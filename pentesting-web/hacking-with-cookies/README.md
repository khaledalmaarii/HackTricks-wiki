# Hacking Cookies

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANU SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakowania, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

**Grupa Try Hard Security**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## Atrybuty Cookie

Ciasteczka posiadajÄ… kilka atrybutÃ³w kontrolujÄ…cych ich zachowanie w przeglÄ…darce uÅ¼ytkownika. Oto przeglÄ…d tych atrybutÃ³w w bardziej biernym tonie:

### Wygasa i Max-Age

DatÄ™ wygaÅ›niÄ™cia ciasteczka okreÅ›la atrybut `Expires`. Z kolei atrybut `Max-age` definiuje czas w sekundach do momentu usuniÄ™cia ciasteczka. **Wybierz `Max-age`, poniewaÅ¼ odzwierciedla nowoczeÅ›niejsze praktyki.**

### Domena

Hosty, ktÃ³re otrzymajÄ… ciasteczko, sÄ… okreÅ›lone przez atrybut `Domain`. DomyÅ›lnie jest on ustawiony na host, ktÃ³ry wydaÅ‚ ciasteczko, nie obejmujÄ…c jego subdomen. Jednak gdy atrybut `Domain` jest jawnie ustawiony, obejmuje on rÃ³wnieÅ¼ subdomeny. Sprawia to, Å¼e okreÅ›lenie atrybutu `Domain` jest mniej restrykcyjnÄ… opcjÄ…, przydatnÄ… w sytuacjach, gdzie konieczne jest udostÄ™pnianie ciasteczek miÄ™dzy subdomenami. Na przykÅ‚ad ustawienie `Domain=mozilla.org` sprawia, Å¼e ciasteczka sÄ… dostÄ™pne na jego subdomenach, takich jak `developer.mozilla.org`.

### ÅšcieÅ¼ka

Konkretna Å›cieÅ¼ka URL, ktÃ³ra musi byÄ‡ obecna w Å¼Ä…danym URL-u, aby zostaÅ‚ wysÅ‚any nagÅ‚Ã³wek `Cookie`, jest wskazana przez atrybut `Path`. Ten atrybut traktuje znak `/` jako separator katalogÃ³w, umoÅ¼liwiajÄ…c dopasowania w podkatalogach.

### Zasady kolejnoÅ›ci

Gdy dwa ciasteczka majÄ… tÄ™ samÄ… nazwÄ™, wybÃ³r ciasteczka do wysÅ‚ania opiera siÄ™ na:

* Ciasteczko pasujÄ…ce do najdÅ‚uÅ¼szej Å›cieÅ¼ki w Å¼Ä…danym URL-u.
* Najnowsze ciasteczko, jeÅ›li Å›cieÅ¼ki sÄ… identyczne.

### SameSite

* Atrybut `SameSite` okreÅ›la, czy ciasteczka sÄ… wysyÅ‚ane w Å¼Ä…daniach pochodzÄ…cych z domen zewnÄ™trznych. Oferuje trzy ustawienia:
* **Strict**: Ogranicza wysyÅ‚anie ciasteczka w Å¼Ä…daniach zewnÄ™trznych.
* **Lax**: Pozwala na wysyÅ‚anie ciasteczka wraz z Å¼Ä…daniami GET inicjowanymi przez strony zewnÄ™trzne.
* **None**: UmoÅ¼liwia wysyÅ‚anie ciasteczka z dowolnej domeny zewnÄ™trznej.

PamiÄ™taj, Å¼e podczas konfigurowania ciasteczek zrozumienie tych atrybutÃ³w moÅ¼e pomÃ³c w zapewnieniu, Å¼e zachowujÄ… siÄ™ zgodnie z oczekiwaniami w rÃ³Å¼nych scenariuszach.

| **Typ Å¼Ä…dania** | **PrzykÅ‚adowy kod**                   | **WysyÅ‚ane ciasteczka, gdy** |
| ---------------- | ---------------------------------- | --------------------- |
| Link             | \<a href="...">\</a>               | NotSet\*, Lax, None   |
| Prerender        | \<link rel="prerender" href=".."/> | NotSet\*, Lax, None   |
| Form GET         | \<form method="GET" action="...">  | NotSet\*, Lax, None   |
| Form POST        | \<form method="POST" action="..."> | NotSet\*, None        |
| iframe           | \<iframe src="...">\</iframe>      | NotSet\*, None        |
| AJAX             | $.get("...")                       | NotSet\*, None        |
| Obraz            | \<img src="...">                   | NetSet\*, None        |

Tabela z [Invicti](https://www.netsparker.com/blog/web-security/same-site-cookie-attribute-prevent-cross-site-request-forgery/) i nieznacznie zmodyfikowana.\
Ciasteczko z atrybutem _**SameSite**_ **zabezpiecza przed atakami CSRF**, gdzie wymagana jest zalogowana sesja.

**\*ZauwaÅ¼, Å¼e od Chrome 80 (luty 2019) domyÅ›lne zachowanie ciasteczka bez atrybutu SameSite** **bÄ™dzie luÅºne** ([https://www.troyhunt.com/promiscuous-cookies-and-their-impending-death-via-the-samesite-policy/](https://www.troyhunt.com/promiscuous-cookies-and-their-impending-death-via-the-samesite-policy/)).\
ZauwaÅ¼, Å¼e tymczasowo, po zastosowaniu tej zmiany, **ciasteczka bez polityki SameSite** **w Chrome bÄ™dÄ… traktowane jako None** podczas **pierwszych 2 minut, a nastÄ™pnie jako Lax dla Å¼Ä…daÅ„ POST z najwyÅ¼szego poziomu miÄ™dzydomenowego.**

## Flagi Ciasteczek

### HttpOnly

Zapobiega to **klientowi** dostÄ™pu do ciasteczka (na przykÅ‚ad za pomocÄ… **Javascript**, np. `document.cookie`)

#### **OminiÄ™cia**

* JeÅ›li strona **wysyÅ‚a ciasteczka jako odpowiedÅº** na Å¼Ä…dania (na przykÅ‚ad na stronie **PHPinfo**), moÅ¼liwe jest wykorzystanie XSS do wysÅ‚ania Å¼Ä…dania do tej strony i **ukradzenia ciasteczek** z odpowiedzi (sprawdÅº przykÅ‚ad w [https://hackcommander.github.io/posts/2022/11/12/bypass-httponly-via-php-info-page/](https://hackcommander.github.io/posts/2022/11/12/bypass-httponly-via-php-info-page/).
* To moÅ¼na ominÄ…Ä‡ za pomocÄ… Å¼Ä…daÅ„ **HTTP TRACE**, poniewaÅ¼ odpowiedÅº serwera (jeÅ›li ta metoda HTTP jest dostÄ™pna) odzwierciedli wysÅ‚ane ciasteczka. Ta technika nazywa siÄ™ **Åšledzenie miÄ™dzywitrynne**.
* Ta technika jest unikana przez **nowoczesne przeglÄ…darki, ktÃ³re nie zezwalajÄ… na wysyÅ‚anie Å¼Ä…dania TRACE** z JS. Jednak znaleziono pewne sposoby obejÅ›cia tego w okreÅ›lonym oprogramowaniu, takie jak wysyÅ‚anie `\r\nTRACE` zamiast `TRACE` do IE6.0 SP2.
* Innym sposobem jest wykorzystanie podatnoÅ›ci zero/dnia przeglÄ…darek.
* MoÅ¼liwe jest **nadpisanie ciasteczek HttpOnly** poprzez przeprowadzenie ataku przepeÅ‚nienia schowka ciasteczkowego:

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

* MoÅ¼liwe jest wykorzystanie ataku [**Cookie Smuggling**](./#cookie-smuggling) do wycieku tych ciasteczek

### Secure

Å»Ä…danie **tylko** wyÅ›le ciasteczko w Å¼Ä…daniu HTTP, jeÅ›li Å¼Ä…danie jest przesyÅ‚ane przez bezpieczny kanaÅ‚ (zazwyczaj **HTTPS**).

## Prefiksy Ciasteczek

Ciasteczka z prefiksem `__Secure-` muszÄ… byÄ‡ ustawione razem z flagÄ… `secure` na stronach zabezpieczonych protokoÅ‚em HTTPS.

Dla ciasteczek z prefiksem `__Host-` muszÄ… byÄ‡ speÅ‚nione kilka warunkÃ³w:

* MuszÄ… byÄ‡ ustawione z flagÄ… `secure`.
* MuszÄ… pochodziÄ‡ z strony zabezpieczonej protokoÅ‚em HTTPS.
* SÄ… one zakazane od okreÅ›lania domeny, uniemoÅ¼liwiajÄ…c ich przesyÅ‚anie do subdomen.
* ÅšcieÅ¼ka dla tych ciasteczek musi byÄ‡ ustawiona na `/`.

Warto zauwaÅ¼yÄ‡, Å¼e ciasteczka z prefiksem `__Host-` nie mogÄ… byÄ‡ wysyÅ‚ane do naddomen ani subdomen. To ograniczenie pomaga w izolowaniu ciasteczek aplikacji. Dlatego stosowanie prefiksu `__Host-` dla wszystkich ciasteczek aplikacji moÅ¼na uznaÄ‡ za dobrÄ… praktykÄ™ w celu zwiÄ™kszenia bezpieczeÅ„stwa i izolacji.
### Nadpisywanie ciasteczek

WiÄ™c jednÄ… z ochron przed ciasteczkami z prefiksem `__Host-` jest uniemoÅ¼liwienie ich nadpisania z subdomen. Zapobieganie na przykÅ‚ad atakom [**Cookie Tossing**](cookie-tossing.md). W prezentacji [**Cookie Crumbles: Unveiling Web Session Integrity Vulnerabilities**](https://www.youtube.com/watch?v=F\_wAzF4a7Xg) ([**paper**](https://www.usenix.org/system/files/usenixsecurity23-squarcina.pdf)) przedstawiono, Å¼e byÅ‚o moÅ¼liwe ustawienie ciasteczek z prefiksem `__HOST-` z subdomeny, oszukujÄ…c parser, na przykÅ‚ad dodajÄ…c "=" na poczÄ…tku lub na poczÄ…tku i na koÅ„cu...:

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Lub w PHP byÅ‚o moÅ¼liwe dodanie **innych znakÃ³w na poczÄ…tku** nazwy ciasteczka, ktÃ³re miaÅ‚y zostaÄ‡ **zamienione na podkreÅ›lenia**, umoÅ¼liwiajÄ…c nadpisanie ciasteczek `__HOST-`:

<figure><img src="../../.gitbook/assets/image (1) (1).png" alt="" width="373"><figcaption></figcaption></figure>

## Ataki na Ciasteczka

JeÅ›li niestandardowe ciasteczko zawiera wraÅ¼liwe dane, sprawdÅº je (szczegÃ³lnie jeÅ›li bierzesz udziaÅ‚ w CTF), poniewaÅ¼ moÅ¼e byÄ‡ podatne na ataki.

### Dekodowanie i Manipulowanie Ciasteczkami

WraÅ¼liwe dane osadzone w ciasteczkach zawsze powinny byÄ‡ dokÅ‚adnie sprawdzane. Ciasteczka zakodowane w Base64 lub podobnych formatach czÄ™sto mogÄ… byÄ‡ zdekodowane. Ta podatnoÅ›Ä‡ pozwala atakujÄ…cym zmieniaÄ‡ zawartoÅ›Ä‡ ciasteczka i podszywaÄ‡ siÄ™ pod innych uÅ¼ytkownikÃ³w, kodujÄ…c zmodyfikowane dane z powrotem do ciasteczka.

### Przechwycenie Sesji

Ten atak polega na kradzieÅ¼y ciasteczka uÅ¼ytkownika w celu uzyskania nieautoryzowanego dostÄ™pu do jego konta w aplikacji. KorzystajÄ…c z ukradzionego ciasteczka, atakujÄ…cy moÅ¼e podszywaÄ‡ siÄ™ pod prawowitego uÅ¼ytkownika.

### Ustalanie Sesji

W tym scenariuszu atakujÄ…cy oszukuje ofiarÄ™, aby uÅ¼yÅ‚a okreÅ›lonego ciasteczka do zalogowania siÄ™. JeÅ›li aplikacja nie przypisuje nowego ciasteczka po zalogowaniu, atakujÄ…cy, posiadajÄ…c oryginalne ciasteczko, moÅ¼e podszyÄ‡ siÄ™ pod ofiarÄ™. Ta technika polega na tym, Å¼e ofiara loguje siÄ™ za pomocÄ… ciasteczka dostarczonego przez atakujÄ…cego.

JeÅ›li znalazÅ‚eÅ› **XSS w subdomenie** lub **masz kontrolÄ™ nad subdomenÄ…**, przeczytaj:

{% content-ref url="cookie-tossing.md" %}
[cookie-tossing.md](cookie-tossing.md)
{% endcontent-ref %}

### Darowizna Sesji

Tutaj atakujÄ…cy przekonuje ofiarÄ™, aby uÅ¼yÅ‚a ciasteczka sesji atakujÄ…cego. Ofiara, wierzÄ…c, Å¼e jest zalogowana do swojego konta, nieumyÅ›lnie wykonuje czynnoÅ›ci w kontekÅ›cie konta atakujÄ…cego.

JeÅ›li znalazÅ‚eÅ› **XSS w subdomenie** lub **masz kontrolÄ™ nad subdomenÄ…**, przeczytaj:

{% content-ref url="cookie-tossing.md" %}
[cookie-tossing.md](cookie-tossing.md)
{% endcontent-ref %}

### [JWT Cookies](../hacking-jwt-json-web-tokens.md)

Kliknij na poprzedni link, aby uzyskaÄ‡ dostÄ™p do strony wyjaÅ›niajÄ…cej moÅ¼liwe wady w JWT.

Tokeny JSON Web (JWT) uÅ¼ywane w ciasteczkach mogÄ… rÃ³wnieÅ¼ zawieraÄ‡ podatnoÅ›ci. Aby uzyskaÄ‡ szczegÃ³Å‚owe informacje na temat potencjalnych wad i jak je wykorzystaÄ‡, zaleca siÄ™ zapoznanie siÄ™ z podlinkowanym dokumentem dotyczÄ…cym hakowania JWT.

### Podrobienie Å»Ä…dania MiÄ™dzywitrynowego (CSRF)

Ten atak zmusza zalogowanego uÅ¼ytkownika do wykonania niechcianych dziaÅ‚aÅ„ w aplikacji internetowej, w ktÃ³rej obecnie jest uwierzytelniony. AtakujÄ…cy mogÄ… wykorzystaÄ‡ ciasteczka, ktÃ³re sÄ… automatycznie wysyÅ‚ane z kaÅ¼dym Å¼Ä…daniem do podatnej strony.

### Puste Ciasteczka

(SprawdÅº dalsze szczegÃ³Å‚y w [oryginalnym badaniu](https://blog.ankursundara.com/cookie-bugs/)) PrzeglÄ…darki pozwalajÄ… na tworzenie ciasteczek bez nazwy, co moÅ¼na zademonstrowaÄ‡ za pomocÄ… JavaScriptu, jak pokazano poniÅ¼ej:
```js
document.cookie = "a=v1"
document.cookie = "=test value;" // Setting an empty named cookie
document.cookie = "b=v2"
```
Wynikiem w nagÅ‚Ã³wku cookie wysÅ‚anym jest `a=v1; test value; b=v2;`. Co ciekawe, umoÅ¼liwia to manipulacjÄ™ ciasteczkami, jeÅ›li ustawiono puste ciasteczko o nazwie, potencjalnie kontrolujÄ…c inne ciasteczka poprzez ustawienie pustego ciasteczka na okreÅ›lonÄ… wartoÅ›Ä‡:
```js
function setCookie(name, value) {
document.cookie = `${name}=${value}`;
}

setCookie("", "a=b"); // Setting the empty cookie modifies another cookie's value
```
To prowadzi do przeglÄ…darki wysyÅ‚ajÄ…cej nagÅ‚Ã³wek cookie interpretowany przez kaÅ¼dy serwer WWW jako cookie o nazwie `a` o wartoÅ›ci `b`.

#### BÅ‚Ä…d w Chrome: Problem z kodem zastÄ™pczym Unicode

W Chrome, jeÅ›li kod zastÄ™pczy Unicode jest czÄ™Å›ciÄ… ustawionego ciasteczka, `document.cookie` zostaje uszkodzone, zwracajÄ…c pÃ³Åºniej pusty ciÄ…g znakÃ³w:
```js
document.cookie = "\ud800=meep";
```
To prowadzi do wyniku `document.cookie` wypisujÄ…cego pusty ciÄ…g znakÃ³w, co wskazuje na trwaÅ‚e uszkodzenie.

#### Przemyt ciasteczek z powodu problemÃ³w z parsowaniem

(SprawdÅº dalsze szczegÃ³Å‚y w [oryginalnym badaniu](https://blog.ankursundara.com/cookie-bugs/)) Kilka serwerÃ³w internetowych, w tym te oparte na Java (Jetty, TomCat, Undertow) i Pythonie (Zope, cherrypy, web.py, aiohttp, bottle, webob), bÅ‚Ä™dnie obsÅ‚uguje ciasteczka ze wzglÄ™du na przestarzaÅ‚e wsparcie dla RFC2965. OdczytujÄ… wartoÅ›Ä‡ ciasteczka w podwÃ³jnych cudzysÅ‚owach jako pojedynczÄ… wartoÅ›Ä‡, nawet jeÅ›li zawiera Å›redniki, ktÃ³re normalnie powinny oddzielaÄ‡ pary klucz-wartoÅ›Ä‡:
```
RENDER_TEXT="hello world; JSESSIONID=13371337; ASDF=end";
```
#### WraÅ¼liwoÅ›ci na Wstrzykiwanie Ciasteczek

(SprawdÅº dalsze szczegÃ³Å‚y w [oryginalnym badaniu](https://blog.ankursundara.com/cookie-bugs/)) NieprawidÅ‚owe parsowanie ciasteczek przez serwery, w szczegÃ³lnoÅ›ci Undertow, Zope oraz te korzystajÄ…ce z `http.cookie.SimpleCookie` i `http.cookie.BaseCookie` w Pythonie, tworzy moÅ¼liwoÅ›ci atakÃ³w wstrzykiwania ciasteczek. Te serwery niepoprawnie ograniczajÄ… poczÄ…tek nowych ciasteczek, co pozwala atakujÄ…cym podszyÄ‡ siÄ™ pod ciasteczka:

* Undertow oczekuje nowego ciasteczka natychmiast po wartoÅ›ci w cudzysÅ‚owie bez Å›rednika.
* Zope szuka przecinka, aby rozpoczÄ…Ä‡ parsowanie kolejnego ciasteczka.
* Klasy ciasteczek w Pythonie zaczynajÄ… parsowanie od znaku spacji.

Ta wraÅ¼liwoÅ›Ä‡ jest szczegÃ³lnie niebezpieczna w aplikacjach internetowych polegajÄ…cych na ochronie przed CSRF opartej na ciasteczkach, poniewaÅ¼ pozwala atakujÄ…cym wstrzyknÄ…Ä‡ podszyte ciasteczka z tokenem CSRF, potencjalnie omijajÄ…c Å›rodki bezpieczeÅ„stwa. Problem jest pogÅ‚Ä™biony przez sposÃ³b obsÅ‚ugi przez Python zduplikowanych nazw ciasteczek, gdzie ostatnie wystÄ…pienie zastÄ™puje wczeÅ›niejsze. Podnosi to rÃ³wnieÅ¼ obawy dotyczÄ…ce ciasteczek `__Secure-` i `__Host-` w niebezpiecznych kontekstach oraz moÅ¼e prowadziÄ‡ do pomijania autoryzacji, gdy ciasteczka sÄ… przekazywane do serwerÃ³w back-endowych podatnych na podszywanie siÄ™.

### Dodatkowe Sprawdzenia WraÅ¼liwych Ciasteczek

#### **Podstawowe sprawdzenia**

* **Ciasteczko** jest **takie samo** za kaÅ¼dym razem, gdy siÄ™ **logujesz**.
* Wyloguj siÄ™ i sprÃ³buj uÅ¼yÄ‡ tego samego ciasteczka.
* SprÃ³buj zalogowaÄ‡ siÄ™ na 2 urzÄ…dzeniach (lub przeglÄ…darkach) na to samo konto, uÅ¼ywajÄ…c tego samego ciasteczka.
* SprawdÅº, czy ciasteczko zawiera jakieÅ› informacje i sprÃ³buj je zmodyfikowaÄ‡.
* SprÃ³buj utworzyÄ‡ kilka kont o prawie takiej samej nazwie uÅ¼ytkownika i sprawdÅº, czy moÅ¼na zauwaÅ¼yÄ‡ podobieÅ„stwa.
* SprawdÅº opcjÄ™ "**zapamiÄ™taj mnie**", jeÅ›li istnieje, aby zobaczyÄ‡, jak dziaÅ‚a. JeÅ›li istnieje i moÅ¼e byÄ‡ podatne, zawsze uÅ¼ywaj ciasteczka z opcji **zapamiÄ™taj mnie** bez Å¼adnego innego ciasteczka.
* SprawdÅº, czy poprzednie ciasteczko dziaÅ‚a nawet po zmianie hasÅ‚a.

#### **Zaawansowane ataki na ciasteczka**

JeÅ›li ciasteczko pozostaje takie samo (lub prawie takie samo) po zalogowaniu, oznacza to prawdopodobnie, Å¼e ciasteczko jest powiÄ…zane z pewnym polem twojego konta (prawdopodobnie nazwÄ… uÅ¼ytkownika). W takim przypadku moÅ¼esz:

* SprÃ³buj utworzyÄ‡ wiele **kont** z bardzo **podobnymi** nazwami uÅ¼ytkownikÃ³w i sprÃ³buj **odgadnÄ…Ä‡**, jak dziaÅ‚a algorytm.
* SprÃ³buj **brute force** nazwy uÅ¼ytkownika. JeÅ›li ciasteczko sÅ‚uÅ¼y tylko jako metoda uwierzytelniania dla twojej nazwy uÅ¼ytkownika, moÅ¼esz utworzyÄ‡ konto o nazwie uÅ¼ytkownika "**Bmin**" i **brute force** kaÅ¼dy pojedynczy **bit** ciasteczka, poniewaÅ¼ jednym z ciasteczek, ktÃ³re sprÃ³bujesz, bÄ™dzie to naleÅ¼Ä…ce do "**admin**".
* SprÃ³buj **Padding Oracle** (moÅ¼esz odszyfrowaÄ‡ zawartoÅ›Ä‡ ciasteczka). UÅ¼yj **padbuster**.

**Padding Oracle - PrzykÅ‚ady Padbuster**
```bash
padbuster <URL/path/when/successfully/login/with/cookie> <COOKIE> <PAD[8-16]>
# When cookies and regular Base64
padbuster http://web.com/index.php u7bvLewln6PJPSAbMb5pFfnCHSEd6olf 8 -cookies auth=u7bvLewln6PJPSAbMb5pFfnCHSEd6olf

# If Base64 urlsafe or hex-lowercase or hex-uppercase --encoding parameter is needed, for example:
padBuster http://web.com/home.jsp?UID=7B216A634951170FF851D6CC68FC9537858795A28ED4AAC6
7B216A634951170FF851D6CC68FC9537858795A28ED4AAC6 8 -encoding 2
```
Padbuster bÄ™dzie podejmowaÅ‚ kilka prÃ³b i zapyta, ktÃ³ra z nich jest warunkiem bÅ‚Ä™du (ten, ktÃ³ry nie jest prawidÅ‚owy).

NastÄ™pnie rozpocznie deszyfrowanie ciasteczka (moÅ¼e to potrwaÄ‡ kilka minut).

JeÅ›li atak zakoÅ„czyÅ‚ siÄ™ sukcesem, moÅ¼esz sprÃ³bowaÄ‡ zaszyfrowaÄ‡ wybrany ciÄ…g znakÃ³w. Na przykÅ‚ad, jeÅ›li chciaÅ‚byÅ› **zaszyfrowaÄ‡** **user=administrator**
```
padbuster http://web.com/index.php 1dMjA5hfXh0jenxJQ0iW6QXKkzAGIWsiDAKV3UwJPT2lBP+zAD0D0w== 8 -cookies thecookie=1dMjA5hfXh0jenxJQ0iW6QXKkzAGIWsiDAKV3UwJPT2lBP+zAD0D0w== -plaintext user=administrator
```
To wykonanie da Ci poprawnie zaszyfrowane i zakodowane ciasteczko z ciÄ…giem **user=administrator** wewnÄ…trz.

**CBC-MAC**

ByÄ‡ moÅ¼e ciasteczko mogÅ‚oby mieÄ‡ jakÄ…Å› wartoÅ›Ä‡ i byÄ‡ podpisane za pomocÄ… CBC. Wtedy integralnoÅ›Ä‡ wartoÅ›ci to podpis utworzony za pomocÄ… CBC z tÄ… samÄ… wartoÅ›ciÄ…. PoniewaÅ¼ zaleca siÄ™ uÅ¼ycie wektora zerowego jako IV, ten rodzaj sprawdzania integralnoÅ›ci moÅ¼e byÄ‡ podatny na atak.

**Atak**

1. Uzyskaj podpis nazwy uÅ¼ytkownika **administ** = **t**
2. Uzyskaj podpis nazwy uÅ¼ytkownika **rator\x00\x00\x00 XOR t** = **t'**
3. Ustaw w ciasteczku wartoÅ›Ä‡ **administrator+t'** (**t'** bÄ™dzie poprawnym podpisem **(rator\x00\x00\x00 XOR t) XOR t** = **rator\x00\x00\x00**

**ECB**

JeÅ›li ciasteczko jest szyfrowane za pomocÄ… ECB, moÅ¼e byÄ‡ podatne na atak.\
Po zalogowaniu otrzymywane ciasteczko musi byÄ‡ zawsze takie samo.

**Jak wykryÄ‡ i zaatakowaÄ‡:**

UtwÃ³rz 2 uÅ¼ytkownikÃ³w z prawie takimi samymi danymi (nazwa uÅ¼ytkownika, hasÅ‚o, e-mail, itp.) i sprÃ³buj odkryÄ‡ jakiÅ› wzorzec w danym ciasteczku

UtwÃ³rz uÅ¼ytkownika o nazwie na przykÅ‚ad "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa" i sprawdÅº, czy istnieje jakiÅ› wzorzec w ciasteczku (poniewaÅ¼ ECB szyfruje kaÅ¼dy blok tym samym kluczem, te same zaszyfrowane bajty mogÄ… siÄ™ pojawiÄ‡, jeÅ›li nazwa uÅ¼ytkownika jest szyfrowana).

Powinien byÄ‡ jakiÅ› wzorzec (o wielkoÅ›ci uÅ¼ywanego bloku). WiÄ™c, znajÄ…c sposÃ³b, w jaki jest szyfrowany ciÄ…g "a", moÅ¼esz utworzyÄ‡ nazwÄ™ uÅ¼ytkownika: "a"\*(rozmiar bloku)+"admin". NastÄ™pnie moÅ¼esz usunÄ…Ä‡ zaszyfrowany wzorzec bloku "a" z ciasteczka. I bÄ™dziesz mieÄ‡ ciasteczko uÅ¼ytkownika "admin".

## Referencje

* [https://blog.ankursundara.com/cookie-bugs/](https://blog.ankursundara.com/cookie-bugs/)
* [https://www.linkedin.com/posts/rickey-martin-24533653\_100daysofhacking-penetrationtester-ethicalhacking-activity-7016286424526180352-bwDd](https://www.linkedin.com/posts/rickey-martin-24533653\_100daysofhacking-penetrationtester-ethicalhacking-activity-7016286424526180352-bwDd)

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub grupy [**telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
