# Cookie Tossing

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Description

ê³µê²©ìê°€ **ì„œë¸Œë„ë©”ì¸ì´ë‚˜ íšŒì‚¬ì˜ ë„ë©”ì¸ì„ ì œì–´í•˜ê±°ë‚˜ ì„œë¸Œë„ë©”ì¸ì—ì„œ XSSë¥¼ ë°œê²¬í•  ìˆ˜ ìˆë‹¤ë©´** ì´ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¿ í‚¤ í•´í‚¹ ì„¹ì…˜ì—ì„œ ì–¸ê¸‰í–ˆë“¯ì´, **ì¿ í‚¤ê°€ ë„ë©”ì¸ì— ì„¤ì •ë˜ë©´(ì§€ì •ëœ ê²½ìš°) ë„ë©”ì¸ê³¼ ì„œë¸Œë„ë©”ì¸ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.**

{% hint style="danger" %}
ë”°ë¼ì„œ, **ê³µê²©ìëŠ” íŠ¹ì • ì¿ í‚¤ë¥¼ ë„ë©”ì¸ê³¼ ì„œë¸Œë„ë©”ì¸ì— ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´** `document.cookie="session=1234; Path=/app/login; domain=.example.com"`
{% endhint %}

ì´ê²ƒì€ ìœ„í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µê²©ìëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **í”¼í•´ìì˜ ì¿ í‚¤ë¥¼ ê³µê²©ìì˜ ê³„ì •ì— ê³ ì •ì‹œì¼œì„œ ì‚¬ìš©ìê°€ ì´ë¥¼ ì¸ì§€í•˜ì§€ ëª»í•˜ë©´,** **ê³µê²©ìì˜ ê³„ì •ì—ì„œ í–‰ë™ì„ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.** ê³µê²©ìëŠ” í¥ë¯¸ë¡œìš´ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤(í”Œë«í¼ì—ì„œ ì‚¬ìš©ìì˜ ê²€ìƒ‰ ê¸°ë¡ í™•ì¸, í”¼í•´ìê°€ ê³„ì •ì— ì‹ ìš©ì¹´ë“œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŒ...)
* **ì¿ í‚¤ê°€ ë¡œê·¸ì¸ í›„ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ê²½ìš°**, ê³µê²©ìëŠ” **ì¿ í‚¤ë¥¼ ê³ ì •(session-fixation)**í•˜ê³  í”¼í•´ìê°€ ë¡œê·¸ì¸í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦° í›„ **ê·¸ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í”¼í•´ìë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
* ë•Œë•Œë¡œ, ì„¸ì…˜ ì¿ í‚¤ê°€ ë³€ê²½ë˜ë”ë¼ë„ ê³µê²©ìëŠ” ì´ì „ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ê³  ìƒˆë¡œìš´ ì¿ í‚¤ë„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ì¿ í‚¤ê°€ ì´ˆê¸° ê°’ì„ ì„¤ì •í•˜ëŠ” ê²½ìš°**(ì˜ˆ: í”Œë¼ìŠ¤í¬ì—ì„œ **ì¿ í‚¤**ê°€ **ì„¸ì…˜ì˜ CSRF í† í°**ì„ **ì„¤ì •í•˜ê³  ì´ ê°’ì´ í”¼í•´ìê°€ ë¡œê·¸ì¸í•œ í›„ì—ë„ ìœ ì§€ë˜ëŠ” ê²½ìš°**), **ê³µê²©ìëŠ” ì´ ì•Œë ¤ì§„ ê°’ì„ ì„¤ì •í•œ í›„ ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**(ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ê³µê²©ìëŠ” CSRF í† í°ì„ ì•Œê³  ìˆìœ¼ë¯€ë¡œ ì‚¬ìš©ìê°€ CSRF ìš”ì²­ì„ ìˆ˜í–‰í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤).
* ê°’ì„ ì„¤ì •í•˜ëŠ” ê²ƒì²˜ëŸ¼, ê³µê²©ìëŠ” ì„œë²„ì—ì„œ ìƒì„±ëœ ì¸ì¦ë˜ì§€ ì•Šì€ ì¿ í‚¤ë¥¼ ì–»ê³ , ê·¸ë¡œë¶€í„° CSRF í† í°ì„ ì–»ì–´ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

### Cookie Order

ë¸Œë¼ìš°ì €ê°€ **ê°™ì€ ì´ë¦„ì˜ ë‘ ì¿ í‚¤ë¥¼ ìˆ˜ì‹ í•˜ê³  ë™ì¼í•œ ë²”ìœ„**(ë„ë©”ì¸, ì„œë¸Œë„ë©”ì¸ ë° ê²½ë¡œ)ì— ë¶€ë¶„ì ìœ¼ë¡œ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ê²½ìš°, **ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ì— ëŒ€í•´ ë‘ ì¿ í‚¤ì˜ ê°’ì„ ëª¨ë‘ ë³´ëƒ…ë‹ˆë‹¤.**

ê°€ì¥ **êµ¬ì²´ì ì¸ ê²½ë¡œ**ë¥¼ ê°€ì§„ ì¿ í‚¤ê°€ ë¨¼ì € ì„¤ì •ë˜ê³ , ê·¸ ë‹¤ìŒ ë‹¤ë¥¸ ì¿ í‚¤ì˜ ê°’ì´ ì„¤ì •ë©ë‹ˆë‹¤. ì˜ˆ: `Cookie: iduser=MoreSpecificAndOldestCookie; iduser=LessSpecific;`

ëŒ€ë¶€ë¶„ì˜ **ì›¹ì‚¬ì´íŠ¸ëŠ” ì²« ë²ˆì§¸ ê°’ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.** ë”°ë¼ì„œ ê³µê²©ìê°€ ì¿ í‚¤ë¥¼ ì„¤ì •í•˜ë ¤ë©´ ë‹¤ë¥¸ ì¿ í‚¤ê°€ ì„¤ì •ë˜ê¸° ì „ì— ì„¤ì •í•˜ê±°ë‚˜ ë” êµ¬ì²´ì ì¸ ê²½ë¡œë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

{% hint style="warning" %}
ë˜í•œ, **ë” êµ¬ì²´ì ì¸ ê²½ë¡œì— ì¿ í‚¤ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥**ì€ ë§¤ìš° í¥ë¯¸ë¡­ìŠµë‹ˆë‹¤. í”¼í•´ìê°€ ìì‹ ì˜ ì¿ í‚¤ë¡œ ì‘ì—…í•˜ê²Œ í•  ìˆ˜ ìˆì§€ë§Œ ì•…ì„± ì¿ í‚¤ê°€ ì„¤ì •ëœ íŠ¹ì • ê²½ë¡œì—ì„œëŠ” ì´ì „ì— ì„¤ì •ëœ ì¿ í‚¤ê°€ ì „ì†¡ë©ë‹ˆë‹¤.
{% endhint %}

### Protection Bypass

ì´ ê³µê²©ì— ëŒ€í•œ ê°€ëŠ¥í•œ ë³´í˜¸ ë°©ë²•ì€ **ì›¹ ì„œë²„ê°€ ê°™ì€ ì´ë¦„ì˜ ë‘ ì¿ í‚¤ë¥¼ ë‘ ê°œì˜ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ìˆ˜ë½í•˜ì§€ ì•ŠëŠ” ê²ƒì…ë‹ˆë‹¤.**

ê³µê²©ìê°€ í”¼í•´ìì—ê²Œ ì´ë¯¸ ì¿ í‚¤ê°€ ì œê³µëœ í›„ ì¿ í‚¤ë¥¼ ì„¤ì •í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´, ê³µê²©ìëŠ” **ì¿ í‚¤ ì˜¤ë²„í”Œë¡œìš°**ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìœ¼ë©°, ê·¸ëŸ° ë‹¤ìŒ **ì •ìƒ ì¿ í‚¤ê°€ ì‚­ì œë˜ë©´ ì•…ì„± ì¿ í‚¤ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

ë˜ ë‹¤ë¥¸ ìœ ìš©í•œ **ìš°íšŒ ë°©ë²•**ì€ **ì¿ í‚¤ ì´ë¦„ì„ URL ì¸ì½”ë”©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.** ì¼ë¶€ ë³´í˜¸ëŠ” ìš”ì²­ì—ì„œ ê°™ì€ ì´ë¦„ì˜ ë‘ ì¿ í‚¤ë¥¼ í™•ì¸í•˜ê³  ì„œë²„ëŠ” ì¿ í‚¤ ì´ë¦„ì„ ë””ì½”ë”©í•©ë‹ˆë‹¤.

### Cookie Bomb

Cookie Tossing ê³µê²©ì€ **Cookie Bomb** ê³µê²©ì„ ìˆ˜í–‰í•˜ëŠ” ë°ì—ë„ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="cookie-bomb.md" %}
[cookie-bomb.md](cookie-bomb.md)
{% endcontent-ref %}

### Defense**s**

#### **ì¿ í‚¤ ì´ë¦„ì— ì ‘ë‘ì‚¬ `__Host` ì‚¬ìš©**

* ì¿ í‚¤ ì´ë¦„ì— ì´ ì ‘ë‘ì‚¬ê°€ ìˆëŠ” ê²½ìš°, **Secureë¡œ í‘œì‹œë˜ê³ , ì•ˆì „í•œ ì¶œì²˜ì—ì„œ ì „ì†¡ë˜ë©°, Domain ì†ì„±ì´ í¬í•¨ë˜ì§€ ì•Šê³ , Path ì†ì„±ì´ /ë¡œ ì„¤ì •ëœ ê²½ìš°ì—ë§Œ** Set-Cookie ì§€ì‹œë¬¸ì—ì„œ **ìˆ˜ë½ë©ë‹ˆë‹¤.**
* **ì´ê²ƒì€ ì„œë¸Œë„ë©”ì¸ì´ ì¿ í‚¤ë¥¼ ìµœìƒìœ„ ë„ë©”ì¸ìœ¼ë¡œ ê°•ì œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì¿ í‚¤ëŠ” "ë„ë©”ì¸ ì ê¸ˆ"ìœ¼ë¡œ ê°„ì£¼ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

### References

* [**@blueminimal**](https://twitter.com/blueminimal)
* [**https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers**](https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers)
* [**https://github.blog/2013-04-09-yummy-cookies-across-domains/**](https://github.blog/2013-04-09-yummy-cookies-across-domains/)
* [**Cookie Crumbles: Unveiling Web Session Integrity Vulnerabilities**](https://www.youtube.com/watch?v=F\_wAzF4a7Xg)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
