<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w GitHub.

</details>


## Opis

JeÅ›li atakujÄ…cy moÅ¼e **kontrolowaÄ‡ subdomenÄ™ lub domenÄ™ firmy lub znaleÅºÄ‡ XSS w subdomenie**, bÄ™dzie w stanie przeprowadziÄ‡ ten atak.

Jak wskazano w sekcji Hacking z wykorzystaniem plikÃ³w cookie, gdy **cookie jest ustawione dla domeny (okreÅ›lajÄ…c jÄ…), bÄ™dzie uÅ¼ywane w domenie i subdomenach**.

{% hint style="danger" %}
Dlatego **atakujÄ…cy bÄ™dzie w stanie ustawiÄ‡ dla domeny i subdomen okreÅ›lone cookie, wykonujÄ…c coÅ› w rodzaju** `document.cookie="session=1234; Path=/app/login; domain=.example.com"`
{% endhint %}

MoÅ¼e to byÄ‡ niebezpieczne, poniewaÅ¼ atakujÄ…cy moÅ¼e:

* **ZafiksowaÄ‡ cookie ofiary na swoje konto**, wiÄ™c jeÅ›li uÅ¼ytkownik tego nie zauwaÅ¼y, **wykona czynnoÅ›ci na koncie atakujÄ…cego**, a atakujÄ…cy moÅ¼e uzyskaÄ‡ pewne interesujÄ…ce informacje (sprawdziÄ‡ historiÄ™ wyszukiwania uÅ¼ytkownika na platformie, ofiara moÅ¼e wprowadziÄ‡ swojÄ… kartÄ™ kredytowÄ… do konta...)
* JeÅ›li **cookie nie zmienia siÄ™ po zalogowaniu**, atakujÄ…cy moÅ¼e po prostu **zafiksowaÄ‡ cookie**, poczekaÄ‡, aÅ¼ ofiara siÄ™ zaloguje, a nastÄ™pnie **uÅ¼yÄ‡ tego cookie do zalogowania siÄ™ jako ofiara**.
* JeÅ›li **cookie ustawia pewnÄ… wartoÅ›Ä‡ poczÄ…tkowÄ…** (np. w przypadku flask, gdzie **cookie** moÅ¼e **ustawiÄ‡ token CSRF** sesji, a ta wartoÅ›Ä‡ bÄ™dzie utrzymywana po zalogowaniu ofiary), **atakujÄ…cy moÅ¼e ustawiÄ‡ tÄ™ znanÄ… wartoÅ›Ä‡, a nastÄ™pnie jej naduÅ¼ywaÄ‡** (w takim scenariuszu atakujÄ…cy moÅ¼e zmusiÄ‡ uÅ¼ytkownika do wykonania Å¼Ä…dania CSRF, poniewaÅ¼ zna token CSRF).

## KolejnoÅ›Ä‡ cookie

Gdy przeglÄ…darka otrzymuje dwa pliki cookie o tej samej nazwie, **czÄ™Å›ciowo wpÅ‚ywajÄ…ce na ten sam zakres** (domena, subdomeny i Å›cieÅ¼ka), przeglÄ…darka **wyÅ›le obie wartoÅ›ci cookie**, jeÅ›li obie sÄ… waÅ¼ne dla Å¼Ä…dania.

W zaleÅ¼noÅ›ci od tego, kto ma **najbardziej szczegÃ³Å‚owÄ… Å›cieÅ¼kÄ™** lub ktÃ³ry jest **starszy**, przeglÄ…darka **ustawi najpierw wartoÅ›Ä‡ cookie**, a nastÄ™pnie wartoÅ›Ä‡ drugiego, jak w: `Cookie: iduser=MoreSpecificAndOldestCookie; iduser=LessSpecific;`

WiÄ™kszoÅ›Ä‡ **witryn uÅ¼ywa tylko pierwszej wartoÅ›ci**. Dlatego, jeÅ›li atakujÄ…cy chce ustawiÄ‡ plik cookie, lepiej go ustawiÄ‡ przed innym lub ustawiÄ‡ go z bardziej szczegÃ³Å‚owÄ… Å›cieÅ¼kÄ….

{% hint style="warning" %}
Ponadto, moÅ¼liwoÅ›Ä‡ **ustawienia pliku cookie w bardziej szczegÃ³Å‚owej Å›cieÅ¼ce** jest bardzo interesujÄ…ca, poniewaÅ¼ bÄ™dziesz mÃ³gÅ‚ sprawiÄ‡, Å¼e **ofiara bÄ™dzie dziaÅ‚aÄ‡ z jej plikiem cookie, z wyjÄ…tkiem konkretnej Å›cieÅ¼ki, gdzie zostanie wysÅ‚ane zÅ‚oÅ›liwe plik cookie**.
{% endhint %}

## OminiÄ™cie zabezpieczeÅ„

MoÅ¼liwÄ… ochronÄ… przed tym atakiem byÅ‚oby to, Å¼e **serwer sieciowy nie bÄ™dzie akceptowaÅ‚ Å¼Ä…daÅ„ z dwoma plikami cookie o tej samej nazwie, ale o dwÃ³ch rÃ³Å¼nych wartoÅ›ciach**.

Aby ominÄ…Ä‡ scenariusz, w ktÃ³rym atakujÄ…cy ustawia plik cookie po tym, jak ofiarze juÅ¼ zostaÅ‚ przekazany plik cookie, atakujÄ…cy mÃ³gÅ‚by spowodowaÄ‡ **przepeÅ‚nienie pliku cookie**, a nastÄ™pnie, gdy **legitymacyjny plik cookie zostanie usuniÄ™ty, ustawiÄ‡ zÅ‚oÅ›liwy plik cookie**.

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

Innym przydatnym **sposobem ominiÄ™cia** moÅ¼e byÄ‡ **kodowanie URL nazwy pliku cookie**, poniewaÅ¼ niektÃ³re zabezpieczenia sprawdzajÄ…, czy w Å¼Ä…daniu znajdujÄ… siÄ™ 2 pliki cookie o tej samej nazwie, a nastÄ™pnie serwer dekoduje nazwy plikÃ³w cookie.

## Bomba cookie

Atak Cookie Tossing moÅ¼e byÄ‡ rÃ³wnieÅ¼ wykorzystany do przeprowadzenia ataku **Cookie Bomb**:

{% content-ref url="cookie-bomb.md" %}
[cookie-bomb.md](cookie-bomb.md)
{% endcontent-ref %}

## Obrona

### **UÅ¼yj prefiksu `__Host` w nazwie pliku cookie**

* JeÅ›li nazwa pliku cookie ma ten prefiks, **bÄ™dzie akceptowana tylko** w dyrektywie Set-Cookie, jeÅ›li jest oznaczona jako Secure, zostaÅ‚a wysÅ‚ana z bezpiecznego ÅºrÃ³dÅ‚a, nie zawiera atrybutu Domain i ma ustawiony atrybut Path na /
* **UniemoÅ¼liwia to subdomenom wymuszenie pliku cookie dla domeny apex, poniewaÅ¼ takie pliki cookie mogÄ… byÄ‡ postrzegane jako "zablokowane dla domeny"**

## OdwoÅ‚ania

* [**@blueminimal**](https://twitter.com/blueminimal)
* [**https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers**](https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers)
* [**https://github.blog/2013-04-09-yummy-cookies-across-domains/**](https://github.blog/2013-04-09-yummy-cookies-across-domains/)


<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w GitHub.

</details>
