<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- Travaillez-vous dans une entreprise de **cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **groupe Discord** ou le [**groupe telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


## Description

Si un attaquant peut **contrÃ´ler un sous-domaine ou le domaine d'une entreprise ou trouve un XSS dans un sous-domaine**, il pourra effectuer cette attaque.

Comme indiquÃ© dans la section Cookies Hacking, lorsqu'un **cookie est dÃ©fini pour un domaine (en le spÃ©cifiant), il sera utilisÃ© dans le domaine et les sous-domaines.**

{% hint style="danger" %}
Par consÃ©quent, **un attaquant sera en mesure de dÃ©finir pour le domaine et les sous-domaines un cookie spÃ©cifique en faisant quelque chose comme** `document.cookie="session=1234; Path=/app/login; domain=.example.com"`
{% endhint %}

Cela peut Ãªtre dangereux car l'attaquant peut Ãªtre en mesure de :

* **Fixer le cookie de la victime sur le compte de l'attaquant** de sorte que si l'utilisateur ne remarque pas, **il effectuera les actions dans le compte de l'attaquant** et l'attaquant peut obtenir des informations intÃ©ressantes (vÃ©rifier l'historique des recherches de l'utilisateur sur la plateforme, la victime peut dÃ©finir sa carte de crÃ©dit dans le compte...)
* Si le **cookie ne change pas aprÃ¨s la connexion**, l'attaquant peut simplement **fixer un cookie**, attendre que la victime se connecte, puis **utiliser ce cookie pour se connecter en tant que victime**.
* Si le **cookie dÃ©finit une valeur initiale** (comme dans Flask oÃ¹ le **cookie** peut **dÃ©finir** le **jeton CSRF** de la session et cette valeur sera maintenue aprÃ¨s la connexion de la victime), l'**attaquant peut dÃ©finir cette valeur connue et ensuite l'exploiter** (dans ce scÃ©nario, l'attaquant peut ensuite faire effectuer une demande CSRF Ã  l'utilisateur car il connaÃ®t le jeton CSRF).

## Ordre des cookies

Lorsqu'un navigateur reÃ§oit deux cookies avec le mÃªme nom **affectant partiellement la mÃªme portÃ©e** (domaine, sous-domaines et chemin), le **navigateur enverra les deux valeurs du cookie** lorsque les deux sont valides pour la demande.

En fonction de celui qui a **le chemin le plus spÃ©cifique** ou de celui qui est **le plus ancien**, le navigateur **dÃ©finira d'abord la valeur du cookie** puis la valeur de l'autre comme dans : `Cookie: iduser=MoreSpecificAndOldestCookie; iduser=LessSpecific;`

La plupart des **sites Web n'utiliseront que la premiÃ¨re valeur**. Ainsi, si un attaquant veut dÃ©finir un cookie, il est prÃ©fÃ©rable de le dÃ©finir avant qu'un autre ne soit dÃ©fini ou de le dÃ©finir avec un chemin plus spÃ©cifique.

{% hint style="warning" %}
De plus, la capacitÃ© Ã  **dÃ©finir un cookie dans un chemin plus spÃ©cifique** est trÃ¨s intÃ©ressante car vous pourrez faire travailler la **victime avec son cookie sauf dans le chemin spÃ©cifique oÃ¹ le cookie malveillant dÃ©fini sera envoyÃ© en premier**.
{% endhint %}

## Contournement de la protection

Une protection possible contre cette attaque serait que le **serveur Web n'accepte pas les demandes avec deux cookies avec le mÃªme nom mais deux valeurs diffÃ©rentes**.

Pour contourner le scÃ©nario oÃ¹ l'attaquant dÃ©finit un cookie aprÃ¨s que la victime ait dÃ©jÃ  reÃ§u le cookie, l'attaquant pourrait provoquer un **dÃ©bordement de cookie** et ensuite, une fois que le **cookie lÃ©gitime est supprimÃ©, dÃ©finir le malveillant**.

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

Un autre **contournement** utile pourrait Ãªtre de **coder l'URL avec le nom du cookie** car certaines protections vÃ©rifient deux cookies avec le mÃªme nom dans une demande, puis le serveur dÃ©coder les noms des cookies.

## Bombe de cookies

Une attaque de Cookie Tossing peut Ã©galement Ãªtre utilisÃ©e pour effectuer une attaque de **Bombe de cookies** :

{% content-ref url="cookie-bomb.md" %}
[cookie-bomb.md](cookie-bomb.md)
{% endcontent-ref %}

## DÃ©fenses

### **Utilisez le prÃ©fixe `__Host` dans le nom du cookie**

* Si un nom de cookie a ce prÃ©fixe, il **ne sera acceptÃ© que** dans une directive Set-Cookie s'il est marquÃ© Secure, a Ã©tÃ© envoyÃ© depuis une origine sÃ©curisÃ©e, ne comprend pas d'attribut Domain et a l'attribut Path dÃ©fini sur /
* **Cela empÃªche les sous-domaines de forcer un cookie sur le domaine apex car ces cookies peuvent Ãªtre considÃ©rÃ©s comme "verrouillÃ©s sur le domaine"**

## RÃ©fÃ©rences

* [**@blueminimal**](https://twitter.com/blueminimal)
* [**https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers**](https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers)
* [**https://github.blog/2013-04-09-yummy-cookies-across-domains/**](https://github.blog/2013-04-09-yummy-cookies-across-domains/) 

<details>
