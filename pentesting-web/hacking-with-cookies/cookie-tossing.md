# Bacanje kola캜i캖a

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

### Opis

Ako napada캜 mo쬰 **kontrolisati poddomen ili domen kompanije ili prona캠e XSS u poddomenu** mo캖i 캖e da izvede ovaj napad.

Kao 코to je nazna캜eno u sekciji Hekovanje kola캜i캖a, kada se **kola캜i캖 postavi na domen (navo캠enjem) bi캖e kori코캖en na domenu i poddomenima.**

{% hint style="danger" %}
Stoga, **napada캜 캖e mo캖i da postavi na domen i poddomene odre캠eni kola캜i캖 rade캖i ne코to sli캜no kao** `document.cookie="sesija=1234; Putanja=/app/login; domen=.primer.com"`
{% endhint %}

Ovo mo쬰 biti opasno jer napada캜 mo쬰:

* **Fiksirati kola캜i캖 rtve na nalog napada캜a** tako da ako korisnik ne primeti, **izvr코ava캖e radnje na nalogu napada캜a** i napada캜 mo쬰 dobiti neke zanimljive informacije (proverite istoriju pretraga korisnika na platformi, rtva mo쬰 postaviti svoju kreditnu karticu na nalog...)
* Ako se **kola캜i캖 ne promeni nakon prijave**, napada캜 mo쬰 jednostavno **fiksirati kola캜i캖 (fiksacija sesije)**, sa캜ekati da se rtva prijavi, a zatim **koristiti taj kola캜i캖 da se prijavi kao rtva**.
* Ponekad, 캜ak i ako se sesioni kola캜i캖 promeni, napada캜 mo쬰 koristiti prethodni i dobi캖e i novi.
* Ako **kola캜i캖 postavlja neku po캜etnu vrednost** (kao u flask gde **kola캜i캖** mo쬰 **postaviti CSRF token** sesije i ta vrednost 캖e se odr쬬ti nakon 코to se rtva prijavi), **napada캜 mo쬰 postaviti tu poznatu vrednost i zatim je zloupotrebiti** (u tom scenariju, napada캜 mo쬰 naterati korisnika da izvr코i CSRF zahtev jer zna CSRF token).
* Ba코 kao 코to postavlja vrednost, napada캜 tako캠e mo쬰 dobiti neautentifikovan kola캜i캖 generisan od strane servera, dobiti CSRF token iz njega i koristiti ga.

### Redosled kola캜i캖a

Kada pregleda캜 primi dva kola캜i캖a sa istim imenom **delimi캜no uti캜u캖i na isti opseg** (domen, poddomeni i putanja), **pregleda캜 캖e poslati obe vrednosti kola캜i캖a** kada su oba validna za zahtev.

Zavisno o tome ko ima **najspecifi캜niju putanju** ili koji je **stariji**, pregleda캜 캖e **prvo postaviti vrednost kola캜i캖a** a zatim vrednost drugog kao u: `Kola캜i캖: idkorisnika=Specifi캜nijiINajstarijiKola캜i캖; idkorisnika=ManjeSpecifi캜an;`

Ve캖ina **veb sajtova 캖e koristiti samo prvu vrednost**. Dakle, ako napada캜 쬰li da postavi kola캜i캖, bolje je postaviti ga pre nego 코to se postavi drugi ili postaviti sa specifi캜nijom putanjom.

{% hint style="warning" %}
Osim toga, mogu캖nost **postavljanja kola캜i캖a u specifi캜niju putanju** je veoma interesantna jer 캖ete mo캖i da naterate **rtvu da radi sa svojim kola캜i캖em osim u specifi캜noj putanji gde 캖e zlonamerni kola캜i캖 biti poslat pre**.
{% endhint %}

### Bypass za코tite

Mogu캖a za코tita od ovog napada bi bila da **veb server ne캖e prihvatiti zahteve sa dva kola캜i캖a sa istim imenom ali sa dve razli캜ite vrednosti**.

Da bi zaobi코ao scenario gde napada캜 postavlja kola캜i캖 nakon 코to je rtvi ve캖 dat kola캜i캖, napada캜 bi mogao izazvati **prelivanje kola캜i캖a** a zatim, kada se **legitimni kola캜i캖 obri코e, postaviti zlonamerni**.

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

Jo코 jedan koristan **bypass** bi bio **URL enkodiranje imena kola캜i캖a** jer neke za코tite proveravaju da li postoje 2 kola캜i캖a sa istim imenom u zahtevu i tada 캖e server dekodirati imena kola캜i캖a.

### Kola캜i캖ka bomba

Napad Bacanje kola캜i캖a tako캠e mo쬰 biti kori코캖en za izvo캠enje **Kola캜i캖ke bombe**:

{% content-ref url="cookie-bomb.md" %}
[cookie-bomb.md](cookie-bomb.md)
{% endcontent-ref %}

### Odbran**e**

#### **Koristite prefiks `__Host` u imenu kola캜i캖a**

* Ako ime kola캜i캖a ima ovaj prefiks, **bi캖e prihva캖eno samo** u Set-Cookie direktivi ako je ozna캜eno kao Sigurno, poslato sa sigurnog porekla, ne uklju캜uje atribut Domen, i ima postavljenu Putanju na /
* **Ovo spre캜ava poddomene da prisile kola캜i캖 na glavni domen jer se ovi kola캜i캖i mogu smatrati "zaklju캜anim za domen"**

### Reference

* [**@blueminimal**](https://twitter.com/blueminimal)
* [**https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers**](https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers)
* [**https://github.blog/2013-04-09-yummy-cookies-across-domains/**](https://github.blog/2013-04-09-yummy-cookies-across-domains/)
* [**Cookie Crumbles: Unveiling Web Session Integrity Vulnerabilities**](https://www.youtube.com/watch?v=F\_wAzF4a7Xg)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
