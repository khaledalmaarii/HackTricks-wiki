# Cookie Tossing

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

### AÃ§Ä±klama

EÄŸer bir saldÄ±rgan **bir alt alan adÄ±nÄ± veya bir ÅŸirketin alan adÄ±nÄ± kontrol edebiliyorsa ya da bir alt alan adÄ±nda bir XSS bulursa** bu saldÄ±rÄ±yÄ± gerÃ§ekleÅŸtirebilir.

Cookies Hacking bÃ¶lÃ¼mÃ¼nde belirtildiÄŸi gibi, **bir Ã§erez bir alana (belirterek) ayarlandÄ±ÄŸÄ±nda, o alan ve alt alan adlarÄ±nda kullanÄ±lacaktÄ±r.**

{% hint style="danger" %}
Bu nedenle, **bir saldÄ±rgan belirli bir Ã§erezi alan ve alt alan adlarÄ±na ayarlayabilecektir, bu da ÅŸunu yaparak mÃ¼mkÃ¼ndÃ¼r:** `document.cookie="session=1234; Path=/app/login; domain=.example.com"`
{% endhint %}

Bu tehlikeli olabilir Ã§Ã¼nkÃ¼ saldÄ±rgan:

* **KurbanÄ±n Ã§erezini saldÄ±rganÄ±n hesabÄ±na sabitleyebilir**, bÃ¶ylece kullanÄ±cÄ± fark etmezse, **saldÄ±rganÄ±n hesabÄ±nda iÅŸlemleri gerÃ§ekleÅŸtirebilir** ve saldÄ±rgan bazÄ± ilginÃ§ bilgilere ulaÅŸabilir (kullanÄ±cÄ±nÄ±n platformdaki arama geÃ§miÅŸini kontrol etmek, kurbanÄ±n hesabÄ±nda kredi kartÄ± ayarlamasÄ± yapmasÄ±...).
* EÄŸer **Ã§erez giriÅŸ yaptÄ±ktan sonra deÄŸiÅŸmiyorsa**, saldÄ±rgan sadece **bir Ã§erezi sabitleyebilir (oturum sabitleme)**, kurban giriÅŸ yapana kadar bekleyebilir ve sonra **o Ã§erezi kullanarak kurban olarak giriÅŸ yapabilir**.
* Bazen, oturum Ã§erezleri deÄŸiÅŸse bile, saldÄ±rgan Ã¶nceki Ã§erezi kullanabilir ve yeni Ã§erezi de alabilir.
* EÄŸer **Ã§erez bazÄ± baÅŸlangÄ±Ã§ deÄŸerleri ayarlÄ±yorsa** (flask'ta olduÄŸu gibi, burada **Ã§erez** oturumun **CSRF token'Ä±nÄ±** ayarlayabilir ve bu deÄŸer kurban giriÅŸ yaptÄ±ktan sonra korunur), **saldÄ±rgan bu bilinen deÄŸeri ayarlayabilir ve sonra bunu kÃ¶tÃ¼ye kullanabilir** (bu senaryoda, saldÄ±rgan kurbanÄ±n CSRF token'Ä±nÄ± bildiÄŸi iÃ§in kullanÄ±cÄ±yÄ± bir CSRF isteÄŸi gerÃ§ekleÅŸtirmeye zorlayabilir).
* DeÄŸeri ayarlamak gibi, saldÄ±rgan ayrÄ±ca sunucu tarafÄ±ndan Ã¼retilen kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ bir Ã§erezi alabilir, ondan CSRF token'Ä±nÄ± alabilir ve bunu kullanabilir.

### Ã‡erez SÄ±rasÄ±

Bir tarayÄ±cÄ±, **aynÄ± isimde iki Ã§erez aldÄ±ÄŸÄ±nda ve bu Ã§erezler aynÄ± kapsamÄ± (alan, alt alanlar ve yol) kÄ±smen etkiliyorsa**, **tarayÄ±cÄ± her iki Ã§erezin deÄŸerini de** geÃ§erli olduÄŸu sÃ¼rece istekte gÃ¶nderecektir.

Kimin **en spesifik yolu** olduÄŸu veya hangisinin **en eski olduÄŸu** dikkate alÄ±narak, tarayÄ±cÄ± **Ã¶nce Ã§erezin deÄŸerini ayarlayacak** ve sonra diÄŸerinin deÄŸerini ayarlayacaktÄ±r, Ã¶rneÄŸin: `Cookie: iduser=MoreSpecificAndOldestCookie; iduser=LessSpecific;`

Ã‡oÄŸu **web sitesi yalnÄ±zca ilk deÄŸeri kullanacaktÄ±r**. Bu nedenle, bir saldÄ±rgan bir Ã§erez ayarlamak istiyorsa, baÅŸka bir Ã§erez ayarlanmadan Ã¶nce ayarlamak veya daha spesifik bir yol ile ayarlamak daha iyidir.

{% hint style="warning" %}
AyrÄ±ca, **daha spesifik bir yolda Ã§erez ayarlama yeteneÄŸi** Ã§ok ilginÃ§tir Ã§Ã¼nkÃ¼ **kurbanÄ±n Ã§erezi ile Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlayabilirsiniz, yalnÄ±zca kÃ¶tÃ¼ niyetli Ã§erezin ayarlandÄ±ÄŸÄ± spesifik yol dÄ±ÅŸÄ±nda**.
{% endhint %}

### Koruma AÅŸma

Bu saldÄ±rÄ±ya karÅŸÄ± olasÄ± bir koruma, **web sunucusunun aynÄ± isimde ancak iki farklÄ± deÄŸere sahip iki Ã§erezi kabul etmemesi** olacaktÄ±r.

SaldÄ±rganÄ±n kurbanÄ±n Ã§erezini aldÄ±ktan sonra bir Ã§erez ayarladÄ±ÄŸÄ± senaryosunu aÅŸmak iÃ§in, saldÄ±rgan bir **Ã§erez taÅŸmasÄ±** oluÅŸturabilir ve sonra, **geÃ§erli Ã§erez silindikten sonra, kÃ¶tÃ¼ niyetli olanÄ± ayarlayabilir**.

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

BaÅŸka bir yararlÄ± **aÅŸma** yÃ¶ntemi, **Ã§erez adÄ±nÄ± URL kodlamaktÄ±r** Ã§Ã¼nkÃ¼ bazÄ± korumalar bir istekte aynÄ± isimde 2 Ã§erez kontrol eder ve ardÄ±ndan sunucu Ã§erez adlarÄ±nÄ± Ã§Ã¶zer.

### Ã‡erez BombasÄ±

Bir Cookie Tossing saldÄ±rÄ±sÄ± ayrÄ±ca bir **Ã‡erez BombasÄ±** saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirmek iÃ§in de kullanÄ±labilir:

{% content-ref url="cookie-bomb.md" %}
[cookie-bomb.md](cookie-bomb.md)
{% endcontent-ref %}

### Savunmalar

#### **Ã‡erez adÄ±nda `__Host` Ã¶n ekini kullanÄ±n**

* EÄŸer bir Ã§erez adÄ± bu Ã¶n eki taÅŸÄ±yorsa, **yalnÄ±zca** Set-Cookie direktifinde **GÃ¼venli** olarak iÅŸaretlenmiÅŸse, gÃ¼venli bir kaynaktan gÃ¶nderilmiÅŸse, bir Alan niteliÄŸi iÃ§ermiyorsa ve Yol niteliÄŸi / olarak ayarlanmÄ±ÅŸsa **kabul edilecektir**.
* **Bu, alt alanlarÄ±n bir Ã§erezi ana alana zorlamasÄ±nÄ± engeller Ã§Ã¼nkÃ¼ bu Ã§erezler "alan kilitli" olarak gÃ¶rÃ¼lebilir.**

### Referanslar

* [**@blueminimal**](https://twitter.com/blueminimal)
* [**https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers**](https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers)
* [**https://github.blog/2013-04-09-yummy-cookies-across-domains/**](https://github.blog/2013-04-09-yummy-cookies-across-domains/)
* [**Cookie Crumbles: Unveiling Web Session Integrity Vulnerabilities**](https://www.youtube.com/watch?v=F\_wAzF4a7Xg)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
