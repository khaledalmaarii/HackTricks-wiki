# Cookie Tossing

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

### æè¿°

å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿ**æ§åˆ¶ä¸€ä¸ªå­åŸŸåæˆ–å…¬å¸çš„åŸŸåï¼Œæˆ–è€…åœ¨å­åŸŸåä¸­å‘ç° XSS**ï¼Œä»–å°†èƒ½å¤Ÿæ‰§è¡Œæ­¤æ”»å‡»ã€‚

æ­£å¦‚åœ¨ Cookies Hacking éƒ¨åˆ†æ‰€æŒ‡å‡ºçš„ï¼Œå½“**cookie è¢«è®¾ç½®åˆ°ä¸€ä¸ªåŸŸï¼ˆæŒ‡å®šå®ƒï¼‰æ—¶ï¼Œå®ƒå°†åœ¨è¯¥åŸŸåŠå…¶å­åŸŸä¸­ä½¿ç”¨ã€‚**

{% hint style="danger" %}
å› æ­¤ï¼Œ**æ”»å‡»è€…å°†èƒ½å¤Ÿå°†ç‰¹å®š cookie è®¾ç½®åˆ°åŸŸå’Œå­åŸŸï¼Œæ‰§è¡Œç±»ä¼¼** `document.cookie="session=1234; Path=/app/login; domain=.example.com"`
{% endhint %}

è¿™å¯èƒ½æ˜¯å±é™©çš„ï¼Œå› ä¸ºæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿï¼š

* **å°†å—å®³è€…çš„ cookie å›ºå®šåˆ°æ”»å‡»è€…çš„è´¦æˆ·**ï¼Œå› æ­¤å¦‚æœç”¨æˆ·æ²¡æœ‰æ³¨æ„ï¼Œ**ä»–å°†åœ¨æ”»å‡»è€…çš„è´¦æˆ·ä¸­æ‰§è¡Œæ“ä½œ**ï¼Œæ”»å‡»è€…å¯èƒ½è·å¾—ä¸€äº›æœ‰è¶£çš„ä¿¡æ¯ï¼ˆæŸ¥çœ‹ç”¨æˆ·åœ¨å¹³å°ä¸Šçš„æœç´¢å†å²ï¼Œå—å®³è€…å¯èƒ½åœ¨è´¦æˆ·ä¸­è®¾ç½®ä»–çš„ä¿¡ç”¨å¡...ï¼‰
* å¦‚æœ**cookie åœ¨ç™»å½•åæ²¡æœ‰æ”¹å˜**ï¼Œæ”»å‡»è€…å¯èƒ½åªéœ€**å›ºå®šä¸€ä¸ª cookieï¼ˆä¼šè¯å›ºå®šï¼‰**ï¼Œç­‰å¾…å—å®³è€…ç™»å½•ï¼Œç„¶å**ä½¿ç”¨è¯¥ cookie ä»¥å—å®³è€…èº«ä»½ç™»å½•**ã€‚
* æœ‰æ—¶ï¼Œå³ä½¿ä¼šè¯ cookie å‘ç”Ÿå˜åŒ–ï¼Œæ”»å‡»è€…ä¹Ÿä¼šä½¿ç”¨ä¹‹å‰çš„ cookieï¼Œå¹¶ä¸”ä»–ä¹Ÿä¼šæ”¶åˆ°æ–°çš„ cookieã€‚
* å¦‚æœ**cookie è®¾ç½®äº†ä¸€äº›åˆå§‹å€¼**ï¼ˆä¾‹å¦‚åœ¨ flask ä¸­ï¼Œ**cookie** å¯èƒ½**è®¾ç½®**ä¼šè¯çš„ **CSRF token**ï¼Œå¹¶ä¸”è¯¥å€¼å°†åœ¨å—å®³è€…ç™»å½•åä¿æŒï¼‰ï¼Œ**æ”»å‡»è€…å¯èƒ½è®¾ç½®è¿™ä¸ªå·²çŸ¥å€¼ï¼Œç„¶åæ»¥ç”¨å®ƒ**ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šè®©ç”¨æˆ·æ‰§è¡Œ CSRF è¯·æ±‚ï¼Œå› ä¸ºä»–çŸ¥é“ CSRF tokenï¼‰ã€‚
* å°±åƒè®¾ç½®å€¼ä¸€æ ·ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥è·å–æœåŠ¡å™¨ç”Ÿæˆçš„æœªè®¤è¯ cookieï¼Œä»ä¸­è·å– CSRF token å¹¶ä½¿ç”¨å®ƒã€‚

### Cookie é¡ºåº

å½“æµè§ˆå™¨æ¥æ”¶åˆ°ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°çš„ cookie **éƒ¨åˆ†å½±å“ç›¸åŒèŒƒå›´**ï¼ˆåŸŸã€å­åŸŸå’Œè·¯å¾„ï¼‰æ—¶ï¼Œ**æµè§ˆå™¨å°†åœ¨è¯·æ±‚æœ‰æ•ˆæ—¶å‘é€è¿™ä¸¤ä¸ª cookie çš„å€¼**ã€‚

æ ¹æ®è°å…·æœ‰**æœ€å…·ä½“çš„è·¯å¾„**æˆ–å“ªä¸ªæ˜¯**æœ€æ—§çš„**ï¼Œæµè§ˆå™¨å°†**é¦–å…ˆè®¾ç½® cookie çš„å€¼**ï¼Œç„¶åè®¾ç½®å¦ä¸€ä¸ªçš„å€¼ï¼Œå¦‚ï¼š`Cookie: iduser=MoreSpecificAndOldestCookie; iduser=LessSpecific;`

å¤§å¤šæ•°**ç½‘ç«™å°†åªä½¿ç”¨ç¬¬ä¸€ä¸ªå€¼**ã€‚å› æ­¤ï¼Œå¦‚æœæ”»å‡»è€…æƒ³è¦è®¾ç½®ä¸€ä¸ª cookieï¼Œæœ€å¥½åœ¨è®¾ç½®å¦ä¸€ä¸ªä¹‹å‰è®¾ç½®å®ƒï¼Œæˆ–è€…è®¾ç½®ä¸€ä¸ªæ›´å…·ä½“çš„è·¯å¾„ã€‚

{% hint style="warning" %}
æ­¤å¤–ï¼Œ**åœ¨æ›´å…·ä½“çš„è·¯å¾„ä¸­è®¾ç½® cookie çš„èƒ½åŠ›**éå¸¸æœ‰è¶£ï¼Œå› ä¸ºæ‚¨å°†èƒ½å¤Ÿè®©**å—å®³è€…åœ¨ä»–çš„ cookie ä¸­å·¥ä½œï¼Œé™¤äº†æ¶æ„ cookie è®¾ç½®å°†è¢«å‘é€ä¹‹å‰çš„ç‰¹å®šè·¯å¾„ã€‚**
{% endhint %}

### ä¿æŠ¤ç»•è¿‡

å¯¹è¿™ç§æ”»å‡»çš„å¯èƒ½ä¿æŠ¤æ˜¯**Web æœåŠ¡å™¨ä¸æ¥å—å…·æœ‰ç›¸åŒåç§°ä½†ä¸¤ä¸ªä¸åŒå€¼çš„ä¸¤ä¸ª cookie çš„è¯·æ±‚**ã€‚

ä¸ºäº†ç»•è¿‡æ”»å‡»è€…åœ¨å—å®³è€…å·²ç»è·å¾— cookie åè®¾ç½® cookie çš„åœºæ™¯ï¼Œæ”»å‡»è€…å¯ä»¥é€ æˆ**cookie æº¢å‡º**ï¼Œç„¶åï¼Œä¸€æ—¦**åˆæ³• cookie è¢«åˆ é™¤ï¼Œè®¾ç½®æ¶æ„ cookie**ã€‚

{% content-ref url="cookie-jar-overflow.md" %}
[cookie-jar-overflow.md](cookie-jar-overflow.md)
{% endcontent-ref %}

å¦ä¸€ä¸ªæœ‰ç”¨çš„**ç»•è¿‡**å¯èƒ½æ˜¯**å¯¹ cookie åç§°è¿›è¡Œ URL ç¼–ç **ï¼Œå› ä¸ºä¸€äº›ä¿æŠ¤æªæ–½æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦æœ‰ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°çš„ cookieï¼Œç„¶åæœåŠ¡å™¨å°†è§£ç  cookie çš„åç§°ã€‚

### Cookie ç‚¸å¼¹

Cookie Tossing æ”»å‡»ä¹Ÿå¯ä»¥ç”¨äºæ‰§è¡Œ**Cookie ç‚¸å¼¹**æ”»å‡»ï¼š

{% content-ref url="cookie-bomb.md" %}
[cookie-bomb.md](cookie-bomb.md)
{% endcontent-ref %}

### é˜²å¾¡

#### **åœ¨ cookie åç§°ä¸­ä½¿ç”¨å‰ç¼€ `__Host`**

* å¦‚æœ cookie åç§°å…·æœ‰æ­¤å‰ç¼€ï¼Œ**åªæœ‰åœ¨æ ‡è®°ä¸ºå®‰å…¨ã€ä»å®‰å…¨æ¥æºå‘é€ã€ä¸åŒ…æ‹¬åŸŸå±æ€§å¹¶ä¸”è·¯å¾„å±æ€§è®¾ç½®ä¸º / æ—¶ï¼Œæ‰ä¼šåœ¨ Set-Cookie æŒ‡ä»¤ä¸­è¢«æ¥å—**
* **è¿™é˜²æ­¢å­åŸŸå¼ºåˆ¶ cookie åˆ°é¡¶çº§åŸŸï¼Œå› ä¸ºè¿™äº› cookie å¯ä»¥è¢«è§†ä¸ºâ€œåŸŸé”å®šâ€**

### å‚è€ƒ

* [**@blueminimal**](https://twitter.com/blueminimal)
* [**https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers**](https://speakerdeck.com/filedescriptor/the-cookie-monster-in-your-browsers)
* [**https://github.blog/2013-04-09-yummy-cookies-across-domains/**](https://github.blog/2013-04-09-yummy-cookies-across-domains/)
* [**Cookie Crumbles: Unveiling Web Session Integrity Vulnerabilities**](https://www.youtube.com/watch?v=F\_wAzF4a7Xg)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
