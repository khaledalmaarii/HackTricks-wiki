# HTTP Connection Request Smuggling

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

**è¿™æ˜¯å¯¹å¸–å­** [**https://portswigger.net/research/browser-powered-desync-attacks**](https://portswigger.net/research/browser-powered-desync-attacks) **çš„æ€»ç»“**

## è¿æ¥çŠ¶æ€æ”»å‡» <a href="#state" id="state"></a>

### é¦–æ¬¡è¯·æ±‚éªŒè¯

åœ¨è·¯ç”±è¯·æ±‚æ—¶ï¼Œåå‘ä»£ç†å¯èƒ½ä¾èµ–äº **Host header** æ¥ç¡®å®šç›®æ ‡åç«¯æœåŠ¡å™¨ï¼Œé€šå¸¸ä¾èµ–äºå…è®¸è®¿é—®çš„ä¸»æœºç™½åå•ã€‚ç„¶è€Œï¼Œä¸€äº›ä»£ç†å­˜åœ¨æ¼æ´ï¼Œç™½åå•ä»…åœ¨è¿æ¥çš„åˆå§‹è¯·æ±‚ä¸­å¼ºåˆ¶æ‰§è¡Œã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡é¦–å…ˆå‘å…è®¸çš„ä¸»æœºå‘å‡ºè¯·æ±‚ï¼Œç„¶åé€šè¿‡åŒä¸€è¿æ¥è¯·æ±‚å†…éƒ¨ç«™ç‚¹æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼š
```
GET / HTTP/1.1
Host: [allowed-external-host]

GET / HTTP/1.1
Host: [internal-host]
```
### First-request Routing

åœ¨æŸäº›é…ç½®ä¸­ï¼Œå‰ç«¯æœåŠ¡å™¨å¯èƒ½ä¼šä½¿ç”¨**ç¬¬ä¸€ä¸ªè¯·æ±‚çš„Hostå¤´**æ¥ç¡®å®šè¯¥è¯·æ±‚çš„åç«¯è·¯ç”±ï¼Œç„¶åå°†æ¥è‡ªåŒä¸€å®¢æˆ·ç«¯è¿æ¥çš„æ‰€æœ‰åç»­è¯·æ±‚æŒä¹…æ€§åœ°è·¯ç”±åˆ°ç›¸åŒçš„åç«¯è¿æ¥ã€‚è¿™å¯ä»¥è¡¨ç¤ºä¸ºï¼š
```
GET / HTTP/1.1
Host: example.com

POST /pwreset HTTP/1.1
Host: psres.net
```
è¿™ä¸ªé—®é¢˜å¯ä»¥ä¸[Host header attacks](https://portswigger.net/web-security/host-header)ç»“åˆï¼Œä¾‹å¦‚å¯†ç é‡ç½®ä¸­æ¯’æˆ–[web cache poisoning](https://portswigger.net/web-security/web-cache-poisoning)ï¼Œä»¥åˆ©ç”¨å…¶ä»–æ¼æ´æˆ–è·å¾—å¯¹å…¶ä»–è™šæ‹Ÿä¸»æœºçš„æœªç»æˆæƒè®¿é—®ã€‚

{% hint style="info" %}
è¦è¯†åˆ«è¿™äº›æ¼æ´ï¼Œå¯ä»¥åˆ©ç”¨HTTP Request Smugglerä¸­çš„â€œconnection-state probeâ€åŠŸèƒ½ã€‚
{% endhint %}

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µAWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µGCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubåº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
