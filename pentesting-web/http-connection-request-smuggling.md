# HTTP Connection Request Smuggling

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**ã“ã®è¨˜äº‹ã®è¦ç´„ã¯** [**https://portswigger.net/research/browser-powered-desync-attacks**](https://portswigger.net/research/browser-powered-desync-attacks) **ã§ã™**

## Connection State Attacks <a href="#state" id="state"></a>

### First-request Validation

ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹éš›ã€ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã¯**Hostãƒ˜ãƒƒãƒ€ãƒ¼**ã«ä¾å­˜ã—ã¦ã€å®›å…ˆã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚é€šå¸¸ã€ã‚¢ã‚¯ã‚»ã‚¹ãŒè¨±å¯ã•ã‚ŒãŸãƒ›ã‚¹ãƒˆã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ä¾å­˜ã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€ä¸€éƒ¨ã®ãƒ—ãƒ­ã‚­ã‚·ã«ã¯ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆãŒæ¥ç¶šå†…ã®æœ€åˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã®ã¿é©ç”¨ã•ã‚Œã‚‹ã¨ã„ã†è„†å¼±æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€æ”»æ’ƒè€…ã¯ã€æœ€åˆã«è¨±å¯ã•ã‚ŒãŸãƒ›ã‚¹ãƒˆã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã„ã€ãã®å¾ŒåŒã˜æ¥ç¶šã‚’é€šã˜ã¦å†…éƒ¨ã‚µã‚¤ãƒˆã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
GET / HTTP/1.1
Host: [allowed-external-host]

GET / HTTP/1.1
Host: [internal-host]
```
### First-request Routing

ä¸€éƒ¨ã®æ§‹æˆã§ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãŒ**æœ€åˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®Hostãƒ˜ãƒƒãƒ€ãƒ¼**ã‚’ä½¿ç”¨ã—ã¦ã€ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’æ±ºå®šã—ã€ãã®å¾Œã€åŒã˜ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šã‹ã‚‰ã®ã™ã¹ã¦ã®å¾Œç¶šãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’åŒã˜ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šã«æŒç¶šçš„ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯æ¬¡ã®ã‚ˆã†ã«ç¤ºã™ã“ã¨ãŒã§ãã¾ã™:
```
GET / HTTP/1.1
Host: example.com

POST /pwreset HTTP/1.1
Host: psres.net
```
ã“ã®å•é¡Œã¯ã€ä»–ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã—ãŸã‚Šã€è¿½åŠ ã®ä»®æƒ³ãƒ›ã‚¹ãƒˆã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¾—ã‚‹ãŸã‚ã«ã€[Host header attacks](https://portswigger.net/web-security/host-header)ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°ã‚„[web cache poisoning](https://portswigger.net/web-security/web-cache-poisoning)ãªã©ï¼‰ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% hint style="info" %}
ã“ã‚Œã‚‰ã®è„†å¼±æ€§ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ã€HTTP Request Smugglerã®ã€Œconnection-state probeã€æ©Ÿèƒ½ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚
{% endhint %}

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
