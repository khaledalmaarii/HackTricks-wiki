# HTTP YanÄ±t KaÃ§Ä±rma / Desenkronizasyon

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

**Bu gÃ¶nderinin tekniÄŸi videodan alÄ±nmÄ±ÅŸtÄ±r:** [**https://www.youtube.com/watch?v=suxDcYViwao\&t=1343s**](https://www.youtube.com/watch?v=suxDcYViwao\&t=1343s)

## HTTP Ä°stek KuyruÄŸu Desenkronizasyonu

Ã–ncelikle, bu teknik **bir HTTP Ä°stek KaÃ§Ä±rma aÃ§Ä±ÄŸÄ±nÄ± istismar eder**, bu yÃ¼zden bunun ne olduÄŸunu bilmelisiniz:

Bu tekniÄŸin **ana** **farkÄ±**, yaygÄ±n bir HTTP Ä°stek kaÃ§Ä±rmadan, **kurbanÄ±n isteÄŸine bir Ã¶n ek ekleyerek saldÄ±rmak yerine**, **kurbanÄ±n aldÄ±ÄŸÄ± yanÄ±tÄ± sÄ±zdÄ±rmak veya deÄŸiÅŸtirmek** iÃ§in kullanmamÄ±zdÄ±r. Bu, HTTP Ä°stek kaÃ§Ä±rmayÄ± istismar etmek iÃ§in 1,5 istek gÃ¶ndermek yerine, **proxy yanÄ±t kuyruklarÄ±nÄ± desenkronize etmek iÃ§in 2 tam istek gÃ¶ndermemizle** yapÄ±lÄ±r.

Bunun nedeni, **yanÄ±t kuyruÄŸunu desenkronize edebilmemizdir**, bÃ¶ylece **kurbanÄ±n meÅŸru isteÄŸinden gelen yanÄ±tÄ±n saldÄ±rgana gÃ¶nderilmesi** veya **kurbanÄ±n yanÄ±tÄ±na saldÄ±rganÄ±n kontrolÃ¼ndeki iÃ§eriÄŸin enjekte edilmesi**dir.

### HTTP Pipeline Desenkronizasyonu

HTTP/1.1, **Ã¶nceki isteklere beklemeden farklÄ± kaynaklar istemeye** olanak tanÄ±r. Bu nedenle, eÄŸer bir **proxy** varsa, proxy'nin gÃ¶revi, **arka uca gÃ¶nderilen isteklerin ve ondan gelen yanÄ±tlarÄ±n senkronize bir eÅŸleÅŸmesini korumaktÄ±r**.

Ancak, yanÄ±t kuyruklarÄ±nÄ± desenkronize etme konusunda bir sorun vardÄ±r. EÄŸer bir saldÄ±rgan bir HTTP YanÄ±t kaÃ§Ä±rma saldÄ±rÄ±sÄ± gÃ¶nderirse ve **ilk isteÄŸe ve kaÃ§Ä±rÄ±lan isteÄŸe yanÄ±tlar hemen verilirse**, kaÃ§Ä±rÄ±lan yanÄ±t, kurban yanÄ±tÄ±nÄ±n kuyruÄŸuna eklenmeyecek, **bir hata olarak atÄ±lacaktÄ±r**.

![](<../.gitbook/assets/image (633).png>)

Bu nedenle, **kaÃ§Ä±rÄ±lan isteÄŸin** arka uÃ§ sunucusunda iÅŸlenmesi iÃ§in daha fazla zamana ihtiyacÄ± vardÄ±r. BÃ¶ylece, kaÃ§Ä±rÄ±lan istek iÅŸlenene kadar, saldÄ±rganla iletiÅŸim sona erecektir.

EÄŸer bu Ã¶zel durumda bir **kurban bir istek gÃ¶ndermiÅŸse** ve **kaÃ§Ä±rÄ±lan istek meÅŸru isteÄŸinden Ã¶nce yanÄ±tlanÄ±rsa**, **kaÃ§Ä±rÄ±lan yanÄ±t kurbana gÃ¶nderilecektir**. BÃ¶ylece, saldÄ±rgan **kurban tarafÄ±ndan "gerÃ§ekleÅŸtirilen" isteÄŸi kontrol edecektir**.

AyrÄ±ca, eÄŸer **saldÄ±rgan bir istek gerÃ§ekleÅŸtirirse** ve **kurbanÄ±n isteÄŸine verilen meÅŸru yanÄ±t**, saldÄ±rganÄ±n isteÄŸinden **Ã¶nce yanÄ±tlanÄ±rsa**, **kurbanÄ±n yanÄ±tÄ± saldÄ±rgana gÃ¶nderilecektir**, **kurbanÄ±n yanÄ±tÄ±nÄ± Ã§alarak** (Ã¶rneÄŸin, **Set-Cookie** baÅŸlÄ±ÄŸÄ±nÄ± iÃ§erebilir).

![](<../.gitbook/assets/image (1020).png>)

![](<../.gitbook/assets/image (719).png>)

### Ã‡oklu Ä°Ã§ Ä°Ã§e Enjeksiyonlar

YaygÄ±n **HTTP Ä°stek KaÃ§Ä±rma** ile bir diÄŸer **ilginÃ§ fark**, yaygÄ±n bir kaÃ§Ä±rma saldÄ±rÄ±sÄ±nda **hedefin kurbanÄ±n isteÄŸinin baÅŸlangÄ±cÄ±nÄ± deÄŸiÅŸtirmek** olmasÄ±dÄ±r, bÃ¶ylece beklenmedik bir eylem gerÃ§ekleÅŸtirilir. **HTTP YanÄ±t kaÃ§Ä±rma saldÄ±rÄ±sÄ±nda**, tam istekler gÃ¶nderdiÄŸiniz iÃ§in, **bir yÃ¼k iÃ§inde onlarca yanÄ±t enjekte edebilir** ve bu da **onlarca kullanÄ±cÄ±nÄ±n** **enjekte edilen yanÄ±tlarÄ± almasÄ±na neden olacaktÄ±r**.

AyrÄ±ca, **meÅŸru kullanÄ±cÄ±lar arasÄ±nda daha kolay onca istismar daÄŸÄ±tma** imkanÄ± saÄŸlamanÄ±n yanÄ± sÄ±ra, bu aynÄ± zamanda sunucuda bir **DoS** oluÅŸturmak iÃ§in de kullanÄ±labilir.

### Ä°stismar Organizasyonu

Daha Ã¶nce aÃ§Ä±klandÄ±ÄŸÄ± gibi, bu tekniÄŸi istismar etmek iÃ§in, **sunucuya gÃ¶nderilen ilk kaÃ§Ä±rÄ±lan mesajÄ±n** **iÅŸlenmesi iÃ§in Ã§ok zaman almasÄ±** gerekmektedir.

Bu **zaman alan istek**, sadece **kurbanÄ±n yanÄ±tÄ±nÄ± Ã§almaya Ã§alÄ±ÅŸmak** istiyorsak yeterlidir. Ancak daha karmaÅŸÄ±k bir istismar gerÃ§ekleÅŸtirmek istiyorsanÄ±z, bu istismar iÃ§in yaygÄ±n bir yapÄ± olacaktÄ±r.

Ã–ncelikle **HTTP Ä°stek KaÃ§Ä±rma** istismarÄ±nÄ± kullanarak **ilk** isteÄŸi, ardÄ±ndan **zaman alan isteÄŸi** ve sonra **kurbanlara gÃ¶nderilecek 1 veya daha fazla yÃ¼k isteÄŸi**.

## HTTP YanÄ±t KuyruÄŸu Desenkronizasyonunu Ä°stismar Etme

### DiÄŸer kullanÄ±cÄ±larÄ±n isteklerini yakalama <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

HTTP Ä°stek KaÃ§Ä±rma ile bilinen yÃ¼kler gibi, **kurbanÄ±n isteÄŸini Ã§alabilirsiniz** ama bir Ã¶nemli farkla: Bu durumda, **yanÄ±tÄ±n iÃ§inde yansÄ±tÄ±lan iÃ§eriÄŸi gÃ¶ndermeniz yeterlidir**, **kalÄ±cÄ± depolama** gerekmez.

Ã–ncelikle, saldÄ±rgan, **yansÄ±tÄ±lan parametre ile son bir POST isteÄŸi iÃ§eren** bir yÃ¼k gÃ¶nderir ve bÃ¼yÃ¼k bir Content-Length ayarlar.

![](<../.gitbook/assets/image (1053).png>)

ArdÄ±ndan, **ilk istek** (mavi) **iÅŸlendiÄŸinde** ve **uyku halindeki** istek iÅŸlenirken (sarÄ±), **bir kurbandan gelen bir sonraki istek**, **yansÄ±tÄ±lan parametrenin hemen ardÄ±ndan kuyruÄŸa eklenecektir**:

![](<../.gitbook/assets/image (794).png>)

SonrasÄ±nda, **kurban**, **uyku halindeki** isteÄŸin yanÄ±tÄ±nÄ± **alacak** ve eÄŸer bu arada **saldÄ±rgan** **baÅŸka bir istek gÃ¶nderirse**, **yansÄ±tÄ±lan iÃ§erik isteÄŸinden gelen yanÄ±t ona gÃ¶nderilecektir**.

## YanÄ±t Desenkronizasyonu

Bu noktaya kadar, HTTP Ä°stek KaÃ§Ä±rma saldÄ±rÄ±larÄ±nÄ± nasÄ±l istismar edeceÄŸimizi Ã¶ÄŸrendik, bÃ¶ylece **bir istemcinin alacaÄŸÄ± yanÄ±tÄ± kontrol edebiliriz** ve ardÄ±ndan **kurban iÃ§in tasarlanmÄ±ÅŸ yanÄ±tÄ± Ã§alabiliriz**.

Ancak, yanÄ±tlarÄ± **daha da desenkronize etmek** mÃ¼mkÃ¼ndÃ¼r.

**YanÄ±t gÃ¶vdesinde** **hiÃ§bir iÃ§erik olmamasÄ± gereken** ve **GET isteÄŸiymiÅŸ gibi** **Content-Length** iÃ§ermesi gereken **HEAD** istekleri gibi ilginÃ§ istekler vardÄ±r.

Bu nedenle, eÄŸer bir saldÄ±rgan **HEAD** isteÄŸi enjekte ederse, bu gÃ¶rÃ¼ntÃ¼lerdeki gibi:

![](<../.gitbook/assets/image (1107).png>)

O zaman, **mavi yanÄ±t saldÄ±rgana verildiÄŸinde**, bir sonraki kurban isteÄŸi kuyruÄŸa eklenecektir:

![](<../.gitbook/assets/image (999).png>)

SonrasÄ±nda, **kurban**, **HEAD** isteÄŸinden gelen **yanÄ±tÄ± alacak**, bu yanÄ±t **bir Content-Length iÃ§erecek ama hiÃ§ iÃ§erik olmayacaktÄ±r**. Bu nedenle, proxy **bu yanÄ±tÄ± kurbana gÃ¶ndermeyecek**, ancak bazÄ± **iÃ§erikler** bekleyecektir, bu da aslÄ±nda **saldÄ±rgan tarafÄ±ndan enjekte edilen sarÄ± isteÄŸin yanÄ±tÄ± olacaktÄ±r**:

![](<../.gitbook/assets/image (735).png>)

### Ä°Ã§erik KarÄ±ÅŸÄ±klÄ±ÄŸÄ±

Ã–nceki Ã¶rneÄŸi takip ederek, **kurbanÄ±n alacaÄŸÄ± yanÄ±tÄ±n gÃ¶vdesini kontrol edebildiÄŸinizi** ve **HEAD** **yanÄ±tÄ±nÄ±n genellikle baÅŸlÄ±klarÄ±nda **Content-Type ve Content-Length** iÃ§erdiÄŸini bilerek, **kurbanÄ±n XSS** oluÅŸturmasÄ±na neden olacak aÅŸaÄŸÄ±daki gibi bir istek gÃ¶nderebilirsiniz:

![](<../.gitbook/assets/image (688).png>)

### Ã–nbellek Zehirleme

Daha Ã¶nce bahsedilen yanÄ±t desenkronizasyonu Ä°Ã§erik KarÄ±ÅŸÄ±klÄ±ÄŸÄ± saldÄ±rÄ±sÄ±nÄ± istismar ederek, **eÄŸer Ã¶nbellek, kurban tarafÄ±ndan gerÃ§ekleÅŸtirilen isteÄŸe verilen yanÄ±tÄ± depoluyorsa ve bu yanÄ±t, bir XSS oluÅŸturan enjekte edilmiÅŸ bir yanÄ±t ise, o zaman Ã¶nbellek zehirlenmiÅŸtir**.

XSS yÃ¼kÃ¼nÃ¼ iÃ§eren kÃ¶tÃ¼ niyetli istek:

![](<../.gitbook/assets/image (614).png>)

Kurbana, yanÄ±tÄ± Ã¶nbelleÄŸe almasÄ± iÃ§in baÅŸlÄ±k iÃ§eren kÃ¶tÃ¼ niyetli yanÄ±t:

![](<../.gitbook/assets/image (566).png>)

{% hint style="warning" %}
Bu durumda, eÄŸer **"kurban" saldÄ±rgansa**, artÄ±k **keyfi URL'lerde Ã¶nbellek zehirlemesi** gerÃ§ekleÅŸtirebilir, Ã§Ã¼nkÃ¼ **kÃ¶tÃ¼ niyetli yanÄ±tla Ã¶nbelleÄŸe alÄ±nacak URL'yi kontrol edebilir**.
{% endhint %}

### Web Ã–nbellek AldatmacasÄ±

Bu saldÄ±rÄ±, Ã¶ncekiyle benzer, ancak **yÃ¼kÃ¼ Ã¶nbelleÄŸe enjekte etmek yerine, saldÄ±rgan kurban bilgilerini Ã¶nbelleÄŸe alacaktÄ±r**:

![](<../.gitbook/assets/image (991).png>)

### YanÄ±t BÃ¶lme

Bu saldÄ±rÄ±nÄ±n **hedefi**, **yanÄ±t** **desenkronizasyonunu** tekrar istismar ederek **proxy'nin %100 saldÄ±rgan tarafÄ±ndan Ã¼retilen bir yanÄ±t gÃ¶ndermesini saÄŸlamak**tÄ±r.

Bunu baÅŸarmak iÃ§in, saldÄ±rgan, **yanÄ±t iÃ§inde bazÄ± deÄŸerleri yansÄ±tan** bir web uygulamasÄ± uÃ§ noktasÄ± bulmalÄ± ve **HEAD yanÄ±tÄ±nÄ±n iÃ§erik uzunluÄŸunu bilmelidir**.

Bir **istismar** gÃ¶nderecektir:

![](<../.gitbook/assets/image (911).png>)

Ä°lk istek Ã§Ã¶zÃ¼ldÃ¼kten ve saldÄ±rgana geri gÃ¶nderildikten sonra, **kurbanÄ±n isteÄŸi kuyruÄŸa eklenir**:

![](<../.gitbook/assets/image (737).png>)

Kurban, yanÄ±t olarak **HEAD yanÄ±tÄ± + ikinci isteÄŸin yanÄ±tÄ±nÄ±n iÃ§eriÄŸini (yansÄ±tÄ±lan verilerin bir kÄ±smÄ±nÄ± iÃ§eren)** alacaktÄ±r:

![](<../.gitbook/assets/image (356).png>)

Ancak, **yansÄ±tÄ±lan verilerin, yanÄ±t kuyruÄŸunda geÃ§erli bir HTTP yanÄ±tÄ± Ã¼reten HEAD yanÄ±tÄ±nÄ±n Content-Length'ine gÃ¶re bir boyuta sahip olduÄŸunu** unutmayÄ±n.

Bu nedenle, **ikinci kurbanÄ±n bir sonraki isteÄŸi**, **saldÄ±rgan tarafÄ±ndan tamamen oluÅŸturulmuÅŸ bir yanÄ±t alacaktÄ±r**. YanÄ±t tamamen saldÄ±rgan tarafÄ±ndan oluÅŸturulduÄŸundan, **proxy'nin yanÄ±tÄ± Ã¶nbelleÄŸe almasÄ±nÄ± da saÄŸlayabilir**.

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
