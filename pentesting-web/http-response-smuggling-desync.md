# HTTP YanÄ±t KaÃ§Ä±rma / Desenkronizasyon

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahraman olmaya kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nleri**]'ni edinin (https://peass.creator-spring.com)
* [**PEASS Ailesi**]'ni keÅŸfedin (https://opensea.io/collection/the-peass-family), Ã¶zel [**NFT'ler**]'imiz koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

**Bu yazÄ±nÄ±n tekniÄŸi ÅŸu videodan alÄ±nmÄ±ÅŸtÄ±r:** [**https://www.youtube.com/watch?v=suxDcYViwao\&t=1343s**](https://www.youtube.com/watch?v=suxDcYViwao\&t=1343s)

## HTTP Ä°stek KuyruÄŸu Desenkronizasyonu

Ã–ncelikle, bu teknik **bir HTTP Ä°stek KaÃ§Ä±rma aÃ§Ä±ÄŸÄ±ndan yararlanÄ±r**, bu yÃ¼zden bunun ne olduÄŸunu bilmelisiniz:

Bu teknik ve yaygÄ±n bir HTTP Ä°stek kaÃ§Ä±rma arasÄ±ndaki **ana fark**, **kurbanÄ±n isteÄŸine bir Ã¶nek ekleyerek saldÄ±rmak yerine**, **kurbanÄ±n aldÄ±ÄŸÄ± yanÄ±tÄ± sÄ±zdÄ±rmak veya deÄŸiÅŸtirmek**tir. Bunun iÃ§in, HTTP Ä°stek kaÃ§Ä±rma saldÄ±rÄ±sÄ±nÄ± kÃ¶tÃ¼ye kullanmak iÃ§in yarÄ±m bir istek gÃ¶ndermek yerine, **arka arkaya 2 tam istek gÃ¶ndererek proxy yanÄ±tlarÄ±nÄ±n kuyruÄŸunu desenkronize etme**yi hedefliyoruz.

Bu, **yanÄ±t kuyruÄŸunu desenkronize edebileceÄŸimiz anlamÄ±na gelir**, bÃ¶ylece **kurbanÄ±n meÅŸru isteÄŸinden gelen yanÄ±t saldÄ±rgana gÃ¶nderilir** veya **saldÄ±rganÄ±n kontrol ettiÄŸi iÃ§erik kurbanÄ±n yanÄ±tÄ±na enjekte edilir**.

### HTTP Pipeline Desenkronizasyonu

HTTP/1.1, **Ã¶nceki istekleri beklemeye gerek olmadan farklÄ± kaynaklar istemeyi** saÄŸlar. Bu nedenle, bir **proxy** varsa, arka uca gÃ¶nderilen isteklerin ve oradan gelen yanÄ±tlarÄ±n **senkronize eÅŸleÅŸmesini saÄŸlamak proxylerin gÃ¶revidir**.

Ancak, yanÄ±tlarÄ±n kuyruÄŸunu desenkronize etme sorunu vardÄ±r. Bir saldÄ±rgan bir HTTP YanÄ±t kaÃ§Ä±rma saldÄ±rÄ±sÄ± gÃ¶nderirse ve **ilk istek ve kaÃ§Ä±rÄ±lan yanÄ±t hemen yanÄ±tlanÄ±rsa**, kaÃ§Ä±rÄ±lan yanÄ±t, kurbanÄ±n yanÄ±t kuyruÄŸuna **eklenmez, sadece bir hata olarak atÄ±lÄ±r**.

![](<../.gitbook/assets/image (630).png>)

Bu nedenle, **kaÃ§Ä±rÄ±lan isteÄŸin sunucuda iÅŸlenmesi daha uzun sÃ¼rmelidir**. Bu nedenle, kaÃ§Ä±rÄ±lan istek iÅŸlendiÄŸinde, saldÄ±rganla iletiÅŸim kurulmuÅŸ olacak.

Bu belirli durumda bir **kurban bir istek gÃ¶nderdiÄŸinde** ve **kaÃ§Ä±rÄ±lan istek Ã¶nce yanÄ±tlandÄ±ÄŸÄ±nda**, **kaÃ§Ä±rÄ±lan yanÄ±t kurbanÄ±n yanÄ±tÄ±na gÃ¶nderilecektir**. Bu nedenle, saldÄ±rgan **kurban tarafÄ±ndan "gerÃ§ekleÅŸtirilen" isteÄŸi kontrol edecek**.

DahasÄ±, **saldÄ±rgan daha sonra bir istek yaparsa** ve **kurbanÄ±n meÅŸru yanÄ±tÄ±**, **saldÄ±rganÄ±n isteÄŸinden Ã¶nce yanÄ±tlanÄ±rsa**, **kurbanÄ±n yanÄ±tÄ± saldÄ±rgana gÃ¶nderilecek**, kurbanÄ±n yanÄ±tÄ±nÄ± (Ã¶rneÄŸin **Set-Cookie** baÅŸlÄ±ÄŸÄ±nÄ± iÃ§erebilir) **Ã§alacak**.

![](<../.gitbook/assets/image (1017).png>)

![](<../.gitbook/assets/image (716).png>)

### Birden Fazla Ä°Ã§ Ä°Ã§e Enjeksiyon

YaygÄ±n bir **HTTP Ä°stek KaÃ§Ä±rma** saldÄ±rÄ±sÄ±ndan **farklÄ±** bir **ilginÃ§ fark**, yaygÄ±n bir kaÃ§Ä±rma saldÄ±rÄ±sÄ±nda **kurbanÄ±n isteÄŸinin baÅŸlangÄ±cÄ±nÄ± deÄŸiÅŸtirmenin** hedef olduÄŸu, **HTTP YanÄ±t kaÃ§Ä±rma saldÄ±rÄ±sÄ±nda**, **tam istekler gÃ¶nderdiÄŸinizden**, bir payload iÃ§ine onlarca yanÄ±t enjekte edebileceÄŸinizdir, bu da onlarca kullanÄ±cÄ±nÄ±n **enjekte edilen yanÄ±tlarÄ± alan** ve **desenkronize olan** kullanÄ±cÄ±lar olacaÄŸÄ± anlamÄ±na gelir.

MeÅŸru kullanÄ±cÄ±lara daha kolayca onlarca saldÄ±rÄ±yÄ± **daÄŸÄ±tabilme** yeteneÄŸinin yanÄ± sÄ±ra, bu aynÄ± zamanda sunucuda bir **DoS** oluÅŸturmak iÃ§in de kullanÄ±labilir.

### SaldÄ±rÄ± Organizasyonu

Bu tekniÄŸi kÃ¶tÃ¼ye kullanmak iÃ§in, **sunucuya ilk kaÃ§Ä±rÄ±lan mesajÄ±n iÅŸlenmesi iÃ§in Ã§ok zaman gereklidir**.

Bu **zaman alÄ±cÄ± istek, kurbanÄ±n yanÄ±tÄ±nÄ± Ã§almayÄ± denemek iÃ§in yeterlidir**. Ancak daha karmaÅŸÄ±k bir saldÄ±rÄ± gerÃ§ekleÅŸtirmek istiyorsanÄ±z, bu saldÄ±rÄ± iÃ§in yaygÄ±n bir yapÄ± olacaktÄ±r.

Ã–ncelikle, **HTTP Ä°stek KaÃ§Ä±rma**'yÄ± kÃ¶tÃ¼ye kullanarak **ilk** istek, ardÄ±ndan **zaman alan istek** ve ardÄ±ndan **kurbanlara gÃ¶nderilecek yanÄ±tlarÄ±n** **1 veya daha fazla payload isteÄŸi**.

## HTTP YanÄ±t KuyruÄŸu Desenkronizasyonunu KÃ¶tÃ¼ye Kullanma

### DiÄŸer kullanÄ±cÄ±larÄ±n isteklerini yakalama <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

Bilinen HTTP Ä°stek KaÃ§Ä±rma payloadlarÄ± gibi, **kurbanÄ±n isteÄŸini Ã§alabilirsiniz** ancak Ã¶nemli bir farkla: Bu durumda, **yanÄ±tta yansÄ±tÄ±lacak iÃ§eriÄŸi gÃ¶ndermek yeterlidir**, **kalÄ±cÄ± depolama gerekli deÄŸildir**.

Ã–ncelikle, saldÄ±rgan, sonunda yansÄ±tÄ±lan parametreli bir **son POST isteÄŸi iÃ§eren bir payload gÃ¶nderir** ve bÃ¼yÃ¼k bir Content-Length iÃ§erir

![](<../.gitbook/assets/image (1050).png>)

Sonra, **ilk istek** (mavi) **iÅŸlendikten sonra** ve **uyuyan** istek iÅŸlenirken (sarÄ±) **kurbanÄ±n gÃ¶nderdiÄŸi bir sonraki istek**, yansÄ±tÄ±lan parametrenin hemen ardÄ±ndan kuyruÄŸa **eklenecektir**:

![](<../.gitbook/assets/image (791).png>)

Sonra, **kurban**, **uyuyan** isteÄŸin yanÄ±tÄ±nÄ± **alacak** ve bu sÄ±rada **saldÄ±rgan** **baÅŸka bir istek gÃ¶nderirse**, **yansÄ±tÄ±lan iÃ§erik isteÄŸinin yanÄ±tÄ± ona gÃ¶nderilecektir**.

## YanÄ±t Desenkronizasyonu

Bu noktaya kadar, HTTP Ä°stek KaÃ§Ä±rma saldÄ±rÄ±larÄ±nÄ± kÃ¶tÃ¼ye kullanarak bir **istemcinin alacaÄŸÄ± yanÄ±tÄ± kontrol etmeyi** ve ardÄ±ndan **kurban iÃ§in amaÃ§lanan yanÄ±tÄ± Ã§almayÄ±** Ã¶ÄŸrendik.

Ancak yanÄ±tlarÄ± **daha da fazla desenkronize etmek mÃ¼mkÃ¼n**.

**HEAD** isteÄŸi gibi ilginÃ§ istekler vardÄ±r ki, **yanÄ±tÄ±n gÃ¶vdesinde hiÃ§bir iÃ§erik olmamasÄ± gerektiÄŸi** belirtilir ve (zorunlu olarak) **GET isteÄŸi gibi Content-Length** iÃ§ermesi gerekir.

Bu nedenle, bir saldÄ±rgan **HEAD** isteÄŸi enjekte ederse, bu resimlerde olduÄŸu gibi:

![](<../.gitbook/assets/image (1104).png>)

Sonra, **mavi olan saldÄ±rgana yanÄ±tlandÄ±ktan sonra**, bir sonraki kurbanÄ±n isteÄŸi kuyruÄŸa **eklenecektir**:

![](<../.gitbook/assets/image (996).png>)

Sonra, **kurban**, **HEAD** isteÄŸinden gelen **yanÄ±tÄ± alacak**, bu yanÄ±t **Content-Length iÃ§erecek ancak hiÃ§bir iÃ§erik olmayacak**. Bu nedenle, proxy, bu yanÄ±tÄ± kurbanÄ±n yanÄ±na **gÃ¶ndermeyecek**, ancak **bazÄ± iÃ§erik bekleyecek**, aslÄ±nda **saldÄ±rgan tarafÄ±ndan da enjekte edilen sarÄ± isteÄŸin yanÄ±tÄ± olacak**:

![](<../.gitbook/assets/image (732).png>)
### Ä°Ã§erik KarÄ±ÅŸÄ±klÄ±ÄŸÄ±

Ã–nceki Ã¶rneÄŸi takip ederek, **yanÄ±tÄ± alacak kurbanÄ±n isteÄŸinin gÃ¶vdesini kontrol edebileceÄŸinizi** ve bir **HEAD yanÄ±tÄ±nÄ±n genellikle baÅŸlÄ±klarÄ±nda** **Content-Type ve Content-Length**'i iÃ§erdiÄŸini bildiÄŸinizde, XSS'e neden olmak iÃ§in aÅŸaÄŸÄ±daki gibi bir istek gÃ¶nderebilirsiniz **XSS'e karÅŸÄ± savunmasÄ±z olmayan sayfada**:

![](<../.gitbook/assets/image (685).png>)

### Ã–nbellek Zehirlenmesi

Ã–nceki yorumlanmÄ±ÅŸ yanÄ±t desenkronizasyon Ä°Ã§erik KarÄ±ÅŸÄ±klÄ±ÄŸÄ± saldÄ±rÄ±sÄ±nÄ± istismar ederek, **Ã¶nbellek, kurban tarafÄ±ndan gerÃ§ekleÅŸtirilen isteÄŸin yanÄ±tÄ±nÄ± saklarsa ve bu yanÄ±t bir XSS'e neden olan enjekte edilmiÅŸ bir yanÄ±tsa, o zaman Ã¶nbellek zehirlenir**.

XSS yÃ¼kÃ¼ iÃ§eren kÃ¶tÃ¼ niyetli istek:

![](<../.gitbook/assets/image (611).png>)

Ã–nbelleÄŸe yanÄ±tÄ± saklamasÄ± iÃ§in baÅŸlÄ±ÄŸÄ± iÃ§eren kurbanÄ±n kÃ¶tÃ¼ niyetli yanÄ±tÄ±:

![](<../.gitbook/assets/image (563).png>)

{% hint style="warning" %}
Bu durumda **"kurban" saldÄ±rgan ise** artÄ±k **kÃ¶tÃ¼ niyetli yanÄ±tla Ã¶nbellek zehirlenmesi yapabilir** Ã§Ã¼nkÃ¼ **kÃ¶tÃ¼ niyetli yanÄ±tla Ã¶nbelleÄŸe alÄ±nacak URL'yi kontrol edebilir**.
{% endhint %}

### Web Ã–nbellek AldatmacasÄ±

Bu saldÄ±rÄ± Ã¶ncekine benzer, ancak **Ã¶nbelleÄŸe bir yÃ¼k enjekte etmek yerine, saldÄ±rgan kurban bilgisini Ã¶nbelleÄŸe alacak:**

![](<../.gitbook/assets/image (988).png>)

### YanÄ±t BÃ¶lÃ¼nmesi

Bu saldÄ±rÄ±nÄ±n **amacÄ±**, **yanÄ±t desenkronizasyonunu** tekrar **istismar ederek proxy'nin %100 saldÄ±rgan tarafÄ±ndan oluÅŸturulan bir yanÄ±t gÃ¶ndermesini saÄŸlamaktÄ±r**.

Bunu baÅŸarmak iÃ§in, saldÄ±rganÄ±n, yanÄ±tÄ±n iÃ§inde bazÄ± deÄŸerleri yansÄ±tan web uygulamasÄ±nÄ±n bir uÃ§ noktasÄ±nÄ± **bulmasÄ± ve HEAD yanÄ±tÄ±nÄ±n iÃ§eriÄŸinin uzunluÄŸunu bilmesi gerekir**.

Åu ÅŸekilde bir **saldÄ±rÄ±** gÃ¶nderecektir:

![](<../.gitbook/assets/image (908).png>)

Ä°lk istek Ã§Ã¶zÃ¼ldÃ¼kten ve saldÄ±rgana geri gÃ¶nderildikten sonra, **kurbanÄ±n isteÄŸi kuyruÄŸa eklenir**:

![](<../.gitbook/assets/image (734).png>)

Kurban, yanÄ±t olarak **HEAD yanÄ±tÄ±nÄ± + yansÄ±tÄ±lan verilerin bir kÄ±smÄ±nÄ± iÃ§eren ikinci isteÄŸin yanÄ±tÄ±nÄ± alacaktÄ±r**:

![](<../.gitbook/assets/image (353).png>)

Ancak, **yansÄ±tÄ±lan verilerin HEAD yanÄ±tÄ±nÄ±n Content-Length'ine gÃ¶re bir boyuta sahip olduÄŸuna** dikkat edin, bu da **yanÄ±t kuyruÄŸunda geÃ§erli bir HTTP yanÄ±tÄ± oluÅŸturdu**.

Bu nedenle, **ikinci kurbanÄ±n sonraki isteÄŸi** tamamen saldÄ±rgan tarafÄ±ndan oluÅŸturulan bir yanÄ±t alacaktÄ±r. YanÄ±t tamamen saldÄ±rgan tarafÄ±ndan oluÅŸturulduÄŸundan, aynÄ± zamanda **proxy'nin yanÄ±tÄ± Ã¶nbelleÄŸe almasÄ±nÄ± saÄŸlayabilir**.
