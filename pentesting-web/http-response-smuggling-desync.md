# HTTP YanÄ±tÄ± Smuggling / Desenkronizasyon

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

**Bu yazÄ±nÄ±n tekniÄŸi, ÅŸu videodan alÄ±nmÄ±ÅŸtÄ±r: [https://www.youtube.com/watch?v=suxDcYViwao\&t=1343s](https://www.youtube.com/watch?v=suxDcYViwao\&t=1343s)**


## HTTP Ä°stek SÄ±rasÄ± Desenkronizasyonu

Ã–ncelikle, bu teknik bir HTTP Ä°stek Smuggling zafiyetini istismar eder, bu yÃ¼zden bunun ne olduÄŸunu bilmelisiniz:

Bu teknik ve yaygÄ±n bir HTTP Ä°stek smuggling arasÄ±ndaki **ana fark**, **kurbanÄ±n isteÄŸine bir Ã¶nek ekleyerek saldÄ±rmak yerine, kurbanÄ±n aldÄ±ÄŸÄ± yanÄ±tÄ± sÄ±zdÄ±rmak veya deÄŸiÅŸtirmek**. Bunun iÃ§in, HTTP Ä°stek smuggling'i istismar etmek iÃ§in 1 istek ve yarÄ±m gÃ¶ndermek yerine, **proxy'lerin yanÄ±tlarÄ±nÄ±n sÄ±rasÄ±nÄ± desenkronize etmek iÃ§in 2 tam istek gÃ¶nderiyoruz**.

Bu, **yanÄ±t kuyruÄŸunu desenkronize edebileceÄŸimiz anlamÄ±na gelir**, bÃ¶ylece kurbanÄ±n **meÅŸru isteÄŸinin yanÄ±tÄ± saldÄ±rgan tarafÄ±ndan gÃ¶nderilir** veya saldÄ±rganÄ±n kontrol ettiÄŸi iÃ§eriÄŸi kurbanÄ±n yanÄ±tÄ±na enjekte ederiz.

### HTTP Pipeline Desenkronizasyonu

HTTP/1.1, **Ã¶nceki istekleri beklemeye gerek duymadan** **farklÄ± kaynaklarÄ± istemek** iÃ§in izin verir. Bu nedenle, **bir proxy** varsa, proxy'nin, **arka uÃ§taki gÃ¶nderilen isteklerin ve gelen yanÄ±tlarÄ±n senkronize bir eÅŸleÅŸmesini korumasÄ±** gerekir.

Ancak, yanÄ±tlarÄ±n kuyruÄŸunu desenkronize etme sorunu vardÄ±r. EÄŸer bir saldÄ±rgan bir HTTP YanÄ±tÄ± smuggling saldÄ±rÄ±sÄ± gÃ¶nderirse ve **ilk istek ve smuggling yapÄ±lan isteklere yanÄ±tlar hemen yanÄ±tlanÄ±rsa**, smuggling yanÄ±tÄ± kurbanÄ±n yanÄ±t kuyruÄŸuna **eklenmez, sadece bir hata olarak atÄ±lÄ±r**.

![](<../.gitbook/assets/image (635) (1) (1) (1).png>)

Bu nedenle, smuggling yapÄ±lan isteÄŸin iÅŸlenmesi daha uzun sÃ¼rmesi gerekmektedir. Bu ÅŸekilde, smuggling yapÄ±lan istek iÅŸlendiÄŸinde, saldÄ±rganla iletiÅŸim sona ermiÅŸ olacaktÄ±r.

EÄŸer bu Ã¶zel durumda bir **kurban bir istek gÃ¶ndermiÅŸse** ve **smuggling yapÄ±lan isteÄŸe yanÄ±t Ã¶nce** gelirse, **smuggling yanÄ±tÄ± kurbanÄ±n yanÄ±tÄ±na gÃ¶nderilecektir**. Bu durumda saldÄ±rgan, kurban tarafÄ±ndan "gerÃ§ekleÅŸtirilen" isteÄŸi **kontrol edecektir**.

DahasÄ±, eÄŸer saldÄ±rgan bir istek yaparsa ve kurbanÄ±n isteÄŸine **meÅŸru yanÄ±t**, saldÄ±rganÄ±n isteÄŸinden **Ã¶nce yanÄ±tlanÄ±rsa**, **kurbanÄ±n yanÄ±tÄ± saldÄ±rana gÃ¶nderilecektir**, bu da kurbanÄ±n yanÄ±tÄ±nÄ± (Ã¶rneÄŸin **Set-Cookie** baÅŸlÄ±ÄŸÄ±nÄ± iÃ§erebilir) Ã§alacaktÄ±r.

![](<../.gitbook/assets/image (658) (1).png>)

![](<../.gitbook/assets/image (655) (1) (1) (1).png>)

### Birden Fazla Ä°Ã§ Ä°Ã§e Enjeksiyon

YaygÄ±n bir HTTP Ä°stek Smuggling'den **ilginÃ§ bir fark**, yaygÄ±n bir smuggling saldÄ±rÄ±sÄ±nda, **hedefin isteÄŸinin baÅŸÄ±nÄ± deÄŸiÅŸtirerek beklenmedik bir eylem gerÃ§ekleÅŸtirmektir**. Bir **HTTP YanÄ±tÄ± smuggling saldÄ±rÄ±sÄ±nda**, tam istekler gÃ¶nderdiÄŸiniz iÃ§in **bir payload iÃ§ine onlarca yanÄ±t enjekte edebilirsiniz**, bu da onlarca kullanÄ±cÄ±nÄ±n **enjekte edilen yanÄ±tlarÄ± desenkronize edeceÄŸi** anlamÄ±na gelir.

MeÅŸru kullanÄ±cÄ±lara daha kolay bir ÅŸekilde onlarca saldÄ±rÄ± daÄŸÄ±tabilme yeteneÄŸi dÄ±ÅŸÄ±nda, bu aynÄ± zamanda sunucuda bir **DoS** (Hizmet Reddi) oluÅŸturmak iÃ§in de kullanÄ±labilir.

### SaldÄ±rÄ± DÃ¼zeni

Daha Ã¶nce aÃ§Ä±klandÄ±ÄŸÄ± gibi, bu tekniÄŸi istismar etmek iÃ§in, **sunucuya ilk smuggling mesajÄ±nÄ±n iÅŸlenmesi iÃ§in uzun bir sÃ¼re gereklidir**.

Bu zaman alÄ±cÄ± istek, sadece kurbanÄ±n yanÄ±tÄ±nÄ± Ã§almak istiyorsanÄ±z yeterlidir. Ancak daha karmaÅŸÄ±k bir saldÄ±rÄ± gerÃ§ekleÅŸtirmek istiyorsanÄ±z, bu saldÄ±rÄ± iÃ§in yaygÄ±n bir yapÄ±dÄ±r.

Ã–ncelikle, HTTP Ä°stek Smuggling'i istismar eden **ilk** istek, ardÄ±ndan **zaman alÄ±cÄ± istek** ve ardÄ±ndan yanÄ±tlarÄ± kurbanlara gÃ¶nderilecek **1 veya daha fazla payload isteÄŸi**.

## HTTP YanÄ±t KuyruÄŸu Desenkronizasyonunu Ä°stismar Etme

### DiÄŸer kullanÄ±cÄ±larÄ±n isteklerini yakalama <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

Bilinen HTTP Ä°stek Smuggling payloadlarÄ± gibi, kurbanÄ±n isteÄŸini **Ã§alabilirsiniz**, ancak Ã¶nemli bir farkla: Bu durumda, **yanÄ±tta yansÄ±tÄ±lan iÃ§eriÄŸi gÃ¶ndermek** iÃ§in **kalÄ±cÄ± depolama gerekmez**.

Ä°lk olarak, saldÄ±rgan, sonunda yansÄ±tÄ±lan parametreli bir **son POST isteÄŸi iÃ§eren bir payload** gÃ¶nderir ve bÃ¼yÃ¼k bir Content-Length iÃ§erir.

![](<../.gitbook/assets/image (625).png>)

Daha sonra, **ilk istek** (mavi) **iÅŸlendi** ve **uykulu** olan iÅŸlenirken (sarÄ±), **bir kurbandan gelen sonraki istek, yansÄ±tÄ±lan parametrenin hemen ardÄ±ndan kuyruÄŸa eklenecektir**:

![](<../.gitbook/assets/image (634) (1).png>)

Daha sonra, **kurban**, **uykulu** isteÄŸin yanÄ±tÄ±nÄ± **alacak** ve bu sÄ±rada **saldÄ±rgan** **baÅŸka bir istek gÃ¶nderirse**, **yansÄ±tÄ±lan iÃ§erik isteÄŸinin yanÄ±tÄ± ona gÃ¶nderilecektir**.

## YanÄ±t Desenkronizasyonu

Bu noktaya kadar, HTTP Ä°stek Smuggling saldÄ±rÄ±larÄ±nÄ± istismar ederek bir **istemcinin alacaÄŸÄ± yanÄ±tÄ± kontrol etmeyi** ve ardÄ±ndan kurban iÃ§in amaÃ§
### Ä°Ã§erik KarÄ±ÅŸÄ±klÄ±ÄŸÄ±

Ã–nceki Ã¶rneÄŸi takip ederek, **yanÄ±tÄ± alacak olan kurbanÄ±n isteÄŸin gÃ¶vdesini kontrol edebileceÄŸinizi** ve bir **HEAD yanÄ±tÄ±nÄ±n genellikle baÅŸlÄ±klarÄ±nda Content-Type ve Content-Length'in** bulunduÄŸunu bilerek, XSS saldÄ±rÄ±sÄ±na neden olmadan kurbanda XSS olmayan bir sayfada XSS oluÅŸturmak iÃ§in aÅŸaÄŸÄ±daki gibi bir istek gÃ¶nderebilirsiniz:

![](<../.gitbook/assets/image (654) (1) (1) (1) (1).png>)

### Ã–nbellek Zehirlenmesi

Ã–nceden belirtilen yanÄ±t desenkronizasyonu Ä°Ã§erik KarÄ±ÅŸÄ±klÄ±ÄŸÄ± saldÄ±rÄ±sÄ±nÄ± kÃ¶tÃ¼ye kullanarak, **Ã¶nbellek, kurban tarafÄ±ndan gerÃ§ekleÅŸtirilen isteÄŸin yanÄ±tÄ±nÄ± saklarsa ve bu yanÄ±t XSS'e neden olan bir enjekte edilmiÅŸ yanÄ±t ise, Ã¶nbellek zehirlenir**.

XSS yÃ¼kÃ¼nÃ¼ iÃ§eren kÃ¶tÃ¼ niyetli istek:

![](<../.gitbook/assets/image (644) (1).png>)

Ã–nbelleÄŸe yanÄ±tÄ±n saklanmasÄ±nÄ± belirten baÅŸlÄ±ÄŸÄ± iÃ§eren kurbanÄ± hedefleyen kÃ¶tÃ¼ niyetli yanÄ±t:

![](<../.gitbook/assets/image (629) (1).png>)

{% hint style="warning" %}
Bu durumda **"kurban" saldÄ±rgan ise**, artÄ±k **kÃ¶tÃ¼ niyetli yanÄ±tla Ã¶nbelleÄŸe zehirleme yapabilir**, Ã§Ã¼nkÃ¼ **kÃ¶tÃ¼ niyetli yanÄ±tla Ã¶nbelleÄŸe alÄ±nacak URL'yi kontrol edebilir**.
{% endhint %}

### Web Ã–nbellek YanÄ±ltmasÄ±

Bu saldÄ±rÄ±, Ã¶ncekiyle benzerdir, ancak **Ã¶nbelleÄŸe bir yÃ¼k enjekte etmek yerine, saldÄ±rgan kurban bilgisini Ã¶nbelleÄŸe alÄ±r**:

![](<../.gitbook/assets/image (643) (1) (1).png>)

### YanÄ±t BÃ¶lÃ¼nmesi

Bu saldÄ±rÄ±nÄ±n amacÄ±, tekrar **yanÄ±t desenkronizasyonunu kÃ¶tÃ¼ye kullanarak proxy'nin %100 saldÄ±rgan tarafÄ±ndan oluÅŸturulan bir yanÄ±t gÃ¶ndermesini saÄŸlamaktÄ±r**.

Bunu baÅŸarmak iÃ§in saldÄ±rganÄ±n, yanÄ±tÄ±n iÃ§inde bazÄ± deÄŸerleri yansÄ±tan web uygulamasÄ±nÄ±n bir uÃ§ noktasÄ±nÄ± bulmasÄ± ve HEAD yanÄ±tÄ±nÄ±n iÃ§erik uzunluÄŸunu bilmesi gerekmektedir.

AÅŸaÄŸÄ±daki gibi bir **saldÄ±rÄ±** gÃ¶nderecektir:

![](<../.gitbook/assets/image (649) (1) (1) (1).png>)

Ä°lk istek Ã§Ã¶zÃ¼ldÃ¼kten ve saldÄ±rgana geri gÃ¶nderildikten sonra, **kurbanÄ±n isteÄŸi sÄ±raya eklenir**:

![](<../.gitbook/assets/image (661) (1) (1) (1).png>)

Kurban, yanÄ±t olarak **HEAD yanÄ±tÄ±nÄ± + ikinci isteÄŸin yanÄ±tÄ±nÄ±n iÃ§eriÄŸini (yansÄ±tÄ±lan verinin bir kÄ±smÄ±nÄ± iÃ§eren)** alacaktÄ±r:

![](<../.gitbook/assets/image (633) (1).png>)

Ancak, **yansÄ±tÄ±lan verinin HEAD yanÄ±tÄ±nÄ±n Content-Length'ine gÃ¶re bir boyuta sahip olduÄŸuna** dikkat edin, bu da **yanÄ±t sÄ±rasÄ±nda geÃ§erli bir HTTP yanÄ±tÄ± oluÅŸturdu**.

Bu nedenle, **ikinci kurbanÄ±n bir sonraki isteÄŸi**, **saldÄ±rgan tarafÄ±ndan tamamen oluÅŸturulan bir yanÄ±tÄ± alacaktÄ±r**. YanÄ±t tamamen saldÄ±rgan tarafÄ±ndan oluÅŸturulduÄŸu iÃ§in **proxy'nin yanÄ±tÄ± Ã¶nbelleÄŸe almasÄ±nÄ± da saÄŸlayabilir**.


<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **tanÄ±tmak veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da takip edin ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live).
* Hacking hilelerinizi gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek **hacking hilelerinizi paylaÅŸÄ±n**.

</details>
