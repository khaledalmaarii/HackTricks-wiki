# HTTP YanÄ±t KaÃ§Ä±rma / Desenkronizasyon

<details>

<summary><strong>AWS hackleme konusunu sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek.

</details>

**Bu yazÄ±nÄ±n tekniÄŸi, ÅŸu videodan alÄ±nmÄ±ÅŸtÄ±r:** [**https://www.youtube.com/watch?v=suxDcYViwao\&t=1343s**](https://www.youtube.com/watch?v=suxDcYViwao\&t=1343s)

## HTTP Ä°stek KuyruÄŸu Desenkronizasyonu

Bu tekniÄŸin **bir HTTP Ä°stek KaÃ§Ä±rma aÃ§Ä±ÄŸÄ±ndan yararlandÄ±ÄŸÄ±nÄ±** unutmayÄ±n, bu yÃ¼zden bunun ne olduÄŸunu bilmelisiniz:

Bu tekniÄŸin bir standart HTTP Ä°stek kaÃ§Ä±rma saldÄ±rÄ±sÄ±ndan farkÄ±, **kurbanÄ±n isteÄŸine bir Ã¶nek ekleyerek saldÄ±rmak yerine**, **kurbanÄ±n aldÄ±ÄŸÄ± yanÄ±tÄ± sÄ±zdÄ±rmak veya deÄŸiÅŸtirmek** olacaktÄ±r. Bu, HTTP Ä°stek kaÃ§Ä±rma saldÄ±rÄ±sÄ±nÄ± kÃ¶tÃ¼ye kullanmak iÃ§in 1 istek ve yarÄ±m gÃ¶ndermek yerine, **proxy yanÄ±tlarÄ±nÄ± desenkronize etmek iÃ§in 2 tam istek gÃ¶ndermek** anlamÄ±na gelir.

Bu, **yanÄ±t kuyruÄŸunu desenkronize edebileceÄŸimiz iÃ§in**, **kurbanÄ±n meÅŸru isteÄŸinden gelen yanÄ±tÄ±n saldÄ±rgan tarafÄ±ndan gÃ¶nderilmesine** veya **kurbanÄ±n yanÄ±tÄ±na saldÄ±rgan tarafÄ±ndan kontrol edilen iÃ§erik enjekte edilmesine** olanak tanÄ±r.

### HTTP Boru HattÄ± Desenkronizasyonu

HTTP/1.1, **Ã¶nceki istekleri beklemeye gerek olmadan farklÄ± kaynaklar istemeyi** saÄŸlar. Bu nedenle, bir **proxy** varsa, **arka uca gÃ¶nderilen isteklerin ve oradan gelen yanÄ±tlarÄ±n senkronize eÅŸleÅŸmesini saÄŸlamak** proxy'nin gÃ¶revidir.

Ancak, yanÄ±tlarÄ±n kuyruÄŸunu desenkronize etme sorunu vardÄ±r. Bir saldÄ±rgan bir HTTP YanÄ±t kaÃ§Ä±rma saldÄ±rÄ±sÄ± gÃ¶nderirse ve **ilk istek ve kaÃ§Ä±rÄ±lan yanÄ±tlar hemen yanÄ±tlanÄ±rsa**, kaÃ§Ä±rÄ±lan yanÄ±t, kurbanÄ±n yanÄ±t kuyruÄŸuna **eklenmeyecek, sadece bir hata olarak atÄ±lacaktÄ±r**.

Bu nedenle, **kaÃ§Ä±rÄ±lan isteÄŸin iÅŸlenmesi iÃ§in daha fazla zaman almasÄ± gerekmektedir**. Bu nedenle, kaÃ§Ä±rÄ±lan istek iÅŸlendiÄŸinde, saldÄ±rganla iletiÅŸim kurulmuÅŸ olacaktÄ±r.

EÄŸer bu belirli durumda bir **kurban bir istek gÃ¶ndermiÅŸse** ve **kaÃ§Ä±rÄ±lan istek Ã¶nce yanÄ±tlanÄ±rsa**, **kaÃ§Ä±rÄ±lan yanÄ±t kurbanÄ±n alacaÄŸÄ±** ÅŸekilde gÃ¶nderilecektir. Bu nedenle, saldÄ±rgan, kurban tarafÄ±ndan "gerÃ§ekleÅŸtirilen" isteÄŸi **kontrol edecektir**.

DahasÄ±, **saldÄ±rgan daha sonra bir istek yaparsa** ve **kurbanÄ±n meÅŸru yanÄ±tÄ±**, **saldÄ±rganÄ±n isteÄŸinden Ã¶nce yanÄ±tlanÄ±rsa**, **kurbanÄ±n yanÄ±tÄ± saldÄ±rgana gÃ¶nderilecektir**, kurbanÄ±n yanÄ±tÄ±nÄ± (Ã¶rneÄŸin **Set-Cookie** baÅŸlÄ±ÄŸÄ±nÄ± iÃ§erebilir) **Ã§alacaktÄ±r**.

### Birden Fazla Ä°Ã§ Ä°Ã§e Enjeksiyon

Ortak **HTTP Ä°stek KaÃ§Ä±rma** saldÄ±rÄ±sÄ±ndan farklÄ± olarak, bir ortak kaÃ§Ä±rma saldÄ±rÄ±sÄ±nda, **hedefin isteÄŸinin baÅŸlangÄ±cÄ±nÄ± deÄŸiÅŸtirmenin** amaÃ§landÄ±ÄŸÄ±dÄ±r. **HTTP YanÄ±t kaÃ§Ä±rma saldÄ±rÄ±sÄ±nda**, tam istekler gÃ¶nderdiÄŸinizden, bir yÃ¼kte onlarca yanÄ±tÄ± **enjekte edebilirsiniz** ve bu, **enjekte edilen yanÄ±tlarÄ± alan onlarca kullanÄ±cÄ±yÄ± desenkronize edecektir**.

MeÅŸru kullanÄ±cÄ±lara daha kolay bir ÅŸekilde onlarca saldÄ±rÄ±yÄ± **daÄŸÄ±tabilme** yeteneÄŸinin yanÄ± sÄ±ra, bu, sunucuda bir **Hizmet DÄ±ÅŸÄ± BÄ±rakma**'ya neden olmak iÃ§in de kullanÄ±labilir.

### SaldÄ±rÄ± Organizasyonu

Bu tekniÄŸi kÃ¶tÃ¼ye kullanmak iÃ§in, **sunucuya ilk kaÃ§Ä±rÄ±lan mesajÄ±n iÅŸlenmesinin uzun zaman almasÄ± gerekmektedir**.

Bu **zaman alÄ±cÄ± istek, kurbanÄ±n yanÄ±tÄ±nÄ± Ã§almayÄ± denemek** istiyorsanÄ±z yeterlidir. Ancak daha karmaÅŸÄ±k bir saldÄ±rÄ± gerÃ§ekleÅŸtirmek istiyorsanÄ±z, bu saldÄ±rÄ± iÃ§in yaygÄ±n bir yapÄ± olacaktÄ±r.

Ã–ncelikle, **HTTP Ä°stek KaÃ§Ä±rma**'yÄ± kÃ¶tÃ¼ye kullanarak **ilk** istek, ardÄ±ndan **zaman alan istek** ve ardÄ±ndan **kurbanlara gÃ¶nderilecek yanÄ±tlarÄ±n** gÃ¶nderileceÄŸi **1 veya daha fazla yÃ¼k isteÄŸi**.

## HTTP YanÄ±t KuyruÄŸu Desenkronizasyonunu KÃ¶tÃ¼ye Kullanma

### DiÄŸer kullanÄ±cÄ±larÄ±n isteklerini yakalama <a href="#capturing-other-users-requests" id="capturing-other-users-requests"></a>

Bilinen HTTP Ä°stek KaÃ§Ä±rma payloadlarÄ± gibi, bu durumda **kurbanÄ±n isteÄŸini Ã§alabilirsiniz** ancak Ã¶nemli bir farkla: Bu durumda, **yanÄ±tta yansÄ±tÄ±lacak iÃ§eriÄŸe ihtiyacÄ±nÄ±z vardÄ±r**, **kalÄ±cÄ± depolama gerekmez**.

Ã–ncelikle, saldÄ±rgan, sonunda yansÄ±tÄ±lan parametreye sahip bir **son POST isteÄŸi iÃ§eren bir yÃ¼k** ve bÃ¼yÃ¼k bir Content-Length iÃ§eren bir yÃ¼k gÃ¶nderir.

![](<../.gitbook/assets/image (1053).png>)

Sonra, **ilk istek** (mavi) **iÅŸlendikten sonra** ve **uyuyan** istek iÅŸlenirken (sarÄ±) **kurban tarafÄ±ndan gelen bir sonraki istek**, **yansÄ±tÄ±lan parametrenin hemen ardÄ±ndan kuyruÄŸa eklenecektir**:

![](<../.gitbook/assets/image (794).png>)

Sonra, **kurban**, **uyuyan** isteÄŸin yanÄ±tÄ±nÄ± alacak ve bu arada **saldÄ±rgan baÅŸka bir istek gÃ¶nderirse**, **yansÄ±tÄ±lan iÃ§erik isteÄŸinden gelen yanÄ±t ona gÃ¶nderilecektir**.

## YanÄ±t Desenkronizasyonu

Bu noktaya kadar, HTTP Ä°stek KaÃ§Ä±rma saldÄ±rÄ±larÄ±nÄ± kÃ¶tÃ¼ye kullanarak bir **istemcinin alacaÄŸÄ± yanÄ±tÄ± kontrol etmeyi** ve ardÄ±ndan **kurban iÃ§in amaÃ§lanan yanÄ±tÄ± Ã§almayÄ±** Ã¶ÄŸrendik.

Ancak yanÄ±tlarÄ± **daha da fazla desenkronize etmek mÃ¼mkÃ¼ndÃ¼r**.

**HEAD** isteÄŸi gibi ilginÃ§ istekler vardÄ±r ki, bu isteklerin **yanÄ±t gÃ¶vdesinde hiÃ§bir iÃ§erik olmamasÄ± gerektiÄŸi** belirtilmiÅŸtir ve (zorunlu olarak) **GET isteÄŸi gibi Content-Length** iÃ§ermesi gerekmektedir.

Bu nedenle, bir saldÄ±rgan, bu gÃ¶rÃ¼ntÃ¼lerde olduÄŸu gibi bir **HEAD** isteÄŸi enjekte ederse:

![](<../.gitbook/assets/image (1107).png>)

Sonra, **mavi olan saldÄ±rgana yanÄ±tlandÄ±ktan sonra**, bir sonraki kurbanÄ±n isteÄŸi kuyruÄŸa eklenecektir:

![](<../.gitbook/assets/image (999).png>)

Sonra, **kurban**, **HEAD** isteÄŸinden gelen yanÄ±tÄ± alacak, bu yanÄ±t **hiÃ§bir iÃ§erik iÃ§ermesine raÄŸmen Content-Length iÃ§erecektir**. Bu nedenle, proxy, bu yanÄ±tÄ± kurbanÄ±n yanÄ±tÄ±na gÃ¶ndermeyecek, ancak bir **iÃ§erik bekleyecek**, bu iÃ§erik aslÄ±nda **saldÄ±rgan tarafÄ±ndan da enjekte edilen sarÄ± isteÄŸin yanÄ±tÄ± olacaktÄ±r**:

![](<../.gitbook/assets/image (735).png>)
### Ä°Ã§erik KarÄ±ÅŸÄ±klÄ±ÄŸÄ±

Ã–nceki Ã¶rneÄŸi takip ederek, **yanÄ±tÄ± alacak kurbanÄ±n vÃ¼cudunu kontrol edebileceÄŸinizi** ve bir **HEAD yanÄ±tÄ±nÄ±n genellikle baÅŸlÄ±klarÄ±nda** **Content-Type ve Content-Length**'in bulunduÄŸunu bilerek, XSS'ye neden olmak iÃ§in aÅŸaÄŸÄ±daki gibi bir istek gÃ¶nderebilirsiniz:

![](<../.gitbook/assets/image (688).png>)

### Ã–nbellek Zehirlenmesi

Ã–nceki yorumlanmÄ±ÅŸ yanÄ±t desenkronizasyonu Ä°Ã§erik KarÄ±ÅŸÄ±klÄ±ÄŸÄ± saldÄ±rÄ±sÄ±nÄ± istismar ederek, **Ã¶nbelleÄŸin, kurban tarafÄ±ndan gerÃ§ekleÅŸtirilen isteÄŸin yanÄ±tÄ±nÄ± sakladÄ±ÄŸÄ±nÄ± ve bu yanÄ±tÄ±n XSS'e neden olan bir enjekte edilmiÅŸ yanÄ±t olduÄŸunu** varsayarsak, Ã¶nbellek zehirlenir.

XSS yÃ¼kÃ¼ iÃ§eren kÃ¶tÃ¼ niyetli istek:

![](<../.gitbook/assets/image (614).png>)

Ã–nbelleÄŸe yanÄ±tÄ± saklamasÄ± iÃ§in baÅŸlÄ±ÄŸÄ± iÃ§eren kurbanÄ± hedefleyen kÃ¶tÃ¼ niyetli yanÄ±t:

![](<../.gitbook/assets/image (566).png>)

{% hint style="warning" %}
Bu durumda **"kurban" saldÄ±rgan ise** artÄ±k **rastgele URL'lerde Ã¶nbellek zehirlenmesi yapabilir** Ã§Ã¼nkÃ¼ kÃ¶tÃ¼ niyetli yanÄ±tla **Ã¶nbelleÄŸe alÄ±nacak URL'yi kontrol edebilir**.
{% endhint %}

### Web Ã–nbellek AldatmacasÄ±

Bu saldÄ±rÄ± Ã¶ncekine benzer, ancak **Ã¶nbelleÄŸe bir yÃ¼k enjekte etmek yerine, saldÄ±rgan kurban bilgilerini Ã¶nbelleÄŸe alacak:**

![](<../.gitbook/assets/image (991).png>)

### YanÄ±t BÃ¶lÃ¼nmesi

Bu saldÄ±rÄ±nÄ±n **amacÄ±**, **yanÄ±t desenkronizasyonunu** tekrar kÃ¶tÃ¼ye kullanarak **proxy'nin %100 saldÄ±rgan tarafÄ±ndan oluÅŸturulan bir yanÄ±t gÃ¶ndermesini saÄŸlamaktÄ±r**.

Bunu baÅŸarmak iÃ§in, saldÄ±rganÄ±n, **yanÄ±tÄ±n iÃ§inde bazÄ± deÄŸerleri yansÄ±tan bir web uygulamasÄ±nÄ±n bir uÃ§ noktasÄ±nÄ± bulmasÄ±** ve **HEAD yanÄ±tÄ±nÄ±n iÃ§eriÄŸinin uzunluÄŸunu bilmesi** gerekir.

Åu ÅŸekilde bir **saldÄ±rÄ±** gÃ¶nderecektir:

![](<../.gitbook/assets/image (911).png>)

Ä°lk istek Ã§Ã¶zÃ¼ldÃ¼kten ve saldÄ±rgana geri gÃ¶nderildikten sonra, **kurbanÄ±n isteÄŸi sÄ±raya eklenir**:

![](<../.gitbook/assets/image (737).png>)

Kurban, yanÄ±t olarak **HEAD yanÄ±tÄ±nÄ± + ikinci isteÄŸin yanÄ±tÄ±nÄ±n iÃ§eriÄŸini (yansÄ±tÄ±lan verilerin bir kÄ±smÄ±nÄ± iÃ§eren)** alacaktÄ±r:

![](<../.gitbook/assets/image (356).png>)

Ancak, **yansÄ±tÄ±lan verilerin, HEAD yanÄ±tÄ±nÄ±n Content-Length'ine gÃ¶re bir boyuta sahip olduÄŸuna** dikkat edin, bu da **yanÄ±t sÄ±rasÄ±nda geÃ§erli bir HTTP yanÄ±tÄ± oluÅŸturdu**.

Bu nedenle, **ikinci kurbanÄ±n sonraki isteÄŸi**, **tamamen saldÄ±rgan tarafÄ±ndan oluÅŸturulan bir yanÄ±t alacak**. YanÄ±t tamamen saldÄ±rgan tarafÄ±ndan oluÅŸturulduÄŸundan, aynÄ± zamanda **proxy'nin yanÄ±tÄ± Ã¶nbelleÄŸe almasÄ±nÄ± saÄŸlayabilir**.
