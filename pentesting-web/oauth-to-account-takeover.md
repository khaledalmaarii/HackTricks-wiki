# OAuth to Account takeover

<details>

<summary><strong>Naucz siÄ™ hackingu AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w PDF** SprawdÅº [**PLANY SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFTs**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi trikami hakerskimi, przesyÅ‚ajÄ…c PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Podstawowe informacje <a href="#d4a8" id="d4a8"></a>

OAuth oferuje rÃ³Å¼ne wersje, z podstawowymi informacjami dostÄ™pnymi w [OAuth 2.0 documentation](https://oauth.net/2/). Ta dyskusja koncentruje siÄ™ gÅ‚Ã³wnie na szeroko stosowanym [OAuth 2.0 authorization code grant type](https://oauth.net/2/grant-types/authorization-code/), zapewniajÄ…cym **ramy autoryzacji, ktÃ³re umoÅ¼liwiajÄ… aplikacji dostÄ™p lub wykonywanie dziaÅ‚aÅ„ na koncie uÅ¼ytkownika w innej aplikacji** (serwer autoryzacji).

RozwaÅ¼my hipotetycznÄ… stronÄ™ _**https://example.com**_, zaprojektowanÄ… do **prezentowania wszystkich Twoich postÃ³w w mediach spoÅ‚ecznoÅ›ciowych**, w tym prywatnych. Aby to osiÄ…gnÄ…Ä‡, stosowany jest OAuth 2.0. _https://example.com_ poprosi o TwojÄ… zgodÄ™ na **dostÄ™p do Twoich postÃ³w w mediach spoÅ‚ecznoÅ›ciowych**. W konsekwencji na _https://socialmedia.com_ pojawi siÄ™ ekran zgody, przedstawiajÄ…cy **uprawnienia, o ktÃ³re siÄ™ prosi, oraz dewelopera skÅ‚adajÄ…cego proÅ›bÄ™**. Po Twojej autoryzacji, _https://example.com_ zyska moÅ¼liwoÅ›Ä‡ **dostÄ™pu do Twoich postÃ³w w Twoim imieniu**.

WaÅ¼ne jest, aby zrozumieÄ‡ nastÄ™pujÄ…ce komponenty w ramach OAuth 2.0:

* **resource owner**: Ty, jako **uÅ¼ytkownik/podmiot**, autoryzujesz dostÄ™p do swojego zasobu, np. postÃ³w na koncie w mediach spoÅ‚ecznoÅ›ciowych.
* **resource server**: **Serwer zarzÄ…dzajÄ…cy uwierzytelnionymi Å¼Ä…daniami** po tym, jak aplikacja uzyska `access token` w imieniu `resource owner`, np. **https://socialmedia.com**.
* **client application**: **Aplikacja ubiegajÄ…ca siÄ™ o autoryzacjÄ™** od `resource owner`, taka jak **https://example.com**.
* **authorization server**: **Serwer, ktÃ³ry wydaje `access tokens`** do `client application` po pomyÅ›lnym uwierzytelnieniu `resource owner` i uzyskaniu autoryzacji, np. **https://socialmedia.com**.
* **client\_id**: Publiczny, unikalny identyfikator aplikacji.
* **client\_secret:** Poufny klucz, znany tylko aplikacji i serwerowi autoryzacji, uÅ¼ywany do generowania `access_tokens`.
* **response\_type**: WartoÅ›Ä‡ okreÅ›lajÄ…ca **typ Å¼Ä…danego tokena**, np. `code`.
* **scope**: **Poziom dostÄ™pu**, o ktÃ³ry ubiega siÄ™ `client application` od `resource owner`.
* **redirect\_uri**: **URL, na ktÃ³ry uÅ¼ytkownik jest przekierowywany po autoryzacji**. Zazwyczaj musi byÄ‡ zgodny z wczeÅ›niej zarejestrowanym URL przekierowania.
* **state**: Parametr do **utrzymania danych podczas przekierowania uÅ¼ytkownika do i z serwera autoryzacji**. Jego unikalnoÅ›Ä‡ jest kluczowa dla peÅ‚nienia funkcji **mechanizmu ochrony przed CSRF**.
* **grant\_type**: Parametr wskazujÄ…cy **typ grantu i typ tokena, ktÃ³ry ma zostaÄ‡ zwrÃ³cony**.
* **code**: Kod autoryzacyjny z `authorization server`, uÅ¼ywany w poÅ‚Ä…czeniu z `client_id` i `client_secret` przez aplikacjÄ™ klienckÄ… do uzyskania `access_token`.
* **access\_token**: **Token, ktÃ³rego aplikacja kliencka uÅ¼ywa do Å¼Ä…daÅ„ API** w imieniu `resource owner`.
* **refresh\_token**: UmoÅ¼liwia aplikacji **uzyskanie nowego `access_token` bez ponownego pytania uÅ¼ytkownika**.

### Przebieg

**Rzeczywisty przebieg OAuth** wyglÄ…da nastÄ™pujÄ…co:

1. Przechodzisz na [https://example.com](https://example.com) i wybierasz przycisk â€Integrate with Social Mediaâ€.
2. Strona wysyÅ‚a Å¼Ä…danie do [https://socialmedia.com](https://socialmedia.com) proszÄ…c o TwojÄ… autoryzacjÄ™, aby aplikacja https://example.com mogÅ‚a uzyskaÄ‡ dostÄ™p do Twoich postÃ³w. Å»Ä…danie jest skonstruowane jako:
```
https://socialmedia.com/auth
?response_type=code
&client_id=example_clientId
&redirect_uri=https%3A%2F%2Fexample.com%2Fcallback
&scope=readPosts
&state=randomString123
```
3. NastÄ™pnie zostanie wyÅ›wietlona strona zgody.
4. Po zatwierdzeniu, Social Media wysyÅ‚a odpowiedÅº do `redirect_uri` z parametrami `code` i `state`:
```
https://example.com?code=uniqueCode123&state=randomString123
```
5. https://example.com wykorzystuje ten `code`, razem z `client_id` i `client_secret`, aby wykonaÄ‡ Å¼Ä…danie po stronie serwera w celu uzyskania `access_token` w Twoim imieniu, umoÅ¼liwiajÄ…c dostÄ™p do uprawnieÅ„, na ktÃ³re wyraziÅ‚eÅ› zgodÄ™:
```
POST /oauth/access_token
Host: socialmedia.com
...{"client_id": "example_clientId", "client_secret": "example_clientSecret", "code": "uniqueCode123", "grant_type": "authorization_code"}
```
```markdown
6. Finally, the process concludes as https://example.com employs your `access_token` to make an API call to Social Media to access

## Vulnerabilities <a href="#id-323a" id="id-323a"></a>

### Open redirect\_uri <a href="#cc36" id="cc36"></a>

`redirect_uri` jest kluczowy dla bezpieczeÅ„stwa w implementacjach OAuth i OpenID, poniewaÅ¼ kieruje, gdzie wysyÅ‚ane sÄ… wraÅ¼liwe dane, takie jak kody autoryzacyjne, po autoryzacji. JeÅ›li jest Åºle skonfigurowany, moÅ¼e pozwoliÄ‡ atakujÄ…cym na przekierowanie tych Å¼Ä…daÅ„ na zÅ‚oÅ›liwe serwery, umoÅ¼liwiajÄ…c przejÄ™cie konta.

Techniki eksploatacji rÃ³Å¼niÄ… siÄ™ w zaleÅ¼noÅ›ci od logiki walidacji serwera autoryzacyjnego. MogÄ… obejmowaÄ‡ od Å›cisÅ‚ego dopasowania Å›cieÅ¼ki do akceptowania dowolnego URL w okreÅ›lonej domenie lub podkatalogu. Powszechne metody eksploatacji obejmujÄ… otwarte przekierowania, przejÅ›cia Å›cieÅ¼ek, wykorzystywanie sÅ‚abych wyraÅ¼eÅ„ regularnych i wstrzykiwanie HTML w celu kradzieÅ¼y tokenÃ³w.

OprÃ³cz `redirect_uri`, inne parametry OAuth i OpenID, takie jak `client_uri`, `policy_uri`, `tos_uri` i `initiate_login_uri`, sÄ… rÃ³wnieÅ¼ podatne na ataki przekierowania. Te parametry sÄ… opcjonalne i ich wsparcie rÃ³Å¼ni siÄ™ w zaleÅ¼noÅ›ci od serwerÃ³w.

Dla tych, ktÃ³rzy celujÄ… w serwer OpenID, punkt odkrywania (`**.well-known/openid-configuration**`) czÄ™sto zawiera cenne szczegÃ³Å‚y konfiguracyjne, takie jak `registration_endpoint`, `request_uri_parameter_supported` i `require_request_uri_registration`. Te szczegÃ³Å‚y mogÄ… pomÃ³c w identyfikacji punktu rejestracji i innych specyfikacji konfiguracyjnych serwera.

### XSS in redirect implementation <a href="#bda5" id="bda5"></a>

Jak wspomniano w tym raporcie o bug bounty [https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html](https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html) moÅ¼e byÄ‡ moÅ¼liwe, Å¼e **URL przekierowania jest odzwierciedlany w odpowiedzi** serwera po uwierzytelnieniu uÅ¼ytkownika, bÄ™dÄ…c **podatnym na XSS**. MoÅ¼liwy Å‚adunek do testowania:
```
```
https://app.victim.com/login?redirectUrl=https://app.victim.com/dashboard</script><h1>test</h1>
```
### CSRF - Improper handling of state parameter <a href="#bda5" id="bda5"></a>

W implementacjach OAuth niewÅ‚aÅ›ciwe uÅ¼ycie lub pominiÄ™cie **parametru `state`** moÅ¼e znacznie zwiÄ™kszyÄ‡ ryzyko atakÃ³w **Cross-Site Request Forgery (CSRF)**. Ta podatnoÅ›Ä‡ pojawia siÄ™, gdy parametr `state` jest **nieuÅ¼ywany, uÅ¼ywany jako wartoÅ›Ä‡ statyczna lub nie jest odpowiednio walidowany**, co pozwala atakujÄ…cym na obejÅ›cie zabezpieczeÅ„ CSRF.

AtakujÄ…cy mogÄ… to wykorzystaÄ‡, przechwytujÄ…c proces autoryzacji, aby poÅ‚Ä…czyÄ‡ swoje konto z kontem ofiary, co moÅ¼e prowadziÄ‡ do potencjalnych **przejÄ™Ä‡ konta**. Jest to szczegÃ³lnie krytyczne w aplikacjach, gdzie OAuth jest uÅ¼ywany do **celÃ³w uwierzytelniania**.

PrzykÅ‚ady tej podatnoÅ›ci w rzeczywistych sytuacjach zostaÅ‚y udokumentowane w rÃ³Å¼nych **wyzwaniach CTF** i **platformach hakerskich**, co podkreÅ›la jej praktyczne implikacje. Problem ten dotyczy rÃ³wnieÅ¼ integracji z usÅ‚ugami zewnÄ™trznymi, takimi jak **Slack**, **Stripe** i **PayPal**, gdzie atakujÄ…cy mogÄ… przekierowywaÄ‡ powiadomienia lub pÅ‚atnoÅ›ci na swoje konta.

PrawidÅ‚owe obsÅ‚ugiwanie i walidacja **parametru `state`** sÄ… kluczowe dla ochrony przed CSRF i zabezpieczenia przepÅ‚ywu OAuth.

### Pre Account Takeover <a href="#ebe4" id="ebe4"></a>

1. **Bez weryfikacji e-maila przy tworzeniu konta**: AtakujÄ…cy mogÄ… z wyprzedzeniem utworzyÄ‡ konto, uÅ¼ywajÄ…c e-maila ofiary. JeÅ›li ofiara pÃ³Åºniej uÅ¼yje usÅ‚ugi zewnÄ™trznej do logowania, aplikacja moÅ¼e nieumyÅ›lnie poÅ‚Ä…czyÄ‡ to konto zewnÄ™trzne z wczeÅ›niej utworzonym kontem atakujÄ…cego, prowadzÄ…c do nieautoryzowanego dostÄ™pu.
2. **Wykorzystywanie luÅºnej weryfikacji e-maila w OAuth**: AtakujÄ…cy mogÄ… wykorzystaÄ‡ usÅ‚ugi OAuth, ktÃ³re nie weryfikujÄ… e-maili, rejestrujÄ…c siÄ™ w ich usÅ‚udze, a nastÄ™pnie zmieniajÄ…c e-mail konta na e-mail ofiary. Ta metoda podobnie ryzykuje nieautoryzowany dostÄ™p do konta, podobnie jak w pierwszym scenariuszu, ale przez inny wektor ataku.

### Disclosure of Secrets <a href="#e177" id="e177"></a>

Identyfikacja i ochrona tajnych parametrÃ³w OAuth jest kluczowa. Podczas gdy **`client_id`** moÅ¼e byÄ‡ bezpiecznie ujawniony, ujawnienie **`client_secret`** niesie ze sobÄ… znaczÄ…ce ryzyko. JeÅ›li `client_secret` zostanie skompromitowany, atakujÄ…cy mogÄ… wykorzystaÄ‡ toÅ¼samoÅ›Ä‡ i zaufanie aplikacji do **kradzieÅ¼y `access_tokens` uÅ¼ytkownikÃ³w** i prywatnych informacji.

CzÄ™stÄ… podatnoÅ›ciÄ… jest sytuacja, gdy aplikacje bÅ‚Ä™dnie obsÅ‚ugujÄ… wymianÄ™ kodu autoryzacyjnego (`code`) na `access_token` po stronie klienta zamiast po stronie serwera. Ten bÅ‚Ä…d prowadzi do ujawnienia `client_secret`, umoÅ¼liwiajÄ…c atakujÄ…cym generowanie `access_tokens` pod pozorem aplikacji. Ponadto, poprzez inÅ¼ynieriÄ™ spoÅ‚ecznÄ…, atakujÄ…cy mogÄ… eskalowaÄ‡ uprawnienia, dodajÄ…c dodatkowe zakresy do autoryzacji OAuth, jeszcze bardziej wykorzystujÄ…c zaufany status aplikacji.

### Client Secret Bruteforce

MoÅ¼esz sprÃ³bowaÄ‡ **bruteforce client\_secret** dostawcy usÅ‚ug z dostawcÄ… toÅ¼samoÅ›ci, aby sprÃ³bowaÄ‡ ukraÅ›Ä‡ konta.\
Å»Ä…danie do BF moÅ¼e wyglÄ…daÄ‡ podobnie do:
```
POST /token HTTP/1.1
content-type: application/x-www-form-urlencoded
host: 10.10.10.10:3000
content-length: 135
Connection: close

code=77515&redirect_uri=http%3A%2F%2F10.10.10.10%3A3000%2Fcallback&grant_type=authorization_code&client_id=public_client_id&client_secret=[bruteforce]
```
### Referer Header leaking Code + State

Gdy klient ma **code i state**, jeÅ›li sÄ… one **odzwierciedlone w nagÅ‚Ã³wku Referer** podczas przeglÄ…dania innej strony, to jest podatny.

### Access Token Stored in Browser History

PrzejdÅº do **historii przeglÄ…darki i sprawdÅº, czy access token jest tam zapisany**.

### Everlasting Authorization Code

**Authorization code powinien Å¼yÄ‡ tylko przez pewien czas, aby ograniczyÄ‡ okno czasowe, w ktÃ³rym atakujÄ…cy moÅ¼e go ukraÅ›Ä‡ i uÅ¼yÄ‡**.

### Authorization/Refresh Token not bound to client

JeÅ›li moÅ¼esz uzyskaÄ‡ **authorization code i uÅ¼yÄ‡ go z innym klientem, moÅ¼esz przejÄ…Ä‡ inne konta**.

### Happy Paths, XSS, Iframes & Post Messages to leak code & state values

[**SprawdÅº ten post**](https://labs.detectify.com/writeups/account-hijacking-using-dirty-dancing-in-sign-in-oauth-flows/#gadget-2-xss-on-sandbox-third-party-domain-that-gets-the-url)

### AWS Cognito <a href="#bda5" id="bda5"></a>

W tym raporcie z bug bounty: [**https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/**](https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/) moÅ¼na zobaczyÄ‡, Å¼e **token**, ktÃ³ry **AWS Cognito** zwraca uÅ¼ytkownikowi, moÅ¼e mieÄ‡ **wystarczajÄ…ce uprawnienia do nadpisania danych uÅ¼ytkownika**. Dlatego, jeÅ›li moÅ¼esz **zmieniÄ‡ email uÅ¼ytkownika na inny email**, moÅ¼esz byÄ‡ w stanie **przejÄ…Ä‡** inne konta.
```bash
# Read info of the user
aws cognito-idp get-user --region us-east-1 --access-token eyJraWQiOiJPVj[...]

# Change email address
aws cognito-idp update-user-attributes --region us-east-1 --access-token eyJraWQ[...] --user-attributes Name=email,Value=imaginary@flickr.com
{
"CodeDeliveryDetailsList": [
{
"Destination": "i***@f***.com",
"DeliveryMedium": "EMAIL",
"AttributeName": "email"
}
]
}
```
Aby uzyskaÄ‡ bardziej szczegÃ³Å‚owe informacje na temat wykorzystywania AWS Cognito, sprawdÅº:

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/aws-pentesting/aws-unauthenticated-enum-access/aws-cognito-unauthenticated-enum" %}

### Wykorzystywanie tokenÃ³w innych aplikacji <a href="#bda5" id="bda5"></a>

Jak [**wspomniano w tym artykule**](https://salt.security/blog/oh-auth-abusing-oauth-to-take-over-millions-of-accounts), przepÅ‚ywy OAuth, ktÃ³re oczekujÄ… otrzymania **tokenu** (a nie kodu), mogÄ… byÄ‡ podatne, jeÅ›li nie sprawdzajÄ…, czy token naleÅ¼y do aplikacji.

Dzieje siÄ™ tak, poniewaÅ¼ **atakujÄ…cy** moÅ¼e stworzyÄ‡ **aplikacjÄ™ obsÅ‚ugujÄ…cÄ… OAuth i zalogowaÄ‡ siÄ™ za pomocÄ… Facebooka** (na przykÅ‚ad) w swojej wÅ‚asnej aplikacji. NastÄ™pnie, gdy ofiara zaloguje siÄ™ za pomocÄ… Facebooka w **aplikacji atakujÄ…cego**, atakujÄ…cy moÅ¼e uzyskaÄ‡ **token OAuth uÅ¼ytkownika przyznany jego aplikacji i uÅ¼yÄ‡ go do zalogowania siÄ™ w aplikacji OAuth ofiary, uÅ¼ywajÄ…c tokenu uÅ¼ytkownika ofiary**.

{% hint style="danger" %}
Dlatego, jeÅ›li atakujÄ…cy zdoÅ‚a skÅ‚oniÄ‡ uÅ¼ytkownika do uzyskania dostÄ™pu do swojej wÅ‚asnej aplikacji OAuth, bÄ™dzie mÃ³gÅ‚ przejÄ…Ä‡ konto ofiary w aplikacjach, ktÃ³re oczekujÄ… tokenu i nie sprawdzajÄ…, czy token zostaÅ‚ przyznany ich ID aplikacji.
{% endhint %}

### Dwa linki i cookie <a href="#bda5" id="bda5"></a>

Zgodnie z [**tym artykuÅ‚em**](https://medium.com/@metnew/why-electron-apps-cant-store-your-secrets-confidentially-inspect-option-a49950d6d51f), moÅ¼liwe byÅ‚o skÅ‚onienie ofiary do otwarcia strony z **returnUrl** wskazujÄ…cym na hosta atakujÄ…cego. Ta informacja byÅ‚aby **przechowywana w cookie (RU)** i w **pÃ³Åºniejszym kroku** **prompt** zapyta **uÅ¼ytkownika**, czy chce daÄ‡ dostÄ™p do hosta atakujÄ…cego.

Aby ominÄ…Ä‡ ten prompt, moÅ¼liwe byÅ‚o otwarcie karty, aby zainicjowaÄ‡ **przepÅ‚yw OAuth**, ktÃ³ry ustawiÅ‚by to cookie RU za pomocÄ… **returnUrl**, zamkniÄ™cie karty przed wyÅ›wietleniem promptu i otwarcie nowej karty bez tej wartoÅ›ci. Wtedy **prompt nie poinformuje o hoÅ›cie atakujÄ…cego**, ale cookie bÄ™dzie ustawione na niego, wiÄ™c **token zostanie wysÅ‚any do hosta atakujÄ…cego** w przekierowaniu.

### OminiÄ™cie interakcji z promptem <a href="#bda5" id="bda5"></a>

Jak wyjaÅ›niono w [**tym filmie**](https://www.youtube.com/watch?v=n9x7\_J\_a\_7Q), niektÃ³re implementacje OAuth pozwalajÄ… na wskazanie parametru GET **`prompt`** jako None (**`&prompt=none`**), aby **zapobiec pytaniu uÅ¼ytkownikÃ³w o potwierdzenie** danego dostÄ™pu w promptie na stronie, jeÅ›li sÄ… juÅ¼ zalogowani na platformie.

### response\_mode

Jak [**wyjaÅ›niono w tym filmie**](https://www.youtube.com/watch?v=n9x7\_J\_a\_7Q), moÅ¼liwe jest wskazanie parametru **`response_mode`**, aby okreÅ›liÄ‡, gdzie chcesz, aby kod zostaÅ‚ dostarczony w koÅ„cowym URL:

* `response_mode=query` -> Kod jest dostarczany wewnÄ…trz parametru GET: `?code=2397rf3gu93f`
* `response_mode=fragment` -> Kod jest dostarczany wewnÄ…trz parametru fragmentu URL `#code=2397rf3gu93f`
* `response_mode=form_post` -> Kod jest dostarczany wewnÄ…trz formularza POST z inputem o nazwie `code` i wartoÅ›ciÄ…
* `response_mode=web_message` -> Kod jest wysyÅ‚any w wiadomoÅ›ci post: `window.opener.postMessage({"code": "asdasdasd...`

### Parametry SSRF <a href="#bda5" id="bda5"></a>

[**SprawdÅº to badanie**](https://portswigger.net/research/hidden-oauth-attack-vectors) **dla dalszych szczegÃ³Å‚Ã³w tej techniki.**

Dynamiczna rejestracja klienta w OAuth sÅ‚uÅ¼y jako mniej oczywisty, ale krytyczny wektor dla luk bezpieczeÅ„stwa, szczegÃ³lnie dla atakÃ³w **Server-Side Request Forgery (SSRF)**. Ten endpoint pozwala serwerom OAuth na odbieranie szczegÃ³Å‚Ã³w dotyczÄ…cych aplikacji klienckich, w tym wraÅ¼liwych URL, ktÃ³re mogÄ… byÄ‡ wykorzystane.

**Kluczowe punkty:**

* **Dynamiczna rejestracja klienta** jest czÄ™sto mapowana na `/register` i akceptuje szczegÃ³Å‚y takie jak `client_name`, `client_secret`, `redirect_uris` oraz URL dla logo lub JSON Web Key Sets (JWKs) za pomocÄ… Å¼Ä…daÅ„ POST.
* Ta funkcja przestrzega specyfikacji okreÅ›lonych w **RFC7591** i **OpenID Connect Registration 1.0**, ktÃ³re zawierajÄ… parametry potencjalnie podatne na SSRF.
* Proces rejestracji moÅ¼e nieumyÅ›lnie naraÅ¼aÄ‡ serwery na SSRF na kilka sposobÃ³w:
* **`logo_uri`**: URL dla logo aplikacji klienckiej, ktÃ³ry moÅ¼e byÄ‡ pobrany przez serwer, wywoÅ‚ujÄ…c SSRF lub prowadzÄ…c do XSS, jeÅ›li URL jest niewÅ‚aÅ›ciwie obsÅ‚ugiwany.
* **`jwks_uri`**: URL do dokumentu JWK klienta, ktÃ³ry, jeÅ›li jest zÅ‚oÅ›liwie skonstruowany, moÅ¼e spowodowaÄ‡, Å¼e serwer wykona Å¼Ä…dania wychodzÄ…ce do serwera kontrolowanego przez atakujÄ…cego.
* **`sector_identifier_uri`**: Odnosi siÄ™ do tablicy JSON `redirect_uris`, ktÃ³rÄ… serwer moÅ¼e pobraÄ‡, tworzÄ…c moÅ¼liwoÅ›Ä‡ SSRF.
* **`request_uris`**: Lista dozwolonych URI Å¼Ä…daÅ„ dla klienta, ktÃ³re mogÄ… byÄ‡ wykorzystane, jeÅ›li serwer pobiera te URI na poczÄ…tku procesu autoryzacji.

**Strategia eksploatacji:**

* SSRF moÅ¼na wywoÅ‚aÄ‡, rejestrujÄ…c nowego klienta z zÅ‚oÅ›liwymi URL w parametrach takich jak `logo_uri`, `jwks_uri` lub `sector_identifier_uri`.
* ChociaÅ¼ bezpoÅ›rednia eksploatacja za pomocÄ… `request_uris` moÅ¼e byÄ‡ ograniczona przez kontrole biaÅ‚ej listy, dostarczenie wczeÅ›niej zarejestrowanego, kontrolowanego przez atakujÄ…cego `request_uri` moÅ¼e uÅ‚atwiÄ‡ SSRF podczas fazy autoryzacji.

## Warunki wyÅ›cigu dostawcÃ³w OAuth

JeÅ›li platforma, ktÃ³rÄ… testujesz, jest dostawcÄ… OAuth, [**przeczytaj to, aby przetestowaÄ‡ moÅ¼liwe warunki wyÅ›cigu**](race-condition.md).

## Referencje

* [**https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1**](https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1)
* [**https://portswigger.net/research/hidden-oauth-attack-vectors**](https://portswigger.net/research/hidden-oauth-attack-vectors)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>Naucz siÄ™ hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w PDF** SprawdÅº [**PLANY SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi trikami hakerskimi, przesyÅ‚ajÄ…c PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
