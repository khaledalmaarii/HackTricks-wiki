# OAuth ile Hesap Ele GeÃ§irme

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na (https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks ve HackTricks Cloud** github depolarÄ±na PR'lar gÃ¶ndererek paylaÅŸÄ±n.

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Temel Bilgiler <a href="#d4a8" id="d4a8"></a>

OAuth, [OAuth 2.0 belgelerinde](https://oauth.net/2/) eriÅŸilebilir temel bilgilerle birlikte Ã§eÅŸitli sÃ¼rÃ¼mler sunar. Bu tartÄ±ÅŸma genellikle yaygÄ±n olarak kullanÄ±lan [OAuth 2.0 yetkilendirme kodu tahsis tÃ¼rÃ¼](https://oauth.net/2/grant-types/authorization-code/) Ã¼zerinde odaklanÄ±r, bir **uygulamanÄ±n baÅŸka bir uygulamadaki bir kullanÄ±cÄ±nÄ±n hesabÄ±na eriÅŸmesine veya iÅŸlem yapmasÄ±na olanak tanÄ±yan bir yetkilendirme Ã§erÃ§evesi** saÄŸlar (yetkilendirme sunucusu).

Hayali bir web sitesini dÃ¼ÅŸÃ¼nÃ¼n _**https://ornek.com**_, tÃ¼m sosyal medya gÃ¶nderilerinizi, Ã¶zel olanlarÄ± da dahil olmak Ã¼zere **sergilemek iÃ§in tasarlanmÄ±ÅŸtÄ±r**. Bunu baÅŸarmak iÃ§in OAuth 2.0 kullanÄ±lÄ±r. _https://ornek.com_, **sosyal medya gÃ¶nderilerinize eriÅŸim izni** isteyecektir. SonuÃ§ olarak, _https://sosyalmedya.com_ Ã¼zerinde bir onay ekranÄ± belirecek ve **istenen izinler ve istekte bulunan geliÅŸtirici** belirtilecektir. OnayÄ±nÄ±zÄ±n ardÄ±ndan, _https://ornek.com_, **gÃ¶nderilerinize sizin adÄ±nÄ±za eriÅŸme yeteneÄŸi kazanÄ±r**.

OAuth 2.0 Ã§erÃ§evesi iÃ§inde aÅŸaÄŸÄ±daki bileÅŸenleri anlamanÄ±z Ã¶nemlidir:

- **kaynak sahibi**: Siz, **kullanÄ±cÄ±/Ã¶ÄŸe** olarak, sosyal medya hesabÄ±nÄ±zÄ±n gÃ¶nderilerine eriÅŸim izni verirsiniz.
- **kaynak sunucusu**: Uygulama, `kaynak sahibi` adÄ±na bir `eriÅŸim belirteci` aldÄ±ktan sonra kimlik doÄŸrulamasÄ± yapÄ±lan istekleri yÃ¶neten **sunucu**, Ã¶rneÄŸin **https://sosyalmedya.com**.
- **istemci uygulamasÄ±**: `kaynak sahibi`nden yetki isteyen **uygulama**, Ã¶rneÄŸin **https://ornek.com**.
- **yetkilendirme sunucusu**: `kaynak sahibi`nin baÅŸarÄ±lÄ± kimlik doÄŸrulamasÄ±nÄ± ve yetkilendirmeyi saÄŸladÄ±ktan sonra `istemci uygulamasÄ±na eriÅŸim belirteÃ§leri` veren **sunucu**, Ã¶rneÄŸin **https://sosyalmedya.com**.
- **client\_id**: Uygulama iÃ§in genel, benzersiz bir tanÄ±mlayÄ±cÄ±.
- **client\_secret:** YalnÄ±zca uygulama ve yetkilendirme sunucusu tarafÄ±ndan bilinen gizli bir anahtar, `eriÅŸim belirteÃ§leri` oluÅŸturmak iÃ§in kullanÄ±lÄ±r.
- **response\_type**: Ä°stenen **token tÃ¼rÃ¼nÃ¼ belirten** bir deÄŸer, Ã¶rneÄŸin `code`.
- **scope**: `istemci uygulamasÄ±nÄ±n` `kaynak sahibinden` istediÄŸi **eriÅŸim dÃ¼zeyi**.
- **redirect\_uri**: Yetkilendirme sonrasÄ± kullanÄ±cÄ±nÄ±n yÃ¶nlendirileceÄŸi **URL**. Genellikle Ã¶nceden kayÄ±tlÄ± yÃ¶nlendirme URL'siyle uyumlu olmalÄ±dÄ±r.
- **state**: KullanÄ±cÄ±nÄ±n yetkilendirme sunucusuna yÃ¶nlendirilmesi ve oradan geri dÃ¶nmesi sÄ±rasÄ±nda verileri **saklamak iÃ§in bir parametre**. BenzersizliÄŸi, **CSRF koruma mekanizmasÄ±** olarak hizmet etmesi iÃ§in Ã¶nemlidir.
- **grant\_type**: **Tahsis tÃ¼rÃ¼nÃ¼ ve dÃ¶ndÃ¼rÃ¼lecek token tÃ¼rÃ¼nÃ¼ belirten** bir parametre.
- **code**: `yetkilendirme sunucusundan` alÄ±nan yetkilendirme kodu, `istemci uygulamasÄ±` tarafÄ±ndan `client_id` ve `client_secret` ile birlikte kullanÄ±larak bir `eriÅŸim belirteci` almak iÃ§in kullanÄ±lÄ±r.
- **access\_token**: `istemci uygulamasÄ±nÄ±n` API isteklerinde kullanacaÄŸÄ± **token** `kaynak sahibi` adÄ±na.
- **refresh\_token**: UygulamanÄ±n **kullanÄ±cÄ±ya tekrar soru sormadan yeni bir `eriÅŸim belirteci` almasÄ±nÄ± saÄŸlar**.

### AkÄ±ÅŸ

**GerÃ§ek OAuth akÄ±ÅŸÄ±** ÅŸu ÅŸekilde devam eder:

1. [https://ornek.com](https://ornek.com) adresine giderek "Sosyal Medya ile Entegre Ol" dÃ¼ÄŸmesini seÃ§ersiniz.
2. Site daha sonra, https://ornek.com'un uygulamasÄ±nÄ±n gÃ¶nderilerinize eriÅŸmesine izin vermeniz iÃ§in [https://sosyalmedya.com](https://sosyalmedya.com) adresine bir istek gÃ¶nderir. Ä°stek ÅŸu ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r:
```
https://socialmedia.com/auth
?response_type=code
&client_id=example_clientId
&redirect_uri=https%3A%2F%2Fexample.com%2Fcallback
&scope=readPosts
&state=randomString123
```
3. ArdÄ±ndan bir onay sayfasÄ± ile karÅŸÄ±laÅŸÄ±rsÄ±nÄ±z.

4. OnayÄ±nÄ±zÄ± takiben, Sosyal Medya, `redirect_uri`'ye `code` ve `state` parametreleri ile bir yanÄ±t gÃ¶nderir:
```
https://example.com?code=uniqueCode123&state=randomString123
```
5. https://example.com, sizin adÄ±nÄ±za bir `access_token` almak iÃ§in bu `code`'u, birlikte `client_id` ve `client_secret`'Ä±nÄ± kullanÄ±r, bÃ¶ylece sizin onayladÄ±ÄŸÄ±nÄ±z izinlere eriÅŸim saÄŸlar:
```
POST /oauth/access_token
Host: socialmedia.com
...{"client_id": "example_clientId", "client_secret": "example_clientSecret", "code": "uniqueCode123", "grant_type": "authorization_code"}
```
6. Son olarak, iÅŸlem https://example.com'un `access_token`'Ä±nÄ± kullanarak bir API Ã§aÄŸrÄ±sÄ± yaparak Sosyal Medya'ya eriÅŸir.

## ZayÄ±flÄ±klar <a href="#323a" id="323a"></a>

### AÃ§Ä±k redirect\_uri <a href="#cc36" id="cc36"></a>

`redirect_uri`, OAuth ve OpenID uygulamalarÄ±nda gÃ¼venlik aÃ§Ä±sÄ±ndan Ã¶nemlidir, Ã§Ã¼nkÃ¼ hassas verileri, Ã¶rneÄŸin yetkilendirme kodlarÄ±nÄ±, yetkilendirme sonrasÄ± nereye gÃ¶nderileceÄŸini yÃ¶nlendirir. YanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸsa, saldÄ±rganlarÄ±n bu istekleri kÃ¶tÃ¼ amaÃ§lÄ± sunuculara yÃ¶nlendirmesine izin vererek hesap ele geÃ§irmelerine olanak tanÄ±yabilir.

SÃ¶mÃ¼rÃ¼ teknikleri, yetkilendirme sunucusunun doÄŸrulama mantÄ±ÄŸÄ±na baÄŸlÄ± olarak deÄŸiÅŸir. Bunlar, katÄ± yol eÅŸleÅŸtirmesinden belirli etki alanÄ± veya alt dizindeki herhangi bir URL'yi kabul etmeye kadar uzanabilir. YaygÄ±n sÃ¶mÃ¼rÃ¼ yÃ¶ntemleri arasÄ±nda aÃ§Ä±k yÃ¶nlendirmeler, yol geÃ§iÅŸi, zayÄ±f regexlerin sÃ¶mÃ¼rÃ¼lmesi ve belirteÃ§ hÄ±rsÄ±zlÄ±ÄŸÄ± iÃ§in HTML enjeksiyonu bulunur.

`redirect_uri` dÄ±ÅŸÄ±nda, `client_uri`, `policy_uri`, `tos_uri` ve `initiate_login_uri` gibi diÄŸer OAuth ve OpenID parametreleri de yÃ¶nlendirme saldÄ±rÄ±larÄ±na duyarlÄ±dÄ±r. Bu parametreler isteÄŸe baÄŸlÄ±dÄ±r ve destekleri sunucular arasÄ±nda deÄŸiÅŸir.

Bir OpenID sunucusunu hedefleyenler iÃ§in keÅŸif ucu noktasÄ± (`**.well-known/openid-configuration**`), genellikle `registration_endpoint`, `request_uri_parameter_supported` ve "`require_request_uri_registration` gibi deÄŸerli yapÄ±landÄ±rma ayrÄ±ntÄ±larÄ±nÄ± listeleyebilir. Bu ayrÄ±ntÄ±lar, kayÄ±t ucu noktasÄ±nÄ± ve sunucunun diÄŸer yapÄ±landÄ±rma ayrÄ±ntÄ±larÄ±nÄ± tanÄ±mlamada yardÄ±mcÄ± olabilir.

### YÃ¶nlendirme uygulamasÄ±ndaki XSS <a href="#bda5" id="bda5"></a>

Bu hata Ã¶dÃ¼lÃ¼ raporunda belirtildiÄŸi gibi [https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html](https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html) muhtemelen yÃ¶nlendirme **URL'sinin**, kullanÄ±cÄ± kimlik doÄŸrulamasÄ±ndan sonra sunucunun yanÄ±tÄ±nda **yansÄ±tÄ±ldÄ±ÄŸÄ±** ve **XSS'ye duyarlÄ±** olduÄŸu mÃ¼mkÃ¼ndÃ¼r. Test etmek iÃ§in olasÄ± yÃ¼k:
```
https://app.victim.com/login?redirectUrl=https://app.victim.com/dashboard</script><h1>test</h1>
```
### CSRF - Durum parametresinin yanlÄ±ÅŸ iÅŸlenmesi <a href="#bda5" id="bda5"></a>

OAuth uygulamalarÄ±nda, **`state` parametresinin** yanlÄ±ÅŸ kullanÄ±mÄ± veya ihmal edilmesi, **Cross-Site Request Forgery (CSRF)** saldÄ±rÄ±larÄ±nÄ±n riskini Ã¶nemli Ã¶lÃ§Ã¼de artÄ±rabilir. Bu zafiyet, `state` parametresinin ya **kullanÄ±lmamasÄ±, sabit bir deÄŸer olarak kullanÄ±lmasÄ± veya doÄŸru ÅŸekilde doÄŸrulanmamasÄ±** durumunda ortaya Ã§Ä±kar ve saldÄ±rganlarÄ±n CSRF korumalarÄ±nÄ± atlamasÄ±na izin verir.

SaldÄ±rganlar, yetkilendirme sÃ¼recini ele geÃ§irerek kendi hesaplarÄ±nÄ± bir kurbanÄ±n hesabÄ±yla baÄŸlayarak potansiyel **hesap ele geÃ§irmelerine** yol aÃ§abilir. Bu Ã¶zellikle OAuth'nin **kimlik doÄŸrulama amaÃ§lÄ±** kullanÄ±ldÄ±ÄŸÄ± uygulamalarda kritiktir.

Bu zafiyetin gerÃ§ek dÃ¼nya Ã¶rnekleri Ã§eÅŸitli **CTF meydan okumalarÄ±nda** ve **hacking platformlarÄ±nda** belgelenmiÅŸ ve pratik sonuÃ§larÄ±nÄ± vurgulamÄ±ÅŸtÄ±r. Sorun, **Slack**, **Stripe** ve **PayPal** gibi Ã¼Ã§Ã¼ncÃ¼ taraf hizmetlerle entegrasyonlara da uzanÄ±r, burada saldÄ±rganlar bildirimleri veya Ã¶demeleri kendi hesaplarÄ±na yÃ¶nlendirebilirler.

**`state` parametresinin** doÄŸru ÅŸekilde iÅŸlenmesi ve doÄŸrulanmasÄ±, CSRF'ye karÅŸÄ± korunma ve OAuth akÄ±ÅŸÄ±nÄ± gÃ¼vence altÄ±na alma aÃ§Ä±sÄ±ndan hayati Ã¶neme sahiptir.

### Hesap Ele GeÃ§irme Ã–ncesi <a href="#ebe4" id="ebe4"></a>

1. **Hesap OluÅŸtururken E-posta DoÄŸrulamasÄ± Olmadan**: SaldÄ±rganlar, kurbanÄ±n e-postasÄ±nÄ± kullanarak Ã¶nceden bir hesap oluÅŸturabilirler. Kurban daha sonra giriÅŸ yapmak iÃ§in Ã¼Ã§Ã¼ncÃ¼ taraf bir hizmet kullanÄ±rsa, uygulama bu Ã¼Ã§Ã¼ncÃ¼ taraf hesabÄ±nÄ± yanlÄ±ÅŸlÄ±kla saldÄ±rganÄ±n Ã¶nceden oluÅŸturulan hesabÄ±na baÄŸlayabilir ve yetkisiz eriÅŸime yol aÃ§abilir.

2. **GeÃ§erli Olmayan OAuth E-posta DoÄŸrulamasÄ±nÄ± SÃ¶mÃ¼rme**: SaldÄ±rganlar, e-postalarÄ± doÄŸrulamayan OAuth hizmetlerini sÃ¶mÃ¼rebilir ve kendi servislerine kaydolup ardÄ±ndan hesap e-postasÄ±nÄ± kurbanÄ±n e-postasÄ±yla deÄŸiÅŸtirebilirler. Bu yÃ¶ntem, ilk senaryoya benzer ÅŸekilde yetkisiz hesap eriÅŸimine ve farklÄ± bir saldÄ±rÄ± vektÃ¶rÃ¼ aracÄ±lÄ±ÄŸÄ±yla risk oluÅŸturur.

### SÄ±rlarÄ±n AÃ§Ä±klanmasÄ± <a href="#e177" id="e177"></a>

Gizli OAuth parametrelerini tanÄ±mlamak ve korumak hayati Ã¶nem taÅŸÄ±r. **`client_id`** gÃ¼venle aÃ§Ä±klanabilirken, **`client_secret`**'in ifÅŸa edilmesi Ã¶nemli riskler oluÅŸturur. EÄŸer `client_secret` tehlikeye atÄ±lÄ±rsa, saldÄ±rganlar uygulamanÄ±n kimliÄŸini ve gÃ¼venini sÃ¶mÃ¼rerek kullanÄ±cÄ± `access_token`'larÄ±nÄ± ve Ã¶zel bilgileri **Ã§alabilirler**.

YaygÄ±n bir zafiyet, uygulamalarÄ±n yetkilendirme `code`'unun `access_token` karÅŸÄ±lÄ±ÄŸÄ±nÄ± sunucu tarafÄ±nda deÄŸil istemci tarafÄ±nda yanlÄ±ÅŸ ÅŸekilde iÅŸlemesinden kaynaklanÄ±r. Bu hata, `client_secret`'in aÃ§Ä±ÄŸa Ã§Ä±kmasÄ±na yol aÃ§ar ve saldÄ±rganlarÄ±n uygulama adÄ±na `access_token`'lar oluÅŸturmasÄ±na olanak tanÄ±r. DahasÄ±, sosyal mÃ¼hendislik aracÄ±lÄ±ÄŸÄ±yla saldÄ±rganlar, OAuth yetkilendirmesine ek kapsamlar ekleyerek ayrÄ±calÄ±klarÄ± artÄ±rabilir ve uygulamanÄ±n gÃ¼venilir durumunu daha da kÃ¶tÃ¼ye kullanabilirler.

### Ä°stemci SÄ±rrÄ± Kaba Kuvvet SaldÄ±rÄ±sÄ±

Kimlik saÄŸlayÄ±cÄ± ile hizmet saÄŸlayÄ±cÄ±sÄ±nÄ±n **client\_secret**'ini **kaba kuvvet saldÄ±rÄ±sÄ±** ile deneyebilirsiniz, bÃ¶ylece hesaplarÄ± Ã§almaya Ã§alÄ±ÅŸabilirsiniz.\
BF'ye yÃ¶nelik istek benzer olabilir:
```
POST /token HTTP/1.1
content-type: application/x-www-form-urlencoded
host: 10.10.10.10:3000
content-length: 135
Connection: close

code=77515&redirect_uri=http%3A%2F%2F10.10.10.10%3A3000%2Fcallback&grant_type=authorization_code&client_id=public_client_id&client_secret=[bruteforce]
```
### Referer Header sÄ±zdÄ±ran Code + State

MÃ¼ÅŸteri **koda ve state'e** sahip olduktan sonra, farklÄ± bir sayfaya gÃ¶z attÄ±ÄŸÄ±nda **Referer baÅŸlÄ±ÄŸÄ±nda yansÄ±tÄ±lÄ±yorsa**, zayÄ±f bir durumdadÄ±r.

### EriÅŸim Belirteci TarayÄ±cÄ± GeÃ§miÅŸinde SaklanÄ±yor

TarayÄ±cÄ± geÃ§miÅŸine gidin ve **eriÅŸim belirtecinin orada kaydedilip kaydedilmediÄŸini kontrol edin**.

### Sonsuz Yetkilendirme Kodu

**Yetkilendirme kodu, saldÄ±rganÄ±n Ã§alÄ±p kullanabileceÄŸi zaman penceresini sÄ±nÄ±rlamak iÃ§in sadece belirli bir sÃ¼re yaÅŸamalÄ±dÄ±r**.

### Yetkilendirme/Yenileme Belirteci mÃ¼ÅŸteriye baÄŸlÄ± deÄŸil

EÄŸer **yetkilendirme kodunu alabilir ve farklÄ± bir mÃ¼ÅŸteriyle kullanabilirseniz, diÄŸer hesaplarÄ± ele geÃ§irebilirsiniz**.

### Mutlu Yollar, XSS, Ä°frame'ler ve Kodu ve state deÄŸerlerini sÄ±zdÄ±rmak iÃ§in Post MesajlarÄ±

**[Bu yazÄ±yÄ± kontrol edin](https://labs.detectify.com/writeups/account-hijacking-using-dirty-dancing-in-sign-in-oauth-flows/#gadget-2-xss-on-sandbox-third-party-domain-that-gets-the-url)**

### AWS Cognito <a href="#bda5" id="bda5"></a>

Bu hata Ã¶dÃ¼lÃ¼ raporunda: [**https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/**](https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/) gÃ¶rebilirsiniz ki **AWS Cognito**'nun kullanÄ±cÄ±ya geri verdiÄŸi **belirtecin**, **kullanÄ±cÄ± verilerini Ã¼zerine yazma iznine sahip olabileceÄŸini**. Bu nedenle, **farklÄ± bir kullanÄ±cÄ± e-postasÄ± iÃ§in kullanÄ±cÄ± e-postasÄ±nÄ± deÄŸiÅŸtirebilirseniz**, baÅŸkalarÄ±nÄ±n hesaplarÄ±nÄ± **ele geÃ§irebilirsiniz**.
```bash
# Read info of the user
aws cognito-idp get-user --region us-east-1 --access-token eyJraWQiOiJPVj[...]

# Change email address
aws cognito-idp update-user-attributes --region us-east-1 --access-token eyJraWQ[...] --user-attributes Name=email,Value=imaginary@flickr.com
{
"CodeDeliveryDetailsList": [
{
"Destination": "i***@f***.com",
"DeliveryMedium": "EMAIL",
"AttributeName": "email"
}
]
}
```
AWS Cognito'yu kÃ¶tÃ¼ye kullanma hakkÄ±nda daha detaylÄ± bilgi iÃ§in ÅŸu linke bakabilirsiniz:

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/aws-pentesting/aws-unauthenticated-enum-access/aws-cognito-unauthenticated-enum" %}

### DiÄŸer UygulamalarÄ±n Token'larÄ±nÄ±n KÃ¶tÃ¼ye KullanÄ±lmasÄ± <a href="#bda5" id="bda5"></a>

[**Bu yazÄ±da belirtildiÄŸi gibi**](https://salt.security/blog/oh-auth-abusing-oauth-to-take-over-millions-of-accounts), **token** (ve bir kod deÄŸil) bekleyen OAuth akÄ±ÅŸlarÄ±, token'Ä±n uygulamaya ait olup olmadÄ±ÄŸÄ±nÄ± kontrol etmezse zayÄ±f olabilir.

Bu, Ã§Ã¼nkÃ¼ bir **saldÄ±rgan**, kendi uygulamasÄ±nda **OAuth'yi destekleyen ve Facebook ile giriÅŸ yapabilen bir uygulama oluÅŸturabilir**. ArdÄ±ndan, bir kurbanÄ±n Facebook'ta **saldÄ±rganÄ±n uygulamasÄ±nda oturum aÃ§tÄ±ÄŸÄ±nda**, saldÄ±rgan, **kurbanÄ±n OAuth uygulamasÄ±nda verilen kullanÄ±cÄ± token'Ä±nÄ± alabilir ve kurbanÄ±n kullanÄ±cÄ± token'Ä±nÄ± kullanarak kurbanÄ±n OAuth uygulamasÄ±na giriÅŸ yapabilir**.

{% hint style="danger" %}
Bu nedenle, saldÄ±rgan, kullanÄ±cÄ±nÄ±n kendi OAuth uygulamasÄ±na eriÅŸmesini saÄŸlarsa, token'Ä±n verildiÄŸi uygulama kimliÄŸine bakÄ±lmadan bir token bekleyen ve token'Ä±n uygulama kimliÄŸine verilip verilmediÄŸini kontrol etmeyen uygulamalarda kurbanÄ±n hesabÄ±nÄ± ele geÃ§irebilecektir.
{% endhint %}

### Ä°ki baÄŸlantÄ± ve Ã§erez <a href="#bda5" id="bda5"></a>

[**Bu yazÄ±da belirtildiÄŸi gibi**](https://medium.com/@metnew/why-electron-apps-cant-store-your-secrets-confidentially-inspect-option-a49950d6d51f), bir kurbanÄ±n bir **returnUrl** ile saldÄ±rganÄ±n ana bilgisayarÄ±nÄ± iÅŸaret eden bir sayfayÄ± aÃ§masÄ±nÄ±n mÃ¼mkÃ¼n olduÄŸu belirtildi. Bu bilgi bir **Ã§erezde (RU)** saklanacak ve **daha sonra** **prompt**, **kullanÄ±cÄ±ya** o saldÄ±rganÄ±n ana bilgisayarÄ±na eriÅŸim vermek isteyip istemediÄŸini **soracaktÄ±r**.

Bu prompt'u atlamak iÃ§in, **returnUrl**'yi kullanan **Oauth akÄ±ÅŸÄ±nÄ± baÅŸlatan** bir sekme aÃ§mak, prompt gÃ¶sterilmeden Ã¶nce sekme kapatmak ve bu deÄŸeri olmadan yeni bir sekme aÃ§mak mÃ¼mkÃ¼ndÃ¼. ArdÄ±ndan, **prompt, saldÄ±rganÄ±n ana bilgisayarÄ±ndan bahsetmeyecek**, ancak Ã§erez ona ayarlanacak, bÃ¶ylece yÃ¶nlendirmede **token saldÄ±rganÄ±n ana bilgisayarÄ±na gÃ¶nderilecektir**.

### SSRF parametreleri <a href="#bda5" id="bda5"></a>

Bu tekniÄŸin daha ayrÄ±ntÄ±lÄ± bilgileri iÃ§in **[bu araÅŸtÄ±rmayÄ± kontrol edin](https://portswigger.net/research/hidden-oauth-attack-vectors)**.

OAuth'da Dinamik Ä°stemci KaydÄ±, Ã¶zellikle **Sunucu TarafÄ± Ä°stek SahtekarlÄ±ÄŸÄ± (SSRF)** saldÄ±rÄ±larÄ± iÃ§in daha az aÃ§Ä±k ama kritik bir vektÃ¶r olarak hizmet verir. Bu uÃ§ nokta, OAuth sunucularÄ±nÄ±n, hassas URL'leri de iÃ§eren istemci uygulamalarÄ± hakkÄ±nda ayrÄ±ntÄ±lar almasÄ±nÄ± saÄŸlar ve bu URL'lerin kÃ¶tÃ¼ye kullanÄ±lmasÄ±na neden olabilir.

**Ana Noktalar:**

- **Dinamik Ä°stemci KaydÄ±** genellikle `/register` ile eÅŸleÅŸtirilir ve `client_name`, `client_secret`, `redirect_uris` ve POST istekleri aracÄ±lÄ±ÄŸÄ±yla logolar veya JSON Web Anahtar KÃ¼mesi (JWK'ler) iÃ§in URL'ler gibi ayrÄ±ntÄ±larÄ± kabul eder.
- Bu Ã¶zellik, **RFC7591** ve **OpenID Connect Registration 1.0** tarafÄ±ndan belirlenen Ã¶zelliklere uyar ve SSRF'ye duyarlÄ± olabilecek parametreleri iÃ§erir.
- KayÄ±t sÃ¼reci, sunucularÄ± yanlÄ±ÅŸlÄ±kla SSRF'ye maruz bÄ±rakabilir:
- **`logo_uri`**: Sunucu tarafÄ±ndan alÄ±nabilecek istemci uygulamasÄ±nÄ±n logosu iÃ§in bir URL, SSRF'yi tetikleyebilir veya URL yanlÄ±ÅŸ iÅŸlenirse XSS'e yol aÃ§abilir.
- **`jwks_uri`**: Ä°stemcinin JWK belgesine bir URL, kÃ¶tÃ¼ amaÃ§lÄ± olarak oluÅŸturulursa, sunucunun saldÄ±rganÄ±n kontrol ettiÄŸi bir sunucuya Ã§Ä±kÄ±ÅŸ istekleri yapmasÄ±na neden olabilir.
- **`sector_identifier_uri`**: Sunucunun alabileceÄŸi `redirect_uris` JSON dizisine referans verir, bu da sunucunun SSRF fÄ±rsatÄ± yaratabilir.
- **`request_uris`**: Ä°stemci iÃ§in izin verilen istek URI'lerini listeler, bu URI'lerin yetkilendirme sÃ¼recinin baÅŸÄ±nda sunucu tarafÄ±ndan alÄ±nmasÄ± durumunda kÃ¶tÃ¼ye kullanÄ±labilir.

**SÃ¶mÃ¼rÃ¼ Stratejisi:**

- SSRF, `logo_uri`, `jwks_uri` veya `sector_identifier_uri` gibi parametrelerde kÃ¶tÃ¼ amaÃ§lÄ± URL'lerle yeni bir istemci kaydedilerek tetiklenebilir.
- DoÄŸrudan `request_uris` Ã¼zerinden sÃ¶mÃ¼rÃ¼ belki de beyaz liste kontrolleri ile azaltÄ±labilir, ancak Ã¶nceden kaydedilmiÅŸ, saldÄ±rgan tarafÄ±ndan kontrol edilen bir `request_uri` saÄŸlamak, yetkilendirme aÅŸamasÄ±nda SSRF'yi kolaylaÅŸtÄ±rabilir.

## OAuth SaÄŸlayÄ±cÄ±larÄ± YarÄ±ÅŸ KoÅŸullarÄ±

Test ettiÄŸiniz platform bir OAuth saÄŸlayÄ±cÄ±sÄ± ise, olasÄ± YarÄ±ÅŸ KoÅŸullarÄ±nÄ± test etmek iÃ§in [**bunu okuyun**](race-condition.md).

## Referanslar

* [**https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1**](https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1)
* [**https://portswigger.net/research/hidden-oauth-attack-vectors**](https://portswigger.net/research/hidden-oauth-attack-vectors)


<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme hakkÄ±nda Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Family'yi keÅŸfedin**](https://opensea.io/collection/the-peass-family), Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek destekleyin.**

</details>
