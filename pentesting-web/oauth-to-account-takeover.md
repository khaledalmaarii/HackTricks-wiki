# OAuth do przejÄ™cia konta

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Podstawowe informacje <a href="#d4a8" id="d4a8"></a>

OAuth oferuje rÃ³Å¼ne wersje, z podstawowymi informacjami dostÄ™pnymi w [dokumentacji OAuth 2.0](https://oauth.net/2/). Ta dyskusja koncentruje siÄ™ gÅ‚Ã³wnie na szeroko stosowanym [typie przyznawania kodu autoryzacji OAuth 2.0](https://oauth.net/2/grant-types/authorization-code/), zapewniajÄ…c **ramy autoryzacji, ktÃ³re umoÅ¼liwiajÄ… aplikacji dostÄ™p do konta uÅ¼ytkownika w innej aplikacji lub wykonywanie dziaÅ‚aÅ„ w jego imieniu** (serwer autoryzacji).

RozwaÅ¼my hipotetycznÄ… stronÄ™ _**https://example.com**_, zaprojektowanÄ… do **prezentacji wszystkich twoich postÃ³w w mediach spoÅ‚ecznoÅ›ciowych**, w tym prywatnych. Aby to osiÄ…gnÄ…Ä‡, wykorzystuje siÄ™ OAuth 2.0. _https://example.com_ poprosi o twojÄ… zgodÄ™ na **dostÄ™p do twoich postÃ³w w mediach spoÅ‚ecznoÅ›ciowych**. W konsekwencji na _https://socialmedia.com_ pojawi siÄ™ ekran zgody, przedstawiajÄ…cy **Å¼Ä…dane uprawnienia oraz dewelopera skÅ‚adajÄ…cego wniosek**. Po twojej autoryzacji, _https://example.com_ zyskuje moÅ¼liwoÅ›Ä‡ **dostÄ™pu do twoich postÃ³w w twoim imieniu**.

WaÅ¼ne jest, aby zrozumieÄ‡ nastÄ™pujÄ…ce elementy w ramach OAuth 2.0:

* **wÅ‚aÅ›ciciel zasobu**: Ty, jako **uÅ¼ytkownik/podmiot**, autoryzujesz dostÄ™p do swojego zasobu, jak posty na twoim koncie w mediach spoÅ‚ecznoÅ›ciowych.
* **serwer zasobÃ³w**: **serwer zarzÄ…dzajÄ…cy uwierzytelnionymi Å¼Ä…daniami** po tym, jak aplikacja uzyskaÅ‚a `access token` w imieniu `wÅ‚aÅ›ciciela zasobu`, np. **https://socialmedia.com**.
* **aplikacja kliencka**: **aplikacja ubiegajÄ…ca siÄ™ o autoryzacjÄ™** od `wÅ‚aÅ›ciciela zasobu`, taka jak **https://example.com**.
* **serwer autoryzacji**: **serwer, ktÃ³ry wydaje `access tokens`** dla `aplikacji klienckiej` po pomyÅ›lnej autoryzacji `wÅ‚aÅ›ciciela zasobu`, np. **https://socialmedia.com**.
* **client\_id**: Publiczny, unikalny identyfikator aplikacji.
* **client\_secret:** Poufny klucz, znany tylko aplikacji i serwerowi autoryzacji, uÅ¼ywany do generowania `access_tokens`.
* **response\_type**: WartoÅ›Ä‡ okreÅ›lajÄ…ca **typ Å¼Ä…danego tokena**, jak `code`.
* **scope**: **poziom dostÄ™pu**, o ktÃ³ry `aplikacja kliencka` prosi `wÅ‚aÅ›ciciela zasobu`.
* **redirect\_uri**: **URL, na ktÃ³ry uÅ¼ytkownik jest przekierowywany po autoryzacji**. Zazwyczaj musi byÄ‡ zgodny z wczeÅ›niej zarejestrowanym URL przekierowania.
* **state**: Parametr do **utrzymywania danych podczas przekierowania uÅ¼ytkownika do i z serwera autoryzacji**. Jego unikalnoÅ›Ä‡ jest kluczowa jako **mechanizm ochrony przed CSRF**.
* **grant\_type**: Parametr wskazujÄ…cy **typ przyznania i typ tokena do zwrÃ³cenia**.
* **code**: Kod autoryzacji z `serwera autoryzacji`, uÅ¼ywany razem z `client_id` i `client_secret` przez aplikacjÄ™ klienckÄ… do uzyskania `access_token`.
* **access\_token**: **token, ktÃ³rego aplikacja kliencka uÅ¼ywa do Å¼Ä…daÅ„ API** w imieniu `wÅ‚aÅ›ciciela zasobu`.
* **refresh\_token**: UmoÅ¼liwia aplikacji **uzyskanie nowego `access_token` bez ponownego pytania uÅ¼ytkownika**.

### PrzepÅ‚yw

**Rzeczywisty przepÅ‚yw OAuth** przebiega nastÄ™pujÄ…co:

1. Przechodzisz do [https://example.com](https://example.com) i wybierasz przycisk â€Integruj z mediami spoÅ‚ecznoÅ›ciowymiâ€.
2. Strona nastÄ™pnie wysyÅ‚a Å¼Ä…danie do [https://socialmedia.com](https://socialmedia.com) z proÅ›bÄ… o twojÄ… autoryzacjÄ™, aby aplikacja https://example.com mogÅ‚a uzyskaÄ‡ dostÄ™p do twoich postÃ³w. Å»Ä…danie jest skonstruowane jako:
```
https://socialmedia.com/auth
?response_type=code
&client_id=example_clientId
&redirect_uri=https%3A%2F%2Fexample.com%2Fcallback
&scope=readPosts
&state=randomString123
```
3. NastÄ™pnie zostaniesz przedstawiony stronie zgody.  
4. Po twojej akceptacji, Social Media wysyÅ‚a odpowiedÅº do `redirect_uri` z parametrami `code` i `state`:
```
https://example.com?code=uniqueCode123&state=randomString123
```
5. https://example.com wykorzystuje ten `code`, razem z jego `client_id` i `client_secret`, aby zrealizowaÄ‡ Å¼Ä…danie po stronie serwera w celu uzyskania `access_token` w Twoim imieniu, umoÅ¼liwiajÄ…c dostÄ™p do uprawnieÅ„, na ktÃ³re wyraziÅ‚eÅ› zgodÄ™:
```
POST /oauth/access_token
Host: socialmedia.com
...{"client_id": "example_clientId", "client_secret": "example_clientSecret", "code": "uniqueCode123", "grant_type": "authorization_code"}
```
6. Na koniec proces koÅ„czy siÄ™, gdy https://example.com wykorzystuje twÃ³j `access_token`, aby wykonaÄ‡ wywoÅ‚anie API do Social Media w celu uzyskania dostÄ™pu

## Luki <a href="#id-323a" id="id-323a"></a>

### Otwarty redirect\_uri <a href="#cc36" id="cc36"></a>

`redirect_uri` jest kluczowy dla bezpieczeÅ„stwa w implementacjach OAuth i OpenID, poniewaÅ¼ kieruje, gdzie wraÅ¼liwe dane, takie jak kody autoryzacji, sÄ… wysyÅ‚ane po autoryzacji. JeÅ›li jest Åºle skonfigurowany, moÅ¼e pozwoliÄ‡ atakujÄ…cym na przekierowanie tych Å¼Ä…daÅ„ do zÅ‚oÅ›liwych serwerÃ³w, co umoÅ¼liwia przejÄ™cie konta.

Techniki eksploatacji rÃ³Å¼niÄ… siÄ™ w zaleÅ¼noÅ›ci od logiki walidacji serwera autoryzacji. MogÄ… obejmowaÄ‡ od Å›cisÅ‚ego dopasowania Å›cieÅ¼ek do akceptowania dowolnego URL w okreÅ›lonej domenie lub podkatalogu. Powszechne metody eksploatacji obejmujÄ… otwarte przekierowania, przechodzenie przez Å›cieÅ¼ki, wykorzystywanie sÅ‚abych wyraÅ¼eÅ„ regularnych oraz wstrzykiwanie HTML w celu kradzieÅ¼y tokenÃ³w.

OprÃ³cz `redirect_uri`, inne parametry OAuth i OpenID, takie jak `client_uri`, `policy_uri`, `tos_uri` i `initiate_login_uri`, sÄ… rÃ³wnieÅ¼ podatne na ataki przekierowujÄ…ce. Parametry te sÄ… opcjonalne, a ich wsparcie rÃ³Å¼ni siÄ™ w zaleÅ¼noÅ›ci od serwerÃ³w.

Dla tych, ktÃ³rzy celujÄ… w serwer OpenID, punkt koÅ„cowy odkrywania (`**.well-known/openid-configuration**`) czÄ™sto zawiera cenne szczegÃ³Å‚y konfiguracyjne, takie jak `registration_endpoint`, `request_uri_parameter_supported` i "`require_request_uri_registration`. Te szczegÃ³Å‚y mogÄ… pomÃ³c w identyfikacji punktu koÅ„cowego rejestracji i innych specyfikacji konfiguracyjnych serwera.

### XSS w implementacji przekierowania <a href="#bda5" id="bda5"></a>

Jak wspomniano w tym raporcie o bug bounty [https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html](https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html), moÅ¼e byÄ‡ moÅ¼liwe, Å¼e **URL przekierowania jest odzwierciedlany w odpowiedzi** serwera po uwierzytelnieniu uÅ¼ytkownika, co czyni go **podatnym na XSS**. MoÅ¼liwy Å‚adunek do przetestowania:
```
https://app.victim.com/login?redirectUrl=https://app.victim.com/dashboard</script><h1>test</h1>
```
### CSRF - NiewÅ‚aÅ›ciwe zarzÄ…dzanie parametrem state <a href="#bda5" id="bda5"></a>

W implementacjach OAuth, niewÅ‚aÅ›ciwe uÅ¼ycie lub pominiÄ™cie parametru **`state`** moÅ¼e znacznie zwiÄ™kszyÄ‡ ryzyko atakÃ³w **Cross-Site Request Forgery (CSRF)**. Ta podatnoÅ›Ä‡ wystÄ™puje, gdy parametr `state` jest **nieuÅ¼ywany, uÅ¼ywany jako statyczna wartoÅ›Ä‡ lub niewÅ‚aÅ›ciwie walidowany**, co pozwala atakujÄ…cym na ominiÄ™cie ochrony CSRF.

AtakujÄ…cy mogÄ… to wykorzystaÄ‡, przechwytujÄ…c proces autoryzacji, aby powiÄ…zaÄ‡ swoje konto z kontem ofiary, co prowadzi do potencjalnych **przejÄ™Ä‡ konta**. Jest to szczegÃ³lnie krytyczne w aplikacjach, w ktÃ³rych OAuth jest uÅ¼ywany do **celÃ³w uwierzytelniania**.

PrzykÅ‚ady tej podatnoÅ›ci w rzeczywistych sytuacjach zostaÅ‚y udokumentowane w rÃ³Å¼nych **wyzwaniach CTF** i **platformach hackingowych**, podkreÅ›lajÄ…c jej praktyczne implikacje. Problem ten dotyczy rÃ³wnieÅ¼ integracji z usÅ‚ugami stron trzecich, takimi jak **Slack**, **Stripe** i **PayPal**, gdzie atakujÄ…cy mogÄ… przekierowywaÄ‡ powiadomienia lub pÅ‚atnoÅ›ci na swoje konta.

WÅ‚aÅ›ciwe zarzÄ…dzanie i walidacja parametru **`state`** sÄ… kluczowe dla ochrony przed CSRF i zabezpieczenia przepÅ‚ywu OAuth.

### Przed przejÄ™ciem konta <a href="#ebe4" id="ebe4"></a>

1. **Bez weryfikacji e-maila przy tworzeniu konta**: AtakujÄ…cy mogÄ… z wyprzedzeniem stworzyÄ‡ konto uÅ¼ywajÄ…c e-maila ofiary. JeÅ›li ofiara pÃ³Åºniej uÅ¼yje usÅ‚ugi stron trzecich do logowania, aplikacja moÅ¼e nieumyÅ›lnie powiÄ…zaÄ‡ to konto z wczeÅ›niej stworzonym kontem atakujÄ…cego, co prowadzi do nieautoryzowanego dostÄ™pu.
2. **Wykorzystywanie luÅºnej weryfikacji e-maila w OAuth**: AtakujÄ…cy mogÄ… wykorzystaÄ‡ usÅ‚ugi OAuth, ktÃ³re nie weryfikujÄ… e-maili, rejestrujÄ…c siÄ™ w ich usÅ‚udze, a nastÄ™pnie zmieniajÄ…c e-mail konta na e-mail ofiary. Ta metoda podobnie naraÅ¼a na nieautoryzowany dostÄ™p do konta, podobnie jak w pierwszym scenariuszu, ale przez inny wektor ataku.

### Ujawnienie sekretÃ³w <a href="#e177" id="e177"></a>

Identyfikacja i ochrona tajnych parametrÃ³w OAuth jest kluczowa. Podczas gdy **`client_id`** moÅ¼na bezpiecznie ujawniaÄ‡, ujawnienie **`client_secret`** wiÄ…Å¼e siÄ™ z powaÅ¼nymi ryzykami. JeÅ›li `client_secret` zostanie skompromitowane, atakujÄ…cy mogÄ… wykorzystaÄ‡ toÅ¼samoÅ›Ä‡ i zaufanie aplikacji do **kradzieÅ¼y `access_tokens`** uÅ¼ytkownikÃ³w i prywatnych informacji.

Powszechna podatnoÅ›Ä‡ wystÄ™puje, gdy aplikacje bÅ‚Ä™dnie obsÅ‚ugujÄ… wymianÄ™ `code` autoryzacji na `access_token` po stronie klienta, a nie serwera. Ten bÅ‚Ä…d prowadzi do ujawnienia `client_secret`, umoÅ¼liwiajÄ…c atakujÄ…cym generowanie `access_tokens` pod przykrywkÄ… aplikacji. Ponadto, poprzez inÅ¼ynieriÄ™ spoÅ‚ecznÄ…, atakujÄ…cy mogÄ… eskalowaÄ‡ uprawnienia, dodajÄ…c dodatkowe zakresy do autoryzacji OAuth, dalej wykorzystujÄ…c zaufany status aplikacji.

### Bruteforce klienta sekretu

MoÅ¼esz sprÃ³bowaÄ‡ **bruteforce'owaÄ‡ client_secret** dostawcy usÅ‚ug z dostawcÄ… toÅ¼samoÅ›ci, aby sprÃ³bowaÄ‡ ukraÅ›Ä‡ konta.\
Å»Ä…danie do BF moÅ¼e wyglÄ…daÄ‡ podobnie do:
```
POST /token HTTP/1.1
content-type: application/x-www-form-urlencoded
host: 10.10.10.10:3000
content-length: 135
Connection: close

code=77515&redirect_uri=http%3A%2F%2F10.10.10.10%3A3000%2Fcallback&grant_type=authorization_code&client_id=public_client_id&client_secret=[bruteforce]
```
### Referer Header leaking Code + State

Gdy klient ma **kod i stan**, jeÅ›li sÄ… one **odzwierciedlone w nagÅ‚Ã³wku Referer** podczas przeglÄ…dania innej strony, to jest podatny.

### Access Token Stored in Browser History

PrzejdÅº do **historii przeglÄ…darki i sprawdÅº, czy token dostÄ™pu jest tam zapisany**.

### Everlasting Authorization Code

**Kod autoryzacji powinien Å¼yÄ‡ tylko przez pewien czas, aby ograniczyÄ‡ czas, w ktÃ³rym atakujÄ…cy moÅ¼e go ukraÅ›Ä‡ i uÅ¼yÄ‡**.

### Authorization/Refresh Token not bound to client

JeÅ›li moÅ¼esz uzyskaÄ‡ **kod autoryzacji i uÅ¼yÄ‡ go z innym klientem, to moÅ¼esz przejÄ…Ä‡ inne konta**.

### Happy Paths, XSS, Iframes & Post Messages to leak code & state values

[**SprawdÅº ten post**](https://labs.detectify.com/writeups/account-hijacking-using-dirty-dancing-in-sign-in-oauth-flows/#gadget-2-xss-on-sandbox-third-party-domain-that-gets-the-url)

### AWS Cognito <a href="#bda5" id="bda5"></a>

W tym raporcie o bug bounty: [**https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/**](https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/) moÅ¼esz zobaczyÄ‡, Å¼e **token**, ktÃ³ry **AWS Cognito** zwraca uÅ¼ytkownikowi, moÅ¼e mieÄ‡ **wystarczajÄ…ce uprawnienia do nadpisania danych uÅ¼ytkownika**. Dlatego, jeÅ›li moÅ¼esz **zmieniÄ‡ adres e-mail uÅ¼ytkownika na inny adres e-mail**, moÅ¼esz byÄ‡ w stanie **przejÄ…Ä‡** inne konta.
```bash
# Read info of the user
aws cognito-idp get-user --region us-east-1 --access-token eyJraWQiOiJPVj[...]

# Change email address
aws cognito-idp update-user-attributes --region us-east-1 --access-token eyJraWQ[...] --user-attributes Name=email,Value=imaginary@flickr.com
{
"CodeDeliveryDetailsList": [
{
"Destination": "i***@f***.com",
"DeliveryMedium": "EMAIL",
"AttributeName": "email"
}
]
}
```
For more detailed info about how to abuse AWS cognito check:

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/aws-pentesting/aws-unauthenticated-enum-access/aws-cognito-unauthenticated-enum" %}

### Abusing other Apps tokens <a href="#bda5" id="bda5"></a>

Jak [**wspomniano w tym artykule**](https://salt.security/blog/oh-auth-abusing-oauth-to-take-over-millions-of-accounts), przepÅ‚ywy OAuth, ktÃ³re oczekujÄ… otrzymania **tokena** (a nie kodu), mogÄ… byÄ‡ podatne, jeÅ›li nie sprawdzajÄ…, czy token naleÅ¼y do aplikacji.

Dzieje siÄ™ tak, poniewaÅ¼ **atakujÄ…cy** moÅ¼e stworzyÄ‡ **aplikacjÄ™ wspierajÄ…cÄ… OAuth i logowaÄ‡ siÄ™ za pomocÄ… Facebooka** (na przykÅ‚ad) w swojej wÅ‚asnej aplikacji. NastÄ™pnie, gdy ofiara zaloguje siÄ™ za pomocÄ… Facebooka w **aplikacji atakujÄ…cego**, atakujÄ…cy moÅ¼e uzyskaÄ‡ **token OAuth uÅ¼ytkownika przyznany jego aplikacji i uÅ¼yÄ‡ go do zalogowania siÄ™ w aplikacji OAuth ofiary, uÅ¼ywajÄ…c tokena uÅ¼ytkownika ofiary**.

{% hint style="danger" %}
Dlatego, jeÅ›li atakujÄ…cy zdoÅ‚a uzyskaÄ‡ dostÄ™p uÅ¼ytkownika do swojej wÅ‚asnej aplikacji OAuth, bÄ™dzie mÃ³gÅ‚ przejÄ…Ä‡ konto ofiary w aplikacjach, ktÃ³re oczekujÄ… tokena i nie sprawdzajÄ…, czy token zostaÅ‚ przyznany ich identyfikatorowi aplikacji.
{% endhint %}

### Two links & cookie <a href="#bda5" id="bda5"></a>

Zgodnie z [**tym artykuÅ‚em**](https://medium.com/@metnew/why-electron-apps-cant-store-your-secrets-confidentially-inspect-option-a49950d6d51f), moÅ¼liwe byÅ‚o zmuszenie ofiary do otwarcia strony z **returnUrl** wskazujÄ…cym na host atakujÄ…cego. Te informacje byÅ‚yby **przechowywane w ciasteczku (RU)**, a w **pÃ³Åºniejszym kroku** **prompt** **zapytuje** **uÅ¼ytkownika**, czy chce udzieliÄ‡ dostÄ™pu do hosta atakujÄ…cego.

Aby obejÅ›Ä‡ ten prompt, moÅ¼liwe byÅ‚o otwarcie zakÅ‚adki w celu zainicjowania **przepÅ‚ywu Oauth**, ktÃ³ry ustawiÅ‚by to ciasteczko RU uÅ¼ywajÄ…c **returnUrl**, zamkniÄ™cie zakÅ‚adki przed wyÅ›wietleniem promptu i otwarcie nowej zakÅ‚adki bez tej wartoÅ›ci. Wtedy **prompt nie poinformuje o hoÅ›cie atakujÄ…cego**, ale ciasteczko zostanie ustawione na niego, wiÄ™c **token zostanie wysÅ‚any do hosta atakujÄ…cego** w przekierowaniu.

### Prompt Interaction Bypass <a href="#bda5" id="bda5"></a>

Jak wyjaÅ›niono w [**tym filmie**](https://www.youtube.com/watch?v=n9x7\_J\_a\_7Q), niektÃ³re implementacje OAuth pozwalajÄ… wskazaÄ‡ parametr GET **`prompt`** jako None (**`&prompt=none`**), aby **zapobiec pytaniu uÅ¼ytkownikÃ³w o potwierdzenie** danego dostÄ™pu w prompt w sieci, jeÅ›li sÄ… juÅ¼ zalogowani na platformie.

### response\_mode

Jak [**wyjaÅ›niono w tym filmie**](https://www.youtube.com/watch?v=n9x7\_J\_a\_7Q), moÅ¼e byÄ‡ moÅ¼liwe wskazanie parametru **`response_mode`**, aby okreÅ›liÄ‡, gdzie chcesz, aby kod zostaÅ‚ podany w koÅ„cowym URL:

* `response_mode=query` -> Kod jest podawany wewnÄ…trz parametru GET: `?code=2397rf3gu93f`
* `response_mode=fragment` -> Kod jest podawany wewnÄ…trz fragmentu URL `#code=2397rf3gu93f`
* `response_mode=form_post` -> Kod jest podawany wewnÄ…trz formularza POST z polem o nazwie `code` i wartoÅ›ciÄ…
* `response_mode=web_message` -> Kod jest wysyÅ‚any w wiadomoÅ›ci post: `window.opener.postMessage({"code": "asdasdasd...`

### SSRFs parameters <a href="#bda5" id="bda5"></a>

[**SprawdÅº to badanie**](https://portswigger.net/research/hidden-oauth-attack-vectors) **Aby uzyskaÄ‡ dalsze szczegÃ³Å‚y na temat tej techniki.**

Dynamiczna rejestracja klienta w OAuth sÅ‚uÅ¼y jako mniej oczywisty, ale krytyczny wektor dla luk w zabezpieczeniach, szczegÃ³lnie dla atakÃ³w **Server-Side Request Forgery (SSRF)**. Ten punkt koÅ„cowy pozwala serwerom OAuth otrzymywaÄ‡ szczegÃ³Å‚y dotyczÄ…ce aplikacji klienckich, w tym wraÅ¼liwe adresy URL, ktÃ³re mogÄ… byÄ‡ wykorzystane.

**Kluczowe punkty:**

* **Dynamiczna rejestracja klienta** jest czÄ™sto mapowana na `/register` i akceptuje szczegÃ³Å‚y takie jak `client_name`, `client_secret`, `redirect_uris` oraz adresy URL dla logo lub zestawÃ³w kluczy JSON Web (JWK) za pomocÄ… Å¼Ä…daÅ„ POST.
* Ta funkcja przestrzega specyfikacji zawartych w **RFC7591** i **OpenID Connect Registration 1.0**, ktÃ³re zawierajÄ… parametry potencjalnie podatne na SSRF.
* Proces rejestracji moÅ¼e nieumyÅ›lnie naraÅ¼aÄ‡ serwery na SSRF na kilka sposobÃ³w:
* **`logo_uri`**: Adres URL dla logo aplikacji klienckiej, ktÃ³ry moÅ¼e byÄ‡ pobierany przez serwer, wywoÅ‚ujÄ…c SSRF lub prowadzÄ…c do XSS, jeÅ›li adres URL jest Åºle obsÅ‚ugiwany.
* **`jwks_uri`**: Adres URL do dokumentu JWK klienta, ktÃ³ry, jeÅ›li zostanie zÅ‚oÅ›liwie skonstruowany, moÅ¼e spowodowaÄ‡, Å¼e serwer wykona zewnÄ™trzne Å¼Ä…dania do serwera kontrolowanego przez atakujÄ…cego.
* **`sector_identifier_uri`**: Odnosi siÄ™ do tablicy JSON `redirect_uris`, ktÃ³rÄ… serwer moÅ¼e pobraÄ‡, tworzÄ…c moÅ¼liwoÅ›Ä‡ SSRF.
* **`request_uris`**: Wymienia dozwolone URI Å¼Ä…daÅ„ dla klienta, ktÃ³re mogÄ… byÄ‡ wykorzystane, jeÅ›li serwer pobiera te URI na poczÄ…tku procesu autoryzacji.

**Strategia eksploatacji:**

* SSRF moÅ¼na wywoÅ‚aÄ‡, rejestrujÄ…c nowego klienta z zÅ‚oÅ›liwymi adresami URL w parametrach takich jak `logo_uri`, `jwks_uri` lub `sector_identifier_uri`.
* ChociaÅ¼ bezpoÅ›rednia eksploatacja za pomocÄ… `request_uris` moÅ¼e byÄ‡ ograniczona przez kontrole biaÅ‚ej listy, dostarczenie wstÄ™pnie zarejestrowanego, kontrolowanego przez atakujÄ…cego `request_uri` moÅ¼e uÅ‚atwiÄ‡ SSRF podczas fazy autoryzacji.

## OAuth providers Race Conditions

JeÅ›li platforma, ktÃ³rÄ… testujesz, jest dostawcÄ… OAuth [**przeczytaj to, aby przetestowaÄ‡ moÅ¼liwe warunki wyÅ›cigu**](race-condition.md).

## References

* [**https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1**](https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1)
* [**https://portswigger.net/research/hidden-oauth-attack-vectors**](https://portswigger.net/research/hidden-oauth-attack-vectors)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
