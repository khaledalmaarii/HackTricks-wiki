# OAuth to Account takeover

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Temel Bilgiler <a href="#d4a8" id="d4a8"></a>

OAuth Ã§eÅŸitli versiyonlar sunar, temel bilgilere [OAuth 2.0 dokÃ¼mantasyonu](https://oauth.net/2/) Ã¼zerinden ulaÅŸÄ±labilir. Bu tartÄ±ÅŸma, yaygÄ±n olarak kullanÄ±lan [OAuth 2.0 yetkilendirme kodu hibe tÃ¼rÃ¼](https://oauth.net/2/grant-types/authorization-code/) Ã¼zerine odaklanmaktadÄ±r ve **bir uygulamanÄ±n baÅŸka bir uygulamadaki bir kullanÄ±cÄ±nÄ±n hesabÄ±na eriÅŸim veya iÅŸlem yapmasÄ±nÄ± saÄŸlayan bir yetkilendirme Ã§erÃ§evesi** sunar (yetkilendirme sunucusu).

_Hayali bir web sitesi olan_ _**https://example.com**_'u dÃ¼ÅŸÃ¼nÃ¼n, **tÃ¼m sosyal medya gÃ¶nderilerinizi, Ã¶zel olanlar da dahil olmak Ã¼zere, sergilemek iÃ§in tasarlanmÄ±ÅŸtÄ±r**. Bunu baÅŸarmak iÃ§in OAuth 2.0 kullanÄ±lÄ±r. _https://example.com_ **sosyal medya gÃ¶nderilerinize eriÅŸim izni** isteyecektir. SonuÃ§ olarak, _https://socialmedia.com_ Ã¼zerinde **istenen izinleri ve isteÄŸi yapan geliÅŸtiriciyi** belirten bir onay ekranÄ± gÃ¶rÃ¼necektir. OnayÄ±nÄ±zÄ± verdikten sonra, _https://example.com_ **gÃ¶nderilerinize sizin adÄ±nÄ±za eriÅŸim** kazanÄ±r.

OAuth 2.0 Ã§erÃ§evesindeki aÅŸaÄŸÄ±daki bileÅŸenleri anlamak Ã¶nemlidir:

* **resource owner**: **KaynaÄŸÄ±nÄ±za eriÅŸim izni veren** siz, yani **kullanÄ±cÄ±/varlÄ±k**.
* **resource server**: **Kimlik doÄŸrulama sonrasÄ± istekleri yÃ¶neten sunucu**, Ã¶rneÄŸin **https://socialmedia.com**.
* **client application**: `resource owner`dan **yetki isteyen uygulama**, Ã¶rneÄŸin **https://example.com**.
* **authorization server**: `resource owner`Ä±n baÅŸarÄ±lÄ± kimlik doÄŸrulamasÄ± ve yetkilendirmesi sonrasÄ± `client application`a **`access tokens` veren sunucu**, Ã¶rneÄŸin **https://socialmedia.com**.
* **client\_id**: Uygulama iÃ§in genel, benzersiz bir tanÄ±mlayÄ±cÄ±.
* **client\_secret:** `access_tokens` oluÅŸturmak iÃ§in uygulama ve yetkilendirme sunucusu tarafÄ±ndan bilinen gizli bir anahtar.
* **response\_type**: **Ä°stenen token tÃ¼rÃ¼nÃ¼ belirten** bir deÄŸer, Ã¶rneÄŸin `code`.
* **scope**: `client application`Ä±n `resource owner`dan **istediÄŸi eriÅŸim seviyesi**.
* **redirect\_uri**: Yetkilendirme sonrasÄ± kullanÄ±cÄ±nÄ±n **yÃ¶nlendirileceÄŸi URL**. Genellikle Ã¶nceden kayÄ±tlÄ± yÃ¶nlendirme URL'si ile uyumlu olmalÄ±dÄ±r.
* **state**: KullanÄ±cÄ±nÄ±n yetkilendirme sunucusuna yÃ¶nlendirilmesi ve geri dÃ¶nmesi sÄ±rasÄ±nda **veriyi korumak iÃ§in kullanÄ±lan** bir parametre. **CSRF koruma mekanizmasÄ±** olarak hizmet etmesi iÃ§in benzersizliÄŸi kritiktir.
* **grant\_type**: **Hibe tÃ¼rÃ¼nÃ¼ ve dÃ¶ndÃ¼rÃ¼lecek token tÃ¼rÃ¼nÃ¼ belirten** bir parametre.
* **code**: `authorization server`dan gelen yetkilendirme kodu, `client_id` ve `client_secret` ile birlikte `access_token` almak iÃ§in client application tarafÄ±ndan kullanÄ±lÄ±r.
* **access\_token**: `client application`Ä±n `resource owner` adÄ±na API istekleri iÃ§in kullandÄ±ÄŸÄ± **token**.
* **refresh\_token**: UygulamanÄ±n **kullanÄ±cÄ±yÄ± yeniden uyarmadan yeni bir `access_token` almasÄ±nÄ± saÄŸlar**.

### AkÄ±ÅŸ

**GerÃ§ek OAuth akÄ±ÅŸÄ±** ÅŸu ÅŸekilde ilerler:

1. [https://example.com](https://example.com) adresine gidip â€œSosyal Medya ile Entegre Etâ€ butonuna tÄ±klarsÄ±nÄ±z.
2. Site, [https://socialmedia.com](https://socialmedia.com) adresine, https://example.comâ€™un uygulamasÄ±nÄ±n gÃ¶nderilerinize eriÅŸmesine izin vermeniz iÃ§in bir istek gÃ¶nderir. Ä°stek ÅŸu ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r:
```
https://socialmedia.com/auth
?response_type=code
&client_id=example_clientId
&redirect_uri=https%3A%2F%2Fexample.com%2Fcallback
&scope=readPosts
&state=randomString123
```
3. ArdÄ±ndan bir onay sayfasÄ± ile karÅŸÄ±laÅŸÄ±rsÄ±nÄ±z.
4. OnayÄ±nÄ±zÄ±n ardÄ±ndan, Sosyal Medya `code` ve `state` parametreleri ile `redirect_uri`'ye bir yanÄ±t gÃ¶nderir:
```
https://example.com?code=uniqueCode123&state=randomString123
```
5. https://example.com bu `code`'u, `client_id` ve `client_secret` ile birlikte, sizin adÄ±nÄ±za bir `access_token` elde etmek iÃ§in sunucu tarafÄ±nda bir istek yapmak amacÄ±yla kullanÄ±r ve bu sayede onayladÄ±ÄŸÄ±nÄ±z izinlere eriÅŸim saÄŸlar:
```
POST /oauth/access_token
Host: socialmedia.com
...{"client_id": "example_clientId", "client_secret": "example_clientSecret", "code": "uniqueCode123", "grant_type": "authorization_code"}
```
6. Son olarak, sÃ¼reÃ§ https://example.com'un `access_token` kullanarak Sosyal Medya'ya API Ã§aÄŸrÄ±sÄ± yapmasÄ±yla tamamlanÄ±r.

## GÃ¼venlik AÃ§Ä±klarÄ± <a href="#id-323a" id="id-323a"></a>

### Open redirect\_uri <a href="#cc36" id="cc36"></a>

`redirect_uri`, OAuth ve OpenID uygulamalarÄ±nda gÃ¼venlik iÃ§in Ã§ok Ã¶nemlidir, Ã§Ã¼nkÃ¼ yetkilendirme kodlarÄ± gibi hassas verilerin yetkilendirme sonrasÄ± nereye gÃ¶nderileceÄŸini yÃ¶nlendirir. YanlÄ±ÅŸ yapÄ±landÄ±rÄ±lÄ±rsa, saldÄ±rganlarÄ±n bu istekleri kÃ¶tÃ¼ niyetli sunuculara yÃ¶nlendirmesine izin vererek hesap ele geÃ§irmeye olanak tanÄ±yabilir.

SÃ¶mÃ¼rme teknikleri, yetkilendirme sunucusunun doÄŸrulama mantÄ±ÄŸÄ±na baÄŸlÄ± olarak deÄŸiÅŸir. KatÄ± yol eÅŸleÅŸtirmeden, belirtilen alan veya alt dizin iÃ§indeki herhangi bir URL'yi kabul etmeye kadar Ã§eÅŸitlilik gÃ¶sterebilir. YaygÄ±n sÃ¶mÃ¼rme yÃ¶ntemleri arasÄ±nda aÃ§Ä±k yÃ¶nlendirmeler, yol geÃ§iÅŸi, zayÄ±f regexlerin kullanÄ±lmasÄ± ve token hÄ±rsÄ±zlÄ±ÄŸÄ± iÃ§in HTML enjeksiyonu bulunur.

`redirect_uri` dÄ±ÅŸÄ±nda, `client_uri`, `policy_uri`, `tos_uri` ve `initiate_login_uri` gibi diÄŸer OAuth ve OpenID parametreleri de yÃ¶nlendirme saldÄ±rÄ±larÄ±na karÅŸÄ± savunmasÄ±zdÄ±r. Bu parametreler isteÄŸe baÄŸlÄ±dÄ±r ve sunucular arasÄ±nda destekleri deÄŸiÅŸiklik gÃ¶sterir.

Bir OpenID sunucusunu hedefleyenler iÃ§in, keÅŸif uÃ§ noktasÄ± (`**.well-known/openid-configuration**`) genellikle `registration_endpoint`, `request_uri_parameter_supported` ve "`require_request_uri_registration` gibi deÄŸerli yapÄ±landÄ±rma ayrÄ±ntÄ±larÄ±nÄ± listeler. Bu ayrÄ±ntÄ±lar, kayÄ±t uÃ§ noktasÄ±nÄ± ve sunucunun diÄŸer yapÄ±landÄ±rma Ã¶zelliklerini belirlemede yardÄ±mcÄ± olabilir.

### YÃ¶nlendirme uygulamasÄ±nda XSS <a href="#bda5" id="bda5"></a>

Bu hata Ã¶dÃ¼l raporunda belirtildiÄŸi gibi [https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html](https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html) yÃ¶nlendirme **URL'sinin, kullanÄ±cÄ± kimlik doÄŸruladÄ±ktan sonra sunucunun yanÄ±tÄ±nda yansÄ±tÄ±lmasÄ±** ve **XSS'ye karÅŸÄ± savunmasÄ±z olmasÄ±** mÃ¼mkÃ¼n olabilir. Test etmek iÃ§in olasÄ± yÃ¼k:
```
https://app.victim.com/login?redirectUrl=https://app.victim.com/dashboard</script><h1>test</h1>
```
### CSRF - State Parametresinin Uygunsuz YÃ¶netimi <a href="#bda5" id="bda5"></a>

OAuth uygulamalarÄ±nda, **`state` parametresinin** yanlÄ±ÅŸ kullanÄ±mÄ± veya ihmal edilmesi, **Cross-Site Request Forgery (CSRF)** saldÄ±rÄ±larÄ±nÄ±n riskini Ã¶nemli Ã¶lÃ§Ã¼de artÄ±rabilir. Bu zafiyet, `state` parametresinin **kullanÄ±lmamasÄ±, statik bir deÄŸer olarak kullanÄ±lmasÄ± veya dÃ¼zgÃ¼n bir ÅŸekilde doÄŸrulanmamasÄ±** durumunda ortaya Ã§Ä±kar ve saldÄ±rganlarÄ±n CSRF korumalarÄ±nÄ± atlatmasÄ±na olanak tanÄ±r.

SaldÄ±rganlar, yetkilendirme sÃ¼recini kesintiye uÄŸratarak kendi hesaplarÄ±nÄ± kurbanÄ±n hesabÄ±yla iliÅŸkilendirebilir, bu da potansiyel **hesap ele geÃ§irmelerine** yol aÃ§ar. Bu, OAuth'un **kimlik doÄŸrulama amacÄ±yla** kullanÄ±ldÄ±ÄŸÄ± uygulamalarda Ã¶zellikle kritiktir.

Bu zafiyetin gerÃ§ek dÃ¼nya Ã¶rnekleri Ã§eÅŸitli **CTF zorluklarÄ±nda** ve **hacking platformlarÄ±nda** belgelenmiÅŸtir ve pratik sonuÃ§larÄ±nÄ± vurgulamaktadÄ±r. Sorun, saldÄ±rganlarÄ±n bildirimleri veya Ã¶demeleri kendi hesaplarÄ±na yÃ¶nlendirebileceÄŸi **Slack**, **Stripe** ve **PayPal** gibi Ã¼Ã§Ã¼ncÃ¼ taraf hizmetlerle yapÄ±lan entegrasyonlara da uzanÄ±r.

CSRF'ye karÅŸÄ± korunmak ve OAuth akÄ±ÅŸÄ±nÄ± gÃ¼vence altÄ±na almak iÃ§in **`state` parametresinin** doÄŸru ÅŸekilde yÃ¶netilmesi ve doÄŸrulanmasÄ± Ã§ok Ã¶nemlidir.

### Hesap Ele GeÃ§irme Ã–ncesi <a href="#ebe4" id="ebe4"></a>

1. **Hesap OluÅŸturma SÄ±rasÄ±nda E-posta DoÄŸrulamasÄ± Olmadan**: SaldÄ±rganlar, kurbanÄ±n e-postasÄ±nÄ± kullanarak Ã¶nceden bir hesap oluÅŸturabilir. Kurban daha sonra Ã¼Ã§Ã¼ncÃ¼ taraf bir hizmeti giriÅŸ iÃ§in kullanÄ±rsa, uygulama yanlÄ±ÅŸlÄ±kla bu Ã¼Ã§Ã¼ncÃ¼ taraf hesabÄ±nÄ± saldÄ±rganÄ±n Ã¶nceden oluÅŸturduÄŸu hesapla iliÅŸkilendirebilir ve yetkisiz eriÅŸime yol aÃ§abilir.
2. **GevÅŸek OAuth E-posta DoÄŸrulamasÄ±nÄ± SÃ¶mÃ¼rmek**: SaldÄ±rganlar, e-postalarÄ± doÄŸrulamayan OAuth hizmetlerini kullanarak kendi hizmetlerine kaydolabilir ve ardÄ±ndan hesap e-postasÄ±nÄ± kurbanÄ±nkiyle deÄŸiÅŸtirebilir. Bu yÃ¶ntem, ilk senaryoya benzer ÅŸekilde yetkisiz hesap eriÅŸimi riski taÅŸÄ±r, ancak farklÄ± bir saldÄ±rÄ± vektÃ¶rÃ¼ Ã¼zerinden gerÃ§ekleÅŸir.

### SÄ±rlarÄ±n AÃ§Ä±ÄŸa Ã‡Ä±kmasÄ± <a href="#e177" id="e177"></a>

Gizli OAuth parametrelerini tanÄ±mlamak ve korumak Ã§ok Ã¶nemlidir. **`client_id`** gÃ¼venli bir ÅŸekilde aÃ§Ä±klanabilirken, **`client_secret`**'in ifÅŸa edilmesi Ã¶nemli riskler taÅŸÄ±r. `client_secret` ele geÃ§irilirse, saldÄ±rganlar uygulamanÄ±n kimliÄŸini ve gÃ¼venini kullanarak **kullanÄ±cÄ± `access_token`larÄ±nÄ±** ve Ã¶zel bilgileri Ã§alabilir.

YaygÄ±n bir zafiyet, uygulamalarÄ±n yetkilendirme `code`unu `access_token` ile deÄŸiÅŸtirme iÅŸlemini istemci tarafÄ±nda yanlÄ±ÅŸlÄ±kla gerÃ§ekleÅŸtirmesi durumunda ortaya Ã§Ä±kar. Bu hata, `client_secret`in aÃ§Ä±ÄŸa Ã§Ä±kmasÄ±na yol aÃ§ar ve saldÄ±rganlarÄ±n uygulamanÄ±n kimliÄŸine bÃ¼rÃ¼nerek `access_token` Ã¼retmesine olanak tanÄ±r. AyrÄ±ca, sosyal mÃ¼hendislik yoluyla saldÄ±rganlar, OAuth yetkilendirmesine ek kapsamlar ekleyerek ayrÄ±calÄ±klarÄ± artÄ±rabilir ve uygulamanÄ±n gÃ¼venilir statÃ¼sÃ¼nÃ¼ daha fazla kÃ¶tÃ¼ye kullanabilir.

### Client Secret Bruteforce

Bir hizmet saÄŸlayÄ±cÄ±nÄ±n client\_secret'Ä±nÄ± kimlik saÄŸlayÄ±cÄ±sÄ± ile **bruteforce** yaparak hesaplarÄ± Ã§almayÄ± deneyebilirsiniz.\
BF isteÄŸi ÅŸu ÅŸekilde gÃ¶rÃ¼nebilir:
```
POST /token HTTP/1.1
content-type: application/x-www-form-urlencoded
host: 10.10.10.10:3000
content-length: 135
Connection: close

code=77515&redirect_uri=http%3A%2F%2F10.10.10.10%3A3000%2Fcallback&grant_type=authorization_code&client_id=public_client_id&client_secret=[bruteforce]
```
### Referer Header leaking Code + State

MÃ¼ÅŸteri **code ve state** deÄŸerlerine sahip olduÄŸunda, **Referer header** iÃ§inde yansÄ±tÄ±ldÄ±ÄŸÄ±nda ve farklÄ± bir sayfaya gÃ¶z attÄ±ÄŸÄ±nda, bu durumda savunmasÄ±zdÄ±r.

### Access Token Stored in Browser History

**TarayÄ±cÄ± geÃ§miÅŸine gidin ve access token'Ä±n orada kaydedilip kaydedilmediÄŸini kontrol edin**.

### Everlasting Authorization Code

**Authorization code sadece belirli bir sÃ¼re yaÅŸamalÄ±dÄ±r, bÃ¶ylece bir saldÄ±rganÄ±n onu Ã§alabileceÄŸi ve kullanabileceÄŸi zaman penceresi sÄ±nÄ±rlanÄ±r**.

### Authorization/Refresh Token not bound to client

**Authorization code'u alabilir ve farklÄ± bir mÃ¼ÅŸteri ile kullanabilirseniz, diÄŸer hesaplarÄ± ele geÃ§irebilirsiniz**.

### Happy Paths, XSS, Iframes & Post Messages to leak code & state values

[**Bu gÃ¶nderiyi kontrol edin**](https://labs.detectify.com/writeups/account-hijacking-using-dirty-dancing-in-sign-in-oauth-flows/#gadget-2-xss-on-sandbox-third-party-domain-that-gets-the-url)

### AWS Cognito <a href="#bda5" id="bda5"></a>

Bu bug bounty raporunda: [**https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/**](https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/) **AWS Cognito**'nun kullanÄ±cÄ±ya geri verdiÄŸi **token**'Ä±n **kullanÄ±cÄ± verilerini deÄŸiÅŸtirmek iÃ§in yeterli izinlere sahip olabileceÄŸini** gÃ¶rebilirsiniz. Bu nedenle, **kullanÄ±cÄ± e-postasÄ±nÄ± farklÄ± bir kullanÄ±cÄ± e-postasÄ± ile deÄŸiÅŸtirebilirseniz**, diÄŸer hesaplarÄ± **ele geÃ§irebilirsiniz**.
```bash
# Read info of the user
aws cognito-idp get-user --region us-east-1 --access-token eyJraWQiOiJPVj[...]

# Change email address
aws cognito-idp update-user-attributes --region us-east-1 --access-token eyJraWQ[...] --user-attributes Name=email,Value=imaginary@flickr.com
{
"CodeDeliveryDetailsList": [
{
"Destination": "i***@f***.com",
"DeliveryMedium": "EMAIL",
"AttributeName": "email"
}
]
}
```
AWS cognito'yu nasÄ±l kÃ¶tÃ¼ye kullanabileceÄŸiniz hakkÄ±nda daha ayrÄ±ntÄ±lÄ± bilgi iÃ§in kontrol edin:

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/aws-pentesting/aws-unauthenticated-enum-access/aws-cognito-unauthenticated-enum" %}

### DiÄŸer Uygulama TokenlarÄ±nÄ± KÃ¶tÃ¼ye Kullanma <a href="#bda5" id="bda5"></a>

[**Bu yazÄ±da belirtildiÄŸi gibi**](https://salt.security/blog/oh-auth-abusing-oauth-to-take-over-millions-of-accounts), **token** (ve kod deÄŸil) almayÄ± bekleyen OAuth akÄ±ÅŸlarÄ±, token'Ä±n uygulamaya ait olup olmadÄ±ÄŸÄ±nÄ± kontrol etmezlerse savunmasÄ±z olabilirler.

Bu, bir **saldÄ±rganÄ±n** kendi **uygulamasÄ±nda Facebook ile giriÅŸ yapmayÄ± destekleyen bir uygulama oluÅŸturabileceÄŸi** anlamÄ±na gelir. Daha sonra, bir kurban saldÄ±rganÄ±n uygulamasÄ±nda Facebook ile giriÅŸ yaptÄ±ÄŸÄ±nda, saldÄ±rgan **kullanÄ±cÄ±nÄ±n uygulamasÄ±na verilen OAuth token'Ä±nÄ± alabilir ve bu token'Ä± kullanarak kurbanÄ±n OAuth uygulamasÄ±nda kurbanÄ±n kullanÄ±cÄ± token'Ä± ile giriÅŸ yapabilir**.

{% hint style="danger" %}
Bu nedenle, saldÄ±rgan kullanÄ±cÄ±nÄ±n kendi OAuth uygulamasÄ±na eriÅŸmesini saÄŸlarsa, token bekleyen ve token'Ä±n kendi uygulama kimliÄŸine verilip verilmediÄŸini kontrol etmeyen uygulamalarda kurbanÄ±n hesabÄ±nÄ± ele geÃ§irebilir.
{% endhint %}

### Ä°ki baÄŸlantÄ± ve Ã§erez <a href="#bda5" id="bda5"></a>

[**Bu yazÄ±ya gÃ¶re**](https://medium.com/@metnew/why-electron-apps-cant-store-your-secrets-confidentially-inspect-option-a49950d6d51f), bir kurbanÄ±n saldÄ±rganÄ±n ana bilgisayarÄ±na iÅŸaret eden bir **returnUrl** ile bir sayfa aÃ§masÄ±nÄ± saÄŸlamak mÃ¼mkÃ¼ndÃ¼. Bu bilgi bir **Ã§erezde (RU)** saklanacak ve **daha sonraki bir adÄ±mda** **kullanÄ±cÄ±ya** bu saldÄ±rganÄ±n ana bilgisayarÄ±na eriÅŸim izni verip vermek istemediÄŸi **sorulacaktÄ±r**.

Bu istemi atlatmak iÃ§in, **returnUrl** kullanarak bu RU Ã§erezini ayarlayacak **Oauth akÄ±ÅŸÄ±nÄ±** baÅŸlatmak iÃ§in bir sekme aÃ§mak, istem gÃ¶sterilmeden Ã¶nce sekmeyi kapatmak ve bu deÄŸeri iÃ§ermeyen yeni bir sekme aÃ§mak mÃ¼mkÃ¼ndÃ¼. Daha sonra, **istem saldÄ±rganÄ±n ana bilgisayarÄ±nÄ± bildirmeyecek**, ancak Ã§erez ona ayarlanmÄ±ÅŸ olacak, bu nedenle **token yÃ¶nlendirmede saldÄ±rganÄ±n ana bilgisayarÄ±na gÃ¶nderilecektir**.

### Ä°stem EtkileÅŸimi Atlatma <a href="#bda5" id="bda5"></a>

[**Bu videoda aÃ§Ä±klandÄ±ÄŸÄ± gibi**](https://www.youtube.com/watch?v=n9x7\_J\_a\_7Q), bazÄ± OAuth uygulamalarÄ±, kullanÄ±cÄ±larÄ±n platformda zaten oturum aÃ§mÄ±ÅŸlarsa verilen eriÅŸimi bir istemde onaylamalarÄ±nÄ±n istenmesini **Ã¶nlemek** iÃ§in **`prompt`** GET parametresini None (**`&prompt=none`**) olarak belirtmeye izin verir.

### response\_mode

[**Bu videoda aÃ§Ä±klandÄ±ÄŸÄ± gibi**](https://www.youtube.com/watch?v=n9x7\_J\_a\_7Q), son URL'de kodun nerede saÄŸlanmasÄ±nÄ± istediÄŸinizi belirtmek iÃ§in **`response_mode`** parametresini belirtmek mÃ¼mkÃ¼n olabilir:

* `response_mode=query` -> Kod bir GET parametresi iÃ§inde saÄŸlanÄ±r: `?code=2397rf3gu93f`
* `response_mode=fragment` -> Kod URL fragment parametresi iÃ§inde saÄŸlanÄ±r `#code=2397rf3gu93f`
* `response_mode=form_post` -> Kod bir POST formu iÃ§inde bir `code` adlÄ± input ile saÄŸlanÄ±r ve deÄŸeri
* `response_mode=web_message` -> Kod bir post mesajÄ±nda gÃ¶nderilir: `window.opener.postMessage({"code": "asdasdasd...`

### SSRFs parametreleri <a href="#bda5" id="bda5"></a>

[**Bu araÅŸtÄ±rmayÄ± kontrol edin**](https://portswigger.net/research/hidden-oauth-attack-vectors) **Bu tekniÄŸin daha fazla ayrÄ±ntÄ±sÄ± iÃ§in.**

OAuth'ta Dinamik Ä°stemci KaydÄ±, **Server-Side Request Forgery (SSRF)** saldÄ±rÄ±larÄ± iÃ§in daha az belirgin ancak kritik bir vektÃ¶r olarak hizmet eder. Bu uÃ§ nokta, OAuth sunucularÄ±nÄ±n istemci uygulamalarÄ± hakkÄ±nda ayrÄ±ntÄ±larÄ± almasÄ±na izin verir, bu da kÃ¶tÃ¼ye kullanÄ±labilecek hassas URL'leri iÃ§erebilir.

**Ana Noktalar:**

* **Dinamik Ä°stemci KaydÄ±** genellikle `/register` ile eÅŸleÅŸtirilir ve POST istekleri aracÄ±lÄ±ÄŸÄ±yla `client_name`, `client_secret`, `redirect_uris` ve logolar veya JSON Web Key Sets (JWKs) iÃ§in URL'ler gibi ayrÄ±ntÄ±larÄ± kabul eder.
* Bu Ã¶zellik, **RFC7591** ve **OpenID Connect Registration 1.0**'da belirtilen ve SSRF'ye karÅŸÄ± potansiyel olarak savunmasÄ±z parametrelere uyan Ã¶zelliklere sahiptir.
* KayÄ±t sÃ¼reci, sunucularÄ± birkaÃ§ ÅŸekilde SSRF'ye maruz bÄ±rakabilir:
* **`logo_uri`**: Sunucu tarafÄ±ndan alÄ±nabilecek istemci uygulamasÄ±nÄ±n logosu iÃ§in bir URL, yanlÄ±ÅŸ kullanÄ±lÄ±rsa SSRF'yi tetikleyebilir veya XSS'ye yol aÃ§abilir.
* **`jwks_uri`**: Ä°stemcinin JWK belgesine bir URL, kÃ¶tÃ¼ niyetli olarak oluÅŸturulmuÅŸsa, sunucunun saldÄ±rgan tarafÄ±ndan kontrol edilen bir sunucuya dÄ±ÅŸ istekler yapmasÄ±na neden olabilir.
* **`sector_identifier_uri`**: Sunucunun alabileceÄŸi `redirect_uris` JSON dizisine referans verir, bu da bir SSRF fÄ±rsatÄ± yaratÄ±r.
* **`request_uris`**: Ä°stemci iÃ§in izin verilen istek URI'larÄ±nÄ± listeler, sunucu yetkilendirme sÃ¼recinin baÅŸÄ±nda bu URI'larÄ± alÄ±rsa kÃ¶tÃ¼ye kullanÄ±labilir.

**SÃ¶mÃ¼rÃ¼ Stratejisi:**

* SSRF, `logo_uri`, `jwks_uri` veya `sector_identifier_uri` gibi parametrelerde kÃ¶tÃ¼ niyetli URL'ler ile yeni bir istemci kaydederek tetiklenebilir.
* `request_uris` aracÄ±lÄ±ÄŸÄ±yla doÄŸrudan sÃ¶mÃ¼rÃ¼, beyaz liste kontrolleri ile hafifletilebilirken, Ã¶nceden kayÄ±tlÄ±, saldÄ±rgan tarafÄ±ndan kontrol edilen bir `request_uri` saÄŸlamak, yetkilendirme aÅŸamasÄ±nda SSRF'yi kolaylaÅŸtÄ±rabilir.

## OAuth saÄŸlayÄ±cÄ±larÄ± YarÄ±ÅŸ KoÅŸullarÄ±

Test ettiÄŸiniz platform bir OAuth saÄŸlayÄ±cÄ±sÄ± ise [**muhtemel YarÄ±ÅŸ KoÅŸullarÄ± iÃ§in bunu okuyun**](race-condition.md).

## Referanslar

* [**https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1**](https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1)
* [**https://portswigger.net/research/hidden-oauth-attack-vectors**](https://portswigger.net/research/hidden-oauth-attack-vectors)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

<details>

<summary><strong>SÄ±fÄ±rdan kahramana AWS hacking Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **HackTricks'te ÅŸirketinizin reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** istiyorsanÄ±z [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu, Ã¶zel [**NFT'lerimizi**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* **ğŸ’¬ Discord grubuna** [**katÄ±lÄ±n**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter'da** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live) **takip edin**.
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ±zÄ± paylaÅŸÄ±n** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
