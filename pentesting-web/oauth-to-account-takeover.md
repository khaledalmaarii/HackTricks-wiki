# OAuth to Account takeover

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Basic Information <a href="#d4a8" id="d4a8"></a>

OAuth, [OAuth 2.0 belgeleri](https://oauth.net/2/) adresinde eriÅŸilebilen temel bilgilerle birlikte Ã§eÅŸitli sÃ¼rÃ¼mler sunar. Bu tartÄ±ÅŸma esas olarak yaygÄ±n olarak kullanÄ±lan [OAuth 2.0 yetkilendirme kodu hibe tÃ¼rÃ¼](https://oauth.net/2/grant-types/authorization-code/) etrafÄ±nda dÃ¶ner ve **bir uygulamanÄ±n baÅŸka bir uygulamadaki bir kullanÄ±cÄ±nÄ±n hesabÄ±na eriÅŸmesini veya eylemler gerÃ§ekleÅŸtirmesini saÄŸlayan bir yetkilendirme Ã§erÃ§evesi** sunar (yetkilendirme sunucusu).

Hayali bir web sitesi _**https://example.com**_ dÃ¼ÅŸÃ¼nÃ¼n; bu site **tÃ¼m sosyal medya gÃ¶nderilerinizi**, Ã¶zel olanlar da dahil olmak Ã¼zere, **sergilemek** iÃ§in tasarlanmÄ±ÅŸtÄ±r. Bunu baÅŸarmak iÃ§in OAuth 2.0 kullanÄ±lÄ±r. _https://example.com_, **sosyal medya gÃ¶nderilerinize eriÅŸim** izni talep edecektir. SonuÃ§ olarak, _https://socialmedia.com_ Ã¼zerinde **talep edilen izinleri ve talebi yapan geliÅŸtiriciyi** belirten bir onay ekranÄ± belirecektir. OnayÄ±nÄ±zla, _https://example.com_, **adÄ±nÄ±za gÃ¶nderilerinize eriÅŸim** saÄŸlama yetkisi kazanÄ±r.

OAuth 2.0 Ã§erÃ§evesindeki aÅŸaÄŸÄ±daki bileÅŸenleri anlamak Ã¶nemlidir:

* **resource owner**: Siz, **kullanÄ±cÄ±/varlÄ±k** olarak, sosyal medya hesabÄ± gÃ¶nderileriniz gibi kaynaÄŸÄ±nÄ±za eriÅŸim izni verirsiniz.
* **resource server**: **EriÅŸim token'Ä±** almÄ±ÅŸ uygulamanÄ±n kimlik doÄŸrulama isteklerini yÃ¶neten **sunucu**, Ã¶rneÄŸin, **https://socialmedia.com**.
* **client application**: `resource owner`'dan yetkilendirme talep eden **uygulama**, Ã¶rneÄŸin, **https://example.com**.
* **authorization server**: `resource owner`'Ä±n baÅŸarÄ±lÄ± bir ÅŸekilde kimlik doÄŸrulamasÄ±nÄ± yaptÄ±ktan sonra `client application`'a **`access tokens`** veren **sunucu**, Ã¶rneÄŸin, **https://socialmedia.com**.
* **client\_id**: Uygulama iÃ§in kamuya aÃ§Ä±k, benzersiz bir tanÄ±mlayÄ±cÄ±.
* **client\_secret:** Sadece uygulama ve yetkilendirme sunucusu tarafÄ±ndan bilinen, `access_tokens` oluÅŸturmak iÃ§in kullanÄ±lan gizli bir anahtar.
* **response\_type**: **Talep edilen token tÃ¼rÃ¼nÃ¼** belirten bir deÄŸer, Ã¶rneÄŸin `code`.
* **scope**: `client application`'Ä±n `resource owner`'dan talep ettiÄŸi **eriÅŸim seviyesi**.
* **redirect\_uri**: **KullanÄ±cÄ±nÄ±n yetkilendirmeden sonra yÃ¶nlendirileceÄŸi URL**. Bu genellikle Ã¶nceden kaydedilmiÅŸ yÃ¶nlendirme URL'si ile uyumlu olmalÄ±dÄ±r.
* **state**: **KullanÄ±cÄ±nÄ±n yetkilendirme sunucusuna yÃ¶nlendirilmesi sÄ±rasÄ±nda verileri korumak iÃ§in** bir parametre. BenzersizliÄŸi, **CSRF koruma mekanizmasÄ±** olarak hizmet etmesi iÃ§in kritik Ã¶neme sahiptir.
* **grant\_type**: **Hibe tÃ¼rÃ¼nÃ¼ ve dÃ¶ndÃ¼rÃ¼lecek token tÃ¼rÃ¼nÃ¼** belirten bir parametre.
* **code**: `authorization server`'dan alÄ±nan yetkilendirme kodu, `client application` tarafÄ±ndan `access_token` almak iÃ§in `client_id` ve `client_secret` ile birlikte kullanÄ±lÄ±r.
* **access\_token**: `resource owner` adÄ±na API istekleri iÃ§in `client application`'Ä±n kullandÄ±ÄŸÄ± **token**.
* **refresh\_token**: UygulamanÄ±n **kullanÄ±cÄ±yÄ± yeniden istemeden yeni bir `access_token` almasÄ±nÄ±** saÄŸlar.

### Flow

**GerÃ§ek OAuth akÄ±ÅŸÄ±** ÅŸu ÅŸekilde ilerler:

1. [https://example.com](https://example.com) adresine gidersiniz ve â€œSosyal Medya ile Entegre Olâ€ butonuna tÄ±klarsÄ±nÄ±z.
2. Site, https://example.com uygulamasÄ±nÄ±n gÃ¶nderilerinize eriÅŸim izni talep etmek iÃ§in [https://socialmedia.com](https://socialmedia.com) adresine bir istek gÃ¶nderir. Ä°stek ÅŸu ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r:
```
https://socialmedia.com/auth
?response_type=code
&client_id=example_clientId
&redirect_uri=https%3A%2F%2Fexample.com%2Fcallback
&scope=readPosts
&state=randomString123
```
3. ArdÄ±ndan bir onay sayfasÄ± ile karÅŸÄ±laÅŸÄ±rsÄ±nÄ±z.  
4. OnayÄ±nÄ±zÄ± takiben, Sosyal Medya `code` ve `state` parametreleri ile `redirect_uri`'ye bir yanÄ±t gÃ¶nderir:
```
https://example.com?code=uniqueCode123&state=randomString123
```
5. https://example.com bu `code`'u, `client_id` ve `client_secret` ile birlikte, sizin adÄ±nÄ±za bir `access_token` almak iÃ§in sunucu tarafÄ±nda bir istek yapmak Ã¼zere kullanÄ±r ve onayladÄ±ÄŸÄ±nÄ±z izinlere eriÅŸim saÄŸlar:
```
POST /oauth/access_token
Host: socialmedia.com
...{"client_id": "example_clientId", "client_secret": "example_clientSecret", "code": "uniqueCode123", "grant_type": "authorization_code"}
```
6. Son olarak, sÃ¼reÃ§ https://example.com `access_token`'Ä±nÄ±zÄ± kullanarak Sosyal Medya'ya eriÅŸmek iÃ§in bir API Ã§aÄŸrÄ±sÄ± yapar.

## GÃ¼venlik AÃ§Ä±klarÄ± <a href="#id-323a" id="id-323a"></a>

### AÃ§Ä±k yÃ¶nlendirme\_uri <a href="#cc36" id="cc36"></a>

`redirect_uri`, OAuth ve OpenID uygulamalarÄ±nda gÃ¼venlik iÃ§in kritik Ã¶neme sahiptir, Ã§Ã¼nkÃ¼ yetkilendirme kodlarÄ± gibi hassas verilerin yetkilendirme sonrasÄ± nereye gÃ¶nderileceÄŸini yÃ¶nlendirir. YanlÄ±ÅŸ yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±nda, saldÄ±rganlarÄ±n bu istekleri kÃ¶tÃ¼ niyetli sunuculara yÃ¶nlendirmesine izin verebilir ve hesap ele geÃ§irme olasÄ±lÄ±ÄŸÄ±nÄ± artÄ±rÄ±r.

SÃ¶mÃ¼rÃ¼ teknikleri, yetkilendirme sunucusunun doÄŸrulama mantÄ±ÄŸÄ±na baÄŸlÄ± olarak deÄŸiÅŸir. KatÄ± yol eÅŸleÅŸtirmeden, belirtilen alan veya alt dizin iÃ§indeki herhangi bir URL'yi kabul etmeye kadar deÄŸiÅŸebilir. YaygÄ±n sÃ¶mÃ¼rÃ¼ yÃ¶ntemleri arasÄ±nda aÃ§Ä±k yÃ¶nlendirmeler, yol geÃ§iÅŸi, zayÄ±f regexlerin istismarÄ± ve token hÄ±rsÄ±zlÄ±ÄŸÄ± iÃ§in HTML enjeksiyonu yer alÄ±r.

`redirect_uri` dÄ±ÅŸÄ±nda, `client_uri`, `policy_uri`, `tos_uri` ve `initiate_login_uri` gibi diÄŸer OAuth ve OpenID parametreleri de yÃ¶nlendirme saldÄ±rÄ±larÄ±na karÅŸÄ± hassastÄ±r. Bu parametreler isteÄŸe baÄŸlÄ±dÄ±r ve destekleri sunucular arasÄ±nda deÄŸiÅŸiklik gÃ¶sterir.

OpenID sunucusunu hedef alanlar iÃ§in, keÅŸif uÃ§ noktasÄ± (`**.well-known/openid-configuration**`) genellikle `registration_endpoint`, `request_uri_parameter_supported` ve "`require_request_uri_registration`" gibi deÄŸerli yapÄ±landÄ±rma ayrÄ±ntÄ±larÄ±nÄ± listeler. Bu ayrÄ±ntÄ±lar, kayÄ±t uÃ§ noktasÄ±nÄ± ve sunucunun diÄŸer yapÄ±landÄ±rma Ã¶zelliklerini belirlemede yardÄ±mcÄ± olabilir.

### YÃ¶nlendirme uygulamasÄ±nda XSS <a href="#bda5" id="bda5"></a>

Bu hata Ã¶dÃ¼lÃ¼ raporunda belirtildiÄŸi gibi [https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html](https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html), yÃ¶nlendirme **URL'sinin sunucunun yanÄ±tÄ±nda yansÄ±tÄ±lmasÄ±** mÃ¼mkÃ¼n olabilir, bu da **XSS'ye karÅŸÄ± savunmasÄ±z** hale getirir. Test etmek iÃ§in olasÄ± yÃ¼k:
```
https://app.victim.com/login?redirectUrl=https://app.victim.com/dashboard</script><h1>test</h1>
```
### CSRF - State parametresinin yanlÄ±ÅŸ yÃ¶netimi <a href="#bda5" id="bda5"></a>

OAuth uygulamalarÄ±nda, **`state` parametresinin** kÃ¶tÃ¼ye kullanÄ±mÄ± veya atlanmasÄ±, **Cross-Site Request Forgery (CSRF)** saldÄ±rÄ±larÄ±nÄ±n riskini Ã¶nemli Ã¶lÃ§Ã¼de artÄ±rabilir. Bu zafiyet, `state` parametresinin ya **kullanÄ±lmamasÄ±, statik bir deÄŸer olarak kullanÄ±lmasÄ± veya dÃ¼zgÃ¼n bir ÅŸekilde doÄŸrulanmamasÄ±** durumunda ortaya Ã§Ä±kar ve saldÄ±rganlarÄ±n CSRF korumalarÄ±nÄ± atlamasÄ±na olanak tanÄ±r.

SaldÄ±rganlar, yetkilendirme sÃ¼recini keserek kendi hesaplarÄ±nÄ± bir maÄŸdurun hesabÄ±yla iliÅŸkilendirebilir, bu da potansiyel **hesap ele geÃ§irmelerine** yol aÃ§ar. Bu, OAuth'un **kimlik doÄŸrulama amaÃ§larÄ±** iÃ§in kullanÄ±ldÄ±ÄŸÄ± uygulamalarda Ã¶zellikle kritik Ã¶neme sahiptir.

Bu zafiyetin gerÃ§ek dÃ¼nya Ã¶rnekleri, Ã§eÅŸitli **CTF yarÄ±ÅŸmalarÄ±** ve **hacking platformlarÄ±** Ã¼zerinde belgelenmiÅŸtir ve pratik etkilerini vurgulamaktadÄ±r. Sorun, **Slack**, **Stripe** ve **PayPal** gibi Ã¼Ã§Ã¼ncÃ¼ taraf hizmetlerle entegrasyonlara da uzanmakta, burada saldÄ±rganlar bildirimleri veya Ã¶demeleri kendi hesaplarÄ±na yÃ¶nlendirebilir.

**`state` parametresinin** doÄŸru yÃ¶netimi ve doÄŸrulanmasÄ±, CSRF'ye karÅŸÄ± korunmak ve OAuth akÄ±ÅŸÄ±nÄ± gÃ¼vence altÄ±na almak iÃ§in kritik Ã¶neme sahiptir.

### Hesap Ele GeÃ§irmeden Ã–nce <a href="#ebe4" id="ebe4"></a>

1. **Hesap OluÅŸturma sÄ±rasÄ±nda E-posta DoÄŸrulamasÄ± Olmadan**: SaldÄ±rganlar, maÄŸdurun e-posta adresini kullanarak Ã¶nceden bir hesap oluÅŸturabilir. EÄŸer maÄŸdur daha sonra bir Ã¼Ã§Ã¼ncÃ¼ taraf hizmeti ile giriÅŸ yaparsa, uygulama bu Ã¼Ã§Ã¼ncÃ¼ taraf hesabÄ±nÄ± saldÄ±rganÄ±n Ã¶nceden oluÅŸturduÄŸu hesapla yanlÄ±ÅŸlÄ±kla iliÅŸkilendirebilir ve yetkisiz eriÅŸime yol aÃ§abilir.
2. **GevÅŸek OAuth E-posta DoÄŸrulamasÄ±nÄ± KÃ¶tÃ¼ye Kullanma**: SaldÄ±rganlar, e-postalarÄ± doÄŸrulamayan OAuth hizmetlerini kÃ¶tÃ¼ye kullanarak kendi hizmetleriyle kaydolabilir ve ardÄ±ndan hesap e-posta adresini maÄŸdurunki ile deÄŸiÅŸtirebilir. Bu yÃ¶ntem, ilk senaryoya benzer ÅŸekilde yetkisiz hesap eriÅŸimi riski taÅŸÄ±r, ancak farklÄ± bir saldÄ±rÄ± vektÃ¶rÃ¼ aracÄ±lÄ±ÄŸÄ±yla.

### Gizli Bilgilerin AÃ§Ä±ÄŸa Ã‡Ä±kmasÄ± <a href="#e177" id="e177"></a>

Gizli OAuth parametrelerini tanÄ±mlamak ve korumak Ã§ok Ã¶nemlidir. **`client_id`** gÃ¼venle ifÅŸa edilebilirken, **`client_secret`** ifÅŸa edilmesi Ã¶nemli riskler taÅŸÄ±r. EÄŸer `client_secret` ele geÃ§irilirse, saldÄ±rganlar uygulamanÄ±n kimliÄŸini ve gÃ¼venini kÃ¶tÃ¼ye kullanarak **kullanÄ±cÄ± `access_tokens`** ve Ã¶zel bilgileri Ã§alabilir.

UygulamalarÄ±n yetkilendirme `code`'unu `access_token` ile istemci tarafÄ±nda deÄŸil, sunucu tarafÄ±nda yanlÄ±ÅŸlÄ±kla yÃ¶netmesi durumunda yaygÄ±n bir zafiyet ortaya Ã§Ä±kar. Bu hata, `client_secret`'in aÃ§Ä±ÄŸa Ã§Ä±kmasÄ±na yol aÃ§ar ve saldÄ±rganlarÄ±n uygulamanÄ±n kimliÄŸini kullanarak `access_tokens` oluÅŸturmasÄ±na olanak tanÄ±r. AyrÄ±ca, sosyal mÃ¼hendislik yoluyla, saldÄ±rganlar OAuth yetkilendirmesine ek kapsamlar ekleyerek ayrÄ±calÄ±klarÄ± artÄ±rabilir ve uygulamanÄ±n gÃ¼venilir durumunu daha da kÃ¶tÃ¼ye kullanabilir.

### Client Secret Bruteforce

Bir hizmet saÄŸlayÄ±cÄ±nÄ±n client\_secret'ini Ã§almak iÃ§in kimlik saÄŸlayÄ±cÄ± ile **bruteforce** yapmayÄ± deneyebilirsiniz.\
BF isteÄŸi ÅŸu ÅŸekilde gÃ¶rÃ¼nebilir:
```
POST /token HTTP/1.1
content-type: application/x-www-form-urlencoded
host: 10.10.10.10:3000
content-length: 135
Connection: close

code=77515&redirect_uri=http%3A%2F%2F10.10.10.10%3A3000%2Fcallback&grant_type=authorization_code&client_id=public_client_id&client_secret=[bruteforce]
```
### Referer Header leaking Code + State

MÃ¼ÅŸteri **kod ve durum** bilgilerine sahip olduÄŸunda, eÄŸer bu bilgiler **Referer baÅŸlÄ±ÄŸÄ±nda yansÄ±tÄ±lÄ±yorsa** ve farklÄ± bir sayfaya gÃ¶z atÄ±yorsa, o zaman bu aÃ§Ä±k durumdadÄ±r.

### Access Token Stored in Browser History

**TarayÄ±cÄ± geÃ§miÅŸine gidin ve access token'Ä±n orada kaydedilip kaydedilmediÄŸini kontrol edin.**

### Everlasting Authorization Code

**Yetkilendirme kodu, bir saldÄ±rganÄ±n onu Ã§alabileceÄŸi ve kullanabileceÄŸi zaman penceresini sÄ±nÄ±rlamak iÃ§in sadece bir sÃ¼re boyunca geÃ§erli olmalÄ±dÄ±r.**

### Authorization/Refresh Token not bound to client

EÄŸer **yetkilendirme kodunu alabilir ve bunu farklÄ± bir istemci ile kullanabilirseniz, diÄŸer hesaplarÄ± ele geÃ§irebilirsiniz.**

### Happy Paths, XSS, Iframes & Post Messages to leak code & state values

[**Bu yazÄ±yÄ± kontrol edin**](https://labs.detectify.com/writeups/account-hijacking-using-dirty-dancing-in-sign-in-oauth-flows/#gadget-2-xss-on-sandbox-third-party-domain-that-gets-the-url)

### AWS Cognito <a href="#bda5" id="bda5"></a>

Bu hata Ã¶dÃ¼l raporunda: [**https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/**](https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/) **AWS Cognito** tarafÄ±ndan kullanÄ±cÄ±ya geri verilen **token'Ä±n, kullanÄ±cÄ± verilerini Ã¼zerine yazmak iÃ§in yeterli izinlere sahip olabileceÄŸini** gÃ¶rebilirsiniz. Bu nedenle, eÄŸer **bir kullanÄ±cÄ± e-posta adresini farklÄ± bir kullanÄ±cÄ± e-posta adresi ile deÄŸiÅŸtirebilirseniz**, diÄŸer hesaplarÄ± **ele geÃ§irebilirsiniz.**
```bash
# Read info of the user
aws cognito-idp get-user --region us-east-1 --access-token eyJraWQiOiJPVj[...]

# Change email address
aws cognito-idp update-user-attributes --region us-east-1 --access-token eyJraWQ[...] --user-attributes Name=email,Value=imaginary@flickr.com
{
"CodeDeliveryDetailsList": [
{
"Destination": "i***@f***.com",
"DeliveryMedium": "EMAIL",
"AttributeName": "email"
}
]
}
```
For more detailed info about how to abuse AWS cognito check:

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/aws-pentesting/aws-unauthenticated-enum-access/aws-cognito-unauthenticated-enum" %}

### Abusing other Apps tokens <a href="#bda5" id="bda5"></a>

As [**mentioned in this writeup**](https://salt.security/blog/oh-auth-abusing-oauth-to-take-over-millions-of-accounts), OAuth akÄ±ÅŸlarÄ± **token** (ve kod deÄŸil) almayÄ± bekliyorsa, token'Ä±n uygulamaya ait olduÄŸunu kontrol etmedikleri takdirde savunmasÄ±z olabilirler.

Bu, bir **saldÄ±rganÄ±n** kendi uygulamasÄ±nda **OAuth destekleyen ve Facebook ile giriÅŸ yapan bir uygulama** oluÅŸturabileceÄŸi anlamÄ±na gelir. ArdÄ±ndan, bir kurban **saldÄ±rganÄ±n uygulamasÄ±nda** Facebook ile giriÅŸ yaptÄ±ÄŸÄ±nda, saldÄ±rgan **kullanÄ±cÄ±nÄ±n uygulamasÄ±na verilen OAuth token'Ä±nÄ± alabilir ve bunu kurbanÄ±n OAuth uygulamasÄ±nda kurbanÄ±n kullanÄ±cÄ± token'Ä± ile giriÅŸ yapmak iÃ§in kullanabilir**.

{% hint style="danger" %}
Bu nedenle, saldÄ±rgan kendi OAuth uygulamasÄ±na kullanÄ±cÄ± eriÅŸimini elde ederse, token bekleyen ve token'Ä±n kendi uygulama kimliÄŸine verilip verilmediÄŸini kontrol etmeyen uygulamalarda kurbanÄ±n hesabÄ±nÄ± ele geÃ§irebilir.
{% endhint %}

### Two links & cookie <a href="#bda5" id="bda5"></a>

According to [**this writeup**](https://medium.com/@metnew/why-electron-apps-cant-store-your-secrets-confidentially-inspect-option-a49950d6d51f), bir kurbanÄ±n saldÄ±rganÄ±n ana bilgisayarÄ±na iÅŸaret eden bir **returnUrl** ile bir sayfa aÃ§masÄ± saÄŸlanabiliyordu. Bu bilgi **bir Ã§erezde (RU)** saklanacak ve **sonraki adÄ±mda** **istem** **kullanÄ±cÄ±ya** o saldÄ±rganÄ±n ana bilgisayarÄ±na eriÅŸim vermek isteyip istemediÄŸini **soracaktÄ±r**.

Bu istemi atlatmak iÃ§in, **returnUrl** kullanarak bu RU Ã§erezini ayarlayacak bir **Oauth akÄ±ÅŸÄ±nÄ±** baÅŸlatmak iÃ§in bir sekme aÃ§mak, istem gÃ¶sterilmeden Ã¶nce sekmeyi kapatmak ve o deÄŸeri iÃ§ermeyen yeni bir sekme aÃ§mak mÃ¼mkÃ¼ndÃ¼. BÃ¶ylece, **istem saldÄ±rganÄ±n ana bilgisayarÄ± hakkÄ±nda bilgi vermeyecek**, ancak Ã§erez ona ayarlanacak, bu nedenle **token saldÄ±rganÄ±n ana bilgisayarÄ±na** yÃ¶nlendirme sÄ±rasÄ±nda gÃ¶nderilecektir.

### Prompt Interaction Bypass <a href="#bda5" id="bda5"></a>

As explained in [**this video**](https://www.youtube.com/watch?v=n9x7\_J\_a\_7Q), bazÄ± OAuth uygulamalarÄ±, kullanÄ±cÄ±larÄ±n platformda zaten oturum aÃ§mÄ±ÅŸlarsa webde verilen eriÅŸimi onaylamalarÄ± iÃ§in **`prompt`** GET parametresini None (**`&prompt=none`**) olarak belirtmelerine izin verir.

### response\_mode

As [**explained in this video**](https://www.youtube.com/watch?v=n9x7\_J\_a\_7Q), kodun son URL'de nerede saÄŸlanmasÄ±nÄ± istediÄŸinizi belirtmek iÃ§in **`response_mode`** parametresini belirtmek mÃ¼mkÃ¼n olabilir:

* `response_mode=query` -> Kod bir GET parametresi iÃ§inde saÄŸlanÄ±r: `?code=2397rf3gu93f`
* `response_mode=fragment` -> Kod URL parÃ§asÄ± parametresi iÃ§inde saÄŸlanÄ±r `#code=2397rf3gu93f`
* `response_mode=form_post` -> Kod, `code` adÄ±nda bir girdi ile bir POST formu iÃ§inde saÄŸlanÄ±r ve deÄŸer
* `response_mode=web_message` -> Kod bir post mesajÄ±nda gÃ¶nderilir: `window.opener.postMessage({"code": "asdasdasd...`

### SSRFs parameters <a href="#bda5" id="bda5"></a>

[**Check this research**](https://portswigger.net/research/hidden-oauth-attack-vectors) **For further details of this technique.**

OAuth'taki Dinamik Ä°stemci KaydÄ±, gÃ¼venlik aÃ§Ä±klarÄ± iÃ§in daha az belirgin ama kritik bir vektÃ¶r olarak hizmet eder, Ã¶zellikle **Sunucu TarafÄ± Ä°stek SahteciliÄŸi (SSRF)** saldÄ±rÄ±larÄ± iÃ§in. Bu uÃ§ nokta, OAuth sunucularÄ±nÄ±n istemci uygulamalarÄ± hakkÄ±nda, istismar edilebilecek hassas URL'ler de dahil olmak Ã¼zere, ayrÄ±ntÄ±lar almasÄ±na olanak tanÄ±r.

**Ana Noktalar:**

* **Dinamik Ä°stemci KaydÄ±** genellikle `/register` ile eÅŸleÅŸtirilir ve `client_name`, `client_secret`, `redirect_uris` ve logo veya JSON Web Key Sets (JWK'ler) iÃ§in URL'ler gibi ayrÄ±ntÄ±larÄ± POST istekleri aracÄ±lÄ±ÄŸÄ±yla kabul eder.
* Bu Ã¶zellik, **RFC7591** ve **OpenID Connect Registration 1.0**'da belirtilen spesifikasyonlara uyar ve SSRF'ye karÅŸÄ± potansiyel olarak savunmasÄ±z olabilecek parametreleri iÃ§erir.
* KayÄ±t sÃ¼reci, istemcileri birkaÃ§ ÅŸekilde SSRF'ye maruz bÄ±rakabilir:
* **`logo_uri`**: Sunucu tarafÄ±ndan alÄ±nabilecek istemci uygulamasÄ±nÄ±n logosu iÃ§in bir URL, SSRF'yi tetikleyebilir veya URL yanlÄ±ÅŸ yÃ¶netilirse XSS'ye yol aÃ§abilir.
* **`jwks_uri`**: Ä°stemcinin JWK belgesine giden bir URL, kÃ¶tÃ¼ niyetle oluÅŸturulursa, sunucunun saldÄ±rgan kontrolÃ¼ndeki bir sunucuya dÄ±ÅŸa dÃ¶nÃ¼k istekler yapmasÄ±na neden olabilir.
* **`sector_identifier_uri`**: Sunucunun alabileceÄŸi `redirect_uris` JSON dizisini referans alÄ±r, bu da SSRF fÄ±rsatÄ± yaratÄ±r.
* **`request_uris`**: Ä°stemci iÃ§in izin verilen istek URI'lerini listeler, bu URI'ler yetkilendirme sÃ¼recinin baÅŸlangÄ±cÄ±nda sunucu tarafÄ±ndan alÄ±nÄ±rsa istismar edilebilir.

**Ä°stismar Stratejisi:**

* SSRF, `logo_uri`, `jwks_uri` veya `sector_identifier_uri` gibi parametrelerde kÃ¶tÃ¼ niyetli URL'lerle yeni bir istemci kaydederek tetiklenebilir.
* `request_uris` aracÄ±lÄ±ÄŸÄ±yla doÄŸrudan istismar, beyaz liste kontrolleri ile azaltÄ±labilirken, Ã¶nceden kaydedilmiÅŸ, saldÄ±rgan kontrolÃ¼ndeki bir `request_uri` saÄŸlamak, yetkilendirme aÅŸamasÄ±nda SSRF'yi kolaylaÅŸtÄ±rabilir.

## OAuth providers Race Conditions

If the platform you are testing is an OAuth provider [**read this to test for possible Race Conditions**](race-condition.md).

## References

* [**https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1**](https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1)
* [**https://portswigger.net/research/hidden-oauth-attack-vectors**](https://portswigger.net/research/hidden-oauth-attack-vectors)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
