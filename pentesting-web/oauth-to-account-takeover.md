# OAuth HesabÄ± Ele GeÃ§irmek Ä°Ã§in

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizin **HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki Ã¶zel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Temel Bilgiler <a href="#d4a8" id="d4a8"></a>

OAuth, [OAuth 2.0 belgelerinde](https://oauth.net/2/) eriÅŸilebilir olan Ã§eÅŸitli sÃ¼rÃ¼mler sunar. Bu tartÄ±ÅŸma, temel olarak bir uygulamanÄ±n baÅŸka bir uygulamadaki bir kullanÄ±cÄ±nÄ±n hesabÄ±na eriÅŸim veya iÅŸlem yapmasÄ±nÄ± saÄŸlayan bir **yetkilendirme Ã§erÃ§evesi olan OAuth 2.0 yetkilendirme kodu grant tÃ¼rÃ¼ne** odaklanÄ±r.

Bir Ã¶rnek web sitesi olan _**https://example.com**_, Ã¶zel olanlar dahil olmak Ã¼zere **tÃ¼m sosyal medya gÃ¶nderilerinizi sergilemek** iÃ§in OAuth 2.0 kullanÄ±r. Bunun iÃ§in _https://example.com_, **sosyal medya gÃ¶nderilerinize eriÅŸim izni** isteyecektir. SonuÃ§ olarak, _https://socialmedia.com_ Ã¼zerinde bir onay ekranÄ± gÃ¶rÃ¼necek ve **istenen izinler ve istekte bulunan geliÅŸtirici** belirtilecektir. Sizin onayÄ±nÄ±zla, _https://example.com_, sizin adÄ±nÄ±za **gÃ¶nderilerinize eriÅŸme yeteneÄŸi kazanÄ±r**.

OAuth 2.0 Ã§erÃ§evesi iÃ§inde aÅŸaÄŸÄ±daki bileÅŸenleri anlamak Ã¶nemlidir:

- **kaynak sahibi**: Siz, **kullanÄ±cÄ±/Ã¶ÄŸe** olarak, sosyal medya hesabÄ±nÄ±z gibi kaynaÄŸÄ±nÄ±za eriÅŸime izin verirsiniz.
- **kaynak sunucusu**: Uygulama, `eriÅŸim belirteci`ni `kaynak sahibi` adÄ±na gÃ¼vence altÄ±na aldÄ±ktan sonra yetkilendirilmiÅŸ istekleri yÃ¶neten **kimlik doÄŸrulamasÄ± yapÄ±lan sunucu**, Ã¶rneÄŸin **https://socialmedia.com**.
- **istemci uygulamasÄ±**: `kaynak sahibi`nden yetkilendirme isteyen **uygulama**, Ã¶rneÄŸin **https://example.com**.
- **yetkilendirme sunucusu**: `kaynak sahibi`nin baÅŸarÄ±lÄ± kimlik doÄŸrulamasÄ±nÄ± ve yetkilendirmeyi takiben `eriÅŸim belirteci`ni `istemci uygulamasÄ±na` veren **sunucu**, Ã¶rneÄŸin **https://socialmedia.com**.
- **client\_id**: Uygulama iÃ§in genel, benzersiz bir tanÄ±mlayÄ±cÄ±.
- **client\_secret**: YalnÄ±zca uygulama ve yetkilendirme sunucusu tarafÄ±ndan bilinen gizli bir anahtar, `eriÅŸim belirteci` oluÅŸturmak iÃ§in kullanÄ±lÄ±r.
- **response\_type**: Ä°stenen belirteÃ§ tÃ¼rÃ¼nÃ¼ belirten bir deÄŸer, Ã¶rneÄŸin `code`.
- **scope**: `istemci uygulamasÄ±nÄ±n` `kaynak sahibinden` istediÄŸi **eriÅŸim dÃ¼zeyi**.
- **redirect\_uri**: Yetkilendirme sonrasÄ±nda kullanÄ±cÄ±nÄ±n yÃ¶nlendirildiÄŸi **URL**. Bu genellikle Ã¶nceden kaydedilmiÅŸ yÃ¶nlendirme URL'siyle uyumlu olmalÄ±dÄ±r.
- **state**: Verilerin kullanÄ±cÄ±nÄ±n yetkilendirme sunucusuna yÃ¶nlendirilmesi ve sunucudan geri yÃ¶nlendirilmesi sÄ±rasÄ±nda **verilerin korunmasÄ± iÃ§in bir parametre**. BenzersizliÄŸi, **CSRF koruma mekanizmasÄ±** olarak Ã¶nemlidir.
- **grant\_type**: Ä°zin tÃ¼rÃ¼nÃ¼ ve dÃ¶ndÃ¼rÃ¼lecek belirteÃ§ tÃ¼rÃ¼nÃ¼ belirten bir parametre.
- **code**: `yetkilendirme sunucusundan` alÄ±nan yetkilendirme kodu, `istemci uygulamasÄ±` tarafÄ±ndan `client_id` ve `client_secret` ile birlikte kullanÄ±larak bir `eriÅŸim belirteci` elde etmek iÃ§in kullanÄ±lÄ±r.
- **access\_token**: `istemci uygulamasÄ±nÄ±n` API isteklerinde kullanacaÄŸÄ± **belirteÃ§**, `kaynak sahibi` adÄ±na.
- **refresh\_token**: UygulamanÄ±n kullanÄ±cÄ±yÄ± tekrar sormadan yeni bir `eriÅŸim belirteci` elde etmesini saÄŸlar.

### AkÄ±ÅŸ

**GerÃ§ek OAuth akÄ±ÅŸÄ±** aÅŸaÄŸÄ±daki gibi ilerler:

1. [https://example.com](https://example.com) adresine gidip "Sosyal Medya ile Entegre Ol" dÃ¼ÄŸmesini seÃ§ersiniz.
2. Site, https://example.com'un uygulamasÄ±nÄ±n gÃ¶nderilerinize eriÅŸim saÄŸlamasÄ± iÃ§in sizin izniniz istenmesi iÃ§in [https://socialmedia.com](https://socialmedia.com) adresine bir istek gÃ¶nderir. Ä°stek aÅŸaÄŸÄ±daki gibi yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r:
```
https://socialmedia.com/auth
?response_type=code
&client_id=example_clientId
&redirect_uri=https%3A%2F%2Fexample.com%2Fcallback
&scope=readPosts
&state=randomString123
```
3. ArdÄ±ndan bir onay sayfasÄ±yla karÅŸÄ±laÅŸÄ±rsÄ±nÄ±z.

4. OnayÄ±nÄ±zÄ± takiben, Sosyal Medya `redirect_uri`'ye `code` ve `state` parametreleriyle bir yanÄ±t gÃ¶nderir:
```
https://example.com?code=uniqueCode123&state=randomString123
```
5. https://example.com, bu `code`'u, `client_id` ve `client_secret` ile birlikte kullanarak sizin adÄ±nÄ±za bir sunucu tarafÄ± isteÄŸi yapar ve sizin onayladÄ±ÄŸÄ±nÄ±z izinlere eriÅŸim saÄŸlamak iÃ§in bir `access_token` elde eder:
```
POST /oauth/access_token
Host: socialmedia.com
...{"client_id": "example_clientId", "client_secret": "example_clientSecret", "code": "uniqueCode123", "grant_type": "authorization_code"}
```
6. Son olarak, sÃ¼reÃ§ https://example.com'un `access_token`'Ä± kullanarak Sosyal Medya'ya eriÅŸmek iÃ§in bir API Ã§aÄŸrÄ±sÄ± yapmasÄ±yla sonuÃ§lanÄ±r.

## ZayÄ±flÄ±klar <a href="#323a" id="323a"></a>

### AÃ§Ä±k redirect\_uri <a href="#cc36" id="cc36"></a>

`redirect_uri`, OAuth ve OpenID uygulamalarÄ±nda gÃ¼venlik aÃ§Ä±sÄ±ndan Ã¶nemlidir Ã§Ã¼nkÃ¼ yetkilendirme sonrasÄ±nda yetkilendirme kodlarÄ± gibi hassas verilerin gÃ¶nderildiÄŸi yeri yÃ¶nlendirir. YanlÄ±ÅŸ yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±nda, saldÄ±rganlarÄ±n bu istekleri kÃ¶tÃ¼ amaÃ§lÄ± sunuculara yÃ¶nlendirmesine izin vererek hesap ele geÃ§irmesine olanak tanÄ±yabilir.

SÃ¶mÃ¼rÃ¼ teknikleri, yetkilendirme sunucusunun doÄŸrulama mantÄ±ÄŸÄ±na baÄŸlÄ± olarak deÄŸiÅŸir. Bunlar, katÄ± yol eÅŸleÅŸtirmesinden belirtilen etki alanÄ± veya alt dizindeki herhangi bir URL'yi kabul etmeye kadar uzanabilir. YaygÄ±n sÃ¶mÃ¼rÃ¼ yÃ¶ntemleri arasÄ±nda aÃ§Ä±k yÃ¶nlendirmeler, yol geÃ§iÅŸi, zayÄ±f regexlerin sÃ¶mÃ¼rÃ¼lmesi ve belirteÃ§ hÄ±rsÄ±zlÄ±ÄŸÄ± iÃ§in HTML enjeksiyonu bulunur.

`redirect_uri` dÄ±ÅŸÄ±nda, `client_uri`, `policy_uri`, `tos_uri` ve `initiate_login_uri` gibi diÄŸer OAuth ve OpenID parametreleri de yÃ¶nlendirme saldÄ±rÄ±larÄ±na karÅŸÄ± savunmasÄ±z olabilir. Bu parametreler isteÄŸe baÄŸlÄ±dÄ±r ve destekleri sunucular arasÄ±nda deÄŸiÅŸir.

OpenID sunucusunu hedefleyenler iÃ§in keÅŸif ucu noktasÄ± (`**.well-known/openid-configuration**`), `registration_endpoint`, `request_uri_parameter_supported` ve "`require_request_uri_registration` gibi deÄŸerli yapÄ±landÄ±rma ayrÄ±ntÄ±larÄ±nÄ± genellikle listeler. Bu ayrÄ±ntÄ±lar, sunucunun kayÄ±t ucu noktasÄ±nÄ± ve diÄŸer yapÄ±landÄ±rma ayrÄ±ntÄ±larÄ±nÄ± belirlemeye yardÄ±mcÄ± olabilir.

### YÃ¶nlendirme uygulamasÄ±nda XSS <a href="#bda5" id="bda5"></a>

Bu hata avÄ± raporunda [https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html](https://blog.dixitaditya.com/2021/11/19/account-takeover-chain.html) belirtildiÄŸi gibi, kullanÄ±cÄ±nÄ±n kimlik doÄŸrulamasÄ±ndan sonra sunucunun yanÄ±tÄ±nda **URL'nin yansÄ±tÄ±ldÄ±ÄŸÄ±** ve **XSS'ye karÅŸÄ± savunmasÄ±z** olabileceÄŸi mÃ¼mkÃ¼ndÃ¼r. Test etmek iÃ§in olasÄ± yÃ¼k:
```
https://app.victim.com/login?redirectUrl=https://app.victim.com/dashboard</script><h1>test</h1>
```
### CSRF - Durum parametresinin yanlÄ±ÅŸ iÅŸlenmesi <a href="#bda5" id="bda5"></a>

OAuth uygulamalarÄ±nda **`state` parametresinin** yanlÄ±ÅŸ kullanÄ±lmasÄ± veya atlanmasÄ±, **Cross-Site Request Forgery (CSRF)** saldÄ±rÄ±larÄ±nÄ±n riskini Ã¶nemli Ã¶lÃ§Ã¼de artÄ±rabilir. Bu gÃ¼venlik aÃ§Ä±ÄŸÄ±, `state` parametresinin ya **kullanÄ±lmamasÄ±, sabit bir deÄŸer olarak kullanÄ±lmasÄ± veya doÄŸru ÅŸekilde doÄŸrulanmamasÄ±** durumunda ortaya Ã§Ä±kar ve saldÄ±rganlarÄ±n CSRF korumalarÄ±nÄ± atlamasÄ±na izin verir.

SaldÄ±rganlar, yetkilendirme sÃ¼recini araya girerek kendi hesaplarÄ±nÄ± kurbanÄ±n hesabÄ±yla baÄŸlayarak potansiyel **hesap ele geÃ§irmelerine** yol aÃ§abilirler. Bu durum Ã¶zellikle OAuth'nin **kimlik doÄŸrulama amaÃ§lÄ±** kullanÄ±ldÄ±ÄŸÄ± uygulamalarda kritik Ã¶neme sahiptir.

Bu gÃ¼venlik aÃ§Ä±ÄŸÄ±na iliÅŸkin gerÃ§ek dÃ¼nya Ã¶rnekleri, Ã§eÅŸitli **CTF zorluklarÄ±** ve **hacking platformlarÄ±** tarafÄ±ndan belgelenmiÅŸ ve pratik sonuÃ§larÄ±nÄ± ortaya koymuÅŸtur. Sorun, **Slack**, **Stripe** ve **PayPal** gibi Ã¼Ã§Ã¼ncÃ¼ taraf hizmetlerle olan entegrasyonlara da uzanÄ±r ve saldÄ±rganlar bildirimleri veya Ã¶demeleri kendi hesaplarÄ±na yÃ¶nlendirebilirler.

CSRF'ye karÅŸÄ± korunmak ve OAuth akÄ±ÅŸÄ±nÄ± gÃ¼vence altÄ±na almak iÃ§in **`state` parametresinin** doÄŸru ÅŸekilde iÅŸlenmesi ve doÄŸrulanmasÄ± Ã¶nemlidir.

### Hesap Ele GeÃ§irme Ã–ncesi <a href="#ebe4" id="ebe4"></a>

1. **Hesap OluÅŸturmada E-posta DoÄŸrulamasÄ± OlmaksÄ±zÄ±n**: SaldÄ±rganlar, kurbanÄ±n e-postasÄ±nÄ± kullanarak Ã¶nceden bir hesap oluÅŸturabilirler. Kurban daha sonra giriÅŸ iÃ§in Ã¼Ã§Ã¼ncÃ¼ taraf bir hizmet kullanÄ±rsa, uygulama yanlÄ±ÅŸlÄ±kla bu Ã¼Ã§Ã¼ncÃ¼ taraf hesabÄ±nÄ± saldÄ±rganÄ±n Ã¶nceden oluÅŸturduÄŸu hesapla iliÅŸkilendirebilir ve yetkisiz eriÅŸime yol aÃ§abilir.

2. **GeÃ§erli Olmayan OAuth E-posta DoÄŸrulamasÄ±nÄ±n SÃ¶mÃ¼rÃ¼lmesi**: SaldÄ±rganlar, e-postalarÄ± doÄŸrulamayan OAuth hizmetlerini sÃ¶mÃ¼rebilirler. Bunun iÃ§in kendi servislerine kaydolup hesap e-postasÄ±nÄ± kurbanÄ±n e-postasÄ±yla deÄŸiÅŸtirirler. Bu yÃ¶ntem, ilk senaryoya benzer ÅŸekilde yetkisiz hesap eriÅŸimine yol aÃ§ar, ancak farklÄ± bir saldÄ±rÄ± vektÃ¶rÃ¼ kullanÄ±r.

### SÄ±rlarÄ±n AÃ§Ä±ÄŸa Ã‡Ä±karÄ±lmasÄ± <a href="#e177" id="e177"></a>

Gizli OAuth parametrelerinin belirlenmesi ve korunmasÄ± Ã¶nemlidir. **`client_id`** gÃ¼venli bir ÅŸekilde aÃ§Ä±klanabilirken, **`client_secret`**'in aÃ§Ä±ÄŸa Ã§Ä±karÄ±lmasÄ± Ã¶nemli riskler oluÅŸturur. EÄŸer `client_secret` tehlikeye dÃ¼ÅŸerse, saldÄ±rganlar uygulamanÄ±n kimliÄŸini ve gÃ¼venini sÃ¶mÃ¼rerek kullanÄ±cÄ± `access_token`'larÄ±nÄ± ve Ã¶zel bilgileri Ã§alabilirler.

YaygÄ±n bir gÃ¼venlik aÃ§Ä±ÄŸÄ±, uygulamalarÄ±n yetkilendirme `code`'unun `access_token` ile deÄŸiÅŸimini sunucu tarafÄ± yerine istemci tarafÄ±nda yanlÄ±ÅŸ ÅŸekilde iÅŸlemesidir. Bu hata, `client_secret`'in aÃ§Ä±ÄŸa Ã§Ä±kmasÄ±na neden olur ve saldÄ±rganlarÄ±n uygulama adÄ±na `access_token` Ã¼retmesine olanak tanÄ±r. DahasÄ±, sosyal mÃ¼hendislik yoluyla saldÄ±rganlar, OAuth yetkilendirmesine ek kapsamlar ekleyerek ayrÄ±calÄ±klarÄ± artÄ±rabilir ve uygulamanÄ±n gÃ¼venilir durumunu daha da sÃ¶mÃ¼rebilirler.

### Ä°stemci Gizli Kuvvet SaldÄ±rÄ±sÄ±

HesaplarÄ± Ã§almak iÃ§in hizmet saÄŸlayÄ±cÄ±nÄ±n **istemci gizli kuvvetini kaba kuvvetle deneyebilirsiniz**.\
BF'ye yÃ¶nelik istek benzer olabilir:
```
POST /token HTTP/1.1
content-type: application/x-www-form-urlencoded
host: 10.10.10.10:3000
content-length: 135
Connection: close

code=77515&redirect_uri=http%3A%2F%2F10.10.10.10%3A3000%2Fcallback&grant_type=authorization_code&client_id=public_client_id&client_secret=[bruteforce]
```
### Referer BaÅŸlÄ±ÄŸÄ± SÄ±zdÄ±ran Kod + Durum

Ä°stemci, **kod ve durumu** aldÄ±ktan sonra, farklÄ± bir sayfaya gÃ¶z attÄ±ÄŸÄ±nda **Referer baÅŸlÄ±ÄŸÄ± iÃ§inde yansÄ±tÄ±lÄ±yorsa**, bu zayÄ±f bir noktadÄ±r.

### EriÅŸim Belirteci TarayÄ±cÄ± GeÃ§miÅŸinde SaklanÄ±yor

TarayÄ±cÄ± geÃ§miÅŸine gidin ve **eriÅŸim belirtecinin orada kaydedilip kaydedilmediÄŸini kontrol edin**.

### Sonsuz Yetkilendirme Kodu

**Yetkilendirme kodu, saldÄ±rganÄ±n Ã§alÄ±p kullanabileceÄŸi zaman penceresini sÄ±nÄ±rlamak iÃ§in sadece belirli bir sÃ¼re yaÅŸamalÄ±dÄ±r**.

### Yetkilendirme/Yenileme Belirteci, istemciye baÄŸlÄ± deÄŸil

**Yetkilendirme kodunu alabilir ve farklÄ± bir istemciyle kullanabilirseniz, baÅŸka hesaplarÄ± ele geÃ§irebilirsiniz**.

### Mutlu Yollar, XSS, Ä°frame'ler ve Kod & Durum DeÄŸerlerini sÄ±zdÄ±rmak iÃ§in GÃ¶nderi MesajlarÄ±

**[Bu gÃ¶nderiyi kontrol edin](https://labs.detectify.com/writeups/account-hijacking-using-dirty-dancing-in-sign-in-oauth-flows/#gadget-2-xss-on-sandbox-third-party-domain-that-gets-the-url)**

### AWS Cognito <a href="#bda5" id="bda5"></a>

Bu hata avÄ± raporunda: [**https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/**](https://security.lauritz-holtmann.de/advisories/flickr-account-takeover/) **AWS Cognito**'nun kullanÄ±cÄ±ya geri verdiÄŸi **belirtecin**, kullanÄ±cÄ± verilerini **Ã¼zerine yazmak iÃ§in yeterli izinlere sahip olabileceÄŸini** gÃ¶rebilirsiniz. Bu nedenle, **farklÄ± bir kullanÄ±cÄ± e-postasÄ± iÃ§in kullanÄ±cÄ± e-postasÄ±nÄ± deÄŸiÅŸtirebilirseniz**, baÅŸkalarÄ±nÄ±n hesaplarÄ±nÄ± ele geÃ§irebilirsiniz.
```bash
# Read info of the user
aws cognito-idp get-user --region us-east-1 --access-token eyJraWQiOiJPVj[...]

# Change email address
aws cognito-idp update-user-attributes --region us-east-1 --access-token eyJraWQ[...] --user-attributes Name=email,Value=imaginary@flickr.com
{
"CodeDeliveryDetailsList": [
{
"Destination": "i***@f***.com",
"DeliveryMedium": "EMAIL",
"AttributeName": "email"
}
]
}
```
Daha detaylÄ± bilgi iÃ§in AWS Cognito'yu nasÄ±l kÃ¶tÃ¼ye kullanacaÄŸÄ±nÄ±zÄ± kontrol edin:

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/aws-pentesting/aws-unauthenticated-enum-access/aws-cognito-unauthenticated-enum" %}

### DiÄŸer Uygulama TokenlarÄ±nÄ±n KÃ¶tÃ¼ye KullanÄ±lmasÄ± <a href="#bda5" id="bda5"></a>

[**Bu yazÄ±da belirtildiÄŸi gibi**](https://salt.security/blog/oh-auth-abusing-oauth-to-take-over-millions-of-accounts), **token** (ve bir kod deÄŸil) bekleyen OAuth akÄ±ÅŸlarÄ±, tokenÄ±n uygulamaya ait olup olmadÄ±ÄŸÄ±nÄ± kontrol etmezse savunmasÄ±z olabilir.

Bu, bir **saldÄ±rganÄ±n** kendi uygulamasÄ±nda OAuth'yi destekleyen ve Facebook ile giriÅŸ yapabilen bir **uygulama oluÅŸturabileceÄŸi** anlamÄ±na gelir. ArdÄ±ndan, bir kurbanÄ±n Facebook ile **saldÄ±rganÄ±n uygulamasÄ±nda** oturum aÃ§masÄ± durumunda, saldÄ±rgan, kurbanÄ±n OAuth uygulamasÄ±na verilen **kullanÄ±cÄ± tokenÄ±nÄ± alabilir ve kurbanÄ±n kullanÄ±cÄ± tokenÄ± kullanÄ±larak kurbanÄ±n OAuth uygulamasÄ±na giriÅŸ yapabilir**.

{% hint style="danger" %}
Bu nedenle, saldÄ±rgan kullanÄ±cÄ±nÄ±n kendi OAuth uygulamasÄ±na eriÅŸmesini saÄŸlarsa, tokenÄ±n uygulama kimliklerine verilip verilmediÄŸini kontrol etmeyen uygulamalarda kurbanÄ±n hesabÄ±nÄ± ele geÃ§irebilir.
{% endhint %}

### Ä°ki baÄŸlantÄ± ve Ã§erez <a href="#bda5" id="bda5"></a>

[**Bu yazÄ±da belirtildiÄŸi gibi**](https://medium.com/@metnew/why-electron-apps-cant-store-your-secrets-confidentially-inspect-option-a49950d6d51f), bir kurbanÄ±n saldÄ±rganÄ±n ana bilgisayarÄ±na yÃ¶nlendiren bir **returnUrl**'ye sahip bir sayfayÄ± aÃ§masÄ± mÃ¼mkÃ¼ndÃ¼. Bu bilgi bir **Ã§erezde (RU)** saklanacak ve bir **sonraki adÄ±mda** **prompt**, **kullanÄ±cÄ±ya** bu saldÄ±rganÄ±n ana bilgisayarÄ±na eriÅŸim vermek isteyip istemediÄŸini **soracaktÄ±r**.

Bu prompt'u atlamak iÃ§in, **Oauth akÄ±ÅŸÄ±nÄ± baÅŸlatan** ve bu RU Ã§erezini **returnUrl** kullanarak ayarlayan bir sekme aÃ§mak, prompt gÃ¶sterilmeden Ã¶nce sekme kapatmak ve bu deÄŸeri olmadan yeni bir sekme aÃ§mak mÃ¼mkÃ¼ndÃ¼. ArdÄ±ndan, **prompt saldÄ±rganÄ±n ana bilgisayarÄ±nÄ± bilgilendirmeyecek**, ancak Ã§erez ona ayarlanacak, bu nedenle **token yÃ¶nlendirmede saldÄ±rganÄ±n ana bilgisayarÄ±na gÃ¶nderilecektir**.

### SSRF parametreleri <a href="#bda5" id="bda5"></a>

**Bu tekniÄŸin daha ayrÄ±ntÄ±lÄ± bilgileri iÃ§in [bu araÅŸtÄ±rmayÄ± kontrol edin](https://portswigger.net/research/hidden-oauth-attack-vectors).**

OAuth'da Dinamik Ä°stemci KaydÄ±, Ã¶zellikle **Sunucu TarafÄ± Ä°stek SahteciliÄŸi (SSRF)** saldÄ±rÄ±larÄ± iÃ§in daha az aÃ§Ä±k ama kritik bir vektÃ¶r olarak hizmet verir. Bu uÃ§ nokta, OAuth sunucularÄ±nÄ±n hassas URL'leri de dahil olmak Ã¼zere istemci uygulamalarÄ± hakkÄ±nda ayrÄ±ntÄ±larÄ± almasÄ±na olanak tanÄ±r ve bu URL'lerin kÃ¶tÃ¼ye kullanÄ±lmasÄ±na neden olabilir.

**Ana Noktalar:**

- **Dinamik Ä°stemci KaydÄ±** genellikle `/register` ile eÅŸleÅŸtirilir ve `client_name`, `client_secret`, `redirect_uris` ve POST istekleri aracÄ±lÄ±ÄŸÄ±yla logolar veya JSON Web Anahtar Setleri (JWK'ler) iÃ§in URL'ler gibi ayrÄ±ntÄ±larÄ± kabul eder.
- Bu Ã¶zellik, SSRF'ye aÃ§Ä±k olabilen parametrelere sahip **RFC7591** ve **OpenID Connect Registration 1.0** tarafÄ±ndan belirlenen Ã¶zelliklere uyar.
- KayÄ±t sÃ¼reci, sunucularÄ± yanlÄ±ÅŸlÄ±kla SSRF'ye aÃ§abilir:
- **`logo_uri`**: Sunucu tarafÄ±ndan alÄ±nabilecek istemci uygulamasÄ±nÄ±n logosu iÃ§in bir URL, bu da SSRF'yi tetikleyebilir veya URL yanlÄ±ÅŸ iÅŸlenirse XSS'ye yol aÃ§abilir.
- **`jwks_uri`**: Ä°stemcinin JWK belgesine bir URL, kÃ¶tÃ¼ niyetli olarak oluÅŸturulursa sunucunun saldÄ±rgan tarafÄ±ndan kontrol edilen bir sunucuya Ã§Ä±kÄ±ÅŸ istekleri yapmasÄ±na neden olabilir.
- **`sector_identifier_uri`**: Sunucu tarafÄ±ndan alÄ±nabilecek bir `redirect_uris` JSON dizisine referans verir, bu da SSRF fÄ±rsatÄ± yaratabilir.
- **`request_uris`**: Ä°stemci iÃ§in izin verilen istek URI'lerini listeler, sunucunun yetkilendirme sÃ¼recinin baÅŸÄ±nda bu URI'leri alÄ±rsa kÃ¶tÃ¼ye kullanÄ±labilir.

**SÃ¶mÃ¼rÃ¼ Stratejisi:**

- SSRF, `logo_uri`, `jwks_uri` veya `sector_identifier_uri` gibi parametrelerde kÃ¶tÃ¼ niyetli URL'lerle yeni bir istemci kaydederek tetiklenebilir.
- `request_uris` aracÄ±lÄ±ÄŸÄ±yla doÄŸrudan sÃ¶mÃ¼rÃ¼, beyaz liste kontrolleri tarafÄ±ndan hafifletilebilirken, Ã¶nceden kaydedilmiÅŸ, saldÄ±rgan tarafÄ±ndan kontrol edilen bir `request_uri` saÄŸlamak, yetkilendirme aÅŸamasÄ±nda SSRF'yi kolaylaÅŸtÄ±rabilir.

## OAuth saÄŸlayÄ±cÄ±larÄ± YarÄ±ÅŸ KoÅŸullarÄ±

Test ettiÄŸiniz platform bir OAuth saÄŸlayÄ±cÄ± ise, [**mÃ¼mkÃ¼n olan YarÄ±ÅŸ KoÅŸullarÄ±nÄ± test etmek iÃ§in bunu okuyun**](race-condition.md).

## Referanslar

* [**https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1**](https://medium.com/a-bugz-life/the-wondeful-world-of-oauth-bug-bounty-edition-af3073b354c1)
* [**https://portswigger.net/research/hidden-oauth-attack-vectors**](https://portswigger.net/research/hidden-oauth-attack-vectors)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklam vermek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da takip edin ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live).
* Hacking hilelerinizi gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek katkÄ±da bulunun.

</details>
