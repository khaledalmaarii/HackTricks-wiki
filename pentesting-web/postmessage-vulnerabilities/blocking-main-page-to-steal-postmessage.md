# Blokiranje glavne stranice da bi se ukrao postmessage

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Radite li u **kompaniji za kiberneti캜ku bezbednost**? 콯elite li da vidite svoju **kompaniju reklamiranu na HackTricks-u**? Ili 쬰lite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru쬴te se** [**游눫**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 游냕[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## Pobeda RC-ova sa Iframe-ovima

Prema ovom [**Terjanq writeup-u**](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710) blob dokumenti kreirani iz null origin-a su izolovani radi bezbednosti, 코to zna캜i da ako odr쬬vate zauzetu glavnu stranicu, iframe stranica 캖e biti izvr코ena.

U su코tini, u tom izazovu se izvr코ava **izolovani iframe** i **odmah nakon** 코to se **u캜ita**, **roditeljska** stranica 캖e **poslati post** poruku sa **flag-om**.\
Me캠utim, ta komunikacija putem postmessage-a je **ranjiva na XSS** (iframe mo쬰 izvr코iti JS kod).

Stoga, cilj napada캜a je da **omogu캖i roditelju da kreira iframe**, ali **pre nego 코to** roditeljska stranica **po코alje** osetljive podatke (**flag**), **dr쬴 je zauzetom** i 코alje **payload iframe-u**. Dok je **roditelj zauzet**, **iframe izvr코ava payload** koji 캖e biti neki JS kod koji 캖e slu코ati **postmessage poruku roditelja i procuriti flag**.\
Na kraju, iframe je izvr코io payload i roditeljska stranica prestaje biti zauzeta, pa 코alje flag i payload ga otkriva.

Ali kako mo쬰te u캜initi da roditelj bude **zauzet odmah nakon 코to generi코e iframe i samo dok 캜eka da iframe bude spreman da po코alje osetljive podatke?** U su코tini, trebate prona캖i **asinhronu akciju** koju mo쬰te da izvr코ite na roditelju. Na primer, u tom izazovu roditelj je **slu코ao** post poruke na slede캖i na캜in:
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
tako je bilo mogu캖e poslati **veliki celi broj u postmessage** koji 캖e biti **pretvoren u string** u toj pore캠enju, 코to 캖e oduzeti neko vreme:
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
I kako biste bili precizni i **poslali** taj **postmessage** odmah **nakon** 코to je **iframe** kreiran, ali **pre** nego 코to je spreman da primi podatke od roditelja, mora캖ete da **manipuli코ete milisekundama `setTimeout`**.

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **cybersecurity kompaniji**? 콯elite li da vidite svoju **kompaniju reklamiranu na HackTricks-u**? Ili 쬰lite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru쬴te se** [**游눫**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 游냕[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
