# PostMessage'yi Ã§almak iÃ§in ana sayfayÄ± engelleme

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramanla Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

* Bir **cybersecurity ÅŸirketinde** Ã§alÄ±ÅŸÄ±yor musunuz? **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** ister misiniz? veya **PEASS'Ä±n en son sÃ¼rÃ¼mÃ¼ne veya HackTricks'i PDF olarak indirmek** ister misiniz? [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonunu
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter**'da takip edin ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Hacking hilelerinizi [hacktricks repo](https://github.com/carlospolop/hacktricks) ve [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)'ya PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Iframe'lerle RC Kazanma

Bu [**Terjanq yazÄ±sÄ±na**](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710) gÃ¶re, null kÃ¶kenlerinden oluÅŸturulan blob belgeleri gÃ¼venlik avantajÄ± iÃ§in izole edilir, bu da demektir ki eÄŸer ana sayfayÄ± meÅŸgul tutarsanÄ±z, iframe sayfasÄ± Ã§alÄ±ÅŸtÄ±rÄ±lacak.

Temel olarak, bu zorlukta **izole edilmiÅŸ bir iframe Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r** ve hemen **ardÄ±ndan** yÃ¼klendikten sonra **ana** sayfa **bayrakla bir post** mesajÄ± gÃ¶nderecektir.\
Ancak, bu postmessage iletiÅŸimi **XSS'ye karÅŸÄ± savunmasÄ±zdÄ±r** (**iframe** JS kodunu Ã§alÄ±ÅŸtÄ±rabilir).

Bu nedenle, saldÄ±rganÄ±n amacÄ±, **ebeveynin iframe'i oluÅŸturmasÄ±na izin vermek**, ancak **Ã¶nce** **ebeveyn** sayfanÄ±n **duyarlÄ± veriyi (bayrak)** **meÅŸgul tutmak** ve **payload'Ä± iframe'e gÃ¶ndermek**. **Ebeveyn meÅŸgulken**, **iframe payload'Ä±** Ã§alÄ±ÅŸtÄ±rÄ±r ve **ebeveyn postmessage mesajÄ±nÄ± dinler ve bayraÄŸÄ± sÄ±zdÄ±rÄ±r**.\
Sonunda, iframe payload'Ä± Ã§alÄ±ÅŸtÄ±rdÄ± ve ebeveyn sayfa meÅŸgul olmaktan Ã§Ä±ktÄ±, bu yÃ¼zden bayraÄŸÄ± gÃ¶nderir ve payload onu sÄ±zdÄ±rÄ±r.

Ancak, **ebeveyn iframe'i oluÅŸturduktan hemen sonra meÅŸgul olmasÄ±nÄ± ve iframe'in duyarlÄ± veriyi gÃ¶ndermeye hazÄ±r olana kadar meÅŸgul olmasÄ±nÄ±** nasÄ±l saÄŸlayabilirsiniz? Temel olarak, ebeveynin **yÃ¼rÃ¼tmesini saÄŸlayabileceÄŸiniz async bir eylem** bulmanÄ±z gerekiyor. Ã–rneÄŸin, bu zorlukta ebeveyn ÅŸu ÅŸekilde **postmessage'larÄ± dinliyordu**:
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
Bu durumda, postMessage ile gÃ¶nderilen bir **bÃ¼yÃ¼k tamsayÄ±yÄ±** karÅŸÄ±laÅŸtÄ±rmada **dizeye dÃ¶nÃ¼ÅŸtÃ¼rmek** mÃ¼mkÃ¼ndÃ¼ ve bu iÅŸlem biraz zaman alacaktÄ±:
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
Ve **postmessage**'i **gÃ¶ndermek** iÃ§in, **iframe** oluÅŸturulduktan hemen sonra, ebeveyninden veri almak iÃ§in hazÄ±r hale gelmeden Ã¶nce **setTimeout**'in milisaniyeleriyle oynamanÄ±z gerekecektir.

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

* Bir **cybersecurity ÅŸirketinde** Ã§alÄ±ÅŸÄ±yor musunuz? **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** ister misiniz? veya **PEASS'Ä±n en son sÃ¼rÃ¼mÃ¼ne veya HackTricks'i PDF olarak indirmek** ister misiniz? [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonunu.
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter**'da beni takip edin ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Hacking hilelerinizi [hacktricks repo](https://github.com/carlospolop/hacktricks) ve [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)'ya PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
