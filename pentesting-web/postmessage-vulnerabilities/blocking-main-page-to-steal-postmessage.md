# Blocking main page to steal postmessage

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Winning RCs with Iframes

ì´ [**Terjanq writeup**](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710)ì— ë”°ë¥´ë©´, null originì—ì„œ ìƒì„±ëœ blob ë¬¸ì„œëŠ” ë³´ì•ˆìƒì˜ ì´ì ìœ¼ë¡œ ê²©ë¦¬ë˜ì–´ ìˆìœ¼ë©°, ì´ëŠ” ë©”ì¸ í˜ì´ì§€ê°€ ë°”ì˜ë©´ iframe í˜ì´ì§€ê°€ ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ ì´ ë„ì „ì—ì„œ **ê²©ë¦¬ëœ iframeì´ ì‹¤í–‰**ë˜ê³  ë°”ë¡œ **ë¡œë“œëœ í›„** **ë¶€ëª¨** í˜ì´ì§€ê°€ **í”Œë˜ê·¸**ì™€ í•¨ê»˜ **post** ë©”ì‹œì§€ë¥¼ **ë³´ëƒ…ë‹ˆë‹¤**.\
ê·¸ëŸ¬ë‚˜ ê·¸ postmessage í†µì‹ ì€ **XSSì— ì·¨ì•½**í•©ë‹ˆë‹¤( **iframe**ì´ JS ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤).

ë”°ë¼ì„œ ê³µê²©ìì˜ ëª©í‘œëŠ” **ë¶€ëª¨ê°€ iframeì„ ìƒì„±í•˜ê²Œ** í•˜ë˜, **ë¶€ëª¨** í˜ì´ì§€ê°€ **ë¯¼ê°í•œ ë°ì´í„°(í”Œë˜ê·¸)**ë¥¼ **ë³´ë‚´ê¸° ì „ì—** **ë°”ì˜ê²Œ ìœ ì§€**í•˜ê³  **payloadë¥¼ iframeìœ¼ë¡œ ë³´ë‚´ëŠ”** ê²ƒì…ë‹ˆë‹¤. **ë¶€ëª¨ê°€ ë°”ì  ë•Œ** **iframeì€ payloadë¥¼ ì‹¤í–‰**í•˜ë©°, ì´ëŠ” **ë¶€ëª¨ postmessage ë©”ì‹œì§€ë¥¼ ë“£ê³  í”Œë˜ê·¸ë¥¼ ìœ ì¶œí•˜ëŠ”** JSê°€ ë  ê²ƒì…ë‹ˆë‹¤.\
ë§ˆì§€ë§‰ìœ¼ë¡œ, iframeì´ payloadë¥¼ ì‹¤í–‰í•˜ê³  ë¶€ëª¨ í˜ì´ì§€ê°€ ë°”ì˜ì§€ ì•Šê²Œ ë˜ë©´, í”Œë˜ê·¸ë¥¼ ë³´ë‚´ê³  payloadê°€ ì´ë¥¼ ìœ ì¶œí•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ë¶€ëª¨ê°€ **iframeì„ ìƒì„±í•œ ì§í›„ì— ë°”ì˜ê²Œ ë§Œë“¤ê³ , ë¯¼ê°í•œ ë°ì´í„°ë¥¼ ë³´ë‚´ê¸° ìœ„í•´ iframeì´ ì¤€ë¹„ë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ì–´ë–»ê²Œ í•  ìˆ˜ ìˆì„ê¹Œìš”?** ê¸°ë³¸ì ìœ¼ë¡œ ë¶€ëª¨ê°€ **ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”** **ë¹„ë™ê¸°** **ì‘ì—…**ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì´ ë„ì „ì—ì„œ ë¶€ëª¨ëŠ” ë‹¤ìŒê³¼ ê°™ì´ **postmessages**ë¥¼ **ë“£ê³ ** ìˆì—ˆìŠµë‹ˆë‹¤:
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
ê·¸ë˜ì„œ **postmessage**ì—ì„œ **í° ì •ìˆ˜ë¥¼ ë³´ë‚´ëŠ”** ê²ƒì´ ê°€ëŠ¥í–ˆìœ¼ë©°, ì´ëŠ” ê·¸ ë¹„êµì—ì„œ **ë¬¸ìì—´ë¡œ ë³€í™˜ë ** ê²ƒì´ê³ , ì‹œê°„ì´ ì¢€ ê±¸ë¦´ ê²ƒì…ë‹ˆë‹¤:
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
ì •í™•í•˜ê²Œ **postmessage**ë¥¼ **iframe**ì´ ìƒì„±ëœ **í›„**ì—, ê·¸ëŸ¬ë‚˜ ë¶€ëª¨ë¡œë¶€í„° ë°ì´í„°ë¥¼ ë°›ì„ ì¤€ë¹„ê°€ **ë˜ê¸° ì „ì—** **setTimeout**ì˜ ë°€ë¦¬ì´ˆë¥¼ **ì¡°ì •**í•´ì•¼ í•©ë‹ˆë‹¤.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
