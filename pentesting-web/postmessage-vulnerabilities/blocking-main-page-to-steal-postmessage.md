# Blocking main page to steal postmessage

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Winning RCs with Iframes

Laut diesem [**Terjanq writeup**](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710) werden Blobs, die aus null Urspr√ºngen erstellt wurden, aus Sicherheitsgr√ºnden isoliert, was bedeutet, dass, wenn Sie die Hauptseite besch√§ftigt halten, die Iframe-Seite ausgef√ºhrt wird.

Im Grunde genommen wird in dieser Herausforderung ein **isoliertes Iframe ausgef√ºhrt** und direkt **nachdem** es **geladen** wurde, wird die **Eltern**-Seite eine **post**-Nachricht mit dem **Flag** **senden**.\
Diese postmessage-Kommunikation ist jedoch **anf√§llig f√ºr XSS** (das **iframe** kann JS-Code ausf√ºhren).

Daher besteht das Ziel des Angreifers darin, die **Elternseite das Iframe erstellen zu lassen**, aber **bevor** die **Eltern**-Seite die sensiblen Daten (**Flag**) **sendet**, **sie besch√§ftigt zu halten** und die **Payload an das Iframe** zu senden. W√§hrend die **Elternseite besch√§ftigt ist**, f√ºhrt das **Iframe die Payload aus**, die ein JS sein wird, das auf die **postmessage-Nachricht der Elternseite h√∂rt und das Flag leakt**.\
Schlie√ülich hat das Iframe die Payload ausgef√ºhrt und die Elternseite h√∂rt auf, besch√§ftigt zu sein, sodass sie das Flag sendet und die Payload es leakt.

Aber wie k√∂nnten Sie die Elternseite **besch√§ftigt machen, direkt nachdem sie das Iframe generiert hat und nur w√§hrend sie darauf wartet, dass das Iframe bereit ist, die sensiblen Daten zu senden?** Im Grunde genommen m√ºssen Sie eine **asynchrone** **Aktion** finden, die Sie die Elternseite **ausf√ºhren** lassen k√∂nnen. Zum Beispiel h√∂rte die Elternseite in dieser Herausforderung auf **postmessages** wie folgt:
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
so war es m√∂glich, eine **gro√üe Ganzzahl in einer postmessage** zu senden, die in diesem Vergleich **in einen String umgewandelt** wird, was einige Zeit in Anspruch nehmen wird:
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
Und um genau zu sein und diese **postmessage** genau **nach** der Erstellung des **iframes** aber **vor** dem **bereit** zu senden, um die Daten vom Elternteil zu empfangen, m√ºssen Sie mit den Millisekunden eines `setTimeout` **spielen**.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
