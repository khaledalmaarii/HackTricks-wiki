# é˜»æ­¢ä¸»é¡µé¢ä»¥çªƒå– postmessage

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## ä½¿ç”¨ Iframes èµ¢å¾— RCs

æ ¹æ®è¿™ç¯‡ [**Terjanq æ–‡ç« **](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710)ï¼Œä»ç©ºæºåˆ›å»ºçš„ blob æ–‡æ¡£å‡ºäºå®‰å…¨åŸå› æ˜¯éš”ç¦»çš„ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ è®©ä¸»é¡µé¢ä¿æŒå¿™ç¢Œï¼Œiframe é¡µé¢å°†ä¼šè¢«æ‰§è¡Œã€‚

åŸºæœ¬ä¸Šï¼Œåœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­ï¼Œä¸€ä¸ª **éš”ç¦»çš„ iframe è¢«æ‰§è¡Œ**ï¼Œå¹¶ä¸”åœ¨å®ƒ **åŠ è½½å**ï¼Œ**çˆ¶**é¡µé¢å°†ä¼š **å‘é€ä¸€ä¸ª post** æ¶ˆæ¯ï¼ŒåŒ…å« **flag**ã€‚\
ç„¶è€Œï¼Œè¿™ä¸ª postmessage é€šä¿¡æ˜¯ **æ˜“å— XSS æ”»å‡»çš„**ï¼ˆ**iframe** å¯ä»¥æ‰§è¡Œ JS ä»£ç ï¼‰ã€‚

å› æ­¤ï¼Œæ”»å‡»è€…çš„ç›®æ ‡æ˜¯ **è®©çˆ¶é¡µé¢åˆ›å»º iframe**ï¼Œä½† **åœ¨** è®© **çˆ¶**é¡µé¢ **å‘é€** æ•æ„Ÿæ•°æ®ï¼ˆ**flag**ï¼‰ä¹‹å‰ **ä¿æŒå®ƒå¿™ç¢Œ**ï¼Œå¹¶å°† **æœ‰æ•ˆè½½è·å‘é€åˆ° iframe**ã€‚å½“ **çˆ¶é¡µé¢å¿™ç¢Œæ—¶**ï¼Œ**iframe æ‰§è¡Œæœ‰æ•ˆè½½è·**ï¼Œè¿™å°†æ˜¯ä¸€äº› JS ä»£ç ï¼Œç”¨äºç›‘å¬ **çˆ¶ postmessage æ¶ˆæ¯å¹¶æ³„éœ² flag**ã€‚\
æœ€åï¼Œiframe æ‰§è¡Œäº†æœ‰æ•ˆè½½è·ï¼Œçˆ¶é¡µé¢åœæ­¢å¿™ç¢Œï¼Œå› æ­¤å®ƒå‘é€äº† flagï¼Œä¸”æœ‰æ•ˆè½½è·æ³„éœ²äº†å®ƒã€‚

ä½†æ˜¯ä½ å¦‚ä½•èƒ½è®©çˆ¶é¡µé¢åœ¨ **ç”Ÿæˆ iframe åç«‹å³å¿™ç¢Œï¼Œå¹¶ä¸”åœ¨ç­‰å¾… iframe å‡†å¤‡å¥½å‘é€æ•æ„Ÿæ•°æ®æ—¶ä¿æŒå¿™ç¢Œå‘¢ï¼Ÿ** åŸºæœ¬ä¸Šï¼Œä½ éœ€è¦æ‰¾åˆ° **å¼‚æ­¥** **æ“ä½œ**ï¼Œè®©çˆ¶é¡µé¢ **æ‰§è¡Œ**ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­ï¼Œçˆ¶é¡µé¢ **ç›‘å¬** **postmessages** å¦‚ä¸‹ï¼š
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
æ‰€ä»¥å¯ä»¥åœ¨ **postmessage** ä¸­å‘é€ä¸€ä¸ª **å¤§æ•´æ•°**ï¼Œåœ¨æ¯”è¾ƒä¸­ä¼šè¢« **è½¬æ¢ä¸ºå­—ç¬¦ä¸²**ï¼Œè¿™å°†éœ€è¦ä¸€äº›æ—¶é—´ï¼š
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
ä¸ºäº†ç²¾ç¡®åœ°**å‘é€**è¯¥**postmessage**ï¼Œåœ¨**iframe**åˆ›å»ºåä½†åœ¨å…¶**å‡†å¤‡å¥½**æ¥æ”¶æ¥è‡ªçˆ¶çº§çš„æ•°æ®ä¹‹å‰ï¼Œæ‚¨éœ€è¦**è°ƒæ•´`setTimeout`çš„æ¯«ç§’æ•°**ã€‚

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
