# Blocking main page to steal postmessage

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Winning RCs with Iframes

Prema ovom [**Terjanq writeup**](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710) blob dokumenti kreirani iz null izvora su izolovani zbog bezbednosnih prednosti, 코to zna캜i da ako zadr쬴te glavnu stranicu zauzetom, stranica iframe 캖e biti izvr코ena.

U su코tini, u tom izazovu **izolovani iframe se izvr코ava** i odmah **nakon** 코to je **u캜itan**, **roditeljska** stranica 캖e **poslati post** poruku sa **flagom**.\
Me캠utim, ta postmessage komunikacija je **vulnerable to XSS** (**iframe** mo쬰 izvr코iti JS kod).

Stoga, cilj napada캜a je da **omogu캖i roditelju da kreira iframe**, ali **pre nego 코to** roditeljska stranica **po코alje** osetljive podatke (**flag**) **dr쬴 je zauzetom** i po코alje **payload u iframe**. Dok je **roditelj zauzet**, **iframe izvr코ava payload** koji 캖e biti neki JS koji 캖e slu코ati za **roditelj postmessage poruku i leakovati flag**.\
Na kraju, iframe je izvr코io payload i roditeljska stranica prestaje da bude zauzeta, tako da 코alje flag i payload ga leakuje.

Ali kako biste mogli da u캜inite da roditelj bude **zauzet odmah nakon 코to je generisao iframe i samo dok 캜eka da iframe bude spreman da po코alje osetljive podatke?** U su코tini, treba da prona캠ete **async** **akciju** koju mo쬰te naterati roditelja da **izvr코i**. Na primer, u tom izazovu roditelj je **slu코ao** **postmessages** ovako:
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
tako da je bilo mogu캖e poslati **veliki ceo broj u postmessage** koji 캖e biti **pretvoren u string** u toj uporedbi, 코to 캖e potrajati neko vreme:
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
I da biste bili precizni i **poslali** tu **postmessage** odmah **nakon** 코to je **iframe** kreiran, ali **pre** nego 코to bude **spreman** da primi podatke od roditelja, mora캖ete da **igrate sa milisekundama `setTimeout`**.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
