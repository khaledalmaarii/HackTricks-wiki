# Blocking main page to steal postmessage

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Winning RCs with Iframes

According to this [**Terjanq writeup**](https://gist.github.com/terjanq/7c1a71b83db5e02253c218765f96a710) blob documents created from null origins are isolated for security benefits, which means that if you maintain busy the main page, the iframe page is going to be executed.

åŸºæœ¬çš„ã«ã“ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã§ã¯ã€**å­¤ç«‹ã—ãŸiframeãŒå®Ÿè¡Œã•ã‚Œ**ã€**èª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œ**ã«**è¦ª**ãƒšãƒ¼ã‚¸ãŒ**ãƒ•ãƒ©ã‚°**ã‚’å«ã‚€**post**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’**é€ä¿¡**ã—ã¾ã™ã€‚\
ã—ã‹ã—ã€ãã®postmessageé€šä¿¡ã¯**XSSã«è„†å¼±**ã§ã™ï¼ˆ**iframe**ã¯JSã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼‰ã€‚

ã—ãŸãŒã£ã¦ã€æ”»æ’ƒè€…ã®ç›®æ¨™ã¯**è¦ªã«iframeã‚’ä½œæˆã•ã›ã‚‹**ã“ã¨ã§ã™ãŒã€**è¦ª**ãƒšãƒ¼ã‚¸ãŒ**æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ï¼ˆ**ãƒ•ãƒ©ã‚°**ï¼‰ã‚’**é€ä¿¡**ã™ã‚‹å‰ã«**ãã‚Œã‚’**å¿™ã—ãã•ã›**ã€**ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’iframeã«é€ä¿¡**ã•ã›ã‚‹ã“ã¨ã§ã™ã€‚**è¦ªãŒå¿™ã—ã„é–“**ã€**iframeã¯ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ**ã—ã€ã“ã‚Œã¯**è¦ªã®postmessageãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒªãƒƒã‚¹ãƒ³ã—ã€ãƒ•ãƒ©ã‚°ã‚’æ¼æ´©**ã•ã›ã‚‹JSã«ãªã‚Šã¾ã™ã€‚\
æœ€çµ‚çš„ã«ã€iframeã¯ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã€è¦ªãƒšãƒ¼ã‚¸ã¯å¿™ã—ã•ã‚’ã‚„ã‚ã‚‹ã®ã§ã€ãƒ•ãƒ©ã‚°ã‚’é€ä¿¡ã—ã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒãã‚Œã‚’æ¼æ´©ã•ã›ã¾ã™ã€‚

ã—ã‹ã—ã€ã©ã®ã‚ˆã†ã«ã—ã¦è¦ªã‚’**iframeã‚’ç”Ÿæˆã—ãŸç›´å¾Œã«å¿™ã—ãã•ã›ã€iframeãŒæ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹æº–å‚™ãŒã§ãã‚‹ã®ã‚’å¾…ã£ã¦ã„ã‚‹é–“ã ã‘å¿™ã—ãã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ** åŸºæœ¬çš„ã«ã€**éåŒæœŸ**ã®**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ã¦ã€è¦ªã«**å®Ÿè¡Œ**ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€ã“ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã§ã¯è¦ªãŒ**postmessages**ã‚’æ¬¡ã®ã‚ˆã†ã«**ãƒªãƒƒã‚¹ãƒ³**ã—ã¦ã„ã¾ã—ãŸï¼š
```javascript
window.addEventListener('message', (e) => {
if (e.data == 'blob loaded') {
$("#previewModal").modal();
}
});
```
ãã®ãŸã‚ã€**postmessageã§å¤§ããªæ•´æ•°ã‚’é€ä¿¡ã™ã‚‹**ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚Šã€ãã®æ¯”è¼ƒã§**æ–‡å­—åˆ—ã«å¤‰æ›ã•ã‚Œã‚‹**ãŸã‚ã€æ™‚é–“ãŒã‹ã‹ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ï¼š
```bash
const buffer = new Uint8Array(1e7);
win?.postMessage(buffer, '*', [buffer.buffer]);
```
ãã—ã¦ã€æ­£ç¢ºã«**postmessage**ã‚’**iframe**ãŒä½œæˆã•ã‚ŒãŸ**å¾Œ**ã€ã—ã‹ã—è¦ªã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹æº–å‚™ãŒã§ãã‚‹**å‰**ã«**é€ä¿¡**ã™ã‚‹ãŸã‚ã«ã¯ã€`setTimeout`ã®ãƒŸãƒªç§’ã‚’**èª¿æ•´**ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
