# Bypassovanje Nginx ACL pravila pomo캖u manipulacije putanjom <a href="#heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules" id="heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules"></a>

Tehnike [iz ovog istra쬴vanja](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies).

Primer Nginx pravila:
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
### **NodeJS - Express**

| Nginx verzija | **Node.js Karakteri za Obila쬰nje** |
| ------------- | ----------------------------- |
| 1.22.0        | `\xA0`                        |
| 1.21.6        | `\xA0`                        |
| 1.20.2        | `\xA0`, `\x09`, `\x0C`        |
| 1.18.0        | `\xA0`, `\x09`, `\x0C`        |
| 1.16.1        | `\xA0`, `\x09`, `\x0C`        |

### **Flask**

| Nginx verzija | **Flask Karakteri za Obila쬰nje**                                    |
| ------------- | -------------------------------------------------------------- |
| 1.22.0        | `\x85`, `\xA0`                                                 |
| 1.21.6        | `\x85`, `\xA0`                                                 |
| 1.20.2        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.18.0        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.16.1        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |

### **Spring Boot**

| Nginx verzija | **Spring Boot Karakteri za Obila쬰nje** |
| ------------- | --------------------------------- |
| 1.22.0        | `;`                               |
| 1.21.6        | `;`                               |
| 1.20.2        | `\x09`, `;`                       |
| 1.18.0        | `\x09`, `;`                       |
| 1.16.1        | `\x09`, `;`                       |

### **PHP-FPM**

Konfiguracija Nginx FPM:
```plaintext
location = /admin.php {
deny all;
}

location ~ \.php$ {
include snippets/fastcgi-php.conf;
fastcgi_pass unix:/run/php/php8.1-fpm.sock;
}
```
Nginx je konfigurisan da blokira pristup `/admin.php`, ali je mogu캖e zaobi캖i to pristupanjem `/admin.php/index.php`.

### Kako spre캜iti
```plaintext
location ~* ^/admin {
deny all;
}
```
## Bypassovanje Mod Security pravila <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a>

### Konfuzija putanje

[U ovom postu](https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/) je obja코njeno da ModSecurity v3 (do 3.0.12), **nepropisno implementirao promenljivu `REQUEST_FILENAME`** koja je trebalo da sadr쬴 pristupljenu putanju (do po캜etka parametara). To je zato 코to je vr코io URL dekodiranje da bi dobio putanju.\
Stoga, zahtev poput `http://example.com/foo%3f';alert(1);foo=` u mod security 캖e pretpostaviti da je putanja samo `/foo` jer se `%3f` transformi코e u `?` zavr코avaju캖i URL putanju, ali zapravo putanja koju 캖e server primiti 캖e biti `/foo%3f';alert(1);foo=`.

Promenljive `REQUEST_BASENAME` i `PATH_INFO` tako캠e su bile pogo캠ene ovim bagom.

Ne코to sli캜no se dogodilo u verziji 2 Mod Security-ja koja je omogu캖ila zaobila쬰nje za코tite koja je spre캜avala korisnika da pristupi fajlovima sa specifi캜nim ekstenzijama vezanim za rezervne kopije fajlova (kao 코to su `.bak`) jednostavno slanjem ta캜ke URL enkodiranu u `%2e`, na primer: `https://example.com/backup%2ebak`.

## Bypassovanje AWS WAF ACL <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a>

### Deformisani zaglavlje

[Ovo istra쬴vanje](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies) pominje da je bilo mogu캖e zaobi캖i AWS WAF pravila primenjena na HTTP zaglavlja slanjem "deformisanog" zaglavlja koje nije bilo pravilno parsirano od strane AWS-a, ali jeste od strane serverske aplikacije.

Na primer, slanjem slede캖eg zahteva sa SQL injection-om u zaglavlju X-Query:
```http
GET / HTTP/1.1\r\n
Host: target.com\r\n
X-Query: Value\r\n
\t' or '1'='1' -- \r\n
Connection: close\r\n
\r\n
```
## Reference

* [https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)
* [https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/](https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
