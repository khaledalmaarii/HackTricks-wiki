# Passwortzur√ºcksetz-Token-Leck √ºber Referrer

* Der HTTP Referer-Header kann den Passwortzur√ºcksetz-Token leaken, wenn er in der URL enthalten ist. Dies kann passieren, wenn ein Benutzer auf einen Link einer Drittanbieter-Website klickt, nachdem er eine Passwortzur√ºcksetzung angefordert hat.
* **Auswirkungen**: Potenzieller Konto√ºbernahme durch Cross-Site Request Forgery (CSRF)-Angriffe.
* **Ausnutzung**: Um zu √ºberpr√ºfen, ob ein Passwortzur√ºcksetz-Token im Referer-Header geleakt wird, **fordern Sie eine Passwortzur√ºcksetzung** an Ihre E-Mail-Adresse an und **klicken Sie auf den bereitgestellten Zur√ºcksetzlink**. **√Ñndern Sie Ihr Passwort** nicht sofort. Stattdessen **navigieren Sie zu einer Drittanbieter-Website** (wie Facebook oder Twitter), w√§hrend Sie **die Anfragen mit Burp Suite abfangen**. √úberpr√ºfen Sie die Anfragen, um zu sehen, ob der **Referer-Header den Passwortzur√ºcksetz-Token enth√§lt**, da dies sensible Informationen an Dritte offenlegen k√∂nnte.
* **Referenzen**:
* [HackerOne Bericht 342693](https://hackerone.com/reports/342693)
* [HackerOne Bericht 272379](https://hackerone.com/reports/272379)
* [Artikel √ºber Passwortzur√ºcksetz-Token-Leck](https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a)

## **Passwortzur√ºcksetzung-Poisoning**

* Angreifer k√∂nnen den Host-Header w√§hrend der Passwortzur√ºcksetz-Anfragen manipulieren, um den Zur√ºcksetzlink auf eine b√∂sartige Seite zu verweisen.
* **Auswirkungen**: F√ºhrt zu potenzieller Konto√ºbernahme durch das Leaken von Zur√ºcksetzungstoken an Angreifer.
* **Minderungsma√ünahmen**:
* Validieren Sie den Host-Header gegen eine Whitelist erlaubter Domains.
* Verwenden Sie sichere, serverseitige Methoden zur Generierung absoluter URLs.
* **Patch**: Verwenden Sie `$_SERVER['SERVER_NAME']`, um Passwortzur√ºcksetz-URLs zu konstruieren, anstatt `$_SERVER['HTTP_HOST']`.
* **Referenzen**:
* [Acunetix Artikel √ºber Passwortzur√ºcksetzung-Poisoning](https://www.acunetix.com/blog/articles/password-reset-poisoning/)

## **Passwortzur√ºcksetzung durch Manipulation des E-Mail-Parameters**

Angreifer k√∂nnen die Passwortzur√ºcksetz-Anfrage manipulieren, indem sie zus√§tzliche E-Mail-Parameter hinzuf√ºgen, um den Zur√ºcksetzlink umzuleiten.

* F√ºgen Sie die E-Mail des Angreifers als zweiten Parameter mit & hinzu.
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* F√ºgen Sie die Angreifer-E-Mail als zweiten Parameter mit %20 hinzu
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* F√ºgen Sie die Angreifer-E-Mail als zweiten Parameter mit | hinzu
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* F√ºgen Sie die E-Mail des Angreifers als zweiten Parameter mit cc hinzu
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* F√ºgen Sie die E-Mail des Angreifers als zweiten Parameter unter Verwendung von Bcc hinzu
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* F√ºgen Sie die Angreifer-E-Mail als zweiten Parameter mit , hinzu
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* F√ºgen Sie die Angreifer-E-Mail als zweiten Parameter im JSON-Array hinzu
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
* **Minderungsma√ünahmen**:
* E-Mail-Parameter serverseitig ordnungsgem√§√ü analysieren und validieren.
* Vorbereitete Anweisungen oder parametrisierte Abfragen verwenden, um Injektionsangriffe zu verhindern.
* **Referenzen**:
* [https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be](https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be)
* [https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/](https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/)
* [https://twitter.com/HusseiN98D/status/1254888748216655872](https://twitter.com/HusseiN98D/status/1254888748216655872)

## **√Ñndern von E-Mail und Passwort eines beliebigen Benutzers √ºber API-Parameter**

* Angreifer k√∂nnen E-Mail- und Passwortparameter in API-Anfragen √§ndern, um die Kontodaten zu √§ndern.
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
* **Minderungsma√ünahmen**:
* Stellen Sie strenge Parameter√ºberpr√ºfungen und Authentifizierungspr√ºfungen sicher.
* Implementieren Sie robustes Logging und Monitoring, um verd√§chtige Aktivit√§ten zu erkennen und darauf zu reagieren.
* **Referenz**:
* [Vollst√§ndige Konto√ºbernahme durch API-Parameter-Manipulation](https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240)

## **Keine Ratenbegrenzung: E-Mail-Bombardierung**

* Mangelnde Ratenbegrenzung bei Passwortzur√ºcksetzanforderungen kann zu E-Mail-Bombardierung f√ºhren, wodurch der Benutzer mit R√ºcksetz-E-Mails √ºberflutet wird.
* **Minderungsma√ünahmen**:
* Implementieren Sie eine Ratenbegrenzung basierend auf IP-Adresse oder Benutzerkonto.
* Verwenden Sie CAPTCHA-Herausforderungen, um automatisierten Missbrauch zu verhindern.
* **Referenzen**:
* [HackerOne Bericht 280534](https://hackerone.com/reports/280534)

## **Herausfinden, wie das Passwort-Zur√ºcksetz-Token generiert wird**

* Das Verst√§ndnis des Musters oder der Methode hinter der Token-Generierung kann dazu f√ºhren, dass Tokens vorhergesagt oder brute-forced werden. Einige Optionen:
* Basierend auf Zeitstempel
* Basierend auf der Benutzer-ID
* Basierend auf der E-Mail des Benutzers
* Basierend auf Vorname und Nachname
* Basierend auf Geburtsdatum
* Basierend auf Kryptographie
* **Minderungsma√ünahmen**:
* Verwenden Sie starke, kryptografische Methoden zur Token-Generierung.
* Stellen Sie ausreichende Zuf√§lligkeit und L√§nge sicher, um Vorhersehbarkeit zu verhindern.
* **Tools**: Verwenden Sie Burp Sequencer, um die Zuf√§lligkeit von Tokens zu analysieren.

## **Erratbare UUID**

* Wenn UUIDs (Version 1) erratbar oder vorhersehbar sind, k√∂nnen Angreifer sie brute-forcen, um g√ºltige R√ºcksetz-Token zu generieren. √úberpr√ºfen Sie:

{% content-ref url="uuid-insecurities.md" %}
[uuid-insecurities.md](uuid-insecurities.md)
{% endcontent-ref %}

* **Minderungsma√ünahmen**:
* Verwenden Sie GUID Version 4 f√ºr Zuf√§lligkeit oder implementieren Sie zus√§tzliche Sicherheitsma√ünahmen f√ºr andere Versionen.
* **Tools**: Verwenden Sie [guidtool](https://github.com/intruder-io/guidtool) zur Analyse und Generierung von GUIDs.

## **Antwortmanipulation: Schlechte Antwort durch gute ersetzen**

* Manipulation von HTTP-Antworten, um Fehlermeldungen oder Einschr√§nkungen zu umgehen.
* **Minderungsma√ünahmen**:
* Implementieren Sie serverseitige Pr√ºfungen, um die Integrit√§t der Antwort sicherzustellen.
* Verwenden Sie sichere Kommunikationskan√§le wie HTTPS, um Man-in-the-Middle-Angriffe zu verhindern.
* **Referenz**:
* [Kritischer Fehler bei Live-Bug-Bounty-Event](https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3)

## **Verwendung eines abgelaufenen Tokens**

* Testen, ob abgelaufene Tokens weiterhin f√ºr das Zur√ºcksetzen des Passworts verwendet werden k√∂nnen.
* **Minderungsma√ünahmen**:
* Implementieren Sie strenge Token-Ablaufrichtlinien und validieren Sie das Token-Ablaufdatum serverseitig.

## **Brute Force Passwort-Zur√ºcksetz-Token**

* Versuch, das R√ºcksetz-Token mit Tools wie Burpsuite und IP-Rotator zu brute-forcen, um IP-basierte Ratenlimits zu umgehen.
* **Minderungsma√ünahmen**:
* Implementieren Sie robuste Ratenbegrenzungs- und Kontosperrmechanismen.
* √úberwachen Sie verd√§chtige Aktivit√§ten, die auf Brute-Force-Angriffe hindeuten.

## **Versuchen Sie, Ihr Token zu verwenden**

* Testen, ob das R√ºcksetz-Token eines Angreifers in Verbindung mit der E-Mail des Opfers verwendet werden kann.
* **Minderungsma√ünahmen**:
* Stellen Sie sicher, dass Tokens an die Benutzersitzung oder andere benutzerspezifische Attribute gebunden sind.

## **Sitzungsinvalidierung bei Abmeldung/Passwortzur√ºcksetzung**

* Sicherstellen, dass Sitzungen ung√ºltig werden, wenn sich ein Benutzer abmeldet oder sein Passwort zur√ºcksetzt.
* **Minderungsma√ünahmen**:
* Implementieren Sie ein angemessenes Sitzungsmanagement, um sicherzustellen, dass alle Sitzungen bei Abmeldung oder Passwortzur√ºcksetzung ung√ºltig werden.

## **Sitzungsinvalidierung bei Abmeldung/Passwortzur√ºcksetzung**

* R√ºcksetz-Token sollten eine Ablaufzeit haben, nach der sie ung√ºltig werden.
* **Minderungsma√ünahmen**:
* Setzen Sie eine angemessene Ablaufzeit f√ºr R√ºcksetz-Token fest und setzen Sie diese serverseitig strikt durch.

## Referenzen

* [https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token](https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token)

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Treten Sie dem [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) Server bei, um mit erfahrenen Hackern und Bug-Bounty-J√§gern zu kommunizieren!

**Hacking Einblicke**\
Engagieren Sie sich mit Inhalten, die in die Aufregung und Herausforderungen des Hackens eintauchen

**Echtzeit-Hack-Nachrichten**\
Bleiben Sie auf dem Laufenden mit der schnelllebigen Hack-Welt durch Echtzeit-Nachrichten und Einblicke

**Neueste Ank√ºndigungen**\
Bleiben Sie informiert √ºber die neuesten Bug-Bounties und wichtige Plattform-Updates

**Treten Sie uns bei** [**Discord**](https://discord.com/invite/N3FrSbmwdy) und beginnen Sie noch heute mit den besten Hackern zusammenzuarbeiten!

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
