# Restablecimiento/Olvido de Contrase帽a Bypass

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Join [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) server to communicate with experienced hackers and bug bounty hunters!

**Hacking Insights**\
Engage with content that delves into the thrill and challenges of hacking

**Real-Time Hack News**\
Keep up-to-date with fast-paced hacking world through real-time news and insights

**Latest Announcements**\
Stay informed with the newest bug bounties launching and crucial platform updates

**Join us on** [**Discord**](https://discord.com/invite/N3FrSbmwdy) and start collaborating with top hackers today!

## **Filtraci贸n del Token de Restablecimiento de Contrase帽a a Trav茅s del Referer**

* El encabezado HTTP referer puede filtrar el token de restablecimiento de contrase帽a si se incluye en la URL. Esto puede ocurrir cuando un usuario hace clic en un enlace de un sitio web de terceros despu茅s de solicitar un restablecimiento de contrase帽a.
* **Impacto**: Posible toma de control de la cuenta a trav茅s de ataques de Cross-Site Request Forgery (CSRF).
* **Explotaci贸n**: Para verificar si un token de restablecimiento de contrase帽a se est谩 filtrando en el encabezado referer, **solicita un restablecimiento de contrase帽a** a tu direcci贸n de correo electr贸nico y **haz clic en el enlace de restablecimiento** proporcionado. **No cambies tu contrase帽a** de inmediato. En su lugar, **navega a un sitio web de terceros** (como Facebook o Twitter) mientras **interceptas las solicitudes usando Burp Suite**. Inspecciona las solicitudes para ver si el **encabezado referer contiene el token de restablecimiento de contrase帽a**, ya que esto podr铆a exponer informaci贸n sensible a terceros.
* **Referencias**:
* [HackerOne Report 342693](https://hackerone.com/reports/342693)
* [HackerOne Report 272379](https://hackerone.com/reports/272379)
* [Art铆culo sobre la Filtraci贸n del Token de Restablecimiento de Contrase帽a](https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a)

## **Envenenamiento del Restablecimiento de Contrase帽a**

* Los atacantes pueden manipular el encabezado Host durante las solicitudes de restablecimiento de contrase帽a para apuntar el enlace de restablecimiento a un sitio malicioso.
* **Impacto**: Conduce a una posible toma de control de la cuenta al filtrar tokens de restablecimiento a los atacantes.
* **Pasos de Mitigaci贸n**:
* Valida el encabezado Host contra una lista blanca de dominios permitidos.
* Utiliza m茅todos seguros del lado del servidor para generar URLs absolutas.
* **Parche**: Usa `$_SERVER['SERVER_NAME']` para construir URLs de restablecimiento de contrase帽a en lugar de `$_SERVER['HTTP_HOST']`.
* **Referencias**:
* [Art铆culo de Acunetix sobre el Envenenamiento del Restablecimiento de Contrase帽a](https://www.acunetix.com/blog/articles/password-reset-poisoning/)

## **Restablecimiento de Contrase帽a Manipulando el Par谩metro de Correo Electr贸nico**

Los atacantes pueden manipular la solicitud de restablecimiento de contrase帽a a帽adiendo par谩metros de correo electr贸nico adicionales para desviar el enlace de restablecimiento.

* Agrega el correo electr贸nico del atacante como segundo par谩metro usando &
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* Agregar el correo electr贸nico del atacante como segundo par谩metro usando %20
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* Agregar el correo electr贸nico del atacante como segundo par谩metro usando |
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* Agregar el correo electr贸nico del atacante como segundo par谩metro usando cc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* Agregar el correo electr贸nico del atacante como segundo par谩metro usando bcc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* Agregar el correo electr贸nico del atacante como segundo par谩metro usando ,
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* Agregar el correo electr贸nico del atacante como segundo par谩metro en el arreglo json
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
* **Pasos de Mitigaci贸n**:
* Analizar y validar adecuadamente los par谩metros de correo electr贸nico del lado del servidor.
* Utilizar declaraciones preparadas o consultas parametrizadas para prevenir ataques de inyecci贸n.
* **Referencias**:
* [https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be](https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be)
* [https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/](https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/)
* [https://twitter.com/HusseiN98D/status/1254888748216655872](https://twitter.com/HusseiN98D/status/1254888748216655872)

## **Cambio de Correo Electr贸nico y Contrase帽a de Cualquier Usuario a Trav茅s de Par谩metros de API**

* Los atacantes pueden modificar los par谩metros de correo electr贸nico y contrase帽a en las solicitudes de API para cambiar las credenciales de la cuenta.
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
* **Pasos de Mitigaci贸n**:
* Asegurar una validaci贸n estricta de par谩metros y controles de autenticaci贸n.
* Implementar un registro y monitoreo robustos para detectar y responder a actividades sospechosas.
* **Referencia**:
* [Toma de Control Completa de Cuenta a trav茅s de Manipulaci贸n de Par谩metros de API](https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240)

## **Sin Limitaci贸n de Tasa: Bombardeo de Correos Electr贸nicos**

* La falta de limitaci贸n de tasa en las solicitudes de restablecimiento de contrase帽a puede llevar a un bombardeo de correos electr贸nicos, abrumando al usuario con correos de restablecimiento.
* **Pasos de Mitigaci贸n**:
* Implementar limitaci贸n de tasa basada en la direcci贸n IP o la cuenta de usuario.
* Usar desaf铆os CAPTCHA para prevenir abusos automatizados.
* **Referencias**:
* [Informe de HackerOne 280534](https://hackerone.com/reports/280534)

## **Descubrir C贸mo se Genera el Token de Restablecimiento de Contrase帽a**

* Comprender el patr贸n o m茅todo detr谩s de la generaci贸n de tokens puede llevar a predecir o forzar tokens. Algunas opciones:
* Basado en Timestamp
* Basado en el UserID
* Basado en el correo electr贸nico del Usuario
* Basado en Nombre y Apellido
* Basado en Fecha de Nacimiento
* Basado en Criptograf铆a
* **Pasos de Mitigaci贸n**:
* Usar m茅todos criptogr谩ficos fuertes para la generaci贸n de tokens.
* Asegurar suficiente aleatoriedad y longitud para prevenir la predictibilidad.
* **Herramientas**: Usar Burp Sequencer para analizar la aleatoriedad de los tokens.

## **UUID Adivinable**

* Si los UUIDs (versi贸n 1) son adivinables o predecibles, los atacantes pueden forzarlos para generar tokens de restablecimiento v谩lidos. Verifique:

{% content-ref url="uuid-insecurities.md" %}
[uuid-insecurities.md](uuid-insecurities.md)
{% endcontent-ref %}

* **Pasos de Mitigaci贸n**:
* Usar GUID versi贸n 4 para aleatoriedad o implementar medidas de seguridad adicionales para otras versiones.
* **Herramientas**: Usar [guidtool](https://github.com/intruder-io/guidtool) para analizar y generar GUIDs.

## **Manipulaci贸n de Respuesta: Reemplazar Respuesta Mala con Buena**

* Manipular respuestas HTTP para eludir mensajes de error o restricciones.
* **Pasos de Mitigaci贸n**:
* Implementar verificaciones del lado del servidor para asegurar la integridad de la respuesta.
* Usar canales de comunicaci贸n seguros como HTTPS para prevenir ataques de hombre en el medio.
* **Referencia**:
* [Error Cr铆tico en Evento de Recompensa por Errores en Vivo](https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3)

## **Uso de Token Expirado**

* Probar si los tokens expirados a煤n pueden ser utilizados para el restablecimiento de contrase帽a.
* **Pasos de Mitigaci贸n**:
* Implementar pol铆ticas estrictas de expiraci贸n de tokens y validar la expiraci贸n del token del lado del servidor.

## **Fuerza Bruta del Token de Restablecimiento de Contrase帽a**

* Intentar forzar el token de restablecimiento usando herramientas como Burpsuite e IP-Rotator para eludir l铆mites de tasa basados en IP.
* **Pasos de Mitigaci贸n**:
* Implementar mecanismos robustos de limitaci贸n de tasa y bloqueo de cuentas.
* Monitorear actividades sospechosas indicativas de ataques de fuerza bruta.

## **Intenta Usar Tu Token**

* Probar si el token de restablecimiento de un atacante puede ser utilizado junto con el correo electr贸nico de la v铆ctima.
* **Pasos de Mitigaci贸n**:
* Asegurar que los tokens est茅n vinculados a la sesi贸n del usuario u otros atributos espec铆ficos del usuario.

## **Invalidaci贸n de Sesi贸n en Cierre de Sesi贸n/Restablecimiento de Contrase帽a**

* Asegurar que las sesiones se invaliden cuando un usuario cierra sesi贸n o restablece su contrase帽a.
* **Pasos de Mitigaci贸n**:
* Implementar una gesti贸n adecuada de sesiones, asegurando que todas las sesiones se invaliden al cerrar sesi贸n o restablecer la contrase帽a.

## **Invalidaci贸n de Sesi贸n en Cierre de Sesi贸n/Restablecimiento de Contrase帽a**

* Los tokens de restablecimiento deben tener un tiempo de expiraci贸n despu茅s del cual se vuelven inv谩lidos.
* **Pasos de Mitigaci贸n**:
* Establecer un tiempo de expiraci贸n razonable para los tokens de restablecimiento y hacer cumplir estrictamente esto del lado del servidor.

## Referencias

* [https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token](https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token)

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

隆nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores!

**Perspectivas de Hacking**\
Invol煤crate con contenido que profundiza en la emoci贸n y los desaf铆os del hacking

**Noticias de Hackeo en Tiempo Real**\
Mantente al d铆a con el mundo del hacking de ritmo r谩pido a trav茅s de noticias e informaci贸n en tiempo real

**ltimos Anuncios**\
Mantente informado sobre las nuevas recompensas por errores que se lanzan y actualizaciones cruciales de la plataforma

**nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo!

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
