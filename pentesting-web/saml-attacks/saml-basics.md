<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTricksçš„è¡£ç‰©**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**æ¨ç‰¹**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


# æè¿°

å®‰å…¨æ–­è¨€æ ‡è®°è¯­è¨€ï¼ˆSAMLï¼‰æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼Œå…è®¸èº«ä»½æä¾›è€…ï¼ˆIdPï¼‰å°†æˆæƒå‡­æ®ä¼ é€’ç»™æœåŠ¡æä¾›è€…ï¼ˆSPï¼‰ã€‚è¿™ä¸ªæœ¯è¯­çš„æ„æ€æ˜¯ä½ å¯ä»¥**ä½¿ç”¨ä¸€ç»„å‡­æ®ç™»å½•å¤šä¸ªä¸åŒçš„ç½‘ç«™**ã€‚ç®¡ç†æ¯ä¸ªç”¨æˆ·çš„ä¸€ä¸ªç™»å½•æ¯”ç®¡ç†å•ç‹¬çš„ç™»å½•åˆ°ç”µå­é‚®ä»¶ã€å®¢æˆ·å…³ç³»ç®¡ç†ï¼ˆCRMï¼‰è½¯ä»¶ã€æ´»åŠ¨ç›®å½•ç­‰è¦ç®€å•å¾—å¤šã€‚

SAMLäº‹åŠ¡ä½¿ç”¨å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆXMLï¼‰è¿›è¡Œèº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…ä¹‹é—´çš„æ ‡å‡†åŒ–é€šä¿¡ã€‚SAMLæ˜¯ç”¨æˆ·èº«ä»½éªŒè¯å’Œä½¿ç”¨æœåŠ¡çš„æˆæƒä¹‹é—´çš„é“¾æ¥ã€‚ï¼ˆæ¥è‡ª[è¿™é‡Œ](https://www.varonis.com/blog/what-is-saml/)ï¼‰

# SAML vs. OAuth

OAuthæ˜¯ä¸€ä¸ªç¨å¾®è¾ƒæ–°çš„æ ‡å‡†ï¼Œç”±Googleå’ŒTwitterå…±åŒå¼€å‘ï¼Œç”¨äºå®ç°ç®€åŒ–çš„äº’è”ç½‘ç™»å½•ã€‚OAuthä½¿ç”¨ä¸SAMLç±»ä¼¼çš„æ–¹æ³•æ¥å…±äº«ç™»å½•ä¿¡æ¯ã€‚**SAMLä¸ºä¼ä¸šæä¾›æ›´å¤šæ§åˆ¶æƒ**ï¼Œä»¥ä¿æŒå…¶SSOç™»å½•æ›´å®‰å…¨ï¼Œè€Œ**OAuthåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ›´å¥½ï¼Œå¹¶ä½¿ç”¨JSON**ã€‚

# æ¶æ„

![saml-flow](https://epi052.gitlab.io/notes-to-self/img/saml/saml-flow.jpg)

1. ç¬¬1æ­¥ - æˆ‘ä»¬å°è¯•è®¿é—®æŸä¸ªå—ä¿æŠ¤çš„èµ„æº
2. ç¬¬2æ­¥ - å­˜å‚¨è¯¥èµ„æºçš„æœåŠ¡å™¨ï¼ˆæœåŠ¡æä¾›è€…ï¼‰ä¸è®¤è¯†æˆ‘ä»¬ï¼Œå› æ­¤å®ƒç”Ÿæˆä¸€ä¸ªè¦å‘é€åˆ°èº«ä»½æä¾›è€…çš„**SAMLè¯·æ±‚**ã€‚è¿™å°±åƒæˆ‘ä»¬æ²¡æœ‰æŠ¤ç…§æ¥åˆ°å¾·å›½ï¼Œè¢«é€å›ç¾å›½æ‹¿æŠ¤ç…§ï¼Œç„¶åæ‰èƒ½è¿›å…¥è¯¥å›½å®¶ã€‚
3. ç¬¬3æ­¥ - ç”ŸæˆSAMLè¯·æ±‚åï¼ŒSPå°†æˆ‘ä»¬**é‡å®šå‘**åˆ°IdPã€‚æ³¨æ„ï¼šSAMLè¯·æ±‚é€šè¿‡æˆ‘ä»¬çš„æµè§ˆå™¨ä¼ é€’åˆ°IdPã€‚
4. ç¬¬4æ­¥ - IdPæ¥æ”¶åˆ°SAMLè¯·æ±‚
5. ç¬¬4aæ­¥ï¼ˆæœªæ˜¾ç¤ºï¼‰- IdPæä¾›æŸç§èº«ä»½éªŒè¯æ–¹å¼ï¼›ç™»å½•è¡¨å•æˆ–ç±»ä¼¼çš„ä¸œè¥¿ã€‚
6. ç¬¬4bæ­¥ï¼ˆæœªæ˜¾ç¤ºï¼‰- IdPéªŒè¯æˆ‘ä»¬æ˜¯åˆæ³•ç”¨æˆ·ï¼Œåº”è¯¥è¢«å…è®¸è®¿é—®ä½œä¸ºSAMLè¯·æ±‚çš„ä¸€éƒ¨åˆ†åŒ…å«çš„èµ„æº
7. ç¬¬5æ­¥ - IdPåˆ›å»ºä¸€ä¸ª**SAMLå“åº”**ã€‚SAMLå“åº”åŒ…å«SPæ‰€éœ€çš„SAMLæ–­è¨€ã€‚æ–­è¨€é€šå¸¸è‡³å°‘åŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯ï¼šæŒ‡ç¤ºæ–­è¨€æ¥è‡ªæ­£ç¡®çš„IdPï¼ŒæŒ‡å®šç”¨æˆ·æ˜¯è°çš„**NameID**å±æ€§ï¼Œä»¥åŠæ•°å­—ç­¾åã€‚SAMLå“åº”ä¹Ÿé€šè¿‡æˆ‘ä»¬çš„æµè§ˆå™¨ä¼ é€’ã€‚
8. ç¬¬6æ­¥ - IdPå°†æˆ‘ä»¬**é‡å®šå‘**åˆ°SPçš„æ–­è¨€æ¶ˆè´¹è€…æœåŠ¡ï¼ˆACSï¼‰URLã€‚ACSåªæ˜¯SPæœŸæœ›æ¥æ”¶SAMLæ–­è¨€çš„URLã€‚
9. ç¬¬7æ­¥ - ACSéªŒè¯SAMLå“åº”ã€‚
10. ç¬¬8æ­¥ - æˆ‘ä»¬è¢«å…è®¸è®¿é—®æœ€åˆè¯·æ±‚çš„èµ„æºã€‚

# SAMLè¯·æ±‚ç¤ºä¾‹

è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°çœ‹ä¸€ä¸‹ä¸Šé¢æ¦‚è¿°çš„ç¬¬2æ­¥å’Œç¬¬3æ­¥ã€‚æˆ‘ä»¬å°†å‘ç¤ºä¾‹æœåŠ¡æä¾›è€…å‘å‡ºè¯·æ±‚ï¼Œè¯·æ±‚ä½äº[https://shibdemo-sp1.test.edu/secure/](https://shibdemo-sp1.test.edu/secure/)çš„èµ„æºï¼Œæ­£å¦‚å…¶åç§°æ‰€ç¤ºï¼Œè¿™æ˜¯éœ€è¦æˆ‘ä»¬è¿›è¡Œèº«ä»½éªŒè¯æ‰èƒ½æŸ¥çœ‹çš„å†…å®¹ã€‚

_shibdemo-sp1.test.eduæ˜¯ç”¨äºæµ‹è¯•çš„æœ¬åœ°è™šæ‹ŸåŒ–çš„IdPå’ŒSPå®ä¾‹ï¼Œä¸æ˜¯å®é™…çš„ç½‘ç«™_
```
GET /secure/ HTTP/1.1
Host: shibdemo-sp1.test.edu
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:65.0) Gecko/20100101 Firefox/65.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://shibdemo-sp1.test.edu/
Connection: close
Upgrade-Insecure-Requests: 1
```
SPç”ŸæˆSAMLè¯·æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬å°šæœªè¿›è¡Œèº«ä»½éªŒè¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹é¢çœ‹åˆ°åŸå§‹çš„SAMLè¯·æ±‚ã€‚
```markup
<?xml version="1.0"?>
<samlp:AuthnRequest
xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
AssertionConsumerServiceURL="https://shibdemo-sp1.test.edu/Shibboleth.sso/SAML2/POST"
Destination="https://shibdemo-idp.test.edu/idp/profile/SAML2/Redirect/SSO"
ID="_cdae718238ba9c207a35cc7c70b046a0"
IssueInstant="2019-03-12T20:54:58Z"
ProtocolBinding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
Version="2.0">
<saml:Issuer xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion">https://shibdemo-sp1.test.edu/shibboleth</saml:Issuer>
<samlp:NameIDPolicy AllowCreate="1"/>
</samlp:AuthnRequest>
```
* **AssertionConsumerServiceURL**: æ ‡è¯†åœ¨èº«ä»½æä¾›è€…è®¤è¯ååº”å°†SAMLå“åº”å‘é€åˆ°çš„ä½ç½®
* **Destination**: æŒ‡ç¤ºè¯·æ±‚åº”å‘é€åˆ°çš„åœ°å€ï¼ˆèº«ä»½æä¾›è€…ï¼‰
* **ProtocolBinding**: é€šå¸¸ä¸AssertionConsumerServiceURLå±æ€§ä¸€èµ·ä½¿ç”¨ï¼Œå®šä¹‰SAMLåè®®æ¶ˆæ¯çš„ä¼ è¾“æœºåˆ¶
* **saml:Issuer**: æ ‡è¯†ç”Ÿæˆè¯·æ±‚æ¶ˆæ¯çš„å®ä½“

æˆ‘ä»¬å·²ç»æ¦‚è¿°äº†ä¸Šè¿°è¯·æ±‚çš„æ›´é‡è¦çš„å…ƒç´ ï¼Œä½†æœ‰å…³å…¶ä»–å…ƒç´ çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨[æ ¸å¿ƒè§„èŒƒ](https://docs.oasis-open.org/security/saml/v2.0/saml-core-2.0-os.pdf)ä¸­æŸ¥çœ‹ã€‚ä¸Šè¿°è¯·æ±‚çš„å¤§è‡´æ„æ€æ˜¯ï¼šâ€œå˜¿ï¼Œè¯·å¯¹å‘é€ç»™æ‚¨çš„ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç„¶ååœ¨æ‚¨ä»¬å®Œæˆåè®©è¯¥ç”¨æˆ·è”ç³»æˆ‘â€ã€‚

åˆ›å»ºäº†SAMLè¯·æ±‚åï¼ŒæœåŠ¡æä¾›å•†ï¼ˆSPï¼‰ç°åœ¨é€šè¿‡**302é‡å®šå‘**å›å¤æˆ‘ä»¬å¯¹`/secure/`çš„GETè¯·æ±‚ã€‚302å°†æˆ‘ä»¬çš„æµè§ˆå™¨æŒ‡å‘èº«ä»½æä¾›è€…ã€‚SAMLè¯·æ±‚è¢«ç¼–ç åˆ°HTTPå“åº”çš„**Location**å¤´éƒ¨ä¸­ï¼Œä½œä¸º302çš„ä¸€éƒ¨åˆ†ã€‚
```markup
HTTP/1.1 302 Found
Date: Tue, 12 Mar 2019 20:54:58 GMT
Server: Apache/2.2.3 (CentOS)
Expires: Wed, 01 Jan 1997 12:00:00 GMT
Cache-Control: private,no-store,no-cache,max-age=0
Location: https://shibdemo-idp.test.edu/idp/profile/SAML2/Redirect/SSO?SAMLRequest=fZJdT4MwFIb%2FCuk9FNgmWzNIcLtwyXRkoBfemFKO0gRa7Cl%2B%2FHvZmDoTs8u2b5%2B350mXyNumY2lva7WH1x7QOh9to5AdD2LSG8U0R4lM8RaQWcHy9HbLQs9nndFWC90QJ0UEY6VWK62wb8HkYN6kgPv9Nia1tR0ySrGWZQWtdrELPDs0eVD1NB92S92ArT1ETQ%2FwkGa7vCDOeshIxQ%2Fcfyiy6n4pw4IOz3mWDZwQe6ikAWFpnu%2BIs1nH5ElUHKJgHk7mJV%2BI0I%2F4ZCZEJCK%2F9KdX3B9iiD1sFFqubExCP1i4%2FsQNwiL02WzKZvNH4mSnqa%2BlqqR6uayoHEPIbooic8exHsDgcaQhQJLlQTQ7Fpsz9Zex%2FNs3SS7bxR%2B7S3pWNLZ27G4gb9aZbqT4dNKm0e8rA9xCTAJCk%2FHK39%2BRfAE%3D&RelayState=ss%3Amem%3A39430bdac29d44586c326f12b4cb3345ffa47137a374e37cba0877e0fc79ea91
Content-Length: 897
Connection: close
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>302 Found</title>
</head><body>
<h1>Found</h1>
<p>The document has moved <a href="https://shibdemo-idp.test.edu/idp/profile/SAML2/Redirect/SSO?SAMLRequest=fZJdT4MwFIb%2FCuk9FNgmWzNIcLtwyXRkoBfemFKO0gRa7Cl%2B%2FHvZmDoTs8u2b5%2B350mXyNumY2lva7WH1x7QOh9to5AdD2LSG8U0R4lM8RaQWcHy9HbLQs9nndFWC90QJ0UEY6VWK62wb8HkYN6kgPv9Nia1tR0ySrGWZQWtdrELPDs0eVD1NB92S92ArT1ETQ%2FwkGa7vCDOeshIxQ%2Fcfyiy6n4pw4IOz3mWDZwQe6ikAWFpnu%2BIs1nH5ElUHKJgHk7mJV%2BI0I%2F4ZCZEJCK%2F9KdX3B9iiD1sFFqubExCP1i4%2FsQNwiL02WzKZvNH4mSnqa%2BlqqR6uayoHEPIbooic8exHsDgcaQhQJLlQTQ7Fpsz9Zex%2FNs3SS7bxR%2B7S3pWNLZ27G4gb9aZbqT4dNKm0e8rA9xCTAJCk%2FHK39%2BRfAE%3D&amp;RelayState=ss%3Amem%3A39430bdac29d44586c326f12b4cb3345ffa47137a374e37cba0877e0fc79ea91">here</a>.</p>
<hr>
<address>Apache/2.2.3 (CentOS) Server at shibdemo-sp1.test.edu Port 443</address>
</body></html>
```
**RelayState**å‚æ•°ä¸SAMLè¯·æ±‚ä¸€èµ·å‘é€ï¼Œæ˜¯ç”±SPå‘é€ç»™IdPçš„çŠ¶æ€ä¿¡æ¯ï¼Œä»¥ä¾¿SPåœ¨SAMLå“åº”è¿”å›æ—¶çŸ¥é“æœ€åˆè¯·æ±‚èµ„æºçš„ç”¨æˆ·ã€‚SAMLå“åº”å¿…é¡»åŒ…å«ç›¸åŒçš„RelayStateå€¼ã€‚

**SAMLRequest**å‚æ•°æ˜¯ä¹‹å‰æˆ‘ä»¬æŸ¥çœ‹çš„ç›¸åŒåŸå§‹XMLç‰‡æ®µçš„**å‹ç¼©**å’Œ**ç¼–ç **ç‰ˆæœ¬ã€‚SAMLä½¿ç”¨[Deflateå‹ç¼©](https://en.wikipedia.org/wiki/DEFLATE)ç®—æ³•ï¼Œç„¶åå¯¹ç»“æœè¿›è¡Œbase64ç¼–ç ã€‚

# SAMLå“åº”ç¤ºä¾‹

æˆ‘ä»¬å°†è·³è¿‡ç”¨æˆ·å‘IdPè¿›è¡Œèº«ä»½éªŒè¯çš„éƒ¨åˆ†ï¼Œç›´æ¥è¿›å…¥æˆ‘ä»¬åœ¨[SAMLèº«ä»½éªŒè¯å·¥ä½œæµç¨‹](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/#saml-authentication-workflow)ä¸­è®¨è®ºçš„ç¬¬5æ­¥å’Œç¬¬6æ­¥ã€‚è¯·è®°ä½ï¼Œ**æˆ‘ä»¬å°†è¦æŸ¥çœ‹çš„å†…å®¹æ˜¯ç”¨æˆ·å‘IdPè¿›è¡Œèº«ä»½éªŒè¯ä¹‹åå‘ç”Ÿçš„äº‹æƒ…**ã€‚

è®©æˆ‘ä»¬é¦–å…ˆæŸ¥çœ‹åŸå§‹çš„SAMLå“åº”ã€‚
```markup
<?xml version="1.0" encoding="UTF-8"?>
<samlp:Response Destination="https://shibdemo-sp1.test.edu/Shibboleth.sso/SAML2/POST" ID="_2af3ff4a06aa82058f0eaa8ae7866541" InResponseTo="_cdae718238ba9c207a35cc7c70b046a0" IssueInstant="2019-03-12T20:54:54.061Z" Version="2.0" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
<saml:Issuer Format="urn:oasis:names:tc:SAML:2.0:nameid-format:entity" xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion">https://shibdemo-idp.test.edu/idp/shibboleth</saml:Issuer>
<ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
<ds:SignedInfo>
<ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>
<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>
<ds:Reference URI="#_2af3ff4a06aa82058f0eaa8ae7866541">
<ds:Transforms>
<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>          <ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>
</ds:Transforms>
<ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/>
<ds:DigestValue>Se+WwXd5r44J56LauTz/wnP3jWg=</ds:DigestValue>
</ds:Reference>
</ds:SignedInfo>
<ds:SignatureValue>f8X28hHMpnTi/Hqi6phuxqbYKsf99Qi8QqVI3x3zRj6njs+J9ey7qxw4GTMV657IfmmMotE0IAIrmPh3lebX65bCUCpiDtFaP04KjWNGGWa7z6rjwhRIY6chYGYzdmrXWmvY2EXW3nkynAJ2vXo5mncOz2P17/bQgqDU6BTzfRzYU6q6TcGLjRd7pGMGbBm6wH5c8aHM4FaQZNv7qHkIVvTlCRcpg/b8qS2fWW8kwgklLXd1xTCXh9XedxrFWq75nSFZ6FiakfUMybC5YIqZ7nr4GfVKqdmh3wvCF/P9jrUkBNDsw3Id63UAwbnMVvBAYt2tgfiD5hpJ3ZLkzjds+g==</ds:SignatureValue>
<ds:KeyInfo>
<ds:X509Data>
<ds:X509Certificate>MIIDXTCCAkWgAwIBAgIJAO7P8i9TJMuvMA0GCSqGSIb3DQEBCwUAMEUxCzAJBgNVBAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBXaWRnaXRzIFB0eSBMdGQwHhcNMTgwNDA1MDI1NTUyWhcNMjgwNDA0MDI1NTUyWjBFMQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwfSJJxxWvJ2Xok+Qx1OwQa+LA6mTSomOrgcJkRhfjeA9LMBmQlZKMdHiwKCaJBm7l1G13CNN2XhBZBqLFEX/4pPO5WBakAEa8h1i1ODmge1NKntcr3jPG8pGrzQVFbTpyoPaeJM5nSJUJhdI+QlXEYRZ2WUpKrrPXaG4O/bKFQ4FP7tRiYMi7SZde0QOUSTUlO14JA5L3jNUk0eha2hVULyCEa9WjbfOfw+0TvE32MrAhsu4QJQgr18q1x4+GNuOI0LkX1/WehXDstyjX68CxHRSNfsarX7HeOvqn8HbGkIAKMG1ldmSkyvJ0DrvEU+0wTxaTXxFR+zwFOBnSKIVBwIDAQABo1AwTjAdBgNVHQ4EFgQUn3h8qx+ssGm8balncHSF9hi01NQwHwYDVR0jBBgwFoAUn3h8qx+ssGm8balncHSF9hi01NQwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAuVmxbUhFA8cdnxgwHWYXniebXpPNMfoMBPpMao20uv9dkKHH2AzuT7TWAICiSj29ZuHEVJaK1mfwErr+R8etKnGT0tA53/509+gWG0eCQSh+AF/VPWQ4JRoPMszKdLzl4surnNOA5JegKVvTcT91+G+OWv0hB4iMD/quegLSBfrlbtyTT58Moj33wDDhaMH1Dlm23zfgB/0w3ztZnnmdxXJxGZuLiybJXTMbkjhUk41udHTQcsxKdaRoaQobDNdbqyl245RP15QXKphaz8DadCyH4v8o5NIU5lZyEG7KCpWnqWe6au6OrbGqBkqDIrEue3Wnu+TFaJRXBd12D9Xb8g==</ds:X509Certificate>
</ds:X509Data>
</ds:KeyInfo>
</ds:Signature>
<samlp:Status>
<samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/>
</samlp:Status>
<saml:Assertion xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ID="_e0acf8ced7e2cafc7c65b2c097842486e0838d76e0" IssueInstant="2019-03-13T22:44:33Z" Version="2.0">
<saml:Issuer>https://shibdemo-idp.test.edu/idp/shibboleth</saml:Issuer>
<ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
<ds:SignedInfo>
<ds:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>
<ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>
<ds:Reference URI="#_e0acf8ced7e2cafc7c65b2c097842486e0838d76e0">
<ds:Transforms>
<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
<ds:Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>
</ds:Transforms>
<ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/>
<ds:DigestValue>kDAb3x6EFvA9VblqwbIFcCnLQvo=</ds:DigestValue>
</ds:Reference>
</ds:SignedInfo>
<ds:SignatureValue>e6qavbOCH8YAAMzDXnEwT4R7VBvan2gfYU6f5M1Akp6bqZqu3H4iJ5/VKtkMb7773E4RtDpY1vy9+6hLd/BQ2V5ZN6HG12JOVAgCr9rzna2sgNDYzGfmHsOwD9QJTOYZIFU3mtOSK6Lk8bZxM7wK5X0vmRNHI5a3oQlbWy9O6NtqZdm2AwI+zXb2ePV6lILjyoGkeuRId/35lA57OW+lBsGSz1T/X+5kVBdWRAYib2FAvGLIxInLt7jEDDfh93unL+YcbXevRcQLnKzrqTmu9TFIq+w0KeEnYxxPtCCmnnv86LWDhW30RJH2cS7kTsHa271RPsCCuutJD1QSaxVP1w==
</ds:SignatureValue>
<ds:KeyInfo>
<ds:X509Data>
<ds:X509Certificate>MIIDXTCCAkWgAwIBAgIJAO7P8i9TJMuvMA0GCSqGSIb3DQEBCwUAMEUxCzAJBgNVBAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBXaWRnaXRzIFB0eSBMdGQwHhcNMTgwNDA1MDI1NTUyWhcNMjgwNDA0MDI1NTUyWjBFMQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwfSJJxxWvJ2Xok+Qx1OwQa+LA6mTSomOrgcJkRhfjeA9LMBmQlZKMdHiwKCaJBm7l1G13CNN2XhBZBqLFEX/4pPO5WBakAEa8h1i1ODmge1NKntcr3jPG8pGrzQVFbTpyoPaeJM5nSJUJhdI+QlXEYRZ2WUpKrrPXaG4O/bKFQ4FP7tRiYMi7SZde0QOUSTUlO14JA5L3jNUk0eha2hVULyCEa9WjbfOfw+0TvE32MrAhsu4QJQgr18q1x4+GNuOI0LkX1/WehXDstyjX68CxHRSNfsarX7HeOvqn8HbGkIAKMG1ldmSkyvJ0DrvEU+0wTxaTXxFR+zwFOBnSKIVBwIDAQABo1AwTjAdBgNVHQ4EFgQUn3h8qx+ssGm8balncHSF9hi01NQwHwYDVR0jBBgwFoAUn3h8qx+ssGm8balncHSF9hi01NQwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAuVmxbUhFA8cdnxgwHWYXniebXpPNMfoMBPpMao20uv9dkKHH2AzuT7TWAICiSj29ZuHEVJaK1mfwErr+R8etKnGT0tA53/509+gWG0eCQSh+AF/VPWQ4JRoPMszKdLzl4surnNOA5JegKVvTcT91+G+OWv0hB4iMD/quegLSBfrlbtyTT58Moj33wDDhaMH1Dlm23zfgB/0w3ztZnnmdxXJxGZuLiybJXTMbkjhUk41udHTQcsxKdaRoaQobDNdbqyl245RP15QXKphaz8DadCyH4v8o5NIU5lZyEG7KCpWnqWe6au6OrbGqBkqDIrEue3Wnu+TFaJRXBd12D9Xb8g==</ds:X509Certificate>
</ds:X509Data>
</ds:KeyInfo>
</ds:Signature>
<saml:Subject>
<saml:NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:transient" SPNameQualifier="https://shibdemo-sp1.test.edu/shibboleth">_29b7a1a396d841b09fcf2b0bd8ce88fed6ad70e1a7</saml:NameID>
<saml:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
<saml:SubjectConfirmationData InResponseTo="_cdae718238ba9c207a35cc7c70b046a0" NotOnOrAfter="2019-03-13T22:49:33Z" Recipient="https://shibdemo-sp1.test.edu/Shibboleth.sso/SAML2/POST"/>
</saml:SubjectConfirmation>
</saml:Subject>
<saml:Conditions NotBefore="2019-03-13T22:44:03Z" NotOnOrAfter="2019-03-13T22:49:33Z">
<saml:AudienceRestriction>
<saml:Audience>https://shibdemo-sp1.test.edu/shibboleth</saml:Audience>
</saml:AudienceRestriction>
</saml:Conditions>
<saml:AuthnStatement AuthnInstant="2019-03-13T22:44:33Z" SessionIndex="_a52c3c1242663b44b706523f0a2ada454eb997e40a" SessionNotOnOrAfter="2019-03-14T06:44:33Z">
<saml:AuthnContext>
<saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</saml:AuthnContextClassRef>
</saml:AuthnContext>
</saml:AuthnStatement>
<saml:AttributeStatement>
```html
<saml:Attribute Name="uid" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:basic">
<saml:AttributeValue xsi:type="xs:string">epi</saml:AttributeValue>
</saml:Attribute>
<saml:Attribute Name="mail" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:basic">
<saml:AttributeValue xsi:type="xs:string">epi@test.edu</saml:AttributeValue>
</saml:Attribute>
<saml:Attribute Name="first_name" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:basic">
<saml:AttributeValue xsi:type="xs:string">epi</saml:AttributeValue>
</saml:Attribute>
<saml:Attribute Name="last_name" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:basic">
<saml:AttributeValue xsi:type="xs:string">bar</saml:AttributeValue>
</saml:Attribute>
</saml:AttributeStatement>
</saml:Assertion>
</samlp:Response>
```

```html
<saml:Attribute Name="uid" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:basic">
<saml:AttributeValue xsi:type="xs:string">epi</saml:AttributeValue>
</saml:Attribute>
<saml:Attribute Name="mail" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:basic">
<saml:AttributeValue xsi:type="xs:string">epi@test.edu</saml:AttributeValue>
</saml:Attribute>
<saml:Attribute Name="first_name" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:basic">
<saml:AttributeValue xsi:type="xs:string">epi</saml:AttributeValue>
</saml:Attribute>
<saml:Attribute Name="last_name" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:basic">
<saml:AttributeValue xsi:type="xs:string">bar</saml:AttributeValue>
</saml:Attribute>
</saml:AttributeStatement>
</saml:Assertion>
</samlp:Response>
```
* **ds:Signature**: ä¸€ä¸ªä¿æŠ¤æ–­è¨€çš„å®Œæ•´æ€§å’ŒéªŒè¯å‘è¡Œè€…çš„[XMLç­¾å](https://www.w3.org/TR/xmldsig-core1/#sec-KeyInfo)ï¼›SAMLæ–­è¨€å¯ä»¥è¢«ç­¾åï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ã€‚ä¸Šé¢çš„ç¤ºä¾‹åŒ…å«ä¸¤ä¸ªds:Signatureå…ƒç´ ã€‚åŸå› æ˜¯ä¸€ä¸ªæ˜¯æ¶ˆæ¯çš„ç­¾åï¼Œå¦ä¸€ä¸ªæ˜¯æ–­è¨€çš„ç­¾åã€‚
* **saml:Assertion**: åŒ…å«æœ‰å…³ç”¨æˆ·èº«ä»½å’Œå¯èƒ½çš„å…¶ä»–ç”¨æˆ·å±æ€§çš„ä¿¡æ¯ã€‚
* **saml:Subject**: æŒ‡å®šæ–­è¨€ä¸­æ‰€æœ‰è¯­å¥çš„ä¸»ä½“ã€‚
* **saml:StatusCode**: è¡¨ç¤ºå¯¹åº”è¯·æ±‚æ‰€æ‰§è¡Œçš„æ´»åŠ¨çš„çŠ¶æ€ä»£ç ã€‚
* **saml:Conditions**: æŒ‡å®šæ–­è¨€çš„æœ‰æ•ˆæ—¶é—´ä»¥åŠæ–­è¨€æ˜¯é’ˆå¯¹ç‰¹å®šæœåŠ¡æä¾›å•†çš„ã€‚
* **saml:AuthnStatement**: è¡¨æ˜IdPå¯¹æ–­è¨€çš„ä¸»ä½“è¿›è¡Œäº†èº«ä»½éªŒè¯ã€‚
* **saml:AttributeStatement**: åŒ…å«æè¿°æ–­è¨€ä¸»ä½“çš„å±æ€§ã€‚

ä¸‹é¢æ˜¯åŒä¸€ä¸ªSAMLå“åº”çš„æ›´ç›´è§‚çš„å¯è§†åŒ–è¡¨ç¤ºã€‚

![response-layout](https://epi052.gitlab.io/notes-to-self/img/saml/response-layout.png)

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡IdPè¿›è¡Œäº†èº«ä»½éªŒè¯ï¼Œå¹¶ä¸”å®ƒç”Ÿæˆäº†ä¸Šè¿°çš„SAMLå“åº”ï¼Œå®ƒé€šè¿‡å¦ä¸€ä¸ª302é‡å®šå‘å“åº”æˆ‘ä»¬çš„èº«ä»½éªŒè¯ã€‚
```
HTTP/1.1 302 Moved Temporarily
Date: Tue, 12 Mar 2019 20:54:53 GMT
Expires: 0
Cache-Control: no-cache, no-store, must-revalidate, max-age=0
Pragma: no-cache
Set-Cookie: _idp_session=MTkyLjE2OC4xLjk2%7CNmE1OWIwOTkxMjkzZjMyOTk2Yjg3NzE0NWNjYTkwYTliNGM1NDViZjRkZDhmY2M5OGQ2NmVjOGZlZTc0NzY1Ng%3D%3D%7CXWP3eN6ZeRPWk%2Bnj5AhRklHyIyU%3D; Version=1; Path=/idp; Secure
Location: https://shibdemo-idp.test.edu:443/idp/profile/SAML2/Redirect/SSO
Content-Length: 0
Connection: close
Content-Type: text/plain; charset=UTF-8
```
302æœ€ç»ˆå¯¼è‡´æˆ‘ä»¬å‘æœåŠ¡æä¾›å•†çš„æ–­è¨€æ¶ˆè´¹è€…æœåŠ¡URLå‘å‡ºPOSTè¯·æ±‚ã€‚POSTè¯·æ±‚çš„ä¸»ä½“åŒ…å«RelayStateå’ŒSAMLResponseå‚æ•°ã€‚è¯·è®°ä½ï¼ŒACSä¼šå¤„ç†å’ŒéªŒè¯SAMLå“åº”ã€‚
```markup
POST /Shibboleth.sso/SAML2/POST HTTP/1.1
Host: shibdemo-sp1.test.edu
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:65.0) Gecko/20100101 Firefox/65.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://shibdemo-idp.test.edu/idp/profile/SAML2/Redirect/SSO
Content-Type: application/x-www-form-urlencoded
Content-Length: 12314
Connection: close
Upgrade-Insecure-Requests: 1

RelayState=ss%3Amem%3A39430bdac29d44586c326f12b4cb3345ffa47137a374e37cba0877e0fc79ea91&SAMLResponse=PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c2FtbDJwOlJlc3BvbnNlIHhtbG5zOnNhbWwycD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiBEZXN0aW5hdGlvbj0iaHR0cHM6Ly9zaGliZGVtby1zcDEudGVzdC5lZHUvU2hpYmJvbGV0aC5zc28vU0FNTDIvUE9TVCIgSUQ9Il8yYWYzZmY0YTA2YWE4MjA1OGYwZWFhOGFlNzg2NjU0MSIgSW5SZXNwb25zZVRvPSJfY2RhZTcxODIzOGJhOWMyMDdhMzVjYzdjNzBiMDQ2YTAiIElzc3VlSW5zdGFudD0iMjAxOS0wMy0xMlQyMDo1NDo1NC4wNjFaIiBWZXJzaW9uPSIyLjAiPjxzYW1sMjpJc3N1ZXIgeG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIEZvcm1hdD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm5hbWVpZC1mb3JtYXQ6ZW50aXR5Ij5odHRwczovL3NoaWJkZW1vLWlkcC50ZXN0LmVkdS9pZHAvc2hpYmJvbGV0aDwvc2FtbDI6SXNzdWVyPjxzYW1sMnA6U3RhdHVzPjxzYW1sMnA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8%2BPC9zYW1sMnA6U3RhdHVzPjxzYW1sMjpFbmNyeXB0ZWRBc3NlcnRpb24geG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjx4ZW5jOkVuY3J5cHRlZERhdGEgeG1sbnM6eGVuYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIiBJZD0iXzNmZWYzNGViYTU1OWFmYmZhOWMxMGM4OTg4ZDcyMjA5IiBUeXBlPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyNFbGVtZW50Ij48eGVuYzpFbmNyeXB0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjYWVzMTI4LWNiYyIgeG1sbnM6eGVuYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIi8%2BPGRzOktleUluZm8geG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjx4ZW5jOkVuY3J5cHRlZEtleSBJZD0iXzYxNzgyYWUxZjEwYmZmODdlYjI1NDIxNGJiNGI4MzMyIiB4bWxuczp4ZW5jPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyMiPjx4ZW5jOkVuY3J5cHRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyNyc2Etb2FlcC1tZ2YxcCIgeG1sbnM6eGVuYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIj48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiIHhtbG5zOmRzPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIi8%2BPC94ZW5jOkVuY3J5cHRpb25NZXRob2Q%2BPGRzOktleUluZm8%2BPGRzOlg1MDlEYXRhPjxkczpYNTA5Q2VydGlmaWNhdGU%2BTUlJQy9UQ0NBZVdnQXdJQkFnSUpBT2Q3UEUxdWFhVWhNQTBHQ1NxR1NJYjNEUUVCQlFVQU1CMHhHekFaQmdOVkJBTVRFbE5vYVdKawpaVzF2TFhOd01TNXNiMk5oYkRBZUZ3MHhNVEV3TWpFd016VXhNalZhRncweU1URXdNVGd3TXpVeE1qVmFNQjB4R3pBWkJnTlZCQU1UCkVsTm9hV0prWlcxdkxYTndNUzVzYjJOaGJEQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUxldnFJWjEKOG1MQzZhU1gwSnNXdS81SnBlR0VMbGVLbFRabmtJaUt3Ny9FVnN6N0VmZEZhVEd6cU1pTjFlTS83NjY1bTFBcHhJVUpibnN1cE15Ywo5Mm9WaFpJcDNxVU5mMTExMldJNlovL1dOWThFTVU4WXdheUxGSmdjQUkxVHpyVS9NNHpjaitTRFVqeUNOaDBnYVlUWENFT0NpeWFXCkl6cGxWMU9IRzNXdmVWenFTVGZHa2p4UWpBc21mZmZVVzY4eEVyVlVYck5SWVlWUStBMmlMbUwzQ29jcmc4QUwvNTRSbnRPdm1vRngKMk1xaVVseVA4dWdML2FiT05EeTlLd0VqYXNNZmR3YzI1L0p5TEFQMTE4VThPNUk3UXRvUG90bS9rRWpZOEY2SmJnSXlmSSswUElPUwp1dTlnU0NSMFhkRm9WTnI3ZkppM2JwT09PclduUjRzQ0F3RUFBYU5BTUQ0d0hRWURWUjBSQkJZd0ZJSVNVMmhwWW1SbGJXOHRjM0F4CkxteHZZMkZzTUIwR0ExVWREZ1FXQkJSUGNxSGk1VUhNNis3ZEs0VnRwTCtPL082ZldUQU5CZ2txaGtpRzl3MEJBUVVGQUFPQ0FRRUEKVFM1SUp0UlBWaEk2ZndMQUZzS0Q5K09PbjFZRlY2NUVWVFRGaFJQeDRoTFdxQjRPRVBpR05kN2pEdFQzTVhzdmNpeTc3cS9sckV1QQp4bWw4dWloekpqSzQwbndFcThFUnRyWWZhbmhNeDJrT2JzWU4vMW02RGs4eHJkYU9oeHE1UDdrVG9JbnNTK3VEOXhCK1g0cUN4Rm52CmJ1Qm1wSC90UlR5amROcU5vVEVRa1ZBMVBmUHdHMG1wTEhXUDlPMVJqTjFsV3Y4ZUVQb0JBdzQ4ZHFvVnlCQUxoN2pJektvN2RWUW0KSitNVlhnMnRvR0l5NnhjekJOYk5ZVU5BTnc1b2M5MlY3VE1LaE00cE4zSUR1aFk2VTNkMmlYZGNsYkVRLzZiTHhlaXRYUllUWUxIQworTUs0VmFXNUFPN0hXZEhBSEVRV2NDaXpOU0xFekZXMWhBbHcvQT09PC9kczpYNTA5Q2VydGlmaWNhdGU%2BPC9kczpYNTA5RGF0YT48L2RzOktleUluZm8%2BPHhlbmM6Q2lwaGVyRGF0YSB4bWxuczp4ZW5jPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyMiPjx4ZW5jOkNpcGhlclZhbHVlPlhEbkNOUk1VK3o3bnIyeGltRVZZR2JCMjdXenJlSUVBeFVrRWVmYWlrNHpjWFNqUWd5amdiYktFMkVFN0UzZXUvai81WW15RW9kS2c0M3VUbnlJcjZHSWE4dDlvV1NPTDNmNHhaNlpRSmJMbmZHeEpZM0pyRGVNTXhBRU5vZ1lsSy9RZFZQbDNGdFhsZXlibHE2YXlBd0oxYkhMc3dGRHVmWDJma2NrQjV2MURTclN5S3JtNjhZSTB2WWthcmFvVkRKU2c0RmxIRTl1dXFSdVdXYjN1a2dYNGF3VytHb2VWb0VFZjJLQlhJdnlneXI3VG00d3dhV2NETy9WV3JITkREV2o1M1c0SzVWVW9ibEVKVkptRVNSaUx1L0IvMUxielovZkd1V0FxRU5SRmtDbUZEVm12OWo2eHNwNk5GVCs1MWZDSi9LMUhsbUtmOVVQWC83dzhOQT09PC94ZW5jOkNpcGhlclZhbHVlPjwveGVuYzpDaXBoZXJEYXRhPjwveGVuYzpFbmNyeXB0ZWRLZXk%2BPC9kczpLZXlJbmZvPjx4ZW5jOkNpcGhlckRhdGEgeG1sbnM6eGVuYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIj48eGVuYzpDaXBoZXJWYWx1ZT5OV3MxampNRG5yYnFRQTl0VnJKbnN6dUt4d0Rva25PeEVmQmNpZEZSc0lFR0Z0eVUyd2cyWmdMVXhYZmhML1NUWEdMYVlKNFhTR1JTQ1pUUzFjbkhFUWdjNzlVWUUzcjB0ZCtjM0ViaU1JWUFXdFJMZWc2TEgxd0ZGY2RqMEhBS0pwNG9OZnpQTUovZ3BkeXZWZ3FhcEZPdDFOT0tNalNOS3EwUlhWMm5DK1BrZWxIOVVqU1lDdTg2TE12dTREcHBMc1JVQWFvRTJJM24rUkNOYUIzRHRJZTVISFZkR0JmNk5reXR6Z05oNFVDZ0ZWbFA2TjN3SjdwbDBEQ0YrTHErVzVPdGNMVDl5UkxhbXJsY241eVlxV2k2V3NxaUVUMHpPbGI3bC81RnlqUDFYZVBGWFJNeWpXblFTcWN1eFRuS2ZISlNLc0NRZG0zb0xWeEt2ajZFS3NmbmFiQlgrVnBydjhlSWN3QXBxTWRhOUlWMmh0eFljOFhGWTZtcnJMUGpoeVJHMHI4cGxoOFpEazZTcTFmNVpGRnRCdXZLZ3F6NS9TUXJmVk1FMjJKQUhXOHphQ0ZzR3NLRXBicDdTZ0E3Yi85NlRnM25mZDh5eVJrb2d5ZW9CYmcvRHRhN0VRRnh6bW9RVXpNV3Q3WkJ1ZDhGNXQxQUJIRDlsVnNkUXd4djA4b2FGMi8vNXE2M1RCOEcwcGZYNXYyU3pYV01wUFE3amtHZzJ1clpYU2loYWQveGJpODBLaFVFcXBvZFd6UlVUckluNUE0b055YU5uelkydzdDSGpjUmppQ0kzM2hQL251Zm5qQzZyK3VaV0V3T3ZkRFJMWU0xMXRoK056a3VGcnJTS1RVeE9MY0tBNWxVVUFEdTdpVFVUWTYweXl1RkZXRlo4TDZuSW93NTFiN1cyWVVESlBRZmZkaWJEczg3TUxma0V4VWZ0QTBsc3ZKV0dvZDh3SkVNaUk4M1pEdjJ4WFhlYWJURFdhK1FRS3A1anNiUS9mcWJ1Y3VOeDI0UlhQVDN4VysweWVQQ3V3dlp5SnJTOFlwYmVMV2FBQTMxbXNYSlFTTXNacEpXSFpjVS9EWnhsVHYyQzVpNVhJck5oQUNDMnd1elAzTTB3dWtXVkV6MjAyVkloN3NDSTh1anNNNlJPQU1oNjhSRndTc2FJaEMzbVpZbGJzV1lqTzZyTXJhSzljK1BXdEhoZGZPbDZqTjJNZkZsT3NKdDc5RWsxNHNsbmpPNWIwazVCcktOTkxPYlQ1aTBiSng3UXdlNE0rbDJlVlpGOURkbEI0R0FGVjdMeVVGUWpHYTkxd2JBdS9jTlZWRldYMFM3L3FkcjNXQXVnQjFsL1hRN0lsRTBMbjRpSnJJK2hlWjZ6d0VBUVNibHFyYXRaSXY4U1UwT0J1b2tYWks2UXU3MnB1TUFpdDNZZklHbk8vaUJrR3VCelhiTzR2S3NpZjNYczE2aS9ad0d2eGFDOExkYXNHQ25veVdmRE1IZG1ucWlpL1JjNWhpZUZxazJLNk9zUHpFQjVUeXBWbVZFWTBDMlBSY1hKOTlMelZ0U3NQS25tNnpzanR2MnRaUm9iV2dKekZhK1pDZlBzbEVDNndWTUJPL0hPbHMxZGY1bTBVcXVGUGZPK0dyd1E1NEE1VzJ3S2pwMTdnT2lhRzNKWXlHZG5NaUxvTEV3dStaV0NDMnZLeExEOUxPRDVYUk0rRERmU1FCazZVQjJmaWFxTjA0eC8wcTRRT3RMN2dCeHo5MnY5REp1UHFYcjhuWnFXOVFXbnNtODFpcHVWdEJVeG9paWNtZlMzOVovRTd2bzFYenlNdmN4TjNndFNTSHljTlNPYm11SklLcEVHSDM2ckQxbmppbHZ3RWhJT1hKQ2QyenRNZDVOZ0wybEl0SjNtUmpnVzg5WnNkR0YxcVdRZ2g2ZmlVOVFwL2IzNW10c25TZVpiS1ZTc21IY2k0VmlCSXpXLytwa2lucWk2Y3NCdCtxeFIvRGNvMlkzdVdpaFR0UC9zaDRLNGthYlNQd2NySGZ2YVJlZWNUTUxLMVFIem5SdjhNRzE4M0h4RW9tM2FFd2UvdjlqQitIOG1IZDVucDNKM0tKS0wzQ20xeHZETERhUFVRYkRHb2pUNE1kNUtVMTBOSmV2c3hFMFRiSVdBUWJLeDUyL21jVlNicEpxT210NDlNeElxTXRESVJST3RUcEcvTldaQTZ6Q0VRbTRTQ055WW9oVFdUTWVxU0VuMU1odlQ5dGw3S3cxd2twb25yRE0rbzNGNmsrTXFGTGMwcHNUR2d1T1Zrd0pXdkxudG1XUllMTXIvdEdKTWVsV25Mam8wQmlqVlZYQjlPWkhzbTVScmdJWVdIYm83SkFMbTBHMGxHVlRmbThtaXlsbExRK3RSbGFpTVI1c2ladktVdk0rNlkzK3VMMWtSOWxnUHQ5U1ZCWURzVTZBMXRyTzNIck5uZ1g5UWRVSUExQUtraDBiUVIzVHhlZ3phK2pwL3JNSm1ob25IR21STlFYZzVmZFRiem5qQ3lCMWdDZ0N6dkE2RHJFQ1JwQVdMeks5OFdpZ25Jc3JKakIwMTJzaGV6UDc2ak1meExGcFh5b1VXYkNhVFVoYjNJMkUydXRyU1dDUnZOeGJPTGlYdUtUUkQ2UEkzdlNjVURHQU9VL2QxTDdYQ1VnOXJEM0VqSnFPYTQ4aEFNMFRYdjB5MWlkRXFZWnJCK1hmSVl5c1NqTmVHOWh1WTRHenRuQW9oaWVtZ0hsdlJGdkVJckJpT3paVHNnQjllaElrOGFpK3JXUDk1OEM0dEVwRnhhNS8zVDNHOC9INHd4VjByaGNjbHg4VS9JY0FOVVJxQlNrSHZMUmg1dlBjcFJDMjNoTngvRXM1VVlXMXZlR2pMYlpRalMvSXQ4TDVsYjhsL2pZMGxlN2dIVEZ5RnBBcWx3TDlmY1QwZUFaYm1MbW1ZZElEbnJxdGVYWGQwL1dXcWVaV0cwQ3g0akorN0hCVHJodUNzcDJ3QlRzb3FTbGdreUhGNU1SNEVlNitiY2pxb0tXSUpzdXEyaEkrbWQvUDE3RlJ2YTQwdXMxNFY2Z0RrVHZEcVZ3OTk1MmZOTE13TmR4bzlRa0NWTmwxRy9FNGVETXl3MUMzMXFiNnJtUlRhclN3Vmx1RlV5RnZpVUE3WkxJOWxuZjNTRUNPV0NRYy9tdkZCVGNRUXExYnN3S2tPZTAvM3lPSlB4VENNU2ZIeDc5MlJSbHNXSkxDdVNkRjBDWEhKSzltL0F3L2U5ZmRmUVduVyt4RUFWdlRBTEFKbjd5QWkwRUtQeU56anMybndReEZhUWtydWhUeGxrMm9TT3p4ODhET2JDakNNWDJSbEpEUzY0M000U1ZpbUcyUjFlSlNPbS9YUkhoeU5MY2RWeTg1b0VJOG1FSG0yN2paVDRUVlhCeEpQcnpKNUVkbTFQWHZtZ01RZXFzSWVFSWZ4TFpvNG5YL2JwZmtnRGF3SkxkSUdHczh4TE9rclBFbDQ5NGJtc2FsdFpTRHh3eCs1MmtjSm9MRHRnNk5YdnVEWHc2eDNhTm1qK0VTK0toQzZ6Wmc3b3I5YVZmWEUwUjUrY3FsSjIvd2NDWmZBcWlVUkF0QUdCWDBOYnA4WUVpRVpwVzJYNXFmQ1RpbUVobjVVdUhTeHY1cVNrQXdYdlNBVGljbFRTY0kzWTJQOURURVozblRNR0cyRXJVT2hjU0FobC8yUGFRemlDeGNTYSsvWUhaUzZCRk9KRi9tWTZ5WHVMd3NzRVJSZ0o4S09wMUVSU2FZVWVXRDJtcERZUy9KRVJobEFVUmFkOFVjYVVLSEJZSTg5eXIzdk56N2FqbUt3U3dRanlnRm1nZGJrSFFwQ25EcTE2TzMwdDY5eXhwcC94OEZFNUo0TU9ab1hwVXJPZ1RkSFlFa3IwN3dPZzR2U1BlZTZSUWRhOUo5eTNvQUNvZFlrQ0V3VGlpU1d6RlRwRGpjM2dEZU1WOUdkUUJOYUVsa25obFNBN3JRRFR2RDhjSmQ1WDVnK2kyTUdnV3A2UmcwdDR6OEg3dCtkYXNsZkd0Sll5dzc1a3hadHpPT3JCV2ZmU3kxSVVLMDB3VURzUUY1TytEMzVydXcwa245ZnUzbEZCU1RqNGVKQ2ZuWHVvTUY0VG41YUE5WWtkYWZUTHlCRVB0WVN4dFNzeVRKQWJLZXNaeXl2bE5YOGFEbzB0Z1NrTUZLbDNhUy9Db09vRG9BNE11ZG9iNGFMOW83MEdlNStnb1JwMkJsa2NzZ3A1Z2ZlSlZlQ2ttdWNYYjVTWGs3ZVRSU1BPU3BBQjROTXZJL0xLRVJ4Z2lhMHkzR2hWYWJLMHEweVBUQWFya0xEM0d5SHB5bTFjd3NmUTMzQ29PWmZERU5zc1VoK1pKWlo3TDVmbHkydldBcGVPZ3B2UU9pc0g2VGRXbXFOSThlNE1qcUJuL1V4anM2UU4xeXlrbEV5WFk3aDRPNTNMUHlEUDI0am5XVFQ1NVRlenE2U1BpVFJRNmlaYVhsTnFFMWQ5WDIzV2tUUFQyVklUMElNa3BJUFhuTkllem4ycVRIMEJEWHJIcUtNUG81RC9qZW0vL2ltR0VQU1JabUhtTGJuM2ZsazF3VU9FZGZiL0JkT3dFVkRIRHlnU3ZHYS9DM0JkNVVKekVPaFlzSFN0YXFiWUFYSlVmb1p1ck5RQ09od3hCVVJySzdadmVMc1lsc01pK1hvZm11c2NFQ2oyVzUwRE1peFF5Vi9JZ2Q2dEpWb1p1Zk1Rb01pb2xEMSs4VmNLOTNVS0djUmVUTnhZV05vZjVEZ0NJNUVTdEVoMnlOQVhFMFNMNTlGT1V4am13bzNMbEJIOUN5VUc2QXp5STErc1lxQk5MdVBteEJTQUl6UFYzT2NzZmpoWEpJeXIxMnQ1Yi85THVpT0hRU3hWUmQyWVAzekM1Nmg3Q00rSUZNam1aRUdIakIvek1ESTJCc3hvMmhQeVh4N2Y1eVpwS0poVFZ5dXpiSjZIMzlHU3M2ajF6RytrVWgvVmd2bU1yWlhseHgvUVlTMU5QSVJ6dElQRmU0dHNGY0IyV1JNZXhvZEc3VVE0NjBZQk5hWGFLU3cwMHdmaGdhVHVxWVhMRy81Y3RjUy9DMkg5VWdra2RtOG1yNzRpVjBYdklaQmxSVXo2cVNLZjFtZExQcGppbDBJNUFRR2UwUmhHMTZ6RElsNEdsem41cVh2dS9BdVZvZzJwT0hLaTBqcVJqa0p4VkdPQjVNK1lpeXBXSWpzTkxRNDYxR2hNeVN3aDMzVlI4aWhueWVmM1oycjlXbVgrSkJkTGNZOWhiRFZKNFAxT2hFb1Vxd0pnV25saUoxL0NIelYwSG5CaGcrc1lZZnVnT0ZSaWY5ZDZCVUZ5cmIwVnF0OTlWQTZyLy9GN3AzMG0zVzBnMjlNQ2VoZG14SzhHVFZ6d3JpTGpnaDArUXpHeHJoMk5hRG02NWs3Y1BKMVREWmlZa3I2OEh4MnBVTmRMRmtpZHJsTDd3QWZrV3V2Tmd5ZlRlclFsSzdxVHUxNzJZdzg5dThxZmkrenoxdktrakx6d2x4ZHE0K0oxOVpHMnJ3ZlBXaFRJbG1hL1VQTndFNkhycVY2ajhGYWtVdGZNSVJWWHRtK1JyNFVJOEdackpJbUVueTJlV05DM0lQZUQyRVQwN0kwRU92RDFtVkdQVHRFK1pqZ1ZLaFFEYVdINkR3LzRtcVJ1b2tLU252YjJ4a28vd0dRV0RUTHdjSWM5c3pXRHRIbEJRdjZaaU5KTkxGamFWWksvaWFaNVRmWUFLTk9IT25sU25xc1ZOVnk5eEV5anhtYzVVYUhYNHdSeS8wQ29PWlNqODJpU2tWa2NOc0hsVXh5d2ROVEl5NGYzWmVncDk1dmg2TE0vUnd3T1VjYjdSODVBYTFGVXA1WkszQ1NkZi8xdlQrSjZUYUdoOWtnOHkyZzJwZjhXU2NDYXYxMVgxV1pOOFhkb3J0WDZ5ZzhUaFVzaWxvK09DeVlMelNOWm94MHkzQU1DNW56UFBNZGRBUC9sRUd0OHpVS1FvU0JkbmZYTEZQaWk3aDU3QWNqc3JNSm5HTmhoOHQxVU1TOGNDWWNBaVZSU3c5Qk5GdG1aQkFHNjR1ZXl4dytQZWpYN3ppWDZrOXlGVWNFdk8wQ0JkZGRWVVRZdS9NZkZpT2V6K3dpRFdzY3hJNm9OcWJndUR3MDdvTytQcDljTjFaWmNqYmJNd1JsSEdMTUsrZlVzZ2orbWt3Z1MyR2VWTGovV3lUSGo5VG1GbFhMWEtlZmxkWVFKUG1lb0kwQmdVZ3E3cHgzUSsrWXpNU1hrZFNIUmllOTRyU3dlOU9jZU9yM2FTcEQ2Yzl0cGtYZFJyQWoxWVdIbGhDaEkvakJXM3lMbEw0WDlGN3JrUVpsL3BuMERtQmJxYTdta1k4em9oTFdPMDhkTTNMS3FGU2VkdElmYm83emNLWnBIY2tjdVhQSWF4dHlYTVdWanBieUZEQXpYSlo0V2JCR0hCRzJ1ZlREeEU0VjdFaHFMeCtWZlNyMUFzeGhYRW0xQnRwRkRaSFlOUXNFUXBOS2R6M2JybStjZnowYU1raDZGaGF1YklicUFQNWlaQ2crN3dZUHNmUm42bDE2ZTIrZFVSNE1mNWxyZE1UaUljVTNEdGFuRVF2YXdSQXkySCtMNGdLNTROVVh4ZE5KY3NKWkFuOXdzSzlWdzJxS0M4UHhDaGR0dHV2Qm83KzkzVEdGenMxS2FBSFdNTk1kMnVKVVlJTkdLUEIyKzVSU0JuVHpDbU55bUFpOGJ3ZWxnTnpSbkNtWVNZaVJHbmlQc1dmUmJlTTNSWURaVDkzbEo5c25oamNuYnFCMDYrUlloaVBHeFdSVVJIZE1QaHI5TTNOejFpdmRFckd5VmNmdzhNT1FvbFZLTmIxdUJQME42SEd2NVVyQzBxYmpRczJ5OWJDaWw0dEZNbzlGY0tqNWNYUGpMU041RDl4OG14MkNORmNPbm1sYjI5WFprS0NtN3d2STFVREZGTlFlYnpDWTlSMWtPUG9PWlV1N1Y2RDVWcWlwcmZiOVVlK3lLenkyOExTMEQyUjlmSVNpZnhNRExBUGZMODZzYjRlR1R4U2J3Wk9MTWI0QzlUcjNiMVdUenA0WnFwWExmSVpoSEtvZGxoZkgyTTFaQ1FGamRxTS9XWGprL092Q3ZHczNocDdBckVtQTBJOGtnMDFVUmpMdXJVMkc4T1hyWkxhdFNUaEJOZm5JTDFYenI2U3M1dzJ1cEpnOCtwM0NSb2YxVHRma25BcWp5dXYwcVNDdUVBVTF0Y290OTVuQVBacndMdUZTS2QwK1FTSDJMQVEzNlZZMEpLbVRqMXFSQndNUzJ6UFNGVzJsYXU2cG9wUUdxQTR1K01USnVpOXY4M3RWMG9xRDV1NkVSTXZ4WnFGcGgvWVZZUVFPZEJiSHJwZWFyTlVrVG5DM0s1TmNzSTArVWtJdGN3L1BYZ2FhMStIdXhJRmNzOStxeitTMDBtVEs2c3pnUWZ5Q3ZsUExKVXhOT3VBUVFpTzBRVzBhQjBtMEIvQWNyS1RjNlJaRE42cGM5WVIybUcxOW1yR09veUxmVjFaL0lVd1VHUFB1ZkZGZUsxdzBxUzNnMHZxdmQ0VWhFTVgxMTgrMzVka2w2N3JWb2NkRUJnQlZVWVRTNkpabHlqRVNYSVJaQVBCQnlBRkF1ZzRRdHRqT0FKcFp1TmtFd1dFV2V4TC9SWkJ1MHcvQjIyYVV4d3p6SVZUOGFTOVpCV3FBS3NicXRuYno1YXU1MzNXS2VaSm0wdHJKQTUzZE1sK1lFemNPMjIvenlWV1c2MURiTnRCbUpJWWhCUkRDOUx3KzdCWjJBemc9PC94ZW5jOkNpcGhlclZhbHVlPjwveGVuYzpDaXBoZXJEYXRhPjwveGVuYzpFbmNyeXB0ZWREYXRhPjwvc2FtbDI6RW5jcnlwdGVkQXNzZXJ0aW9uPjwvc2FtbDJwOlJlc3BvbnNlPg%3D%3D
# SAML Basics

SAML (Security Assertion Markup Language) is an XML-based open standard for exchanging authentication and authorization data between parties, particularly between an identity provider (IdP) and a service provider (SP). It allows for single sign-on (SSO) functionality, where a user can authenticate once with the IdP and then access multiple SPs without needing to re-authenticate.

## SAML Components

SAML consists of three main components:

1. **Identity Provider (IdP):** The IdP is responsible for authenticating users and generating SAML assertions, which are XML documents containing information about the user's identity and attributes.

2. **Service Provider (SP):** The SP is the application or service that the user wants to access. It relies on the IdP to authenticate users and provide the necessary information to authorize access.

3. **User:** The user is the entity trying to access the SP. They authenticate with the IdP and receive a SAML assertion, which they present to the SP to gain access.

## SAML Workflow

The SAML workflow typically involves the following steps:

1. **User Access Request:** The user attempts to access a protected resource on the SP.

2. **Redirect to IdP:** The SP detects that the user is not authenticated and redirects them to the IdP.

3. **Authentication:** The user authenticates with the IdP, providing their credentials.

4. **SAML Assertion Generation:** Upon successful authentication, the IdP generates a SAML assertion containing information about the user.

5. **SAML Assertion Delivery:** The IdP sends the SAML assertion to the user's browser, typically through a redirect.

6. **SAML Assertion Presentation:** The user's browser presents the SAML assertion to the SP.

7. **SAML Assertion Validation:** The SP validates the SAML assertion, ensuring its integrity and authenticity.

8. **User Access Granted:** If the SAML assertion is valid, the SP grants the user access to the requested resource.

## SAML Vulnerabilities

SAML implementations can be vulnerable to various attacks, including:

- **Identity Provider Impersonation:** An attacker impersonates the IdP and provides a malicious SAML assertion to the SP, gaining unauthorized access.

- **Service Provider Impersonation:** An attacker impersonates the SP and tricks the user into providing their credentials to a malicious IdP.

- **XML Signature Wrapping (XSW):** An attacker manipulates the SAML assertion's XML signature to bypass validation and gain unauthorized access.

- **XML External Entity (XXE) Injection:** An attacker injects malicious XML entities into the SAML assertion, leading to information disclosure or denial of service.

- **SAML Response Replay:** An attacker intercepts a valid SAML response and replays it to gain unauthorized access.

- **SAML Response Injection:** An attacker injects malicious content into a valid SAML response, leading to various attacks such as cross-site scripting (XSS) or remote code execution (RCE).

- **SAML Response Tampering:** An attacker modifies the SAML response to manipulate user attributes or gain unauthorized access.

- **SAML Response DoS:** An attacker floods the SP with a large number of SAML responses, causing a denial of service.

- **SAML Response Signature Bypass:** An attacker manipulates the SAML response's signature to bypass validation and gain unauthorized access.

- **SAML Response Encryption Bypass:** An attacker manipulates the SAML response's encryption to bypass validation and gain unauthorized access.

- **SAML Response Injection via IdP Metadata:** An attacker injects malicious content into the IdP's metadata, leading to various attacks when the SP processes the metadata.

- **SAML Response Injection via SP Metadata:** An attacker injects malicious content into the SP's metadata, leading to various attacks when the IdP processes the metadata.

- **SAML Response Injection via IdP Discovery Service:** An attacker manipulates the IdP discovery service to inject malicious content into the SAML response.

- **SAML Response Injection via SP Discovery Service:** An attacker manipulates the SP discovery service to inject malicious content into the SAML response.

- **SAML Response Injection via SP Initiated SSO:** An attacker manipulates the SP-initiated SSO flow to inject malicious content into the SAML response.

- **SAML Response Injection via IdP Initiated SSO:** An attacker manipulates the IdP-initiated SSO flow to inject malicious content into the SAML response.

- **SAML Response Injection via IdP-initiated Logout:** An attacker manipulates the IdP-initiated logout flow to inject malicious content into the SAML response.

- **SAML Response Injection via SP-initiated Logout:** An attacker manipulates the SP-initiated logout flow to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout:** An attacker manipulates the single logout flow to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout:** An attacker manipulates the single logout flow with IdP-initiated logout to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with SP-initiated Logout:** An attacker manipulates the single logout flow with SP-initiated logout to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout:** An attacker manipulates the single logout flow with both IdP-initiated logout and SP-initiated logout to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout Service:** An attacker manipulates the single logout flow with both IdP-initiated logout, SP-initiated logout, and single logout service to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout Service and IdP Discovery Service:** An attacker manipulates the single logout flow with both IdP-initiated logout, SP-initiated logout, single logout service, and IdP discovery service to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout Service and SP Discovery Service:** An attacker manipulates the single logout flow with both IdP-initiated logout, SP-initiated logout, single logout service, and SP discovery service to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout Service and IdP Discovery Service and SP Discovery Service:** An attacker manipulates the single logout flow with both IdP-initiated logout, SP-initiated logout, single logout service, IdP discovery service, and SP discovery service to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout Service and IdP Discovery Service and SP Discovery Service and IdP-initiated SSO:** An attacker manipulates the single logout flow with both IdP-initiated logout, SP-initiated logout, single logout service, IdP discovery service, SP discovery service, and IdP-initiated SSO to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout Service and IdP Discovery Service and SP Discovery Service and IdP-initiated SSO and SP-initiated SSO:** An attacker manipulates the single logout flow with both IdP-initiated logout, SP-initiated logout, single logout service, IdP discovery service, SP discovery service, IdP-initiated SSO, and SP-initiated SSO to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout Service and IdP Discovery Service and SP Discovery Service and IdP-initiated SSO and SP-initiated SSO and IdP-initiated Logout and SP-initiated Logout:** An attacker manipulates the single logout flow with both IdP-initiated logout, SP-initiated logout, single logout service, IdP discovery service, SP discovery service, IdP-initiated SSO, SP-initiated SSO, IdP-initiated logout, and SP-initiated logout to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout Service and IdP Discovery Service and SP Discovery Service and IdP-initiated SSO and SP-initiated SSO and IdP-initiated Logout and SP-initiated Logout and Single Logout with IdP-initiated Logout and SP-initiated Logout:** An attacker manipulates the single logout flow with both IdP-initiated logout, SP-initiated logout, single logout service, IdP discovery service, SP discovery service, IdP-initiated SSO, SP-initiated SSO, IdP-initiated logout, SP-initiated logout, and single logout with IdP-initiated logout and SP-initiated logout to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout Service and IdP Discovery Service and SP Discovery Service and IdP-initiated SSO and SP-initiated SSO and IdP-initiated Logout and SP-initiated Logout and Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout with IdP-initiated Logout and SP-initiated Logout:** An attacker manipulates the single logout flow with both IdP-initiated logout, SP-initiated logout, single logout service, IdP discovery service, SP discovery service, IdP-initiated SSO, SP-initiated SSO, IdP-initiated logout, SP-initiated logout, single logout with IdP-initiated logout and SP-initiated logout, and single logout with IdP-initiated logout and SP-initiated logout to inject malicious content into the SAML response.

- **SAML Response Injection via Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout Service and IdP Discovery Service and SP Discovery Service and IdP-initiated SSO and SP-initiated SSO and IdP-initiated Logout and SP-initiated Logout and Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout with IdP-initiated Logout and SP-initiated Logout and Single Logout with IdP-initiated Logout and SP-initiated Logout:** An attacker manipulates the single logout flow with both IdP-initiated logout, SP-initiated logout, single logout service, IdP discovery service, SP discovery service, IdP-initiated SSO, SP-initiated SSO, IdP-initiated logout, SP-initiated logout, single logout with IdP-initiated logout and SP-initiated logout, single logout with IdP-initiated logout and SP-initiated logout, and single logout with IdP-initiated logout and SP-initiated logout to inject malicious content into the SAML response.

## References

- [SAML - Wikipedia](https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language)
- [SAML Technical Overview - OASIS](https://www.oasis-open.org/committees/download.php/27819/sstc-saml-tech-overview-2.0-cd-02.pdf)
ä¸€æ—¦æ¥æ”¶åˆ°POSTè¯·æ±‚å¹¶éªŒè¯SAMLå“åº”ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¿é—®æœ€åˆè¯·æ±‚çš„å—ä¿æŠ¤èµ„æºã€‚
```
GET /secure/ HTTP/1.1
Host: shibdemo-sp1.test.edu
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:65.0) Gecko/20100101 Firefox/65.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://shibdemo-idp.test.edu/idp/profile/SAML2/Redirect/SSO
Connection: close
Cookie: _shibsession_64656661756c7468747470733a2f2f7368696264656d6f2d7370312e746573742e6564752f73686962626f6c657468=_ac05716a62d3ee9450c863b093f32bbb
Upgrade-Insecure-Requests: 1
```

```markup
HTTP/1.1 200 OK
Date: Tue, 12 Mar 2019 20:55:04 GMT
Server: Apache/2.2.3 (CentOS)
X-Powered-By: PHP/5.1.6
Content-Length: 1047
Connection: close
Content-Type: text/html; charset=UTF-8


<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>IDM Integration</title>
-------------8<-------------
```
# XML ç­¾å

æˆ‘ä»¬å‡ ä¹å·²ç»æ¶µç›–äº†æˆ‘ä»¬éœ€è¦äº†è§£çš„æ‰€æœ‰åŸºç¡€çŸ¥è¯†ï¼Œä»¥ä¾¿ç»§ç»­è¿›è¡Œå®é™…æµ‹è¯•ï¼æˆ‘ä»¬éœ€è¦ä»‹ç»çš„æœ€åä¸€é¡¹æ˜¯ XML ç­¾åã€‚æœ‰è¶£çš„æ˜¯ï¼ŒXML ç­¾åå¯ä»¥ç”¨äº**å¯¹æ•´ä¸ª XML æ ‘æˆ–æ ‘ä¸­çš„ç‰¹å®šå…ƒç´ è¿›è¡Œç­¾å**ã€‚æˆ‘ä»¬ä¹‹å‰å·²ç»çœ‹åˆ°åœ¨ç¤ºä¾‹ SAML å“åº”ä¸­ä½¿ç”¨äº†ä¸¤ä¸ªå•ç‹¬çš„ XML ç­¾åã€‚æ¯ä¸ªç­¾åè´Ÿè´£å“åº”çš„ä¸åŒéƒ¨åˆ†ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å°† XML ç­¾ååˆå¹¶åˆ° XML æ–‡æ¡£ä¸­çš„ä¸åŒæ–¹æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶æˆ‘ä»¬çš„ç¤ºä¾‹å°† Response å…ƒç´ ä½œä¸ºè¦ç­¾åçš„èµ„æºï¼Œä½† XML ç­¾åå¯ä»¥åº”ç”¨äºä»»ä½•å¯¹è±¡ï¼ŒåŒ…æ‹¬ Assertion å…ƒç´ ã€‚

## åŒ…å«ç­¾å

åŸºæœ¬çš„ XML ç­¾åç”±ä»¥ä¸‹å…ƒç´ ç»„æˆã€‚
```markup
<Signature>
<SignedInfo>
<CanonicalizationMethod />
<SignatureMethod />
<Reference>
<Transforms />
<DigestMethod />
<DigestValue />
</Reference>
<Reference />
</SignedInfo>
<SignatureValue />
<KeyInfo />
<Object />
</Signature>
```
æˆ‘ä»¬ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªè¦ç­¾åçš„èµ„æºéƒ½æœ‰è‡ªå·±çš„Referenceå…ƒç´ ã€‚Referenceå…ƒç´ çš„URIå±æ€§è¡¨ç¤ºè¯¥ç‰¹å®šç­¾åç­¾ç½²çš„èµ„æºã€‚é€šè¿‡æŸ¥çœ‹æˆ‘ä»¬ä¹‹å‰çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸€ç‚¹çš„å®é™…åº”ç”¨ã€‚
```markup
<samlp:Response ... ID="_2af3ff4a06aa82058f0eaa8ae7866541" ... >
...
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#_2af3ff4a06aa82058f0eaa8ae7866541">
...
</ds:Reference>
</ds:SignedInfo>
</ds:Signature>
...
</samlp:Response>
```
æˆ‘ä»¬åœ¨ä¹‹å‰çš„ç¤ºä¾‹ä¸­çœ‹åˆ°çš„æ˜¯**å°è£…ç­¾å**ã€‚å°è£…ç­¾åæ˜¯ä¸€ä¸ªç­¾åï¼Œå®ƒæ˜¯æ‰€ç­¾åèµ„æºçš„åä»£ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­çš„ds:Transformå…ƒç´ ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹æ˜ç¡®è¯´æ˜ã€‚
```markup
<ds:Reference URI="#_2af3ff4a06aa82058f0eaa8ae7866541">
<ds:Transforms>
<ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
...
</ds:Transforms>
...
</ds:Reference>
```
## åŒ…è£¹å¼ç­¾å

é™¤äº†åŒ…è£¹å¼ç­¾åä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç§°ä¸º**åŒ…è£¹å¼ç­¾å**çš„ç­¾åæ–¹å¼ï¼Œå…¶ä¸­ç­¾åå°†èµ„æºåŒ…è£¹èµ·æ¥ï¼Œè€Œä¸æ˜¯åè¿‡æ¥ã€‚
```markup
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#_2af3ff4a06aa82058f0eaa8ae7866541">
...
</ds:Reference>
</ds:SignedInfo>
<samlp:Response ... ID="_2af3ff4a06aa82058f0eaa8ae7866541" ... >
...
</samlp:Response>
</ds:Signature>
```
## åˆ†ç¦»ç­¾å

æœ€åï¼Œæœ‰**åˆ†ç¦»ç­¾å**ã€‚åˆ†ç¦»ç­¾åæ—¢ä¸æ˜¯åŒ…è£…ç­¾åï¼Œä¹Ÿä¸æ˜¯è¢«ç­¾åèµ„æºçš„åŒ…è£…ã€‚ç›¸åï¼Œå®ƒå®Œå…¨ä¸è¢«ç­¾åçš„èµ„æºåˆ†ç¦»ã€‚
```markup
<samlp:Response ... ID="_2af3ff4a06aa82058f0eaa8ae7866541" ... >
...
</samlp:Response>
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#_2af3ff4a06aa82058f0eaa8ae7866541">
...
</ds:Reference>
</ds:SignedInfo>
</ds:Signature>
```
# å‚è€ƒèµ„æ–™

å¤§éƒ¨åˆ†å†…å®¹æ¥è‡ª[https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/)


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricksä»“åº“](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloudä»“åº“](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
