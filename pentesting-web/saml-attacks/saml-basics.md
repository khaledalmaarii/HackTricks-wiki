<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>


# SAML Genel BakÄ±ÅŸ

**Security Assertion Markup Language (SAML)**, kimlik saÄŸlayÄ±cÄ±larÄ±n (IdP) yetkilendirme kimlik bilgilerini hizmet saÄŸlayÄ±cÄ±lara (SP) gÃ¶ndermek iÃ§in kullanÄ±lmasÄ±nÄ± saÄŸlayarak tek oturum aÃ§ma (SSO) iÅŸlemini kolaylaÅŸtÄ±rÄ±r. Bu yaklaÅŸÄ±m, tek bir kimlik bilgisi kÃ¼mesinin birden Ã§ok web sitesinde kullanÄ±lmasÄ±na izin vererek Ã§oklu oturum aÃ§ma yÃ¶netimini basitleÅŸtirir. Kimlik saÄŸlayÄ±cÄ±lar ve hizmet saÄŸlayÄ±cÄ±lar arasÄ±nda standartlaÅŸtÄ±rÄ±lmÄ±ÅŸ iletiÅŸim iÃ§in XML'yi kullanÄ±r ve kullanÄ±cÄ± kimliÄŸinin kimlik doÄŸrulamasÄ±nÄ± hizmet yetkilendirmesiyle baÄŸlar.

## SAML ve OAuth KarÅŸÄ±laÅŸtÄ±rmasÄ±

- **SAML**, SSO oturum aÃ§ma gÃ¼venliÄŸi Ã¼zerinde daha fazla kontrol saÄŸlamak iÃ§in kurumlara yÃ¶neliktir.
- **OAuth**, daha mobil dostu olacak ÅŸekilde tasarlanmÄ±ÅŸtÄ±r, JSON kullanÄ±r ve Google ve Twitter gibi ÅŸirketlerin iÅŸbirliÄŸiyle geliÅŸtirilmiÅŸtir.

# SAML Kimlik DoÄŸrulama AkÄ±ÅŸÄ±

**Daha fazla ayrÄ±ntÄ± iÃ§in [https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/)** adresindeki tam yazÄ±ya bakÄ±n. Ä°ÅŸte bir Ã¶zet:

SAML kimlik doÄŸrulama sÃ¼reci, ÅŸemada gÃ¶sterildiÄŸi gibi birkaÃ§ adÄ±mdan oluÅŸur:

![https://epi052.gitlab.io/notes-to-self/img/saml/saml-flow.jpg](https://epi052.gitlab.io/notes-to-self/img/saml/saml-flow.jpg)

1. **Kaynak EriÅŸim Denemesi**: KullanÄ±cÄ±, korumalÄ± bir kaynaÄŸa eriÅŸmeye Ã§alÄ±ÅŸÄ±r.
2. **SAML Ä°stemi OluÅŸturma**: SP, kullanÄ±cÄ±yÄ± tanÄ±maz ve bir SAML Ä°steÄŸi oluÅŸturur.
3. **IdP'ye YÃ¶nlendirme**: KullanÄ±cÄ±, SAML Ä°steÄŸi tarayÄ±cÄ±sÄ± aracÄ±lÄ±ÄŸÄ±yla geÃ§erek IdP'ye yÃ¶nlendirilir.
4. **IdP Ä°stemi AlÄ±r**: IdP, SAML Ä°steÄŸini alÄ±r.
5. **IdP'de Kimlik DoÄŸrulama**: IdP, kullanÄ±cÄ±nÄ±n kimliÄŸini doÄŸrular.
6. **KullanÄ±cÄ± DoÄŸrulamasÄ±**: IdP, kullanÄ±cÄ±nÄ±n istenen kaynaÄŸa eriÅŸim yetkisini doÄŸrular.
7. **SAML YanÄ±tÄ± OluÅŸturma**: IdP, gerekli bildirimleri iÃ§eren bir SAML YanÄ±tÄ± oluÅŸturur.
8. **SP'nin ACS URL'sine YÃ¶nlendirme**: KullanÄ±cÄ±, SP'nin Assertion Consumer Service (ACS) URL'sine yÃ¶nlendirilir.
9. **SAML YanÄ±tÄ± DoÄŸrulama**: ACS, SAML YanÄ±tÄ±nÄ± doÄŸrular.
10. **Kaynak EriÅŸimi OnaylandÄ±**: Ä°lk olarak istenen kaynaÄŸa eriÅŸim saÄŸlanÄ±r.

# SAML Ä°stemi Ã–rneÄŸi

Bir kullanÄ±cÄ±nÄ±n [https://shibdemo-sp1.test.edu/secure/](https://shibdemo-sp1.test.edu/secure/) adresindeki gÃ¼venli bir kaynaÄŸa eriÅŸim isteÄŸini dÃ¼ÅŸÃ¼nelim. SP, kimlik doÄŸrulamasÄ±nÄ±n eksik olduÄŸunu tespit eder ve bir SAML Ä°steÄŸi oluÅŸturur:
```
GET /secure/ HTTP/1.1
Host: shibdemo-sp1.test.edu
...
```
SAML Ä°steÄŸi ÅŸu ÅŸekilde gÃ¶rÃ¼nÃ¼r:
```xml
<?xml version="1.0"?>
<samlp:AuthnRequest ...
</samlp:AuthnRequest>
```
Bu isteÄŸin temel unsurlarÄ± ÅŸunlardÄ±r:
- **AssertionConsumerServiceURL**: IdP'nin SAML YanÄ±tÄ±nÄ± kimlik doÄŸrulamasÄ±ndan sonra gÃ¶ndermesi gereken yerin belirlendiÄŸi yerdir.
- **Destination**: Ä°steÄŸin gÃ¶nderildiÄŸi IdP'nin adresidir.
- **ProtocolBinding**: SAML protokolÃ¼ mesajlarÄ±nÄ±n iletim yÃ¶ntemini tanÄ±mlar.
- **saml:Issuer**: Ä°steÄŸi baÅŸlatan varlÄ±ÄŸÄ± tanÄ±mlar.

SAML Ä°steÄŸi oluÅŸturulduktan sonra, SP, tarayÄ±cÄ±yÄ± SAML Ä°steÄŸini HTTP yanÄ±tÄ±nÄ±n **Location** baÅŸlÄ±ÄŸÄ±nda kodlanmÄ±ÅŸ olarak iÃ§eren IdP'ye yÃ¶nlendiren bir **302 yÃ¶nlendirmesi** ile yanÄ±t verir. **RelayState** parametresi, iÅŸlem boyunca durum bilgisini korur ve SP, SAML YanÄ±tÄ±nÄ± aldÄ±ÄŸÄ±nda baÅŸlangÄ±Ã§ kaynaÄŸÄ± isteÄŸini tanÄ±r. **SAMLRequest** parametresi, ham XML parÃ§acÄ±ÄŸÄ±nÄ±n sÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ ve kodlanmÄ±ÅŸ bir sÃ¼rÃ¼mÃ¼dÃ¼r ve Deflate sÄ±kÄ±ÅŸtÄ±rma ve base64 kodlama kullanÄ±r.


# SAML YanÄ±tÄ± Ã–rneÄŸi

[Ä°ÅŸte tam bir SAML yanÄ±tÄ±](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/) bulabilirsiniz. YanÄ±tÄ±n temel bileÅŸenleri ÅŸunlarÄ± iÃ§erir:

- **ds:Signature**: Bu bÃ¶lÃ¼m, bir XML Ä°mzasÄ±dÄ±r ve beyanÄ±n yayÄ±ncÄ±sÄ±nÄ±n bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ ve otantikliÄŸini saÄŸlar. Ã–rnekteki SAML yanÄ±tÄ±, mesaj iÃ§in bir `ds:Signature` Ã¶ÄŸesi ve beyan iÃ§in baÅŸka bir `ds:Signature` Ã¶ÄŸesi iÃ§erir.
- **saml:Assertion**: Bu bÃ¶lÃ¼m, kullanÄ±cÄ±nÄ±n kimlik bilgilerini ve olasÄ± diÄŸer Ã¶znitelikleri iÃ§erir.
- **saml:Subject**: Beyanda yer alan tÃ¼m ifadelerin temel konusunu belirtir.
- **saml:StatusCode**: Ä°lgili isteÄŸe yanÄ±t olarak iÅŸlemin durumunu temsil eder.
- **saml:Conditions**: BeyanÄ±n geÃ§erlilik zamanlamasÄ± ve belirtilen Hizmet SaÄŸlayÄ±cÄ± gibi koÅŸullarÄ± ayrÄ±ntÄ±landÄ±rÄ±r.
- **saml:AuthnStatement**: BeyanÄ±n konusunun IdP tarafÄ±ndan kimlik doÄŸrulandÄ±ÄŸÄ±nÄ± onaylar.
- **saml:AttributeStatement**: BeyanÄ±n konusunu tanÄ±mlayan Ã¶znitelikleri iÃ§erir.

SAML YanÄ±tÄ±nÄ± takiben, sÃ¼reÃ§ IdP'den bir 302 yÃ¶nlendirmesi iÃ§erir. Bu, Hizmet SaÄŸlayÄ±cÄ±nÄ±n Assertion Consumer Service (ACS) URL'sine bir POST isteÄŸi yapÄ±lmasÄ±na yol aÃ§ar. POST isteÄŸi, `RelayState` ve `SAMLResponse` parametrelerini iÃ§erir. ACS, SAML YanÄ±tÄ±nÄ± iÅŸlemek ve doÄŸrulamakla sorumludur.

POST isteÄŸi alÄ±ndÄ±ktan ve SAML YanÄ±tÄ± doÄŸrulandÄ±ktan sonra, kullanÄ±cÄ±nÄ±n baÅŸlangÄ±Ã§ta istediÄŸi korumalÄ± kaynaÄŸa eriÅŸim saÄŸlanÄ±r. Bu, `/secure/` uÃ§ noktasÄ±na bir `GET` isteÄŸi ve baÅŸarÄ±lÄ± eriÅŸimi gÃ¶steren bir `200 OK` yanÄ±tÄ± ile gÃ¶sterilir.


# XML Ä°mzalarÄ±

XML Ä°mzalarÄ± Ã§ok yÃ¶nlÃ¼dÃ¼r ve bir XML aÄŸacÄ±nÄ±n tamamÄ±nÄ± veya belirli Ã¶ÄŸelerini imzalayabilir. Bunlar yalnÄ±zca YanÄ±t Ã¶ÄŸelerine deÄŸil, herhangi bir XML Nesnesine uygulanabilir. AÅŸaÄŸÄ±da XML Ä°mzalarÄ±nÄ±n temel tÃ¼rleri bulunmaktadÄ±r:

### XML Ä°mzasÄ±nÄ±n Temel YapÄ±sÄ±
Bir XML Ä°mzasÄ±, aÅŸaÄŸÄ±daki temel Ã¶ÄŸelerden oluÅŸur:
```xml
<Signature>
<SignedInfo>
<CanonicalizationMethod />
<SignatureMethod />
<Reference>
<Transforms />
<DigestMethod />
<DigestValue />
</Reference>
...
</SignedInfo>
<SignatureValue />
<KeyInfo />
<Object />
</Signature>
```
Her bir `Reference` Ã¶ÄŸesi, URI Ã¶zniteliÄŸi ile belirlenen belirli bir kaynaÄŸÄ±n imzalandÄ±ÄŸÄ±nÄ± gÃ¶sterir.

### XML Ä°mzalarÄ±nÄ±n TÃ¼rleri

1. **Kapsayan Ä°mza**: Bu tÃ¼r bir imza, imzalanan iÃ§eriÄŸin bir alt Ã¶ÄŸesi olup, imza, imzalanan iÃ§erikle aynÄ± XML yapÄ±sÄ± iÃ§inde bulunur.

Ã–rnek:
```xml
<samlp:Response ... ID="..." ... >
...
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
</ds:Signature>
...
</samlp:Response>
```

Kapsayan bir imzada, `ds:Transform` Ã¶ÄŸesi, `enveloped-signature` algoritmasÄ±yla kapsandÄ±ÄŸÄ±nÄ± belirtir.

2. **Kapsayan Ä°mza**: Kapsayan imzalar, imzalanan kaynaÄŸÄ± saran imzalardÄ±r.

Ã–rnek:
```xml
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
<samlp:Response ... ID="..." ... >
...
</samlp:Response>
</ds:Signature>
```

3. **AyrÄ± Ä°mza**: Bu tÃ¼r, imzaladÄ±ÄŸÄ± iÃ§erikten ayrÄ±dÄ±r. Ä°mza ve iÃ§erik baÄŸÄ±msÄ±z olarak var olsa da, ikisi arasÄ±ndaki bir baÄŸlantÄ± korunur.

Ã–rnek:
```xml
<samlp:Response ... ID="..." ... >
...
</samlp:Response>
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
</ds:Signature>
```

SonuÃ§ olarak, XML Ä°mzalarÄ±, farklÄ± yapÄ±sal ve gÃ¼venlik ihtiyaÃ§larÄ±nÄ± karÅŸÄ±layan esnek yÃ¶ntemler sunar.

## Referanslar
* [https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± yapmak veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da takip edin ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live).
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
