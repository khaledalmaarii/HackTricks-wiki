<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>


# Przegld SAML

**Security Assertion Markup Language (SAML)** umo偶liwia dostawcom to偶samoci (IdP) wykorzystanie uwierzytelniania jednokrotnego logowania (SSO) do przesyania powiadcze autoryzacji dostawcom usug (SP). Ta metoda upraszcza zarzdzanie wieloma logowaniami, umo偶liwiajc u偶ycie jednego zestawu powiadcze na wielu stronach internetowych. Wykorzystuje XML do standaryzowanej komunikacji midzy IdP a SP, czc uwierzytelnianie to偶samoci u偶ytkownika z autoryzacj usugi.

## Por贸wnanie midzy SAML a OAuth

- **SAML** jest dostosowany do zapewnienia przedsibiorstwom wikszej kontroli nad bezpieczestwem logowania SSO.
- **OAuth** jest zaprojektowany tak, aby by bardziej przyjazny dla urzdze mobilnych, korzysta z JSON i jest wsp贸lnym wysikiem firm takich jak Google i Twitter.

# Przebieg uwierzytelniania SAML

**Aby uzyska wicej szczeg贸贸w, sprawd藕 peny post na stronie [https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/)**. Oto streszczenie:

Proces uwierzytelniania SAML obejmuje kilka krok贸w, jak pokazano na schemacie:

![https://epi052.gitlab.io/notes-to-self/img/saml/saml-flow.jpg](https://epi052.gitlab.io/notes-to-self/img/saml/saml-flow.jpg)

1. **Pr贸ba dostpu do zasobu**: U偶ytkownik pr贸buje uzyska dostp do chronionego zasobu.
2. **Generowanie 偶dania SAML**: SP nie rozpoznaje u偶ytkownika i generuje 偶danie SAML.
3. **Przekierowanie do IdP**: U偶ytkownik zostaje przekierowany do IdP, a 偶danie SAML przechodzi przez przegldark u偶ytkownika.
4. **Odbi贸r 偶dania przez IdP**: IdP odbiera 偶danie SAML.
5. **Uwierzytelnianie w IdP**: IdP uwierzytelnia u偶ytkownika.
6. **Walidacja u偶ytkownika**: IdP sprawdza legalno u偶ytkownika w celu uzyskania dostpu do 偶danego zasobu.
7. **Generowanie odpowiedzi SAML**: IdP generuje odpowied藕 SAML zawierajc niezbdne twierdzenia.
8. **Przekierowanie do URL ACS SP**: U偶ytkownik zostaje przekierowany do URL usugi odbiorcy twierdze (ACS) SP.
9. **Walidacja odpowiedzi SAML**: ACS sprawdza odpowied藕 SAML.
10. **Przyznanie dostpu do zasobu**: Dostp do pocztkowo 偶danego zasobu jest udzielany.

# Przykad 偶dania SAML

Rozwa偶my scenariusz, w kt贸rym u偶ytkownik 偶da dostpu do zabezpieczonego zasobu na stronie [https://shibdemo-sp1.test.edu/secure/](https://shibdemo-sp1.test.edu/secure/). SP rozpoznaje brak uwierzytelnienia i generuje 偶danie SAML:
```
GET /secure/ HTTP/1.1
Host: shibdemo-sp1.test.edu
...
```
Surowe 偶danie SAML wyglda nastpujco:
```xml
<?xml version="1.0"?>
<samlp:AuthnRequest ...
</samlp:AuthnRequest>
```
Kluczowe elementy tego 偶dania obejmuj:
- **AssertionConsumerServiceURL**: Okrela, gdzie IdP powinien wysa SAML Response po uwierzytelnieniu.
- **Destination**: Adres IdP, do kt贸rego wysyane jest 偶danie.
- **ProtocolBinding**: Okrela metod transmisji wiadomoci protokou SAML.
- **saml:Issuer**: Identyfikuje podmiot, kt贸ry zainicjowa 偶danie.

Po wygenerowaniu 偶dania SAML, SP odpowiada za przekierowanie **302**, kierujc przegldark do IdP z zakodowanym 偶daniem SAML w nag贸wku HTTP odpowiedzi **Location**. Parametr **RelayState** utrzymuje informacje o stanie transakcji, zapewniajc, 偶e SP rozpoznaje pocztkowe 偶danie zasobu po otrzymaniu SAML Response. Parametr **SAMLRequest** to skompresowana i zakodowana wersja surowego fragmentu XML, wykorzystujca kompresj Deflate i kodowanie base64.


# Przykad odpowiedzi SAML

Pen odpowied藕 SAML mo偶na znale藕 [tutaj](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/). Kluczowe skadniki odpowiedzi obejmuj:

- **ds:Signature**: Ta sekcja, podpis XML, zapewnia integralno i autentyczno nadawcy twierdzenia. Odpowied藕 SAML w przykadzie zawiera dwa elementy `ds:Signature`, jeden dla wiadomoci, a drugi dla twierdzenia.
- **saml:Assertion**: Ta cz zawiera informacje na temat to偶samoci u偶ytkownika i ewentualnie innych atrybut贸w.
- **saml:Subject**: Okrela podmiot g贸wny wszystkich owiadcze w twierdzeniu.
- **saml:StatusCode**: Reprezentuje status operacji w odpowiedzi na odpowiadajce 偶danie.
- **saml:Conditions**: Szczeg贸y warunk贸w, takich jak wa偶no twierdzenia i okrelony dostawca usug.
- **saml:AuthnStatement**: Potwierdza, 偶e IdP uwierzytelni podmiot twierdzenia.
- **saml:AttributeStatement**: Zawiera atrybuty opisujce podmiot twierdzenia.

Po odpowiedzi SAML proces obejmuje przekierowanie 302 z IdP. Prowadzi to do 偶dania POST do usugi Assertion Consumer Service (ACS) URL dostawcy usug. 呕danie POST zawiera parametry `RelayState` i `SAMLResponse`. ACS jest odpowiedzialny za przetwarzanie i weryfikacj odpowiedzi SAML.

Po otrzymaniu 偶dania POST i zweryfikowaniu odpowiedzi SAML, dostp jest udzielany do chronionego zasobu, kt贸ry pocztkowo zosta 偶dany przez u偶ytkownika. Ilustruje to 偶danie `GET` do punktu kocowego `/secure/` i odpowied藕 `200 OK`, wskazujc udane uzyskanie dostpu do zasobu.


# Podpisy XML

Podpisy XML s wszechstronne i mog podpisywa cae drzewo XML lub konkretne elementy w nim. Mog by stosowane do dowolnego obiektu XML, nie tylko element贸w Response. Poni偶ej przedstawiamy kluczowe typy podpis贸w XML:

### Podstawowa struktura podpisu XML
Podpis XML skada si z podstawowych element贸w, jak pokazano:
```xml
<Signature>
<SignedInfo>
<CanonicalizationMethod />
<SignatureMethod />
<Reference>
<Transforms />
<DigestMethod />
<DigestValue />
</Reference>
...
</SignedInfo>
<SignatureValue />
<KeyInfo />
<Object />
</Signature>
```
Ka偶dy element `Reference` oznacza okrelony zas贸b, kt贸ry jest podpisany i identyfikowany przez atrybut URI.

### Rodzaje podpis贸w XML

1. **Podpis osadzony**: Ten rodzaj podpisu jest potomkiem zasobu, kt贸ry podpisuje, co oznacza, 偶e podpis jest zawarty w tej samej strukturze XML co podpisana zawarto.

Przykad:
```xml
<samlp:Response ... ID="..." ... >
...
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
</ds:Signature>
...
</samlp:Response>
```

W przypadku podpisu osadzonego, element `ds:Transform` okrela, 偶e jest on osadzony za pomoc algorytmu `enveloped-signature`.

2. **Podpis otaczajcy**: W przeciwiestwie do podpis贸w osadzonych, podpisy otaczajce owijaj podpisywany zas贸b.

Przykad:
```xml
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
<samlp:Response ... ID="..." ... >
...
</samlp:Response>
</ds:Signature>
```

3. **Podpis odczony**: Ten rodzaj podpisu jest oddzielony od podpisywanej zawartoci. Podpis i zawarto istniej niezale偶nie, ale utrzymywane jest poczenie midzy nimi.

Przykad:
```xml
<samlp:Response ... ID="..." ... >
...
</samlp:Response>
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
</ds:Signature>
```

Podsumowujc, podpisy XML zapewniaj elastyczne sposoby zabezpieczania dokument贸w XML, przy czym ka偶dy rodzaj spenia r贸偶ne wymagania strukturalne i dotyczce bezpieczestwa.


## Odwoania
* [https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Uzyskaj [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
