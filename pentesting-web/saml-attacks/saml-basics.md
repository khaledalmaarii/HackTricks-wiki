<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>


# Pregled SAML-a

**Security Assertion Markup Language (SAML)** omoguÄ‡ava koriÅ¡Ä‡enje provajdera identiteta (IdP) za slanje autorizacionih podataka servis provajderima (SP), olakÅ¡avajuÄ‡i jednokratnu prijavu (SSO). Ovaj pristup pojednostavljuje upravljanje viÅ¡estrukim prijavama omoguÄ‡avajuÄ‡i koriÅ¡Ä‡enje jednog seta podataka za prijavu na viÅ¡e veb sajtova. Koristi XML za standardizovanu komunikaciju izmeÄ‘u IdP-a i SP-a, povezujuÄ‡i autentifikaciju korisniÄkog identiteta sa autorizacijom servisa.

## PoreÄ‘enje izmeÄ‘u SAML-a i OAuth-a

- **SAML** je prilagoÄ‘en pruÅ¾anju veÄ‡e kontrole nad sigurnoÅ¡Ä‡u prijave jednokratne prijave (SSO) za preduzeÄ‡a.
- **OAuth** je dizajniran da bude prilagoÄ‘en mobilnim ureÄ‘ajima, koristi JSON i rezultat je saradnje kompanija poput Google-a i Twitter-a.

# SAML Autentifikacioni tok

**Za dodatne detalje pogledajte ceo post na [https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/)**. Ovo je saÅ¾etak:

Proces autentifikacije SAML-a ukljuÄuje nekoliko koraka, kako je prikazano na dijagramu:

![https://epi052.gitlab.io/notes-to-self/img/saml/saml-flow.jpg](https://epi052.gitlab.io/notes-to-self/img/saml/saml-flow.jpg)

1. **PokuÅ¡aj pristupa resursu**: Korisnik pokuÅ¡ava da pristupi zaÅ¡tiÄ‡enom resursu.
2. **Generisanje SAML zahteva**: SP ne prepoznaje korisnika i generiÅ¡e SAML zahtev.
3. **Preusmeravanje na IdP**: Korisnik se preusmerava na IdP, pri Äemu SAML zahtev prolazi kroz korisnikov pretraÅ¾ivaÄ.
4. **IdP prima zahtev**: IdP prima SAML zahtev.
5. **Autentifikacija na IdP-u**: IdP autentifikuje korisnika.
6. **Provera korisnika**: IdP proverava legitimnost korisnika za pristup traÅ¾enom resursu.
7. **Generisanje SAML odgovora**: IdP generiÅ¡e SAML odgovor koji sadrÅ¾i neophodne tvrdnje.
8. **Preusmeravanje na SP-ov ACS URL**: Korisnik se preusmerava na SP-ov Assertion Consumer Service (ACS) URL.
9. **Provera SAML odgovora**: ACS proverava SAML odgovor.
10. **Pristup resursu odobren**: Pristup traÅ¾enom resursu je odobren.

# Primer SAML zahteva

Razmotrite scenario u kojem korisnik zahteva pristup bezbednom resursu na [https://shibdemo-sp1.test.edu/secure/](https://shibdemo-sp1.test.edu/secure/). SP prepoznaje nedostatak autentifikacije i generiÅ¡e SAML zahtev:
```
GET /secure/ HTTP/1.1
Host: shibdemo-sp1.test.edu
...
```
Sirovi SAML zahtev izgleda ovako:
```xml
<?xml version="1.0"?>
<samlp:AuthnRequest ...
</samlp:AuthnRequest>
```
KljuÄni elementi ovog zahteva ukljuÄuju:
- **AssertionConsumerServiceURL**: OdreÄ‘uje gde IdP treba da poÅ¡alje SAML odgovor nakon autentifikacije.
- **Destination**: Adresa IdP-a na koju se zahtev Å¡alje.
- **ProtocolBinding**: DefiniÅ¡e naÄin prenosa poruka SAML protokola.
- **saml:Issuer**: Identifikuje entitet koji je pokrenuo zahtev.

Nakon generisanja SAML zahteva, SP odgovara sa **302 preusmerenjem**, usmeravajuÄ‡i pregledaÄ na IdP sa SAML zahtevom kodiranim u zaglavlju HTTP odgovora **Location**. Parametar **RelayState** odrÅ¾ava informacije o stanju tokom transakcije, osiguravajuÄ‡i da SP prepozna poÄetni zahtev resursa prilikom primanja SAML odgovora. Parametar **SAMLRequest** je komprimirana i kodirana verzija sirovog XML iseÄka, koristeÄ‡i Deflate kompresiju i base64 kodiranje.


# Primer SAML odgovora

MoÅ¾ete pronaÄ‡i [potpuni SAML odgovor ovde](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/). KljuÄni delovi odgovora ukljuÄuju:

- **ds:Signature**: Ova sekcija, XML potpis, osigurava integritet i autentiÄnost izdavaÄa tvrdnje. SAML odgovor u primeru sadrÅ¾i dva `ds:Signature` elementa, jedan za poruku i drugi za tvrdnju.
- **saml:Assertion**: Ovaj deo sadrÅ¾i informacije o identitetu korisnika i eventualno druge atribute.
- **saml:Subject**: Ovde se navodi glavni subjekt svih izjava u tvrdnji.
- **saml:StatusCode**: Predstavlja status operacije u odgovoru na odgovarajuÄ‡i zahtev.
- **saml:Conditions**: Detalji o uslovima kao Å¡to su vaÅ¾nost tvrdnje i odreÄ‘eni pruÅ¾alac usluga.
- **saml:AuthnStatement**: PotvrÄ‘uje da je IdP autentifikovao subjekt tvrdnje.
- **saml:AttributeStatement**: SadrÅ¾i atribute koji opisuju subjekt tvrdnje.

Nakon SAML odgovora, proces ukljuÄuje 302 preusmerenje od strane IdP-a. To dovodi do POST zahteva ka URL-u Assertion Consumer Service (ACS) pruÅ¾aoca usluga. POST zahtev ukljuÄuje parametre `RelayState` i `SAMLResponse`. ACS je odgovoran za obradu i validaciju SAML odgovora.

Nakon Å¡to se primi POST zahtev i validira SAML odgovor, pristup se odobrava zaÅ¡tiÄ‡enom resursu koji je korisnik prvobitno zahtevao. To se ilustruje sa `GET` zahtevom ka `/secure/` endpointu i `200 OK` odgovorom, Å¡to ukazuje na uspeÅ¡an pristup resursu.


# XML Potpisi

XML potpisi su svestrani i mogu potpisivati celo XML stablo ili odreÄ‘ene elemente unutar njega. Mogu se primeniti na bilo koji XML objekat, ne samo na elemente odgovora. Ovo su kljuÄne vrste XML potpisa:

### Osnovna struktura XML potpisa
XML potpis se sastoji od osnovnih elemenata kako je prikazano:
```xml
<Signature>
<SignedInfo>
<CanonicalizationMethod />
<SignatureMethod />
<Reference>
<Transforms />
<DigestMethod />
<DigestValue />
</Reference>
...
</SignedInfo>
<SignatureValue />
<KeyInfo />
<Object />
</Signature>
```
Svaki `Reference` element oznaÄava odreÄ‘eni resurs koji se potpisuje, prepoznatljiv preko atributa URI.

### Vrste XML potpisa

1. **Enveloped Signature**: Ova vrsta potpisa je potomak resursa koji se potpisuje, Å¡to znaÄi da se potpis nalazi unutar iste XML strukture kao i potpisani sadrÅ¾aj.

Primer:
```xml
<samlp:Response ... ID="..." ... >
...
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
</ds:Signature>
...
</samlp:Response>
```

U enveloped potpisu, element `ds:Transform` specificira da je potpis omotan kroz algoritam `enveloped-signature`.

2. **Enveloping Signature**: Za razliku od enveloped potpisa, enveloping potpisi obuhvataju resurs koji se potpisuje.

Primer:
```xml
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
<samlp:Response ... ID="..." ... >
...
</samlp:Response>
</ds:Signature>
```

3. **Detached Signature**: Ova vrsta je odvojena od sadrÅ¾aja koji se potpisuje. Potpis i sadrÅ¾aj postoje nezavisno, ali se odrÅ¾ava veza izmeÄ‘u njih.

Primer:
```xml
<samlp:Response ... ID="..." ... >
...
</samlp:Response>
<ds:Signature>
<ds:SignedInfo>
...
<ds:Reference URI="#...">
...
</ds:Reference>
</ds:SignedInfo>
</ds:Signature>
```

ZakljuÄno, XML potpisi pruÅ¾aju fleksibilne naÄine za obezbeÄ‘ivanje XML dokumenata, pri Äemu svaka vrsta sluÅ¾i razliÄitim strukturnim i sigurnosnim potrebama.


## Reference
* [https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
