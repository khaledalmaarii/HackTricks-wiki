# MySQL File priv to SSRF/RCE

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**Ovo je saÅ¾etak MySQL/MariaDB/Percona tehnika sa [https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/)**.

### Server-Side Request Forgery (SSRF) putem SQL funkcija

U istraÅ¾ivanju SQL Out of Band eksfiltracije podataka, `LOAD_FILE()` funkcija se obiÄno koristi za iniciranje mreÅ¾nih zahteva. Ova funkcija, meÄ‘utim, je ograniÄena operativnim sistemom na kojem radi i konfiguracijama pokretanja baze podataka.

Globalna promenljiva `secure_file_priv`, ako nije postavljena, podrazumevano je `/var/lib/mysql-files/`, ograniÄavajuÄ‡i pristup datotekama na ovaj direktorijum osim ako nije postavljena na praznu string (`""`). Ova prilagodba zahteva izmene u konfiguracionom fajlu baze podataka ili parametrima pokretanja.

S obzirom da je `secure_file_priv` onemoguÄ‡en (`""`), i pod pretpostavkom da su potrebne datoteke i `file_priv` dozvole dodeljene, datoteke van odreÄ‘enog direktorijuma mogu se Äitati. Ipak, sposobnost ovih funkcija da izvrÅ¡avaju mreÅ¾ne pozive u velikoj meri zavisi od operativnog sistema. Na Windows sistemima, mreÅ¾ni pozivi na UNC putanje su moguÄ‡i zbog razumevanja konvencija imenovanja UNC od strane operativnog sistema, Å¡to moÅ¾e dovesti do eksfiltracije NTLMv2 heÅ¡ova.

Ova SSRF metoda je ograniÄena na TCP port 445 i ne dozvoljava modifikaciju broja porta, iako se moÅ¾e koristiti za pristup deljenjima sa punim privilegijama za Äitanje i, kao Å¡to je prikazano u prethodnim istraÅ¾ivanjima, za kraÄ‘u heÅ¡ova za dalju eksploataciju.

### Remote Code Execution (RCE) putem User Defined Functions (UDF)

MySQL baze podataka omoguÄ‡avaju koriÅ¡Ä‡enje User Defined Functions (UDF) iz spoljaÅ¡njih biblioteka. Ako su ove biblioteke dostupne unutar odreÄ‘enih direktorijuma ili sistemskog `$PATH`, mogu se pozvati iz MySQL-a.

Ova tehnika omoguÄ‡ava izvrÅ¡avanje mreÅ¾nih/HTTP zahteva putem UDF, pod uslovom da su ispunjeni odreÄ‘eni uslovi, ukljuÄujuÄ‡i pristup za pisanje na `@@plugin_dir`, `file_priv` postavljen na `Y`, i `secure_file_priv` onemoguÄ‡en.

Na primer, biblioteka `lib_mysqludf_sys` ili druge UDF biblioteke koje omoguÄ‡avaju HTTP zahteve mogu se uÄitati za izvrÅ¡avanje SSRF. Biblioteke moraju biti prenete na server, Å¡to se moÅ¾e postiÄ‡i heksadecimalnim ili base64 kodiranjem sadrÅ¾aja biblioteke i zatim pisanjem u odgovarajuÄ‡i direktorijum.

Proces se razlikuje ako `@@plugin_dir` nije moguÄ‡e pisati, posebno za MySQL verzije iznad `v5.0.67`. U takvim sluÄajevima, moraju se koristiti alternativni putevi koji su dostupni za pisanje.

Automatizacija ovih procesa moÅ¾e se olakÅ¡ati alatima kao Å¡to je SQLMap, koji podrÅ¾ava UDF injekciju, a za slepe SQL injekcije mogu se koristiti tehnike preusmeravanja izlaza ili DNS zahteva. 

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
