# MySQL File priv to SSRF/RCE

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}

**Bu, [https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/) adresinden MySQL/MariaDB/Percona tekniklerinin bir Ã¶zetidir.**

### SQL FonksiyonlarÄ± ile Sunucu TarafÄ± Ä°stek SahteciliÄŸi (SSRF)

SQL Out of Band veri sÄ±zdÄ±rma keÅŸfinde, `LOAD_FILE()` fonksiyonu genellikle aÄŸ isteklerini baÅŸlatmak iÃ§in kullanÄ±lÄ±r. Ancak, bu fonksiyon Ã§alÄ±ÅŸtÄ±ÄŸÄ± iÅŸletim sistemi ve veritabanÄ±nÄ±n baÅŸlangÄ±Ã§ yapÄ±landÄ±rmalarÄ± ile sÄ±nÄ±rlÄ±dÄ±r.

`secure_file_priv` global deÄŸiÅŸkeni, ayarlanmamÄ±ÅŸsa, varsayÄ±lan olarak `/var/lib/mysql-files/` dizinine ayarlanÄ±r ve dosya eriÅŸimi bu dizinle sÄ±nÄ±rlÄ±dÄ±r, boÅŸ bir dizeye (`""`) ayarlanmadÄ±kÃ§a. Bu ayarlama, veritabanÄ±nÄ±n yapÄ±landÄ±rma dosyasÄ±nda veya baÅŸlangÄ±Ã§ parametrelerinde deÄŸiÅŸiklik yapÄ±lmasÄ±nÄ± gerektirir.

`secure_file_priv` devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±ÄŸÄ±nda (`""`), gerekli dosya ve `file_priv` izinleri verildiÄŸinde, belirlenen dizin dÄ±ÅŸÄ±ndaki dosyalar okunabilir. Ancak, bu fonksiyonlarÄ±n aÄŸ Ã§aÄŸrÄ±larÄ± yapabilme yeteneÄŸi, bÃ¼yÃ¼k Ã¶lÃ§Ã¼de iÅŸletim sistemine baÄŸlÄ±dÄ±r. Windows sistemlerinde, UNC yollarÄ±na yapÄ±lan aÄŸ Ã§aÄŸrÄ±larÄ± mÃ¼mkÃ¼ndÃ¼r Ã§Ã¼nkÃ¼ iÅŸletim sistemi UNC adlandÄ±rma kurallarÄ±nÄ± anlar, bu da NTLMv2 hash'lerinin sÄ±zdÄ±rÄ±lmasÄ±na yol aÃ§abilir.

Bu SSRF yÃ¶ntemi, TCP port 445 ile sÄ±nÄ±rlÄ±dÄ±r ve port numarasÄ±nÄ±n deÄŸiÅŸtirilmesine izin vermez, ancak tam okuma ayrÄ±calÄ±klarÄ± ile paylaÅŸÄ±mlara eriÅŸmek iÃ§in kullanÄ±labilir ve Ã¶nceki araÅŸtÄ±rmalarda gÃ¶sterildiÄŸi gibi, daha fazla istismar iÃ§in hash Ã§almaya olanak tanÄ±r.

### KullanÄ±cÄ± TanÄ±mlÄ± Fonksiyonlar (UDF) ile Uzaktan Kod YÃ¼rÃ¼tme (RCE)

MySQL veritabanlarÄ±, dÄ±ÅŸ kÃ¼tÃ¼phane dosyalarÄ±ndan KullanÄ±cÄ± TanÄ±mlÄ± Fonksiyonlar (UDF) kullanma imkanÄ± sunar. Bu kÃ¼tÃ¼phaneler belirli dizinlerde veya sistemin `$PATH`'inde eriÅŸilebilir olduÄŸunda, MySQL iÃ§inden Ã§aÄŸrÄ±labilir.

Bu teknik, `@@plugin_dir`'e yazma eriÅŸimi, `file_priv`'in `Y` olarak ayarlanmasÄ± ve `secure_file_priv`'in devre dÄ±ÅŸÄ± bÄ±rakÄ±lmasÄ± gibi birkaÃ§ koÅŸulun saÄŸlanmasÄ± durumunda, bir UDF aracÄ±lÄ±ÄŸÄ±yla aÄŸ/HTTP isteklerinin yÃ¼rÃ¼tÃ¼lmesine olanak tanÄ±r.

Ã–rneÄŸin, `lib_mysqludf_sys` kÃ¼tÃ¼phanesi veya HTTP isteklerini etkinleÅŸtiren diÄŸer UDF kÃ¼tÃ¼phaneleri, SSRF gerÃ§ekleÅŸtirmek iÃ§in yÃ¼klenebilir. KÃ¼tÃ¼phaneler, kÃ¼tÃ¼phanenin iÃ§eriÄŸinin hex veya base64 kodlamasÄ± yapÄ±larak sunucuya aktarÄ±lmasÄ± ve ardÄ±ndan uygun dizine yazÄ±lmasÄ± yoluyla aktarÄ±lmalÄ±dÄ±r.

`@@plugin_dir` yazÄ±labilir deÄŸilse, Ã¶zellikle `v5.0.67` Ã¼zerindeki MySQL sÃ¼rÃ¼mleri iÃ§in sÃ¼reÃ§ deÄŸiÅŸir. Bu gibi durumlarda, yazÄ±labilir alternatif yollar kullanÄ±lmalÄ±dÄ±r.

Bu sÃ¼reÃ§lerin otomasyonu, UDF enjeksiyonunu destekleyen SQLMap gibi araÃ§larla kolaylaÅŸtÄ±rÄ±labilir ve kÃ¶r SQL enjeksiyonlarÄ± iÃ§in Ã§Ä±ktÄ± yÃ¶nlendirme veya DNS istek kaÃ§Ä±rma teknikleri kullanÄ±labilir.

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
