# MySQL File priv za SSRF/RCE

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

**Ovo je saÅ¾etak MySQL/MariaDB/Percona tehnika sa [https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/)**.

### Server-Side Request Forgery (SSRF) putem SQL funkcija

Prilikom istraÅ¾ivanja SQL Out of Band eksfiltracije podataka, Äesto se koristi funkcija `LOAD_FILE()` za pokretanje mreÅ¾nih zahteva. MeÄ‘utim, ova funkcija je ograniÄena operativnim sistemom na kojem radi i konfiguracijama pokretanja baze podataka.

Globalna promenljiva `secure_file_priv`, ako nije postavljena, podrazumevano je podeÅ¡ena na `/var/lib/mysql-files/`, Å¡to ograniÄava pristup datotekama samo u ovom direktorijumu, osim ako nije postavljena na prazan string (`""`). Ovo podeÅ¡avanje zahteva izmene u konfiguracionom fajlu baze podataka ili parametrima pokretanja.

Ako je `secure_file_priv` onemoguÄ‡en (`""`), i uz pretpostavku da su datoteka i dozvole `file_priv` odobrene, moguÄ‡e je Äitati datoteke van odreÄ‘enog direktorijuma. MeÄ‘utim, sposobnost ovih funkcija da prave mreÅ¾ne pozive zavisi od operativnog sistema. Na Windows sistemima, mreÅ¾ni pozivi ka UNC putanjama su moguÄ‡i zbog razumevanja operativnog sistema UNC konvencija imenovanja, Å¡to moÅ¾e dovesti do eksfiltracije NTLMv2 heÅ¡eva.

Ova metoda SSRF je ograniÄena na TCP port 445 i ne dozvoljava izmenu broja porta, iako se moÅ¾e koristiti za pristup deljenim resursima sa punim privilegijama za Äitanje i, kao Å¡to je pokazano u prethodnim istraÅ¾ivanjima, za kraÄ‘u heÅ¡eva radi daljeg iskoriÅ¡Ä‡avanja.

### Remote Code Execution (RCE) putem User Defined Functions (UDF)

MySQL baze podataka omoguÄ‡avaju koriÅ¡Ä‡enje User Defined Functions (UDF) iz eksternih biblioteka. Ako su ove biblioteke dostupne unutar odreÄ‘enih direktorijuma ili u `$PATH` sistemu, mogu se pozvati iz MySQL-a.

Ova tehnika omoguÄ‡ava izvrÅ¡avanje mreÅ¾nih/HTTP zahteva putem UDF-a, pod uslovom da su ispunjeni odreÄ‘eni uslovi, ukljuÄujuÄ‡i pristup za pisanje u `@@plugin_dir`, postavljanje `file_priv` na `Y` i onemoguÄ‡avanje `secure_file_priv`.

Na primer, biblioteka `lib_mysqludf_sys` ili druge UDF biblioteke koje omoguÄ‡avaju HTTP zahteve mogu se uÄitati radi izvoÄ‘enja SSRF-a. Biblioteke se moraju preneti na server, Å¡to se moÅ¾e postiÄ‡i kodiranjem sadrÅ¾aja biblioteke u heks ili base64 formatu, a zatim pisanjem u odgovarajuÄ‡i direktorijum.

Postupak se razlikuje ako `@@plugin_dir` nije moguÄ‡e pisati, posebno za MySQL verzije iznad `v5.0.67`. U takvim sluÄajevima, moraju se koristiti alternativne putanje koje se mogu pisati.

Automatizacija ovih procesa moÅ¾e se olakÅ¡ati alatima poput SQLMap-a, koji podrÅ¾ava UDF ubrizgavanje, a za slepe SQL ubrizgavanje, mogu se koristiti tehnike preusmeravanja izlaza ili DNS zahteva za krijumÄarenje.
