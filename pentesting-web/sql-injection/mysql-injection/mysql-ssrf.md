# MySQL File priv to SSRF/RCE

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

**Dies ist eine Zusammenfassung der MySQL/MariaDB/Percona-Techniken von [https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/)**.

### Server-Side Request Forgery (SSRF) √ºber SQL-Funktionen

Bei der Erkundung der SQL Out of Band-Datenexfiltration wird die `LOAD_FILE()`-Funktion h√§ufig verwendet, um Netzwerkaufrufe zu initiieren. Diese Funktion ist jedoch durch das Betriebssystem, auf dem sie ausgef√ºhrt wird, und die Startkonfigurationen der Datenbank eingeschr√§nkt.

Die globale Variable `secure_file_priv`, wenn sie nicht gesetzt ist, hat standardm√§√üig den Wert `/var/lib/mysql-files/`, was den Dateizugriff auf dieses Verzeichnis beschr√§nkt, es sei denn, sie wird auf einen leeren String (`""`) gesetzt. Diese Anpassung erfordert √Ñnderungen in der Konfigurationsdatei der Datenbank oder in den Startparametern.

Wenn `secure_file_priv` deaktiviert ist (`""`), und vorausgesetzt, die erforderlichen Datei- und `file_priv`-Berechtigungen sind erteilt, k√∂nnen Dateien au√üerhalb des vorgesehenen Verzeichnisses gelesen werden. Dennoch h√§ngt die F√§higkeit dieser Funktionen, Netzwerkaufrufe zu t√§tigen, stark vom Betriebssystem ab. Auf Windows-Systemen sind Netzwerkaufrufe zu UNC-Pfaden m√∂glich, da das Betriebssystem die UNC-Namenskonventionen versteht, was potenziell zur Exfiltration von NTLMv2-Hashes f√ºhren kann.

Diese SSRF-Methode ist auf den TCP-Port 445 beschr√§nkt und erlaubt keine √Ñnderung der Portnummer, kann jedoch verwendet werden, um Freigaben mit vollst√§ndigen Leserechten zuzugreifen und, wie in fr√ºheren Forschungen gezeigt, um Hashes f√ºr weitere Ausbeutung zu stehlen.

### Remote Code Execution (RCE) √ºber Benutzerdefinierte Funktionen (UDF)

MySQL-Datenbanken bieten die Verwendung von Benutzerdefinierten Funktionen (UDF) aus externen Bibliotheksdateien. Wenn diese Bibliotheken in bestimmten Verzeichnissen oder im `$PATH` des Systems zug√§nglich sind, k√∂nnen sie von innerhalb von MySQL aufgerufen werden.

Diese Technik erm√∂glicht die Ausf√ºhrung von Netzwerk-/HTTP-Anfragen √ºber eine UDF, vorausgesetzt, mehrere Bedingungen sind erf√ºllt, einschlie√ülich Schreibzugriff auf das `@@plugin_dir`, `file_priv` auf `Y` gesetzt und `secure_file_priv` deaktiviert.

Zum Beispiel kann die `lib_mysqludf_sys`-Bibliothek oder andere UDF-Bibliotheken, die HTTP-Anfragen erm√∂glichen, geladen werden, um SSRF durchzuf√ºhren. Die Bibliotheken m√ºssen auf den Server √ºbertragen werden, was durch Hex- oder Base64-Codierung des Inhalts der Bibliothek und anschlie√üendes Schreiben in das entsprechende Verzeichnis erreicht werden kann.

Der Prozess variiert, wenn das `@@plugin_dir` nicht beschreibbar ist, insbesondere f√ºr MySQL-Versionen √ºber `v5.0.67`. In solchen F√§llen m√ºssen alternative beschreibbare Pfade verwendet werden.

Die Automatisierung dieser Prozesse kann durch Tools wie SQLMap erleichtert werden, die UDF-Injektion unterst√ºtzen, und f√ºr blinde SQL-Injektionen k√∂nnen Techniken zur Ausgabeumleitung oder DNS-Anforderungs-Schmuggel verwendet werden.

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
