# MySQL File priv to SSRF/RCE

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**Ceci est un r√©sum√© des techniques MySQL/MariaDB/Percona provenant de [https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/)**.

### Server-Side Request Forgery (SSRF) via SQL Functions

Dans l'exploration de l'exfiltration de donn√©es SQL Out of Band, la fonction `LOAD_FILE()` est couramment utilis√©e pour initier des requ√™tes r√©seau. Cependant, cette fonction est contrainte par le syst√®me d'exploitation sur lequel elle fonctionne et les configurations de d√©marrage de la base de donn√©es.

La variable globale `secure_file_priv`, si elle n'est pas d√©finie, par d√©faut √† `/var/lib/mysql-files/`, limitant l'acc√®s aux fichiers √† ce r√©pertoire √† moins qu'elle ne soit d√©finie sur une cha√Æne vide (`""`). Cet ajustement n√©cessite des modifications dans le fichier de configuration de la base de donn√©es ou les param√®tres de d√©marrage.

√âtant donn√© que `secure_file_priv` est d√©sactiv√© (`""`), et en supposant que les permissions n√©cessaires sur les fichiers et `file_priv` sont accord√©es, les fichiers en dehors du r√©pertoire d√©sign√© peuvent √™tre lus. Pourtant, la capacit√© de ces fonctions √† effectuer des appels r√©seau d√©pend fortement du syst√®me d'exploitation. Sur les syst√®mes Windows, les appels r√©seau vers des chemins UNC sont r√©alisables en raison de la compr√©hension par le syst√®me d'exploitation des conventions de nommage UNC, ce qui peut conduire √† l'exfiltration de hachages NTLMv2.

Cette m√©thode SSRF est limit√©e au port TCP 445 et ne permet pas la modification du num√©ro de port, bien qu'elle puisse √™tre utilis√©e pour acc√©der √† des partages avec des privil√®ges de lecture complets et, comme d√©montr√© dans des recherches ant√©rieures, pour voler des hachages pour une exploitation ult√©rieure.

### Remote Code Execution (RCE) via User Defined Functions (UDF)

Les bases de donn√©es MySQL offrent l'utilisation de fonctions d√©finies par l'utilisateur (UDF) √† partir de fichiers de biblioth√®que externes. Si ces biblioth√®ques sont accessibles dans des r√©pertoires sp√©cifiques ou dans le `$PATH` du syst√®me, elles peuvent √™tre invoqu√©es depuis MySQL.

Cette technique permet l'ex√©cution de requ√™tes r√©seau/HTTP via une UDF, √† condition que plusieurs conditions soient remplies, y compris l'acc√®s en √©criture au `@@plugin_dir`, `file_priv` d√©fini sur `Y`, et `secure_file_priv` d√©sactiv√©.

Par exemple, la biblioth√®que `lib_mysqludf_sys` ou d'autres biblioth√®ques UDF permettant des requ√™tes HTTP peuvent √™tre charg√©es pour effectuer SSRF. Les biblioth√®ques doivent √™tre transf√©r√©es sur le serveur, ce qui peut √™tre r√©alis√© par l'encodage hexad√©cimal ou base64 du contenu de la biblioth√®que, puis en l'√©crivant dans le r√©pertoire appropri√©.

Le processus varie si le `@@plugin_dir` n'est pas accessible en √©criture, en particulier pour les versions de MySQL sup√©rieures √† `v5.0.67`. Dans de tels cas, des chemins alternatifs qui sont accessibles en √©criture doivent √™tre utilis√©s.

L'automatisation de ces processus peut √™tre facilit√©e par des outils tels que SQLMap, qui prend en charge l'injection UDF, et pour les injections SQL aveugles, des techniques de redirection de sortie ou de contournement de requ√™tes DNS peuvent √™tre utilis√©es.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
