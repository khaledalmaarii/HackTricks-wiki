{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### PostgreSQL Large Objects

PostgreSQL oferuje strukturÄ™ znanÄ… jako **large objects**, dostÄ™pnÄ… za poÅ›rednictwem tabeli `pg_largeobject`, zaprojektowanÄ… do przechowywania duÅ¼ych typÃ³w danych, takich jak obrazy czy dokumenty PDF. To podejÅ›cie jest korzystniejsze niÅ¼ funkcja `COPY TO`, poniewaÅ¼ umoÅ¼liwia **eksport danych z powrotem do systemu plikÃ³w**, zapewniajÄ…c dokÅ‚adnÄ… replikÄ™ oryginalnego pliku.

Aby **przechowaÄ‡ peÅ‚ny plik** w tej tabeli, naleÅ¼y utworzyÄ‡ obiekt w tabeli `pg_largeobject` (identyfikowany przez LOID), a nastÄ™pnie wprowadziÄ‡ fragmenty danych, kaÅ¼dy o rozmiarze 2KB, do tego obiektu. WaÅ¼ne jest, aby te fragmenty miaÅ‚y dokÅ‚adnie 2KB (z moÅ¼liwym wyjÄ…tkiem ostatniego fragmentu), aby zapewniÄ‡ prawidÅ‚owe dziaÅ‚anie funkcji eksportu.

Aby **podzieliÄ‡ swoje dane binarne** na fragmenty 2KB, moÅ¼na wykonaÄ‡ nastÄ™pujÄ…ce polecenia:
```bash
split -b 2048 your_file # Creates 2KB sized files
```
Aby zakodowaÄ‡ kaÅ¼dy plik w Base64 lub Hex, moÅ¼na uÅ¼yÄ‡ poniÅ¼szych poleceÅ„:
```bash
base64 -w 0 <Chunk_file> # Encodes in Base64 in one line
xxd -ps -c 99999999999 <Chunk_file> # Encodes in Hex in one line
```
**WaÅ¼ne**: Podczas automatyzacji tego procesu upewnij siÄ™, Å¼e wysyÅ‚asz kawaÅ‚ki 2KB czystych bajtÃ³w. Pliki zakodowane w hex bÄ™dÄ… wymagaÅ‚y 4KB danych na kawaÅ‚ek z powodu podwojenia rozmiaru, podczas gdy pliki zakodowane w Base64 stosujÄ… wzÃ³r `ceil(n / 3) * 4`.

ZawartoÅ›Ä‡ duÅ¼ych obiektÃ³w moÅ¼na przeglÄ…daÄ‡ w celach debugowania za pomocÄ…:
```sql
select loid, pageno, encode(data, 'escape') from pg_largeobject;
```
#### UÅ¼ywanie `lo_creat` i Base64

Aby przechowaÄ‡ dane binarne, najpierw tworzony jest LOID:
```sql
SELECT lo_creat(-1);       -- Creates a new, empty large object
SELECT lo_create(173454);  -- Attempts to create a large object with a specific OID
```
W sytuacjach wymagajÄ…cych precyzyjnej kontroli, takich jak wykorzystanie Blind SQL Injection, `lo_create` jest preferowane do okreÅ›lenia staÅ‚ego LOID.

Dane mogÄ… byÄ‡ nastÄ™pnie wstawiane w nastÄ™pujÄ…cy sposÃ³b:
```sql
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 0, decode('<B64 chunk1>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 1, decode('<B64 chunk2>', 'base64'));

```
Aby wyeksportowaÄ‡ i potencjalnie usunÄ…Ä‡ duÅ¼y obiekt po uÅ¼yciu:
```sql
SELECT lo_export(173454, '/tmp/your_file');
SELECT lo_unlink(173454);  -- Deletes the specified large object
```
#### UÅ¼ywanie `lo_import` i Hex

Funkcja `lo_import` moÅ¼e byÄ‡ wykorzystana do tworzenia i okreÅ›lania LOID dla duÅ¼ego obiektu:
```sql
select lo_import('/path/to/file');
select lo_import('/path/to/file', 173454);
```
Po utworzeniu obiektu dane sÄ… wstawiane na stronÄ™, zapewniajÄ…c, Å¼e kaÅ¼dy kawaÅ‚ek nie przekracza 2KB:
```sql
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=0;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=1;
```
Aby zakoÅ„czyÄ‡ proces, dane sÄ… eksportowane, a duÅ¼y obiekt jest usuwany:
```sql
select lo_export(173454, '/path/to/your_file');
select lo_unlink(173454);  -- Deletes the specified large object
```
### Ograniczenia

ZauwaÅ¼ono, Å¼e **duÅ¼e obiekty mogÄ… mieÄ‡ ACL** (Listy Kontroli DostÄ™pu), co moÅ¼e ograniczaÄ‡ dostÄ™p nawet do obiektÃ³w stworzonych przez twojego uÅ¼ytkownika. Jednak starsze obiekty z liberalnymi ACL mogÄ… byÄ‡ nadal dostÄ™pne do eksfiltracji treÅ›ci.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
