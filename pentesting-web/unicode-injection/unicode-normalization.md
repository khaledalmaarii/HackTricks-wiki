# Normalisation Unicode

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

**Ceci est un r√©sum√© de :** [**https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/**](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/). Consultez pour plus de d√©tails (images prises de l√†).

## Comprendre Unicode et Normalisation

La normalisation Unicode est un processus qui garantit que diff√©rentes repr√©sentations binaires de caract√®res sont standardis√©es √† la m√™me valeur binaire. Ce processus est crucial pour traiter des cha√Ænes dans la programmation et le traitement des donn√©es. La norme Unicode d√©finit deux types d'√©quivalence de caract√®res :

1. **√âquivalence Canonique** : Les caract√®res sont consid√©r√©s comme √©quivalents canoniques s'ils ont la m√™me apparence et signification lorsqu'ils sont imprim√©s ou affich√©s.
2. **√âquivalence de Compatibilit√©** : Une forme d'√©quivalence plus faible o√π les caract√®res peuvent repr√©senter le m√™me caract√®re abstrait mais peuvent √™tre affich√©s diff√©remment.

Il existe **quatre algorithmes de normalisation Unicode** : NFC, NFD, NFKC et NFKD. Chaque algorithme utilise les techniques de normalisation canonique et de compatibilit√© de mani√®re diff√©rente. Pour une compr√©hension plus approfondie, vous pouvez explorer ces techniques sur [Unicode.org](https://unicode.org/).

### Points Cl√©s sur l'Encodage Unicode

Comprendre l'encodage Unicode est essentiel, surtout lorsqu'il s'agit de probl√®mes d'interop√©rabilit√© entre diff√©rents syst√®mes ou langues. Voici les points principaux :

* **Points de Code et Caract√®res** : Dans Unicode, chaque caract√®re ou symbole se voit attribuer une valeur num√©rique connue sous le nom de "point de code".
* **Repr√©sentation en Octets** : Le point de code (ou caract√®re) est repr√©sent√© par un ou plusieurs octets en m√©moire. Par exemple, les caract√®res LATIN-1 (courants dans les pays anglophones) sont repr√©sent√©s en utilisant un octet. Cependant, les langues avec un ensemble de caract√®res plus large n√©cessitent plus d'octets pour la repr√©sentation.
* **Encodage** : Ce terme fait r√©f√©rence √† la mani√®re dont les caract√®res sont transform√©s en une s√©rie d'octets. UTF-8 est une norme d'encodage r√©pandue o√π les caract√®res ASCII sont repr√©sent√©s en utilisant un octet, et jusqu'√† quatre octets pour d'autres caract√®res.
* **Traitement des Donn√©es** : Les syst√®mes traitant des donn√©es doivent √™tre conscients de l'encodage utilis√© pour convertir correctement le flux d'octets en caract√®res.
* **Variantes de UTF** : En plus de UTF-8, il existe d'autres normes d'encodage comme UTF-16 (utilisant un minimum de 2 octets, jusqu'√† 4) et UTF-32 (utilisant 4 octets pour tous les caract√®res).

Il est crucial de comprendre ces concepts pour g√©rer efficacement et att√©nuer les probl√®mes potentiels d√©coulant de la complexit√© d'Unicode et de ses diverses m√©thodes d'encodage.

Un exemple de la fa√ßon dont Unicode normalise deux octets diff√©rents repr√©sentant le m√™me caract√®re :
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Une liste de caract√®res √©quivalents Unicode peut √™tre trouv√©e ici :** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) et [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### D√©couverte

Si vous pouvez trouver √† l'int√©rieur d'une application web une valeur qui est renvoy√©e, vous pourriez essayer d'envoyer **‚ÄòKELVIN SIGN‚Äô (U+0212A)** qui **se normalise en "K"** (vous pouvez l'envoyer sous la forme `%e2%84%aa`). **Si un "K" est renvoy√©**, alors, une sorte de **normalisation Unicode** est effectu√©e.

Autre **exemple** : `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` apr√®s **unicode** est `Leonishan`.

## **Exemples vuln√©rables**

### **Contournement du filtre d'injection SQL**

Imaginez une page web qui utilise le caract√®re `'` pour cr√©er des requ√™tes SQL avec l'entr√©e de l'utilisateur. Ce web, comme mesure de s√©curit√©, **supprime** toutes les occurrences du caract√®re **`'`** de l'entr√©e de l'utilisateur, mais **apr√®s cette suppression** et **avant la cr√©ation** de la requ√™te, il **normalise** l'entr√©e de l'utilisateur en utilisant **Unicode**.

Alors, un utilisateur malveillant pourrait ins√©rer un caract√®re Unicode diff√©rent √©quivalent √† `' (0x27)` comme `%ef%bc%87`, lorsque l'entr√©e est normalis√©e, un guillemet simple est cr√©√© et une **vuln√©rabilit√© d'injection SQL** appara√Æt :

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (702).png>)

**Quelques caract√®res Unicode int√©ressants**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### sqlmap template

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

Vous pouvez utiliser l'un des caract√®res suivants pour tromper l'application web et exploiter un XSS :

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (2).png>)

Remarquez que, par exemple, le premier caract√®re Unicode propos√© peut √™tre envoy√© sous la forme : `%e2%89%ae` ou `%u226e`

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1) (1).png>)

### Fuzzing Regexes

Lorsque le backend **v√©rifie l'entr√©e utilisateur avec une regex**, il se peut que l'**entr√©e** soit **normalis√©e** pour la **regex** mais **pas** pour l'endroit o√π elle est **utilis√©e**. Par exemple, dans un Open Redirect ou SSRF, la regex peut √™tre **normalisant l'URL envoy√©e** mais ensuite **y acc√©dant telle quelle**.

L'outil [**recollapse**](https://github.com/0xacb/recollapse) \*\*\*\* permet de **g√©n√©rer des variations de l'entr√©e** pour fuzz le backend. Pour plus d'infos, consultez le **github** et ce [**post**](https://0xacb.com/2022/11/21/recollapse/).

## References

* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
