# XS-Search/XS-Leaks

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

U偶yj [****](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=xs-search), aby atwo tworzy i **automatyzowa przepywy pracy** zasilane przez najbardziej zaawansowane narzdzia spoecznociowe na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=xs-search" %}

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakowania, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

## Podstawowe informacje

XS-Search to metoda u偶ywana do **wydobywania informacji midzydomenowych** poprzez wykorzystanie **podatnoci kana贸w bocznych**.

Kluczowe skadniki zaanga偶owane w ten atak to:

* **Strona internetowa podatna**: Strona docelowa, z kt贸rej ma by wydobywana informacja.
* **Strona internetowa atakujcego**: Zoliwa strona internetowa stworzona przez atakujcego, kt贸r odwiedza ofiara, hostujca exploit.
* **Metoda wczenia**: Technika u偶ywana do wczenia Strony internetowej podatnej do Strony internetowej atakujcego (np. window.open, iframe, fetch, tag HTML z href, itp.).
* **Technika wycieku**: Techniki u偶ywane do rozr贸偶niania r贸偶nic w stanie Strony internetowej podatnej na podstawie informacji zebranej za pomoc metody wczenia.
* **Stany**: Dwa potencjalne warunki Strony internetowej podatnej, kt贸re atakujcy ma na celu odr贸偶nienie.
* **R贸偶nice do wykrycia**: Obserwowalne zmiany, na kt贸rych atakujcy polega do wnioskowania o stanie Strony internetowej podatnej.

### R贸偶nice do wykrycia

Kilka aspekt贸w mo偶na przeanalizowa, aby odr贸偶ni stany Strony internetowej podatnej:

* **Kod stanu**: Odr贸偶nianie midzy **r贸偶nymi kodami stanu odpowiedzi HTTP** midzydomenowych, takimi jak bdy serwera, bdy klienta lub bdy uwierzytelniania.
* **U偶ycie interfejsu API**: Identyfikacja **u偶ycia interfejs贸w API sieci Web** na stronach, ujawniajca, czy strona midzydomenowa wykorzystuje okrelone interfejsy API JavaScript.
* **Przekierowania**: Wykrywanie nawigacji do innych stron, nie tylko przekierowa HTTP, ale tak偶e tych wywoanych przez JavaScript lub HTML.
* **Zawarto strony**: Obserwowanie **zmian w treci odpowiedzi HTTP** lub w zasobach podrzdnych strony, takich jak **liczba osadzonych ramek** lub r贸偶nice w rozmiarze obraz贸w.
* **Nag贸wek HTTP**: Zauwa偶anie obecnoci lub mo偶liwej wartoci **konkretnego nag贸wka odpowiedzi HTTP**, w tym nag贸wk贸w takich jak X-Frame-Options, Content-Disposition i Cross-Origin-Resource-Policy.
* **Czas**: Zauwa偶anie staych r贸偶nic czasowych midzy dwoma stanami.

### Metody wczenia

* **Elementy HTML**: HTML oferuje r贸偶ne elementy do **wczania zasob贸w midzydomenowych**, takie jak arkusze styl贸w, obrazy lub skrypty, zmuszajc przegldark do 偶dania zasobu nie-HTML. Kompilacj potencjalnych element贸w HTML do tego celu mo偶na znale藕 pod adresem [https://github.com/cure53/HTTPLeaks](https://github.com/cure53/HTTPLeaks).
* **Ramki**: Elementy takie jak **iframe**, **object** i **embed** mog osadza zasoby HTML bezporednio na stronie atakujcego. Jeli strona **nie ma ochrony przed osadzaniem**, JavaScript mo偶e uzyska dostp do obiektu okna osadzonego zasobu za pomoc waciwoci contentWindow.
* **Okienka pop-up**: Metoda **`window.open`** otwiera zas贸b w nowej karcie lub oknie, dostarczajc **uchwyt okna** dla JavaScriptu do interakcji z metodami i waciwociami zgodnie z SOP. Okienka pop-up, czsto u偶ywane w jednokrotnym logowaniu, omijaj ograniczenia osadzania i ciasteczek docelowego zasobu. Jednak nowoczesne przegldarki ograniczaj tworzenie okienek pop-up do okrelonych dziaa u偶ytkownika.
* **呕dania JavaScript**: JavaScript pozwala na bezporednie 偶dania zasob贸w docelowych za pomoc **XMLHttpRequests** lub **Fetch API**. Te metody oferuj precyzyjn kontrol nad 偶daniem, na przykad wyb贸r ledzenia przekierowa HTTP.

### Techniki wycieku

* **Obsuga zdarze**: Klasyczna technika wycieku w XS-Leaks, gdzie obsugi zdarze takie jak **onload** i **onerror** dostarczaj informacji o sukcesie lub niepowodzeniu adowania zasobu.
* **Komunikaty o bdach**: Wyjtki JavaScript lub specjalne strony bd贸w mog dostarcza informacji o wycieku bezporednio z komunikatu bdu lub poprzez r贸偶nicowanie midzy jego obecnoci a brakiem.
* **Globalne limity**: Fizyczne ograniczenia przegldarki, takie jak pojemno pamici lub inne narzucone limity przegldarki, mog sygnalizowa osignicie progu, su偶c jako technika wycieku.
* **Globalny stan**: Wykrywalne interakcje z **globalnymi stanami przegldarek** (np. interfejsem Historii) mog by wykorzystane. Na przykad **liczba wpis贸w** w historii przegldarki mo偶e dostarczy wskaz贸wek dotyczcych stron midzydomenowych.
* **API wydajnoci**: To API dostarcza **szczeg贸y wydajnoci bie偶cej strony**, w tym czas sieciowy dla dokumentu i zaadowanych zasob贸w, umo偶liwiajc wnioskowanie o 偶danych zasobach.
* **Atrybuty do odczytu**: Niekt贸re atrybuty HTML s **odczytywalne midzydomenowo** i mog by u偶ywane jako technika wycieku. Na przykad waciwo `window.frame.length` pozwala JavaScriptowi zliczy ramki osadzone na stronie internetowej midzydomenowej.

## Narzdzie XSinator & Artyku

XSinator to automatyczne narzdzie do **sprawdzania przegldarek pod ktem kilku znanych XS-Leaks** wyjanionych w swoim artykule: [**https://xsinator.com/paper.pdf**](https://xsinator.com/paper.pdf)

Mo偶esz **uzyska dostp do narzdzia na** [**https://xsinator.com/**](https://xsinator.com/)

{% hint style="warning" %}
**Wyczone XS-Leaks**: Musielimy wykluczy XS-Leaks, kt贸re polegaj na **pracownikach usug** poniewa偶 ingerowayby w inne wycieki w XSinatorze. Ponadto zdecydowalimy si **wykluczy XS-Leaks, kt贸re polegaj na bdach konfiguracji i bdach w konkretnej aplikacji internetowej**. Na przykad bdy konfiguracji wsp贸dzielenia zasob贸w CrossOrigin (CORS), wycieki postMessage lub Cross-Site Scripting. Dodatkowo wykluczylimy XS-Leaks oparte na czasie, poniewa偶 czsto cierpi na wolno, haaliwo i niedokadno.
{% endhint %}

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=xs-search), aby atwo budowa i **automatyzowa przepywy pracy** zasilane przez najbardziej zaawansowane narzdzia spoecznociowe na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=xs-search" %}
## Techniki oparte na czasie

Niekt贸re z nastpujcych technik bd wykorzystywa czas jako cz procesu wykrywania r贸偶nic w mo偶liwych stanach stron internetowych. Istniej r贸偶ne sposoby mierzenia czasu w przegldarce internetowej.

**Zegary**: API [performance.now()](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now) umo偶liwia programistom uzyskiwanie pomiar贸w czasu o wysokiej rozdzielczoci.\
Istnieje znaczna liczba interfejs贸w API, kt贸rych atakujcy mog u偶y do stworzenia zegar贸w: [Broadcast Channel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API), [Message Channel API](https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel), [requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame), [setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout), animacje CSS i inne.\
Wicej informacji: [https://xsleaks.dev/docs/attacks/timing-attacks/clocks](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/).

## Techniki obsugi zdarze

### Onload/Onerror

* **Metody wczenia**: Ramki, Elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://www.usenix.org/conference/usenixsecurity19/presentation/staicu](https://www.usenix.org/conference/usenixsecurity19/presentation/staicu), [https://xsleaks.dev/docs/attacks/error-events/](https://xsleaks.dev/docs/attacks/error-events/)
* **Podsumowanie**: podczas pr贸by adowania zasobu zdarzenia onerror/onload s wyzwalane, co pozwala okreli kod stanu.
* **Przykad kodu**: [https://xsinator.com/testing.html#Event%20Handler%20Leak%20(Script)](https://xsinator.com/testing.html#Event%20Handler%20Leak%20\(Script\))

{% content-ref url="cookie-bomb-+-onerror-xs-leak.md" %}
[cookie-bomb-+-onerror-xs-leak.md](cookie-bomb-+-onerror-xs-leak.md)
{% endcontent-ref %}

Przykad kodu pr贸buje **adowa obiekty skrypt贸w z JS**, ale **inne tagi** takie jak obiekty, arkusze styl贸w, obrazy, d藕wiki mog by r贸wnie偶 u偶ywane. Ponadto mo偶liwe jest r贸wnie偶 bezporednie wstrzyknicie **tagu** i zadeklarowanie zdarze `onload` i `onerror` wewntrz tagu (zamiast wstrzykiwania go z JS).

Istnieje r贸wnie偶 wersja tego ataku bez u偶ycia skryptu:
```html
<object data="//example.com/404">
<object data="//attacker.com/?error"></object>
</object>
```
W tym przypadku, jeli `example.com/404` nie zostanie znalezione, zostanie zaadowane `attacker.com/?error`.

### Czas adowania

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj ze wzgldu na zawarto strony, kod statusu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events)
* **Podsumowanie:** [**performance.now()**](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) **API** mo偶e by u偶yte do zmierzenia czasu potrzebnego na wykonanie 偶dania. Jednak mo偶na u偶y innych zegar贸w, takich jak [**PerformanceLongTaskTiming API**](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming), kt贸ry mo偶e zidentyfikowa zadania dziaajce du偶ej ni偶 50 ms.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events) inny przykad w:

{% content-ref url="performance.now-example.md" %}
[performance.now-example.md](performance.now-example.md)
{% endcontent-ref %}

#### Czas adowania + Wymuszone ci偶kie zadanie

Ta technika jest podobna do poprzedniej, ale **atakujcy** dodatkowo **wymusi** pewn akcj, kt贸ra zajmie **znaczc ilo czasu** gdy **odpowied藕 jest pozytywna lub negatywna** i zmierzy ten czas.

{% content-ref url="performance.now-+-force-heavy-task.md" %}
[performance.now-+-force-heavy-task.md](performance.now-+-force-heavy-task.md)
{% endcontent-ref %}

### Czas wyadowania/przed wyadowaniem

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj ze wzgldu na zawarto strony, kod statusu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)
* **Podsumowanie:** Zegar [SharedArrayBuffer](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#sharedarraybuffer-and-web-workers) mo偶e by u偶yty do zmierzenia czasu potrzebnego na wykonanie 偶dania. Mo偶na u偶y innych zegar贸w.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)

Czas potrzebny na pobranie zasobu mo偶na zmierzy, wykorzystujc zdarzenia [`unload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/unload\_event) i [`beforeunload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload\_event). Zdarzenie **`beforeunload`** jest wywoywane, gdy przegldarka ma przej do nowej strony, podczas gdy zdarzenie **`unload`** wystpuje, gdy nawigacja faktycznie si odbywa. R贸偶nic czasu midzy tymi dwoma zdarzeniami mo偶na obliczy, aby okreli **czas, jaki przegldarka spdzia na pobieraniu zasobu**.

### Czas ramki z ograniczeniami + onload <a href="#sandboxed-frame-timing-attacks" id="sandboxed-frame-timing-attacks"></a>

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj ze wzgldu na zawarto strony, kod statusu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)
* **Podsumowanie:** [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) API mo偶e by u偶yte do zmierzenia czasu potrzebnego na wykonanie 偶dania. Mo偶na u偶y innych zegar贸w.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)

Zauwa偶ono, 偶e w przypadku braku [Ochrony ramkowej](https://xsleaks.dev/docs/defenses/opt-in/xfo/), czas potrzebny na zaadowanie strony i jej podzasob贸w przez sie mo偶e by zmierzony przez atakujcego. Pomiar ten jest zazwyczaj mo偶liwy, poniewa偶 obsuga `onload` ramki jest wyzwalana dopiero po zakoczeniu adowania zasob贸w i wykonania JavaScript. Aby omin zmienno wprowadzan przez wykonanie skryptu, atakujcy mo偶e u偶y atrybutu [`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe) wewntrz `<iframe>`. Wczenie tego atrybutu ogranicza liczne funkcjonalnoci, w szczeg贸lnoci wykonanie JavaScript, uatwiajc tym samym pomiar, kt贸ry jest g贸wnie determinowany przez wydajno sieci.
```javascript
// Example of an iframe with the sandbox attribute
<iframe src="example.html" sandbox></iframe>
```
### #ID + bd + onload

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**:
* **Podsumowanie**: Jeli mo偶esz spowodowa bd strony, gdy dostpna jest poprawna zawarto, i spowodowa poprawne zaadowanie, gdy dostpna jest dowolna zawarto, to mo偶esz stworzy ptl do wydobycia wszystkich informacji bez mierzenia czasu.
* **Przykad kodu**:

Za贸偶my, 偶e mo偶esz **wstawi** stron, kt贸ra zawiera **tajn** zawarto **wewntrz ramki**.

Mo偶esz sprawi, 偶e **ofiara szuka** pliku zawierajcego "_**flag**_" u偶ywajc ramki (wykorzystujc na przykad CSRF). Wewntrz ramki wiesz, 偶e zdarzenie _**onload**_ zostanie **zawsze wykonane co najmniej raz**. Nastpnie mo偶esz **zmieni** **URL** ramki, zmieniajc tylko **zawarto** **hasa** wewntrz URL.

Na przykad:

1. **URL1**: www.atakujcy.com/xssearch#try1
2. **URL2**: www.atakujcy.com/xssearch#try2

Jeli pierwszy URL zosta **pomylnie zaadowany**, to, gdy **zmienisz** **cz hasa** w URL, zdarzenie **onload** **nie zostanie ponownie wywoane**. Ale **jeli** strona miaa **jakikolwiek bd** podczas **adowania**, wtedy zdarzenie **onload** zostanie **ponownie wywoane**.

W ten spos贸b mo偶esz **rozr贸偶ni** midzy stron **poprawnie** zaadowan a stron, kt贸ra ma **bd** podczas dostpu.

### Wykonywanie JavaScriptu

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**:
* **Podsumowanie**: Jeli **strona zwraca** **wra偶liw** zawarto, **lub** zawarto, kt贸r mo偶na **kontrolowa** przez u偶ytkownika. U偶ytkownik mo偶e umieci **poprawny kod JS w przypadku negatywnym**, a **ka偶d pr贸b zaadowa** wewntrz tag贸w **`<script>`**, wic w przypadkach **negatywnych** kod **atakujcego** jest **wykonywany**, a w przypadkach **pozytywnych** **nic** nie bdzie wykonywane.
* **Przykad kodu**:

{% content-ref url="javascript-execution-xs-leak.md" %}
[javascript-execution-xs-leak.md](javascript-execution-xs-leak.md)
{% endcontent-ref %}

### CORB - Onerror

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu i nag贸wki
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/browser-features/corb/](https://xsleaks.dev/docs/attacks/browser-features/corb/)
* **Podsumowanie**: **Cross-Origin Read Blocking (CORB)** to rodek bezpieczestwa, kt贸ry zapobiega adowaniu pewnych wra偶liwych zasob贸w z innych 藕r贸de, aby chroni przed atakami takimi jak **Spectre**. Atakujcy jednak mog wykorzysta jego zachowanie ochronne. Gdy odpowied藕 podlegajca **CORB** zwraca _**zabezpieczony przez CORB**_ `Content-Type` z `nosniff` i kodem stanu `2xx`, **CORB** usuwa ciao i nag贸wki odpowiedzi. Atakujcy obserwujcy to mog wywnioskowa kombinacj **kodu stanu** (wskazujcego na sukces lub bd) i `Content-Type` (oznaczajcy, czy jest chroniony przez **CORB**), co prowadzi do potencjalnego wycieku informacji.
* **Przykad kodu**:

Sprawd藕 link do wicej informacji o ataku.

### onblur

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/id-attribute/](https://xsleaks.dev/docs/attacks/id-attribute/), [https://xsleaks.dev/docs/attacks/experiments/portals/](https://xsleaks.dev/docs/attacks/experiments/portals/)
* **Podsumowanie**: Wyciek wra偶liwych danych z atrybutu id lub name.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet](https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet)

Mo偶liwe jest **zaadowanie strony** wewntrz **ramki** i u偶ycie **`#warto_id`** aby skupi stron na elemencie ramki z wskazanym id, a nastpnie, jeli zostanie wywoany sygna **`onblur`**, element ID istnieje.\
Mo偶esz przeprowadzi ten sam atak za pomoc tag贸w **`portal`**.

### Komunikaty postMessage Broadcasts <a href="#postmessage-broadcasts" id="postmessage-broadcasts"></a>

* **Metody wczenia**: Ramki, Okna pop-up
* **Wykrywalna r贸偶nica**: U偶ycie interfejsu API
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/postmessage-broadcasts/](https://xsleaks.dev/docs/attacks/postmessage-broadcasts/)
* **Podsumowanie**: Zbieranie wra偶liwych informacji z postMessage lub wykorzystanie obecnoci postMessage jako orakulum do poznania stanu u偶ytkownika na stronie.
* **Przykad kodu**: `Kod nasuchujcy wszystkich komunikat贸w postMessage.`

Aplikacje czsto wykorzystuj [`komunikaty postMessage`](https://developer.mozilla.org/pl/docs/Web/API/Window/postMessage) do komunikacji midzy r贸偶nymi 藕r贸dami. Jednak ta metoda mo偶e przypadkowo ujawni **wra偶liwe informacje**, jeli parametr `targetOrigin` nie jest poprawnie okrelony, pozwalajc dowolnemu oknu na odbieranie komunikat贸w. Ponadto sam fakt otrzymania komunikatu mo偶e dziaa jak **orakulum**; na przykad pewne komunikaty mog by wysyane tylko do u偶ytkownik贸w zalogowanych. Dlatego obecno lub brak tych komunikat贸w mo偶e ujawni informacje o stanie lub to偶samoci u偶ytkownika, na przykad czy s uwierzytelnieni czy nie.

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

U偶yj [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=xs-search), aby atwo tworzy i **automatyzowa zadania** przy u偶yciu najbardziej zaawansowanych narzdzi spoecznoci na wiecie.\
Zdobd藕 dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=xs-search" %}

## Techniki globalnych limit贸w

### API WebSocket

* **Metody wczenia**: Ramki, Okna pop-up
* **Wykrywalna r贸偶nica**: U偶ycie interfejsu API
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **Podsumowanie**: Wyczerpanie limitu pocze WebSocket ujawnia liczb pocze WebSocket strony z innego 藕r贸da.
* **Przykad kodu**: [https://xsinator.com/testing.html#WebSocket%20Leak%20(FF)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(FF\)), [https://xsinator.com/testing.html#WebSocket%20Leak%20(GC)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(GC\))

Mo偶liwe jest zidentyfikowanie, czy, i ile, **pocze WebSocket wykorzystuje strona docelowa**. Pozwala to atakujcemu wykry stany aplikacji i wycieka informacje zwizane z liczb pocze WebSocket.

Jeli jedno **藕r贸do** u偶ywa **maksymalnej liczby obiekt贸w pocze WebSocket**, bez wzgldu na ich stan poczenia, utworzenie **nowych obiekt贸w spowoduje wyjtki JavaScript**. Aby przeprowadzi ten atak, strona atakujca otwiera stron docelow w oknie pop-up lub ramce, a nastpnie, po zaadowaniu strony docelowej, pr贸buje utworzy maksymaln liczb pocze WebSocket. **Liczba wyrzuconych wyjtk贸w** to **liczba pocze WebSocket u偶ywanych przez stron docelow**.
### Interfejs patnoci

* **Metody wczenia**: Ramki, Wyskakujce okienka
* **Wykrywalna r贸偶nica**: U偶ycie interfejsu API
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **Podsumowanie**: Wykryj 偶danie patnoci, poniewa偶 tylko jedno mo偶e by aktywne w danym czasie.
* **Przykad kodu**: [https://xsinator.com/testing.html#Payment%20API%20Leak](https://xsinator.com/testing.html#Payment%20API%20Leak)

Ten XS-Leak umo偶liwia atakujcemu **wykrycie, kiedy strona z innego pochodzenia inicjuje 偶danie patnoci**.

Poniewa偶 **tylko jedno 偶danie patnoci mo偶e by aktywne** w tym samym czasie, jeli docelowa witryna u偶ywa interfejsu API Payment Request, jakiekolwiek **dalsze pr贸by u偶ycia tego API zakocz si niepowodzeniem** i spowoduj **wyjtek JavaScript**. Atakujcy mo偶e wykorzysta to, **pr贸bujc okresowo wywietla interfejs API patnoci**. Jeli jedna pr贸ba powoduje wyjtek, oznacza to, 偶e docelowa witryna go obecnie u偶ywa. Atakujcy mo偶e ukry te okresowe pr贸by, natychmiast zamykajc interfejs po jego utworzeniu.

### Mierzenie ptli zdarze <a href="#timing-the-event-loop" id="timing-the-event-loop"></a>

* **Metody wczenia**:
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj zwizany z zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop)
* **Podsumowanie:** Pomiar czasu wykonania strony internetowej nadu偶ywajcej jednowtkowej ptli zdarze JS.
* **Przykad kodu**:

{% content-ref url="event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

JavaScript dziaa w modelu wsp贸bie偶noci **jednowtkowej ptli zdarze** oznaczajcej, 偶e **mo偶e wykonywa tylko jedno zadanie na raz**. Ta cecha mo偶e by wykorzystana do **pomiaru czasu wykonania kodu z innego pochodzenia**. Atakujcy mo偶e mierzy czas wykonania swojego kodu w ptli zdarze, cigle wysyajc zdarzenia o staych waciwociach. Te zdarzenia bd przetwarzane, gdy pulpit zdarze bdzie pusty. Jeli inne pochodzenia r贸wnie偶 wysyaj zdarzenia do tej samej puli, **atakujcy mo偶e wywnioskowa czas potrzebny na wykonanie tych zewntrznych zdarze, obserwujc op贸藕nienia w wykonaniu swoich zada**. Ta metoda monitorowania ptli zdarze w poszukiwaniu op贸藕nie mo偶e ujawni czas wykonania kodu z r贸偶nych 藕r贸de, potencjalnie odsaniajc poufne informacje.

{% hint style="warning" %}
Podczas pomiaru czasu wykonania mo偶na **wyeliminowa** **czynniki sieciowe** w celu uzyskania **bardziej precyzyjnych pomiar贸w**. Na przykad, poprzez wczytanie zasob贸w u偶ywanych przez stron przed jej zaadowaniem.
{% endhint %}

### Zajta ptla zdarze <a href="#busy-event-loop" id="busy-event-loop"></a>

* **Metody wczenia**:
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj zwizany z zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop)
* **Podsumowanie:** Jedna z metod pomiaru czasu wykonania operacji internetowej polega na celowym zablokowaniu ptli zdarze wtku, a nastpnie pomiarze **czasu, jaki jest potrzebny, aby ptla zdarze zn贸w staa si dostpna**. Poprzez wstawienie operacji blokujcej (takiej jak dugie obliczenia lub synchroniczne wywoanie API) do ptli zdarze i monitorowanie czasu, jaki jest potrzebny na rozpoczcie kolejnego kodu, mo偶na wywnioskowa czas trwania zada wykonywanych w ptli zdarze podczas okresu blokowania. Ta technika wykorzystuje jednowtkow natur ptli zdarze JavaScript, gdzie zadania s wykonywane sekwencyjnie, i mo偶e dostarczy informacji na temat wydajnoci lub zachowania innych operacji wsp贸dzielcych ten sam wtek.
* **Przykad kodu**:

Znaczc zalet techniki mierzenia czasu wykonania poprzez zablokowanie ptli zdarze jest jej potencja do obejcia **Izolacji witryny**. **Izolacja witryny** to funkcja zabezpieczajca, kt贸ra separuje r贸偶ne strony internetowe do oddzielnych proces贸w, majc na celu zapobieganie bezporedniemu dostpowi zoliwych stron do wra偶liwych danych innych stron. Jednak偶e, wpywajc na czas wykonania innej domeny poprzez wsp贸dzielon ptl zdarze, atakujcy mo偶e porednio wycign informacje o dziaaniach tej domeny. Ta metoda nie polega na bezporednim dostpie do danych innej domeny, lecz obserwuje wpyw dziaa tej domeny na wsp贸dzielon ptl zdarze, unikajc tym samym barier ochronnych ustanowionych przez **Izolacj witryny**.

{% hint style="warning" %}
Podczas pomiaru czasu wykonania mo偶na **wyeliminowa** **czynniki sieciowe** w celu uzyskania **bardziej precyzyjnych pomiar贸w**. Na przykad, poprzez wczytanie zasob贸w u偶ywanych przez stron przed jej zaadowaniem.
{% endhint %}

### Pula pocze

* **Metody wczenia**: 呕dania JavaScript
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj zwizany z zawartoci strony, kodem stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)
* **Podsumowanie:** Atakujcy mo偶e zablokowa wszystkie gniazda opr贸cz jednego, zaadowa docelow witryn i jednoczenie zaadowa inn stron, czas do momentu rozpoczcia adowania ostatniej strony to czas, jaki zajo zaadowanie strony docelowej.
* **Przykad kodu**:

{% content-ref url="connection-pool-example.md" %}
[connection-pool-example.md](connection-pool-example.md)
{% endcontent-ref %}

Przegldarki wykorzystuj gniazda do komunikacji z serwerem, ale ze wzgldu na ograniczone zasoby systemu operacyjnego i sprztu, **przegldarki s zmuszone narzuci limit** na liczb r贸wnoczesnych gniazd. Atakujcy mo偶e wykorzysta to ograniczenie poprzez nastpujce kroki:

1. Okrelenie limitu gniazd przegldarki, na przykad 256 globalnych gniazd.
2. Zajcie 255 gniazd na du偶szy czas, inicjujc 255 偶da do r贸偶nych host贸w, zaprojektowanych tak, aby utrzyma poczenia otwarte bez ich zamykania.
3. U偶ycie 256. gniazda do wysania 偶dania do strony docelowej.
4. Pr贸ba wysania 257. 偶dania do innego hosta. Poniewa偶 wszystkie gniazda s zajte (zgodnie z krokami 2 i 3), to 偶danie zostanie umieszczone w kolejce do momentu zwolnienia gniazda. Op贸藕nienie przed kontynuacj tego 偶dania dostarcza atakujcemu informacji o czasie zwizanym z aktywnoci sieciow zwizan z 256. gniazdem (gniazdem strony docelowej). Wnioskowanie to jest mo偶liwe, poniewa偶 255 gniazd z kroku 2 s nadal zajte, co oznacza, 偶e ka偶de nowo dostpne gniazdo musi by tym, kt贸re zostao zwolnione w kroku 3. Czas potrzebny na zwolnienie 256. gniazda jest bezporednio zwizany z czasem potrzebnym na zakoczenie 偶dania do strony docelowej.

Wicej informacji: [https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/) 

### Pula pocze wedug celu

* **Metody wczenia**: 呕dania JavaScript
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj zwizany z zawartoci strony, kodem stanu)
* **Wicej informacji**:
* **Podsumowanie:** Jest to podobna technika do poprzedniej, ale zamiast u偶ywa wszystkich gniazd, Google **Chrome** narzuca limit **6 r贸wnoczesnych 偶da do tego samego pochodzenia**. Jeli **zablokujemy 5** i nastpnie **uruchomimy 6.** 偶danie, mo偶emy **zmierzy** to i jeli uda nam si sprawi, 偶e **strona ofiarna wyle** wicej **偶da** do tego samego punktu kocowego, aby wykry **stan** **strony**, **6. 偶danie** potrwa **du偶ej** i bdziemy w stanie to wykry.
## Techniki interfejsu API wydajnoci

[`Interfejs API wydajnoci`](https://developer.mozilla.org/en-US/docs/Web/API/Performance) oferuje wgld w metryki wydajnoci aplikacji internetowych, dodatkowo wzbogacony przez [`Interfejs czasowania zasob贸w`](https://developer.mozilla.org/en-US/docs/Web/API/Resource\_Timing\_API). Interfejs czasowania zasob贸w umo偶liwia monitorowanie szczeg贸owych czas贸w 偶da sieciowych, takich jak czas trwania 偶da. Warto zauwa偶y, 偶e gdy serwery zawieraj nag贸wek `Timing-Allow-Origin: *` w swoich odpowiedziach, dodatkowe dane, takie jak rozmiar transferu i czas poszukiwania domeny, staj si dostpne.

Te bogactwo danych mo偶na pozyska za pomoc metod takich jak [`performance.getEntries`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntries) lub [`performance.getEntriesByName`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByName), zapewniajc wszechstronny widok informacji zwizanych z wydajnoci. Ponadto, interfejs umo偶liwia pomiar czas贸w wykonania poprzez obliczanie r贸偶nicy midzy znacznikami czasowymi uzyskanymi z [`performance.now()`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now). Warto jednak zauwa偶y, 偶e dla pewnych operacji w przegldarkach, takich jak Chrome, precyzja `performance.now()` mo偶e by ograniczona do milisekund, co mo偶e wpyn na dokadno pomiar贸w czasowych.

Poza pomiarami czasowymi, interfejs API wydajnoci mo偶e by wykorzystany do uzyskania informacji zwizanych z bezpieczestwem. Na przykad obecno lub brak stron w obiekcie `performance` w Chrome mo偶e wskazywa na zastosowanie `X-Frame-Options`. Konkretnie, jeli strona jest blokowana przed renderowaniem w ramce z powodu `X-Frame-Options`, nie zostanie zapisana w obiekcie `performance`, co stanowi subtelny wskaz贸wk dotyczc polityk ramkowania strony.

### Wyciek bd贸w

* **Metody wczenia**: Ramki, Elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** 呕danie, kt贸re koczy si bdem, nie utworzy wpisu czasowania zasob贸w.
* **Przykad kodu**: [https://xsinator.com/testing.html#Performance%20API%20Error%20Leak](https://xsinator.com/testing.html#Performance%20API%20Error%20Leak)

Mo偶liwe jest **rozr贸偶nienie midzy kodami stanu odpowiedzi HTTP**, poniewa偶 偶dania prowadzce do **bdu** nie tworz **wpisu wydajnoci**.

### Bd ponownego adowania stylu

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** Ze wzgldu na bd przegldarki, 偶dania koczce si bdem s adowane dwukrotnie.
* **Przykad kodu**: [https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak](https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak)

W poprzedniej technice zidentyfikowano r贸wnie偶 dwa przypadki, w kt贸rych bdy przegldarki w GC prowadz do **adowania zasob贸w dwukrotnie, gdy nie uda si je zaadowa**. Spowoduje to wielokrotne wpisy w interfejsie API wydajnoci i mo偶e by wykryte.

### Bd czenia 偶da

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** 呕dania koczce si bdem nie mog by scalane.
* **Przykad kodu**: [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

Technika zostaa znaleziona w tabeli w wspomnianym dokumencie, ale nie znaleziono na niej opisu techniki. Jednak kod 藕r贸dowy sprawdzajcy to mo偶na znale藕 pod adresem [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

### Wyciek pustej strony

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** Puste odpowiedzi nie tworz wpis贸w czasowania zasob贸w.
* **Przykad kodu**: [https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak](https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak)

Atakujcy mo偶e wykry, czy 偶danie zakoczyo si pustym ciaem odpowiedzi HTTP, poniewa偶 **puste strony nie tworz wpisu wydajnoci w niekt贸rych przegldarkach**.

### **Wyciek XSS-Auditora**

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** Korzystajc z audytora XSS w twierdzeniach bezpieczestwa, atakujcy mog wykry konkretne elementy strony internetowej, obserwujc zmiany w odpowiedziach, gdy stworzone adunki wyzwalaj mechanizm filtrowania audytora.
* **Przykad kodu**: [https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak](https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak)

W twierdzeniach bezpieczestwa (SA) audytor XSS, pierwotnie przeznaczony do zapobiegania atakom typu Cross-Site Scripting (XSS), paradoksalnie mo偶e by wykorzystany do wycieku poufnych informacji. Chocia偶 ta wbudowana funkcja zostaa usunita z Google Chrome (GC), nadal jest obecna w SA. W 2013 roku Braun i Heiderich wykazali, 偶e audytor XSS mo偶e przypadkowo blokowa prawidowe skrypty, prowadzc do faszywych pozytyw贸w. Na tej podstawie badacze opracowali techniki wydobywania informacji i wykrywania okrelonych treci na stronach z r贸偶nych 藕r贸de, koncepcj znan jako XS-Leaks, pocztkowo zgoszon przez Terad i rozwinit przez Heyesa w pocie na blogu. Chocia偶 te techniki byy specyficzne dla audytora XSS w GC, odkryto, 偶e w SA strony zablokowane przez audytora XSS nie generuj wpis贸w w interfejsie API wydajnoci, ujawniajc metod, dziki kt贸rej wra偶liwe informacje mog wci偶 by wyciekane.

### Wyciek X-Frame

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2), [https://xsleaks.github.io/xsleaks/examples/x-frame/index.html](https://xsleaks.github.io/xsleaks/examples/x-frame/index.html), [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options)
* **Podsumowanie:** Zas贸b z nag贸wkiem X-Frame-Options nie tworzy wpisu czasowania zasob贸w.
* **Przykad kodu**: [https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak](https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak)

Jeli strona **nie mo偶e** by **renderowana** w **ramce**, nie tworzy **wpisu wydajnoci**. W rezultacie atakujcy mo偶e wykry nag贸wek odpowiedzi **`X-Frame-Options`**.\
To samo dotyczy u偶ycia tagu **embed**. 

### Wykrywanie pobierania

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** Pobrania nie tworz wpis贸w czasowania zasob贸w w interfejsie API wydajnoci.
* **Przykad kodu**: [https://xsinator.com/testing.html#Performance%20API%20Download%20Detection](https://xsinator.com/testing.html#Performance%20API%20Download%20Detection)

Podobnie jak opisany XS-Leak, **zas贸b pobrany** z powodu nag贸wka ContentDisposition, r贸wnie偶 nie tworzy **wpisu wydajnoci**. Ta technika dziaa we wszystkich g贸wnych przegldarkach.
### Przekierowanie Start Leak

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Przekierowanie
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** Wyciek czasu rozpoczcia przekierowania poprzez zas贸b czasowania.
* **Przykad kodu**: [https://xsinator.com/testing.html#Redirect%20Start%20Leak](https://xsinator.com/testing.html#Redirect%20Start%20Leak)

Znale藕limy jedno wystpienie XS-Leak, kt贸re nadu偶ywa zachowania niekt贸rych przegldarek, kt贸re rejestruj zbyt wiele informacji dla 偶da midzydomenowych. Standard definiuje podzbi贸r atrybut贸w, kt贸re powinny by ustawione na zero dla zasob贸w midzydomenowych. Jednak偶e, w **SA** jest mo偶liwe wykrycie, czy u偶ytkownik jest **przekierowany** przez stron docelow, poprzez zapytanie **API Performance** i sprawdzenie danych czasowania **redirectStart**.

### Przekierowanie Czasu Trwania Leak

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Przekierowanie
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** Czas trwania wpis贸w czasowania jest ujemny, gdy wystpuje przekierowanie.
* **Przykad kodu**: [https://xsinator.com/testing.html#Duration%20Redirect%20Leak](https://xsinator.com/testing.html#Duration%20Redirect%20Leak)

W GC, **czas trwania** dla 偶da, kt贸re skutkuj **przekierowaniem**, jest **ujemny** i mo偶na je zatem **rozr贸偶ni** od 偶da, kt贸re nie skutkuj przekierowaniem.

### Wyciek CORP

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Podsumowanie:** Zasoby chronione za pomoc CORP nie tworz wpis贸w czasowania zasob贸w.
* **Przykad kodu**: [https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak](https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak)

W niekt贸rych przypadkach, wpis **nextHopProtocol** mo偶e by u偶ywany jako technika wycieku. W GC, gdy ustawiony jest nag贸wek **CORP**, warto **nextHopProtocol** bdzie **pusta**. Zauwa偶, 偶e SA nie utworzy w og贸le wpisu o wydajnoci dla zasob贸w z wczonym CORP.

### Serwis Worker

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: U偶ycie API
* **Wicej informacji**: [https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/](https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/)
* **Podsumowanie:** Wykryj, czy serwis Worker jest zarejestrowany dla okrelonego pochodzenia.
* **Przykad kodu**:

Serwisy Worker to konteksty skryptowe sterowane zdarzeniami, kt贸re dziaaj w pochodzeniu. Dziaaj one w tle strony internetowej i mog przechwytywa, modyfikowa i **buforowa zasoby**, aby tworzy aplikacje internetowe offline.\
Jeli **zas贸b buforowany** przez **serwis Worker** jest dostpny poprzez **iframe**, zas贸b zostanie **zaadowany z bufora serwisu Worker**.\
Aby wykry, czy zas贸b zosta **zaadowany z bufora serwisu Worker**, mo偶na u偶y **API Performance**.\
Mo偶na to r贸wnie偶 zrobi za pomoc ataku czasowego (sprawd藕 dokument dla wicej informacji).

### Pami Cache

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Czasowanie
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources)
* **Podsumowanie:** Mo偶liwe jest sprawdzenie, czy zas贸b zosta przechowywany w pamici podrcznej.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources), [https://xsinator.com/testing.html#Cache%20Leak%20(POST)](https://xsinator.com/testing.html#Cache%20Leak%20\(POST\))

Korzystajc z [API Performance](./#performance-api) mo偶na sprawdzi, czy zas贸b jest buforowany.

### Czas Trwania Sieci

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)
* **Podsumowanie:** Mo偶liwe jest pobranie czasu trwania sieciowego 偶dania z API `performance`.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)

## Technika Komunikat贸w o Bdach

### Bd Media

* **Metody wczenia**: Elementy HTML (Wideo, Audio)
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://bugs.chromium.org/p/chromium/issues/detail?id=828265](https://bugs.chromium.org/p/chromium/issues/detail?id=828265)
* **Podsumowanie:** W Firefoxie mo偶liwe jest dokadne wyciekanie kodu stanu 偶dania midzydomenowego.
* **Przykad kodu**: [https://jsbin.com/nejatopusi/1/edit?html,css,js,output](https://jsbin.com/nejatopusi/1/edit?html,css,js,output)
```javascript
// Code saved here in case it dissapear from the link
// Based on MDN MediaError example: https://mdn.github.io/dom-examples/media/mediaerror/
window.addEventListener("load", startup, false);
function displayErrorMessage(msg) {
document.getElementById("log").innerHTML += msg;
}

function startup() {
let audioElement = document.getElementById("audio");
// "https://mdn.github.io/dom-examples/media/mediaerror/assets/good.mp3";
document.getElementById("startTest").addEventListener("click", function() {
audioElement.src = document.getElementById("testUrl").value;
}, false);
// Create the event handler
var errHandler = function() {
let err = this.error;
let message = err.message;
let status = "";

// Chrome error.message when the request loads successfully: "DEMUXER_ERROR_COULD_NOT_OPEN: FFmpegDemuxer: open context failed"
// Firefox error.message when the request loads successfully: "Failed to init decoder"
if((message.indexOf("DEMUXER_ERROR_COULD_NOT_OPEN") != -1) || (message.indexOf("Failed to init decoder") != -1)){
status = "Success";
}else{
status = "Error";
}
displayErrorMessage("<strong>Status: " + status + "</strong> (Error code:" + err.code + " / Error Message: " + err.message + ")<br>");
};
audioElement.onerror = errHandler;
}
```
### CORS Error

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **Podsumowanie:** W twierdzeniach dotyczcych bezpieczestwa (SA), komunikaty bd贸w CORS niechccy ujawniaj peny adres URL przekierowanych 偶da.
* **Przykad kodu**: [https://xsinator.com/testing.html#CORS%20Error%20Leak](https://xsinator.com/testing.html#CORS%20Error%20Leak)

Ta technika umo偶liwia atakujcemu **wydobycie celu przekierowania strony z innej domeny** poprzez wykorzystanie sposobu, w jaki przegldarki oparte na Webkit obsuguj 偶dania CORS. Konkretnie, gdy **偶danie z wczonym CORS** jest wysyane do strony docelowej, kt贸ra przekierowuje na podstawie stanu u偶ytkownika, a przegldarka nastpnie odmawia 偶dania, **peny adres URL docelowego przekierowania** jest ujawniany w komunikacie bdu. Ta podatno nie tylko ujawnia fakt przekierowania, ale tak偶e eksponuje punkt kocowy przekierowania oraz ewentualne **czue parametry zapytania**, kt贸re mo偶e zawiera.

### SRI Error

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **Podsumowanie:** W twierdzeniach dotyczcych bezpieczestwa (SA), komunikaty bd贸w CORS niechccy ujawniaj peny adres URL przekierowanych 偶da.
* **Przykad kodu**: [https://xsinator.com/testing.html#SRI%20Error%20Leak](https://xsinator.com/testing.html#SRI%20Error%20Leak)

Atakujcy mo偶e wykorzysta **rozszerzone komunikaty bd贸w** do wydedukowania rozmiaru odpowiedzi z innej domeny. Jest to mo偶liwe dziki mechanizmowi Integralnoci Podzasobu (SRI), kt贸ry u偶ywa atrybutu integralnoci do weryfikacji, czy zasoby pobrane, czsto z CDN-贸w, nie zostay sfaszowane. Aby SRI dziaao na zasobach z innej domeny, musz by **wczone CORS**; w przeciwnym razie nie podlegaj one weryfikacji integralnoci. W twierdzeniach dotyczcych bezpieczestwa (SA), podobnie jak w przypadku bdu CORS XS-Leak, komunikat bdu mo偶e by przechwycony po nieudanym 偶daniu pobrania z atrybutem integralnoci. Atakujcy mog celowo **wywoa ten bd**, przypisujc **faszyw warto skr贸tu** do atrybutu integralnoci dowolnego 偶dania. W SA, rezultujcy komunikat bdu niechccy ujawnia dugo zawartoci 偶danego zasobu. To wyciek informacji pozwala atakujcemu rozpozna r贸偶nice w rozmiarze odpowiedzi, torujc drog dla zaawansowanych atak贸w XS-Leak.

### Naruszenie/Wykrywanie CSP

* **Metody wczenia**: Wyskakujce okienka
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://bugs.chromium.org/p/chromium/issues/detail?id=313737](https://bugs.chromium.org/p/chromium/issues/detail?id=313737), [https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html](https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html), [https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects](https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects)
* **Podsumowanie:** Pozwalajc jedynie na stron ofiary w CSP, jeli pr贸bujemy uzyska do niej dostp i pr贸buje przekierowa na inn domen, CSP spowoduje wykrywalny bd.
* **Przykad kodu**: [https://xsinator.com/testing.html#CSP%20Violation%20Leak](https://xsinator.com/testing.html#CSP%20Violation%20Leak), [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation)

XS-Leak mo偶e wykorzysta CSP do wykrycia, czy strona z innej domeny zostaa przekierowana na inn domen. Ten wyciek mo偶e wykry przekierowanie, ale dodatkowo ujawnia domen docelow przekierowania. Podstawowym pomysem tego ataku jest **pozwolenie na domen docelow na stronie atakujcego**. Gdy 偶danie jest kierowane do domeny docelowej, **przekierowuje** ono na stron z innej domeny. **CSP blokuje** dostp do niej i tworzy **raport naruszenia u偶ywany jako technika wycieku**. W zale偶noci od przegldarki, **ten raport mo偶e ujawni lokalizacj docelow przekierowania**.\
Nowoczesne przegldarki nie wska偶 adresu URL, na kt贸ry nastpio przekierowanie, ale nadal mo偶na wykry, 偶e zostao ono uruchomione.

### Pami podrczna

* **Metody wczenia**: Ramki, Wyskakujce okienka
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events](https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events), [https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html](https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html)
* **Podsumowanie:** Wyczy plik z pamici podrcznej. Otw贸rz stron docelow, sprawd藕, czy plik jest obecny w pamici podrcznej.
* **Przykad kodu:**

Przegldarki mog u偶ywa jednej wsp贸lnej pamici podrcznej dla wszystkich stron internetowych. Bez wzgldu na ich pochodzenie, mo偶na wydedukowa, czy strona docelowa **偶daa okrelonego pliku**.

Jeli strona aduje obraz tylko wtedy, gdy u偶ytkownik jest zalogowany, mo偶na **uniewa偶ni** **zas贸b** (aby nie by ju偶 w pamici podrcznej, jeli by, zobacz wicej informacji), **wykona 偶danie**, kt贸re mogoby zaadowa ten zas贸b i spr贸bowa zaadowa zas贸b **z bdnym 偶daniem** (np. u偶ywajc zbyt dugiego nag贸wka referera). Jeli zaadowanie zasobu **nie spowodowao 偶adnego bdu**, oznacza to, 偶e by on **w pamici podrcznej**.

### Dyrektywa CSP

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://bugs.chromium.org/p/chromium/issues/detail?id=1105875](https://bugs.chromium.org/p/chromium/issues/detail?id=1105875)
* **Podsumowanie:** Dyrektywy nag贸wka CSP mog by sondowane za pomoc atrybutu iframe CSP, ujawniajc szczeg贸y polityki.
* **Przykad kodu**: [https://xsinator.com/testing.html#CSP%20Directive%20Leak](https://xsinator.com/testing.html#CSP%20Directive%20Leak)

Nowa funkcja w Google Chrome (GC) pozwala stronie internetowej **zaproponowa polityk bezpieczestwa zawartoci (CSP)**, ustawiajc atrybut na elemencie iframe, z dyrektywami polityki przesyanymi wraz z 偶daniem HTTP. Zazwyczaj osadzona zawarto musi **autoryzowa to za pomoc nag贸wka HTTP**, w przeciwnym razie zostanie wywietlona **strona bdu**. Jednak jeli iframe jest ju偶 objty CSP, a nowo proponowana polityka nie jest bardziej restrykcyjna, strona zostanie zaadowana normalnie. Ten mechanizm otwiera drog dla atakujcego do **wykrycia konkretnych dyrektyw CSP** strony z innej domeny poprzez identyfikacj strony bdu. Chocia偶 ta podatno zostaa oznaczona jako naprawiona, nasze ustalenia ujawniaj **now technik wycieku**, zdoln do wykrywania strony bdu, sugerujc, 偶e podstawowy problem nigdy nie zosta w peni rozwizany.

### **CORP**

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [**https://xsleaks.dev/docs/attacks/browser-features/corp/**](https://xsleaks.dev/docs/attacks/browser-features/corp/)
* **Podsumowanie:** Zasoby zabezpieczone za pomoc Cross-Origin Resource Policy (CORP) spowoduj bd podczas pobierania z nieautoryzowanego 藕r贸da.
* **Przykad kodu**: [https://xsinator.com/testing.html#CORP%20Leak](https://xsinator.com/testing.html#CORP%20Leak)

Nag贸wek CORP to stosunkowo nowa funkcja bezpieczestwa platformy internetowej, kt贸ra gdy jest ustawiona **blokuje 偶dania no-cors z innej domeny** do okrelonego zasobu. Obecno tego nag贸wka mo偶e by wykryta, poniewa偶 zas贸b zabezpieczony za pomoc CORP spowoduje **bd podczas pobierania**.
### CORB

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Nag贸wki
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header](https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header)
* **Podsumowanie**: CORB mo偶e pozwoli atakujcym wykry obecno nag贸wka **`nosniff`** w 偶daniu.
* **Przykad kodu**: [https://xsinator.com/testing.html#CORB%20Leak](https://xsinator.com/testing.html#CORB%20Leak)

Sprawd藕 link, aby uzyska wicej informacji na temat ataku.

### Bd CORS na nieprawidowej konfiguracji odbicia pochodzenia <a href="#cors-error-on-origin-reflection-misconfiguration" id="cors-error-on-origin-reflection-misconfiguration"></a>

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Nag贸wki
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)
* **Podsumowanie**: Jeli nag贸wek Origin jest odbijany w nag贸wku `Access-Control-Allow-Origin`, mo偶liwe jest sprawdzenie, czy zas贸b jest ju偶 w pamici podrcznej.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)

W przypadku gdy **nag贸wek Origin** jest **odbijany** w nag贸wku `Access-Control-Allow-Origin`, atakujcy mo偶e nadu偶y tego zachowania, pr贸bujc **pobra** **zas贸b** w trybie **CORS**. Jeli **bd nie jest wywoany**, oznacza to, 偶e zosta **poprawnie pobrany z sieci**, jeli bd jest **wywoany**, oznacza to, 偶e zosta **pobrany z pamici podrcznej** (bd pojawia si, poniewa偶 pami podrczna zapisuje odpowied藕 z nag贸wkiem CORS zezwalajcym na oryginaln domen, a nie na domen atakujcego).\
Nale偶y zauwa偶y, 偶e jeli pochodzenie nie jest odbijane, ale u偶ywany jest znak wieloznaczny (`Access-Control-Allow-Origin: *`), to nie zadziaa.

## Technika czytelnych atrybut贸w

### Przekierowanie Fetch

* **Metody wczenia**: Fetch API
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html](https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html)
* **Podsumowanie:** GC i SA pozwalaj sprawdzi typ odpowiedzi (opaque-redirect) po zakoczeniu przekierowania.
* **Przykad kodu**: [https://xsinator.com/testing.html#Fetch%20Redirect%20Leak](https://xsinator.com/testing.html#Fetch%20Redirect%20Leak)

Przesyajc 偶danie za pomoc Fetch API z `redirect: "manual"` i innymi parametrami, mo偶liwe jest odczytanie atrybutu `response.type` i jeli jest r贸wny `opaqueredirect`, to odpowied藕 bya przekierowaniem.

### COOP

* **Metody wczenia**: Okienka pop-up
* **Wykrywalna r贸偶nica**: Nag贸wek
* **Wicej informacji**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.4), [https://xsleaks.dev/docs/attacks/window-references/](https://xsleaks.dev/docs/attacks/window-references/)
* **Podsumowanie:** Strony zabezpieczone przez Cross-Origin Opener Policy (COOP) uniemo偶liwiaj dostp do interakcji midzy r贸偶nymi pochodzeniami.
* **Przykad kodu**: [https://xsinator.com/testing.html#COOP%20Leak](https://xsinator.com/testing.html#COOP%20Leak)

Atakujcy jest w stanie wywnioskowa obecno nag贸wka Cross-Origin Opener Policy (COOP) w odpowiedzi HTTP z innego pochodzenia. COOP jest wykorzystywany przez aplikacje internetowe do uniemo偶liwienia zewntrznym witrynom uzyskania arbitralnych odwoa do okien. Widoczno tego nag贸wka mo偶na zauwa偶y, pr贸bujc uzyska dostp do **odwoania contentWindow**. W przypadkach, gdy COOP jest stosowany warunkowo, **waciwo opener** staje si wska藕nikiem: jest **niezdefiniowana**, gdy COOP jest aktywne, i **zdefiniowana** w jego braku.

### Maksymalna dugo adresu URL - Po stronie serwera

* **Metody wczenia**: Fetch API, Elementy HTML
* **Wykrywalna r贸偶nica**: Kod stanu / Zawarto
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects](https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects)
* **Podsumowanie:** Wykrywanie r贸偶nic w odpowiedziach z powodu dugoci odpowiedzi przekierowania, kt贸ra mo偶e by zbyt du偶a, co powoduje, 偶e serwer odpowiada bdem i generowany jest alert.
* **Przykad kodu**: [https://xsinator.com/testing.html#URL%20Max%20Length%20Leak](https://xsinator.com/testing.html#URL%20Max%20Length%20Leak)

Jeli przekierowanie po stronie serwera wykorzystuje **dane u偶ytkownika wewntrz przekierowania** i **dodatkowe dane**, mo偶liwe jest wykrycie tego zachowania, poniewa偶 zwykle **serwery** maj **limit dugoci 偶dania**. Jeli **dane u偶ytkownika** maj **t sam dugo - 1**, poniewa偶 **przekierowanie** u偶ywa **tych danych** i **dodaje** co **dodatkowego**, spowoduje to **bd wykrywalny za pomoc zdarze bd贸w**.

Jeli uda ci si jako ustawi ciasteczka u偶ytkownikowi, mo偶esz r贸wnie偶 przeprowadzi ten atak, **ustawiajc wystarczajc ilo ciasteczek** ([**bomb ciasteczkow**](../hacking-with-cookies/cookie-bomb.md)), wic z **zwikszon wielkoci odpowiedzi** **poprawnej odpowiedzi** zostanie wywoany **bd**. W tym przypadku pamitaj, 偶e jeli wywoasz to 偶danie z tej samej witryny, `<script>` automatycznie wyle ciasteczka (wic mo偶esz sprawdzi bdy).\
Przykad **bomby ciasteczkowej + XS-Search** mo偶na znale藕 w zamierzonym rozwizaniu tego opisu: [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended)

`SameSite=None` lub bycie w tym samym kontekcie jest zazwyczaj wymagane dla tego rodzaju ataku.

### Maksymalna dugo adresu URL - Po stronie klienta

* **Metody wczenia**: Okienka pop-up
* **Wykrywalna r贸偶nica**: Kod stanu / Zawarto
* **Wicej informacji**: [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)
* **Podsumowanie:** Wykrywanie r贸偶nic w odpowiedziach z powodu dugoci odpowiedzi przekierowania, kt贸ra mo偶e by zbyt du偶a, aby mo偶na byo zauwa偶y r贸偶nic.
* **Przykad kodu**: [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)

Zgodnie z [dokumentacj Chromium](https://chromium.googlesource.com/chromium/src/+/main/docs/security/url\_display\_guidelines/url\_display\_guidelines.md#URL-Length), maksymalna dugo adresu URL w Chrome wynosi 2 MB.

> Og贸lnie rzecz biorc, _platforma internetowa_ nie ma ogranicze co do dugoci adres贸w URL (cho 2^31 to powszechne ograniczenie). _Chrome_ ogranicza adresy URL do maksymalnej dugoci **2 MB** z powod贸w praktycznych i aby unikn problem贸w z odmow usugi w komunikacji midzyprocesowej.

Dlatego jeli **adres URL przekierowania jest wikszy w jednym z przypadk贸w**, mo偶liwe jest przekierowanie z **adresem URL wikszym ni偶 2 MB**, aby uderzy w **limit dugoci**. Gdy to si zdarzy, Chrome wywietla stron **`about:blank#blocked`**.

**Zauwa偶alna r贸偶nica** polega na tym, 偶e jeli **przekierowanie** zostao **zakoczone**, `window.origin` wywouje **bd**, poniewa偶 pochodzenie zewntrzne nie mo偶e uzyska do tego informacji. Jednak jeli **limit** zosta **przekroczony** i zaadowana strona to **`about:blank#blocked`**, to pochodzenie okna pozostaje takie jak **rodzica**, co jest **dostpn informacj**.

Wszystkie dodatkowe informacje potrzebne do osignicia **2 MB** mo偶na doda za pomoc **hasztagu** w pocztkowym adresie URL, aby zosta on **u偶yty w przekierowaniu**.

{% content-ref url="url-max-length-client-side.md" %}
[url-max-length-client-side.md](url-max-length-client-side.md)
{% endcontent-ref %}
### Maksymalna liczba przekierowa

* **Metody wczenia**: Fetch API, Ramki
* **Wykrywalna r贸偶nica**: Kod stanu
* **Wicej informacji**: [https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76)
* **Podsumowanie:** U偶yj limitu przekierowa przegldarki, aby ustali wystpowanie przekierowa URL.
* **Przykad kodu**: [https://xsinator.com/testing.html#Max%20Redirect%20Leak](https://xsinator.com/testing.html#Max%20Redirect%20Leak)

Jeli **maksymalna** liczba **przekierowa** przegldarki wynosi **20**, atakujcy mo偶e spr贸bowa zaadowa swoj stron z **19 przekierowaniami** i ostatecznie **przekierowa ofiar** do testowanej strony. Jeli zostanie wywoany **bd**, oznacza to, 偶e strona pr贸bowaa **przekierowa ofiar**.

### Dugo historii

* **Metody wczenia**: Ramki, Okienka pop-up
* **Wykrywalna r贸偶nica**: Przekierowania
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/navigations/](https://xsleaks.dev/docs/attacks/navigations/)
* **Podsumowanie:** Kod JavaScript manipuluje histori przegldarki i mo偶na uzyska do niego dostp za pomoc waciwoci length.
* **Przykad kodu**: [https://xsinator.com/testing.html#History%20Length%20Leak](https://xsinator.com/testing.html#History%20Length%20Leak)

API historii pozwala kodowi JavaScript manipulowa histori przegldarki, kt贸ra **zapisuje odwiedzone przez u偶ytkownika strony**. Atakujcy mo偶e wykorzysta waciwo length jako metod wczenia: do wykrywania nawigacji JavaScript i HTML.\
Sprawdzajc `history.length`, sprawiajc, 偶e u偶ytkownik **przechodzi** do strony, **zmienia** j **z powrotem** do tego samego pochodzenia i **sprawdzajc** now warto **`history.length`**.

### Dugo historii z tym samym adresem URL

* **Metody wczenia**: Ramki, Okienka pop-up
* **Wykrywalna r贸偶nica**: Jeli adres URL jest taki sam jak zgadywany
* **Podsumowanie:** Mo偶liwe jest zgadnicie, czy lokalizacja ramki/okienka jest w okrelonym adresie URL, nadu偶ywajc dugoci historii.
* **Przykad kodu**: Poni偶ej

Atakujcy m贸gby u偶y kodu JavaScript do **manipulowania lokalizacj ramki/okienka na zgadywany adres** i **natychmiast** **zmieni go na `about:blank`**. Jeli dugo historii wzrosa, oznacza to, 偶e adres URL by poprawny i mia czas na **zwikszenie, poniewa偶 adres URL nie jest ponownie adowany, jeli jest taki sam**. Jeli nie wzrosa, oznacza to, 偶e **pr贸bowa zaadowa zgadywany adres URL**, ale poniewa偶 **natychmiast po** zaadowaniu **`about:blank`**, **dugo historii nigdy nie wzrosa** podczas adowania zgadywanego adresu URL.
```javascript
async function debug(win, url) {
win.location = url + '#aaa';
win.location = 'about:blank';
await new Promise(r => setTimeout(r, 500));
return win.history.length;
}

win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=c"));

win.close();
win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=b"));
```
### Liczenie ramek

* **Metody wczenia**: Ramki, Wyskakujce okienka
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/frame-counting/](https://xsleaks.dev/docs/attacks/frame-counting/)
* **Podsumowanie:** Oce ilo element贸w iframe, sprawdzajc waciwo `window.length`.
* **Przykad kodu**: [https://xsinator.com/testing.html#Frame%20Count%20Leak](https://xsinator.com/testing.html#Frame%20Count%20Leak)

Liczenie **liczby ramek** w witrynie otwartej za pomoc `iframe` lub `window.open` mo偶e pom贸c zidentyfikowa **stan u偶ytkownika na tej stronie**.\
Co wicej, jeli strona zawsze ma t sam liczb ramek, cige sprawdzanie liczby ramek mo偶e pom贸c zidentyfikowa **wzorzec**, kt贸ry mo偶e ujawni informacje.

Przykadem tej techniki jest to, 偶e w przegldarce Chrome **PDF** mo偶e by **wykrywany** za pomoc **liczenia ramek**, poniewa偶 wewntrznie u偶ywane jest `embed`. Istniej [Parametry URL otwarcia](https://bugs.chromium.org/p/chromium/issues/detail?id=64309#c113), kt贸re pozwalaj na pewn kontrol nad zawartoci, tak jak `zoom`, `view`, `page`, `toolbar`, gdzie ta technika mo偶e by interesujca.

### Elementy HTMLElements

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/)
* **Podsumowanie:** Odczytaj wyciek warto, aby odr贸偶ni midzy 2 mo偶liwymi stanami
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/), [https://xsinator.com/testing.html#Media%20Dimensions%20Leak](https://xsinator.com/testing.html#Media%20Dimensions%20Leak), [https://xsinator.com/testing.html#Media%20Duration%20Leak](https://xsinator.com/testing.html#Media%20Duration%20Leak)

Wyciek informacji za pomoc element贸w HTML jest problemem w bezpieczestwie sieciowym, zwaszcza gdy dynamiczne pliki multimedialne s generowane na podstawie informacji u偶ytkownika, lub gdy dodawane s znaki wodne, zmieniajc rozmiar multimedi贸w. Mo偶e to by wykorzystane przez atakujcych do odr贸偶nienia midzy mo偶liwymi stanami poprzez analiz informacji ujawnianych przez okrelone elementy HTML.

### Informacje Ujawniane przez Elementy HTML

* **HTMLMediaElement**: Ten element ujawnia czasy `duration` i `buffered` multimedi贸w, do kt贸rych mo偶na uzyska dostp za pomoc jego interfejsu API. [Czytaj wicej o HTMLMediaElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement)
* **HTMLVideoElement**: Ujawnia `videoHeight` i `videoWidth`. W niekt贸rych przegldarkach dostpne s dodatkowe waciwoci, takie jak `webkitVideoDecodedByteCount`, `webkitAudioDecodedByteCount` i `webkitDecodedFrameCount`, oferujce bardziej szczeg贸owe informacje na temat zawartoci multimedialnej. [Czytaj wicej o HTMLVideoElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement)
* **getVideoPlaybackQuality()**: Ta funkcja dostarcza szczeg贸owe informacje o jakoci odtwarzania wideo, w tym `totalVideoFrames`, kt贸re mog wskazywa ilo przetworzonych danych wideo. [Czytaj wicej o getVideoPlaybackQuality()](https://developer.mozilla.org/en-US/docs/Web/API/VideoPlaybackQuality)
* **HTMLImageElement**: Ten element ujawnia `height` i `width` obrazu. Jednak jeli obraz jest nieprawidowy, te waciwoci zwr贸c 0, a funkcja `image.decode()` zostanie odrzucona, sygnalizujc niepowodzenie adowania obrazu. [Czytaj wicej o HTMLImageElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement)

### Waciwo CSS

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle](https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle), [https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html](https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html)
* **Podsumowanie:** Identyfikuj zmiany w stylowaniu strony internetowej, kt贸re koreluj ze stanem u偶ytkownika.
* **Przykad kodu**: [https://xsinator.com/testing.html#CSS%20Property%20Leak](https://xsinator.com/testing.html#CSS%20Property%20Leak)

Aplikacje internetowe mog zmienia **stylowanie strony internetowej w zale偶noci od stanu u偶ytkownika**. Pliki CSS z r贸偶nych 藕r贸de mog by osadzone na stronie atakujcego za pomoc **elementu link HTML**, a **reguy** zostan **zastosowane** do strony atakujcego. Jeli strona dynamicznie zmienia te reguy, atakujcy mo偶e **wykry** te **r贸偶nice** w zale偶noci od stanu u偶ytkownika.\
Jako technika wycieku, atakujcy mo偶e u偶y metody `window.getComputedStyle` do **odczytania** waciwoci CSS okrelonego elementu HTML. W rezultacie atakujcy mo偶e odczyta dowolne waciwoci CSS, jeli znany jest dotknity element i nazwa waciwoci.

### Historia CSS

* **Metody wczenia**: Elementy HTML
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history](https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history)
* **Podsumowanie:** Wykryj, czy styl `:visited` jest zastosowany do adresu URL, wskazujc, 偶e zosta ju偶 odwiedzony
* **Przykad kodu**: [http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html](http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html)

{% hint style="info" %}
Zgodnie z [**tym**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/), to nie dziaa w headless Chrome.
{% endhint %}

Selektor CSS `:visited` jest wykorzystywany do stylizacji adres贸w URL w inny spos贸b, jeli zostay one wczeniej odwiedzone przez u偶ytkownika. W przeszoci metoda `getComputedStyle()` moga by wykorzystana do identyfikacji tych r贸偶nic stylu. Jednak nowoczesne przegldarki wprowadziy rodki bezpieczestwa, aby uniemo偶liwi tej metodzie ujawnienie stanu linku. rodki te obejmuj zawsze zwracanie stylu obliczonego tak, jakby link by odwiedzony, oraz ograniczanie styl贸w, kt贸re mo偶na zastosowa za pomoc selektora `:visited`.

Mimo tych ogranicze, mo偶liwe jest porednie rozpoznanie stanu odwiedzonego linku. Jedn z technik jest zmylenie u偶ytkownika do interakcji z obszarem dotknitym przez CSS, w szczeg贸lnoci wykorzystanie waciwoci `mix-blend-mode`. Ta waciwo pozwala na mieszanie element贸w z ich tem, potencjalnie ujawniajc stan odwiedzenia na podstawie interakcji u偶ytkownika.

Ponadto, wykrycie mo偶na osign bez interakcji u偶ytkownika, wykorzystujc czasy renderowania link贸w. Poniewa偶 przegldarki mog renderowa odwiedzone i nieodwiedzone linki w inny spos贸b, mo偶e to wprowadzi mierzaln r贸偶nic czasu w renderowaniu. Dow贸d koncepcji (PoC) zosta wspomniany w raporcie bdu Chromium, demonstrujc t technik za pomoc wielu link贸w do wzmocnienia r贸偶nicy czasu, umo偶liwiajc tym samym wykrycie stanu odwiedzenia poprzez analiz czasu.

Aby uzyska wicej informacji na temat tych waciwoci i metod, odwied藕 ich strony dokumentacji:

* `:visited`: [Dokumentacja MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/:visited)
* `getComputedStyle()`: [Dokumentacja MDN](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle)
* `mix-blend-mode`: [Dokumentacja MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode)
### Wyciek X-Frame ContentDocument

* **Metody wczenia**: Ramki
* **Wykrywalna r贸偶nica**: Nag贸wki
* **Wicej informacji**: [https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf](https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf)
* **Podsumowanie:** W Google Chrome, pojawia si dedykowana strona bdu, gdy strona jest blokowana przed osadzeniem na stronie z innej domeny ze wzgldu na ograniczenia X-Frame-Options.
* **Przykad kodu**: [https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak](https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak)

W Chrome, jeli strona z nag贸wkiem `X-Frame-Options` ustawionym na "deny" lub "same-origin" jest osadzona jako obiekt, pojawia si strona bdu. Chrome zwraca unikalnie pusty obiekt dokumentu (zamiast `null`) dla waciwoci `contentDocument` tego obiektu, w przeciwiestwie do iframe'贸w lub innych przegldarek. Atakujcy mogliby wykorzysta to, wykrywajc pusty dokument, potencjalnie ujawniajc informacje o stanie u偶ytkownika, zwaszcza jeli programici niesp贸jnie ustawiaj nag贸wek X-Frame-Options, czsto pomijajc strony bd贸w. wiadomo i konsekwentne stosowanie nag贸wk贸w bezpieczestwa s kluczowe dla zapobiegania takim wyciekom.

### Wykrywanie Pobierania

* **Metody wczenia**: Ramki, Okna pop-up
* **Wykrywalna r贸偶nica**: Nag贸wki
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/navigations/#download-trigger](https://xsleaks.dev/docs/attacks/navigations/#download-trigger)
* **Podsumowanie:** Atakujcy mo偶e rozpozna pobieranie plik贸w, wykorzystujc iframe'y; kontynuowane dostpno iframe'a sugeruje udane pobranie pliku.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/navigations/#download-bar](https://xsleaks.dev/docs/attacks/navigations/#download-bar)

Nag贸wek `Content-Disposition`, w szczeg贸lnoci `Content-Disposition: attachment`, instruuje przegldark do pobrania zawartoci zamiast wywietlania jej inline. To zachowanie mo偶e by wykorzystane do wykrywania, czy u偶ytkownik ma dostp do strony, kt贸ra wywouje pobieranie pliku. W przegldarkach opartych na Chromium istnieje kilka technik do wykrywania tego zachowania pobierania:

1. **Monitorowanie Paska Pobierania**:
* Gdy plik jest pobierany w przegldarkach opartych na Chromium, na dole okna przegldarki pojawia si pasek pobierania.
* Monitorujc zmiany w wysokoci okna, atakujcy mog wywnioskowa pojawienie si paska pobierania, sugerujc rozpoczcie pobierania.
2. **Pobieranie z Nawigacj za pomoc Iframe'贸w**:
* Gdy strona wywouje pobieranie pliku za pomoc nag贸wka `Content-Disposition: attachment`, nie powoduje to zdarzenia nawigacji.
* adujc zawarto w iframe'ie i monitorujc zdarzenia nawigacji, mo偶na sprawdzi, czy dyspozycja zawartoci powoduje pobranie pliku (brak nawigacji) czy nie.
3. **Pobieranie z Nawigacj bez Iframe'贸w**:
* Podobnie jak w technice z iframe'em, ta metoda polega na u偶yciu `window.open` zamiast iframe'a.
* Monitorowanie zdarze nawigacji w nowo otwartym oknie mo偶e ujawni, czy pobrano plik (brak nawigacji) czy czy zawarto jest wywietlana inline (nastpuje nawigacja).

W przypadkach, gdy tylko zalogowani u偶ytkownicy mog wywoa takie pobrania, te techniki mog by wykorzystane do poredniego wnioskowania o stanie uwierzytelnienia u偶ytkownika na podstawie odpowiedzi przegldarki na 偶danie pobrania.

### Pomijanie Partycjonowanego Cache'a HTTP <a href="#partitioned-http-cache-bypass" id="partitioned-http-cache-bypass"></a>

* **Metody wczenia**: Okna pop-up
* **Wykrywalna r贸偶nica**: Czasowanie
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)
* **Podsumowanie:** Atakujcy mo偶e rozpozna pobieranie plik贸w, wykorzystujc iframe'y; kontynuowane dostpno iframe'a sugeruje udane pobranie pliku.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass), [https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722](https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722) (z [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))

{% hint style="warning" %}
Dlatego ta technika jest interesujca: Chrome ma teraz **partycjonowanie pamici podrcznej**, a klucz pamici podrcznej nowo otwartej strony to: `(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m=xxx)`, ale jeli otworz stron ngrok i u偶yj fetch na niej, klucz pamici podrcznej bdzie: `(https://myip.ngrok.io, https://myip.ngrok.io, https://sustenance.web.actf.co/?m=xxx)`, **klucz pamici jest inny**, wic pami podrczna nie mo偶e by wsp贸dzielona. Wicej szczeg贸贸w mo偶na znale藕 tutaj: [Zyskiwanie bezpieczestwa i prywatnoci poprzez partycjonowanie pamici podrcznej](https://developer.chrome.com/blog/http-cache-partitioning/)\
(Komentarz z [**tutaj**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))
{% endhint %}

Jeli strona `example.com` zawiera zas贸b z `*.example.com/resource`, to ten zas贸b bdzie mia **ten sam klucz pamici podrcznej** jakby zas贸b by bezporednio **偶dany poprzez nawigacj na najwy偶szym poziomie**. To dlatego, 偶e klucz pamici podrcznej skada si z _eTLD+1_ na najwy偶szym poziomie i _eTLD+1_ ramki.

Poniewa偶 dostp do pamici podrcznej jest szybszy ni偶 adowanie zasobu, mo偶na spr贸bowa zmieni lokalizacj strony i anulowa j 20 ms (na przykad) po. Jeli po zatrzymaniu zmienia si pochodzenie, oznacza to, 偶e zas贸b by w pamici podrcznej.\
Lub mo偶na po prostu **wysa zapytanie fetch do potencjalnie zasobu w pamici podrcznej i zmierzy czas, jaki to zajmuje**.

### Rczne Przekierowanie <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **Metody wczenia**: API Fetch
* **Wykrywalna r贸偶nica**: Przekierowania
* **Wicej informacji**: [ttps://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234)
* **Podsumowanie:** Mo偶liwe jest sprawdzenie, czy odpowied藕 na 偶danie fetch jest przekierowaniem
* **Przykad kodu**:

![](<../../.gitbook/assets/image (769).png>)

### Fetch z AbortController <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **Metody wczenia**: API Fetch
* **Wykrywalna r贸偶nica**: Czasowanie
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)
* **Podsumowanie:** Mo偶liwe jest pr贸bowanie zaadowania zasobu i przerwanie adowania przed jego zakoczeniem. W zale偶noci od tego, czy wystpi bd, zas贸b by lub nie by w pamici podrcznej.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)

U偶yj _**fetch**_ i _**setTimeout**_ z **AbortController**, aby zar贸wno wykry, czy **zas贸b jest w pamici podrcznej**, jak i usun okrelony zas贸b z pamici podrcznej przegldarki. Ponadto proces ten zachodzi bez buforowania nowej zawartoci.
### Zanieczyszczenie skrypt贸w

* **Metody wczenia**: Elementy HTML (skrypt)
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)
* **Podsumowanie:** Mo偶liwe jest **nadpisanie wbudowanych funkcji** i odczytanie ich argument贸w nawet z **skryptu z innej domeny** (kt贸ry nie mo偶e by odczytany bezporednio), co mo偶e **wycieka cenne informacje**.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)

### Pracownicy usug <a href="#service-workers" id="service-workers"></a>

* **Metody wczenia**: Wyskakujce okienka
* **Wykrywalna r贸偶nica**: Zawarto strony
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers)
* **Podsumowanie:** Mierzenie czasu wykonania strony internetowej za pomoc pracownik贸w usug.
* **Przykad kodu**:

W danej sytuacji atakujcy podejmuje inicjatyw zarejestrowania **pracownika usugi** na jednej z ich domen, konkretnie "attacker.com". Nastpnie atakujcy otwiera nowe okno na stronie docelowej z g贸wnego dokumentu i nakazuje **pracownikowi usugi** rozpoczcie timera. Gdy nowe okno zaczyna si adowa, atakujcy przekierowuje odniesienie uzyskane w poprzednim kroku do strony zarzdzanej przez **pracownika usugi**.

Po przybyciu 偶dania zainicjowanego w poprzednim kroku, **pracownik usugi** odpowiada kodem stanu **204 (No Content)**, efektywnie koczc proces nawigacji. W tym momencie **pracownik usugi** rejestruje pomiar z timera zainicjowanego wczeniej w kroku drugim. Ten pomiar jest wpywany przez czas trwania JavaScript powodujcego op贸藕nienia w procesie nawigacji.

{% hint style="warning" %}
W czasie wykonania mo偶na **wyeliminowa** **czynniki sieciowe** w celu uzyskania **bardziej precyzyjnych pomiar贸w**. Na przykad, poprzez wczytanie zasob贸w u偶ywanych przez stron przed jej zaadowaniem.
{% endhint %}

### Pobieranie czasu

* **Metody wczenia**: Interfejs Fetch API
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj ze wzgldu na zawarto strony, kod stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)
* **Podsumowanie:** U偶yj [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow), aby zmierzy czas wykonania 偶dania. Mo偶na u偶y innych zegar贸w.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)

### Czas midzyokienkowy

* **Metody wczenia**: Wyskakujce okienka
* **Wykrywalna r贸偶nica**: Czas (zazwyczaj ze wzgldu na zawarto strony, kod stanu)
* **Wicej informacji**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)
* **Podsumowanie:** U偶yj [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow), aby zmierzy czas wykonania 偶dania za pomoc `window.open`. Mo偶na u偶y innych zegar贸w.
* **Przykad kodu**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=xs-search), aby atwo tworzy i **automatyzowa przepywy pracy** zasilane przez najbardziej zaawansowane narzdzia spoecznoci na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=xs-search" %}

## Z HTML lub ponownym wstrzykiwaniem

Tutaj znajdziesz techniki do wyciekania informacji z HTML z innej domeny **wstrzykujc zawarto HTML**. Te techniki s interesujce w przypadkach, gdy z jakiego powodu mo偶esz **wstrzykn HTML, ale nie mo偶esz wstrzykn kodu JS**.

### Wiszcy znacznik

{% content-ref url="../dangling-markup-html-scriptless-injection/" %}
[dangling-markup-html-scriptless-injection](../dangling-markup-html-scriptless-injection/)
{% endcontent-ref %}

### Leniwe adowanie obraz贸w

Jeli musisz **wycieka zawarto** i mo偶esz **doda HTML przed sekretem**, powiniene sprawdzi **powszechne techniki wiszcego znacznika**.\
Jednak jeli z jakiego powodu **MUSISZ** to zrobi **znak po znaku** (mo偶e komunikacja odbywa si poprzez trafienie w pami podrczn), mo偶esz skorzysta z tego triku.

**Obrazy** w HTML maj atrybut "**loading**", kt贸rego warto mo偶e by "**lazy**". W takim przypadku obraz zostanie zaadowany, gdy zostanie wywietlony, a nie podczas adowania strony:
```html
<img src=/something loading=lazy >
```
Dlatego mo偶esz **doda du偶o niepotrzebnych znak贸w** (Na przykad **tysice "W"**) aby **wypeni stron internetow przed sekretem lub doda co w rodzaju** `<br><canvas height="1850px"></canvas><br>.`\
Jeli na przykad nasze **wstrzyknicie pojawi si przed flag**, **obraz** zostanie **zaadowany**, ale jeli pojawi si **po** **flaga**, flaga + mieci **uniemo偶liwi jej zaadowanie** (musisz pobawi si iloci mieci do umieszczenia). Tak wanie stao si w [**tym rozwizaniu**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/).

Inn opcj byoby skorzystanie z **scroll-to-text-fragment**, jeli jest to dozwolone:

#### Scroll-to-text-fragment

Jednak偶e, mo偶esz sprawi, 偶e **bot uzyska dostp do strony** za pomoc
```
#:~:text=SECR
```
Wic strona internetowa bdzie wyglda mniej wicej tak: **`https://victim.com/post.html#:~:text=SECR`**

Gdzie post.html zawiera atakujce niepotrzebne znaki i obraz adowany leniwie, a nastpnie dodawany jest sekret bota.

To, co robi ten tekst, to sprawia, 偶e bot uzyskuje dostp do dowolnego tekstu na stronie zawierajcego tekst `SECR`. Poniewa偶 ten tekst to sekret i znajduje si **poni偶ej obrazu**, obraz **zaaduje si tylko wtedy, gdy zgadnity sekret jest poprawny**. Masz wic swoje 藕r贸do, aby **wycieka sekret znak po znaku**.

Przykad kodu do wykorzystania tego: [https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)

### Op贸藕nione adowanie Obrazu na Podstawie Czasu

Jeli **nie jest mo偶liwe zaadowanie zewntrznego obrazu**, co mogoby wskazywa atakujcemu, 偶e obraz zosta zaadowany, inn opcj byoby pr贸bowanie **odgadn znak kilka razy i mierzy to**. Jeli obraz jest zaadowany, wszystkie 偶dania zajm wicej czasu ni偶 w przypadku, gdy obraz nie jest zaadowany. To wanie zostao wykorzystane w [**rozwizaniu tego opisu**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/) **podsumowanym tutaj:**

{% content-ref url="event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

### ReDoS

{% content-ref url="../regular-expression-denial-of-service-redos.md" %}
[regular-expression-denial-of-service-redos.md](../regular-expression-denial-of-service-redos.md)
{% endcontent-ref %}

### CSS ReDoS

Jeli u偶ywane jest `jQuery(location.hash)`, mo偶liwe jest sprawdzenie za pomoc czasu, **czy istnieje jaki zawarto HTML**, poniewa偶 jeli selektor `main[id='site-main']` nie pasuje, nie trzeba sprawdza reszty **selektor贸w**:
```javascript
$("*:has(*:has(*:has(*)) *:has(*:has(*:has(*))) *:has(*:has(*:has(*)))) main[id='site-main']")
```
### Wstrzykiwanie CSS

{% content-ref url="css-injection/" %}
[wstrzykiwanie-css](css-injection/)
{% endcontent-ref %}

## Obrona

Zalecane s rodki zaradcze w [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) oraz w ka偶dej sekcji wiki [https://xsleaks.dev/](https://xsleaks.dev/). Zapoznaj si tam z wicej informacji na temat sposob贸w ochrony przed tymi technikami.

## Odnoniki

* [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)
* [https://xsleaks.dev/](https://xsleaks.dev)
* [https://github.com/xsleaks/xsleaks](https://github.com/xsleaks/xsleaks)
* [https://xsinator.com/](https://xsinator.com/)
* [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
U偶yj [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), aby atwo tworzy i **automatyzowa workflowy** zasilane przez **najbardziej zaawansowane** narzdzia spoecznociowe na wiecie.\
Otrzymaj dostp ju偶 dzi:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=xs-search" %}
