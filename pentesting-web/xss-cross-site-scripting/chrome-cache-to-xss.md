# Chrome Cache to XSS

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>
{% endhint %}

Wicej szczeg贸贸w [**w tym opracowaniu**](https://blog.arkark.dev/2022/11/18/seccon-en/#web-spanote).

Technika om贸wiona tutaj polega na zrozumieniu zachowania i interakcji dw贸ch g贸wnych typ贸w pamici podrcznej: **back/forward cache (bfcache)** i **disk cache**. Bfcache, kt贸ry przechowuje peny zrzut strony, w tym stert JavaScript, ma pierwszestwo przed pamici podrczn dysku w nawigacji wstecz/naprz贸d z powodu swojej zdolnoci do przechowywania bardziej kompleksowego zrzutu. Pami podrczna dysku, w przeciwiestwie do tego, przechowuje zasoby pobrane z sieci bez uwzgldnienia sterty JavaScript i jest wykorzystywana do nawigacji wstecz/naprz贸d w celu zmniejszenia koszt贸w komunikacji. Interesujcym aspektem pamici podrcznej dysku jest jej uwzgldnienie zasob贸w pobranych za pomoc `fetch`, co oznacza, 偶e zasoby URL bd renderowane przez przegldark z pamici podrcznej.

### Kluczowe punkty:

- **bfcache** ma pierwszestwo przed pamici podrczn dysku w nawigacji wstecz/naprz贸d.
- Aby wykorzysta stron przechowywan w pamici podrcznej dysku zamiast bfcache, to ostatnie musi by wyczone.

### Wyczanie bfcache:

Domylnie Puppeteer wycza bfcache, zgodnie z warunkami wymienionymi w dokumentacji Chromium. Jedn z efektywnych metod wyczenia bfcache jest u偶ycie `RelatedActiveContentsExist`, osignite przez otwarcie strony za pomoc `window.open()`, kt贸ra zachowuje odniesienie do `window.opener`.

### Reprodukcja zachowania:

1. Odwied藕 stron internetow, np. `https://example.com`.
2. Wykonaj `open("http://spanote.seccon.games:3000/api/token")`, co skutkuje odpowiedzi serwera z kodem statusu 500.
3. W nowo otwartej karcie przejd藕 do `http://spanote.seccon.games:3000/`. Ta akcja buforuje odpowied藕 `http://spanote.seccon.games:3000/api/token` jako pami podrczn dysku.
4. U偶yj `history.back()`, aby wr贸ci. Akcja ta skutkuje renderowaniem buforowanej odpowiedzi JSON na stronie.

Weryfikacj, 偶e pami podrczna dysku zostaa wykorzystana, mo偶na potwierdzi za pomoc DevTools w Google Chrome.

Aby uzyska wicej informacji na temat bfcache i pamici podrcznej dysku, odniesienia mo偶na znale藕 na [web.dev o bfcache](https://web.dev/i18n/en/bfcache/) oraz [dokumentach projektowych Chromium na temat pamici podrcznej dysku](https://www.chromium.org/developers/design-documents/network-stack/disk-cache/), odpowiednio.


{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>
{% endhint %}
