# Chromeç¼“å­˜åˆ°XSS

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æƒ³è¦è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTæ”¶è—å“The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

ä»[**è¿™ç¯‡æ–‡ç« **](https://blog.arkark.dev/2022/11/18/seccon-en/#web-spanote)ä¸­è·å–çš„æŠ€æœ¯ã€‚

æœ‰ä¸¤ç§é‡è¦çš„ç¼“å­˜ç±»å‹ï¼š

* **åé€€/å‰è¿›ç¼“å­˜ï¼ˆbfcacheï¼‰**
* å‚è€ƒ[https://web.dev/i18n/en/bfcache/](https://web.dev/i18n/en/bfcache/)
* å®ƒå­˜å‚¨äº†é¡µé¢çš„å®Œæ•´å¿«ç…§ï¼Œ**åŒ…æ‹¬JavaScriptå †**ã€‚
* ç¼“å­˜ç”¨äºåé€€/å‰è¿›å¯¼èˆªã€‚
* å®ƒä¼˜å…ˆäºç£ç›˜ç¼“å­˜ã€‚
* **ç£ç›˜ç¼“å­˜**
* å‚è€ƒ[https://www.chromium.org/developers/design-documents/network-stack/disk-cache/](https://www.chromium.org/developers/design-documents/network-stack/disk-cache/)
* å®ƒå­˜å‚¨äº†ä»ç½‘ç»œè·å–çš„èµ„æºã€‚ç¼“å­˜**ä¸åŒ…æ‹¬JavaScriptå †**ã€‚
* ç¼“å­˜ä¹Ÿç”¨äºåé€€/å‰è¿›å¯¼èˆªä»¥è·³è¿‡é€šä¿¡æˆæœ¬ã€‚

ä½œä¸ºç£ç›˜ç¼“å­˜çš„ä¸€ä¸ªæœ‰è¶£ç‚¹ï¼Œ**ç¼“å­˜åŒ…æ‹¬**ä¸ä»…æ˜¯æ¸²æŸ“åˆ°ç½‘é¡µçš„HTTPå“åº”ï¼Œè¿˜åŒ…æ‹¬**ä½¿ç”¨`fetch`è·å–çš„å“åº”**ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ è®¿é—®äº†ä¸€ä¸ªå·²è·å–çš„èµ„æºçš„URLï¼Œ**æµè§ˆå™¨å°†åœ¨é¡µé¢ä¸Šæ¸²æŸ“è¯¥èµ„æº**ã€‚

è¿˜æœ‰å¦ä¸€ä¸ªé‡è¦çš„ç‚¹ã€‚å¦‚æœåé€€/å‰è¿›å¯¼èˆªæ—¶è®¿é—®çš„é¡µé¢åŒæ—¶åœ¨ç£ç›˜ç¼“å­˜å’Œbfcacheä¸­éƒ½æœ‰æ•ˆï¼Œ**bfcacheä¼˜å…ˆäºç£ç›˜ç¼“å­˜**ã€‚å› æ­¤ï¼Œå¦‚æœä½ éœ€è¦è®¿é—®åŒæ—¶å­˜å‚¨åœ¨ä¸¤ä¸ªç¼“å­˜ä¸­çš„é¡µé¢ï¼Œä½†æƒ³è¦ä½¿ç”¨ç£ç›˜ç¼“å­˜ä¸­çš„é¡µé¢ï¼Œä½ éœ€è¦ä»¥æŸç§æ–¹å¼**ç¦ç”¨bfcache**ã€‚

### ç¦ç”¨bfcache

puppeteerçš„[é»˜è®¤é€‰é¡¹](https://github.com/puppeteer/puppeteer/blob/v19.2.0/packages/puppeteer-core/src/node/ChromeLauncher.ts#L175)ä¼šç¦ç”¨bfcacheã€‚

è®©æˆ‘ä»¬åœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­å°è¯•è¿™ä¸ªæœ‰è¶£çš„è¡Œä¸ºã€‚

é¦–å…ˆï¼Œä½ éœ€è¦ç¦ç”¨bfcache[\[2\]](https://blog.arkark.dev/2022/11/18/seccon-en/#fn2)ã€‚æœ‰å¾ˆå¤šæƒ…å†µä¸‹bfcacheä¼šè¢«ç¦ç”¨ï¼Œåˆ—è¡¨å¦‚ä¸‹ï¼š

* [https://source.chromium.org/chromium/chromium/src/+/main:out/mac-Debug/gen/third\_party/blink/renderer/core/inspector/protocol/page.cc?q=BackForwardCacheNotRestoredReasonEnum \&ss=chromium](https://source.chromium.org/chromium/chromium/src/+/main:out/mac-Debug/gen/third\_party/blink/renderer/core/inspector/protocol/page.cc?q=BackForwardCacheNotRestoredReasonEnum%20\&ss=chromium)

ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨`RelatedActiveContentsExist`ã€‚

* `RelatedActiveContentsExist`ï¼šä½¿ç”¨`window.open()`æ‰“å¼€çš„é¡µé¢ï¼Œå¹¶ä¸”å®ƒå¼•ç”¨äº†`window.opener`ã€‚
* å‚è€ƒ[https://web.dev/i18n/en/bfcache/#avoid-windowopener-references](https://web.dev/i18n/en/bfcache/#avoid-windowopener-references)

å› æ­¤ï¼Œä»¥ä¸‹æ­¥éª¤å¯ä»¥é‡ç°è¿™ä¸ªè¡Œä¸ºï¼š

1. è®¿é—®ä¸€ä¸ªç½‘é¡µï¼ˆä¾‹å¦‚`https://example.com`ï¼‰
2. æ‰§è¡Œ`open("http://spanote.seccon.games:3000/api/token")`
* ![](https://blog.arkark.dev/images/2022/20221118-seccon-spanote-04.png)
* æœåŠ¡å™¨è¿”å›500çŠ¶æ€ç çš„å“åº”ã€‚
3. åœ¨æ‰“å¼€çš„æ ‡ç­¾ä¸­è®¿é—®`http://spanote.seccon.games:3000/`
* ![](https://blog.arkark.dev/images/2022/20221118-seccon-spanote-05.png)
* ç„¶åï¼Œ`http://spanote.seccon.games:3000/api/token`çš„å“åº”è¢«ç¼“å­˜ä¸ºç£ç›˜ç¼“å­˜ã€‚
4. æ‰§è¡Œ`history.back()`
* ![](https://blog.arkark.dev/images/2022/20221118-seccon-spanote-06.png)
* ç¼“å­˜çš„JSONå“åº”åœ¨é¡µé¢ä¸Šå‘ˆç°ï¼

ä½ å¯ä»¥ä½¿ç”¨Google Chromeçš„DevToolsç¡®è®¤ä½¿ç”¨äº†ç£ç›˜ç¼“å­˜ï¼š\
![](https://blog.arkark.dev/images/2022/20221118-seccon-spanote-07.png)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æƒ³è¦è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTæ”¶è—å“The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [ğŸ’¬](https://emojipedia.org/speech-balloon/) [Discord ç¾¤ç»„](https://discord.gg/hRep4RUj7f) æˆ– [Telegram ç¾¤ç»„](https://t.me/peass) æˆ–åœ¨ Twitter ä¸Š **å…³æ³¨æˆ‘** [ğŸ¦](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[@carlospolopm](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘** [hacktricks ä»“åº“](https://github.com/carlospolop/hacktricks) **å’Œ** [hacktricks-cloud ä»“åº“](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
