# Chrome Cache to XSS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

M√°s detalles [**en este informe**](https://blog.arkark.dev/2022/11/18/seccon-en/#web-spanote).

La t√©cnica discutida aqu√≠ implica entender el comportamiento e interacci√≥n de dos tipos principales de cach√©: la **cach√© de retroceso/avance (bfcache)** y la **cach√© de disco**. La bfcache, que almacena una instant√°nea completa de una p√°gina incluyendo el mont√≥n de JavaScript, tiene prioridad sobre la cach√© de disco para las navegaciones de retroceso/avance debido a su capacidad para almacenar una instant√°nea m√°s completa. La cach√© de disco, en contraste, almacena recursos obtenidos de la web sin incluir el mont√≥n de JavaScript, y se utiliza para las navegaciones de retroceso/avance para reducir los costos de comunicaci√≥n. Un aspecto interesante de la cach√© de disco es su inclusi√≥n de recursos obtenidos usando `fetch`, lo que significa que los recursos de URL accedidos ser√°n renderizados por el navegador desde la cach√©.

### Puntos Clave:

- La **bfcache** tiene precedencia sobre la cach√© de disco en las navegaciones de retroceso/avance.
- Para utilizar una p√°gina almacenada en la cach√© de disco en lugar de la bfcache, esta √∫ltima debe ser desactivada.

### Desactivando bfcache:

Por defecto, Puppeteer desactiva bfcache, aline√°ndose con las condiciones listadas en la documentaci√≥n de Chromium. Un m√©todo efectivo para desactivar bfcache es a trav√©s del uso de `RelatedActiveContentsExist`, logrado al abrir una p√°gina con `window.open()` que retiene una referencia a `window.opener`.

### Reproduciendo el comportamiento:

1. Visita una p√°gina web, por ejemplo, `https://example.com`.
2. Ejecuta `open("http://spanote.seccon.games:3000/api/token")`, lo que resulta en una respuesta del servidor con un c√≥digo de estado 500.
3. En la nueva pesta√±a abierta, navega a `http://spanote.seccon.games:3000/`. Esta acci√≥n almacena en cach√© la respuesta de `http://spanote.seccon.games:3000/api/token` como una cach√© de disco.
4. Usa `history.back()` para navegar hacia atr√°s. La acci√≥n resulta en la renderizaci√≥n de la respuesta JSON almacenada en cach√© en la p√°gina.

La verificaci√≥n de que se utiliz√≥ la cach√© de disco se puede confirmar a trav√©s del uso de DevTools en Google Chrome.

Para m√°s detalles sobre bfcache y cach√© de disco, se pueden encontrar referencias en [web.dev sobre bfcache](https://web.dev/i18n/en/bfcache/) y [documentos de dise√±o de Chromium sobre cach√© de disco](https://www.chromium.org/developers/design-documents/network-stack/disk-cache/), respectivamente.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
