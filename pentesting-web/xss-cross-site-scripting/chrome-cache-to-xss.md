# Chrome Cache to XSS

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

More in depth details [**in this writeup**](https://blog.arkark.dev/2022/11/18/seccon-en/#web-spanote).

ã“ã“ã§è­°è«–ã•ã‚Œã¦ã„ã‚‹æŠ€è¡“ã¯ã€2ã¤ã®ä¸»è¦ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚¤ãƒ—ã€**ãƒãƒƒã‚¯/ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (bfcache)** ã¨ **ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥** ã®å‹•ä½œã¨ç›¸äº’ä½œç”¨ã‚’ç†è§£ã™ã‚‹ã“ã¨ã‚’å«ã¿ã¾ã™ã€‚bfcacheã¯ã€JavaScriptãƒ’ãƒ¼ãƒ—ã‚’å«ã‚€ãƒšãƒ¼ã‚¸ã®å®Œå…¨ãªã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä¿å­˜ã—ã€ã‚ˆã‚ŠåŒ…æ‹¬çš„ãªã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä¿å­˜ã§ãã‚‹ãŸã‚ã€ãƒãƒƒã‚¯/ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®éš›ã«ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ˆã‚Šã‚‚å„ªå…ˆã•ã‚Œã¾ã™ã€‚ä¸€æ–¹ã€ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ã€JavaScriptãƒ’ãƒ¼ãƒ—ã‚’å«ã¾ãšã«ã‚¦ã‚§ãƒ–ã‹ã‚‰å–å¾—ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’ä¿å­˜ã—ã€é€šä¿¡ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã™ã‚‹ãŸã‚ã«ãƒãƒƒã‚¯/ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®èˆˆå‘³æ·±ã„ç‚¹ã¯ã€`fetch`ã‚’ä½¿ç”¨ã—ã¦å–å¾—ã—ãŸãƒªã‚½ãƒ¼ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã‚ã‚Šã€ã¤ã¾ã‚Šã‚¢ã‚¯ã‚»ã‚¹ã•ã‚ŒãŸURLãƒªã‚½ãƒ¼ã‚¹ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã£ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

### Key Points:

- **bfcache**ã¯ãƒãƒƒã‚¯/ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ˆã‚Šã‚‚å„ªå…ˆã•ã‚Œã¾ã™ã€‚
- bfcacheã®ä»£ã‚ã‚Šã«ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€bfcacheã‚’ç„¡åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### Disabling bfcache:

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€Puppeteerã¯bfcacheã‚’ç„¡åŠ¹ã«ã—ã€Chromiumã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚ŒãŸæ¡ä»¶ã«æ²¿ã£ã¦ã„ã¾ã™ã€‚bfcacheã‚’ç„¡åŠ¹ã«ã™ã‚‹åŠ¹æœçš„ãªæ–¹æ³•ã®1ã¤ã¯ã€`window.open()`ã‚’ä½¿ç”¨ã—ã¦`window.opener`ã¸ã®å‚ç…§ã‚’ä¿æŒã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’é–‹ãã“ã¨ã«ã‚ˆã£ã¦ã€`RelatedActiveContentsExist`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚

### Reproducing the behavior:

1. ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚ä¾‹: `https://example.com`ã€‚
2. `open("http://spanote.seccon.games:3000/api/token")`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€500ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã‚µãƒ¼ãƒãƒ¼å¿œç­”ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚
3. æ–°ã—ãé–‹ã„ãŸã‚¿ãƒ–ã§ã€`http://spanote.seccon.games:3000/`ã«ç§»å‹•ã—ã¾ã™ã€‚ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šã€`http://spanote.seccon.games:3000/api/token`ã®å¿œç­”ãŒãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚
4. `history.back()`ã‚’ä½¿ç”¨ã—ã¦æˆ»ã‚Šã¾ã™ã€‚ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šã€ãƒšãƒ¼ã‚¸ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸJSONå¿œç­”ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåˆ©ç”¨ã•ã‚ŒãŸã“ã¨ã®ç¢ºèªã¯ã€Google Chromeã®DevToolsã‚’ä½¿ç”¨ã—ã¦ç¢ºèªã§ãã¾ã™ã€‚

bfcacheã¨ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«é–¢ã™ã‚‹ã•ã‚‰ãªã‚‹è©³ç´°ã¯ã€[web.dev on bfcache](https://web.dev/i18n/en/bfcache/)ãŠã‚ˆã³[Chromiumã®ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«é–¢ã™ã‚‹è¨­è¨ˆæ–‡æ›¸](https://www.chromium.org/developers/design-documents/network-stack/disk-cache/)ã§å‚ç…§ã§ãã¾ã™ã€‚

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
