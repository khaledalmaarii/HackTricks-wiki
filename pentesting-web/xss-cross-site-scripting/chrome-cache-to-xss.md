# Chrome Cache to XSS

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

Mehr detaillierte Informationen [**in diesem Bericht**](https://blog.arkark.dev/2022/11/18/seccon-en/#web-spanote).

Die hier diskutierte Technik beinhaltet das Verst√§ndnis des Verhaltens und der Interaktion von zwei prim√§ren Cache-Typen: dem **back/forward cache (bfcache)** und dem **Disk-Cache**. Der bfcache, der einen vollst√§ndigen Snapshot einer Seite einschlie√ülich des JavaScript-Heaps speichert, hat Vorrang vor dem Disk-Cache bei R√ºckw√§rts-/Vorw√§rtsnavigationen aufgrund seiner F√§higkeit, einen umfassenderen Snapshot zu speichern. Der Disk-Cache hingegen speichert Ressourcen, die aus dem Web abgerufen wurden, ohne den JavaScript-Heap einzuschlie√üen, und wird f√ºr R√ºckw√§rts-/Vorw√§rtsnavigationen verwendet, um Kommunikationskosten zu reduzieren. Ein interessanter Aspekt des Disk-Caches ist seine Einbeziehung von Ressourcen, die mit `fetch` abgerufen wurden, was bedeutet, dass aufgerufene URL-Ressourcen vom Browser aus dem Cache gerendert werden.

### Wichtige Punkte:

- Der **bfcache** hat Vorrang vor dem Disk-Cache bei R√ºckw√§rts-/Vorw√§rtsnavigationen.
- Um eine Seite, die im Disk-Cache gespeichert ist, anstelle des bfcache zu nutzen, muss letzterer deaktiviert werden.

### Deaktivierung des bfcache:

Standardm√§√üig deaktiviert Puppeteer den bfcache, was mit den in der Chromium-Dokumentation aufgef√ºhrten Bedingungen √ºbereinstimmt. Eine effektive Methode zur Deaktivierung des bfcache ist die Verwendung von `RelatedActiveContentsExist`, die erreicht wird, indem eine Seite mit `window.open()` ge√∂ffnet wird, die eine Referenz zu `window.opener` beibeh√§lt.

### Verhalten reproduzieren:

1. Besuche eine Webseite, z.B. `https://example.com`.
2. F√ºhre `open("http://spanote.seccon.games:3000/api/token")` aus, was zu einer Serverantwort mit einem 500-Statuscode f√ºhrt.
3. Navigiere im neu ge√∂ffneten Tab zu `http://spanote.seccon.games:3000/`. Diese Aktion cached die Antwort von `http://spanote.seccon.games:3000/api/token` als Disk-Cache.
4. Verwende `history.back()`, um zur√ºck zu navigieren. Die Aktion f√ºhrt dazu, dass die zwischengespeicherte JSON-Antwort auf der Seite gerendert wird.

Die √úberpr√ºfung, dass der Disk-Cache verwendet wurde, kann durch die Verwendung von DevTools in Google Chrome best√§tigt werden.

F√ºr weitere Details zu bfcache und Disk-Cache k√∂nnen Referenzen auf [web.dev zu bfcache](https://web.dev/i18n/en/bfcache/) und [Chromiums Entwurfsdokumente zum Disk-Cache](https://www.chromium.org/developers/design-documents/network-stack/disk-cache/) gefunden werden.


{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
