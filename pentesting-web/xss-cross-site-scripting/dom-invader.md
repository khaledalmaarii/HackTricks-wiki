# DOM Invader

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

## DOM Invader

DOM Invader to narzdzie przegldarkowe zainstalowane w wbudowanej przegldarce Burp. Pomaga w **wykrywaniu podatnoci DOM XSS** przy u偶yciu r贸偶nych 藕r贸de i zlew贸w, w tym wiadomoci internetowych i zanieczyszczenia prototypu. Narzdzie jest wstpnie zainstalowane jako rozszerzenie.

DOM Invader integruje zakadk w panelu DevTools przegldarki, umo偶liwiajc:

1. **Identyfikacj kontrolowanych zlew贸w** na stronie internetowej do testowania DOM XSS, dostarczajc kontekst i szczeg贸y sanitizacji.
2. **Rejestrowanie, edytowanie i ponowne wysyanie wiadomoci internetowych** wysyanych za pomoc metody `postMessage()` do testowania DOM XSS. DOM Invader mo偶e r贸wnie偶 automatycznie wykrywa podatnoci przy u偶yciu specjalnie przygotowanych wiadomoci internetowych.
3. Wykrywanie **藕r贸de zanieczyszczenia prototypu po stronie klienta** i skanowanie kontrolowanych gad偶et贸w wysyanych do ryzykownych zlew贸w.
4. Identyfikacj **podatnoci DOM clobbering**.

### Wcz to

W wbudowanej przegldarce Burp przejd藕 do **rozszerzenia Burp** i wcz je:

<figure><img src="../../.gitbook/assets/image (1129).png" alt=""><figcaption></figcaption></figure>

Teraz odwie偶 stron, a w **Dev Tools** znajdziesz **zakadk DOM Invader:**

<figure><img src="../../.gitbook/assets/image (695).png" alt=""><figcaption></figcaption></figure>

### Wstrzyknij Canary

Na poprzednim obrazku mo偶esz zobaczy **losow grup znak贸w, to jest Canary**. Teraz powiniene zacz **wstrzykiwa** go w r贸偶nych czciach sieci (parametry, formularze, url...) i za ka偶dym razem klikn wyszukiwanie. DOM Invader sprawdzi, czy **canary trafi do jakiegokolwiek interesujcego zlewu**, kt贸ry m贸gby by wykorzystany.

Ponadto opcje **Wstrzyknij parametry URL** i Wstrzyknij formularze automatycznie otworz **now zakadk**, **wstrzykujc** **canary** w ka偶dy **parametr URL** i **formularz**, kt贸ry znajd.

### Wstrzyknij pusty Canary

Jeli chcesz tylko znale藕 potencjalne zlewy, kt贸re strona mo偶e mie, nawet jeli nie s wykorzystywalne, mo偶esz **wyszukiwa pusty canary**.

### Wiadomoci Post

DOM Invader umo偶liwia testowanie DOM XSS przy u偶yciu wiadomoci internetowych z takimi funkcjami jak:

1. **Rejestrowanie wiadomoci internetowych** wysyanych za pomoc `postMessage()`, podobnie jak rejestrowanie historii 偶da/odpowiedzi HTTP w Burp Proxy.
2. **Modyfikacja** i **ponowne wydanie** wiadomoci internetowych w celu rcznego testowania DOM XSS, podobnie jak funkcja Burp Repeater.
3. **Automatyczna zmiana** i wysyanie wiadomoci internetowych w celu badania DOM XSS.

#### Szczeg贸y wiadomoci

Szczeg贸owe informacje o ka偶dej wiadomoci mo偶na zobaczy, klikajc na ni, co obejmuje, czy JavaScript po stronie klienta uzyskuje dostp do waciwoci `origin`, `data` lub `source` wiadomoci.

* **`origin`** : Jeli **informacje o pochodzeniu wiadomoci nie s sprawdzane**, mo偶esz by w stanie wysya wiadomoci midzy 藕r贸dami do obsugi zdarze **z dowolnej zewntrznej domeny**. Ale jeli jest to sprawdzane, nadal mo偶e by niebezpieczne.
* **`data`**: To tutaj wysyany jest adunek. Jeli te dane nie s u偶ywane, zlew jest bezu偶yteczny.
* **`source`**: Ocena, czy waciwo 藕r贸da, zazwyczaj odnoszca si do iframe, jest weryfikowana zamiast pochodzenia. Nawet jeli to jest sprawdzane, nie zapewnia to, 偶e weryfikacja nie mo偶e by obejrzana.

#### Odpowiedz na wiadomo

1. Z widoku **Wiadomoci** kliknij dowoln wiadomo, aby otworzy okno szczeg贸贸w wiadomoci.
2. Edytuj pole **Dane** wedug potrzeb.
3. Kliknij **Wylij**.

### Zanieczyszczenie prototypu

DOM Invader mo偶e r贸wnie偶 wyszukiwa **podatnoci zanieczyszczenia prototypu**. Najpierw musisz to wczy:

<figure><img src="../../.gitbook/assets/image (1026).png" alt=""><figcaption></figcaption></figure>

Nastpnie **bdzie wyszukiwa 藕r贸da**, kt贸re umo偶liwiaj dodawanie dowolnych waciwoci do **`Object.prototype`**.

Jeli co zostanie znalezione, pojawi si przycisk **Test**, aby **przetestowa znalezione 藕r贸do**. Kliknij na niego, pojawi si nowa zakadka, utw贸rz obiekt w konsoli i sprawd藕, czy `testproperty` istnieje:
```javascript
let b = {}
b.testproperty
```
Once you found a source you can **scan for a gadget**:

1. Nowa karta jest otwierana przez DOM Invader, gdy klikniesz przycisk **Scan for gadgets**, kt贸ry znajduje si obok ka偶dego zidentyfikowanego 藕r贸da zanieczyszczenia prototypu w widoku **DOM**. Rozpoczyna si skanowanie w poszukiwaniu odpowiednich gad偶et贸w.
2. W midzyczasie w tej samej karcie powinien by otwarty zakadka **DOM Invader** w panelu DevTools. Po zakoczeniu skanowania, wszelkie zlewy dostpne za porednictwem zidentyfikowanych gad偶et贸w s wywietlane w widoku **DOM**. Na przykad, waciwo gad偶etu o nazwie `html` przekazywana do zlewu `innerHTML` jest pokazana w poni偶szym przykadzie.

## DOM clobbering

Na poprzednim obrazie mo偶na zobaczy, 偶e skanowanie DOM clobbering mo偶na wczy. Po wczeniu, **DOM Invader zacznie szuka podatnoci na DOM clobbering**.

## References

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
