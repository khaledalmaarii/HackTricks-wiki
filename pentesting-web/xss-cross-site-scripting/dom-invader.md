# DOMå…¥ä¾µè€…

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ YouTube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## DOMå…¥ä¾µè€…

DOMå…¥ä¾µè€…æ˜¯å®‰è£…åœ¨Burpå†…ç½®æµè§ˆå™¨ä¸­çš„æµè§ˆå™¨å·¥å…·ã€‚å®ƒä½¿ç”¨å„ç§æºå’Œæ¥æ”¶å™¨ï¼ˆåŒ…æ‹¬Webæ¶ˆæ¯å’ŒåŸå‹æ±¡æŸ“ï¼‰æ¥å¸®åŠ©**æ£€æµ‹DOM XSSæ¼æ´**ã€‚è¯¥å·¥å…·ä½œä¸ºæ‰©å±•é¢„å®‰è£…ã€‚

DOMå…¥ä¾µè€…åœ¨æµè§ˆå™¨çš„DevToolsé¢æ¿ä¸­é›†æˆäº†ä¸€ä¸ªé€‰é¡¹å¡ï¼Œå¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

1. è¯†åˆ«ç½‘é¡µä¸Šçš„**å¯æ§æ¥æ”¶å™¨**ï¼Œç”¨äºDOM XSSæµ‹è¯•ï¼Œå¹¶æä¾›ä¸Šä¸‹æ–‡å’Œæ¸…ç†è¯¦ç»†ä¿¡æ¯ã€‚
2. è®°å½•ã€ç¼–è¾‘å’Œé‡æ–°å‘é€é€šè¿‡`postMessage()`æ–¹æ³•å‘é€çš„Webæ¶ˆæ¯ï¼Œç”¨äºDOM XSSæµ‹è¯•ã€‚DOMå…¥ä¾µè€…è¿˜å¯ä»¥ä½¿ç”¨ç‰¹åˆ¶çš„Webæ¶ˆæ¯è‡ªåŠ¨æ£€æµ‹æ¼æ´ã€‚
3. æ£€æµ‹**å®¢æˆ·ç«¯åŸå‹æ±¡æŸ“**æºï¼Œå¹¶æ‰«æå‘é€åˆ°é£é™©æ¥æ”¶å™¨çš„å¯æ§å°å·¥å…·ã€‚
4. è¯†åˆ«**DOMè¦†ç›–æ¼æ´**ã€‚

### å¯ç”¨DOMå…¥ä¾µè€…

åœ¨Burpçš„å†…ç½®æµè§ˆå™¨ä¸­ï¼Œè½¬åˆ°**Burpæ‰©å±•**å¹¶å¯ç”¨å®ƒï¼š

<figure><img src="../../.gitbook/assets/image (4) (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

ç°åœ¨åˆ·æ–°é¡µé¢ï¼Œåœ¨**Dev Tools**ä¸­ï¼Œæ‚¨å°†æ‰¾åˆ°**DOMå…¥ä¾µè€…é€‰é¡¹å¡**ï¼š

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### æ³¨å…¥ä¸€ä¸ªCanary

åœ¨ä¸Šä¸€å¼ å›¾ç‰‡ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸€ä¸ª**éšæœºå­—ç¬¦ç»„ï¼Œå³Canary**ã€‚ç°åœ¨ï¼Œæ‚¨åº”è¯¥å¼€å§‹åœ¨Webçš„ä¸åŒéƒ¨åˆ†ï¼ˆå‚æ•°ã€è¡¨å•ã€URLç­‰ï¼‰ä¸­**æ³¨å…¥**å®ƒï¼Œå¹¶æ¯æ¬¡ç‚¹å‡»æœç´¢ã€‚DOMå…¥ä¾µè€…å°†æ£€æŸ¥**Canaryæ˜¯å¦å‡ºç°åœ¨ä»»ä½•æœ‰è¶£çš„æ¥æ”¶å™¨**ä¸­ï¼Œè¿™äº›æ¥æ”¶å™¨å¯èƒ½ä¼šè¢«åˆ©ç”¨ã€‚

æ­¤å¤–ï¼Œé€‰é¡¹**æ³¨å…¥URLå‚æ•°**å’Œ**æ³¨å…¥è¡¨å•**å°†è‡ªåŠ¨æ‰“å¼€ä¸€ä¸ª**æ–°æ ‡ç­¾é¡µ**ï¼Œåœ¨æ¯ä¸ª**URLå‚æ•°**å’Œ**è¡¨å•**ä¸­**æ³¨å…¥Canary**ã€‚

### æ³¨å…¥ä¸€ä¸ªç©ºçš„Canary

å¦‚æœæ‚¨åªæƒ³æ‰¾åˆ°é¡µé¢å¯èƒ½å…·æœ‰çš„æ½œåœ¨æ¥æ”¶å™¨ï¼Œå³ä½¿å®ƒä»¬ä¸èƒ½è¢«åˆ©ç”¨ï¼Œæ‚¨ä¹Ÿå¯ä»¥**æœç´¢ä¸€ä¸ªç©ºçš„Canary**ã€‚

### å‘é€æ¶ˆæ¯

DOMå…¥ä¾µè€…å…è®¸ä½¿ç”¨Webæ¶ˆæ¯è¿›è¡ŒDOM XSSæµ‹è¯•ï¼Œå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š

1. è®°å½•é€šè¿‡`postMessage()`å‘é€çš„Webæ¶ˆæ¯ï¼Œç±»ä¼¼äºBurp Proxyçš„HTTPè¯·æ±‚/å“åº”å†å²è®°å½•ã€‚
2. ä¿®æ”¹å’Œé‡æ–°å‘é€Webæ¶ˆæ¯ï¼Œä»¥æ‰‹åŠ¨æµ‹è¯•DOM XSSï¼Œç±»ä¼¼äºBurp Repeaterçš„åŠŸèƒ½ã€‚
3. è‡ªåŠ¨ä¿®æ”¹å’Œå‘é€Webæ¶ˆæ¯ä»¥æ¢æµ‹DOM XSSã€‚

#### æ¶ˆæ¯è¯¦æƒ…

æ‚¨å¯ä»¥å•å‡»æ¯æ¡æ¶ˆæ¯ä»¥æŸ¥çœ‹æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯JavaScriptæ˜¯å¦è®¿é—®äº†æ¶ˆæ¯çš„`origin`ã€`data`æˆ–`source`å±æ€§ã€‚

* **`origin`**ï¼šå¦‚æœæœªæ£€æŸ¥æ¶ˆæ¯çš„**æ¥æºä¿¡æ¯**ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿå‘äº‹ä»¶å¤„ç†ç¨‹åº**ä»ä»»æ„å¤–éƒ¨åŸŸ**å‘é€è·¨åŸŸæ¶ˆæ¯ã€‚ä½†å¦‚æœæ£€æŸ¥äº†å®ƒï¼Œä»ç„¶å¯èƒ½å­˜åœ¨ä¸å®‰å…¨æ€§ã€‚
* **`data`**ï¼šè¿™æ˜¯è´Ÿè½½å‘é€çš„ä½ç½®ã€‚å¦‚æœæœªä½¿ç”¨æ­¤æ•°æ®ï¼Œåˆ™æ¥æ”¶å™¨æ— ç”¨ã€‚
* **`source`**ï¼šè¯„ä¼°æºå±æ€§æ˜¯å¦ç»è¿‡éªŒè¯ï¼Œé€šå¸¸å¼•ç”¨ä¸€ä¸ªiframeï¼Œè€Œä¸æ˜¯æ¥æºã€‚å³ä½¿è¿›è¡Œäº†æ£€æŸ¥ï¼Œä¹Ÿä¸èƒ½ä¿è¯éªŒè¯æ— æ³•ç»•è¿‡ã€‚

#### å›å¤æ¶ˆæ¯

1. ä»**æ¶ˆæ¯**è§†å›¾ä¸­ï¼Œå•å‡»ä»»ä½•æ¶ˆæ¯ä»¥æ‰“å¼€æ¶ˆæ¯è¯¦ç»†ä¿¡æ¯å¯¹è¯æ¡†ã€‚
2. æ ¹æ®éœ€è¦ç¼–è¾‘**Data**å­—æ®µã€‚
3. å•å‡»**å‘é€**ã€‚

### åŸå‹æ±¡æŸ“

DOMå…¥ä¾µè€…è¿˜å¯ä»¥æœç´¢**åŸå‹æ±¡æŸ“æ¼æ´**ã€‚é¦–å…ˆï¼Œæ‚¨éœ€è¦å¯ç”¨å®ƒï¼š

<figure><img src="../../.gitbook/assets/image (5) (1) (1).png" alt=""><figcaption></figcaption></figure>

ç„¶åï¼Œå®ƒå°†**æœç´¢æº**ï¼Œä½¿æ‚¨èƒ½å¤Ÿå‘**`Object.prototype`**æ·»åŠ ä»»æ„å±æ€§ã€‚

å¦‚æœæ‰¾åˆ°ä»»ä½•å†…å®¹ï¼Œå°†å‡ºç°ä¸€ä¸ª**æµ‹è¯•**æŒ‰é’®ï¼Œç”¨äº**æµ‹è¯•æ‰¾åˆ°çš„æº**ã€‚å•å‡»å®ƒï¼Œå°†å‡ºç°ä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µï¼Œåœ¨æ§åˆ¶å°ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶æ£€æŸ¥`testproperty`æ˜¯å¦å­˜åœ¨ï¼š
```javascript
let b = {}
b.testproperty
```
ä¸€æ—¦æ‰¾åˆ°æºä»£ç ï¼Œæ‚¨å¯ä»¥**æ‰«æå°å·¥å…·**ï¼š

1. ä»**DOM**è§†å›¾ä¸­ï¼Œå•å‡»DOM Invaderæ‰¾åˆ°çš„ä»»ä½•åŸå‹æ±¡æŸ“æºæ—è¾¹çš„**æ‰«æå°å·¥å…·**æŒ‰é’®ã€‚DOM Invaderå°†æ‰“å¼€ä¸€ä¸ªæ–°æ ‡ç­¾é¡µå¹¶å¼€å§‹æ‰«æé€‚åˆçš„å°å·¥å…·ã€‚
2. åœ¨åŒä¸€ä¸ªæ ‡ç­¾é¡µä¸­ï¼Œåœ¨DevToolsé¢æ¿ä¸­æ‰“å¼€**DOM Invader**é€‰é¡¹å¡ã€‚æ‰«æå®Œæˆåï¼Œ**DOM**è§†å›¾å°†æ˜¾ç¤ºDOM Invaderé€šè¿‡è¯†åˆ«çš„å°å·¥å…·èƒ½å¤Ÿè®¿é—®çš„ä»»ä½•æ¼æ´ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä¸€ä¸ªåä¸º`html`çš„å°å·¥å…·å±æ€§è¢«ä¼ é€’ç»™äº†`innerHTML`æ¼æ´ã€‚

## DOMè¦†ç›–

åœ¨ä¸Šé¢çš„å›¾åƒä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¯ä»¥æ‰“å¼€DOMè¦†ç›–æ‰«æã€‚ä¸€æ—¦å®Œæˆï¼Œ**DOM Invaderå°†å¼€å§‹æœç´¢DOMè¦†ç›–æ¼æ´**ã€‚

## å‚è€ƒèµ„æ–™

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—æœ€æ–°ç‰ˆæœ¬çš„PEASSæˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTrickså—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTæ”¶è—å“](https://opensea.io/collection/the-peass-family)â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
