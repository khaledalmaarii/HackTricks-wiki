# DOM Invader

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

## DOM Invader

DOM Invader √© uma ferramenta de navegador instalada no navegador embutido do Burp. Ela auxilia na **detec√ß√£o de vulnerabilidades DOM XSS** usando v√°rias fontes e sinks, incluindo mensagens da web e polui√ß√£o de prot√≥tipos. A ferramenta √© pr√©-instalada como uma extens√£o.

DOM Invader integra uma aba dentro do painel DevTools do navegador, permitindo o seguinte:

1. **Identifica√ß√£o de sinks control√°veis** em uma p√°gina da web para testes de DOM XSS, fornecendo detalhes de contexto e sanitiza√ß√£o.
2. **Registro, edi√ß√£o e reenvio de mensagens da web** enviadas via o m√©todo `postMessage()` para testes de DOM XSS. O DOM Invader tamb√©m pode detectar automaticamente vulnerabilidades usando mensagens da web especialmente elaboradas.
3. Detec√ß√£o de **fontes de polui√ß√£o de prot√≥tipos do lado do cliente** e varredura de gadgets control√°veis enviados para sinks arriscados.
4. Identifica√ß√£o de **vulnerabilidades de clobbering DOM**.

### Ative-o

No navegador embutido do Burp, v√° para a **extens√£o Burp** e ative-a:

<figure><img src="../../.gitbook/assets/image (1129).png" alt=""><figcaption></figcaption></figure>

Agora, atualize a p√°gina e nas **Dev Tools** voc√™ encontrar√° a **aba DOM Invader:**

<figure><img src="../../.gitbook/assets/image (695).png" alt=""><figcaption></figcaption></figure>

### Injete um Canary

Na imagem anterior, voc√™ pode ver um **grupo aleat√≥rio de caracteres, que √© o Canary**. Voc√™ deve agora come√ßar a **injet√°-lo** em diferentes partes da web (par√¢metros, formul√°rios, url...) e cada vez clicar para pesquis√°-lo. O DOM Invader verificar√° se o **canary terminou em algum sink interessante** que poderia ser explorado.

Al√©m disso, as op√ß√µes **Injetar par√¢metros de URL** e Injetar formul√°rios abrir√£o automaticamente uma **nova aba** **injetando** o **canary** em cada **par√¢metro de URL** e **formul√°rio** que encontrar.

### Injete um Canary vazio

Se voc√™ apenas quiser encontrar sinks potenciais que a p√°gina possa ter, mesmo que n√£o sejam explor√°veis, voc√™ pode **procurar por um canary vazio**.

### Mensagens Post

O DOM Invader permite testar DOM XSS usando mensagens da web com recursos como:

1. **Registro de mensagens da web** enviadas via `postMessage()`, semelhante ao registro de hist√≥rico de requisi√ß√µes/respostas HTTP do Burp Proxy.
2. **Modifica√ß√£o** e **reemiss√£o** de mensagens da web para testar manualmente DOM XSS, semelhante √† fun√ß√£o do Burp Repeater.
3. **Altera√ß√£o autom√°tica** e envio de mensagens da web para sondar DOM XSS.

#### Detalhes da mensagem

Informa√ß√µes detalhadas podem ser visualizadas sobre cada mensagem clicando nela, incluindo se o JavaScript do lado do cliente acessa as propriedades `origin`, `data` ou `source` da mensagem.

* **`origin`** : Se a **informa√ß√£o de origem da mensagem n√£o for verificada**, voc√™ pode ser capaz de enviar mensagens de origem cruzada para o manipulador de eventos **de um dom√≠nio externo arbitr√°rio**. Mas se for verificado, ainda pode ser inseguro.
* **`data`**: √â aqui que a carga √∫til √© enviada. Se esses dados n√£o forem usados, o sink √© in√∫til.
* **`source`**: Avalia se a propriedade source, geralmente referenciando um iframe, √© validada em vez da origem. Mesmo que isso seja verificado, n√£o garante que a valida√ß√£o n√£o possa ser contornada.

#### Responder a uma mensagem

1. Na visualiza√ß√£o **Mensagens**, clique em qualquer mensagem para abrir o di√°logo de detalhes da mensagem.
2. Edite o campo **Data** conforme necess√°rio.
3. Clique em **Enviar**.

### Polui√ß√£o de Prot√≥tipos

O DOM Invader tamb√©m pode procurar por **vulnerabilidades de Polui√ß√£o de Prot√≥tipos**. Primeiro, voc√™ precisa ativ√°-lo:

<figure><img src="../../.gitbook/assets/image (1026).png" alt=""><figcaption></figcaption></figure>

Em seguida, ele **procurar√° fontes** que permitem que voc√™ adicione propriedades arbitr√°rias ao **`Object.prototype`**.

Se algo for encontrado, um bot√£o **Testar** aparecer√° para **testar a fonte encontrada**. Clique nele, uma nova aba aparecer√°, crie um objeto no console e verifique se a `testproperty` existe:
```javascript
let b = {}
b.testproperty
```
Uma vez que voc√™ encontrou uma fonte, voc√™ pode **escanear por um gadget**:

1. Uma nova aba √© aberta pelo DOM Invader quando o bot√£o **Scan for gadgets**, que pode ser encontrado ao lado de qualquer fonte de polui√ß√£o de prot√≥tipo identificada na visualiza√ß√£o **DOM**, √© clicado. O escaneamento por gadgets adequados ent√£o come√ßa.
2. Enquanto isso, na mesma aba, a aba **DOM Invader** deve estar aberta no painel DevTools. Ap√≥s a conclus√£o do escaneamento, quaisquer sinks acess√≠veis via os gadgets identificados s√£o exibidos na visualiza√ß√£o **DOM**. Por exemplo, uma propriedade de gadget chamada `html` sendo passada para o sink `innerHTML` √© mostrada no exemplo abaixo.

## DOM clobbering

Na imagem anterior, √© poss√≠vel ver que a varredura de DOM clobbering pode ser ativada. Uma vez feito isso, **DOM Invader come√ßar√° a procurar por vulnerabilidades de DOM clobbering**.

## Refer√™ncias

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
