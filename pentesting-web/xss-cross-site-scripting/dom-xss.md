# DOM XSS

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## DOM-Schwachstellen

DOM-Schwachstellen treten auf, wenn Daten aus von Angreifern kontrollierten **Quellen** (wie `location.search`, `document.referrer` oder `document.cookie`) unsicher an **Senken** √ºbertragen werden. Senken sind Funktionen oder Objekte (z. B. `eval()`, `document.body.innerHTML`), die sch√§dlichen Inhalt ausf√ºhren oder rendern k√∂nnen, wenn sie mit b√∂sartigen Daten versorgt werden.

* **Quellen** sind Eingaben, die von Angreifern manipuliert werden k√∂nnen, einschlie√ülich URLs, Cookies und Webnachrichten.
* **Senken** sind potenziell gef√§hrliche Endpunkte, an denen b√∂sartige Daten zu nachteiligen Auswirkungen f√ºhren k√∂nnen, wie z. B. der Ausf√ºhrung von Skripten.

Das Risiko entsteht, wenn Daten ohne ordnungsgem√§√üe Validierung oder Sanit√§rung von einer Quelle zu einer Senke flie√üen, was Angriffe wie XSS erm√∂glicht.

{% hint style="info" %}
**Eine aktuellere Liste von Quellen und Senken finden Sie unter** [**https://github.com/wisec/domxsswiki/wiki**](https://github.com/wisec/domxsswiki/wiki)
{% endhint %}

**H√§ufige Quellen:**
```javascript
document.URL
document.documentURI
document.URLUnencoded
document.baseURI
location
document.cookie
document.referrer
window.name
history.pushState
history.replaceState
localStorage
sessionStorage
IndexedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB)
Database
```
**H√§ufige Senken:**

| [**Open Redirect**](dom-xss.md#open-redirect)                                    | [**Javascript Injection**](dom-xss.md#javascript-injection)                         | [**DOM-Datenmanipulation**](dom-xss.md#dom-data-manipulation) | **jQuery**                                                             |
| -------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------------------------- | ---------------------------------------------------------------------- |
| `location`                                                                       | `eval()`                                                                            | `scriptElement.src`                                           | `add()`                                                                |
| `location.host`                                                                  | `Function() Konstruktor`                                                            | `scriptElement.text`                                          | `after()`                                                              |
| `location.hostname`                                                              | `setTimeout()`                                                                      | `scriptElement.textContent`                                   | `append()`                                                             |
| `location.href`                                                                  | `setInterval()`                                                                     | `scriptElement.innerText`                                     | `animate()`                                                            |
| `location.pathname`                                                              | `setImmediate()`                                                                    | `someDOMElement.setAttribute()`                               | `insertAfter()`                                                        |
| `location.search`                                                                | `execCommand()`                                                                     | `someDOMElement.search`                                       | `insertBefore()`                                                       |
| `location.protocol`                                                              | `execScript()`                                                                      | `someDOMElement.text`                                         | `before()`                                                             |
| `location.assign()`                                                              | `msSetImmediate()`                                                                  | `someDOMElement.textContent`                                  | `html()`                                                               |
| `location.replace()`                                                             | `range.createContextualFragment()`                                                  | `someDOMElement.innerText`                                    | `prepend()`                                                            |
| `open()`                                                                         | `crypto.generateCRMFRequest()`                                                      | `someDOMElement.outerText`                                    | `replaceAll()`                                                         |
| `domElem.srcdoc`                                                                 | **\`\`**[**Manipulation des lokalen Dateipfads**](dom-xss.md#local-file-path-manipulation) | `someDOMElement.value`                                        | `replaceWith()`                                                        |
| `XMLHttpRequest.open()`                                                          | `FileReader.readAsArrayBuffer()`                                                    | `someDOMElement.name`                                         | `wrap()`                                                               |
| `XMLHttpRequest.send()`                                                          | `FileReader.readAsBinaryString()`                                                   | `someDOMElement.target`                                       | `wrapInner()`                                                          |
| `jQuery.ajax()`                                                                  | `FileReader.readAsDataURL()`                                                        | `someDOMElement.method`                                       | `wrapAll()`                                                            |
| `$.ajax()`                                                                       | `FileReader.readAsText()`                                                           | `someDOMElement.type`                                         | `has()`                                                                |
| **\`\`**[**Manipulation von Ajax-Anfragen**](dom-xss.md#ajax-request-manipulation)    | `FileReader.readAsFile()`                                                           | `someDOMElement.backgroundImage`                              | `constructor()`                                                        |
| `XMLHttpRequest.setRequestHeader()`                                              | `FileReader.root.getFile()`                                                         | `someDOMElement.cssText`                                      | `init()`                                                               |
| `XMLHttpRequest.open()`                                                          | `FileReader.root.getFile()`                                                         | `someDOMElement.codebase`                                     | `index()`                                                              |
| `XMLHttpRequest.send()`                                                          | [**Link-Manipulation**](dom-xss.md#link-manipulation)                               | `someDOMElement.innerHTML`                                    | `jQuery.parseHTML()`                                                   |
| `jQuery.globalEval()`                                                            | `someDOMElement.href`                                                               | `someDOMElement.outerHTML`                                    | `$.parseHTML()`                                                        |
| `$.globalEval()`                                                                 | `someDOMElement.src`                                                                | `someDOMElement.insertAdjacentHTML`                           | [**Client-seitige JSON-Injection**](dom-xss.md#client-side-sql-injection) |
| **\`\`**[**Manipulation des HTML5-Speichers**](dom-xss.md#html-5-storage-manipulation) | `someDOMElement.action`                                                             | `someDOMElement.onevent`                                      | `JSON.parse()`                                                         |
| `sessionStorage.setItem()`                                                       | [**XPath-Injection**](dom-xss.md#xpath-injection)                                   | `document.write()`                                            | `jQuery.parseJSON()`                                                   |
| `localStorage.setItem()`                                                         | `document.evaluate()`                                                               | `document.writeln()`                                          | `$.parseJSON()`                                                        |
| **``**[**`Denial of Service`**](dom-xss.md#denial-of-service)**``**              | `someDOMElement.evaluate()`                                                         | `document.title`                                              | **\`\`**[**Cookie-Manipulation**](dom-xss.md#cookie-manipulation)      |
| `requestFileSystem()`                                                            | **\`\`**[**Manipulation der Dokumentdom√§ne**](dom-xss.md#document-domain-manipulation) | `document.implementation.createHTMLDocument()`                | `document.cookie`                                                      |
| `RegExp()`                                                                       | `document.domain`                                                                   | `history.pushState()`                                         | [**WebSocket-URL-Vergiftung**](dom-xss.md#websocket-url-poisoning)      |
| [**Client-seitige SQL-Injection**](dom-xss.md#client-side-sql-injection)            | [**Web-Nachrichten-Manipulation**](dom-xss.md#web-message-manipulation)                 | `history.replaceState()`                                      | `WebSocket`                                                            |
| `executeSql()`                                                                   | `postMessage()`                                                                     | \`\`                                                          | \`\`                                                                   |

Die **`innerHTML`** Senke akzeptiert in modernen Browsern keine `script`-Elemente, noch werden `svg onload`-Ereignisse ausgel√∂st. Das bedeutet, dass Sie alternative Elemente wie `img` oder `iframe` verwenden m√ºssen.

Diese Art von XSS ist wahrscheinlich die **schwierigste zu finden**, da Sie den JS-Code durchsuchen m√ºssen, um zu sehen, ob er **irgendein Objekt verwendet**, dessen **Wert Sie kontrollieren**, und in diesem Fall pr√ºfen, ob es **irgendeine M√∂glichkeit gibt, es zu missbrauchen**, um beliebigen JS auszuf√ºhren.

## Werkzeuge, um sie zu finden

* [https://github.com/mozilla/eslint-plugin-no-unsanitized](https://github.com/mozilla/eslint-plugin-no-unsanitized)
* Browsererweiterung, um jede Daten zu √ºberpr√ºfen, die eine potenzielle Senke erreicht: [https://github.com/kevin-mizu/domloggerpp](https://github.com/kevin-mizu/domloggerpp)

## Beispiele

### Open Redirect

Von: [https://portswigger.net/web-security/dom-based/open-redirection](https://portswigger.net/web-security/dom-based/open-redirection)

**Open Redirect-Schwachstellen im DOM** treten auf, wenn ein Skript Daten, die ein Angreifer kontrollieren kann, in eine Senke schreibt, die in der Lage ist, die Navigation √ºber Domains hinweg zu initiieren.

Es ist entscheidend zu verstehen, dass die Ausf√ºhrung beliebigen Codes, wie **`javascript:alert(1)`**, m√∂glich ist, wenn Sie die Kontrolle √ºber den Anfang der URL haben, wo die Umleitung erfolgt.

Senken:
```javascript
location
location.host
location.hostname
location.href
location.pathname
location.search
location.protocol
location.assign()
location.replace()
open()
domElem.srcdoc
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.ajax()
$.ajax()
```
### Cookie-Manipulation

Von: [https://portswigger.net/web-security/dom-based/cookie-manipulation](https://portswigger.net/web-security/dom-based/cookie-manipulation)

DOM-basierte Cookie-Manipulationsanf√§lligkeiten treten auf, wenn ein Skript Daten, die von einem Angreifer kontrolliert werden k√∂nnen, in den Wert eines Cookies einf√ºgt. Diese Anf√§lligkeit kann zu unerwartetem Verhalten der Webseite f√ºhren, wenn das Cookie innerhalb der Seite verwendet wird. Dar√ºber hinaus kann sie ausgenutzt werden, um einen Session-Fixation-Angriff durchzuf√ºhren, wenn das Cookie an der Verfolgung von Benutzersitzungen beteiligt ist. Der prim√§re Sink, der mit dieser Anf√§lligkeit verbunden ist, ist:

Sinks:
```javascript
document.cookie
```
### JavaScript-Injektion

Von: [https://portswigger.net/web-security/dom-based/javascript-injection](https://portswigger.net/web-security/dom-based/javascript-injection)

DOM-basierte JavaScript-Injektionsanf√§lligkeiten entstehen, wenn ein Skript Daten, die von einem Angreifer kontrolliert werden k√∂nnen, als JavaScript-Code ausf√ºhrt.

Sinks:
```javascript
eval()
Function() constructor
setTimeout()
setInterval()
setImmediate()
execCommand()
execScript()
msSetImmediate()
range.createContextualFragment()
crypto.generateCRMFRequest()
```
### Document-Domain-Manipulation

From: [https://portswigger.net/web-security/dom-based/document-domain-manipulation](https://portswigger.net/web-security/dom-based/document-domain-manipulation)

**Document-Domain-Manipulation-Schwachstellen** treten auf, wenn ein Skript die `document.domain`-Eigenschaft mit Daten festlegt, die ein Angreifer kontrollieren kann.

Die `document.domain`-Eigenschaft spielt eine **Schl√ºsselrolle** bei der **Durchsetzung** der **Same-Origin-Policy** durch Browser. Wenn zwei Seiten aus unterschiedlichen Urspr√ºngen ihre `document.domain` auf den **gleichen Wert** setzen, k√∂nnen sie ohne Einschr√§nkungen interagieren. Obwohl Browser bestimmte **Grenzen** f√ºr die Werte, die `document.domain` zugewiesen werden k√∂nnen, auferlegen und die Zuweisung von v√∂llig nicht verwandten Werten zum tats√§chlichen Seitenursprung verhindern, gibt es Ausnahmen. Typischerweise erlauben Browser die Verwendung von **Kind**- oder **Eltern-Domains**.

Sinks:
```javascript
document.domain
```
### WebSocket-URL-Poisoning

From: [https://portswigger.net/web-security/dom-based/websocket-url-poisoning](https://portswigger.net/web-security/dom-based/websocket-url-poisoning)

**WebSocket-URL-Poisoning** tritt auf, wenn ein Skript **kontrollierbare Daten als Ziel-URL** f√ºr eine WebSocket-Verbindung verwendet.

Sinks:

Der `WebSocket`-Konstruktor kann zu WebSocket-URL-Poisoning-Schwachstellen f√ºhren.

### Link-Manipulation

From: [https://portswigger.net/web-security/dom-based/link-manipulation](https://portswigger.net/web-security/dom-based/link-manipulation)

**DOM-basierte Link-Manipulationsschwachstellen** entstehen, wenn ein Skript **angreifer-kontrollierbare Daten an ein Navigationsziel** innerhalb der aktuellen Seite schreibt, wie z.B. einen klickbaren Link oder die Einreichungs-URL eines Formulars.

Sinks:
```javascript
someDOMElement.href
someDOMElement.src
someDOMElement.action
```
### Ajax-Anforderungsmanipulation

Von: [https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation](https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation)

**Schwachstellen bei der Manipulation von Ajax-Anfragen** entstehen, wenn ein Skript **angreiferkontrollierte Daten in eine Ajax-Anfrage schreibt**, die mit einem `XmlHttpRequest`-Objekt ausgegeben wird.

Sinks:
```javascript
XMLHttpRequest.setRequestHeader()
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.globalEval()
$.globalEval()
```
### Lokale Dateipfadmanipulation

From: [https://portswigger.net/web-security/dom-based/local-file-path-manipulation](https://portswigger.net/web-security/dom-based/local-file-path-manipulation)

**Schwachstellen bei der lokalen Dateipfadmanipulation** entstehen, wenn ein Skript **vom Angreifer kontrollierbare Daten an eine Datei-Verarbeitungs-API** als `filename`-Parameter √ºbergibt. Diese Schwachstelle kann von einem Angreifer ausgenutzt werden, um eine URL zu konstruieren, die, wenn sie von einem anderen Benutzer besucht wird, dazu f√ºhren k√∂nnte, dass **der Browser des Benutzers eine beliebige lokale Datei √∂ffnet oder schreibt**.

Sinks:
```javascript
FileReader.readAsArrayBuffer()
FileReader.readAsBinaryString()
FileReader.readAsDataURL()
FileReader.readAsText()
FileReader.readAsFile()
FileReader.root.getFile()
FileReader.root.getFile()
```
### Client-Side SQL-Injection

Von: [https://portswigger.net/web-security/dom-based/client-side-sql-injection](https://portswigger.net/web-security/dom-based/client-side-sql-injection)

**Client-side SQL-Injection-Schwachstellen** treten auf, wenn ein Skript **angreiferkontrollierte Daten auf unsichere Weise in eine clientseitige SQL-Abfrage einf√ºgt**.

Sinks:
```javascript
executeSql()
```
### HTML5-Speicher-Manipulation

From: [https://portswigger.net/web-security/dom-based/html5-storage-manipulation](https://portswigger.net/web-security/dom-based/html5-storage-manipulation)

**HTML5-Speicher-Manipulationsanf√§lligkeiten** entstehen, wenn ein Skript **angreiferkontrollierte Daten im HTML5-Speicher des Webbrowsers** (`localStorage` oder `sessionStorage`) **speichert**. W√§hrend diese Aktion an sich keine Sicherheitsanf√§lligkeit darstellt, wird sie problematisch, wenn die Anwendung anschlie√üend **die gespeicherten Daten liest und unsicher verarbeitet**. Dies k√∂nnte es einem Angreifer erm√∂glichen, den Speichermechanismus auszunutzen, um andere DOM-basierte Angriffe durchzuf√ºhren, wie z.B. Cross-Site-Scripting und JavaScript-Injection.

Sinks:
```javascript
sessionStorage.setItem()
localStorage.setItem()
```
### XPath-Injection

Von: [https://portswigger.net/web-security/dom-based/client-side-xpath-injection](https://portswigger.net/web-security/dom-based/client-side-xpath-injection)

**DOM-basierte XPath-Injektionsanf√§lligkeiten** treten auf, wenn ein Skript **angreiferkontrollierte Daten in eine XPath-Abfrage einf√ºgt**.

Sinks:
```javascript
document.evaluate()
someDOMElement.evaluate()
```
### Client-side JSON injection

From: [https://portswigger.net/web-security/dom-based/client-side-json-injection](https://portswigger.net/web-security/dom-based/client-side-json-injection)

**DOM-basierte JSON-Injektionsanf√§lligkeiten** treten auf, wenn ein Skript **von einem Angreifer kontrollierbare Daten in einen String einf√ºgt, der als JSON-Datenstruktur geparst und dann von der Anwendung verarbeitet wird**.

Sinks:
```javascript
JSON.parse()
jQuery.parseJSON()
$.parseJSON()
```
### Web-Nachrichtenmanipulation

From: [https://portswigger.net/web-security/dom-based/web-message-manipulation](https://portswigger.net/web-security/dom-based/web-message-manipulation)

**Web-Nachrichtenanf√§lligkeiten** entstehen, wenn ein Skript **angreiferkontrollierbare Daten als Web-Nachricht an ein anderes Dokument** innerhalb des Browsers sendet. Ein **Beispiel** f√ºr anf√§llige Web-Nachrichtenmanipulation findet sich in [PortSwiggers Web Security Academy](https://portswigger.net/web-security/dom-based/controlling-the-web-message-source).

Sinks:

Die `postMessage()`-Methode zum Senden von Web-Nachrichten kann zu Sicherheitsanf√§lligkeiten f√ºhren, wenn der Ereignislistener f√ºr den Empfang von Nachrichten die eingehenden Daten auf unsichere Weise verarbeitet.

### DOM-Datenmanipulation

From: [https://portswigger.net/web-security/dom-based/dom-data-manipulation](https://portswigger.net/web-security/dom-based/dom-data-manipulation)

**DOM-Datenmanipulationsanf√§lligkeiten** entstehen, wenn ein Skript **angreiferkontrollierbare Daten in ein Feld innerhalb des DOM** schreibt, das in der sichtbaren UI oder der clientseitigen Logik verwendet wird. Diese Sicherheitsanf√§lligkeit kann von einem Angreifer ausgenutzt werden, um eine URL zu konstruieren, die, wenn sie von einem anderen Benutzer besucht wird, das Erscheinungsbild oder Verhalten der clientseitigen UI √§ndern kann.

Sinks:
```javascript
scriptElement.src
scriptElement.text
scriptElement.textContent
scriptElement.innerText
someDOMElement.setAttribute()
someDOMElement.search
someDOMElement.text
someDOMElement.textContent
someDOMElement.innerText
someDOMElement.outerText
someDOMElement.value
someDOMElement.name
someDOMElement.target
someDOMElement.method
someDOMElement.type
someDOMElement.backgroundImage
someDOMElement.cssText
someDOMElement.codebase
document.title
document.implementation.createHTMLDocument()
history.pushState()
history.replaceState()
```
### Denial of Service

From: [https://portswigger.net/web-security/dom-based/denial-of-service](https://portswigger.net/web-security/dom-based/denial-of-service)

**DOM-basierte Denial-of-Service-Schwachstellen** treten auf, wenn ein Skript **angreiferkontrollierte Daten unsicher an eine problematische Plattform-API √ºbergibt**. Dazu geh√∂ren APIs, die, wenn sie aufgerufen werden, dazu f√ºhren k√∂nnen, dass der Computer des Benutzers **√ºberm√§√üige Mengen an CPU oder Speicherplatz** verbraucht. Solche Schwachstellen k√∂nnen erhebliche Nebenwirkungen haben, wie z.B. dass der Browser die Funktionalit√§t der Website einschr√§nkt, indem er Versuche, Daten in `localStorage` zu speichern, ablehnt oder besch√§ftigte Skripte beendet.

Sinks:
```javascript
requestFileSystem()
RegExp()
```
## Dom Clobbering

{% content-ref url="dom-clobbering.md" %}
[dom-clobbering.md](dom-clobbering.md)
{% endcontent-ref %}

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
