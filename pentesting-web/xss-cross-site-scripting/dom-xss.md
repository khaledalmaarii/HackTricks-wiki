# DOM XSS

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za sajber bezbednost**? ≈Ωelite li da vidite svoju **kompaniju reklamiranu na HackTricks**? ili ≈æelite pristup **najnovijoj verziji PEASS ili preuzimanje HackTricks u PDF formatu**? Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru≈æite se** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitteru** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repozitorijum**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repozitorijum**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## DOM Vulnerabilities

DOM ranjivosti se javljaju kada podaci iz izvora pod kontrolom napadaƒça (kao ≈°to su `location.search`, `document.referrer`, ili `document.cookie`) nesigurno dospevaju do **sinks**. Sinks su funkcije ili objekti (npr. `eval()`, `document.body.innerHTML`) koji mogu izvr≈°iti ili prikazati ≈°tetan sadr≈æaj ako im se dostave zlonamerni podaci.

* **Izvori** su ulazi koji mogu biti manipulisani od strane napadaƒça, ukljuƒçujuƒái URL-ove, kolaƒçiƒáe i web poruke.
* **Sinks** su potencijalno opasne taƒçke gde zlonamerni podaci mogu dovesti do ≈°tetnih efekata, kao ≈°to je izvr≈°avanje skripti.

Rizik se javlja kada podaci teku od izvora do sinka bez odgovarajuƒáe validacije ili sanitizacije, omoguƒáavajuƒái napade poput XSS.

{% hint style="info" %}
**Mo≈æete pronaƒái a≈æuriranu listu izvora i sinkova na** [**https://github.com/wisec/domxsswiki/wiki**](https://github.com/wisec/domxsswiki/wiki)
{% endhint %}

**Uobiƒçajeni izvori:**
```javascript
document.URL
document.documentURI
document.URLUnencoded
document.baseURI
location
document.cookie
document.referrer
window.name
history.pushState
history.replaceState
localStorage
sessionStorage
IndexedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB)
Database
```
**Uobiƒçajeni Sifovi:**

| [**Otvoreno Preusmeravanje**](dom-xss.md#open-redirect)                                    | [**Umetanje JavaScript-a**](dom-xss.md#javascript-injection)                         | [**Manipulacija DOM-podacima**](dom-xss.md#dom-data-manipulation) | **jQuery**                                                             |
| -------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------------------------- | ---------------------------------------------------------------------- |
| `location`                                                                       | `eval()`                                                                            | `scriptElement.src`                                           | `add()`                                                                |
| `location.host`                                                                  | `Function() constructor`                                                            | `scriptElement.text`                                          | `after()`                                                              |
| `location.hostname`                                                              | `setTimeout()`                                                                      | `scriptElement.textContent`                                   | `append()`                                                             |
| `location.href`                                                                  | `setInterval()`                                                                     | `scriptElement.innerText`                                     | `animate()`                                                            |
| `location.pathname`                                                              | `setImmediate()`                                                                    | `someDOMElement.setAttribute()`                               | `insertAfter()`                                                        |
| `location.search`                                                                | `execCommand()`                                                                     | `someDOMElement.search`                                       | `insertBefore()`                                                       |
| `location.protocol`                                                              | `execScript()`                                                                      | `someDOMElement.text`                                         | `before()`                                                             |
| `location.assign()`                                                              | `msSetImmediate()`                                                                  | `someDOMElement.textContent`                                  | `html()`                                                               |
| `location.replace()`                                                             | `range.createContextualFragment()`                                                  | `someDOMElement.innerText`                                    | `prepend()`                                                            |
| `open()`                                                                         | `crypto.generateCRMFRequest()`                                                      | `someDOMElement.outerText`                                    | `replaceAll()`                                                         |
| `domElem.srcdoc`                                                                 | **\`\`**[**Manipulacija Lokalnim Putanjama Datoteka**](dom-xss.md#local-file-path-manipulation) | `someDOMElement.value`                                        | `replaceWith()`                                                        |
| `XMLHttpRequest.open()`                                                          | `FileReader.readAsArrayBuffer()`                                                    | `someDOMElement.name`                                         | `wrap()`                                                               |
| `XMLHttpRequest.send()`                                                          | `FileReader.readAsBinaryString()`                                                   | `someDOMElement.target`                                       | `wrapInner()`                                                          |
| `jQuery.ajax()`                                                                  | `FileReader.readAsDataURL()`                                                        | `someDOMElement.method`                                       | `wrapAll()`                                                            |
| `$.ajax()`                                                                       | `FileReader.readAsText()`                                                           | `someDOMElement.type`                                         | `has()`                                                                |
| **\`\`**[**Manipulacija Ajax zahtevima**](dom-xss.md#ajax-request-manipulation)    | `FileReader.readAsFile()`                                                           | `someDOMElement.backgroundImage`                              | `constructor()`                                                        |
| `XMLHttpRequest.setRequestHeader()`                                              | `FileReader.root.getFile()`                                                         | `someDOMElement.cssText`                                      | `init()`                                                               |
| `XMLHttpRequest.open()`                                                          | `FileReader.root.getFile()`                                                         | `someDOMElement.codebase`                                     | `index()`                                                              |
| `XMLHttpRequest.send()`                                                          | [**Manipulacija Linkova**](dom-xss.md#link-manipulation)                               | `someDOMElement.innerHTML`                                    | `jQuery.parseHTML()`                                                   |
| `jQuery.globalEval()`                                                            | `someDOMElement.href`                                                               | `someDOMElement.outerHTML`                                    | `$.parseHTML()`                                                        |
| `$.globalEval()`                                                                 | `someDOMElement.src`                                                                | `someDOMElement.insertAdjacentHTML`                           | [**Umetanje JSON-a na Klijentskoj Strani**](dom-xss.md#client-side-sql-injection) |
| **\`\`**[**Manipulacija HTML5-skladi≈°tem**](dom-xss.md#html-5-storage-manipulation) | `someDOMElement.action`                                                             | `someDOMElement.onevent`                                      | `JSON.parse()`                                                         |
| `sessionStorage.setItem()`                                                       | [**XPath ubacivanje**](dom-xss.md#xpath-injection)                                   | `document.write()`                                            | `jQuery.parseJSON()`                                                   |
| `localStorage.setItem()`                                                         | `document.evaluate()`                                                               | `document.writeln()`                                          | `$.parseJSON()`                                                        |
| **``**[**`Odbijanje usluge`**](dom-xss.md#denial-of-service)**``**              | `someDOMElement.evaluate()`                                                         | `document.title`                                              | **\`\`**[**Manipulacija Kolaƒçiƒáima**](dom-xss.md#cookie-manipulation)      |
| `requestFileSystem()`                                                            | **\`\`**[**Manipulacija Dokument-Domenom**](dom-xss.md#document-domain-manipulation) | `document.implementation.createHTMLDocument()`                | `document.cookie`                                                      |
| `RegExp()`                                                                       | `document.domain`                                                                   | `history.pushState()`                                         | [**WebSocket-URL trovanje**](dom-xss.md#websocket-url-poisoning)      |
| [**Umetanje SQL-a na Klijentskoj Strani**](dom-xss.md#client-side-sql-injection)            | [**Manipulacija Web-porukama**](dom-xss.md#web-message-manipulation)                 | `history.replaceState()`                                      | `WebSocket`                                                            |
| `executeSql()`                                                                   | `postMessage()`                                                                     | \`\`                                                          | \`\`                                                                   |

**`innerHTML`** sif ne prihvata `script` elemente na bilo kom modernom pregledaƒçu, niti ƒáe se dogaƒëaji `svg onload` pokrenuti. To znaƒçi da ƒáete morati koristiti alternativne elemente poput `img` ili `iframe`.

Ovaj tip XSS-a je verovatno **najte≈æi za pronaƒái**, jer morate pogledati unutar JS koda, videti da li **koristi** bilo koji objekat ƒçiju **vrednost kontroli≈°ete**, i u tom sluƒçaju videti da li postoji **naƒçin da se zloupotrebi** kako bi se izvr≈°io proizvoljni JS.

## Alati za pronala≈æenje

* [https://github.com/mozilla/eslint-plugin-no-unsanitized](https://github.com/mozilla/eslint-plugin-no-unsanitized)
* Pro≈°irenje pregledaƒça za proveru svih podataka koji sti≈æu do potencijalnog sifa: [https://github.com/kevin-mizu/domloggerpp](https://github.com/kevin-mizu/domloggerpp)

## Primeri

### Otvoreno Preusmeravanje

Sa: [https://portswigger.net/web-security/dom-based/open-redirection](https://portswigger.net/web-security/dom-based/open-redirection)

**Ranjivosti otvorenog preusmeravanja u DOM-u** se javljaju kada skripta upisuje podatke, koje napadaƒç mo≈æe kontrolisati, u sif sposoban za pokretanje navigacije preko domena.

Va≈æno je razumeti da je izvr≈°avanje proizvoljnog koda, poput **`javascript:alert(1)`**, moguƒáe ako imate kontrolu nad poƒçetkom URL-a gde se preusmerenje de≈°ava.

Sifovi:
```javascript
location
location.host
location.hostname
location.href
location.pathname
location.search
location.protocol
location.assign()
location.replace()
open()
domElem.srcdoc
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.ajax()
$.ajax()
```
### Manipulacija kolaƒçiƒáa

Od: [https://portswigger.net/web-security/dom-based/cookie-manipulation](https://portswigger.net/web-security/dom-based/cookie-manipulation)

Ranjivosti manipulacije kolaƒçiƒáima zasnovane na DOM-u javljaju se kada skripta ukljuƒçuje podatke, koje napadaƒç mo≈æe kontrolisati, u vrednost kolaƒçiƒáa. Ova ranjivost mo≈æe dovesti do neoƒçekivanog pona≈°anja veb stranice ako se kolaƒçiƒá koristi unutar sajta. Dodatno, mo≈æe se iskoristiti za sprovoƒëenje napada fiksacije sesije ako je kolaƒçiƒá ukljuƒçen u praƒáenje korisniƒçkih sesija. Primarni izvor povezan sa ovom ranjivo≈°ƒáu je:

Izvori:
```javascript
document.cookie
```
### JavaScript Injekcija

Od: [https://portswigger.net/web-security/dom-based/javascript-injection](https://portswigger.net/web-security/dom-based/javascript-injection)

DOM-bazne ranjivosti JavaScript injekcije se stvaraju kada skripta pokreƒáe podatke, koje mo≈æe kontrolisati napadaƒç, kao JavaScript kod.

Sinks:
```javascript
eval()
Function() constructor
setTimeout()
setInterval()
setImmediate()
execCommand()
execScript()
msSetImmediate()
range.createContextualFragment()
crypto.generateCRMFRequest()
```
### Manipulacija dokument-domena

Sa: [https://portswigger.net/web-security/dom-based/document-domain-manipulation](https://portswigger.net/web-security/dom-based/document-domain-manipulation)

**Ranjivosti manipulacije dokument-domenom** se javljaju kada skripta postavlja svojstvo `document.domain` koristeƒái podatke koje napadaƒç mo≈æe kontrolisati.

Svojstvo `document.domain` igra **kljuƒçnu ulogu** u **sprovoƒëenju** **politike istog porekla** od strane pregledaƒça. Kada se dve stranice sa razliƒçitih porekla postave svoj `document.domain` na **istu vrednost**, mogu meƒëusobno da interaguju bez ograniƒçenja. Iako pregledaƒçi nameƒáu odreƒëena **ograniƒçenja** na vrednosti koje se mogu dodeliti `document.domain`, spreƒçavajuƒái dodelu potpuno nepovezanih vrednosti stvarnom poreklu stranice, postoje izuzeci. Obiƒçno, pregledaƒçi dozvoljavaju kori≈°ƒáenje **poddomena** ili **roditeljskih domena**.

Sinks:
```javascript
document.domain
```
### Trovanje WebSocket-URL-a

Od: [https://portswigger.net/web-security/dom-based/websocket-url-poisoning](https://portswigger.net/web-security/dom-based/websocket-url-poisoning)

**Trovanje WebSocket-URL-a** nastaje kada skripta koristi **kontrolisane podatke kao ciljni URL** za WebSocket konekciju.

Sinks:

Konstruktor `WebSocket` mo≈æe dovesti do ranjivosti trovanja WebSocket-URL-a.

### Manipulacija linkova

Od: [https://portswigger.net/web-security/dom-based/link-manipulation](https://portswigger.net/web-security/dom-based/link-manipulation)

**Ranjivosti manipulacije linkova zasnovane na DOM-u** nastaju kada skripta upisuje **podatke pod kontrolom napadaƒça ka navigacionom cilju** unutar trenutne stranice, kao ≈°to je klikabilni link ili URL za podno≈°enje forme.
```javascript
someDOMElement.href
someDOMElement.src
someDOMElement.action
```
### Manipulacija Ajax zahtevima

Od: [https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation](https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation)

**Ranjivosti manipulacije Ajax zahtevima** nastaju kada skripta upisuje **podatke koje kontrolira napadaƒç u Ajax zahtev** koji se izdaje koristeƒái objekat `XmlHttpRequest`.

Sinks:
```javascript
XMLHttpRequest.setRequestHeader()
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.globalEval()
$.globalEval()
```
### Manipulacija lokalnih putanja datoteka

Sa: [https://portswigger.net/web-security/dom-based/local-file-path-manipulation](https://portswigger.net/web-security/dom-based/local-file-path-manipulation)

**Ranjivosti manipulacije lokalnih putanja datoteka** nastaju kada skripta prosleƒëuje **podatke koje kontrolira napadaƒç API-ju za rukovanje datotekama** kao parametar `filename`. Ova ranjivost mo≈æe biti iskori≈°ƒáena od strane napadaƒça da konstrui≈°e URL koji, ako ga poseti drugi korisnik, mo≈æe dovesti do toga da **korisnikov pretra≈æivaƒç otvori ili upi≈°e proizvoljnu lokalnu datoteku**.

Sinks:
```javascript
FileReader.readAsArrayBuffer()
FileReader.readAsBinaryString()
FileReader.readAsDataURL()
FileReader.readAsText()
FileReader.readAsFile()
FileReader.root.getFile()
FileReader.root.getFile()
```
### Klijentska SQL injekcija

Od: [https://portswigger.net/web-security/dom-based/client-side-sql-injection](https://portswigger.net/web-security/dom-based/client-side-sql-injection)

**Klijentske SQL injekcione ranjivosti** se javljaju kada skripta ukljuƒçuje **podatke koje kontrolira napadaƒç u klijentski SQL upit na nesiguran naƒçin**.

Sinks:
```javascript
executeSql()
```
### Manipulacija HTML5 skladi≈°tem

Od: [https://portswigger.net/web-security/dom-based/html5-storage-manipulation](https://portswigger.net/web-security/dom-based/html5-storage-manipulation)

**Ranjivosti manipulacije HTML5 skladi≈°tem** nastaju kada skripta **sme≈°ta podatke koje napadaƒç mo≈æe kontrolisati u HTML5 skladi≈°te veb pregledaƒça** (`localStorage` ili `sessionStorage`). Iako ova radnja po sebi nije bezbednosna ranjivost, postaje problematiƒçna ako aplikacija zatim **ƒçita sme≈°tene podatke i obraƒëuje ih na nesiguran naƒçin**. To bi omoguƒáilo napadaƒçu da iskoristi mehanizam skladi≈°tenja za sprovoƒëenje drugih napada zasnovanih na DOM-u, poput skriptovanja preko skripte i ubacivanja JavaScript-a.

Sinks:
```javascript
sessionStorage.setItem()
localStorage.setItem()
```
### XPath ubrizgavanje

Od: [https://portswigger.net/web-security/dom-based/client-side-xpath-injection](https://portswigger.net/web-security/dom-based/client-side-xpath-injection)

**Vulnerabilnosti DOM bazirane na XPath ubrizgavanju** se javljaju kada skripta ukljuƒçuje **podatke koje napadaƒç mo≈æe kontrolisati u XPath upitu**.

Sinks:
```javascript
document.evaluate()
someDOMElement.evaluate()
```
### Klijentska JSON ubrizgavanje

Od: [https://portswigger.net/web-security/dom-based/client-side-json-injection](https://portswigger.net/web-security/dom-based/client-side-json-injection)

**DOM bazirane JSON-ubrizgavanje ranjivosti** se javljaju kada skripta ukljuƒçuje **podatke koje kontrolira napadaƒç u string koji se parsira kao JSON podatkovna struktura, a zatim obraƒëuje od strane aplikacije**.

Sinks:
```javascript
JSON.parse()
jQuery.parseJSON()
$.parseJSON()
```
### Manipulacija web-porukama

Od: [https://portswigger.net/web-security/dom-based/web-message-manipulation](https://portswigger.net/web-security/dom-based/web-message-manipulation)

**Ranjivosti web-poruka** nastaju kada skripta ≈°alje **podatke koje kontrolira napadaƒç kao web-poruku drugom dokumentu** unutar pregledaƒça. **Primer** ranjive manipulacije web-porukama mo≈æe se pronaƒái na [PortSwigger-ovoj Akademiji za bezbednost veb-a](https://portswigger.net/web-security/dom-based/controlling-the-web-message-source).

Sinks:

Metoda `postMessage()` za slanje web-poruka mo≈æe dovesti do ranjivosti ako slu≈°alac dogaƒëaja za primanje poruka obraƒëuje dolazne podatke na nesiguran naƒçin.

### Manipulacija DOM-podacima

Od: [https://portswigger.net/web-security/dom-based/dom-data-manipulation](https://portswigger.net/web-security/dom-based/dom-data-manipulation)

**Ranjivosti manipulacije DOM-podacima** nastaju kada skripta upisuje **podatke koje kontrolira napadaƒç u polje unutar DOM-a** koje se koristi u vidljivom korisniƒçkom interfejsu ili logici na strani klijenta. Ova ranjivost mo≈æe biti iskori≈°ƒáena od strane napadaƒça da konstrui≈°e URL koji, ako ga poseti drugi korisnik, mo≈æe promeniti izgled ili pona≈°anje korisniƒçkog interfejsa na strani klijenta.

Sinks:
```javascript
scriptElement.src
scriptElement.text
scriptElement.textContent
scriptElement.innerText
someDOMElement.setAttribute()
someDOMElement.search
someDOMElement.text
someDOMElement.textContent
someDOMElement.innerText
someDOMElement.outerText
someDOMElement.value
someDOMElement.name
someDOMElement.target
someDOMElement.method
someDOMElement.type
someDOMElement.backgroundImage
someDOMElement.cssText
someDOMElement.codebase
document.title
document.implementation.createHTMLDocument()
history.pushState()
history.replaceState()
```
### Odbijanje usluge

Sa: [https://portswigger.net/web-security/dom-based/denial-of-service](https://portswigger.net/web-security/dom-based/denial-of-service)

**DOM bazirane ranjivosti odbijanja usluge** se javljaju kada skripta nebezbedno prosleƒëuje **podatke koje napadaƒç mo≈æe kontrolisati ka problematiƒçnoj platformi API-ja**. To ukljuƒçuje API-je koji, kada se pozovu, mogu dovesti do toga da raƒçunar korisnika tro≈°i **prekomerne koliƒçine CPU-a ili prostora na disku**. Takve ranjivosti mogu imati znaƒçajne sporedne efekte, poput pregledaƒça koji ograniƒçava funkcionalnost veb sajta odbijanjem poku≈°aja ƒçuvanja podataka u `localStorage` ili prekidanja zauzetih skripti.

Sinks:
```javascript
requestFileSystem()
RegExp()
```
## Dom Clobbering

{% content-ref url="dom-clobbering.md" %}
[dom-clobbering.md](dom-clobbering.md)
{% endcontent-ref %}

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za sajber bezbednost**? ≈Ωelite li da vidite svoju **kompaniju reklamiranu na HackTricks**? ili ≈æelite pristup **najnovijoj verziji PEASS ili preuzimanje HackTricks u PDF formatu**? Proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru≈æite se** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitteru** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repozitorijum**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repozitorijum**](https://github.com/carlospolop/hacktricks-cloud).

</details>
