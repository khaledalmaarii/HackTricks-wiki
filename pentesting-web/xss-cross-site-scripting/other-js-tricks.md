# æ‚é¡¹JSæŠ€å·§å’Œç›¸å…³ä¿¡æ¯

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## Javascriptæ¨¡ç³Šæµ‹è¯•

### æœ‰æ•ˆçš„JSæ³¨é‡Šå­—ç¬¦
```javascript
//This is a 1 line comment
/* This is a multiline comment*/
#!This is a 1 line comment, but "#!" must to be at the beggining of the line
-->This is a 1 line comment, but "-->" must to be at the beggining of the line


for (let j = 0; j < 128; j++) {
for (let k = 0; k < 128; k++) {
for (let l = 0; l < 128; l++) {
if (j == 34 || k ==34 || l ==34)
continue;
if (j == 0x0a || k ==0x0a || l ==0x0a)
continue;
if (j == 0x0d || k ==0x0d || l ==0x0d)
continue;
if (j == 0x3c || k ==0x3c || l ==0x3c)
continue;
if (
(j == 47 && k == 47)
||(k == 47 && l == 47)
)
continue;
try {
var cmd = String.fromCharCode(j) + String.fromCharCode(k) + String.fromCharCode(l) + 'a.orange.ctf"';
eval(cmd);
} catch(e) {
var err = e.toString().split('\n')[0].split(':')[0];
if (err === 'SyntaxError' || err === "ReferenceError")
continue
err = e.toString().split('\n')[0]
}
console.log(err,cmd);
}
}
}
//From: https://balsn.tw/ctf_writeup/20191012-hitconctfquals/#bounty-pl33z

// From: Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (p. 43). Kindle Edition.
log=[];
for(let i=0;i<=0xff;i++){
for(let j=0;j<=0xfff;j++){
try {
eval(`${String.fromCodePoint(i,j)}%$Â£234$`)
log.push([i,j])
}catch(e){}
}
}
console.log(log)//[35,33],[47,47]
```
### æœ‰æ•ˆçš„JSæ¢è¡Œå­—ç¬¦

In JavaScript, there are several characters that can be used to represent a new line. These characters can be useful in certain situations, such as when trying to obfuscate code or bypass input filters. Here are some of the valid JS new line characters:

- `\n`: This is the most commonly used new line character in JavaScript. It represents a line feed.
- `\r`: This character represents a carriage return.
- `\u2028`: This is the Unicode character for line separator.
- `\u2029`: This is the Unicode character for paragraph separator.

When using these characters, it's important to keep in mind that different platforms and browsers may interpret them differently. Therefore, it's recommended to test the code on the target platform to ensure compatibility.

### æœ‰æ•ˆçš„JSæ¢è¡Œå­—ç¬¦

åœ¨JavaScriptä¸­ï¼Œæœ‰å‡ ä¸ªå­—ç¬¦å¯ä»¥ç”¨æ¥è¡¨ç¤ºæ¢è¡Œã€‚è¿™äº›å­—ç¬¦åœ¨æŸäº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚åœ¨å°è¯•æ··æ·†ä»£ç æˆ–ç»•è¿‡è¾“å…¥è¿‡æ»¤å™¨æ—¶ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰æ•ˆçš„JSæ¢è¡Œå­—ç¬¦ï¼š

- `\n`ï¼šè¿™æ˜¯JavaScriptä¸­æœ€å¸¸ç”¨çš„æ¢è¡Œå­—ç¬¦ã€‚å®ƒè¡¨ç¤ºæ¢è¡Œã€‚
- `\r`ï¼šè¿™ä¸ªå­—ç¬¦è¡¨ç¤ºå›è½¦ã€‚
- `\u2028`ï¼šè¿™æ˜¯è¡Œåˆ†éš”ç¬¦çš„Unicodeå­—ç¬¦ã€‚
- `\u2029`ï¼šè¿™æ˜¯æ®µè½åˆ†éš”ç¬¦çš„Unicodeå­—ç¬¦ã€‚

åœ¨ä½¿ç”¨è¿™äº›å­—ç¬¦æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸åŒçš„å¹³å°å’Œæµè§ˆå™¨å¯èƒ½ä¼šä»¥ä¸åŒçš„æ–¹å¼è§£é‡Šå®ƒä»¬ã€‚å› æ­¤ï¼Œå»ºè®®åœ¨ç›®æ ‡å¹³å°ä¸Šæµ‹è¯•ä»£ç ï¼Œä»¥ç¡®ä¿å…¼å®¹æ€§ã€‚
```javascript
//Javascript interpret as new line these chars:
String.fromCharCode(10) //0x0a
String.fromCharCode(13) //0x0d
String.fromCharCode(8232) //0xe2 0x80 0xa8
String.fromCharCode(8233) //0xe2 0x80 0xa8

for (let j = 0; j < 65536; j++) {
try {
var cmd = '"aaaaa";'+String.fromCharCode(j) + '-->a.orange.ctf"';
eval(cmd);
} catch(e) {
var err = e.toString().split('\n')[0].split(':')[0];
if (err === 'SyntaxError' || err === "ReferenceError")
continue;
err = e.toString().split('\n')[0]
}
console.log(`[${err}]`,j,cmd);
}
//From: https://balsn.tw/ctf_writeup/20191012-hitconctfquals/#bounty-pl33z
```
### å‡½æ•°è°ƒç”¨ä¸­çš„æœ‰æ•ˆJSç©ºæ ¼

In some cases, when trying to bypass filters or evade detection, it may be necessary to use valid JavaScript spaces in a function call. These spaces can help obfuscate the payload and make it more difficult for security measures to detect.

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸ºäº†ç»•è¿‡è¿‡æ»¤å™¨æˆ–è§„é¿æ£€æµ‹ï¼Œå¯èƒ½éœ€è¦åœ¨å‡½æ•°è°ƒç”¨ä¸­ä½¿ç”¨æœ‰æ•ˆçš„JavaScriptç©ºæ ¼ã€‚è¿™äº›ç©ºæ ¼å¯ä»¥å¸®åŠ©æ··æ·†æœ‰æ•ˆè½½è·ï¼Œä½¿å…¶æ›´éš¾è¢«å®‰å…¨æªæ–½æ£€æµ‹åˆ°ã€‚

Here are some examples of valid JavaScript spaces that can be used:

ä»¥ä¸‹æ˜¯ä¸€äº›å¯ä»¥ä½¿ç”¨çš„æœ‰æ•ˆJavaScriptç©ºæ ¼çš„ç¤ºä¾‹ï¼š

- **No-Break Space**: This is a non-breaking space character that can be used instead of a regular space. It can be represented by the Unicode character `\u00A0`.

  - **ä¸é—´æ–­ç©ºæ ¼**ï¼šè¿™æ˜¯ä¸€ä¸ªéé—´æ–­ç©ºæ ¼å­—ç¬¦ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£æ™®é€šç©ºæ ¼ã€‚å®ƒå¯ä»¥ç”¨Unicodeå­—ç¬¦`\u00A0`è¡¨ç¤ºã€‚

- **Zero-Width Space**: This is a non-printable character that has no width when displayed. It can be represented by the Unicode character `\u200B`.

  - **é›¶å®½åº¦ç©ºæ ¼**ï¼šè¿™æ˜¯ä¸€ä¸ªä¸å¯æ‰“å°çš„å­—ç¬¦ï¼Œåœ¨æ˜¾ç¤ºæ—¶æ²¡æœ‰å®½åº¦ã€‚å®ƒå¯ä»¥ç”¨Unicodeå­—ç¬¦`\u200B`è¡¨ç¤ºã€‚

- **Zero-Width Non-Joiner**: This is another non-printable character that has no width when displayed and is used to prevent the joining of two adjacent characters. It can be represented by the Unicode character `\u200C`.

  - **é›¶å®½åº¦éè¿æ¥ç¬¦**ï¼šè¿™æ˜¯å¦ä¸€ä¸ªä¸å¯æ‰“å°çš„å­—ç¬¦ï¼Œåœ¨æ˜¾ç¤ºæ—¶æ²¡æœ‰å®½åº¦ï¼Œå¹¶ä¸”ç”¨äºé˜²æ­¢ä¸¤ä¸ªç›¸é‚»å­—ç¬¦çš„è¿æ¥ã€‚å®ƒå¯ä»¥ç”¨Unicodeå­—ç¬¦`\u200C`è¡¨ç¤ºã€‚

By using these valid JavaScript spaces in a function call, you can add an extra layer of obfuscation to your payload and increase the chances of bypassing security measures.

é€šè¿‡åœ¨å‡½æ•°è°ƒç”¨ä¸­ä½¿ç”¨è¿™äº›æœ‰æ•ˆçš„JavaScriptç©ºæ ¼ï¼Œæ‚¨å¯ä»¥ä¸ºæœ‰æ•ˆè½½è·æ·»åŠ é¢å¤–çš„æ··æ·†å±‚ï¼Œå¹¶å¢åŠ ç»•è¿‡å®‰å…¨æªæ–½çš„æœºä¼šã€‚
```javascript
// Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (pp. 40-41). Kindle Edition.

// Check chars that can be put in between in func name and the ()
function x(){}

log=[];
for(let i=0;i<=0x10ffff;i++){
try {
eval(`x${String.fromCodePoint(i)}()`)
log.push(i)
}catch(e){}
}

console.log(log)v//9,10,11,12,13,32,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,813 232,8233,8239,8287,12288,65279
```
### **ç”Ÿæˆå­—ç¬¦ä¸²çš„æœ‰æ•ˆå­—ç¬¦**

The following characters can be used to generate strings in various contexts:

ä»¥ä¸‹å­—ç¬¦å¯ç”¨äºåœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ç”Ÿæˆå­—ç¬¦ä¸²ï¼š

- Alphanumeric characters (a-z, A-Z, 0-9)
- Special characters (!, @, #, $, %, ^, &, *, (, ), -, _, +, =, [, ], {, }, |, \, :, ;, ", ', <, >, ,, ., ?, /)
- Whitespace characters (space, tab, newline)
- Unicode characters

- å­—æ¯æ•°å­—å­—ç¬¦ï¼ˆa-zï¼ŒA-Zï¼Œ0-9ï¼‰
- ç‰¹æ®Šå­—ç¬¦ï¼ˆï¼ï¼Œ@ï¼Œ#ï¼Œ$ï¼Œ%ï¼Œ^ï¼Œ&ï¼Œ*ï¼Œï¼ˆï¼Œï¼‰ï¼Œ-ï¼Œ_ï¼Œ+ï¼Œ=ï¼Œ[ï¼Œ]ï¼Œ{ï¼Œ}ï¼Œ|ï¼Œ\ï¼Œ:ï¼Œ;ï¼Œ"ï¼Œ'ï¼Œ<ï¼Œ>ï¼Œï¼Œï¼Œ.ï¼Œï¼Ÿï¼Œ/ï¼‰
- ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œæ¢è¡Œç¬¦ï¼‰
- Unicodeå­—ç¬¦

These characters can be combined and manipulated to create strings that serve various purposes, such as injecting malicious code or bypassing input validation.

å¯ä»¥ç»„åˆå’Œæ“ä½œè¿™äº›å­—ç¬¦ï¼Œä»¥åˆ›å»ºç”¨äºæ³¨å…¥æ¶æ„ä»£ç æˆ–ç»•è¿‡è¾“å…¥éªŒè¯çš„å­—ç¬¦ä¸²ã€‚
```javascript
// Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (pp. 41-42). Kindle Edition.

// Check which pairs of chars can make something be a valid string
log=[];
for(let i=0;i<=0x10ffff;i++){
try {
eval(`${String.fromCodePoint(i)}%$Â£234${String.fromCodePoint(i)}`)
log.push(i)
}catch(e){}
}
console.log(log) //34,39,47,96
//single quote, quotes, backticks & // (regex)
```
### **Surrogate Pairs BFï¼ˆä»£ç†å¯¹æš´åŠ›ç ´è§£ï¼‰**

è¿™ç§æŠ€æœ¯å¯¹äºXSSæ¥è¯´å¹¶ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯å®ƒå¯ä»¥ç”¨äºç»•è¿‡WAFçš„ä¿æŠ¤ã€‚è¿™æ®µPythonä»£ç æ¥æ”¶ä¸¤ä¸ªå­—èŠ‚ä½œä¸ºè¾“å…¥ï¼Œå¹¶æœç´¢å…·æœ‰ç¬¬ä¸€ä¸ªå­—èŠ‚ä½œä¸ºé«˜ä»£ç†å¯¹çš„æœ€åä¸€ä¸ªå­—èŠ‚å’Œæœ€åä¸€ä¸ªå­—èŠ‚ä½œä¸ºä½ä»£ç†å¯¹çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„ä»£ç†å¯¹ã€‚
```python
def unicode(findHex):
for i in range(0,0xFFFFF):
H = hex(int(((i - 0x10000) / 0x400) + 0xD800))
h = chr(int(H[-2:],16))
L = hex(int(((i - 0x10000) % 0x400 + 0xDC00)))
l = chr(int(L[-2:],16))
if(h == findHex[0]) and (l == findHex[1]):
print(H.replace("0x","\\u")+L.replace("0x","\\u"))
```
æ›´å¤šä¿¡æ¯ï¼š

* [https://github.com/dreadlocked/ctf-writeups/blob/master/nn8ed/README.md](https://github.com/dreadlocked/ctf-writeups/blob/master/nn8ed/README.md)
* [https://mathiasbynens.be/notes/javascript-unicode](https://mathiasbynens.be/notes/javascript-unicode) [https://mathiasbynens.be/notes/javascript-encoding](https://mathiasbynens.be/notes/javascript-encoding)

### `javascript{}:`åè®®æ¨¡ç³Šæµ‹è¯•
```javascript
// Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (p. 34). Kindle Edition.
log=[];
let anchor = document.createElement('a');
for(let i=0;i<=0x10ffff;i++){
anchor.href = `javascript${String.fromCodePoint(i)}:`;
if(anchor.protocol === 'javascript:') {
log.push(i);
}
}
console.log(log)//9,10,13,58
// Note that you could BF also other possitions of the use of multiple chars

// Test one option
let anchor = document.createElement('a');
anchor.href = `javascript${String.fromCodePoint(58)}:alert(1337)`;
anchor.append('Click me')
document.body.append(anchor)

// Another way to test
<a href="&#12;javascript:alert(1337)">Test</a>
```
### URLæ¨¡ç³Šæµ‹è¯•

URLæ¨¡ç³Šæµ‹è¯•æ˜¯ä¸€ç§å¸¸ç”¨çš„Webåº”ç”¨ç¨‹åºæ¸—é€æµ‹è¯•æŠ€æœ¯ï¼Œç”¨äºå‘ç°å¯èƒ½å­˜åœ¨çš„æ¼æ´ã€‚é€šè¿‡å¯¹URLè¿›è¡Œæ¨¡ç³Šæµ‹è¯•ï¼Œå¯ä»¥å°è¯•å„ç§ä¸åŒçš„è¾“å…¥å’Œå‚æ•°ç»„åˆï¼Œä»¥å¯»æ‰¾å¯èƒ½å¯¼è‡´å®‰å…¨æ¼æ´çš„æƒ…å†µã€‚

URLæ¨¡ç³Šæµ‹è¯•çš„ç›®æ ‡æ˜¯å‘ç°åº”ç”¨ç¨‹åºä¸­çš„æ½œåœ¨æ¼æ´ï¼Œä¾‹å¦‚è·¯å¾„éå†ã€æ–‡ä»¶åŒ…å«ã€SQLæ³¨å…¥ç­‰ã€‚é€šè¿‡æ„é€ ç‰¹å®šçš„URLè¯·æ±‚ï¼Œå¯ä»¥è§¦å‘åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´ï¼Œå¹¶è·å–æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œæ¶æ„æ“ä½œã€‚

URLæ¨¡ç³Šæµ‹è¯•å¯ä»¥ä½¿ç”¨å„ç§å·¥å…·å’ŒæŠ€æœ¯æ¥å®ç°ã€‚å…¶ä¸­ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨å­—å…¸æ–‡ä»¶ï¼ŒåŒ…å«å„ç§å¯èƒ½çš„URLè·¯å¾„å’Œå‚æ•°ç»„åˆã€‚é€šè¿‡å°†è¿™äº›å­—å…¸æ–‡ä»¶ä¸ç›®æ ‡URLè¿›è¡Œç»„åˆï¼Œå¯ä»¥ç”Ÿæˆå¤§é‡çš„URLè¯·æ±‚ï¼Œä»¥ä¾¿è¿›è¡Œæµ‹è¯•ã€‚

URLæ¨¡ç³Šæµ‹è¯•çš„å…³é”®æ˜¯é€‰æ‹©åˆé€‚çš„å­—å…¸æ–‡ä»¶å’Œå‚æ•°ç»„åˆã€‚æ ¹æ®åº”ç”¨ç¨‹åºçš„ç‰¹ç‚¹å’Œå·²çŸ¥çš„æ¼æ´ç±»å‹ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„å­—å…¸æ–‡ä»¶å’Œå‚æ•°ç»„åˆæ¥è¿›è¡Œæµ‹è¯•ã€‚åŒæ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ¥åŠ å¿«æµ‹è¯•è¿‡ç¨‹ï¼Œå¹¶æä¾›æ›´å…¨é¢çš„æµ‹è¯•è¦†ç›–ã€‚

URLæ¨¡ç³Šæµ‹è¯•æ˜¯ä¸€é¡¹é‡è¦çš„æ¸—é€æµ‹è¯•æŠ€æœ¯ï¼Œå¯ä»¥å¸®åŠ©å‘ç°Webåº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ¼æ´ã€‚é€šè¿‡å¯¹URLè¿›è¡Œæ¨¡ç³Šæµ‹è¯•ï¼Œå¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ï¼Œå¹¶é˜²æ­¢æ½œåœ¨çš„æ”»å‡»ã€‚
```javascript
// Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (pp. 36-37). Kindle Edition.

// Before the protocol
a=document.createElement('a');
log=[];
for(let i=0;i<=0x10ffff;i++){
a.href = `${String.fromCodePoint(i)}https://hacktricks.xyz`;
if(a.hostname === 'hacktricks.xyz'){
log.push(i);
}
}
console.log(log) //0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32

// Between the slashes
a=document.createElement('a');
log=[];
for(let i=0;i<=0x10ffff;i++){
a.href = `/${String.fromCodePoint(i)}/hacktricks.xyz`;
if(a.hostname === 'hacktricks.xyz'){
log.push(i);
}
}
console.log(log) //9,10,13,47,92
```
### HTMLæ¨¡ç³Šæµ‹è¯•

HTMLæ¨¡ç³Šæµ‹è¯•æ˜¯ä¸€ç§æµ‹è¯•Webåº”ç”¨ç¨‹åºçš„æŠ€æœ¯ï¼Œæ—¨åœ¨å‘ç°å’Œåˆ©ç”¨HTMLä¸­çš„æ¼æ´ã€‚é€šè¿‡å‘è¾“å…¥å­—æ®µæ³¨å…¥æ¶æ„æˆ–å¼‚å¸¸æ•°æ®ï¼Œå¯ä»¥æ­ç¤ºæ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„HTMLæ¨¡ç³Šæµ‹è¯•æŠ€æœ¯ï¼š

- **æ ‡ç­¾é—­åˆæµ‹è¯•**ï¼šåœ¨è¾“å…¥å­—æ®µä¸­æ³¨å…¥ä¸å®Œæ•´çš„HTMLæ ‡ç­¾ï¼Œä»¥æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦æ­£ç¡®å¤„ç†æ ‡ç­¾é—­åˆã€‚ä¾‹å¦‚ï¼Œå°†`<script>`æ ‡ç­¾æ³¨å…¥ä¸º`<script>`æˆ–`<script></script>`ã€‚

- **å±æ€§æ³¨å…¥æµ‹è¯•**ï¼šåœ¨HTMLæ ‡ç­¾çš„å±æ€§ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œä»¥æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦æ­£ç¡®è¿‡æ»¤å’Œè½¬ä¹‰ç”¨æˆ·è¾“å…¥ã€‚ä¾‹å¦‚ï¼Œå°†`<img>`æ ‡ç­¾çš„`src`å±æ€§æ³¨å…¥ä¸º`" onerror="alert('XSS')" />`ã€‚

- **ç‰¹æ®Šå­—ç¬¦æµ‹è¯•**ï¼šåœ¨è¾“å…¥å­—æ®µä¸­æ³¨å…¥ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚å°–æ‹¬å·ã€å¼•å·å’Œæ–œæ ï¼Œä»¥æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦æ­£ç¡®å¤„ç†å’Œè½¬ä¹‰è¿™äº›å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œå°†`<`æ³¨å…¥ä¸º`&lt;`ã€‚

- **ç¼–ç ç»•è¿‡æµ‹è¯•**ï¼šå°è¯•ç»•è¿‡åº”ç”¨ç¨‹åºå¯¹ç‰¹æ®Šå­—ç¬¦çš„ç¼–ç å’Œè½¬ä¹‰æœºåˆ¶ï¼Œä»¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨åå…­è¿›åˆ¶ç¼–ç ç»•è¿‡`<`å­—ç¬¦çš„è¿‡æ»¤ã€‚

- **æ ‡ç­¾åµŒå¥—æµ‹è¯•**ï¼šåœ¨è¾“å…¥å­—æ®µä¸­åµŒå¥—HTMLæ ‡ç­¾ï¼Œä»¥æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦æ­£ç¡®å¤„ç†å’Œè§£æåµŒå¥—æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œå°†`<b>`æ ‡ç­¾åµŒå¥—åœ¨`<i>`æ ‡ç­¾å†…ã€‚

- **äº‹ä»¶å¤„ç†ç¨‹åºæµ‹è¯•**ï¼šåœ¨HTMLæ ‡ç­¾çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œä»¥æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦æ­£ç¡®è¿‡æ»¤å’Œå¤„ç†ç”¨æˆ·è¾“å…¥ã€‚ä¾‹å¦‚ï¼Œå°†`<img>`æ ‡ç­¾çš„`onerror`äº‹ä»¶æ³¨å…¥ä¸º`alert('XSS')`ã€‚

- **URLæ³¨å…¥æµ‹è¯•**ï¼šåœ¨URLå‚æ•°ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼Œä»¥æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦æ­£ç¡®å¤„ç†å’Œè§£æURLã€‚ä¾‹å¦‚ï¼Œå°†`<script>`æ ‡ç­¾æ³¨å…¥ä¸ºURLå‚æ•°çš„ä¸€éƒ¨åˆ†ã€‚

HTMLæ¨¡ç³Šæµ‹è¯•æ˜¯ä¸€ç§æœ‰ç”¨çš„æŠ€æœ¯ï¼Œå¯ä»¥å¸®åŠ©å‘ç°å’Œä¿®å¤Webåº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ¼æ´ï¼Œç‰¹åˆ«æ˜¯è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰æ¼æ´ã€‚
```javascript
// Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (p. 38). Kindle Edition.

// Fuzzing chars that can close an HTML comment

let log=[];
let div = document.createElement('div');
for(let i=0;i<=0x10ffff;i++){
div.innerHTML=`<!----${String.fromCodePoint(i)}><span></span>-->`;
if(div.querySelector('span')){
log.push(i);
}
}
console.log(log)//33,45,62
```
## **åˆ†æå±æ€§**

æ¥è‡ªPortswiggerçš„å·¥å…·**Hackability inspector**å¯ä»¥å¸®åŠ©**åˆ†æ**javascriptå¯¹è±¡çš„**å±æ€§**ã€‚æŸ¥çœ‹ï¼š[https://portswigger-labs.net/hackability/inspector/?input=x.contentWindow\&html=%3Ciframe%20src=//subdomain1.portswigger-labs.net%20id=x%3E](https://portswigger-labs.net/hackability/inspector/?input=x.contentWindow\&html=%3Ciframe%20src=//subdomain1.portswigger-labs.net%20id=x%3E)

## **.map jsæ–‡ä»¶**

* ä¸‹è½½.map jsæ–‡ä»¶çš„æŠ€å·§ï¼š[https://medium.com/@bitthebyte/javascript-for-bug-bounty-hunters-part-2-f82164917e7](https://medium.com/@bitthebyte/javascript-for-bug-bounty-hunters-part-2-f82164917e7)
* æ‚¨å¯ä»¥ä½¿ç”¨æ­¤å·¥å…·åˆ†æè¿™äº›æ–‡ä»¶ï¼š[https://github.com/paazmaya/shuji](https://github.com/paazmaya/shuji)

## "--" èµ‹å€¼

é€’å‡è¿ç®—ç¬¦`--`ä¹Ÿæ˜¯ä¸€ç§èµ‹å€¼æ“ä½œã€‚è¯¥è¿ç®—ç¬¦æ¥å—ä¸€ä¸ªå€¼ï¼Œç„¶åå°†å…¶é€’å‡ä¸€ã€‚å¦‚æœè¯¥å€¼ä¸æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå®ƒå°†è¢«è®¾ç½®ä¸º`NaN`ã€‚è¿™å¯ä»¥ç”¨æ¥**ä»ç¯å¢ƒä¸­åˆ é™¤å˜é‡çš„å†…å®¹**ã€‚

![](<../../.gitbook/assets/image (553).png>)

![](<../../.gitbook/assets/image (554).png>)

## å‡½æ•°æŠ€å·§

### .call å’Œ .apply

å‡½æ•°çš„**`.call`**æ–¹æ³•ç”¨äº**è¿è¡Œå‡½æ•°**ã€‚\
é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæœŸæœ›çš„**ç¬¬ä¸€ä¸ªå‚æ•°**æ˜¯**`this`çš„å€¼**ï¼Œå¦‚æœ**æ²¡æœ‰æä¾›**ï¼Œåˆ™è¯¥å€¼å°†ä¸º**`window`**ï¼ˆé™¤éä½¿ç”¨äº†**`strict mode`**ï¼‰ã€‚
```javascript
function test_call(){
console.log(this.value); //baz
}
new_this={value:"hey!"}
test_call.call(new_this);

// To pass more arguments, just pass then inside .call()
function test_call() {
console.log(arguments[0]); //"arg1"
console.log(arguments[1]); //"arg2"
console.log(this); //[object Window]
}
test_call.call(null, "arg1", "arg2")

// If you use the "use strict" directive "this" will be null instead of window:
function test_call() {
"use strict";
console.log(this); //null
}
test_call.call(null)

//The apply function is pretty much exactly the same as the call function with one important difference, you can supply an array of arguments in the second argument:
function test_apply() {
console.log(arguments[0]); //"arg1"
console.log(arguments[1]); //"arg2"
console.log(this); //[object Window]
}
test_apply.apply(null, ["arg1", "arg2"])
```
### ç®­å¤´å‡½æ•°

ç®­å¤´å‡½æ•°å…è®¸æ‚¨æ›´è½»æ¾åœ°åœ¨ä¸€è¡Œä¸­ç”Ÿæˆå‡½æ•°ï¼ˆå¦‚æœæ‚¨ç†è§£å®ƒä»¬çš„è¯ï¼‰
```javascript
// Traditional
function (a){ return a + 1; }
// Arrow forms
a => a + 100;
a => {a + 100};

// Traditional
function (a, b){ return a + b + 1; }
// Arrow
(a, b) => a + b + 100;

// Tradictional no args
let a = 4;
let b = 2;
function (){ return a + b + 1; }

// Arrow
let a = 4;
let b = 2;
() => a + b + 1;
```
æ‰€ä»¥ï¼Œå¤§å¤šæ•°ä¹‹å‰çš„å‡½æ•°å®é™…ä¸Šæ˜¯æ— ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å°†å®ƒä»¬ä¿å­˜èµ·æ¥ä»¥ä¾¿è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œåˆ›å»º`plusone`å‡½æ•°ï¼š
```javascript
// Traductional
function plusone (a){ return a + 1; }

//Arrow
plusone = a => a + 100;
```
### ç»‘å®šå‡½æ•°

ç»‘å®šå‡½æ•°å…è®¸åˆ›å»ºä¸€ä¸ª**ä¿®æ”¹äº†**`this`**å¯¹è±¡å’Œç»™å®šå‚æ•°çš„**å‡½æ•°**çš„**å‰¯æœ¬**ã€‚
```javascript
//This will use the this object and print "Hello World"
var fn = function ( param1, param2 ) {
console.info( this, param1, param2 );
}
fn('Hello', 'World')

//This will still use the this object and print "Hello World"
var copyFn = fn.bind();
copyFn('Hello', 'World')

//This will use the "console" object as "this" object inside the function and print "fixingparam1 Hello"
var bindFn_change = fn.bind(console, "fixingparam1");
bindFn_change('Hello', 'World')

//This will still use the this object and print "fixingparam1 Hello"
var bindFn_thisnull = fn.bind(null, "fixingparam1");
bindFn_change('Hello', 'World')

//This will still use the this object and print "fixingparam1 Hello"
var bindFn_this = fn.bind(this, "fixingparam1");
bindFn_change('Hello', 'World')
```
{% hint style="info" %}
è¯·æ³¨æ„ï¼Œä½¿ç”¨ **`bind`** å¯ä»¥æ“çºµåœ¨è°ƒç”¨å‡½æ•°æ—¶è¦ä½¿ç”¨çš„ **`this`** å¯¹è±¡ã€‚
{% endhint %}

### å‡½æ•°ä»£ç æ³„æ¼

å¦‚æœä½ å¯ä»¥**è®¿é—®å‡½æ•°çš„å¯¹è±¡**ï¼Œä½ å¯ä»¥**è·å–è¯¥å‡½æ•°çš„ä»£ç **ã€‚
```javascript
function afunc(){
return 1+1;
}
console.log(afunc.toString()); //This will print the code of the function
console.log(String(afunc)); //This will print the code of the function
console.log(this.afunc.toString()); //This will print the code of the function
console.log(global.afunc.toString()); //This will print the code of the function
```
åœ¨æ²¡æœ‰å‡½æ•°åç§°çš„æƒ…å†µä¸‹ï¼Œæ‚¨ä»ç„¶å¯ä»¥ä»å†…éƒ¨æ‰“å°å‡½æ•°ä»£ç ï¼š
```javascript
(function (){ return arguments.callee.toString(); })()
(function (){ return arguments[0]; })("arg0")
```
ä»¥ä¸‹æ˜¯ä»å¦ä¸€ä¸ªå‡½æ•°ä¸­æå–å‡½æ•°ä»£ç ï¼ˆåŒ…æ‹¬æ³¨é‡Šï¼‰çš„ä¸€äº›éšæœºæ–¹æ³•ï¼š

```javascript
1. ä½¿ç”¨`toString()`æ–¹æ³•ï¼š
```javascript
var functionCode = anotherFunction.toString();
```

2. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼š
```javascript
var functionCode = anotherFunction.toString().match(/function[^{]+\{([\s\S]*)\}$/)[1];
```

3. ä½¿ç”¨`Function.prototype.toString()`æ–¹æ³•ï¼š
```javascript
var functionCode = Function.prototype.toString.call(anotherFunction);
```

4. ä½¿ç”¨`new Function()`æ„é€ å‡½æ•°ï¼š
```javascript
var functionCode = new Function('', anotherFunction.toString());
```

è¯·æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•å¯èƒ½ä¼šå—åˆ°æµè§ˆå™¨çš„é™åˆ¶æˆ–å®‰å…¨ç­–ç•¥çš„å½±å“ã€‚
```javascript
(function (){ return retFunc => String(arguments[0]) })(a=>{/* Hidden commment */})()
(function (){ return retFunc => Array(arguments[0].toString()) })(a=>{/* Hidden commment */})()
(function (){ return String(this)}).bind(()=>{ /* Hidden commment */ })()
(u=>(String(u)))(_=>{ /* Hidden commment */ })
(u=>_=>(String(u)))(_=>{ /* Hidden commment */ })()
```
## é€ƒé€¸æ²™ç®± - æ¢å¤windowå¯¹è±¡

Windowå¯¹è±¡å…è®¸è®¿é—®å…¨å±€å®šä¹‰çš„å‡½æ•°ï¼Œå¦‚alertæˆ–evalã€‚

{% code overflow="wrap" %}
```javascript
// Some ways to access window
window.eval("alert(1)")
frames
globalThis
parent
self
top //If inside a frame, this is top most window

// Access window from document
document.defaultView.alert(1)
// Access document from a node object
node = document.createElement('div')
node.ownerDocument.defaultView.alert(1)

// There is a path property on each error event whose last element is the window
<img src onerror=event.path.pop().alert(1337)>
// In other browsers the method is
<img src onerror=event.composedPath().pop().alert(1337)>
// In case of svg, the "event" object is called "evt"
<svg><image href=1 onerror=evt.composedPath().pop().alert(1337)>

// Abusing Error.prepareStackTrace to get Window back
Error.prepareStackTrace=function(error, callSites){
2   callSites.shift().getThis().alert(1337);
3 };
4 new Error().stack

// From an HTML event
// Events from HTML are executed in this context
with(document) {
with(element) {
//executed event
}
}
// Because of that with(document) it's possible to access properties of document like:
<img src onerror=defaultView.alert(1337)>
<img src onerror=s=createElement('script');s.append('alert(1337)');appendChild(s)>
```
{% endcode %}

## åœ¨è®¿é—®å€¼æ—¶è®¾ç½®æ–­ç‚¹
```javascript
// Stop when a property in sessionStorage or localStorage is set/get
// via getItem or setItem functions
sessionStorage.getItem = localStorage.getItem  = function(prop) {
debugger;
return sessionStorage[prop];
}

localStorage.setItem = function(prop, val) {
debugger;
localStorage[prop] = val;
}
```

```javascript
// Stop when anyone sets or gets the property "ppmap" in any object
// For example sessionStorage.ppmap
// "123".ppmap
// Useful to find where weird properties are being set or accessed
// or to find where prototype pollutions are occurring

function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if ( debugGet )
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});
};

debugAccess(Object.prototype, 'ppmap')
```
## è‡ªåŠ¨æµè§ˆå™¨è®¿é—®ä»¥æµ‹è¯•æœ‰æ•ˆè½½è·

Sometimes, when testing for Cross-Site Scripting (XSS) vulnerabilities, it is necessary to automate the process of accessing a web page with a payload. This can be achieved using various methods, such as using a headless browser or a browser automation tool.

### Headless Browsers

Headless browsers are web browsers without a graphical user interface (GUI). They can be controlled programmatically to access web pages and execute JavaScript code. Some popular headless browsers include Puppeteer, PhantomJS, and Selenium WebDriver with headless mode enabled.

To automate browser access using a headless browser, you can write a script that navigates to the target web page and injects the XSS payload. The script can then capture any resulting behavior or responses from the web page.

### Browser Automation Tools

Browser automation tools, such as Selenium WebDriver, allow you to control web browsers programmatically. These tools provide APIs that enable you to interact with web pages, fill out forms, click buttons, and perform other actions.

To automate browser access using a browser automation tool, you can write a script that uses the tool's API to navigate to the target web page and inject the XSS payload. The script can then capture any resulting behavior or responses from the web page.

Automating browser access can save time and effort when testing for XSS vulnerabilities, as it eliminates the need for manual interaction with the web page. However, it is important to use these techniques responsibly and with proper authorization, as unauthorized access to websites can be illegal and unethical.
```javascript
//Taken from https://github.com/svennergr/writeups/blob/master/inti/0621/README.md
const puppeteer = require("puppeteer");

const realPasswordLength = 3000;
async function sleep(ms) {
return new Promise((resolve) => setTimeout(resolve, ms));
}

(async () => {
const browser = await puppeteer.launch();
const page = await browser.newPage();
//Loop to iterate through different values
for (let i = 0; i < 10000; i += 100) {
console.log(`Run number ${i}`);
const input = `${"0".repeat(i)}${realPasswordLength}`;
console.log(`  https://challenge-0621.intigriti.io/passgen.php?passwordLength=${input}&allowNumbers=true&allowSymbols=true&timestamp=1624556811000`);
//Go to the page
await page.goto(
`https://challenge-0621.intigriti.io/passgen.php?passwordLength=${input}&allowNumbers=true&allowSymbols=true&timestamp=1624556811000`
);
//Call function "generate()" inside the page
await page.evaluate("generate()");
//Get node inner text from an HTML element
const passwordContent = await page.$$eval(
".alert .page-content",
(node) => node[0].innerText
);
//Transform the content and print it in console
const plainPassword = passwordContent.replace("Your password is: ", "");
if (plainPassword.length != realPasswordLength) {
console.log(i, plainPassword.length, plainPassword);
}

await sleep(1000);
}
await browser.close();
})();
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**æ¨ç‰¹**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks)å’Œ[**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud)æäº¤ PR æ¥**åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
