# SOME - Izvr코avanje metoda iste domene

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Izvr코avanje metoda iste domene

Bi캖e prilika kada mo쬰te izvr코iti neki ograni캜eni javascript na stranici. Na primer, u slu캜aju kada mo쬰te[ **kontrolisati vrednost povratnog poziva koja 캖e biti izvr코ena**](./#javascript-function).

U tim slu캜ajevima, jedna od najboljih stvari koje mo쬰te u캜initi je da **pristupite DOM-u kako biste pozvali bilo koju** osetljivu akciju koju mo쬰te prona캖i (poput klika na dugme). Me캠utim, obi캜no 캖ete ovu ranjivost prona캖i u **malim krajnjim ta캜kama bez ikakvih zanimljivih stvari u DOM-u**.

U tim scenarijima, ovaj napad 캖e biti veoma koristan, jer je njegov cilj da bude u mogu캖nosti da **zloupotrebi ograni캜eno izvr코avanje JS unutar DOM-a sa razli캜ite stranice iz iste domene** sa mnogo zanimljivim akcijama.

U osnovi, tok napada je slede캖i:

* Prona캠ite **povratni poziv koji mo쬰te zloupotrebiti** (potencijalno ograni캜en na \[\w\\.\_]).
* Ako nije ograni캜en i mo쬰te izvr코iti bilo koji JS, mogli biste to zloupotrebiti kao redovni XSS
* Naterajte **rtvu da otvori stranicu** koju kontroli코e **napada캜**
* **Stranica 캖e se otvoriti** u **drugom prozoru** (novi prozor 캖e imati objekat **`opener`** koji referencira inicijalni)
* **Inicijalna stranica** 캖e u캜itati **stranicu** gde se nalazi **zanimljivi DOM**.
* **Druga stranica** 캖e u캜itati **ranjivu stranicu zloupotrebljavaju캖i povratni poziv** i koriste캖i objekat **`opener`** da **pristupi i izvr코i neku akciju na inicijalnoj stranici** (koja sada sadr쬴 zanimljivi DOM).

{% hint style="danger" %}
Imajte na umu da 캜ak i ako inicijalna stranica pristupi novoj URL adresi nakon 코to je kreirala drugu stranicu, **`opener` objekat druge stranice je i dalje va쬰캖a referenca na prvu stranicu u novom DOM-u**.

맚avi코e, da bi druga stranica mogla da koristi objekat opener, **obe stranice moraju biti iz iste domene**. To je razlog za코to, da biste zloupotrebili ovu ranjivost, morate prona캖i neku vrstu **XSS u istoj domeni**.
{% endhint %}

### Eksploatacija

* Mo쬰te koristiti ovaj oblik da **generi코ete PoC** za eksploataciju ove vrste ranjivosti: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Da biste prona코li DOM putanju do HTML elementa sa klikom, mo쬰te koristiti ovu ekstenziju za pretra쬴va캜: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Primer

* Mo쬰te prona캖i ranjiv primer na [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* Imajte na umu da server u ovom primeru **generi코e javascript kod** i **dodaje** ga u HTML na osnovu **sadr쬬ja parametra povratnog poziva:** `<script>opener.{callbacl_content}</script>`. Zato u ovom primeru ne morate eksplicitno nazna캜iti kori코캖enje `opener`.
* Tako캠e proverite ovaj CTF izve코taj: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## Reference

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
