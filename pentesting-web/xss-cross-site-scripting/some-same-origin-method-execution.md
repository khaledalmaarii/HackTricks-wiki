# SOME - Wykonanie metody o tej samej domenie

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujÄ…cej siÄ™ cyberbezpieczeÅ„stwem**? Chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks**? A moÅ¼e chcesz mieÄ‡ dostÄ™p do **najnowszej wersji PEASS lub pobraÄ‡ HackTricks w formacie PDF**? SprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **DoÅ‚Ä…cz do** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**repozytorium hacktricks**](https://github.com/carlospolop/hacktricks) **i** [**repozytorium hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Wykonanie metody o tej samej domenie

ZdarzÄ… siÄ™ sytuacje, w ktÃ³rych moÅ¼esz wykonaÄ‡ pewien ograniczony kod JavaScript na stronie. Na przykÅ‚ad, w przypadku, gdy moÅ¼esz **kontrolowaÄ‡ wartoÅ›Ä‡ wywoÅ‚ania zwrotnego, ktÃ³ra zostanie wykonana**.

W takich przypadkach jednÄ… z najlepszych rzeczy, ktÃ³re moÅ¼esz zrobiÄ‡, jest **uzyskanie dostÄ™pu do DOM, aby wywoÅ‚aÄ‡ dowolnÄ…** wraÅ¼liwÄ… akcjÄ™, ktÃ³rÄ… moÅ¼na tam znaleÅºÄ‡ (np. klikniÄ™cie przycisku). Jednak zazwyczaj tÄ™ podatnoÅ›Ä‡ znajdziesz w **maÅ‚ych punktach koÅ„cowych bez Å¼adnych interesujÄ…cych elementÃ³w w DOM**.

W takich scenariuszach ten atak bÄ™dzie bardzo przydatny, poniewaÅ¼ jego celem jest **wykorzystanie ograniczonego wykonywania JS wewnÄ…trz DOM z innej strony o tej samej domenie** z bardziej interesujÄ…cymi akcjami.

Podstawowy przebieg ataku jest nastÄ™pujÄ…cy:

* ZnajdÅº **zwrotkÄ™, ktÃ³rÄ… moÅ¼na wykorzystaÄ‡** (potencjalnie ograniczonÄ… do \[\w\\.\_]).
* JeÅ›li nie jest ograniczona i moÅ¼esz wykonaÄ‡ dowolny kod JS, moÅ¼esz po prostu wykorzystaÄ‡ to jako zwykÅ‚e XSS.
* Spowoduj, Å¼e **ofiara otworzy stronÄ™** kontrolowanÄ… przez **atakujÄ…cego**.
* **Strona otworzy siÄ™** w **innym oknie** (nowe okno bÄ™dzie miaÅ‚o obiekt **`opener`**, ktÃ³ry odnosi siÄ™ do poczÄ…tkowego okna).
* **PoczÄ…tkowa strona** zaÅ‚aduje **stronÄ™**, na ktÃ³rej znajduje siÄ™ **interesujÄ…cy DOM**.
* **Druga strona** zaÅ‚aduje **podatnÄ… stronÄ™, wykorzystujÄ…c zwrotkÄ™** i uÅ¼ywajÄ…c obiektu **`opener`**, aby **uzyskaÄ‡ dostÄ™p i wykonaÄ‡ pewnÄ… akcjÄ™ w poczÄ…tkowej stronie** (ktÃ³ra teraz zawiera interesujÄ…cy DOM).

{% hint style="danger" %}
NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e nawet jeÅ›li poczÄ…tkowa strona uzyska dostÄ™p do nowego adresu URL po utworzeniu drugiej strony, **obiekt `opener` drugiej strony wciÄ…Å¼ jest waÅ¼nym odwoÅ‚aniem do pierwszej strony w nowym DOM**.

Ponadto, aby druga strona mogÅ‚a uÅ¼ywaÄ‡ obiektu opener, **obie strony muszÄ… byÄ‡ w tej samej domenie**. Dlatego teÅ¼, aby wykorzystaÄ‡ tÄ™ podatnoÅ›Ä‡, musisz znaleÅºÄ‡ pewien rodzaj **XSS w tej samej domenie**.
{% endhint %}

### Wykorzystanie

* MoÅ¼esz uÅ¼yÄ‡ tego formularza do **wygenerowania PoC** w celu wykorzystania tego rodzaju podatnoÅ›ci: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Aby znaleÅºÄ‡ Å›cieÅ¼kÄ™ DOM do elementu HTML z klikniÄ™ciem, moÅ¼esz uÅ¼yÄ‡ tego rozszerzenia przeglÄ…darki: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### PrzykÅ‚ad

* MoÅ¼esz znaleÅºÄ‡ przykÅ‚ad podatnoÅ›ci na stronie [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* ZauwaÅ¼, Å¼e w tym przykÅ‚adzie serwer **generuje kod JavaScript** i **dodaje** go do HTML na podstawie **zawartoÅ›ci parametru zwrotki:** `<script>opener.{callbacl_content}</script>`. Dlatego w tym przykÅ‚adzie nie musisz wskazywaÄ‡ uÅ¼ycia `opener` explicite.
* SprawdÅº rÃ³wnieÅ¼ ten opis rozwiÄ…zania CTF: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## OdwoÅ‚ania

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmujÄ…cej siÄ™ cyberbezpieczeÅ„stwem**? Chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks**? A moÅ¼e chcesz mieÄ‡ dostÄ™p do **najnowszej wersji PEASS lub pobraÄ‡ HackTricks w formacie PDF**? SprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* **DoÅ‚Ä…cz do** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**repozytorium hacktricks**](https://github.com/carlospolop/hacktricks) **i** [**repozytorium hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
