# SOME - Execu√ß√£o de M√©todo de Mesma Origem

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

## Execu√ß√£o de M√©todo de Mesma Origem

Haver√° ocasi√µes em que voc√™ pode executar algum javascript limitado em uma p√°gina. Por exemplo, no caso em que voc√™ pode [**controlar um valor de callback que ser√° executado**](./#javascript-function).

Nesses casos, uma das melhores coisas que voc√™ pode fazer √© **acessar o DOM para chamar qualquer** a√ß√£o sens√≠vel que voc√™ encontrar l√° (como clicar em um bot√£o). No entanto, geralmente voc√™ encontrar√° essa vulnerabilidade em **pequenos endpoints sem nada interessante no DOM**.

Nesses cen√°rios, esse ataque ser√° muito √∫til, porque seu objetivo √© ser capaz de **abusar da execu√ß√£o limitada de JS dentro de um DOM de uma p√°gina diferente do mesmo dom√≠nio** com a√ß√µes muito mais interessantes.

Basicamente, o fluxo do ataque √© o seguinte:

* Encontre um **callback que voc√™ pode abusar** (potencialmente limitado a \[\w\\.\_]).
* Se n√£o estiver limitado e voc√™ puder executar qualquer JS, voc√™ poderia apenas abusar disso como um XSS regular.
* Fa√ßa a **v√≠tima abrir uma p√°gina** controlada pelo **atacante**.
* A **p√°gina se abrir√°** em uma **nova janela** (a nova janela ter√° o objeto **`opener`** referenciando a inicial).
* A **p√°gina inicial** carregar√° a **p√°gina** onde o **DOM interessante** est√° localizado.
* A **segunda p√°gina** carregar√° a **p√°gina vulner√°vel abusando do callback** e usando o objeto **`opener`** para **acessar e executar alguma a√ß√£o na p√°gina inicial** (que agora cont√©m o DOM interessante).

{% hint style="danger" %}
Observe que mesmo se a p√°gina inicial acessar uma nova URL ap√≥s ter criado a segunda p√°gina, o **objeto `opener` da segunda p√°gina ainda √© uma refer√™ncia v√°lida para a primeira p√°gina no novo DOM**.

Al√©m disso, para que a segunda p√°gina possa usar o objeto opener, **ambas as p√°ginas devem estar na mesma origem**. Esta √© a raz√£o pela qual, para abusar dessa vulnerabilidade, voc√™ precisa encontrar algum tipo de **XSS na mesma origem**.
{% endhint %}

### Explora√ß√£o

* Voc√™ pode usar esta forma para **gerar um PoC** para explorar esse tipo de vulnerabilidade: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Para encontrar um caminho DOM para um elemento HTML com um clique, voc√™ pode usar esta extens√£o de navegador: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Exemplo

* Voc√™ pode encontrar um exemplo vulner√°vel em [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* Observe que neste exemplo o servidor est√° **gerando c√≥digo javascript** e **adicionando** ao HTML com base no **conte√∫do do par√¢metro de callback:** `<script>opener.{callbacl_content}</script>`. √â por isso que neste exemplo voc√™ n√£o precisa indicar o uso de `opener` explicitamente.
* Confira tamb√©m este writeup de CTF: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## Refer√™ncias

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
