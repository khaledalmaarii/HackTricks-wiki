# SOME - Same Origin Method Execution

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) æ˜¯ä¸€ä¸ªç”± **æš—ç½‘** é©±åŠ¨çš„æœç´¢å¼•æ“ï¼Œæä¾› **å…è´¹** åŠŸèƒ½ä»¥æ£€æŸ¥å…¬å¸æˆ–å…¶å®¢æˆ·æ˜¯å¦è¢« **çªƒå–æ¶æ„è½¯ä»¶** **å…¥ä¾µ**ã€‚

WhiteIntel çš„ä¸»è¦ç›®æ ‡æ˜¯æ‰“å‡»ç”±äºä¿¡æ¯çªƒå–æ¶æ„è½¯ä»¶å¯¼è‡´çš„è´¦æˆ·æ¥ç®¡å’Œå‹’ç´¢è½¯ä»¶æ”»å‡»ã€‚

æ‚¨å¯ä»¥è®¿é—®ä»–ä»¬çš„ç½‘ç«™å¹¶å…è´¹å°è¯•ä»–ä»¬çš„å¼•æ“ï¼š

{% embed url="https://whiteintel.io" %}

***

## Same Origin Method Execution

æœ‰æ—¶æ‚¨å¯ä»¥åœ¨é¡µé¢ä¸­æ‰§è¡Œä¸€äº›æœ‰é™çš„ JavaScriptã€‚ä¾‹å¦‚ï¼Œåœ¨æ‚¨å¯ä»¥[ **æ§åˆ¶å°†è¢«æ‰§è¡Œçš„å›è°ƒå€¼**](./#javascript-function)çš„æƒ…å†µä¸‹ã€‚

åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åšçš„æœ€å¥½çš„äº‹æƒ…ä¹‹ä¸€æ˜¯ **è®¿é—® DOM ä»¥è°ƒç”¨æ‚¨èƒ½æ‰¾åˆ°çš„ä»»ä½•** æ•æ„Ÿæ“ä½œï¼ˆä¾‹å¦‚ç‚¹å‡»æŒ‰é’®ï¼‰ã€‚ç„¶è€Œï¼Œé€šå¸¸æ‚¨ä¼šåœ¨ **æ²¡æœ‰ä»»ä½•æœ‰è¶£å†…å®¹çš„ DOM çš„å°ç«¯ç‚¹** ä¸­å‘ç°æ­¤æ¼æ´ã€‚

åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œè¿™ç§æ”»å‡»å°†éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå…¶ç›®æ ‡æ˜¯èƒ½å¤Ÿ **æ»¥ç”¨æ¥è‡ªåŒä¸€åŸŸçš„ä¸åŒé¡µé¢ä¸­çš„æœ‰é™ JS æ‰§è¡Œ**ï¼Œä»¥è¿›è¡Œæ›´æœ‰è¶£çš„æ“ä½œã€‚

åŸºæœ¬ä¸Šï¼Œæ”»å‡»æµç¨‹å¦‚ä¸‹ï¼š

* æ‰¾åˆ°ä¸€ä¸ª **æ‚¨å¯ä»¥æ»¥ç”¨çš„å›è°ƒ**ï¼ˆå¯èƒ½é™åˆ¶ä¸º \[\w\\.\_]ï¼‰ã€‚
* å¦‚æœæ²¡æœ‰é™åˆ¶å¹¶ä¸”æ‚¨å¯ä»¥æ‰§è¡Œä»»ä½• JSï¼Œæ‚¨å¯ä»¥åƒå¸¸è§„ XSS ä¸€æ ·æ»¥ç”¨å®ƒã€‚
* è®© **å—å®³è€…æ‰“å¼€ä¸€ä¸ª** ç”± **æ”»å‡»è€…** æ§åˆ¶çš„é¡µé¢ã€‚
* **é¡µé¢å°†è‡ªå·±** åœ¨ **ä¸åŒçª—å£** ä¸­æ‰“å¼€ï¼ˆæ–°çª—å£å°†æœ‰å¯¹è±¡ **`opener`** å¼•ç”¨åˆå§‹çª—å£ï¼‰ã€‚
* **åˆå§‹é¡µé¢** å°†åŠ è½½ **æœ‰è¶£çš„ DOM** æ‰€åœ¨çš„ **é¡µé¢**ã€‚
* **ç¬¬äºŒä¸ªé¡µé¢** å°†åŠ è½½ **æ»¥ç”¨å›è°ƒçš„æ˜“å—æ”»å‡»é¡µé¢**ï¼Œå¹¶ä½¿ç”¨ **`opener`** å¯¹è±¡ **è®¿é—®å¹¶åœ¨åˆå§‹é¡µé¢ä¸­æ‰§è¡ŒæŸäº›æ“ä½œ**ï¼ˆç°åœ¨åŒ…å«æœ‰è¶£çš„ DOMï¼‰ã€‚

{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œå³ä½¿åˆå§‹é¡µé¢åœ¨åˆ›å»ºç¬¬äºŒä¸ªé¡µé¢åè®¿é—®æ–° URLï¼Œ**ç¬¬äºŒä¸ªé¡µé¢çš„ `opener` å¯¹è±¡ä»ç„¶æ˜¯å¯¹æ–° DOM ä¸­ç¬¬ä¸€ä¸ªé¡µé¢çš„æœ‰æ•ˆå¼•ç”¨**ã€‚

æ­¤å¤–ï¼Œä¸ºäº†ä½¿ç¬¬äºŒä¸ªé¡µé¢èƒ½å¤Ÿä½¿ç”¨ opener å¯¹è±¡ï¼Œ**ä¸¤ä¸ªé¡µé¢å¿…é¡»åœ¨åŒä¸€æº**ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸ºäº†æ»¥ç”¨æ­¤æ¼æ´ï¼Œæ‚¨éœ€è¦æ‰¾åˆ°æŸç§ **åŒæºä¸­çš„ XSS**ã€‚
{% endhint %}

### Exploitation

* æ‚¨å¯ä»¥ä½¿ç”¨æ­¤è¡¨å•æ¥ **ç”Ÿæˆ PoC** ä»¥åˆ©ç”¨æ­¤ç±»æ¼æ´ï¼š[https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* ä¸ºäº†æ‰¾åˆ°å¸¦æœ‰ç‚¹å‡»çš„ HTML å…ƒç´ çš„ DOM è·¯å¾„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤æµè§ˆå™¨æ‰©å±•ï¼š[https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Example

* æ‚¨å¯ä»¥åœ¨ [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/) æ‰¾åˆ°ä¸€ä¸ªæ˜“å—æ”»å‡»çš„ç¤ºä¾‹ã€‚
* è¯·æ³¨æ„ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒæœåŠ¡å™¨ **ç”Ÿæˆ JavaScript ä»£ç ** å¹¶ **å°†å…¶æ·»åŠ ** åˆ°åŸºäº **å›è°ƒå‚æ•°å†…å®¹çš„ HTML** ä¸­ï¼š`<script>opener.{callbacl_content}</script>`ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨æ­¤ç¤ºä¾‹ä¸­æ‚¨ä¸éœ€è¦æ˜ç¡®æŒ‡ç¤ºä½¿ç”¨ `opener`ã€‚
* è¿˜å¯ä»¥æŸ¥çœ‹æ­¤ CTF æ–‡ç« ï¼š[https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## References

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
