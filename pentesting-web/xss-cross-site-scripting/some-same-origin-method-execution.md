# SOME - Same Origin Method Execution

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Same Origin Method Execution

Es wird Gelegenheiten geben, bei denen du einige eingeschr√§nkte JavaScript in einer Seite ausf√ºhren kannst. Zum Beispiel im Fall, dass du [**einen Callback-Wert kontrollieren kannst, der ausgef√ºhrt wird**](./#javascript-function).

In diesen F√§llen ist eine der besten Dinge, die du tun kannst, **auf das DOM zuzugreifen, um jede** sensible Aktion aufzurufen, die du dort finden kannst (wie das Klicken auf einen Button). Allerdings wirst du diese Schwachstelle normalerweise in **kleinen Endpunkten ohne interessante Dinge im DOM** finden.

In diesen Szenarien wird dieser Angriff sehr n√ºtzlich sein, da sein Ziel darin besteht, **die eingeschr√§nkte JS-Ausf√ºhrung innerhalb eines DOM von einer anderen Seite derselben Domain** mit viel interessanteren Aktionen auszunutzen.

Grunds√§tzlich ist der Angriffsfluss wie folgt:

* Finde einen **Callback, den du ausnutzen kannst** (potenziell beschr√§nkt auf \[\w\\.\_]).
* Wenn es nicht beschr√§nkt ist und du beliebiges JS ausf√ºhren kannst, k√∂nntest du dies einfach als regul√§res XSS ausnutzen.
* Lass die **Opfer eine Seite** √∂ffnen, die vom **Angreifer** kontrolliert wird.
* Die **Seite wird sich selbst** in einem **neuen Fenster** √∂ffnen (das neue Fenster hat das Objekt **`opener`**, das auf das urspr√ºngliche verweist).
* Die **urspr√ºngliche Seite** wird die **Seite** laden, auf der sich das **interessante DOM** befindet.
* Die **zweite Seite** wird die **anf√§llige Seite laden, indem sie den Callback ausnutzt** und das **`opener`**-Objekt verwendet, um **auf die urspr√ºngliche Seite zuzugreifen und eine Aktion auszuf√ºhren** (die jetzt das interessante DOM enth√§lt).

{% hint style="danger" %}
Beachte, dass selbst wenn die urspr√ºngliche Seite nach dem Erstellen der zweiten Seite auf eine neue URL zugreift, das **`opener`-Objekt der zweiten Seite immer noch eine g√ºltige Referenz auf die erste Seite im neuen DOM ist**.

Dar√ºber hinaus m√ºssen beide Seiten, damit die zweite Seite das Opener-Objekt verwenden kann, **im selben Ursprung sein**. Das ist der Grund, warum du, um diese Schwachstelle auszunutzen, eine Art von **XSS im selben Ursprung** finden musst.
{% endhint %}

### Exploitation

* Du kannst dieses Formular verwenden, um **eine PoC zu generieren**, um diese Art von Schwachstelle auszunutzen: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Um einen DOM-Pfad zu einem HTML-Element mit einem Klick zu finden, kannst du diese Browsererweiterung verwenden: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Beispiel

* Du kannst ein anf√§lliges Beispiel unter [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/) finden.
* Beachte, dass der Server in diesem Beispiel **JavaScript-Code generiert** und **hinzuf√ºgt**, basierend auf dem **Inhalt des Callback-Parameters:** `<script>opener.{callbacl_content}</script>`. Deshalb musst du in diesem Beispiel die Verwendung von `opener` nicht explizit angeben.
* √úberpr√ºfe auch diesen CTF-Writeup: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## References

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
