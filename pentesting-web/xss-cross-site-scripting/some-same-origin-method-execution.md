# SOME - Same Origin Method Execution

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Same Origin Method Execution

Habr치 ocasiones en las que podr치s ejecutar un javascript limitado en una p치gina. Por ejemplo, en el caso en que puedes [**controlar un valor de callback que ser치 ejecutado**](./#javascript-function).

En esos casos, una de las mejores cosas que podr칤as hacer es **acceder al DOM para llamar a cualquier** acci칩n sensible que puedas encontrar all칤 (como hacer clic en un bot칩n). Sin embargo, generalmente encontrar치s esta vulnerabilidad en **peque침os endpoints sin nada interesante en el DOM**.

En esos escenarios, este ataque ser치 muy 칰til, porque su objetivo es poder **abusar de la ejecuci칩n limitada de JS dentro de un DOM desde una p치gina diferente del mismo dominio** con acciones mucho m치s interesantes.

B치sicamente, el flujo del ataque es el siguiente:

* Encontrar un **callback que puedas abusar** (potencialmente limitado a \[\w\\.\_]).
* Si no est치 limitado y puedes ejecutar cualquier JS, podr칤as simplemente abusar de esto como un XSS regular.
* Hacer que la **v칤ctima abra una p치gina** controlada por el **atacante**.
* La **p치gina se abrir치 sola** en una **ventana diferente** (la nueva ventana tendr치 el objeto **`opener`** referenciando a la inicial).
* La **p치gina inicial** cargar치 la **p치gina** donde se encuentra el **DOM interesante**.
* La **segunda p치gina** cargar치 la **p치gina vulnerable abusando del callback** y usando el objeto **`opener`** para **acceder y ejecutar alguna acci칩n en la p치gina inicial** (que ahora contiene el DOM interesante).

{% hint style="danger" %}
Ten en cuenta que incluso si la p치gina inicial accede a una nueva URL despu칠s de haber creado la segunda p치gina, el **objeto `opener` de la segunda p치gina sigue siendo una referencia v치lida a la primera p치gina en el nuevo DOM**.

Adem치s, para que la segunda p치gina pueda usar el objeto opener **ambas p치ginas deben estar en el mismo origen**. Esta es la raz칩n por la cual, para abusar de esta vulnerabilidad, necesitas encontrar alg칰n tipo de **XSS en el mismo origen**.
{% endhint %}

### Exploitation

* Puedes usar este formulario para **generar un PoC** para explotar este tipo de vulnerabilidad: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Para encontrar una ruta DOM a un elemento HTML con un clic, puedes usar esta extensi칩n de navegador: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Example

* Puedes encontrar un ejemplo vulnerable en [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* Ten en cuenta que en este ejemplo el servidor est치 **generando c칩digo javascript** y **agreg치ndolo** al HTML basado en el **contenido del par치metro callback:** `<script>opener.{callbacl_content}</script>`. Por eso en este ejemplo no necesitas indicar el uso de `opener` expl칤citamente.
* Tambi칠n revisa este writeup de CTF: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## References

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
