# SOME - Wykonanie Metody Tego Samego Pochodzenia

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

## Wykonanie Metody Tego Samego Pochodzenia

BÄ™dÄ… sytuacje, w ktÃ³rych moÅ¼esz wykonaÄ‡ ograniczony javascript na stronie. Na przykÅ‚ad, w przypadku, gdy moÅ¼esz[ **kontrolowaÄ‡ wartoÅ›Ä‡ zwrotnÄ…, ktÃ³ra zostanie wykonana**](./#javascript-function).

W takich przypadkach jednÄ… z najlepszych rzeczy, ktÃ³re moÅ¼esz zrobiÄ‡, jest **dostÄ™p do DOM, aby wywoÅ‚aÄ‡ dowolnÄ…** wraÅ¼liwÄ… akcjÄ™, ktÃ³rÄ… moÅ¼esz tam znaleÅºÄ‡ (jak klikniÄ™cie przycisku). Jednak zazwyczaj znajdziesz tÄ™ lukÄ™ w **maÅ‚ych punktach koÅ„cowych bez Å¼adnych interesujÄ…cych rzeczy w DOM**.

W tych scenariuszach, ta atak bÄ™dzie bardzo przydatny, poniewaÅ¼ jego celem jest **naduÅ¼ycie ograniczonego wykonania JS wewnÄ…trz DOM z innej strony z tej samej domeny** z wieloma interesujÄ…cymi akcjami.

Zasadniczo, przepÅ‚yw ataku jest nastÄ™pujÄ…cy:

* ZnajdÅº **callback, ktÃ³ry moÅ¼esz naduÅ¼yÄ‡** (potencjalnie ograniczony do \[\w\\.\_]).
* JeÅ›li nie jest ograniczony i moÅ¼esz wykonaÄ‡ dowolny JS, moÅ¼esz po prostu naduÅ¼yÄ‡ tego jak zwykÅ‚ego XSS
* Spraw, aby **ofiara otworzyÅ‚a stronÄ™** kontrolowanÄ… przez **atakujÄ…cego**
* **Strona otworzy siÄ™** w **innym oknie** (nowe okno bÄ™dzie miaÅ‚o obiekt **`opener`** odnoszÄ…cy siÄ™ do poczÄ…tkowego)
* **PoczÄ…tkowa strona** zaÅ‚aduje **stronÄ™**, na ktÃ³rej znajduje siÄ™ **interesujÄ…cy DOM**.
* **Druga strona** zaÅ‚aduje **wraÅ¼liwÄ… stronÄ™, naduÅ¼ywajÄ…c callback** i uÅ¼ywajÄ…c obiektu **`opener`**, aby **uzyskaÄ‡ dostÄ™p i wykonaÄ‡ jakÄ…Å› akcjÄ™ na poczÄ…tkowej stronie** (ktÃ³ra teraz zawiera interesujÄ…cy DOM).

{% hint style="danger" %}
ZauwaÅ¼, Å¼e nawet jeÅ›li poczÄ…tkowa strona uzyskuje dostÄ™p do nowego URL po utworzeniu drugiej strony, **obiekt `opener` drugiej strony jest nadal waÅ¼nym odniesieniem do pierwszej strony w nowym DOM**.

Co wiÄ™cej, aby druga strona mogÅ‚a uÅ¼ywaÄ‡ obiektu opener, **obie strony muszÄ… byÄ‡ w tym samym pochodzeniu**. To jest powÃ³d, dla ktÃ³rego, aby naduÅ¼yÄ‡ tÄ™ lukÄ™, musisz znaleÅºÄ‡ jakiÅ› rodzaj **XSS w tym samym pochodzeniu**.
{% endhint %}

### Wykorzystanie

* MoÅ¼esz uÅ¼yÄ‡ tej formy, aby **wygenerowaÄ‡ PoC** do wykorzystania tego typu luki: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Aby znaleÅºÄ‡ Å›cieÅ¼kÄ™ DOM do elementu HTML z klikniÄ™ciem, moÅ¼esz uÅ¼yÄ‡ tej rozszerzenia przeglÄ…darki: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### PrzykÅ‚ad

* MoÅ¼esz znaleÅºÄ‡ wraÅ¼liwy przykÅ‚ad w [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* ZauwaÅ¼, Å¼e w tym przykÅ‚adzie serwer **generuje kod javascript** i **dodaje** go do HTML na podstawie **zawartoÅ›ci parametru callback:** `<script>opener.{callbacl_content}</script>`. Dlatego w tym przykÅ‚adzie nie musisz wskazywaÄ‡ uÅ¼ycia `opener` w sposÃ³b expliczny.
* SprawdÅº rÃ³wnieÅ¼ ten opis CTF: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## Odniesienia

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
