# PIE

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

## Informa√ß√µes B√°sicas

Um bin√°rio compilado como PIE, ou **Execut√°vel Independente de Posi√ß√£o**, significa que o **programa pode ser carregado em diferentes locais de mem√≥ria** cada vez que √© executado, prevenindo endere√ßos codificados.

O truque para explorar esses bin√°rios est√° em explorar os **endere√ßos relativos**‚Äîos deslocamentos entre partes do programa permanecem os mesmos, mesmo que as localiza√ß√µes absolutas mudem. Para **burlar o PIE, voc√™ s√≥ precisa vazar um endere√ßo**, tipicamente da **pilha** usando vulnerabilidades como ataques de string de formato. Uma vez que voc√™ tenha um endere√ßo, pode calcular outros por seus **deslocamentos fixos**.

Uma dica √∫til na explora√ß√£o de bin√°rios PIE √© que seu **endere√ßo base normalmente termina em 000** devido √†s p√°ginas de mem√≥ria serem as unidades de randomiza√ß√£o, com tamanho de 0x1000 bytes. Este alinhamento pode ser uma **verifica√ß√£o cr√≠tica se um exploit n√£o est√° funcionando** como esperado, indicando se o endere√ßo base correto foi identificado.\
Ou voc√™ pode usar isso para seu exploit, se voc√™ vazar que um endere√ßo est√° localizado em **`0x649e1024`** voc√™ sabe que o **endere√ßo base √© `0x649e1000`** e a partir da√≠ voc√™ pode apenas **calcular deslocamentos** de fun√ß√µes e locais.

## Bypasses

Para burlar o PIE, √© necess√°rio **vazar algum endere√ßo do bin√°rio carregado**, existem algumas op√ß√µes para isso:

* **ASLR desativado**: Se o ASLR estiver desativado, um bin√°rio compilado com PIE sempre **ser√° carregado no mesmo endere√ßo**, portanto **o PIE ser√° in√∫til** j√° que os endere√ßos dos objetos sempre estar√£o no mesmo lugar.
* Ser **dado** o vazamento (comum em desafios CTF f√°ceis, [**ver este exemplo**](https://ir0nstone.gitbook.io/notes/types/stack/pie/pie-exploit))
* **For√ßar valores EBP e EIP** na pilha at√© que voc√™ vaze os corretos:

{% content-ref url="bypassing-canary-and-pie.md" %}
[bypassing-canary-and-pie.md](bypassing-canary-and-pie.md)
{% endcontent-ref %}

* Usar uma vulnerabilidade de leitura arbitr√°ria, como [**string de formato**](../../format-strings/) para vazar um endere√ßo do bin√°rio (por exemplo, da pilha, como na t√©cnica anterior) para obter a base do bin√°rio e usar deslocamentos a partir da√≠. [**Encontre um exemplo aqui**](https://ir0nstone.gitbook.io/notes/types/stack/pie/pie-bypass).

## Refer√™ncias

* [https://ir0nstone.gitbook.io/notes/types/stack/pie](https://ir0nstone.gitbook.io/notes/types/stack/pie)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
