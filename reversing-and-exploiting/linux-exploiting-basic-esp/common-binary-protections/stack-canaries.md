# YÄ±ÄŸÄ±n KanaryalarÄ±

<details>

<summary><strong>AWS hackleme becerilerini sÄ±fÄ±rdan ileri seviyeye Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile</strong>!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## **StackGuard ve StackShield**

**StackGuard**, tampon taÅŸmalarÄ±na karÅŸÄ± koruma saÄŸlamak iÃ§in **EIP (GeniÅŸletilmiÅŸ Komut Ä°ÅŸaretÃ§isi)**'den Ã¶nce Ã¶zel bir deÄŸer olan **kanarya** ekler, Ã¶zellikle `0x000aff0d` (null, yeni satÄ±r, EOF, taÅŸÄ±ma dÃ¶nÃ¼ÅŸÃ¼) deÄŸerini kullanÄ±r. Ancak, `recv()`, `memcpy()`, `read()` ve `bcopy()` gibi iÅŸlevler hala savunmasÄ±zdÄ±r ve **EBP (Taban Ä°ÅŸaretÃ§isi)**'yi korumaz.

**StackShield**, StackGuard'dan daha sofistike bir yaklaÅŸÄ±m benimseyerek tÃ¼m dÃ¶nÃ¼ÅŸ adreslerini (**EIP'ler**) depolayan bir **Global DÃ¶nÃ¼ÅŸ YÄ±ÄŸÄ±nÄ±** sÃ¼rdÃ¼rÃ¼r. Bu yapÄ±, taÅŸma durumlarÄ±nÄ± tespit etmek iÃ§in depolanan ve gerÃ§ek dÃ¶nÃ¼ÅŸ adresleri arasÄ±nda karÅŸÄ±laÅŸtÄ±rma yapÄ±lmasÄ±nÄ± saÄŸlayarak herhangi bir taÅŸmanÄ±n zarar vermemesini saÄŸlar. AyrÄ±ca, StackShield, **EIP**'nin beklenen veri alanÄ±nÄ±n dÄ±ÅŸÄ±na iÅŸaret ettiÄŸini tespit etmek iÃ§in dÃ¶nÃ¼ÅŸ adresini bir sÄ±nÄ±r deÄŸeriyle karÅŸÄ±laÅŸtÄ±rabilir. Bununla birlikte, StackShield'Ä±n da Return-to-libc, ROP (Return-Oriented Programming) veya ret2ret gibi tekniklerle atlatÄ±labileceÄŸi, bu nedenle StackShield'Ä±n yerel deÄŸiÅŸkenleri korumadÄ±ÄŸÄ± anlamÄ±na gelir.

## **YÄ±ÄŸÄ±n SaldÄ±rÄ± Koruyucusu (ProPolice) `-fstack-protector`:**

Bu mekanizma, **EBP**'den Ã¶nce bir **kanarya** yerleÅŸtirir ve yerel deÄŸiÅŸkenleri yeniden dÃ¼zenleyerek tamponlarÄ±n diÄŸer deÄŸiÅŸkenleri Ã¼zerine yazmasÄ±nÄ± engellemek iÃ§in tamponlarÄ± daha yÃ¼ksek bellek adreslerine yerleÅŸtirir. AyrÄ±ca, yÄ±ÄŸÄ±na geÃ§irilen argÃ¼manlarÄ± gÃ¼venli bir ÅŸekilde kopyalar ve bu kopyalarÄ± argÃ¼man olarak kullanÄ±r. Bununla birlikte, 8'den az Ã¶ÄŸeye sahip dizileri veya kullanÄ±cÄ±nÄ±n yapÄ±sÄ±ndaki tamponlarÄ± korumaz.

**Kanarya**, `/dev/urandom` kaynaklÄ± rastgele bir sayÄ± veya varsayÄ±lan `0xff0a0000` deÄŸerinden tÃ¼retilen bir sayÄ±dÄ±r. **TLS (Ä°ÅŸ ParÃ§acÄ±ÄŸÄ± Yerel Depolama)**'da saklanÄ±r ve iÅŸ parÃ§acÄ±klarÄ± arasÄ±nda paylaÅŸÄ±lan bellek alanlarÄ±na iÅŸ parÃ§acÄ±ÄŸÄ± Ã¶zgÃ¼ kÃ¼resel veya statik deÄŸiÅŸkenlerin olmasÄ±na izin verir. Bu deÄŸiÅŸkenler baÅŸlangÄ±Ã§ta ebeveyn sÃ¼reÃ§ten kopyalanÄ±r ve Ã§ocuk sÃ¼reÃ§ler verilerini deÄŸiÅŸtirebilir ancak ebeveyni veya kardeÅŸleri etkilemez. Bununla birlikte, **`fork()` kullanÄ±larak yeni bir kanarya oluÅŸturulmadan kullanÄ±ldÄ±ÄŸÄ±nda, tÃ¼m sÃ¼reÃ§ler (ebeveyn ve Ã§ocuklar) aynÄ± kanaryayÄ± paylaÅŸÄ±r**, bu da onu savunmasÄ±z hale getirir. **i386** mimarisinde kanarya `gs:0x14` adresinde saklanÄ±r ve **x86\_64** mimarisinde `fs:0x28` adresinde saklanÄ±r.

Bu yerel koruma, saldÄ±rÄ±lara aÃ§Ä±k tamponlara sahip iÅŸlevleri tanÄ±mlar ve bu iÅŸlevlerin baÅŸÄ±na kanaryayÄ± yerleÅŸtirmek ve bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ doÄŸrulamak iÃ§in bu iÅŸlevlerin baÅŸÄ±na kod enjekte eder.

Bir web sunucusu `fork()` kullandÄ±ÄŸÄ±nda, kanaryayÄ± bayt bayt tahmin etmek iÃ§in bir brute-force saldÄ±rÄ±sÄ±nÄ± etkinleÅŸtirir. Ancak, `fork()`'ten sonra `execve()` kullanmak bellek alanÄ±nÄ± Ã¼zerine yazar ve saldÄ±rÄ±yÄ± geÃ§ersiz kÄ±lar. `vfork()`, Ã§ocuk sÃ¼recin yazmaya Ã§alÄ±ÅŸana kadar Ã§oÄŸaltÄ±lmadan Ã§alÄ±ÅŸmasÄ±na izin verir, yazmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda bir kopya oluÅŸturulur, bÃ¶ylece farklÄ± bir iÅŸlem oluÅŸturma ve bellek iÅŸleme yaklaÅŸÄ±mÄ± sunar.

## Atlamalar

* **KanaryayÄ± sÄ±zdÄ±rmak** ve ardÄ±ndan (Ã¶rneÄŸin tampon taÅŸmasÄ±) kendi deÄŸeriyle Ã¼zerine yazmak.
* EÄŸer kanarya Ã§ocuk sÃ¼reÃ§lerde Ã§oÄŸaltÄ±lÄ±rsa, bir bayt biriminde brute-force yapmak mÃ¼mkÃ¼n olabilir.
* EÄŸer ikili dosyada ilginÃ§ bir sÄ±zÄ±ntÄ± aÃ§Ä±ÄŸÄ± varsa, sÄ±zdÄ±rmak mÃ¼mkÃ¼n olabilir.
