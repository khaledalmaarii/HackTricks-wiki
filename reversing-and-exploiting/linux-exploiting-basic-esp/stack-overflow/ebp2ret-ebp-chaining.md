# EBP2Ret - EBP ì²´ì´ë‹

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œ**ë¶€í„° **íˆì–´ë¡œ**ë¡œ **AWS í•´í‚¹**ì„ ë°°ìš°ì„¸ìš”!</summary>

ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ **HackTricks**ë¥¼ ì§€ì›í•˜ëŠ” ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ **ë˜ê¸¸ ì›í•˜ê±°ë‚˜ **PDFë¡œ HackTricks ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

ì´ ê¸°ìˆ ì€ **ë² ì´ìŠ¤ í¬ì¸í„° (EBP)**ë¥¼ ì¡°ì‘í•˜ì—¬ **EBP ë ˆì§€ìŠ¤í„°**ì™€ `leave; ret` ëª…ë ¹ì–´ ì‹œí€€ìŠ¤ë¥¼ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ í•¨ìˆ˜ì˜ ì‹¤í–‰ì„ ì—°ê²°í•˜ëŠ” ëŠ¥ë ¥ì„ ì•…ìš©í•©ë‹ˆë‹¤.

**`leave`**ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤:
```
movl               %ebp, %esp
popl               %ebp
ret
```
### EBP2Ret

ì´ ê¸°ìˆ ì€ **EBP ë ˆì§€ìŠ¤í„°ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆì§€ë§Œ EIP ë ˆì§€ìŠ¤í„°ë¥¼ ì§ì ‘ì ìœ¼ë¡œ ë³€ê²½í•  ë°©ë²•ì´ ì—†ì„ ë•Œ íŠ¹íˆ ìœ ìš©**í•©ë‹ˆë‹¤. í•¨ìˆ˜ê°€ ì‹¤í–‰ì„ ë§ˆì¹˜ë©´ì„œ ë°œìƒí•˜ëŠ” ë™ì‘ì„ í™œìš©í•©ë‹ˆë‹¤.

`fvuln`ì˜ ì‹¤í–‰ ì¤‘ì— ìŠ¤íƒì— **ê°€ì§œ EBP**ë¥¼ ì£¼ì…í•˜ì—¬ í•´ë‹¹ ìœ„ì¹˜ê°€ ì…¸ì½”ë“œ ì£¼ì†Œê°€ ìˆëŠ” ë©”ëª¨ë¦¬ ì˜ì—­ì„ ê°€ë¦¬í‚¤ë„ë¡ ê´€ë¦¬í•œë‹¤ë©´ (pop ì‘ì—…ì„ ê³ ë ¤í•˜ì—¬ 4ë°”ì´íŠ¸ë¥¼ ë”í•œ), ê°„ì ‘ì ìœ¼ë¡œ EIPë¥¼ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `fvuln`ì´ ë°˜í™˜ë  ë•Œ ESPëŠ” ì´ ì¡°ì‘ëœ ìœ„ì¹˜ë¡œ ì„¤ì •ë˜ë©°, ì´í›„ì˜ `pop` ì‘ì—…ì€ ESPë¥¼ 4ë§Œí¼ ê°ì†Œì‹œì¼œ ì‹¤ì œë¡œëŠ” ì…¸ì½”ë“œë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ë§Œë“­ë‹ˆë‹¤. `ret` ëª…ë ¹ì´ ì‹¤í–‰ë˜ë©´ ì œì–´ê°€ ì…¸ì½”ë“œë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.

#### Exploit êµ¬ì„±

ë¨¼ì € ì‹¤í–‰ ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ì˜ ì–´ë”˜ê°€ì— **ì…¸ì½”ë“œë¥¼ ì£¼ì…**í•˜ê³  **ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜** ìœ íš¨í•œ [**ONE\_GADGET**](https://github.com/david942j/one\_gadget)ì˜ ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ **`system()`ì˜ ì£¼ì†Œ ë’¤ì— 4ë°”ì´íŠ¸ì˜ ì“°ë ˆê¸° ë°”ì´íŠ¸ì™€ `"/bin/sh"`ì˜ ì£¼ì†Œê°€ ìˆëŠ” ìœ„ì¹˜ë¥¼ ESPê°€ ê°€ë¦¬í‚¤ë„ë¡**í•´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ, íŒ¨ë”©ì„ ìƒì„±í•˜ê³  `ì…¸ì½”ë“œ/one_gadget ì£¼ì†Œ - 4`ë¡œ EBPë¥¼ **ì†ìƒ**ì‹œì¼œì•¼ í•©ë‹ˆë‹¤. `pop` ë•Œë¬¸ì— `-4`ì—¬ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¼ ESPëŠ” ìš°ë¦¬ê°€ ì›í•˜ëŠ” ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ê²Œ ë˜ê³  `ret`ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

#### Off-By-One Exploit

ì´ ê¸°ìˆ ì˜ íŠ¹ì • ë³€í˜•ì¸ "Off-By-One Exploit"ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” **EBPì˜ ê°€ì¥ ë‚®ì€ ìœ íš¨ ë°”ì´íŠ¸ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê²½ìš°** ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ê²½ìš° ì…¸ì½”ë“œ ì£¼ì†Œë¥¼ ì €ì¥í•˜ëŠ” ë©”ëª¨ë¦¬ ìœ„ì¹˜ëŠ” EBPì™€ ì²˜ìŒ ì„¸ ë°”ì´íŠ¸ë¥¼ ê³µìœ í•´ì•¼ í•˜ë¯€ë¡œ ë” ì œì•½ ì¡°ê±´ì´ ìˆëŠ” ìœ ì‚¬í•œ ì¡°ì‘ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### **EBP Chaining**

ë”°ë¼ì„œ ìŠ¤íƒì˜ `EBP` í•­ëª©ì— ì œì–´ ê°€ëŠ¥í•œ ì£¼ì†Œë¥¼ ë„£ê³  `EIP`ì— `leave; ret`ì˜ ì£¼ì†Œë¥¼ ë„£ìœ¼ë©´ **`ESP`ë¥¼ ìŠ¤íƒì—ì„œ ì œì–´ ê°€ëŠ¥í•œ `EBP` ì£¼ì†Œë¡œ ì´ë™**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì œ **`ESP`**ê°€ ì›í•˜ëŠ” ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ì œì–´ë˜ê³  ì‹¤í–‰í•  ë‹¤ìŒ ëª…ë ¹ì€ `RET`ì…ë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•˜ê¸° ìœ„í•´ ì œì–´ëœ ESP ìœ„ì¹˜ì— ë‹¤ìŒì„ ë°°ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **`&(ë‹¤ìŒ ê°€ì§œ EBP)`** -> `leave` ëª…ë ¹ì˜ `pop ebp`ë¡œ ìƒˆë¡œìš´ EBPë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
- **`system()`** -> `ret`ì— ì˜í•´ í˜¸ì¶œë©ë‹ˆë‹¤.
- **`&(leave;ret)`** -> ì‹œìŠ¤í…œì´ ì¢…ë£Œëœ í›„ í˜¸ì¶œë˜ë©°, ESPë¥¼ ê°€ì§œ EBPë¡œ ì´ë™ì‹œí‚¤ê³  ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.
- **`&("/bin/sh")`** -> `system`ì˜ ë§¤ê°œë³€ìˆ˜

ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ í”„ë¡œê·¸ë¨ì˜ íë¦„ì„ ì œì–´í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ê°€ì§œ EBPë¥¼ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
