# Ret2ret & Reo2pop

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

## Ret2ret

GÅ‚Ã³wnym celem tej techniki jest prÃ³ba **obejÅ›cia ASLR poprzez naduÅ¼ycie istniejÄ…cego wskaÅºnika na stosie**.

W zasadzie, przepeÅ‚nienia stosu sÄ… zazwyczaj spowodowane ciÄ…gami, a **ciÄ…gi koÅ„czÄ… siÄ™ bajtem zerowym na koÅ„cu** w pamiÄ™ci. To pozwala sprÃ³bowaÄ‡ zredukowaÄ‡ miejsce wskazywane przez istniejÄ…cy wskaÅºnik juÅ¼ istniejÄ…cy na stosie. WiÄ™c jeÅ›li stos zawieraÅ‚ `0xbfffffdd`, to to przepeÅ‚nienie mogÅ‚oby przeksztaÅ‚ciÄ‡ go w `0xbfffff00` (zauwaÅ¼ ostatni zera bajt).

JeÅ›li ten adres wskazuje na nasz shellcode na stosie, moÅ¼liwe jest skierowanie przepÅ‚ywu do tego adresu poprzez **dodawanie adresÃ³w do instrukcji `ret`** aÅ¼ do momentu, gdy ta zostanie osiÄ…gniÄ™ta.

Dlatego atak wyglÄ…daÅ‚by tak:

* NOP sled
* Shellcode
* Nadpisanie stosu z EIP za pomocÄ… **adresÃ³w do `ret`** (RET sled)
* 0x00 dodane przez ciÄ…g modyfikujÄ…cy adres ze stosu, sprawiajÄ…c, Å¼e wskazuje na NOP sled

PodÄ…Å¼ajÄ…c za [**tym linkiem**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2ret.c) moÅ¼esz zobaczyÄ‡ przykÅ‚ad podatnego binarnego i [**w tym**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2retexploit.c) exploit.

## Ret2pop

W przypadku, gdy moÅ¼esz znaleÅºÄ‡ **idealny wskaÅºnik na stosie, ktÃ³rego nie chcesz modyfikowaÄ‡** (w `ret2ret` zmieniamy ostatni najniÅ¼szy bajt na `0x00`), moÅ¼esz przeprowadziÄ‡ ten sam atak `ret2ret`, ale **dÅ‚ugoÅ›Ä‡ RET sled musi byÄ‡ skrÃ³cona o 1** (tak, aby koÅ„cowy `0x00` nadpisaÅ‚ dane tuÅ¼ przed idealnym wskaÅºnikiem), a **ostatni** adres RET sled musi wskazywaÄ‡ na **`pop <reg>; ret`**.\
W ten sposÃ³b **dane przed idealnym wskaÅºnikiem zostanÄ… usuniÄ™te** ze stosu (to sÄ… dane dotkniÄ™te przez `0x00`) i **koÅ„cowy `ret` bÄ™dzie wskazywaÅ‚ na idealny adres** na stosie bez Å¼adnych zmian.

PodÄ…Å¼ajÄ…c za [**tym linkiem**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2pop.c) moÅ¼esz zobaczyÄ‡ przykÅ‚ad podatnego binarnego i [**w tym** ](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2popexploit.c) exploit.

## References

* [https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md)

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
