# Ret2ret & Reo2pop

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Ret2ret

Glavni cilj ove tehnike je da poku코a da **obi캠e ASLR zloupotrebom postoje캖eg pokaziva캜a na steku**.

U su코tini, prelivanja steka obi캜no uzrokuju stringovi, a **stringovi se zavr코avaju nul-bajtom na kraju** u memoriji. Ovo omogu캖ava da se poku코a smanjiti mesto na koje pokazuje postoje캖i pokaziva캜 ve캖 prisutan na steku. Dakle, ako je stek sadr쬬vao `0xbfffffdd`, ovo prelivanje bi moglo da ga transformi코e u `0xbfffff00` (obratite pa쬹ju na poslednji nulti bajt).

Ako ta adresa pokazuje na na코 shellcode u steku, mogu캖e je usmeriti tok ka toj adresi dodavanjem adresa u **`ret` instrukciju** dok se ne dostigne.

Stoga bi napad izgledao ovako:

* NOP klizaljka
* Shellcode
* Prepisivanje steka iz EIP-a sa **adresama za `ret`** (RET klizaljka)
* 0x00 dodat od strane stringa modifikuju캖i adresu iz steka tako da pokazuje na NOP klizaljku

Prate캖i [**ovu vezu**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2ret.c) mo쬰te videti primer ranjivog binarnog fajla i [**u ovom**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2retexploit.c) eksploataciju.

## Ret2pop

U slu캜aju da mo쬰te prona캖i **savr코eni pokaziva캜 na steku koji ne 쬰lite da modifikujete** (u `ret2ret` menjamo poslednji najni쬴 bajt u `0x00`), mo쬰te izvesti isti `ret2ret` napad, ali **du쬴na RET klizaljke mora biti skra캖ena za 1** (tako da poslednji `0x00` prepisuje podatke neposredno pre savr코enog pokaziva캜a), a **poslednja** adresa RET klizaljke mora pokazivati na **`pop <reg>; ret`**.\
Na ovaj na캜in, **podaci pre savr코enog pokaziva캜a bi캖e uklonjeni** iz steka (to su podaci pogo캠eni `0x00`) i **poslednji `ret` 캖e pokazivati na savr코enu adresu** u steku bez ikakvih promena.

Prate캖i [**ovu vezu**](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2pop.c) mo쬰te videti primer ranjivog binarnog fajla i [**u ovom** ](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/ASLR%20Smack%20and%20Laugh%20reference%20-%20Tilo%20Mueller/ret2popexploit.c) eksploataciju.

## Reference

* [https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md](https://github.com/florianhofhammer/stack-buffer-overflow-internship/blob/master/NOTES.md)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
