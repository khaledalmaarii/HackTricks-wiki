# KÃ¶tÃ¼ AmaÃ§lÄ± YazÄ±lÄ±mlarda KullanÄ±lan Ortak API'lar

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi **HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerin**](https://opensea.io/collection/the-peass-family) yer aldÄ±ÄŸÄ± [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶nderin.

</details>

**Try Hard GÃ¼venlik Grubu**

<figure><img src="../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## Genel

### AÄŸ

| Ham Soketler | WinAPI Soketler |
| ------------- | -------------- |
| socket()      | WSAStratup()   |
| bind()        | bind()         |
| listen()      | listen()       |
| accept()      | accept()       |
| connect()     | connect()      |
| read()/recv() | recv()         |
| write()       | send()         |
| shutdown()    | WSACleanup()   |

### KalÄ±cÄ±lÄ±k

| KayÄ±t Defteri    | Dosya         | Servis                      |
| ---------------- | ------------- | ---------------------------- |
| RegCreateKeyEx() | GetTempPath() | OpenSCManager                |
| RegOpenKeyEx()   | CopyFile()    | CreateService()              |
| RegSetValueEx()  | CreateFile()  | StartServiceCtrlDispatcher() |
| RegDeleteKeyEx() | WriteFile()   |                              |
| RegGetValue()    | ReadFile()    |                              |

### Åifreleme

| AdÄ±                   |
| --------------------- |
| WinCrypt              |
| CryptAcquireContext() |
| CryptGenKey()         |
| CryptDeriveKey()      |
| CryptDecrypt()        |
| CryptReleaseContext() |

### Anti-Analiz/VM

| Fonksiyon AdÄ±                                             | Montaj TalimatlarÄ± |
| --------------------------------------------------------- | ------------------ |
| IsDebuggerPresent()                                       | CPUID()            |
| GetSystemInfo()                                           | IN()               |
| GlobalMemoryStatusEx()                                    |                    |
| GetVersion()                                              |                    |
| CreateToolhelp32Snapshot \[Bir iÅŸlemin Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol et] |                    |
| CreateFileW/A \[Bir dosyanÄ±n var olup olmadÄ±ÄŸÄ±nÄ± kontrol et]                    |                    |

### Gizlilik

| AdÄ±                     |                                                                            |
| ------------------------ | -------------------------------------------------------------------------- |
| VirtualAlloc             | Bellek tahsisi (sÄ±kÄ±ÅŸtÄ±rÄ±cÄ±lar)                                                     |
| VirtualProtect           | Bellek izni deÄŸiÅŸtirme (bir bÃ¶lÃ¼me yÃ¼rÃ¼tme izni veren sÄ±kÄ±ÅŸtÄ±rÄ±cÄ±) |
| ReadProcessMemory        | Harici iÅŸlemlere enjeksiyon                                          |
| WriteProcessMemoryA/W    | Harici iÅŸlemlere enjeksiyon                                          |
| NtWriteVirtualMemory     |                                                                            |
| CreateRemoteThread       | DLL/Ä°ÅŸlem enjeksiyonu...                                                   |
| NtUnmapViewOfSection     |                                                                            |
| QueueUserAPC             |                                                                            |
| CreateProcessInternalA/W |                                                                            |

### YÃ¼rÃ¼tme

| Fonksiyon AdÄ±    |
| ---------------- |
| CreateProcessA/W |
| ShellExecute     |
| WinExec          |
| ResumeThread     |
| NtResumeThread   |

### Ã‡eÅŸitli

* GetAsyncKeyState() -- TuÅŸ kaydÄ±
* SetWindowsHookEx -- TuÅŸ kaydÄ±
* GetForeGroundWindow -- Ã‡alÄ±ÅŸan pencere adÄ±nÄ± al (veya bir tarayÄ±cÄ±dan web sitesini)
* LoadLibrary() -- KÃ¼tÃ¼phane iÃ§e aktar
* GetProcAddress() -- KÃ¼tÃ¼phane iÃ§e aktar
* CreateToolhelp32Snapshot() -- Ã‡alÄ±ÅŸan iÅŸlemleri listele
* GetDC() -- Ekran gÃ¶rÃ¼ntÃ¼sÃ¼
* BitBlt() -- Ekran gÃ¶rÃ¼ntÃ¼sÃ¼
* InternetOpen(), InternetOpenUrl(), InternetReadFile(), InternetWriteFile() -- Ä°nternete eriÅŸim
* FindResource(), LoadResource(), LockResource() -- YÃ¼rÃ¼tÃ¼lebilir dosyanÄ±n kaynaklarÄ±na eriÅŸim

## KÃ¶tÃ¼ AmaÃ§lÄ± YazÄ±lÄ±m Teknikleri

### DLL Enjeksiyonu

BaÅŸka bir iÅŸlem iÃ§inde keyfi bir DLL'yi yÃ¼rÃ¼t

1. KÃ¶tÃ¼ niyetli DLL'yi enjekte etmek iÃ§in iÅŸlemi bul: CreateToolhelp32Snapshot, Process32First, Process32Next
2. Ä°ÅŸlemi aÃ§: GetModuleHandle, GetProcAddress, OpenProcess
3. DLL'nin yolunu iÅŸlem iÃ§ine yaz: VirtualAllocEx, WriteProcessMemory
4. KÃ¶tÃ¼ niyetli DLL'yi yÃ¼kleyecek iÅŸlemde bir iÅŸ parÃ§acÄ±ÄŸÄ± oluÅŸtur: CreateRemoteThread, LoadLibrary

KullanÄ±lacak diÄŸer iÅŸlevler: NTCreateThreadEx, RtlCreateUserThread

### YansÄ±malÄ± DLL Enjeksiyonu

Normal Windows API Ã§aÄŸrÄ±larÄ±nÄ± yapmadan kÃ¶tÃ¼ niyetli bir DLL yÃ¼kle.\
DLL, bir iÅŸlem iÃ§ine eÅŸlenir, iÃ§e aktarma adreslerini Ã§Ã¶zer, yer deÄŸiÅŸtirmeleri dÃ¼zeltir ve DllMain iÅŸlevini Ã§aÄŸÄ±rÄ±r.

### Ä°ÅŸ ParÃ§acÄ±ÄŸÄ± KaÃ§Ä±rma

Bir iÅŸlemde bir iÅŸ parÃ§acÄ±ÄŸÄ±nÄ± bul ve onu kÃ¶tÃ¼ niyetli bir DLL yÃ¼klemeye zorla

1. Hedef iÅŸ parÃ§acÄ±ÄŸÄ±nÄ± bul: CreateToolhelp32Snapshot, Thread32First, Thread32Next
2. Ä°ÅŸ parÃ§acÄ±ÄŸÄ±nÄ± aÃ§: OpenThread
3. Ä°ÅŸ parÃ§acÄ±ÄŸÄ±nÄ± askÄ±ya al: SuspendThread
4. KÃ¶tÃ¼ niyetli DLL'nin yolunu kurban iÅŸlem iÃ§ine yaz: VirtualAllocEx, WriteProcessMemory
5. KÃ¼tÃ¼phaneyi yÃ¼kleyen iÅŸ parÃ§acÄ±ÄŸÄ±nÄ± devam ettir: ResumeThread

### PE Enjeksiyonu

TaÅŸÄ±nabilir YÃ¼rÃ¼tme Enjeksiyonu: YÃ¼rÃ¼tÃ¼lebilir dosya, kurban iÅŸlemin belleÄŸine yazÄ±lacak ve oradan yÃ¼rÃ¼tÃ¼lecek.

### Ä°ÅŸlem BoÅŸaltma

KÃ¶tÃ¼ niyetli yazÄ±lÄ±m, iÅŸlemin belleÄŸinden meÅŸru kodu kaldÄ±rÄ±r ve kÃ¶tÃ¼ niyetli bir ikili yÃ¼kler

1. Yeni bir iÅŸlem oluÅŸtur: CreateProcess
2. BelleÄŸi kaldÄ±r: ZwUnmapViewOfSection, NtUnmapViewOfSection
3. KÃ¶tÃ¼ niyetli ikiliyi iÅŸlem belleÄŸine yaz: VirtualAllocEc, WriteProcessMemory
4. GiriÅŸ noktasÄ±nÄ± ayarla ve yÃ¼rÃ¼t: SetThreadContext, ResumeThread

## Hooking

* **SSDT** (**Sistem Hizmeti TanÄ±m Tablosu**), kullanÄ±cÄ± iÅŸlemlerinin bu iÅŸlevleri (ntoskrnl.exe) veya GUI sÃ¼rÃ¼cÃ¼sÃ¼ (win32k.sys) Ã§aÄŸÄ±rmasÄ±nÄ± saÄŸlayan Ã§ekirdek iÅŸlevlere (ntoskrnl.exe) iÅŸaret eder.
* Bir rootkit, bu iÅŸaretÃ§ileri kendi kontrol ettiÄŸi adreslere deÄŸiÅŸtirebilir
* **IRP** (**GiriÅŸ/Ã‡Ä±kÄ±ÅŸ Ä°steÄŸi Paketleri**), bir bileÅŸenden diÄŸerine veri parÃ§alarÄ± iletir. Ã‡ekirdekte neredeyse her ÅŸey IRP'leri kullanÄ±r ve her cihaz nesnesinin kendi iÅŸlev tablosu vardÄ±r ve bunlar kancalanabilir: DKOM (DoÄŸrudan Ã‡ekirdek Nesne ManipÃ¼lasyonu)
* **IAT** (**Ä°Ã§e Aktarma Adres Tablosu**), baÄŸÄ±mlÄ±lÄ±klarÄ± Ã§Ã¶zmek iÃ§in kullanÄ±ÅŸlÄ±dÄ±r. Bu tabloyu kancalamak, Ã§aÄŸrÄ±lacak kodu ele geÃ§irmeyi saÄŸlar.
* **EAT** (**DÄ±ÅŸa Aktarma Adres Tablosu**) Kancalar. Bu kancalar **kullanÄ±cÄ± alanÄ±ndan** yapÄ±labilir. AmaÃ§, DLL'ler tarafÄ±ndan dÄ±ÅŸa aktarÄ±lan iÅŸlevleri kancalamaktÄ±r.
* **Ä°Ã§ Kancalar**: Bu tÃ¼r, zor bir hedeftir. Bu, iÅŸlevlerin kodunu deÄŸiÅŸtirerek yapÄ±lÄ±r. Belki de bunu baÅŸlangÄ±cÄ±na bir sÄ±Ã§rama koyarak yapabilirsiniz.

**Try Hard GÃ¼venlik Grubu**

<figure><img src="../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi **HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerin**](https://opensea.io/collection/the-peass-family) yer aldÄ±ÄŸÄ± [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking hilelerinizi gÃ¶ndererek PR'ler oluÅŸturun** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.
