# ì•…ì„±ì½”ë“œì—ì„œ ì‚¬ìš©ë˜ëŠ” ì¼ë°˜ì ì¸ API

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## ì¼ë°˜

### ë„¤íŠ¸ì›Œí‚¹

| ì›ì‹œ ì†Œì¼“   | WinAPI ì†Œì¼“ |
| ------------- | -------------- |
| socket()      | WSAStratup()   |
| bind()        | bind()         |
| listen()      | listen()       |
| accept()      | accept()       |
| connect()     | connect()      |
| read()/recv() | recv()         |
| write()       | send()         |
| shutdown()    | WSACleanup()   |

### ì§€ì†ì„±

| ë ˆì§€ìŠ¤íŠ¸ë¦¬         | íŒŒì¼          | ì„œë¹„ìŠ¤                      |
| ---------------- | ------------- | ---------------------------- |
| RegCreateKeyEx() | GetTempPath() | OpenSCManager                |
| RegOpenKeyEx()   | CopyFile()    | CreateService()              |
| RegSetValueEx()  | CreateFile()  | StartServiceCtrlDispatcher() |
| RegDeleteKeyEx() | WriteFile()   |                              |
| RegGetValue()    | ReadFile()    |                              |

### ì•”í˜¸í™”

| ì´ë¦„                  |
| --------------------- |
| WinCrypt              |
| CryptAcquireContext() |
| CryptGenKey()         |
| CryptDeriveKey()      |
| CryptDecrypt()        |
| CryptReleaseContext() |

### ë¶„ì„ ë°©ì§€/VM

| í•¨ìˆ˜ ì´ë¦„                                             | ì–´ì…ˆë¸”ë¦¬ ëª…ë ¹ì–´ |
| --------------------------------------------------------- | --------------------- |
| IsDebuggerPresent()                                       | CPUID()               |
| GetSystemInfo()                                           | IN()                  |
| GlobalMemoryStatusEx()                                    |                       |
| GetVersion()                                              |                       |
| CreateToolhelp32Snapshot \[í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸] |                       |
| CreateFileW/A \[íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸]                    |                       |

### ìŠ¤í…”ìŠ¤

| ì´ë¦„                     |                                                                            |
| ------------------------ | -------------------------------------------------------------------------- |
| VirtualAlloc             | ë©”ëª¨ë¦¬ í• ë‹¹ (íŒ¨ì»¤)                                                       |
| VirtualProtect           | ë©”ëª¨ë¦¬ ê¶Œí•œ ë³€ê²½ (íŒ¨ì»¤ê°€ ì„¹ì…˜ì— ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬)                          |
| ReadProcessMemory        | ì™¸ë¶€ í”„ë¡œì„¸ìŠ¤ì— ì£¼ì…                                                      |
| WriteProcessMemoryA/W    | ì™¸ë¶€ í”„ë¡œì„¸ìŠ¤ì— ì£¼ì…                                                      |
| NtWriteVirtualMemory     |                                                                            |
| CreateRemoteThread       | DLL/í”„ë¡œì„¸ìŠ¤ ì£¼ì…...                                                     |
| NtUnmapViewOfSection     |                                                                            |
| QueueUserAPC             |                                                                            |
| CreateProcessInternalA/W |                                                                            |

### ì‹¤í–‰

| í•¨ìˆ˜ ì´ë¦„    |
| ---------------- |
| CreateProcessA/W |
| ShellExecute     |
| WinExec          |
| ResumeThread     |
| NtResumeThread   |

### ê¸°íƒ€

* GetAsyncKeyState() -- í‚¤ ë¡œê¹…
* SetWindowsHookEx -- í‚¤ ë¡œê¹…
* GetForeGroundWindow -- ì‹¤í–‰ ì¤‘ì¸ ì°½ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° (ë˜ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì›¹ì‚¬ì´íŠ¸)
* LoadLibrary() -- ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
* GetProcAddress() -- ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
* CreateToolhelp32Snapshot() -- ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ëª©ë¡
* GetDC() -- ìŠ¤í¬ë¦°ìƒ·
* BitBlt() -- ìŠ¤í¬ë¦°ìƒ·
* InternetOpen(), InternetOpenUrl(), InternetReadFile(), InternetWriteFile() -- ì¸í„°ë„· ì ‘ê·¼
* FindResource(), LoadResource(), LockResource() -- ì‹¤í–‰ íŒŒì¼ì˜ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼

## ì•…ì„±ì½”ë“œ ê¸°ë²•

### DLL ì£¼ì…

ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ ë‚´ì—ì„œ ì„ì˜ì˜ DLL ì‹¤í–‰

1. ì•…ì„± DLLì„ ì£¼ì…í•  í”„ë¡œì„¸ìŠ¤ ì°¾ê¸°: CreateToolhelp32Snapshot, Process32First, Process32Next
2. í”„ë¡œì„¸ìŠ¤ ì—´ê¸°: GetModuleHandle, GetProcAddress, OpenProcess
3. í”„ë¡œì„¸ìŠ¤ ë‚´ì— DLL ê²½ë¡œ ì“°ê¸°: VirtualAllocEx, WriteProcessMemory
4. ì•…ì„± DLLì„ ë¡œë“œí•  í”„ë¡œì„¸ìŠ¤ ë‚´ì—ì„œ ìŠ¤ë ˆë“œ ìƒì„±: CreateRemoteThread, LoadLibrary

ì‚¬ìš©í•  ë‹¤ë¥¸ í•¨ìˆ˜: NTCreateThreadEx, RtlCreateUserThread

### ë°˜ì‚¬ DLL ì£¼ì…

ì •ìƒ Windows API í˜¸ì¶œ ì—†ì´ ì•…ì„± DLL ë¡œë“œ.\
DLLì€ í”„ë¡œì„¸ìŠ¤ ë‚´ì— ë§¤í•‘ë˜ë©°, ê°€ì ¸ì˜¤ê¸° ì£¼ì†Œë¥¼ í•´ê²°í•˜ê³ , ì¬ë°°ì¹˜ë¥¼ ìˆ˜ì •í•˜ê³ , DllMain í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

### ìŠ¤ë ˆë“œ í•˜ì´ì¬í‚¹

í”„ë¡œì„¸ìŠ¤ì—ì„œ ìŠ¤ë ˆë“œë¥¼ ì°¾ì•„ ì•…ì„± DLLì„ ë¡œë“œí•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.

1. ëŒ€ìƒ ìŠ¤ë ˆë“œ ì°¾ê¸°: CreateToolhelp32Snapshot, Thread32First, Thread32Next
2. ìŠ¤ë ˆë“œ ì—´ê¸°: OpenThread
3. ìŠ¤ë ˆë“œ ì¼ì‹œ ì¤‘ì§€: SuspendThread
4. í”¼í•´ì í”„ë¡œì„¸ìŠ¤ ë‚´ì— ì•…ì„± DLL ê²½ë¡œ ì“°ê¸°: VirtualAllocEx, WriteProcessMemory
5. ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•˜ëŠ” ìŠ¤ë ˆë“œ ì¬ê°œ: ResumeThread

### PE ì£¼ì…

íœ´ëŒ€ìš© ì‹¤í–‰ ì£¼ì…: ì‹¤í–‰ íŒŒì¼ì´ í”¼í•´ì í”„ë¡œì„¸ìŠ¤ì˜ ë©”ëª¨ë¦¬ì— ê¸°ë¡ë˜ê³  ê±°ê¸°ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

### í”„ë¡œì„¸ìŠ¤ í™€ë¡œì‰

ì•…ì„±ì½”ë“œëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ë©”ëª¨ë¦¬ì—ì„œ í•©ë²•ì ì¸ ì½”ë“œë¥¼ ì–¸ë§µí•˜ê³  ì•…ì„± ë°”ì´ë„ˆë¦¬ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.

1. ìƒˆ í”„ë¡œì„¸ìŠ¤ ìƒì„±: CreateProcess
2. ë©”ëª¨ë¦¬ ì–¸ë§µ: ZwUnmapViewOfSection, NtUnmapViewOfSection
3. í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ì— ì•…ì„± ë°”ì´ë„ˆë¦¬ ì“°ê¸°: VirtualAllocEc, WriteProcessMemory
4. ì§„ì…ì ì„ ì„¤ì •í•˜ê³  ì‹¤í–‰: SetThreadContext, ResumeThread

## í›„í‚¹

* **SSDT** (**ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ ì„¤ëª…ì í…Œì´ë¸”**)ì€ ì»¤ë„ í•¨ìˆ˜(ntoskrnl.exe) ë˜ëŠ” GUI ë“œë¼ì´ë²„(win32k.sys)ë¥¼ ê°€ë¦¬ì¼œ ì‚¬ìš©ì í”„ë¡œì„¸ìŠ¤ê°€ ì´ëŸ¬í•œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
* ë£¨íŠ¸í‚·ì€ ì´ëŸ¬í•œ í¬ì¸í„°ë¥¼ ìì‹ ì´ ì œì–´í•˜ëŠ” ì£¼ì†Œë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **IRP** (**I/O ìš”ì²­ íŒ¨í‚·**)ì€ í•œ êµ¬ì„± ìš”ì†Œì—ì„œ ë‹¤ë¥¸ êµ¬ì„± ìš”ì†Œë¡œ ë°ì´í„° ì¡°ê°ì„ ì „ì†¡í•©ë‹ˆë‹¤. ì»¤ë„ì˜ ê±°ì˜ ëª¨ë“  ê²ƒì´ IRPë¥¼ ì‚¬ìš©í•˜ë©° ê° ì¥ì¹˜ ê°ì²´ëŠ” í›„í‚¹í•  ìˆ˜ ìˆëŠ” ìì²´ í•¨ìˆ˜ í…Œì´ë¸”ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤: DKOM (ì§ì ‘ ì»¤ë„ ê°ì²´ ì¡°ì‘)
* **IAT** (**ê°€ì ¸ì˜¤ê¸° ì£¼ì†Œ í…Œì´ë¸”**)ì€ ì¢…ì†ì„±ì„ í•´ê²°í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤. ì´ í…Œì´ë¸”ì„ í›„í‚¹í•˜ì—¬ í˜¸ì¶œë  ì½”ë“œë¥¼ í•˜ì´ì¬í‚¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **EAT** (**ë‚´ë³´ë‚´ê¸° ì£¼ì†Œ í…Œì´ë¸”**) í›„í‚¹. ì´ í›„í‚¹ì€ **ìœ ì €ëœë“œ**ì—ì„œ ìˆ˜í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª©í‘œëŠ” DLLì— ì˜í•´ ë‚´ë³´ë‚´ì§„ í•¨ìˆ˜ë¥¼ í›„í‚¹í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
* **ì¸ë¼ì¸ í›„í‚¹**: ì´ ìœ í˜•ì€ ë‹¬ì„±í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. ì´ëŠ” í•¨ìˆ˜ ìì²´ì˜ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. ì•„ë§ˆë„ ì´ì˜ ì‹œì‘ ë¶€ë¶„ì— ì í”„ë¥¼ ë„£ëŠ” ë°©ì‹ìœ¼ë¡œ. 

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
