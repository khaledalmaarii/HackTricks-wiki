# Pentesting BLE - Bluetooth Low Energy

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Einf√ºhrung

Seit der Bluetooth 4.0-Spezifikation verwendet BLE nur 40 Kan√§le, die den Bereich von 2400 bis 2483,5 MHz abdecken. Im Gegensatz dazu verwendet traditionelles Bluetooth 79 Kan√§le im selben Bereich.

BLE-Ger√§te kommunizieren, indem sie **Werbepakete** (**Beacons**) senden, diese Pakete senden die Existenz des BLE-Ger√§ts an andere nahegelegene Ger√§te. Diese Beacons **senden manchmal auch Daten**.

Das h√∂rende Ger√§t, auch als zentrales Ger√§t bezeichnet, kann auf ein Werbepaket mit einer **SCAN-Anfrage** reagieren, die speziell an das werbende Ger√§t gesendet wird. Die **Antwort** auf diesen Scan verwendet die gleiche Struktur wie das **Werbepaket** mit zus√§tzlichen Informationen, die nicht in die urspr√ºngliche Werbeanfrage passten, wie den vollst√§ndigen Ger√§tenamen.

![](<../../.gitbook/assets/image (152).png>)

Das Pr√§ambelbyte synchronisiert die Frequenz, w√§hrend die vierbyte Zugangsadresse ein **Verbindungsidentifier** ist, der in Szenarien verwendet wird, in denen mehrere Ger√§te versuchen, Verbindungen auf denselben Kan√§len herzustellen. Als n√§chstes enth√§lt die Protokolldateneinheit (**PDU**) die **Werbedaten**. Es gibt mehrere Arten von PDU; die am h√§ufigsten verwendeten sind ADV\_NONCONN\_IND und ADV\_IND. Ger√§te verwenden den PDU-Typ **ADV\_NONCONN\_IND**, wenn sie **keine Verbindungen akzeptieren**, und √ºbertragen Daten nur im Werbepaket. Ger√§te verwenden **ADV\_IND**, wenn sie **Verbindungen zulassen** und **aufh√∂ren, Werbepakete** zu senden, sobald eine **Verbindung** **hergestellt** wurde.

### GATT

Das **Generic Attribute Profile** (GATT) definiert, wie das **Ger√§t Daten formatieren und √ºbertragen** sollte. Wenn Sie die Angriffsfl√§che eines BLE-Ger√§ts analysieren, konzentrieren Sie oft Ihre Aufmerksamkeit auf das GATT (oder GATTs), da es bestimmt, wie die **Ger√§tefunktionalit√§t ausgel√∂st** wird und wie Daten gespeichert, gruppiert und modifiziert werden. Das GATT listet die Merkmale, Deskriptoren und Dienste eines Ger√§ts in einer Tabelle als 16- oder 32-Bit-Werte auf. Ein **Merkmal** ist ein **Daten**wert, der zwischen dem zentralen Ger√§t und dem Peripherieger√§t **gesendet** wird. Diese Merkmale k√∂nnen **Deskriptoren** haben, die **zus√§tzliche Informationen √ºber sie bereitstellen**. **Merkmale** werden oft in **Diensten** **gruppiert**, wenn sie mit der Ausf√ºhrung einer bestimmten Aktion zusammenh√§ngen.

## Aufz√§hlung
```bash
hciconfig #Check config, check if UP or DOWN
# If DOWN try:
sudo modprobe -c bluetooth
sudo hciconfig hci0 down && sudo hciconfig hci0 up

# Spoof MAC
spooftooph -i hci0 -a 11:22:33:44:55:66
```
### GATTool

**GATTool** erm√∂glicht es, eine **Verbindung** mit einem anderen Ger√§t herzustellen, die **Eigenschaften** dieses Ger√§ts aufzulisten und seine Attribute zu lesen und zu schreiben.\
GATTTool kann mit der Option `-I` eine interaktive Shell starten:
```bash
gatttool -i hci0 -I
[ ][LE]> connect 24:62:AB:B1:A8:3E Attempting to connect to A4:CF:12:6C:B3:76 Connection successful
[A4:CF:12:6C:B3:76][LE]> characteristics
handle: 0x0002, char properties: 0x20, char value handle:
0x0003, uuid: 00002a05-0000-1000-8000-00805f9b34fb
handle: 0x0015, char properties: 0x02, char value handle:
0x0016, uuid: 00002a00-0000-1000-8000-00805f9b34fb
[...]

# Write data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-write-req <characteristic handle> -n <value>
gatttool -b a4:cf:12:6c:b3:76 --char-write-req -a 0x002e -n $(echo -n "04dc54d9053b4307680a"|xxd -ps)

# Read data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-read -a 0x16

# Read connecting with an authenticated encrypted connection
gatttool --sec-level=high -b a4:cf:12:6c:b3:76 --char-read -a 0x002c
```
### Bettercap
```bash
# Start listening for beacons
sudo bettercap --eval "ble.recon on"
# Wait some time
>> ble.show # Show discovered devices
>> ble.enum <mac addr> # This will show the service, characteristics and properties supported

# Write data in a characteristic
>> ble.write <MAC ADDR> <UUID> <HEX DATA>
>> ble.write <mac address of device> ff06 68656c6c6f # Write "hello" in ff06
```
{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
