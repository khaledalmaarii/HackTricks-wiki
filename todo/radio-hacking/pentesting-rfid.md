# Pentesting RFID

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

## Introdu√ß√£o

**Identifica√ß√£o por Radiofrequ√™ncia (RFID)** √© a solu√ß√£o de r√°dio de curto alcance mais popular. Geralmente √© usada para armazenar e transmitir informa√ß√µes que identificam uma entidade.

Uma etiqueta RFID pode depender de **sua pr√≥pria fonte de energia (ativa)**, como uma bateria embutida, ou receber sua energia da antena de leitura usando a corrente **induzida pelas ondas de r√°dio recebidas** (**passiva**).

### Classes

A EPCglobal divide as etiquetas RFID em seis categorias. Uma etiqueta em cada categoria possui todas as capacidades listadas na categoria anterior, tornando-a retrocompat√≠vel.

* As etiquetas **Classe 0** s√£o etiquetas **passivas** que operam em bandas **UHF**. O fornecedor **pr√©-programa** elas na f√°brica de produ√ß√£o. Como resultado, voc√™ **n√£o pode alterar** as informa√ß√µes armazenadas em sua mem√≥ria.
* As etiquetas **Classe 1** tamb√©m podem operar em bandas **HF**. Al√©m disso, elas podem ser **gravadas apenas uma vez** ap√≥s a produ√ß√£o. Muitas etiquetas Classe 1 tamb√©m podem processar **verifica√ß√µes de redund√¢ncia c√≠clica** (CRCs) dos comandos que recebem. Os CRCs s√£o alguns bytes extras no final dos comandos para detec√ß√£o de erros.
* As etiquetas **Classe 2** podem ser **gravadas v√°rias vezes**.
* As etiquetas **Classe 3** podem conter **sensores embutidos** que podem registrar par√¢metros ambientais, como a temperatura atual ou o movimento da etiqueta. Essas etiquetas s√£o **semi-passivas**, porque embora tenham uma fonte de energia embutida, como uma **bateria** integrada, elas **n√£o podem iniciar** a **comunica√ß√£o** sem fio com outras etiquetas ou leitores.
* As etiquetas **Classe 4** podem iniciar comunica√ß√£o com outras etiquetas da mesma classe, tornando-as **etiquetas ativas**.
* As etiquetas **Classe 5** podem fornecer **energia para outras etiquetas e se comunicar com todas as classes de etiquetas anteriores**. As etiquetas Classe 5 podem atuar como **leitores RFID**.

### Informa√ß√µes Armazenadas em Etiquetas RFID

A mem√≥ria de uma etiqueta RFID geralmente armazena quatro tipos de dados: os **dados de identifica√ß√£o**, que **identificam** a **entidade** √† qual a etiqueta est√° anexada (esses dados incluem campos definidos pelo usu√°rio, como contas banc√°rias); os **dados suplementares**, que fornecem **mais** **detalhes** sobre a entidade; os **dados de controle**, usados para a **configura√ß√£o** interna da etiqueta; e os **dados do fabricante** da etiqueta, que cont√™m um Identificador √önico da etiqueta (**UID**) e detalhes sobre a **produ√ß√£o**, **tipo** e **fornecedor** da etiqueta. Voc√™ encontrar√° os dois primeiros tipos de dados em todas as etiquetas comerciais; os √∫ltimos dois podem diferir com base no fornecedor da etiqueta.

O padr√£o ISO especifica o valor do Identificador de Fam√≠lia de Aplica√ß√£o (**AFI**), um c√≥digo que indica o **tipo de objeto** ao qual a etiqueta pertence. Outro registro importante, tamb√©m especificado pela ISO, √© o Identificador de Formato de Armazenamento de Dados (**DSFID**), que define a **organiza√ß√£o l√≥gica dos dados do usu√°rio**.

A maioria dos **controles de seguran√ßa** RFID possui mecanismos que **restrigem** as opera√ß√µes de **leitura** ou **grava√ß√£o** em cada bloco de mem√≥ria do usu√°rio e nos registros especiais que cont√™m os valores AFI e DSFID. Esses **mecanismos de bloqueio** usam dados armazenados na mem√≥ria de controle e t√™m **senhas padr√£o** pr√©-configuradas pelo fornecedor, mas permitem que os propriet√°rios da etiqueta **configurem senhas personalizadas**.

### Compara√ß√£o de Etiquetas de Baixa e Alta Frequ√™ncia

<figure><img src="../../.gitbook/assets/image (983).png" alt=""><figcaption></figcaption></figure>

## Etiquetas RFID de Baixa Frequ√™ncia (125kHz)

As **etiquetas de baixa frequ√™ncia** s√£o frequentemente usadas em sistemas que **n√£o requerem alta seguran√ßa**: acesso a pr√©dios, chaves de intercomunicador, cart√µes de associa√ß√£o de academias, etc. Devido ao seu maior alcance, s√£o convenientes para uso em estacionamento pago: o motorista n√£o precisa trazer o cart√£o perto do leitor, pois √© acionado de mais longe. Ao mesmo tempo, as etiquetas de baixa frequ√™ncia s√£o muito primitivas, t√™m uma baixa taxa de transfer√™ncia de dados. Por essa raz√£o, √© imposs√≠vel implementar transfer√™ncias de dados bidirecionais complexas para coisas como manter saldo e criptografia. As etiquetas de baixa frequ√™ncia apenas transmitem seu ID curto sem qualquer meio de autentica√ß√£o.

Esses dispositivos dependem da tecnologia **RFID** **passiva** e operam em uma **faixa de 30 kHz a 300 kHz**, embora seja mais comum usar 125 kHz a 134 kHz:

* **Longo Alcance** ‚Äî frequ√™ncia mais baixa se traduz em maior alcance. Existem alguns leitores EM-Marin e HID, que funcionam a uma dist√¢ncia de at√© um metro. Esses s√£o frequentemente usados em estacionamentos.
* **Protocolo primitivo** ‚Äî devido √† baixa taxa de transfer√™ncia de dados, essas etiquetas podem apenas transmitir seu ID curto. Na maioria dos casos, os dados n√£o s√£o autenticados e n√£o est√£o protegidos de forma alguma. Assim que o cart√£o est√° na faixa do leitor, ele come√ßa a transmitir seu ID.
* **Baixa seguran√ßa** ‚Äî Esses cart√µes podem ser facilmente copiados ou at√© mesmo lidos do bolso de outra pessoa devido √† primitividade do protocolo.

**Protocolos populares de 125 kHz:**

* **EM-Marin** ‚Äî EM4100, EM4102. O protocolo mais popular na CEI. Pode ser lido a cerca de um metro devido √† sua simplicidade e estabilidade.
* **HID Prox II** ‚Äî protocolo de baixa frequ√™ncia introduzido pela HID Global. Este protocolo √© mais popular em pa√≠ses ocidentais. √â mais complexo e os cart√µes e leitores para este protocolo s√£o relativamente caros.
* **Indala** ‚Äî protocolo de baixa frequ√™ncia muito antigo que foi introduzido pela Motorola e, posteriormente, adquirido pela HID. √â menos prov√°vel que voc√™ o encontre na natureza em compara√ß√£o com os dois anteriores, pois est√° caindo em desuso.

Na realidade, existem muitos mais protocolos de baixa frequ√™ncia. Mas todos usam a mesma modula√ß√£o na camada f√≠sica e podem ser considerados, de uma forma ou de outra, uma varia√ß√£o dos listados acima.

### Ataque

Voc√™ pode **atacar essas Etiquetas com o Flipper Zero**:

{% content-ref url="flipper-zero/fz-125khz-rfid.md" %}
[fz-125khz-rfid.md](flipper-zero/fz-125khz-rfid.md)
{% endcontent-ref %}

## Etiquetas RFID de Alta Frequ√™ncia (13.56 MHz)

As **etiquetas de alta frequ√™ncia** s√£o usadas para uma intera√ß√£o mais complexa entre leitor e etiqueta quando voc√™ precisa de criptografia, uma grande transfer√™ncia de dados bidirecional, autentica√ß√£o, etc.\
Geralmente s√£o encontradas em cart√µes banc√°rios, transporte p√∫blico e outros passes seguros.

As **etiquetas de alta frequ√™ncia de 13.56 MHz s√£o um conjunto de padr√µes e protocolos**. Elas s√£o geralmente referidas como [NFC](https://nfc-forum.org/what-is-nfc/about-the-technology/), mas isso nem sempre √© correto. O conjunto b√°sico de protocolos usados nos n√≠veis f√≠sico e l√≥gico √© o ISO 14443. Protocolos de alto n√≠vel, bem como padr√µes alternativos (como ISO 19092), s√£o baseados nele. Muitas pessoas se referem a essa tecnologia como **Comunica√ß√£o em Campo Pr√≥ximo (NFC)**, um termo para dispositivos que operam na frequ√™ncia de 13.56 MHz.

<figure><img src="../../.gitbook/assets/image (930).png" alt=""><figcaption></figcaption></figure>

Simplificando, a arquitetura do NFC funciona assim: o protocolo de transmiss√£o √© escolhido pela empresa que fabrica os cart√µes e implementado com base no ISO 14443 de baixo n√≠vel. Por exemplo, a NXP inventou seu pr√≥prio protocolo de transmiss√£o de alto n√≠vel chamado Mifare. Mas no n√≠vel inferior, os cart√µes Mifare s√£o baseados no padr√£o ISO 14443-A.

O Flipper pode interagir tanto com o protocolo ISO 14443 de baixo n√≠vel, quanto com o protocolo de transfer√™ncia de dados Mifare Ultralight e EMV usado em cart√µes banc√°rios. Estamos trabalhando para adicionar suporte para Mifare Classic e NFC NDEF. Uma an√°lise detalhada dos protocolos e padr√µes que comp√µem o NFC merece um artigo separado que planejamos publicar mais tarde.

Todos os cart√µes de alta frequ√™ncia baseados no padr√£o ISO 14443-A t√™m um ID de chip √∫nico. Ele atua como o n√∫mero de s√©rie do cart√£o, como o endere√ßo MAC de um cart√£o de rede. **Normalmente, o UID tem 4 ou 7 bytes de comprimento**, mas pode raramente chegar **a 10**. Os UIDs n√£o s√£o um segredo e s√£o facilmente leg√≠veis, **√†s vezes at√© impressos no pr√≥prio cart√£o**.

Existem muitos sistemas de controle de acesso que dependem do UID para **autenticar e conceder acesso**. √Äs vezes isso acontece **mesmo** quando as etiquetas RFID **suportam criptografia**. Tal **uso indevido** as reduz ao n√≠vel dos **cart√µes de 125 kHz** em termos de **seguran√ßa**. Cart√µes virtuais (como Apple Pay) usam um UID din√¢mico para que os propriet√°rios de telefones n√£o abram portas com seu aplicativo de pagamento.

* **Baixo alcance** ‚Äî cart√µes de alta frequ√™ncia s√£o especificamente projetados para que precisem ser colocados perto do leitor. Isso tamb√©m ajuda a proteger o cart√£o de intera√ß√µes n√£o autorizadas. O alcance m√°ximo de leitura que conseguimos alcan√ßar foi de cerca de 15 cm, e isso foi com leitores de longo alcance feitos sob medida.
* **Protocolos avan√ßados** ‚Äî velocidades de transfer√™ncia de dados de at√© 424 kbps permitem protocolos complexos com transfer√™ncia de dados bidirecional completa. O que, por sua vez, **permite criptografia**, transfer√™ncia de dados, etc.
* **Alta seguran√ßa** ‚Äî cart√µes de contato sem fio de alta frequ√™ncia n√£o s√£o de forma alguma inferiores aos cart√µes inteligentes. Existem cart√µes que suportam algoritmos criptograficamente fortes como AES e implementam criptografia assim√©trica.

### Ataque

Voc√™ pode **atacar essas Etiquetas com o Flipper Zero**:

{% content-ref url="flipper-zero/fz-nfc.md" %}
[fz-nfc.md](flipper-zero/fz-nfc.md)
{% endcontent-ref %}

Ou usando o **proxmark**:

{% content-ref url="proxmark-3.md" %}
[proxmark-3.md](proxmark-3.md)
{% endcontent-ref %}

## Refer√™ncias

* [https://blog.flipperzero.one/rfid/](https://blog.flipperzero.one/rfid/)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
