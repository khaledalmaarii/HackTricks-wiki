# Active Directory Methodology

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic overview

**Active Directory** рдПрдХ рдореМрд▓рд┐рдХ рддрдХрдиреАрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдЬреЛ **рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ** рдХреЛ рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рднреАрддрд░ **рдбреЛрдореЗрди**, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ**, рдФрд░ **рд╡рд╕реНрддреБрдУрдВ** рдХреЛ рдХреБрд╢рд▓рддрд╛рдкреВрд░реНрд╡рдХ рдмрдирд╛рдиреЗ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддрд╛ рд╣реИред рдЗрд╕реЗ рд╕реНрдХреЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рдмрдВрдзрдиреАрдп **рд╕рдореВрд╣реЛрдВ** рдФрд░ **рдЙрдкрд╕рдореВрд╣реЛрдВ** рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рд╡рд┐рднрд┐рдиреНрди рд╕реНрддрд░реЛрдВ рдкрд░ **рдкрд╣реБрдБрдЪ рдЕрдзрд┐рдХрд╛рд░реЛрдВ** рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред

**Active Directory** рдХреА рд╕рдВрд░рдЪрдирд╛ рддреАрди рдкреНрд░рд╛рдердорд┐рдХ рдкрд░рддреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рд╣реИ: **рдбреЛрдореЗрди**, **рдкреЗрдбрд╝**, рдФрд░ **рдЬрдВрдЧрд▓**ред рдПрдХ **рдбреЛрдореЗрди** рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдПрдХ рд╕рдВрдЧреНрд░рд╣ рд╣реИ, рдЬреИрд╕реЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдпрд╛ **рдбрд┐рд╡рд╛рдЗрд╕**, рдЬреЛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдбреЗрдЯрд╛рдмреЗрд╕ рд╕рд╛рдЭрд╛ рдХрд░рддреЗ рд╣реИрдВред **рдкреЗрдбрд╝** рдЗрди рдбреЛрдореЗрдиреЛрдВ рдХреЗ рд╕рдореВрд╣ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рд╕рд╛рдЭрд╛ рд╕рдВрд░рдЪрдирд╛ рджреНрд╡рд╛рд░рд╛ рдЬреБрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдПрдХ **рдЬрдВрдЧрд▓** рдХрдИ рдкреЗрдбрд╝реЛрдВ рдХрд╛ рд╕рдВрдЧреНрд░рд╣ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ **рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдзреЛрдВ** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдкрд╕ рдореЗрдВ рдЬреБрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВ, рдЬреЛ рд╕рдВрдЧрдардирд╛рддреНрдордХ рд╕рдВрд░рдЪрдирд╛ рдХреА рд╕рдмрд╕реЗ рдКрдкрд░реА рдкрд░рдд рдмрдирд╛рддреЗ рд╣реИрдВред рдкреНрд░рддреНрдпреЗрдХ рд╕реНрддрд░ рдкрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ **рдкрд╣реБрдБрдЪ** рдФрд░ **рд╕рдВрдЪрд╛рд░ рдЕрдзрд┐рдХрд╛рд░** рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

**Active Directory** рдХреЗ рднреАрддрд░ рдкреНрд░рдореБрдЦ рдЕрд╡рдзрд╛рд░рдгрд╛рдПрдБ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

1. **Directory** тАУ Active Directory рд╡рд╕реНрддреБрдУрдВ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд░рдЦрддрд╛ рд╣реИред
2. **Object** тАУ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рднреАрддрд░ рдХреА рд╕рдВрд╕реНрдерд╛рдПрдБ, рдЬрд┐рд╕рдореЗрдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛**, **рд╕рдореВрд╣**, рдпрд╛ **рд╕рд╛рдЭрд╛ рдлрд╝реЛрд▓реНрдбрд░** рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
3. **Domain** тАУ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрдВрдЯреЗрдирд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХрдИ рдбреЛрдореЗрдиреЛрдВ рдХрд╛ рдПрдХ **рдЬрдВрдЧрд▓** рдореЗрдВ рд╕рд╣-рдЕрд╕реНрддрд┐рддреНрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдкреНрд░рддреНрдпреЗрдХ рдЕрдкрдиреА рд╕реНрд╡рдпрдВ рдХреА рд╡рд╕реНрддреБ рд╕рдВрдЧреНрд░рд╣ рдмрдирд╛рдП рд░рдЦрддрд╛ рд╣реИред
4. **Tree** тАУ рдбреЛрдореЗрдиреЛрдВ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рдЬреЛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдЯ рдбреЛрдореЗрди рд╕рд╛рдЭрд╛ рдХрд░рддрд╛ рд╣реИред
5. **Forest** тАУ Active Directory рдореЗрдВ рд╕рдВрдЧрдардирд╛рддреНрдордХ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рд╢рд┐рдЦрд░, рдЬрд┐рд╕рдореЗрдВ рдХрдИ рдкреЗрдбрд╝ рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ **рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдз** рд╣реЛрддреЗ рд╣реИрдВред

**Active Directory Domain Services (AD DS)** рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреА рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рднреАрддрд░ рдХреЗрдВрджреНрд░реАрдХреГрдд рдкреНрд░рдмрдВрдзрди рдФрд░ рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

1. **Domain Services** тАУ рдбреЗрдЯрд╛ рднрдВрдбрд╛рд░рдг рдХреЛ рдХреЗрдВрджреНрд░реАрдХреГрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдФрд░ **рдбреЛрдореЗрдиреЛрдВ** рдХреЗ рдмреАрдЪ рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдФрд░ **рдЦреЛрдЬ** рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдПрдБ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
2. **Certificate Services** тАУ рд╕реБрд░рдХреНрд╖рд┐рдд **рдбрд┐рдЬрд┐рдЯрд▓ рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ** рдХреЗ рдирд┐рд░реНрдорд╛рдг, рд╡рд┐рддрд░рдг, рдФрд░ рдкреНрд░рдмрдВрдзрди рдХреА рджреЗрдЦрд░реЗрдЦ рдХрд░рддрд╛ рд╣реИред
3. **Lightweight Directory Services** тАУ **LDAP рдкреНрд░реЛрдЯреЛрдХреЙрд▓** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛-рд╕рдХреНрд╖рдо рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред
4. **Directory Federation Services** тАУ рдПрдХрд▓ рд╕рддреНрд░ рдореЗрдВ рдХрдИ рд╡реЗрдм рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд╕рд┐рдВрдЧрд▓-рд╕рд╛рдЗрди-рдСрди** рдХреНрд╖рдорддрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
5. **Rights Management** тАУ рдЕрдирдзрд┐рдХреГрдд рд╡рд┐рддрд░рдг рдФрд░ рдЙрдкрдпреЛрдЧ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдХреЗ рдХреЙрдкреАрд░рд╛рдЗрдЯ рд╕рд╛рдордЧреНрд░реА рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рд╕рд╣рд╛рдпрддрд╛ рдХрд░рддрд╛ рд╣реИред
6. **DNS Service** тАУ **рдбреЛрдореЗрди рдирд╛рдореЛрдВ** рдХреЗ рд╕рдорд╛рдзрд╛рди рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред

рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ: [**TechTerms - Active Directory Definition**](https://techterms.com/definition/active\_directory)

### **Kerberos Authentication**

**AD рдкрд░ рд╣рдорд▓рд╛ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **Kerberos рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдХреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ **рд╕рдордЭрдирд╛** рд╣реЛрдЧрд╛ред\
[**рдпрджрд┐ рдЖрдк рдЕрднреА рднреА рдирд╣реАрдВ рдЬрд╛рдирддреЗ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рдкрдврд╝реЗрдВред**](kerberos-authentication.md)

## Cheat Sheet

рдЖрдк [https://wadcoms.github.io/](https://wadcoms.github.io) рдкрд░ рдЬрд╛рдХрд░ AD рдХреЛ рд╕реВрдЪреАрдмрджреНрдз/рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХреМрди рд╕реЗ рдХрдорд╛рдВрдб рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рдХрд╛ рддреНрд╡рд░рд┐рдд рджреГрд╢реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## Recon Active Directory (No creds/sessions)

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ AD рд╡рд╛рддрд╛рд╡рд░рдг рддрдХ рдкрд╣реБрдБрдЪ рд╣реИ рд▓реЗрдХрд┐рди рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреЛрдИ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓/рд╕рддреНрд░ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* **рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ:**
* рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рд╕реНрдХреИрди рдХрд░реЗрдВ, рдорд╢реАрдиреЗрдВ рдФрд░ рдЦреБрд▓реЗ рдкреЛрд░реНрдЯ рдЦреЛрдЬреЗрдВ рдФрд░ рдЙрди рдкрд░ **рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рд╢реЛрд╖рдг** рдХрд░рдиреЗ рдпрд╛ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдирд┐рдХрд╛рд▓рдиреЗ** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, [рдкреНрд░рд┐рдВрдЯрд░ рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рд▓рдХреНрд╖реНрдп рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ](ad-information-in-printers.md)ред
* DNS рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдирд╛ рдбреЛрдореЗрди рдореЗрдВ рдкреНрд░рдореБрдЦ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рджреЗ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ рдХрд┐ рд╡реЗрдм, рдкреНрд░рд┐рдВрдЯрд░, рд╢реЗрдпрд░, рд╡реАрдкреАрдПрди, рдореАрдбрд┐рдпрд╛, рдЖрджрд┐ред
* `gobuster dns -d domain.local -t 25 -w /opt/Seclist/Discovery/DNS/subdomain-top2000.txt`
* рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп [**Pentesting Methodology**](../../generic-methodologies-and-resources/pentesting-methodology.md) рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ рдХрд┐ рдЗрд╕реЗ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИред
* **smb рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рд╢реВрдиреНрдп рдФрд░ рдЧреЗрд╕реНрдЯ рдкрд╣реБрдБрдЪ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ** (рдпрд╣ рдЖрдзреБрдирд┐рдХ Windows рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдкрд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛):
* `enum4linux -a -u "" -p "" <DC IP> && enum4linux -a -u "guest" -p "" <DC IP>`
* `smbmap -u "" -p "" -P 445 -H <DC IP> && smbmap -u "guest" -p "" -P 445 -H <DC IP>`
* `smbclient -U '%' -L //<DC IP> && smbclient -U 'guest%' -L //`
* рдПрдХ SMB рд╕рд░реНрд╡рд░ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдХрд╛ рдпрд╣рд╛рдБ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ:

{% content-ref url="../../network-services-pentesting/pentesting-smb/" %}
[pentesting-smb](../../network-services-pentesting/pentesting-smb/)
{% endcontent-ref %}

* **Ldap рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░реЗрдВ**
* `nmap -n -sV --script "ldap* and not brute" -p 389 <DC IP>`
* LDAP рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдХрд╛ рдпрд╣рд╛рдБ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ (рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **рдЧреБрдордирд╛рдо рдкрд╣реБрдБрдЪ** рдкрд░ рдзреНрдпрд╛рди рджреЗрдВ):

{% content-ref url="../../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

* **рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рд╡рд┐рд╖рд╛рдХреНрдд рдХрд░реЗрдВ**
* [**Responder рдХреЗ рд╕рд╛рде рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЗрдХрдЯреНрдард╛ рдХрд░реЗрдВ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
* [**рд░рд┐рд▓реЗ рд╣рдорд▓реЗ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реЛрд╕реНрдЯ рддрдХ рдкрд╣реБрдБрдЪреЗрдВ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack)
* [**рдЦрд░рд╛рдм UPnP рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЗрдХрдЯреНрдард╛ рдХрд░реЗрдВ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.md)[**SDP**](https://medium.com/@nickvangilder/exploiting-multifunction-printers-during-a-penetration-test-engagement-28d3840d8856)
* [**OSINT**](https://book.hacktricks.xyz/external-recon-methodology):
* рдЖрдВрддрд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬреЛрдВ, рд╕реЛрд╢рд▓ рдореАрдбрд┐рдпрд╛, рд╕реЗрд╡рд╛рдУрдВ (рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рд╡реЗрдм) рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо/рдирд╛рдо рдирд┐рдХрд╛рд▓реЗрдВ рдЬреЛ рдбреЛрдореЗрди рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рднреАрддрд░ рд╣реИрдВ рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдкрд▓рдмреНрдз рд╣реИрдВред
* рдпрджрд┐ рдЖрдк рдХрдВрдкрдиреА рдХреЗ рдХрд░реНрдордЪрд╛рд░рд┐рдпреЛрдВ рдХреЗ рдкреВрд░реНрдг рдирд╛рдо рдкрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рд╡рд┐рднрд┐рдиреНрди AD **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рд╕рдореНрдореЗрд▓рдиреЛрдВ** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (**[рдпрд╣ рдкрдврд╝реЗрдВ](https://activedirectorypro.com/active-directory-user-naming-convention/)**)ред рд╕рдмрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рд╕рдореНрдореЗрд▓рди рд╣реИрдВ: _NameSurname_, _Name.Surname_, _NamSur_ (рдкреНрд░рддреНрдпреЗрдХ рдХреЗ 3 рдЕрдХреНрд╖рд░), _Nam.Sur_, _NSurname_, _N.Surname_, _SurnameName_, _Surname.Name_, _SurnameN_, _Surname.N_, 3 _рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЕрдХреНрд╖рд░ рдФрд░ 3 рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕рдВрдЦреНрдпрд╛_ (abc123)ред
* рдЙрдкрдХрд░рдг:
* [w0Tx/generate-ad-username](https://github.com/w0Tx/generate-ad-username)
* [urbanadventurer/username-anarchy](https://github.com/urbanadventurer/username-anarchy)

### User enumeration

* **рдЧреБрдордирд╛рдо SMB/LDAP enum:** [**pentesting SMB**](../../network-services-pentesting/pentesting-smb/) рдФрд░ [**pentesting LDAP**](../../network-services-pentesting/pentesting-ldap.md) рдкреГрд╖реНрдареЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВред
* **Kerbrute enum**: рдЬрдм рдПрдХ **рдЕрдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рддреЛ рд╕рд░реНрд╡рд░ **Kerberos рддреНрд░реБрдЯрд┐** рдХреЛрдб _KRB5KDC\_ERR\_C\_PRINCIPAL\_UNKNOWN_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдЧрд╛, рдЬрд┐рд╕рд╕реЗ рд╣рдореЗрдВ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЕрдорд╛рдиреНрдп рдерд╛ред **рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рдПрдХ AS-REP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ **TGT** рдпрд╛ рддреНрд░реБрдЯрд┐ _KRB5KDC\_ERR\_PREAUTH\_REQUIRED_ рдХреЛ рдЙрддреНрддреЗрдЬрд┐рдд рдХрд░реЗрдВрдЧреЗ, рдЬреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреВрд░реНрд╡-рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред
```bash
./kerbrute_linux_amd64 userenum -d lab.ropnop.com --dc 10.10.10.10 usernames.txt #From https://github.com/ropnop/kerbrute/releases

nmap -p 88 --script=krb5-enum-users --script-args="krb5-enum-users.realm='DOMAIN'" <IP>
Nmap -p 88 --script=krb5-enum-users --script-args krb5-enum-users.realm='<domain>',userdb=/root/Desktop/usernames.txt <IP>

msf> use auxiliary/gather/kerberos_enumusers

crackmapexec smb dominio.es  -u '' -p '' --users | awk '{print $4}' | uniq
```
* **OWA (Outlook Web Access) рд╕рд░реНрд╡рд░**

рдпрджрд┐ рдЖрдк рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЗрдирдореЗрдВ рд╕реЗ рдПрдХ рд╕рд░реНрд╡рд░ рдкрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕рдХреЗ рдЦрд┐рд▓рд╛рдл **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧрдгрдирд╛** рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдЙрдкрдХрд░рдг [**MailSniper**](https://github.com/dafthack/MailSniper) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
ipmo C:\Tools\MailSniper\MailSniper.ps1
# Get info about the domain
Invoke-DomainHarvestOWA -ExchHostname [ip]
# Enumerate valid users from a list of potential usernames
Invoke-UsernameHarvestOWA -ExchHostname [ip] -Domain [domain] -UserList .\possible-usernames.txt -OutFile valid.txt
# Password spraying
Invoke-PasswordSprayOWA -ExchHostname [ip] -UserList .\valid.txt -Password Summer2021
# Get addresses list from the compromised mail
Get-GlobalAddressList -ExchHostname [ip] -UserName [domain]\[username] -Password Summer2021 -OutFile gal.txt
```
{% hint style="warning" %}
рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рд╕реВрдЪрд┐рдпрд╛рдБ [**рдЗрд╕ github repo**](https://github.com/danielmiessler/SecLists/tree/master/Usernames/Names) \*\*\*\* рдФрд░ рдЗрд╕ ([**statistically-likely-usernames**](https://github.com/insidetrust/statistically-likely-usernames)) рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдкрдХреЗ рдкрд╛рд╕ **рдХрдВрдкрдиреА рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд▓реЛрдЧреЛрдВ рдХреЗ рдирд╛рдо** рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП рдЬреЛ рдЖрдк рдкрд╣рд▓реЗ рдХреА рдкреБрдирдГ рдЦреЛрдЬ рдЪрд░рдг рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рдЪреБрдХреЗ рд╣реИрдВред рдирд╛рдо рдФрд░ рдЙрдкрдирд╛рдо рдХреЗ рд╕рд╛рде, рдЖрдк рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**namemash.py**](https://gist.github.com/superkojiman/11076951) рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

### рдПрдХ рдпрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЬрд╛рдирдирд╛

рдареАрдХ рд╣реИ, рддреЛ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рдПрдХ рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рд╣реИ рд▓реЗрдХрд┐рди рдХреЛрдИ рдкрд╛рд╕рд╡рд░реНрдб рдирд╣реАрдВ рд╣реИ... рдлрд┐рд░ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ:

* [**ASREPRoast**](asreproast.md): рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ _DONT\_REQ\_PREAUTH_ рд╡рд┐рд╢реЗрд╖рддрд╛ **рдирд╣реАрдВ рд╣реИ**, рддреЛ рдЖрдк рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП **AS\_REP рд╕рдВрджреЗрд╢** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдПрдХ рд╡реНрдпреБрддреНрдкрдиреНрди рджреНрд╡рд╛рд░рд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХреБрдЫ рдбреЗрдЯрд╛ рд╣реЛрдЧрд╛ред
* [**Password Spraying**](password-spraying.md): рдЪрд▓реЛ рдкреНрд░рддреНрдпреЗрдХ рдЦреЛрдЬреЗ рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╕рдмрд╕реЗ **рд╕рд╛рдорд╛рдиреНрдп рдкрд╛рд╕рд╡рд░реНрдб** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рд╢рд╛рдпрдж рдХреБрдЫ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдЦрд░рд╛рдм рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ (рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗрдВ!)ред
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк **OWA рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рднреА рд╕реНрдкреНрд░реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рддрд╛рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдореЗрд▓ рд╕рд░реНрд╡рд░реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВред

{% content-ref url="password-spraying.md" %}
[password-spraying.md](password-spraying.md)
{% endcontent-ref %}

### LLMNR/NBT-NS рдЬрд╣рд░ рджреЗрдирд╛

рдЖрдк рдХреБрдЫ рдЪреБрдиреМрддреА **рд╣реИрд╢** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ **рдЬрд╣рд░ рджреЗрдХрд░** рдХреБрдЫ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ **рдиреЗрдЯрд╡рд░реНрдХ**:

{% content-ref url="../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

### NTML рд░рд┐рд▓реЗ

рдпрджрд┐ рдЖрдк рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдзрд┐рдХ рдИрдореЗрд▓ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдмреЗрд╣рддрд░ рд╕рдордЭ** рд╣реЛрдЧреАред рдЖрдк NTML [**рд░рд┐рд▓реЗ рд╣рдорд▓реЛрдВ**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack) \*\*\*\* рдХреЛ рдордЬрдмреВрд░ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ AD рд╡рд╛рддрд╛рд╡рд░рдг рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВред

### NTLM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЪреБрд░рд╛рдирд╛

рдпрджрд┐ рдЖрдк **рдЕрдиреНрдп PCs рдпрд╛ рд╢реЗрдпрд░реЛрдВ** рддрдХ **рдирд▓ рдпрд╛ рдЕрддрд┐рдерд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЗ рд╕рд╛рде **рдкрд╣реБрдБрдЪ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдлрд╛рдЗрд▓реЗрдВ** (рдЬреИрд╕реЗ SCF рдлрд╝рд╛рдЗрд▓) рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдпрджрд┐ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдкрд╣реБрдБрдЪреА рдЬрд╛рддреА рд╣реИрдВ рддреЛ **рдЖрдкрдХреЗ рдЦрд┐рд▓рд╛рдл NTML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВрдЧреА** рддрд╛рдХрд┐ рдЖрдк **NTLM рдЪреБрдиреМрддреА** рдЪреБрд░рд╛ рд╕рдХреЗрдВ:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

## рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕/рд╕рддреНрд░ рдХреЗ рд╕рд╛рде рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рд╕реВрдЪреА рдмрдирд╛рдирд╛

рдЗрд╕ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдПрдХ рдорд╛рдиреНрдп рдбреЛрдореЗрди рдЦрд╛рддреЗ рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдпрд╛ рд╕рддреНрд░ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред** рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдорд╛рдиреНрдп рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдпрд╛ рдПрдХ рд╢реЗрд▓ рд╣реИ, рддреЛ **рдЖрдкрдХреЛ рдпрд╛рдж рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдкрд╣рд▓реЗ рджрд┐рдП рдЧрдП рд╡рд┐рдХрд▓реНрдк рдЕрднреА рднреА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХреЗ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ**ред

рдкреНрд░рдорд╛рдгрд┐рдд рд╕реВрдЪреА рдмрдирд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ **Kerberos рдбрдмрд▓ рд╣реЙрдк рд╕рдорд╕реНрдпрд╛** рдХреНрдпрд╛ рд╣реИ, рдпрд╣ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рд┐рдПред

{% content-ref url="kerberos-double-hop-problem.md" %}
[kerberos-double-hop-problem.md](kerberos-double-hop-problem.md)
{% endcontent-ref %}

### рд╕реВрдЪреА рдмрдирд╛рдирд╛

рдПрдХ рдЦрд╛рддреЗ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ **рдкреВрд░реЗ рдбреЛрдореЗрди рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝рд╛ рдХрджрдо рд╣реИ**, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк **рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рд╕реВрдЪреА рдмрдирд╛рдирд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ:**

[**ASREPRoast**](asreproast.md) рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ, рдЖрдк рдЕрдм рд╣рд░ рд╕рдВрднрд╛рд╡рд┐рдд рдХрдордЬреЛрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ [**Password Spraying**](password-spraying.md) рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ, рдЖрдк **рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЦрд╛рддреЗ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб, рдЦрд╛рд▓реА рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ рдирдП рдЖрд╢рд╛рдЬрдирдХ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

* рдЖрдк [**CMD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдмреБрдирд┐рдпрд╛рджреА рдкреБрдирдГ рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](../basic-cmd-for-pentesters.md#domain-info)
* рдЖрдк [**рдкреЙрд╡рд░рд╢реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреБрдирдГ рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](../basic-powershell-for-pentesters/) рдЬреЛ рдЕрдзрд┐рдХ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реЛрдЧрд╛
* рдЖрдк [**powerview рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](../basic-powershell-for-pentesters/powerview.md) рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП
* рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдкреБрдирдГ рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдЕрджреНрднреБрдд рдЙрдкрдХрд░рдг рд╣реИ [**BloodHound**](bloodhound.md)ред рдпрд╣ **рдмрд╣реБрдд рдЫрд┐рдкрд╛ рд╣реБрдЖ рдирд╣реАрдВ рд╣реИ** (рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╕рдВрдЧреНрд░рд╣ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░), рд▓реЗрдХрд┐рди **рдпрджрд┐ рдЖрдкрдХреЛ рдЗрд╕рдХреА рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рд╣реИ**, рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЖрдЬрдорд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдкрддрд╛ рдХрд░реЗрдВ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ RDP рдХрд╣рд╛рдБ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдиреНрдп рд╕рдореВрд╣реЛрдВ рдХреЗ рд▓рд┐рдП рдкрде рдЦреЛрдЬреЗрдВ, рдЖрджрд┐ред
* **рдЕрдиреНрдп рд╕реНрд╡рдЪрд╛рд▓рд┐рдд AD рд╕реВрдЪреАрдХрд░рдг рдЙрдкрдХрд░рдг рд╣реИрдВ:** [**AD Explorer**](bloodhound.md#ad-explorer)**,** [**ADRecon**](bloodhound.md#adrecon)**,** [**Group3r**](bloodhound.md#group3r)**,** [**PingCastle**](bloodhound.md#pingcastle)**ред**
* [**AD рдХреЗ DNS рд░рд┐рдХреЙрд░реНрдб**](ad-dns-records.md) рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред
* рдЖрдк рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП **AdExplorer.exe** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **SysInternal** рд╕реВрдЯ рд╕реЗ рд╣реИред
* рдЖрдк **ldapsearch** рдХреЗ рд╕рд╛рде LDAP рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ _userPassword_ рдФрд░ _unixUserPassword_ рдлрд╝реАрд▓реНрдб рдореЗрдВ, рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ _Description_ рдХреЗ рд▓рд┐рдПред рдЕрдиреНрдп рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП [PayloadsAllTheThings рдкрд░ AD рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЯрд┐рдкреНрдкрдгреА рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#password-in-ad-user-comment) рджреЗрдЦреЗрдВред
* рдпрджрд┐ рдЖрдк **Linux** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЖрдк [**pywerview**](https://github.com/the-useless-one/pywerview) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЛрдореЗрди рдХреА рд╕реВрдЪреА рднреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред
* рдЖрдк рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ:
* [**tomcarver16/ADSearch**](https://github.com/tomcarver16/ADSearch)
* [**61106960/adPEAS**](https://github.com/61106960/adPEAS)
*   **рд╕рднреА рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдирд┐рдХрд╛рд▓рдирд╛**

Windows рд╕реЗ рд╕рднреА рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИ (`net user /domain`, `Get-DomainUser` рдпрд╛ `wmic useraccount get name,sid`)ред Linux рдореЗрдВ, рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `GetADUsers.py -all -dc-ip 10.10.10.110 domain.com/username` рдпрд╛ `enum4linux -a -u "user" -p "password" <DC IP>`

> рднрд▓реЗ рд╣реА рдпрд╣ рд╕реВрдЪреАрдХрд░рдг рдЕрдиреБрднрд╛рдЧ рдЫреЛрдЯрд╛ рджрд┐рдЦрддрд╛ рд╣реИ, рдпрд╣ рд╕рднреА рдХрд╛ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднрд╛рдЧ рд╣реИред рд▓рд┐рдВрдХ рдкрд░ рдкрд╣реБрдБрдЪреЗрдВ (рдореБрдЦреНрдп рд░реВрдк рд╕реЗ cmd, powershell, powerview рдФрд░ BloodHound рд╡рд╛рд▓реЗ), рдЬрд╛рдиреЗрдВ рдХрд┐ рдбреЛрдореЗрди рдХреЛ рдХреИрд╕реЗ рд╕реВрдЪреАрдмрджреНрдз рдХрд░реЗрдВ рдФрд░ рддрдм рддрдХ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ рдЬрдм рддрдХ рдЖрдк рд╕рд╣рдЬ рдорд╣рд╕реВрд╕ рди рдХрд░реЗрдВред рдПрдХ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреЗ рджреМрд░рд╛рди, рдпрд╣ DA рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдпрд╛ рдпрд╣ рддрдп рдХрд░рдиреЗ рдХрд╛ рдХреБрдВрдЬреА рдХреНрд╖рдг рд╣реЛрдЧрд╛ рдХрд┐ рдХреБрдЫ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ред

### Kerberoast

Kerberoasting рдореЗрдВ **TGS рдЯрд┐рдХрдЯ** рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЛрдВ рд╕реЗ рдЬреБрдбрд╝реЗ рд╕реЗрд╡рд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЛ рдХреНрд░реИрдХ рдХрд░рдирд╛тАФрдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИтАФ**рдСрдлрд▓рд╛рдЗрди**ред

рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА:

{% content-ref url="kerberoast.md" %}
[kerberoast.md](kerberoast.md)
{% endcontent-ref %}

### рджреВрд░рд╕реНрде рдХрдиреЗрдХреНрд╢рди (RDP, SSH, FTP, Win-RM, рдЖрджрд┐)

рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдХреБрдЫ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА **рдорд╢реАрди** рддрдХ рдкрд╣реБрдБрдЪ рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рд╡рд┐рднрд┐рдиреНрди рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд╕рд╛рде рдХрдИ рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **CrackMapExec** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдЖрдкрдХреЗ рдкреЛрд░реНрдЯ рд╕реНрдХреИрди рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╣реИред

### рд╕реНрдерд╛рдиреАрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐

рдпрджрд┐ рдЖрдкрдиреЗ рдирд┐рдпрдорд┐рдд рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдпрд╛ рд╕рддреНрд░ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рд╣реИ рдФрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдбреЛрдореЗрди рдореЗрдВ рдХрд┐рд╕реА рднреА рдорд╢реАрди** рдкрд░ рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рд╛рде **рдкрд╣реБрдБрдЪ** рд╣реИ, рддреЛ рдЖрдкрдХреЛ **рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдФрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рд▓реВрдЯ рдХреЗ рд▓рд┐рдП** рдЕрдкрдирд╛ рд░рд╛рд╕реНрддрд╛ рдЦреЛрдЬрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреЗрд╡рд▓ рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЖрдк **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╣реИрд╢ рдХреЛ** рдореЗрдореЛрд░реА (LSASS) рдФрд░ рд╕реНрдерд╛рдиреАрдп (SAM) рдореЗрдВ **рдбрдВрдк** рдХрд░ рд╕рдХреЗрдВрдЧреЗред

рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ [**Windows рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐**](../windows-local-privilege-escalation/) рдФрд░ рдПрдХ [**рдЪреЗрдХрд▓рд┐рд╕реНрдЯ**](../checklist-windows-privilege-escalation.md) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдкреВрд░рд╛ рдкреГрд╖реНрда рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, [**WinPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рди рднреВрд▓реЗрдВред

### рд╡рд░реНрддрдорд╛рди рд╕рддреНрд░ рдЯрд┐рдХрдЯ

рдпрд╣ рдмрд╣реБрдд **рдЕрд╕рдВрднрд╡** рд╣реИ рдХрд┐ рдЖрдк рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЗрдВ **рдЯрд┐рдХрдЯ** рдкрд╛рдПрдБ рдЬреЛ рдЖрдкрдХреЛ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдк рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
## List all tickets (if not admin, only current user tickets)
.\Rubeus.exe triage
## Dump the interesting one by luid
.\Rubeus.exe dump /service:krbtgt /luid:<luid> /nowrap
[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("<BASE64_TICKET>"))
```
### NTML Relay

рдпрджрд┐ рдЖрдк рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдзрд┐рдХ рдИрдореЗрд▓ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдмреЗрд╣рддрд░ рд╕рдордЭ** рд╣реЛрдЧреАред рдЖрдк NTML [**relay attacks**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack)** рдХреЛ рдордЬрдмреВрд░ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред**

### **Looks for Creds in Computer Shares**

рдЕрдм рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреБрдЫ рдмреБрдирд┐рдпрд╛рджреА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк **AD рдХреЗ рдЕрдВрджрд░ рд╕рд╛рдЭрд╛ рдХреА рдЧрдИ рдХреЛрдИ **рджрд┐рд▓рдЪрд╕реНрдк рдлрд╝рд╛рдЗрд▓реЗрдВ** **рдкрд╛рддреЗ рд╣реИрдВред** рдЖрдк рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рдЙрдмрд╛рдК рджреЛрд╣рд░рд╛рд╡ рд╡рд╛рд▓рд╛ рдХрд╛рд░реНрдп рд╣реИ (рдФрд░ рдЕрдзрд┐рдХ рдпрджрд┐ рдЖрдк рд╕реИрдХрдбрд╝реЛрдВ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкрд╛рддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдкрдХреЛ рдЬрд╛рдВрдЪрдирд╛ рд╣реИ)ред

[**Follow this link to learn about tools you could use.**](../../network-services-pentesting/pentesting-smb/#domain-shared-folders-search)

### Steal NTLM Creds

рдпрджрд┐ рдЖрдк **рдЕрдиреНрдп PCs рдпрд╛ рд╢реЗрдпрд░реЛрдВ** рддрдХ **рдкрд╣реБрдБрдЪ** рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдлрд╛рдЗрд▓реЗрдВ** (рдЬреИрд╕реЗ SCF рдлрд╝рд╛рдЗрд▓) рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдпрджрд┐ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХреА рдЬрд╛рддреА рд╣реИрдВ, рддреЛ **рдЖрдкрдХреЗ рдЦрд┐рд▓рд╛рдл NTML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВрдЧреА** рддрд╛рдХрд┐ рдЖрдк **NTLM рдЪреБрдиреМрддреА** рдЪреБрд░рд╛ рд╕рдХреЗрдВред

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

### CVE-2021-1675/CVE-2021-34527 PrintNightmare

рдпрд╣ рднреЗрджреНрдпрддрд╛ рдХрд┐рд╕реА рднреА рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

{% content-ref url="printnightmare.md" %}
[printnightmare.md](printnightmare.md)
{% endcontent-ref %}

## Privilege escalation on Active Directory WITH privileged credentials/session

**рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрдХрдиреАрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рдпрдорд┐рдд рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рдЖрдкрдХреЛ рдЗрди рд╣рдорд▓реЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░/рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред**

### Hash extraction

рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдЖрдк [AsRepRoast](asreproast.md), [Password Spraying](password-spraying.md), [Kerberoast](kerberoast.md), [Responder](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) рд╕рд╣рд┐рдд рд░рд┐рд▓реЗ рдХрд░рддреЗ рд╣реБрдП, [EvilSSDP](../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.md), [рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдирд╛](../windows-local-privilege-escalation/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдХреБрдЫ рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ** рдЦрд╛рддреЗ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд░рд╣реЗ рд╣реИрдВред\
рдлрд┐рд░, рдпрд╣ рд╕рднреА рд╣реИрд╢ рдХреЛ рдореЗрдореЛрд░реА рдФрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдбрдВрдк рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред\
[**Read this page about different ways to obtain the hashes.**](https://github.com/carlospolop/hacktricks/blob/master/windows-hardening/active-directory-methodology/broken-reference/README.md)

### Pass the Hash

**рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд╣реИрд╢ рд╣реЛ**, рддреЛ рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЙрд╕рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдкрдХреЛ рдХреБрдЫ **рдЙрдкрдХрд░рдг** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рдЙрд╕ **рд╣реИрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХрд░реЗрдЧрд╛, **рдпрд╛** рдЖрдк рдПрдХ рдирдпрд╛ **sessionlogon** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **LSASS** рдХреЗ рдЕрдВрджрд░ рдЙрд╕ **рд╣реИрд╢** рдХреЛ **рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдЬрдм рднреА рдХреЛрдИ **NTLM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рд╡рд╣ **рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред** рдЕрдВрддрд┐рдо рд╡рд┐рдХрд▓реНрдк рд╡рд╣реА рд╣реИ рдЬреЛ mimikatz рдХрд░рддрд╛ рд╣реИред\
[**Read this page for more information.**](../ntlm/#pass-the-hash)

### Over Pass the Hash/Pass the Key

рдпрд╣ рд╣рдорд▓рд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ NTLM рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Kerberos рдЯрд┐рдХрдЯреЛрдВ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ** рдХрд╛ рд▓рдХреНрд╖реНрдп рд░рдЦрддрд╛ рд╣реИ, NTLM рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдкрд░ рд╕рд╛рдорд╛рдиреНрдп Pass The Hash рдХреЗ рд╡рд┐рдХрд▓реНрдк рдХреЗ рд░реВрдк рдореЗрдВред рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **рдЙрди рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ NTLM рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдЕрдХреНрд╖рдо рд╣реИ** рдФрд░ рдХреЗрд╡рд▓ **Kerberos рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рд╣реИред**

{% content-ref url="over-pass-the-hash-pass-the-key.md" %}
[over-pass-the-hash-pass-the-key.md](over-pass-the-hash-pass-the-key.md)
{% endcontent-ref %}

### Pass the Ticket

**Pass The Ticket (PTT)** рд╣рдорд▓реЗ рдХреА рд╡рд┐рдзрд┐ рдореЗрдВ, рд╣рдорд▓рд╛рд╡рд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЯрд┐рдХрдЯ рдЪреБрд░рд╛рддреЗ рд╣реИрдВ** рдмрдЬрд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рдЙрдирдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдпрд╛ рд╣реИрд╢ рдорд╛рдиред рдпрд╣ рдЪреБрд░рд╛рдпрд╛ рдЧрдпрд╛ рдЯрд┐рдХрдЯ рдлрд┐рд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рднреАрддрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

{% content-ref url="pass-the-ticket.md" %}
[pass-the-ticket.md](pass-the-ticket.md)
{% endcontent-ref %}

### Credentials Reuse

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ **рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ** рдХрд╛ **рд╣реИрд╢** рдпрд╛ **рдкрд╛рд╕рд╡рд░реНрдб** рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рдЕрдиреНрдп **PCs** рдкрд░ **рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред
```bash
# Local Auth Spray (once you found some local admin pass or hash)
## --local-auth flag indicate to only try 1 time per machine
crackmapexec smb --local-auth 10.10.10.10/23 -u administrator -H 10298e182387f9cab376ecd08491764a0 | grep +
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдХрд╛рдлреА **рд╢реЛрд░рдЧреБрд▓** рд╡рд╛рд▓рд╛ рд╣реИ рдФрд░ **LAPS** рдЗрд╕реЗ **рдХрдо** рдХрд░реЗрдЧрд╛ред
{% endhint %}

### MSSQL рджреБрд░реБрдкрдпреЛрдЧ рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд▓рд┐рдВрдХ

рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ **MSSQL рдЙрджрд╛рд╣рд░рдгреЛрдВ** рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ, рддреЛ рд╡рд╣ рдЗрд╕реЗ **рдХрдорд╛рдВрдб** рдХреЛ MSSQL рд╣реЛрд╕реНрдЯ рдореЗрдВ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдпрджрд┐ SA рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реЛ), **NetNTLM** **рд╣реИрд╢** рдЪреБрд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рд░рд┐рд▓реЗ** **рд╣рдорд▓рд╛** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдПрдХ MSSQL рдЙрджрд╛рд╣рд░рдг рдХреЛ рдПрдХ рдЕрд▓рдЧ MSSQL рдЙрджрд╛рд╣рд░рдг рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп (рдбреЗрдЯрд╛рдмреЗрд╕ рд▓рд┐рдВрдХ) рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдкрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ, рддреЛ рд╡рд╣ **рдЕрдиреНрдп рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдХреНрд╡реЗрд░реА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдз рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛**ред рдпреЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╢реНрд░реГрдВрдЦрд▓рд╛рдмрджреНрдз рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХрд┐рд╕реА рдмрд┐рдВрджреБ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИ рдбреЗрдЯрд╛рдмреЗрд╕ рдЦреЛрдЬрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдБ рд╡рд╣ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
**рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдмреАрдЪ рдХреЗ рд▓рд┐рдВрдХ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд╡рди рд╡рди рдЯреНрд░рд╕реНрдЯ рдХреЗ рдкрд╛рд░ рднреА рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред**

{% content-ref url="abusing-ad-mssql.md" %}
[abusing-ad-mssql.md](abusing-ad-mssql.md)
{% endcontent-ref %}

### рдЕрд╕рдВрд╡рд░реНрддрд┐рдд рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡

рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдХрдВрдкреНрдпреВрдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ [ADS\_UF\_TRUSTED\_FOR\_DELEGATION](https://msdn.microsoft.com/en-us/library/aa772300\(v=vs.85\).aspx) рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рд╕рд╛рде рдкрд╛рддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ рдбреЛрдореЗрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ, рддреЛ рдЖрдк рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╣рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдореЗрдореЛрд░реА рд╕реЗ TGT рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗред\
рддреЛ, рдпрджрд┐ рдПрдХ **рдбреЛрдореЗрди рдПрдбрдорд┐рди рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд▓реЙрдЧрд┐рди рдХрд░рддрд╛ рд╣реИ**, рддреЛ рдЖрдк рдЙрд╕рдХреЗ TGT рдХреЛ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ [рдкрд╛рд╕ рдж рдЯрд┐рдХрдЯ](pass-the-ticket.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕рдХреА рдирдХрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рд╕рдВрд╡рд░реНрддрд┐рдд рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреЗ рдХрд╛рд░рдг рдЖрдк рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдПрдХ рдкреНрд░рд┐рдВрдЯ рд╕рд░реНрд╡рд░ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рдордЭреМрддрд╛** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ DC рд╣реЛрдЧрд╛)ред

{% content-ref url="unconstrained-delegation.md" %}
[unconstrained-delegation.md](unconstrained-delegation.md)
{% endcontent-ref %}

### рд╕рдВрд╡рд░реНрддрд┐рдд рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡

рдпрджрд┐ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЛ "рд╕рдВрд╡рд░реНрддрд┐рдд рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡" рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рд╣реИ, рддреЛ рд╡рд╣ **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдирдХрд▓ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдХрд┐рд╕реА рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ рдХреБрдЫ рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХреЗ**ред\
рдлрд┐рд░, рдпрджрд┐ рдЖрдк рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рдХрдВрдкреНрдпреВрдЯрд░ рдХрд╛ **рд╣реИрд╢ рд╕рдордЭреМрддрд╛** рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдбреЛрдореЗрди рдПрдбрдорд┐рди) рдХреА рдирдХрд▓ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ рддрд╛рдХрд┐ рдХреБрдЫ рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХреЗред

{% content-ref url="constrained-delegation.md" %}
[constrained-delegation.md](constrained-delegation.md)
{% endcontent-ref %}

### рд╕рдВрд╕рд╛рдзрди-рдЖрдзрд╛рд░рд┐рдд рд╕рдВрд╡рд░реНрддрд┐рдд рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡

рдПрдХ рджреВрд░рд╕реНрде рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ Active Directory рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ **WRITE** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реЛрдиреЗ рд╕реЗ **рдЙрдиреНрдирдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рдХреЗ рд╕рд╛рде рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ:

{% content-ref url="resource-based-constrained-delegation.md" %}
[resource-based-constrained-delegation.md](resource-based-constrained-delegation.md)
{% endcontent-ref %}

### ACLs рджреБрд░реБрдкрдпреЛрдЧ

рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреБрдЫ **рджрд┐рд▓рдЪрд╕реНрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рд░рдЦ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ **рдкрд╛рд░реНрд╢реНрд╡ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд** рдХрд░рдиреЗ/рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИред

{% content-ref url="acl-persistence-abuse/" %}
[acl-persistence-abuse](acl-persistence-abuse/)
{% endcontent-ref %}

### рдкреНрд░рд┐рдВрдЯрд░ рд╕реНрдкреВрд▓рд░ рд╕реЗрд╡рд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ **рд╕реНрдкреВрд▓ рд╕реЗрд╡рд╛ рд╕реБрдирдиреЗ** рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ **рдирдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП **рджреБрд░реБрдкрдпреЛрдЧ** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

{% content-ref url="printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](printers-spooler-service-abuse.md)
{% endcontent-ref %}

### рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ рд╕рддреНрд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдпрджрд┐ **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** **рд╕рдордЭреМрддрд╛** рдХреА рдЧрдИ рдорд╢реАрди рддрдХ рдкрд╣реБрдБрдЪрддреЗ рд╣реИрдВ, рддреЛ **рдореЗрдореЛрд░реА рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдПрдХрддреНрд░ рдХрд░рдирд╛ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдЙрдирдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдореЗрдВ рдмреАрдХрди рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдирд╛** рд╕рдВрднрд╡ рд╣реИ рддрд╛рдХрд┐ рдЙрдирдХреА рдирдХрд▓ рдХреА рдЬрд╛ рд╕рдХреЗред\
рдЖрдорддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ RDP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рддрдХ рдкрд╣реБрдБрдЪрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣рд╛рдВ рдЖрдкрдХреЗ рдкрд╛рд╕ рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ RDP рд╕рддреНрд░реЛрдВ рдкрд░ рдХреБрдЫ рд╣рдорд▓реЗ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ:

{% content-ref url="rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](rdp-sessions-abuse.md)
{% endcontent-ref %}

### LAPS

**LAPS** рдбреЛрдореЗрди-рдЬреЛрдбрд╝реЗ рдЧрдП рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдкрд░ **рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдкрд╛рд╕рд╡рд░реНрдб** рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рдгрд╛рд▓реА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдпрд╣ **рдпрд╛рджреГрдЪреНрдЫрд┐рдХ**, рдЕрджреНрд╡рд┐рддреАрдп, рдФрд░ рдЕрдХреНрд╕рд░ **рдмрджрд▓рддрд╛** рд╣реИред рдпреЗ рдкрд╛рд╕рд╡рд░реНрдб Active Directory рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ ACLs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЗрд╡рд▓ рдЕрдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдБрдЪ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИред рдЗрди рдкрд╛рд╕рд╡рд░реНрдбреЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде, рдЕрдиреНрдп рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдкрд░ рдкрд┐рд╡рдЯрд┐рдВрдЧ рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

{% content-ref url="laps.md" %}
[laps.md](laps.md)
{% endcontent-ref %}

### рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЪреЛрд░реА

**рд╕рдордЭреМрддрд╛ рдХреА рдЧрдИ рдорд╢реАрди рд╕реЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдПрдХрддреНрд░ рдХрд░рдирд╛** рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рднреАрддрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="ad-certificates/certificate-theft.md" %}
[certificate-theft.md](ad-certificates/certificate-theft.md)
{% endcontent-ref %}

### рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдпрджрд┐ **рдХрдордЬреЛрд░ рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ, рддреЛ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="ad-certificates/domain-escalation.md" %}
[domain-escalation.md](ad-certificates/domain-escalation.md)
{% endcontent-ref %}

## рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЦрд╛рддреЗ рдХреЗ рд╕рд╛рде рдкреЛрд╕реНрдЯ-рд╢реЛрд╖рдг

### рдбреЛрдореЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдбрдВрдкрд┐рдВрдЧ

рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк **рдбреЛрдореЗрди рдПрдбрдорд┐рди** рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдмреЗрд╣рддрд░ **рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдПрдбрдорд┐рди** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдбреЛрдореЗрди рдбреЗрдЯрд╛рдмреЗрд╕** рдХреЛ **рдбрдВрдк** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: _ntds.dit_ред

[**DCSync рд╣рдорд▓реЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдВ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ**](dcsync.md)уАВ

[**NTDS.dit рдХреЛ рдЪреБрд░рд╛рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдВ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ**](https://github.com/carlospolop/hacktricks/blob/master/windows-hardening/active-directory-methodology/broken-reference/README.md)

### рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдерд┐рд░рддрд╛

рдкрд╣рд▓реЗ рдЪрд░реНрдЪрд╛ рдХреА рдЧрдИ рдХреБрдЫ рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрдерд┐рд░рддрд╛ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

*   рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ [**Kerberoast**](kerberoast.md) рдХреЗ рд▓рд┐рдП рдХрдордЬреЛрд░ рдмрдирд╛рдирд╛

```powershell
Set-DomainObject -Identity <username> -Set @{serviceprincipalname="fake/NOTHING"}r
```
*   рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ [**ASREPRoast**](asreproast.md) рдХреЗ рд▓рд┐рдП рдХрдордЬреЛрд░ рдмрдирд╛рдирд╛

```powershell
Set-DomainObject -Identity <username> -XOR @{UserAccountControl=4194304}
```
*   рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ [**DCSync**](./#dcsync) рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджреЗрдирд╛

```powershell
Add-DomainObjectAcl -TargetIdentity "DC=SUB,DC=DOMAIN,DC=LOCAL" -PrincipalIdentity bfarmer -Rights DCSync
```

### рд╕рд┐рд▓реНрд╡рд░ рдЯрд┐рдХрдЯ

**рд╕рд┐рд▓реНрд╡рд░ рдЯрд┐рдХрдЯ рд╣рдорд▓рд╛** рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП **рд╡реИрдз рдЯрд┐рдХрдЯ рдЧреНрд░рд╛рдВрдЯрд┐рдВрдЧ рд╕реЗрд╡рд╛ (TGS) рдЯрд┐рдХрдЯ** рдмрдирд╛рддрд╛ рд╣реИ, **NTLM рд╣реИрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, **PC рдЦрд╛рддреЗ рдХрд╛ рд╣реИрд╢**)ред рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╕реЗрд╡рд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ** рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

{% content-ref url="silver-ticket.md" %}
[silver-ticket.md](silver-ticket.md)
{% endcontent-ref %}

### рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ

**рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рд╣рдорд▓рд╛** рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ **NTLM рд╣реИрд╢** рдХреЛ **krbtgt рдЦрд╛рддреЗ** рдореЗрдВ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ Active Directory (AD) рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдЦрд╛рддрд╛ рд╡рд┐рд╢реЗрд╖ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рднреА **рдЯрд┐рдХрдЯ рдЧреНрд░рд╛рдВрдЯрд┐рдВрдЧ рдЯрд┐рдХрдЯ (TGTs)** рдкрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ AD рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рднреАрддрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВред

рдПрдХ рдмрд╛рд░ рдЬрдм рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ рд╣реИрд╢ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реЗрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдХрд┐рд╕реА рднреА рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП **TGTs** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд╡рд╣ рдЪреБрдирддрд╛ рд╣реИ (рд╕рд┐рд▓реНрд╡рд░ рдЯрд┐рдХрдЯ рд╣рдорд▓рд╛)ред

{% content-ref url="golden-ticket.md" %}
[golden-ticket.md](golden-ticket.md)
{% endcontent-ref %}

### рдбрд╛рдпрдордВрдб рдЯрд┐рдХрдЯ

рдпреЗ рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдХреА рддрд░рд╣ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ **рд╕рд╛рдорд╛рдиреНрдп рдЧреЛрд▓реНрдбрди рдЯрд┐рдХрдЯ рдкрд╣рдЪрд╛рди рддрдВрддреНрд░реЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕** рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рд╕реЗ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВред

{% content-ref url="diamond-ticket.md" %}
[diamond-ticket.md](diamond-ticket.md)
{% endcontent-ref %}

### **рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЦрд╛рддрд╛ рд╕реНрдерд┐рд░рддрд╛**

**рдХрд┐рд╕реА рдЦрд╛рддреЗ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╣реЛрдирд╛ рдпрд╛ рдЙрдиреНрд╣реЗрдВ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЦрд╛рддреЗ рдореЗрдВ рд╕реНрдерд┐рд░рддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реИ (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдпрджрд┐ рд╡рд╣ рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓рддрд╛ рд╣реИ):

{% content-ref url="ad-certificates/account-persistence.md" %}
[account-persistence.md](ad-certificates/account-persistence.md)
{% endcontent-ref %}

### **рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдбреЛрдореЗрди рд╕реНрдерд┐рд░рддрд╛**

**рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рднреА рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд╕реНрдерд┐рд░рддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╡ рд╣реИ:**

{% content-ref url="ad-certificates/domain-persistence.md" %}
[domain-persistence.md](ad-certificates/domain-persistence.md)
{% endcontent-ref %}

### AdminSDHolder рд╕рдореВрд╣

Active Directory рдореЗрдВ **AdminSDHolder** рдСрдмреНрдЬреЗрдХреНрдЯ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рд╕рдореВрд╣реЛрдВ** (рдЬреИрд╕реЗ рдбреЛрдореЗрди рдПрдбрдорд┐рди рдФрд░ рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдПрдбрдорд┐рди) рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЗрди рд╕рдореВрд╣реЛрдВ рдкрд░ рдПрдХ рдорд╛рдирдХ **рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓ рд▓рд┐рд╕реНрдЯ (ACL)** рд▓рд╛рдЧреВ рдХрд░рдХреЗ рдЕрдирдзрд┐рдХреГрдд рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд░реЛрдХрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ; рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ AdminSDHolder рдХреЗ ACL рдХреЛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкреВрд░реНрдг рдкрд╣реБрдБрдЪ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рднреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рд╕рдореВрд╣реЛрдВ рдкрд░ рд╡реНрдпрд╛рдкрдХ рдирд┐рдпрдВрддреНрд░рдг рдорд┐рд▓ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп, рдЬрд┐рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдЙрд▓рдЯрд╛ рдкрдбрд╝ рд╕рдХрддрд╛ рд╣реИ, рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рдЗрд╕реЗ рдирд┐рдХрдЯрддрд╛ рд╕реЗ рдореЙрдирд┐рдЯрд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

[**AdminDSHolder рд╕рдореВрд╣ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдВ рд╣реИред**](privileged-groups-and-token-privileges.md#adminsdholder-group)

### DSRM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕

рд╣рд░ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ (DC)** рдХреЗ рдЕрдВрджрд░, рдПрдХ **рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ** рдЦрд╛рддрд╛ рдореМрдЬреВрдж рд╣реЛрддрд╛ рд╣реИред рдРрд╕реА рдорд╢реАрди рдкрд░ рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдЕрдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдХреЗ, рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╣реИрд╢ рдХреЛ **mimikatz** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рдХрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдмрд╛рдж, рдЗрд╕ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕рдВрд╢реЛрдзрди рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕реНрдерд╛рдиреАрдп рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЦрд╛рддреЗ рддрдХ рджреВрд░рд╕реНрде рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред

{% content-ref url="dsrm-credentials.md" %}
[dsrm-credentials.md](dsrm-credentials.md)
{% endcontent-ref %}

### ACL рд╕реНрдерд┐рд░рддрд╛

рдЖрдк рдХреБрдЫ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдбреЛрдореЗрди рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдкрд░ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЛ рдХреБрдЫ **рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрдорддрд┐** рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рднрд╡рд┐рд╖реНрдп рдореЗрдВ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред

{% content-ref url="acl-persistence-abuse/" %}
[acl-persistence-abuse](acl-persistence-abuse/)
{% endcontent-ref %}

### рд╕реБрд░рдХреНрд╖рд╛ рд╡рд░реНрдгрдирдХрд░реНрддрд╛

**рд╕реБрд░рдХреНрд╖рд╛ рд╡рд░реНрдгрдирдХрд░реНрддрд╛** рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреЛ **рд╕реНрдЯреЛрд░** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдПрдХ **рдСрдмреНрдЬреЗрдХреНрдЯ** рдХреЗ рдкрд╛рд╕ **рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ** рдкрд░ рд╣реЛрддреА рд╣реИрдВред рдпрджрд┐ рдЖрдк рдХреЗрд╡рд▓ **рд╕реБрд░рдХреНрд╖рд╛ рд╡рд░реНрдгрдирдХрд░реНрддрд╛** рдореЗрдВ **рдереЛрдбрд╝рд╛ рд╕рд╛ рдкрд░рд┐рд╡рд░реНрддрди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рд╕рдореВрд╣ рдХрд╛ рд╕рджрд╕реНрдп рдмрдиреЗред

{% content-ref url="security-descriptors.md" %}
[security-descriptors.md](security-descriptors.md)
{% endcontent-ref %}

### рдХрдВрдХрд╛рд▓ рдХреБрдВрдЬреА

**LSASS** рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдПрдХ **рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рдкрд╛рд╕рд╡рд░реНрдб** рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдЬреЛ рд╕рднреА рдбреЛрдореЗрди рдЦрд╛рддреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

{% content-ref url="skeleton-key.md" %}
[skeleton-key.md](skeleton-key.md)
{% endcontent-ref %}

### рдХрд╕реНрдЯрдо SSP

[рдпрд╣рд╛рдВ рдЬрд╛рдиреЗрдВ рдХрд┐ SSP (рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд░реНрдерди рдкреНрд░рджрд╛рддрд╛) рдХреНрдпрд╛ рд╣реИред](../authentication-credentials-uac-and-efs/#security-support-provider-interface-sspi)\
рдЖрдк **рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ SSP** рдХреЛ **рдХреИрдкреНрдЪрд░** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдорд╢реАрди рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдХреЛ **рд╕реНрдкрд╖реНрдЯ рдкрд╛рда** рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред\\

{% content-ref url="custom-ssp.md" %}
[custom-ssp.md](custom-ssp.md)
{% endcontent-ref %}

### DCShadow

рдпрд╣ AD рдореЗрдВ рдПрдХ **рдирдпрд╛ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░** рдкрдВрдЬреАрдХреГрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╡рд╕реНрддреБрдУрдВ рдкрд░ **рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ** (SIDHistory, SPNs...) рдХреЛ **рдзрдХреЗрд▓рдиреЗ** рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ **рдмрд┐рдирд╛** рдХрд┐рд╕реА **рд▓реЙрдЧ** рдХреЛ рдЫреЛрдбрд╝реЗ рдЬреЛ **рд╕рдВрд╢реЛрдзрдиреЛрдВ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реЛред рдЖрдкрдХреЛ **DA** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ **рд░реВрдЯ рдбреЛрдореЗрди** рдХреЗ рдЕрдВрджрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдк рдЧрд▓рдд рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдмрд╣реБрдд рднрджреНрджреЗ рд▓реЙрдЧ рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреЗред

{% content-ref url="dcshadow.md" %}
[dcshadow.md](dcshadow.md)
{% endcontent-ref %}

### LAPS рд╕реНрдерд┐рд░рддрд╛

рдкрд╣рд▓реЗ рд╣рдордиреЗ рдЪрд░реНрдЪрд╛ рдХреА рд╣реИ рдХрд┐ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **LAPS рдкрд╛рд╕рд╡рд░реНрдб рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐ рд╣реИ** рддреЛ рдЖрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреИрд╕реЗ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрди рдкрд╛рд╕рд╡рд░реНрдбреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╕реНрдерд┐рд░рддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ** рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЬрд╛рдВрдЪреЗрдВ:

{% content-ref url="laps.md" %}
[laps.md](laps.md)
{% endcontent-ref %}

## рд╡рди рд╡рди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ - рдбреЛрдореЗрди рдЯреНрд░рд╕реНрдЯ

Microsoft **рд╡рди** рдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рд╕реАрдорд╛ рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ **рдПрдХрд▓ рдбреЛрдореЗрди рдХрд╛ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдкреВрд░реЗ рд╡рди рдХреЗ рд╕рдордЭреМрддрд╛ рд╣реЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ**ред

### рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА

рдПрдХ [**рдбреЛрдореЗрди рдЯреНрд░рд╕реНрдЯ**](http://technet.microsoft.com/en-us/library/cc759554\(v=ws.10\).aspx) рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рддрдВрддреНрд░ рд╣реИ рдЬреЛ рдПрдХ **рдбреЛрдореЗрди** рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рджреВрд╕рд░реЗ **рдбреЛрдореЗрди** рдореЗрдВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ рджреЛрдиреЛрдВ рдбреЛрдореЗрди рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рдПрдХ рд▓рд┐рдВрдХ рдмрдирд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рддреНрдпрд╛рдкрди рдирд┐рд░реНрдмрд╛рдз рд░реВрдк рд╕реЗ рдкреНрд░рд╡рд╛рд╣рд┐рдд рд╣реЛ рд╕рдХреЗред рдЬрдм рдбреЛрдореЗрди рдПрдХ рдЯреНрд░рд╕реНрдЯ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╡реЗ рдЕрдкрдиреЗ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ (DCs)** рдХреЗ рднреАрддрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ **рдХреБрдВрдЬреА** рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдФрд░ рд░рдЦрд░рдЦрд╛рд╡ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдЯреНрд░рд╕реНрдЯ рдХреА рдЕрдЦрдВрдбрддрд╛ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред

рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ, рдпрджрд┐ рдХреЛрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди** рдореЗрдВ рдПрдХ рд╕реЗрд╡рд╛ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдЗрд░рд╛рджрд╛ рд░рдЦрддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдкрд╣рд▓реЗ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдбреЛрдореЗрди рдХреЗ DC рд╕реЗ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЯрд┐рдХрдЯ рдЬрд┐рд╕реЗ **рдЗрдВрдЯрд░-рд░реАрд▓рдо TGT** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдпрд╣ TGT рдПрдХ рд╕рд╛рдЭрд╛ **рдХреБрдВрдЬреА** рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕ рдкрд░ рджреЛрдиреЛрдВ рдбреЛрдореЗрди рд╕рд╣рдордд рд╣реБрдП рд╣реИрдВред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд┐рд░ рдЗрд╕ TGT рдХреЛ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдХреЗ DC** рдХреЛ рд╕реЗрд╡рд╛ рдЯрд┐рдХрдЯ (**TGS**) рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИред рдЬрдм рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рдХреЗ DC рджреНрд╡рд╛рд░рд╛ рдЗрдВрдЯрд░-рд░реАрд▓рдо TGT рдХрд╛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╕рддреНрдпрд╛рдкрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдПрдХ TGS рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕реЗрд╡рд╛ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

**рдЪрд░рдг**:

1. **рдбреЛрдореЗрди 1** рдореЗрдВ рдПрдХ **рдХреНрд▓рд╛рдЗрдВрдЯ рдХрдВрдкреНрдпреВрдЯрд░** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЕрдкрдиреЗ **NTLM рд╣реИрд╢** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ **рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ (DC1)** рд╕реЗ **рдЯрд┐рдХрдЯ рдЧреНрд░рд╛рдВрдЯрд┐рдВрдЧ рдЯрд┐рдХрдЯ (TGT)** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИред
2. рдпрджрд┐ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ DC1 рдПрдХ рдирдпрд╛ TGT рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИред
3. рдХреНрд▓рд╛рдЗрдВрдЯ рдлрд┐рд░ **рдбреЛрдореЗрди 2** рдореЗрдВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП DC1 рд╕реЗ рдПрдХ **рдЗрдВрдЯрд░-рд░реАрд▓рдо TGT** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИред
4. рдЗрдВрдЯрд░-рд░реАрд▓рдо TGT рдХреЛ DC1 рдФрд░ DC2 рдХреЗ рдмреАрдЪ рд╕рд╛рдЭрд╛ рдЯреНрд░рд╕реНрдЯ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рджреЛ-рддрд░рдлрд╛ рдбреЛрдореЗрди рдЯреНрд░рд╕реНрдЯ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред
5. рдХреНрд▓рд╛рдЗрдВрдЯ рдЗрдВрдЯрд░-рд░реАрд▓рдо TGT рдХреЛ **рдбреЛрдореЗрди 2 рдХреЗ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ (DC2)** рдкрд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИред
6. DC2 рдЕрдкрдиреЗ рд╕рд╛рдЭрд╛ рдЯреНрд░рд╕реНрдЯ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрдВрдЯрд░-рд░реАрд▓рдо TGT рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдпрджрд┐ рдорд╛рдиреНрдп рд╣реИ, рддреЛ рд╡рд╣ рдЙрд╕ рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП **рдЯрд┐рдХрдЯ рдЧреНрд░рд╛рдВрдЯрд┐рдВрдЧ рд╕реЗрд╡рд╛ (TGS)** рдЬрд╛рд░реА рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИред
7. рдЕрдВрддрддрдГ, рдХреНрд▓рд╛рдЗрдВрдЯ рдЗрд╕ TGS рдХреЛ рд╕рд░реНрд╡рд░ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рд╕рд░реНрд╡рд░ рдХреЗ рдЦрд╛рддреЗ рдХреЗ рд╣реИрд╢ рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддрд╛рдХрд┐ рдбреЛрдореЗрди 2 рдореЗрдВ рд╕реЗрд╡рд╛ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХреЗред

### рд╡рд┐рднрд┐рдиреНрди рдЯреНрд░рд╕реНрдЯ

рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **рдПрдХ рдЯреНрд░рд╕реНрдЯ 1-рддрд░рдлрд╛ рдпрд╛ 2-рддрд░рдлрд╛** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред 2-рддрд░рдлрд╛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдореЗрдВ, рджреЛрдиреЛрдВ рдбреЛрдореЗрди рдПрдХ-рджреВрд╕рд░реЗ рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди **1-рддрд░рдлрд╛** рдЯреНрд░рд╕реНрдЯ рд╕рдВрдмрдВрдз рдореЗрдВ рдПрдХ рдбреЛрдореЗрди **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп** рд╣реЛрдЧрд╛ рдФрд░ рджреВрд╕рд░рд╛ **рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛** рдбреЛрдореЗрди рд╣реЛрдЧрд╛ред рдЕрдВрддрд┐рдо рдорд╛рдорд▓реЗ рдореЗрдВ, **рдЖрдк рдХреЗрд╡рд▓ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЛрдореЗрди рд╕реЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рдХреЗ рдЕрдВрджрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВрдЧреЗ**ред

рдпрджрд┐ рдбреЛрдореЗрди A, рдбреЛрдореЗрди B рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рддреЛ A рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдбреЛрдореЗрди рд╣реИ рдФрд░ B рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдбреЛрдореЗрди A** рдореЗрдВ, рдпрд╣ рдПрдХ **рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдЯреНрд░рд╕реНрдЯ** рд╣реЛрдЧрд╛; рдФрд░ **рдбреЛрдореЗрди B** рдореЗрдВ, рдпрд╣ рдПрдХ **рдЗрдирдмрд╛рдЙрдВрдб рдЯреНрд░рд╕реНрдЯ** рд╣реЛрдЧрд╛ред

**рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдз**

* **рдорд╛рддрд╛-рдкрд┐рддрд╛-рд╢рд┐рд╢реБ рдЯреНрд░рд╕реНрдЯ**: рдпрд╣ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╕реЗрдЯрдЕрдк рд╣реИ рдЬреЛ рдПрдХ рд╣реА рд╡рди рдХреЗ рднреАрддрд░ рд╣реЛрддрд╛ рд╣реИ, рдЬрд╣рд╛рдБ рдПрдХ рд╢рд┐рд╢реБ рдбреЛрдореЗрди рдЕрдкрдиреЗ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдбреЛрдореЗрди рдХреЗ рд╕рд╛рде рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рджреЛ-рддрд░рдлрд╛ рдкрд╛рд░рдЧрдореНрдп рдЯреНрд░рд╕реНрдЯ рд░рдЦрддрд╛ рд╣реИред рдореВрд▓ рд░реВрдк рд╕реЗ, рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдиреБрд░реЛрдз рдорд╛рддрд╛-рдкрд┐рддрд╛ рдФрд░ рд╢рд┐рд╢реБ рдХреЗ рдмреАрдЪ рдирд┐рд░реНрдмрд╛рдз рд░реВрдк рд╕реЗ рдкреНрд░рд╡рд╛рд╣рд┐рдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
* **рдХреНрд░реЙрд╕-рд▓рд┐рдВрдХ рдЯреНрд░рд╕реНрдЯ**: "рд╢реЙрд░реНрдЯрдХрдЯ рдЯреНрд░рд╕реНрдЯ" рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрджрд░реНрднрд┐рдд, рдпреЗ рд╢рд┐рд╢реБ рдбреЛрдореЗрди рдХреЗ рдмреАрдЪ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╕рдВрджрд░реНрдн рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рддреЗрдЬ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЬрдЯрд┐рд▓ рд╡рди рдореЗрдВ, рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рдВрджрд░реНрдн рдЖрдорддреМрд░ рдкрд░ рд╡рди рдХреА рдЬрдбрд╝ рддрдХ рдпрд╛рддреНрд░рд╛ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рд▓рдХреНрд╖рд┐рдд рдбреЛрдореЗрди рддрдХ рдкрд╣реБрдБрдЪрддреЗ рд╣реИрдВред рдХреНрд░реЙрд╕-рд▓рд┐рдВрдХ рдмрдирд╛рдХрд░, рдпрд╛рддреНрд░рд╛ рдХреЛ рдЫреЛрдЯрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рднреМрдЧреЛрд▓рд┐рдХ рд░реВрдк рд╕реЗ рдлреИрд▓реЗ рд╣реБрдП рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдлрд╛рдпрджреЗрдордВрдж рд╣реЛрддрд╛ рд╣реИред
* **рдмрд╛рд╣рд░реА рдЯреНрд░рд╕реНрдЯ**: рдпреЗ рд╡рд┐рднрд┐рдиреНрди, рдЕрд╕рдВрдмрдВрдзрд┐рдд рдбреЛрдореЗрди рдХреЗ рдмреАрдЪ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ рдЧреИрд░-рдкрд╛рд░рдЧрдореНрдп рд╣реЛрддреЗ рд╣реИрдВред [Microsoft рдХреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝](https://technet.microsoft.com/en-us/library/cc773178\(v=ws.10\).aspx) рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдмрд╛рд╣рд░реА рдЯреНрд░рд╕реНрдЯ рдЙрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рд╡рд░реНрддрдорд╛рди рд╡рди рдХреЗ рдмрд╛рд╣рд░ рдПрдХ рдбреЛрдореЗрди рдореЗрдВ рд╣реИрдВ рдЬреЛ рд╡рди рдЯреНрд░рд╕реНрдЯ рджреНрд╡рд╛рд░рд╛ рдЬреБрдбрд╝реЗ рдирд╣реАрдВ рд╣реИрдВред SID рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рд╣рд░реА рдЯреНрд░рд╕реНрдЯ рдХреЗ рд╕рд╛рде рдмрдврд╝рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* **рдЯреНрд░реА-рд░реВрдЯ рдЯреНрд░рд╕реНрдЯ**: рдпреЗ рдЯреНрд░рд╕реНрдЯ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╡рди рдХреА рдЬрдбрд╝ рдбреЛрдореЗрди рдФрд░ рдПрдХ рдирдП рдЬреЛрдбрд╝реЗ рдЧрдП рдЯреНрд░реА рд░реВрдЯ рдХреЗ рдмреАрдЪ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдЬрдмрдХрд┐ рдпреЗ рд╕рд╛рдорд╛рдиреНрдпрддрдГ рдирд╣реАрдВ рдорд┐рд▓рддреЗ рд╣реИрдВ, рдЯреНрд░реА-рд░реВрдЯ рдЯреНрд░рд╕реНрдЯ рдирдП рдбреЛрдореЗрди рдкреЗрдбрд╝реЛрдВ рдХреЛ рдПрдХ рд╡рди рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЙрдиреНрд╣реЗрдВ рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдбреЛрдореЗрди рдирд╛рдо рдмрдирд╛рдП рд░рдЦрдиреЗ рдФрд░ рджреЛ-рддрд░рдлрд╛ рдкрд╛рд░рдЧрдореНрдпрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [Microsoft рдХреЗ рдЧрд╛рдЗрдб](https://technet.microsoft.com/en-us/library/cc773178\(v=ws.10\).aspx) рдореЗрдВ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред
* **рд╡рди рдЯреНрд░рд╕реНрдЯ**: рдпрд╣ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЯреНрд░рд╕реНрдЯ рджреЛ рд╡рди рд░реВрдЯ рдбреЛрдореЗрди рдХреЗ рдмреАрдЪ рдПрдХ рджреЛ-рддрд░рдлрд╛ рдкрд╛рд░рдЧрдореНрдп рдЯреНрд░рд╕реНрдЯ рд╣реИ, рдЬреЛ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП SID рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред
* **MIT рдЯреНрд░рд╕реНрдЯ**: рдпреЗ рдЯреНрд░рд╕реНрдЯ рдЧреИрд░-рд╡рд┐рдВрдбреЛрдЬ, [RFC4120-рдЕрдиреБрд░реВрдк](https://tools.ietf.org/html/rfc4120) Kerberos рдбреЛрдореЗрди рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред MIT рдЯреНрд░рд╕реНрдЯ рдереЛрдбрд╝реЗ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖реАрдХреГрдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдЙрди рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╡рд┐рдВрдбреЛрдЬ рдкрд╛рд░рд┐рд╕реНрдерд┐рддрд┐рдХреА рддрдВрддреНрд░ рдХреЗ рдмрд╛рд╣рд░ Kerberos-рдЖрдзрд╛рд░рд┐рдд рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

#### **рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдзреЛрдВ рдореЗрдВ рдЕрдиреНрдп рднрд┐рдиреНрдирддрд╛рдПрдБ**

* рдПрдХ рдЯреНрд░рд╕реНрдЯ рд╕рдВрдмрдВрдз рднреА **рдкрд╛рд░рдЧрдореНрдп** (A рдЯреНрд░рд╕реНрдЯ B, B рдЯреНрд░рд╕реНрдЯ C, рддреЛ A рдЯреНрд░рд╕реНрдЯ C) рдпрд╛ **рдЧреИрд░-рдкрд╛рд░рдЧрдореНрдп** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
* рдПрдХ рдЯреНрд░рд╕реНрдЯ рд╕рдВрдмрдВрдз рдХреЛ **рджреНрд╡рд┐рджрд┐рд╢реАрдп рдЯреНрд░рд╕реНрдЯ** (рджреЛрдиреЛрдВ рдПрдХ-рджреВрд╕рд░реЗ рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ) рдпрд╛ **рдПрдХ-рддрд░рдлрд╛ рдЯреНрд░рд╕реНрдЯ** (рдХреЗрд╡рд▓ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рджреВрд╕рд░реЗ рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рддрд╛ рд╣реИ) рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### рд╣рдорд▓реЗ рдХрд╛ рдорд╛рд░реНрдЧ

1. **рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕рдВрдмрдВрдзреЛрдВ** рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ
2. рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ **рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдореБрдЦ** (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рд╕рдореВрд╣/рдХрдВрдкреНрдпреВрдЯрд░) рдХреЗ рдкрд╛рд╕ **рджреВрд╕рд░реЗ рдбреЛрдореЗрди** рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ **рдкрд╣реБрдБрдЪ** рд╣реИ, рд╢рд╛рдпрдж ACE рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдпрд╛ рджреВрд╕рд░реЗ рдбреЛрдореЗрди рдХреЗ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдгред **рдбреЛрдореЗрди рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдзреЛрдВ** рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ (рдпрд╣ рдЯреНрд░рд╕реНрдЯ рд╢рд╛рдпрдж рдЗрд╕ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛)ред
1. рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ kerberoast рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
3. **рд╕рдордЭреМрддрд╛ рдХрд░реЗрдВ** рдЙрди **рдЦрд╛рддреЛрдВ** рдХрд╛ рдЬреЛ **рдбреЛрдореЗрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд┐рд╡рдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЗ рдкрд╛рд╕ рджреВрд╕рд░реЗ рдбреЛрдореЗрди рдореЗрдВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреАрди рдкреНрд░рд╛рдердорд┐рдХ рддрдВрддреНрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:

* **рд╕реНрдерд╛рдиреАрдп рд╕рдореВрд╣ рд╕рджрд╕реНрдпрддрд╛**: рдкреНрд░рдореБрдЦреЛрдВ рдХреЛ рдорд╢реАрдиреЛрдВ рдкрд░ рд╕реНрдерд╛рдиреАрдп рд╕рдореВрд╣реЛрдВ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рд╕рд░реНрд╡рд░ рдкрд░ "рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХреЛрдВ" рдХрд╛ рд╕рдореВрд╣, рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдЙрд╕ рдорд╢реАрди рдкрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
* **рд╡рд┐рджреЗрд╢реА рдбреЛрдореЗрди рд╕рдореВрд╣ рд╕рджрд╕реНрдпрддрд╛**: рдкреНрд░рдореБрдЦ рднреА рд╡рд┐рджреЗрд╢реА рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рд╕рдореВрд╣реЛрдВ рдХреЗ рд╕рджрд╕реНрдп рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрд╕ рд╡рд┐рдзрд┐ рдХреА рдкреНрд░рднрд╛рд╡рд╢реАрд▓рддрд╛ рдЯреНрд░рд╕реНрдЯ рдХреА рдкреНрд░рдХреГрддрд┐ рдФрд░ рд╕рдореВрд╣ рдХреЗ рджрд╛рдпрд░реЗ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИред
* **рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓ рд▓рд┐рд╕реНрдЯ (ACLs)**: рдкреНрд░рдореБрдЦреЛрдВ рдХреЛ **ACL** рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **DACL** рдореЗрдВ **ACEs** рдХреЗ рд░реВрдк рдореЗрдВ, рдЬреЛ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЬреЛ рд▓реЛрдЧ ACLs, DACLs, рдФрд░ ACEs рдХреЗ рддрдВрддреНрд░ рдореЗрдВ рдЧрд╣рд░рд╛рдИ рд╕реЗ рдЬрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЙрдирдХреЗ рд▓рд┐рдП тАЬ[An ACE Up The Sleeve](https://specterops.io/assets/resources/an\_ace\_up\_the\_sleeve.pdf)тАЭ рд╢реАрд░реНрд╖рдХ рд╡рд╛рд▓рд╛ рд╢реНрд╡реЗрдд рдкрддреНрд░ рдПрдХ рдЕрдореВрд▓реНрдп рд╕рдВрд╕рд╛рдзрди рд╣реИред

### рд╢рд┐рд╢реБ-рд╕реЗ-рдорд╛рддрд╛-рдкрд┐рддрд╛ рд╡рди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐
```
Get-DomainTrust

SourceName      : sub.domain.local    --> current domain
TargetName      : domain.local        --> foreign domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST       --> WITHIN_FOREST: Both in the same forest
TrustDirection  : Bidirectional       --> Trust direction (2ways in this case)
WhenCreated     : 2/19/2021 1:28:00 PM
WhenChanged     : 2/19/2021 1:28:00 PM
```
{% hint style="warning" %}
рдпрд╣рд╛рдБ **2 рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреБрдВрдЬреА** рд╣реИрдВ, рдПрдХ _Child --> Parent_ рдХреЗ рд▓рд┐рдП рдФрд░ рджреВрд╕рд░реА _Parent_ --> _Child_ рдХреЗ рд▓рд┐рдПред\
рдЖрдк рд╡рд░реНрддрдорд╛рди рдбреЛрдореЗрди рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдХреБрдВрдЬреА рдХреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
Invoke-Mimikatz -Command '"lsadump::trust /patch"' -ComputerName dc.my.domain.local
Invoke-Mimikatz -Command '"lsadump::dcsync /user:dcorp\mcorp$"'
```
{% endhint %}

#### SID-History Injection

Enterprise admin рдХреЗ рд░реВрдк рдореЗрдВ рдмрдЪреНрдЪреЗ/рдорд╛рддрд╛-рдкрд┐рддрд╛ рдбреЛрдореЗрди рдореЗрдВ SID-History рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдврд╝реЗрдВ:

{% content-ref url="sid-history-injection.md" %}
[sid-history-injection.md](sid-history-injection.md)
{% endcontent-ref %}

#### Exploit writeable Configuration NC

Configuration Naming Context (NC) рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рд╕рдордЭрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред Configuration NC Active Directory (AD) рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдПрдХ рдЬрдВрдЧрд▓ рдХреЗ рднреАрддрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЗрдВрджреНрд░реАрдп рднрдВрдбрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдбреЗрдЯрд╛ рдЬрдВрдЧрд▓ рдХреЗ рднреАрддрд░ рд╣рд░ Domain Controller (DC) рдкрд░ рдкреБрдирд░реБрддреНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ, writable DCs Configuration NC рдХреА рдПрдХ writable рдкреНрд░рддрд┐ рдмрдирд╛рдП рд░рдЦрддреЗ рд╣реИрдВред рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХрд┐рд╕реА рдХреЗ рдкрд╛рд╕ **DC рдкрд░ SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдПрдХ рдмрдЪреНрдЪреЗ DC рдкрд░ред

**Link GPO to root DC site**

Configuration NC рдХреЗ Sites рдХрдВрдЯреЗрдирд░ рдореЗрдВ AD рдЬрдВрдЧрд▓ рдХреЗ рднреАрддрд░ рд╕рднреА рдбреЛрдореЗрди-рдЬреЛрдбрд╝реЗ рдЧрдП рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдХреЗ рд╕рд╛рдЗрдЯреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рд╣реИред рдХрд┐рд╕реА рднреА DC рдкрд░ SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдп рдХрд░рдХреЗ, рд╣рдорд▓рд╛рд╡рд░ GPOs рдХреЛ root DC рд╕рд╛рдЗрдЯреЛрдВ рд╕реЗ рд▓рд┐рдВрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдХреНрд░рд┐рдпрд╛ рдЗрди рд╕рд╛рдЗрдЯреЛрдВ рдкрд░ рд▓рд╛рдЧреВ рдХреА рдЧрдИ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рд╣реЗрд░рдлреЗрд░ рдХрд░рдХреЗ root рдбреЛрдореЗрди рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЦрддрд░реЗ рдореЗрдВ рдбрд╛рд▓ рд╕рдХрддреА рд╣реИред

рдЧрд╣рд░рд╛рдИ рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдХреЛрдИ [Bypassing SID Filtering](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-4-bypass-sid-filtering-research) рдкрд░ рд╢реЛрдз рдХрд░ рд╕рдХрддрд╛ рд╣реИред

**Compromise any gMSA in the forest**

рдПрдХ рд╣рдорд▓реЗ рдХрд╛ рд╡реЗрдХреНрдЯрд░ рдбреЛрдореЗрди рдХреЗ рднреАрддрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд gMSAs рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рдирд╛ рд╣реИред KDS Root рдХреБрдВрдЬреА, рдЬреЛ gMSAs рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ, Configuration NC рдХреЗ рднреАрддрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИред рдХрд┐рд╕реА рднреА DC рдкрд░ SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд╛рде, KDS Root рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдФрд░ рдЬрдВрдЧрд▓ рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рднреА gMSA рдХреЗ рд▓рд┐рдП рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╢реНрд▓реЗрд╖рдг [Golden gMSA Trust Attacks](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-5-golden-gmsa-trust-attack-from-child-to-parent) рдкрд░ рдЪрд░реНрдЪрд╛ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**Schema change attack**

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдзреИрд░реНрдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдирдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд AD рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдирд╛ред SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд╛рде, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ AD Schema рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рднреА рд╡рд░реНрдЧреЛрдВ рдкрд░ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЗрд╕рд╕реЗ рдирдП рдмрдирд╛рдП рдЧрдП AD рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдкрд░ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

рдЕрдзрд┐рдХ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП [Schema Change Trust Attacks](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-6-schema-change-trust-attack-from-child-to-parent) рдкрд░ рдЬрд╛рдПрдВред

**From DA to EA with ADCS ESC5**

ADCS ESC5 рднреЗрджреНрдпрддрд╛ Public Key Infrastructure (PKI) рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рддреА рд╣реИ рддрд╛рдХрд┐ рдПрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЯреЗрдореНрдкрд▓реЗрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬреЛ рдЬрдВрдЧрд▓ рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИред рдЪреВрдВрдХрд┐ PKI рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ Configuration NC рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рдПрдХ writable рдмрдЪреНрдЪреЗ DC рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ ESC5 рд╣рдорд▓реЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдЗрд╕ рдкрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг [From DA to EA with ESC5](https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c) рдореЗрдВ рдкрдврд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред ADCS рдХреА рдХрдореА рд╡рд╛рд▓реЗ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ, рд╣рдорд▓рд╛рд╡рд░ рдЖрд╡рд╢реНрдпрдХ рдШрдЯрдХреЛрдВ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд░рдЦрддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ [Escalating from Child Domain Admins to Enterprise Admins](https://www.pkisolutions.com/escalating-from-child-domains-admins-to-enterprise-admins-in-5-minutes-by-abusing-ad-cs-a-follow-up/) рдореЗрдВ рдЪрд░реНрдЪрд╛ рдХреА рдЧрдИ рд╣реИред

### External Forest Domain - One-Way (Inbound) or bidirectional
```powershell
Get-DomainTrust
SourceName      : a.domain.local   --> Current domain
TargetName      : domain.external  --> Destination domain
TrustType       : WINDOWS-ACTIVE_DIRECTORY
TrustAttributes :
TrustDirection  : Inbound          --> Inboud trust
WhenCreated     : 2/19/2021 10:50:56 PM
WhenChanged     : 2/19/2021 10:50:56 PM
```
рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ **рдЖрдкрдХрд╛ рдбреЛрдореЗрди рдПрдХ рдмрд╛рд╣рд░реА рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИ** рдЬреЛ рдЖрдкрдХреЛ **рдЕрдирд┐рд╢реНрдЪрд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рджреЗрддрд╛ рд╣реИред рдЖрдкрдХреЛ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ **рдЖрдкрдХреЗ рдбреЛрдореЗрди рдХреЗ рдХреМрди рд╕реЗ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рдХреЗ рдкрд╛рд╕ рдмрд╛рд╣рд░реА рдбреЛрдореЗрди рдкрд░ рдХреМрди рд╕рд╛ рдПрдХреНрд╕реЗрд╕ рд╣реИ** рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ рднреБрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ:

{% content-ref url="external-forest-domain-oneway-inbound.md" %}
[external-forest-domain-oneway-inbound.md](external-forest-domain-oneway-inbound.md)
{% endcontent-ref %}

### рдмрд╛рд╣рд░реА рд╡рди рдбреЛрдореЗрди - рдПрдХрддрд░рдлрд╛ (рдЖрдЙрдЯрдмрд╛рдЙрдВрдб)
```powershell
Get-DomainTrust -Domain current.local

SourceName      : current.local   --> Current domain
TargetName      : external.local  --> Destination domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : FOREST_TRANSITIVE
TrustDirection  : Outbound        --> Outbound trust
WhenCreated     : 2/19/2021 10:15:24 PM
WhenChanged     : 2/19/2021 10:15:24 PM
```
In this scenario **рдЖрдкрдХрд╛ рдбреЛрдореЗрди** **рдХрд┐рд╕реА рдЕрдиреНрдп рдбреЛрдореЗрди** рдХреЗ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ **рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** **рд╡рд┐рд╢реНрд╡рд╛рд╕** рдХрд░ рд░рд╣рд╛ рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрдм рдПрдХ **рдбреЛрдореЗрди рдХреЛ рд╡рд┐рд╢реНрд╡рд╛рд╕** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдбреЛрдореЗрди **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИ** рдЬрд┐рд╕рдХрд╛ **рдирд╛рдо рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рдирд┐рдд** рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЬреЛ **рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдкрд╛рд╕рд╡рд░реНрдб** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдбреЛрдореЗрди рдХреЗ рдЕрдВрджрд░ рдЬрд╛рдПрдВ** рдФрд░ рдЙрд╕реЗ рд╕реВрдЪреАрдмрджреНрдз рдХрд░реЗрдВ рдФрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ:

{% content-ref url="external-forest-domain-one-way-outbound.md" %}
[external-forest-domain-one-way-outbound.md](external-forest-domain-one-way-outbound.md)
{% endcontent-ref %}

рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдбреЛрдореЗрди рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ [**SQL trusted link**](abusing-ad-mssql.md#mssql-trusted-links) рдХреЛ рдЦреЛрдЬрдирд╛ рдЬреЛ **рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕** рдХреА **рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛** рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдЬреЛ рдмрд╣реБрдд рд╕рд╛рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИ)ред

рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдбреЛрдореЗрди рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ рдЙрд╕ рдорд╢реАрди рдкрд░ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рдЬрд╣рд╛рдВ **рд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдбреЛрдореЗрди рдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ** **RDP** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдлрд┐рд░, рд╣рдорд▓рд╛рд╡рд░ RDP рд╕рддреНрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рд╡рд┐рдХреНрдЯрд┐рдо рдХреЗ рдореВрд▓ рдбреЛрдореЗрди** рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ **рд╡рд┐рдХреНрдЯрд┐рдо рдиреЗ рдЕрдкрдирд╛ рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ рдорд╛рдЙрдВрдЯ рдХрд┐рдпрд╛ рд╣реИ**, рддреЛ **RDP рд╕рддреНрд░** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ **рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ рдХреЗ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдлрд╝реЛрд▓реНрдбрд░** рдореЗрдВ **рдмреИрдХрдбреЛрд░** рд╕реНрдЯреЛрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ **RDPInception** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

{% content-ref url="rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](rdp-sessions-abuse.md)
{% endcontent-ref %}

### рдбреЛрдореЗрди рд╡рд┐рд╢реНрд╡рд╛рд╕ рджреБрд░реБрдкрдпреЛрдЧ рд╢рдорди

### **SID рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ:**

* SID рдЗрддрд┐рд╣рд╛рд╕ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдорд▓реЛрдВ рдХреЗ рдЬреЛрдЦрд┐рдо рдХреЛ SID рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рджреНрд╡рд╛рд░рд╛ рдХрдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕рднреА рдЗрдВрдЯрд░-рдлреЙрд░реЗрд╕реНрдЯ рдЯреНрд░рд╕реНрдЯ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд░рд┐рдп рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рдЗрд╕ рдзрд╛рд░рдгрд╛ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ рдХрд┐ рдЗрдВрдЯреНрд░рд╛-рдлреЙрд░реЗрд╕реНрдЯ рдЯреНрд░рд╕реНрдЯ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИрдВ, рдлреЙрд░реЗрд╕реНрдЯ рдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рд╕реАрдорд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирддреЗ рд╣реБрдП, рди рдХрд┐ рдбреЛрдореЗрди рдХреЛ, рдЬреИрд╕рд╛ рдХрд┐ рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдХрд╛ рдорд╛рдирдирд╛ рд╣реИред
* рд╣рд╛рд▓рд╛рдБрдХрд┐, рдПрдХ рдкрдХрдбрд╝ рд╣реИ: SID рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣реБрдВрдЪ рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рдЗрд╕реЗ рдХрднреА-рдХрднреА рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### **рдЪрдпрдирд╛рддреНрдордХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг:**

* рдЗрдВрдЯрд░-рдлреЙрд░реЗрд╕реНрдЯ рдЯреНрд░рд╕реНрдЯ рдХреЗ рд▓рд┐рдП, рдЪрдпрдирд╛рддреНрдордХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рджреЛрдиреЛрдВ рдлреЙрд░реЗрд╕реНрдЯ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдбреЛрдореЗрди рдпрд╛ рдлреЙрд░реЗрд╕реНрдЯ рдХреЗ рднреАрддрд░ рдбреЛрдореЗрди рдФрд░ рд╕рд░реНрд╡рд░реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рд╕реНрдкрд╖реНрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
* рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдпреЗ рдЙрдкрд╛рдп рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдирд╛рдорд┐рдВрдЧ рд╕рдВрджрд░реНрдн (NC) рдХреЗ рд╢реЛрд╖рдг рдпрд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдЦрд╛рддреЗ рдкрд░ рд╣рдорд▓реЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред

[**iRed.team рдкрд░ рдбреЛрдореЗрди рдЯреНрд░рд╕реНрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реАред**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain)

## AD -> Azure & Azure -> AD

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/azure-security/az-lateral-movements/azure-ad-connect-hybrid-identity" %}

## рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рд░рдХреНрд╖рд╛

[**рдпрд╣рд╛рдВ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВред**](../stealing-credentials/credentials-protections.md)\\

### **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рд░рдХреНрд╖рд╛рддреНрдордХ рдЙрдкрд╛рдп**

* **рдбреЛрдореЗрди рдПрдбрдорд┐рди рдкреНрд░рддрд┐рдмрдВрдз**: рдпрд╣ рдЕрдиреБрд╢рдВрд╕рд╛ рдХреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдбреЛрдореЗрди рдПрдбрдорд┐рди рдХреЗрд╡рд▓ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░реНрд╕ рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдП, рдЕрдиреНрдп рд╣реЛрд╕реНрдЯ рдкрд░ рдЙрдирдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдмрдЪреЗрдВред
* **рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░**: рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдбреЛрдореЗрди рдПрдбрдорд┐рди (DA) рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд╛рде рдирд╣реАрдВ рдЪрд▓рд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред
* **рдЕрд╕реНрдерд╛рдпреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕реАрдорд╛**: DA рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╡рд╛рд▓реЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП, рдЙрдирдХреА рдЕрд╡рдзрд┐ рд╕реАрдорд┐рдд рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рдЗрд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: `Add-ADGroupMember -Identity тАШDomain AdminsтАЩ -Members newDA -MemberTimeToLive (New-TimeSpan -Minutes 20)`

### **рдзреЛрдЦреЗ рдХреА рддрдХрдиреАрдХреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛**

* рдзреЛрдЦреЗ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдореЗрдВ рдЬрд╛рд▓ рдмрд┐рдЫрд╛рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдбрд┐рдХреЙрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдХрдВрдкреНрдпреВрдЯрд░, рдЬрд┐рдирдореЗрдВ рдРрд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рд╕рдорд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ рдпрд╛ рдЬрд┐рдиреНрд╣реЗрдВ рдбреЗрд▓реАрдЧреЗрд╢рди рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдПрдХ рд╡рд┐рд╕реНрддреГрдд рджреГрд╖реНрдЯрд┐рдХреЛрдг рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдирд╛ рдпрд╛ рдЙрдиреНрд╣реЗрдВ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред
* рдПрдХ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ: `Create-DecoyUser -UserFirstName user -UserLastName manager-uncommon -Password Pass@123 | DeployUserDeception -UserFlag PasswordNeverExpires -GUID d07da11f-8a3d-42b6-b0aa-76c962be719a -Verbose`
* рдзреЛрдЦреЗ рдХреА рддрдХрдиреАрдХреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [Deploy-Deception on GitHub](https://github.com/samratashok/Deploy-Deception) рдкрд░ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

### **рдзреЛрдЦреЗ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдирд╛**

* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд▓рд┐рдП**: рд╕рдВрджрд┐рдЧреНрдз рд╕рдВрдХреЗрддреЛрдВ рдореЗрдВ рдЕрд╕рд╛рдорд╛рдиреНрдп ObjectSID, рдЕрд╕рд╛рдорд╛рдиреНрдп рд▓реЙрдЧрд┐рди, рдирд┐рд░реНрдорд╛рдг рддрд┐рдерд┐рдпрд╛рдБ, рдФрд░ рдХрдо рдЦрд░рд╛рдм рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЧрд┐рдирддреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
* **рд╕рд╛рдорд╛рдиреНрдп рд╕рдВрдХреЗрддрдХ**: рд╕рдВрднрд╛рд╡рд┐рдд рдбрд┐рдХреЙрдп рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдЧреБрдгреЛрдВ рдХреА рддреБрд▓рдирд╛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдЧреБрдгреЛрдВ рд╕реЗ рдХрд░рдиреЗ рд╕реЗ рдЕрд╕рдВрдЧрддрддрд╛рдПрдБ рдкреНрд░рдХрдЯ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред [HoneypotBuster](https://github.com/JavelinNetworks/HoneypotBuster) рдЬреИрд╕реЗ рдЙрдкрдХрд░рдг рдРрд╕реА рдзреЛрдЦрд╛рдзрдбрд╝реА рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### **рдбрд┐рдЯреЗрдХреНрд╢рди рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛**

* **Microsoft ATA рдбрд┐рдЯреЗрдХреНрд╢рди рдмрд╛рдпрдкрд╛рд╕**:
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реВрдЪреАрдХрд░рдг**: рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░реНрд╕ рдкрд░ рд╕рддреНрд░ рд╕реВрдЪреАрдХрд░рдг рд╕реЗ рдмрдЪрдирд╛ ATA рдбрд┐рдЯреЗрдХреНрд╢рди рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдПред
* **рдЯрд┐рдХрдЯ рдЕрдиреБрдХрд░рдг**: рдЯрд┐рдХрдЯ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП **aes** рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдбрд┐рдЯреЗрдХреНрд╢рди рд╕реЗ рдмрдЪрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ NTLM рдореЗрдВ рдбрд╛рдЙрдирдЧреНрд░реЗрдб рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред
* **DCSync рд╣рдорд▓реЗ**: ATA рдбрд┐рдЯреЗрдХреНрд╢рди рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЧреИрд░-рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрди рдХрд░рдирд╛ рд╕рд▓рд╛рд╣ рджреА рдЬрд╛рддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдбреЛрдореЗрди рдХрдВрдЯреНрд░реЛрд▓рд░ рд╕реЗ рд╕реАрдзреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХрд░рдиреЗ рдкрд░ рдЕрд▓рд░реНрдЯ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдЧрд╛ред

## рд╕рдВрджрд░реНрдн

* [http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/](http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/)
* [https://www.labofapenetrationtester.com/2018/10/deploy-deception.html](https://www.labofapenetrationtester.com/2018/10/deploy-deception.html)
* [https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
