# Active Directory Methodology

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic overview

**Active Directory**ëŠ” **ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ì**ê°€ **ë„ë©”ì¸**, **ì‚¬ìš©ì**, ë° **ê°ì²´**ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ìƒì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ë³¸ ê¸°ìˆ ë¡œ ì‘ë™í•©ë‹ˆë‹¤. ì´ëŠ” í™•ì¥ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„ë˜ì–´, ë§ì€ ìˆ˜ì˜ ì‚¬ìš©ìë¥¼ ê´€ë¦¬ ê°€ëŠ¥í•œ **ê·¸ë£¹** ë° **í•˜ìœ„ ê·¸ë£¹**ìœ¼ë¡œ ì¡°ì§í•˜ê³ , ë‹¤ì–‘í•œ ìˆ˜ì¤€ì—ì„œ **ì ‘ê·¼ ê¶Œí•œ**ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Active Directory**ì˜ êµ¬ì¡°ëŠ” ì„¸ ê°€ì§€ ì£¼ìš” ê³„ì¸µìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤: **ë„ë©”ì¸**, **íŠ¸ë¦¬**, ë° **í¬ë¦¬ìŠ¤íŠ¸**. **ë„ë©”ì¸**ì€ ê³µí†µ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê³µìœ í•˜ëŠ” **ì‚¬ìš©ì** ë˜ëŠ” **ì¥ì¹˜**ì™€ ê°™ì€ ê°ì²´ì˜ ëª¨ìŒì„ í¬í•¨í•©ë‹ˆë‹¤. **íŠ¸ë¦¬**ëŠ” ê³µìœ  êµ¬ì¡°ë¡œ ì—°ê²°ëœ ì´ëŸ¬í•œ ë„ë©”ì¸ì˜ ê·¸ë£¹ì´ë©°, **í¬ë¦¬ìŠ¤íŠ¸**ëŠ” ì—¬ëŸ¬ íŠ¸ë¦¬ì˜ ëª¨ìŒì„ ë‚˜íƒ€ë‚´ë©°, **ì‹ ë¢° ê´€ê³„**ë¥¼ í†µí•´ ìƒí˜¸ ì—°ê²°ë˜ì–´ ì¡°ì§ êµ¬ì¡°ì˜ ìµœìƒìœ„ ê³„ì¸µì„ í˜•ì„±í•©ë‹ˆë‹¤. ê° ìˆ˜ì¤€ì—ì„œ íŠ¹ì • **ì ‘ê·¼** ë° **í†µì‹  ê¶Œí•œ**ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Active Directory**ì˜ ì£¼ìš” ê°œë…ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **ë””ë ‰í† ë¦¬** â€“ Active Directory ê°ì²´ì™€ ê´€ë ¨ëœ ëª¨ë“  ì •ë³´ë¥¼ ë³´ê´€í•©ë‹ˆë‹¤.
2. **ê°ì²´** â€“ ë””ë ‰í† ë¦¬ ë‚´ì˜ ì—”í‹°í‹°ë¥¼ ë‚˜íƒ€ë‚´ë©°, **ì‚¬ìš©ì**, **ê·¸ë£¹**, ë˜ëŠ” **ê³µìœ  í´ë”**ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
3. **ë„ë©”ì¸** â€“ ë””ë ‰í† ë¦¬ ê°ì²´ì˜ ì»¨í…Œì´ë„ˆ ì—­í• ì„ í•˜ë©°, ì—¬ëŸ¬ ë„ë©”ì¸ì´ **í¬ë¦¬ìŠ¤íŠ¸** ë‚´ì—ì„œ ê³µì¡´í•  ìˆ˜ ìˆìœ¼ë©°, ê° ë„ë©”ì¸ì€ ìì²´ ê°ì²´ ëª¨ìŒì„ ìœ ì§€í•©ë‹ˆë‹¤.
4. **íŠ¸ë¦¬** â€“ ê³µí†µ ë£¨íŠ¸ ë„ë©”ì¸ì„ ê³µìœ í•˜ëŠ” ë„ë©”ì¸ì˜ ê·¸ë£¹ì…ë‹ˆë‹¤.
5. **í¬ë¦¬ìŠ¤íŠ¸** â€“ Active Directoryì˜ ì¡°ì§ êµ¬ì¡°ì˜ ì •ì ìœ¼ë¡œ, ì—¬ëŸ¬ íŠ¸ë¦¬ë¡œ êµ¬ì„±ë˜ë©° ì´ë“¤ ê°„ì— **ì‹ ë¢° ê´€ê³„**ê°€ ìˆìŠµë‹ˆë‹¤.

**Active Directory Domain Services (AD DS)**ëŠ” ë„¤íŠ¸ì›Œí¬ ë‚´ì—ì„œ ì¤‘ì•™ ì§‘ì¤‘ì‹ ê´€ë¦¬ ë° í†µì‹ ì— ì¤‘ìš”í•œ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì„œë¹„ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **ë„ë©”ì¸ ì„œë¹„ìŠ¤** â€“ ë°ì´í„° ì €ì¥ì†Œë¥¼ ì¤‘ì•™ ì§‘ì¤‘í™”í•˜ê³  **ì‚¬ìš©ì**ì™€ **ë„ë©”ì¸** ê°„ì˜ ìƒí˜¸ ì‘ìš©ì„ ê´€ë¦¬í•˜ë©°, **ì¸ì¦** ë° **ê²€ìƒ‰** ê¸°ëŠ¥ì„ í¬í•¨í•©ë‹ˆë‹¤.
2. **ì¸ì¦ì„œ ì„œë¹„ìŠ¤** â€“ ì•ˆì „í•œ **ë””ì§€í„¸ ì¸ì¦ì„œ**ì˜ ìƒì„±, ë°°í¬ ë° ê´€ë¦¬ë¥¼ ê°ë…í•©ë‹ˆë‹¤.
3. **ê²½ëŸ‰ ë””ë ‰í† ë¦¬ ì„œë¹„ìŠ¤** â€“ **LDAP í”„ë¡œí† ì½œ**ì„ í†µí•´ ë””ë ‰í† ë¦¬ ì§€ì› ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì§€ì›í•©ë‹ˆë‹¤.
4. **ë””ë ‰í† ë¦¬ ì—°í•© ì„œë¹„ìŠ¤** â€“ ì—¬ëŸ¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë‹¨ì¼ ì„¸ì…˜ìœ¼ë¡œ ì‚¬ìš©ìë¥¼ ì¸ì¦í•  ìˆ˜ ìˆëŠ” **ì‹±ê¸€ ì‚¬ì¸ì˜¨** ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
5. **ê¶Œí•œ ê´€ë¦¬** â€“ ì €ì‘ê¶Œ ìë£Œë¥¼ ë³´í˜¸í•˜ê¸° ìœ„í•´ ë¬´ë‹¨ ë°°í¬ ë° ì‚¬ìš©ì„ ê·œì œí•©ë‹ˆë‹¤.
6. **DNS ì„œë¹„ìŠ¤** â€“ **ë„ë©”ì¸ ì´ë¦„**ì˜ í•´ì„ì— í•„ìˆ˜ì ì…ë‹ˆë‹¤.

ìì„¸í•œ ì„¤ëª…ì€ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”: [**TechTerms - Active Directory Definition**](https://techterms.com/definition/active\_directory)

### **Kerberos Authentication**

ADë¥¼ **ê³µê²©í•˜ëŠ” ë°©ë²•**ì„ ë°°ìš°ë ¤ë©´ **Kerberos ì¸ì¦ í”„ë¡œì„¸ìŠ¤**ë¥¼ ì •ë§ ì˜ **ì´í•´í•´ì•¼** í•©ë‹ˆë‹¤.\
[**ì‘ë™ ë°©ì‹ì„ ì•„ì§ ëª¨ë¥¸ë‹¤ë©´ ì´ í˜ì´ì§€ë¥¼ ì½ì–´ë³´ì„¸ìš”.**](kerberos-authentication.md)

## Cheat Sheet

ADë¥¼ ì—´ê±°/ì•…ìš©í•˜ê¸° ìœ„í•´ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ëª…ë ¹ì–´ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•˜ë ¤ë©´ [https://wadcoms.github.io/](https://wadcoms.github.io)ì—ì„œ ë§ì€ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Recon Active Directory (No creds/sessions)

AD í™˜ê²½ì— ì ‘ê·¼í•  ìˆ˜ ìˆì§€ë§Œ ìê²© ì¦ëª…/ì„¸ì…˜ì´ ì—†ëŠ” ê²½ìš° ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **ë„¤íŠ¸ì›Œí¬ë¥¼ íœí…ŒìŠ¤íŠ¸:**
* ë„¤íŠ¸ì›Œí¬ë¥¼ ìŠ¤ìº”í•˜ê³ , ë¨¸ì‹ ê³¼ ì—´ë¦° í¬íŠ¸ë¥¼ ì°¾ì•„ **ì·¨ì•½ì ì„ ì•…ìš©**í•˜ê±°ë‚˜ **ìê²© ì¦ëª…ì„ ì¶”ì¶œ**í•˜ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤ (ì˜ˆ: [í”„ë¦°í„°ëŠ” ë§¤ìš° í¥ë¯¸ë¡œìš´ ëŒ€ìƒì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤](ad-information-in-printers.md)).
* DNSë¥¼ ì—´ê±°í•˜ë©´ ë„ë©”ì¸ ë‚´ì˜ ì£¼ìš” ì„œë²„ì— ëŒ€í•œ ì •ë³´(ì›¹, í”„ë¦°í„°, ê³µìœ , VPN, ë¯¸ë””ì–´ ë“±)ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* `gobuster dns -d domain.local -t 25 -w /opt/Seclist/Discovery/DNS/subdomain-top2000.txt`
* ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ë¥¼ ì°¾ìœ¼ë ¤ë©´ ì¼ë°˜ [**íœí…ŒìŠ¤íŒ… ë°©ë²•ë¡ **](../../generic-methodologies-and-resources/pentesting-methodology.md)ì„ í™•ì¸í•˜ì„¸ìš”.
* **smb ì„œë¹„ìŠ¤ì—ì„œ null ë° Guest ì ‘ê·¼ í™•ì¸** (ì´ê²ƒì€ ìµœì‹  Windows ë²„ì „ì—ì„œëŠ” ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤):
* `enum4linux -a -u "" -p "" <DC IP> && enum4linux -a -u "guest" -p "" <DC IP>`
* `smbmap -u "" -p "" -P 445 -H <DC IP> && smbmap -u "guest" -p "" -P 445 -H <DC IP>`
* `smbclient -U '%' -L //<DC IP> && smbclient -U 'guest%' -L //`
* SMB ì„œë²„ë¥¼ ì—´ê±°í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë” ìì„¸í•œ ê°€ì´ë“œëŠ” ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../../network-services-pentesting/pentesting-smb/" %}
[pentesting-smb](../../network-services-pentesting/pentesting-smb/)
{% endcontent-ref %}

* **Ldap ì—´ê±°**
* `nmap -n -sV --script "ldap* and not brute" -p 389 <DC IP>`
* LDAPì„ ì—´ê±°í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë” ìì„¸í•œ ê°€ì´ë“œëŠ” ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (íŠ¹íˆ **ìµëª… ì ‘ê·¼**ì— ì£¼ì˜í•˜ì„¸ìš”):

{% content-ref url="../../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

* **ë„¤íŠ¸ì›Œí¬ë¥¼ ì˜¤ì—¼ì‹œí‚¤ê¸°**
* [**Responderë¡œ ì„œë¹„ìŠ¤ë¥¼ ê°€ì¥í•˜ì—¬ ìê²© ì¦ëª… ìˆ˜ì§‘**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
* [**ë¦´ë ˆì´ ê³µê²©ì„ ì•…ìš©í•˜ì—¬ í˜¸ìŠ¤íŠ¸ì— ì ‘ê·¼**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack)
* [**ì•…ì„± UPnP ì„œë¹„ìŠ¤ ë…¸ì¶œë¡œ ìê²© ì¦ëª… ìˆ˜ì§‘**](../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.md)[**SDP**](https://medium.com/@nickvangilder/exploiting-multifunction-printers-during-a-penetration-test-engagement-28d3840d8856)
* [**OSINT**](https://book.hacktricks.xyz/external-recon-methodology):
* ë‚´ë¶€ ë¬¸ì„œ, ì†Œì…œ ë¯¸ë””ì–´, ì„œë¹„ìŠ¤(ì£¼ë¡œ ì›¹)ì—ì„œ ì‚¬ìš©ì ì´ë¦„/ì´ë¦„ì„ ì¶”ì¶œí•˜ê³  ê³µê°œì ìœ¼ë¡œ ì´ìš© ê°€ëŠ¥í•œ ìë£Œì—ì„œë„ ì¶”ì¶œí•©ë‹ˆë‹¤.
* íšŒì‚¬ ì§ì›ì˜ ì „ì²´ ì´ë¦„ì„ ì°¾ìœ¼ë©´ ë‹¤ì–‘í•œ AD **ì‚¬ìš©ì ì´ë¦„ ê·œì¹™**ì„ ì‹œë„í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (**[ì´ê²ƒì„ ì½ì–´ë³´ì„¸ìš”](https://activedirectorypro.com/active-directory-user-naming-convention/)**). ê°€ì¥ ì¼ë°˜ì ì¸ ê·œì¹™ì€: _NameSurname_, _Name.Surname_, _NamSur_ (ê°ê° 3ê¸€ì), _Nam.Sur_, _NSurname_, _N.Surname_, _SurnameName_, _Surname.Name_, _SurnameN_, _Surname.N_, 3 _ë¬´ì‘ìœ„ ë¬¸ìì™€ 3 ë¬´ì‘ìœ„ ìˆ«ì_ (abc123)ì…ë‹ˆë‹¤.
* ë„êµ¬:
* [w0Tx/generate-ad-username](https://github.com/w0Tx/generate-ad-username)
* [urbanadventurer/username-anarchy](https://github.com/urbanadventurer/username-anarchy)

### User enumeration

* **ìµëª… SMB/LDAP ì—´ê±°:** [**íœí…ŒìŠ¤íŒ… SMB**](../../network-services-pentesting/pentesting-smb/) ë° [**íœí…ŒìŠ¤íŒ… LDAP**](../../network-services-pentesting/pentesting-ldap.md) í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”.
* **Kerbrute ì—´ê±°**: **ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ì ì´ë¦„ì´ ìš”ì²­ë˜ë©´** ì„œë²„ëŠ” **Kerberos ì˜¤ë¥˜** ì½”ë“œ _KRB5KDC\_ERR\_C\_PRINCIPAL\_UNKNOWN_ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ë‹µí•˜ë©°, ì´ë¥¼ í†µí•´ ì‚¬ìš©ì ì´ë¦„ì´ ìœ íš¨í•˜ì§€ ì•ŠìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ìœ íš¨í•œ ì‚¬ìš©ì ì´ë¦„**ì€ **AS-REP** ì‘ë‹µì—ì„œ **TGT**ë¥¼ ìœ ë„í•˜ê±°ë‚˜ _KRB5KDC\_ERR\_PREAUTH\_REQUIRED_ ì˜¤ë¥˜ë¥¼ ë‚˜íƒ€ë‚´ë©°, ì´ëŠ” ì‚¬ìš©ìê°€ ì‚¬ì „ ì¸ì¦ì„ ìˆ˜í–‰í•´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
```bash
./kerbrute_linux_amd64 userenum -d lab.ropnop.com --dc 10.10.10.10 usernames.txt #From https://github.com/ropnop/kerbrute/releases

nmap -p 88 --script=krb5-enum-users --script-args="krb5-enum-users.realm='DOMAIN'" <IP>
Nmap -p 88 --script=krb5-enum-users --script-args krb5-enum-users.realm='<domain>',userdb=/root/Desktop/usernames.txt <IP>

msf> use auxiliary/gather/kerberos_enumusers

crackmapexec smb dominio.es  -u '' -p '' --users | awk '{print $4}' | uniq
```
* **OWA (Outlook Web Access) ì„œë²„**

ë„¤íŠ¸ì›Œí¬ì—ì„œ ì´ëŸ¬í•œ ì„œë²„ ì¤‘ í•˜ë‚˜ë¥¼ ë°œê²¬í•˜ë©´ **ì‚¬ìš©ì ì—´ê±°ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì˜ˆë¥¼ ë“¤ì–´, [**MailSniper**](https://github.com/dafthack/MailSniper) ë„êµ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
ipmo C:\Tools\MailSniper\MailSniper.ps1
# Get info about the domain
Invoke-DomainHarvestOWA -ExchHostname [ip]
# Enumerate valid users from a list of potential usernames
Invoke-UsernameHarvestOWA -ExchHostname [ip] -Domain [domain] -UserList .\possible-usernames.txt -OutFile valid.txt
# Password spraying
Invoke-PasswordSprayOWA -ExchHostname [ip] -UserList .\valid.txt -Password Summer2021
# Get addresses list from the compromised mail
Get-GlobalAddressList -ExchHostname [ip] -UserName [domain]\[username] -Password Summer2021 -OutFile gal.txt
```
{% hint style="warning" %}
ì‚¬ìš©ì ì´ë¦„ ëª©ë¡ì€ [**ì´ github ë¦¬í¬ì§€í† ë¦¬**](https://github.com/danielmiessler/SecLists/tree/master/Usernames/Names) \*\*\*\*ì™€ ì´ê³³ ([**statistically-likely-usernames**](https://github.com/insidetrust/statistically-likely-usernames))ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ, ì´ ì „ì— ìˆ˜í–‰í–ˆì–´ì•¼ í•  ì •ì°° ë‹¨ê³„ì—ì„œ **íšŒì‚¬ì˜ ì§ì› ì´ë¦„**ì„ ì•Œê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ë¦„ê³¼ ì„±ì„ ê°€ì§€ê³  [**namemash.py**](https://gist.github.com/superkojiman/11076951) ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì ì¬ì ì¸ ìœ íš¨ ì‚¬ìš©ì ì´ë¦„ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### í•˜ë‚˜ ì´ìƒì˜ ì‚¬ìš©ì ì´ë¦„ ì•Œê¸°

ì¢‹ìŠµë‹ˆë‹¤, ìœ íš¨í•œ ì‚¬ìš©ì ì´ë¦„ì´ ìˆì§€ë§Œ ë¹„ë°€ë²ˆí˜¸ëŠ” ì—†ëŠ” ìƒí™©ì…ë‹ˆë‹¤... ê·¸ëŸ¼ ì‹œë„í•´ ë³´ì„¸ìš”:

* [**ASREPRoast**](asreproast.md): ì‚¬ìš©ìê°€ _DONT\_REQ\_PREAUTH_ ì†ì„±ì´ **ì—†ë‹¤ë©´**, í•´ë‹¹ ì‚¬ìš©ìì— ëŒ€í•œ **AS\_REP ë©”ì‹œì§€**ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìœ¼ë©°, ì´ ë©”ì‹œì§€ëŠ” ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ íŒŒìƒìœ¼ë¡œ ì•”í˜¸í™”ëœ ë°ì´í„°ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
* [**Password Spraying**](password-spraying.md): ë°œê²¬ëœ ê° ì‚¬ìš©ìì— ëŒ€í•´ ê°€ì¥ **ì¼ë°˜ì ì¸ ë¹„ë°€ë²ˆí˜¸**ë¥¼ ì‹œë„í•´ ë³´ì„¸ìš”. ì–´ë–¤ ì‚¬ìš©ìê°€ ë‚˜ìœ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ë¹„ë°€ë²ˆí˜¸ ì •ì±…ì„ ì—¼ë‘ì— ë‘ì„¸ìš”!).
* OWA ì„œë²„ë¥¼ **ìŠ¤í”„ë ˆì´**í•˜ì—¬ ì‚¬ìš©ì ë©”ì¼ ì„œë²„ì— ì ‘ê·¼ì„ ì‹œë„í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="password-spraying.md" %}
[password-spraying.md](password-spraying.md)
{% endcontent-ref %}

### LLMNR/NBT-NS ì¤‘ë…

ë„¤íŠ¸ì›Œí¬ì˜ ì¼ë¶€ í”„ë¡œí† ì½œì„ **ì¤‘ë…**í•˜ì—¬ **í•´ì‹œ**ë¥¼ **íšë“**í•  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤:

{% content-ref url="../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md" %}
[spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md)
{% endcontent-ref %}

### NTML ë¦´ë ˆì´

í™œì„± ë””ë ‰í† ë¦¬ë¥¼ ì—´ê±°í•˜ëŠ” ë° ì„±ê³µí–ˆë‹¤ë©´ **ë” ë§ì€ ì´ë©”ì¼ê³¼ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ë” ë‚˜ì€ ì´í•´**ë¥¼ ê°–ê²Œ ë  ê²ƒì…ë‹ˆë‹¤. NTML [**ë¦´ë ˆì´ ê³µê²©**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack) \*\*\*\*ì„ ê°•ì œë¡œ ìˆ˜í–‰í•˜ì—¬ AD í™˜ê²½ì— ì ‘ê·¼í•  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.

### NTLM ìê²© ì¦ëª… í›”ì¹˜ê¸°

**null ë˜ëŠ” guest ì‚¬ìš©ì**ë¡œ ë‹¤ë¥¸ PCë‚˜ ê³µìœ ì— **ì ‘ê·¼**í•  ìˆ˜ ìˆë‹¤ë©´, **íŒŒì¼ì„ ë°°ì¹˜**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì˜ˆ: SCF íŒŒì¼). ì´ íŒŒì¼ì´ ì ‘ê·¼ë˜ë©´ **ë‹¹ì‹ ì— ëŒ€í•œ NTML ì¸ì¦ì„ íŠ¸ë¦¬ê±°**í•˜ì—¬ **NTLM ì±Œë¦°ì§€ë¥¼ í›”ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

## ìê²© ì¦ëª…/ì„¸ì…˜ìœ¼ë¡œ í™œì„± ë””ë ‰í† ë¦¬ ì—´ê±°í•˜ê¸°

ì´ ë‹¨ê³„ì—ì„œëŠ” **ìœ íš¨í•œ ë„ë©”ì¸ ê³„ì •ì˜ ìê²© ì¦ëª…ì´ë‚˜ ì„¸ì…˜ì„ ì†ìƒì‹œì¼œì•¼ í•©ë‹ˆë‹¤.** ìœ íš¨í•œ ìê²© ì¦ëª…ì´ë‚˜ ë„ë©”ì¸ ì‚¬ìš©ìë¡œì„œì˜ ì‰˜ì´ ìˆë‹¤ë©´, **ì´ì „ì— ì œê³µëœ ì˜µì…˜ì´ ì—¬ì „íˆ ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ì†ìƒì‹œí‚¤ëŠ” ì˜µì…˜ì„ì„ ê¸°ì–µí•´ì•¼ í•©ë‹ˆë‹¤.**

ì¸ì¦ëœ ì—´ê±°ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— **Kerberos ë”ë¸” í™‰ ë¬¸ì œ**ê°€ ë¬´ì—‡ì¸ì§€ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.

{% content-ref url="kerberos-double-hop-problem.md" %}
[kerberos-double-hop-problem.md](kerberos-double-hop-problem.md)
{% endcontent-ref %}

### ì—´ê±°

ê³„ì •ì„ ì†ìƒì‹œí‚¤ëŠ” ê²ƒì€ **ì „ì²´ ë„ë©”ì¸ì„ ì†ìƒì‹œí‚¤ê¸° ìœ„í•œ í° ë‹¨ê³„**ì…ë‹ˆë‹¤. ì´ì œ **Active Directory ì—´ê±°**ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

[**ASREPRoast**](asreproast.md)ì™€ ê´€ë ¨í•˜ì—¬ ì´ì œ ëª¨ë“  ê°€ëŠ¥í•œ ì·¨ì•½í•œ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, [**Password Spraying**](password-spraying.md)ì™€ ê´€ë ¨í•˜ì—¬ ì†ìƒëœ ê³„ì •ì˜ ë¹„ë°€ë²ˆí˜¸, ë¹ˆ ë¹„ë°€ë²ˆí˜¸ ë° ìƒˆë¡œìš´ ìœ ë§í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* [**CMDë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ ì •ì°° ìˆ˜í–‰**](../basic-cmd-for-pentesters.md#domain-info)
* [**powershellì„ ì‚¬ìš©í•˜ì—¬ ì •ì°°**](../basic-powershell-for-pentesters/)í•  ìˆ˜ë„ ìˆìœ¼ë©°, ì´ëŠ” ë” ì€ë°€í•©ë‹ˆë‹¤.
* [**powerview ì‚¬ìš©**](../basic-powershell-for-pentesters/powerview.md)í•˜ì—¬ ë” ìì„¸í•œ ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* Active Directoryì—ì„œ ì •ì°°ì„ ìœ„í•œ ë˜ ë‹¤ë¥¸ í›Œë¥­í•œ ë„êµ¬ëŠ” [**BloodHound**](bloodhound.md)ì…ë‹ˆë‹¤. ì´ëŠ” **ê·¸ë¦¬ ì€ë°€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤** (ì‚¬ìš©í•˜ëŠ” ìˆ˜ì§‘ ë°©ë²•ì— ë”°ë¼ ë‹¤ë¦„), í•˜ì§€ë§Œ **ê·¸ê²ƒì— ì‹ ê²½ ì“°ì§€ ì•ŠëŠ”ë‹¤ë©´** ê¼­ ì‹œë„í•´ ë³´ì„¸ìš”. ì‚¬ìš©ìê°€ RDPí•  ìˆ˜ ìˆëŠ” ìœ„ì¹˜, ë‹¤ë¥¸ ê·¸ë£¹ìœ¼ë¡œì˜ ê²½ë¡œ ë“±ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ê¸°íƒ€ ìë™í™”ëœ AD ì—´ê±° ë„êµ¬ëŠ”:** [**AD Explorer**](bloodhound.md#ad-explorer)**,** [**ADRecon**](bloodhound.md#adrecon)**,** [**Group3r**](bloodhound.md#group3r)**,** [**PingCastle**](bloodhound.md#pingcastle)**.**
* [**ADì˜ DNS ë ˆì½”ë“œ**](ad-dns-records.md)ë„ í¥ë¯¸ë¡œìš´ ì •ë³´ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ë””ë ‰í† ë¦¬ë¥¼ ì—´ê±°í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” **GUI ë„êµ¬**ëŠ” **SysInternal** Suiteì˜ **AdExplorer.exe**ì…ë‹ˆë‹¤.
* **ldapsearch**ë¥¼ ì‚¬ìš©í•˜ì—¬ LDAP ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ _userPassword_ ë° _unixUserPassword_ í•„ë“œì—ì„œ ìê²© ì¦ëª…ì„ ì°¾ê±°ë‚˜ _Description_ì„ ê²€ìƒ‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. cf. [PayloadsAllTheThingsì˜ AD ì‚¬ìš©ì ì£¼ì„ì—ì„œ ë¹„ë°€ë²ˆí˜¸](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#password-in-ad-user-comment)ì—ì„œ ë‹¤ë¥¸ ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.
* **Linux**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° [**pywerview**](https://github.com/the-useless-one/pywerview)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë„ë©”ì¸ì„ ì—´ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ìë™í™” ë„êµ¬ë¡œëŠ” ë‹¤ìŒì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
* [**tomcarver16/ADSearch**](https://github.com/tomcarver16/ADSearch)
* [**61106960/adPEAS**](https://github.com/61106960/adPEAS)
*   **ëª¨ë“  ë„ë©”ì¸ ì‚¬ìš©ì ì¶”ì¶œí•˜ê¸°**

Windowsì—ì„œ ë„ë©”ì¸ ì‚¬ìš©ì ì´ë¦„ì„ ì–»ëŠ” ê²ƒì€ ë§¤ìš° ì‰½ìŠµë‹ˆë‹¤ (`net user /domain`, `Get-DomainUser` ë˜ëŠ” `wmic useraccount get name,sid`). Linuxì—ì„œëŠ” ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: `GetADUsers.py -all -dc-ip 10.10.10.110 domain.com/username` ë˜ëŠ” `enum4linux -a -u "user" -p "password" <DC IP>`

> ì´ ì—´ê±° ì„¹ì…˜ì´ ì‘ì•„ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, ì´ëŠ” ëª¨ë“  ê²ƒ ì¤‘ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì…ë‹ˆë‹¤. ë§í¬ë¥¼ ë°©ë¬¸í•˜ê³  (ì£¼ë¡œ cmd, powershell, powerview ë° BloodHoundì˜ ë§í¬) ë„ë©”ì¸ì„ ì—´ê±°í•˜ëŠ” ë°©ë²•ì„ ë°°ìš°ê³  í¸ì•ˆí•´ì§ˆ ë•Œê¹Œì§€ ì—°ìŠµí•˜ì„¸ìš”. í‰ê°€ ì¤‘ì—ëŠ” DAë¡œ ê°€ëŠ” ê¸¸ì„ ì°¾ê±°ë‚˜ ì•„ë¬´ê²ƒë„ í•  ìˆ˜ ì—†ë‹¤ê³  ê²°ì •í•˜ëŠ” ì¤‘ìš”í•œ ìˆœê°„ì´ ë  ê²ƒì…ë‹ˆë‹¤.

### Kerberoast

Kerberoastingì€ ì‚¬ìš©ì ê³„ì •ì— ì—°ê²°ëœ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ë˜ëŠ” **TGS í‹°ì¼“**ì„ ì–»ê³ , ê·¸ ì•”í˜¸í™”ë¥¼ í•´ë…í•˜ëŠ” ê³¼ì •ì„ í¬í•¨í•©ë‹ˆë‹¤â€”ì´ëŠ” ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°â€”**ì˜¤í”„ë¼ì¸**ì—ì„œ ìˆ˜í–‰ë©ë‹ˆë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒì„ ì°¸ì¡°í•˜ì„¸ìš”:

{% content-ref url="kerberoast.md" %}
[kerberoast.md](kerberoast.md)
{% endcontent-ref %}

### ì›ê²© ì—°ê²° (RDP, SSH, FTP, Win-RM ë“±)

ì¼ë‹¨ ìê²© ì¦ëª…ì„ ì–»ìœ¼ë©´, **ì–´ë–¤ ë¨¸ì‹ **ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ **CrackMapExec**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ì„œë²„ì— ë‹¤ì–‘í•œ í”„ë¡œí† ì½œë¡œ ì—°ê²°ì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹

ì •ìƒ ë„ë©”ì¸ ì‚¬ìš©ìë¡œì„œ ìê²© ì¦ëª…ì´ë‚˜ ì„¸ì…˜ì„ ì†ìƒì‹œì¼°ê³ , ì´ ì‚¬ìš©ìë¡œ **ë„ë©”ì¸ ë‚´ì˜ ì–´ë–¤ ë¨¸ì‹ ì— ì ‘ê·¼**í•  ìˆ˜ ìˆë‹¤ë©´, **ë¡œì»¬ì—ì„œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ê³  ìê²© ì¦ëª…ì„ ì°¾ëŠ” ë°©ë²•ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤**. ì´ëŠ” ë¡œì»¬ ê´€ë¦¬ì ê¶Œí•œì´ ìˆì–´ì•¼ë§Œ **ë‹¤ë¥¸ ì‚¬ìš©ìì˜ í•´ì‹œë¥¼ ë©”ëª¨ë¦¬(LSASS)ì™€ ë¡œì»¬(SAM)ì—ì„œ ë¤í”„í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.**

ì´ ì±…ì—ëŠ” [**Windowsì—ì„œì˜ ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹**](../windows-local-privilege-escalation/)ì— ëŒ€í•œ ì™„ì „í•œ í˜ì´ì§€ì™€ [**ì²´í¬ë¦¬ìŠ¤íŠ¸**](../checklist-windows-privilege-escalation.md)ê°€ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, [**WinPEAS**](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”.

### í˜„ì¬ ì„¸ì…˜ í‹°ì¼“

ì˜ˆìƒì¹˜ ëª»í•œ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” **í‹°ì¼“**ì„ í˜„ì¬ ì‚¬ìš©ìì—ì„œ ì°¾ëŠ” ê²ƒì€ ë§¤ìš° **ê°€ëŠ¥ì„±ì´ ë‚®ìŠµë‹ˆë‹¤**, í•˜ì§€ë§Œ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
## List all tickets (if not admin, only current user tickets)
.\Rubeus.exe triage
## Dump the interesting one by luid
.\Rubeus.exe dump /service:krbtgt /luid:<luid> /nowrap
[IO.File]::WriteAllBytes("ticket.kirbi", [Convert]::FromBase64String("<BASE64_TICKET>"))
```
### NTML Relay

í™œì„± ë””ë ‰í† ë¦¬ë¥¼ ì—´ê±°í•˜ëŠ” ë° ì„±ê³µí–ˆë‹¤ë©´ **ë” ë§ì€ ì´ë©”ì¼ê³¼ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ë” ë‚˜ì€ ì´í•´**ë¥¼ ê°–ê²Œ ë  ê²ƒì…ë‹ˆë‹¤. NTML [**ë¦´ë ˆì´ ê³µê²©**](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md#relay-attack)**ì„ ê°•ì œí•  ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.**

### **ì»´í“¨í„° ê³µìœ ì—ì„œ ìê²© ì¦ëª… ì°¾ê¸°**

ê¸°ë³¸ ìê²© ì¦ëª…ì„ ì–»ì—ˆìœ¼ë‹ˆ **AD ë‚´ë¶€ì—ì„œ ê³µìœ ë˜ê³  ìˆëŠ” í¥ë¯¸ë¡œìš´ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤**. ìˆ˜ë™ìœ¼ë¡œ í•  ìˆ˜ ìˆì§€ë§Œ ë§¤ìš° ì§€ë£¨í•˜ê³  ë°˜ë³µì ì¸ ì‘ì—…ì…ë‹ˆë‹¤(ìˆ˜ë°± ê°œì˜ ë¬¸ì„œë¥¼ í™•ì¸í•´ì•¼ í•˜ëŠ” ê²½ìš° ë”ë”ìš±).

[**ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬ì— ëŒ€í•´ ì•Œì•„ë³´ë ¤ë©´ ì´ ë§í¬ë¥¼ ë”°ë¥´ì„¸ìš”.**](../../network-services-pentesting/pentesting-smb/#domain-shared-folders-search)

### NTLM ìê²© ì¦ëª… í›”ì¹˜ê¸°

ë‹¤ë¥¸ PCë‚˜ ê³µìœ ì— **ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ë©´**, **íŒŒì¼ì„ ë°°ì¹˜**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì˜ˆ: SCF íŒŒì¼). ì´ íŒŒì¼ì´ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œë“  ì ‘ê·¼ë˜ë©´ **ë‹¹ì‹ ì— ëŒ€í•œ NTML ì¸ì¦ì„ íŠ¸ë¦¬ê±°**í•˜ì—¬ **NTLM ì±Œë¦°ì§€ë¥¼ í›”ì³ì„œ í¬ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:

{% content-ref url="../ntlm/places-to-steal-ntlm-creds.md" %}
[places-to-steal-ntlm-creds.md](../ntlm/places-to-steal-ntlm-creds.md)
{% endcontent-ref %}

### CVE-2021-1675/CVE-2021-34527 PrintNightmare

ì´ ì·¨ì•½ì ì€ ì¸ì¦ëœ ì‚¬ìš©ìê°€ **ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì†ìƒì‹œí‚¬ ìˆ˜ ìˆê²Œ** í–ˆìŠµë‹ˆë‹¤.

{% content-ref url="printnightmare.md" %}
[printnightmare.md](printnightmare.md)
{% endcontent-ref %}

## ê¶Œí•œ ìƒìŠ¹: íŠ¹ê¶Œ ìê²© ì¦ëª…/ì„¸ì…˜ì„ í†µí•œ Active Directory

**ë‹¤ìŒ ê¸°ìˆ ì„ ìˆ˜í–‰í•˜ë ¤ë©´ ì¼ë°˜ ë„ë©”ì¸ ì‚¬ìš©ìë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•Šìœ¼ë©°, ì´ëŸ¬í•œ ê³µê²©ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ íŠ¹ë³„í•œ ê¶Œí•œ/ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.**

### í•´ì‹œ ì¶”ì¶œ

ìš´ ì¢‹ê²Œë„ [AsRepRoast](asreproast.md), [Password Spraying](password-spraying.md), [Kerberoast](kerberoast.md), [Responder](../../generic-methodologies-and-resources/pentesting-network/spoofing-llmnr-nbt-ns-mdns-dns-and-wpad-and-relay-attacks.md) í¬í•¨í•˜ì—¬ ë¦´ë ˆì´, [EvilSSDP](../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.md), [ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹](../windows-local-privilege-escalation/)ì„ í†µí•´ **ë¡œì»¬ ê´€ë¦¬ì** ê³„ì •ì„ **ì†ìƒì‹œí‚¤ëŠ” ë° ì„±ê³µí–ˆë‹¤ë©´**.\
ê·¸ëŸ° ë‹¤ìŒ, ë©”ëª¨ë¦¬ì™€ ë¡œì»¬ì—ì„œ ëª¨ë“  í•´ì‹œë¥¼ ë¤í”„í•  ì‹œê°„ì…ë‹ˆë‹¤.\
[**í•´ì‹œë¥¼ ì–»ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì— ëŒ€í•œ ì´ í˜ì´ì§€ë¥¼ ì½ì–´ë³´ì„¸ìš”.**](https://github.com/carlospolop/hacktricks/blob/master/windows-hardening/active-directory-methodology/broken-reference/README.md)

### í•´ì‹œ ì „ë‹¬

**ì‚¬ìš©ìì˜ í•´ì‹œë¥¼ ì–»ìœ¼ë©´**, ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì‚¬ìš©ìë¥¼ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.\
í•´ì‹œë¥¼ ì‚¬ìš©í•˜ì—¬ **NTLM ì¸ì¦ì„ ìˆ˜í–‰í•˜ëŠ”** **ë„êµ¬**ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ë©°, **ë˜ëŠ”** ìƒˆë¡œìš´ **ì„¸ì…˜ë¡œê·¸ì˜¨**ì„ ìƒì„±í•˜ê³  **LSASS** ë‚´ë¶€ì— ê·¸ **í•´ì‹œë¥¼ ì£¼ì…**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë©´ **NTLM ì¸ì¦ì´ ìˆ˜í–‰ë  ë•Œ** ê·¸ **í•´ì‹œê°€ ì‚¬ìš©ë©ë‹ˆë‹¤**. ë§ˆì§€ë§‰ ì˜µì…˜ì´ mimikatzê°€ í•˜ëŠ” ì¼ì…ë‹ˆë‹¤.\
[**ìì„¸í•œ ì •ë³´ëŠ” ì´ í˜ì´ì§€ë¥¼ ì½ì–´ë³´ì„¸ìš”.**](../ntlm/#pass-the-hash)

### í•´ì‹œ ì´ˆê³¼ ì „ë‹¬/í‚¤ ì „ë‹¬

ì´ ê³µê²©ì€ **ì‚¬ìš©ì NTLM í•´ì‹œë¥¼ ì‚¬ìš©í•˜ì—¬ Kerberos í‹°ì¼“ì„ ìš”ì²­í•˜ëŠ” ê²ƒ**ì„ ëª©í‘œë¡œ í•˜ë©°, ì´ëŠ” ì¼ë°˜ì ì¸ NTLM í”„ë¡œí† ì½œì„ í†µí•œ í•´ì‹œ ì „ë‹¬ì˜ ëŒ€ì•ˆì…ë‹ˆë‹¤. ë”°ë¼ì„œ, ì´ëŠ” **NTLM í”„ë¡œí† ì½œì´ ë¹„í™œì„±í™”ëœ ë„¤íŠ¸ì›Œí¬**ì—ì„œ íŠ¹íˆ **ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. **Kerberosë§Œ ì¸ì¦ í”„ë¡œí† ì½œë¡œ í—ˆìš©ë©ë‹ˆë‹¤.**

{% content-ref url="over-pass-the-hash-pass-the-key.md" %}
[over-pass-the-hash-pass-the-key.md](over-pass-the-hash-pass-the-key.md)
{% endcontent-ref %}

### í‹°ì¼“ ì „ë‹¬

**í‹°ì¼“ ì „ë‹¬(PTT)** ê³µê²© ë°©ë²•ì—ì„œëŠ” ê³µê²©ìê°€ **ì‚¬ìš©ìì˜ ì¸ì¦ í‹°ì¼“ì„ í›”ì¹©ë‹ˆë‹¤**. ì´ í›”ì¹œ í‹°ì¼“ì€ **ì‚¬ìš©ìë¥¼ ê°€ì¥í•˜ëŠ” ë° ì‚¬ìš©ë˜ì–´**, ë„¤íŠ¸ì›Œí¬ ë‚´ì˜ ë¦¬ì†ŒìŠ¤ì™€ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ë¬´ë‹¨ ì ‘ê·¼ì„ ì–»ìŠµë‹ˆë‹¤.

{% content-ref url="pass-the-ticket.md" %}
[pass-the-ticket.md](pass-the-ticket.md)
{% endcontent-ref %}

### ìê²© ì¦ëª… ì¬ì‚¬ìš©

**ë¡œì»¬ ê´€ë¦¬ì**ì˜ **í•´ì‹œ** ë˜ëŠ” **ë¹„ë°€ë²ˆí˜¸**ê°€ ìˆë‹¤ë©´, ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ **PCì— ë¡œì»¬ë¡œ ë¡œê·¸ì¸**í•´ ë³´ì•„ì•¼ í•©ë‹ˆë‹¤.
```bash
# Local Auth Spray (once you found some local admin pass or hash)
## --local-auth flag indicate to only try 1 time per machine
crackmapexec smb --local-auth 10.10.10.10/23 -u administrator -H 10298e182387f9cab376ecd08491764a0 | grep +
```
{% hint style="warning" %}
ì´ê²ƒì€ ìƒë‹¹íˆ **ì‹œë„ëŸ½ê³ ** **LAPS**ê°€ ì´ë¥¼ **ì™„í™”**í•  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### MSSQL ë‚¨ìš© ë° ì‹ ë¢° ë§í¬

ì‚¬ìš©ìê°€ **MSSQL ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ**ì´ ìˆë‹¤ë©´, ê·¸ëŠ” MSSQL í˜¸ìŠ¤íŠ¸ì—ì„œ **ëª…ë ¹ì„ ì‹¤í–‰**í•˜ê±°ë‚˜ (SAë¡œ ì‹¤í–‰ ì¤‘ì¸ ê²½ìš°), NetNTLM **í•´ì‹œ**ë¥¼ **íƒˆì·¨**í•˜ê±°ë‚˜ ì‹¬ì§€ì–´ **ì¤‘ê³„** **ê³µê²©**ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë˜í•œ, MSSQL ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹¤ë¥¸ MSSQL ì¸ìŠ¤í„´ìŠ¤ì— ì˜í•´ ì‹ ë¢°ë°›ëŠ” ê²½ìš°(ë°ì´í„°ë² ì´ìŠ¤ ë§í¬). ì‚¬ìš©ìê°€ ì‹ ë¢°ë°›ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ê¶Œí•œì´ ìˆë‹¤ë©´, ê·¸ëŠ” **ì‹ ë¢° ê´€ê³„ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì—ì„œë„ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì´ëŸ¬í•œ ì‹ ë¢°ëŠ” ì—°ê²°ë  ìˆ˜ ìˆìœ¼ë©°, ì–´ëŠ ì‹œì ì—ì„œ ì‚¬ìš©ìëŠ” ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì˜ëª» êµ¬ì„±ëœ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
**ë°ì´í„°ë² ì´ìŠ¤ ê°„ì˜ ë§í¬ëŠ” í¬ë¦¬ìŠ¤íŠ¸ ì‹ ë¢°ë¥¼ ë„˜ì–´ ì‘ë™í•©ë‹ˆë‹¤.**

{% content-ref url="abusing-ad-mssql.md" %}
[abusing-ad-mssql.md](abusing-ad-mssql.md)
{% endcontent-ref %}

### ì œì•½ ì—†ëŠ” ìœ„ì„

[ADS\_UF\_TRUSTED\_FOR\_DELEGATION](https://msdn.microsoft.com/en-us/library/aa772300\(v=vs.85\).aspx) ì†ì„±ì„ ê°€ì§„ ì»´í“¨í„° ê°ì²´ë¥¼ ë°œê²¬í•˜ê³  í•´ë‹¹ ì»´í“¨í„°ì—ì„œ ë„ë©”ì¸ ê¶Œí•œì´ ìˆë‹¤ë©´, ì»´í“¨í„°ì— ë¡œê·¸ì¸í•˜ëŠ” ëª¨ë“  ì‚¬ìš©ìì˜ ë©”ëª¨ë¦¬ì—ì„œ TGTë¥¼ ë¤í”„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë”°ë¼ì„œ, **ë„ë©”ì¸ ê´€ë¦¬ìê°€ ì»´í“¨í„°ì— ë¡œê·¸ì¸í•˜ë©´**, ê·¸ì˜ TGTë¥¼ ë¤í”„í•˜ê³  [Pass the Ticket](pass-the-ticket.md)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë¥¼ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì œí•œëœ ìœ„ì„ ë•ë¶„ì— **í”„ë¦°íŠ¸ ì„œë²„ë¥¼ ìë™ìœ¼ë¡œ ì†ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤** (í¬ë§ì ìœ¼ë¡œ DCì¼ ê²ƒì…ë‹ˆë‹¤).

{% content-ref url="unconstrained-delegation.md" %}
[unconstrained-delegation.md](unconstrained-delegation.md)
{% endcontent-ref %}

### ì œì•½ëœ ìœ„ì„

ì‚¬ìš©ì ë˜ëŠ” ì»´í“¨í„°ê°€ "ì œì•½ëœ ìœ„ì„"ì„ í—ˆìš©ë°›ìœ¼ë©´, **íŠ¹ì • ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ì–´ë–¤ ì‚¬ìš©ìë¥¼ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.\
ê·¸ëŸ° ë‹¤ìŒ, ì´ ì‚¬ìš©ì/ì»´í“¨í„°ì˜ **í•´ì‹œë¥¼ ì†ìƒì‹œí‚¤ë©´** **ëª¨ë“  ì‚¬ìš©ìë¥¼ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤** (ë„ë©”ì¸ ê´€ë¦¬ì í¬í•¨) íŠ¹ì • ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="constrained-delegation.md" %}
[constrained-delegation.md](constrained-delegation.md)
{% endcontent-ref %}

### ë¦¬ì†ŒìŠ¤ ê¸°ë°˜ ì œì•½ ìœ„ì„

ì›ê²© ì»´í“¨í„°ì˜ Active Directory ê°ì²´ì— ëŒ€í•œ **ì“°ê¸°** ê¶Œí•œì„ ê°€ì§€ë©´ **ìƒìŠ¹ëœ ê¶Œí•œ**ìœ¼ë¡œ ì½”ë“œ ì‹¤í–‰ì„ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="resource-based-constrained-delegation.md" %}
[resource-based-constrained-delegation.md](resource-based-constrained-delegation.md)
{% endcontent-ref %}

### ACL ë‚¨ìš©

ì†ìƒëœ ì‚¬ìš©ìëŠ” **ë„ë©”ì¸ ê°ì²´ì— ëŒ€í•œ í¥ë¯¸ë¡œìš´ ê¶Œí•œ**ì„ ê°€ì§ˆ ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ë‚˜ì¤‘ì— **ì¸¡ë©´ ì´ë™**/**ê¶Œí•œ ìƒìŠ¹**ì„ ê°€ëŠ¥í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="acl-persistence-abuse/" %}
[acl-persistence-abuse](acl-persistence-abuse/)
{% endcontent-ref %}

### í”„ë¦°í„° ìŠ¤í’€ëŸ¬ ì„œë¹„ìŠ¤ ë‚¨ìš©

ë„ë©”ì¸ ë‚´ì—ì„œ **ìŠ¤í’€ ì„œë¹„ìŠ¤ê°€ ìˆ˜ì‹  ëŒ€ê¸° ì¤‘ì¸** ê²ƒì„ ë°œê²¬í•˜ë©´, ì´ë¥¼ **ë‚¨ìš©í•˜ì—¬ ìƒˆë¡œìš´ ìê²© ì¦ëª…ì„ íšë“í•˜ê³ ** **ê¶Œí•œì„ ìƒìŠ¹**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="printers-spooler-service-abuse.md" %}
[printers-spooler-service-abuse.md](printers-spooler-service-abuse.md)
{% endcontent-ref %}

### ì œ3ì ì„¸ì…˜ ë‚¨ìš©

**ë‹¤ë¥¸ ì‚¬ìš©ì**ê°€ **ì†ìƒëœ** ë¨¸ì‹ ì— **ì ‘ê·¼**í•˜ë©´, ë©”ëª¨ë¦¬ì—ì„œ **ìê²© ì¦ëª…ì„ ìˆ˜ì§‘**í•˜ê³  ì‹¬ì§€ì–´ **ê·¸ë“¤ì˜ í”„ë¡œì„¸ìŠ¤ì— ë¹„ì½˜ì„ ì£¼ì…**í•˜ì—¬ ê·¸ë“¤ì„ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ìëŠ” RDPë¥¼ í†µí•´ ì‹œìŠ¤í…œì— ì ‘ê·¼í•˜ë¯€ë¡œ, ì—¬ê¸°ì—ì„œ ì œ3ì RDP ì„¸ì…˜ì— ëŒ€í•œ ëª‡ ê°€ì§€ ê³µê²©ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](rdp-sessions-abuse.md)
{% endcontent-ref %}

### LAPS

**LAPS**ëŠ” ë„ë©”ì¸ì— ê°€ì…ëœ ì»´í“¨í„°ì—ì„œ **ë¡œì»¬ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸**ë¥¼ ê´€ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œì„ ì œê³µí•˜ì—¬, ë¹„ë°€ë²ˆí˜¸ê°€ **ë¬´ì‘ìœ„í™”**, ê³ ìœ í•˜ë©° ìì£¼ **ë³€ê²½**ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë¹„ë°€ë²ˆí˜¸ëŠ” Active Directoryì— ì €ì¥ë˜ë©°, ACLì„ í†µí•´ ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì œì–´ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë¹„ë°€ë²ˆí˜¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê¶Œí•œì´ ìˆìœ¼ë©´, ë‹¤ë¥¸ ì»´í“¨í„°ë¡œ í”¼ë²—í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.

{% content-ref url="laps.md" %}
[laps.md](laps.md)
{% endcontent-ref %}

### ì¸ì¦ì„œ ë„ë‚œ

**ì†ìƒëœ ë¨¸ì‹ ì—ì„œ ì¸ì¦ì„œë¥¼ ìˆ˜ì§‘í•˜ëŠ” ê²ƒ**ì€ í™˜ê²½ ë‚´ì—ì„œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ëŠ” ë°©ë²•ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="ad-certificates/certificate-theft.md" %}
[certificate-theft.md](ad-certificates/certificate-theft.md)
{% endcontent-ref %}

### ì¸ì¦ì„œ í…œí”Œë¦¿ ë‚¨ìš©

**ì·¨ì•½í•œ í…œí”Œë¦¿**ì´ êµ¬ì„±ë˜ì–´ ìˆë‹¤ë©´, ì´ë¥¼ ë‚¨ìš©í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="ad-certificates/domain-escalation.md" %}
[domain-escalation.md](ad-certificates/domain-escalation.md)
{% endcontent-ref %}

## ë†’ì€ ê¶Œí•œ ê³„ì •ìœ¼ë¡œì˜ í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡

### ë„ë©”ì¸ ìê²© ì¦ëª… ë¤í”„

**ë„ë©”ì¸ ê´€ë¦¬ì** ë˜ëŠ” ë” ë‚˜ì•„ê°€ **ì—”í„°í”„ë¼ì´ì¦ˆ ê´€ë¦¬ì** ê¶Œí•œì„ ì–»ìœ¼ë©´, **ë„ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤**ë¥¼ **ë¤í”„**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: _ntds.dit_.

[**DCSync ê³µê²©ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ëŠ” ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](dcsync.md).

[**NTDS.ditë¥¼ í›”ì¹˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ëŠ” ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://github.com/carlospolop/hacktricks/blob/master/windows-hardening/active-directory-methodology/broken-reference/README.md)

### ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•œ ì§€ì†ì„±

ì•ì„œ ë…¼ì˜ëœ ëª‡ ê°€ì§€ ê¸°ìˆ ì€ ì§€ì†ì„±ì— ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

*   ì‚¬ìš©ìë¥¼ [**Kerberoast**](kerberoast.md)ì— ì·¨ì•½í•˜ê²Œ ë§Œë“¤ê¸°

```powershell
Set-DomainObject -Identity <username> -Set @{serviceprincipalname="fake/NOTHING"}r
```
*   ì‚¬ìš©ìë¥¼ [**ASREPRoast**](asreproast.md)ì— ì·¨ì•½í•˜ê²Œ ë§Œë“¤ê¸°

```powershell
Set-DomainObject -Identity <username> -XOR @{UserAccountControl=4194304}
```
*   ì‚¬ìš©ìì—ê²Œ [**DCSync**](./#dcsync) ê¶Œí•œ ë¶€ì—¬í•˜ê¸°

```powershell
Add-DomainObjectAcl -TargetIdentity "DC=SUB,DC=DOMAIN,DC=LOCAL" -PrincipalIdentity bfarmer -Rights DCSync
```

### ì‹¤ë²„ í‹°ì¼“

**ì‹¤ë²„ í‹°ì¼“ ê³µê²©**ì€ íŠ¹ì • ì„œë¹„ìŠ¤ì— ëŒ€í•œ **í•©ë²•ì ì¸ í‹°ì¼“ ë¶€ì—¬ ì„œë¹„ìŠ¤(TGS) í‹°ì¼“**ì„ **NTLM í•´ì‹œ**ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•©ë‹ˆë‹¤ (ì˜ˆ: **PC ê³„ì •ì˜ í•´ì‹œ**). ì´ ë°©ë²•ì€ **ì„œë¹„ìŠ¤ ê¶Œí•œì— ì ‘ê·¼í•˜ê¸° ìœ„í•´** ì‚¬ìš©ë©ë‹ˆë‹¤.

{% content-ref url="silver-ticket.md" %}
[silver-ticket.md](silver-ticket.md)
{% endcontent-ref %}

### ê³¨ë“  í‹°ì¼“

**ê³¨ë“  í‹°ì¼“ ê³µê²©**ì€ ê³µê²©ìê°€ Active Directory(AD) í™˜ê²½ì—ì„œ **krbtgt ê³„ì •ì˜ NTLM í•´ì‹œ**ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. ì´ ê³„ì •ì€ ëª¨ë“  **í‹°ì¼“ ë¶€ì—¬ í‹°ì¼“(TGT)**ì— ì„œëª…í•˜ëŠ” ë° ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— íŠ¹ë³„í•©ë‹ˆë‹¤. ì´ëŠ” AD ë„¤íŠ¸ì›Œí¬ ë‚´ì—ì„œ ì¸ì¦í•˜ëŠ” ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤.

ê³µê²©ìê°€ ì´ í•´ì‹œë¥¼ ì–»ìœ¼ë©´, ê·¸ë“¤ì€ ì„ íƒí•œ ëª¨ë“  ê³„ì •ì— ëŒ€í•œ **TGT**ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì‹¤ë²„ í‹°ì¼“ ê³µê²©).

{% content-ref url="golden-ticket.md" %}
[golden-ticket.md](golden-ticket.md)
{% endcontent-ref %}

### ë‹¤ì´ì•„ëª¬ë“œ í‹°ì¼“

ì´ë“¤ì€ ì¼ë°˜ì ì¸ ê³¨ë“  í‹°ì¼“ íƒì§€ ë©”ì»¤ë‹ˆì¦˜ì„ **ìš°íšŒí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ìœ„ì¡°ëœ** ê³¨ë“  í‹°ì¼“ê³¼ ê°™ìŠµë‹ˆë‹¤.

{% content-ref url="diamond-ticket.md" %}
[diamond-ticket.md](diamond-ticket.md)
{% endcontent-ref %}

### **ì¸ì¦ì„œ ê³„ì • ì§€ì†ì„±**

**ê³„ì •ì˜ ì¸ì¦ì„œë¥¼ ë³´ìœ í•˜ê±°ë‚˜ ìš”ì²­í•  ìˆ˜ ìˆëŠ” ê²ƒ**ì€ ì‚¬ìš©ìì˜ ê³„ì •ì— ì§€ì†ì ìœ¼ë¡œ ë‚¨ì•„ ìˆì„ ìˆ˜ ìˆëŠ” ë§¤ìš° ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤ (ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ë”ë¼ë„):

{% content-ref url="ad-certificates/account-persistence.md" %}
[account-persistence.md](ad-certificates/account-persistence.md)
{% endcontent-ref %}

### **ì¸ì¦ì„œ ë„ë©”ì¸ ì§€ì†ì„±**

**ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ ë„ë©”ì¸ ë‚´ì—ì„œ ë†’ì€ ê¶Œí•œìœ¼ë¡œ ì§€ì†í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:**

{% content-ref url="ad-certificates/domain-persistence.md" %}
[domain-persistence.md](ad-certificates/domain-persistence.md)
{% endcontent-ref %}

### AdminSDHolder ê·¸ë£¹

Active Directoryì˜ **AdminSDHolder** ê°ì²´ëŠ” **íŠ¹ê¶Œ ê·¸ë£¹**(ì˜ˆ: ë„ë©”ì¸ ê´€ë¦¬ì ë° ì—”í„°í”„ë¼ì´ì¦ˆ ê´€ë¦¬ì)ì˜ ë³´ì•ˆì„ ë³´ì¥í•˜ê¸° ìœ„í•´ ì´ëŸ¬í•œ ê·¸ë£¹ì— í‘œì¤€ **ì•¡ì„¸ìŠ¤ ì œì–´ ëª©ë¡(ACL)**ì„ ì ìš©í•˜ì—¬ ë¬´ë‹¨ ë³€ê²½ì„ ë°©ì§€í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ê¸°ëŠ¥ì€ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µê²©ìê°€ AdminSDHolderì˜ ACLì„ ìˆ˜ì •í•˜ì—¬ ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ ì „ì²´ ì•¡ì„¸ìŠ¤ë¥¼ ë¶€ì—¬í•˜ë©´, í•´ë‹¹ ì‚¬ìš©ìëŠ” ëª¨ë“  íŠ¹ê¶Œ ê·¸ë£¹ì— ëŒ€í•œ ê´‘ë²”ìœ„í•œ ì œì–´ë¥¼ ì–»ê²Œ ë©ë‹ˆë‹¤. ì´ ë³´ì•ˆ ì¡°ì¹˜ëŠ” ë³´í˜¸ë¥¼ ëª©ì ìœ¼ë¡œ í•˜ì§€ë§Œ, ë©´ë°€íˆ ëª¨ë‹ˆí„°ë§ë˜ì§€ ì•Šìœ¼ë©´ ë¶ˆë²•ì ì¸ ì ‘ê·¼ì„ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[**AdminDSHolder ê·¸ë£¹ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**](privileged-groups-and-token-privileges.md#adminsdholder-group)

### DSRM ìê²© ì¦ëª…

ëª¨ë“  **ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬(DC)** ë‚´ì—ëŠ” **ë¡œì»¬ ê´€ë¦¬ì** ê³„ì •ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë¨¸ì‹ ì—ì„œ ê´€ë¦¬ì ê¶Œí•œì„ ì–»ìœ¼ë©´, **mimikatz**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œì»¬ ê´€ë¦¬ì í•´ì‹œë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´í›„, ì´ ë¹„ë°€ë²ˆí˜¸ë¥¼ **ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í™œì„±í™”**í•˜ê¸° ìœ„í•´ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìˆ˜ì •ì„ í•´ì•¼ í•˜ë©°, ì´ë¥¼ í†µí•´ ë¡œì»¬ ê´€ë¦¬ì ê³„ì •ì— ì›ê²©ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="dsrm-credentials.md" %}
[dsrm-credentials.md](dsrm-credentials.md)
{% endcontent-ref %}

### ACL ì§€ì†ì„±

íŠ¹ì • ë„ë©”ì¸ ê°ì²´ì— ëŒ€í•´ **ì‚¬ìš©ìì—ê²Œ íŠ¹ë³„ ê¶Œí•œ**ì„ ë¶€ì—¬í•˜ì—¬ ì‚¬ìš©ìê°€ **ë¯¸ë˜ì— ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆë„ë¡** í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="acl-persistence-abuse/" %}
[acl-persistence-abuse](acl-persistence-abuse/)
{% endcontent-ref %}

### ë³´ì•ˆ ì„¤ëª…ì

**ë³´ì•ˆ ì„¤ëª…ì**ëŠ” **ê°ì²´**ê°€ **ê°ì²´**ì— ëŒ€í•´ ê°€ì§„ **ê¶Œí•œ**ì„ **ì €ì¥**í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ê°ì²´ì˜ **ë³´ì•ˆ ì„¤ëª…ì**ì— **ì¡°ê¸ˆë§Œ ë³€ê²½**ì„ ê°€í•˜ë©´, íŠ¹ê¶Œ ê·¸ë£¹ì˜ êµ¬ì„±ì›ì´ ë˜ì§€ ì•Šê³ ë„ í•´ë‹¹ ê°ì²´ì— ëŒ€í•´ ë§¤ìš° í¥ë¯¸ë¡œìš´ ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="security-descriptors.md" %}
[security-descriptors.md](security-descriptors.md)
{% endcontent-ref %}

### ìŠ¤ì¼ˆë ˆí†¤ í‚¤

**LSASS**ë¥¼ ë©”ëª¨ë¦¬ì—ì„œ ë³€ê²½í•˜ì—¬ ëª¨ë“  ë„ë©”ì¸ ê³„ì •ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” **ìœ ë‹ˆë²„ì„¤ ë¹„ë°€ë²ˆí˜¸**ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

{% content-ref url="skeleton-key.md" %}
[skeleton-key.md](skeleton-key.md)
{% endcontent-ref %}

### ì‚¬ìš©ì ì •ì˜ SSP

[SSP(ë³´ì•ˆ ì§€ì› ì œê³µì)ê°€ ë¬´ì—‡ì¸ì§€ ì—¬ê¸°ì—ì„œ ì•Œì•„ë³´ì„¸ìš”.](../authentication-credentials-uac-and-efs/#security-support-provider-interface-sspi)\
ìì‹ ì˜ **SSP**ë¥¼ ìƒì„±í•˜ì—¬ ë¨¸ì‹ ì— ì ‘ê·¼í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” **ìê²© ì¦ëª…**ì„ **ëª…í™•í•œ í…ìŠ¤íŠ¸**ë¡œ **ìº¡ì²˜**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\\

{% content-ref url="custom-ssp.md" %}
[custom-ssp.md](custom-ssp.md)
{% endcontent-ref %}

### DCShadow

ADì— **ìƒˆ ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬**ë¥¼ ë“±ë¡í•˜ê³  ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ì •ëœ ê°ì²´ì— **ì†ì„±**(SIDHistory, SPNs...)ì„ **í‘¸ì‹œ**í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ **ìˆ˜ì •**ì— ëŒ€í•œ **ë¡œê·¸**ë¥¼ ë‚¨ê¸°ì§€ ì•ŠìŠµë‹ˆë‹¤. **DA** ê¶Œí•œì´ í•„ìš”í•˜ë©° **ë£¨íŠ¸ ë„ë©”ì¸** ë‚´ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\
ì˜ëª»ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ë§¤ìš° ë¶ˆì¾Œí•œ ë¡œê·¸ê°€ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="dcshadow.md" %}
[dcshadow.md](dcshadow.md)
{% endcontent-ref %}

### LAPS ì§€ì†ì„±

ì´ì „ì— **LAPS ë¹„ë°€ë²ˆí˜¸ë¥¼ ì½ì„ ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê¶Œí•œ**ì´ ìˆì„ ê²½ìš° ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ëŠ” ë°©ë²•ì— ëŒ€í•´ ë…¼ì˜í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ë¹„ë°€ë²ˆí˜¸ëŠ” **ì§€ì†ì„±ì„ ìœ ì§€í•˜ëŠ” ë°ì—ë„ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.\
í™•ì¸í•´ ë³´ì„¸ìš”:

{% content-ref url="laps.md" %}
[laps.md](laps.md)
{% endcontent-ref %}

## í¬ë¦¬ìŠ¤íŠ¸ ê¶Œí•œ ìƒìŠ¹ - ë„ë©”ì¸ ì‹ ë¢°

MicrosoftëŠ” **í¬ë¦¬ìŠ¤íŠ¸**ë¥¼ ë³´ì•ˆ ê²½ê³„ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤. ì´ëŠ” **ë‹¨ì¼ ë„ë©”ì¸ì„ ì†ìƒì‹œí‚¤ëŠ” ê²ƒì´ ì „ì²´ í¬ë¦¬ìŠ¤íŠ¸ê°€ ì†ìƒë  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤**.

### ê¸°ë³¸ ì •ë³´

[**ë„ë©”ì¸ ì‹ ë¢°**](http://technet.microsoft.com/en-us/library/cc759554\(v=ws.10\).aspx)ëŠ” í•œ **ë„ë©”ì¸**ì˜ ì‚¬ìš©ìê°€ ë‹¤ë¥¸ **ë„ë©”ì¸**ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë³´ì•ˆ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. ì´ëŠ” ë‘ ë„ë©”ì¸ì˜ ì¸ì¦ ì‹œìŠ¤í…œ ê°„ì˜ ì—°ê²°ì„ ìƒì„±í•˜ì—¬ ì¸ì¦ ê²€ì¦ì´ ì›í™œí•˜ê²Œ íë¥¼ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. ë„ë©”ì¸ì´ ì‹ ë¢°ë¥¼ ì„¤ì •í•˜ë©´, ê·¸ë“¤ì€ ì‹ ë¢°ì˜ ë¬´ê²°ì„±ì— ì¤‘ìš”í•œ íŠ¹ì • **í‚¤**ë¥¼ **ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬(DC)** ë‚´ì—ì„œ êµí™˜í•˜ê³  ìœ ì§€í•©ë‹ˆë‹¤.

ì¼ë°˜ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ì‚¬ìš©ìê°€ **ì‹ ë¢°ëœ ë„ë©”ì¸**ì˜ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•˜ë ¤ëŠ” ê²½ìš°, ë¨¼ì € ìì‹ ì˜ ë„ë©”ì¸ DCì—ì„œ **ì¸í„°-ë ë¦„ TGT**ë¼ëŠ” íŠ¹ë³„í•œ í‹°ì¼“ì„ ìš”ì²­í•´ì•¼ í•©ë‹ˆë‹¤. ì´ TGTëŠ” ë‘ ë„ë©”ì¸ì´ í•©ì˜í•œ ê³µìœ  **í‚¤**ë¡œ ì•”í˜¸í™”ë©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ì´ TGTë¥¼ **ì‹ ë¢°ëœ ë„ë©”ì¸ì˜ DC**ì— ì œì‹œí•˜ì—¬ ì„œë¹„ìŠ¤ í‹°ì¼“(**TGS**)ì„ ë°›ìŠµë‹ˆë‹¤. ì‹ ë¢°ëœ ë„ë©”ì¸ì˜ DCê°€ ì¸í„°-ë ë¦„ TGTë¥¼ ì„±ê³µì ìœ¼ë¡œ ê²€ì¦í•˜ë©´, TGSë¥¼ ë°œê¸‰í•˜ì—¬ ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

**ë‹¨ê³„**:

1. **ë„ë©”ì¸ 1**ì˜ **í´ë¼ì´ì–¸íŠ¸ ì»´í“¨í„°**ê°€ **ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬(DC1)**ì— **NTLM í•´ì‹œ**ë¥¼ ì‚¬ìš©í•˜ì—¬ **í‹°ì¼“ ë¶€ì—¬ í‹°ì¼“(TGT)**ì„ ìš”ì²­í•˜ëŠ” ê²ƒìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ê°€ ì‹œì‘ë©ë‹ˆë‹¤.
2. í´ë¼ì´ì–¸íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¸ì¦ë˜ë©´ DC1ì€ ìƒˆë¡œìš´ TGTë¥¼ ë°œê¸‰í•©ë‹ˆë‹¤.
3. í´ë¼ì´ì–¸íŠ¸ëŠ” **ë„ë©”ì¸ 2**ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ DC1ì—ì„œ **ì¸í„°-ë ë¦„ TGT**ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.
4. ì¸í„°-ë ë¦„ TGTëŠ” ë‘ ë°©í–¥ ë„ë©”ì¸ ì‹ ë¢°ì˜ ì¼í™˜ìœ¼ë¡œ DC1ê³¼ DC2 ê°„ì— ê³µìœ ëœ **ì‹ ë¢° í‚¤**ë¡œ ì•”í˜¸í™”ë©ë‹ˆë‹¤.
5. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¸í„°-ë ë¦„ TGTë¥¼ **ë„ë©”ì¸ 2ì˜ ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬(DC2)**ë¡œ ê°€ì ¸ê°‘ë‹ˆë‹¤.
6. DC2ëŠ” ê³µìœ ëœ ì‹ ë¢° í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸í„°-ë ë¦„ TGTë¥¼ ê²€ì¦í•˜ê³ , ìœ íš¨í•œ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ê°€ ì ‘ê·¼í•˜ë ¤ëŠ” ë„ë©”ì¸ 2ì˜ ì„œë²„ì— ëŒ€í•œ **í‹°ì¼“ ë¶€ì—¬ ì„œë¹„ìŠ¤(TGS)**ë¥¼ ë°œê¸‰í•©ë‹ˆë‹¤.
7. ë§ˆì§€ë§‰ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ TGSë¥¼ ì„œë²„ì— ì œì‹œí•˜ì—¬ ë„ë©”ì¸ 2ì˜ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•©ë‹ˆë‹¤. ì´ TGSëŠ” ì„œë²„ì˜ ê³„ì • í•´ì‹œë¡œ ì•”í˜¸í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### ë‹¤ì–‘í•œ ì‹ ë¢°

**ì‹ ë¢°ëŠ” 1ë°©í–¥ ë˜ëŠ” 2ë°©í–¥**ì¼ ìˆ˜ ìˆë‹¤ëŠ” ì ì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤. 2ë°©í–¥ ì˜µì…˜ì—ì„œëŠ” ë‘ ë„ë©”ì¸ì´ ì„œë¡œë¥¼ ì‹ ë¢°í•˜ì§€ë§Œ, **1ë°©í–¥** ì‹ ë¢° ê´€ê³„ì—ì„œëŠ” í•œ ë„ë©”ì¸ì´ **ì‹ ë¢°ë°›ëŠ”** ë„ë©”ì¸ì´ê³  ë‹¤ë¥¸ ë„ë©”ì¸ì´ **ì‹ ë¢°í•˜ëŠ”** ë„ë©”ì¸ì…ë‹ˆë‹¤. ë§ˆì§€ë§‰ ê²½ìš°, **ì‹ ë¢°ë°›ëŠ” ë„ë©”ì¸ì—ì„œ ì‹ ë¢°í•˜ëŠ” ë„ë©”ì¸ ë‚´ì˜ ë¦¬ì†ŒìŠ¤ì—ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ë„ë©”ì¸ Aê°€ ë„ë©”ì¸ Bë¥¼ ì‹ ë¢°í•˜ë©´, AëŠ” ì‹ ë¢°í•˜ëŠ” ë„ë©”ì¸ì´ê³  BëŠ” ì‹ ë¢°ë°›ëŠ” ë„ë©”ì¸ì…ë‹ˆë‹¤. ë˜í•œ, **ë„ë©”ì¸ A**ì—ì„œëŠ” ì´ê²ƒì´ **ì•„ì›ƒë°”ìš´ë“œ ì‹ ë¢°**ê°€ ë˜ê³ , **ë„ë©”ì¸ B**ì—ì„œëŠ” ì´ê²ƒì´ **ì¸ë°”ìš´ë“œ ì‹ ë¢°**ê°€ ë©ë‹ˆë‹¤.

**ë‹¤ì–‘í•œ ì‹ ë¢° ê´€ê³„**

* **ë¶€ëª¨-ìì‹ ì‹ ë¢°**: ì´ëŠ” ë™ì¼í•œ í¬ë¦¬ìŠ¤íŠ¸ ë‚´ì—ì„œ ì¼ë°˜ì ì¸ ì„¤ì •ìœ¼ë¡œ, ìì‹ ë„ë©”ì¸ì€ ìë™ìœ¼ë¡œ ë¶€ëª¨ ë„ë©”ì¸ê³¼ 2ë°©í–¥ ì „ì´ ì‹ ë¢°ë¥¼ ê°€ì§‘ë‹ˆë‹¤. ë³¸ì§ˆì ìœ¼ë¡œ ì´ëŠ” ì¸ì¦ ìš”ì²­ì´ ë¶€ëª¨ì™€ ìì‹ ê°„ì— ì›í™œí•˜ê²Œ íë¥¼ ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
* **êµì°¨ ë§í¬ ì‹ ë¢°**: "ë‹¨ì¶• ì‹ ë¢°"ë¼ê³ ë„ í•˜ë©°, ìì‹ ë„ë©”ì¸ ê°„ì— ì„¤ì •ë˜ì–´ ì°¸ì¡° í”„ë¡œì„¸ìŠ¤ë¥¼ ê°€ì†í™”í•©ë‹ˆë‹¤. ë³µì¡í•œ í¬ë¦¬ìŠ¤íŠ¸ì—ì„œëŠ” ì¸ì¦ ì°¸ì¡°ê°€ ì¼ë°˜ì ìœ¼ë¡œ í¬ë¦¬ìŠ¤íŠ¸ ë£¨íŠ¸ë¡œ ì˜¬ë¼ê°”ë‹¤ê°€ ëŒ€ìƒ ë„ë©”ì¸ìœ¼ë¡œ ë‚´ë ¤ê°€ì•¼ í•©ë‹ˆë‹¤. êµì°¨ ë§í¬ë¥¼ ìƒì„±í•¨ìœ¼ë¡œì¨ ì—¬ì •ì„ ë‹¨ì¶•í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì§€ë¦¬ì ìœ¼ë¡œ ë¶„ì‚°ëœ í™˜ê²½ì—ì„œ íŠ¹íˆ ìœ ìš©í•©ë‹ˆë‹¤.
* **ì™¸ë¶€ ì‹ ë¢°**: ì´ëŠ” ì„œë¡œ ê´€ë ¨ì´ ì—†ëŠ” ë„ë©”ì¸ ê°„ì— ì„¤ì •ë˜ë©° ë³¸ì§ˆì ìœ¼ë¡œ ë¹„ì „ì´ì ì…ë‹ˆë‹¤. [Microsoftì˜ ë¬¸ì„œì— ë”°ë¥´ë©´](https://technet.microsoft.com/en-us/library/cc773178\(v=ws.10\).aspx), ì™¸ë¶€ ì‹ ë¢°ëŠ” í˜„ì¬ í¬ë¦¬ìŠ¤íŠ¸ ì™¸ë¶€ì˜ ë„ë©”ì¸ì—ì„œ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ë° ìœ ìš©í•˜ë©°, í¬ë¦¬ìŠ¤íŠ¸ ì‹ ë¢°ë¡œ ì—°ê²°ë˜ì§€ ì•Šì€ ë„ë©”ì¸ì— í•´ë‹¹í•©ë‹ˆë‹¤. ì™¸ë¶€ ì‹ ë¢°ë¥¼ í†µí•´ SID í•„í„°ë§ì„ í†µí•´ ë³´ì•ˆì´ ê°•í™”ë©ë‹ˆë‹¤.
* **íŠ¸ë¦¬ ë£¨íŠ¸ ì‹ ë¢°**: ì´ëŸ¬í•œ ì‹ ë¢°ëŠ” í¬ë¦¬ìŠ¤íŠ¸ ë£¨íŠ¸ ë„ë©”ì¸ê³¼ ìƒˆë¡œ ì¶”ê°€ëœ íŠ¸ë¦¬ ë£¨íŠ¸ ê°„ì— ìë™ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ìì£¼ ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ, íŠ¸ë¦¬ ë£¨íŠ¸ ì‹ ë¢°ëŠ” ìƒˆë¡œìš´ ë„ë©”ì¸ íŠ¸ë¦¬ë¥¼ í¬ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•˜ëŠ” ë° ì¤‘ìš”í•˜ë©°, ì´ë¥¼ í†µí•´ ê³ ìœ í•œ ë„ë©”ì¸ ì´ë¦„ì„ ìœ ì§€í•˜ê³  2ë°©í–¥ ì „ì´ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤. [Microsoftì˜ ê°€ì´ë“œì—ì„œ ë” ë§ì€ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.](https://technet.microsoft.com/en-us/library/cc773178\(v=ws.10\).aspx).
* **í¬ë¦¬ìŠ¤íŠ¸ ì‹ ë¢°**: ì´ ìœ í˜•ì˜ ì‹ ë¢°ëŠ” ë‘ í¬ë¦¬ìŠ¤íŠ¸ ë£¨íŠ¸ ë„ë©”ì¸ ê°„ì˜ 2ë°©í–¥ ì „ì´ ì‹ ë¢°ë¡œ, ë³´ì•ˆ ì¡°ì¹˜ë¥¼ ê°•í™”í•˜ê¸° ìœ„í•´ SID í•„í„°ë§ì„ ì‹œí–‰í•©ë‹ˆë‹¤.
* **MIT ì‹ ë¢°**: ì´ëŸ¬í•œ ì‹ ë¢°ëŠ” ë¹„ Windows, [RFC4120 ì¤€ìˆ˜](https://tools.ietf.org/html/rfc4120) Kerberos ë„ë©”ì¸ê³¼ ì„¤ì •ë©ë‹ˆë‹¤. MIT ì‹ ë¢°ëŠ” ì¢€ ë” ì „ë¬¸í™”ë˜ì–´ ìˆìœ¼ë©°, Windows ìƒíƒœê³„ ì™¸ë¶€ì˜ Kerberos ê¸°ë°˜ ì‹œìŠ¤í…œê³¼ì˜ í†µí•©ì´ í•„ìš”í•œ í™˜ê²½ì— ë§ì¶°ì ¸ ìˆìŠµë‹ˆë‹¤.

#### **ì‹ ë¢° ê´€ê³„ì˜ ë‹¤ë¥¸ ì°¨ì´ì **

* ì‹ ë¢° ê´€ê³„ëŠ” **ì „ì´ì **ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (Aê°€ Bë¥¼ ì‹ ë¢°í•˜ê³ , Bê°€ Cë¥¼ ì‹ ë¢°í•˜ë©´, Aê°€ Cë¥¼ ì‹ ë¢°í•¨) ë˜ëŠ” **ë¹„ì „ì´ì **ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì‹ ë¢° ê´€ê³„ëŠ” **ì–‘ë°©í–¥ ì‹ ë¢°**(ì„œë¡œë¥¼ ì‹ ë¢°í•¨) ë˜ëŠ” **ì¼ë°©í–¥ ì‹ ë¢°**(í•œ ìª½ë§Œ ë‹¤ë¥¸ ìª½ì„ ì‹ ë¢°í•¨)ë¡œ ì„¤ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê³µê²© ê²½ë¡œ

1. **ì‹ ë¢° ê´€ê³„ë¥¼ ì—´ê±°**í•©ë‹ˆë‹¤.
2. ì–´ë–¤ **ë³´ì•ˆ ì£¼ì²´**(ì‚¬ìš©ì/ê·¸ë£¹/ì»´í“¨í„°)ê°€ **ë‹¤ë¥¸ ë„ë©”ì¸ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€** í™•ì¸í•©ë‹ˆë‹¤. ACE í•­ëª©ì´ë‚˜ ë‹¤ë¥¸ ë„ë©”ì¸ì˜ ê·¸ë£¹ì— ì†í•´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ë„ë©”ì¸ ê°„ì˜ ê´€ê³„**ë¥¼ ì°¾ì•„ë³´ì„¸ìš” (ì‹ ë¢°ê°€ ì´ ëª©ì ì„ ìœ„í•´ ìƒì„±ë˜ì—ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤).
3. ì´ ê²½ìš° kerberoastê°€ ë˜ ë‹¤ë¥¸ ì˜µì…˜ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. **ë„ë©”ì¸ì„ í†µí•´ í”¼ë²—í•  ìˆ˜ ìˆëŠ” ê³„ì •ì„ ì†ìƒì‹œí‚µë‹ˆë‹¤**.

ê³µê²©ìëŠ” ë‹¤ìŒ ì„¸ ê°€ì§€ ì£¼ìš” ë©”ì»¤ë‹ˆì¦˜ì„ í†µí•´ ë‹¤ë¥¸ ë„ë©”ì¸ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **ë¡œì»¬ ê·¸ë£¹ êµ¬ì„±ì› ìê²©**: ì£¼ì²´ëŠ” ì„œë²„ì˜ "ê´€ë¦¬ì" ê·¸ë£¹ê³¼ ê°™ì€ ë¨¸ì‹ ì˜ ë¡œì»¬ ê·¸ë£¹ì— ì¶”ê°€ë  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ í•´ë‹¹ ë¨¸ì‹ ì— ëŒ€í•œ ìƒë‹¹í•œ ì œì–´ë¥¼ ë¶€ì—¬ë°›ìŠµë‹ˆë‹¤.
* **ì™¸ë¶€ ë„ë©”ì¸ ê·¸ë£¹ êµ¬ì„±ì› ìê²©**: ì£¼ì²´ëŠ” ì™¸ë¶€ ë„ë©”ì¸ ë‚´ì˜ ê·¸ë£¹ì˜ êµ¬ì„±ì›ì´ ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ë°©ë²•ì˜ íš¨ê³¼ëŠ” ì‹ ë¢°ì˜ ì„±ê²©ê³¼ ê·¸ë£¹ì˜ ë²”ìœ„ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
* **ì•¡ì„¸ìŠ¤ ì œì–´ ëª©ë¡(ACL)**: ì£¼ì²´ëŠ” **DACL** ë‚´ì˜ **ACE**ì˜ ì—”í‹°í‹°ë¡œì„œ **ACL**ì— ì§€ì •ë  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œê³µí•©ë‹ˆë‹¤. ACL, DACL ë° ACEì˜ ë©”ì»¤ë‹ˆì¦˜ì— ëŒ€í•´ ë” ê¹Šì´ íŒŒê³ ë“¤ê³ ì í•˜ëŠ” ë¶„ë“¤ì„ ìœ„í•´, â€œ[An ACE Up The Sleeve](https://specterops.io/assets/resources/an\_ace\_up\_the\_sleeve.pdf)â€ë¼ëŠ” ë°±ì„œê°€ ê·€ì¤‘í•œ ìë£Œì…ë‹ˆë‹¤.

### ìì‹-ë¶€ëª¨ í¬ë¦¬ìŠ¤íŠ¸ ê¶Œí•œ ìƒìŠ¹
```
Get-DomainTrust

SourceName      : sub.domain.local    --> current domain
TargetName      : domain.local        --> foreign domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST       --> WITHIN_FOREST: Both in the same forest
TrustDirection  : Bidirectional       --> Trust direction (2ways in this case)
WhenCreated     : 2/19/2021 1:28:00 PM
WhenChanged     : 2/19/2021 1:28:00 PM
```
{% hint style="warning" %}
ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” **2ê°œì˜ í‚¤**ê°€ ìˆìŠµë‹ˆë‹¤. í•˜ë‚˜ëŠ” _Child --> Parent_ ìš©ì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” _Parent_ --> _Child_ ìš©ì…ë‹ˆë‹¤.\
í˜„ì¬ ë„ë©”ì¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” í‚¤ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
Invoke-Mimikatz -Command '"lsadump::trust /patch"' -ComputerName dc.my.domain.local
Invoke-Mimikatz -Command '"lsadump::dcsync /user:dcorp\mcorp$"'
```
{% endhint %}

#### SID-History Injection

Enterprise adminìœ¼ë¡œì„œ SID-History injectionì„ ì•…ìš©í•˜ì—¬ ìì‹/ë¶€ëª¨ ë„ë©”ì¸ìœ¼ë¡œ ìƒìŠ¹:

{% content-ref url="sid-history-injection.md" %}
[sid-history-injection.md](sid-history-injection.md)
{% endcontent-ref %}

#### ì“°ê¸° ê°€ëŠ¥í•œ Configuration NC ì•…ìš©

Configuration Naming Context (NC)ë¥¼ ì•…ìš©í•˜ëŠ” ë°©ë²•ì„ ì´í•´í•˜ëŠ” ê²ƒì€ ì¤‘ìš”í•˜ë‹¤. Configuration NCëŠ” Active Directory (AD) í™˜ê²½ì—ì„œ í¬ë ˆìŠ¤íŠ¸ ì „ë°˜ì— ê±¸ì³ êµ¬ì„± ë°ì´í„°ì˜ ì¤‘ì•™ ì €ì¥ì†Œ ì—­í• ì„ í•œë‹¤. ì´ ë°ì´í„°ëŠ” í¬ë ˆìŠ¤íŠ¸ ë‚´ ëª¨ë“  ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬(DC)ì— ë³µì œë˜ë©°, ì“°ê¸° ê°€ëŠ¥í•œ DCëŠ” Configuration NCì˜ ì“°ê¸° ê°€ëŠ¥í•œ ë³µì‚¬ë³¸ì„ ìœ ì§€í•œë‹¤. ì´ë¥¼ ì•…ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” **DCì—ì„œ SYSTEM ê¶Œí•œ**ì´ í•„ìš”í•˜ë©°, ë°”ëŒì§í•˜ê²ŒëŠ” ìì‹ DCì—ì„œ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤.

**ë£¨íŠ¸ DC ì‚¬ì´íŠ¸ì— GPO ì—°ê²°**

Configuration NCì˜ Sites ì»¨í…Œì´ë„ˆì—ëŠ” AD í¬ë ˆìŠ¤íŠ¸ ë‚´ ëª¨ë“  ë„ë©”ì¸ì— ê°€ì…ëœ ì»´í“¨í„°ì˜ ì‚¬ì´íŠ¸ì— ëŒ€í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤. DCì—ì„œ SYSTEM ê¶Œí•œìœ¼ë¡œ ì‘ì—…í•¨ìœ¼ë¡œì¨ ê³µê²©ìëŠ” GPOë¥¼ ë£¨íŠ¸ DC ì‚¬ì´íŠ¸ì— ì—°ê²°í•  ìˆ˜ ìˆë‹¤. ì´ ì‘ì—…ì€ ì´ëŸ¬í•œ ì‚¬ì´íŠ¸ì— ì ìš©ëœ ì •ì±…ì„ ì¡°ì‘í•˜ì—¬ ë£¨íŠ¸ ë„ë©”ì¸ì„ ì ì¬ì ìœ¼ë¡œ ìœ„í˜‘í•  ìˆ˜ ìˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” [SID í•„í„° ìš°íšŒ](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-4-bypass-sid-filtering-research)ì— ëŒ€í•œ ì—°êµ¬ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆë‹¤.

**í¬ë ˆìŠ¤íŠ¸ ë‚´ ëª¨ë“  gMSA íƒ€ê²ŸíŒ…**

ê³µê²© ë²¡í„°ëŠ” ë„ë©”ì¸ ë‚´ íŠ¹ê¶Œ gMSAë¥¼ íƒ€ê²ŸíŒ…í•˜ëŠ” ê²ƒì´ë‹¤. gMSAì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê³„ì‚°í•˜ëŠ” ë° í•„ìˆ˜ì ì¸ KDS Root í‚¤ëŠ” Configuration NC ë‚´ì— ì €ì¥ëœë‹¤. DCì—ì„œ SYSTEM ê¶Œí•œì„ ê°€ì§€ê³  ìˆìœ¼ë©´ KDS Root í‚¤ì— ì ‘ê·¼í•˜ì—¬ í¬ë ˆìŠ¤íŠ¸ ë‚´ ëª¨ë“  gMSAì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤.

ìì„¸í•œ ë¶„ì„ì€ [Golden gMSA Trust Attacks](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-5-golden-gmsa-trust-attack-from-child-to-parent)ì— ëŒ€í•œ ë…¼ì˜ì—ì„œ ì°¾ì„ ìˆ˜ ìˆë‹¤.

**ìŠ¤í‚¤ë§ˆ ë³€ê²½ ê³µê²©**

ì´ ë°©ë²•ì€ ìƒˆë¡œìš´ íŠ¹ê¶Œ AD ê°ì²´ì˜ ìƒì„±ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¸ë‚´ê°€ í•„ìš”í•˜ë‹¤. SYSTEM ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” AD ìŠ¤í‚¤ë§ˆë¥¼ ìˆ˜ì •í•˜ì—¬ ëª¨ë“  í´ë˜ìŠ¤ì— ëŒ€í•´ ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì™„ì „í•œ ì œì–´ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” ìƒˆë¡œ ìƒì„±ëœ AD ê°ì²´ì— ëŒ€í•œ ë¬´ë‹¨ ì ‘ê·¼ ë° ì œì–´ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆë‹¤.

ì¶”ê°€ ì½ê¸°ëŠ” [ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹ ë¢° ê³µê²©](https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-6-schema-change-trust-attack-from-child-to-parent)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**ADCS ESC5ë¥¼ í†µí•œ DAì—ì„œ EAë¡œ**

ADCS ESC5 ì·¨ì•½ì ì€ ê³µì¸ í‚¤ ì¸í”„ë¼(PKI) ê°ì²´ì— ëŒ€í•œ ì œì–´ë¥¼ ëª©í‘œë¡œ í•˜ì—¬ í¬ë ˆìŠ¤íŠ¸ ë‚´ì˜ ëª¨ë“  ì‚¬ìš©ìë¡œ ì¸ì¦í•  ìˆ˜ ìˆëŠ” ì¸ì¦ì„œ í…œí”Œë¦¿ì„ ìƒì„±í•œë‹¤. PKI ê°ì²´ëŠ” Configuration NCì— ìœ„ì¹˜í•˜ë¯€ë¡œ, ì“°ê¸° ê°€ëŠ¥í•œ ìì‹ DCë¥¼ ì†ìƒì‹œí‚¤ë©´ ESC5 ê³µê²©ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

ìì„¸í•œ ë‚´ìš©ì€ [ESC5ë¥¼ í†µí•œ DAì—ì„œ EAë¡œ](https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c)ì—ì„œ ì½ì„ ìˆ˜ ìˆë‹¤. ADCSê°€ ì—†ëŠ” ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ê³µê²©ìê°€ í•„ìš”í•œ êµ¬ì„± ìš”ì†Œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì´ ìˆìœ¼ë©°, ì´ëŠ” [ìì‹ ë„ë©”ì¸ ê´€ë¦¬ìì—ì„œ ì—”í„°í”„ë¼ì´ì¦ˆ ê´€ë¦¬ìê¹Œì§€ ìƒìŠ¹](https://www.pkisolutions.com/escalating-from-child-domains-admins-to-enterprise-admins-in-5-minutes-by-abusing-ad-cs-a-follow-up/)ì—ì„œ ë…¼ì˜ëœë‹¤.

### ì™¸ë¶€ í¬ë ˆìŠ¤íŠ¸ ë„ë©”ì¸ - ë‹¨ë°©í–¥(ìˆ˜ì‹ ) ë˜ëŠ” ì–‘ë°©í–¥
```powershell
Get-DomainTrust
SourceName      : a.domain.local   --> Current domain
TargetName      : domain.external  --> Destination domain
TrustType       : WINDOWS-ACTIVE_DIRECTORY
TrustAttributes :
TrustDirection  : Inbound          --> Inboud trust
WhenCreated     : 2/19/2021 10:50:56 PM
WhenChanged     : 2/19/2021 10:50:56 PM
```
ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ **ê·€í•˜ì˜ ë„ë©”ì¸ì€ ì™¸ë¶€ ë„ë©”ì¸ì— ì˜í•´ ì‹ ë¢°ë°›ê³  ìˆìŠµë‹ˆë‹¤**. ì´ë¡œ ì¸í•´ **ì •í•´ì§€ì§€ ì•Šì€ ê¶Œí•œ**ì„ ê°–ê²Œ ë©ë‹ˆë‹¤. ê·€í•˜ëŠ” **ê·€í•˜ì˜ ë„ë©”ì¸ì—ì„œ ì™¸ë¶€ ë„ë©”ì¸ì— ëŒ€í•´ ì–´ë–¤ ì£¼ì²´ê°€ ì–´ë–¤ ì ‘ê·¼ ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ”ì§€** ì°¾ì•„ì•¼ í•˜ë©°, ê·¸ í›„ ì´ë¥¼ ì•…ìš©í•˜ë ¤ê³  ì‹œë„í•´ì•¼ í•©ë‹ˆë‹¤:

{% content-ref url="external-forest-domain-oneway-inbound.md" %}
[external-forest-domain-oneway-inbound.md](external-forest-domain-oneway-inbound.md)
{% endcontent-ref %}

### ì™¸ë¶€ í¬ë¦¬ìŠ¤íŠ¸ ë„ë©”ì¸ - ë‹¨ë°©í–¥ (ì•„ì›ƒë°”ìš´ë“œ)
```powershell
Get-DomainTrust -Domain current.local

SourceName      : current.local   --> Current domain
TargetName      : external.local  --> Destination domain
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : FOREST_TRANSITIVE
TrustDirection  : Outbound        --> Outbound trust
WhenCreated     : 2/19/2021 10:15:24 PM
WhenChanged     : 2/19/2021 10:15:24 PM
```
In this scenario **your domain** is **trusting** some **privileges** to principal from a **different domains**.

ê·¸ëŸ¬ë‚˜ **ë„ë©”ì¸ì´ ì‹ ë¢°ë°›ì„ ë•Œ**, ì‹ ë¢°í•˜ëŠ” ë„ë©”ì¸ì€ **ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì´ë¦„**ì„ ê°€ì§„ **ì‚¬ìš©ì**ë¥¼ **ì‹ ë¢°ëœ ë¹„ë°€ë²ˆí˜¸**ë¥¼ ì‚¬ìš©í•˜ì—¬ **ìƒì„±**í•©ë‹ˆë‹¤. ì´ëŠ” **ì‹ ë¢°í•˜ëŠ” ë„ë©”ì¸ì˜ ì‚¬ìš©ìì— ì ‘ê·¼í•˜ì—¬ ì‹ ë¢°ëœ ë„ë©”ì¸ì— ë“¤ì–´ê°€** ì´ë¥¼ ì—´ê±°í•˜ê³  ë” ë§ì€ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ë ¤ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤:

{% content-ref url="external-forest-domain-one-way-outbound.md" %}
[external-forest-domain-one-way-outbound.md](external-forest-domain-one-way-outbound.md)
{% endcontent-ref %}

ì‹ ë¢°ëœ ë„ë©”ì¸ì„ ì†ìƒì‹œí‚¤ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ **ë„ë©”ì¸ ì‹ ë¢°ì˜ ë°˜ëŒ€ ë°©í–¥**ì— ìƒì„±ëœ [**SQL ì‹ ë¢° ë§í¬**](abusing-ad-mssql.md#mssql-trusted-links)ë¥¼ ì°¾ëŠ” ê²ƒì…ë‹ˆë‹¤(ì´ëŠ” ê·¸ë¦¬ í”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤).

ì‹ ë¢°ëœ ë„ë©”ì¸ì„ ì†ìƒì‹œí‚¤ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ **ì‹ ë¢°ëœ ë„ë©”ì¸ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”** ë¨¸ì‹ ì—ì„œ ëŒ€ê¸°í•˜ì—¬ **RDP**ë¥¼ í†µí•´ ë¡œê·¸ì¸í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ê³µê²©ìëŠ” RDP ì„¸ì…˜ í”„ë¡œì„¸ìŠ¤ì— ì½”ë“œë¥¼ ì£¼ì…í•˜ê³  **í”¼í•´ìì˜ ì›ë˜ ë„ë©”ì¸ì— ì ‘ê·¼**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê²Œë‹¤ê°€, ë§Œì•½ **í”¼í•´ìê°€ ê·¸ì˜ í•˜ë“œ ë“œë¼ì´ë¸Œë¥¼ ë§ˆìš´íŠ¸í–ˆë‹¤ë©´**, ê³µê²©ìëŠ” **RDP ì„¸ì…˜** í”„ë¡œì„¸ìŠ¤ì—ì„œ **í•˜ë“œ ë“œë¼ì´ë¸Œì˜ ì‹œì‘ í´ë”**ì— **ë°±ë„ì–´**ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê¸°ìˆ ì€ **RDPInception**ì´ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤.

{% content-ref url="rdp-sessions-abuse.md" %}
[rdp-sessions-abuse.md](rdp-sessions-abuse.md)
{% endcontent-ref %}

### Domain trust abuse mitigation

### **SID í•„í„°ë§:**

* SID ì—­ì‚¬ ì†ì„±ì„ í™œìš©í•œ ê³µê²©ì˜ ìœ„í—˜ì€ SID í•„í„°ë§ìœ¼ë¡œ ì™„í™”ë˜ë©°, ì´ëŠ” ëª¨ë“  ìƒí˜¸ ìˆ² ì‹ ë¢°ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë©ë‹ˆë‹¤. ì´ëŠ” ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ì˜ ì…ì¥ì— ë”°ë¼ ìˆ²ì„ ë³´ì•ˆ ê²½ê³„ë¡œ ê°„ì£¼í•˜ê³ , ìˆ² ë‚´ ì‹ ë¢°ê°€ ì•ˆì „í•˜ë‹¤ëŠ” ê°€ì •ì— ê¸°ë°˜í•©ë‹ˆë‹¤.
* ê·¸ëŸ¬ë‚˜ ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤: SID í•„í„°ë§ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì‚¬ìš©ì ì ‘ê·¼ì„ ë°©í•´í•  ìˆ˜ ìˆì–´ ê°€ë” ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.

### **ì„ íƒì  ì¸ì¦:**

* ìƒí˜¸ ìˆ² ì‹ ë¢°ì˜ ê²½ìš°, ì„ íƒì  ì¸ì¦ì„ ì‚¬ìš©í•˜ë©´ ë‘ ìˆ²ì˜ ì‚¬ìš©ìë“¤ì´ ìë™ìœ¼ë¡œ ì¸ì¦ë˜ì§€ ì•Šë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ëŒ€ì‹ , ì‹ ë¢°í•˜ëŠ” ë„ë©”ì¸ì´ë‚˜ ìˆ² ë‚´ì˜ ë„ë©”ì¸ ë° ì„œë²„ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” ëª…ì‹œì ì¸ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.
* ì´ëŸ¬í•œ ì¡°ì¹˜ê°€ ì“°ê¸° ê°€ëŠ¥í•œ êµ¬ì„± ëª…ëª… ì»¨í…ìŠ¤íŠ¸(NC)ì˜ ì•…ìš©ì´ë‚˜ ì‹ ë¢° ê³„ì •ì— ëŒ€í•œ ê³µê²©ìœ¼ë¡œë¶€í„° ë³´í˜¸í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

[**ired.teamì˜ ë„ë©”ì¸ ì‹ ë¢°ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´.**](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain)

## AD -> Azure & Azure -> AD

{% embed url="https://cloud.hacktricks.xyz/pentesting-cloud/azure-security/az-lateral-movements/azure-ad-connect-hybrid-identity" %}

## Some General Defenses

[**ìê²© ì¦ëª…ì„ ë³´í˜¸í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ë” ì•Œì•„ë³´ì„¸ìš”.**](../stealing-credentials/credentials-protections.md)\\

### **ìê²© ì¦ëª… ë³´í˜¸ë¥¼ ìœ„í•œ ë°©ì–´ ì¡°ì¹˜**

* **ë„ë©”ì¸ ê´€ë¦¬ì ì œí•œ**: ë„ë©”ì¸ ê´€ë¦¬ìëŠ” ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ë§Œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆë„ë¡ ê¶Œì¥í•˜ë©°, ë‹¤ë¥¸ í˜¸ìŠ¤íŠ¸ì—ì„œì˜ ì‚¬ìš©ì€ í”¼í•´ì•¼ í•©ë‹ˆë‹¤.
* **ì„œë¹„ìŠ¤ ê³„ì • ê¶Œí•œ**: ë³´ì•ˆì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì„œë¹„ìŠ¤ëŠ” ë„ë©”ì¸ ê´€ë¦¬ì(DA) ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.
* **ì„ì‹œ ê¶Œí•œ ì œí•œ**: DA ê¶Œí•œì´ í•„ìš”í•œ ì‘ì—…ì˜ ê²½ìš°, ê·¸ ê¸°ê°„ì„ ì œí•œí•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: `Add-ADGroupMember -Identity â€˜Domain Adminsâ€™ -Members newDA -MemberTimeToLive (New-TimeSpan -Minutes 20)`

### **ê¸°ë§Œ ê¸°ìˆ  êµ¬í˜„**

* ê¸°ë§Œì„ êµ¬í˜„í•˜ëŠ” ê²ƒì€ ë¹„ë°€ë²ˆí˜¸ê°€ ë§Œë£Œë˜ì§€ ì•Šê±°ë‚˜ ìœ„ì„ì„ ìœ„í•´ ì‹ ë¢°ëœ ê²ƒìœ¼ë¡œ í‘œì‹œëœ ê²ƒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ê°€ì§„ ìœ ì¸ ì‚¬ìš©ì ë˜ëŠ” ì»´í“¨í„°ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. êµ¬ì²´ì ì¸ ì ‘ê·¼ ë°©ì‹ì—ëŠ” íŠ¹ì • ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ê±°ë‚˜ ë†’ì€ ê¶Œí•œ ê·¸ë£¹ì— ì¶”ê°€í•˜ëŠ” ê²ƒì´ í¬í•¨ë©ë‹ˆë‹¤.
* ì‹¤ìš©ì ì¸ ì˜ˆë¡œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤: `Create-DecoyUser -UserFirstName user -UserLastName manager-uncommon -Password Pass@123 | DeployUserDeception -UserFlag PasswordNeverExpires -GUID d07da11f-8a3d-42b6-b0aa-76c962be719a -Verbose`
* ê¸°ë§Œ ê¸°ìˆ  ë°°í¬ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ëŠ” [GitHubì˜ Deploy-Deception](https://github.com/samratashok/Deploy-Deception)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **ê¸°ë§Œ ì‹ë³„**

* **ì‚¬ìš©ì ê°ì²´ì˜ ê²½ìš°**: ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì§€í‘œì—ëŠ” ë¹„ì •ìƒì ì¸ ObjectSID, ë“œë¬¸ ë¡œê·¸ì¸, ìƒì„± ë‚ ì§œ ë° ë‚®ì€ ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ ìˆ˜ê°€ í¬í•¨ë©ë‹ˆë‹¤.
* **ì¼ë°˜ ì§€í‘œ**: ì ì¬ì ì¸ ìœ ì¸ ê°ì²´ì˜ ì†ì„±ì„ ì§„ì§œ ê°ì²´ì˜ ì†ì„±ê³¼ ë¹„êµí•˜ë©´ ë¶ˆì¼ì¹˜ê°€ ë“œëŸ¬ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [HoneypotBuster](https://github.com/JavelinNetworks/HoneypotBuster)ì™€ ê°™ì€ ë„êµ¬ëŠ” ì´ëŸ¬í•œ ê¸°ë§Œì„ ì‹ë³„í•˜ëŠ” ë° ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **íƒì§€ ì‹œìŠ¤í…œ ìš°íšŒ**

* **Microsoft ATA íƒì§€ ìš°íšŒ**:
* **ì‚¬ìš©ì ì—´ê±°**: ATA íƒì§€ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì„¸ì…˜ ì—´ê±°ë¥¼ í”¼í•©ë‹ˆë‹¤.
* **í‹°ì¼“ ê°€ì¥í•˜ê¸°**: í‹°ì¼“ ìƒì„±ì„ ìœ„í•´ **aes** í‚¤ë¥¼ ì‚¬ìš©í•˜ë©´ NTLMë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œí•˜ì§€ ì•ŠìŒìœ¼ë¡œì¨ íƒì§€ë¥¼ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **DCSync ê³µê²©**: ATA íƒì§€ë¥¼ í”¼í•˜ê¸° ìœ„í•´ ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì•„ë‹Œ ê³³ì—ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë˜ë©°, ë„ë©”ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì§ì ‘ ì‹¤í–‰í•˜ë©´ ê²½ê³ ê°€ ë°œìƒí•©ë‹ˆë‹¤.

## References

* [http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/](http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/)
* [https://www.labofapenetrationtester.com/2018/10/deploy-deception.html](https://www.labofapenetrationtester.com/2018/10/deploy-deception.html)
* [https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/child-domain-da-to-ea-in-parent-domain)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
