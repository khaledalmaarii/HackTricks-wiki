# AD CS рдЦрд╛рддрд╛ рд╕реНрдерд┐рд░рддрд╛

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

**рдпрд╣ [https://www.specterops.io/assets/resources/Certified\_Pre-Owned.pdf](https://www.specterops.io/assets/resources/Certified\_Pre-Owned.pdf) рд╕реЗ рдЕрджреНрднреБрдд рд╢реЛрдз рдХреЗ рдорд╢реАрди рд╕реНрдерд┐рд░рддрд╛ рдЕрдзреНрдпрд╛рдпреЛрдВ рдХрд╛ рдЫреЛрдЯрд╛ рд╕рд╛рд░рд╛рдВрд╢ рд╣реИ**


## **рдкреНрд░рдореБрдЦ рдпреВрдЬрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЪреЛрд░реА рдХреЛ рдкреНрд░рдорд╛рдг рдкрддреНрд░реЛрдВ рдХреЗ рд╕рд╛рде рд╕рдордЭрдирд╛ - PERSIST1**

рдПрдХ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЬрд╣рд╛рдВ рдПрдХ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдЬреЛ рдбреЛрдореЗрди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ **рд╕реНрдерд┐рд░рддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ** рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЛ **рдЕрдиреБрд░реЛрдз** рдФрд░ **рдЪреБрд░рд╛рдиреЗ** рдХрд╛ рдореМрдХрд╛ рдорд┐рд▓рддрд╛ рд╣реИред рдПрдХреНрдЯрд┐рд╡ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ `User` рдЯреЗрдореНрдкрд▓реЗрдЯ рдРрд╕реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХрднреА-рдХрднреА рдпрд╣ рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

[**Certify**](https://github.com/GhostPack/Certify) рдирд╛рдордХ рдПрдХ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдХреЛрдИ рднреА рдорд╛рдиреНрдп рдкреНрд░рдорд╛рдг рдкрддреНрд░реЛрдВ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╕реНрдерд╛рдпреА рдкрд╣реБрдВрдЪ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддреЗ рд╣реИрдВ:
```bash
Certify.exe find /clientauth
```
**рдкреНрд░рдорд╛рдгрдкрддреНрд░** рдХреА рд╢рдХреНрддрд┐ рдЙрд╕рдХреА рдХреНрд╖рдорддрд╛ рдореЗрдВ рд╣реИ рдЬреЛ рдпрд╣ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ **рдкреНрд░рдорд╛рдгрд┐рдд** рд╣реЛрдиреЗ рдХреА рд╣реИ, рдХрд┐рд╕реА рднреА рдкрд╛рд╕рд╡рд░реНрдб рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдЬрдм рддрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ **рдорд╛рдиреНрдп** рд░рд╣рддрд╛ рд╣реИред

рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЛ `certmgr.msc` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╛ `certreq.exe` рдХреЗ рд╕рд╛рде рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред **Certify** рдХреЗ рд╕рд╛рде, рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд░реВрдк рдореЗрдВ рд╕рд░рд▓ рд╣реЛрддреА рд╣реИ:
```bash
Certify.exe request /ca:CA-SERVER\CA-NAME /template:TEMPLATE-NAME
```
рдПрдХ рд╕рдлрд▓ рдЕрдиреБрд░реЛрдз рдХреЗ рдмрд╛рдж, рдПрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рде рдЙрд╕рдХреА рдирд┐рдЬреА рдХреБрдВрдЬреА `.pem` рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдЙрддреНрдкрдиреНрди рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕реЗ рдПрдХ `.pfx` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЬреЛ Windows рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдЙрдкрдпреЛрдЧреА рд╣реИ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```bash
openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx
```
рдлрд┐рд░ `.pfx` рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓рдХреНрд╖реНрдп рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ [**Rubeus**](https://github.com/GhostPack/Rubeus) рдирд╛рдордХ рдПрдХ рдЙрдкрдХрд░рдг рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдЯрд┐рдХрдЯ рдЧреНрд░рд╛рдВрдЯрд┐рдВрдЧ рдЯрд┐рдХрдЯ (TGT) рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рд╣рдорд▓рд╛рд╡рд░ рдХреА рдкрд╣реБрдВрдЪ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдкреНрд░рдорд╛рдгрдкрддреНрд░ **рдорд╛рдиреНрдп** рд╣реЛрдиреЗ рддрдХ (рд╕рд╛рдорд╛рдиреНрдпрдд: рдПрдХ рд╕рд╛рд▓):
```bash
Rubeus.exe asktgt /user:harmj0y /certificate:C:\Temp\cert.pfx /password:CertPass!
```
## **рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЗ рд╕рд╛рде рдорд╢реАрди рд╕реНрдерд┐рд░рддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ - PERSIST2**

рдПрдХ рдФрд░ рддрдХрдиреАрдХ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдорд╢реАрди рдЦрд╛рддреЗ рдХреЛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд▓рд┐рдП рдирд╛рдорд╛рдВрдХрд┐рдд рдХрд░рдирд╛, рдбрд┐рдлрд╝реЙрд▓реНрдЯ `Machine` рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдПред рдпрджрд┐ рдХрд┐рд╕реА рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдЙрдЪреНрдЪрд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╡реЗ **SYSTEM** рдЦрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА **рд╕реНрдерд┐рд░рддрд╛** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ:
```bash
Certify.exe request /ca:dc.theshire.local/theshire-DC-CA /template:Machine /machine
```
рдпрд╣ рдкрд╣реБрдВрдЪ рдЕрдЯреИрдХрд░ рдХреЛ **рдХрд░реНрдмреЗрд░реЛрд╕** рдореЗрдВ рдорд╢реАрди рдЕрдХрд╛рдЙрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ рдФрд░ **S4U2Self** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реЛрд╕реНрдЯ рдкрд░ рдХрд┐рд╕реА рднреА рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдХрд░реНрдмреЗрд░реЛрд╕ рд╕реЗрд╡рд╛ рдЯрд┐рдХрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрдЯреИрдХрд░ рдХреЛ рдорд╢реАрди рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдпреА рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред

## **рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд░рд┐рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ - PERSIST3**

рдЪрд░реНрдЪрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЕрдВрддрд┐рдо рддрд░реАрдХрд╛ **рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЯреЗрдореНрдкрд▓реЗрдЯ** рдХреА **рдорд╛рдиреНрдпрддрд╛** рдФрд░ **рдирд╡реАрдХрд░рдг рдЕрд╡рдзрд┐рдпреЛрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рд╣реИред рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЛ рдЗрд╕рдХреЗ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд╡реАрдХрд░рдг рдХрд░рдХреЗ, рдПрдХ рдЕрдЯреИрдХрд░ рд╕рдХреНрд░рд┐рдп рдбрд╛рдпрд░реЗрдХреНрдЯреНрд░реА рдХреЛ рдкреБрдирдГ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдмрдирд╛рдП рд░рдЦ рд╕рдХрддрд╛ рд╣реИ рдмрд┐рдирд╛ рдЕрддрд┐рд░рд┐рдХреНрдд рдЯрд┐рдХрдЯ рдкрдВрдЬреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ, рдЬреЛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкреНрд░рд╛рдзрд┐рдХрд░рдг (CA) рд╕рд░реНрд╡рд░ рдкрд░ рдирд┐рд╢рд╛рди рдЫреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдПрдХ **рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╕реНрдерд┐рд░рддрд╛** рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, CA рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рдХрдо рдмрд╛рддрдЪреАрддреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣рдЪрд╛рди рдХрд╛ рдЬреЛрдЦрд┐рдо рдХрдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрднрд┐рд╡рд╛рджрдирдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрддрд┐рдХреНрд░рдордг рдХреА рд╕реВрдЪрдирд╛ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рдХрд╛ рдЙрддреНрдкрд╛рджрди рдЯрд╛рд▓рддрд╛ рд╣реИред
